<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å„ªå…ˆåº¦è¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { color: #667eea; margin-bottom: 10px; }
    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin: 10px 5px;
      transition: transform 0.2s;
    }
    .btn:active { transform: scale(0.95); }
    .btn-back { background: #95a5a6; }
    .summary {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .category { margin: 10px 0; font-size: 18px; }
    .incorrect { color: #e74c3c; }
    .still-learning { color: #f39c12; }
    .new { color: #3498db; }
    .mastered { color: #27ae60; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #667eea;
      color: white;
      font-weight: 600;
    }
    tr:hover { background: #f8f9fa; }
    .priority { font-weight: bold; font-size: 16px; }
    .no-data {
      text-align: center;
      padding: 40px;
      color: #95a5a6;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” å„ªå…ˆåº¦è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
    <p style="color: #7f8c8d; margin-bottom: 20px;">LocalStorageã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã™</p>

    <div>
      <button class="btn" onclick="checkData()">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª</button>
      <button class="btn btn-back" onclick="location.href='/'">ğŸ  ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</button>
    </div>

    <div id="output"></div>
  </div>

  <script>
    function checkData() {
      try {
        const data = JSON.parse(localStorage.getItem('english-progress') || '{}');
        const wordProgress = data.wordProgress || {};

        const words = Object.entries(wordProgress);

        if (words.length === 0) {
          document.getElementById('output').innerHTML = `
            <div class="no-data">
              âŒ ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br><br>
              æš—è¨˜ã‚¿ãƒ–ã§å•é¡Œã‚’è§£ã„ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„
            </div>
          `;
          return;
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã«åˆ†é¡
        const categories = {
          incorrect: [],
          still_learning: [],
          new: [],
          mastered: []
        };

        let noPriority = 0;
        let totalWords = 0;

        words.forEach(([word, p]) => {
          totalWords++;
          const cat = p.category || 'new';

          if (p.calculatedPriority === undefined) {
            noPriority++;
          }

          const item = {
            word,
            correct: p.correctCount || 0,
            incorrect: p.incorrectCount || 0,
            priority: p.calculatedPriority,
            accuracy: p.correctCount && p.incorrectCount
              ? ((p.correctCount / (p.correctCount + p.incorrectCount)) * 100).toFixed(1)
              : 'N/A'
          };

          if (categories[cat]) {
            categories[cat].push(item);
          }
        });

        // å„ªå…ˆåº¦é †ã«ã‚½ãƒ¼ãƒˆ
        Object.keys(categories).forEach(cat => {
          categories[cat].sort((a, b) => (b.priority || 0) - (a.priority || 0));
        });

        // HTMLç”Ÿæˆ
        let html = `
          <div class="summary">
            <h2>ğŸ“Š çµ±è¨ˆ</h2>
            <div class="category incorrect">âŒ åˆ†ã‹ã‚‰ãªã„: ${categories.incorrect.length}èª</div>
            <div class="category still-learning">ğŸŸ¡ ã¾ã ã¾ã : ${categories.still_learning.length}èª</div>
            <div class="category new">ğŸ†• æœªå­¦ç¿’: ${categories.new.length}èª</div>
            <div class="category mastered">âœ… è¦šãˆã¦ã‚‹: ${categories.mastered.length}èª</div>
            <div class="category" style="color: #e74c3c;">âš ï¸ å„ªå…ˆåº¦æœªè¨ˆç®—: ${noPriority}èª / ${totalWords}èª</div>
          </div>
        `;

        // incorrectã®è©³ç´°
        if (categories.incorrect.length > 0) {
          html += '<h3 style="color: #e74c3c; margin-top: 30px;">âŒ åˆ†ã‹ã‚‰ãªã„ï¼ˆæœ€å„ªå…ˆã§å‡ºé¡Œã•ã‚Œã‚‹ã¹ãï¼‰</h3>';
          html += '<table><thead><tr><th>å˜èª</th><th>æ­£è§£</th><th>ä¸æ­£è§£</th><th>æ­£ç­”ç‡</th><th>å„ªå…ˆåº¦</th></tr></thead><tbody>';
          categories.incorrect.slice(0, 20).forEach(item => {
            const priorityColor = item.priority === undefined ? '#e74c3c' : '#27ae60';
            html += `<tr>
              <td><strong>${item.word}</strong></td>
              <td>${item.correct}</td>
              <td>${item.incorrect}</td>
              <td>${item.accuracy}%</td>
              <td class="priority" style="color: ${priorityColor};">
                ${item.priority !== undefined ? item.priority.toFixed(1) : 'æœªè¨ˆç®—âŒ'}
              </td>
            </tr>`;
          });
          html += '</tbody></table>';
        }

        // still_learningã®è©³ç´°
        if (categories.still_learning.length > 0) {
          html += '<h3 style="color: #f39c12; margin-top: 30px;">ğŸŸ¡ ã¾ã ã¾ã </h3>';
          html += '<table><thead><tr><th>å˜èª</th><th>æ­£è§£</th><th>ä¸æ­£è§£</th><th>æ­£ç­”ç‡</th><th>å„ªå…ˆåº¦</th></tr></thead><tbody>';
          categories.still_learning.slice(0, 10).forEach(item => {
            const priorityColor = item.priority === undefined ? '#e74c3c' : '#27ae60';
            html += `<tr>
              <td><strong>${item.word}</strong></td>
              <td>${item.correct}</td>
              <td>${item.incorrect}</td>
              <td>${item.accuracy}%</td>
              <td class="priority" style="color: ${priorityColor};">
                ${item.priority !== undefined ? item.priority.toFixed(1) : 'æœªè¨ˆç®—âŒ'}
              </td>
            </tr>`;
          });
          html += '</tbody></table>';
        }

        // çµè«–
        if (noPriority > 0) {
          html += `
            <div style="background: #fff3cd; border-left: 4px solid #f39c12; padding: 15px; margin-top: 20px;">
              <strong>âš ï¸ å•é¡Œæ¤œå‡º:</strong><br>
              ${noPriority}èªã®å„ªå…ˆåº¦ãŒæœªè¨ˆç®—ã§ã™ã€‚ã“ã‚Œã‚‰ã¯ä¿®æ­£å‰ã®ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚<br>
              ã“ã‚Œã‚‰ã®å˜èªã‚’1å›ãšã¤å›ç­”ã™ã‚‹ã¨å„ªå…ˆåº¦ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¾ã™ã€‚
            </div>
          `;
        } else {
          html += `
            <div style="background: #d4edda; border-left: 4px solid #27ae60; padding: 15px; margin-top: 20px;">
              <strong>âœ… æ­£å¸¸:</strong><br>
              ã™ã¹ã¦ã®å˜èªã«å„ªå…ˆåº¦ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚incorrectã®å˜èªãŒæœ€å„ªå…ˆã§å‡ºé¡Œã•ã‚Œã¾ã™ã€‚
            </div>
          `;
        }

        document.getElementById('output').innerHTML = html;

      } catch (error) {
        document.getElementById('output').innerHTML = `
          <div class="no-data">
            âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ<br><br>
            ${error.message}
          </div>
        `;
      }
    }
  </script>
</body>
</html>
