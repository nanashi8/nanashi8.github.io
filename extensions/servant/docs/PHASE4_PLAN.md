# Phase 4è¨ˆç”»: pre-commitçµ±åˆ

**é–‹å§‹æ—¥**: 2025å¹´12æœˆ31æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨ˆç”»ä¸­

---

## ğŸ¯ ç›®æ¨™

Phase 4ã§ã¯ã€Instructions Validatorã‚’**Gitãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**ã«çµ±åˆã—ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•çš„ã«ãƒ«ãƒ¼ãƒ«é•åã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é•åãŒå«ã¾ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

---

## ğŸ“‹ å®Ÿè£…ç¯„å›²

### 1. Git Hooksçµ±åˆ

#### pre-commit hook
- ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•å®Ÿè¡Œ
- `.instructions.md`ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼
- é•åãŒã‚ã‚Œã°ã‚³ãƒŸãƒƒãƒˆä¸­æ–­
- é•åç®‡æ‰€ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤º

#### commit-msg hook (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å“è³ªãƒã‚§ãƒƒã‚¯
- Conventional Commitså½¢å¼ã®æ¨å¥¨
- Instructionså‚ç…§ã®æ¨å¥¨

### 2. VSCodeçµ±åˆ

#### Source Controlçµ±åˆ
- ã‚³ãƒŸãƒƒãƒˆå‰ã®è­¦å‘Šè¡¨ç¤º
- Quick Fixã¸ã®ãƒªãƒ³ã‚¯
- é•åã‚µãƒãƒªãƒ¼ã®è¡¨ç¤º

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼çŠ¶æ…‹ã®è¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º

### 3. è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³

```json
{
  "instructionsValidator.preCommit.enabled": true,
  "instructionsValidator.preCommit.strictMode": false,
  "instructionsValidator.preCommit.autoFix": false,
  "instructionsValidator.preCommit.ignorePatterns": []
}
```

---

## ğŸ› ï¸ æŠ€è¡“è¨­è¨ˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VSCode Extension                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PreCommitValidator          â”‚   â”‚
â”‚  â”‚ - checkBeforeCommit()       â”‚   â”‚
â”‚  â”‚ - registerHooks()           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â†“                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ RuleEngine                  â”‚   â”‚
â”‚  â”‚ - validateAll()             â”‚   â”‚
â”‚  â”‚ - getViolations()           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Git Hooks (.git/hooks/)            â”‚
â”‚  - pre-commit                       â”‚
â”‚  - commit-msg                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

```
extensions/instructions-validator/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ git/
â”‚   â”‚   â”œâ”€â”€ PreCommitValidator.ts     (æ–°è¦)
â”‚   â”‚   â”œâ”€â”€ HookInstaller.ts          (æ–°è¦)
â”‚   â”‚   â””â”€â”€ GitIntegration.ts         (æ–°è¦)
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ StatusBarItem.ts          (æ–°è¦)
â”‚   â”‚   â””â”€â”€ SourceControlDecorator.ts (æ–°è¦)
â”‚   â””â”€â”€ extension.ts                  (æ›´æ–°)
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ pre-commit                    (æ–°è¦)
â”‚   â””â”€â”€ commit-msg                    (æ–°è¦)
â””â”€â”€ tests/
    â”œâ”€â”€ PreCommitValidator.test.ts    (æ–°è¦)
    â”œâ”€â”€ HookInstaller.test.ts         (æ–°è¦)
    â””â”€â”€ GitIntegration.test.ts        (æ–°è¦)
```

---

## ğŸ“ å®Ÿè£…æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: PreCommitValidatorå®Ÿè£… (1-2æ™‚é–“)
- [ ] `PreCommitValidator.ts`ä½œæˆ
- [ ] `checkBeforeCommit()`ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] RuleEngineã¨ã®çµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ (æœ€ä½10ã‚±ãƒ¼ã‚¹)

### ã‚¹ãƒ†ãƒƒãƒ—2: Hook Installerå®Ÿè£… (1æ™‚é–“)
- [ ] `HookInstaller.ts`ä½œæˆ
- [ ] `.git/hooks/pre-commit`ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
- [ ] ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¨­å®š (chmod +x)
- [ ] æ—¢å­˜hookã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—3: Gitçµ±åˆ (1æ™‚é–“)
- [ ] `GitIntegration.ts`ä½œæˆ
- [ ] staged filesã®å–å¾—
- [ ] gitãƒªãƒã‚¸ãƒˆãƒªã®æ¤œå‡º
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—4: UIå®Ÿè£… (1æ™‚é–“)
- [ ] `StatusBarItem.ts`ä½œæˆ
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
- [ ] ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è©³ç´°è¡¨ç¤º
- [ ] `SourceControlDecorator.ts`ä½œæˆ
- [ ] Source Controlçµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—5: è¨­å®šã¨çµ±åˆ (30åˆ†)
- [ ] `package.json`ã«è¨­å®šè¿½åŠ 
- [ ] `extension.ts`ã§åˆæœŸåŒ–
- [ ] ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã®hookã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- [ ] ãƒ†ã‚¹ãƒˆä½œæˆ

### ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚° (1æ™‚é–“)
- [ ] å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (ç›®æ¨™: 70/70ãƒ‘ã‚¹)
- [ ] E2Eãƒ†ã‚¹ãƒˆ (å®Ÿéš›ã®Gitãƒªãƒã‚¸ãƒˆãƒªã§æ¤œè¨¼)
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æ¤œè¨¼

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ (æœ€ä½20ã‚±ãƒ¼ã‚¹è¿½åŠ )

```typescript
describe('PreCommitValidator', () => {
  it('should detect violations in staged files');
  it('should allow commit when no violations');
  it('should block commit when violations exist');
  it('should respect strictMode setting');
  it('should skip ignored patterns');
  // ... 15+ more tests
});

describe('HookInstaller', () => {
  it('should install pre-commit hook');
  it('should backup existing hook');
  it('should set correct permissions');
  it('should handle installation errors');
  // ... 6+ more tests
});
```

### E2Eãƒ†ã‚¹ãƒˆ

```bash
# ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª
1. æ­£å¸¸ãªãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆ (æˆåŠŸ)
2. é•åãŒã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆ (å¤±æ•—)
3. Quick Fixã§ä¿®æ­£å¾Œã®ã‚³ãƒŸãƒƒãƒˆ (æˆåŠŸ)
4. ignorePatternsè¨­å®šã®ãƒ†ã‚¹ãƒˆ
5. strictMode ON/OFFåˆ‡ã‚Šæ›¿ãˆ
```

---

## ğŸ“Š æˆåŠŸåŸºæº–

| é …ç›® | ç›®æ¨™ | æ¤œè¨¼æ–¹æ³• |
|------|------|----------|
| ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹ç‡ | 70/70 | npm test |
| Hookè‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | 100% | æ‹¡å¼µæ©Ÿèƒ½æœ‰åŠ¹åŒ–æ™‚ |
| é•åæ¤œå‡ºç²¾åº¦ | 100% | E2Eãƒ†ã‚¹ãƒˆ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | <1ç§’ | å¤§è¦æ¨¡ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ã‚³ãƒŸãƒƒãƒˆæ™‚é–“ |
| ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ | ç›´æ„Ÿçš„ | æ‰‹å‹•ãƒ†ã‚¹ãƒˆ |

---

## ğŸš§ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: æ—¢å­˜ã®Git Hooksã¨ã®ç«¶åˆ
**å¯¾ç­–**: æ—¢å­˜hookã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã€å†…å®¹ã‚’ãƒãƒ¼ã‚¸ã™ã‚‹

### ãƒªã‚¹ã‚¯2: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
**å¯¾ç­–**: ä¸¦åˆ—å‡¦ç†ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã€staged filesã®ã¿ãƒã‚§ãƒƒã‚¯

### ãƒªã‚¹ã‚¯3: ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ äº’æ›æ€§
**å¯¾ç­–**: Windows/macOS/Linuxã§å€‹åˆ¥ãƒ†ã‚¹ãƒˆ

---

## ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

- **Day 1**: ã‚¹ãƒ†ãƒƒãƒ—1-2å®Œäº† (PreCommitValidator + HookInstaller)
- **Day 2**: ã‚¹ãƒ†ãƒƒãƒ—3-4å®Œäº† (Gitçµ±åˆ + UI)
- **Day 3**: ã‚¹ãƒ†ãƒƒãƒ—5-6å®Œäº† (è¨­å®š + ãƒ†ã‚¹ãƒˆ)

**äºˆæƒ³å®Œäº†æ—¥**: 2025å¹´1æœˆ3æ—¥

---

## ğŸ¯ Phase 4å®Œäº†æ¡ä»¶

- [x] Phase 4è¨ˆç”»æ›¸ä½œæˆ
- [ ] PreCommitValidatorå®Ÿè£…å®Œäº†
- [ ] HookInstallerå®Ÿè£…å®Œäº†
- [ ] Gitçµ±åˆå®Œäº†
- [ ] UIå®Ÿè£…å®Œäº†
- [ ] å…¨70ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹
- [ ] E2Eãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
- [ ] Phase 4å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ

---

## ğŸ”œ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºäºˆå®š

**Phase 5**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ä¸¦åˆ—å‡¦ç†
- ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«æ¤œè¨¼
- ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

**Phase 6**: Marketplaceå…¬é–‹
- READMEä½œæˆ
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæº–å‚™
- å…¬é–‹æ‰‹ç¶šã

---

**æº–å‚™å®Œäº†ï¼Phase 4å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ï¼** ğŸš€
