# 文法問題解説の品質ガイドライン

## 目的

このガイドは、文法問題の解説を学習者にとって真に有益なものにし、手抜き解説を防止するために作成されました。

## 品質チェックシステム

`tools/validate-grammar-explanations.ts` により、すべての文法問題の解説が以下の基準を満たしているか自動チェックされます。

### ビルド時の自動実行

- `npm run build` を実行すると、ビルド前に自動的に解説品質チェックが実行されます
- チェックに失敗すると、ビルドが中断されます
- これにより、品質基準を満たさない解説が本番環境にデプロイされることを防ぎます

### 手動実行

```bash
npm run validate:grammar:explanations
```

## 品質基準

### 1. 最小文字数

すべての解説は **最低50文字以上** 必要です。

❌ 悪い例:
```json
"explanation": "比較級: more + 形容詞"
```

✅ 良い例:
```json
"explanation": "比較級は「～より...」という意味を表します。interestingは3音節の長い形容詞なので、語尾に-erをつけず「more + 形容詞」の形を使います。短い形容詞（1～2音節）にはtaller、smarterのように-erをつけますが、長い形容詞（3音節以上）にはmore interesting、more beautifulのようにmoreを前につけます。"
```

### 2. 文法ポイント別の必須キーワード

各文法ポイントには、解説に含めるべき必須キーワードがあります:

#### 比較級
- 必須: 音節、more、-er、使い分け
- 説明すべき内容: なぜmoreを使うのか/erをつけるのか、音節数による違い

#### 最上級
- 必須: 最も、most、-est、使い分け
- 説明すべき内容: 形容詞の長さによる使い分け

#### 受動態
- 必須: be動詞、過去分詞、される
- 説明すべき内容: 構造（be動詞 + 過去分詞）、意味、動作主の表し方

#### 現在完了
- 必須: have、has、過去分詞、経験、完了、継続、結果
- 説明すべき内容: 形式（have/has + 過去分詞）、4つの用法のどれか

#### 不定詞
- 必須: to、原形、名詞的、副詞的、形容詞的
- 説明すべき内容: 基本形、用法の種類

#### 関係代名詞
- 必須: 先行詞、which、who、that、修飾
- 説明すべき内容: 先行詞との関係、使い分け

### 3. 特定パターンの詳細説明

以下のパターンを含む問題には、特に詳細な説明が必要です:

#### more + 形容詞

必須説明内容:
- なぜ-erではなくmoreを使うのか
- 音節数による使い分けルール
- 短い形容詞と長い形容詞の違い
- 具体例

#### be動詞 + 過去分詞（受動態）

必須説明内容:
- 受動態の構造
- 能動態との違い
- 動作主の表し方（by）
- 時制による変化

#### have/has + 過去分詞（現在完了）

必須説明内容:
- 現在完了の形式
- 4つの用法（経験・完了・継続・結果）のうち、その問題で使われている用法
- 過去形との違い

### 4. 手抜き表現の禁止

以下の表現だけで終わらせてはいけません:

❌ 「この問題では○○が正答です。」
❌ 「○○の語順です。」
❌ 「more + 形容詞」

必ず **なぜそうなるのか** の理由と文法ルールを説明してください。

## チェック項目の詳細

### エラー種別

1. **解説文字数不足**: 50文字未満の解説
2. **必須キーワード不足**: 文法ポイントに必要なキーワードが含まれていない
3. **詳細説明不足**: 特定パターンに対する詳細説明が不足している
4. **手抜き表現検出**: 結論だけで理由が説明されていない

### エラー出力例

```
❌ 5件の問題が見つかりました

📄 grammar_grade3_unit9.json: 2件の問題
================================================================================

問題ID: so-g3-u9-002
エラー種別: 詳細説明不足
問題: more + 形容詞の使い分け（音節数による理由）が説明されていません（不足: 音節, 長い形容詞, -er, つけ）
改善案: 例: "interestingは3音節の長い形容詞なので、語尾に-erをつけず「more + 形容詞」の形を使います。短い形容詞（1～2音節）にはtaller、smarterのように-erをつけますが、長い形容詞（3音節以上）にはmore interesting、more beautifulのようにmoreを前につけます。"
--------------------------------------------------------------------------------
```

## 良い解説の書き方

### テンプレート

```
[文の意味の説明] + [使われている文法ポイント] + [なぜその形になるのか] + [使い分けのルール] + [他の例]
```

### 具体例

#### 比較級（more + 形容詞）

```json
"explanation": "この本はあの本より面白いです。比較級は「～より...」という意味を表します。interestingは3音節の長い形容詞なので、語尾に-erをつけず「more + 形容詞」の形を使います。短い形容詞（1～2音節）にはtaller、smarterのように-erをつけますが、長い形容詞（3音節以上）にはmore interesting、more beautifulのようにmoreを前につけます。"
```

#### 受動態

```json
"explanation": "その手紙は彼女によって書かれました。受動態は「be動詞 + 過去分詞」の形で、「～される」という意味を表します。動作の対象（この文では手紙）が主語になり、動作主（この文では彼女）はbyを使って表します。時制によってbe動詞が変化します（is/are written, was/were written, will be written）。"
```

#### 現在完了

```json
"explanation": "私は京都を3回訪れたことがあります。現在完了は「have/has + 過去分詞」の形で、この文では経験（～したことがある）を表しています。現在完了には他に、完了（～してしまった）、継続（ずっと～している）、結果（～した結果今～だ）の用法があります。回数を表すthree timesと一緒に使うことで経験を強調しています。"
```

## チェックツールの実装

`tools/validate-grammar-explanations.ts` は以下の機能を持っています:

1. 全文法データファイルを走査
2. 各問題の解説を品質基準に照らし合わせてチェック
3. 問題があれば詳細なエラーメッセージと改善案を表示
4. エラーがある場合はビルドを中断（exit code 1）

## 今後の拡張

### 計画中の機能

- [ ] AI による解説の自動生成提案
- [ ] 過去の優良解説をテンプレートとして提示
- [ ] 学習者からのフィードバックを基にした解説改善提案
- [ ] 他の問題タイプ（和訳、スペル、読解など）への拡張

## まとめ

このシステムにより:

1. ✅ すべての解説が一定の品質基準を満たすことが保証される
2. ✅ 手抜き解説が本番環境にデプロイされることを防ぐ
3. ✅ 学習者にとって本当に役立つ詳細な解説が提供される
4. ✅ 文法ルールの理由と使い分けが明確に説明される

**品質の高い教育コンテンツを維持するため、すべての解説は必ずこの基準に従って作成してください。**
