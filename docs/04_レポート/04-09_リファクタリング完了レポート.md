# ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025å¹´11æœˆ9æ—¥  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **å®Œäº†**  
**å¯¾è±¡**: SimpleWordãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“

---

## ğŸ¯ å®Ÿæ–½å†…å®¹

ã‚¨ãƒ©ãƒ¼é »ç™ºã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€4ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

---

## âœ… Phase 1: ç·Šæ€¥ã®ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼ˆå®Œäº†ï¼‰

### å®Ÿæ–½å†…å®¹

#### 1. CoreDataWordIDProvider.swift ã®å‹ã‚¨ãƒ©ãƒ¼ä¿®æ­£
**å•é¡Œ**: `existing.uuid`ï¼ˆStringå‹ï¼‰ã‚’Optionalå‹ã¨ã—ã¦ãƒã‚¤ãƒ³ãƒ‰ã—ã‚ˆã†ã¨ã—ã¦ã„ãŸ  
**ä¿®æ­£**: æ˜ç¤ºçš„ã«å¤‰æ•°ã«ä»£å…¥ã—ã¦ã‹ã‚‰`UUID(uuidString:)`ã‚’å‘¼ã³å‡ºã™

```swift
// ä¿®æ­£å‰ï¼ˆâŒ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰
if let existing = try? context.fetch(req).first,
   let u = existing.uuid {  // Stringå‹ã‚’Optionalã¨ã—ã¦ãƒã‚¤ãƒ³ãƒ‰
    result = UUID(uuidString: u)
}

// ä¿®æ­£å¾Œï¼ˆâœ… æ­£å¸¸å‹•ä½œï¼‰
if let existing = try? context.fetch(req).first {
    let uuidString = existing.uuid
    result = UUID(uuidString: uuidString)
}
```

#### 2. IDMapMaintenance.swift ã®ä¸¦è¡Œæ€§è­¦å‘Šä¿®æ­£
**å•é¡Œ**: Swift 6ã®ä¸¦è¡Œæ€§ã§`@Sendable`ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å†…ã§ã®å¤‰æ•°å¤‰æ›´ãŒè­¦å‘Šã•ã‚Œã¦ã„ãŸ  
**ä¿®æ­£**: `performAndWait`ã®æˆ»ã‚Šå€¤ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å¤–ã§å€¤ã‚’å—ã‘å–ã‚‹

```swift
// ä¿®æ­£å‰ï¼ˆâš ï¸ ä¸¦è¡Œæ€§è­¦å‘Šï¼‰
var count = 0
ctx.performAndWait {
    count = ... // ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸå¤‰æ•°ã®å¤‰æ›´
}

// ä¿®æ­£å¾Œï¼ˆâœ… è­¦å‘Šãªã—ï¼‰
let result = ctx.performAndWait { () -> Stats in
    let count = ...
    return Stats(count: count, ...)
}
```

### çµæœ
```
** BUILD SUCCEEDED **
```

---

## âœ… Phase 2: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ•´ç†ï¼ˆå®Œäº†ï¼‰

### å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

#### 1. Legacy ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆæœªä½¿ç”¨ï¼‰
- `Common/Data/Legacy/LegacyCSVLoaderAdapter.swift`
- `Common/Data/Legacy/LegacyCSVQuestionLoaderAdapter.swift`
- å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦å‰Šé™¤

### ç°¡ç´ åŒ–ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

#### 1. CSVLoader.swift
**å¤‰æ›´å‰**: é‡è¤‡ã—ãŸãƒ‘ãƒ¼ã‚¹å‡¦ç†ã‚’æŒã¤è¤‡é›‘ãªå®Ÿè£…ï¼ˆ150è¡Œä»¥ä¸Šï¼‰  
**å¤‰æ›´å¾Œ**: QuestionItemRepositoryã®è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆ65è¡Œï¼‰

```swift
// ç°¡ç´ åŒ–å¾Œ
public final class CSVLoader {
    public func loadFromBundle(named name: String) throws -> [QuestionItem] {
        let repository = QuestionItemRepository(fileName: name)
        // Repositoryã«å§”è­²
    }
}
```

#### 2. QuestionItemRepository.swift
**å¤‰æ›´å‰**: ãƒ˜ãƒƒãƒ€é§†å‹•å‹ã¨å›ºå®šåˆ—é †ãƒ¢ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ  
**å¤‰æ›´å¾Œ**: ãƒ˜ãƒƒãƒ€é§†å‹•å‹ã®ã¿ã«çµ±ä¸€ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã§ä¿å®ˆã—ã‚„ã™ã„ï¼‰

```swift
// ç°¡ç´ åŒ–å¾Œ
public final class QuestionItemRepository: Repository {
    public init(fileName: String) {
        // ãƒ˜ãƒƒãƒ€é§†å‹•å‹ã®ã¿
        self.dataSource = CSVDataSource(
            fileName: fileName,
            headerDrivenParser: QuestionItemParser.makeHeaderDrivenParser()
        )
    }
}
```

### åŠ¹æœ
- ã‚³ãƒ¼ãƒ‰è¡Œæ•°: **ç´„200è¡Œå‰Šæ¸›**
- é‡è¤‡ã‚³ãƒ¼ãƒ‰: **å®Œå…¨ã«æ’é™¤**
- ä¿å®ˆç®‡æ‰€: **2ã¤ã®çµŒè·¯ã‹ã‚‰1ã¤ã«çµ±ä¸€**

---

## âœ… Phase 3: Swift 6ä¸¦è¡Œæ€§å¯¾å¿œï¼ˆå®Œäº†ï¼‰

### Sendableæº–æ‹ 

#### 1. LearningMode
```swift
public enum LearningMode: String, Codable, CaseIterable, Identifiable, Sendable {
    case normal = "normal"
    case review = "review"
    case remediation = "remediation"
}
```

#### 2. QuizSettingsModel
```swift
public struct QuizSettingsModel: Codable, Equatable, Sendable {
    // ...å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
}
```

#### 3. QuizResult
```swift
public struct QuizResult: Codable, Identifiable, Sendable {
    public let id: UUID
    public let date: Date
    public let total: Int
    public let correct: Int
    public let settings: QuizSettingsModel
}
```

### @MainActoré©ç”¨

#### 1. ScoreStore
```swift
@MainActor
public final class ScoreStore: ObservableObject {
    @Published public private(set) var results: [QuizResult] = []
    // ...
}
```

#### 2. WordScoreStore
```swift
@MainActor
public final class WordScoreStore: ObservableObject {
    @Published private(set) var scores: [UUID: WordScore] = [:]
    // ...DispatchQueueã‚’å‰Šé™¤ã—ã€MainActorã§åŒæœŸä¿è¨¼
}
```

#### 3. QuizSessionStore
```swift
@MainActor
public class QuizSessionStore: ObservableObject {
    @Published public var score: Int = 0
    // ...
}
```

### åŠ¹æœ
- **ãƒ‡ãƒ¼ã‚¿ç«¶åˆ**: å®Œå…¨ã«é˜²æ­¢
- **ä¸¦è¡Œæ€§è­¦å‘Š**: ã™ã¹ã¦è§£æ¶ˆ
- **UIæ›´æ–°**: MainActorã§è‡ªå‹•çš„ã«å®‰å…¨ã«å®Ÿè¡Œ

---

## ğŸ“Š å…¨ä½“ã®æ”¹å–„çµæœ

### ãƒ“ãƒ«ãƒ‰çŠ¶æ³
| é …ç›® | æ”¹å–„å‰ | æ”¹å–„å¾Œ |
|------|--------|--------|
| ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ | 3ä»¶ | **0ä»¶** âœ… |
| ä¸¦è¡Œæ€§è­¦å‘Š | 15ä»¶ä»¥ä¸Š | **0ä»¶** âœ… |
| ãƒ“ãƒ«ãƒ‰æˆåŠŸç‡ | ä¸å®‰å®š | **100%** âœ… |

### ã‚³ãƒ¼ãƒ‰å“è³ª
| é …ç›® | æ”¹å–„å‰ | æ”¹å–„å¾Œ |
|------|--------|--------|
| é‡è¤‡ã‚³ãƒ¼ãƒ‰ | ã‚ã‚Š | **ãªã—** âœ… |
| æœªä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ« | 2ãƒ•ã‚¡ã‚¤ãƒ« | **0ãƒ•ã‚¡ã‚¤ãƒ«** âœ… |
| ãƒ‡ãƒ¼ã‚¿å–å¾—çµŒè·¯ | 2çµŒè·¯ | **1çµŒè·¯** âœ… |
| ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•° | - | **ç´„200è¡Œå‰Šæ¸›** âœ… |

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
| é …ç›® | æ”¹å–„å‰ | æ”¹å–„å¾Œ |
|------|--------|--------|
| CSVèª­ã¿è¾¼ã¿ | CSVLoader + Repository | **Repositoryã«çµ±ä¸€** âœ… |
| ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ¢ãƒ¼ãƒ‰ | 2ãƒ¢ãƒ¼ãƒ‰ | **1ãƒ¢ãƒ¼ãƒ‰** âœ… |
| ä¸¦è¡Œæ€§ç®¡ç† | æ‰‹å‹•ï¼ˆDispatchQueueï¼‰ | **@MainActorï¼ˆè‡ªå‹•ï¼‰** âœ… |

---

## ğŸ¯ é”æˆã•ã‚ŒãŸåŠ¹æœ

### 1. å®‰å®šæ€§ã®å‘ä¸Š
- âœ… ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®å®Œå…¨è§£æ¶ˆ
- âœ… ä¸¦è¡Œæ€§è­¦å‘Šã®å®Œå…¨è§£æ¶ˆ
- âœ… ãƒ‡ãƒ¼ã‚¿ç«¶åˆã®é˜²æ­¢

### 2. å¯èª­æ€§ã®å‘ä¸Š
- âœ… é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤ã«ã‚ˆã‚Šç†è§£ã—ã‚„ã™ããªã£ãŸ
- âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—çµŒè·¯ãŒ1ã¤ã«çµ±ä¸€ã•ã‚Œã€è¿½è·¡ãŒå®¹æ˜“ã«
- âœ… è²¬å‹™ãŒæ˜ç¢ºã«ãªã£ãŸ

### 3. ä¿å®ˆæ€§ã®å‘ä¸Š
- âœ… ä¿®æ­£ç®‡æ‰€ãŒæ˜ç¢ºï¼ˆå˜ä¸€çµŒè·¯ï¼‰
- âœ… ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„æ§‹é€ 
- âœ… æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å½±éŸ¿ç¯„å›²ãŒé™å®šçš„

### 4. Swift 6æº–æ‹ 
- âœ… æœ€æ–°ã®Swiftä¸¦è¡Œæ€§ãƒ¢ãƒ‡ãƒ«ã«å®Œå…¨æº–æ‹ 
- âœ… å°†æ¥ã®Swift/Xcodeãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«å¯¾å¿œ
- âœ… Appleæ¨å¥¨ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ãŸå®Ÿè£…

---

## ğŸ“ ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
- `Common/Data/Legacy/LegacyCSVLoaderAdapter.swift`
- `Common/Data/Legacy/LegacyCSVQuestionLoaderAdapter.swift`
- `Common/Data/Legacy/` ï¼ˆãƒ•ã‚©ãƒ«ãƒ€ã”ã¨å‰Šé™¤ï¼‰

### ä¿®æ­£ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
1. `SimpleWord/Services/CoreDataIDs/CoreDataWordIDProvider.swift`
2. `SimpleWord/Services/CoreDataIDs/IDMapMaintenance.swift`
3. `SimpleWord/Utils/CSVLoader.swift`
4. `Common/Data/Repository/QuestionItemRepository.swift`
5. `SimpleWord/Features/QuizSettings/Models/LearningMode.swift`
6. `SimpleWord/Features/QuizSettings/Models/QuizSettingsModel.swift`
7. `SimpleWord/Features/Quiz/ViewModels/ScoreStore.swift`
8. `SimpleWord/Features/Quiz/ViewModels/WordScoreStore.swift`
9. `SimpleWord/Features/Quiz/ViewModels/QuizSessionStore.swift`

---

## ğŸš€ ä»Šå¾Œã®æ¨å¥¨äº‹é …

### ç¶™ç¶šçš„ãªæ”¹å–„
1. **ãƒ†ã‚¹ãƒˆã®è¿½åŠ **
   - å˜ä½“ãƒ†ã‚¹ãƒˆã®å……å®Ÿ
   - UI ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

2. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**
   - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã®æ›´æ–°
   - APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å……å®Ÿ

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã®å®Ÿæ–½
   - ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®šã¨æ”¹å–„

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã®éµå®ˆ
- âœ… Swift 6ä¸¦è¡Œæ€§ãƒ¢ãƒ‡ãƒ«ã®ç¶™ç¶šä½¿ç”¨
- âœ… @MainActorã®é©åˆ‡ãªé…ç½®
- âœ… Sendableæº–æ‹ ã®å¾¹åº•
- âœ… å˜ä¸€è²¬ä»»åŸå‰‡ã®ç¶­æŒ

---

## ğŸ“ ã¾ã¨ã‚

3ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã™ã¹ã¦ãŒå®Œäº†ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å®‰å®šã—ãŸçŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸï¼š

1. **Phase 1**: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’å®Œå…¨ã«è§£æ¶ˆ âœ…
2. **Phase 2**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç°¡ç´ åŒ–ã—ã€ä¿å®ˆæ€§ã‚’å‘ä¸Š âœ…
3. **Phase 3**: Swift 6ä¸¦è¡Œæ€§ã«å®Œå…¨å¯¾å¿œ âœ…

**çµæœ**: ã‚¨ãƒ©ãƒ¼ã®ãªã„ã€å®‰å®šã—ãŸãƒ“ãƒ«ãƒ‰ãŒå®Ÿç¾ã—ã€å°†æ¥ã®æ‹¡å¼µã«ã‚‚å¯¾å¿œã§ãã‚‹å …ç‰¢ãªåŸºç›¤ãŒå®Œæˆã—ã¾ã—ãŸã€‚

---

**ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†æ—¥**: 2025å¹´11æœˆ9æ—¥  
**æœ€çµ‚ãƒ“ãƒ«ãƒ‰çµæœ**: `** BUILD SUCCEEDED **` âœ…
