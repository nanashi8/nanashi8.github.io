# フレーズ訳生成ルール

## 概要

長文読解機能では、英文を**フレーズ（句・節）単位**で自動分割し、各フレーズに対応する自然な日本語訳を表示します。このドキュメントでは、適切なフレーズ訳を生成するためのルールを定義します。

## フレーズ分割の仕組み

### 現在の自動分割ロジック（`passageAdapter.ts`）

1. **基本単位**: 文（`.` `!` `?`で終わる）
2. **長文の分割**: 20単語を超える文は接続詞で分割
   - 対象接続詞: `when`, `if`, `because`, `although`, `while`, `since`, `after`, `before`, `unless`, `until`, `as`, `though`, `whereas`
   - 分割条件: 15単語以上経過後に接続詞が出現した場合
3. **会話文**: `Speaker: "..."` 形式は1つのフレーズとして扱う

### フレーズ分割の例

**元の文:**
```
January 2nd, our extended family gathered at my grandparents' house for the traditional New Year's celebration.
```

**分割結果（1フレーズ）:**
- 20単語以下なのでそのまま1フレーズ

**元の文（長文の例）:**
```
I worked at the same company for a long time—fifteen years—but decided it was time for a change because I was tired of the routine.
```

**分割結果（2フレーズ）:**
1. `I worked at the same company for a long time—fifteen years—but decided it was time for a change`
2. `because I was tired of the routine.`

## フレーズ訳の要件

### 1. 対応性の原則

✅ **正しい例:**
- 英文: `January 2nd, our extended family gathered at my grandparents' house for the traditional New Year's celebration.`
- 訳: `1月2日、私たちの大家族が祖父母の家に集まり、伝統的な新年のお祝いをしました。`

❌ **誤った例:**
- 英文: `January 2nd, our extended family gathered...`
- 訳: `お盆休み` ← 内容が全く異なる

### 2. 自然さの原則

フレーズ訳は、以下の条件を満たす必要があります:

1. **文法的に完結している**
   - 独立して読んでも意味が通じる
   - 主語・述語が明確（文脈で省略可能な場合を除く）

2. **日本語として自然**
   - 直訳ではなく、自然な日本語表現
   - 中学生が読んで理解できるレベル

3. **長さが適切**
   - 1フレーズ = 1文または1節
   - 長すぎず、短すぎず（目安: 20-60文字）

### 3. 文脈保持の原則

前後のフレーズと合わせて読んだ時、自然な流れになるようにする。

**例:**
```
フレーズ1: "Welcome, welcome everyone!"
訳1: 「ようこそ、みなさん！」

フレーズ2: Grandma said warmly as she brought out tea and snacks.
訳2: おばあちゃんは温かく言いながら、お茶とお菓子を持ってきました。
```

## フレーズ訳生成ガイドライン

### Step 1: フレーズ分類

各フレーズを以下のタイプに分類:

1. **完全文** - 主語・述語が揃った完結した文
2. **従属節** - 接続詞で始まる節（`because...`, `when...`など）
3. **会話文** - 引用符で囲まれた発話
4. **タイトル・見出し** - 段落の見出し

### Step 2: タイプ別翻訳方針

#### 1. 完全文
- そのまま自然な日本語に翻訳
- 時制・主語を適切に処理

**例:**
```
英: January 2nd, our extended family gathered at my grandparents' house.
訳: 1月2日、私たちの大家族が祖父母の家に集まりました。
```

#### 2. 従属節
- 接続詞を日本語に変換
- 前の文との接続を考慮

**例:**
```
英: because I was tired of sitting at a desk all day
訳: なぜなら、一日中デスクに座っているのに疲れていたからです
```

#### 3. 会話文
- 「」で囲む
- 話し言葉として自然な表現に

**例:**
```
英: "Welcome, welcome everyone!"
訳: 「ようこそ、みなさん！」
```

#### 4. タイトル・見出し
- 簡潔に、内容を要約

**例:**
```
英: Uncle Takeshi's New Job
訳: タケシおじさんの新しい仕事
```

### Step 3: 品質チェック

各フレーズ訳について以下を確認:

- [ ] 英文の内容を正確に反映しているか
- [ ] 日本語として自然か
- [ ] 前後のフレーズと接続が自然か
- [ ] 中学生が理解できる表現か
- [ ] 固有名詞・数値が正確か

## 実装上の注意点

### JSONファイル構造

```json
{
  "id": "passage-id",
  "title": "タイトル",
  "level": "advanced",
  "phrases": [
    {
      "id": 1,
      "english": "実際の英文フレーズ",
      "japanese": "対応する自然な日本語訳",
      "phraseMeaning": "対応する自然な日本語訳",
      "segments": [...]
    }
  ]
}
```

### 重要な注意事項

1. **`japanese`と`phraseMeaning`は同じ値を設定**
   - 互換性のため両方に同じ訳を入れる

2. **英文フレーズは自動分割結果と完全一致**
   - `passageAdapter.ts`の分割ロジックと一致させる
   - 手動で勝手に分割しない

3. **全フレーズに訳を付ける**
   - 空欄や"(未登録)"は禁止
   - 最低限の訳でも必ず入れる

## 翻訳の具体例

### 例1: 短い文

```
英: Grandma smiled.
分割: そのまま（1フレーズ）
訳: おばあちゃんは微笑みました。
```

### 例2: 中程度の文

```
英: I'm working as a driver for a logistics company.
分割: そのまま（1フレーズ）
訳: 私は物流会社でドライバーとして働いています。
```

### 例3: 長文（接続詞で分割）

```
英: I worked at the same company for a long time—fifteen years—but decided it was time for a change.
分割: そのまま（20単語以下）
訳: 私は同じ会社で長い間—15年間—働いていましたが、変化の時だと決心しました。
```

### 例4: 従属節を含む長文

```
英文全体: I get to travel to different cities because my schedule is flexible.
分割結果:
  フレーズ1: I get to travel to different cities
  フレーズ2: because my schedule is flexible.

訳:
  訳1: 私は様々な都市を訪れることができます
  訳2: なぜなら、私のスケジュールが柔軟だからです
```

### 例5: 会話文

```
英: "You need to take better care of yourself," Grandma said with concern.
分割: そのまま（1フレーズ）
訳: 「もっと自分を大切にしなければならないわ」とおばあちゃんは心配そうに言いました。
```

## 自動化のための提案

### フレーズ訳生成スクリプトの要件

1. **入力**: `.txt`形式の英文パッセージ
2. **処理**:
   - `passageAdapter.ts`と同じロジックでフレーズ分割
   - 各フレーズをLLM APIに送信して翻訳
   - 翻訳結果を検証（長さ、自然さ）
3. **出力**: JSONファイル（`passages-phrase-learning/`）

### スクリプト設計案

```python
# scripts/generate_phrase_translations.py

1. パッセージファイル読み込み
2. フレーズ分割（TypeScriptロジックをPythonで再現）
3. 各フレーズをLLM APIで翻訳
   - プロンプト: "以下の英文フレーズを、中学生にも分かる自然な日本語に翻訳してください"
   - 文脈を渡す: 前後数フレーズも一緒に送信
4. 翻訳結果を検証
   - 長さチェック（20-60文字推奨）
   - キーワード一致チェック（固有名詞など）
5. JSON形式で出力
```

## パイプラインへの統合

### validate_ui_specifications.py への追加

```python
def validate_phrase_translations(self):
    """フレーズ訳の検証"""
    print(f"\n{YELLOW}[新規] フレーズ訳の整合性検証{RESET}")
    
    # 全passage-phrase-learningファイルをチェック
    phrase_dir = self.base_path / 'public/data/passages-phrase-learning'
    
    for json_file in phrase_dir.glob('*.json'):
        data = json.loads(json_file.read_text())
        
        for phrase in data['phrases']:
            # 1. japanese/phraseMeaningが存在するか
            if not phrase.get('japanese') or not phrase.get('phraseMeaning'):
                self.errors.append(f"❌ {json_file.name}: フレーズID {phrase['id']} に訳がありません")
            
            # 2. 訳が適切な長さか（5-100文字）
            if len(phrase.get('japanese', '')) < 5 or len(phrase.get('japanese', '')) > 100:
                self.warnings.append(f"⚠️ {json_file.name}: フレーズID {phrase['id']} の訳の長さが不適切")
            
            # 3. english フィールドが空でないか
            if not phrase.get('english'):
                self.errors.append(f"❌ {json_file.name}: フレーズID {phrase['id']} の英文が空です")
```

## まとめ

適切なフレーズ訳を生成・維持するためには:

1. ✅ **自動分割ロジックを理解**する
2. ✅ **対応性・自然さ・文脈**の3原則を守る
3. ✅ **品質チェック**を実施する
4. ✅ **パイプラインで継続的に検証**する

これにより、学習者にとって有益な長文読解機能を提供できます。

---

## プロの翻訳家・校正者の品質基準

### 日本語の品質チェック項目

フレーズ訳は、以下の品質基準を満たす必要があります:

#### 1. 不自然な表現の回避

❌ **避けるべき直訳調の表現:**
- `することができます` → `できます`、`〜られます`
- `することが可能です` → `できます`
- `〜であるということ` → `〜であること`、`〜だということ`
- `〜するということです` → `〜します`、`〜することです`
- `において` → `で`、`に`（文脈に応じて）
- `に関して` → `について`
- `に対して` → `に`（文脈に応じて）
- `によって` → `で`（文脈に応じて）
- `〜ということになります` → `〜です`、`〜になります`
- `〜というわけです` → `〜です`
- `〜ということができます` → `〜できます`、`〜と言えます`

✅ **自然な表現の例:**
- 英: `Students can participate in various activities.`
- ❌ 直訳: `生徒は様々な活動に参加することができます。`
- ✅ 自然: `生徒は様々な活動に参加できます。`

#### 2. 助詞の正確な使用

よくある助詞の誤用パターン:
- 二重助詞（`では、で`、`には、に`、`とは、と`）の回避
- 適切な助詞の選択（`を`、`が`、`に`、`で`）
- 文末の助詞の適切性

✅ **正しい例:**
- `東京で開催された会議` （❌ `東京において開催された会議`）
- `環境について考える` （❌ `環境に関して考える`）

#### 3. 文体の統一

**中学生向け教材では「です・ます調」を使用:**

✅ **統一された文体:**
```
彼は毎日学校に通います。放課後は図書館で勉強します。
```

❌ **不統一な文体（混在）:**
```
彼は毎日学校に通う。放課後は図書館で勉強します。
```

#### 4. 冗長表現の排除

❌ **冗長な表現:**
- `非常に多くの` → `たくさんの`、`多数の`
- `とても大きな` → `大きな`
- `かなり小さな` → `小さな`
- `実際に`、`基本的に`、`一般的に` → 文脈で不要なことが多い
- `〜したりします` → `〜します`（他の例がない場合）
- `〜というもの` → 削除可能な場合が多い

✅ **簡潔な表現:**
- 英: `There are very many students in the classroom.`
- ❌ 冗長: `教室には非常に多くの生徒がいます。`
- ✅ 簡潔: `教室にはたくさんの生徒がいます。`

#### 5. 中学生向けの適切な語彙選択

**難しすぎる語彙の例:**
- `鑑みる` → `考える`、`踏まえる`
- `斯く` → `このように`
- `然るべき` → `適切な`
- `概ね` → `だいたい`、`ほぼ`
- `顕著` → `目立つ`、`はっきりした`
- `凡そ` → `およそ`、`約`
- `寧ろ` → `むしろ`
- `殊に` → `特に`
- `須く` → 誤用が多いため使用を避ける

**幼稚すぎる表現の例:**
- `お友達` → `友達`
- `お勉強` → `勉強`
- `ちっちゃい` → `小さい`
- `すっごく` → `とても`、`非常に`

✅ **中学生に適した語彙:**
```
英: The results were quite significant.
❌ 難: その結果は頗る顕著であった。
❌ 幼: その結果はすっごく目立っていました。
✅ 適切: その結果はとても目立っていました。
```

#### 6. 内容の正確な対応

**人称代名詞の正確な翻訳:**
- `I` → `私は/私が`（❌ `彼は`、`彼女は`）
- `He` → `彼は/彼が`（❌ `私は`、`彼女は`）
- `She` → `彼女は/彼女が`（❌ `私は`、`彼は`）
- `my` → `私の`（❌ `彼の`、`彼女の`）

**時制の正確な翻訳:**
- `will` → 未来形（❌ 過去形）
- `was/were` → 過去形（❌ 未来形）
- `have/has done` → 完了形

**疑問文・否定文の対応:**

✅ **疑問文:**
```
英: Do you understand this concept?
✅ 正: この概念を理解していますか？
❌ 誤: この概念を理解しています。
```

✅ **否定文:**
```
英: I have never been to Tokyo.
✅ 正: 私は一度も東京に行ったことがありません。
❌ 誤: 私は東京に行ったことがあります。
```

#### 7. 句読点の適切な使用

**30文字以上のフレーズでは読点を使用:**

✅ **読みやすい:**
```
彼は毎朝早く起きて、ランニングをし、朝食を食べてから学校に行きます。
```

❌ **読みにくい:**
```
彼は毎朝早く起きてランニングをし朝食を食べてから学校に行きます。
```

#### 8. カタカナ語の適度な使用

**カタカナ語が多すぎる場合は日本語に置き換え:**

❌ **カタカナ過多:**
```
このプログラムはインタラクティブなインターフェースとダイナミックなビジュアライゼーションを提供します。
```

✅ **適度なバランス:**
```
このプログラムは対話的な画面と動的な表示機能を提供します。
```

### 品質チェックリスト

翻訳後、以下の項目を確認してください:

- [ ] 英文の内容と日本語訳が対応している
- [ ] 人称代名詞・時制・疑問文/否定文が正確に翻訳されている
- [ ] 不自然な直訳調の表現がない
- [ ] 助詞の使い方が正確である
- [ ] 文体が統一されている（です・ます調）
- [ ] 冗長な表現がなく、簡潔である
- [ ] 中学生に適した語彙レベルである
- [ ] 句読点が適切に使われている
- [ ] カタカナ語が過度に使われていない
- [ ] 全体として自然な日本語である
