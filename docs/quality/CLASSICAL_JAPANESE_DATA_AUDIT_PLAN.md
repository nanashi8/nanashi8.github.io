# 古文・漢文データ 全件監査計画（教材品質）

目的: `public/data/classical-japanese/*.csv` の例文・読み・出典を「教材として誤りがない（誤読・誤引用・無根拠引用・過剰重複を抑える）」状態へ近づける。

## 前提
- 例文セル形式は原則 `引用（読み）＜現代語訳＞【出典】`。
- 読みは「（）内に全文読み」。漢文は「書き下し読み」。
- 現状データには「代表的な引用の流用」が多く、語句と引用の“完全一致”を機械で断罪すると誤検出が大量に出る。

## 監査の観点（重要度順）

### A. 読み（誤読）
- 例: 「日暮らし → にちくらし」のように教材上の誤りになるもの。
- 対応方針:
  - 既知の誤読は「優先読み（上書き）」で再発しない形に固定。
  - 新規に見つかった誤読は、再現条件（語・前後文脈）を添えて上書き辞書へ追加。

### B. 引用の妥当性（無根拠・誤った引用）
- 例: 助動詞「き」の項目なのに、引用に「き」が存在しない等。
- 対応方針:
  - 自動判定は「項目タイプ別」に分ける（助動詞・敬語・係り結び…）。
  - 自動判定で断定できないものは「要手動審査」へ分類する（NG判定の乱発を避ける）。

### C. 重複引用（重要でない項目での過剰流用）
- 同一引用が大量に再利用されると、教材としての学習価値が下がる。
- 対応方針:
  - 「重要/最重要」項目は一定の重複を許容しうる。
  - 重要度が低い項目での重複は、差し替え候補を作って順次置換する。

### D. 出典ポリシー（出典必須）
- 方針: すべて典拠（作品名等）を要求し、`【作例】` は禁止。
- 暫定運用: 典拠がまだ確定できない場合は `【出典要確認】` を使用し、手動審査で必ず典拠を確定する（放置しない）。

## フロー（自動→手動→再発防止）

### 1) 自動監査（毎回）
- スクリプト: `scripts/audit-classical-japanese-examples-quality.ts`
- 目的:
  - 形式の破綻（パース不能）
  - 読みの不審（漢字残り等）
  - 致命度の高い項目（助動詞「き/けり」など）の引用妥当性
  - 重複引用の集計（低重要度のみ重複を抽出）

実行例:
- 通常: `npm run ts-node -- scripts/audit-classical-japanese-examples-quality.ts`
- 重複詳細も表示: `npm run ts-node -- scripts/audit-classical-japanese-examples-quality.ts --show-duplicates`
- 語句包含のヒューリスティック集計（誤検出多め）: `npm run ts-node -- scripts/audit-classical-japanese-examples-quality.ts --heuristic-term-check`
- 出典の“確定”を必須にする（`【出典要確認】` をNG扱い）: `npx tsx scripts/audit-classical-japanese-examples-quality.ts --require-known-sources`

### 2) 手動審査キュー
- 自動監査で `term-critical` が出た行: 優先度「最優先」
- 低重要度で重複が多い引用: 優先度「高」
- その他（自動で断定できないが疑わしい）: 優先度「中」

### 3) 修正
- 読み誤り: 上書き辞書（優先読み）に追加し、CSVへ一括反映
- 引用妥当性: 項目タイプに沿う例文へ差し替え（出典はポリシーに従う）
- 重複: 重要度が低い項目を中心に、別例文へ差し替え

### 4) 再発防止（ガード）
- 変更後に必ず自動監査を再実行し、
  - 形式破綻 0
  - 重要項目の `term-critical` 0
  - 重複の「低重要度のみ大量流用」が減っている
  を確認する。

## 直近の課題（現状認識）
- データ構造的に「語句が引用文に必ず含まれる」前提が成り立たない行が多く、単純な包含チェックは誤検出が多い。
- よって、機械検査は「確実に言えるもの」から段階的に拡張する（助動詞/敬語など、形が明確なものから）。
