# フレーズ訳品質検証ガイド

## 概要

英語学習アプリの各タブにおける日本語訳について、**プロの翻訳家や文章校正者の観点から品質を検証**するシステムです。

## 検証システムの構成

本プロジェクトでは、**3つの独立した品質検証**が並列実行されます：

### 1. 📋 UI仕様書準拠検証
- **対象**: React コンポーネント、CSS ファイル
- **検証内容**: カラーコード、非同期処理、ローディング表示
- **スクリプト**: `validate_ui_specifications.py`

### 2. 📖 長文タブ フレーズ訳品質検証
- **対象**: `passages-phrase-learning/*.json`
- **検証内容**: フレーズ単位の英日対応、日本語品質
- **スクリプト**: `validate_phrase_translations.py`

### 3. ✏️ 文法・和訳タブ 日本語品質検証
- **対象**: `grammar_*.json`, `fill-in-blank*.json` など
- **検証内容**: 問題文・解説・ヒントの日本語品質
- **スクリプト**: `validate_grammar_translations.py` ⭐ **新規**

---

## 検証内容の詳細

### 長文タブ（フレーズ訳）の検証

### 1. 基本的な整合性チェック

- ✅ 英文と日本語訳の存在確認
- ✅ 訳の長さチェック（3-150文字）
- ✅ 内容の一致確認（月名、季節、人称代名詞、時制）

### 2. 日本語品質チェック（プロの校正者基準）

#### a. 不自然な表現の検出
- 直訳調の表現（`することができます`、`において`、`に関して`など）
- 機械翻訳特有の冗長表現

#### b. 助詞の誤用チェック
- 二重助詞の検出
- よくある助詞の誤用パターン

#### c. 文体の統一性
- です・ます調とだ・である調の混在チェック

#### d. 冗長表現の検出
- 不要な副詞（`非常に多くの`、`基本的に`など）
- 回りくどい表現

#### e. 語彙の適切性
- 中学生には難しすぎる語彙（`鑑みる`、`顕著`など）
- 逆に幼稚すぎる表現（`お友達`、`すっごく`など）

#### f. 内容の正確性
- **人称代名詞の不一致**: `He`が`私は`に誤訳されている
- **時制の不一致**: `will`が過去形に誤訳されている
- **疑問文の不一致**: 英文は疑問文なのに訳に`？`がない
- **否定文の不一致**: 英文に`not`があるのに訳に否定表現がない

#### g. 読みやすさ
- 30文字以上で句読点がないフレーズの検出
- カタカナ語の過剰使用の検出

## 使い方

### 検証スクリプトの実行

```bash
cd /path/to/nanashi8-github-io-git
python3 scripts/validate_phrase_translations.py
```

### 出力例

```
============================================================
フレーズ訳整合性検証
============================================================

検証対象: 22 ファイル

✓ advanced-environmental-issues.json: 701 フレーズ (エラー: 0, 警告: 32)
✗ intermediate-career-day.json: 550 フレーズ (エラー: 549, 警告: 0)

============================================================
検証結果サマリー
============================================================

総ファイル数: 22
総フレーズ数: 11013

空の訳: 551 件
短すぎる訳: 321 件
長すぎる訳: 9 件

日本語品質の問題:
  不自然な表現: 20 件
  冗長表現: 14 件
  疑問文の不一致: 46 件
  否定表現の不一致: 401 件

警告 (1820件):
  ⚠️  advanced-environmental-issues.json: フレーズ#9 - 英文に否定表現がありますが、訳にありません
      英文: Understanding these environmental issues is not merely an academic exercise...
      訳: 生活に

エラー (844件):
  ❌ advanced-family-gathering.json: フレーズ#2 - 内容の不一致を検出
      英文に 'January' があるのに、訳に 'お盆' が含まれています
      英文: January 2nd, our extended family gathered...
      訳: お盆休み
```

## 主な検出問題

### 実際に検出された問題例

#### 1. 内容の完全な不一致（最も深刻）

```
❌ エラー例:
英文: January 2nd, our extended family gathered...
訳: お盆休み

問題: 1月2日（正月）なのに、訳が「お盆休み」（8月）
```

#### 2. 人称代名詞の誤訳（844件中多数）

```
❌ エラー例:
英文: He went to the store...
訳: 私は店に行きました

問題: 「彼は」なのに「私は」に誤訳
```

#### 3. 否定表現の欠落（401件）

```
⚠️ 警告例:
英文: Many species have not even been scientifically identified yet.
訳: 種もいます。

問題: 英文は「まだ科学的に特定されていない」という否定文なのに、訳に否定表現がない
```

#### 4. 疑問文の欠落（46件）

```
⚠️ 警告例:
英文: Do you understand this concept?
訳: この概念を理解しています。

問題: 疑問文なのに訳に「？」や「〜か」がない
```

#### 5. 訳が短すぎる（321件）

```
⚠️ 警告例:
フレーズ: Understanding these environmental issues...
訳: 今 (1文字)

問題: フレーズ全体の意味を表せていない
```

## 品質基準の詳細

詳しくは以下のドキュメントを参照してください:

- **[PHRASE_TRANSLATION_RULES.md](PHRASE_TRANSLATION_RULES.md)** - フレーズ訳生成ルールと品質基準の完全版

### 重要な品質原則

1. **対応性**: 英文とフレーズ訳の内容が一致している
1. **自然さ**: 直訳ではなく、自然な日本語表現
1. **適切性**: 中学生が理解できる語彙レベル
1. **正確性**: 人称、時制、疑問文/否定文が正確に翻訳されている
1. **簡潔性**: 冗長な表現を避ける
1. **統一性**: 文体（です・ます調）が統一されている

## 今後の作業

### 優先順位1: データ修正

1. **intermediate-career-day.json**: 549/550 フレーズが空（最優先）
1. **人称代名詞の誤訳**: 844件のエラーの多くがこれに該当
1. **内容の不一致**: January→お盆など、明らかな誤訳

### 優先順位2: 自動化

1. **フレーズ訳生成スクリプト**の作成
   - LLM APIを使用して適切な訳を生成
   - PHRASE_TRANSLATION_RULES.mdのルールに従う
   - 生成後に自動検証

1. **パイプライン統合**
   - CI/CDに`validate_phrase_translations.py`を追加
   - プルリクエスト時に自動チェック

## 関連ファイル

- `scripts/validate_phrase_translations.py` - 検証スクリプト（本体）
- `docs/PHRASE_TRANSLATION_RULES.md` - フレーズ訳ルールと品質基準
- `nanashi8.github.io/public/data/passages-phrase-learning/*.json` - 検証対象データ
- `nanashi8.github.io/src/utils/passageAdapter.ts` - フレーズ分割ロジック

## まとめ

このシステムにより、以下が可能になりました:

✅ **プロの翻訳家・校正者の観点から品質を自動検証**  
✅ **844件のエラーと1820件の警告を検出**  
✅ **人称代名詞、時制、疑問文/否定文の不一致を発見**  
✅ **不自然な日本語表現を検出**  
✅ **中学生向け教材としての語彙の適切性をチェック**

次のステップは、検出された問題を修正し、今後の品質維持のためにパイプラインに統合することです。

---

## 文法・和訳タブの検証内容（新規）

### 検証対象データ

- `grammar_grade*.json` - 文法問題
- `fill-in-blank*.json` - 穴埋め問題
- `sentence-ordering*.json` - 並び替え問題
- `verb-form*.json` - 動詞の形問題

### 検証項目

#### 1. 必須フィールドの存在
- `japanese`: 問題文の日本語訳
- `explanation`: 解説文
- `hint`: ヒント（任意だが推奨）

#### 2. japanese（問題文）の品質
- **文末の適切性**: です・ます調で終わっているか
- **冗長表現の検出**: `することができます` → `できます`
- **重複の検出**: `私は` が何度も繰り返されていないか

#### 3. explanation（解説）の品質
- **長さチェック**: 短すぎる解説（10文字未満）を警告
- **文法用語の統一**:
  - ✅ `一般動詞` （❌ `普通動詞`, `動作動詞`）
  - ✅ `be動詞` （❌ `ビー動詞`, `be-動詞`）
  - ✅ `三人称単数` （❌ `3人称単数`, `三単現`）
- **記号の使い方**: `×` の後に説明があるか
- **難しすぎる用語の検出**:
  - ❌ `主格`, `目的格`, `所有格`, `補語`, `修飾語` など

#### 4. hint（ヒント）の品質
- **長さチェック**: 30文字以内が適切
- **答えの明示**: 「答えは〜」など答えを直接示していないか

### 検出される問題の例

```
⚠️  grammar_grade1_unit0.json: 問題#g1-u0-so-001
    中学生には難しい用語: '補語'
    解説: 基本語順：主語(I) + be動詞(am) + 補語(a student)。

⚠️  grammar_grade1_unit3.json: 問題#g1-u3-fib-015
    japanese の文末が不自然
    文: 私は本を読む（現在進行形にする）

⚠️  grammar_grade2_unit5.json: 問題#g2-u5-para-003
    文法用語の不統一: '3人称単数' → '三人称単数'
```

---

## 使い方（統合版）

### 全ての検証を一括実行

```bash
cd /path/to/nanashi8-github-io-git
bash scripts/validate_all_quality.sh
```

**実行内容:**
1. 📋 UI仕様書準拠検証
1. 📖 長文タブ フレーズ訳品質検証
1. ✏️ 文法・和訳タブ 日本語品質検証

### 個別実行

```bash
# 長文タブのみ
python3 scripts/validate_phrase_translations.py

# 文法・和訳タブのみ
python3 scripts/validate_grammar_translations.py

# UI仕様のみ
python3 scripts/validate_ui_specifications.py
```

---

## 出力例（統合版）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
品質検証パイプライン
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 1/3 UI仕様書準拠検証を実行中...
✓ UI仕様書への準拠は適切です

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📖 2/3 長文タブ フレーズ訳品質検証を実行中...
総ファイル数: 22
総フレーズ数: 11013
エラー: 844件
警告: 1820件

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✏️  3/3 文法・和訳タブ 日本語品質検証を実行中...
総ファイル数: 29
総問題数: 1200
エラー: 0件
警告: 950件

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
最終結果
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

❌ 検証に失敗しました
  - 長文タブ フレーズ訳品質検証: 失敗

詳細は上記の出力を確認してください。
```

---

## 関連ファイル（更新版）

### 検証スクリプト
- `scripts/validate_ui_specifications.py` - UI仕様書準拠検証
- `scripts/validate_phrase_translations.py` - 長文タブ フレーズ訳検証
- `scripts/validate_grammar_translations.py` - 文法・和訳タブ検証 ⭐ **新規**
- `scripts/validate_all_quality.sh` - 統合実行スクリプト（並列実行）

### データファイル
- `nanashi8.github.io/public/data/passages-phrase-learning/*.json` - 長文タブ
- `nanashi8.github.io/public/data/grammar_*.json` - 文法タブ ⭐ **検証対象**
- `nanashi8.github.io/public/data/fill-in-blank*.json` - 穴埋めタブ ⭐ **検証対象**

### ドキュメント
- `docs/PHRASE_TRANSLATION_RULES.md` - フレーズ訳ルールと品質基準
- `docs/SOFTWARE_QUALITY_TERMINOLOGY.md` - 品質保証用語解説
- `docs/PHRASE_TRANSLATION_QUALITY_GUIDE.md` - 本ドキュメント

