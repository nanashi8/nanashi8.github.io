# ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å–å¾—ã‚¬ã‚¤ãƒ‰

Webã‚µã‚¤ãƒˆç®¡ç†è€…ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±ï¼ˆè¨ªå•æ—¥æ™‚ã€é–²è¦§ãƒšãƒ¼ã‚¸ã€ãƒªãƒ•ã‚¡ãƒ©ãªã©ï¼‰ã‚’å–å¾—ãƒ»åˆ†æã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [å–å¾—ã§ãã‚‹æƒ…å ±](#å–å¾—ã§ãã‚‹æƒ…å ±)
2. [ä¸»ãªå®Ÿè£…æ–¹æ³•](#ä¸»ãªå®Ÿè£…æ–¹æ³•)
3. [é™çš„ã‚µã‚¤ãƒˆå‘ã‘å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰](#é™çš„ã‚µã‚¤ãƒˆå‘ã‘å®Ÿè£…æ¨å¥¨)
4. [ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã«ã‚ˆã‚‹å–å¾—](#ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã«ã‚ˆã‚‹å–å¾—)
5. [ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è§£æãƒ„ãƒ¼ãƒ«](#ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è§£æãƒ„ãƒ¼ãƒ«)
6. [ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»æ³•çš„æ³¨æ„ç‚¹](#ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æ³•çš„æ³¨æ„ç‚¹)
7. [å°å…¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#å°å…¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)

---

## å–å¾—ã§ãã‚‹æƒ…å ±

### åŸºæœ¬æƒ…å ±
- **ã‚¢ã‚¯ã‚»ã‚¹æ—¥æ™‚ï¼ˆtimestampï¼‰**: ã„ã¤è¨ªå•ã—ãŸã‹
- **URL/ãƒšãƒ¼ã‚¸ãƒ‘ã‚¹**: ã©ã®ãƒšãƒ¼ã‚¸ã‚’è¦‹ãŸã‹
- **ãƒªãƒ•ã‚¡ãƒ©ï¼ˆreferrerï¼‰**: ã©ã“ã‹ã‚‰æ¥ãŸã‹ï¼ˆæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã€SNSã€ç›´æ¥ãªã©ï¼‰
- **User-Agent**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»OSæƒ…å ±ï¼ˆChrome/Safari/Firefoxã€Windows/Mac/iOSç­‰ï¼‰
- **ç”»é¢ã‚µã‚¤ã‚º**: ãƒ‡ãƒã‚¤ã‚¹ã®è§£åƒåº¦ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åˆ†æç”¨ï¼‰

### è¿½åŠ å–å¾—å¯èƒ½ãªæƒ…å ±
- **IPã‚¢ãƒ‰ãƒ¬ã‚¹**: ã‚µãƒ¼ãƒãƒ¼å´ã§å–å¾—å¯ï¼ˆâš ï¸ å€‹äººæƒ…å ±æ‰±ã„ã€åŒ¿ååŒ–æ¨å¥¨ï¼‰
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“**: æ»åœ¨æ™‚é–“ã€é›¢è„±æ™‚é–“
- **ã‚¤ãƒ™ãƒ³ãƒˆ**: ã‚¯ãƒªãƒƒã‚¯ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€å‹•ç”»å†ç”Ÿãªã©ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- **ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: è³¼å…¥ã€ç™»éŒ²ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãªã©ã®ç›®æ¨™é”æˆ
- **åœ°ç†æƒ…å ±**: IPã‹ã‚‰å›½ãƒ»éƒ½å¸‚ã‚’æ¨å®šï¼ˆç²¾åº¦ã¯é™å®šçš„ï¼‰

---

## ä¸»ãªå®Ÿè£…æ–¹æ³•

### æ–¹æ³•ã®æ¯”è¼ƒè¡¨

| æ–¹æ³• | é›£æ˜“åº¦ | ã‚³ã‚¹ãƒˆ | ãƒ‡ãƒ¼ã‚¿æ‰€æœ‰ | ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å¯¾å¿œ | é©ç”¨ã‚·ãƒ¼ãƒ³ |
|------|--------|--------|------------|------------------|------------|
| **ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°** | ä½ | ç„¡æ–™ | âœ… è‡ªç¤¾ | â–³ IPãŒç”Ÿã§æ®‹ã‚‹ | è‡ªå‰ã‚µãƒ¼ãƒãƒ¼é‹ç”¨æ™‚ |
| **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé€ä¿¡+ã‚µãƒ¼ãƒãƒ¬ã‚¹** | ä¸­ | ä½ã€œä¸­ | âœ… è‡ªç¤¾ | â—¯ å®Ÿè£…æ¬¡ç¬¬ | GitHub Pagesç­‰ã®é™çš„ã‚µã‚¤ãƒˆ |
| **Google Analytics 4** | ä½ | ç„¡æ–™* | âŒ Google | â–³ CookieåŒæ„å¿…è¦ | æ‰‹è»½ã«è©³ç´°åˆ†æã—ãŸã„ |
| **Matomoï¼ˆè‡ªãƒ›ã‚¹ãƒˆï¼‰** | ä¸­ã€œé«˜ | ã‚µãƒ¼ãƒãƒ¼ä»£ | âœ… è‡ªç¤¾ | â—¯ è¨­å®šã§èª¿æ•´å¯ | ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦– |
| **Plausible/Fathom** | ä½ | æœ‰æ–™ | â–³ SaaS | â— Cookieä¸è¦ | ã‚·ãƒ³ãƒ—ãƒ«ãƒ»è»½é‡é‡è¦– |

*ç„¡æ–™æ ã‚ã‚Šï¼ˆæœˆ1000ä¸‡ã‚¤ãƒ™ãƒ³ãƒˆã¾ã§ï¼‰

---

## é™çš„ã‚µã‚¤ãƒˆå‘ã‘å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰

GitHub Pagesã€Netlifyã€Vercelãªã©**ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ãŒå–ã‚Œãªã„é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ã§ã®å®Ÿè£…æ–¹æ³•ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶]
     â†“ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿
[é™çš„HTML + tracking.js]
     â†“ ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±ã‚’POST
[ã‚µãƒ¼ãƒãƒ¬ã‚¹é–¢æ•°ï¼ˆLambda/Netlify Functionsç­‰ï¼‰]
     â†“ IPä»˜ä¸ãƒ»ä¿å­˜
[ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ or ãƒ­ã‚°ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆS3/BigQueryç­‰ï¼‰]
```

### å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«

#### 1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶JSï¼‰

`public/tracking.js`:
```javascript
(function() {
  const ENDPOINT = 'https://your-site.netlify.app/.netlify/functions/track';
  
  function sendEvent(eventType, data = {}) {
    const payload = {
      type: eventType,
      ts: new Date().toISOString(),
      url: location.pathname + location.search,
      referrer: document.referrer || null,
      ua: navigator.userAgent,
      screen: {
        width: screen.width,
        height: screen.height
      },
      ...data
    };
    
    // Beacon APIï¼ˆãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã‚‚é€ä¿¡ç¢ºå®Ÿï¼‰
    if (navigator.sendBeacon) {
      const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
      navigator.sendBeacon(ENDPOINT, blob);
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      fetch(ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
        keepalive: true
      }).catch(err => console.warn('Tracking failed:', err));
    }
  }
  
  // ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼
  window.addEventListener('load', () => sendEvent('pageview'));
  
  // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆä¾‹ï¼ˆdata-trackå±æ€§ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼‰
  document.addEventListener('click', (e) => {
    const target = e.target.closest('[data-track]');
    if (target) {
      sendEvent('click', { 
        element: target.getAttribute('data-track'),
        text: target.textContent.trim()
      });
    }
  });
})();
```

HTML ã«è¿½åŠ :
```html
<script src="/tracking.js" defer></script>
```

#### 2. ã‚µãƒ¼ãƒãƒ¬ã‚¹é–¢æ•°ï¼ˆå—ä¿¡å´ï¼‰

**Netlify Functions** ã®ä¾‹ (`netlify/functions/track.js`):

```javascript
const AWS = require('aws-sdk');
const s3 = new AWS.S3();

exports.handler = async (event) => {
  // CORSãƒ˜ãƒƒãƒ€ãƒ¼
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type',
  };
  
  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 204, headers };
  }
  
  try {
    const body = JSON.parse(event.body);
    const ip = event.headers['x-forwarded-for']?.split(',')[0] || 
               event.headers['client-ip'] || 
               'unknown';
    
    const record = {
      timestamp: body.ts,
      ip: anonymizeIP(ip), // IPåŒ¿ååŒ–ï¼ˆå¾Œè¿°ï¼‰
      url: body.url,
      referrer: body.referrer,
      userAgent: body.ua,
      screen: body.screen,
      eventType: body.type,
      eventData: body.element || body.text || null
    };
    
    // S3ã«ä¿å­˜ï¼ˆã¾ãŸã¯ DynamoDB/PostgreSQLç­‰ï¼‰
    const key = `logs/${new Date().toISOString().split('T')[0]}/${Date.now()}.json`;
    await s3.putObject({
      Bucket: process.env.S3_BUCKET,
      Key: key,
      Body: JSON.stringify(record),
      ContentType: 'application/json'
    }).promise();
    
    console.log('Tracked:', record);
    
    return {
      statusCode: 204,
      headers,
      body: ''
    };
  } catch (error) {
    console.error('Error:', error);
    return {
      statusCode: 500,
      headers,
      body: JSON.stringify({ error: 'Internal error' })
    };
  }
};

// IPåŒ¿ååŒ–ï¼ˆæœ€çµ‚ã‚ªã‚¯ãƒ†ãƒƒãƒˆã‚’ãƒã‚¹ã‚¯ï¼‰
function anonymizeIP(ip) {
  if (ip.includes(':')) {
    // IPv6: æœ€å¾Œã®2ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ãƒã‚¹ã‚¯
    return ip.split(':').slice(0, -2).join(':') + '::0';
  }
  // IPv4: æœ€å¾Œã®ã‚ªã‚¯ãƒ†ãƒƒãƒˆã‚’ãƒã‚¹ã‚¯
  return ip.split('.').slice(0, 3).join('.') + '.0';
}
```

**AWS Lambda + API Gateway** ã‚‚åŒæ§˜ã®å®Ÿè£…ãŒå¯èƒ½ã€‚

#### 3. ãƒ‡ãƒ¼ã‚¿åˆ†æ

S3ã«ä¿å­˜ã—ãŸãƒ­ã‚°ã‚’BigQueryã‚„Athenaã§åˆ†æ:

```sql
-- æ—¥åˆ¥ã‚¢ã‚¯ã‚»ã‚¹æ•°
SELECT 
  DATE(timestamp) as date,
  COUNT(*) as pageviews
FROM logs
WHERE eventType = 'pageview'
GROUP BY date
ORDER BY date DESC;

-- äººæ°—ãƒšãƒ¼ã‚¸ Top 10
SELECT 
  url,
  COUNT(*) as views
FROM logs
WHERE eventType = 'pageview'
GROUP BY url
ORDER BY views DESC
LIMIT 10;

-- ãƒªãƒ•ã‚¡ãƒ©åˆ†æ
SELECT 
  CASE 
    WHEN referrer IS NULL THEN 'Direct'
    WHEN referrer LIKE '%google%' THEN 'Google'
    WHEN referrer LIKE '%twitter%' THEN 'Twitter'
    ELSE 'Other'
  END as source,
  COUNT(*) as visits
FROM logs
GROUP BY source
ORDER BY visits DESC;
```

---

## ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã«ã‚ˆã‚‹å–å¾—

è‡ªå‰ã‚µãƒ¼ãƒãƒ¼ï¼ˆNginxã€Apacheç­‰ï¼‰ã‚’é‹ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ã‚µãƒ¼ãƒãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’æ´»ç”¨ã€‚

### Nginx ã®å ´åˆ

#### ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç¢ºèª

`/etc/nginx/nginx.conf`:
```nginx
log_format combined '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent '
                    '"$http_referer" "$http_user_agent"';

access_log /var/log/nginx/access.log combined;
```

#### ãƒ­ã‚°ä¾‹
```
192.168.1.100 - - [21/Nov/2025:14:23:45 +0900] "GET /quiz HTTP/1.1" 200 4521 "https://google.com/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)"
```

### ãƒ­ã‚°è§£æã‚³ãƒãƒ³ãƒ‰

#### åŸºæœ¬é›†è¨ˆï¼ˆawkï¼‰

```bash
# ä»Šæ—¥ã®ã‚¢ã‚¯ã‚»ã‚¹æ•°
grep "$(date +%d/%b/%Y)" /var/log/nginx/access.log | wc -l

# IPåˆ¥ã‚¢ã‚¯ã‚»ã‚¹ä¸Šä½10
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10

# URLåˆ¥ã‚¢ã‚¯ã‚»ã‚¹ä¸Šä½10
awk '{print $7}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰åˆ¥é›†è¨ˆ
awk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -rn

# ãƒªãƒ•ã‚¡ãƒ©åˆ¥é›†è¨ˆ
awk -F'"' '{print $4}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -20

# User-Agentåˆ¥é›†è¨ˆï¼ˆãƒœãƒƒãƒˆæ¤œå‡ºç”¨ï¼‰
awk -F'"' '{print $6}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -20

# æ™‚é–“å¸¯åˆ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆæ™‚é–“ã®ã¿æŠ½å‡ºï¼‰
awk -F'[: []' '{print $3}' /var/log/nginx/access.log | sort | uniq -c

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ï¼ˆ4xx, 5xxï¼‰ã®ã¿æŠ½å‡º
awk '$9 ~ /^[45]/ {print $0}' /var/log/nginx/access.log | tail -20
```

#### é«˜åº¦ãªåˆ†æãƒ„ãƒ¼ãƒ«

**GoAccess**ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ Web UIï¼‰:
```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆUbuntu/Debianï¼‰
sudo apt install goaccess

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
goaccess /var/log/nginx/access.log -c

# HTML ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
goaccess /var/log/nginx/access.log -o /var/www/html/report.html --log-format=COMBINED

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ HTMLï¼ˆWebSocketï¼‰
goaccess /var/log/nginx/access.log -o /var/www/html/report.html --log-format=COMBINED --real-time-html
```

**ELK Stack**ï¼ˆElasticsearch + Logstash + Kibanaï¼‰:
- Logstash ã§ãƒ­ã‚°åé›†ãƒ»ãƒ‘ãƒ¼ã‚¹
- Elasticsearch ã«ä¿å­˜
- Kibana ã§ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ

```yaml
# docker-compose.yml ç°¡æ˜“ä¾‹
version: '3'
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
    ports:
      - 9200:9200
  
  logstash:
    image: docker.elastic.co/logstash/logstash:8.11.0
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf
      - /var/log/nginx:/logs
    depends_on:
      - elasticsearch
  
  kibana:
    image: docker.elastic.co/kibana/kibana:8.11.0
    ports:
      - 5601:5601
    depends_on:
      - elasticsearch
```

---

## ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£è§£æãƒ„ãƒ¼ãƒ«

### Google Analytics 4ï¼ˆGA4ï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ç„¡æ–™ï¼ˆæœˆ1000ä¸‡ã‚¤ãƒ™ãƒ³ãƒˆã¾ã§ï¼‰
- è©³ç´°ãªãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ•ã‚¡ãƒãƒ«ç­‰ï¼‰
- BigQueryé€£æºã§ã‚«ã‚¹ã‚¿ãƒ åˆ†æå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ‡ãƒ¼ã‚¿ã¯Googleã«é€ä¿¡ã•ã‚Œã‚‹
- Cookieä½¿ç”¨ã®ãŸã‚åŒæ„å–å¾—ãŒå¿…è¦ï¼ˆGDPRç­‰ï¼‰
- å­¦ç¿’ã‚³ã‚¹ãƒˆãŒã‚„ã‚„é«˜ã„

**å°å…¥**:
```html
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX', {
    anonymize_ip: true, // IPåŒ¿ååŒ–
    cookie_flags: 'SameSite=None;Secure'
  });
</script>
```

### Matomoï¼ˆæ—§Piwikï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã€è‡ªãƒ›ã‚¹ãƒˆå¯èƒ½ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’è‡ªåˆ†ã§ç®¡ç†ï¼‰
- GA4ã«è¿‘ã„æ©Ÿèƒ½ï¼ˆãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã€A/Bãƒ†ã‚¹ãƒˆç­‰ï¼‰
- GDPRæº–æ‹ ã®è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³è±Šå¯Œ

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- è‡ªãƒ›ã‚¹ãƒˆã®å ´åˆã¯ã‚µãƒ¼ãƒãƒ¼ãƒ»DBç®¡ç†ãŒå¿…è¦
- ã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆã¯æœ‰æ–™ï¼ˆæœˆâ‚¬19ã€œï¼‰

**Dockerå°å…¥ä¾‹**:
```bash
# docker-compose.yml
version: '3'
services:
  matomo:
    image: matomo:latest
    ports:
      - 8080:80
    environment:
      - MATOMO_DATABASE_HOST=db
      - MATOMO_DATABASE_DBNAME=matomo
      - MATOMO_DATABASE_USERNAME=matomo
      - MATOMO_DATABASE_PASSWORD=secret
    volumes:
      - matomo:/var/www/html
  
  db:
    image: mariadb:10
    environment:
      - MYSQL_ROOT_PASSWORD=rootsecret
      - MYSQL_DATABASE=matomo
      - MYSQL_USER=matomo
      - MYSQL_PASSWORD=secret
    volumes:
      - db:/var/lib/mysql

volumes:
  matomo:
  db:
```

èµ·å‹•:
```bash
docker-compose up -d
# http://localhost:8080 ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–‹å§‹
```

### Plausible / Fathom

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ã‚·ãƒ³ãƒ—ãƒ«ã§è»½é‡ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ1KBæœªæº€ï¼‰
- Cookieä¸è¦ã§GDPRæº–æ‹ 
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦–

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- æœ‰æ–™ï¼ˆPlausible: æœˆ$9ã€œã€Fathom: æœˆ$14ã€œï¼‰
- æ©Ÿèƒ½ã¯ã‚·ãƒ³ãƒ—ãƒ«ï¼ˆè©³ç´°åˆ†æã«ã¯ä¸å‘ãï¼‰

**å°å…¥ä¾‹ï¼ˆPlausibleï¼‰**:
```html
<script defer data-domain="yourdomain.com" src="https://plausible.io/js/script.js"></script>
```

---

## ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»æ³•çš„æ³¨æ„ç‚¹

### æ—¥æœ¬ã®æ³•å¾‹

**å€‹äººæƒ…å ±ä¿è­·æ³•**:
- IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€Œå€‹äººã«é–¢ã™ã‚‹æƒ…å ±ã€ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- åˆ©ç”¨ç›®çš„ã‚’ç‰¹å®šã—ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«æ˜è¨˜
- ç¬¬ä¸‰è€…æä¾›ï¼ˆGAç­‰ï¼‰ã¯æœ¬äººåŒæ„ãŒåŸå‰‡

### GDPRï¼ˆEUï¼‰/ ePrivacy

- Cookieä½¿ç”¨ã«ã¯**äº‹å‰åŒæ„ï¼ˆã‚ªãƒ—ãƒˆã‚¤ãƒ³ï¼‰**ãŒå¿…è¦
- ãƒ‡ãƒ¼ã‚¿ä¸»ä½“ã®æ¨©åˆ©ï¼ˆã‚¢ã‚¯ã‚»ã‚¹æ¨©ã€å‰Šé™¤æ¨©ç­‰ï¼‰ã‚’ä¿è¨¼
- ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ã‚’æœ€å°é™ã«

### å®Ÿè£…ã™ã¹ãã“ã¨

#### 1. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¸ã®è¨˜è¼‰

```markdown
## ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®å–å¾—ã«ã¤ã„ã¦

å½“ã‚µã‚¤ãƒˆã§ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºä¿ã®ãŸã‚ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’è‡ªå‹•çš„ã«åé›†ã—ã¾ã™ã€‚

### åé›†ã™ã‚‹æƒ…å ±
- ã‚¢ã‚¯ã‚»ã‚¹æ—¥æ™‚
- é–²è¦§ãƒšãƒ¼ã‚¸ã®URL
- ãƒªãƒ•ã‚¡ãƒ©ï¼ˆå‚ç…§å…ƒã‚µã‚¤ãƒˆï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»OSæƒ…å ±ï¼ˆUser-Agentï¼‰
- IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆåŒ¿ååŒ–å‡¦ç†ã‚’å®Ÿæ–½ï¼‰
- ç”»é¢è§£åƒåº¦

### åˆ©ç”¨ç›®çš„
- ã‚µã‚¤ãƒˆã®åˆ©ç”¨çŠ¶æ³åˆ†æ
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ”¹å–„
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

### ä¿å­˜æœŸé–“
- 90æ—¥é–“ï¼ˆãã‚Œä»¥é™ã¯è‡ªå‹•å‰Šé™¤ï¼‰

### ç¬¬ä¸‰è€…æä¾›
- åŸå‰‡ã¨ã—ã¦ç¬¬ä¸‰è€…ã«æä¾›ã—ã¾ã›ã‚“
- ãŸã ã—ã€æ³•ä»¤ã«åŸºã¥ãé–‹ç¤ºè«‹æ±‚ã«ã¯å¿œã˜ã¾ã™

### ãŠå•ã„åˆã‚ã›
- ãƒ¡ãƒ¼ãƒ«: privacy@example.com
```

#### 2. CookieåŒæ„ãƒãƒŠãƒ¼

```html
<div id="cookie-banner" style="position: fixed; bottom: 0; width: 100%; background: #333; color: white; padding: 15px; display: none;">
  <p>
    å½“ã‚µã‚¤ãƒˆã§ã¯ã‚¢ã‚¯ã‚»ã‚¹åˆ†æã®ãŸã‚Cookieã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    <a href="/privacy" style="color: #4a9eff;">è©³ç´°</a>
  </p>
  <button onclick="acceptCookies()">åŒæ„ã™ã‚‹</button>
  <button onclick="rejectCookies()">æ‹’å¦</button>
</div>

<script>
  // åŒæ„çŠ¶æ…‹ã®ç¢ºèª
  if (!localStorage.getItem('cookieConsent')) {
    document.getElementById('cookie-banner').style.display = 'block';
  } else if (localStorage.getItem('cookieConsent') === 'accepted') {
    // ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°é–‹å§‹
    loadTrackingScript();
  }
  
  function acceptCookies() {
    localStorage.setItem('cookieConsent', 'accepted');
    document.getElementById('cookie-banner').style.display = 'none';
    loadTrackingScript();
  }
  
  function rejectCookies() {
    localStorage.setItem('cookieConsent', 'rejected');
    document.getElementById('cookie-banner').style.display = 'none';
  }
  
  function loadTrackingScript() {
    // GA4ã‚„Matomoã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã“ã“ã§èª­ã¿è¾¼ã‚€
    const script = document.createElement('script');
    script.src = '/tracking.js';
    document.head.appendChild(script);
  }
</script>
```

#### 3. IPåŒ¿ååŒ–ã®å®Ÿè£…

```javascript
// IPv4: 192.168.1.100 â†’ 192.168.1.0
function anonymizeIPv4(ip) {
  return ip.split('.').slice(0, 3).join('.') + '.0';
}

// IPv6: 2001:0db8:85a3::8a2e:0370:7334 â†’ 2001:0db8:85a3::
function anonymizeIPv6(ip) {
  return ip.split(':').slice(0, 3).join(':') + '::';
}

function anonymizeIP(ip) {
  return ip.includes(':') ? anonymizeIPv6(ip) : anonymizeIPv4(ip);
}
```

#### 4. ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å‰Šé™¤

```javascript
// ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§å®šæœŸå®Ÿè¡Œï¼ˆä¾‹: cronï¼‰
const deleteOldLogs = async () => {
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - 90); // 90æ—¥å‰
  
  // S3ã®å ´åˆ
  const objects = await s3.listObjectsV2({
    Bucket: 'my-logs',
    Prefix: 'logs/'
  }).promise();
  
  const toDelete = objects.Contents.filter(obj => 
    new Date(obj.LastModified) < cutoffDate
  );
  
  if (toDelete.length > 0) {
    await s3.deleteObjects({
      Bucket: 'my-logs',
      Delete: {
        Objects: toDelete.map(obj => ({ Key: obj.Key }))
      }
    }).promise();
    console.log(`Deleted ${toDelete.length} old log files`);
  }
};

// æ¯æ—¥å®Ÿè¡Œ
setInterval(deleteOldLogs, 24 * 60 * 60 * 1000);
```

---

## å°å…¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æº–å‚™æ®µéš

- [ ] åé›†ã™ã‚‹æƒ…å ±ã®ç¨®é¡ã‚’æ±ºå®šï¼ˆå¿…è¦æœ€å°é™ã«ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ä¿å­˜å ´æ‰€ã‚’æ±ºå®šï¼ˆS3/DB/SaaSï¼‰
- [ ] ä¿å­˜æœŸé–“ã‚’æ±ºå®šï¼ˆæ¨å¥¨: 30ã€œ90æ—¥ï¼‰
- [ ] ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆãƒ»æ›´æ–°

### å®Ÿè£…æ®µéš

- [ ] ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰å®Ÿè£…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
- [ ] å—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…ï¼ˆã‚µãƒ¼ãƒãƒ¬ã‚¹é–¢æ•°ç­‰ï¼‰
- [ ] IPåŒ¿ååŒ–ã®å®Ÿè£…
- [ ] CookieåŒæ„ãƒãƒŠãƒ¼ã®å®Ÿè£…ï¼ˆå¿…è¦ãªå ´åˆï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å‰Šé™¤ã®ä»•çµ„ã¿æ§‹ç¯‰

### ãƒ†ã‚¹ãƒˆæ®µéš

- [ ] é–‹ç™ºç’°å¢ƒã§ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã‚’ãƒ†ã‚¹ãƒˆ
- [ ] å„ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ãƒ‡ãƒã‚¤ã‚¹ã§å‹•ä½œç¢ºèª
- [ ] ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãƒ»åºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼ã§ã®æŒ™å‹•ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### é‹ç”¨æ®µéš

- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»åˆ†æã‚¯ã‚¨ãƒªã®ä½œæˆ
- [ ] ç•°å¸¸ã‚¢ã‚¯ã‚»ã‚¹ã®ç›£è¦–è¨­å®š
- [ ] å®šæœŸçš„ãªãƒ­ã‚°ç¢ºèªï¼ˆé€±æ¬¡/æœˆæ¬¡ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

---

## ãŠã™ã™ã‚ãƒ„ãƒ¼ãƒ«é¸æŠã‚¬ã‚¤ãƒ‰

### ã‚±ãƒ¼ã‚¹åˆ¥æ¨å¥¨

| çŠ¶æ³ | æ¨å¥¨ãƒ„ãƒ¼ãƒ« | ç†ç”± |
|------|-----------|------|
| ã¨ã«ã‹ãç°¡å˜ã«å§‹ã‚ãŸã„ | Google Analytics 4 | è¨­å®š5åˆ†ã€ãƒ¬ãƒãƒ¼ãƒˆè±Šå¯Œ |
| ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦– | Plausible ã¾ãŸã¯ Matomo | Cookieä¸è¦ã€ãƒ‡ãƒ¼ã‚¿è‡ªç¤¾ç®¡ç† |
| GitHub Pagesä½¿ç”¨ä¸­ | è‡ªä½œï¼ˆNetlify Functionsï¼‰ | ã‚³ã‚¹ãƒˆæœ€å°ã€å®Œå…¨åˆ¶å¾¡ |
| è‡ªå‰ã‚µãƒ¼ãƒãƒ¼é‹ç”¨ | Nginx/Apache ãƒ­ã‚° + GoAccess | è¿½åŠ ã‚³ã‚¹ãƒˆä¸è¦ã€è»½é‡ |
| å¤§è¦æ¨¡ã‚µã‚¤ãƒˆ | ELK Stack ã¾ãŸã¯ Google BigQuery | ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã€é«˜åº¦ãªåˆ†æ |
| eã‚³ãƒãƒ¼ã‚¹ | Google Analytics 4 + GTM | eã‚³ãƒãƒ¼ã‚¹æ©Ÿèƒ½å……å®Ÿ |

### ã‚³ã‚¹ãƒˆæ¯”è¼ƒï¼ˆæœˆé–“10ä¸‡PVæƒ³å®šï¼‰

| ãƒ„ãƒ¼ãƒ« | ã‚³ã‚¹ãƒˆ | å‚™è€ƒ |
|--------|--------|------|
| Nginx/Apache ãƒ­ã‚° | ç„¡æ–™ | ã‚µãƒ¼ãƒãƒ¼ä»£ã®ã¿ |
| è‡ªä½œï¼ˆNetlify Functionsï¼‰ | $0ã€œ$10 | ç„¡æ–™æ å†…ã§åã¾ã‚‹å ´åˆã‚‚ |
| Google Analytics 4 | ç„¡æ–™ | 1000ä¸‡ã‚¤ãƒ™ãƒ³ãƒˆ/æœˆã¾ã§ |
| Plausible | $9/æœˆ | 10ä¸‡PVã¾ã§ |
| Matomo Cloud | â‚¬19/æœˆ | ç´„3000å†† |
| Matomoï¼ˆè‡ªãƒ›ã‚¹ãƒˆï¼‰ | ã‚µãƒ¼ãƒãƒ¼ä»£ | VPS $5ã€œ |

---

## ã¾ã¨ã‚

### é™çš„ã‚µã‚¤ãƒˆã®å ´åˆ
1. **æœ€é€Ÿ**: Google Analytics 4ï¼ˆ5åˆ†ã§å°å…¥ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼å¿…é ˆï¼‰
2. **ãƒãƒ©ãƒ³ã‚¹å‹**: Plausibleï¼ˆè»½é‡ã€Cookieä¸è¦ã€æœ‰æ–™ï¼‰
3. **å®Œå…¨åˆ¶å¾¡**: è‡ªä½œãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆNetlify Functions + S3ç­‰ï¼‰

### è‡ªå‰ã‚µãƒ¼ãƒãƒ¼ã®å ´åˆ
1. Nginx/Apacheã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°æ´»ç”¨
2. GoAccessã§å¯è¦–åŒ–
3. å¿…è¦ã«å¿œã˜ã¦ELKã‚„Matomoã‚’è¿½åŠ 

### å¿…ãšå¯¾å¿œã™ã‚‹ã“ã¨
- âœ… ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã¸ã®è¨˜è¼‰
- âœ… IPåŒ¿ååŒ–
- âœ… ãƒ‡ãƒ¼ã‚¿ä¿å­˜æœŸé–“ã®è¨­å®šã¨è‡ªå‹•å‰Šé™¤
- âœ… Cookieä½¿ç”¨æ™‚ã¯åŒæ„å–å¾—

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [Google Analytics 4 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://support.google.com/analytics/answer/10089681)
- [Matomo å…¬å¼ã‚µã‚¤ãƒˆ](https://matomo.org/)
- [Plausible Analytics](https://plausible.io/)
- [GoAccess](https://goaccess.io/)
- [å€‹äººæƒ…å ±ä¿è­·å§”å“¡ä¼š - å€‹äººæƒ…å ±ä¿è­·æ³•](https://www.ppc.go.jp/)
- [GDPRï¼ˆEUä¸€èˆ¬ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦å‰‡ï¼‰](https://gdpr.eu/)

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ21æ—¥
