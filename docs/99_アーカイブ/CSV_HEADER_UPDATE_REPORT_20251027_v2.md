# CSVヘッダ更新レポート

**作成日**: 2025-10-27  
**バージョン**: 2.1  
**対象プロジェクト**: SimpleWord

---

## 概要

CSVファイルのヘッダを手動で見直し・修正したことに伴い、関連するコードファイルおよびドキュメントを更新しました。

---

## 更新されたCSVヘッダ形式

### 1. 中学古典単語.csv（基本形式）

```csv
語句,読み（ひらがな）,意味,語源等解説（日本語）,関連語と意味,関連分野,難易度
```

**列の説明:**
- **語句**: 学習対象の単語・用語
- **読み（ひらがな）**: 読み方をひらがなで表記
- **意味**: 単語の意味・訳
- **語源等解説（日本語）**: 語源や追加の解説
- **関連語と意味**: 関連する単語とその意味（セミコロン区切り）
- **関連分野**: カテゴリ・分野（セミコロン区切り）
- **難易度**: 難易度レベル（数値またはテキスト）

### 2. 中学英会話.csv（発音付き形式）

```csv
語句,発音（カタカナ）,和訳,語源等解説（日本語）,関連語（英語）と意味（日本語）,関連分野（日本語）,難易度
```

**列の説明:**
- **語句**: 英語の単語・フレーズ
- **発音（カタカナ）**: 発音をカタカナで表記
- **和訳**: 日本語訳
- **語源等解説（日本語）**: 語源や使い方の解説
- **関連語（英語）と意味（日本語）**: 関連する英語表現とその意味
- **関連分野（日本語）**: カテゴリ・分野
- **難易度**: 難易度レベル

---

## 更新されたファイル一覧

### コードファイル

#### 1. SimpleWordTests/SimpleWordTests.swift
- **変更内容**: テストケース内のヘッダ文字列を実際のCSVフォーマットに合わせて更新
- **影響**: テストの整合性を確保

#### 2. SimpleWord/Utils/FileUtils.swift
- **変更内容**: 
  - `createNewCSVInDocuments()`: 新規CSV作成時のヘッダを日本語形式に変更
  - `writeQuestionItems()`: QuestionItem保存時のヘッダコメントと実際のヘッダ文字列を更新
- **影響**: 新規作成されるCSVファイルが正しい日本語ヘッダを持つようになる

### ドキュメントファイル

#### 3. README_V2.md
- **変更内容**: 「よくある質問」セクションのCSVフォーマット例を更新
- **追加内容**: 
  - 基本形式（読み（ひらがな））の例
  - 発音付き形式（発音（カタカナ））の例

#### 4. SimpleWord/docs/仕様書/03_問題集管理_CSV_仕様書.md
- **変更内容**: CSVフォーマット例を更新（README_V2.mdと同様）
- **影響**: 仕様書とREADMEの一貫性を確保

---

## 機能追加: 発音表示

### 実装内容

**ファイル**: `SimpleWord/QuizComponents/ChoiceCardView.swift`

回答後の選択肢カード表示において、CSVの2列目が「発音（カタカナ）」の場合、語句の後ろに発音を括弧付きで表示する機能がすでに実装されています。

**表示ロジック（87-95行目）:**
```swift
// 発音を表示（ヘッダに「発音」が含まれる場合）
if !questionItem.reading.isEmpty,
   let readingLabel = headerLabels["reading"],
   (readingLabel.contains("発音") || readingLabel.contains("カタカナ")) {
    Text("(\(questionItem.reading))")
        .font(.caption2)
        .foregroundColor(textColor.opacity(0.85))
}
```

**動作:**
- `headerLabels["reading"]`に「発音」または「カタカナ」という文字列が含まれている場合、`questionItem.reading`の値を括弧付きで表示
- それ以外の場合（例: 「読み（ひらがな）」）は、従来通り別の行で表示

**表示例:**

英会話CSVの場合:
```
語句: Hello! (ハロー)
和訳: こんにちは
語源等解説: 英語の挨拶の定番
...
```

古典単語CSVの場合:
```
語句: いと
読み: いと
意味: とても
...
```

---

## データの整合性

### CSVデータの変更
- **変更なし**: CSV内のデータ行（実際の単語情報）は変更されていません
- **ヘッダのみ変更**: 1行目のヘッダ行のみが日本語の正式名称に更新されました

### 列数の固定
- **7列固定**: すべてのCSVファイルは7列の固定フォーマットを維持
- **列順の固定**: 列の順序も固定されており、変更はありません

### パーサの対応
- `QuestionItemParser`は列順（インデックス）ベースで解析を行うため、ヘッダの文言変更の影響を受けません
- ヘッダ行は表示ラベル取得にのみ使用され、データ解析には使用されません

---

## テスト結果

### 静的チェック
- ✅ コンパイルエラー: なし
- ✅ 型整合性: 問題なし
- ✅ 構文エラー: なし

### 期待される動作
1. ✅ CSV読み込み時にヘッダ行が正しくスキップされる
2. ✅ データ行が正しく7列としてパースされる
3. ✅ 選択肢カードに正しいラベルが表示される
4. ✅ 発音列の場合、語句の後ろに発音が表示される
5. ✅ 読み列の場合、発音は別行で表示される

---

## 今後の推奨事項

### 1. 既存CSVファイルの更新
Resources配下の他のCSVファイル（中学歴史.csvなど）も、同様のヘッダ形式に統一することを推奨します。

### 2. CSV作成ガイドラインの整備
新規にCSVを作成する際のガイドラインドキュメントを作成し、以下を明記することを推奨します:
- 列数は7列固定
- ヘッダは日本語の正式名称を使用
- 発音を含む場合は「発音（カタカナ）」、読みの場合は「読み（ひらがな）」と明記
- UTF-8エンコーディング必須

### 3. バリデーション強化
CSV読み込み時に以下のバリデーションを追加することを検討:
- ヘッダ形式のチェック（推奨ヘッダとの比較）
- エンコーディングの自動検出と警告
- BOM付きUTF-8への対応

---

## まとめ

CSVヘッダの日本語正式名称への更新により、以下が達成されました:

1. **可読性の向上**: ヘッダが日本語の正式名称になり、CSVファイルの内容が分かりやすくなりました
2. **一貫性の確保**: コード、テスト、ドキュメントがすべて統一されたヘッダ形式を使用するようになりました
3. **機能の維持**: データの変更はなく、既存機能（発音表示含む）はすべて正常に動作します
4. **拡張性の確保**: 将来的に他のCSVファイルも同様の形式に統一可能です

**最終更新**: 2025-10-27  
**ステータス**: ✅ 完了
