# ミクロマクロ理論 × UDD（未知駆動開発）：既存研究との対応と統合アーキテクチャ（検証メモ）

**作成日**: 2026年1月16日  
**ステータス**: 構想（検証メモ / 対応表 / 手順）  
**キーワード**: ミクロ↔マクロ接続, マルチスケール, 閉包（closure）, UQ（不確かさ定量化）, 逐次実験計画（OED）, Digital twin, Validate-first, 監査ログ

---

## 0. この文書の狙い

「ミクロマクロ理論 × 未知駆動開発（UDD）」を、
**既存の確立領域（名称の違い）へ対応づけ**、
**検証可能なアーキテクチャと手順**に落とす。

このリポジトリのUDD定義（Validate-first / 未知分類 / 原因分解 / 監査）を前提にする：
- [UDD_SIGNIFICANCE_CONCEPT.md](UDD_SIGNIFICANCE_CONCEPT.md)

補足：この文書でいう
- **ミクロ**: 詳細シミュレーション/実験/個体モデル
- **マクロ**: 意思決定に使う粗視化モデル（連続体モデル・統計モデル・エージェントベースモデルなど）
- **接続（橋）**: ミクロ情報をマクロに反映する手続き（閉包・パラメータ化・同化・校正など）
を指す。

---

## 1. 「ミクロ↔マクロ接続」を既存領域で言い換える

ミクロとマクロの“接続”は、分野ごとに名前が変わるが、困っている論点はだいたい同じ：

- **マクロ方程式に必要な閉包（closure）が分からない**
- **スケール分離が弱い / 非線形 / ヒステリシスで、単純な平均化が効かない**
- **同定不能性（identifiability）で、複数の仮説が同じ観測を説明できる**

この文脈で、あなたの「未知駆動（探索で更新）」は、
UQ（不確かさの分類・校正・モデル差分）と強く整合する。

---

## 2. 対応表（本構想の要素 ↔ 既存研究の用語）

| 本構想の構成要素 | 既存研究で近いラベル | 目的（何が嬉しいか） | 典型的な落とし穴 |
|---|---|---|---|
| ミクロ↔マクロ接続（橋） | Multiscale modeling | 多階層を一貫して扱う枠組み | closureの恣意性、スケール分離の破れ |
| 「方程式が書けない」接続 | Equation-free modeling | lifting/restrictionで“閉包をオンデマンド”にする | 粗視化変数（coarse observables）選定ミス、lifting誤差（healing依存） |
| 未知を前提に更新する | Uncertainty quantification (UQ) | 何が不確かかを分類し、校正・予測区間を出す | identifiability、モデル差分とパラメータの混同 |
| 次にどこを測る/計算するか | Sequential design / Optimal experimental design (OED) | 実験・計算コストを最小化しつつ未知を減らす | 探索が局所最適、評価手続きリーク |
| 実系↔モデルの同期・更新ループ | Digital twin | 運用データでモデルを更新し続ける | “同期なし”が双子を名乗る問題、責任分界が曖昧 |

補足：この対応表は「名称合わせ」のためのメモで、リンク集を目的にしない。

---

## 3. 統合アーキテクチャ（最小）

狙い：
- **マクロ計算**（意思決定・予測・制御）を回しながら
- **ミクロ計算**でclosure/パラメータを供給し
- **UQで未知を定量化**して
  - **逐次実験計画（OED）で次の計算/観測を選び**
- **データ同化/更新（Twin）**で現実に追従する

```mermaid
graph TD
  A[目的・意思決定タスク] --> B[マクロモデル: 連続体/統計/ABM（エージェントベース）など]
  B --> C{予測が不確か?<br/>（UQ）}
  C -->|不確か| D[未知の分類<br/>(構造/パラメータ/観測/評価)]
  D --> E[次の打ち手を選ぶ<br/>(逐次実験計画 / OED)]
  E --> F[ミクロ計算・実験・観測<br/>(局所シミュレーション/実測)]
  F --> G[橋（closure推定/校正）<br/>lifting/restriction/同化]
  G --> B
  C -->|十分| H[運用/提示/制御]
```

UDD的に重要なのは、最初から「正しい橋」を決め打ちしないこと。
代わりに、橋（closure）を **検証可能な仮説** として扱い、更新を回す。

---

## 4. UDD（Validate-first）での検証プロトコル（手順書）

この節は「ミクロ↔マクロ接続」を、研究メモではなく **検証可能な運用**として回すための最小手順。
ポイントは、アルゴリズム選定より先に「手続き固定・リーク遮断・監査ログ」を決めること。

---

### 4-1. 事前に固定する“契約”（Artifacts / I/F）

Gateに入る前に、最低限これだけは文章として固定する（コードは後でよい）。

- **A1. 目的と評価**
  - 目的：何を予測/最適化/同定したいか
  - 評価：誤差指標（例：RMSE、予測区間被覆率、下流の意思決定損失）
  - データ分割：fit範囲（学習/校正に触れてよい範囲）と評価範囲
- **A2. マクロモデルI/F**
  - 入力：マクロ状態、制御、境界条件
  - 出力：予測量（観測に対応する量も含む）
  - 不確かさの出力形式（点推定のみ/分布/区間）
- **A3. ミクロ計算/実験I/F**
  - 入力：ミクロ初期条件、条件パラメータ
  - 出力：必要な統計量（観測可能量）と、その推定誤差（あるなら）
- **A4. 橋（restriction/lifting/closure）のI/F**
  - restriction：ミクロ→マクロ観測量の定義
  - lifting：マクロ→ミクロ初期条件の生成規則（再現可能な乱数・手順）
  - closure：何を推定/学習してマクロへ渡すか
- **A5. 監査ログのスキーマ（最小）**
  - run_id、日時、コード/データ/モデルのバージョン
  - 入力条件（マクロ/ミクロ/橋/評価設定）
  - 出力（観測、推定、予測、指標）
  - その反復での意思決定（次の一手）と根拠

---

### 4-2. Gate 0：評価が破綻しないことの保証（Validate-first）

**目的**：この先どれだけ探索しても「良くなった/悪くなった」が嘘にならないようにする。

- **入力**
  - A1〜A5（上の契約）
- **手順（最小）**
  1. 評価指標と分割（fit範囲/評価範囲）を“文章で固定”する
  2. ベースラインを固定する（最小の比較対象：単純モデル/既存手法/ゼロ次近似）
  3. 禁止事項を固定する（例：評価に未来情報が混ざる処理、評価指標の後出し変更）
  4. 停止条件（No-Go）を先に書く
- **出力**
  - Gate 0 仕様（評価・分割・ベースライン・禁止・停止条件）
  - ベースライン結果（指標とログ）
- **停止条件（例）**
  - 評価が再現できない（同条件で結果が揺れ、原因が追えない）
  - 指標が目的とズレている（何を最適化しているか説明できない）
  - 評価が反証不能（どんな改善も“良さそう”に見えてしまう）
- **ログ（最小）**
  - metric_definition、split_definition、baseline_spec、forbidden_rules、stop_rules

---

### 4-3. Gate 1：マクロ変数（coarse observables）と橋を確定

**目的**：ミクロ↔マクロの接続点を曖昧にしない（曖昧だと検証不能）。

- **入力**
  - Gate 0 仕様
  - restriction/liftingの候補（A4）
- **手順（最小）**
  1. 観測可能量（観測に対応するマクロ量）を列挙し、単位・前処理を固定する
  2. restrictionを固定する（ミクロログ→マクロ量への変換規則）
  3. liftingを固定する（マクロ量→ミクロ初期条件の生成規則）
  4. healing（短時間なじませ）の有無と手順が必要なら固定する
- **出力**
  - coarse observables 定義
  - restriction/lifting 手順
- **停止条件（例）**
  - liftingが一意でなく、結果のばらつきが支配的で検証できない
  - 観測量が、目的（A1）と無関係である
- **ログ（最小）**
  - observable_spec、restriction_spec、lifting_spec、rng_seed_policy

---

### 4-4. Gate 2：更新対象を分離（パラメータ校正 vs 構造差分）

**目的**：何を“更新”しているのかを明確にし、同定不能性（identifiability）で迷走しない。

- **入力**
  - Gate 1までの定義
  - closureの候補（A4）
- **手順（最小）**
  1. 更新対象を2系統に分けて宣言する
     - パラメータ校正：構造固定で数値だけ推定する
     - 構造差分：モデル構造が足りていないことを認め、差分モデル/代替仮説を追加する
  2. どちらを優先して検証するか順序を固定する（混ぜない）
  3. 不確かさの意味を固定する（観測誤差/モデル誤差/離散化誤差 等）
- **出力**
  - 更新ルール（どの反復で何を更新するか）
  - 反証可能な仮説リスト（採用/却下の基準つき）
- **停止条件（例）**
  - 複数の仮説が同程度に当たり、区別できない（次の観測設計が必要）
  - パラメータが不安定で、推定手続きが収束しない
- **ログ（最小）**
  - update_target（param/structure）、uq_semantics、hypothesis_registry

---

### 4-5. Gate 3：次の計算/観測を選ぶ（逐次実験計画 / OED）

**目的**：どこを追加でミクロ計算/実験すべきかを、手続き固定のもとで決める。

- **入力**
  - Gate 2までの更新ルール
  - コスト制約（計算資源、実験回数、時間）
- **手順（最小）**
  1. 次の候補集合（候補点/条件/領域）を定義して固定する
  2. 選択規則を固定する（例：期待情報量、予測分散、意思決定損失の改善）
  3. 反復単位のログを残し、Gate 0の評価で必ず比較する
- **出力**
  - 次の一手（候補点/条件）
  - 選択根拠（数値・ルール・制約の満たし方）
- **停止条件（例）**
  - 追加データを入れても評価が改善しない（収穫逓減）
  - 不確かさが下がらない（UQの前提が壊れている可能性）
- **ログ（最小）**
  - candidate_set_spec、selection_rule_spec、selected_action、decision_rationale

---

## 5. 追加で当てに行くべき参照（次のウェブ検証候補）

この文書は概説レベルの対応づけまで。次に“実装可能性”を詰めるには、以下のレビュー/教科書に当てるのが良い：

- Heterogeneous Multiscale Methods / HMM（Engquist系）
- Multi-fidelity UQ / surrogate modeling（GPなど）
- 物質・地球科学では、摩擦則/破壊則の「校正」と「モデル差分」の扱い

---

## 6. まとめ（検証として言える範囲）

- 「ミクロマクロ理論 × UDD」は、既存のマルチスケール + UQ + 逐次設計（OED） + Digital twin を **検証駆動で統合する**構図として十分に成立する。
- 新規性は“概念そのもの”より、**未知を品質システム（Validate-first）として運用に落とす設計**に出やすい。
