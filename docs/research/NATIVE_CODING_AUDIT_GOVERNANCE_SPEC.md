# 母国語コーディングの監査ログ・ガバナンス仕様（ドラフト）

**作成日**: 2026年1月14日  
**ステータス**: ドラフト（フェーズA用）  
**目的**: 「曖昧さを安全に扱う」ための責任分界・承認点・監査ログを固定する

---

## 0. なぜ監査が必要か

母国語コーディングは、自然言語の利得（速い・柔軟）と引き換えに、
- 暗黙前提の取り違え
- 仕様の抜け
- 生成の幻覚

を「静かに」混入させやすい。
したがって運用では、**いつ・誰が・何を根拠に・どの差分を承認したか** を残す必要がある。

---

## 1. 役割（Roles）

最小限、次の役割を想定する。

- **要求作成者（Requester）**：意図を日本語で提示
- **仕様確定者（Specifier）**：曖昧さを潰し、受け入れ条件を確定
- **実装者（Implementer）**：差分を作り、テストを追加
- **承認者（Approver）**：差分とテストとログを見て最終承認

個人開発でも「同一人物が複数役割を持つ」だけで、ログ上は分離して扱う。

---

## 2. 承認点（Human-in-the-loop Gates）

### Gate A：仕様確定（Ask-to-commit）

変更生成前に必ず満たす。

- 未確定点リストが空、または仮定が明示され同意されている
- 受け入れ条件が測定可能（テスト可能）
- 非目標が明示されている

### Gate B：PR承認

- 差分が最小で、意図との対応が説明できる
- テストが受け入れ条件をカバー
- 監査ログが揃っている

---

## 3. 監査ログの最小スキーマ（JSON想定）

保存形式は自由だが、最低限このフィールドが揃うと「説明」と「再現」ができる。

### 3-1. AuditRecord（1試行）

- id: 一意ID
- timestamp: 作業開始/終了
- repo: リポジトリ識別子
- branch: 対象ブランチ
- intent:
  - raw_japanese: 生の日本語要求
  - normalized_spec: テンプレに落とした仕様（目的/制約/非目標/受け入れ条件）
  - assumptions: 仮定一覧
- clarifications:
  - questions: 確認質問
  - answers: 回答
- change:
  - files_changed: 変更ファイル一覧
  - diff_summary: 変更概要（自然言語）
  - constraints_applied: 適用した制約（型/契約/互換性ルールなど）
- tests:
  - added: 追加/更新したテスト
  - execution:
    - command: 実行コマンド
    - result: pass/fail
    - artifacts: レポートやログへの参照
- review:
  - approver: 承認者
  - decision: approve/reject
  - rationale: 判断理由
- outcome:
  - intent_pass: true/false
  - safety_pass: true/false
  - trace_pass: true/false
  - failure_classification: 未知分類（要求/仕様/実装/評価/運用）

---

## 4. ログの保存場所（案）

- 個人/チームで運用しやすい形として、以下を推奨。

- docs/research/ 配下：設計と例
- 実ログ：リポジトリルートに `.audit/` を作り、日付/IDで保存（例：`.audit/2026-01-14/xxx.json`）

注：このリポジトリではまず「設計のみ」をdocsに置き、運用が固まったら保存場所を決める。

---

## 5. 情報管理（最小ルール）

- 個人情報/契約情報/APIキーをログに書かない
- 生データは参照IDにし、ログは“ポインタ”を持つ
- 外部へ共有するログはマスキング済みにする

---

## 6. 失敗原因の分類（UDD接続）

- 要求未知：目的が変わった/一致しない
- 仕様未知：境界条件・例外が不足
- 実装未知：手段選択が誤り
- 評価未知：受け入れ条件が測れない/テスト不足
- 運用未知：環境・権限・データ制約

この分類をログに残すと、改善が「モデルのせい」ではなく、どこを直すべきかに落ちる。

