# 効率的開発パイプライン: 作業管理ルール

## 🎯 基本原則

### 1. **作業時間制限**
各タスクには明確な時間制限を設定。制限を超えそうな場合は自動的に別タスクに切り替え。

| タスクタイプ | 制限時間 | 超過時のアクション |
|------------|---------|------------------|
| 分析・調査 | 10分 | 結果を記録して次へ |
| 小規模修正（1-3ファイル） | 15分 | 中断ポイント記録 |
| 中規模実装（4-10ファイル） | 30分 | 段階的コミット |
| 大規模リファクタリング | 20分/ステップ | サブタスク分割 |
| テスト実行 | 5分 | バックグラウンド化検討 |

---

## 🔄 自動切り替えトリガー

### トリガー条件
1. **ユーザー待機時間が2分以上**
   → 進捗を記録して代替タスク提案

2. **同一ツール3回連続失敗**
   → アプローチ変更または別タスク提案

3. **15分以内にコミット未完了**
   → 中断ポイント記録 + 段階的コミット提案

4. **テスト/ビルドが5分以上**
   → 別の並行可能タスクを提案

---

## 📋 タスク優先度マトリクス

### 高優先度（即座に実行）
- 🔴 緊急バグ修正
- 🔴 ビルド/テスト失敗の修正
- 🔴 型エラー修正（5件以下）

### 中優先度（計画的実行）
- 🟡 機能追加
- 🟡 リファクタリング（小規模）
- 🟡 ドキュメント整備

### 低優先度（時間があれば）
- 🟢 大規模リファクタリング（分割実施）
- 🟢 最適化
- 🟢 技術的探索

---

## 🚦 実装フロー

### Phase別の実装戦略

#### **分析フェーズ (最大10分)**
```
1. 問題/タスク特定 (2分)
2. 影響範囲調査 (3分)
3. 実装計画策定 (5分)
→ 10分超過時: 分析結果を記録して実装は次回
```

#### **実装フェーズ (最大30分/ステップ)**
```
1. 最小単位に分割 (各15分以内)
2. 実装 → テスト → コミット
3. 15分経過でコミット可能な状態にする
→ 30分超過時: 現状をコミットして残りは次ステップ
```

#### **テストフェーズ (最大5分)**
```
1. ユニットテスト実行 (2分)
2. 型チェック (1分)
3. ビルド確認 (2分)
→ 5分超過時: バックグラウンド実行 + 次タスク開始
```

---

## 🔀 タスク切り替え基準

### 切り替えシグナル

#### 🚨 即座に切り替え
- ユーザーが明示的に中断した
- 必要な情報が不足している
- 外部依存（API、ツール）が応答しない

#### ⚠️ 計画的に切り替え
- 15分で完了見込みなし
- 複数の前提条件が未解決
- テスト実行が長時間（5分以上）

#### ✅ 継続してOK
- 5分以内に完了見込み
- 現在の作業が80%以上完了
- 直前のコミットから10分以内

---

## 📦 段階的コミット戦略

### コミットタイミング
1. **15分ごと**: 動作する最小単位でコミット
2. **ステップ完了時**: タグ付きコミット
3. **中断時**: 進捗状況を記録してコミット

### コミットメッセージフォーマット
```
[進捗率%] タスク名: 完了内容

【完了】
- 項目1
- 項目2

【残作業】
- 項目3（見積: X分）
- 項目4（見積: Y分）

【次回開始時】
具体的な再開手順
```

---

## 🎮 実装ガイドライン

### 大規模タスクの分割例

#### ❌ 悪い例（分割なし）
```
タスク: progressStorage.ts (3607行) を分割
見積: 5.5時間
→ 長すぎる！ユーザーが待機できない
```

#### ✅ 良い例（段階的実施）
```
Step 1: 型定義分離 (15分)
  → 即座にコミット
Step 2: Core抽出 (20分)
  → テスト → コミット
Step 3: Statistics抽出 (20分)
  → テスト → コミット
...各ステップを独立して完了可能
```

---

## 🔍 モニタリング指標

### 効率性チェックリスト
- [ ] 各作業ステップが15分以内
- [ ] 15分ごとにコミット可能な状態
- [ ] ユーザー待機時間が2分以内
- [ ] テスト実行が5分以内
- [ ] 連続失敗が3回未満

### 警告サイン
- ⚠️ 同じファイルを30分以上編集
- ⚠️ コミットなしで1時間経過
- ⚠️ ツールエラーが3回連続
- ⚠️ ユーザーが作業を中断

---

## 📊 代替タスクバンク

### 長時間タスクの代替候補

#### 大規模リファクタリング中断時
→ 代替: ドキュメント整備、小規模バグ修正、型エラー修正

#### テスト実行待機時
→ 代替: README更新、コメント追加、コード整形

#### 外部依存待機時
→ 代替: ローカルで完結するタスク、設計文書作成

---

## 🎯 実装テンプレート

### 開始時チェック
```typescript
// 1. タスク時間見積もり
const estimatedTime = "15分";

// 2. 制限時間チェック
if (estimatedTime > "15分") {
  // タスクを分割
  subTasks = splitTask(task);
}

// 3. 並行可能タスクの確認
const parallelTasks = findParallelTasks();
```

### 実装中モニタリング
```typescript
// 15分経過チェック
if (elapsedTime > 15分 && !isCommittable()) {
  // 中断ポイント記録
  recordProgress();
  // 代替タスク提案
  suggestAlternativeTasks();
}
```

### 中断時の対応
```typescript
// 1. 現在の状態を記録
saveProgressStatus();

// 2. 次回の開始手順を記述
writeRestartInstructions();

// 3. 代替タスクを提案
suggestNextTasks();
```

---

## 🚀 適用ルール

### Copilotの動作ルール

1. **作業開始時**
   - タスクを15分単位に分割
   - 各ステップの成功条件を明確化

2. **実装中**
   - 15分経過前にコミット可能な状態を作る
   - ツールエラー3回で別アプローチ検討

3. **ユーザー待機発生時**
   - 2分以上 → 進捗記録 + 代替タスク提案
   - 5分以上 → 強制的に中断 + 次回手順記録

4. **中断時**
   - 必ず進捗状況をドキュメント化
   - 次回開始時の具体的手順を記載
   - git commitで状態を保存

---

## 📝 適用例

### 例1: progressStorage.ts分割
```
❌ 従来: 5.5時間の大規模タスク
   → ユーザー中断

✅ 改善: 6ステップ × 15分 = 1.5時間
   Step 1 (15分) → コミット
   Step 2 (15分) → コミット
   ...
   ユーザーはいつでも中断・再開可能
```

### 例2: テスト実行が長時間
```
❌ 従来: テスト完了まで待機（5分）
   → 無駄な待機時間

✅ 改善: テスト実行中に別タスク実施
   - ドキュメント更新
   - コード整形
   - 次ステップの計画
```

---

## ✅ 成功指標

- **平均コミット間隔**: 15分以内
- **ユーザー待機時間**: 2分以内
- **タスク完了率**: 80%以上
- **中断後の再開成功率**: 95%以上

---

**最終更新**: 2025-12-15  
**適用開始**: 即座  
**レビュー頻度**: 月次

---

## 📊 作業履歴

### 2025-12-15: ドキュメント整理・ルートファイル整理

**タスク**: docs/直下31ファイル + ルート直下9ファイルの整理

**実施内容**:
- ✅ docs/配下を6カテゴリに整理 (processes, design, features, maintenance, plans, reports)
- ✅ ルート直下ファイルをdocs/design, docs/reports, tools/demos, tools/dataに移動
- ✅ 参照リンク更新 (19ファイル、30箇所以上)
- ✅ 自動生成JSON出力先をtools/data/に統一

**コミット状態**: 38ファイルrenameステージング済み（未コミット）

**次回作業**: 
1. git commit -m "docs: Reorganize 40 files into categories"
2. レポート2件を確認 (DOCS_REORGANIZATION_2025-12-15.md, ROOT_FILES_CLEANUP_2025-12-15.md)
3. CI/CDワークフローの動作確認

**反省点**:
- ⚠️ 段階的コミットを実施せず、一括で38ファイルをステージング
- ⚠️ 作業中に本ファイルへの記録を怠った
- ⚠️ タスク完了後に即座に報告せず、追加作業を探してしまった
