# クロスプラットフォーム開発ガイドライン

## 基本原則

### プラットフォーム統一性の原則

**全てのプラットフォームバージョンに対する指示の解釈:**

ユーザーが以下のいずれかのプラットフォームに言及した場合、**全てのプラットフォーム**に対する指示として解釈すること:

- モバイル版
- デスクトップ版
- Windows版
- Mac版
- その他のプラットフォーム版

### 実装要件

1. **機能の完全な互換性**
   - 全てのプラットフォームで同一の機能を提供すること
   - 機能の追加・変更は全プラットフォームに同時適用すること
   - プラットフォーム固有の機能分岐は原則禁止

1. **データの完全な互換性**
   - LocalStorageのデータ構造は全プラットフォームで統一
   - 設定値、学習進捗、統計データは全て共通仕様
   - プラットフォーム間でのデータ移行が透過的に行われること

1. **UI/UXの一貫性**
   - ユーザー体験は全プラットフォームで一貫していること
   - 操作フローは同一であること
   - 設定項目、メニュー構成は統一されていること

## モバイル版の例外処理

### 例外が許容される条件

モバイル版のみ異なる実装が許容されるのは、以下の条件を**全て満たす場合のみ**:

1. **表示制約による必然性**
   - 画面サイズ、タッチインターフェース等の物理的制約
   - デスクトップ版と同じレイアウトでは機能性が著しく損なわれる場合

1. **機能的同等性の保証**
   - 見た目は異なっても、提供される機能は完全に同一
   - ユーザーが達成できるタスクに差異がないこと

1. **ユーザビリティの向上**
   - 例外実装により、モバイルでのユーザビリティが向上すること
   - デスクトップ版のユーザビリティを損なわないこと

### モバイル例外実装の実例

#### 許容される例外

```css
/* タブ表示: アイコン+ラベル（モバイル）vs アイコンのみ（デスクトップ） */
@media (max-width: 768px) {
  .score-board-tabs-mobile {
    flex-direction: column;
  }
  .tab-label {
    display: block; /* モバイルではラベル表示 */
  }
}

/* デスクトップではアイコンのみで十分な幅を確保できる */
.tab-label {
  display: none; /* デフォルトは非表示 */
}
```

**理由**: 画面幅の制約により、モバイルではラベルが必要。機能は同一（タブ切り替え）。

#### 許容されない例外

```typescript
// ❌ 不可: モバイルだけ機能を削除
if (isMobile) {
  // 統計タブを非表示
  tabs = tabs.filter(tab => tab.id !== 'stats');
}

// ❌ 不可: モバイルだけ設定項目を減らす
if (isMobile) {
  return <SimplifiedSettings />;
}

// ❌ 不可: モバイルだけデータ保存しない
if (!isMobile) {
  saveProgress(data);
}
```

## 実装チェックリスト

### 新機能追加時

- [ ] 全プラットフォームで同じ機能が動作する
- [ ] モバイル固有の実装は表示最適化のみ
- [ ] データ構造に差異がない
- [ ] 設定値の保存・読み込みが統一されている
- [ ] TypeScriptの型定義が共通

### UI変更時

- [ ] レスポンシブデザインで対応可能か検証
- [ ] モバイル例外が必要な場合、機能的同等性を確認
- [ ] CSSメディアクエリで実装（JSでの分岐を避ける）
- [ ] タッチ操作とマウス操作の両方をサポート

### データ処理変更時

- [ ] LocalStorage関数は全プラットフォーム共通
- [ ] 計算ロジックにプラットフォーム分岐がない
- [ ] エクスポート/インポート機能が統一されている

## コードレビュー基準

### 禁止パターン

```typescript
// ❌ プラットフォーム別の機能分岐
if (platform === 'mobile') {
  return <MobileOnlyFeature />;
}

// ❌ プラットフォーム別のデータ構造
const storageKey = isMobile ? 'mobile-progress' : 'desktop-progress';

// ❌ プラットフォーム別の計算ロジック
const score = isMobile ? calculateMobileScore() : calculateDesktopScore();
```

### 推奨パターン

```typescript
// ✅ レスポンシブCSS
<div className={`score-board-tabs ${isMobile ? 'score-board-tabs-mobile' : ''}`}>

// ✅ 共通のデータ構造
const storageKey = 'user-progress'; // 全プラットフォーム共通

// ✅ 共通の計算ロジック
const score = calculateScore(answers); // プラットフォーム非依存
```

## テスト要件

### クロスプラットフォームテスト

新機能実装後、以下の確認を必須とする:

1. **デスクトップブラウザ**
   - Chrome (Windows/Mac)
   - Firefox (Windows/Mac)
   - Safari (Mac)
   - Edge (Windows)

1. **モバイルブラウザ**
   - Safari (iOS)
   - Chrome (Android)

1. **確認項目**
   - 全ての機能が動作すること
   - データが正しく保存・読み込みされること
   - UI要素が適切に表示されること
   - 操作フローが一貫していること

## エスカレーション

### 例外判断が必要な場合

以下の場合は、実装前に設計レビューを実施:

- モバイル版で機能制限が必要と思われる場合
- プラットフォーム別のデータ構造が必要と思われる場合
- レスポンシブCSSだけでは対応困難な場合

**判断基準**: 「この違いはユーザーに本当に必要か？」を問い続ける

## まとめ

**原則**: 1つのコードベース、全てのプラットフォーム

**例外**: 表示最適化のみ、機能は完全統一

**テスト**: 全プラットフォームで動作確認必須

---

*最終更新: 2025年11月29日*
