# AWS移行ガイド - 静的ホスティングから動的Webアプリへ

---

## 目次

1. [移行の概要](#1-移行の概要)
1. [現在のアーキテクチャ vs AWS後のアーキテクチャ](#2-現在のアーキテクチャ-vs-aws後のアーキテクチャ)
1. [移行で追加される機能](#3-移行で追加される機能)
1. [技術スタック選定](#4-技術スタック選定)
1. [AWS構成パターン](#5-aws構成パターン)
1. [コスト試算](#6-コスト試算)
1. [移行ステップ](#7-移行ステップ)
1. [開発スケジュール](#8-開発スケジュール)
1. [リスクと対策](#9-リスクと対策)
1. [移行後の運用](#10-移行後の運用)

---

## 1. 移行の概要

### なぜAWSに移行するのか？

**現在の制限（静的ホスティング）:**
- ユーザー間でデータを共有できない
- 複数デバイスでの学習履歴同期不可
- 大規模なデータ分析（協調フィルタリング）不可
- サーバー側処理が必要な高度なAI機能が実装できない

**AWS移行で可能になること:**
- ✅ **複数デバイス同期**: スマホ・PC・タブレットで学習履歴共有
- ✅ **協調フィルタリングAI**: 類似学習者の成功パターンから推薦
- ✅ **クラウド保存**: ブラウザのデータ削除でも履歴が消えない
- ✅ **高度な分析**: ユーザー全体の統計・トレンド分析
- ✅ **将来の拡張**: B2B展開・教師用ダッシュボード・API提供

### 移行の必要性判断

| 状況 | 推奨 |
|------|------|
| 個人利用のみ | 移行不要（現状で十分） |
| 複数デバイスで使いたい | 移行推奨 |
| 10人以上のユーザーがいる | 移行推奨 |
| B2B展開を考えている | 移行必須 |
| 収益化を計画している | 移行必須 |

---

## 2. 現在のアーキテクチャ vs AWS後のアーキテクチャ

### 現在の構成（静的ホスティング）

```
┌─────────────────┐
│  GitHub Pages   │ 静的ファイル配信（無料）
└────────┬────────┘
         │ HTML/CSS/JS
         ↓
┌─────────────────┐
│ ユーザーのブラウザ │
│  - React実行    │
│  - LocalStorage │ データ保存（ブラウザ内のみ）
└─────────────────┘
```

**問題点:**
- LocalStorageは5-10MB制限
- ブラウザごとにデータが分離（Chrome/Safari/スマホで別々）
- キャッシュクリアでデータ消失リスク
- 他のユーザーのデータにアクセス不可

### AWS移行後の構成

```
┌──────────────┐
│ CloudFront   │ CDN（高速配信）
│ + S3         │ 静的ファイル（React）
└──────┬───────┘
       │
       ↓
┌──────────────┐      ┌──────────────┐
│  API Gateway │←────→│   Lambda     │ サーバーレス処理
│  (REST API)  │      │  or EC2/ECS  │
└──────┬───────┘      └──────┬───────┘
       │                     │
       ↓                     ↓
┌──────────────┐      ┌──────────────┐
│    Cognito   │      │     RDS      │ データベース
│  (ユーザー認証)│      │ (PostgreSQL) │
└──────────────┘      └──────────────┘
```

**メリット:**
- ✅ データが永続的に保存される
- ✅ 複数デバイスで自動同期
- ✅ 大量データの高速検索・分析
- ✅ ユーザー認証・セキュリティ強化
- ✅ スケーラビリティ（ユーザー数増加に対応）

---

## 3. 移行で追加される機能

### 3.1 基本機能（必須実装）

| 機能 | 説明 | 優先度 |
|------|------|--------|
| ユーザー認証 | メール/パスワードでログイン | 高 |
| 学習履歴同期 | 複数デバイスで履歴共有 | 高 |
| クラウドバックアップ | データ消失防止 | 高 |
| プロフィール管理 | ユーザー設定の保存 | 中 |

### 3.2 高度な機能（段階的実装）

| 機能 | 説明 | 技術要件 |
|------|------|----------|
| 協調フィルタリングAI | 類似学習者の推薦 | ML処理・大規模データ分析 |
| リアルタイム同期 | 複数デバイスで即座に反映 | WebSocket/Server-Sent Events |
| オフライン対応 | ネット接続なしでも学習可能 | Service Worker + 差分同期 |
| 教師用ダッシュボード | 生徒の進捗管理 | 権限管理・レポート生成 |
| API提供 | 外部サービス連携 | REST API + 認証 |

### 3.3 収益化機能

| 機能 | 説明 | 実装難易度 |
|------|------|-----------|
| サブスクリプション決済 | Stripe/PayPal連携 | 中 |
| プレミアム機能制限 | 無料/有料プラン分岐 | 低 |
| B2Bライセンス管理 | 組織単位での契約 | 高 |
| 使用量課金 | API呼び出し数による課金 | 中 |

---

## 4. 技術スタック選定

### 4.1 フロントエンド（現状維持）

- **React 18 + TypeScript**: 現在のコードベースを活用
- **Vite**: 高速ビルド
- **新規追加**: Axios/Fetch（API通信）、React Query（データ管理）

### 4.2 バックエンド選択肢

#### オプション1: サーバーレス（推奨）

```
API Gateway + Lambda (Node.js/Python) + RDS Aurora Serverless
```

**メリット:**
- ✅ 使った分だけ課金（低トラフィック時は安い）
- ✅ 自動スケーリング
- ✅ サーバー管理不要

**デメリット:**
- ❌ コールドスタート（初回応答が遅い）
- ❌ 複雑なデバッグ

**コスト:** 月 $10-50（小規模）

#### オプション2: コンテナ（中〜大規模向け）

```
ECS/Fargate + Express.js/FastAPI + RDS PostgreSQL
```

**メリット:**
- ✅ 安定したパフォーマンス
- ✅ ローカル開発と同じ環境
- ✅ 複雑なロジックに対応

**デメリット:**
- ❌ 常時稼働でコスト高
- ❌ スケーリング設定が必要

**コスト:** 月 $50-200

#### オプション3: EC2（フルコントロール）

```
EC2 (t3.micro/small) + Nginx + Node.js + PostgreSQL
```

**メリット:**
- ✅ 完全な制御
- ✅ 一番安い（無料枠あり）

**デメリット:**
- ❌ サーバー管理が必要（セキュリティパッチ等）
- ❌ 手動スケーリング

**コスト:** 月 $15-30

### 4.3 データベース選択肢

| DB | 用途 | コスト（月） |
|----|------|-------------|
| RDS PostgreSQL (t3.micro) | リレーショナルデータ | $15-25 |
| Aurora Serverless v2 | 自動スケーリング | $30-100 |
| DynamoDB | NoSQL・高速 | $5-20（使用量次第） |

**推奨:** 最初はRDS PostgreSQL（無料枠1年間）

### 4.4 認証

| 方式 | 説明 | コスト |
|------|------|--------|
| AWS Cognito | マネージド認証 | 無料枠5万ユーザー |
| 自前JWT | カスタム実装 | $0（開発コスト高） |

**推奨:** Cognito（簡単・セキュア）

---

## 5. AWS構成パターン

### 5.1 最小構成（月$20-40）

```
S3 + CloudFront → 静的ファイル配信
      ↓
API Gateway + Lambda → ビジネスロジック
      ↓
RDS t3.micro (PostgreSQL) → データ保存
      ↓
Cognito → ユーザー認証
```

**対象:** 個人〜100ユーザー

### 5.2 中規模構成（月$100-300）

```
Route 53 (独自ドメイン)
      ↓
CloudFront + S3 → 静的配信
      ↓
ALB → ロードバランサー
      ↓
ECS Fargate (2台) → アプリサーバー
      ↓
RDS Multi-AZ → データベース（冗長化）
      ↓
ElastiCache Redis → キャッシュ
```

**対象:** 100〜10,000ユーザー

### 5.3 大規模構成（月$500-2000）

```
+ Auto Scaling → 自動スケーリング
+ CloudWatch → 監視・アラート
+ S3 Glacier → データアーカイブ
+ SageMaker → ML推論（協調フィルタリング）
```

**対象:** 10,000ユーザー以上・B2B展開

---

## 6. コスト試算

### 6.1 初期構成（最小）

| サービス | 内容 | 月額（USD） |
|---------|------|------------|
| S3 + CloudFront | 静的ファイル | $1-5 |
| API Gateway | 100万リクエスト | $3.50 |
| Lambda | 100万実行（1GB/s） | $0.20 |
| RDS t3.micro | PostgreSQL | $15 |
| Cognito | 5万ユーザーまで | $0 |
| Route 53 | ドメイン管理 | $0.50 |
| **合計** | | **$20-25** |

**無料枠（1年間）:** RDS・EC2・Lambda等で初年度は$5-10/月も可能

### 6.2 中規模構成

| サービス | 内容 | 月額（USD） |
|---------|------|------------|
| CloudFront + S3 | | $10-20 |
| ECS Fargate (2台) | 0.5vCPU/1GB | $30-50 |
| RDS db.t3.small Multi-AZ | | $60-80 |
| ElastiCache | cache.t3.micro | $15 |
| その他 | 監視・ログ | $10 |
| **合計** | | **$125-175** |

### 6.3 収益化との比較

**損益分岐点:**
- 月$25コスト → 月額500円×50ユーザーで収支プラス
- 月$150コスト → 月額500円×300ユーザー または B2B 1-2契約

---

## 7. 移行ステップ

### Phase 1: 設計・準備（1-2週間）

**タスク:**
1. ✅ API設計（エンドポイント一覧作成）
1. ✅ データベーススキーマ設計
1. ✅ 認証フロー設計
1. ✅ AWSアカウント作成・初期設定

**成果物:**
- API仕様書（Swagger/OpenAPI）
- ER図（データベース設計）
- 認証フロー図

### Phase 2: バックエンド開発（2-3週間）

**タスク:**
1. ローカル開発環境構築（Docker）
1. APIエンドポイント実装
   - ユーザー登録/ログイン
   - 学習履歴CRUD
   - 統計データ取得
1. データベースマイグレーション
1. 認証ミドルウェア実装
1. ユニットテスト作成

**技術スタック例:**
```
Node.js + Express + TypeORM + PostgreSQL + JWT
または
Python + FastAPI + SQLAlchemy + PostgreSQL + JWT
```

### Phase 3: フロントエンド改修（1-2週間）

**タスク:**
1. ログイン/サインアップ画面作成
1. LocalStorage → API通信への移行
1. オフライン時のエラーハンドリング
1. データ同期ロジック実装

**変更ファイル:**
- `src/App.tsx`: ログイン状態管理
- `src/api/`: API通信レイヤー追加
- `src/hooks/useAuth.ts`: 認証フック
- `src/hooks/useSync.ts`: データ同期

### Phase 4: AWS環境構築（1週間）

**タスク（あなたがAWSコンソールで実施）:**
1. RDSインスタンス作成
1. Lambda関数デプロイ（Serverless Framework使用）
1. API Gateway設定
1. Cognito ユーザープール作成
1. S3 + CloudFront設定
1. 環境変数・シークレット管理（Secrets Manager）

**私が提供するもの:**
- 手順書（スクリーンショット付き）
- Terraformコード（Infrastructure as Code）
- デプロイスクリプト

### Phase 5: データ移行（1週間）

**タスク:**
1. LocalStorageデータのエクスポート機能作成
1. 既存ユーザーのアカウント作成
1. 履歴データのインポート
1. データ整合性チェック

**移行ツール例:**
```typescript
// LocalStorageからJSON出力
const exportData = () => {
  const data = {
    history: JSON.parse(localStorage.getItem('history')),
    settings: JSON.parse(localStorage.getItem('settings')),
    // ...
  };
  return data;
};

// APIにインポート
await fetch('/api/import', {
  method: 'POST',
  body: JSON.stringify(exportData())
});
```

### Phase 6: テスト・デバッグ（1-2週間）

**テスト項目:**
- [ ] ユーザー登録・ログイン
- [ ] 学習履歴の保存・取得
- [ ] 複数デバイス同期
- [ ] パフォーマンステスト（100並行リクエスト）
- [ ] セキュリティテスト（SQL injection等）
- [ ] モバイル対応確認

### Phase 7: 本番リリース（1週間）

**タスク:**
1. 段階的ロールアウト（10% → 50% → 100%）
1. モニタリング設定（CloudWatch）
1. エラー監視（Sentry等）
1. ユーザーサポート体制

---

## 8. 開発スケジュール

### 8.1 最短パターン（6-8週間）

```
Week 1-2:  設計・準備
Week 3-5:  バックエンド開発
Week 6-7:  フロントエンド改修
Week 8:    AWS構築・デプロイ
Week 9-10: テスト・調整
Week 11:   本番リリース
```

### 8.2 段階的パターン（3-6ヶ月）

```
Month 1: 基本機能（認証・同期）
Month 2: データ移行・テスト
Month 3: 協調フィルタリングAI
Month 4: 収益化機能
Month 5: B2B機能
Month 6: 最適化・スケーリング
```

### 8.3 開発リソース

**1人フルタイムの場合:**
- 設計: 40時間
- バックエンド: 80時間
- フロントエンド: 40時間
- AWS構築: 20時間
- テスト: 40時間
- **合計: 220時間（約6週間）**

**パートタイムの場合:**
- 週10時間 → 22週間（5.5ヶ月）
- 週20時間 → 11週間（2.75ヶ月）

---

## 9. リスクと対策

### 9.1 技術リスク

| リスク | 影響 | 対策 |
|--------|------|------|
| API設計ミス | 後で変更困難 | 事前にOpenAPI仕様書作成 |
| データ移行失敗 | ユーザーデータ消失 | バックアップ・ロールバック計画 |
| パフォーマンス劣化 | UX低下 | ローディング状態・キャッシュ戦略 |
| セキュリティ脆弱性 | 情報漏洩 | OWASP Top 10対策・定期監査 |

### 9.2 コストリスク

| リスク | 対策 |
|--------|------|
| 予想外のコスト増 | CloudWatch Budget Alarmで通知 |
| 無駄なリソース | 週次コストレビュー |
| スケーリング失敗 | Auto Scaling設定・負荷テスト |

### 9.3 運用リスク

| リスク | 対策 |
|--------|------|
| サーバーダウン | Multi-AZ構成・ヘルスチェック |
| データ消失 | 自動バックアップ（日次・週次） |
| 不正アクセス | WAF・レート制限・監査ログ |

---

## 10. 移行後の運用

### 10.1 日次運用

- ✅ エラーログ確認（CloudWatch Logs）
- ✅ パフォーマンスメトリクス監視
- ✅ コスト確認

### 10.2 週次運用

- ✅ データベースバックアップ確認
- ✅ セキュリティパッチ適用
- ✅ ユーザーフィードバック確認

### 10.3 月次運用

- ✅ コストレビュー・最適化
- ✅ パフォーマンスチューニング
- ✅ 機能改善・追加

### 10.4 監視アラート設定

```yaml
アラート:
  - エラー率 > 5%
  - レスポンス時間 > 3秒
  - CPU使用率 > 80%
  - ディスク使用率 > 90%
  - 月間コスト > $200
```

---

## まとめ

### 移行すべきタイミング

**今すぐ移行すべき:**
- ✅ 複数デバイスで使いたい
- ✅ 10人以上のユーザーがいる
- ✅ 収益化を計画している

**まだ不要:**
- ❌ 個人利用のみ
- ❌ ユーザー数が少ない（5人未満）
- ❌ 静的ホスティングで満足

### 推奨アプローチ

1. **まずゲーミフィケーションAIを実装**（無料・すぐできる）
1. **ユーザー数が20人を超えたらAWS移行検討**
1. **段階的移行**（いきなり全機能ではなく、認証・同期から）
1. **コスト監視しながら拡張**

### 次のステップ

移行を進める場合:
1. [ ] AWSアカウント作成（無料枠利用）
1. [ ] API設計開始（一緒に仕様書作成）
1. [ ] ローカル開発環境構築

質問・相談があればいつでもどうぞ！
