# å®Œå…¨å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— - 90ç‚¹ä»¥ä¸Šã‚’ç›®æŒ‡ã™å®Ÿè£…è¨ˆç”»

**ä½œæˆæ—¥**: 2025å¹´12æœˆ23æ—¥  
**ç›®æ¨™**: äººé–“ã®ã‚ˆã†ã«ç”Ÿå¾’ã«å¯„ã‚Šæ·»ã„ã€è¨˜æ†¶ã®è¶…å®šç€ã‚’ä¿ƒã™å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ   
**ç›®æ¨™ã‚¹ã‚³ã‚¢**: 90ç‚¹ä»¥ä¸Š / 100ç‚¹

---

## ğŸ“Š ç¾çŠ¶åˆ†æã¨ç›®æ¨™è¨­å®š

### ç¾åœ¨ã®ã‚¹ã‚³ã‚¢: 72ç‚¹ / 100ç‚¹

| è¦³ç‚¹ | ç¾çŠ¶ | ç›®æ¨™ | Gap |
|------|------|------|-----|
| **é©å¿œçš„å­¦ç¿’** | 80% | 95% | +15% |
| **Spaced Repetition** | 60% | 95% | +35% âš ï¸æœ€å„ªå…ˆ |
| **å€‹åˆ¥åŒ–** | 75% | 90% | +15% |
| **äººé–“ã‚‰ã—ã•** | 65% | 90% | +25% âš ï¸é‡è¦ |
| **è¨˜æ†¶ã®è¶…å®šç€** | 60% | 95% | +35% âš ï¸æœ€å„ªå…ˆ |
| **ç·åˆç›®æ¨™** | 72% | **93%** | +21% |

### é‡ç‚¹æ”¹å–„ã‚¨ãƒªã‚¢
1. ğŸ”´ **è¨˜æ†¶ç§‘å­¦ã®çµ±åˆ** - SM-2, Ebbinghausæ›²ç·šï¼ˆ+35%ï¼‰
2. ğŸŸ¡ **æ„Ÿæƒ…çš„ã‚µãƒãƒ¼ãƒˆ** - äººé–“ã‚‰ã—ã„å¯¾è©±ãƒ»åŠ±ã¾ã—ï¼ˆ+25%ï¼‰
3. ğŸŸ¢ **å¤šæ§˜ãªå¾©ç¿’æ–¹æ³•** - æ–‡è„ˆå¤‰æ›´ã€æ®µéšçš„æŒ‡å°ï¼ˆ+15%ï¼‰

---

## ğŸ—ºï¸ å…¨ä½“ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ï¼ˆ6ãƒ•ã‚§ãƒ¼ã‚ºï¼‰

```
Phase 1: ConstantsæŠ½å‡º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2.5æ™‚é–“
         [åŸºç›¤æ•´ç†]

Phase 2: Strategy Patternå°å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12æ™‚é–“
         [Positionè¨ˆç®—ã®æ•´ç†]

Phase 3: AIçµ±åˆãƒ¬ã‚¤ãƒ¤ãƒ¼å¼·åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 8æ™‚é–“
         [æ—¢å­˜AIæ©Ÿèƒ½ã®çµ±åˆ]

Phase 4: è¨˜æ†¶ç§‘å­¦çµ±åˆ â˜…æœ€é‡è¦â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 18æ™‚é–“
         [SM-2, Ebbinghaus, é•·æœŸè¨˜æ†¶æˆ¦ç•¥]

Phase 5: æ„Ÿæƒ…çš„ã‚µãƒãƒ¼ãƒˆ â˜…é‡è¦â˜… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12æ™‚é–“
         [EmotionalAI, åŠ±ã¾ã—, Scaffolding]

Phase 6: å¤šæ§˜ãªå¾©ç¿’æ–¹æ³• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10æ™‚é–“
         [æ–‡è„ˆå¤‰æ›´, å¤šæ§˜ãªãƒ†ã‚¹ãƒˆå½¢å¼]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åˆè¨ˆ: 62.5æ™‚é–“ï¼ˆç´„8æ—¥é–“ï¼‰
```

---

## ğŸ“‹ Phase 1: ConstantsæŠ½å‡ºã€2.5æ™‚é–“ã€‘

**ç›®çš„**: Magic numberså‰Šæ¸›ã€æ„å‘³ã®æ˜ç¢ºåŒ–  
**å„ªå…ˆåº¦**: ğŸŸ¢ é«˜ï¼ˆå³åº§ã«å®Ÿè¡Œå¯èƒ½ï¼‰  
**ãƒªã‚¹ã‚¯**: ä½

### å·¥ç¨‹1-1: Constantså®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã€1æ™‚é–“ã€‘
```typescript
// src/ai/utils/positionConstants.ts
export const POSITION_RANGES = {
  MASTERED: { min: 0, max: 20, default: 10 },
  NEW: { min: 20, max: 40, default: 35 },
  STILL_LEARNING: { min: 40, max: 70, default: 50 },
  INCORRECT: { min: 70, max: 100, default: 85 }
} as const;

export const CONSECUTIVE_THRESHOLDS = {
  MASTERED: 3,
  LEARNING: 2,
  STRUGGLING: 1,
  INCORRECT: 3
} as const;

export const ACCURACY_THRESHOLDS = {
  EXCELLENT: 0.9,
  GOOD: 0.8,
  FAIR: 0.6,
  POOR: 0.5
} as const;

export const BOOST_VALUES = {
  STILL_LEARNING_MAX: 15,
  STILL_LEARNING_MULTIPLIER: 5,
  TIME_DECAY_MAX: 15,
  TIME_DECAY_MULTIPLIER: 1.5
} as const;

export const GAMIFICATION_THRESHOLDS = {
  NEW_MIN: 40,
  NEW_MAX: 59,
  STILL_MIN: 60,
  STILL_MAX: 69
} as const;
```

### å·¥ç¨‹1-2: categoryDetermination.ts ã¸ã®é©ç”¨ã€1æ™‚é–“ã€‘
- ç´„20ç®‡æ‰€ã®Magic numbersç½®æ›
- æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®å‹•ä½œä¿è¨¼

### å·¥ç¨‹1-3: ãƒ†ã‚¹ãƒˆæ›´æ–°ã€30åˆ†ã€‘
- Constantsä½¿ç”¨ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 
- æ—¢å­˜ãƒ†ã‚¹ãƒˆå…¨ã¦ãƒ‘ã‚¹ç¢ºèª

**Phase 1 å®Œäº†åŸºæº–**:
- âœ… Magic numbers 0å€‹
- âœ… æ—¢å­˜ãƒ†ã‚¹ãƒˆå…¨ã¦ãƒ‘ã‚¹
- âœ… å‹ã‚¨ãƒ©ãƒ¼ãªã—

---

## ğŸ“‹ Phase 2: Strategy Patternå°å…¥ã€12æ™‚é–“ã€‘

**ç›®çš„**: 171è¡Œã®if-elseãƒã‚§ãƒ¼ãƒ³ã‚’Strategyã‚¯ãƒ©ã‚¹ã«åˆ†é›¢  
**å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­ï¼ˆæ¬¡å›ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼‰  
**ãƒªã‚¹ã‚¯**: ä¸­

### å·¥ç¨‹2-1: Strategyã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã€1æ™‚é–“ã€‘
```typescript
// src/ai/utils/positionStrategies/types.ts
export interface PositionStrategy {
  readonly name: string;
  readonly priority: number;
  canApply(progress: WordProgress, mode: LearningMode): boolean;
  calculate(progress: WordProgress, mode: LearningMode): number;
}
```

### å·¥ç¨‹2-2: å„Strategyå®Ÿè£…ã€4æ™‚é–“ã€‘
- ConsecutiveCorrectStrategyï¼ˆ1æ™‚é–“ï¼‰
- ConsecutiveIncorrectStrategyï¼ˆ45åˆ†ï¼‰
- StillLearningStrategyï¼ˆ45åˆ†ï¼‰
- NewWordStrategyï¼ˆ30åˆ†ï¼‰
- DefaultStrategyï¼ˆ1æ™‚é–“ï¼‰

### å·¥ç¨‹2-3: PositionCalculatorå®Ÿè£…ã€2æ™‚é–“ã€‘
- Strategyé¸æŠãƒ­ã‚¸ãƒƒã‚¯
- å„ªå…ˆåº¦é †ã‚½ãƒ¼ãƒˆ
- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°

### å·¥ç¨‹2-4: categoryDetermination.ts ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã€1æ™‚é–“ã€‘
- PositionCalculatorä½¿ç”¨ã«å¤‰æ›´
- æ—¢å­˜APIç¶­æŒ

### å·¥ç¨‹2-5: ãƒ†ã‚¹ãƒˆä½œæˆã€3æ™‚é–“ã€‘
- å„Strategyå˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆ50ã‚±ãƒ¼ã‚¹ï¼‰
- PositionCalculatorçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ30ã‚±ãƒ¼ã‚¹ï¼‰
- å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆï¼ˆ20ã‚±ãƒ¼ã‚¹ï¼‰

### å·¥ç¨‹2-6: æ—¢å­˜ãƒ†ã‚¹ãƒˆæ¤œè¨¼ã€1æ™‚é–“ã€‘
- å…¨ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹ç¢ºèª
- ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

**Phase 2 å®Œäº†åŸºæº–**:
- âœ… 5ã¤ã®Strategyã‚¯ãƒ©ã‚¹å®Ÿè£…
- âœ… 100+ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å…¨ã¦ãƒ‘ã‚¹
- âœ… if-else ãƒã‚§ãƒ¼ãƒ³å‰Šæ¸›

---

## ğŸ“‹ Phase 3: AIçµ±åˆãƒ¬ã‚¤ãƒ¤ãƒ¼å¼·åŒ–ã€8æ™‚é–“ã€‘

**ç›®çš„**: Specialist AIã®ææ¡ˆã‚’çµ±åˆçš„ã«é©ç”¨  
**å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­  
**ãƒªã‚¹ã‚¯**: ä¸­

### å·¥ç¨‹3-1: AIèª¿æ•´ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã€1æ™‚é–“ã€‘
```typescript
export interface PositionAdjustment {
  source: string;
  delta: number; // -10 ~ +10
  reason: string;
  confidence: number; // 0-1
}

export interface AdjustedPositionResult {
  basePosition: number;
  adjustments: PositionAdjustment[];
  finalPosition: number;
  appliedAIs: string[];
}
```

### å·¥ç¨‹3-2: PositionCalculatoræ‹¡å¼µã€2æ™‚é–“ã€‘
```typescript
async calculateWithAI(
  progress: WordProgress,
  mode: LearningMode,
  sessionContext: ScheduleContext
): Promise<AdjustedPositionResult> {
  const basePosition = this.calculatePosition(progress, mode);
  const adjustments = await this.collectAIAdjustments(sessionContext);
  const finalPosition = this.applyAdjustments(basePosition, adjustments);
  
  return { basePosition, adjustments, finalPosition };
}
```

### å·¥ç¨‹3-3: 7ã¤ã®Specialist AIçµ±åˆã€3æ™‚é–“ã€‘
- GamificationAIçµ±åˆï¼ˆ30åˆ†ï¼‰
- MemoryAIçµ±åˆï¼ˆ30åˆ†ï¼‰
- CognitiveLoadAIçµ±åˆï¼ˆ30åˆ†ï¼‰
- ErrorPredictionAIçµ±åˆï¼ˆ30åˆ†ï¼‰
- LinguisticAIçµ±åˆï¼ˆ30åˆ†ï¼‰
- ContextualAIçµ±åˆï¼ˆ30åˆ†ï¼‰
- LearningStyleAIçµ±åˆï¼ˆ30åˆ†ï¼‰

### å·¥ç¨‹3-4: QuestionScheduleræ›´æ–°ã€1æ™‚é–“ã€‘
- calculateWithAIä½¿ç”¨ã«å¤‰æ›´
- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã«èª¿æ•´çµæœè¡¨ç¤º

### å·¥ç¨‹3-5: ãƒ†ã‚¹ãƒˆä½œæˆã€1æ™‚é–“ã€‘
- AIçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ20ã‚±ãƒ¼ã‚¹ï¼‰
- èª¿æ•´å€¤ã®å¦¥å½“æ€§æ¤œè¨¼

**Phase 3 å®Œäº†åŸºæº–**:
- âœ… 7ã¤ã®AIçµ±åˆå®Œäº†
- âœ… Positionèª¿æ•´ã®é€æ˜æ€§å‘ä¸Š
- âœ… ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã«è©³ç´°è¡¨ç¤º

---

## ğŸ“‹ Phase 4: è¨˜æ†¶ç§‘å­¦çµ±åˆ â˜…æœ€é‡è¦â˜…ã€18æ™‚é–“ã€‘

**ç›®çš„**: SM-2, Ebbinghausæ›²ç·šã€é•·æœŸè¨˜æ†¶æˆ¦ç•¥ã®çµ±åˆ  
**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜ï¼ˆ+35%ã‚¹ã‚³ã‚¢å‘ä¸Šï¼‰  
**ãƒªã‚¹ã‚¯**: é«˜ï¼ˆæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å½±éŸ¿å¤§ï¼‰

### å·¥ç¨‹4-1: SM-2 Algorithmå®Ÿè£…ã€3æ™‚é–“ã€‘

```typescript
// src/ai/specialists/memory/SM2Algorithm.ts
export class SM2Algorithm {
  /**
   * SuperMemo SM-2ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®Ÿè£…
   * å‚è€ƒ: https://www.supermemo.com/en/archives1990-2015/english/ol/sm2
   */
  
  calculateNextReview(
    quality: 0 | 1 | 2 | 3 | 4 | 5, // 0=å®Œå…¨å¤±æ•—, 5=å®Œç’§
    easeFactor: number,              // é›£æ˜“åº¦ä¿‚æ•°ï¼ˆåˆæœŸå€¤2.5ï¼‰
    interval: number,                // å‰å›ã®é–“éš”ï¼ˆæ—¥æ•°ï¼‰
    repetitions: number              // é€£ç¶šæ­£è§£å›æ•°
  ): SM2Result {
    // 1. EaseFactoræ›´æ–°
    let newEF = easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
    if (newEF < 1.3) newEF = 1.3; // ä¸‹é™
    
    // 2. é€£ç¶šæ­£è§£å›æ•°æ›´æ–°
    let newReps = repetitions;
    if (quality < 3) {
      newReps = 0; // ãƒªã‚»ãƒƒãƒˆ
    } else {
      newReps++;
    }
    
    // 3. æ¬¡å›ã®é–“éš”è¨ˆç®—
    let newInterval: number;
    if (quality < 3) {
      newInterval = 1; // 1æ—¥å¾Œ
    } else if (newReps === 1) {
      newInterval = 1;
    } else if (newReps === 2) {
      newInterval = 6;
    } else {
      newInterval = Math.round(interval * newEF);
    }
    
    return {
      nextInterval: newInterval,
      easeFactor: newEF,
      repetitions: newReps,
      nextReviewDate: new Date(Date.now() + newInterval * 24 * 60 * 60 * 1000)
    };
  }
  
  /**
   * ç¾åœ¨ã®æ­£ç­”çŠ¶æ³ã‹ã‚‰Qualityå€¤ã‚’ç®—å‡º
   */
  determineQuality(
    isCorrect: boolean,
    responseTime: number, // ãƒŸãƒªç§’
    hesitation: boolean,
    attempts: number
  ): 0 | 1 | 2 | 3 | 4 | 5 {
    if (!isCorrect) {
      return attempts > 2 ? 0 : 1; // å®Œå…¨å¤±æ•— or å¤±æ•—
    }
    
    // æ­£è§£ã®å ´åˆ
    if (responseTime < 3000 && !hesitation) {
      return 5; // å®Œç’§ï¼ˆ3ç§’ä»¥å†…ã€è¿·ã„ãªã—ï¼‰
    }
    if (responseTime < 5000 && !hesitation) {
      return 4; // è¿·ã„ãªãæ­£è§£
    }
    if (responseTime < 10000) {
      return 3; // å°‘ã—è€ƒãˆã¦æ­£è§£
    }
    return 2; // é•·è€ƒã—ã¦æ­£è§£
  }
}

interface SM2Result {
  nextInterval: number;      // æ—¥æ•°
  easeFactor: number;        // é›£æ˜“åº¦ä¿‚æ•°
  repetitions: number;       // é€£ç¶šæ­£è§£å›æ•°
  nextReviewDate: Date;      // æ¬¡å›å¾©ç¿’æ—¥æ™‚
}
```

### å·¥ç¨‹4-2: Ebbinghauså¿˜å´æ›²ç·šãƒ¢ãƒ‡ãƒ«ã€2æ™‚é–“ã€‘

```typescript
// src/ai/specialists/memory/ForgettingCurveModel.ts
export class ForgettingCurveModel {
  /**
   * Ebbinghauså¿˜å´æ›²ç·šã®å®Ÿè£…
   * R(t) = e^(-t/S)
   * R = è¨˜æ†¶ä¿æŒç‡, t = çµŒéæ™‚é–“, S = è¨˜æ†¶å¼·åº¦
   */
  
  calculateRetention(
    daysSinceLastReview: number,
    memoryStrength: number // 1-10ï¼ˆ10ãŒæœ€å¼·ï¼‰
  ): number {
    const decayRate = 1 / memoryStrength;
    const retention = Math.exp(-daysSinceLastReview * decayRate);
    
    return Math.max(0, Math.min(1, retention)); // 0-1ã«æ­£è¦åŒ–
  }
  
  /**
   * è¨˜æ†¶å¼·åº¦ã®è¨ˆç®—ï¼ˆæ­£ç­”å±¥æ­´ã‹ã‚‰ï¼‰
   */
  calculateMemoryStrength(progress: WordProgress): number {
    const baseStrength = 1;
    
    // é€£ç¶šæ­£è§£ã§å¼·åº¦ä¸Šæ˜‡
    const consecutiveBonus = (progress.consecutiveCorrect || 0) * 1.5;
    
    // æ­£ç­”ç‡ã§èª¿æ•´
    const accuracyBonus = (progress.accuracy || 0) * 3;
    
    // è©¦è¡Œå›æ•°ã§å®‰å®šåŒ–
    const stabilityBonus = Math.min((progress.attempts || 0) * 0.2, 2);
    
    const totalStrength = baseStrength + consecutiveBonus + accuracyBonus + stabilityBonus;
    
    return Math.max(1, Math.min(10, totalStrength));
  }
  
  /**
   * æœ€é©ãªå¾©ç¿’ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ææ¡ˆ
   */
  suggestReviewTiming(
    currentRetention: number,
    targetRetention: number = 0.9 // ç›®æ¨™ä¿æŒç‡90%
  ): 'now' | 'soon' | 'scheduled' {
    if (currentRetention < targetRetention) {
      return 'now'; // ä»Šã™ãå¾©ç¿’
    }
    if (currentRetention < targetRetention + 0.05) {
      return 'soon'; // è¿‘æ—¥ä¸­ã«å¾©ç¿’
    }
    return 'scheduled'; // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é€šã‚Š
  }
}
```

### å·¥ç¨‹4-3: é•·æœŸè¨˜æ†¶ç§»è¡Œæˆ¦ç•¥ã€3æ™‚é–“ã€‘

```typescript
// src/ai/specialists/memory/LongTermMemoryStrategy.ts
export enum MemoryStage {
  WORKING_MEMORY = 'working',      // ä½œæ¥­è¨˜æ†¶ï¼ˆæ•°ç§’ï½æ•°åˆ†ï¼‰
  SHORT_TERM = 'short',            // çŸ­æœŸè¨˜æ†¶ï¼ˆæ•°åˆ†ï½æ•°æ—¥ï¼‰
  CONSOLIDATING = 'consolidating', // å›ºå®šåŒ–ä¸­ï¼ˆæ•°æ—¥ï½æ•°é€±é–“ï¼‰
  LONG_TERM = 'long'               // é•·æœŸè¨˜æ†¶ï¼ˆæ•°ãƒ¶æœˆï½æ°¸ç¶šï¼‰
}

export class LongTermMemoryStrategy {
  /**
   * ç¾åœ¨ã®è¨˜æ†¶æ®µéšã‚’åˆ¤å®š
   */
  determineMemoryStage(progress: WordProgress): MemoryStage {
    const daysSinceFirst = this.getDaysSinceFirstAttempt(progress);
    const consecutiveCorrect = progress.consecutiveCorrect || 0;
    const attempts = progress.attempts || 0;
    
    // é•·æœŸè¨˜æ†¶: 30æ—¥ä»¥ä¸ŠçµŒé & é€£ç¶šæ­£è§£3å›ä»¥ä¸Š & è©¦è¡Œ10å›ä»¥ä¸Š
    if (daysSinceFirst >= 30 && consecutiveCorrect >= 3 && attempts >= 10) {
      return MemoryStage.LONG_TERM;
    }
    
    // å›ºå®šåŒ–ä¸­: 7æ—¥ä»¥ä¸ŠçµŒé & é€£ç¶šæ­£è§£2å›ä»¥ä¸Š
    if (daysSinceFirst >= 7 && consecutiveCorrect >= 2) {
      return MemoryStage.CONSOLIDATING;
    }
    
    // çŸ­æœŸè¨˜æ†¶: 1æ—¥ä»¥ä¸ŠçµŒé & æ­£è§£çµŒé¨“ã‚ã‚Š
    if (daysSinceFirst >= 1 && progress.correct > 0) {
      return MemoryStage.SHORT_TERM;
    }
    
    // ä½œæ¥­è¨˜æ†¶: åˆå›ï½1æ—¥ä»¥å†…
    return MemoryStage.WORKING_MEMORY;
  }
  
  /**
   * å„æ®µéšã«é©ã—ãŸå¾©ç¿’é–“éš”ï¼ˆæ™‚é–“å˜ä½ï¼‰
   */
  getReviewIntervals(stage: MemoryStage): number[] {
    const intervals = {
      [MemoryStage.WORKING_MEMORY]: [
        1 / 1440,      // 1åˆ†å¾Œ
        10 / 1440,     // 10åˆ†å¾Œ
        1 / 24,        // 1æ™‚é–“å¾Œ
        0.5            // 12æ™‚é–“å¾Œ
      ],
      [MemoryStage.SHORT_TERM]: [
        1,   // 1æ—¥å¾Œ
        3,   // 3æ—¥å¾Œ
        7,   // 1é€±é–“å¾Œ
        14   // 2é€±é–“å¾Œ
      ],
      [MemoryStage.CONSOLIDATING]: [
        14,  // 2é€±é–“å¾Œ
        30,  // 1ãƒ¶æœˆå¾Œ
        60,  // 2ãƒ¶æœˆå¾Œ
        90   // 3ãƒ¶æœˆå¾Œ
      ],
      [MemoryStage.LONG_TERM]: [
        180, // 6ãƒ¶æœˆå¾Œ
        365, // 1å¹´å¾Œ
        730  // 2å¹´å¾Œ
      ]
    };
    
    return intervals[stage];
  }
  
  /**
   * æ¬¡å›å¾©ç¿’ã¾ã§ã®æ¨å¥¨æ™‚é–“ï¼ˆæ—¥æ•°ï¼‰
   */
  calculateNextReviewInterval(
    progress: WordProgress,
    sm2Result: SM2Result
  ): number {
    const stage = this.determineMemoryStage(progress);
    const intervals = this.getReviewIntervals(stage);
    const repetition = sm2Result.repetitions;
    
    // SM-2ã®æ¨å¥¨é–“éš”ã¨è¨˜æ†¶æ®µéšã‚’çµ„ã¿åˆã‚ã›
    const stageInterval = intervals[Math.min(repetition, intervals.length - 1)];
    const sm2Interval = sm2Result.nextInterval;
    
    // ä¸¡è€…ã®å¹³å‡ã‚’å–ã‚‹ï¼ˆãƒãƒ©ãƒ³ã‚¹ï¼‰
    return (stageInterval + sm2Interval) / 2;
  }
}
```

### å·¥ç¨‹4-4: MemoryAIçµ±åˆå¼·åŒ–ã€3æ™‚é–“ã€‘

```typescript
// src/ai/specialists/MemoryAI.tsï¼ˆå¤§å¹…å¼·åŒ–ï¼‰
export class MemoryAI extends BaseSpecialistAI {
  private sm2: SM2Algorithm;
  private forgettingCurve: ForgettingCurveModel;
  private longTermStrategy: LongTermMemoryStrategy;
  
  async analyze(context: AnalysisContext): Promise<MemorySignal> {
    const progress = context.progress;
    
    // 1ï¸âƒ£ SM-2åˆ†æ
    const quality = this.determineQuality(context);
    const sm2Result = this.sm2.calculateNextReview(
      quality,
      progress.easeFactor || 2.5,
      progress.lastInterval || 1,
      progress.repetitions || 0
    );
    
    // 2ï¸âƒ£ Ebbinghausåˆ†æ
    const memoryStrength = this.forgettingCurve.calculateMemoryStrength(progress);
    const daysSince = this.getDaysSinceLastAttempt(progress);
    const retention = this.forgettingCurve.calculateRetention(daysSince, memoryStrength);
    const reviewTiming = this.forgettingCurve.suggestReviewTiming(retention);
    
    // 3ï¸âƒ£ é•·æœŸè¨˜æ†¶æˆ¦ç•¥
    const memoryStage = this.longTermStrategy.determineMemoryStage(progress);
    const recommendedInterval = this.longTermStrategy.calculateNextReviewInterval(
      progress,
      sm2Result
    );
    
    // 4ï¸âƒ£ Positionèª¿æ•´ã®ææ¡ˆ
    let positionDelta = 0;
    let reason = '';
    
    if (reviewTiming === 'now' && retention < 0.7) {
      positionDelta = +20; // è¨˜æ†¶ãŒè–„ã‚Œã¦ã„ã‚‹ â†’ å„ªå…ˆåº¦UP
      reason = `è¨˜æ†¶ä¿æŒç‡${(retention * 100).toFixed(0)}% - ä»Šã™ãå¾©ç¿’ãŒå¿…è¦`;
    } else if (memoryStage === MemoryStage.LONG_TERM) {
      positionDelta = -10; // é•·æœŸè¨˜æ†¶æ¸ˆã¿ â†’ å„ªå…ˆåº¦DOWN
      reason = 'é•·æœŸè¨˜æ†¶ã«ç§»è¡Œæ¸ˆã¿ - é–“éš”ã‚’ç©ºã‘ã¦å¾©ç¿’';
    } else if (sm2Result.easeFactor < 2.0) {
      positionDelta = +10; // é›£æ˜“åº¦ãŒé«˜ã„ â†’ å„ªå…ˆåº¦UP
      reason = `é›£æ˜“åº¦ä¿‚æ•°${sm2Result.easeFactor.toFixed(2)} - å®šç€ã«æ™‚é–“ãŒå¿…è¦`;
    }
    
    return {
      positionAdjustment: {
        source: 'MemoryAI',
        delta: positionDelta,
        reason,
        confidence: 0.95
      },
      memoryStage,
      retention,
      forgettingRisk: reviewTiming === 'now' ? 'high' : 'low',
      sm2Data: sm2Result,
      recommendedNextReview: new Date(Date.now() + recommendedInterval * 24 * 60 * 60 * 1000)
    };
  }
}
```

### å·¥ç¨‹4-5: WordProgresså‹æ‹¡å¼µã€2æ™‚é–“ã€‘
```typescript
// src/types/adaptive.tsï¼ˆæ‹¡å¼µï¼‰
export interface WordProgress {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
  
  // ğŸ†• SM-2ãƒ‡ãƒ¼ã‚¿
  easeFactor?: number;        // é›£æ˜“åº¦ä¿‚æ•°ï¼ˆ1.3-3.0, åˆæœŸå€¤2.5ï¼‰
  lastInterval?: number;      // å‰å›ã®å¾©ç¿’é–“éš”ï¼ˆæ—¥æ•°ï¼‰
  repetitions?: number;       // SM-2é€£ç¶šæ­£è§£å›æ•°
  
  // ğŸ†• è¨˜æ†¶æ®µéš
  memoryStage?: MemoryStage;
  
  // ğŸ†• æ¨å¥¨å¾©ç¿’æ—¥æ™‚
  nextReviewDate?: Date;
  
  // ğŸ†• è¨˜æ†¶å¼·åº¦ï¼ˆ1-10ï¼‰
  memoryStrength?: number;
  
  // ğŸ†• æœ€çµ‚ä¿æŒç‡ï¼ˆ0-1ï¼‰
  lastRetention?: number;
}
```

### å·¥ç¨‹4-6: ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã€2æ™‚é–“ã€‘
- æ—¢å­˜ã®WordProgressãƒ‡ãƒ¼ã‚¿ã«SM-2ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
- åˆæœŸå€¤è¨­å®šï¼ˆeaseFactor=2.5, repetitions=0ï¼‰
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

### å·¥ç¨‹4-7: ãƒ†ã‚¹ãƒˆä½œæˆã€3æ™‚é–“ã€‘
- SM-2ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãƒ†ã‚¹ãƒˆï¼ˆ30ã‚±ãƒ¼ã‚¹ï¼‰
- Ebbinghausæ›²ç·šãƒ†ã‚¹ãƒˆï¼ˆ20ã‚±ãƒ¼ã‚¹ï¼‰
- é•·æœŸè¨˜æ†¶æˆ¦ç•¥ãƒ†ã‚¹ãƒˆï¼ˆ25ã‚±ãƒ¼ã‚¹ï¼‰
- MemoryAIçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ25ã‚±ãƒ¼ã‚¹ï¼‰

**Phase 4 å®Œäº†åŸºæº–**:
- âœ… SM-2å®Œå…¨å®Ÿè£…
- âœ… Ebbinghausæ›²ç·šçµ±åˆ
- âœ… 4æ®µéšã®è¨˜æ†¶ç§»è¡Œæˆ¦ç•¥
- âœ… 100+ãƒ†ã‚¹ãƒˆå…¨ã¦ãƒ‘ã‚¹
- âœ… ãƒ‡ãƒ¼ã‚¿ç§»è¡Œå®Œäº†
- âœ… **Spaced Repetitionã‚¹ã‚³ã‚¢: 60% â†’ 95%**

---

## ğŸ“‹ Phase 5: æ„Ÿæƒ…çš„ã‚µãƒãƒ¼ãƒˆ â˜…é‡è¦â˜…ã€12æ™‚é–“ã€‘

**ç›®çš„**: äººé–“ã‚‰ã—ã„å¯¾è©±ãƒ»åŠ±ã¾ã—ãƒ»æ®µéšçš„æŒ‡å°  
**å„ªå…ˆåº¦**: ğŸ”´ é«˜ï¼ˆ+25%ã‚¹ã‚³ã‚¢å‘ä¸Šï¼‰  
**ãƒªã‚¹ã‚¯**: ä¸­

### å·¥ç¨‹5-1: EmotionalAIå®Ÿè£…ã€3æ™‚é–“ã€‘

```typescript
// src/ai/specialists/EmotionalAI.ts
export class EmotionalAI extends BaseSpecialistAI {
  async analyze(context: AnalysisContext): Promise<EmotionalSignal> {
    const sessionStats = context.sessionStats;
    
    // 1ï¸âƒ£ æŒ«æŠ˜åº¦ã®æ¤œå‡º
    const frustrationLevel = this.detectFrustration(sessionStats);
    
    // 2ï¸âƒ£ è‡ªä¿¡åº¦ã®è©•ä¾¡
    const confidenceLevel = this.calculateConfidence(sessionStats);
    
    // 3ï¸âƒ£ ç–²åŠ´åº¦ã®æ¨å®š
    const fatigueLevel = this.estimateFatigue(sessionStats);
    
    // 4ï¸âƒ£ ä¼‘æ†©ã®ææ¡ˆ
    const suggestBreak = this.shouldSuggestBreak(sessionStats, fatigueLevel);
    
    // 5ï¸âƒ£ é©åˆ‡ãªåŠ±ã¾ã—ã®é¸æŠ
    const encouragement = this.selectEncouragement(
      frustrationLevel,
      confidenceLevel,
      context.progress
    );
    
    // 6ï¸âƒ£ Positionèª¿æ•´
    let positionDelta = 0;
    let reason = '';
    
    if (frustrationLevel === 'high') {
      positionDelta = -15; // ç°¡å˜ãªå•é¡Œã«åˆ‡ã‚Šæ›¿ãˆ
      reason = 'é€£ç¶šå¤±æ•—æ¤œå‡º - ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒã®ãŸã‚ç°¡å˜ãªå•é¡Œã‚’';
    } else if (confidenceLevel === 'high' && fatigueLevel === 'low') {
      positionDelta = +5; // å°‘ã—é›£ã—ã„å•é¡Œã«æŒ‘æˆ¦
      reason = 'å¥½èª¿ - å°‘ã—é›£æ˜“åº¦ã‚’ä¸Šã’ã¦æˆé•·ã‚’ä¿ƒã™';
    }
    
    return {
      positionAdjustment: {
        source: 'EmotionalAI',
        delta: positionDelta,
        reason,
        confidence: 0.85
      },
      frustrationLevel,
      confidenceLevel,
      fatigueLevel,
      suggestBreak,
      encouragement
    };
  }
  
  /**
   * æŒ«æŠ˜åº¦ã®æ¤œå‡ºï¼ˆé€£ç¶šä¸æ­£è§£ã€é•·æ™‚é–“åœæ»ï¼‰
   */
  private detectFrustration(stats: SessionStats): 'low' | 'medium' | 'high' {
    const recentErrors = stats.recentAnswers?.filter(a => !a.correct).length || 0;
    const consecutiveErrors = stats.consecutiveIncorrect || 0;
    
    if (consecutiveErrors >= 3 || recentErrors >= 5) {
      return 'high';
    }
    if (consecutiveErrors >= 2 || recentErrors >= 3) {
      return 'medium';
    }
    return 'low';
  }
  
  /**
   * è‡ªä¿¡åº¦ã®è¨ˆç®—ï¼ˆé€£ç¶šæ­£è§£ã€æ­£ç­”ç‡ï¼‰
   */
  private calculateConfidence(stats: SessionStats): 'low' | 'medium' | 'high' {
    const consecutiveCorrect = stats.consecutiveCorrect || 0;
    const accuracy = stats.accuracy || 0;
    
    if (consecutiveCorrect >= 5 && accuracy >= 0.8) {
      return 'high';
    }
    if (consecutiveCorrect >= 3 && accuracy >= 0.6) {
      return 'medium';
    }
    return 'low';
  }
  
  /**
   * ç–²åŠ´åº¦ã®æ¨å®šï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“ã€å•é¡Œæ•°ï¼‰
   */
  private estimateFatigue(stats: SessionStats): 'low' | 'medium' | 'high' {
    const sessionMinutes = stats.sessionDuration || 0;
    const questionCount = stats.totalQuestions || 0;
    
    if (sessionMinutes > 45 || questionCount > 50) {
      return 'high';
    }
    if (sessionMinutes > 30 || questionCount > 30) {
      return 'medium';
    }
    return 'low';
  }
  
  /**
   * ä¼‘æ†©ææ¡ˆã®åˆ¤å®š
   */
  private shouldSuggestBreak(
    stats: SessionStats,
    fatigue: 'low' | 'medium' | 'high'
  ): boolean {
    if (fatigue === 'high') return true;
    
    const errorRate = 1 - (stats.accuracy || 0);
    if (fatigue === 'medium' && errorRate > 0.4) {
      return true; // ç–²åŠ´+ã‚¨ãƒ©ãƒ¼ç‡40%è¶… â†’ ä¼‘æ†©æ¨å¥¨
    }
    
    return false;
  }
  
  /**
   * çŠ¶æ³ã«å¿œã˜ãŸåŠ±ã¾ã—ã®é¸æŠ
   */
  private selectEncouragement(
    frustration: 'low' | 'medium' | 'high',
    confidence: 'low' | 'medium' | 'high',
    progress: WordProgress
  ): string {
    // æŒ«æŠ˜æ™‚
    if (frustration === 'high') {
      return this.getFrustrationEncouragement(progress);
    }
    
    // å¥½èª¿æ™‚
    if (confidence === 'high') {
      return this.getProgressEncouragement(progress);
    }
    
    // å®šç€æ™‚
    if ((progress.consecutiveCorrect || 0) >= 3) {
      return this.getMasteryEncouragement(progress);
    }
    
    // é€šå¸¸æ™‚
    return this.getStandardEncouragement();
  }
  
  private getFrustrationEncouragement(progress: WordProgress): string {
    const templates = [
      'ã“ã®å˜èªã¯é›£ã—ã„ã§ã™ã­ã€‚ç„¦ã‚‰ãšã€ã‚‚ã†ä¸€åº¦ã‚†ã£ãã‚Šè¦‹ã¦ã¿ã¾ã—ã‚‡ã†',
      'å¤§ä¸ˆå¤«ã§ã™ã€‚é›£ã—ã„å˜èªã»ã©ã€å®šç€ã—ãŸã¨ãã®é”æˆæ„Ÿã¯å¤§ãã„ã§ã™ã‚ˆ',
      'èª°ã§ã‚‚è‹¦æ‰‹ãªå˜èªã¯ã‚ã‚Šã¾ã™ã€‚ä¸€ç·’ã«ä½•åº¦ã§ã‚‚æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†',
      'ã¾ã è¦šãˆã¦ã„ãªãã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ç¹°ã‚Šè¿”ã—ãŒè¨˜æ†¶ã®éµã§ã™'
    ];
    return templates[Math.floor(Math.random() * templates.length)];
  }
  
  private getProgressEncouragement(progress: WordProgress): string {
    const consecutiveCorrect = progress.consecutiveCorrect || 0;
    return `ç´ æ™´ã‚‰ã—ã„ï¼${consecutiveCorrect}å›é€£ç¶šæ­£è§£ã§ã™ã€‚ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼`;
  }
  
  private getMasteryEncouragement(progress: WordProgress): string {
    return 'å®Œç’§ã§ã™ï¼ã“ã®å˜èªã¯ã‚‚ã†è‡ªåˆ†ã®ã‚‚ã®ã«ãªã‚Šã¾ã—ãŸã­ã€‚é•·æœŸè¨˜æ†¶ã«ç§»è¡Œã—ã¦ã„ã¾ã™';
  }
  
  private getStandardEncouragement(): string {
    return 'è‰¯ã„ãƒšãƒ¼ã‚¹ã§ã™ã€‚ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†';
  }
}
```

### å·¥ç¨‹5-2: Scaffoldingï¼ˆæ®µéšçš„æŒ‡å°ï¼‰å®Ÿè£…ã€3æ™‚é–“ã€‘

```typescript
// src/ai/specialists/scaffolding/ScaffoldingSystem.ts
export class ScaffoldingSystem {
  /**
   * é©åˆ‡ãªãƒ’ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã®æ±ºå®š
   */
  determineHintLevel(
    progress: WordProgress,
    consecutiveErrors: number
  ): 0 | 1 | 2 | 3 {
    // ã‚¨ãƒ©ãƒ¼å›æ•°ã«å¿œã˜ã¦ãƒ’ãƒ³ãƒˆå¼·åº¦ã‚’ä¸Šã’ã‚‹
    if (consecutiveErrors === 0) return 0; // ãƒ’ãƒ³ãƒˆãªã—
    if (consecutiveErrors === 1) return 1; // è»½ã„ãƒ’ãƒ³ãƒˆ
    if (consecutiveErrors === 2) return 2; // å¼·ã„ãƒ’ãƒ³ãƒˆ
    return 3; // ã»ã¼ç­”ãˆ
  }
  
  /**
   * ãƒ’ãƒ³ãƒˆã®ç”Ÿæˆï¼ˆå˜èªã‚¿ã‚¤ãƒ—åˆ¥ï¼‰
   */
  generateHint(
    word: Word,
    hintLevel: 0 | 1 | 2 | 3
  ): string | null {
    if (hintLevel === 0) return null;
    
    const hints = {
      1: this.generateLightHint(word),
      2: this.generateMediumHint(word),
      3: this.generateStrongHint(word)
    };
    
    return hints[hintLevel];
  }
  
  private generateLightHint(word: Word): string {
    // æœ€åˆã®æ–‡å­—
    return `ãƒ’ãƒ³ãƒˆ: æœ€åˆã®æ–‡å­—ã¯ã€Œ${word.english[0]}ã€ã§ã™`;
  }
  
  private generateMediumHint(word: Word): string {
    // æœ€åˆã®3æ–‡å­— + æ–‡å­—æ•°
    const first3 = word.english.substring(0, 3);
    const length = word.english.length;
    return `ãƒ’ãƒ³ãƒˆ: ${first3}... (${length}æ–‡å­—)`;
  }
  
  private generateStrongHint(word: Word): string {
    // ã»ã¼ç­”ãˆï¼ˆä¼ã›å­—1-2æ–‡å­—ï¼‰
    const masked = word.english
      .split('')
      .map((char, i) => {
        if (i === 0 || i === word.english.length - 1) {
          return char; // æœ€åˆã¨æœ€å¾Œã¯è¡¨ç¤º
        }
        return i % 2 === 0 ? char : '_'; // 1æ–‡å­—ãŠãã«ä¼ã›å­—
      })
      .join('');
    
    return `ãƒ’ãƒ³ãƒˆ: ${masked}`;
  }
}
```

### å·¥ç¨‹5-3: åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚·ã‚¹ãƒ†ãƒ ã€2æ™‚é–“ã€‘
```typescript
// src/components/encouragement/EncouragementDisplay.tsx
export const EncouragementDisplay: React.FC<{
  message: string;
  emotion: 'support' | 'praise' | 'mastery' | 'neutral';
}> = ({ message, emotion }) => {
  const icon = {
    support: 'ğŸ’ª',
    praise: 'ğŸ‰',
    mastery: 'â­',
    neutral: 'ğŸ“'
  }[emotion];
  
  return (
    <div className={`encouragement ${emotion}`}>
      <span className="icon">{icon}</span>
      <p>{message}</p>
    </div>
  );
};
```

### å·¥ç¨‹5-4: QuestionCardã¸ã®çµ±åˆã€2æ™‚é–“ã€‘
- EmotionalAIã‚·ã‚°ãƒŠãƒ«è¡¨ç¤º
- Scaffoldingãƒ’ãƒ³ãƒˆè¡¨ç¤º
- åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### å·¥ç¨‹5-5: ãƒ†ã‚¹ãƒˆä½œæˆã€2æ™‚é–“ã€‘
- EmotionalAIå˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆ20ã‚±ãƒ¼ã‚¹ï¼‰
- Scaffoldingãƒ†ã‚¹ãƒˆï¼ˆ15ã‚±ãƒ¼ã‚¹ï¼‰
- UIçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ10ã‚±ãƒ¼ã‚¹ï¼‰

**Phase 5 å®Œäº†åŸºæº–**:
- âœ… EmotionalAIå®Ÿè£…å®Œäº†
- âœ… 4æ®µéšã®Scaffolding
- âœ… çŠ¶æ³åˆ¥ã®åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… UIçµ±åˆå®Œäº†
- âœ… **äººé–“ã‚‰ã—ã•ã‚¹ã‚³ã‚¢: 65% â†’ 90%**

---

## ğŸ“‹ Phase 6: å¤šæ§˜ãªå¾©ç¿’æ–¹æ³•ã€10æ™‚é–“ã€‘

**ç›®çš„**: æ–‡è„ˆå¤‰æ›´ã€å¤šæ§˜ãªãƒ†ã‚¹ãƒˆå½¢å¼ã§å®šç€å¼·åŒ–  
**å„ªå…ˆåº¦**: ğŸŸ¡ ä¸­ï¼ˆ+15%ã‚¹ã‚³ã‚¢å‘ä¸Šï¼‰  
**ãƒªã‚¹ã‚¯**: ä½

### å·¥ç¨‹6-1: æ–‡è„ˆå¤‰æ›´ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã€3æ™‚é–“ã€‘

```typescript
// src/ai/specialists/context/ContextRotationSystem.ts
export enum ReviewMethod {
  RECOGNITION = 'recognition',  // èªè­˜ãƒ†ã‚¹ãƒˆï¼ˆè‹± â†’ æ—¥ï¼‰
  RECALL = 'recall',            // æƒ³èµ·ãƒ†ã‚¹ãƒˆï¼ˆæ—¥ â†’ è‹±ï¼‰
  SENTENCE = 'sentence',        // æ–‡è„ˆãƒ†ã‚¹ãƒˆï¼ˆç©´åŸ‹ã‚ï¼‰
  LISTENING = 'listening',      // è´è¦šãƒ†ã‚¹ãƒˆï¼ˆéŸ³å£° â†’ æ›¸ãå–ã‚Šï¼‰
  PRODUCTION = 'production'     // ç”£å‡ºãƒ†ã‚¹ãƒˆï¼ˆç”»åƒ â†’ è‹±èªï¼‰
}

export class ContextRotationSystem {
  /**
   * è©¦è¡Œå›æ•°ã«å¿œã˜ãŸå¾©ç¿’æ–¹æ³•ã®é¸æŠ
   */
  selectReviewMethod(
    word: Word,
    progress: WordProgress
  ): ReviewMethod {
    const attempts = progress.attempts || 0;
    const accuracy = progress.accuracy || 0;
    
    // åˆå›: èªè­˜ãƒ†ã‚¹ãƒˆï¼ˆç°¡å˜ï¼‰
    if (attempts === 0) {
      return ReviewMethod.RECOGNITION;
    }
    
    // 2-3å›ç›®: æƒ³èµ·ãƒ†ã‚¹ãƒˆï¼ˆä¸­ç´šï¼‰
    if (attempts <= 3) {
      return ReviewMethod.RECALL;
    }
    
    // 4-6å›ç›®: æ–‡è„ˆãƒ†ã‚¹ãƒˆï¼ˆå¿œç”¨ï¼‰
    if (attempts <= 6 && accuracy >= 0.7) {
      return ReviewMethod.SENTENCE;
    }
    
    // 7å›ç›®ä»¥é™: ãƒ©ãƒ³ãƒ€ãƒ ã§å¤šæ§˜æ€§ç¢ºä¿
    return this.selectRandomMethod(accuracy);
  }
  
  private selectRandomMethod(accuracy: number): ReviewMethod {
    const methods = [
      ReviewMethod.RECOGNITION,
      ReviewMethod.RECALL,
      ReviewMethod.SENTENCE
    ];
    
    // æ­£ç­”ç‡é«˜ã„ â†’ è´è¦šãƒ»ç”£å‡ºã‚‚è¿½åŠ 
    if (accuracy >= 0.8) {
      methods.push(ReviewMethod.LISTENING, ReviewMethod.PRODUCTION);
    }
    
    return methods[Math.floor(Math.random() * methods.length)];
  }
  
  /**
   * æ–¹æ³•åˆ¥ã®å•é¡Œç”Ÿæˆ
   */
  generateQuestion(
    word: Word,
    method: ReviewMethod
  ): QuestionVariant {
    switch (method) {
      case ReviewMethod.RECOGNITION:
        return {
          type: 'recognition',
          prompt: word.english,
          answer: word.japanese,
          instruction: 'æ„å‘³ã‚’é¸ã‚“ã§ãã ã•ã„'
        };
        
      case ReviewMethod.RECALL:
        return {
          type: 'recall',
          prompt: word.japanese,
          answer: word.english,
          instruction: 'è‹±èªã§ç­”ãˆã¦ãã ã•ã„'
        };
        
      case ReviewMethod.SENTENCE:
        return this.generateSentenceQuestion(word);
        
      case ReviewMethod.LISTENING:
        return {
          type: 'listening',
          audioUrl: word.pronunciation?.audio,
          answer: word.english,
          instruction: 'èã“ãˆãŸå˜èªã‚’æ›¸ãå–ã£ã¦ãã ã•ã„'
        };
        
      case ReviewMethod.PRODUCTION:
        return {
          type: 'production',
          imageUrl: word.image,
          answer: word.english,
          instruction: 'ç”»åƒã‚’è‹±èªã§èª¬æ˜ã—ã¦ãã ã•ã„'
        };
    }
  }
  
  private generateSentenceQuestion(word: Word): QuestionVariant {
    // ä¾‹æ–‡ã‹ã‚‰ç©´åŸ‹ã‚å•é¡Œã‚’ç”Ÿæˆ
    const sentence = word.exampleSentence || `I use ${word.english} every day.`;
    const blankedSentence = sentence.replace(word.english, '____');
    
    return {
      type: 'sentence',
      prompt: blankedSentence,
      answer: word.english,
      instruction: 'ç©ºæ¬„ã«å…¥ã‚‹å˜èªã‚’ç­”ãˆã¦ãã ã•ã„',
      hint: `${word.english.length}æ–‡å­—ã®å˜èª`
    };
  }
}
```

### å·¥ç¨‹6-2: QuestionCardå¤šæ§˜åŒ–ã€3æ™‚é–“ã€‘
- 5ç¨®é¡ã®ãƒ†ã‚¹ãƒˆå½¢å¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- æ–¹æ³•åˆ¥ã®UIå®Ÿè£…
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»åŠ¹æœéŸ³

### å·¥ç¨‹6-3: éŸ³å£°ãƒ»ç”»åƒãƒªã‚½ãƒ¼ã‚¹æº–å‚™ã€2æ™‚é–“ã€‘
- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆï¼ˆTTS APIä½¿ç”¨ï¼‰
- ç”»åƒãƒªã‚½ãƒ¼ã‚¹ã®æº–å‚™
- ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

### å·¥ç¨‹6-4: ãƒ†ã‚¹ãƒˆä½œæˆã€2æ™‚é–“ã€‘
- å„ReviewMethodã®ãƒ†ã‚¹ãƒˆï¼ˆ25ã‚±ãƒ¼ã‚¹ï¼‰
- UIçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆ15ã‚±ãƒ¼ã‚¹ï¼‰

**Phase 6 å®Œäº†åŸºæº–**:
- âœ… 5ç¨®é¡ã®å¾©ç¿’æ–¹æ³•å®Ÿè£…
- âœ… æ–‡è„ˆå¤‰æ›´ã‚·ã‚¹ãƒ†ãƒ å®Œæˆ
- âœ… éŸ³å£°ãƒ»ç”»åƒãƒªã‚½ãƒ¼ã‚¹çµ±åˆ
- âœ… **å€‹åˆ¥åŒ–ã‚¹ã‚³ã‚¢: 75% â†’ 90%**

---

## ğŸ“Š æœ€çµ‚ç›®æ¨™é”æˆäºˆæ¸¬

| è¦³ç‚¹ | ç¾çŠ¶ | Phaseå®Œäº†å¾Œ | ç›®æ¨™ | é”æˆ |
|------|------|------------|------|------|
| **é©å¿œçš„å­¦ç¿’** | 80% | 95% | 95% | âœ… |
| **Spaced Repetition** | 60% | 95% | 95% | âœ… |
| **å€‹åˆ¥åŒ–** | 75% | 90% | 90% | âœ… |
| **äººé–“ã‚‰ã—ã•** | 65% | 90% | 90% | âœ… |
| **è¨˜æ†¶ã®è¶…å®šç€** | 60% | 95% | 95% | âœ… |
| **ç·åˆã‚¹ã‚³ã‚¢** | 72% | **93%** | 93% | âœ… |

---

## â±ï¸ å·¥æ•°ã‚µãƒãƒªãƒ¼

| Phase | å†…å®¹ | å·¥æ•° | å„ªå…ˆåº¦ | ãƒªã‚¹ã‚¯ |
|-------|------|------|--------|--------|
| Phase 1 | ConstantsæŠ½å‡º | 2.5æ™‚é–“ | ğŸŸ¢ é«˜ | ä½ |
| Phase 2 | Strategy Pattern | 12æ™‚é–“ | ğŸŸ¡ ä¸­ | ä¸­ |
| Phase 3 | AIçµ±åˆå¼·åŒ– | 8æ™‚é–“ | ğŸŸ¡ ä¸­ | ä¸­ |
| **Phase 4** | **è¨˜æ†¶ç§‘å­¦çµ±åˆ** | **18æ™‚é–“** | ğŸ”´ **æœ€é«˜** | é«˜ |
| **Phase 5** | **æ„Ÿæƒ…çš„ã‚µãƒãƒ¼ãƒˆ** | **12æ™‚é–“** | ğŸ”´ **é«˜** | ä¸­ |
| Phase 6 | å¤šæ§˜ãªå¾©ç¿’ | 10æ™‚é–“ | ğŸŸ¡ ä¸­ | ä½ |
| **åˆè¨ˆ** | | **62.5æ™‚é–“** | | |

### å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆç›®å®‰ï¼‰
- **çŸ­æœŸï¼ˆ1é€±é–“ï¼‰**: Phase 1ã®ã¿å®Ÿè£…
- **ä¸­æœŸï¼ˆ2é€±é–“ï¼‰**: Phase 1-3å®Œäº†
- **é•·æœŸï¼ˆ4é€±é–“ï¼‰**: Phase 1-6å…¨ã¦å®Œäº† â†’ **93ç‚¹é”æˆ** ğŸ¯

---

## âœ… å“è³ªä¿è¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phaseå®Œäº†æ™‚ã®å¿…é ˆç¢ºèªé …ç›®
- [ ] å…¨ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ï¼ˆ100%ï¼‰
- [ ] å‹ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­
- [ ] ESLintã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—ï¼ˆLighthouse 90+ç¶­æŒï¼‰
- [ ] æ—¢å­˜æ©Ÿèƒ½ã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãƒ‘ã‚¹
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ«ã§å‹•ä½œç¢ºèª
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å®Œäº†

### æœ€çµ‚ãƒªãƒªãƒ¼ã‚¹å‰ã®ç¢ºèª
- [ ] E2Eãƒ†ã‚¹ãƒˆå…¨ã¦ãƒ‘ã‚¹
- [ ] ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ãƒ‡ãƒ¼ã‚¿ç§»è¡Œãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æ›´æ–°
- [ ] AIã‚·ã‚¹ãƒ†ãƒ ã®é€æ˜æ€§ç¢ºä¿ï¼ˆå„åˆ¤æ–­ç†ç”±ã®è¡¨ç¤ºï¼‰
- [ ] ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèª

---

## ğŸ¯ æˆåŠŸã®å®šç¾©

### æŠ€è¡“çš„æˆåŠŸæŒ‡æ¨™
1. âœ… SM-2ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Œå…¨å®Ÿè£…
2. âœ… Ebbinghausæ›²ç·šçµ±åˆ
3. âœ… 4æ®µéšã®è¨˜æ†¶ç§»è¡Œæˆ¦ç•¥
4. âœ… EmotionalAIç¨¼åƒ
5. âœ… 5ç¨®é¡ã®å¾©ç¿’æ–¹æ³•å®Ÿè£…
6. âœ… ç·åˆã‚¹ã‚³ã‚¢93ç‚¹ä»¥ä¸Š

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“æŒ‡æ¨™
1. ğŸ“ˆ å­¦ç¿’å®šç€ç‡: 70% â†’ 90%ä»¥ä¸Š
2. ğŸ“ˆ å­¦ç¿’ç¶™ç¶šç‡: 60% â†’ 85%ä»¥ä¸Š
3. ğŸ“ˆ å­¦ç¿’æº€è¶³åº¦: 7.5/10 â†’ 9.0/10ä»¥ä¸Š
4. ğŸ“‰ æŒ«æŠ˜ç‡: 30% â†’ 10%ä»¥ä¸‹

---

**ã“ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«å¾“ãˆã°ã€äººé–“ã®å®¶åº­æ•™å¸«ã®ã‚ˆã†ã«ç”Ÿå¾’ã«å¯„ã‚Šæ·»ã„ã€ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ã„ãŸè¨˜æ†¶ã®è¶…å®šç€ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚** ğŸš€
