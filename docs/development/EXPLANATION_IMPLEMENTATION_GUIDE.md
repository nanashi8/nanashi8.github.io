# 解説データ改善 実装ガイド

**作成日**: 2025年12月15日  
**ステータス**: フェーズ1完了、実証テスト成功

---

## ✅ 完了した準備工程（工程1-15）

### 工程1-2: 品質基準策定 ✅
- [EXPLANATION_IMPROVEMENT_PLAN.md](./EXPLANATION_IMPROVEMENT_PLAN.md) 作成完了
- 必須要素・推奨要素・オプション要素を定義

### 工程3-13: テンプレート作成 ✅
- [EXPLANATION_TEMPLATES.md](./EXPLANATION_TEMPLATES.md) 作成完了
- 5タイプ13パターンのテンプレート完成

### 工程14: 自動生成スクリプト ✅
- `scripts/enhance-grammar-explanations.py` 開発完了
- テンプレートベースの解説生成機能実装
- dry-run モード対応

### 工程15: 品質検証スクリプト ✅
- `scripts/validate-explanation-quality.py` 開発完了
- 5.0点満点の品質スコアリング実装
- 詳細な問題点レポート機能

---

## 🎯 実証テスト結果（1年Unit0）

### テスト実施概要
- **対象**: grammar_grade1_unit0.json（60問）
- **実施日**: 2025年12月15日
- **処理**: 全60問の解説を自動改善

### 改善結果

| 指標 | 改善前 | 改善後 | 改善率 |
|------|--------|--------|--------|
| **平均品質スコア** | 1.82/5.0 | **3.88/5.0** | **+113%** |
| 解説カバー率 | 100% | 100% | 維持 |
| 優秀（4.5+） | 0問 (0%) | 15問 (25%) | **+15問** |
| 良好（4.0+） | 0問 (0%) | 22問 (37%) | **+22問** |
| 許容（3.0+） | 1問 (2%) | 21問 (35%) | **+20問** |
| 要改善（2.0+） | 31問 (52%) | 2問 (3%) | **-29問** |
| 不十分（<2.0） | 28問 (47%) | 0問 (0%) | **-28問** |

### 主な改善点

1. **文字数の充実**
   - 改善前: 多くが50文字未満
   - 改善後: 平均150-300文字の詳細な解説

2. **構造化された説明**
   - 【文法ポイント】セクション追加
   - 【理由】セクションで根拠を明示
   - 【語順ルール】で語順の原則を説明

3. **よくある間違いの追加**
   - ×（間違い）と○（正解）の対比
   - 学習者が間違えやすいポイントを明示

---

## 📋 次のステップ（工程16以降）

### 【優先度: 高】工程16-20: 1年Unit0完全強化

スクリプトで基礎的な改善は達成しましたが、さらに以下を手動で強化：

1. **fillInBlank 1-5問** - be動詞の選択ルールを詳細化
2. **sentenceOrdering 1-5問** - be動詞の文での語順パターン追加
3. **paraphrase 1-5問** - 肯定/否定/疑問文の変換ルール明確化
4. **verbForm 1-5問** - be動詞の変化パターン（am/is/are）
5. **conversation 1-5問** - 場面に応じた応答の説明強化

### 【優先度: 中】工程21-25: 1年Unit1実施

同様のプロセスで一般動詞の基本を強化

### 【自動化拡張】スクリプト改善項目

現在のスクリプトは基本的な改善を実現しましたが、以下を追加検討：

1. **文法事項の自動検出強化**
   - より精密な時制・文型の判定
   - 品詞の自動識別

2. **語順ルールの詳細化**
   - 副詞の位置パターン（頻度・時・場所）
   - 疑問詞の位置ルール

3. **よくある間違いの自動生成**
   - 統計的に多い誤答パターンの学習
   - 文法ルール違反の自動検出

4. **AI統合の検討**
   - OpenAI API / Claude API による高度な解説生成
   - より自然で教育的な説明文の生成

---

## 🛠️ スクリプト使用方法

### 1. 解説の自動改善

```bash
# 単一ファイル処理
python3 scripts/enhance-grammar-explanations.py \
  public/data/grammar/grammar_grade1_unit0.json

# dry-run（実際には保存しない）
python3 scripts/enhance-grammar-explanations.py \
  public/data/grammar/grammar_grade1_unit0.json -d

# ディレクトリ内の全ファイル処理
python3 scripts/enhance-grammar-explanations.py \
  public/data/grammar -a
```

### 2. 品質検証

```bash
# 単一ファイル検証
python3 scripts/validate-explanation-quality.py \
  public/data/grammar/grammar_grade1_unit0.json

# 詳細表示（-v）
python3 scripts/validate-explanation-quality.py \
  public/data/grammar/grammar_grade1_unit0.json -v

# 全ファイル検証 + レポート出力
python3 scripts/validate-explanation-quality.py \
  public/data/grammar -a -r docs/reports/explanation_quality_report.txt
```

---

## 📊 進捗トラッキング

### フェーズ1: 準備（工程1-15）✅
- [x] 工程1-2: 品質基準策定
- [x] 工程3-13: テンプレート作成
- [x] 工程14: 自動生成スクリプト開発
- [x] 工程15: 品質検証スクリプト開発

### フェーズ2: 1年生（工程16-75）
- [x] 工程16-20: 1年Unit0実証テスト ✅ **平均3.88/5.0達成**
- [ ] 工程21-25: 1年Unit1実施
- [ ] 工程26-35: 1年Unit2-3実施
- [ ] 工程36-55: 1年Unit4-7実施
- [ ] 工程56-75: 1年Unit8-10 + 全体検証

### フェーズ3: 2年生（工程76-115）
- 未着手

### フェーズ4: 3年生（工程116-140）
- 未着手

### フェーズ5: 最終調整（工程141-150）
- 未着手

---

## 💡 学んだこと

### 成功要因

1. **段階的アプローチ**: 一気に全問ではなく、1単元で実証
2. **自動化**: スクリプトで基礎品質を担保
3. **品質測定**: 数値化された指標で改善を可視化
4. **テンプレート化**: 一貫した品質基準

### 課題と対策

1. **既存解説との統合**
   - 課題: 既存解説と新規生成が重複
   - 対策: スクリプトで既存解説を優先的に活用

2. **文法検出の精度**
   - 課題: 単純なパターンマッチングの限界
   - 対策: より高度な自然言語処理の導入検討

3. **スケーラビリティ**
   - 課題: 1,780問への適用時間
   - 対策: 並列処理・バッチ処理の実装

---

## 🎯 目標設定

### 短期目標（1ヶ月）
- 1年生全単元（11単元、710問）の改善完了
- 平均品質スコア 4.0/5.0 以上達成

### 中期目標（3ヶ月）
- 2年生全単元（8単元、590問）の改善完了
- 平均品質スコア 4.2/5.0 以上達成

### 長期目標（6ヶ月）
- 全25単元（1,780問）の改善完了
- 平均品質スコア 4.5/5.0 以上達成
- ユーザーフィードバック収集と反映

---

**次回更新予定**: 工程21-25完了時（1年Unit1実施後）
