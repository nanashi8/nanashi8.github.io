<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ABCé †ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
    }
    h2 {
      color: #666;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    .word-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
    }
    .word {
      background: #e3f2fd;
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    .error {
      background: #ffebee;
      border-left: 4px solid #f44336;
      padding: 15px;
      margin: 10px 0;
    }
    .success {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      margin: 10px 0;
    }
    .warning {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 15px;
      margin: 10px 0;
    }
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #1976d2;
    }
    .json {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” ABCé †ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>

  <div class="card">
    <h2>ä½¿ã„æ–¹</h2>
    <ol>
      <li>ã‚¢ãƒ—ãƒªï¼ˆhttp://localhost:5176ï¼‰ã‚’é–‹ã</li>
      <li>æš—è¨˜ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
      <li>ã“ã®ãƒšãƒ¼ã‚¸ã§ã€Œãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
    </ol>
    <button onclick="loadDebugInfo()">ğŸ”„ ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€</button>
    <button onclick="clearDebugInfo()">ğŸ—‘ï¸ ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚¯ãƒªã‚¢</button>
  </div>

  <div id="results"></div>

  <script>
    function loadDebugInfo() {
      const results = document.getElementById('results');
      results.innerHTML = '<p>èª­ã¿è¾¼ã¿ä¸­...</p>';

      try {
        // QuestionSchedulerã®å‘¼ã³å‡ºã—å±¥æ­´
        const schedulerCalls = JSON.parse(localStorage.getItem('debug_scheduler_calls') || '[]');
        const schedulerResults = JSON.parse(localStorage.getItem('debug_scheduler_results') || '[]');
        const memorizationLatest = JSON.parse(localStorage.getItem('debug_memorization_latest') || 'null');

        let html = '';

        // 1. QuestionSchedulerãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
        if (schedulerCalls.length === 0) {
          html += `
            <div class="card">
              <div class="error">
                <h3>âŒ QuestionSchedulerãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼</h3>
                <p>åŸå› ã®å¯èƒ½æ€§ï¼š</p>
                <ul>
                  <li>useEffect ã®ä¾å­˜é…åˆ—ãŒä¸é©åˆ‡</li>
                  <li>adaptiveEnabled ãŒ false</li>
                  <li>TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼</li>
                </ul>
              </div>
            </div>
          `;
        } else {
          html += `
            <div class="card">
              <div class="success">
                <h3>âœ… QuestionSchedulerãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã¾ã™</h3>
                <p>å‘¼ã³å‡ºã—å›æ•°: ${schedulerCalls.length} å›</p>
              </div>
              <h3>æœ€æ–°ã®å‘¼ã³å‡ºã—:</h3>
              <div class="json">${JSON.stringify(schedulerCalls[schedulerCalls.length - 1], null, 2)}</div>
            </div>
          `;
        }

        // 2. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çµæœ
        if (schedulerResults.length > 0) {
          const latest = schedulerResults[schedulerResults.length - 1];

          html += `
            <div class="card">
              <h2>ğŸ“Š ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çµæœ</h2>
              <h3>æœ€åˆã®10å˜èª:</h3>
              <div class="word-list">
                ${latest.top10Words.map((word, i) => `<div class="word">${i+1}. ${word}</div>`).join('')}
              </div>

              <h3>å„ªå…ˆåº¦ãƒˆãƒƒãƒ—10:</h3>
              <div class="json">${JSON.stringify(latest.top10Priorities, null, 2)}</div>
            </div>
          `;

          // ABCé †ãƒã‚§ãƒƒã‚¯
          const words = latest.top10Words;
          const sortedWords = [...words].sort();
          const isABC = JSON.stringify(words) === JSON.stringify(sortedWords);

          if (isABC) {
            html += `
              <div class="card">
                <div class="error">
                  <h3>âŒ ABCé †ã«ãªã£ã¦ã„ã¾ã™ï¼</h3>
                  <p>QuestionSchedulerã¯æ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™ãŒã€çµæœãŒABCé †ã§ã™ã€‚</p>
                  <p>åŸå› ã®å¯èƒ½æ€§ï¼š</p>
                  <ul>
                    <li>sortByPriority() ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ãªã„</li>
                    <li>å„ªå…ˆåº¦è¨ˆç®—ãŒå…¨ã¦åŒã˜å€¤ã«ãªã£ã¦ã„ã‚‹</li>
                    <li>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å¾Œã«åˆ¥ã®ã‚½ãƒ¼ãƒˆå‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹</li>
                  </ul>
                </div>
              </div>
            `;
          } else {
            html += `
              <div class="card">
                <div class="success">
                  <h3>âœ… ABCé †ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆæ­£å¸¸ï¼‰</h3>
                </div>
              </div>
            `;
          }
        }

        // 3. MemorizationViewã®æœ€æ–°æƒ…å ±
        if (memorizationLatest) {
          html += `
            <div class="card">
              <h2>ğŸ“ MemorizationViewæœ€æ–°æƒ…å ±</h2>
              <p>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: ${memorizationLatest.timestamp}</p>
              <p>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ¸ˆã¿å˜èªæ•°: ${memorizationLatest.totalScheduled}</p>
              <h3>æœ€åˆã®10å˜èª:</h3>
              <div class="word-list">
                ${memorizationLatest.top10Words.map((word, i) => `<div class="word">${i+1}. ${word}</div>`).join('')}
              </div>
            </div>
          `;
        }

        results.innerHTML = html;
      } catch (error) {
        results.innerHTML = `
          <div class="card">
            <div class="error">
              <h3>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
              <p>${error.message}</p>
            </div>
          </div>
        `;
      }
    }

    function clearDebugInfo() {
      if (confirm('ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
        localStorage.removeItem('debug_scheduler_calls');
        localStorage.removeItem('debug_scheduler_results');
        localStorage.removeItem('debug_memorization_latest');
        alert('ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        document.getElementById('results').innerHTML = '';
      }
    }

    // è‡ªå‹•èª­ã¿è¾¼ã¿
    window.addEventListener('load', () => {
      setTimeout(loadDebugInfo, 500);
    });
  </script>
</body>
</html>
