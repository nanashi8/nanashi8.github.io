# コンポーネント分割プロンプト

## 使用タイミング
- 単一ファイルが300行を超えた時
- 1つのファイルに複数の責務が混在している時
- コンパイル時間が長くなってきた時

## ステップ1: 事前調査

```
`.copilot/structure-map.md` を確認し、以下を特定してください：
1. 分割対象ファイルの現在の行数と責務
2. 依存している @EnvironmentObject と外部モジュール
3. 推奨されている分割構成（Phase 1, 2, 3）
```

## ステップ2: 影響範囲の特定

```
以下を確認してください：
- このファイルを import している他のファイル
- このファイルが定義している公開API
- 分割後も維持すべきインターフェース
```

## ステップ3: 仕様書の作成

```
`.copilot/components/[新しいコンポーネント名].md` を作成し、以下を記述してください：

# [コンポーネント名] 仕様

## 責務
- [主要な責務1]
- [主要な責務2]

## 入力プロパティ
- プロパティ名: 型 - 説明

## 出力（Binding/Callback）
- プロパティ名: 型 - 説明

## 依存
- @EnvironmentObject: [リスト]
- 外部モジュール: [リスト]

## 内部状態
- @State変数: [リスト]

## 公開メソッド
- メソッド名(引数) -> 戻り値: 説明
```

## ステップ4: 段階的分割実装

### Phase 1: 新しいファイル作成（既存コードは維持）
```
1. 新しいファイルを作成
2. 必要な import を追加
3. プロトタイプ実装（空のViewを返すだけ）
4. コンパイルエラーがないことを確認
```

### Phase 2: コードの移動
```
1. 元のファイルから必要な部分をコピー
2. 新しいファイルに貼り付けて調整
3. プロパティを入力パラメータに変換
4. コンパイルエラーを修正
```

### Phase 3: 元のファイルを更新
```
1. 元のファイルで新しいコンポーネントを import
2. 該当箇所を新しいコンポーネントに置き換え
3. 不要になったコードを削除
4. コンパイルエラーを修正
```

### Phase 4: 動作確認
```
1. アプリをビルド・実行
2. 分割した機能が正常に動作することを確認
3. 既存機能に影響がないことを確認
```

## ステップ5: ドキュメント更新

```
以下を更新してください：
1. `.copilot/structure-map.md` に新しいコンポーネントを追加
2. `.copilot/changelog.md` に分割の記録を追加
3. 必要に応じて `.copilot/quick-ref.md` にパターンを追加
```

## チェックリスト

- [ ] structure-map.md で分割計画を確認した
- [ ] コンポーネント仕様書を作成した
- [ ] 段階的に実装し、各Phaseでコンパイル確認した
- [ ] 動作確認を実施した
- [ ] ドキュメントを更新した
- [ ] 元のファイルサイズが適切になった（200-300行以内）

## 例: QuizView の分割

### Before
```
QuizView.swift (1100行)
- UI表示
- ビジネスロジック
- データ読み込み
- 状態管理
```

### After (Phase 1)
```
QuizView.swift (200行)
- UI制御のみ

QuizViewModel.swift (400行)
- ビジネスロジック
- データ読み込み
- 状態管理
```

### After (Phase 2)
```
QuizView.swift (150行)
QuizViewModel.swift (400行)
QuizStatisticsView.swift (50行)
QuestionCardView.swift (80行)
ChoiceCardView.swift (120行)
DontKnowCardView.swift (40行)
```

## トラブルシューティング

### コンパイルエラー: "Cannot find type in scope"
→ import文を追加してください

### コンパイルエラー: "@EnvironmentObject が見つからない"
→ 新しいコンポーネントにも @EnvironmentObject を追加してください

### 動作しない: プロパティが更新されない
→ @Binding を使用するか、コールバックで親に通知してください
