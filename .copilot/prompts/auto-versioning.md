# バージョニング統合プロンプト

このファイルは、すべてのワークフロー完了時に**必ず実行**するバージョニング手順を定義します。

---

## 📋 自動バージョニングの実行手順

### タイミング
以下のワークフロー完了時に**必ず実行:**
- ✅ 新機能追加完了時（add-feature.md）
- ✅ バグ修正完了時（fix-bug.md）
- ✅ リファクタリング完了時（refactor-component.md）
- ✅ 大規模変更完了時（large-scale-refactoring.md）

---

## ステップ1: 変更規模の判定

### 自動判定基準

```
今回の変更を分類してください：

1️⃣ 小規模機能追加 → MINOR +1 (例: v0.1.0 → v0.2.0)
   - 1-3ファイルの変更
   - 新機能の追加（互換性あり）
   - 所要時間: 1-3時間
   - 例: アニメーション追加、UI改善

2️⃣ 大規模機能追加 → MAJOR +1 (例: v0.9.0 → v1.0.0)
   - 5+ファイルの変更
   - アーキテクチャレベルの変更
   - 所要時間: 4時間以上
   - 例: QuizView完全リファクタリング

3️⃣ バグ修正（小規模） → PATCH +1 (例: v0.2.0 → v0.2.1)
   - 1-2ファイルの修正
   - バグ修正のみ
   - 所要時間: 30分-1時間
   - 例: UIバグ修正、タイプミス修正

4️⃣ バグ修正（大規模） → MINOR +1 (例: v0.2.5 → v0.3.0)
   - 3+ファイルの修正
   - ロジック変更を伴う
   - 所要時間: 2-4時間
   - 例: データフロー修正、状態管理バグ修正
```

---

## ステップ2: 現在のバージョンを取得

```bash
# 最新のバージョンタグを取得
CURRENT_VERSION=$(git describe --tags --abbrev=0 --match="v*" 2>/dev/null || echo "v0.0.0")
echo "現在のバージョン: $CURRENT_VERSION"
```

**出力例:**
```
現在のバージョン: v0.1.0
```

---

## ステップ3: 新しいバージョンを計算

### 計算ロジック

```bash
# 現在のバージョンから数値を抽出
CURRENT="v0.1.0"  # 例

# 分類に応じて新バージョンを計算
# 1️⃣ 小規模機能追加 → v0.2.0
# 2️⃣ 大規模機能追加 → v1.0.0
# 3️⃣ バグ修正（小規模） → v0.1.1
# 4️⃣ バグ修正（大規模） → v0.2.0
```

### 実際の例

| 現在 | 変更種別 | 新バージョン |
|------|----------|-------------|
| v0.1.0 | 小規模機能追加 | v0.2.0 |
| v0.1.0 | 大規模機能追加 | v1.0.0 |
| v0.2.0 | バグ修正（小） | v0.2.1 |
| v0.2.5 | バグ修正（大） | v0.3.0 |
| v0.9.0 | 大規模機能 | v1.0.0 |

---

## ステップ4: Gitタグを作成

### タグ作成コマンド

```bash
# 新しいバージョンを設定
NEW_VERSION="v0.2.0"  # ステップ3で決定

# 注釈付きタグを作成
git tag -a "$NEW_VERSION" -m "$NEW_VERSION: [簡潔な説明]" HEAD

# タグを確認
git tag -l -n9 "$NEW_VERSION"
```

### タグメッセージのフォーマット

```
v0.2.0: [1行で変更内容を要約]

主な変更:
- [変更点1]
- [変更点2]
- [変更点3]

変更ファイル:
- [ファイル1]
- [ファイル2]

影響範囲:
- [影響を受ける機能]
```

### 実際の例

```bash
git tag -a "v0.2.0" -m "v0.2.0: 非推奨構文対策システムの統合完了

主な変更:
- 既存ワークフローに非推奨チェックを統合
- add-feature.md, fix-bug.md, refactor-component.mdを更新
- バージョニング機能を実際に動作するように修正

変更ファイル:
- .copilot/prompts/add-feature.md
- .copilot/prompts/fix-bug.md
- .copilot/prompts/refactor-component.md
- .copilot/prompts/auto-versioning.md (新規)

影響範囲:
- すべての開発ワークフロー" HEAD
```

---

## ステップ5: changelog.mdにバージョンを記録

### フォーマット

```markdown
## v0.2.0 (2025-10-19)

### 新機能
- [機能の説明]

### バグ修正
- [修正内容]

### 変更ファイル
- [ファイル一覧]

### 影響範囲
- [影響を受ける機能]

---
```

### 実際の記録例

`.copilot/changelog.md` の**最上部**に追加：

```markdown
## v0.2.0 (2025-10-19)

### 新機能
- 既存ワークフローにバージョニング機能を統合
- 自動バージョン決定の仕組みを実装

### 変更
- add-feature.md にバージョニングステップを追加
- fix-bug.md にバージョニングステップを追加
- refactor-component.md にバージョニングステップを追加

### 変更ファイル
- .copilot/prompts/add-feature.md
- .copilot/prompts/fix-bug.md
- .copilot/prompts/refactor-component.md
- .copilot/prompts/auto-versioning.md (新規)

### 影響範囲
- すべての開発ワークフロー

---
```

---

## ステップ6: ユーザーに報告

### 報告フォーマット

```
✅ バージョニング完了

📦 新バージョン: v0.2.0
📝 前バージョン: v0.1.0
🏷️  変更種別: 小規模機能追加 (MINOR +1)

📋 次回の予定バージョン:
- 小規模機能追加 → v0.3.0
- 大規模機能追加 → v1.0.0
- バグ修正（小） → v0.2.1
- バグ修正（大） → v0.3.0

🔍 確認コマンド:
git tag -l -n9 "v0.2.0"
```

---

## 📊 バージョニングチェックリスト

各ワークフロー完了時に以下を確認：

- [ ] ステップ1: 変更規模を判定した
- [ ] ステップ2: 現在のバージョンを取得した（`git describe`）
- [ ] ステップ3: 新しいバージョンを計算した
- [ ] ステップ4: Gitタグを作成した（`git tag -a`）
- [ ] ステップ5: changelog.mdにバージョンを記録した
- [ ] ステップ6: ユーザーに報告した

---

## 🚨 重要な注意事項

### 必ず実行するタイミング
1. **新機能追加完了時** - add-feature.md の最終ステップ
2. **バグ修正完了時** - fix-bug.md の最終ステップ
3. **リファクタリング完了時** - refactor-component.md の最終ステップ

### 実行を忘れた場合
後から実行可能です：
```bash
# 特定のコミットにタグを付ける
git tag -a "v0.2.0" -m "..." <commit-hash>
```

### タグの修正（間違えた場合）
```bash
# タグを削除
git tag -d v0.2.0

# 正しいタグを再作成
git tag -a "v0.2.0" -m "..." HEAD
```

---

## 📚 参考資料

- **詳細なルール**: `.copilot/prompts/version-management.md`
- **Semantic Versioning**: https://semver.org/lang/ja/
- **Git統合ワークフロー**: `.copilot/prompts/ai-git-workflow.md`

---

最終更新: 2025年10月19日
