# バージョン管理ルール

**作成日**: 2025年10月19日  
**対象**: すべてのリリース管理

---

## 📋 概要

このプロジェクトでは **Semantic Versioning (SemVer)** を採用し、変更規模を明確に管理します。
AIが自動的にバージョン番号を決定し、タグを作成します。

---

## 🎯 バージョニング規則

### 基本形式
```
MAJOR.MINOR.PATCH
例: v1.2.3
```

### 各数値の意味

| 位置 | 名称 | 意味 | 例 |
|-----|------|------|-----|
| MAJOR | メジャー | 破壊的変更、大規模機能 | v0.x → v1.0 |
| MINOR | マイナー | 新機能追加（互換性あり） | v1.0 → v1.1 |
| PATCH | パッチ | バグ修正、小改善 | v1.1.0 → v1.1.1 |

---

## 📊 変更種別とバージョン番号

### 小規模機能追加 → MINOR +1

**定義:**
- 単一ファイルまたは少数ファイルの変更
- 既存機能への小さな追加
- 所要時間: 1-3時間
- 後方互換性: あり

**例:**
- 合格数のアニメーション追加
- クイズ結果の保存機能
- UI の色変更

**バージョン:**
```
v0.1.0 → v0.2.0
v1.3.5 → v1.4.0（PATCHはリセット）
```

---

### 大規模機能追加 → MAJOR +1

**定義:**
- 複数ファイルにまたがる大規模な新機能
- アーキテクチャレベルの変更
- 所要時間: 4時間以上
- 破壊的変更を含む可能性

**例:**
- 適応型学習システムの追加
- QuizView の完全リファクタリング
- 新しいクイズモードの追加

**バージョン:**
```
v0.9.0 → v1.0.0（初回リリース）
v1.5.3 → v2.0.0（MINOR, PATCHはリセット）
```

---

### 小規模修正 → PATCH +1

**定義:**
- バグ修正
- パフォーマンス改善
- 既存動作の維持（互換性あり）
- 所要時間: 30分-1時間

**例:**
- アニメーション速度の調整
- タイポ修正
- メモリリークの修正

**バージョン:**
```
v0.2.0 → v0.2.1
v1.4.3 → v1.4.4
```

---

### 大規模修正 → MINOR +1

**定義:**
- 根本的なバグの修正（ロジック変更を伴う）
- 複数ファイルにまたがる修正
- 既存の動作が大きく変わる可能性
- 所要時間: 2-4時間

**例:**
- 出題ロジックの書き換え
- データ永続化方式の変更
- 複数の関連バグの一括修正

**バージョン:**
```
v0.2.5 → v0.3.0（PATCHはリセット）
v1.4.3 → v1.5.0（PATCHはリセット）
```

---

## 🤖 AIの自動バージョニング手順

### ステップ1: 変更規模の判定

AIが以下の基準で自動判定します：

```python
def determine_version_bump(change_info):
    # ファイル数、行数、所要時間から判定
    if change_info.files > 5 or change_info.hours > 4:
        return "MAJOR"  # 大規模機能
    elif change_info.is_new_feature:
        return "MINOR"  # 小規模機能
    elif change_info.files > 2 or change_info.hours > 2:
        return "MINOR"  # 大規模修正
    else:
        return "PATCH"  # 小規模修正
```

### ステップ2: 現在のバージョン取得

```bash
# 最新のGitタグを取得
CURRENT_VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
echo "現在のバージョン: $CURRENT_VERSION"
```

### ステップ3: 新しいバージョン計算

```bash
# 例: v0.2.3 → v0.3.0（MINOR +1）
# MAJOR.MINOR.PATCH を分解
IFS='.' read -r major minor patch <<< "${CURRENT_VERSION//v/}"

case $BUMP_TYPE in
  MAJOR)
    major=$((major + 1))
    minor=0
    patch=0
    ;;
  MINOR)
    minor=$((minor + 1))
    patch=0
    ;;
  PATCH)
    patch=$((patch + 1))
    ;;
esac

NEW_VERSION="v${major}.${minor}.${patch}"
echo "新しいバージョン: $NEW_VERSION"
```

### ステップ4: Gitタグ作成

```bash
# タグを作成（注釈付き）
git tag -a "$NEW_VERSION" -m "$NEW_VERSION: $CHANGE_DESCRIPTION"

# 例
git tag -a "v0.3.0" -m "v0.3.0: 合格数アニメーション追加（小規模機能）"
```

### ステップ5: changelog.md 更新

```markdown
## [v0.3.0] - 2025-10-19

### ✨ 小規模機能追加（MINOR +1）

**変更内容:**
- 合格数更新時の光るエフェクト追加
- スプリングアニメーション実装
- 色変更: デフォルト → ゴールド

**影響範囲:**
- QuizStatisticsView.swift

**所要時間:** 1.5時間

**ビルド:** ✅ 成功  
**テスト:** ✅ 全て通過 (0 failures)

**次回予定バージョン:**
- 小規模機能: v0.4.0
- 大規模機能: v1.0.0
- 小規模修正: v0.3.1
- 大規模修正: v0.4.0
```

### ステップ6: ユーザーに報告

```
✅ バージョン v0.3.0 リリース完了

**変更種別:** 小規模機能追加（MINOR +1）
**タグ:** v0.3.0
**コミット:** a1b2c3d
**changelog.md:** 更新済み

**履歴:**
v0.2.0 → v0.3.0

**次回予定バージョン:**
- 小規模機能追加: v0.4.0
- 大規模機能追加: v1.0.0
- 小規模修正: v0.3.1
- 大規模修正: v0.4.0

リリースノートを作成しますか？
```

---

## 📈 バージョン履歴の例

### 初期開発フェーズ（v0.x.x）

```
v0.1.0 - 初期実装（クイズ基本機能）
v0.2.0 - 小機能: スコア保存機能
v0.2.1 - 修正: スコアの表示バグ
v0.3.0 - 小機能: アニメーション追加
v0.3.1 - 修正: アニメーション速度調整
v0.4.0 - 大修正: 出題ロジック書き換え
v0.5.0 - 小機能: 統計表示
v1.0.0 - 大機能: 適応型学習システム（正式リリース）
```

### 正式リリース後（v1.x.x）

```
v1.0.0 - 正式リリース
v1.0.1 - 修正: 軽微なバグ修正
v1.1.0 - 小機能: CSV インポート機能
v1.2.0 - 小機能: 学習履歴グラフ
v1.2.1 - 修正: グラフ表示の不具合
v2.0.0 - 大機能: マルチプレイヤーモード
```

---

## 🔧 特殊なケース

### v1.0.0 への昇格条件

以下のいずれかを満たした時に v1.0.0 にする：

1. **正式リリース準備が整った**
   - 主要機能がすべて実装済み
   - バグが少ない
   - ドキュメントが整備されている

2. **大規模機能が完成した**
   - 適応型学習システム
   - QuizView リファクタリング完了

3. **App Store リリース**
   - 外部ユーザーに公開

### プレリリース版（オプション）

```
v1.0.0-alpha.1  # アルファ版
v1.0.0-beta.1   # ベータ版
v1.0.0-rc.1     # リリース候補
v1.0.0          # 正式版
```

---

## 📝 changelog.md のフォーマット

### 基本構造

```markdown
# SimpleWord 変更履歴

最終更新: 2025-10-19

---

## [v0.3.0] - 2025-10-19

### ✨ 小規模機能追加（MINOR +1）

**変更内容:**
- 合格数の光るエフェクト追加
- スプリングアニメーション実装

**影響範囲:**
- QuizStatisticsView.swift（50行変更）

**所要時間:** 1.5時間

**ビルド:** ✅ 成功  
**テスト:** ✅ 全て通過

**関連:**
- コミット: a1b2c3d
- ブランチ: feature-animation-20251019

---

## [v0.2.1] - 2025-10-18

### 🐛 小規模修正（PATCH +1）

**変更内容:**
- アニメーション二重発火の修正

**影響範囲:**
- QuizView.swift（10行変更）

**所要時間:** 30分

**ビルド:** ✅ 成功  
**テスト:** ✅ 全て通過

---

## [v0.2.0] - 2025-10-17

### ✨ 小規模機能追加（MINOR +1）

**変更内容:**
- クイズ結果の保存機能

**影響範囲:**
- QuizResultStore.swift（新規作成）
- QuizView.swift（30行変更）

**所要時間:** 2時間

**ビルド:** ✅ 成功  
**テスト:** ✅ 全て通過
```

---

## 🎯 実装例

### 例1: 小規模機能追加（v0.2.0 → v0.3.0）

```bash
# AI実行フロー

# 1. 現在のバージョン取得
CURRENT_VERSION=$(git describe --tags --abbrev=0)
# 出力: v0.2.0

# 2. 変更規模判定
# - ファイル数: 1
# - 行数: 50
# - 所要時間: 1.5時間
# - 判定: MINOR +1

# 3. 新しいバージョン計算
NEW_VERSION="v0.3.0"

# 4. Gitタグ作成
git tag -a "v0.3.0" -m "v0.3.0: 合格数アニメーション追加"

# 5. changelog.md 更新
# （上記のフォーマットで記載）

# 6. ユーザーに報告
echo "✅ バージョン v0.3.0 リリース完了"
```

---

### 例2: 大規模機能追加（v0.9.0 → v1.0.0）

```bash
# AI実行フロー

# 1. 現在のバージョン取得
CURRENT_VERSION=$(git describe --tags --abbrev=0)
# 出力: v0.9.0

# 2. 変更規模判定
# - ファイル数: 10
# - 行数: 500
# - 所要時間: 6時間
# - 判定: MAJOR +1

# 3. 新しいバージョン計算
NEW_VERSION="v1.0.0"

# 4. Gitタグ作成
git tag -a "v1.0.0" -m "v1.0.0: 適応型学習システム追加（正式リリース）"

# 5. changelog.md 更新
# （大規模機能の詳細を記載）

# 6. リリースノート作成提案
echo "🎉 メジャーバージョン v1.0.0 リリース完了！"
echo "リリースノートを作成しますか？"
```

---

## 🚨 注意事項

### バージョン番号の後退禁止

```bash
# ❌ NG: バージョンを下げる
v0.3.0 → v0.2.5  # 絶対にやらない

# ✅ OK: 常に増加
v0.3.0 → v0.3.1  # 修正
v0.3.0 → v0.4.0  # 小機能
v0.3.0 → v1.0.0  # 大機能
```

### MINOR, PATCH のリセット

```bash
# MAJOR が増えたら MINOR, PATCH をリセット
v0.9.5 → v1.0.0（v1.0.5 ではない）

# MINOR が増えたら PATCH をリセット
v1.4.8 → v1.5.0（v1.5.8 ではない）
```

### タグの削除・変更禁止

```bash
# ❌ NG: 一度作成したタグは変更・削除しない
git tag -d v0.3.0
git tag -a v0.3.0 -m "修正版"  # やらない

# ✅ OK: 新しいバージョンで対応
git tag -a v0.3.1 -m "v0.3.0の修正版"
```

---

## 📚 関連ドキュメント

- `.copilot/prompts/ai-git-workflow.md` - Git統合ワークフロー
- `.copilot/changelog.md` - 実際の変更履歴
- `参考資料/大規模リファクタリング実現方策.md` - リファクタリング手順

---

## 🎓 まとめ

**バージョン管理の原則:**
- **Semantic Versioning に準拠**（業界標準）
- **変更規模を明確に反映**（MAJOR/MINOR/PATCH）
- **AIが自動判定・自動タグ作成**（手動操作不要）

**開発者の負担:**
- バージョン番号を考える必要なし
- AIが適切に判定してタグを作成
- changelog.md も自動更新

**AIの責任:**
- 変更規模を正確に判定
- バージョン番号を計算
- Gitタグを作成
- changelog.md を更新
- ユーザーに次回バージョン番号を提示
