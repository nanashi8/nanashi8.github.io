# シミュレーション実行ポリシー

**最終更新**: 2025年10月24日

---

## 🎯 基本方針

AIによるシミュレーション実行は**事前確認モード**で動作します。

---

## 📋 実行フロー

```
コード実装
    ↓
実装内容の説明
    ↓
【事前確認】シミュレート実行の確認を求める ⭐
    ↓
ユーザーの許可
    ↓
シミュレート実行
    ↓
結果報告
```

---

## ✅ 事前確認の形式

### 標準フォーマット

```markdown
## 実装完了

[実装内容の説明]

---

## ビルドチェックとシミュレーション

以下のチェックを実行しますか？

**実行内容**:
- ビルドチェック (xcodebuild)
- エラー/警告の確認
- 静的解析

**推奨デバイス**:
- iPhone 16 Pro
- iPhone SE (第3世代)

---

**選択肢**:
- `y` または `yes`: 実行する
- `n` または `no`: スキップする
- `custom`: デバイスやオプションを指定する

ご指示ください。
```

---

## 🔄 ユーザーの選択肢

### 1. `y` / `yes` - 標準実行

```bash
# 実行される内容
xcodebuild -project SimpleWord.xcodeproj \
  -scheme SimpleWord \
  -sdk iphonesimulator \
  -destination 'generic/platform=iOS Simulator' \
  clean build
```

- エラー/警告の確認
- ビルド結果の報告
- 問題があれば自動修正提案

---

### 2. `n` / `no` - スキップ

シミュレーションをスキップして次の作業へ進みます。

```
✅ 実装完了しました。
ビルド・テストはユーザー側で実施してください。
```

---

### 3. `custom` - カスタム指定

デバイスやオプションを指定できます。

**例**:
```
custom: iPhone 15 Pro Max のみ
custom: 警告は無視してエラーのみ確認
custom: ビルドせず静的解析のみ
```

---

## 🚫 自動実行しないケース

以下の場合は**必ず事前確認**を求めます:

1. `xcodebuild` によるビルド実行
2. シミュレーターの起動
3. 実行時テストの実行
4. パフォーマンス測定

---

## ✅ 自動実行するケース（確認不要）

以下は事前確認なしで自動実行されます:

1. **基本的な静的チェック**
   - ファイルの存在確認
   - 構文の簡易チェック
   - import文の確認

2. **軽量な検証**
   - コードフォーマットの確認
   - 命名規則のチェック

3. **ドキュメント生成**
   - レポートの作成
   - ログの記録

---

## 📊 実行レベル一覧

| レベル | 内容 | 事前確認 | 実行時間 |
|--------|------|----------|----------|
| **L0: 静的チェック** | 構文確認のみ | 不要 | <1秒 |
| **L1: ビルドチェック** | xcodebuild実行 | **必要** | 10-30秒 |
| **L2: シミュレート起動** | アプリ起動テスト | **必要** | 30-60秒 |
| **L3: UIテスト** | 画面遷移確認 | **必要** | 1-3分 |
| **L4: パフォーマンステスト** | 負荷テスト | **必要** | 3-10分 |

---

## 🎯 推奨される使い方

### ケース1: 小規模修正（10行以内）

```
実装 → 事前確認 → [n] スキップ
```

理由: 小規模な変更では影響範囲が限定的

---

### ケース2: 中規模修正（100行程度）

```
実装 → 事前確認 → [y] ビルドチェック
```

理由: コンパイルエラーの早期発見

---

### ケース3: 大規模修正（新機能追加）

```
実装 → 事前確認 → [custom] フル検証
```

理由: 動作確認とパフォーマンス測定が必要

---

## 🔧 カスタムオプション例

### 最小限チェック
```
custom: エラーのみ確認、警告は無視
```

### 特定デバイス
```
custom: iPhone SE のみでチェック
```

### 詳細レポート
```
custom: 詳細なビルドログを含める
```

### 複数デバイス
```
custom: iPhone 16 Pro と iPad Pro でチェック
```

---

## 📝 実装への反映方法

### AIが従うべきルール

1. **コード実装後、必ず確認を求める**
   ```python
   # 実装完了
   print("実装が完了しました")
   
   # 事前確認
   print("ビルドチェックを実行しますか？ (y/n/custom)")
   ```

2. **ユーザーの応答を待つ**
   - 応答がない場合は待機
   - 自動実行しない

3. **応答に基づいて実行**
   - `y`: 標準ビルドチェック実行
   - `n`: スキップして完了報告
   - `custom`: 詳細を確認してから実行

---

## 🚀 即座実行が必要な場合

ユーザーが明示的に要求した場合のみ、確認をスキップできます:

### トリガーフレーズ
```
✅ "ビルドして"
✅ "今すぐビルドチェック"
✅ "確認せずに実行"
✅ "自動でビルド"
```

---

## 📚 関連ドキュメント

- `.copilot/AI-TRIGGER-GUIDE.md` - AI自動実行トリガー
- `.copilot/ERROR_FIX_GUIDELINES.md` - エラー修正ガイドライン
- `docs/ERROR_RESOLUTION_PROTOCOL.md` - エラー解決プロトコル

---

## 🎓 まとめ

| 項目 | 方針 |
|------|------|
| **基本動作** | 事前確認モード |
| **確認フォーマット** | y/n/custom |
| **自動実行しないもの** | ビルド、シミュレーター起動 |
| **自動実行するもの** | 静的チェック、ドキュメント生成 |
| **即座実行** | 明示的な要求があった場合のみ |

---

**この方針により、ユーザーが作業のコントロールを保ちつつ、AIの自動化のメリットを享受できます。**
