const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/scoreBoardTests-DWx7OdjV.js","assets/chart-vendor-Eu4deRvW.js","assets/react-vendor-C14am9Lm.js"])))=>i.map(i=>d[i]);
var LI=Object.defineProperty;var zI=(n,e,t)=>e in n?LI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ne=(n,e,t)=>zI(n,typeof e!="symbol"?e+"":e,t);import{j as u}from"./chart-vendor-Eu4deRvW.js";import{a as WI,g as BI,c as bi,b as VI,r as $,R as UI}from"./react-vendor-C14am9Lm.js";function GI(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var dp={},E0=WI;dp.createRoot=E0.createRoot,dp.hydrateRoot=E0.hydrateRoot;const HI="modulepreload",qI=function(n){return"/"+n},R0={},gs=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=qI(c),c in R0)return;R0[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":HI,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return r.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},Gy=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function KI(n){return Gy.includes(n)}const Pl=typeof window<"u"&&new URLSearchParams(window.location.search).get("debug")==="true",R={log:(...n)=>{Pl&&console.log(...n)},warn:(...n)=>{Pl&&console.warn(...n)},error:(...n)=>{console.error(...n)},debug:(...n)=>{Pl&&console.debug(...n)},info:(...n)=>{Pl&&console.info(...n)}};class Vt{static start(e){this.enabled&&performance.mark(`${e}-start`)}static end(e){if(!this.enabled)return 0;try{if(performance.getEntriesByName(`${e}-start`,"mark").length===0)return 0;performance.mark(`${e}-end`),performance.measure(e,`${e}-start`,`${e}-end`);const s=performance.getEntriesByName(e),r=s[s.length-1],o=(r==null?void 0:r.duration)||0;return this.measurements.has(e)||this.measurements.set(e,[]),this.measurements.get(e).push(o),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e),o}catch{return 0}}static getStats(e){const t=this.measurements.get(e);return!t||t.length===0?null:{count:t.length,avg:t.reduce((s,r)=>s+r,0)/t.length,min:Math.min(...t),max:Math.max(...t),p50:this.percentile(t,.5),p95:this.percentile(t,.95),p99:this.percentile(t,.99)}}static percentile(e,t){if(e.length===0)return 0;const s=[...e].sort((o,i)=>o-i),r=Math.ceil(s.length*t)-1;return s[Math.max(0,r)]}static report(){if(!this.enabled)return;const e=Array.from(this.measurements.keys()).map(t=>{const s=this.getStats(t);return s?{label:t,count:s.count,avg:`${s.avg.toFixed(2)}ms`,min:`${s.min.toFixed(2)}ms`,max:`${s.max.toFixed(2)}ms`,p50:`${s.p50.toFixed(2)}ms`,p95:`${s.p95.toFixed(2)}ms`,p99:`${s.p99.toFixed(2)}ms`}:null}).filter(Boolean);console.group("üìä Performance Report"),console.table(e),console.groupEnd()}static export(){const e=Array.from(this.measurements.keys()).reduce((t,s)=>{const r=this.getStats(s);return r&&(t[s]=r),t},{});return JSON.stringify({timestamp:new Date().toISOString(),measurements:e},null,2)}static clear(){this.measurements.clear(),performance.clearMarks(),performance.clearMeasures()}static clearLabel(e){this.measurements.delete(e),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e)}static warnIfSlow(e,t,s){this.enabled&&t>s&&console.warn(`‚ö†Ô∏è [PerformanceMonitor] ${e} took ${t.toFixed(2)}ms (threshold: ${s}ms)`)}static logWithStats(e,t){if(!this.enabled)return;const s=this.getStats(e);s&&s.count>=5?console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms (avg: ${s.avg.toFixed(2)}ms, p95: ${s.p95.toFixed(2)}ms)`):console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms`)}}Ne(Vt,"measurements",new Map),Ne(Vt,"enabled",!1);const QI="QuizAppDB",XI=1,Nn={PROGRESS:"progress",SESSION_HISTORY:"sessionHistory",DAILY_STATS:"dailyStats",SETTINGS:"settings"},Qo=class Qo{constructor(){Ne(this,"connections",[]);Ne(this,"pendingConnectionCreations",0);Ne(this,"config",{maxConnections:5,connectionTimeout:5e3,idleTimeout:6e4});Ne(this,"initializationPromise",null);Ne(this,"cleanupInterval",null);this.startCleanupTimer()}static getInstance(){return Qo.instance||(Qo.instance=new Qo),Qo.instance}async initialize(){return this.initializationPromise?this.initializationPromise:(this.initializationPromise=this.performInitialization(),this.initializationPromise)}async performInitialization(){Vt.start("db-pool-init");try{this.pendingConnectionCreations++;const e=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:e,lastUsed:Date.now(),inUse:!1});const t=Vt.end("db-pool-init");R.log(`üèä [DBConnectionPool] ÂàùÊúüÂåñÂÆå‰∫Ü (${t.toFixed(2)}ms)`)}catch(e){throw R.error("‚ùå [DBConnectionPool] ÂàùÊúüÂåñÂ§±Êïó:",e),e}}createNewConnection(){return new Promise((e,t)=>{Vt.start("db-connection-open");const s=indexedDB.open(QI,XI),r=setTimeout(()=>{t(new Error("IndexedDB open timeout"))},this.config.connectionTimeout);s.onerror=()=>{clearTimeout(r),Vt.end("db-connection-open"),R.error("‚ùå IndexedDB open error:",s.error),t(s.error)},s.onsuccess=()=>{clearTimeout(r),Vt.end("db-connection-open"),e(s.result)},s.onupgradeneeded=o=>{const i=o.target.result;if(i.objectStoreNames.contains(Nn.PROGRESS)||i.createObjectStore(Nn.PROGRESS),!i.objectStoreNames.contains(Nn.SESSION_HISTORY)){const a=i.createObjectStore(Nn.SESSION_HISTORY,{keyPath:"id",autoIncrement:!0});a.createIndex("mode","mode",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("modeTimestamp",["mode","timestamp"],{unique:!1})}i.objectStoreNames.contains(Nn.DAILY_STATS)||i.createObjectStore(Nn.DAILY_STATS,{keyPath:"date"}).createIndex("date","date",{unique:!0}),i.objectStoreNames.contains(Nn.SETTINGS)||i.createObjectStore(Nn.SETTINGS),R.log("üì¶ [DBConnectionPool] Stores created")}})}async getConnection(){Vt.start("db-pool-get-connection"),await this.initialize();const e=this.connections.find(t=>!t.inUse);if(e)return e.inUse=!0,e.lastUsed=Date.now(),Vt.end("db-pool-get-connection"),e.db;if(this.connections.length+this.pendingConnectionCreations<this.config.maxConnections){this.pendingConnectionCreations++;const t=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:t,lastUsed:Date.now(),inUse:!0});const s=Vt.end("db-pool-get-connection");return R.log(`‚ûï [DBConnectionPool] Êñ∞Ë¶èÊé•Á∂ö‰ΩúÊàê (${this.connections.length}/${this.config.maxConnections}) (${s.toFixed(2)}ms)`),t}return R.warn("‚ö†Ô∏è [DBConnectionPool] Êé•Á∂ö„Éó„Éº„É´Ê∫ÄÊùØ„ÄÅÂæÖÊ©ü‰∏≠..."),new Promise(t=>{const s=setInterval(()=>{const r=this.connections.find(o=>!o.inUse);if(r){clearInterval(s),r.inUse=!0,r.lastUsed=Date.now();const o=Vt.end("db-pool-get-connection");R.log(`‚úÖ [DBConnectionPool] ÂæÖÊ©üÂæåÊé•Á∂öÂèñÂæó (${o.toFixed(2)}ms)`),t(r.db)}},10)})}releaseConnection(e){const t=this.connections.find(s=>s.db===e);t&&(t.inUse=!1,t.lastUsed=Date.now())}cleanupIdleConnections(){const t=Date.now()-this.config.idleTimeout,s=this.connections.filter(r=>!r.inUse&&r.lastUsed<t);s.length>0&&(s.forEach(r=>{r.db.close();const o=this.connections.indexOf(r);o!==-1&&this.connections.splice(o,1)}),R.log(`üßπ [DBConnectionPool] „Ç¢„Ç§„Éâ„É´Êé•Á∂öÂâäÈô§: ${s.length}ÂÄã`))}startCleanupTimer(){this.cleanupInterval=window.setInterval(()=>{this.cleanupIdleConnections()},3e4)}async closeAll(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.connections.forEach(e=>{try{e.db.close()}catch(t){R.error("‚ùå [DBConnectionPool] Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫„Ç®„É©„Éº:",t)}}),this.connections=[],this.initializationPromise=null,R.log("üîí [DBConnectionPool] ÂÖ®Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫ÂÆå‰∫Ü")}getStats(){return{totalConnections:this.connections.length,inUseConnections:this.connections.filter(e=>e.inUse).length,availableConnections:this.connections.filter(e=>!e.inUse).length,maxConnections:this.config.maxConnections,oldestConnectionAge:this.connections.length>0?Math.min(...this.connections.map(e=>Date.now()-e.lastUsed)):0}}};Ne(Qo,"instance",null);let hp=Qo;const Ja=hp.getInstance();async function YI(){return await Ja.initialize(),Ja.getConnection()}async function Hy(n,e,t){Vt.start("db-transaction");const s=await Ja.getConnection();try{const r=s.transaction(n,e),o=await t(r),i=Vt.end("db-transaction");return o}finally{Ja.releaseConnection(s)}}async function JI(){return Ja.closeAll()}const ZI="QuizAppDB";function tf(){try{return"indexedDB"in window&&indexedDB!==null}catch{return!1}}function ek(){return Vt.start("db-init-legacy"),YI().then(n=>(Vt.end("db-init-legacy"),n)).catch(n=>{throw Vt.end("db-init-legacy"),R.error("‚ùå IndexedDB initialization failed:",n),n})}async function nf(n,e){try{Vt.start("db-get");const t=await Hy(n,"readonly",async r=>new Promise((o,i)=>{const c=r.objectStore(n).get(e);c.onsuccess=()=>o(c.result||null),c.onerror=()=>i(c.error)})),s=Vt.end("db-get");return t}catch(t){return Vt.end("db-get"),R.error("getFromDB error:",t),null}}async function pr(n,e,t){try{Vt.start("db-put");const s=await Hy(n,"readwrite",async o=>new Promise((i,a)=>{const c=o.objectStore(n),l=t!==void 0?c.put(e,t):c.put(e);l.onsuccess=()=>i(!0),l.onerror=()=>a(l.error)})),r=Vt.end("db-put");return s}catch(s){return Vt.end("db-put"),R.error("putToDB error:",s),!1}}async function tk(){try{await JI(),R.log("üîí Connection pool closed before DB deletion")}catch(n){R.error("‚ö†Ô∏è Pool close error:",n)}return new Promise(n=>{const e=indexedDB.deleteDatabase(ZI);e.onsuccess=()=>{R.log("üóëÔ∏è Database deleted"),n(!0)},e.onerror=()=>{R.error("Database delete error"),n(!1)}})}const qy="indexeddb-migration-completed",Ky="1.1";function sf(){try{return localStorage.getItem(qy)===Ky}catch{return!1}}function Oh(){try{localStorage.setItem(qy,Ky),R.log("‚úÖ Migration flag set")}catch(n){R.error("Failed to set migration flag:",n)}}function qu(n){try{const e=localStorage.getItem(n);return!e||n.includes("lastLogin")||n.includes("Date")||n.includes("daily-plan")||n.includes("score-board")?null:JSON.parse(e)}catch{return R.warn(`${n} is not valid JSON (skipping)`),null}}function nk(n){try{return localStorage.getItem(n)}catch(e){return R.error(`Failed to get ${n} from localStorage:`,e),null}}async function sk(){try{const n=qu("progress-data");if(n)return n.wordProgress||(n.wordProgress={}),n.results||(n.results=[]),n.statistics||(n.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),n.questionSetStats||(n.questionSetStats={}),await pr(Nn.PROGRESS,n,"main"),R.log("üì¶ Progress data migrated:",Object.keys(n.wordProgress||{}).length,"words"),!0;R.log("‚ÑπÔ∏è No progress data to migrate, creating initial data");const e={wordProgress:{},results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{}};return await pr(Nn.PROGRESS,e,"main"),!0}catch(n){return R.error("Progress data migration error:",n),!1}}async function rk(){try{const n=["translation","spelling"];let e=0;for(const t of n){const s=`session-history-${t}`,r=qu(s);if(r&&Array.isArray(r))for(const o of r)await pr(Nn.SESSION_HISTORY,{mode:t,status:o.status,word:o.word,timestamp:o.timestamp}),e++}return e>0&&R.log("üìú Session history migrated:",e,"items"),!0}catch(n){return R.error("Session history migration error:",n),!1}}async function ok(){try{const n=new Date,e=new Date(n.getTime()-90*24*60*60*1e3);let t=0,s=0;for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.startsWith("studyStats-")){const i=o.replace("studyStats-","");if(new Date(i)>=e){const c=qu(o);c&&(await pr(Nn.DAILY_STATS,{date:i,...c}),t++)}else localStorage.removeItem(o),s++}}return(t>0||s>0)&&R.log(`üìä Daily stats: migrated ${t}, cleaned ${s}`),!0}catch(n){return R.error("Daily stats migration error:",n),!1}}async function ik(){try{const n=["user-goal-level","loginStreak","radar-improvement-progress","skip-exclude-groups"],e=["lastLoginDate","lastLoginData"];let t=0;for(const r of n)try{if(r.includes("lastLogin")){R.warn(`Skipping ${r} from JSON migration`);continue}const o=qu(r);o!==null&&(await pr(Nn.SETTINGS,o,r),t++)}catch(o){R.warn(`Failed to migrate ${r}:`,o)}for(const r of e)try{const o=nk(r);o!==null&&(await pr(Nn.SETTINGS,o,r),t++)}catch(o){R.warn(`Failed to migrate ${r}:`,o)}const s=["translation","spelling","reading"];for(const r of s){const o=`daily-plan-target-${r}`,i=`score-board-goal-${r}`;try{const a=localStorage.getItem(o);a&&(await pr(Nn.SETTINGS,a,o),t++)}catch(a){R.warn(`Failed to migrate ${o}:`,a)}try{const a=localStorage.getItem(i);a&&(await pr(Nn.SETTINGS,a,i),t++)}catch(a){R.warn(`Failed to migrate ${i}:`,a)}}return t>0&&R.log("‚öôÔ∏è Settings migrated:",t,"items"),!0}catch(n){return R.error("Settings migration error:",n),!1}}async function ak(){try{const n=await nf(Nn.PROGRESS,"main");return n?!n.wordProgress||typeof n.wordProgress!="object"?(R.warn("‚ö†Ô∏è Progress data verification failed - invalid wordProgress"),!1):(R.log("‚úÖ Migration verification passed"),!0):(R.warn("‚ö†Ô∏è Progress data verification failed - no data found"),!1)}catch(n){return R.error("Migration verification error:",n),!1}}async function ck(){if(sf())return R.log("‚ÑπÔ∏è Migration already completed"),!0;if(!tf())return R.warn("‚ö†Ô∏è IndexedDB not supported, using localStorage"),!1;R.log("üöÄ Starting data migration to IndexedDB...");try{await ek();const n=await Promise.all([sk(),rk(),ok(),ik()]),e=["Progress","SessionHistory","DailyStats","Settings"];return n.forEach((s,r)=>{s||R.warn(`‚ö†Ô∏è ${e[r]} migration incomplete (may be empty)`)}),n[0]||n.some(s=>s)?await ak()?(Oh(),R.log("üéâ Migration completed successfully!"),!0):(R.warn("‚ö†Ô∏è Migration verification failed, but marking as complete"),Oh(),!0):(R.warn("‚ö†Ô∏è All migrations returned false, marking as complete anyway"),Oh(),!0)}catch(n){return R.error("‚ùå Migration failed:",n),!1}}let na=!1;function Qy(){na=tf()&&sf(),R.log(`üì¶ Storage strategy: ${na?"IndexedDB":"localStorage"}`)}async function rf(n){try{return na?await pr(Nn.PROGRESS,n,"main"):(localStorage.setItem("progress-data",JSON.stringify(n)),!0)}catch(e){R.error("saveProgressData error:",e);try{return localStorage.setItem("progress-data",JSON.stringify(n)),!0}catch(t){return R.error("localStorage fallback failed:",t),!1}}}async function Xy(){try{if(na){const n=await nf(Nn.PROGRESS,"main");if(n)return n;const e=localStorage.getItem("progress-data");return e?JSON.parse(e):null}else{const n=localStorage.getItem("progress-data");return n?JSON.parse(n):null}}catch(n){return R.error("loadProgressData error:",n),null}}async function pc(n,e){try{return na?await pr(Nn.SETTINGS,e,n):(localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0)}catch(t){R.error(`saveSetting(${n}) error:`,t);try{return localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0}catch{return!1}}}async function fc(n){try{if(na){const e=await nf(Nn.SETTINGS,n);return e!==null?e:localStorage.getItem(n)||null}else return localStorage.getItem(n)||null}catch(e){return R.error(`loadSetting(${n}) error:`,e),null}}const lk=Object.freeze(Object.defineProperty({__proto__:null,initStorageStrategy:Qy,loadProgressData:Xy,loadSetting:fc,saveProgressData:rf,saveSetting:pc},Symbol.toStringTag,{value:"Module"}));class uk{filter(e,t){if(e.length===0)return e;const s=Date.now();let r=0;const o=e.map(i=>{if(i.position>=40)return i;const a=this.findRecentAnswer(i.question.word,t.recentAnswers);if(!a)return i;const c=s-a.timestamp;let l=!1,d=i.position;return c<3e4?(d-=100,l=!0,R.debug(`[AntiVibration] Âç≥Â∫ßÂÜçÂá∫È°åÈò≤Ê≠¢: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-100})):c<t.minInterval&&a.correct?(d-=5,l=!0,R.debug(`[AntiVibration] Áü≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-5})):c<t.minInterval*5&&a.correct&&(d-=2,l=!0,R.debug(`[AntiVibration] ‰∏≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-2})),a.consecutiveCorrect>=t.consecutiveThreshold&&(d-=2,l=!0,R.debug(`[AntiVibration] ÈÄ£Á∂öÊ≠£Ëß£È†ªÂ∫¶‰ΩéÊ∏õ: ${i.question.word}`,{consecutiveCorrect:a.consecutiveCorrect,penalty:-2})),l?(r++,{...i,position:d,antiVibrationApplied:!0}):i});return r>0&&R.info(`[AntiVibration] „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®: ${r}Âïè„Å´ÊåØÂãïÈò≤Ê≠¢„Éö„Éä„É´„ÉÜ„Ç£`),o}findRecentAnswer(e,t){return t.find(s=>s.word===e)||null}calculateVibrationScore(e,t,s=20){if(e.length===0)return 0;const r=Date.now();let o=0;const i=e.slice(0,Math.min(s,e.length));i.forEach(c=>{const l=this.findRecentAnswer(c.question.word,t);if(!l)return;const d=r-l.timestamp;d<6e4?o+=10:d<3e5?o+=5:d<6e5&&(o+=2),l.consecutiveCorrect>=3&&(o+=5)});const a=Math.min(o,100);return a>50&&R.warn(`[AntiVibration] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫: ${a}`,{topQuestions:i.slice(0,5).map(c=>c.question.word)}),a}extractSessionPriorityQuestions(e){return e.filter(t=>t.question.sessionPriority!==void 0)}extractNormalQuestions(e){return e.filter(t=>t.question.sessionPriority===void 0)}}function dk(n,e){const t=e!=null&&e.mode?String(e.mode):"";return t?[`${n}_${t}`,n]:[n]}function tu(n,e){if(typeof localStorage>"u")return{raw:null,key:null};const t=dk(n,e);for(const s of t)try{const r=localStorage.getItem(s);if(r!=null)return{raw:r,key:s}}catch{}return{raw:null,key:null}}function Yy(n,e){const{raw:t,key:s}=tu(n,e);if(!t)return{value:null,key:null};try{return{value:JSON.parse(t),key:s}}catch{return{value:null,key:null}}}function Pi(n,e,t,s){if(typeof localStorage>"u")return;const r=t!=null&&t.mode?String(t.mode):"",o=(s==null?void 0:s.writeLegacy)!==!1;try{const i=JSON.stringify(e);r&&localStorage.setItem(`${n}_${r}`,i),o&&localStorage.setItem(n,i)}catch{}}const Lh={weights:{memory:1,cognitiveLoad:.8,errorPrediction:.7,learningStyle:.5,linguistic:.4,contextual:.6,gamification:.3},emergencyThresholds:{forgettingRisk:150,cognitiveOverload:!0,consecutiveErrors:5},debugMode:!1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hk=1e-7,pk=1e-4;class Jy{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class of{refCount(e){return Cs("refCount")}incRef(e){return Cs("incRef")}timerAvailable(){return!0}time(e){return Cs("time")}read(e){return Cs("read")}readSync(e){return Cs("readSync")}readToGPU(e,t){return Cs("readToGPU")}numDataIds(){return Cs("numDataIds")}disposeData(e,t){return Cs("disposeData")}write(e,t,s){return Cs("write")}move(e,t,s,r,o){return Cs("move")}createTensorFromGPUData(e,t,s){return Cs("createTensorFromGPUData")}memory(){return Cs("memory")}floatPrecision(){return Cs("floatPrecision")}epsilon(){return this.floatPrecision()===32?hk:pk}dispose(){return Cs("dispose")}}function Cs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fk(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Wi(n,e,t)}function ri(n,e,t){return Math.max(n,Math.min(e,t))}function af(n){return n%2===0?n:n+1}function Wi(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function mk(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function E(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function cf(n,e,t=""){E(Jt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function Zy(n){E(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function we(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Jt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function sa(n){return n%1===0}function pp(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function qi(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function D0(n,e=r=>0,t,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const c=e(i);if(t!=null&&i>=t){o();return}s!=null?s(a,c):setTimeout(a,c)};a()})}function eb(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Lt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),E(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),E(n.every(s=>sa(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Eo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Lt(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function Jn(n,e){return In(n,e)}function In(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function gk(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function xk(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function tb(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function ru(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function yk(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function mc(n){return typeof n=="string"||n instanceof String}function bk(n){return typeof n=="boolean"}function fp(n){return typeof n=="number"}function xa(n){return Array.isArray(n)?xa(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":fp(n)?"float32":mc(n)?"string":bk(n)?"bool":"float32"}function mp(n){return!!(n&&n.constructor&&n.call&&n.apply)}function gp(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function pt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function nb(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((c,l)=>c*l)*(s?2:1);for(let c=0;c<o;c++)r[c]=nb(n+c*a,i,t,s)}return r}function mr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return nb(0,n,e,t)}function wk(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function lf(n,e){const t=Zn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Zn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function sb(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return mr(n,new Float32Array(t));if(e==="int32")return mr(n,new Int32Array(t));if(e==="bool")return mr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function ro(n){n.forEach(e=>{E(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function jr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function ya(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function uf(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j0="tfjsflags";class vk{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Sk,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(uf(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);j0 in e&&e[j0].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=Nk(r,o)})}}function Sk(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Ck(e,s[0],s[1]),s.join("="))),e}function Ck(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Nk(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function he(){return rb}let rb=null;function Ik(n){rb=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let zh;function ob(){if(zh==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");zh=n}return zh}function kk(){const n=ob();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function df(n,e){const t=kk();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Ku="Abs",gc="Acos",xc="Acosh",ba="Add",hf="AddN",pf="All",ff="Any",Qu="ArgMax",Xu="ArgMin",yc="Asin",bc="Asinh",wc="Atan",vc="Atanh",Sc="Atan2",Yu="AvgPool",mf="AvgPoolGrad",Ju="AvgPool3D",gf="AvgPool3DGrad",Zu="BatchMatMul",ed="BatchToSpaceND",xf="Bincount",yf="BitwiseAnd",$k="BroadcastTo",ib="BroadcastArgs",Cc="Cast",Nc="Ceil",Ic="ClipByValue",bf="Complex",td="ComplexAbs",nd="Concat",sd="Conv2D",wf="Conv2DBackpropFilter",rd="Conv2DBackpropInput",od="Conv3D",vf="Conv3DBackpropFilterV2",Sf="Conv3DBackpropInputV2",kc="Cos",$c="Cosh",Cf="Cumprod",id="Cumsum",Nf="CropAndResize",If="DenseBincount",kf="DepthToSpace",ad="DepthwiseConv2dNative",$f="DepthwiseConv2dNativeBackpropFilter",Tf="DepthwiseConv2dNativeBackpropInput",ab="Diag",cd="Dilation2D",xp="Dilation2DBackpropInput",yp="Dilation2DBackpropFilter",Tk="Draw",Tc="RealDiv",Af="Einsum",Ac="Elu",Ef="EluGrad",Ec="Erf",ld="Equal",Rc="Exp",ud="ExpandDims",Dc="Expm1",Rf="FFT",Df="Fill",jf="FlipLeftRight",jc="Floor",_c="FloorDiv",dd="FusedBatchNorm",hd="GatherV2",cb="GatherNd",pd="Greater",Pc="GreaterEqual",Mc="Identity",_f="IFFT",Pf="Imag",Fc="IsFinite",Oc="IsInf",Lc="IsNan",fd="LeakyRelu",md="Less",gd="LessEqual",lb="LinSpace",zc="Log",Wc="Log1p",xd="LogicalAnd",yd="LogicalNot",bd="LogicalOr",Ak="LogSoftmax",wd="LRN",Mf="LRNGrad",vd="Max",Bc="Maximum",Sd="MaxPool",Ff="MaxPoolGrad",Cd="MaxPool3D",Of="MaxPool3DGrad",ub="MaxPoolWithArgmax",Nd="Mean",Id="Min",Vc="Minimum",kd="MirrorPad",Uc="Mod",db="Multinomial",Gc="Multiply",$d="Neg",Td="NotEqual",Lf="NonMaxSuppressionV3",zf="NonMaxSuppressionV4",Wf="NonMaxSuppressionV5",Ad="OnesLike",Ed="OneHot",Rd="Pack",Dd="PadV2",Hc="Pow",jd="Prelu",_d="Prod",hb="RaggedGather",pb="RaggedRange",fb="RaggedTensorToTensor",Bf="Range",Vf="Real",qc="Reciprocal",Kc="Relu",Pd="Reshape",Md="ResizeNearestNeighbor",Uf="ResizeNearestNeighborGrad",Fd="ResizeBilinear",Gf="ResizeBilinearGrad",Qc="Relu6",Od="Reverse",Xc="Round",Yc="Rsqrt",mb="ScatterNd",gb="TensorScatterUpdate",xb="SearchSorted",Ld="Select",Jc="Selu",zd="Slice",Zc="Sin",el="Sinh",tl="Sign",nl="Sigmoid",sl="Softplus",rl="Sqrt",Wd="Sum",Bd="SpaceToBatchND",Vd="SplitV",Ud="Softmax",yb="SparseFillEmptyRows",bb="SparseReshape",wb="SparseSegmentMean",vb="SparseSegmentSum",Sb="SparseToDense",ol="SquaredDifference",Hf="Square",qf="StaticRegexReplace",Kf="StridedSlice",Cb="StringNGrams",Nb="StringSplit",Ib="StringToHashBucketFast",il="Sub",al="Tan",cl="Tanh",ll="Tile",Qf="TopK",Xf="Transform",Ki="Transpose",Yf="Unique",Gd="Unpack",Hd="UnsortedSegmentSum",qd="ZerosLike",ul="Step",Ek="FromPixels",Jf="RotateWithOffset",ou="_FusedMatMul",iu="FusedConv2D",kb="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ms(...n){he().getBool("IS_TEST")||he().getBool("PROD")||console.warn(...n)}function Rk(...n){he().getBool("IS_TEST")||he().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const au=df("kernelRegistry",()=>new Map),bp=df("gradRegistry",()=>new Map);function _0(n,e){const t=Tb(n,e);return au.get(t)}function P0(n){return bp.get(n)}function M0(n){const e=au.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&t.push(i)}return t}function $b(n){const{kernelName:e,backendName:t}=n,s=Tb(e,t);au.has(s)&&Ms(`The kernel '${e}' for backend '${t}' is already registered`),au.set(s,n)}function Dk(n){const{kernelName:e}=n;bp.has(e)&&he().getBool("DEBUG")&&Ms(`Overriding the gradient for '${e}'`),bp.set(e,n)}function Tb(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ab(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Eb=fn,Ks=null;try{Ks=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function fn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}fn.prototype.__isLong__;Object.defineProperty(fn.prototype,"__isLong__",{value:!0});function _s(n){return(n&&n.__isLong__)===!0}fn.isLong=_s;var F0={},O0={};function wi(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=O0[n],s)?s:(t=mn(n,(n|0)<0?-1:0,!0),r&&(O0[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=F0[n],s)?s:(t=mn(n,n<0?-1:0,!1),r&&(F0[n]=t),t))}fn.fromInt=wi;function Qs(n,e){if(isNaN(n))return e?Xo:Xs;if(e){if(n<0)return Xo;if(n>=Rb)return _b}else{if(n<=-z0)return As;if(n+1>=z0)return jb}return n<0?Qs(-n,e).neg():mn(n%ra|0,n/ra|0,e)}fn.fromNumber=Qs;function mn(n,e,t){return new fn(n,e,t)}fn.fromBits=mn;var cu=Math.pow;function Zf(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Xs;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Zf(n.substring(1),e,t).neg();for(var r=Qs(cu(t,8)),o=Xs,i=0;i<n.length;i+=8){var a=Math.min(8,n.length-i),c=parseInt(n.substring(i,i+a),t);if(a<8){var l=Qs(cu(t,a));o=o.mul(l).add(Qs(c))}else o=o.mul(r),o=o.add(Qs(c))}return o.unsigned=e,o}fn.fromString=Zf;function vr(n,e){return typeof n=="number"?Qs(n,e):typeof n=="string"?Zf(n,e):mn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}fn.fromValue=vr;var L0=65536,jk=1<<24,ra=L0*L0,Rb=ra*ra,z0=Rb/2,W0=wi(jk),Xs=wi(0);fn.ZERO=Xs;var Xo=wi(0,!0);fn.UZERO=Xo;var Hi=wi(1);fn.ONE=Hi;var Db=wi(1,!0);fn.UONE=Db;var wp=wi(-1);fn.NEG_ONE=wp;var jb=mn(-1,2147483647,!1);fn.MAX_VALUE=jb;var _b=mn(-1,-1,!0);fn.MAX_UNSIGNED_VALUE=_b;var As=mn(0,-2147483648,!1);fn.MIN_VALUE=As;var Be=fn.prototype;Be.toInt=function(){return this.unsigned?this.low>>>0:this.low};Be.toNumber=function(){return this.unsigned?(this.high>>>0)*ra+(this.low>>>0):this.high*ra+(this.low>>>0)};Be.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(As)){var t=Qs(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Qs(cu(e,6),this.unsigned),i=this,a="";;){var c=i.div(o),l=i.sub(c.mul(o)).toInt()>>>0,d=l.toString(e);if(i=c,i.isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}};Be.getHighBits=function(){return this.high};Be.getHighBitsUnsigned=function(){return this.high>>>0};Be.getLowBits=function(){return this.low};Be.getLowBitsUnsigned=function(){return this.low>>>0};Be.getNumBitsAbs=function(){if(this.isNegative())return this.eq(As)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Be.isZero=function(){return this.high===0&&this.low===0};Be.eqz=Be.isZero;Be.isNegative=function(){return!this.unsigned&&this.high<0};Be.isPositive=function(){return this.unsigned||this.high>=0};Be.isOdd=function(){return(this.low&1)===1};Be.isEven=function(){return(this.low&1)===0};Be.equals=function(e){return _s(e)||(e=vr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Be.eq=Be.equals;Be.notEquals=function(e){return!this.eq(e)};Be.neq=Be.notEquals;Be.ne=Be.notEquals;Be.lessThan=function(e){return this.comp(e)<0};Be.lt=Be.lessThan;Be.lessThanOrEqual=function(e){return this.comp(e)<=0};Be.lte=Be.lessThanOrEqual;Be.le=Be.lessThanOrEqual;Be.greaterThan=function(e){return this.comp(e)>0};Be.gt=Be.greaterThan;Be.greaterThanOrEqual=function(e){return this.comp(e)>=0};Be.gte=Be.greaterThanOrEqual;Be.ge=Be.greaterThanOrEqual;Be.compare=function(e){if(_s(e)||(e=vr(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Be.comp=Be.compare;Be.negate=function(){return!this.unsigned&&this.eq(As)?As:this.not().add(Hi)};Be.neg=Be.negate;Be.add=function(e){_s(e)||(e=vr(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,d=0,h=0,p=0,f=0;return f+=o+l,p+=f>>>16,f&=65535,p+=r+c,h+=p>>>16,p&=65535,h+=s+a,d+=h>>>16,h&=65535,d+=t+i,d&=65535,mn(p<<16|f,d<<16|h,this.unsigned)};Be.subtract=function(e){return _s(e)||(e=vr(e)),this.add(e.neg())};Be.sub=Be.subtract;Be.multiply=function(e){if(this.isZero())return Xs;if(_s(e)||(e=vr(e)),Ks){var t=Ks.mul(this.low,this.high,e.low,e.high);return mn(t,Ks.get_high(),this.unsigned)}if(e.isZero())return Xs;if(this.eq(As))return e.isOdd()?As:Xs;if(e.eq(As))return this.isOdd()?As:Xs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(W0)&&e.lt(W0))return Qs(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,d=e.low&65535,h=0,p=0,f=0,m=0;return m+=i*d,f+=m>>>16,m&=65535,f+=o*d,p+=f>>>16,f&=65535,f+=i*l,p+=f>>>16,f&=65535,p+=r*d,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,p+=i*c,h+=p>>>16,p&=65535,h+=s*d+r*l+o*c+i*a,h&=65535,mn(f<<16|m,h<<16|p,this.unsigned)};Be.mul=Be.multiply;Be.divide=function(e){if(_s(e)||(e=vr(e)),e.isZero())throw Error("division by zero");if(Ks){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ks.div_u:Ks.div_s)(this.low,this.high,e.low,e.high);return mn(t,Ks.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Xo:Xs;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Xo;if(e.gt(this.shru(1)))return Db;o=Xo}else{if(this.eq(As)){if(e.eq(Hi)||e.eq(wp))return As;if(e.eq(As))return Hi;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(Xs)?e.isNegative()?Hi:wp:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(As))return this.unsigned?Xo:Xs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Xs}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:cu(2,a-48),l=Qs(s),d=l.mul(e);d.isNegative()||d.gt(r);)s-=c,l=Qs(s,this.unsigned),d=l.mul(e);l.isZero()&&(l=Hi),o=o.add(l),r=r.sub(d)}return o};Be.div=Be.divide;Be.modulo=function(e){if(_s(e)||(e=vr(e)),Ks){var t=(this.unsigned?Ks.rem_u:Ks.rem_s)(this.low,this.high,e.low,e.high);return mn(t,Ks.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Be.mod=Be.modulo;Be.rem=Be.modulo;Be.not=function(){return mn(~this.low,~this.high,this.unsigned)};Be.and=function(e){return _s(e)||(e=vr(e)),mn(this.low&e.low,this.high&e.high,this.unsigned)};Be.or=function(e){return _s(e)||(e=vr(e)),mn(this.low|e.low,this.high|e.high,this.unsigned)};Be.xor=function(e){return _s(e)||(e=vr(e)),mn(this.low^e.low,this.high^e.high,this.unsigned)};Be.shiftLeft=function(e){return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?mn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):mn(0,this.low<<e-32,this.unsigned)};Be.shl=Be.shiftLeft;Be.shiftRight=function(e){return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?mn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):mn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Be.shr=Be.shiftRight;Be.shiftRightUnsigned=function(e){if(_s(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var s=this.low;return mn(s>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?mn(t,0,this.unsigned):mn(t>>>e-32,0,this.unsigned)};Be.shru=Be.shiftRightUnsigned;Be.shr_u=Be.shiftRightUnsigned;Be.toSigned=function(){return this.unsigned?mn(this.low,this.high,!1):this};Be.toUnsigned=function(){return this.unsigned?this:mn(this.low,this.high,!0)};Be.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Be.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Be.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};fn.fromBytes=function(e,t,s){return s?fn.fromBytesLE(e,t):fn.fromBytesBE(e,t)};fn.fromBytesLE=function(e,t){return new fn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};fn.fromBytesBE=function(e,t){return new fn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Pb=BI(Eb),_k=GI({__proto__:null,default:Pb},[Eb]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=Pb||_k;function Kd(n){return Ho.fromString(n,!0,16)}const Mb=Kd("c3a5c85c97cb3127"),Uo=Kd("b492b66fbe98f273"),is=Kd("9ae16a3b2f90404f");function vp(n){return n.xor(n.shru(47))}function Fb(n,e,t){const s=n.slice(e,e+t);return Ho.fromBytes(Array.from(s),!0,!0)}function un(n,e){return Fb(n,e,8)}function B0(n,e){return Fb(n,e,4)}function Vn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function yo(n,e,t=Kd("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Pk(n,e,t,s,r,o){r=r.add(n),o=Vn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(Vn(r,44)),[r.add(s),o.add(i)]}function Ml(n,e,t,s){return Pk(un(n,e),un(n,e+8),un(n,e+16),un(n,e+24),t,s)}function Mk(n,e=n.length){if(e>=8){const t=is.add(e*2),s=un(n,0).add(is),r=un(n,e-8),o=Vn(r,37).mul(t).add(s),i=Vn(s,25).add(r).mul(t);return yo(o,i,t)}if(e>=4){const t=is.add(e*2),s=B0(n,0);return yo(s.shl(3).add(e),B0(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return vp(is.mul(o).xor(Mb.mul(i))).mul(is)}return is}function Fk(n,e=n.length){const t=is.add(e*2),s=un(n,0).mul(Uo),r=un(n,8),o=un(n,e-8).mul(t),i=un(n,e-16).mul(is);return yo(Vn(s.add(r),43).add(Vn(o,30)).add(i),s.add(Vn(r.add(is),18)).add(o),t)}function Ok(n,e=n.length){const t=is.add(e*2),s=un(n,0).mul(is),r=un(n,8),o=un(n,e-8).mul(t),i=un(n,e-16).mul(is),a=Vn(s.add(r),43).add(Vn(o,30)).add(i),c=yo(a,s.add(Vn(r.add(is),18)).add(o),t),l=un(n,16).mul(t),d=un(n,24),h=a.add(un(n,e-32)).mul(t),p=c.add(un(n,e-24)).mul(t);return yo(Vn(l.add(d),43).add(Vn(h,30)).add(p),l.add(Vn(d.add(s),18)).add(h),t)}function Lk(n,e=n.length){const t=Ho.fromNumber(81,!0);if(e<=32)return e<=16?Mk(n,e):Fk(n,e);if(e<=64)return Ok(n,e);let s=t,r=t.mul(Uo).add(113),o=vp(r.mul(is).add(113)).mul(is),i=[Ho.UZERO,Ho.UZERO],a=[Ho.UZERO,Ho.UZERO];s=s.mul(is).add(un(n,0));let c=0;const l=(e-1>>6)*64,d=l+(e-1&63)-63;do s=Vn(s.add(r).add(i[0]).add(un(n,c+8)),37).mul(Uo),r=Vn(r.add(i[1]).add(un(n,c+48)),42).mul(Uo),s=s.xor(a[1]),r=r.add(i[0]).add(un(n,c+40)),o=Vn(o.add(a[0]),33).mul(Uo),i=Ml(n,c,i[1].mul(Uo),s.add(a[0])),a=Ml(n,c+32,o.add(a[1]),r.add(un(n,c+16))),[o,s]=[s,o],c+=64;while(c!==l);const h=Uo.add(o.and(255).shl(1));return c=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Vn(s.add(r).add(i[0]).add(un(n,c+8)),37).mul(h),r=Vn(r.add(i[1]).add(un(n,c+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(un(n,c+40))),o=Vn(o.add(a[0]),33).mul(h),i=Ml(n,c,i[1].mul(h),s.add(a[0])),a=Ml(n,c+32,o.add(a[1]),r.add(un(n,c+16))),[o,s]=[s,o],yo(yo(i[0],a[0],h).add(vp(r).mul(Mb)).add(o),yo(i[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ro(n,e){return e==="string"?bo(n):vi([n],e)}function zk(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function vi(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=oi(n)),he().getBool("DEBUG")&&gk(n,e),zk(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function hs(){return he().platform.now()}function bo(n,e="utf-8"){return e=e||"utf-8",he().platform.encode(n,e)}function No(n,e="utf-8"){return e=e||"utf-8",he().platform.decode(n,e)}function Zs(n){return he().platform.isTypedArray!=null?he().platform.isTypedArray(n):Ab(n)}function oi(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||uf(n)||n==null||Zs(n)&&t)e.push(n);else if(Array.isArray(n)||Zs(n))for(let s=0;s<n.length;++s)oi(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)oi(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wk{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Vk)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const a=hs();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const l of r)l.dataSync();i=Promise.resolve({kernelMs:hs()-a})}if(he().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const d=r[l];d.data().then(h=>{Bk(h,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(c=>{this.logger.logKernelProfile(t,a,c[0],c[1],o,c[2])})})}}function Bk(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class Vk{logKernelProfile(e,t,s,r,o,i){const a=typeof r=="number"?qi(`${r}ms`,9):r.error,c=qi(e,25),l=t.rank,d=t.size,h=qi(t.shape.toString(),14);let p="";for(const f in o){const m=o[f];if(m!=null){const g=m.shape||t.shape,x=g.length;p+=`${f}: ${x}D ${x>0?g:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${d}	%c${p}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uk(n,e,t){const s={},r={};for(let c=0;c<e.length;c++)s[e[c].id]=!0;for(let c=0;c<n.length;c++){const l=n[c],d=l.inputs;for(const h in d){const p=d[h];let f=!1;for(let m=0;m<e.length;m++)if(s[p.id]){l.outputs.forEach(g=>s[g.id]=!0),f=!0,r[l.id]=!0;break}if(f)break}}const o={};o[t.id]=!0;const i={};for(let c=n.length-1;c>=0;c--){const l=n[c],d=l.inputs;for(let h=0;h<l.outputs.length;h++)if(o[l.outputs[h].id]){for(const p in d)o[d[p].id]=!0,i[l.id]=!0;break}}const a=[];for(let c=0;c<n.length;c++){const l=n[c];if(r[l.id]&&i[l.id]){const d={};for(const p in l.inputs){const f=l.inputs[p];s[f.id]&&(d[p]=f)}const h=Object.assign({},l);h.inputs=d,h.outputs=l.outputs,a.push(h)}}return a}function Gk(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(c=>{const l=n[c.id];l!=null?i.push(l):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const c in o.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=t(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const d=o.inputs[c];if(!Jt(l.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=l;else{const h=n[d.id];n[d.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V0=20,_a=3,Wh=7;function Hk(n,e,t,s){const r=pt(e),o=qk(n,e,t,r),i=e.length,a=nu(n,e,t,r,o),c=["Tensor"];return s&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${i}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function qk(n,e,t,s){const r=we(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,c=t==="complex64"?Wa(n):n;if(a>1)for(let l=0;l<r/o;l++){const d=l*o;for(let h=0;h<o;h++)i[h]=Math.max(i[h],za(c[d+h],0,t).length)}return i}function za(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Wh))} + ${parseFloat(n[1].toFixed(Wh))}j`:mc(n)?s=`'${n}'`:t==="bool"?s=Ob(n):s=parseFloat(n.toFixed(Wh)).toString(),qi(s,e)}function Ob(n){return n===0?"false":"true"}function nu(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,a=e[0],c=e.length;if(c===0){if(t==="complex64"){const g=Wa(n);return[za(g[0],0,t)]}return t==="bool"?[Ob(n[0])]:[n[0].toString()]}if(c===1){if(a>V0){const x=_a*i;let y=Array.from(n.slice(0,x)),b=Array.from(n.slice((a-_a)*i,a*i));return t==="complex64"&&(y=Wa(y),b=Wa(b)),["["+y.map((v,w)=>za(v,r[w],t)).join(", ")+", ..., "+b.map((v,w)=>za(v,r[a-_a+w],t)).join(", ")+"]"]}return["["+(t==="complex64"?Wa(n):Array.from(n)).map((x,y)=>za(x,r[y],t)).join(", ")+"]"]}const l=e.slice(1),d=s.slice(1),h=s[0]*i,p=[];if(a>V0){for(let g=0;g<_a;g++){const x=g*h,y=x+h;p.push(...nu(n.slice(x,y),l,t,d,r,!1))}p.push("...");for(let g=a-_a;g<a;g++){const x=g*h,y=x+h;p.push(...nu(n.slice(x,y),l,t,d,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*h,y=x+h;p.push(...nu(n.slice(x,y),l,t,d,r,g===a-1))}const f=c===2?",":"";p[0]="["+(a>0?p[0]+f:"");for(let g=1;g<p.length-1;g++)p[g]=" "+p[g]+f;let m=`,
`;for(let g=2;g<c;g++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":m),p}function Wa(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=we(e),s!=null){const r=s.length;E(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||In(t,this.size),this.strides=pt(e)}set(e,...t){t.length===0&&(t=[0]),E(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return dr().makeTensor(this.values,this.shape,this.dtype)}}let dr=null,Bi=null;function Kk(n){dr=n}function Qk(n){Bi=n}class Pn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=we(e),this.strides=pt(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Bi.buffer(this.shape,this.dtype,e)}bufferSync(){return Bi.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return mr(this.shape,e,this.dtype==="complex64")}arraySync(){return mr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=dr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>No(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),dr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=dr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>No(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await dr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),dr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Bi.print(this,e)}clone(){return this.throwIfDisposed(),Bi.clone(this)}toString(e=!1){const t=this.dataSync();return Hk(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Bi.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),dr().makeVariable(this,e,t,s)}}Object.defineProperty(Pn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ye(){return df("Tensor",()=>Pn)}ye();class lu extends Pn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Jt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);dr().disposeTensor(this),this.dataId=e.dataId,dr().incRef(this,null)}dispose(){dr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(lu,Symbol.hasInstance,{value:n=>n instanceof Pn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var U0;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(U0||(U0={}));var Sp;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Sp||(Sp={}));var Cp;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Cp||(Cp={}));var Np;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Np||(Np={}));var Ip;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Ip||(Ip={}));const Xk={float32:Np,int32:Sp,bool:Cp,complex64:Ip};function Rs(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Xk[n][e]}function em(n){return Rs(n,"int32")}function Lb(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function zb(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(n,e){if(n.dtype===e.dtype)return[n,e];const t=Rs(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Wb(n){const e=[];return Bb(n,e,new Set),e}function Bb(n,e,t){if(n==null)return;if(n instanceof Pn){e.push(n);return}if(!Yk(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),Bb(o,e,t))}}function Yk(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bh(n){return n.kernelName!=null}class G0{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class oa{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new G0}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Ms(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Wk(this.backendInstance),!0}setupRegisteredKernels(){M0(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){M0(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof of)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Ms(`Initialization of backend ${e} failed`),Ms(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Ms(`Initialization of backend ${e} failed`),Ms(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return oa.nextTensorId++}nextVariableId(){return oa.nextVariableId++}clone(e){const t=Y.runKernel(Mc,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",c={x:i},l={dtype:a};return Y.runKernel(Cc,c,l)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(_0(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(c=>{o+=c.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=Bh(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Bh(e)){const{kernelName:m,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const y=_0(m,this.backendName);E(y!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();c=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});const v=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,b,v);const w=v.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(m,g,w);s=this.saveTensorsForBackwardMode(S)}return w}}else{const{forwardFunc:m}=e,g=x=>{r&&(s=x.map(y=>this.keep(this.clone(y))))};a=()=>{const x=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,g));const y=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,x,y),y}}const{inputs:d,attrs:h}=e,p=Bh(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(f=this.profiler.profileKernel(l,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),t=f.outputs)}),r&&this.addTapeNode(l,d,t,p,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(m=>d[m]!=null?d[m].shape:null),outputShapes:t.map(m=>m.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(c)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=P0(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(E(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(l=>t[l])):a=o.map(l=>t[l]);const c=s.filter((l,d)=>i[d]);return a.concat(c)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&mc(e[0])&&(o=e.map(c=>bo(c)));const i=r.write(o,t,s),a=new Pn(t,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const c=this.state.tensorInfo.get(i),l=yk(o);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new Pn(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new lu(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*ru(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof lu||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*ru(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},c=P0(e);c!=null&&(r=c.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((d,h)=>{if(d==null){const p=s[h],f=Zn(p.size,p.dtype);return this.makeTensor(f,p.shape,p.dtype)}return d}),r(l.length>1?l:l[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Wb(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(E(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));E(o instanceof Pn,()=>"The result y returned by f() must be a tensor.");const i=Uk(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??Jk(o.shape),Gk(a,i,l=>this.tidy(l),Zk);const c=t.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const d of l.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:c}})}customGrad(e){return E(mp(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{E(t.every(a=>a instanceof Pn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,c)=>{r[c]=a});const o=(a,c)=>(s=e(...t,c),E(s.value instanceof Pn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),E(mp(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,c)=>{const l=s.gradFunc(a,c),d=Array.isArray(l)?l:[l];E(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),E(d.every(p=>p instanceof Pn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return d.forEach((p,f)=>{h[f]=()=>p}),h};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=hs(),s=await this.backend.time(e);return s.wallMs=hs()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new G0;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}oa.nextTensorId=0;oa.nextVariableId=0;function Jk(n){const e=lf(we(n),"float32");return Y.makeTensor(e,n,"float32")}function Vb(){const n=ob();if(n._tfengine==null){const e=new vk(n);n._tfengine=new oa(e)}return Ik(n._tfengine.ENV),Kk(()=>n._tfengine),n._tfengine}const Y=Vb();function Zk(n,e){const t={a:n,b:e};return Y.runKernel(ba,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e$(){return typeof navigator<"u"&&navigator!=null}function Ub(n){if(n||e$()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Gb(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ys=he();ys.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ys.registerFlag("IS_BROWSER",()=>Gb());ys.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ys.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ys.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ys.registerFlag("PROD",()=>!1);ys.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ys.getBool("DEBUG"));ys.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ys.registerFlag("IS_TEST",()=>!1);ys.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ys.getBool("DEBUG"));ys.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ys.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ys.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qd(n,e){let t=n;if(Zs(n))return e==="string"?[]:[n.length];if(Lb(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(zb(n))return[n.buffer.size/(e==null?4:ru(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Zs(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&he().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Hb(n,s,[]),s}function Hb(n,e,t){if(t=t||[],!Array.isArray(n)&&!Zs(n)){E(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}E(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),E(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)Hb(n[r],s,t.concat(r))}function H0(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function W(n,e,t,s="numeric"){if(n instanceof ye())return H0(s,n.dtype,e,t),n;let r=xa(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),H0(s,r,e,t),n==null||!Zs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const c=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}const o=Qd(n,r);!Zs(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?vi(n,r):oi(n,[],!0);return Y.makeTensor(a,o,r)}function qb(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>W(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t$="__op";function se(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+t$;const r=(...o)=>{Y.startScope(t);try{const i=s(...o);return uf(i)&&console.error("Cannot return a Promise inside of tidy."),Y.endScope(i),i}catch(i){throw Y.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n$(n,e){const t=W(n,"real","complex"),s=W(e,"imag","complex");cf(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return Y.runKernel(bf,r)}const ii=se({complex_:n$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xd(n,e,t,s){if(s==null)s=xa(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(zb(n)||Lb(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return Y.backend.createTensorFromGPUData(n,e||t,s)}if(!Zs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ro(e);const r=we(e),o=we(t);E(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],c=i===t.length-1?a!==we(e.slice(i)):!0;E(t[i]===e[i]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Zs(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?vi(n,s):oi(n,[],!0),Y.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qi(n,e,t){const s=Qd(n,t);return Xd(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Do{static join(e){return new Do(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Zs(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let c=s;c<this.shards.length;c++){const l=this.shards[c],h=e+a-l.start,p=a,m=Math.min(t,l.end)-l.start,g=new Uint8Array(l.buffer,h,m-h);if(i.set(g,p),a+=g.length,t<l.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=s$(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function s$(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ir(){return Y}function kp(){return Y.memory()}function ae(n,e){return Y.tidy(n,e)}function Pt(n){Wb(n).forEach(t=>t.dispose())}function _r(n){return Y.keep(n)}function Kb(n,e,t=1){return Y.registerBackend(n,e,t)}function r$(){return Y.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ia=4;async function q0(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],c=Array.isArray(n)?n[i].tensor:n[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);const l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const d=new Promise(async h=>{const p=await c.bytes(),f=p.reduce((x,y)=>x+y.length,0)+ia*p.length,m=new Uint8Array(f);let g=0;for(let x=0;x<p.length;x++){const y=p[x],b=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(b,g),g+=ia,m.set(y,g),g+=y.length}h(m)});s.push(d)}else s.push(c.data());e!=null&&(l.group=e),t.push(l)}const o=await Promise.all(s);return{data:c$(o),specs:t}}function o$(n,e){const t=new Do(n),s={};let r=0;for(const o of e){const i=i$(o,(a,c)=>t.slice(r+a,r+c));s[o.name]=a$(o,t.slice(r,r+i)),r+=i}return s}function i$(n,e){const t=we(n.shape);let s;if("quantization"in n){const r=n.quantization;s=uu[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=ia+new Uint32Array(e(r,r+ia))[0];return r}else s=uu[n.dtype];return t*s}function a$(n,e){const t=n.name,s=n.dtype,r=n.shape,o=we(r);let i,a=0;if("quantization"in n){const c=n.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${n.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const l=uu[c.dtype],d=c.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){i=new Float32Array(d.length);for(let h=0;h<d.length;h++){const p=d[h];i[h]=p*c.scale+c.min}}else if(c.dtype==="float16")i=y$()(d);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(s==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let h=0;h<d.length;h++){const p=d[h];i[h]=Math.round(p*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*l}else if(s==="string"){const c=we(n.shape);i=[];for(let l=0;l<c;l++){const d=new Uint32Array(e.slice(a,a+ia))[0];a+=ia;const h=new Uint8Array(e.slice(a,a+d));i.push(h),a+=d}}else{const c=uu[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const l=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let m=0;m<l.length;m++)l[m]=i[m*2],d[m]=i[m*2+1];const h=Qi(l,r,"float32"),p=Qi(d,r,"float32"),f=ii(h,p);return h.dispose(),p.dispose(),f}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*c}return Qi(i,r,s)}function c$(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const tm=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function K0(n){return tm?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function l$(n){if(tm)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function u$(n){if(tm){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function d$(n){return Do.join(n)}function h$(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function p$(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function f$(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),p$(n,t,s)}function nm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:K0(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:K0(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Do(n.weightData).byteLength}}function Q0(n){const e=[];for(const t of n)e.push(...t.weights);return e}function m$(){const n=t=>{let s=t<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function g$(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function x$(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function y$(){const n=m$(),e=g$(),t=x$();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],c=n[t[a>>10]+(a&1023)]+e[a>>10];o[i]=c}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Bn.instance==null&&(Bn.instance=new Bn),Bn.instance}static registerSaveRouter(e){Bn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Bn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Bn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Bn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Bn.getInstance().loadRouters:Bn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const b$=n=>Bn.getSaveHandlers(n),w$=(n,e)=>Bn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $p="tensorflowjs",Tp=1,Yo="models_store",mo="model_info_store";function Qb(){if(!he().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Ap(n){const e=n.result;e.createObjectStore(Yo,{keyPath:"modelPath"}),e.createObjectStore(mo,{keyPath:"modelPath"})}class ai{constructor(e){if(this.indexedDB=Qb(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open($p,Tp);o.onupgradeneeded=()=>Ap(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(Yo,"readonly"),l=a.objectStore(Yo).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=d=>(i.close(),r(l.error)),a.oncomplete=()=>i.close()}else{t.weightData=Do.join(t.weightData);const a=nm(t),c=i.transaction(mo,"readwrite");let l=c.objectStore(mo),d;try{d=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let h;d.onsuccess=()=>{h=i.transaction(Yo,"readwrite");const p=h.objectStore(Yo);let f;try{f=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(m){return r(m)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=m=>{l=c.objectStore(mo);const g=l.delete(this.modelPath);g.onsuccess=()=>(i.close(),r(f.error)),g.onerror=x=>(i.close(),r(f.error))}},d.onerror=p=>(i.close(),r(d.error)),c.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}ai.URL_SCHEME="indexeddb://";const Xb=n=>he().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ai.URL_SCHEME)?v$(n.slice(ai.URL_SCHEME.length)):null;Bn.registerSaveRouter(Xb);Bn.registerLoadRouter(Xb);function v$(n){return new ai(n)}function S$(n){return n.startsWith(ai.URL_SCHEME)?n.slice(ai.URL_SCHEME.length):n}class C${constructor(){this.indexedDB=Qb()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open($p,Tp);s.onupgradeneeded=()=>Ap(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(mo,"readonly"),a=o.objectStore(mo).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;e(c)},a.onerror=c=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=S$(e),new Promise((t,s)=>{const r=this.indexedDB.open($p,Tp);r.onupgradeneeded=()=>Ap(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(mo,"readwrite"),a=i.objectStore(mo),c=a.get(e);let l;c.onsuccess=()=>{if(c.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),h=()=>{l=o.transaction(Yo,"readwrite");const f=l.objectStore(Yo).delete(e);f.onsuccess=()=>t(c.result.modelArtifactsInfo),f.onerror=m=>s(c.error)};d.onsuccess=h,d.onerror=p=>(h(),o.close(),s(c.error))}},c.onerror=d=>(o.close(),s(c.error)),i.oncomplete=()=>{l==null?o.close():l.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kr="/",Vi="tensorflowjs_models",Yb="info",N$="model_topology",I$="weight_specs",k$="weight_data",$$="model_metadata";function Jb(n){return{info:[Vi,n,Yb].join(Kr),topology:[Vi,n,N$].join(Kr),weightSpecs:[Vi,n,I$].join(Kr),weightData:[Vi,n,k$].join(Kr),modelMetadata:[Vi,n,$$].join(Kr)}}function Zb(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function T$(n){const e=n.split(Kr);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Kr)}function A$(n){return n.startsWith(ci.URL_SCHEME)?n.slice(ci.URL_SCHEME.length):n}class ci{constructor(e){if(!he().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Jb(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=nm(e),o=Do.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,l$(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw Zb(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=u$(i),t}}ci.URL_SCHEME="localstorage://";const ew=n=>he().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ci.URL_SCHEME)?E$(n.slice(ci.URL_SCHEME.length)):null;Bn.registerSaveRouter(ew);Bn.registerLoadRouter(ew);function E$(n){return new ci(n)}class R${constructor(){E(he().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),E(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Vi+Kr,s=Kr+Yb;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=T$(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=A$(e);const t=Jb(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return Zb(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X0="://";class $r{constructor(){this.managers={}}static getInstance(){return $r.instance==null&&($r.instance=new $r),$r.instance}static registerManager(e,t){E(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(X0)&&(e=e.slice(0,e.indexOf(X0))),E(e.length>0,()=>"scheme must not be an empty string.");const s=$r.getInstance();E(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=$r.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys($r.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D${constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!he().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Ab(e)}}if(he().get("IS_BROWSER")){he().setPlatform("browser",new D$);try{$r.registerManager(ci.URL_SCHEME,new R$)}catch{}try{$r.registerManager(ai.URL_SCHEME,new C$)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j$={importFetch:()=>require("node-fetch")};let Vh;class _${constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return he().global.fetch!=null?he().global.fetch(e,t):(Vh==null&&(Vh=j$.importFetch()),Vh(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}he().get("IS_NODE")&&!he().get("IS_BROWSER")&&he().setPlatform("node",new _$);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ot(n,e="float32",t){return e=e||"float32",ro(n),new Kn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$(n,e){const t=W(n,"x","cast");if(!xk(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return Y.runKernel(Cc,s,r)}const Xe=se({cast_:P$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$(n){const t={x:W(n,"x","clone","string_or_numeric")};return Y.runKernel(Mc,t)}const ei=se({clone_:M$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F$(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Vb();const O$={buffer:Ot,cast:Xe,clone:ei,print:F$};Qk(O$);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L$(n,e){let t=W(n,"a","add"),s=W(e,"b","add");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(ba,r)}const Ee=se({add_:L$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$(n,e){let t=W(n,"a","floorDiv"),s=W(e,"b","floorDiv");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(_c,r)}const tw=se({floorDiv_:z$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W$(n,e){let t=W(n,"a","div"),s=W(e,"b","div");if([t,s]=$n(t,s),t.dtype==="int32"&&s.dtype==="int32")return tw(t,s);const r={a:t,b:s},o={};return Y.runKernel(Tc,r,o)}const xt=se({div_:W$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$(n,e){let t=W(n,"a","mul"),s=W(e,"b","mul");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(Gc,r)}const K=se({mul_:B$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V$(n){const e=W(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Y.runKernel(td,t)}else{const t={x:e};return Y.runKernel(Ku,t)}}const os=se({abs_:V$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$(n){const t={x:W(n,"x","acos")};return Y.runKernel(gc,t)}const G$=se({acos_:U$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H$(n){const t={x:W(n,"x","acosh")};return Y.runKernel(xc,t)}const q$=se({acosh_:H$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(n,e=null,t=!1){const r={x:W(n,"x","all","bool")},o={axis:e,keepDims:t};return Y.runKernel(pf,r,o)}const nw=se({all_:K$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$(n,e=null,t=!1){const r={x:W(n,"x","any","bool")},o={axis:e,keepDims:t};return Y.runKernel(ff,r,o)}const Ep=se({any_:Q$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$(n,e=0){const s={x:W(n,"x","argMax")},r={axis:e};return Y.runKernel(Qu,s,r)}const Za=se({argMax_:X$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(n,e=0){const s={x:W(n,"x","argMin")},r={axis:e};return Y.runKernel(Xu,s,r)}const J$=se({argMin_:Y$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$(n){const t={x:W(n,"x","asin")};return Y.runKernel(yc,t)}const e2=se({asin_:Z$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t2(n){const t={x:W(n,"x","asinh")};return Y.runKernel(bc,t)}const n2=se({asinh_:t2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2(n){const t={x:W(n,"x","atan")};return Y.runKernel(wc,t)}const r2=se({atan_:s2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o2(n,e){let t=W(n,"a","atan2"),s=W(e,"b","atan2");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(Sc,r)}const i2=se({atan2_:o2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a2(n){const t={x:W(n,"x","atanh")};return Y.runKernel(vc,t)}const c2=se({atanh_:a2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dl(n,e,t,s,r="NHWC",o){const i=n[3],a=[...e,i],c=io(r);return Qn(n,a,t,o,s,null,null,c)}function tr(n,e,t,s,r,o,i="channelsLast"){const[a,c]=ec(e);let l;if(i==="channelsLast")l=[a,c,n[3],n[3]];else if(i==="channelsFirst")l=[a,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Qn(n,l,t,s,r,o,!1,i)}function oo(n,e,t,s,r,o,i="NDHWC"){const[a,c,l]=Rp(e);let d,h;if(i==="NDHWC")h="channelsLast",d=[a,c,l,n[4],n[4]];else if(i==="NCDHW")h="channelsFirst",d=[a,c,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return jo(n,d,t,s,r,!1,h,o)}function Qn(n,e,t,s,r,o,i=!1,a="channelsLast"){let[c,l,d,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,d,h]=n;else if(a==="channelsFirst")[c,h,l,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,f,,m]=e,[g,x]=ec(t),[y,b]=ec(s),v=Xi(p,y),w=Xi(f,b),{padInfo:S,outHeight:N,outWidth:C}=d2(r,l,d,g,x,v,w,o,a),k=i?m*h:m;let I;return a==="channelsFirst"?I=[c,k,N,C]:a==="channelsLast"&&(I=[c,N,C,k]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:d,inChannels:h,outHeight:N,outWidth:C,outChannels:k,padInfo:S,strideHeight:g,strideWidth:x,filterHeight:p,filterWidth:f,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:n,outShape:I,filterShape:e}}function jo(n,e,t,s,r,o=!1,i="channelsLast",a){let[c,l,d,h,p]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[c,l,d,h,p]=n;else if(i==="channelsFirst")[c,p,l,d,h]=n;else throw new Error(`Unknown dataFormat ${i}`);const[f,m,g,,x]=e,[y,b,v]=Rp(t),[w,S,N]=Rp(s),C=Xi(f,w),k=Xi(m,S),I=Xi(g,N),{padInfo:T,outDepth:_,outHeight:D,outWidth:P}=h2(r,l,d,h,y,b,v,C,k,I,a),A=o?x*p:x;let F;return i==="channelsFirst"?F=[c,A,_,D,P]:i==="channelsLast"&&(F=[c,_,D,P,A]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:d,inWidth:h,inChannels:p,outDepth:_,outHeight:D,outWidth:P,outChannels:A,padInfo:T,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:f,filterHeight:m,filterWidth:g,effectiveFilterDepth:C,effectiveFilterHeight:k,effectiveFilterWidth:I,dilationDepth:w,dilationHeight:S,dilationWidth:N,inShape:n,outShape:F,filterShape:e}}function l2(n,e,t,s,r){s==null&&(s=sm(n,e,t));const o=n[0],i=n[1],a=tc((o-e+2*s)/t+1,r),c=tc((i-e+2*s)/t+1,r);return[a,c]}function u2(n,e,t,s,r,o){r==null&&(r=sm(n,e[0],s[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(i[a]=tc((n[a]-e[a]+2*r)/s[a]+1,o));return i}function sm(n,e,t,s=1){const r=Xi(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function ec(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Rp(n){return typeof n=="number"?[n,n,n]:n}function Xi(n,e){return e<=1?n:n+(n-1)*(e-1)}function d2(n,e,t,s,r,o,i,a,c){let l,d,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const f=l2([e,t],o,s,n,a);d=f[0],h=f[1]}else if(n==="same"){d=Math.ceil(e/s),h=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+o-e),f=Math.max(0,(h-1)*r+i-t),m=Math.floor(p/2),g=p-m,x=Math.floor(f/2),y=f-x;l={top:m,bottom:g,left:x,right:y,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),h=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const p=c==="channelsLast"?n[1][0]:n[2][0],f=c==="channelsLast"?n[1][1]:n[2][1],m=c==="channelsLast"?n[2][0]:n[3][0],g=c==="channelsLast"?n[2][1]:n[3][1];l={top:p,bottom:f,left:m,right:g,type:p===0&&f===0&&m===0&&g===0?"VALID":"EXPLICIT"},d=tc((e-o+p+f)/s+1,a),h=tc((t-i+m+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:d,outWidth:h}}function h2(n,e,t,s,r,o,i,a,c,l,d){let h,p,f,m;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=u2([e,t,s,1],[a,c,l],1,[r,o,i],n,d);p=x[0],f=x[1],m=x[2]}else if(n==="same"){p=Math.ceil(e/r),f=Math.ceil(t/o),m=Math.ceil(s/i);const g=(p-1)*r+a-e,x=(f-1)*o+c-t,y=(m-1)*i+l-s,b=Math.floor(g/2),v=g-b,w=Math.floor(x/2),S=x-w,N=Math.floor(y/2),C=y-N;h={top:w,bottom:S,left:N,right:C,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:p,outHeight:f,outWidth:m}}function tc(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function li(n){const[e,t,s]=ec(n);return e===1&&t===1&&s===1}function ts(n,e){return li(n)||li(e)}function ui(n){return ec(n).every(e=>e>0)}function io(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function ws(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")E(sa(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{E(sa(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2(n,e){const s={x:W(n,"x","reshape","string_or_numeric")},r={shape:e};return Y.runKernel(Pd,s,r)}const ne=se({reshape_:p2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2(n,e,t,s,r){const o=W(n,"x","avgPool","float32"),i=1;E(ts(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,c=!1;o.rank===3&&(c=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]])),E(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),ws("avgPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let h=Y.runKernel(Yu,l,d);return h=Xe(h,o.dtype),c?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const rm=se({avgPool_:f2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m2(n,e,t,s,r,o="NDHWC"){const i=W(n,"x","avgPool3d","float32");let a=i,c=!1;i.rank===4&&(c=!0,a=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),E(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),E(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),E(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),ws("avgPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let h=Y.runKernel(Ju,l,d);return h=Xe(h,a.dtype),c?ne(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const g2=se({avgPool3d_:m2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(n,e=0){E(n.length>=1,()=>"Pass at least one tensor to concat");const t=qb(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return ei(t[0]);const s=t,r={axis:e};return Y.runKernel(nd,s,r)}const xs=se({concat_:x2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y2(n,e,t=!1,s=!1){let r=W(n,"a","matMul"),o=W(e,"b","matMul");[r,o]=$n(r,o);const i={a:r,b:o},a={transposeA:t,transposeB:s};return Y.runKernel(Zu,i,a)}const Xt=se({matMul_:y2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b2(n){const t={x:W(n,"x","sigmoid","float32")};return Y.runKernel(nl,t)}const wa=se({sigmoid_:b2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2(n,e,t){const s=W(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return Y.runKernel(zd,r,o)}const dn=se({slice_:w2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2(n){const t={x:W(n,"x","tanh","float32")};return Y.runKernel(cl,t)}const Yd=se({tanh_:v2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(n,e,t){const s=W(n,"x","batchToSpaceND"),r=e.reduce((a,c)=>a*c);E(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),E(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),E(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return Y.runKernel(ed,o,i)}const om=se({batchToSpaceND_:S2});function C2(n){let e;return n.rank===0||n.rank===1?e=ne(n,[1,1,1,n.size]):n.rank===2?e=ne(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ne(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N2(n,e,t,s,r,o){o==null&&(o=.001);const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;s!=null&&(d=W(s,"offset","batchNorm")),E(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:C2(i),scale:l,offset:d,mean:a,variance:c},f={varianceEpsilon:o},m=Y.runKernel(dd,p,f);return ne(m,i.shape)}const Jd=se({batchNorm_:N2});function I2(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),E(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),E(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),E(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&E(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),d!=null&&E(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Jd(i,a,c,d,l,o)}const k2=se({batchNorm2d_:I2});function $2(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),E(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),E(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),E(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&E(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),d!=null&&E(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Jd(i,a,c,d,l,o)}const T2=se({batchNorm3d_:$2});function A2(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),E(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),E(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),E(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&E(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),d!=null&&E(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Jd(i,a,c,d,l,o)}const E2=se({batchNorm4d_:A2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R2(n,e,t){const s=W(n,"x","bincount"),r=W(e,"weights","bincount");E(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),E(t>=0,()=>`size must be non-negative, but got ${t}.`),E(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return Y.runKernel(xf,o,i)}const D2=se({bincount_:R2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2(n,e){let t=W(n,"broadcastTo","x");const s=t.shape;if(ro(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=ne(t,l)}const r=t.shape,o=Array.from(e);for(let l=e.length-1;l>=0;l--)if(r[l]===e[l])o[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((l,d)=>l>1?d:-1).filter(l=>l>=0).length===0)return ei(t);const a={x:t},c={reps:o};return Y.runKernel(ll,a,c)}const Xa=se({broadcastTo_:j2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _2(n){const t={x:W(n,"x","ceil","float32")};return Y.runKernel(Nc,t)}const P2=se({ceil_:_2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zd(n,e,t){ro(n),t=t||xa(e);const s={shape:n,value:e,dtype:t};return Y.runKernel(Df,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M2(n,e,t){const s=W(n,"x","clipByValue");if(E(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Zd(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return Y.runKernel(Ic,r,o)}const Ls=se({clipByValue_:M2});function F2(n){return xs(n,0)}const O2=se({concat1d_:F2});function L2(n,e){return xs(n,e)}const z2=se({concat2d_:L2});function W2(n,e){return xs(n,e)}const B2=se({concat3d_:W2});function V2(n,e){return xs(n,e)}const U2=se({concat4d_:V2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2(n,e,t,s,r="NHWC",o=[1,1],i){const a=W(n,"x","conv2d","float32"),c=W(e,"filter","conv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),E(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),ws("conv2d",s,i);const h=r==="NHWC"?l.shape[3]:l.shape[1];E(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),E(ts(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),E(ui(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),E(ui(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:l,filter:c},f={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=Y.runKernel(sd,p,f);return d?ne(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const di=se({conv2d_:G2});function H2(n,e,t,s,r="NWC",o=1,i){const a=W(n,"x","conv1d"),c=W(e,"filter","conv1d");let l=a,d=!1;a.rank===2&&(d=!0,l=ne(a,[1,a.shape[0],a.shape[1]])),E(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),E(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),ws("conv1d",s,i),E(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),E(ts(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),E(ui(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),E(ui(t),()=>"Error in conv1D: Stride should be larger than 0."),E(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=ne(c,[1,c.shape[0],c.shape[1],c.shape[2]]),p=ne(l,[l.shape[0],1,l.shape[1],l.shape[2]]),x=di(p,h,[1,t],s,"NHWC",[1,o],i);return d?ne(x,[x.shape[2],x.shape[3]]):ne(x,[x.shape[0],x.shape[2],x.shape[3]])}const sw=se({conv1d_:H2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2(n,e,t,s,r,o="NHWC",i){E(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,c=e,l=!1;e.rank===3&&(l=!0,c=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),E(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),E(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),E(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?c.shape[3]:c.shape[1];E(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),E(h===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[3]}.`),ws("conv2dDerInput",r,i);const p={dy:c,filter:t},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},m=Y.runKernel(rd,p,f);return l?ne(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const im=se({conv2DBackpropInput_:q2});function K2(n,e,t,s,r,o){const i=W(n,"x","conv2dTranspose"),a=W(e,"filter","conv2dTranspose");return im(t,i,a,s,r,"NHWC",o)}const rw=se({conv2dTranspose_:K2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q2(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=W(n,"x","conv3d"),a=W(e,"filter","conv3d");let c=i,l=!1;i.rank===4&&(l=!0,c=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),E(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),E(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),E(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),E(ts(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),E(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),E(ui(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),E(ui(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:c,filter:a},h={strides:t,pad:s,dataFormat:r,dilations:o},p=Y.runKernel(od,d,h);return l?ne(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const X2=se({conv3d_:Q2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2(n,e,t,s,r){E(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=ne(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const c=o[4],l=i.shape[4];E(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),E(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),E(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),E(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),E(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},h={pad:r,strides:s,inputShape:o},p=Y.runKernel(Sf,d,h);return a?ne(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const ow=se({conv3DBackpropInput_:Y2});function J2(n,e,t,s,r){const o=W(n,"x","conv3dTranspose"),i=W(e,"filter","conv3dTranspose");return ow(t,o,i,s,r)}const Z2=se({conv3dTranspose_:J2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(n){const t={x:W(n,"x","cos","float32")};return Y.runKernel(kc,t)}const am=se({cos_:eT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tT(n){const t={x:W(n,"x","cosh","float32")};return Y.runKernel($c,t)}const iw=se({cosh_:tT});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nT(n,e=0,t=!1,s=!1){const o={x:W(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return Y.runKernel(Cf,o,i)}const Dp=se({cumprod_:nT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sT(n,e=0,t=!1,s=!1){const o={x:W(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return Y.runKernel(id,o,i)}const aw=se({cumsum_:sT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rT(n,e,t,s=!1){const r=W(n,"x","denseBincount"),o=W(e,"weights","denseBincount");E(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),E(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),E(t>=0,()=>`size must be non-negative, but got ${t}.`),E(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:t,binaryOutput:s};return Y.runKernel(If,i,a)}const Y0=se({denseBincount_:rT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(n,e,t="NHWC"){const s=W(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];E(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),E(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),E(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),E(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},c={blockSize:e,dataFormat:t};return Y.runKernel(kf,a,c)}const iT=se({depthToSpace_:oT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aT(n,e,t,s,r="NHWC",o=[1,1],i){const a=W(n,"x","depthwiseConv2d","float32"),c=W(e,"filter","depthwiseConv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),E(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=r==="NHWC"?l.shape[3]:l.shape[1];E(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),ws("depthwiseConv2d",s,i);const p={x:l,filter:c},f={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=Y.runKernel(ad,p,f);return d?ne(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const cm=se({depthwiseConv2d_:aT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cT(n,e,t,s,r=[1,1],o="NHWC"){const i=W(n,"x","dilation2d"),a=W(e,"filter","dilation2d");E(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),E(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),E(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let c=i,l=!1;i.rank===3&&(c=ne(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),E(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);const d={x:c,filter:a},h={strides:t,pad:s,dilations:r},p=Y.runKernel(cd,d,h);return l?ne(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const lT=se({dilation2d_:cT});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aa(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function zn(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function At(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[t-r-1]=i;else if(i===1)s[t-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uT(n,e){let t=W(n,"a","equal","string_or_numeric"),s=W(e,"b","equal","string_or_numeric");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(ld,r)}const zr=se({equal_:uT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dT(n,e,t){const s=W(e,"a","where"),r=W(t,"b","where"),o=W(n,"condition","where","bool"),i=At(At(o.shape,s.shape),r.shape),a=Xa(o,i),c=Xa(s,i),l=Xa(r,i),d={condition:a,t:c,e:l};return Y.runKernel(Ld,d)}const cs=se({where_:dT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hT(n){const t={x:W(n,"x","zerosLike")};return Y.runKernel(qd,t)}const Ht=se({zerosLike_:hT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pT(n,e){let t=W(n,"a","div"),s=W(e,"b","div");[t,s]=$n(t,s);const r=xt(t,s),o=Ht(r),i=zr(s,o);return cs(i,o,r)}const fT=se({divNoNan_:pT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(n,e){const t=W(n,"t1","dot"),s=W(e,"t2","dot");E((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(E(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=ne(t,[1,-1]),a=ne(s,[-1,1]),c=Xt(i,a);return ne(c,[])}else if(t.rank===1&&s.rank===2){const i=ne(t,[1,-1]),a=ne(s,[s.shape[0],s.shape[1]]),c=Xt(i,a);return ne(c,[c.size])}else if(t.rank===2&&s.rank===1){const i=ne(s,[-1,1]),a=Xt(t,i);return ne(a,[a.size])}else{const i=ne(s,[s.shape[0],s.shape[1]]);return Xt(t,i)}}const gT=se({dot_:mT});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(n,...e){const t=e.map((r,o)=>W(r,`tensors${o}`,"einsum")),s={equation:n};return Y.runKernel(Af,t,s)}const Pa=se({einsum_:xT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(n){const t={x:W(n,"x","elu","float32")};return Y.runKernel(Ac,t)}const eh=se({elu_:yT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(n){let e=W(n,"x","erf");E(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Xe(e,"float32"));const t={x:e};return Y.runKernel(Ec,t)}const cw=se({erf_:bT});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lm(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function lw(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[i++]);return r}function Hn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function Dn(n,e){const t=e.map(s=>1);return lw(n,t,e)}function Xn(n,e,t){E(lm(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Sn(n,e){if(lm(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function _o(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Tn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wT(n,e=null,t=!1){const r={x:W(n,"x","max")},o={reductionIndices:e,keepDims:t};return Y.runKernel(vd,r,o)}const gr=se({max_:wT});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vT(n,e=null,t=!1){const r={x:W(n,"x","min")},o={axis:e,keepDims:t};return Y.runKernel(Id,r,o)}const du=se({min_:vT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ST(n,e){let t=W(n,"base","pow"),s=W(e,"exp","pow");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(Hc,r)}const hi=se({pow_:ST});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yt(n,e){if((Zs(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Zs(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xd(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CT(n){const t={x:W(n,"x","sqrt","float32")};return Y.runKernel(rl,t)}const es=se({sqrt_:CT});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(n){const e=W(n,"x","square"),t={};return Y.runKernel("Square",{x:e},t)}const pn=se({square_:NT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IT(n,e=null,t=!1){let s=W(n,"x","sum");s.dtype==="bool"&&(s=Xe(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Y.runKernel(Wd,r,o)}const gt=se({sum_:IT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kT(n,e="euclidean",t=null,s=!1){n=W(n,"x","norm");const r=uw(n,e,t);let o=r.shape;if(s){const i=Lt(t,n.shape);o=Dn(r.shape,i)}return ne(r,o)}function uw(n,e,t=null){if(n.rank===0)return os(n);if(n.rank!==1&&t===null)return uw(ne(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return gt(os(n),t);if(e===1/0)return gr(os(n),t);if(e===-1/0)return du(os(n),t);if(e==="euclidean"||e===2)return es(gt(hi(os(n),Yt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return gr(gt(os(n),t[0]),t[1]-1);if(e===1/0)return gr(gt(os(n),t[1]),t[0]);if(e===-1/0)return du(gt(os(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return es(gt(pn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const th=se({norm_:kT});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $T(n,e=null,t=!1){return th(n,"euclidean",e,t)}const TT=se({euclideanNorm_:$T});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AT(n){const t={x:W(n,"x","exp")};return Y.runKernel(Rc,t)}const Wr=se({exp_:AT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ET(n,e=0){const t=W(n,"x","expandDims","string_or_numeric");E(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return Y.runKernel(ud,s,r)}const fs=se({expandDims_:ET});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RT(n){const t={x:W(n,"x","expm1")};return Y.runKernel(Dc,t)}const DT=se({expm1_:RT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jT(n,e){const t=W(n,"x","tile","string_or_numeric");E(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return Y.runKernel(ll,s,r)}const fr=se({tile_:jT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _T(n,e,t,s="float32"){e==null&&(e=n);const r=Ot([n,e],s),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=ne(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return fr(fs(i,0),[t[0],1,1]);if(t.length===2)return fr(fs(fs(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return fr(fs(fs(fs(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const dw=se({eye_:_T});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(n){const t={x:W(n,"x","floor","float32")};return Y.runKernel(jc,t)}const nh=se({floor_:PT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MT(n,e,t=0,s=0){const r=W(n,"x","gather"),o=W(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:t,batchDims:s};return Y.runKernel(hd,i,a)}const um=se({gather_:MT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FT(n,e){let t=W(n,"a","greater","string_or_numeric"),s=W(e,"b","greater","string_or_numeric");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(pd,r)}const zs=se({greater_:FT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OT(n,e){let t=W(n,"a","greaterEqual","string_or_numeric"),s=W(e,"b","greaterEqual","string_or_numeric");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Pc,r)}const Si=se({greaterEqual_:OT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(n){const t={input:W(n,"input","imag")};return Y.runKernel(Pf,t)}const dm=se({imag_:LT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zT(n){const t={x:W(n,"x","isFinite")};return Y.runKernel(Fc,t)}const WT=se({isFinite_:zT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BT(n){const t={x:W(n,"x","isInf")};return Y.runKernel(Oc,t)}const VT=se({isInf_:BT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(n){const t={x:W(n,"x","isNaN")};return Y.runKernel(Lc,t)}const GT=se({isNaN_:UT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HT(n,e=.2){const s={x:W(n,"x","leakyRelu")},r={alpha:e};return Y.runKernel(fd,s,r)}const hm=se({leakyRelu_:HT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qT(n,e){let t=W(n,"a","less","string_or_numeric"),s=W(e,"b","less","string_or_numeric");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(md,r)}const hu=se({less_:qT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KT(n,e){let t=W(n,"a","lessEqual","string_or_numeric"),s=W(e,"b","lessEqual","string_or_numeric");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(gd,r)}const va=se({lessEqual_:KT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QT(n,e=5,t=1,s=1,r=.5){const o=W(n,"x","localResponseNormalization");E(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),E(sa(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={x:i},l={depthRadius:e,bias:t,alpha:s,beta:r},d=Y.runKernel(wd,c,l);return a?ne(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const XT=se({localResponseNormalization_:QT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(n){const t={x:W(n,"x","log","float32")};return Y.runKernel(zc,t)}const Br=se({log_:YT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JT(n){const t={x:W(n,"x","log1p")};return Y.runKernel(Wc,t)}const hw=se({log1p_:JT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(n,e){E(mp(n),()=>"The f passed in variableGrads(f) must be a function"),E(e==null||Array.isArray(e)&&e.every(l=>l instanceof lu),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const l in Y.registeredVariables)e.push(Y.registeredVariables[l])}const s=t?e.filter(l=>!l.trainable):null,r=e.length;e=e.filter(l=>l.trainable),E(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=Y.gradients(n,e,null,o);E(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),E(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const c={};return e.forEach((l,d)=>{a[d]!=null&&(c[l.name]=a[d])}),s!=null&&s.forEach(l=>c[l.name]=null),{value:i,grads:c}}function ca(n){return Y.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(n){const t={x:W(n,"x","neg")};return Y.runKernel($d,t)}const kn=se({neg_:eA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(n){const t={x:W(n,"x","softplus")};return Y.runKernel(sl,t)}const hl=se({softplus_:tA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(n){const e=W(n,"x","logSigmoid");return ca(s=>({value:kn(hl(kn(s))),gradFunc:i=>K(i,wa(kn(s)))}))(e)}const sA=se({logSigmoid_:nA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(n,e){let t=W(n,"a","sub"),s=W(e,"b","sub");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(il,r)}const bt=se({sub_:rA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oA(n,e=-1){const t=W(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return ca((r,o)=>{const a=gr(r,e,!0),c=bt(r,a),l=bt(Xe(c,"float32"),Br(gt(Wr(c),e,!0)));return o([l]),{value:l,gradFunc:(h,p)=>{const[f]=p,m=!0,g=Wr(f);return bt(h,K(gt(h,e,m),g))}}})(t)}const pw=se({logSoftmax_:oA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(n,e=null,t=!1){const s=W(n,"x","logSumExp"),r=Lt(e,s.shape),o=gr(s,r,!0),i=bt(s,o),a=Wr(i),c=gt(a,r),l=Br(c),d=Ee(ne(o,l.shape),l);if(t){const h=Dn(d.shape,r);return ne(d,h)}return d}const fw=se({logSumExp_:iA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aA(n,e){const t=W(n,"a","logicalAnd","bool"),s=W(e,"b","logicalAnd","bool");At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(xd,r)}const Zr=se({logicalAnd_:aA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(n){const t={x:W(n,"x","logicalNot","bool")};return Y.runKernel(yd,t)}const pm=se({logicalNot_:cA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lA(n,e){const t=W(n,"a","logicalOr","bool"),s=W(e,"b","logicalOr","bool");At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(bd,r)}const mw=se({logicalOr_:lA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(n,e){const t=W(n,"a","logicalXor","bool"),s=W(e,"b","logicalXor","bool");return At(t.shape,s.shape),Zr(mw(n,e),pm(Zr(n,e)))}const dA=se({logicalXor_:uA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hA(n,e,t,s,r){const o=W(n,"x","maxPool"),i=1;let a=o,c=!1;o.rank===3&&(c=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]])),E(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),E(ts(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ws("maxPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},h=Y.runKernel(Sd,l,d);return c?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const fm=se({maxPool_:hA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=W(n,"x","maxPool3d");let a=i,c=!1;i.rank===4&&(c=!0,a=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),E(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),E(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),ws("maxPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},h=Y.runKernel(Cd,l,d);return c?ne(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const fA=se({maxPool3d_:pA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n,e){let t=W(n,"a","maximum"),s=W(e,"b","maximum");[t,s]=$n(t,s),t.dtype==="bool"&&(t=Xe(t,"int32"),s=Xe(s,"int32")),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Bc,r)}const Po=se({maximum_:mA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gA(n,e=null,t=!1){const r={x:W(n,"x","mean")},o={axis:e,keepDims:t};return Y.runKernel(Nd,r,o)}const Rn=se({mean_:gA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(n,e="float32"){if(ro(n),e==="complex64"){const s=Un(n,"float32"),r=Un(n,"float32");return ii(s,r)}const t=Zn(we(n),e);return Y.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mo(n,e="float32"){if(ro(n),e==="complex64"){const s=Mo(n,"float32"),r=Un(n,"float32");return ii(s,r)}const t=lf(we(n),e);return Y.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(n,e){let t=W(n,"a","minimum"),s=W(e,"b","minimum");[t,s]=$n(t,s),t.dtype==="bool"&&(t=Xe(t,"int32"),s=Xe(s,"int32")),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Vc,r)}const nc=se({minimum_:xA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(n,e,t){E(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=W(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");E(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)E(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),E(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return Y.runKernel(kd,i,o)}const bA=se({mirrorPad_:yA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(n,e){let t=W(n,"a","mod"),s=W(e,"b","mod");[t,s]=$n(t,s);const r={a:t,b:s};return Y.runKernel(Uc,r)}const vA=se({mod_:wA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n,e=null,t=!1){n=W(n,"x","moments");const s=Lt(e,n.shape),r=Rn(n,s,t);let o=r.shape;t||(o=Dn(r.shape,s));const i=pn(bt(Xe(n,"float32"),ne(r,o))),a=Rn(i,s,t);return{mean:r,variance:a}}const mm=se({moments_:SA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CA(n,e){let t=W(n,"a","notEqual","string_or_numeric"),s=W(e,"b","notEqual","string_or_numeric");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Td,r)}const pu=se({notEqual_:CA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:W(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return Y.runKernel(Ed,i,a)}const gw=se({oneHot_:NA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IA(n){const t={x:W(n,"x","onesLike")};return Y.runKernel(Ad,t)}const er=se({onesLike_:IA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kA(n,e,t=0){const s=W(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return Y.runKernel(Dd,o,r)}const gm=se({pad_:kA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n,e,t){const s=W(n,"x","spaceToBatchND");E(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),E(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),E(s.shape.reduce((i,a,c)=>c>0&&c<=e.length?i&&(a+t[c-1][0]+t[c-1][1])%e[c-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return Y.runKernel(Bd,r,o)}const xm=se({spaceToBatchND_:$A});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=W(n,"x","maxPool");let c=a,l=!1;a.rank===3&&(l=!0,c=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(ts(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=tr(c.shape,e,o,r,s),h=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=EA([d.filterHeight,d.filterWidth],h):p=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[m,g]=AA([d.inHeight,d.inWidth],h,p),x=f?s:"valid",y=f?c:xm(c,h,m),v=(t==="avg"?()=>rm(y,e,o,x,i):()=>fm(y,e,o,x,i))(),w=f?v:om(v,h,g);return l?ne(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function AA(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,h)=>(d-o[h]%d)%d),a=r.map((d,h)=>d+i[h]),c=e.map((d,h)=>[s[h],a[h]]),l=e.map((d,h)=>[0,i[h]]);return[c,l]}function EA(n,e){const s=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const RA=se({pool_:TA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n,e){const t=W(n,"x","prelu"),s=W(e,"alpha","prelu"),r={x:t,alpha:s};return Y.runKernel(jd,r)}const ym=se({prelu_:DA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jA(n,e=null,t=!1){let s=W(n,"x","prod");s.dtype==="bool"&&(s=Xe(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Y.runKernel(_d,r,o)}const _A=se({prod_:jA});var bm={exports:{}};bm.exports;(function(n){(function(e,t,s){function r(c){var l=this,d=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=d(" "),l.s1=d(" "),l.s2=d(" "),l.s0-=d(c),l.s0<0&&(l.s0+=1),l.s1-=d(c),l.s1<0&&(l.s1+=1),l.s2-=d(c),l.s2<0&&(l.s2+=1),d=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function i(c,l){var d=new r(c),h=l&&l.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,h&&(typeof h=="object"&&o(h,d),p.state=function(){return o(d,{})}),p}function a(){var c=4022871197,l=function(d){d=String(d);for(var h=0;h<d.length;h++){c+=d.charCodeAt(h);var p=.02519603282416938*c;c=p>>>0,p-=c,p*=c,c=p>>>0,p-=c,c+=p*4294967296}return(c>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=i:this.alea=i})(bi,n)})(bm);var PA=bm.exports,wm={exports:{}};wm.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor128=i})(bi,n)})(wm);var MA=wm.exports,vm={exports:{}};vm.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,d==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorwow=i})(bi,n)})(vm);var FA=vm.exports,Sm={exports:{}};Sm.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.x,h=c.i,p,f;return p=d[h],p^=p>>>7,f=p^p<<24,p=d[h+1&7],f^=p^p>>>10,p=d[h+3&7],f^=p^p>>>3,p=d[h+4&7],f^=p^p<<7,p=d[h+7&7],p=p^p<<13,f^=p^p<<9,d[h]=f,c.i=h+1&7,f};function l(d,h){var p,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,p=0;p<h.length;++p)f[p&7]=f[p&7]<<15^h.charCodeAt(p)+f[p+1&7]<<13;for(;f.length<8;)f.push(0);for(p=0;p<8&&f[p]===0;++p);for(p==8?f[7]=-1:f[p],d.x=f,d.i=0,p=256;p>0;--p)d.next()}l(c,a)}function o(a,c){return c.x=a.x.slice(),c.i=a.i,c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.x&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorshift7=i})(bi,n)})(Sm);var OA=Sm.exports,Cm={exports:{}};Cm.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.w,h=c.X,p=c.i,f,m;return c.w=d=d+1640531527|0,m=h[p+34&127],f=h[p=p+1&127],m^=m<<13,f^=f<<17,m^=m>>>15,f^=f>>>12,m=h[p]=m^f,c.i=p,m+(d^d>>>16)|0};function l(d,h){var p,f,m,g,x,y=[],b=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,b=Math.max(b,h.length)),m=0,g=-32;g<b;++g)h&&(f^=h.charCodeAt((g+32)%h.length)),g===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(x=x+1640531527|0,p=y[g&127]^=f+x,m=p==0?m+1:0);for(m>=128&&(y[(h&&h.length||0)&127]=-1),m=127,g=4*128;g>0;--g)f=y[m+34&127],p=y[m=m+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,y[m]=f^p;d.w=x,d.X=y,d.i=m}l(c,a)}function o(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.X&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor4096=i})(bi,n)})(Cm);var LA=Cm.exports,Nm={exports:{}};Nm.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.b,p=c.c,f=c.d,m=c.a;return h=h<<25^h>>>7^p,p=p-f|0,f=f<<24^f>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^p,c.c=p=p-f|0,c.d=f<<16^p>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var d=0;d<l.length+20;d++)c.b^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.tychei=i})(bi,n)})(Nm);var zA=Nm.exports,xw={exports:{}};const WA={},BA=Object.freeze(Object.defineProperty({__proto__:null,default:WA},Symbol.toStringTag,{value:"Module"})),VA=VI(BA);(function(n){(function(e,t,s){var r=256,o=6,i=52,a="random",c=s.pow(r,o),l=s.pow(2,i),d=l*2,h=r-1,p;function f(w,S,N){var C=[];S=S==!0?{entropy:!0}:S||{};var k=y(x(S.entropy?[w,v(t)]:w??b(),3),C),I=new m(C),T=function(){for(var _=I.g(o),D=c,P=0;_<l;)_=(_+P)*r,D*=r,P=I.g(1);for(;_>=d;)_/=2,D/=2,P>>>=1;return(_+P)/D};return T.int32=function(){return I.g(4)|0},T.quick=function(){return I.g(4)/4294967296},T.double=T,y(v(I.S),t),(S.pass||N||function(_,D,P,A){return A&&(A.S&&g(A,I),_.state=function(){return g(I,{})}),P?(s[a]=_,D):_})(T,k,"global"in S?S.global:this==s,S.state)}function m(w){var S,N=w.length,C=this,k=0,I=C.i=C.j=0,T=C.S=[];for(N||(w=[N++]);k<r;)T[k]=k++;for(k=0;k<r;k++)T[k]=T[I=h&I+w[k%N]+(S=T[k])],T[I]=S;(C.g=function(_){for(var D,P=0,A=C.i,F=C.j,O=C.S;_--;)D=O[A=h&A+1],P=P*r+O[h&(O[A]=O[F=h&F+D])+(O[F]=D)];return C.i=A,C.j=F,P})(r)}function g(w,S){return S.i=w.i,S.j=w.j,S.S=w.S.slice(),S}function x(w,S){var N=[],C=typeof w,k;if(S&&C=="object")for(k in w)try{N.push(x(w[k],S-1))}catch{}return N.length?N:C=="string"?w:w+"\0"}function y(w,S){for(var N=w+"",C,k=0;k<N.length;)S[h&k]=h&(C^=S[h&k]*19)+N.charCodeAt(k++);return v(S)}function b(){try{var w;return p&&(w=p.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),v(w)}catch{var S=e.navigator,N=S&&S.plugins;return[+new Date,e,N,e.screen,v(t)]}}function v(w){return String.fromCharCode.apply(0,w)}if(y(s.random(),t),n.exports){n.exports=f;try{p=VA}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:bi,[],Math)})(xw);var UA=xw.exports,GA=PA,HA=MA,qA=FA,KA=OA,QA=LA,XA=zA,Ci=UA;Ci.alea=GA;Ci.xor128=HA;Ci.xorwow=qA;Ci.xorshift7=KA;Ci.xor4096=QA;Ci.tychei=XA;var Im=Ci;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yw{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Im.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class YA{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Im.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(n,e=0,t=1,s,r){if(ro(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new yw(e,t,s,!1,r),i=Ot(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const ZA=se({randomNormal_:JA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eE(n,e=0,t=1,s="float32",r){ro(n);const o=Ot(n,s),i=new YA(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const pl=se({randomUniform_:eE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sc(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return Y.runKernel(Bf,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tE(n){const t={input:W(n,"input","real")};return Y.runKernel(Vf,t)}const fu=se({real_:tE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nE(n){const t={x:W(n,"x","reciprocal")};return Y.runKernel(qc,t)}const sE=se({reciprocal_:nE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(n){const t={x:W(n,"x","relu")};return Y.runKernel(Kc,t)}const Ni=se({relu_:rE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(n){const t={x:W(n,"x","relu6")};return Y.runKernel(Qc,t)}const bw=se({relu6_:oE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iE(n,e){const s={x:W(n,"x","reverse")},r={dims:e};return Y.runKernel(Od,s,r)}const pi=se({reverse_:iE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(n){const t={x:W(n,"x","round")};return Y.runKernel(Xc,t)}const ww=se({round_:aE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cE(n){const t={x:W(n,"x","rsqrt","float32")};return Y.runKernel(Yc,t)}const vw=se({rsqrt_:cE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(n){const t={x:W(n,"x","selu")};return Y.runKernel(Jc,t)}const Sw=se({selu_:lE});function uE(n,e,t,s,r,o=[1,1],i="NHWC"){const a=W(n,"x","separableConv2d"),c=W(e,"depthwiseFilter","separableConv2d"),l=W(t,"pointwiseFilter","separableConv2d");let d=a,h=!1;if(a.rank===3&&(h=!0,d=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),E(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),E(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),E(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),E(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const p=c.shape[2],f=c.shape[3];E(l.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${l.shape[2]}.`);const m=cm(d,c,s,r,i,o),x=di(m,l,1,"valid",i);return h?ne(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Cw=se({separableConv2d_:uE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dE(n){const t={x:W(n,"x","sign")};return Y.runKernel(tl,t)}const hE=se({sign_:dE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pE(n){const t={x:W(n,"x","sin","float32")};return Y.runKernel(Zc,t)}const Nw=se({sin_:pE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fE(n){const t={x:W(n,"x","sinh")};return Y.runKernel(el,t)}const Iw=se({sinh_:fE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mE(n,e,t){const s=W(n,"x","slice1d");return E(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),dn(s,[e],[t])}const km=se({slice1d_:mE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(n,e,t){const s=W(n,"x","slice2d");return E(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),dn(s,e,t)}const kw=se({slice2d_:gE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xE(n,e,t){const s=W(n,"x","slice3d");return E(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),dn(s,e,t)}const $m=se({slice3d_:xE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(n,e,t){const s=W(n,"x","slice4d");return E(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),dn(s,e,t)}const mu=se({slice4d_:yE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bE(n,e=-1){const t=W(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return Y.runKernel(Ud,s,r)}const Tm=se({softmax_:bE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wE(n){E(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Y.runKernel(Rf,e)}const $w=se({fft_:wE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(n){E(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Y.runKernel(_f,e)}const jp=se({ifft_:vE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SE(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ne(n,[t,e]);s=jp(r)}else{const r=[t,2*(e-1)],o=ne(fu(n),[t,e]),i=ne(dm(n),[t,e]),a=pi(dn(o,[0,1],[t,e-2]),1),c=K(pi(dn(i,[0,1],[t,e-2]),1),Yt(-1)),l=xs([o,a],1),d=xs([i,c],1),h=ne(ii(l,d),[r[0],r[1]]);s=jp(h)}if(s=fu(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=ne(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const CE=se({irfft_:SE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(n,e,t=0){const r={x:W(n,"x","split")},o={numOrSizeSplits:e,axis:t};return Y.runKernel(Vd,r,o)}const Os=se({split_:NE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(n,e){E(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const m=n.shape.map(x=>0),g=n.shape.map(x=>x);g[n.shape.length-1]=e,r=dn(n,m,g),t=e}else if(e!=null&&e>t){const m=n.shape.map(g=>g);m[n.shape.length-1]=e-t,r=xs([n,Un(m)],n.shape.length-1),t=e}else r=n;const o=Ht(r),i=ne(ii(r,o),[s,t]),a=$w(i),c=Math.floor(t/2)+1,l=fu(a),d=dm(a),h=Os(l,[c,t-c],l.shape.length-1),p=Os(d,[c,t-c],d.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=c,ne(ii(h[0],p[0]),f)}const kE=se({rfft_:IE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(n,e){let t=W(n,"a","squaredDifference"),s=W(e,"b","squaredDifference");[t,s]=$n(t,s),At(t.shape,s.shape);const r={a:t,b:s},o={};return Y.runKernel(ol,r,o)}const TE=se({squaredDifference_:$E});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(n,e){const t=W(n,"x","squeeze","string_or_numeric");return ne(t,Eo(t.shape,e).newShape)}const fl=se({squeeze_:AE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(n,e=0){const t=qb(n,"tensors","stack","string_or_numeric");E(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&E(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return Y.runKernel(Rd,s,r)}const eo=se({stack_:EE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RE(n,e=0){const s={x:W(n,"x","step")},r={alpha:e};return Y.runKernel(ul,s,r)}const ml=se({step_:RE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DE(n,e,t,s,r=0,o=0,i=0,a=0,c=0){const d={x:W(n,"x","stridedSlice","string_or_numeric")},h={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};return Y.runKernel(Kf,d,h)}const jE=se({stridedSlice_:DE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _E(n){const t={x:W(n,"x","tan","float32")};return Y.runKernel(al,t)}const PE=se({tan_:_E});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Es(n,e){Zy(n);const t=Qd(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xd(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(n,e,t){if(Zy(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Qd(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xd(n,e,s,t)}function Tw(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function ME(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Tw(t,e,n)}function Ii(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let h=r;h<o;++h)i*=t[h];const a=r<1?1:r,c=we(e.shape)/a,l=[...pt(t.slice(0,r)),1],d=we(t);return{sliceRank:r,numUpdates:c,sliceSize:i,strides:l,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FE(n,e=1,t=!0){const s=W(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[a,c]=Y.runKernel(Qf,o,i);return{values:a,indices:c}}const OE=se({topk_:FE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LE(n,e=0,t=1,s,r){if(ro(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new yw(e,t,s,!0,r),i=Ot(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Aw=se({truncatedNormal_:LE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(n,e=0){const t=W(n,"x","unique","string_or_numeric");E(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=Y.runKernel(Yf,s,r);return{values:o,indices:i}}const WE=se({unique_:zE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(n,e,t){const s=W(n,"x","unsortedSegmentSum"),r=W(e,"segmentIds","unsortedSegmentSum","int32");E(sa(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return Y.runKernel(Hd,o,i)}const Ew=se({unsortedSegmentSum_:BE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VE(n,e=0){const t=W(n,"x","unstack","string_or_numeric");E(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return Y.runKernel(Gd,s,r)}const fi=se({unstack_:VE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UE(n,e=!0,t,s){return Y.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rw(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=Ot(n,"int32"),r=Ot([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GE(n,e,t){const s=W(n,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),E(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{E(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?ae(()=>{let i=fu(s),a=dm(s);return i=Y.runKernel(Ki,{x:i},o),a=Y.runKernel(Ki,{x:a},o),t&&(a=kn(a)),ii(i,a)}):Y.runKernel(Ki,r,o)}const Gt=se({transpose_:GE});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(n,e){if(e==null)return n.shape.slice();if(Jt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(n,e,t,s){const r=W(n,"x","dropout");if(E(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),E(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Pn?r.clone():r;const o=HE(r,t),i=1-e,a=xt(nh(Ee(pl(o,0,1,"float32",s),i)),i);return K(r,a)}const KE=se({dropout_:qE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(n,e,t,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=ne(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]])),E(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),E(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),E(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const l=o==="NHWC"?a.shape[3]:a.shape[1],d=o==="NHWC"?c.shape[3]:c.shape[1];E(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),E(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),ws("conv2dDerFilter",r,i);const h={x:a,dy:c},p={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return Y.runKernel(wf,h,p)}const Am=se({conv2DBackpropFilter_:QE});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Em(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return K(n,ml(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Rm(n,e){let t=e;const s=zn(n.shape,e.shape);return s.length>0&&(t=gt(t,s)),ne(t,n.shape)}function Dm(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Ni(n);if(e==="elu")return eh(n);if(e==="relu6")return bw(n);if(e==="prelu")return ym(n,t);if(e==="leakyrelu")return hm(n,s);if(e==="sigmoid")return wa(n);throw new Error(`Unknown fused activation ${e}.`)}const jm=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:d}){if(c=c||"linear",jm(Y.state.gradientDepth,c)===!1){E(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=di(n,e,t,s,r,o,i);return a!=null&&(N=Ee(N,a)),Dm(N,c,l,d)}const h=W(n,"x","conv2d","float32"),p=W(e,"filter","conv2d","float32");let f=h,m=!1;h.rank===3&&(m=!0,f=ne(h,[1,h.shape[0],h.shape[1],h.shape[2]])),E(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),E(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),ws("fused conv2d",s,i);const g=r==="NHWC"?f.shape[3]:f.shape[1];E(p.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${p.shape[2]}.`),E(ts(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const x=Qn(f.shape,p.shape,t,o,s,i);let y;a!=null&&(y=W(a,"bias","fused conv2d"),[y]=$n(y,h),r==="NHWC"?At(x.outShape,y.shape):(E(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),E(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let b;if(l!=null){const N=l.shape;if(E(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)E(N[0]===1||N[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${x.outChannels}).`);else if(N.length===3)try{At(N,x.outShape)}catch{const k=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(k)}b=W(l,"prelu weights","fused conv2d")}const v=(N,C)=>{E(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[k,I,T,_]=C,D=Em(N,T,c);E(li(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const P=im(I.shape,D,k,t,s),A=Am(I,D,k.shape,t,s),F=[P,A];if(_!=null){const O=Rm(_,D);F.push(O)}return F},w={x:f,filter:p,bias:y,preluActivationWeights:b},S={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:c,leakyreluAlpha:d};return a==null?ca((C,k,I)=>{let T=Y.runKernel(iu,w,S);return I([k,C,T]),m&&(T=ne(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:v}})(f,p):ca((C,k,I,T)=>{let _=Y.runKernel(iu,w,S);return T([k,C,_,I]),m&&(_=ne(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:v}})(f,p,y)}const YE=se({fusedConv2d_:XE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n,e,t,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=ne(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:a,dy:c},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return Y.runKernel($f,l,d)}const ZE=se({depthwiseConv2dNativeBackpropFilter_:JE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(n,e,t,s,r,o=[1,1],i){let a=e,c=!1;e.rank===3&&(c=!0,a=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},h=Y.runKernel(Tf,l,d);return c?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const tR=se({depthwiseConv2dNativeBackpropInput_:eR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(jm(Y.state.gradientDepth,o)===!1){let _=Xt(n,e,t,s);return r!=null&&(_=Ee(_,r)),Dm(_,o,i,a)}let c=W(n,"a","fused matMul"),l=W(e,"b","fused matMul");[c,l]=$n(c,l);const d=t?c.shape[c.rank-2]:c.shape[c.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],p=t?c.shape[c.rank-1]:c.shape[c.rank-2],f=s?l.shape[l.rank-2]:l.shape[l.rank-1],m=c.shape.slice(0,-2),g=l.shape.slice(0,-2),x=we(m),y=we(g);E(d===h,()=>`Error in fused matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${t} and transposeB=${s} must match.`);const v=At(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([p,f]),w=t?ne(c,[x,d,p]):ne(c,[x,p,d]),S=s?ne(l,[y,f,h]):ne(l,[y,h,f]);let N;r!=null&&(N=W(r,"bias","fused matMul"),[N]=$n(N,c),At(v,N.shape));let C;i!=null&&(C=W(i,"prelu weights","fused matMul"));const k=(_,D)=>{const[P,A,F,O]=D,V=Em(ne(_,F.shape),F,o);let L,H;if(!t&&!s?(L=Xt(V,A,!1,!0),H=Xt(P,V,!0,!1)):!t&&s?(L=Xt(V,A,!1,!1),H=Xt(V,P,!0,!1)):t&&!s?(L=Xt(A,V,!1,!0),H=Xt(P,V,!1,!1)):(L=Xt(A,V,!0,!0),H=Xt(V,P,!0,!0)),r!=null){const J=Rm(O,V);return[L,H,J]}else return[L,H]},I={a:w,b:S,bias:N,preluActivationWeights:C},T={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?ca((D,P,A)=>{const F=Y.runKernel(ou,I,T);return A([D,P,F]),{value:ne(F,v),gradFunc:k}})(w,S):ca((D,P,A,F)=>{const O=Y.runKernel(ou,I,T);return F([D,P,O,A]),{value:ne(O,v),gradFunc:k}})(w,S,N)}const J0=se({fusedMatMul_:nR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR(n,e,t,s,r="bilinear",o=0){const i=W(n,"image","cropAndResize"),a=W(e,"boxes","cropAndResize","float32"),c=W(t,"boxInd","cropAndResize","int32"),l=a.shape[0];E(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),E(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),E(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),E(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),E(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),E(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:a,boxInd:c},h={method:r,extrapolationValue:o,cropSize:s};return Y.runKernel(Nf,d,h)}const rR=se({cropAndResize_:sR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(n){const e=W(n,"image","flipLeftRight","float32");E(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Y.runKernel(jf,t,{})}const iR=se({flipLeftRight_:oR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n){const e=W(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];E(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),E(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,fr(e,r)}const cR=se({grayscaleToRGB_:aR});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lR(n){const e=W(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];E(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),E(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=Xe(e,"float32"),i=Es([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Pa("ij,j->i",o,i);break;case 3:a=Pa("ijk,k->ij",o,i);break;case 4:a=Pa("ijkl,l->ijk",o,i);break;case 5:a=Pa("ijklm,m->ijkl",o,i);break;case 6:a=Pa("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=fs(a,-1),Xe(a,r)}const uR=se({rgbToGrayscale_:lR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dR(n,e,t=0,s=.5){const r=W(n,"image","rotateWithOffset","float32");E(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return Y.runKernel(Jf,o,i)}const hR=se({rotateWithOffset_:dR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sa(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),E(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),E(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),E(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),E(e.rank===1,()=>"scores must be a 1D tensor"),E(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),E(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=W(n,"boxes","nonMaxSuppression","float32"),i=W(e,"scores","nonMaxSuppression","float32"),a=Sa(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return Y.runKernel(Lf,{boxes:o,scores:i},c)}const fR=se({nonMaxSuppression_:pR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR(n,e,t){const s=gR(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function gR(n,e,t){return yR(n,e,t||xR)}function xR(n,e){return n>e?1:n<e?-1:0}function yR(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=t(e,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _m(n,e,t,s,r){return Fm(n,e,t,s,r,0)}function Pm(n,e,t,s,r,o){return Fm(n,e,t,s,r,0,!1,o,!0)}function Mm(n,e,t,s,r,o){return Fm(n,e,t,s,r,o,!0)}function Fm(n,e,t,s,r,o,i=!1,a=!1,c=!1){const l=[];for(let x=0;x<e.length;x++)e[x]>r&&l.push({score:e[x],boxIndex:x,suppressBeginIndex:0});l.sort(Z0);const d=o>0?-.5/o:0,h=[],p=[];for(;h.length<t&&l.length>0;){const x=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=x;if(y<r)break;let w=!1;for(let S=h.length-1;S>=v;--S){const N=bR(n,b,h[S]);if(N>=s){w=!0;break}if(x.score=x.score*wR(s,d,N),x.score<=r)break}x.suppressBeginIndex=h.length,w||(x.score===y?(h.push(b),p.push(x.score)):x.score>r&&mR(l,x,Z0))}const f=h.length,m=t-f;a&&m>0&&(h.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));const g={selectedIndices:h};return i&&(g.selectedScores=p),c&&(g.validOutputs=f),g}function bR(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),l=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),f=(a-o)*(c-i),m=(h-l)*(p-d);if(f<=0||m<=0)return 0;const g=Math.max(o,l),x=Math.max(i,d),y=Math.min(a,h),b=Math.min(c,p),v=Math.max(y-g,0)*Math.max(b-x,0);return v/(f+m-v)}function wR(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function Z0(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function vR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=W(n,"boxes","nonMaxSuppressionAsync"),i=W(e,"scores","nonMaxSuppressionAsync"),a=Sa(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c=await Promise.all([o.data(),i.data()]),l=c[0],d=c[1],{selectedIndices:h}=_m(l,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),Es(h,"int32")}const SR=vR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),c=Sa(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l={boxes:i,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},h=Y.runKernel(Wf,l,d);return{selectedIndices:h[0],selectedScores:h[1]}}const NR=se({nonMaxSuppressionWithScore_:CR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function IR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),c=Sa(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l=await Promise.all([i.data(),a.data()]),d=l[0],h=l[1],{selectedIndices:p,selectedScores:f}=Mm(d,h,t,s,r,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Es(p,"int32"),selectedScores:Es(f)}}const kR=IR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),c=Sa(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,p={boxes:i,scores:a},f={maxOutputSize:l,iouThreshold:d,scoreThreshold:h,padToMaxOutputSize:o},m=Y.runKernel(zf,p,f);return{selectedIndices:m[0],validOutputs:m[1]}}const TR=se({nonMaxSuppressionPadded_:$R});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function AR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),c=Sa(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,[p,f]=await Promise.all([i.data(),a.data()]),{selectedIndices:m,validOutputs:g}=Pm(p,f,l,d,h,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Es(m,"int32"),validOutputs:Yt(g,"int32")}}const ER=AR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RR(n,e,t=!1,s=!1){const r=W(n,"images","resizeBilinear");E(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),E(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),E(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=ne(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=Y.runKernel(Fd,a,c);return i?ne(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Dw=se({resizeBilinear_:RR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(n,e,t=!1,s=!1){const r=W(n,"images","resizeNearestNeighbor");E(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),E(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),E(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),E(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=ne(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=Y.runKernel(Md,a,c);return i?ne(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const jw=se({resizeNearestNeighbor_:DR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n,e="binary",t=!1,s=.5){const r=W(n,"image","threshold"),o=.2989,i=.587,a=.114,c=r.shape[0]*r.shape[1];let l=K(Es([s]),255),d,h,p,f;if(E(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),E(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),E(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),E(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,h,p]=Os(r,[1,1,1],-1);const x=K(d,o),y=K(h,i),b=K(p,a);f=Ee(Ee(x,y),b)}else f=n;if(e==="otsu"){const x=D2(Xe(ww(f),"int32"),Qi([]),256);l=_R(x,c)}const m=t?va(f,l):zs(f,l);return Xe(K(m,255),"int32")}function _R(n,e){let t=Es([-1]),s=Es([0]),r=Es([0]),o,i,a,c,l,d;for(let h=0;h<n.size-1;h++){o=dn(n,0,h+1),i=dn(n,h+1),l=xt(gt(o),e),d=xt(gt(i),e);const p=gt(K(o,sc(0,o.size)));a=xt(p,gt(o));const f=Zd(i.shape,o.size),m=Ee(sc(0,i.size),f),g=K(i,m);c=xt(gt(g),gt(i));const x=bt(a,c),y=bt(a,c),b=K(l,d);r=K(K(b,x),y);const v=zs(r,s);s=cs(v,r,s),t=cs(v,Es([h]),t)}return t}const PR=se({threshold_:jR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MR(n,e,t="nearest",s="constant",r=0,o){const i=W(n,"image","transform","float32"),a=W(e,"transforms","transform","float32");E(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),E(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),E(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const c={image:i,transforms:a},l={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return Y.runKernel(Xf,c,l)}const FR=se({transform_:MR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(n,e,t){const s=W(n,"a","bandPart");E(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,c;typeof e=="number"?(E(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),E(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=W(e<0?o:e,"numLower","bandPart")):(E(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=cs(hu(e,0),o,nc(e,o))),typeof t=="number"?(E(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),E(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),c=W(t<0?i:t,"numUpper","bandPart")):(E(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=cs(hu(t,0),i,nc(t,i)));const l=ne(sc(0,o,1,"int32"),[-1,1]),d=sc(0,i,1,"int32"),h=bt(l,d),p=Zr(va(h,a),Si(h,kn(c))),f=Un([o,i],s.dtype);return ne(eo(fi(ne(s,[-1,o,i])).map(m=>cs(p,m,f))),r)}const LR=se({bandPart_:OR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n){let e;if(Array.isArray(n)){e=!1,E(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)E(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Os(n,n.shape[0],0).map(r=>fl(r,[0]));E(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(Y.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=K(gt(K(t[i],o)),t[i]);o=bt(o,a)}return xt(o,th(o,"euclidean"))}));return e?eo(t,0):t}const WR=se({gramSchmidt_:zR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n,e=!1){if(E(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return ex(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((c,l)=>c*l),s=fi(ne(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(c=>{const[l,d]=ex(c,e);r.push(l),o.push(d)});const i=ne(eo(r,0),n.shape),a=ne(eo(o,0),n.shape);return[i,a]}}function ex(n,e=!1){return Y.tidy(()=>{E(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=dw(t),o=ei(n);const i=Yi([[1]],[1,1]);let a=ei(i);const c=t>=s?s:t;for(let l=0;l<c;++l){const d=o,h=a,p=r;[a,o,r]=Y.tidy(()=>{const f=dn(o,[l,l],[t-l,1]),m=th(f),g=dn(o,[l,l],[1,1]),x=cs(zs(g,0),Yi([[-1]]),Yi([[1]])),y=bt(g,K(x,m)),b=xt(f,y);b.shape[0]===1?a=ei(i):a=xs([i,dn(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const v=kn(xt(Xt(x,y),m)),w=dn(o,[l,0],[t-l,s]),S=K(v,a),N=Gt(a);if(l===0)o=bt(w,Xt(S,Xt(N,w)));else{const I=bt(w,Xt(S,Xt(N,w)));o=xs([dn(o,[0,0],[l,s]),I],0)}const C=Gt(S),k=dn(r,[0,l],[t,r.shape[1]-l]);if(l===0)r=bt(k,Xt(Xt(k,a),C));else{const I=bt(k,Xt(Xt(k,a),C));r=xs([dn(r,[0,0],[t,l]),I],1)}return[a,o,r]}),Pt([d,h,p])}return!e&&t>s&&(r=dn(r,[0,0],[t,s]),o=dn(o,[0,0],[s,s])),[r,o]})}const VR=se({qr_:BR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xr={flipLeftRight:iR,grayscaleToRGB:cR,resizeNearestNeighbor:jw,resizeBilinear:Dw,rgbToGrayscale:uR,rotateWithOffset:hR,cropAndResize:rR,nonMaxSuppression:fR,nonMaxSuppressionAsync:SR,nonMaxSuppressionWithScore:NR,nonMaxSuppressionWithScoreAsync:kR,nonMaxSuppressionPadded:TR,nonMaxSuppressionPaddedAsync:ER,threshold:PR,transform:FR},UR={bandPart:LR,gramSchmidt:WR,qr:VR};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GR=new Map,HR=new Map;class Ca{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class qs{constructor(){this.classNameMap={}}static getMap(){return qs.instance==null&&(qs.instance=new qs),qs.instance}static register(e){qs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ke(n,e,t){E(n.className!=null,()=>"Class being registered does not have the static className property defined."),E(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),E(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return qs.register(n),GR.set(r,n),HR.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fo extends Ca{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Pt(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return ZT(e,t)}dispose(){this.iterations_!=null&&Pt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Yt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Fo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _w extends Fo{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ae(()=>Ht(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ae(()=>Ht(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;ae(()=>{const d=Ee(K(c,this.rho),K(pn(a),1-this.rho)),h=K(xt(es(Ee(l,this.epsilon)),es(Ee(c,this.epsilon))),a),p=Ee(K(l,this.rho),K(pn(h),1-this.rho));c.assign(d),l.assign(p);const f=Ee(K(h,-this.learningRate),o);o.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Pt(this.accumulatedGrads.map(e=>e.variable)),Pt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pw extends Fo{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ae(()=>Zd(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;ae(()=>{const c=Ee(a,pn(i));a.assign(c);const l=Ee(K(xt(i,es(Ee(c,Y.backend.epsilon()))),-this.learningRate),o);o.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Pt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mw extends Fo{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ae(()=>{this.accBeta1=Yt(t).variable(),this.accBeta2=Yt(s).variable()}),r==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ae(()=>{const s=bt(1,this.accBeta1),r=bt(1,this.accBeta2);t.forEach((o,i)=>{const a=Y.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ae(()=>Ht(a).variable(c))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:ae(()=>Ht(a).variable(c))});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,p=Ee(K(d,this.beta1),K(l,1-this.beta1)),f=Ee(K(h,this.beta2),K(pn(l),1-this.beta2)),m=xt(p,s),g=xt(f,r);d.assign(p),h.assign(f);const x=Ee(K(xt(m,Ee(es(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(K(this.accBeta1,this.beta1)),this.accBeta2.assign(K(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Pt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Pt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ae(()=>{this.accBeta1.assign(hi(this.beta1,this.iterations_+1)),this.accBeta2.assign(hi(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fw extends Fo{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ae(()=>{this.iteration=Yt(0).variable(),this.accBeta1=Yt(t).variable()}),r==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ae(()=>{const s=bt(1,this.accBeta1),r=xt(-this.learningRate,Ee(K(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=Y.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Ht(a).variable(c)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Ht(a).variable(c)});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,p=Ee(K(d,this.beta1),K(l,1-this.beta1)),f=K(h,this.beta2),m=os(l),g=Po(f,m);d.assign(p),h.assign(g);const x=Ee(K(xt(r,s),xt(p,Ee(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(Ee(this.iteration,1)),this.accBeta1.assign(K(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Pt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Pt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Om extends Fo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=Y.registeredVariables[s];ae(()=>{const a=Ee(K(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=_r(Yt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ow extends Om{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Yt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ae(()=>Ht(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ae(()=>{let c;const l=Ee(K(this.m,i),a);this.useNesterov?c=Ee(K(this.c,Ee(a,K(l,this.m))),o):c=Ee(K(this.c,l),o),i.assign(l),o.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Pt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lw extends Fo{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=Y.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ae(()=>Ht(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ae(()=>Ht(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ae(()=>Ht(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;ae(()=>{const d=Ee(K(c,this.decay),K(pn(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,p=Ee(K(h,this.decay),K(a,1-this.decay)),f=xt(K(a,this.learningRate),es(bt(d,Ee(pn(p),this.epsilon)))),m=Ee(K(l,this.momentum),f);c.assign(d),h.assign(p),l.assign(m);const g=bt(o,m);o.assign(g)}else{const h=Ee(K(c,this.decay),K(pn(a),1-this.decay)),p=Ee(K(l,this.momentum),xt(K(a,this.learningRate),es(Ee(h,this.epsilon))));c.assign(h),l.assign(p);const f=bt(o,p);o.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Pt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Pt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Pt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qR=[_w,Pw,Mw,Fw,Ow,Lw,Om];function KR(){for(const n of qR)ke(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tx(n,e,t,s){i(n),t=t??0,s=s??1,a(t,s);let r=0;const o=c=>(c.then(l=>{const d=t+ ++r/n.length*(s-t);return e(d),l}),c);function i(c){E(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function a(c,l){E(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),E(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),E(l>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${l}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function QR(n,e){e==null&&(e={});const t=e.fetchFunc==null?he().platform.fetch:e.fetchFunc,s=n.map(h=>t(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await tx(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await tx(a,e.onProgress,.5,1)}function XR(n,e){var t;const s=e.fetchFunc==null?he().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:c,value:l}=await o.read();if(c){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}i.enqueue(l);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR="application/octet-stream",JR="application/json";class Lm{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(E(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=he().platform.fetch,E(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&E(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=h$(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:JR}),"model.json"),e.weightData!=null){const i=Do.join(e.weightData);t.body.append("model.weights.bin",new Blob([i],{type:YR}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:nm(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return f$(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=Q0(e.weightsManifest),r=()=>XR(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=ZR(t),o=this.weightPathPrefix||s,i=[],a=[];for(const c of e)for(const l of c.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(l)):i.push(o+l+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const t=await this.getWeightUrls(e),s=Q0(e),r=await QR(t,this.loadOptions);return[s,r]}}Lm.URL_SCHEME_REGEX=/^https?:\/\//;function ZR(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function nx(n){return n.match(Lm.URL_SCHEME_REGEX)!=null}const zw=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>nx(s)):t=nx(n),t)return Ww(n,e)}return null};Bn.registerSaveRouter(zw);Bn.registerLoadRouter(zw);function Ww(n,e){return new Lm(n,e)}function eD(n,e){return Ww(n,e)}function zm(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(we(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let h=0;h<r.length-1;++h)i*=r[h];const a=n.shape,c=r.slice();c.pop();let l=1;for(let h=o;h<t;++h)l*=a[h],c.push(a[h]);const d=[...pt(n.shape).map(h=>h/l),1].slice(0,o);return[c,i,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _p=-2,tD=-1;function Wm(n,e,t){const s=n.shape.length;E(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),E(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)E(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function nD(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Bm(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function Bw(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Vw(n,e,t){return t<=n?t:t-(e-1)}function Uw(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function sD(n,e,t,s,r,o,i,a,c){const l=n.length;let d=new Array(l),h=new Array(l),p=new Array(l);if(e.length&&t>0){const f=e[0],m=t+1;d=Gw(i,f,m,s,n),h=Hw(a,f,m,r,n),p=Bw(o,f,m,n)}else for(let f=0;f<l;f++)d[f]=Kw(i,s,o,n,f,c),h[f]=Qw(a,r,o,n,f,c),p[f]=qw(o,f,c);return{begin:d,end:h,strides:p}}function Gw(n,e,t,s,r){const o=[...r],i=Uw(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const c=Vw(e,t,a);let l=s[c];n&1<<c&&(l=0),o[a]=l}return o}function Hw(n,e,t,s,r){const o=[...r],i=Uw(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const c=Vw(e,t,a);let l=s[c];n&1<<c&&(l=Number.MAX_SAFE_INTEGER),o[a]=l}for(let a=0;a<o.length;a++){const c=r[a];o[a]<0&&(o[a]+=c),o[a]=ri(0,o[a],r[a])}return o}function qw(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function Kw(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),i=ri(0,i,c-1),i}function Qw(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),a>0?i=ri(0,i,c):i=ri(-1,i,c-1),i}function Vm(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Um(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function sh(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{E(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(E(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function Gm(n,e,t,s,r,o,i,a,c){let l;if(s==null?(l=new Array(e.length),l.fill(1)):l=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};for(let v=0;v<h.dims;v++)d&&1<<v&a&&h.numAddAxisAfterEllipsis++,1<<v&i&&(d=!0);d||(h.ellipsisMask|=1<<h.dims,h.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};rD(h,p);let f=!0,m=!0,g=!0;const x=[],y=[];for(let v=0;v<n.length;++v){if(p.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const w=!!(p.shrinkAxisMask&1<<v),S=n[v];if(S===-1){x.push(w?1:-1);continue}const N=[p.beginMask&1<<v,p.endMask&1<<v],C=[p.strides[v]>0?0:-1,p.strides[v]>0?S:S-1];if(w&&p.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&p.strides[v]===1;const k=!!(p.beginMask&1<<v&&p.endMask&1<<v);if(p.beginValid&&p.endValid){if(w){const D=p.begin[v]<0?S+p.begin[v]:p.begin[v];if(p.begin[v]=D,p.end[v]=p.begin[v]+1,D<0||D>=S)throw Error(`slice index ${p.begin[v]} of dimension ${v} out of bounds.`)}else p.begin[v]=sx(p.begin[v],0,p.strides[v],S,N,C),p.end[v]=sx(p.end[v],1,p.strides[v],S,N,C);const _=p.strides[v]===1&&p.begin[v]===0&&p.end[v]===S;f=f&&_,m=m&&(v===0&&p.strides[v]===1||_)}else f=f&&p.strides[v]===1&&k,m=m&&(v===0&&p.strides[v]===1||k);let I,T=!1;if(p.beginValid&&p.endValid?(I=p.end[v]-p.begin[v],T=!0):w?(I=1,T=!0):k&&S>=0&&(p.strides[v]<0?I=-S:I=S,T=!0),T){let _;I===0||I<0!=p.strides[v]<0?_=0:_=Math.trunc(I/p.strides[v])+(I%p.strides[v]!==0?1:0),x.push(_)}else x.push(-1)}for(let v=0;v<p.finalShapeGatherIndices.length;++v){const w=p.finalShapeGatherIndices[v];w>=0?y.push(x[w]):w===_p&&y.push(1)}return{finalShapeSparse:y.filter((v,w)=>p.finalShapeGatherIndices[w]!==_p),finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:g,begin:p.begin,end:p.end,strides:p.strides}}function rD(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(_p),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(tD),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function sx(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const oD=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Wm,computeFlatOffset:Um,computeOutShape:Bm,getNormalizedAxes:sD,isSliceContinous:Vm,maskToAxes:nD,parseSliceParams:sh,sliceInfo:Gm,startForAxis:Kw,startIndicesWithElidedDims:Gw,stopForAxis:Qw,stopIndicesWithElidedDims:Hw,stridesForAxis:qw,stridesWithElidedDims:Bw},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iD{static sgd(e){return new Om(e)}static momentum(e,t,s=!1){return new Ow(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new Lw(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new Mw(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new _w(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new Fw(e,t,s,r,o)}static adagrad(e,t=.1){return new Pw(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go=iD;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Xw(){return new Promise(n=>aD(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hm(n,e){const t=n[0].length;n.forEach((r,o)=>{E(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),E(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)E(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Pr(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(hr||(hr={}));function Yw(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function Jw(n){const e={FIRST_DIM_SIZE:hr.FIRST_DIM_SIZE,VALUE_ROWIDS:hr.VALUE_ROWIDS,ROW_LENGTHS:hr.ROW_LENGTHS,ROW_SPLITS:hr.ROW_SPLITS,ROW_LIMITS:hr.ROW_LIMITS,ROW_STARTS:hr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Zw(n){return n.length===0?0:n[0]===hr.FIRST_DIM_SIZE?n.length-1:n.length}function ev(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qm=30;function rh(n){return n<=qm?n:gp(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Km(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gl(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function xl(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function yl(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function Qm(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function Xm(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oh=1.7580993408473768,ih=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ym=.3275911,Jm=.254829592,Zm=-.284496736,eg=1.421413741,tg=-1.453152027,ng=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function to(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function tv(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function nv(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function sv(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function sg(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function rv(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function ov(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function iv(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uh="->",cD=/->/g,rx=",",ox="...";function rg(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(cD,"").length)/Uh.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Uh}").`);const[s,r]=n.split(Uh);E(s.indexOf(ox)===-1,()=>`The ellipsis notation ("${ox}") is not supported yet.`);const o=s.split(rx),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const f=r[p];if(!o.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<s.length;++p){const f=s[p];a.indexOf(f)===-1&&f!==rx&&a.push(f)}const c=new Array(o.length);for(let p=0;p<i;++p){if(new Set(o[p].split("")).size!==o[p].length)throw new Error(`Found duplicate axes in input component ${o[p]}. Support for duplicate axes in input is not implemented yet.`);c[p]=[];for(let f=0;f<o[p].length;++f)c[p].push(a.indexOf(o[p][f]))}const l=a.length,d=r.length,h=[];for(let p=d;p<l;++p)h.push(p);return{allDims:a,summedDims:h,idDims:c}}function og(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function ig(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:E(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function ag(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],c=lD(e,a);for(const l of c)o.indexOf(l)===-1&&(s[i].push(l),o.push(l))}return{path:t,steps:s}}function cg(n){return n.every((e,t)=>e===t)}function lD(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function lg(n,e,t=0){let s=[];if(typeof e=="number")E(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);E(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,c)=>c>0?a+c:a);e[o]=n.shape[t]-i}E(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function av(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function cv(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function lv(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uv(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function dv(n,e){return`size ${n} must be non-negative, not ${e}`}function hv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function pv(n,e){const t=we(n),s=we(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function fv(n,e){const t=we(n),s=we(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pp(){return"segment ids must be >= 0"}function mv(){return"segment ids are not increasing"}function gv(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function xv(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yv(n,e){let t=!1,s;for(n<=qm?(s=n,t=!0):s=gp(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=gp(n,s+1);return s}function bv(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function ug(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let h=0;h<s;++h)if(n.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const i=n.shape[t],a=[];let c=1,l=1,d=1;for(let h=0;h<s;++h)a.push(n.shape[h]),c*=n.shape[h];for(let h=s;h<t;h++)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=t+1;h<o;h++)a.push(n.shape[h]),d*=n.shape[h];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:i,outputShape:a}}const uD=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:ug,computeOutShape:bv,segOpComputeOptimalWindowSize:yv},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(n){try{return n.map(e=>No(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function wv(n){return n.map(e=>bo(e))}const dD=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Jm,ERF_A2:Zm,ERF_A3:eg,ERF_A4:tg,ERF_A5:ng,ERF_P:Ym,PARALLELIZE_THRESHOLD:qm,get RowPartitionType(){return hr},SELU_SCALE:ih,SELU_SCALEALPHA:oh,applyActivation:Dm,assertAndGetBroadcastShape:At,assertAxesAreInnerMostDims:Xn,assertParamsConsistent:Hm,assignToTypedArray:rv,axesAreInnerMostDims:lm,calculateShapes:Ii,checkEinsumDimSizes:ig,checkPadOnDimRoundingMode:ws,combineLocations:lw,combineRaggedTensorToTensorShapes:Yw,complexWithEvenIndex:nv,complexWithOddIndex:sv,computeConv2DInfo:Qn,computeConv3DInfo:jo,computeDefaultPad:sm,computeDilation2DInfo:dl,computeOptimalWindowSize:rh,computeOutAndReduceShapes:Hn,computeOutShape:Pr,computePool2DInfo:tr,computePool3DInfo:oo,convertConv2DDataFormat:io,decodeEinsumEquation:rg,eitherStridesOrDilationsAreOne:ts,expandShapeToKeepDim:Dn,exponent:iv,exponents:ov,fromStringArrayToUint8:wv,fromUint8ToStringArray:no,getAxesPermutation:Sn,getBroadcastDims:aa,getComplexWithIndex:sg,getEinsumComputePath:ag,getEinsumPermutation:og,getFusedBiasGradient:Rm,getFusedDyActivation:Em,getImageCenter:Km,getInnerMostAxes:Tn,getPermuted:xl,getRaggedRank:Zw,getReductionAxes:zn,getReshaped:gl,getReshapedPermuted:yl,getRowPartitionTypesHelper:Jw,getSliceBeginCoords:Qm,getSliceSize:Xm,getSparseFillEmptyRowsIndicesDenseShapeMismatch:av,getSparseFillEmptyRowsNegativeIndexErrorMessage:cv,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:lv,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:hv,getSparseReshapeInputOutputMismatchErrorMessage:fv,getSparseReshapeInputOutputMultipleErrorMessage:pv,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:uv,getSparseReshapeNegativeOutputDimErrorMessage:dv,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:xv,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Pp,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:mv,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:gv,getUndoAxesPermutation:_o,isIdentityPermutation:cg,log:Rk,mergeRealAndImagArrays:to,prepareAndValidate:zm,prepareSplitSize:lg,segment_util:uD,shouldFuse:jm,slice_util:oD,splitRealAndImagArrays:tv,stridesOrDilationsArePositive:ui,tupleValuesAreOne:li,upcastType:Rs,validateDefaultValueShape:ev,validateInput:ME,validateUpdateShape:Tw,warn:Ms},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */KR();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vv={kernelName:Ku,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,ml(Xe(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hD={kernelName:gc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=pn(Xe(t,"float32")),r=es(bt(Yt(1),s));return kn(xt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pD={kernelName:xc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=es(bt(pn(Xe(t,"float32")),1));return xt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fD={kernelName:ba,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{let a=n;const c=zn(t.shape,r);return c.length>0&&(a=gt(a,c)),ne(a,t.shape)},b:()=>{let a=n;const c=zn(s.shape,r);return c.length>0&&(a=gt(a,c)),ne(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mD={kernelName:hf,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gD={kernelName:Qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ht(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xD={kernelName:Xu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Ht(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yD={kernelName:yc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,es(bt(Yt(1),pn(Xe(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bD={kernelName:bc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=es(Ee(Yt(1),pn(Xe(t,"float32"))));return xt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD={kernelName:Sc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{const a=Ee(pn(t),pn(s));let c=K(n,xt(s,a));const l=zn(t.shape,r);return l.length>0&&(c=gt(c,l)),ne(c,t.shape)},b:()=>{const a=Ee(pn(t),pn(s));let c=kn(K(n,xt(t,a)));const l=zn(s.shape,r);return l.length>0&&(c=gt(c,l)),ne(c,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD={kernelName:wc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,Ee(pn(Xe(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SD={kernelName:vc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,bt(Yt(1),pn(Xe(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CD(n,e,t,s,r,o){const i=W(n,"dy","avgPool3dGrad"),a=W(e,"input","avgPool3dGrad");let c=i,l=a,d=!1;a.rank===4&&(d=!0,c=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),E(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),E(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),ws("avgPool3dGrad",r,o);const h={dy:c,input:l},p={filterSize:t,strides:s,pad:r,dimRoundingMode:o},f=Y.runKernel(gf,h,p);return d?ne(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const ND=se({avgPool3dGrad_:CD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ID={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>ND(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kD(n,e,t,s,r){const o=W(n,"dy","avgPoolGrad"),i=W(e,"input","avgPoolGrad");E(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,c=o,l=!1;i.rank===3&&(l=!0,a=ne(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]])),E(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),E(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:c,input:a},h={filterSize:t,strides:s,pad:r},p=Y.runKernel(mf,d,h);return l?ne(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const $D=se({avgPoolGrad_:kD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD={kernelName:Yu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>$D(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AD={kernelName:Zu,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>Xt(n,r,!1,!0),b:()=>Xt(s,n,!0,!1)}:!o&&i?{a:()=>Xt(n,r,!1,!1),b:()=>Xt(n,s,!0,!1)}:o&&!i?{a:()=>Xt(r,n,!1,!0),b:()=>Xt(s,n,!1,!1)}:{a:()=>Xt(r,n,!0,!0),b:()=>Xt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ED={kernelName:ed,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>xm(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RD={kernelName:$k,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let c=r.length-1;c>=0;c--)if(r[c]===o[c])i[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let c=0;c<i.length;c++)i[c]>1&&a.push(c);return{x:()=>gt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD={kernelName:Cc,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD={kernelName:Nc,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _D={kernelName:Ic,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>cs(Zr(Si(s,r),va(s,o)),n,Ht(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PD={kernelName:td,inputsToSave:["x"],gradFunc:vv.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MD={kernelName:nd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(c=>c.shape),{axis:r}=t,o=Lt(r,e[0].shape)[0],i=s.map(c=>c[o]);return Os(n,i,o).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FD={kernelName:sd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:c}=t;return E(li(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>im(s.shape,n,r,i,a,c),filter:()=>Am(s,n,r.shape,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD={kernelName:rd,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:c}=t;return{dy:()=>di(n,r,o,i,a,1,c),filter:()=>Am(n,s,r.shape,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LD(n,e,t,s,r){let o=n;n.rank===4&&(o=ne(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=ne(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),E(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),E(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),E(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),E(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),E(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},c={strides:s,pad:r,filterShape:t};return Y.runKernel(vf,a,c)}const zD=se({conv3DBackpropFilter_:LD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD={kernelName:od,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;E(li(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>ow(i.shape,n,a,r,o),filter:()=>zD(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD={kernelName:kc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(kn(Nw(Xe(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD={kernelName:$c,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(Iw(Xe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UD={kernelName:id,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const a=Sn([r],s.rank);let c=aw(n,r,o,!i);return a!=null&&(c=Gt(c,a)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD={kernelName:ad,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,a=s??[1,1];E(li(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[c,l]=e;return E(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),E(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),E(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),E(ts(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),ws("depthwiseConv2d",o,i),{x:()=>tR(c.shape,n,l,r,o,a,i),filter:()=>ZE(c,n,l.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HD={kernelName:cd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>Y.runKernel(xp,o,t),filter:()=>Y.runKernel(yp,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qD={kernelName:Ac,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>Y.runKernel(Ef,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KD={kernelName:Ec,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=K(Wr(kn(pn(t))),2/Math.sqrt(Math.PI));return{x:()=>K(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD={kernelName:Rc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XD={kernelName:ud,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ne(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YD={kernelName:Dc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,Wr(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JD={kernelName:jc,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZD={kernelName:_c,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{const a=xt(n,Xe(s,"float32")),c=zn(t.shape,r);return c.length>0?ne(gt(a,c),t.shape):a},b:()=>{let a=K(n,Xe(t,"float32"));const c=zn(s.shape,r);c.length>0&&(a=ne(gt(a,c),s.shape));const l=pn(s);return kn(xt(a,Xe(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ej={kernelName:dd,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,a]=e,c=a??Yt(1),l=zn(o.shape,r.shape),d=[];if(o.rank===1){for(let w=0;w<r.shape.length-1;++w)d.push(r.shape[w]);d.push(1)}const h=bt(r,o),p=K(n,c),f=vw(Ee(i,Yt(s))),m=K(K(K(f,f),f),Yt(-.5));return{x:()=>o.rank===1?ne(K(K(n,fr(ne(f,[1,1,1,o.shape[0]]),d)),c),r.shape):ne(K(K(n,f),c),r.shape),mean:()=>{let w=K(K(f,Yt(-1)),p);return o.rank===1&&(w=gt(w,l)),ne(w,o.shape)},variance:()=>{let w=K(K(m,h),p);return o.rank===1&&(w=gt(w,l)),ne(w,o.shape)},scale:()=>{const w=K(h,f);let S=K(n,w);return o.rank===1&&(S=gt(S,l)),ne(S,o.shape)},offset:()=>{let w=n;return o.rank===1&&(w=gt(w,l)),ne(w,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tj={kernelName:hd,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:i}=t,a=Lt(o,s.shape)[0],c=(l,d,h)=>()=>{const p=l.shape,f=d.size,m=p.slice(0,a),g=m.length,x=p.slice(o,p.length).slice(1),y=x.length,b=ix(0,g),v=ix(g+1,g+1+y),w=ax([m,[f],x]),S=ne(h,w),N=ne(d,[f]),C=ax([[g],b,v]),k=Gt(S,C);let I=Ew(k,N,l.shape[a]);const T=_o(C);return I=Gt(I,T),I};if(i===1){const l=s.shape[0],d=s.split(l,0);return{x:()=>eo(d.map((f,m)=>c(f,r.slice(m,1),n.slice(m,1))())).reshape(s.shape),indices:()=>r}}else return{x:c(s,r,n),indices:()=>r}}};function ix(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function ax(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nj={kernelName:Pc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Ht(t),b:()=>Ht(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sj={kernelName:Mc,gradFunc:n=>({x:()=>Xe(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rj={kernelName:Fc,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oj={kernelName:Oc,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ij={kernelName:Lc,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aj={kernelName:fd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=zs(s,0);return{x:()=>cs(o,n,K(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cj={kernelName:Wc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,Ee(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj={kernelName:zc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,Xe(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uj={kernelName:Ak,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=Wr(s);return bt(n,K(gt(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dj(n,e,t,s=5,r=1,o=1,i=.5){const a={x:n,y:e,dy:t},c={depthRadius:s,bias:r,alpha:o,beta:i};return Y.runKernel(Mf,a,c)}const hj=se({localResponseNormalizationBackprop_:dj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pj={kernelName:wd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:c}=t;return{x:()=>hj(s,r,n,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sv(n,e,t,s){return e.rank<t.rank&&(e=ne(e,Dn(e.shape,s))),n.rank<t.rank&&(n=ne(n,Dn(n.shape,s))),{x:()=>K(n,Xe(zr(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cx={kernelName:vd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],a=Lt(r,o.shape),c=Sv(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fj={kernelName:Bc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>K(n,Xe(Si(t,s),"float32")),b:()=>K(n,Xe(hu(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(n,e,t,s,r,o,i){const a=W(n,"dy","maxPool3dGrad"),c=W(e,"input","maxPool3dGrad"),l=W(t,"output","maxPool3dGrad");let d=a,h=c,p=l,f=!1;c.rank===4&&(f=!0,d=ne(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=ne(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),p=ne(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),E(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),E(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),E(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),ws("maxPool3dGrad",o,i);const m={dy:d,input:h,output:p},g={filterSize:s,strides:r,pad:o,dimRoundingMode:i},x=Y.runKernel(Of,m,g);return f?ne(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const gj=se({maxPool3dGrad_:mj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xj={kernelName:Cd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=t;return{x:()=>gj(n,s,r,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yj(n,e,t,s,r,o,i){const a=W(n,"dy","maxPoolGrad"),c=W(e,"input","maxPoolGrad"),l=W(t,"output","maxPoolGrad");E(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),E(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),E(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),ws("maxPoolGrad",o,i);const d={dy:a,input:c,output:l},h={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return Y.runKernel(Ff,d,h)}const bj=se({maxPoolGrad_:yj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wj={kernelName:Sd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>bj(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vj={kernelName:Nd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=Lt(r,s.shape),a=Hn(s.shape,o)[1],c=we(a);return{x:()=>{const d=s.shape.slice();o.forEach(f=>{d[f]=1});const h=ne(n,d);return xt(K(h,Mo(s.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sj={kernelName:Id,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,a=Lt(r,o.shape),c=Sv(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cj={kernelName:Vc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>K(n,Xe(va(t,s),"float32")),b:()=>K(n,Xe(zs(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nj={kernelName:kd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>dn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ij={kernelName:Uc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{const a=zn(t.shape,r);return a.length>0?ne(gt(n,a),t.shape):n},b:()=>{const a=K(n,kn(nh(xt(t,s)))),c=zn(s.shape,r);return c.length>0?ne(gt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kj={kernelName:Gc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{const a=K(n,Xe(s,"float32")),c=zn(t.shape,r);return c.length>0?ne(gt(a,c),t.shape):a},b:()=>{const a=K(n,Xe(t,"float32")),c=zn(s.shape,r);return c.length>0?ne(gt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $j={kernelName:$d,gradFunc:n=>({x:()=>kn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tj={kernelName:Ed,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Un(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aj={kernelName:Ad,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ej={kernelName:Rd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return fi(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lx={kernelName:Dd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>dn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rj={kernelName:Hc,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,a=At(o.shape,i.shape);return{a:()=>{const d=Xe(i,"float32");let h=K(n,K(d,hi(o,bt(d,Yt(1)))));const p=zn(o.shape,a);return p.length>0&&(h=gt(h,p)),ne(h,o.shape)},b:()=>{const d=zs(o,0),h=cs(d,Br(o),Ht(o));let p=K(n,K(r,h));const f=zn(i.shape,a);return f.length>0&&(p=gt(p,f)),ne(p,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dj={kernelName:jd,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=zs(t,0);return{x:()=>cs(r,n,K(n,s)),alpha:()=>{let o=cs(r,Ht(n),K(n,t));const i=zn(s.shape,n.shape);return i.length>0&&(o=gt(o,i)),ne(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(n,e,t){const s=n.shape.slice();s[t]=1;const r=ne(e,s),o=Dp(n,t,!0,!1),i=Dp(n,t,!0,!0),a=K(o,i);return K(r,a)}function _j(n,e,t){const s=n.shape.length,r=s-t.length,o=Sn(t,s);let i=n;o!=null&&(i=Gt(n,o));const a=i.shape.slice(),l=a.splice(s-t.length,t.length).reduce((p,f)=>p*f,1);a.push(l);const d=i.reshape(a);let h=jj(d,e,r);if(h=h.reshape(i.shape),o!=null){const p=_o(o);h=Gt(h,p)}return h}const Pj={kernelName:_d,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>_j(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mj={kernelName:Tc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{const a=xt(n,Xe(s,"float32")),c=zn(t.shape,r);return c.length>0?ne(gt(a,c),t.shape):a},b:()=>{let a=K(n,Xe(t,"float32"));const c=zn(s.shape,r);c.length>0&&(a=ne(gt(a,c),s.shape));const l=pn(s);return kn(xt(a,Xe(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fj={kernelName:qc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,kn(pn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oj={kernelName:Qc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=K(va(t,6),ml(t));return{x:()=>K(n,Xe(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj={kernelName:Kc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,Xe(ml(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zj={kernelName:Pd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj={kernelName:Fd,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Y.runKernel(Gf,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bj={kernelName:Md,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Y.runKernel(Uf,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj={kernelName:Od,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Lt(s,n.shape);return{x:()=>pi(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uj={kernelName:Xc,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj={kernelName:Yc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>kn(xt(n,K(hi(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hj={kernelName:Ld,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Xe(Ht(t),"float32"),t:()=>K(n,Xe(t,n.dtype)),e:()=>K(n,Xe(pm(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qj={kernelName:Jc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=zs(t,Yt(0)),r=Yt(oh),o=Yt(ih),i=K(n,o),a=K(K(n,r),Wr(Xe(t,"float32")));return cs(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj={kernelName:nl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,K(t,bt(Yt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qj={kernelName:tl,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xj={kernelName:Zc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(am(Xe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj={kernelName:el,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(iw(Xe(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj={kernelName:zd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[a,c]=sh(s,r,o),l=[];for(let d=0;d<n.rank;d++)l.push([a[d],i[d]-a[d]-c[d]]);return{x:()=>gm(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zj={kernelName:Ud,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=K(n,s);return{logits:()=>bt(i,K(gt(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_={kernelName:sl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,wa(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ux={kernelName:Bd,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>om(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dx={kernelName:Vd,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>xs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_={kernelName:rl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,K(es(Xe(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n_={kernelName:Hf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(n,K(Xe(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_={kernelName:ol,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Yt(2);return{a:()=>K(n,K(r,bt(t,s))),b:()=>K(n,K(r,bt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_={kernelName:ul,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_={kernelName:il,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=At(t.shape,s.shape);return{a:()=>{let a=n;const c=zn(t.shape,r);return c.length>0&&(a=gt(a,c)),ne(a,t.shape)},b:()=>{let a=n;const c=zn(s.shape,r);return c.length>0&&(a=gt(a,c)),ne(kn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_={kernelName:Wd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;Lt(o,s.shape).forEach(l=>{r[l]=1});const a=ne(n,r),c=K(a,Mo(s.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_={kernelName:al,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,pn(am(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_={kernelName:cl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>K(bt(Yt(1),pn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_={kernelName:ll,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=Ht(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=Ee(i,dn(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)i=Ee(i,dn(n,[a*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)i=Ee(i,dn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)for(let d=0;d<r[3];++d)i=Ee(i,dn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:Ki,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=_o(r);return{x:()=>Gt(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_={kernelName:Gd,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>eo(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_={kernelName:Hd,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>p_(n,t)}}};function p_(n,e){const t=Po(e,Ht(e)),s=um(n,t);let r=Si(e,Yt(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=fs(r,a+1);r=Zr(r,Mo(s.shape,"bool"));const i=Ht(s);return cs(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_={kernelName:qd,gradFunc:n=>({x:()=>Ht(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_=[vv,hD,pD,fD,mD,gD,xD,yD,bD,wD,vD,SD,ID,TD,AD,ED,RD,DD,jD,_D,PD,MD,OD,FD,WD,BD,VD,UD,GD,HD,Mj,qD,KD,QD,XD,YD,ZD,JD,ej,tj,nj,sj,rj,oj,ij,aj,cj,lj,uj,pj,cx,cx,fj,xj,wj,vj,Sj,Cj,Nj,Ij,kj,$j,Tj,Aj,Ej,lx,lx,Rj,Dj,Pj,Fj,Oj,Lj,zj,Wj,Bj,Vj,Uj,Gj,Hj,qj,Kj,Qj,Xj,Yj,Jj,Zj,e_,ux,ux,dx,dx,t_,s_,n_,r_,o_,i_,a_,c_,l_,u_,d_,h_,f_];for(const n of m_)Dk(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.abs=function(){return this.throwIfDisposed(),os(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.acos=function(){return this.throwIfDisposed(),G$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.acosh=function(){return this.throwIfDisposed(),q$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.add=function(n){return this.throwIfDisposed(),Ee(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.all=function(n,e){return this.throwIfDisposed(),nw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.any=function(n,e){return this.throwIfDisposed(),Ep(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.argMax=function(n){return this.throwIfDisposed(),Za(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.argMin=function(n){return this.throwIfDisposed(),J$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asScalar=function(){return this.throwIfDisposed(),E(this.size===1,()=>"The array must have only 1 element."),ne(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asType=function(n){return this.throwIfDisposed(),Xe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as1D=function(){return this.throwIfDisposed(),ne(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as2D=function(n,e){return this.throwIfDisposed(),ne(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ne(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ne(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),ne(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asin=function(){return this.throwIfDisposed(),e2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.asinh=function(){return this.throwIfDisposed(),n2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atan=function(){return this.throwIfDisposed(),r2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atan2=function(n){return this.throwIfDisposed(),i2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.atanh=function(){return this.throwIfDisposed(),c2(this)};ye().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),rm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),om(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Jd(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Xa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cast=function(n){return this.throwIfDisposed(),Xe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.ceil=function(){return this.throwIfDisposed(),P2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Ls(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Pn&&(n=[n]),xs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),sw(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),rw(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),di(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cos=function(){return this.throwIfDisposed(),am(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cosh=function(){return this.throwIfDisposed(),iw(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Dp(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),aw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),iT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),cm(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),lT(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.divNoNan=function(n){return this.throwIfDisposed(),fT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.div=function(n){return this.throwIfDisposed(),xt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.dot=function(n){return this.throwIfDisposed(),gT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.elu=function(){return this.throwIfDisposed(),eh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.equal=function(n){return this.throwIfDisposed(),zr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.erf=function(){return this.throwIfDisposed(),cw(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),TT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.exp=function(){return this.throwIfDisposed(),Wr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.expandDims=function(n){return this.throwIfDisposed(),fs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.expm1=function(){return this.throwIfDisposed(),DT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.fft=function(){return this.throwIfDisposed(),$w(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.flatten=function(){return this.throwIfDisposed(),ne(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.floor=function(){return this.throwIfDisposed(),nh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.floorDiv=function(n){return this.throwIfDisposed(),tw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.gather=function(n,e,t){return this.throwIfDisposed(),um(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Si(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.greater=function(n){return this.throwIfDisposed(),zs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.ifft=function(){return this.throwIfDisposed(),jp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.irfft=function(){return this.throwIfDisposed(),CE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isFinite=function(){return this.throwIfDisposed(),WT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isInf=function(){return this.throwIfDisposed(),VT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.isNaN=function(){return this.throwIfDisposed(),GT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.leakyRelu=function(n){return this.throwIfDisposed(),hm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.lessEqual=function(n){return this.throwIfDisposed(),va(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.less=function(n){return this.throwIfDisposed(),hu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),XT(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSigmoid=function(){return this.throwIfDisposed(),sA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSoftmax=function(n){return this.throwIfDisposed(),pw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),fw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.log=function(){return this.throwIfDisposed(),Br(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.log1p=function(){return this.throwIfDisposed(),hw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Zr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalNot=function(){return this.throwIfDisposed(),pm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalOr=function(n){return this.throwIfDisposed(),mw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.logicalXor=function(n){return this.throwIfDisposed(),dA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Xt(this,n,e,t)};ye().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),fm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.max=function(n,e){return this.throwIfDisposed(),gr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.maximum=function(n){return this.throwIfDisposed(),Po(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mean=function(n,e){return this.throwIfDisposed(),Rn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.min=function(n,e){return this.throwIfDisposed(),du(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.minimum=function(n){return this.throwIfDisposed(),nc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),bA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mod=function(n){return this.throwIfDisposed(),vA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.mul=function(n){return this.throwIfDisposed(),K(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.neg=function(){return this.throwIfDisposed(),kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.norm=function(n,e,t){return this.throwIfDisposed(),th(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.notEqual=function(n){return this.throwIfDisposed(),pu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),gw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.onesLike=function(){return this.throwIfDisposed(),er(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.pad=function(n,e){return this.throwIfDisposed(),gm(this,n,e)};ye().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),RA(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.pow=function(n){return this.throwIfDisposed(),hi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.prelu=function(n){return this.throwIfDisposed(),ym(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.prod=function(n,e){return this.throwIfDisposed(),_A(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reciprocal=function(){return this.throwIfDisposed(),sE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.relu=function(){return this.throwIfDisposed(),Ni(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.relu6=function(){return this.throwIfDisposed(),bw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ne(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reshape=function(n){return this.throwIfDisposed(),ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),Dw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),jw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.reverse=function(n){return this.throwIfDisposed(),pi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.rfft=function(){return this.throwIfDisposed(),kE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.round=function(){return this.throwIfDisposed(),ww(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.rsqrt=function(){return this.throwIfDisposed(),vw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.selu=function(){return this.throwIfDisposed(),Sw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Cw(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sigmoid=function(){return this.throwIfDisposed(),wa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sign=function(){return this.throwIfDisposed(),hE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sin=function(){return this.throwIfDisposed(),Nw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sinh=function(){return this.throwIfDisposed(),Iw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.slice=function(n,e){return this.throwIfDisposed(),dn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.softmax=function(n){return this.throwIfDisposed(),Tm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.softplus=function(){return this.throwIfDisposed(),hl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),xm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.split=function(n,e){return this.throwIfDisposed(),Os(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sqrt=function(){return this.throwIfDisposed(),es(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.square=function(){return this.throwIfDisposed(),pn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.squaredDifference=function(n){return this.throwIfDisposed(),TE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.squeeze=function(n){return this.throwIfDisposed(),fl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Pn?[this,n]:[this,...n];return eo(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.step=function(n){return this.throwIfDisposed(),ml(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.stridedSlice=function(n,e,t,s,r,o,i,a){return this.throwIfDisposed(),jE(this,n,e,t,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sub=function(n){return this.throwIfDisposed(),bt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.sum=function(n,e){return this.throwIfDisposed(),gt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tan=function(){return this.throwIfDisposed(),PE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tanh=function(){return this.throwIfDisposed(),Yd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.tile=function(n){return this.throwIfDisposed(),fr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toBool=function(){return this.throwIfDisposed(),Xe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toFloat=function(){return this.throwIfDisposed(),Xe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.toInt=function(){return this.throwIfDisposed(),Xe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.topk=function(n,e){return this.throwIfDisposed(),OE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.transpose=function(n){return this.throwIfDisposed(),Gt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unique=function(n){return this.throwIfDisposed(),WE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),Ew(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.unstack=function(n){return this.throwIfDisposed(),fi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.where=function(n,e){return this.throwIfDisposed(),cs(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ye().prototype.zerosLike=function(){return this.throwIfDisposed(),Ht(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Tr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Tr.prototype)}}class Ys extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ys.prototype)}}class G extends Error{constructor(e){super(e),Object.setPrototypeOf(this,G.prototype)}}class jt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,jt.prototype)}}class dg extends Error{constructor(e){super(e),Object.setPrototypeOf(this,dg.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Cv{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mi(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Ar(n,e){if(!n)throw new dg(e)}function hx(n,e){let t=0;for(const s of n)s===e&&t++;return t}function ms(n){return n.length===1?n[0]:n}function nn(n){return Array.isArray(n)?n:[n]}function qr(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function qo(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Vs={};function hg(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Mp(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Mp(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Mp(s))}}}function bl(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in Vs)i=Vs[o];else if(i=e[o],i==null)throw new G(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new G(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,c;if(i in t?[a,c]=t[i]:i in Vs?[a,c]=Vs.className:i in e&&([a,c]=e[i]),a==null)throw new G(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const l={};for(const f of Object.keys(Vs))l[f]=Vs[f];for(const f of Object.keys(t))l[f]=t[f];const d=o.config;d.customObjects=l;const h=Object.assign({},Vs);for(const f of Object.keys(t))Vs[f]=t[f];Mp(o.config);const p=c(a,o.config,t,r);return Vs=Object.assign({},h),p}else{const l=Object.assign({},Vs);for(const h of Object.keys(t))Vs[h]=t[h];const d=new a(o.config);return Vs=Object.assign({},l),d}}}function g_(n,e){return n<e?-1:n>e?1:0}function Fl(n,e){return-1*g_(n,e)}function wo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function x_(n){if(n==null)throw new G(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function ki(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new G(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function pg(n,e,t=0,s=1/0){return Ar(t>=0),Ar(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Gn(n,e){Array.isArray(n)?(E(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Gn(t,`element ${s+1} of ${e}`))):E(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${Nv(n)}.`)}function Nv(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>Nv(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function y_(n,e,t){let s=t!=null?t():hs(),r;return(...i)=>{const a=t!=null?t():hs();return a-s<e||(s=a,r=n(...i)),r}}function Iv(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let b_=0;function kv(){return b_++}const Ol={};function ah(n=""){return n in Ol||(Ol[n]=0),Ol[n]+=1,n+Ol[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const w_=["channelsFirst","channelsLast"],v_=["nearest","bilinear"],S_=["valid","same","causal"],C_=["max","avg"],N_=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Mi=new Map;function An(n){ki(w_,"DataFormat",n)}function I_(n){ki(v_,"InterpolationFormat",n)}function Ws(n){ki(S_,"PaddingMode",n)}function $v(n){ki(C_,"PoolMode",n)}const Ya=[],px="/";function ti(n,e){Ya.push(n);try{const t=e();return Ya.pop(),t}catch(t){throw Ya.pop(),t}}function k_(){return Ya.length===0?"":Ya.join(px)+px}function Tv(n){if(!Ev(n))throw new Error("Not a valid tensor name: '"+n+"'");return k_()+n}function Av(n){if(!Ev(n))throw new Error("Not a valid tensor name: '"+n+"'");Mi.has(n)||Mi.set(n,0);const e=Mi.get(n);if(Mi.set(n,Mi.get(n)+1),e>0){const t=`${n}_${e}`;return Mi.set(t,1),t}else return n}const $_=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Ev(n){return!!n.match($_)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function T_(n){return n===parseInt(n.toString(),10)}function vo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function la(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Io(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function yr(n,e){if(e<n)throw new G(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Gh;function Mn(){return Gh==null&&(Gh=r$().epsilon()),Gh}function br(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mr(n,e){return Xe(n,e)}function wl(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ne(n,t)}function A_(n,e){return ae(()=>{if(n.shape.length!==2)throw new G(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=wl(n,1);return Fp(t,[1,e,1])})}function E_(n){const e=[vo(n.shape)];return ne(n,e)}function R_(n){if(n.rank<=1)throw new G(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],vo(n.shape,1)];return ne(n,e)}function ni(n,e,t){return ae(()=>{switch(n.rank){case 1:return km(n,e,t);case 2:return kw(n,[e,0],[t,n.shape[1]]);case 3:return $m(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return mu(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return dn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return dn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new G(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Hh(n,e,t){return ae(()=>{switch(n.rank){case 1:return km(n,e,t);case 2:return kw(n,[0,e],[n.shape[0],t]);case 3:return $m(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return mu(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Ll(n,e,t,s){return ae(()=>{switch(n.rank){case 1:return km(n,e,t);case 2:switch(s){case 1:return ni(n,e,t);case 2:return Hh(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return ni(n,e,t);case 2:return $m(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Hh(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return ni(n,e,t);case 2:return mu(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return mu(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Hh(n,e,t);default:throw new G(`The axis is not within the rank of the tensor ${s}`)}default:throw new G(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function fg(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),xs(n,e)}function fx(n,e){switch(n.rank){case 1:return O2([n,e]);case 2:return z2([n,e],0);case 3:return B2([n,e],0);case 4:return U2([n,e],0);default:throw new G(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Fp(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new G(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return fr(n,e)}function ch(n,e=0,t=1,s,r){return ZA(n,e,t,s,r)}function Fr(n,e,t,s){if(n.rank<2||e.rank<2)throw new jt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new jt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return J0({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Op(n.rank,s,br()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=ne(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),c=i.pop(),l=[...i,a],d=Array.from({length:e.rank},(m,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=ne(Gt(e,d),[c,-1]);const h=[...r,...l];return ne(J0({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Op(n.rank,s,br()):null,activation:t}),h)}}function Rv(n,e,t){return ae(()=>(Array.isArray(e)?e=Es(e,"int32"):e=Xe(e,"int32"),um(n,e,t)))}function vl(n){return K(n,n)}function Op(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new G(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ne(e,[1,s[0],1,1,1]):ne(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ne(e,[1,1,1,1,s[0]]):ne(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ne(e,[1,s[0],1,1]):ne(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ne(e,[1,1,1,s[0]]):ne(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ne(e,[1,s[0],1]):ne(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ne(e,[1,1,s[0]]):ne(e,[1].concat(s))}else if(n<3)return e;throw new G(`Unsupported input rank by biasAdd: ${e.rank}`)}function Sr(n,e,t){return ae(()=>(t==null&&(t=br()),An(t),Ee(n,Op(n.rank,e,t))))}function D_(n,e=1){if(e!==1)throw new jt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return eh(n)}function j_(n){return ae(()=>xt(n,Ee(os(n),1)))}function Dv(n,e,t,s){return ae(()=>KE(n,e,t,s))}function __(n){return ae(()=>{const e=Ee(.5,K(.2,n));return Ls(e,0,1)})}function Sl(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const P_=["fanIn","fanOut","fanAvg"],M_=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function F_(n){ki(P_,"FanMode",n)}function O_(n){ki(M_,"Distribution",n)}class nr extends Ca{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class jv extends nr{apply(e,t){return Un(e,t)}}jv.className="Zeros";ke(jv);class mg extends nr{apply(e,t){return Mo(e,t)}}mg.className="Ones";ke(mg);class _v extends nr{constructor(e){if(super(),typeof e!="object")throw new G(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new G(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ae(()=>K(Yt(this.value),Mo(e,t)))}getConfig(){return{value:this.value}}}_v.className="Constant";ke(_v);class Pv extends nr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return pl(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Pv.className="RandomUniform";ke(Pv);class Mv extends nr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new jt(`randomNormal does not support dType ${t}.`);return ch(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Mv.className="RandomNormal";ke(Mv);class Fv extends nr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new jt(`truncatedNormal does not support dType ${t}.`);return Aw(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Fv.className="TruncatedNormal";ke(Fv);class Ov extends nr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ae(()=>{if(e.length!==2||e[0]!==e[1])throw new G("Identity matrix initializer can only be used for 2D square matrices.");return K(this.gain,dw(e[0]))})}getConfig(){return{gain:this.gain}}}Ov.className="Identity";ke(Ov);function L_(n,e="channelsLast"){let t,s;if(An(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=vo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=vo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=vo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Ds extends nr{constructor(e){if(super(),e.scale<0)throw new G(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,F_(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,O_(this.distribution),this.seed=e.seed}apply(e,t){const s=L_(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new jt(`${this.getClassName()} does not support dType ${t}.`);return Aw(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return pl(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ds.className="VarianceScaling";ke(Ds);class gg extends Ds{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}gg.className="GlorotUniform";ke(gg);class xg extends Ds{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}xg.className="GlorotNormal";ke(xg);class yg extends Ds{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}yg.className="HeNormal";ke(yg);class bg extends Ds{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}bg.className="HeUniform";ke(bg);class wg extends Ds{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}wg.className="LeCunNormal";ke(wg);class vg extends Ds{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}vg.className="LeCunUniform";ke(vg);class Lv extends nr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ae(()=>{if(e.length<2)throw new jt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=we(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=ch(i,0,1,t,this.seed),c=UR.qr(a,!1);let l=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return l=K(l,h.sign()),s<r&&(l=l.transpose()),K(Yt(this.gain),l.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}Lv.className="Orthogonal";ke(Lv);const mx={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function gx(n,e={}){return bl(n,qs.getMap().classNameMap,e,"initializer")}function vn(n){return hg(n)}function bn(n){if(typeof n=="string"){const e=n in mx?mx[n]:n;if(e==="GlorotNormal")return new xg;if(e==="GlorotUniform")return new gg;if(e==="HeNormal")return new yg;if(e==="HeUniform")return new bg;if(e==="LeCunNormal")return new wg;if(e==="LeCunUniform")return new vg;{const t={};return t.className=e,t.config={},gx(t)}}else return n instanceof nr?n:gx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lp(n){return Array.isArray(n)&&Array.isArray(n[0])}function gu(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function St(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new G(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Qt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new G(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xu(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const xx="Variable";class z_{constructor(e,t="float32",s=xx,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=kv(),s=s??xx,this.originalName=Tv(s),this.name=Av(this.originalName),this.trainable_=r,this.constraint=o,this.val=UE(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),W_(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function W_(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function zp(n){return n.map(e=>e.read())}function Sg(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Fn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Vr{constructor(e,t,s,r,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=kv(),i!=null&&(this.originalName=Tv(i),this.name=Av(this.originalName)),this.rank=t.length}}let B_=0;class lh{constructor(e,t){this.callArgs=t,this.id=B_++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let V_=0;class zt extends Ca{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=V_++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=qr(s)+"_"+ah(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ys(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new G(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return ms(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ms(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Tr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Tr(`Layer ${this.name} is not connected, no input to return.`);return ms(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Tr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Tr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return ms(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=nn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=nn(this.inputSpec);if(t.length!==s.length)throw new G(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new G(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const c=o.shape;for(const l in i.axes){const d=Number(l),h=i.axes[l],p=d>=0?c[d]:c[c.length+d];if(h!=null&&[h,null].indexOf(p)===-1)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${h} but got shape ${c}.`)}}if(i.shape!=null)for(let c=0;c<i.shape.length;++c){const l=i.shape[c],d=o.shape[c];if(l!=null&&d!=null&&l!==d)throw new G(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=nn(e),r=H_(e),o=q_(e);if(r===o)throw new G("Arguments to apply() must be all SymbolicTensors or all Tensors");return ti(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of nn(e))i.push(a.shape);this.build(ms(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=nn(i),c=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(i=ms(c),this.activityRegularizer!=null)throw new jt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=U_(e),a=this.computeOutputShape(i);let c;const l=G_(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((d,h)=>new Vr(l,d,this,nn(e),t,this.name,h)):c=new Vr(l,a,this,nn(e),t,this.name),this.addInboundNode(e,c,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new jt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Tr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Tr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ys(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return xu(this.weights)}build(e){this.built=!0}getWeights(e=!1){return zp(e?this.trainableWeights:this.weights)}setWeights(e){ae(()=>{const t=this.weights;if(t.length!==e.length)throw new G(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=zp(t);for(let o=0;o<r.length;++o){const i=r[o],a=t[o],c=e[o];if(!Jt(i.shape,c.shape))throw new G(`Layer weight shape ${i.shape} not compatible with provided weight shape ${c.shape}`);s.push([a,c])}Sg(s)})}addWeight(e,t,s,r,o,i,a,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new G(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():bn("zeros"));const l=r.apply(t,s),d=new z_(l,s,e,i,a);return l.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=nn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=nn(t),i=nn(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,s,r,o,i,a=null){const c=nn(e);t=nn(t),s=nn(s),r=nn(r),o=gu(o),i=gu(i);const l=[],d=[],h=[];for(const p of c)l.push(p.sourceLayer),d.push(p.nodeIndex),h.push(p.tensorIndex);new lh({outboundLayer:this,inboundLayers:l,nodeIndices:d,tensorIndices:h,inputTensors:c,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function U_(n){n=nn(n);const e=[];for(const t of n)e.push(t.shape);return ms(e)}function G_(n){return"float32"}function zv(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],c=s.nodeIndices[o],l=zv(i,a,c);for(const d of l)r.indexOf(d)===-1&&r.push(d)}return r}}}function H_(n){let e=!0;for(const t of nn(n))if(!(t instanceof Vr)){e=!1;break}return e}function q_(n){let e=!0;for(const t of nn(n))if(t instanceof Vr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Cl extends zt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:ah("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new G("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new G("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new G("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Vr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new lh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new G(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Cl.className="InputLayer";ke(Cl);function K_(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new G("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Cl({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Q_(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Xe(e,n.dtype)}catch{throw new G(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class go{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof go)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Q_(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new G(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Vr){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Vr){if(this.id2Value[e.id]==null)throw new G(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new G(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Pt(this.id2Mask)}}const yu=new Cv,bu=new Cv;function X_(n){yu!=null&&yu.setMaxEntries(n),bu!=null&&bu.setMaxEntries(n)}function Ba(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(m=>m.name),c=[],l=e.names();for(const m of a)l.indexOf(m)!==-1?c.push(e.getValue(m)):c.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let h=yu.get(d),p;if(h==null){const m=Y_(i,e);h=m.sorted,p=m.recipientCounts,yu.put(d,h),bu.put(d,p)}p={},r||Object.assign(p,bu.get(d));const f=new go(e);for(let m=0;m<h.length;++m){const g=h[m],x=g.sourceLayer;if(x instanceof Cl)continue;const y=[],b=[],v=[];let w=!1;for(const I of g.inputs){const T=f.getValue(I),_=f.getMask(I);y.push(T),b.push(_),_!=null&&(w=!0),r||(p[I.name]--,p[I.name]===0&&!e.hasKey(I)&&a.indexOf(I.name)===-1&&!T.isDisposed&&I.sourceLayer.stateful!==!0&&v.push(T))}w&&(t=t||{},t.mask=b[0]);const S=nn(x.apply(y,t));let N=null;x.supportsMasking&&(N=x.computeMask(y,b));const C=Z_(g),k=Array.isArray(C)?C:[C];for(let I=0;I<k.length;++I){f.hasKey(k[I])||f.add(k[I],S[I],Array.isArray(N)?N[0]:N);const T=a.indexOf(k[I].name);T!==-1&&(c[T]=S[I])}r||Pt(v)}return f.disposeMasks(),o?c:c[0]}function Y_(n,e){E(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=yx(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=yx(o,e);for(const c of i)r.has(c.name)||(t.push(c),r.add(c.name));for(const c in a)s[c]==null&&(s[c]=new Set),a[c].forEach(l=>s[c].add(l))}}return{sorted:t,recipientCounts:J_(s)}}function J_(n){const e={};for(const t in n)e[t]=n[t].size;return e}function yx(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const c=i[i.length-1]===o.length-1;if(a.inputs.length===0||c)o.pop(),s.push(a),t.add(a.name),c&&i.pop();else{i.push(o.length-1);for(const l of a.inputs)r[l.name]==null&&(r[l.name]=new Set),r[l.name].add(a.name),!t.has(l.name)&&o.push(l)}}return{sorted:s,recipientMap:r}}function Z_(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP=he();eP.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,X_);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Cg(n,e){return ae(()=>es(gt(K(n,n),e,!0)))}class Nl extends Ca{getConfig(){return{}}}class Wv extends Nl{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>{const t=Cg(e,this.axis),s=Ls(t,0,this.maxValue);return K(e,xt(s,Ee(Mn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Wv.className="MaxNorm";ke(Wv);class Bv extends Nl{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>xt(e,Ee(Mn(),Cg(e,this.axis))))}getConfig(){return{axis:this.axis}}}Bv.className="UnitNorm";ke(Bv);class Vv extends Nl{apply(e){return Ni(e)}}Vv.className="NonNeg";ke(Vv);class Uv extends Nl{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>{const t=Cg(e,this.axis),s=Ee(K(this.rate,Ls(t,this.minValue,this.maxValue)),K(1-this.rate,t));return K(e,xt(s,Ee(Mn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Uv.className="MinMaxNorm";ke(Uv);const bx={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function On(n){return hg(n)}function wx(n,e={}){return bl(n,qs.getMap().classNameMap,e,"constraint")}function Ln(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in bx?bx[n]:n,config:{}};return wx(t)}else return n instanceof Nl?n:wx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Bo(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Pt(s)}}function Gv(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var vx;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(vx||(vx={}));const tP=125;class rc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class nP{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class sP extends rc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=ae(()=>Ee(this.totals[r],K(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ae(()=>{const r=K(xt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),_r(t[s])}))}}class rP extends rc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const c=i[a];e.push(c.data()),t.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class oP extends rc{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Xw,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=tP),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");fp(this.yieldEvery)&&(this.maybeWait=y_(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Bo(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Bo(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Bo(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Bo(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Bo(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):fp(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Bo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Bo(e),await this.trainEnd(e))}}function Hv(n,e){return n==null&&(n={}),n instanceof rc?[n]:Array.isArray(n)&&n[0]instanceof rc?n:nn(n).map(s=>new oP(s,e))}class Hs{constructor(){}static registerCallbackConstructor(e,t){E(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Hs.checkForDuplicate(t),Hs.constructors[e]==null&&(Hs.constructors[e]=[]),Hs.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Hs.constructors)Hs.constructors[+t].forEach(r=>{if(r===e)throw new G("Duplicate callback constructor.")})}static clear(){Hs.constructors={}}static createCallbacks(e){const t=[];for(const s in Hs.constructors){const r=+s;e>=r&&t.push(...Hs.constructors[r])}return t.map(s=>new s)}}Hs.constructors={};function qv(n,e,t,s,r,o,i,a,c){const l=new rP,d=[new sP,...Hs.createCallbacks(e)];n!=null&&d.push(...n),d.push(l);const h=new nP(d);return h.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:c}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Or(n,e={},t=!1){return bl(n,qs.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wu(n,e){return ae(()=>{n.dtype!=="float32"&&(n=Xe(n,"float32"));const t=gt(vl(n),e,!0),s=Zd(t.shape,Mn()),r=es(Po(t,s));return xt(n,r)})}function uh(n,e){return ae(()=>Rn(vl(bt(e,n)),-1))}function Ng(n,e){return ae(()=>Rn(os(bt(e,n)),-1))}function Ig(n,e){return ae(()=>{const t=bt(n,e),s=Ls(os(n),Mn(),Number.MAX_VALUE),r=os(xt(t,s));return K(100,Rn(r,-1))})}function iP(n,e){return ae(()=>{const t=Ls(e,Mn(),Number.MAX_VALUE),s=Br(Ee(1,t)),r=Ls(n,Mn(),Number.MAX_VALUE),o=Br(Ee(1,r));return Rn(vl(bt(s,o)),-1)})}function aP(n,e){return ae(()=>{const t=Po(0,bt(1,K(n,e)));return Rn(vl(t),-1)})}function cP(n,e){return ae(()=>{const t=Po(0,bt(1,K(n,e)));return Rn(t,-1)})}function lP(n,e){return ae(()=>{const t=gt(K(n,e),-1),s=gr(K(bt(1,n),e),-1);return Po(0,Ee(1,bt(s,t)))})}function uP(n,e){return ae(()=>{const t=Math.log(2),s=bt(e,n),r=bt(Ee(s,hl(K(-2,s))),t);return Rn(r,-1)})}function oc(n,e,t=!1){return ae(()=>{if(t)e=Tm(e);else{const s=gt(e,e.shape.length-1,!0);e=xt(e,s)}return e=Ls(e,Mn(),1-Mn()),kn(gt(K(Xe(n,"float32"),Br(e)),e.shape.length-1))})}function vu(n,e,t=!1){return ae(()=>{const s=Xe(nh(E_(n)),"int32");e=Ls(e,Mn(),1-Mn());const r=e.shape,o=ne(gw(s,r[r.length-1]),r);return oc(o,e,t)})}function dP(n,e){if(!Jt(n.shape,e.shape))throw new G(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ae(()=>{const t=Ni(e),s=kn(os(e));return Ee(bt(t,K(e,n)),hw(Wr(s)))})}function dh(n,e){return ae(()=>{let t;return t=Ls(e,Mn(),1-Mn()),t=Br(xt(t,bt(1,t))),Rn(dP(n,t),-1)})}function hP(n,e){return ae(()=>{const t=Ls(n,Mn(),1),s=Ls(e,Mn(),1);return gt(K(n,Br(xt(t,s))),-1)})}function pP(n,e){return ae(()=>{const t=Br(Ee(Mn(),e));return Rn(bt(e,K(n,t)),-1)})}function Kv(n,e){return ae(()=>{const t=wu(n,-1),s=wu(e,-1),r=K(t,s);return kn(gt(r,-1))})}const Su={meanSquaredError:uh,meanAbsoluteError:Ng,meanAbsolutePercentageError:Ig,meanSquaredLogarithmicError:iP,squaredHinge:aP,hinge:cP,categoricalHinge:lP,logcosh:uP,categoricalCrossentropy:oc,sparseCategoricalCrossentropy:vu,binaryCrossentropy:dh,kullbackLeiblerDivergence:hP,poisson:pP,cosineProximity:Kv};function qh(n){if(typeof n=="string"){if(n in Su)return Su[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new G(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qv(n,e){return ae(()=>{const t=K(.5,er(e)),s=Mr(zs(e,t),n.dtype);return Rn(zr(n,s),-1)})}function Xv(n,e){return ae(()=>Mr(zr(Za(n,-1),Za(e,-1)),"float32"))}function fP(n,e){return ae(()=>Xe(gt(Zr(zr(n,1),zr(e,1))),"float32"))}function mP(n,e){return ae(()=>Xe(gt(Zr(zr(n,0),zr(e,1))),"float32"))}function gP(n,e){return ae(()=>{const t=fP(n,e),s=mP(n,e),r=Ee(t,s);return Xe(cs(zs(r,0),xt(t,r),0),"float32")})}function xP(n,e){return dh(n,e)}function yP(n,e){return n.rank===e.rank&&(n=fl(n,[n.rank-1])),e=Za(e,-1),e.dtype!==n.dtype&&(e=Xe(e,n.dtype)),Xe(zr(n,e),"float32")}const bP=uh,wP=uh,vP=Ng,SP=Ng,CP=Ig,NP=Ig,Yv=oc,IP=Kv,Jv=vu,Cu={binaryAccuracy:Qv,categoricalAccuracy:Xv,precision:gP,categoricalCrossentropy:Yv,sparseCategoricalCrossentropy:Jv,mse:bP,MSE:wP,mae:vP,MAE:SP,mape:CP,MAPE:NP,cosine:IP};function kP(n){if(typeof n=="string"&&n in Cu)return Cu[n];if(typeof n!="string"&&n!=null)return n;throw new G(`Unknown metric ${n}`)}function zl(n){if(Ar(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Su))if(Su[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Cu))if(Cu[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $P(n){const e={Adagrad:()=>Go.adagrad(.01),Adadelta:()=>Go.adadelta(1,.95,Mn()),Adam:()=>Go.adam(.001,.9,.999,Mn()),Adamax:()=>Go.adamax(.002,.9,.999,Mn(),0),RMSProp:()=>Go.rmsprop(.001,.9,0,Mn()),SGD:()=>Go.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new G(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Sx=1*1024*1024;function Cx(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Wp(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>Sx&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Sx}.`)}}function Wp(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Wp(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Wp(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TP(n,e,t,s=console.log){const r=EP(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),Nu(o,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?RP(a[d],t,s):DP(a[d],t,i,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const c=AP(n),l=xu(n.nonTrainableWeights);s(`Total params: ${c+l}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${l}`),s("_".repeat(e))}function AP(n){let e;return n.collectedTrainableWeights!=null?e=xu(n.collectedTrainableWeights):e=xu(n.trainableWeights),e}function EP(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Nu(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function RP(n,e,t){let s,r;try{r=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];Nu(a,e,t)}function DP(n,e,t,s){let r,o;try{o=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const h of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(h)===-1))for(let p=0;p<h.inboundLayers.length;++p){const f=h.inboundLayers[p].name,m=h.nodeIndices[p],g=h.tensorIndices[p];i.push(`${f}[${m}][${g}]`)}const a=n.name,c=n.getClassName(),l=i.length===0?"":i[0],d=[`${a} (${c})`,o,r,n.countParams().toString(),l];Nu(d,e,s);for(let h=1;h<i.length;++h)Nu(["","","","",i[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zv(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Iu(n,e){if(n===null)return null;if(typeof n=="string")return qo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];Zv(e,r,o)?t.push(o):t.push(Iu(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=qo(s);t[o]=Iu(r,o)}}return t}}function Bp(n,e){if(n==null)return null;if(typeof n=="string")return qr(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];Zv(e,r,o)?t.push(o):t.push(Bp(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=qr(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=Bp(r,s)}return t}}/** @license See the LICENSE file. */const e1="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jP=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class lr extends zt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=ah(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],wo(this.inputs).length!==this.inputs.length)throw new G(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);wo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const v=b.sourceLayer,w=b.nodeIndex,S=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(S)}for(const b of this.inputs){const v=b.sourceLayer,w=b.nodeIndex,S=b.tensorIndex;Ar(w===0,"input layer has >1 nodes"),Ar(S===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const v=this.inputLayers[b];if(!(v instanceof Cl))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const t={},s={},r={},o={},i={},a=[],c=(b,v,w,S,N,C)=>{(S==null||N==null||C==null)&&(S=b.sourceLayer,N=b.nodeIndex,C=b.tensorIndex);const k=S.inboundNodes[N];if(w.indexOf(k)!==-1)throw new Ys(`The tensor ${b.name} at layer "${S.name}" is part of a cycle.`);if(v.indexOf(k)!==-1)return;this.containerNodes.add(lr.nodeKey(S,N)),S.id in i||(i[S.id]=Object.keys(i).length),w.indexOf(k)===-1&&w.push(k);const I=k.inboundLayers.length;for(let T=0;T<I;T++){const _=k.inputTensors[T],D=k.inboundLayers[T],P=k.nodeIndices[T],A=k.tensorIndices[T];c(_,v,w,D,P,A)}for(v.push(k);w.indexOf(k)>=0;)w.splice(w.indexOf(k),1);a.push(k)},l=[],d=[];for(const b of this.outputs)c(b,l,d);const h=a.slice().reverse();for(const b of h){s[b.id]=b,b.id in t||(t[b.id]=0);let v=t[b.id];const w=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];v=Math.max(v,w),r[b.outboundLayer.id]=v,o[b.outboundLayer.id]=b.outboundLayer,t[b.id]=v;for(let S=0;S<b.inboundLayers.length;S++){const N=b.inboundLayers[S],C=b.nodeIndices[S],k=N.inboundNodes[C],I=t[k.id]==null?0:t[k.id];t[k.id]=Math.max(v+1,I),s[k.id]=k}}const p={};for(const b in t){const v=t[b];v in p||(p[v]=[]),p[v].push(s[b])}const f={};for(const b in r){const v=r[b];v in f||(f[v]=[]),f[v].push(o[b])}let m=Object.keys(f).map(b=>parseInt(b,10)).sort(Fl);this.layers=[];for(const b of m){const v=f[b];v.sort((w,S)=>{const N=i[w.id],C=i[S.id];return N<C?-1:N>C?1:0});for(const w of v)w instanceof lr&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=f,m=Object.keys(p).map(b=>parseInt(b,10)).sort(Fl);const g=this.inputs.slice(),x=[];for(const b of m)for(const v of p[b]){const w=v.outboundLayer;if(w!=null){for(const S of v.inputTensors)if(g.indexOf(S)===-1)throw new Ys(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${w.name}". The following previous layers were accessed without issue: ${x}`);for(const S of v.outputTensors)g.push(S);x.push(w.name)}}this.nodesByDepth=p;const y=this.layers.map(b=>b.name);for(const b of y){const v=y.filter(w=>w===b).length;if(v!==1)throw new Ys(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new lh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new G("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=jP(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[c,l]of a.weights.entries()){const d=o?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(s[d]!=null)throw new G(`Duplicate weight name: ${d}`);s[d]=l,r++}const i=[];for(const a in e){let c=a;if(s[a]==null){const l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[c]!=null)i.push([s[c],e[a]]);else if(t)throw new G(`Provided weight data has no target variable: ${a}`);delete s[c]}if(t){const a=[];for(const c in s)a.push(c);if(a.length>0)throw new G(`${a.length} of ${r} weights are not set: ${a}`)}Sg(i)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${e1}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Bp(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ae(()=>{e=nn(e);const s=new go;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Ba(this.outputs,s,t)})}computeMask(e,t){return ae(()=>{e=nn(e);let s;return t==null?s=mi(null,e.length):s=nn(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=gu(e);if(t.length!==this.inputLayers.length)throw new G(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const c=this.inputLayers[a],l=t[a],d=c.name+"_0_0";s[d]=l}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Fl);if(r.length>1)for(const a of r){const c=this.nodesByDepth[a];for(const l of c){const d=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(d.id)!==-1)continue;const h=[];for(let g=0;g<l.inboundLayers.length;g++){const x=l.inboundLayers[g],y=l.nodeIndices[g],b=l.tensorIndices[g],v=`${x.name}_${y}_${b}`,w=s[v];h.push(w)}const p=d.computeOutputShape(ms(h)),f=gu(p),m=d.inboundNodes.indexOf(l);for(let g=0;g<f.length;g++){const x=`${d.name}_${m}_${g}`;s[x]=f[g]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],h=`${c.name}_${l}_${d}`;i.push(h)}for(let a=0;a<i.length;a++){const c=i[a];Ar(c in s),o.push(s[c])}return ms(o)}runInternalGraph(e,t){t==null&&(t=mi(null,e.length));const s={};for(let c=0;c<this.inputs.length;++c){const l=this.inputs[c],d=e[c],h=t[c];s[l.id]=[d,h]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Fl);for(const c of r){const l=this.nodesByDepth[c];for(const d of l){const h=d.outboundLayer,p=d.inputTensors,f=d.outputTensors,m=new Array;for(const g of p)g.id in s&&m.push(s[g.id]);if(m.length===p.length){let g={},x,y,b,v;if(d.callArgs!=null&&(g=d.callArgs),m.length===1){const[w,S]=m[0];g.mask==null&&(g.mask=S),b=nn(h.call(w,g)),v=nn(h.computeMask(w,S)),x=[w],y=[S]}else x=m.map(w=>w[0]),y=m.map(w=>w[1]),g.mask==null&&(g.mask=y),b=nn(h.call(x,g)),v=nn(h.computeMask(x,y));if(h.activityRegularizer)throw new jt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<f.length;++w){const S=f[w],N=b[w],C=v[w];s[S.id]=[N,C]}}}}const o=[],i=[],a=[];for(const c of this.outputs){Ar(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[l,d]=s[c.id];a.push(l.shape),o.push(l),i.push(d)}return[o,i,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof lr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=lr.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new G("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new G(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new G(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ae(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=lr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),c=i.getConfig(),l=[];for(let h=0;h<i.inboundNodes.length;h++){const p=i.inboundNodes[h],f=lr.nodeKey(i,h);let m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){const g=[];for(let x=0;x<p.inboundLayers.length;x++){const y=p.inboundLayers[x],b=p.nodeIndices[x],v=p.tensorIndices[x],w=lr.nodeKey(y,b);let S=t[w];S==null&&(S=0),g.push([y.name,S,v,m])}l.push(g)}}}const d={};d.name=i.name,d.className=a,d.config=c,d.inboundNodes=l,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],c=this.inputLayersNodeIndices[i],l=lr.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.inputLayersTensorIndices[i];r.push([a.name,d,h])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],c=this.outputLayersNodeIndices[i],l=lr.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.outputLayersTensorIndices[i];o.push([a.name,d,h])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function a(x,y){x.name in i?i[x.name].push(y):i[x.name]=[y]}function c(x,y){const b=[];let v;for(const w of y){const S=w[0],N=w[1],C=w[2];if(v=w[3]==null?{}:w[3],!(S in o)){a(x,y);return}const k=o[S];if(k.inboundNodes.length<=N){a(x,y);return}const I=k.inboundNodes[N];b.push(I.outputTensors[C])}b.length>0&&x.apply(ms(b),v)}function l(x){const y=x.name,b=Or(x,t.customObjects!=null?t.customObjects:{});b.setFastWeightInitDuringBuild(r),o[y]=b,x.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new G(`Corrupted configuration, expected array for nodeData: ${w}`);a(b,w)})}const d=t.name,h=t.layers;for(const x of h)l(x);for(;!x_(i);)for(const x of h){const y=o[x.name];if(y.name in i){const b=i[y.name];delete i[y.name];for(const v of b)c(y,v)}}const p=[],f=[],m=t.inputLayers;for(const x of m){const y=x[0],b=x[1],v=x[2];Ar(y in o);const S=o[y].inboundNodes[b].outputTensors;p.push(S[v])}const g=t.outputLayers;for(const x of g){const y=x[0],b=x[1],v=x[2];Ar(y in o);const S=o[y].inboundNodes[b].outputTensors;f.push(S[v])}return new e({inputs:p,outputs:f,name:d})}get stateful(){if(this._stateful)throw new G("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ae(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _P(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function t1(n,e){return _P(n,e,"classWeight")}async function n1(n,e,t,s){if(t!=null){const r=ae(()=>{if(n.shape.length===1)return ei(n);if(n.shape.length===2){if(n.shape[1]>1)return Za(n,1);if(n.shape[1]===1)return ne(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Pt(r);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Es(i,"float32")}else return null}function PP(n,e){return K(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const MP=32;function s1(n,e){let t,s;const r=e;t=r.xs,s=r.ys,E(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=Nx("input",n.inputNames,t),i=Nx("output",n.outputNames,s),a=o[0].shape[0];E(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),E(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<o.length;c++)E(o[c].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${o[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let c=0;c<i.length;c++)E(i[c].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${i[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function Nx(n,e,t){if(t instanceof Pn)return[t];if(Array.isArray(t))return E(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new G(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function FP(n){if(n.length===3)throw new jt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function OP(n,e,t){const s=t.batchesPerEpoch!=null;if(E(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),E(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),E(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),E(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),E(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(Ix(t.validationData))E(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=FP(t.validationData);o=x.xs,i=x.ys}const a=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let l;r?l=c.slice().concat(c.map(x=>"val_"+x)):l=c.slice();const d=Hv(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,{callbackList:p,history:f}=qv(d,h,t.epochs,null,null,LP(e,t),null,r,l);p.setModel(n),n.history=f,await p.onTrainBegin(),n.stopTraining_=!1;let m=t.initialEpoch==null?0:t.initialEpoch,g=await e.iterator();for(;m<t.epochs;){const x={};await p.onEpochBegin(m);let y=0,b=0;for(s||(g=await e.iterator());!s||y<t.batchesPerEpoch;){const v=await g.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:w,ys:S}=s1(n,v.value),N={};N.batch=b,N.size=w[0].shape[0],await p.onBatchBegin(b,N);const C=[];if(t.classWeight!=null){const T=t1(t.classWeight,n.outputNames);for(let _=0;_<T.length;++_)C.push(await n1(S[_],null,T[_]))}const k=w.concat(S).concat(C),I=a(k);Pt(k);for(let T=0;T<c.length;++T){const _=c[T],D=I[T];N[_]=D,_r(D)}await p.onBatchEnd(b,N),Gv(N),b++,y++}if(s?y>=t.batchesPerEpoch:v.done){if(r){let w;Ix(t.validationData)?w=nn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):w=nn(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?MP:t.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)x[`val_${n.metricsNames[S]}`]=w[S]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(m,x),m++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function LP(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function Ix(n){return typeof n.iterator=="function"}function zP(n){return typeof n.next=="function"}async function WP(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new jt("Verbose mode is not implemented yet.");E(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=zP(e)?e:await e.iterator();let a=0,c=0;for(;!s||c<t.batches;){const l=await i.next();if(o=ae(()=>{if(l.value){const{xs:d,ys:h}=s1(n,l.value),p=d.concat(h),f=ae(()=>r(p));if(Pt(p),c===0)for(let g=0;g<f.length;++g)o.push(Yt(0));const m=p[0].shape[0];for(let g=0;g<f.length;++g){const x=f[g],y=o[g];o[g]=ae(()=>Ee(o[g],K(m,x))),c>0&&Pt(y)}Pt(f),a+=m,++c}return o}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<o.length;++l){const d=o[l];o[l]=xt(o[l],a),Pt(d)}return ms(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kh(n){E(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Ma(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>ni(s,e,t-e)):ni(n,e,t-e)}function Vp(n,e){return ae(()=>n==null?null:Array.isArray(n)?n.map(t=>Vp(t,e)):Rv(n,e.dtype==="int32"?e:Xe(e,"int32")))}function Qh(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function r1(n){const e=[];n instanceof Pn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(wl(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function ar(n,e){if(n==null)return;const t=[];if(e instanceof Pn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof Pn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BP(n){return n instanceof Pn}function Up(n){return Array.isArray(n)}function kx(n){return!BP(n)&&!Up(n)}function $x(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(Up(n)&&n.length>0)i=!0;else if(kx(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new G(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(kx(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new G(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(Up(n)){if(n=n,n.length!==e.length)throw new G(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new G(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=r1(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new G(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d>=0&&l!==d)throw new G(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function VP(n,e,t){const s=wo(n.map(o=>o.shape[0]));s.sort();const r=wo(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new G(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new G(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!Jt(s,r))throw new G(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function UP(n,e,t){const s=[uh,dh,oc];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],a=t[r];if(i!=null){if(i===oc&&o.shape[o.shape.length-1]===1)throw new G(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const c=o.shape.slice(1),l=a.slice(1);for(let d=0;d<c.length;++d){const h=c[d],p=l[d];if(p!=null&&h!==p)throw new G(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Tx(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new G(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new G(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new G(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d!==l)throw new G(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function GP(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const HP="layers-model";class Ji extends lr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new G("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");TP(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=$P(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Fo))throw new G("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new G(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(qh(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new G(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>qh(a))}else{const i=qh(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],c=this.outputNames[i];this.feedOutputNames.push(c),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ti("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=GP(e.metrics,this.outputNames),o=(i,a,c)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([c,i])};ti("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(l=>{const d="";let h,p,f;for(const m of l){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===dh?["accuracy","acc"].indexOf(m)!==-1?p=Qv:["crossentropy","ce"].indexOf(m)!==-1&&(p=xP):this.lossFunctions[i]===vu?["accuracy","acc"].indexOf(m)!==-1?p=yP:["crossentropy","ce"].indexOf(m)!==-1&&(p=Jv):["accuracy","acc"].indexOf(m)!==-1?p=Xv:["crossentropy","ce"].indexOf(m)!==-1&&(p=Yv);let y;["accuracy","acc"].indexOf(m)!==-1?y="acc":["crossentropy","ce"].indexOf(m)!==-1&&(y="ce"),f=p,h=d+y}else f=kP(m),h=d+zl(m);let g;ti(h,()=>{g=f}),o(i,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;Kh(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const c=this.testFunction,l=this.testLoop(c,a,r,s.verbose,s.steps);return ms(l)}finally{ar(i[0],e),ar(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),WP(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new G(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new G(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new G("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new go;if(e instanceof Pn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new G(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)i.add(this.inputs[c],e[c])}else for(const c of this.inputs){const l=e[c.name];if(l==null)throw new G(`No value is provided for the model's input ${c.name}`);i.add(c,l)}const a=Ba(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const t=mi(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const c=i.indexOf(e[a]);if(c!==-1&&(t[a]=o[c],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new G(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ae(()=>{const r=this.checkNumSamples(e);if(s)throw new jt("Verbose predictLoop() is not implemented yet.");const o=Qh(r,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ae(()=>{const l=o[a][0],d=o[a][1],h=Ma(e,l,d),p=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)p.push({key:this.inputs[m],value:h[m]});else p.push({key:this.inputs[0],value:h});const f=new go(p);return Ba(this.outputs,f)}).forEach((l,d)=>i[d].push(l));return ms(i.map(a=>xs(a,0)))})}predict(e,t={}){const s=r1(e);Tx(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return Kh(r),this.predictLoop(s,r)}finally{ar(s,e)}}predictOnBatch(e){Tx(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Ys("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===vu?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=$x(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=$x(t,this.feedOutputNames,o,!1,"target"),VP(e,t),UP(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new G(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[a,c]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){const d=t1(r,this.outputNames);l=[];for(let h=0;h<d.length;++h)l.push(await n1(c[h],null,d[h]))}return[a,c,l]}testLoop(e,t,s,r=0,o){return ae(()=>{const i=this.checkNumSamples(t,s,o,"steps"),a=[];if(r>0)throw new jt("Verbose mode is not implemented yet.");if(o!=null)throw new jt("steps mode in testLoop() is not implemented yet");{const c=Qh(i,s),l=Es(yr(0,i));for(let d=0;d<c.length;++d){const h=c[d][0],p=c[d][1],f=ni(l,h,p-h),m=Vp(t,f),g=e(m);if(d===0)for(let x=0;x<g.length;++x)a.push(Yt(0));for(let x=0;x<g.length;++x){const y=g[x];a[x]=Ee(a[x],K(p-h,y))}}for(let d=0;d<a.length;++d)a[d]=xt(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(hx(e,r)>1){const i=hx(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:s[g]});const p=new go(h),f=Ba(this.outputs,p,{training:!0});let m;for(let g=0;g<this.lossFunctions.length;++g){const x=this.lossFunctions[g];let y=x(r[g],f[g]);o[g]!=null&&(y=PP(y,o[g]));const b=Rn(y);t.push(b),g===0?m=y:m=Ee(m,y)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=t[g];else{const y=this.metricsTensors[g][0],b=this.metricsTensors[g][1];x=Rn(y(r[b],f[b]))}_r(x),i.push(x)}return m=Rn(m),this.calculateLosses().forEach(g=>{m=Ee(m,g)}),m},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,c)].concat(i)}}makeTestFunction(){this.testFunction=e=>ae(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let l=0;l<this.inputs.length;++l)i.push({key:this.inputs[l],value:r[l]});const a=new go(i),c=Ba(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const d=this.lossFunctions[l],h=Rn(d(o[l],c[l]));l===0?s=h:s=Ee(s,h),t.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const d=this.metricsTensors[l][0],h=this.metricsTensors[l][1],p=Rn(d(o[h],c[h]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,c,l,d,h,p;try{const f=s.batchSize==null?32:s.batchSize;Kh(f);const g=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,f);r=g[0],o=g[1],p=g[2];let x=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)c=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new jt("validationData including sample weights is not supported yet."):new G(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const T=await this.standardizeUserData(c,l,null,null,!0,f);d=T[0],h=T[1],y=d.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const I=Math.floor(r[0].shape[0]*(1-s.validationSplit)),T=r[0].shape[0];d=Ma(r,I,T),i=r,r=Ma(r,0,I),h=Ma(o,I,T),a=o,o=Ma(o,0,I),y=d.concat(h)}else s.validationSteps!=null&&(x=!0);const b=r.concat(o).concat(p);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let S,N;x?(this.makeTestFunction(),S=this.testFunction,N=w.slice().concat(w.map(I=>"val_"+I))):(S=null,y=[],N=w.slice());const C=Hv(s.callbacks,s.yieldEvery);return await this.fitLoop(v,b,w,f,s.epochs,s.verbose,C,S,y,s.shuffle,N,s.initialEpoch,null,null)}finally{this.isTraining=!1,ar(r,e),ar(o,t),ar(i,e),ar(a,t),ar(d,c),ar(h,l),p!=null&&Pt(p)}}async fitLoop(e,t,s,r,o,i,a,c,l,d,h,p,f,m){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),p==null&&(p=0);let g=!1;if(c!=null&&l!=null&&(g=!0),m!=null&&(g=!0,f==null))throw new G("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,r,f,"steps_per_epoch");let y;x!=null&&(y=yr(0,x)),i==null&&(i=1);const{callbackList:b,history:v}=qv(a,i,o,p,x,f,r,g,h);b.setModel(this),this.history=v,await b.onTrainBegin(),this.stopTraining_=!1;for(let w=p;w<o;++w){await b.onEpochBegin(w);const S={};if(f!=null)throw new jt("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new jt("batch shuffling is not implemneted yet");d&&fk(y);const N=Es(y),C=Qh(x,r);for(let k=0;k<C.length;++k){const I={};if(await b.onBatchBegin(k,I),ae(()=>{const T=C[k][0],_=C[k][1],D=ni(N,T,_-T);I.batch=k,I.size=_-T;const P=Vp(t,D),A=e(P);for(let F=0;F<s.length;++F){const O=s[F],V=A[F];I[O]=V,_r(V)}if(k===C.length-1&&g){const F=this.testLoop(c,l,r);for(let O=0;O<s.length;++O){const V=s[O],L=F[O];_r(L),S["val_"+V]=L}}}),await b.onBatchEnd(k,I),Gv(I),this.stopTraining_)break}N.dispose()}if(await b.onEpochEnd(w,S),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return OP(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),c=[];for(const l of a){const d=await l.data();c.push(d[0])}return Pt(a),ar(s[0],e),ar(s[1],t),ms(c)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=kp().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-kp().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=qr(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>qr(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=qr(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[qr(zl(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>qr(zl(e)));{const e={};for(const t in this.metrics)e[t]=qr(zl(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Iu(e.optimizer_config),s=Or(t);let r;if(typeof e.loss=="string")r=qo(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>qo(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=qo(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>qo(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=qo(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const l=b$(e);if(l.length===0)throw new G(`Cannot find any save handlers for URL '${e}'`);if(l.length>1)throw new G(`Found more than one (${l.length}) save handlers for URL '${e}'`);e=l[0]}if(e.save==null)throw new G("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await q0(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:HP,generatedBy:`TensorFlow.js tfjs-layers v${e1}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:d,specs:h}=await q0(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=d$([s.data,d])}return this.userDefinedMetadata!=null&&(Cx(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){Cx(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Ji.className="Model";ke(Ji);class o1 extends Ji{}o1.className="Functional";ke(o1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function qP(n,e){if(e==null&&(e={}),typeof n=="string"){const t=w$(n,e);if(t.length===0)t.push(eD(n,e));else if(t.length>1)throw new G(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return KP(n,void 0,e)}async function KP(n,e,t){if(t==null&&(t={}),n.load==null)throw new G("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=Or(Iu(r),e,i),c=s.trainingConfig;if(c!=null&&a.loadTrainingConfig(c),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new G("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:l,optimizerWeights:d}=QP(s.weightData,s.weightSpecs);a.loadWeights(l,o),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),Pt(l),Pt(d.map(h=>h.tensor))}return a}function QP(n,e){const t=o$(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class ua extends Ji{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:ah("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new G(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof ua||e instanceof Ji;let s;if(t){if(s=e,s.outputs.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new G("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new G("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=K_({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new G(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new G("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=zv(this.outputs[0])}this.inboundNodes=[],new lh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:mi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Qt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ji({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new G("Legacy serialization format not supported yet.");o=t}else E(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof ua))throw new jt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const c of o){const d=Or(c,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new G("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new G("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}ua.className="Sequential";ke(ua);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XP(n){return new ua(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ns=class extends Ca{getConfig(){return{}}};class i1 extends ns{apply(e,t=1){return D_(e,t)}}i1.className="elu";ke(i1);class a1 extends ns{apply(e){return Sw(e)}}a1.className="selu";ke(a1);class c1 extends ns{apply(e){return Ni(e)}}c1.className="relu";ke(c1);class l1 extends ns{apply(e){return ae(()=>nc(6,Ni(e)))}}l1.className="relu6";ke(l1);class u1 extends ns{apply(e){return e}}u1.className="linear";ke(u1);class d1 extends ns{apply(e){return wa(e)}}d1.className="sigmoid";ke(d1);class h1 extends ns{apply(e){return __(e)}}h1.className="hardSigmoid";ke(h1);class p1 extends ns{apply(e){return hl(e)}}p1.className="softplus";ke(p1);class f1 extends ns{apply(e){return j_(e)}}f1.className="softsign";ke(f1);class m1 extends ns{apply(e){return Yd(e)}}m1.className="tanh";ke(m1);let kg=class extends ns{apply(e,t=-1){return Tm(e,t)}};kg.className="softmax";ke(kg);class g1 extends ns{apply(e,t=-1){return pw(e,t)}}g1.className="logSoftmax";ke(g1);class x1 extends ns{apply(e){return ae(()=>ae(()=>{const t=Math.sqrt(2),s=K(.5,Ee(1,cw(xt(e,t))));return K(e,s)}))}}x1.className="gelu";ke(x1);class y1 extends ns{apply(e){return ae(()=>K(.5,K(e,Ee(1,Yd(K(es(xt(2,Math.PI)),Ee(e,K(.044715,hi(e,3)))))))))}}y1.className="gelu_new";ke(y1);class b1 extends ns{apply(e){return ae(()=>K(e,Yd(hl(e))))}}b1.className="mish";ke(b1);class w1 extends ns{apply(e,t=1){return ae(()=>K(wa(K(e,t)),e))}}w1.className="swish";ke(w1);function ko(n){return n.getClassName()}function Xh(n,e={}){return bl(n,qs.getMap().classNameMap,e,"activation")}function $o(n){if(n==null){const e={};return e.className="linear",e.config={},Xh(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Xh(e)}else return n instanceof ns?n:Xh(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YP(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class v1 extends Ca{}class S1 extends v1{constructor(e){super(),YP(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ae(()=>{let t=Un([1]);return this.hasL1&&(t=Ee(t,gt(K(this.l1,os(e))))),this.hasL2&&(t=Ee(t,gt(K(this.l2,vl(e))))),ne(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}S1.className="L1L2";ke(S1);const Ax={l1l2:"L1L2"};function an(n){return hg(n)}function Ex(n,e={}){return bl(n,qs.getMap().classNameMap,e,"regularizer")}function wn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in Ax?Ax[n]:n,config:{}};return Ex(t)}else return n instanceof v1?n:Ex(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class C1 extends zt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=St(e);let s=Ni(e);return this.maxValue!=null&&(s=Ls(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}C1.className="ReLU";ke(C1);class N1 extends zt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=St(e);return hm(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}N1.className="LeakyReLU";ke(N1);class I1 extends zt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=bn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=wn(e.alphaRegularizer),this.alphaConstraint=Ln(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new G(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Qt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Fn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=St(e),ym(e,this.alpha.read())}getConfig(){const e={alphaInitializer:vn(this.alphaInitializer),alphaRegularizer:an(this.alphaRegularizer),alphaConstraint:On(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}I1.className="PReLU";ke(I1);let k1=class extends zt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new jt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=St(e);return eh(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};k1.className="ELU";ke(k1);class $1 extends zt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=St(e);return K(s,Xe(zs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}$1.className="ThresholdedReLU";ke($1);class T1 extends zt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new kg().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ae(()=>{let s=St(e);const r=t.mask;if(r!=null){const o=K(bt(Mo(s.shape),Xe(r,s.dtype)),Yt(-1e9));s=Ee(s,o)}return this.axis instanceof Array?this.axis.length>1?Wr(bt(s,fw(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}T1.className="Softmax";ke(T1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zi(n,e,t){if(typeof n=="number")return mi(n,e);if(n.length!==e)throw new G(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!T_(r))throw new G(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function xr(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Er(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Io([t-e,0]);else if(s==="same")n=n*e;else throw new G(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $g(n,e){return ae(()=>(An(e),e==="channelsFirst"?Gt(n,[0,2,3,1]):n))}function A1(n,e){return ae(()=>(An(e),e==="channelsFirst"?Gt(n,[0,2,3,4,1]):n))}function JP(n,e,t,s=1,r="valid",o,i=1){return ae(()=>{if(o==null&&(o=br()),An(o),n.shape.length!==3)throw new G(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new G(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new G(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=Gt(n,[0,2,1])),r==="causal")throw new jt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=sw(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(a=Sr(a,t)),a})}function Rx(n,e,t,s=[1,1],r="valid",o,i,a=null){return ae(()=>{if(o==null&&(o=br()),An(o),n.rank!==3&&n.rank!==4)throw new G(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new G(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=$g(n,o);if(r==="causal")throw new jt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=YE({x:c,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(c=Gt(c,[0,3,1,2])),c})}function ZP(n,e,t,s=[1,1,1],r="valid",o,i){return ae(()=>{if(o==null&&(o=br()),An(o),n.rank!==4&&n.rank!==5)throw new G(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new G(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=A1(n,o);if(r==="causal")throw new jt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=X2(a,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(a=Sr(a,t)),o==="channelsFirst"&&(a=Gt(a,[0,4,1,2,3])),a})}class hh extends zt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",hh.verifyArgs(t),this.rank=e,Gn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new jt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Zi(t.kernelSize,e,"kernelSize"),this.strides=Zi(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ws(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,An(this.dataFormat),this.activation=$o(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=bn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ln(t.biasConstraint),this.biasRegularizer=wn(t.biasRegularizer),this.activityRegularizer=wn(t.activityRegularizer),this.dilationRate=Zi(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new G(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new G(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new G(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Ar("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!pg(e.kernelSize,"number",1,3))throw new G(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ko(this.activation),useBias:this.useBias,biasInitializer:vn(this.biasInitializer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),biasConstraint:On(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Na extends hh{constructor(e,t){super(e,t),this.kernel=null,Na.verifyArgs(t),this.filters=t.filters,Gn(this.filters,"filters"),this.kernelInitializer=bn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ln(t.kernelConstraint),this.kernelRegularizer=wn(t.kernelRegularizer)}build(e){e=Qt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ae(()=>{e=St(e);let s;const r=this.bias==null?null:this.bias.read(),o=Iv(this.activation.getClassName());if(o!=null&&this.rank===2)s=Rx(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=JP(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Rx(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=ZP(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new jt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Qt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=xr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:vn(this.kernelInitializer),kernelRegularizer:an(this.kernelRegularizer),kernelConstraint:On(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new G(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Il extends Na{constructor(e){super(2,e),Il.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!pg(e.kernelSize,"number",1,2))throw new G(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Il.className="Conv2D";ke(Il);class kl extends Na{constructor(e){super(3,e),kl.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new G(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}kl.className="Conv3D";ke(kl);class E1 extends Il{constructor(e){if(super(e),this.inputSpec=[new Fn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qt(e),e.length!==4)throw new G("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Fn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ae(()=>{let s=St(e);if(s.shape.length!==4)throw new G(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const c=r[i],l=r[a],d=this.kernelSize[0],h=this.kernelSize[1],p=this.strides[0],f=this.strides[1],m=Er(c,p,d,this.padding),g=Er(l,f,h,this.padding),x=[o,m,g,this.filters];this.dataFormat!=="channelsLast"&&(s=Gt(s,[0,2,3,1]));let y=rw(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Gt(y,[0,3,1,2])),this.bias!=null&&(y=Sr(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Qt(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return t[s]=this.filters,t[r]=Er(t[r],c,i,this.padding),t[o]=Er(t[o],l,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}E1.className="Conv2DTranspose";ke(E1);class R1 extends kl{constructor(e){if(super(e),this.inputSpec=[new Fn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new G(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qt(e),e.length!==5)throw new G("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new G("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Fn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ae(()=>{let s=St(e);if(s.shape.length!==5)throw new G(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,c;this.dataFormat==="channelsFirst"?(c=2,i=3,a=4):(c=1,i=2,a=3);const l=r[c],d=r[i],h=r[a],p=this.kernelSize[0],f=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],x=this.strides[1],y=this.strides[2],b=Er(l,g,p,this.padding),v=Er(d,x,f,this.padding),w=Er(h,y,m,this.padding),S=[o,b,v,w,this.filters];this.dataFormat!=="channelsLast"&&(s=Gt(s,[0,2,3,4,1]));let N=Z2(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=Gt(N,[0,4,1,2,3])),this.bias!==null&&(N=Sr(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(e){e=Qt(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],d=this.strides[0],h=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=Er(t[r],d,a,this.padding),t[o]=Er(t[o],h,c,this.padding),t[i]=Er(t[i],p,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}R1.className="Conv3DTranspose";ke(R1);class D1 extends Na{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new G("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new G("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new G(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=bn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=wn(t.depthwiseRegularizer),this.depthwiseConstraint=Ln(t.depthwiseConstraint),this.pointwiseInitializer=bn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=wn(t.pointwiseRegularizer),this.pointwiseConstraint=Ln(t.pointwiseConstraint)}build(e){if(e=Qt(e),e.length<this.rank+2)throw new G(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new G(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Fn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ae(()=>{e=St(e);let s;if(this.rank===1)throw new jt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Gt(e,[0,2,3,1])),s=Cw(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Sr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Gt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=vn(this.depthwiseInitializer),e.pointwiseInitializer=vn(this.pointwiseInitializer),e.depthwiseRegularizer=an(this.depthwiseRegularizer),e.pointwiseRegularizer=an(this.pointwiseRegularizer),e.depthwiseConstraint=On(this.depthwiseConstraint),e.pointwiseConstraint=On(this.pointwiseConstraint),e}}D1.className="SeparableConv";class j1 extends D1{constructor(e){super(2,e)}}j1.className="SeparableConv2D";ke(j1);class ph extends Na{constructor(e){super(1,e),ph.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!pg(e.kernelSize,"number",1,1))throw new G(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}ph.className="Conv1D";ke(ph);class _1 extends zt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ae(()=>{if(e=St(e),this.dataFormat==="channelsLast"){const s=Ll(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ll(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Ll(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ll(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}_1.className="Cropping2D";ke(_1);class P1 extends zt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,I_(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ae(()=>{let s=St(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Gt(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?Xr.resizeNearestNeighbor(s,[o,i]):Xr.resizeBilinear(s,[o,i]);return Gt(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?Xr.resizeNearestNeighbor(s,[o,i]):Xr.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}P1.className="UpSampling2D";ke(P1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eM(n,e,t=[1,1],s="valid",r,o){return ae(()=>{r==null&&(r=br()),An(r);let i=$g(n,r);if(n.rank!==4)throw new G(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new G(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=cm(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=Gt(i,[0,3,1,2])),i})}class M1 extends hh{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=bn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ln(e.depthwiseConstraint),this.depthwiseRegularizer=wn(e.depthwiseRegularizer)}build(e){if(e=Qt(e),e.length<4)throw new G(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new G(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{e=St(e);let s=eM(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Sr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Qt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=xr(t,this.kernelSize[0],this.padding,this.strides[0]),i=xr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=vn(this.depthwiseInitializer),e.depthwiseRegularizer=an(this.depthwiseRegularizer),e.depthwiseConstraint=On(this.depthwiseRegularizer),e}}M1.className="DepthwiseConv2D";ke(M1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function F1(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new G("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function O1(n,e,t,s=!1,r,o,i=!1,a=!1){return ae(()=>{const c=e.shape.length;if(c<3)throw new G(`Input should be at least 3D, but is ${c}D.`);const l=[1,0].concat(yr(2,c));e=Gt(e,l),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Xe(Xe(r,"bool"),"float32"),r.rank===c-1&&(r=fs(r,-1)),r=Gt(r,l)),s&&(e=pi(e,0),r!=null&&(r=pi(r,0)));const d=[];let h,p=t;const f=e.shape[0],m=fi(e);let g;r!=null&&(g=fi(r));for(let y=0;y<f;++y){const b=m[y],v=ae(()=>n(b,p));if(r==null)h=v[0],p=v[1];else{const w=ae(()=>{const S=g[y],N=bt(er(S),S),C=Ee(K(v[0],S),K(p[0],N)),k=p.map((I,T)=>Ee(K(v[1][T],S),K(I,N)));return{output:C,newStates:k}});h=w.output,p=w.newStates}a&&d.push(h)}let x;return a&&(x=eo(d,1)),[h,x,p]})}class Oo extends zt{constructor(e){super(e);let t;if(e.cell==null)throw new G("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Eg({cells:e.cell}):t=e.cell,t.stateSize==null)throw new G("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Fn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return yr(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Lp(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return ae(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new jt("Constants support is not implemented in RNN yet.");Lp(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Fn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Jt(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new G(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Fn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ae(()=>{if(!this.stateful)throw new Tr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Un([s,r])):this.states_=[Un([s,this.cell.stateSize])];else if(e==null)Pt(this.states_),this.keptStates!=null&&(Pt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Un([s,r])):this.states_[0]=Un([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Pt(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!Jt(o.shape,a))throw new G(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>_r(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=F1(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new Fn({shape:l.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Vr){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const p=super.apply(l,t);return this.inputSpec=h,p}else return super.apply(e,t)}call(e,t){return ae(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=St(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new G(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},l=O1((m,g)=>{const x=this.cell.call([m].concat(g),a);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=l[0],h=l[1],p=l[2];this.stateful&&this.resetStates(p,r);const f=this.returnSequences?h:d;return this.returnState?[f].concat(p):f})}getInitialState(e){return ae(()=>{let t=Un(e.shape);return t=gt(t,[1,2]),t=wl(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Fp(t,[1,s]):t):this.cell.stateSize>1?[Fp(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Oo.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=Or(r,s);return new e(Object.assign(t,{cell:o}))}}Oo.className="RNN";ke(Oo);class fh extends zt{}class Tg extends fh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=$o(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=bn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=bn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=bn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=wn(e.kernelRegularizer),this.recurrentRegularizer=wn(e.recurrentRegularizer),this.biasRegularizer=wn(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=la([1,Io([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=la([1,Io([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{if(e=e,e.length!==2)throw new G(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=To({ones:()=>er(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=To({ones:()=>er(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Fr(K(e,i),this.kernel.read()):o=Fr(e,this.kernel.read()),this.bias!=null&&(o=Sr(o,this.bias.read())),a!=null&&(s=K(s,a));let c=Ee(o,Fr(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ko(this.activation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:an(this.kernelRegularizer),recurrentRegularizer:an(this.recurrentRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),recurrentConstraint:On(this.recurrentConstraint),biasConstraint:On(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Tg.className="SimpleRNNCell";ke(Tg);class L1 extends Oo{constructor(e){e.cell=new Tg(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}L1.className="SimpleRNN";ke(L1);class Ag extends fh{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new G("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Gn(this.units,"units"),this.activation=$o(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=$o(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=bn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=bn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=bn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=wn(e.kernelRegularizer),this.recurrentRegularizer=wn(e.recurrentRegularizer),this.biasRegularizer=wn(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=la([1,Io([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=la([1,Io([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{if(e=e,e.length!==2)throw new G(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=To({ones:()=>er(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=To({ones:()=>er(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,c,l;0<this.dropout&&this.dropout<1&&(e=K(e,o[0]));let d=Fr(e,this.kernel.read());this.useBias&&(d=Sr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=K(r,i[0]));const h=this.recurrentKernel.read(),[p,f]=Os(h,[2*this.units,this.units],h.rank-1),m=Fr(r,p),[g,x,y]=Os(d,3,d.rank-1),[b,v]=Os(m,2,m.rank-1);a=this.recurrentActivation.apply(Ee(g,b)),c=this.recurrentActivation.apply(Ee(x,v));const w=Fr(K(c,r),f);l=this.activation.apply(Ee(y,w));const S=Ee(K(a,r),K(Ee(1,kn(a)),l));return[S,S]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ko(this.activation),recurrentActivation:ko(this.recurrentActivation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:an(this.kernelRegularizer),recurrentRegularizer:an(this.recurrentRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),recurrentConstraint:On(this.recurrentConstraint),biasConstraint:On(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Ag.className="GRUCell";ke(Ag);class z1 extends Oo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ag(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}z1.className="GRU";ke(z1);class mh extends fh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=$o(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=$o(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=bn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=bn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=bn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=wn(e.kernelRegularizer),this.recurrentRegularizer=wn(e.recurrentRegularizer),this.biasRegularizer=wn(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=la([1,Io([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=la([1,Io([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Qt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends nr{apply(c,l){const d=o.apply([i]),h=new mg().apply([i]),p=o.apply([i*2]);return fx(fx(d,h),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ae(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new G(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=To({ones:()=>er(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=To({ones:()=>er(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let c,l,d,h;0<this.dropout&&this.dropout<1&&(e=K(e,i[0]));let p=Fr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=K(r,a[0])),p=Ee(p,Fr(r,this.recurrentKernel.read())),this.useBias&&(p=Sr(p,this.bias.read()));const[f,m,g,x]=Os(p,4,p.rank-1);c=this.recurrentActivation.apply(f),l=this.recurrentActivation.apply(m),d=Ee(K(l,o),K(c,this.activation.apply(g))),h=this.recurrentActivation.apply(x);const y=K(h,this.activation.apply(d));return[y,y,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ko(this.activation),recurrentActivation:ko(this.recurrentActivation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:an(this.kernelRegularizer),recurrentRegularizer:an(this.recurrentRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),recurrentConstraint:On(this.recurrentConstraint),biasConstraint:On(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}mh.className="LSTMCell";ke(mh);class W1 extends Oo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new mh(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}W1.className="LSTM";ke(W1);class Eg extends fh{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ae(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const c=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=c.call(i,t),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){Lp(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{ti(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(Or(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return zp(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}Sg(t)}}Eg.className="StackedRNNCells";ke(Eg);function To(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):Dv(e(),t),a=()=>Sl(i,e,s);return!r||r<=1?_r(a().clone()):Array(r).fill(void 0).map(a).map(l=>_r(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var tM=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class B1 extends Oo{constructor(e){if(e.unroll)throw new jt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new jt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Fn({ndim:5})]}call(e,t){return ae(()=>{if(this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new G("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ae(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Un(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){ae(()=>{if(!this.stateful)throw new Tr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new G("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Un(o)):this.states_=[Un(o)];else if(e==null)Pt(this.states_),this.keptStates!=null&&(Pt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Un(o)):this.states_[0]=Un(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new G(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Pt(this.states_);for(let a=0;a<this.states_.length;++a){const c=e[a],l=o;if(!Jt(c.shape,l))throw new G(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${c.shape}`);this.states_[a]=c}}this.states_=this.states_.map(a=>_r(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,c=t==="channelsFirst",l=e[c?3:2],d=e[c?4:3],h=xr(l,r[0],o,i[0],a[0]),p=xr(d,r[1],o,i[1],a[1]);return[...e.slice(0,2),...c?[s,h,p]:[h,p,s]]}}B1.className="ConvRNN2D";class Rg extends mh{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Gn(this.filters,"filters"),this.kernelSize=Zi(s,2,"kernelSize"),this.kernelSize.forEach(c=>Gn(c,"kernelSize")),this.strides=Zi(r||1,2,"strides"),this.strides.forEach(c=>Gn(c,"strides")),this.padding=o||"valid",Ws(this.padding),this.dataFormat=i||"channelsLast",An(this.dataFormat),this.dilationRate=Zi(a||1,2,"dilationRate"),this.dilationRate.forEach(c=>Gn(c,"dilationRate"))}build(e){var t;e=Qt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new G(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const l=this.biasInitializer,d=this.filters;c=new(t=class extends nr{apply(p,f){const m=l.apply([d]),g=Mo([d]),x=l.apply([d*2]);return fg([m,g,x])}},t.className="CustomInit",t)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ae(()=>{if(e.length!==3)throw new G(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=To({ones:()=>er(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,l=(J,X,fe)=>!X||!X[fe]?J:K(X[fe],J);let d=l(r,c,0),h=l(r,c,1),p=l(r,c,2),f=l(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=To({ones:()=>er(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let g=l(o,m,0),x=l(o,m,1),y=l(o,m,2),b=l(o,m,3);const v=3,[w,S,N,C]=Os(this.kernel.read(),a,v),[k,I,T,_]=this.useBias?Os(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,w,k,this.padding),h=this.inputConv(h,S,I,this.padding),p=this.inputConv(p,N,T,this.padding),f=this.inputConv(f,C,_,this.padding);const[D,P,A,F]=Os(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,D),x=this.recurrentConv(x,P),y=this.recurrentConv(y,A),b=this.recurrentConv(b,F);const O=this.recurrentActivation.apply(Ee(d,g)),V=this.recurrentActivation.apply(Ee(h,x)),L=Ee(K(V,i),K(O,this.activation.apply(Ee(p,y)))),H=K(this.recurrentActivation.apply(Ee(f,b)),this.activation.apply(L));return[H,H,L]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=tM(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=di(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Sr(o,s,this.dataFormat):o}recurrentConv(e,t){return di(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Rg.className="ConvLSTM2DCell";ke(Rg);class V1 extends B1{constructor(e){const t=new Rg(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}V1.className="ConvLSTM2D";ke(V1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gh extends zt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Sl(()=>Dv(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}gh.className="Dropout";ke(gh);class U1 extends gh{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}U1.className="SpatialDropout1D";ke(U1);class Dg extends zt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Gn(this.units,"units"),this.activation=$o(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=bn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=bn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ln(e.kernelConstraint),this.biasConstraint=Ln(e.biasConstraint),this.kernelRegularizer=wn(e.kernelRegularizer),this.biasRegularizer=wn(e.biasRegularizer),this.activityRegularizer=wn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Qt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Qt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e),r=Iv(this.activation.getClassName());let o;return r!=null?o=Fr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Fr(s,this.kernel.read()),this.bias!=null&&(o=Sr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:ko(this.activation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:an(this.kernelRegularizer),biasRegularizer:an(this.biasRegularizer),activityRegularizer:an(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),biasConstraint:On(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Dg.className="Dense";ke(Dg);class G1 extends zt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Qt(e);for(const t of e.slice(1))if(t==null)throw new G(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],vo(e,1)]}call(e,t){return ae(()=>{this.invokeCallHook(e,t);let s=St(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=Gt(s,r)}return R_(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}G1.className="Flatten";ke(G1);class H1 extends zt{constructor(e){super(e),this.supportsMasking=!0,this.activation=$o(e.activation)}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e);return this.activation.apply(s)})}getConfig(){const e={activation:ko(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}H1.className="Activation";ke(H1);class q1 extends zt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ae(()=>(e=St(e),A_(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}q1.className="RepeatVector";ke(q1);class K1 extends zt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let c=0;c<r.length;++c){const l=r[c];if(this.isUnknown(l))if(i===null)i=c;else throw new G("Can only specifiy one unknown dimension.");else o*=l}const a=vo(e);if(i!==null){if(o===0||a%o!==0)throw new G(s);r[i]=a/o}else if(a!==o)throw new G(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ne(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}K1.className="Reshape";ke(K1);class Q1 extends zt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=yr(1,e.dims.length+1);if(!Jt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Fn({ndim:this.dims.length+1})]}computeOutputShape(e){e=Qt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return Gt(St(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Q1.className="Permute";ke(Q1);class X1 extends zt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=St(e);return Ep(pu(s,this.maskValue),-1)}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e),i=Ep(pu(s,this.maskValue),-1,!0);return K(s,Xe(i,s.dtype))})}}X1.className="Masking";ke(X1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Y1 extends zt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(nn(e.inputLength))}this.inputDim=e.inputDim,Gn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Gn(this.outputDim,"outputDim"),this.embeddingsInitializer=bn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=wn(e.embeddingsRegularizer),this.activityRegularizer=wn(e.activityRegularizer),this.embeddingsConstraint=Ln(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ae(()=>this.maskZero?(e=St(e),pu(e,Ht(e))):null)}computeOutputShape(e){if(e=Qt(e),this.inputLength==null)return[...e,this.outputDim];const t=nn(this.inputLength);if(t.length!==e.length-1)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new G(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ae(()=>{this.invokeCallHook(e,t);let s=St(e);s.dtype!=="int32"&&(s=Mr(s,"int32"));const r=Rv(this.embeddings.read(),ne(s,[s.size]));return ne(r,Qt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:vn(this.embeddingsInitializer),embeddingsRegularizer:an(this.embeddingsRegularizer),activityRegularizer:an(this.activityRegularizer),embeddingsConstraint:On(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}Y1.className="Embedding";ke(Y1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $i extends zt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new jt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new G("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Qt(e)]),e=e,e.length<2)throw new G(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=wo(t),t.length>1)throw new G(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&wo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ae(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Io(r);for(let i of e){const a=i.rank;for(let c=0;c<o-a;++c)i=wl(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const c of e){const l=c.rank;if(l==null){const d=c.shape,h=d[0],p=d.slice(1).concat([h]);let f=ne(c,[h].concat(vo(d.slice(1))));f=Gt(f,[1,0]),f=ne(f,p),s.push(f),o=!0}else if(l>1){const d=yr(1,l).concat([0]);s.push(Gt(c,d)),o=!0}else s.push(c)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const c=i.shape,l=c.length,d=c[l-1],h=[d].concat(c.slice(0,c.length-1));i=ne(Gt(ne(i,[-1,d]),[1,0]),h)}else if(a>1){const c=[a-1].concat(yr(0,a-1));i=Gt(i,c)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=wo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ae(()=>{if(t==null)return null;if(!Array.isArray(t))throw new G("`mask` should be an Array");if(!Array.isArray(e))throw new G("`inputs` should be an Array");if(t.length!==e.length)throw new G(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:fs(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=Zr(s,t[r]);return s})}}class J1 extends $i{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ee(t,e[s]);return t})}}J1.className="Add";ke(J1);class Z1 extends $i{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=K(t,e[s]);return t})}}Z1.className="Multiply";ke(Z1);class eS extends $i{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Ee(t,e[s]);return K(1/e.length,t)})}}eS.className="Average";ke(eS);class tS extends $i{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Po(t,e[s]);return t})}}tS.className="Maximum";ke(tS);class nS extends $i{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=nc(t,e[s]);return t})}}nS.className="Minimum";ke(nS);class sS extends $i{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new G("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(Jt(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new G("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ae(()=>fg(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new G("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new G("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new G("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new G(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ae(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(Xe(er(e[i]),"bool")):t[i].rank<e[i].rank?r.push(fs(t[i],-1)):r.push(t[i]);const o=xs(r,this.axis);return nw(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}sS.className="Concatenate";ke(sS);function Fa(n,e){for(;n<0;)n+=e;return n}function nM(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new jt("batchDot is not implemented for tensors of 4D or higher rank yet");if(E(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),E(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new jt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return ae(()=>{let i;if(s>r){i=s-r;const c=[];for(let l=0;l<i;++l)c.push(1);e=ne(e,e.shape.concat(c))}else if(r>s){i=r-s;const c=[];for(let l=0;l<i;++l)c.push(1);n=ne(n,n.shape.concat(c))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=gt(K(n,e),o[0]):a=gt(K(Gt(n,[1,0]),e),o[1]);else{const c=o[0]!==n.shape.length-1,l=o[1]===e.shape.length-1;a=Xt(n,e,c,l)}if(i>0){let c;s>r?c=s+r-3:c=s-1;const l=[];for(let d=c;d<c+i;++d)l.push(d);a=fl(a,l)}return a.shape.length===1&&(a=fs(a,1)),a})}class rS extends $i{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){E(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new jt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new G(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new G(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>Fa(o,e[i].shape.length)):r=[Fa(this.axes,t.shape.length),Fa(this.axes,s.shape.length)],this.normalize&&(t=wu(t,r[0]),s=wu(s,r[1])),nM(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Fa(this.axes,e.length),Fa(this.axes,t.length)],s}computeOutputShape(e){E(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new jt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}rS.className="Dot";ke(rS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class oS extends zt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e);return Sl(()=>Ee(ch(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}oS.className="GaussianNoise";ke(oS);class iS extends zt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=St(e);return this.rate>0&&this.rate<1?Sl(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return K(s,ch(s.shape,1,o))},()=>s,t.training||!1):s})}}iS.className="GaussianDropout";ke(iS);class aS extends zt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||St(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ae(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Sl(()=>{const o=St(e),a=-1.6732632423543772*1.0507009873554805;let c=Si(pl(s),this.rate);c=Mr(c,"float32");const l=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-l*a*this.rate,h=Ee(K(o,c),K(Ee(c,-1),a));return Ee(K(h,l),d)},()=>St(e),t.training||!1)}return e})}}aS.className="AlphaDropout";ke(aS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ic(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=k2(n,e,t,s,r,o);else if(n.rank===3)i=T2(n,e,t,s,r,o);else if(n.rank===4)i=E2(n,e,t,s,r,o);else throw new jt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function sM(n,e,t,s,r=.001){return ae(()=>{const o=mm(n,s),i=o.mean,a=o.variance;return[ic(n,i,a,t,e,r),i,a]})}function rM(n,e,t,s,r=.001){return ae(()=>{const o=mm(n,s),i=o.mean,a=o.variance,c=[];for(const m of yr(0,n.rank))s.indexOf(m)!==-1?c.push(1):c.push(n.shape[m]);const l=ne(i,c),d=ne(a,c),h=e==null?null:ne(e,c),p=t==null?null:ne(t,c);return[ic(n,l,d,p,h,r),i,a]})}function oM(n,e,t,s,r=.001){return Jt(s.slice().sort(),yr(0,n.rank-1))?sM(n,e,t,s,r):rM(n,e,t,s,r)}class cS extends zt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=bn(e.betaInitializer||"zeros"),this.gammaInitializer=bn(e.gammaInitializer||"ones"),this.movingMeanInitializer=bn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=bn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Ln(e.betaConstraint),this.gammaConstraint=Ln(e.gammaConstraint),this.betaRegularizer=wn(e.betaRegularizer),this.gammaRegularizer=wn(e.gammaRegularizer)}build(e){e=Qt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new G(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Fn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ae(()=>{const s=t.training==null?!1:t.training,r=St(e),o=r.shape,i=o.length,a=yr(0,i),c=this.axis>=0?this.axis:this.axis+i;a.splice(c,1);const l=mi(1,i);l[c]=o[c];const d=a.slice();d.sort();const h=!Jt(d,yr(0,i).slice(0,i-1)),p=()=>{if(h){const b=ne(this.movingMean.read(),l),v=ne(this.movingVariance.read(),l),w=this.center?ne(this.beta.read(),l):null,S=this.scale?ne(this.gamma.read(),l):null;return ic(r,b,v,w,S,this.epsilon)}else return ic(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[f,m,g]=oM(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(b,v,w)=>{ae(()=>{const S=1-w,N=b.read(),C=K(bt(N,v),S);b.write(bt(N,C))})};return(()=>{x(this.movingMean,m,this.momentum),x(this.movingVariance,g,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:vn(this.betaInitializer),gammaInitializer:vn(this.gammaInitializer),movingMeanInitializer:vn(this.movingMeanInitializer),movingVarianceInitializer:vn(this.movingVarianceInitializer),betaRegularizer:an(this.betaRegularizer),gammaRegularizer:an(this.gammaRegularizer),betaConstraint:On(this.betaConstraint),gammaConstraint:On(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}cS.className="BatchNormalization";ke(cS);class lS extends zt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=bn(e.betaInitializer||"zeros"),this.gammaInitializer=bn(e.gammaInitializer||"ones"),this.betaRegularizer=wn(e.betaRegularizer),this.gammaRegularizer=wn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Qt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==wo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=St(e),r=s.shape,o=r.length;return ae(()=>{let{mean:a,variance:c}=mm(s,this.axis,!0);const l=mi(1,o);for(const g of this.axis)l[g]=r[g];const d=g=>g!=null&&g.shape.length!==o?ne(g,l):g;let h=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const f=[],m=[];for(let g=0;g<o;++g)this.axis.indexOf(g)!==-1?(f.push(r[g]),m.push(1)):(f.push(1),m.push(r[g]));return a=fr(a,f),c=fr(c,f),h!=null&&(h=fr(h,m)),p!=null&&(p=fr(p,m)),ic(s,a,c,p,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:vn(this.betaInitializer),gammaInitializer:vn(this.gammaInitializer),betaRegularizer:an(this.betaRegularizer),gammaRegularizer:an(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}lS.className="LayerNormalization";ke(lS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iM(n,e,t){return ae(()=>{if(n.rank!==4)throw new G(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new G("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=br()),t!=="channelsLast"&&t!=="channelsFirst")throw new G(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],gm(n,s)})}class uS extends zt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?br():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new G(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new G(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new G(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Fn({ndim:4})]}computeOutputShape(e){e=Qt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ae(()=>iM(St(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}uS.className="ZeroPadding2D";ke(uS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xh(n,e,t,s,r,o){return ae(()=>{An(r),$v(o),Ws(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=br()),o==null&&(o="max"),n=$g(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=fm(n,e,t,a):i=rm(n,e,t,a),r==="channelsFirst"&&(i=Gt(i,[0,3,1,2])),i})}function dS(n,e,t,s,r,o){return ae(()=>{An(r),$v(o),Ws(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=br()),o==null&&(o="max"),n=A1(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=fA(n,e,t,a):i=g2(n,e,t,a),r==="channelsFirst"&&(i=Gt(i,[0,4,1,2,3])),i})}class hS extends zt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new G(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Gn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new G(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ws(this.padding),this.inputSpec=[new Fn({ndim:3})]}computeOutputShape(e){e=Qt(e);const t=xr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ae(()=>{this.invokeCallHook(e,t),e=wl(St(e),2);const s=this.poolingFunction(St(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return fl(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class pS extends hS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),xh(e,t,s,r,o,"max")}}pS.className="MaxPooling1D";ke(pS);class fS extends hS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),xh(e,t,s,r,o,"avg")}}fS.className="AveragePooling1D";ke(fS);class mS extends zt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new G(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),Ws(this.padding),this.inputSpec=[new Fn({ndim:4})]}computeOutputShape(e){e=Qt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=xr(t,this.poolSize[0],this.padding,this.strides[0]),s=xr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ae(()=>(this.invokeCallHook(e,t),this.poolingFunction(St(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class gS extends mS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),xh(e,t,s,r,o,"max")}}gS.className="MaxPooling2D";ke(gS);class xS extends mS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),xh(e,t,s,r,o,"avg")}}xS.className="AveragePooling2D";ke(xS);class yS extends zt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new G(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),Ws(this.padding),this.inputSpec=[new Fn({ndim:5})]}computeOutputShape(e){e=Qt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=xr(t,this.poolSize[0],this.padding,this.strides[0]),s=xr(s,this.poolSize[1],this.padding,this.strides[1]),r=xr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ae(()=>(this.invokeCallHook(e,t),this.poolingFunction(St(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class bS extends yS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),dS(e,t,s,r,o,"max")}}bS.className="MaxPooling3D";ke(bS);class wS extends yS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),dS(e,t,s,r,o,"avg")}}wS.className="AveragePooling3D";ke(wS);class vS extends zt{constructor(e){super(e),this.inputSpec=[new Fn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new jt}}class SS extends vS{constructor(e){super(e||{})}call(e,t){return ae(()=>{const s=St(e);return Rn(s,1)})}}SS.className="GlobalAveragePooling1D";ke(SS);class CS extends vS{constructor(e){super(e||{})}call(e,t){return ae(()=>{const s=St(e);return gr(s,1)})}}CS.className="GlobalMaxPooling1D";ke(CS);class NS extends zt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),this.inputSpec=[new Fn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new jt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class IS extends NS{call(e,t){return ae(()=>{const s=St(e);return this.dataFormat==="channelsLast"?Rn(s,[1,2]):Rn(s,[2,3])})}}IS.className="GlobalAveragePooling2D";ke(IS);class kS extends NS{call(e,t){return ae(()=>{const s=St(e);return this.dataFormat==="channelsLast"?gr(s,[1,2]):gr(s,[2,3])})}}kS.className="GlobalMaxPooling2D";ke(kS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $S extends zt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=Or(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class TS extends $S{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Qt(e),e.length<3)throw new G(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Qt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ae(()=>(e=St(e),O1((i,a)=>[St(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}TS.className="TimeDistributed";ke(TS);function aM(n){ki(N_,"BidirectionalMergeMode",n)}const cM="concat";class AS extends $S{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Or(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Or(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?cM:e.mergeMode,aM(this.mergeMode),e.weights)throw new jt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):ms(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=F1(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new G("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(h=>new Fn({shape:h.shape}));this.forwardLayer.stateSpec=d.slice(0,l/2),this.backwardLayer.stateSpec=d.slice(l/2),a.push(...d)}if(r!=null)throw new jt("Support for constants in Bidirectional layers is not implemented yet.");const c=i[0]instanceof Vr;for(const l of i)if(l instanceof Vr!==c)throw new G("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const p=super.apply(l,t);return this.inputSpec=h,p}else return super.apply(e,t)}call(e,t){return ae(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const c=s.slice(0,s.length/2),l=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:c})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:l}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=pi(o,1));let a;return this.mergeMode==="concat"?a=fg([r,o]):this.mergeMode==="sum"?a=Ee(r,o):this.mergeMode==="ave"?a=K(.5,Ee(r,o)):this.mergeMode==="mul"?a=K(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ti(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ti(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Or(t.layer);if(delete t.layer,t.numConstants!=null)throw new jt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}AS.className="Bidirectional";ke(AS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ES extends zt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ae(()=>(e=St(e),e.dtype!=="float32"&&(e=Mr(e,"float32")),Ee(K(e,this.scale),this.offset)))}}ES.className="Rescaling";ke(ES);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:lM,cropAndResize:uM}=Xr;class RS extends zt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,i,a,c){return ae(()=>{let l,d=!1;const h=t/i,p=s/a,f=(r+t)/i,m=(o+s)/a,g=[h,p,f,m],x=[];e.rank===3?(d=!0,l=eo([e])):l=e;for(let S=0;S<l.shape[0];S++)x.push(g);const y=Qi(x,[x.length,4]),b=sc(0,x.length,1,"int32"),w=uM(l,y,b,[r,o],"nearest");return Mr(d?St(fi(w)):w,c)})}upsize(e,t,s,r){return ae(()=>{const o=lM(e,[t,s]);return Mr(o,r)})}call(e,t){return ae(()=>{const s=St(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let c=0;i!==this.height&&(c=Math.floor((i-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),c>=0&&l>=0?this.centerCrop(s,c,l,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Qt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}RS.className="CenterCrop";ke(RS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function dM(n,e,t,s){let r=St(n);if(r.dtype!=="int32"&&(r=Mr(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=fs(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=fs(r,-1)),r.rank>2)throw new G(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let c;if(typeof s<"u"&&e==="count"?c=Y0(a,s,t,i):c=Y0(a,[],t,i),e!=="tfIdf")return c;if(s)return K(c,s);throw new G("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DS extends zt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Qt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ae(()=>{e=St(e),e.dtype!=="int32"&&(e=Mr(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new G(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=St(t.countWeights)}const r=gr(e),o=du(e),i=zs(this.numTokens,r).bufferSync().get(0),a=Si(o,0).bufferSync().get(0);if(!(i&&a))throw new G(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return dM(e,this.outputMode,this.numTokens,s)})}}DS.className="CategoryEncoding";ke(DS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const hM=["bilinear","nearest"],Dx=new Set(hM);class jS extends zt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(Dx.has(e.interpolation))this.interpolation=e.interpolation;else throw new G(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Qt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ae(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Xr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...Dx]} are supported`)})}}jS.className="Resizing";ke(jS);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _S{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}_S.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class PS extends zt{constructor(e){super(e),this.randomGenerator=new _S(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}PS.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const pM=["bilinear","nearest"],jx=new Set(pM);class MS extends PS{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new G(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new G(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new G(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(jx.has(s))this.interpolation=s;else throw new G(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Qt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ae(()=>{const s=St(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=pl([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Xr.resizeBilinear(e,i);case"nearest":return Xr.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...jx]} are supported`)}})}}MS.className="RandomWidth";ke(MS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yh(n){return new Dg(n)}function fM(n){return new gh(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mM=he();mM.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var _x;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(_x||(_x={}));var Px;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(Px||(Px={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Mx;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Mx||(Mx={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function st(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&E(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gM=Rw;class yh extends of{nextDataId(){return yh.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Jy(this,Ir())}write(e,t,s){this.firstUse&&(this.firstUse=!1,he().get("IS_NODE")&&Ms(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&mc(s[0])){const o=s.map(i=>bo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return to(r,o)}return wk(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>No(r));return Ot(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ot(e.shape,e.dtype,t)}makeOutput(e,t,s){return Ir().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=hs();return e(),{kernelMs:hs()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){st([e],"where");const t=this.readSync(e.dataId);return gM(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}yh.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FS(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const xM=n=>{const{x:e}=n.inputs,t=n.backend;st(e,"abs");let s=new Float32Array(we(e.shape));const r=t.data.get(e.dataId).values;return s=FS(r),t.makeOutput(s,e.shape,e.dtype)},yM={kernelName:Ku,backendName:"cpu",kernelFunc:xM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function En(n){return(e,t,s,r,o)=>{const i=At(e,t),a=i.length,c=pt(i),l=we(i),d=Jn(o,l),h=e.length,p=t.length,f=pt(e),m=pt(t),g=aa(e,i),x=aa(t,i);if(g.length+x.length===0)for(let y=0;y<d.length;++y)d[y]=n(s[y%s.length],r[y%r.length]);else for(let y=0;y<d.length;++y){const b=ya(y,a,c),v=b.slice(-h);g.forEach(C=>v[C]=0);const w=jr(v,h,f),S=b.slice(-p);x.forEach(C=>S[C]=0);const N=jr(S,p,m);d[y]=n(s[w],r[N])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),c=t.data.get(a.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},a}const bM={kernelName:bf,backendName:"cpu",kernelFunc:$s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ku(n,e,t="float32"){if(t==="complex64"){const r=ku(n,e,"float32"),o=ku(n,e,"float32");return $s({inputs:{real:r,imag:o},backend:n})}const s=Zn(we(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ur(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const wM={kernelName:Mc,backendName:"cpu",kernelFunc:Ur};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gi(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const vM={kernelName:Vf,backendName:"cpu",kernelFunc:gi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OS(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=vi([0],t),[o,i]=En((a,c)=>a!==c?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Ao(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Ur({inputs:{x:r},backend:t});const d=ku(t,r.shape,r.dtype),h=Ao({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=$s({inputs:{real:h,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),p}if(r.dtype==="complex64"){const d=gi({inputs:{input:r},backend:t}),h=Ao({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),h}if(!tb(r.dtype,o)){const d=Ur({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[a,c,l]=OS(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}const SM={kernelName:Cc,backendName:"cpu",kernelFunc:Ao};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;st([i,a],n);const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=i.dtype==="string"?no(l):l,p=i.dtype==="string"?no(d):d,f=s||i.dtype,[m,g]=e(i.shape,a.shape,h,p,f);return c.makeTensorInfo(g,f,m)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const l=Ao({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(l.dataId),h=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,f=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,g=Ao({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),x=c.data.get(g.dataId),y=x.complexTensorInfos.real,b=x.complexTensorInfos.imag,v=c.data.get(y.dataId).values,w=c.data.get(b.dataId).values,[S,N,C]=t(i.shape,a.shape,f,m,v,w),k=c.makeTensorInfo(C,"float32",S),I=c.makeTensorInfo(C,"float32",N),T=$s({inputs:{real:k,imag:I},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(k),c.disposeIntermediateTensorInfo(I),T}else{const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=s||i.dtype,[p,f]=e(i.shape,a.shape,l,d,h);return c.makeTensorInfo(f,h,p)}}}function jg(n){return(e,t,s,r,o,i)=>{const a=At(e,t),c=we(a),l=a.length,d=pt(a),h=Jn("float32",c),p=Jn("float32",c),f=aa(e,a),m=aa(t,a),g=to(s,r),x=to(o,i),y=e.length,b=pt(e),v=t.length,w=pt(t);if(f.length+m.length===0)for(let S=0;S<h.length;S++){const N=S%g.length,C=S%x.length,k=n(g[N*2],g[N*2+1],x[C*2],x[C*2+1]);h[S]=k.real,p[S]=k.imag}else for(let S=0;S<h.length;S++){const N=ya(S,l,d),C=N.slice(-y);f.forEach(D=>C[D]=0);const k=jr(C,y,b),I=N.slice(-v);m.forEach(D=>I[D]=0);const T=jr(I,v,w),_=n(g[k*2],g[k*2+1],x[T*2],x[T*2+1]);h[S]=_.real,p[S]=_.imag}return[h,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LS=En((n,e)=>n+e),CM=jg((n,e,t,s)=>({real:n+t,imag:e+s})),da=Wn(ba,LS,CM),NM={kernelName:ba,backendName:"cpu",kernelFunc:da};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _g(n,e,t,s,r){const o=we(s),i=Zn(r,t);for(let a=0;a<n.length;a++){const c=n[a];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(o>0?i[c]+=e[a]:i[c]+=1)}return i}function zS(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=Ot([r,t],e.dtype);for(let a=0;a<r;a++)for(let c=0;c<o;c++){const l=n.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(s?i.set(1,a,l):e.size>0?i.set(i.get(a,l)+e.get(a,c),a,l):i.set(i.get(a,l)+1,a,l))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WS=En((n,e)=>n&e),IM=Wn(yf,WS),kM={kernelName:yf,backendName:"cpu",kernelFunc:IM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gr(n){return(e,t,s)=>{const r=In(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sn(n,e,t){const s=Gr(e);return Lo(n,s,t)}function Lo(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;st(i,n);const a=o,c=a.data.get(i.dataId).values;let l;if(i.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=no(c)}else l=c;const d=t||i.dtype,h=e(l,d,r);return a.makeTensorInfo(i.shape,d,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BS=Gr(n=>Math.ceil(n)),$M=Lo(Nc,BS),TM={kernelName:Nc,backendName:"cpu",kernelFunc:$M};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VS(n,e,t,s){const r=In(t,we(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const a=we(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?no(i.vals):i.vals;let c=0;for(let l=0;l<i.shape[0];++l){const d=l*e[1]+o;for(let h=0;h<i.shape[1];++h)r[d+h]=a[c++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const US=En((n,e)=>n===e?1:0),GS=Wn(ld,US,null,"bool"),AM={kernelName:ld,backendName:"cpu",kernelFunc:GS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HS=Gr(n=>Math.exp(n)),qS=Lo(Rc,HS,"float32"),EM={kernelName:Rc,backendName:"cpu",kernelFunc:qS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS=Gr(n=>Math.expm1(n)),RM=Lo(Dc,KS),DM={kernelName:Dc,backendName:"cpu",kernelFunc:RM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS=Gr(n=>Math.floor(n)),jM=Lo(jc,QS),_M={kernelName:jc,backendName:"cpu",kernelFunc:jM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XS=En((n,e)=>Math.floor(n/e)),PM=Wn(_c,XS,null,"int32"),MM={kernelName:_c,backendName:"cpu",kernelFunc:PM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YS(n,e,t,s,r,o,i,a,c){const l=Ot([s,o],t);for(let d=0;d<s;d++){const h=[];let p=0;for(let f=0;f<r;f++){const m=n[d*r+f];p+=m*i[f],h.push(m)}if(p<0||p>=c/o)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let f=0;f<o;f++)l.values[d*o+f]=e.get(...e.indexToLoc(p*o+f))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JS(n,e,t){const s=Ot(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],c=i[2],l=e.locToIndex([a,c]);i[2]=e.values[l];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZS=En((n,e)=>n>e?1:0),FM=Wn(pd,ZS,null,"bool"),OM={kernelName:pd,backendName:"cpu",kernelFunc:FM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC=En((n,e)=>n>=e?1:0),LM=Wn(Pc,eC,null,"bool"),zM={kernelName:Pc,backendName:"cpu",kernelFunc:LM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tC=En((n,e)=>n<e?1:0),WM=Wn(md,tC,null,"bool"),BM={kernelName:md,backendName:"cpu",kernelFunc:WM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nC=En((n,e)=>n<=e?1:0),VM=Wn(gd,nC,null,"bool"),UM={kernelName:gd,backendName:"cpu",kernelFunc:VM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sC(n,e,t){const s=(e-n)/(t-1),r=Zn(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC=Gr(n=>Math.log(n)),GM=Lo(zc,rC),HM={kernelName:zc,backendName:"cpu",kernelFunc:GM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oC(n,e,t,s){const r=Jn(s,we(t));for(let o=0;o<r.length;++o){const i=o*e;let a=n[i];for(let c=0;c<e;++c){const l=n[i+c];(Number.isNaN(l)||l>a)&&(a=l)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iC=En((n,e)=>Math.max(n,e)),qM=Wn(Bc,iC),KM={kernelName:Bc,backendName:"cpu",kernelFunc:qM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aC=En((n,e)=>Math.min(n,e)),QM=Wn(Vc,aC),XM={kernelName:Vc,backendName:"cpu",kernelFunc:QM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pg=En((n,e)=>n*e),YM=jg((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),bh=Wn(Gc,Pg,YM),JM={kernelName:Gc,backendName:"cpu",kernelFunc:bh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cC(n,e,t){const s=Ro(-1,t);return Pg([],e,s,n,t)}function ZM(n){const{inputs:e,backend:t}=n,{x:s}=e;st(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=cC(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const eF={kernelName:$d,backendName:"cpu",kernelFunc:ZM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lC=En((n,e)=>n!==e?1:0),tF=Wn(Td,lC,null,"bool"),nF={kernelName:Td,backendName:"cpu",kernelFunc:tF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mg(n,e,t,s,r){const o=e.length,i=we(e),a=pt(e),c=pt(r),l=Jn(t,we(r));for(let d=0;d<i;++d){const h=ya(d,o,a),p=new Array(h.length);for(let m=0;m<p.length;m++)p[m]=h[s[m]];const f=jr(p,o,c);l[f]=n[d]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bs(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;st(r,"transpose");const i=r.shape.length,a=new Array(i);for(let h=0;h<a.length;h++)a[h]=r.shape[o[h]];const c=s.data.get(r.dataId).values,l=Mg(c,r.shape,r.dtype,o,a);return{dataId:s.write(l,a,r.dtype),shape:a,dtype:r.dtype}}const sF={kernelName:Ki,backendName:"cpu",kernelFunc:bs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uC(n,e,t,s){const[r,o]=Hn(n,s),i=Rs(e,"int32"),a=Zn(we(r),i),c=we(o);for(let l=0;l<a.length;++l){const d=l*c;let h=1;for(let p=0;p<c;++p)h*=t[d+p];a[l]=h}return{outVals:a,outShape:r,outDtype:i}}function rF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;st(r,"prod");const a=r.shape.length,c=Lt(o,r.shape),l=Sn(c,a);let d=c,h=r;const p=[];l!=null&&(h=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),p.push(h),d=Tn(d.length,a));const f=t.data.get(h.dataId).values,{outVals:m,outShape:g,outDtype:x}=uC(h.shape,h.dtype,f,d);let y=g;return i&&(y=Dn(g,c)),p.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(y,x,m)}const oF={kernelName:_d,backendName:"cpu",kernelFunc:rF};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iF(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=ya(r,e.length,pt(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function aF(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function cF(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);aF(t,s);let c=1;for(let l=0;l<e.length-1;++l){c*=e[l];const d=e[l+1];for(let h=1;h<c+1;++h)a[l].push(h*d)}for(let l=0;l<n.length;++l){let d=n[l],h=n[l]+1;for(let p=0;p<t.length;++p){const f=t[p],m=p+e.length-1;if(m>=0){const g=a[m],x=g[g.length-1]-f[d];for(let y=d;y<h;++y)a[m].push(f[y+1]+x)}d=f[d],h=f[h]}h!==d&&(r.push([d,h]),o+=h-d)}return{outSplits:a,valueSlices:r,numValues:o}}function lF(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=In("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function Fx(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function uF(n,e,t,s,r,o){const i=Fx(e,2)[1],a=Fx(o,2)[1];let c=0;for(const l of t)for(let d=l[0];d<l[1];++d){for(let h=0;h<s;++h)r[c*a+h]=n[d*i+h];++c}}function dF(n,e,t,s,r){const o=e.slice();o[0]=r;const i=In(t,we(o)),a=n.length,c=a===0?0:a/e[0];return uF(n,e,s,c,i,o),[i,o]}function dC(n,e,t,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(iF(o,i,c),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:d,valueSlices:h,numValues:p}=cF(o,i,n,l),f=lF(d),m=dF(t,s,r,h,p);return[f,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ox=2147483647;function hC(n,e,t,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,c=r.length===0,l=i.length===0,d=[];a||d.push(e[0]),c||d.push(r[0]),l||d.push(i[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const h=d.length===0?1:d[0],p=In("int32",h+1);p[0]=0;for(let x=0;x<h;++x){const y=a?n[0]:n[x],b=c?s[0]:s[x],v=l?o[0]:o[x];if(v===0)throw new Error("Requires delta != 0");let w;if(v>0&&b<y||v<0&&b>y)w=0;else if(w=Math.ceil(Math.abs((b-y)/v)),w>Ox)throw new Error(`Requires ((limit - start) / delta) <= ${Ox}`);p[x+1]=p[x]+w}const f=p[h],m=In(t,f);let g=0;for(let x=0;x<h;++x){const y=p[x+1]-p[x];let b=a?n[0]:n[x];const v=l?o[0]:o[x];for(let w=0;w<y;++w)m[g++]=b,b+=v}return[p,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Us=hr;class $u{constructor(e,t,s,r,o,i,a,c,l,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=Jw(d),this.raggedRank=Zw(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Us.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Us.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Us.VALUE_ROWIDS:return $u.getMaxWidthValueRowID(t);case Us.ROW_SPLITS:return $u.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Us[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return zx(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;ev(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=Yw(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=t)o.push(i);for(let a=r;a<e;++a)o.push(-1);return E(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const c=e[a+1]-e[a];let l=Math.min(r,c),d=t[a];d===-1&&(l=0);for(let h=0;h<l;++h)i.push(d),d+=s;for(let h=0;h<c-l;++h)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let l=t[c];i.push(l);for(let d=1;d<o;++d){const h=e[d];if(h===c)l>=0&&(++a,a<r?l+=s:l=-1);else{if(a=0,c=h,h>=t.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${t.length}`);l=t[h]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Us.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case Us.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${Us[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Us.FIRST_DIM_SIZE:return e[0];case Us.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Us.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Us[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*s[c+1];const o=zx(s,!1),i=In(this.valuesDType,we(o));if(r[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,r[l],s[l]);this.setOutput(this.raggedRank,c,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const c=we(a),l=t.length;let d=this.defaultValue;if(d.length!==c&&d.length!==1){const m=this.defaultValueShape;ae(()=>{const g=ne(d,m);d=Xa(g,a).dataSync()})}let h=0,p=0,f=0;for(let m=0;m<=l;++m){let g=m<l?t[m]:-1;if(g===f){++f;continue}if(p<f){const x=o.subarray(h*c),y=i.subarray(p*c),b=(f-p)*c;Lx(y,x,b)}if(m>=l){const x=s.length;g=Math.floor(x/c)}if(g>f)if(this.defaultValue.length===1)i.subarray(f*c,g*c).fill(this.defaultValue[0]),f=g;else for(;g>f;){const x=i.slice(f*c);Lx(x,d,c),++f}g<0?(h=m+1,p=f):(h=m,p=f,f=p+1)}}}function Lx(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function zx(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function pC(n,e,t,s,r,o,i,a,c,l){return new $u(n,e,t,s,r,o,i,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fC(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return Zn(0,s);const a=Math.abs(Math.ceil((e-n)/t)),c=Zn(a,s);e<n&&t===1&&(t=-1),c[0]=n;for(let l=1;l<c.length;l++)c[l]=c[l-1]+t;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mC=Gr(n=>1/Math.sqrt(n)),hF=Lo(Yc,mC),pF={kernelName:Yc,backendName:"cpu",kernelFunc:hF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jo(n,e,t,s,r,o,i,a,c,l){const d=[s/r,r],h=n.values,p=e.values;if(s===0)return Ot(t,e.dtype);const f=c instanceof Kn?c:Ot(d,e.dtype);typeof c=="string"||typeof c=="number"?f.values.fill(c):typeof c=="boolean"&&f.values.fill(+c);for(let m=0;m<o;m++){const g=[];let x=0;for(let y=0;y<i;y++){const b=h[m*i+y];g.push(b),x+=b*a[y]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${t}`);for(let y=0;y<r;y++)l?f.values[x*r+y]+=p[m*r+y]:f.values[x*r+y]=e.rank===0?p[0]:p[m*r+y]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF=Gr(n=>1/(1+Math.exp(-n))),gC=sn(nl,n=>1/(1+Math.exp(-n))),mF={kernelName:nl,backendName:"cpu",kernelFunc:gC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xC(n,e,t,s,r){const o=Vm(s,e,t),i=we(t),a=pt(s);if(o){const h=Um(e,a);return r==="string"?n.slice(h,h+i):n.subarray(h,h+i)}const c=r==="string"?no(n):n,l=Ot(s,r,c),d=Ot(t,r);for(let h=0;h<d.size;++h){const p=d.indexToLoc(h),f=p.map((m,g)=>m+e[g]);d.set(l.get(...f),...p)}return r==="string"?wv(d.values):d.values}function xi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;st(r,"slice");const[a,c]=sh(r,o,i);Wm(r,a,c);const l=t.data.get(r.dataId).values,d=xC(l,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,d)}const gF={kernelName:zd,backendName:"cpu",kernelFunc:xi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yC(n,e,t,s,r,o,i){const a=e[0],c=o[0],l=new Array(c),d=new Array(a),h=e[1];if(c===0){if(a!==0)throw new Error(av(a));const x=In(t,0),y=In(r,0);return[x,[0,h],y,l,d]}let p=!0,f=0;const m=new Array(c).fill(0);for(let x=0;x<a;++x){const y=n[x*h];if(y<0)throw new Error(cv(x,y));if(y>=c)throw new Error(lv(x,y,c));++m[y],p=p&&y>=f,f=y}let g=!0;for(let x=0;x<c;++x){const y=m[x]===0;l[x]=y,g=g&&!y,m[x]=Math.max(m[x],1),x>0&&(m[x]+=m[x-1])}if(g&&p){const x=n,y=s;for(let b=0;b<a;++b)d[b]=b;return[x,[a,h],y,l,d]}else{const x=m[c-1],y=In(t,x*h),b=In(r,x),v=new Array(c).fill(0);for(let w=0;w<a;++w){const S=n[w*h],N=v[S],C=(S===0?0:m[S-1])+N;v[S]++;for(let k=0;k<h;++k)y[C*h+k]=n[w*h+k];b[C]=s[w],d[w]=C}for(let w=0;w<c;++w)if(v[w]===0){const N=w===0?0:m[w-1];y[N*h+0]=w;for(let C=1;C<h;++C)y[N*h+C]=0;b[N]=i}return[y,[x,h],b,l,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bC(n,e,t,s,r){const o=we(s),i=e[0],a=r.length,c=[];let l=1,d=-1;for(let x=0;x<a;++x){const y=r[x];if(y===-1){if(d!==-1)throw new Error(uv(d,x));d=x,c.push(1)}else{if(y<0)throw new Error(dv(x,y));l*=y,c.push(y)}}if(d!==-1){if(l<=0)throw new Error(hv());const x=Math.trunc(o/l);if(l*x!==o)throw new Error(pv(s,c));c[d]=x}if(we(c)!==o)throw new Error(fv(s,c));const p=s.length,f=[];if(p>0){f[p-1]=1;for(let x=p-2;x>=0;--x)f[x]=f[x+1]*s[x+1]}const m=[];if(a>0){m[a-1]=1;for(let x=a-2;x>=0;--x)m[x]=m[x+1]*c[x+1]}const g=In(t,i*a);for(let x=0;x<i;++x){let y=0;for(let b=0;b<p;++b)y+=n[x*p+b]*f[b];for(let b=0;b<a;++b)g[x*a+b]=Math.trunc(y/m[b]),y%=m[b]}return[g,[i,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fg(n,e,t,s,r,o=!1,i=0){const a=s.length,c=[e[0],n.length/e[0]],l=c[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(Pp());const p=e.slice();p[0]=h;const f=p.reduce((v,w)=>v*w,1),m=In(t,f);if(a===0)return h>0&&m.fill(i),[m,p];if(h<=0)throw new Error(Pp());let g=0,x=1,y=0,b=r[g];for(;;){let v=0;if(x<a){if(v=r[x],b===v){++x;continue}if(b>=v)throw new Error(mv())}if(b<0||b>=h)throw new Error(gv(b,h));b>y&&m.fill(i,y*l,b*l);for(let w=g;w<x;++w){const S=s[w];if(S<0||S>=c[0])throw new Error(xv(w,s[w],c[0]));for(let N=0;N<l;N++)m[b*l+N]+=n[S*l+N]}if(o)for(let w=0;w<l;w++)m[b*l+w]/=x-g;if(g=x,++x,y=b+1,b=v,x>a)break}return y<h&&m.fill(i,y*l,h*l),[m,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xF=Gr(n=>Math.sqrt(n)),yF=sn(rl,n=>Math.sqrt(n)),bF={kernelName:rl,backendName:"cpu",kernelFunc:yF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wC=En((n,e)=>{const t=n-e;return t*t}),wF=Wn(ol,wC),vF={kernelName:ol,backendName:"cpu",kernelFunc:wF};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vC=Gr((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),SF=Lo(qf,vC),CF={kernelName:qf,backendName:"cpu",kernelFunc:SF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SC(n,e,t,s){const r=Ot(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let c=0;c<a.length;c++)a[c]=i[c]*t[c]+s[c];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NF{constructor(e,t,s,r,o,i){this.separator=bo(e),this.nGramWidths=t,this.leftPad=bo(s),this.rightPad=bo(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let a=0;a<o;++a){const c=this.getPadWidth(i),l=Math.max(0,c-a),d=Math.max(0,c-(o-(a+1))),h=i-(l+d),p=t+(l>0?0:a-c);let f=0;f+=l*this.leftPad.length;for(let b=0;b<h;++b)f+=e[p+b].length;f+=d*this.rightPad.length;const m=l+d+h-1;f+=m*this.separator.length,s[r+a]=new Uint8Array(f);const g=s[r+a];let x=0;const y=b=>b.forEach(v=>g[x++]=v);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<h-1;++b)y(e[p+b]),y(this.separator);if(h>0){y(e[p+h-1]);for(let b=0;b<d;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<d-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<r;++l){let d=t[l]>=c;if(d=d&&t[l]<=s,!d)throw new Error(`Invalid split value ${t[l]}, must be in [${c}, ${s}]`);c=t[l]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const o=r-1,i=In("int32",r);if(s===0||r===0){const c=new Array(s);for(let l=0;l<=o;++l)i[l]=0;return[c,i]}i[0]=0;for(let c=1;c<=o;++c){const l=t[c]-t[c-1];let d=0;this.nGramWidths.forEach(h=>{d+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&d===0&&(d=1),i[c]=i[c-1]+d}const a=new Array(i[o]);for(let c=0;c<o;++c){const l=t[c];let d=i[c];if(this.nGramWidths.forEach(h=>{const p=t[c+1]-t[c],f=this.getNumNGrams(p,h);this.createNGrams(e,l,a,d,f,h),d+=f}),this.preserveShort&&d===i[c]){const h=t[c+1]-t[c];if(h===0)continue;const p=h+2*this.padWidth;this.createNGrams(e,l,a,d,1,p)}}return[a,i]}}function CC(n,e,t,s,r,o,i,a){return new NF(t,s,r,o,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IF(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function NC(n,e,t){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let p=0;p<s;++p){const f=r.length;IF(n[p],e,t,r);const m=r.length-f;a[p]=m,o+=m,i=Math.max(i,m)}const c=In("int32",o*2),l=new Array(o),d=[s,i];let h=0;for(let p=0;p<s;++p)for(let f=0;f<a[p];++f)c[h*2]=p,c[h*2+1]=f,l[h]=r[h],++h;return[c,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IC(n,e){const t=In("int32",n.length);for(let s=0;s<n.length;++s)t[s]=Lk(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kC=En((n,e)=>n-e),kF=jg((n,e,t,s)=>({real:n-t,imag:e-s})),Og=Wn(il,kC,kF),$F={kernelName:il,backendName:"cpu",kernelFunc:Og};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $C(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=Ot(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let c=0;c<i.length;c++)i[c]=o[c]%n.shape[c];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function TC(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,c=e-t+1,l=Math.log(a),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(a-d)/a)*Math.sign(c-a/2),p=Math.max(t,Math.floor(e-c*d/a+h)),f=Math.min(s,Math.floor(e+(a-c)*d/a+h));TC(n,e,p,f)}const r=n[e];let o=t,i=s;for(Wi(n,t,e),Va(n[s],r)>0&&Wi(n,t,s);o<i;){for(Wi(n,o,i),o++,i--;Va(n[o],r)<0;)o=o+1;for(;Va(n[i],r)>0;)i=i-1}Va(n[t],r)===0?Wi(n,t,i):(i=i+1,Wi(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function AC(n,e,t,s,r){const o=e[e.length-1],[i,a]=[n.length/o,o],c=Jn(t,i*s),l=Jn("int32",i*s);for(let h=0;h<i;h++){const p=h*a,f=n.subarray(p,p+a);let m=new Array(f.length);f.forEach((b,v)=>m[v]={value:b,index:v}),s<m.length&&(TC(m,s),m=m.slice(0,s)),r&&m.sort(Va);const g=h*s,x=c.subarray(g,g+s),y=l.subarray(g,g+s);for(let b=0;b<s;b++)x[b]=m[b].value,y[b]=m[b].index}const d=e.slice();return d[d.length-1]=s,[Ot(d,t,c),Ot(d,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EC(n,e,t,s){const r=Lt(e,t)[0],o=[1,t[0],1];for(let m=0;m<r;m++)o[0]*=t[m];o[1]=t[r];for(let m=r+1;m<t.length;m++)o[2]*=t[m];const i=new Map,a=new Int32Array(t[r]),c=new Kn(o,s,n),l=[],d=o[0]===1&&o[2]===1;for(let m=0;m<t[r];m++){let g;if(d)g=n[m].toString();else{const y=[];for(let b=0;b<o[0];b++)for(let v=0;v<o[2];v++)y.push(c.get(b,m,v));g=y.join(",")}const x=i.get(g);if(x!=null)a[m]=x;else{const y=i.size;i.set(g,y),a[m]=y,l.push(m)}}const h=o.slice();h[1]=i.size;const p=new Kn(h,s);l.forEach((m,g)=>{for(let x=0;x<o[0];x++)for(let y=0;y<o[2];y++)p.set(c.get(x,m,y),x,g,y)});const f=t.slice();return f[r]=h[1],{outputValues:p.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TF=Object.freeze(Object.defineProperty({__proto__:null,addImpl:LS,bincountImpl:_g,bincountReduceImpl:zS,bitwiseAndImpl:WS,castImpl:OS,ceilImpl:BS,concatImpl:VS,equalImpl:US,expImpl:HS,expm1Impl:KS,floorDivImpl:XS,floorImpl:QS,gatherNdImpl:YS,gatherV2Impl:JS,greaterEqualImpl:eC,greaterImpl:ZS,lessEqualImpl:nC,lessImpl:tC,linSpaceImpl:sC,logImpl:rC,maxImpl:oC,maximumImpl:iC,minimumImpl:aC,multiplyImpl:Pg,negImpl:cC,notEqualImpl:lC,prodImpl:uC,raggedGatherImpl:dC,raggedRangeImpl:hC,raggedTensorToTensorImpl:pC,rangeImpl:fC,rsqrtImpl:mC,scatterImpl:Jo,sigmoidImpl:fF,simpleAbsImpl:FS,sliceImpl:xC,sparseFillEmptyRowsImpl:yC,sparseReshapeImpl:bC,sparseSegmentReductionImpl:Fg,sqrtImpl:xF,squaredDifferenceImpl:wC,staticRegexReplaceImpl:vC,stridedSliceImpl:SC,stringNGramsImpl:CC,stringSplitImpl:NC,stringToHashBucketFastImpl:IC,subImpl:kC,tileImpl:$C,topKImpl:AC,transposeImpl:Mg,uniqueImpl:EC},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Kb("cpu",()=>new yh,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RC=sn(Ac,n=>n>=0?n:Math.exp(n)-1),AF={kernelName:Ac,backendName:"cpu",kernelFunc:RC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;st([r],"leakyRelu");const i=we(r.shape),a=t.data.get(r.dataId).values,c=Jn("float32",i);for(let l=0;l<a.length;l++)c[l]=a[l]<0?o*a[l]:a[l];return t.makeTensorInfo(r.shape,"float32",c)}const EF={kernelName:fd,backendName:"cpu",kernelFunc:DC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RF=En((n,e)=>n<0?e*n:n);function jC(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;st([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[a,c]=RF(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(c,"float32",a)}const DF={kernelName:jd,backendName:"cpu",kernelFunc:jC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _C=sn(Kc,n=>Math.max(0,n)),jF={kernelName:Kc,backendName:"cpu",kernelFunc:_C};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PC=sn(Qc,n=>Math.min(Math.max(0,n),6)),_F={kernelName:Qc,backendName:"cpu",kernelFunc:PC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tu(n,e,t,s,r){if(t==="linear")return Ur({inputs:{x:e},backend:n});if(t==="relu")return _C({inputs:{x:e},backend:n});if(t==="elu")return RC({inputs:{x:e},backend:n});if(t==="relu6")return PC({inputs:{x:e},backend:n});if(t==="prelu")return jC({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return DC({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return gC({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=we(r.shape),a=eb(o,i),c=we(a);E(i===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const l=t.data.get(r.dataId);if(l.complexTensorInfos!=null){const d=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;d.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const PF={kernelName:Pd,backendName:"cpu",kernelFunc:hn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MC(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;st([r,o],"matMul");const c=r.shape.length,l=o.shape.length,d=i?r.shape[c-2]:r.shape[c-1],h=a?o.shape[l-1]:o.shape[l-2],p=i?r.shape[c-1]:r.shape[c-2],f=a?o.shape[l-2]:o.shape[l-1],m=r.shape.slice(0,-2),g=o.shape.slice(0,-2),x=we(m),y=we(g),v=At(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([p,f]);E(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const w=i?[x,d,p]:[x,p,d],S=a?[y,f,h]:[y,h,f],N=hn({inputs:{x:r},backend:t,attrs:{shape:w}}),C=hn({inputs:{x:o},backend:t,attrs:{shape:S}}),k=i?N.shape[1]:N.shape[2],I=i?N.shape[2]:N.shape[1],T=a?C.shape[1]:C.shape[2],_=Math.max(x,y),D=t.data.get(N.dataId).values,P=t.data.get(C.dataId).values,A=pt(N.shape),F=pt(C.shape),[O,V,L]=i?[A[0],1,A[1]]:[A[0],A[1],1],[H,J,X]=a?[1,F[1],F[0]]:[F[1],1,F[0]],fe=I*T,be=Ot([_,I,T],N.dtype),oe=be.values,xe=t.blockSize;for(let $e=0;$e<_;$e++){const Le=$e%x,Re=$e%y;for(let ze=0;ze<I;ze+=xe){const Ye=Math.min(ze+xe,I);for(let Te=0;Te<T;Te+=xe){const ut=Math.min(Te+xe,T);for(let ft=0;ft<k;ft+=xe){const wt=Math.min(ft+xe,k);for(let vt=ze;vt<Ye;vt++)for(let Nt=Te;Nt<ut;Nt++){let mt=0;for(let dt=ft;dt<wt;dt++){const re=D[Le*O+vt*V+dt*L],de=P[dt*H+Nt*J+Re*X];mt+=re*de}oe[$e*fe+(vt*T+Nt)]+=mt}}}}}return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(C),t.makeTensorInfo(v,be.dtype,be.values)}const MF={kernelName:Zu,backendName:"cpu",kernelFunc:MC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FF(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;let p,f,m;const g=[];p=MC({inputs:{a:r,b:o},attrs:{transposeA:c,transposeB:l},backend:t}),i&&(f=da({inputs:{a:p,b:i},backend:t}),g.push(p),p=f),d&&(m=Tu(t,p,d,a,h),g.push(p),p=m);for(const y of g)t.disposeIntermediateTensorInfo(y);return p}const OF={kernelName:ou,backendName:"cpu",kernelFunc:FF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LF=sn(gc,n=>Math.acos(n)),zF={kernelName:gc,backendName:"cpu",kernelFunc:LF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WF=sn(xc,n=>Math.acosh(n)),BF={kernelName:xc,backendName:"cpu",kernelFunc:WF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VF(n){const{inputs:e,backend:t}=n,s=e;st(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),o=Ot(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const c=r[a];for(let l=0;l<i.length;l++)i[l]+=c[l]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const UF={kernelName:hf,backendName:"cpu",kernelFunc:VF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;st(r,"all");const a=Lt(o,r.shape);let c=a;const l=Sn(c,r.shape.length);let d=r;l!=null&&(d=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Xn("all",c,d.shape.length);const[h,p]=Hn(d.shape,c),f=we(p),m=Zn(we(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*f;let v=g[b];for(let w=0;w<f;++w){const S=g[b+w];v=v&&S}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=Dn(h,a),b=hn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const HF={kernelName:pf,backendName:"cpu",kernelFunc:GF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;st(r,"any");const a=Lt(o,r.shape);let c=a;const l=Sn(c,r.shape.length);let d=r;l!=null&&(d=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Xn("any",c,d.shape.length);const[h,p]=Hn(d.shape,c),f=we(p),m=Zn(we(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*f;let v=g[b];for(let w=0;w<f;++w){const S=g[b+w];v=v||S}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=Dn(h,a),b=hn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const KF={kernelName:ff,backendName:"cpu",kernelFunc:qF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;st(r,"argMax");let i=Lt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=bs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),i=[i[0]],Xn("argMax",i,c.shape.length);const[d,h]=Hn(c.shape,i),p=we(d),f=Zn(p,"int32"),m=we(h),g=t.data.get(c.dataId).values;for(let x=0;x<f.length;++x){const y=x*m;let b=g[y],v=0;for(let w=0;w<m;++w){const S=g[y+w];S>b&&(b=S,v=w)}f[x]=v}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",f)}const XF={kernelName:Qu,backendName:"cpu",kernelFunc:QF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;st(r,"argMin");let i=Lt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=bs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),i=[i[0]],Xn("argMin",i,c.shape.length);const[d,h]=Hn(c.shape,i),p=we(d),f=Zn(p,"int32"),m=we(h),g=t.data.get(c.dataId).values;for(let x=0;x<f.length;++x){const y=x*m;let b=g[y],v=0;for(let w=0;w<m;++w){const S=g[y+w];S<b&&(b=S,v=w)}f[x]=v}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",f)}const JF={kernelName:Xu,backendName:"cpu",kernelFunc:YF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZF=sn(yc,n=>Math.asin(n)),eO={kernelName:yc,backendName:"cpu",kernelFunc:ZF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tO=sn(bc,n=>Math.asinh(n)),nO={kernelName:bc,backendName:"cpu",kernelFunc:tO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sO=sn(wc,n=>Math.atan(n)),rO={kernelName:wc,backendName:"cpu",kernelFunc:sO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oO=En((n,e)=>Math.atan2(n,e)),iO=Wn(Sc,oO),aO={kernelName:Sc,backendName:"cpu",kernelFunc:iO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cO=sn(vc,n=>Math.atanh(n)),lO={kernelName:vc,backendName:"cpu",kernelFunc:cO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lg(n,e,t,s,r,o){const i=r.strideHeight,a=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Ot(r.outShape,t),x=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let w=0;w<r.batchSize;++w){const S=w*y,N=w*s[0];for(let C=0;C<r.inChannels;++C)for(let k=0;k<r.outHeight;++k){const I=k*i-p,T=Math.max(0,I),_=Math.min(r.inHeight,d+I),D=S+k*b;for(let P=0;P<r.outWidth;++P){const A=P*a-f,F=Math.max(0,A),O=Math.min(r.inWidth,h+A);let V=m,L=0,H=0;for(let X=T;X<_;X+=c){const fe=N+X*s[1];for(let be=F;be<O;be+=l){const oe=fe+be*s[2],xe=n[oe+C];o==="max"&&xe>V?V=xe:o==="avg"&&(L+=xe,H++)}if(isNaN(V))break}const J=D+P*v+C;x[J]=o==="avg"?L/H:V}}}return g}function FC(n,e,t,s,r=!1,o=!1){const i=Ot(s.outShape,"int32"),a=s.strideHeight,c=s.strideWidth,l=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,p=s.effectiveFilterWidth,f=s.padInfo.top,m=s.padInfo.left,g=Ot(e,t,n);for(let x=0;x<s.batchSize;++x)for(let y=0;y<s.inChannels;++y)for(let b=0;b<s.outHeight;++b){const v=b*a-f;let w=v;for(;w<0;)w+=l;const S=Math.min(s.inHeight,h+v);for(let N=0;N<s.outWidth;++N){const C=N*c-m;let k=C;for(;k<0;)k+=d;const I=Math.min(s.inWidth,p+C);let T=Number.NEGATIVE_INFINITY,_=-1;for(let D=w;D<S;D+=l){const P=D-v;for(let A=k;A<I;A+=d){const F=A-C,O=g.get(x,D,A,y);O>T&&(T=O,r?_=o?((x*s.inHeight+D)*s.inWidth+A)*s.inChannels+y:(D*s.inWidth+A)*s.inChannels+y:_=P*p+F)}}i.set(_,x,b,N,y)}}return i}function OC(n,e,t,s,r,o){const i=r.strideDepth,a=r.strideHeight,c=r.strideWidth,l=r.dilationDepth,d=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,f=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Ot(r.outShape,t),w=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],k=r.outShape[4];for(let I=0;I<r.batchSize;++I){const T=I*S,_=I*s[0];for(let D=0;D<r.inChannels;++D)for(let P=0;P<r.outDepth;++P){const A=P*i-g;let F=A;for(;F<0;)F+=l;const O=Math.min(r.inDepth,p+A),V=T+P*N;for(let L=0;L<r.outHeight;++L){const H=L*a-x;let J=H;for(;J<0;)J+=d;const X=Math.min(r.inHeight,f+H),fe=V+L*C;for(let be=0;be<r.outWidth;++be){const oe=be*c-y;let xe=oe;for(;xe<0;)xe+=h;const $e=Math.min(r.inWidth,m+oe),Le=fe+be*k;let Re=b,ze=0,Ye=0;for(let ut=F;ut<O;ut+=l){const ft=_+ut*s[1];for(let wt=J;wt<X;wt+=d){const vt=ft+wt*s[2];for(let Nt=xe;Nt<$e;Nt+=h){const mt=vt+Nt*s[3],dt=n[mt+D];if(o==="max"&&dt>Re?Re=dt:o==="avg"&&(ze+=dt,Ye++),isNaN(Re))break}if(isNaN(Re))break}if(isNaN(Re))break}const Te=Le+D;w[Te]=o==="avg"?ze/Math.max(Ye,1):Re}}}}return v}function uO(n,e){const t=Ot(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.front,f=e.padInfo.top,m=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let x=0;x<e.inChannels;++x)for(let y=0;y<e.outDepth;++y){const b=y*s-p;let v=b;for(;v<0;)v+=i;const w=Math.min(e.inDepth,l+b);for(let S=0;S<e.outHeight;++S){const N=S*r-f;let C=N;for(;C<0;)C+=a;const k=Math.min(e.inHeight,d+N);for(let I=0;I<e.outWidth;++I){const T=I*o-m;let _=T;for(;_<0;)_+=c;const D=Math.min(e.inWidth,h+T);let P=Number.NEGATIVE_INFINITY,A=-1;for(let F=v;F<w;F+=i){const O=F-b;for(let V=C;V<k;V+=a){const L=V-N;for(let H=_;H<D;H+=c){const J=H-T,X=n.get(g,F,V,H,x);X>=P&&(P=X,A=O*d*h+L*d+J)}}}t.set(A,g,y,S,I,x)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;st(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&Jt(d.inShape,d.outShape))h=Ur({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,f=pt(r.shape),m=Lg(p,r.shape,r.dtype,f,d,"avg");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const hO={kernelName:Yu,backendName:"cpu",kernelFunc:dO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;st(r,"avgPool3d");const d=oo(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,p=OC(h,r.shape,r.dtype,pt(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const fO={kernelName:Ju,backendName:"cpu",kernelFunc:pO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;st([r,o],"avgPool3DGrad");const d=oo(o.shape,i,a,1,c,l),h=d.strideDepth,p=d.strideHeight,f=d.strideWidth,m=d.filterDepth,g=d.filterHeight,x=d.filterWidth,y=d.dilationDepth,b=d.dilationHeight,v=d.dilationWidth,w=d.effectiveFilterDepth,S=d.effectiveFilterHeight,N=d.effectiveFilterWidth,C=w-1-d.padInfo.front,k=N-1-d.padInfo.left,I=S-1-d.padInfo.top,T=Ot(o.shape,"float32"),_=1/(m*g*x),D=t.bufferSync(r);for(let P=0;P<d.batchSize;++P)for(let A=0;A<d.inChannels;++A)for(let F=0;F<d.inDepth;++F)for(let O=0;O<d.inHeight;++O)for(let V=0;V<d.inWidth;++V){const L=F-C,H=O-I,J=V-k;let X=0;for(let fe=0;fe<w;fe+=y){const be=(L+fe)/h;if(!(be<0||be>=d.outDepth||Math.floor(be)!==be))for(let oe=0;oe<S;oe+=b){const xe=(H+oe)/p;if(!(xe<0||xe>=d.outHeight||Math.floor(xe)!==xe))for(let $e=0;$e<N;$e+=v){const Le=(J+$e)/f;if(Le<0||Le>=d.outWidth||Math.floor(Le)!==Le)continue;const Re=D.get(P,be,xe,Le,A);X+=Re}}}T.set(X*_,P,F,O,V,A)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const gO={kernelName:gf,backendName:"cpu",kernelFunc:mO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;st([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=tr(i.shape,a,c,1,l),h=d.strideHeight,p=d.strideWidth,f=d.filterHeight,m=d.filterWidth,g=d.dilationHeight,x=d.dilationWidth,y=d.effectiveFilterHeight,b=d.effectiveFilterWidth,v=b-1-d.padInfo.left,w=y-1-d.padInfo.top,S=Ot(i.shape,"float32"),N=1/(f*m),C=t.data.get(r.dataId).values,k=Ot(r.shape,"float32",C);for(let I=0;I<d.batchSize;++I)for(let T=0;T<d.inChannels;++T)for(let _=0;_<d.inHeight;++_)for(let D=0;D<d.inWidth;++D){const P=_-w,A=D-v;let F=0;for(let O=0;O<y;O+=g){const V=(P+O)/h;if(!(V<0||V>=d.outHeight||Math.floor(V)!==V))for(let L=0;L<b;L+=x){const H=(A+L)/p;if(H<0||H>=d.outWidth||Math.floor(H)!==H)continue;const J=k.get(I,V,H,T);F+=J}}S.set(F*N,I,_,D,T)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const yO={kernelName:mf,backendName:"cpu",kernelFunc:xO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:c}=e;E(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),st([r,a,c,o,i],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const d=t.data.get(r.dataId).values,h=t.data.get(a.dataId).values,p=t.data.get(c.dataId).values,f=o?t.data.get(o.dataId).values:new Float32Array([1]),m=i?t.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(d.length),x=m.length,y=f.length,b=p.length,v=h.length;let w=0,S=0,N=0,C=0;for(let k=0;k<d.length;++k)g[k]=m[w++]+(d[k]-h[S++])*f[N++]/Math.sqrt(p[C++]+l),w>=x&&(w=0),S>=v&&(S=0),N>=y&&(N=0),C>=b&&(C=0);return t.makeTensorInfo(r.shape,r.dtype,g)}const wO={kernelName:dd,backendName:"cpu",kernelFunc:bO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;st([r],"batchToSpaceND");const a=o.reduce((y,b)=>y*b),c=gl(r.shape,o,a),l=xl(c.length,o.length),d=yl(r.shape,o,a),h=Qm(i,o.length),p=Xm(d,i,o.length),f=hn({inputs:{x:r},backend:t,attrs:{shape:c}}),m=bs({inputs:{x:f},backend:t,attrs:{perm:l}}),g=hn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=xi({inputs:{x:g},backend:t,attrs:{begin:h,size:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const SO={kernelName:ed,backendName:"cpu",kernelFunc:vO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=_g(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const NO={kernelName:xf,backendName:"cpu",kernelFunc:CO};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IO(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=At(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const kO={kernelName:ib,backendName:"cpu",kernelFunc:IO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $O=sn(Ic,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),TO={kernelName:Ic,backendName:"cpu",kernelFunc:$O};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AO=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(we(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values;for(let l=0;l<a.length;l++){const d=a[l],h=c[l];s[l]=Math.hypot(d,h)}return t.makeOutput(s,e.shape,"float32")},EO={kernelName:td,backendName:"cpu",kernelFunc:AO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ha(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const RO={kernelName:Pf,backendName:"cpu",kernelFunc:ha};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pa(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Lt(r,e[0].shape)[0],i=e.map(g=>g.shape);Hm(i,o);let a=Pr(e.map(g=>g.shape),o);if(we(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(g=>we(g.shape)>0);if(c.length===1)return Ur({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){const g=c.map(w=>gi({inputs:{input:w},backend:t})),x=c.map(w=>ha({inputs:{input:w},backend:t})),y=pa({inputs:g,backend:t,attrs:{axis:o}}),b=pa({inputs:x,backend:t,attrs:{axis:o}}),v=$s({inputs:{real:y,imag:b},backend:t});return g.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),v}const l=c.map(g=>{const y=[-1,we(g.shape.slice(o))];return hn({inputs:{x:g},backend:t,attrs:{shape:y}})}),d=l.map(g=>({vals:t.data.get(g.dataId).values,shape:g.shape}));a=Pr(l.map(g=>g.shape),1);const h=l[0].shape[0]===1,p=VS(d,a,e[0].dtype,h),f=Pr(c.map(g=>g.shape),o),m=t.makeTensorInfo(f,e[0].dtype,p);return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const DO={kernelName:nd,backendName:"cpu",kernelFunc:pa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s;st([r,o],"conv2d");const h=io(c),p=Qn(r.shape,o.shape,i,l,a,d,!1,h),f=p.filterHeight,m=p.filterWidth,g=p.dilationHeight,x=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v=p.dataFormat==="channelsLast",w=new Kn(p.outShape,r.dtype),S=pt(r.shape),N=pt(o.shape),C=S[0],k=v?S[1]:S[2],I=v?S[2]:1,T=v?1:S[1],_=w.strides[0],D=v?w.strides[1]:w.strides[2],P=v?w.strides[2]:1,A=v?1:w.strides[1],F=t.data.get(r.dataId).values,O=t.data.get(o.dataId).values,V=w.values;for(let L=0;L<p.batchSize;++L){const H=L*C,J=L*_;for(let X=0;X<p.outHeight;++X){const fe=J+X*D,be=X*p.strideHeight-b;for(let oe=0;oe<f;++oe){const xe=be+oe*g;if(xe<0||xe>=p.inHeight)continue;const $e=oe*N[0],Le=H+xe*k;for(let Re=0;Re<p.outWidth;++Re){const ze=fe+Re*P,Ye=Re*p.strideWidth-y;for(let Te=0;Te<m;++Te){const ut=Ye+Te*x;if(ut<0||ut>=p.inWidth)continue;const ft=$e+Te*N[1],wt=Le+ut*I;let vt=ft;for(let Nt=0;Nt<p.inChannels;++Nt){const mt=F[wt+Nt*T];for(let dt=0;dt<p.outChannels;++dt)V[ze+dt*A]+=mt*O[vt+dt];vt+=p.outChannels}}}}}}return t.makeTensorInfo(w.shape,w.dtype,V)}const jO={kernelName:sd,backendName:"cpu",kernelFunc:LC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _O(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s;st([r,o],"conv2dBackpropFilter");const h=io(c),p=Qn(r.shape,d,i,1,a,l,!1,h),{strideHeight:f,strideWidth:m,filterHeight:g,filterWidth:x}=p,y=p.dataFormat==="channelsLast",b=new Kn(p.filterShape,"float32"),v=p.padInfo.left,w=p.padInfo.top,S=t.data.get(r.dataId).values,N=t.data.get(o.dataId).values,C=new Kn(r.shape,r.dtype,S),k=new Kn(o.shape,o.dtype,N);for(let I=0;I<g;++I){const T=Math.max(0,Math.ceil((w-I)/f)),_=Math.min(p.outHeight,(p.inHeight+w-I)/f);for(let D=0;D<x;++D){const P=Math.max(0,Math.ceil((v-D)/m)),A=Math.min(p.outWidth,(p.inWidth+v-D)/m);for(let F=0;F<p.inChannels;++F)for(let O=0;O<p.outChannels;++O){let V=0;for(let L=0;L<p.batchSize;++L)for(let H=T;H<_;++H){const J=I+H*f-w;for(let X=P;X<A;++X){const fe=D+X*m-v;y?V+=C.get(L,J,fe,F)*k.get(L,H,X,O):V+=C.get(L,F,J,fe)*k.get(L,O,H,X)}}b.set(V,I,D,F,O)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const PO={kernelName:wf,backendName:"cpu",kernelFunc:_O};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s;st([r,o],"conv2dBackpropInput");const h=pt(o.shape),p=pt(r.shape);let f=io(l);const m=Qn(i,o.shape,a,1,c,d,!1,f),g=new Kn(m.inShape,"float32"),x=g.values,y=t.data.get(r.dataId).values,b=t.data.get(o.dataId).values,[v,w,S]=h,{batchSize:N,filterHeight:C,filterWidth:k,inChannels:I,inHeight:T,inWidth:_,outChannels:D,outHeight:P,outWidth:A,strideHeight:F,strideWidth:O}=m;f=m.dataFormat;const V=C-1-m.padInfo.top,L=k-1-m.padInfo.left,H=f==="channelsLast",J=g.strides[0],X=H?g.strides[1]:g.strides[2],fe=H?g.strides[2]:1,be=H?1:g.strides[1],oe=p[0],xe=H?p[1]:p[2],$e=H?p[2]:1,Le=H?1:p[1];for(let Re=0;Re<N;++Re)for(let ze=0;ze<I;++ze)for(let Ye=0;Ye<T;++Ye){const Te=Ye-V,ut=Math.max(0,Math.ceil(Te/F)),ft=Math.min(P,(C+Te)/F);for(let wt=0;wt<_;++wt){const vt=wt-L,Nt=Math.max(0,Math.ceil(vt/O)),mt=Math.min(A,(k+vt)/O);let dt=0;for(let de=ut;de<ft;++de){const q=de*F-Te;for(let Z=Nt;Z<mt;++Z){const Ce=Z*O-vt,_e=oe*Re+xe*de+$e*Z,De=v*(C-1-q)+w*(k-1-Ce)+S*ze;for(let Ie=0;Ie<D;++Ie){const Dt=y[_e+Le*Ie],j=b[De+Ie];dt+=Dt*j}}}const re=J*Re+X*Ye+fe*wt+be*ze;x[re]=dt}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const FO={kernelName:rd,backendName:"cpu",kernelFunc:MO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s;st([r,o],"conv3d");const l=jo(r.shape,o.shape,i,c,a),{filterDepth:d,filterHeight:h,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:g,padInfo:x}=l,y=x.front,b=x.left,v=x.top,w=new Kn(l.outShape,r.dtype),S=t.data.get(r.dataId).values,N=t.data.get(o.dataId).values,C=w.values,k=pt(r.shape),I=pt(o.shape);for(let T=0;T<l.batchSize;++T){const _=T*k[0],D=T*w.strides[0];for(let P=0;P<l.outDepth;++P){const A=D+P*w.strides[1],F=P*l.strideDepth-y;for(let O=0;O<d;++O){const V=F+O*f;if(V<0||V>=l.inDepth)continue;const L=O*I[0],H=_+V*k[1];for(let J=0;J<l.outHeight;++J){const X=A+J*w.strides[2],fe=J*l.strideHeight-v;for(let be=0;be<h;++be){const oe=fe+be*m;if(oe<0||oe>=l.inHeight)continue;const xe=L+be*I[1],$e=H+oe*k[2];for(let Le=0;Le<l.outWidth;++Le){const Re=X+Le*l.outChannels,ze=Le*l.strideWidth-b;for(let Ye=0;Ye<p;++Ye){const Te=ze+Ye*g;if(Te<0||Te>=l.inWidth)continue;const ut=xe+Ye*I[2],ft=$e+Te*l.inChannels;let wt=ut;for(let vt=0;vt<l.inChannels;++vt){const Nt=S[ft+vt];for(let mt=0;mt<l.outChannels;++mt)C[Re+mt]+=Nt*N[wt+mt];wt+=l.outChannels}}}}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const LO={kernelName:od,backendName:"cpu",kernelFunc:OO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s;st([r,o],"conv3dBackpropFilterV2");const l=pt(r.shape),d=pt(o.shape),h=jo(r.shape,c,i,1,a),p=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.filterDepth,x=h.filterHeight,y=h.filterWidth,b=new Kn(h.filterShape,"float32"),v=b.values,[w,S,N,C]=b.strides,k=t.data.get(o.dataId).values,[I,T,_,D]=d,P=t.data.get(r.dataId).values,[A,F,O,V]=l,L=h.padInfo.front,H=h.padInfo.left,J=h.padInfo.top;for(let X=0;X<g;++X){const fe=Math.max(0,Math.ceil((L-X)/p)),be=Math.min(h.outDepth,(h.inDepth+L-X)/p),oe=X*w;for(let xe=0;xe<x;++xe){const $e=Math.max(0,Math.ceil((J-xe)/f)),Le=Math.min(h.outHeight,(h.inHeight+J-xe)/f),Re=xe*S+oe;for(let ze=0;ze<y;++ze){const Ye=Math.max(0,Math.ceil((H-ze)/m)),Te=Math.min(h.outWidth,(h.inWidth+H-ze)/m),ut=ze*N+Re;for(let ft=0;ft<h.inChannels;++ft){const wt=ft*C+ut;for(let vt=0;vt<h.outChannels;++vt){let Nt=0;for(let mt=0;mt<h.batchSize;++mt){const dt=mt*A,re=mt*I;for(let de=fe;de<be;++de){const Z=(X+de*p-L)*F+dt,Ce=de*T+re;for(let _e=$e;_e<Le;++_e){const Ie=(xe+_e*f-J)*O+Z,Dt=_e*_+Ce;for(let j=Ye;j<Te;++j){const U=(ze+j*m-H)*V+Ie,M=j*D+Dt;Nt+=P[U+ft]*k[M+vt]}}}}v[wt+vt]=Nt}}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const WO={kernelName:vf,backendName:"cpu",kernelFunc:zO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s;st([r],"conv3dBackpropInputV2");const l=pt(r.shape),d=pt(o.shape),h=jo(c,o.shape,a,1,i),p=new Kn(h.inShape,"float32"),f=p.values,[m,g,x,y]=p.strides,b=t.data.get(r.dataId).values,[v,w,S,N]=l,C=t.data.get(o.dataId).values,[k,I,T,_]=d,{batchSize:D,filterDepth:P,filterHeight:A,filterWidth:F,inChannels:O,inDepth:V,inHeight:L,inWidth:H,outChannels:J,outDepth:X,outHeight:fe,outWidth:be,strideDepth:oe,strideHeight:xe,strideWidth:$e}=h,Le=P-1-h.padInfo.front,Re=A-1-h.padInfo.top,ze=F-1-h.padInfo.left;for(let Ye=0;Ye<D;++Ye)for(let Te=0;Te<O;++Te)for(let ut=0;ut<V;++ut){const ft=ut-Le,wt=Math.max(0,Math.ceil(ft/oe)),vt=Math.min(X,(P+ft)/oe);for(let Nt=0;Nt<L;++Nt){const mt=Nt-Re,dt=Math.max(0,Math.ceil(mt/xe)),re=Math.min(fe,(A+mt)/xe);for(let de=0;de<H;++de){const q=de-ze,Z=Math.max(0,Math.ceil(q/$e)),Ce=Math.min(be,(F+q)/$e);let _e=0;for(let De=wt;De<vt;++De){const Ie=De*oe-ft;for(let Dt=dt;Dt<re;++Dt){const j=Dt*xe-mt;for(let z=Z;z<Ce;++z){const U=z*$e-q,M=v*Ye+w*De+S*Dt+N*z,ie=k*(P-1-Ie)+I*(A-1-j)+T*(F-1-U)+_*Te;for(let te=0;te<J;++te){const Q=b[M+te],ce=C[ie+te];_e+=Q*ce}}}}f[m*Ye+g*ut+x*Nt+y*de+Te]=_e}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const VO={kernelName:Sf,backendName:"cpu",kernelFunc:BO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UO=sn(kc,n=>Math.cos(n)),GO={kernelName:kc,backendName:"cpu",kernelFunc:UO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HO=sn($c,n=>Math.cosh(n)),qO={kernelName:$c,backendName:"cpu",kernelFunc:HO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KO(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,[d,h,p,f]=r.shape,m=o.shape[0],[g,x]=a,y=Ot([m,g,x,f],"float32"),b=t.data.get(o.dataId).values,v=t.data.get(i.dataId).values,w=t.data.get(r.dataId).values,S=pt(r.shape),N=pt(y.shape);for(let C=0;C<m;C++){const k=C*4,I=b[k],T=b[k+1],_=b[k+2],D=b[k+3],P=v[C];if(P>=d)continue;const A=g>1?(_-I)*(h-1)/(g-1):0,F=x>1?(D-T)*(p-1)/(x-1):0;for(let O=0;O<g;O++){const V=g>1?I*(h-1)+O*A:.5*(I+_)*(h-1);if(V<0||V>h-1){for(let L=0;L<x;L++)for(let H=0;H<f;H++){const J=H+L*N[2]+O*N[1]+C*N[0];y.values[J]=l}continue}if(c==="bilinear"){const L=Math.floor(V),H=Math.ceil(V),J=V-L;for(let X=0;X<x;X++){const fe=x>1?T*(p-1)+X*F:.5*(T+D)*(p-1);if(fe<0||fe>p-1){for(let $e=0;$e<f;$e++){const Le=$e+X*N[2]+O*N[1]+C*N[0];y.values[Le]=l}continue}const be=Math.floor(fe),oe=Math.ceil(fe),xe=fe-be;for(let $e=0;$e<f;$e++){let Le=$e+be*S[2]+L*S[1]+P*S[0];const Re=w[Le];Le=$e+oe*S[2]+L*S[1]+P*S[0];const ze=w[Le];Le=$e+be*S[2]+H*S[1]+P*S[0];const Ye=w[Le];Le=$e+oe*S[2]+H*S[1]+P*S[0];const Te=w[Le],ut=Re+(ze-Re)*xe,ft=Ye+(Te-Ye)*xe;Le=$e+X*N[2]+O*N[1]+C*N[0],y.values[Le]=ut+(ft-ut)*J}}}else for(let L=0;L<x;++L){const H=x>1?T*(p-1)+L*F:.5*(T+D)*(p-1);if(H<0||H>p-1){for(let fe=0;fe<f;fe++){const be=fe+L*N[2]+O*N[1]+C*N[0];y.values[be]=l}continue}const J=Math.round(H),X=Math.round(V);for(let fe=0;fe<f;fe++){const be=fe+J*S[2]+X*S[1]+P*S[0],oe=fe+L*N[2]+O*N[1]+C*N[0];y.values[oe]=w[be]}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const QO={kernelName:Nf,backendName:"cpu",kernelFunc:KO};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;st(r,"cumprod");const c=Sn([o],r.shape.length);let l=r;c!=null&&(l=bs({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Tn(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Rs(l.dtype,"int32"),p=lf(we(l.shape),h),f=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<f.length;y+=m)for(let b=0;b<m;b++){const v=g(y,b);if(b===0)p[v]=i?1:f[v];else{const w=g(y,b-1);p[v]=i?f[w]*p[w]:f[v]*p[w]}}const x=t.makeTensorInfo(l.shape,h,p);if(c!=null){const y=_o(c),b=bs({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const YO={kernelName:Cf,backendName:"cpu",kernelFunc:XO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;st(r,"cumsum");const c=Sn([o],r.shape.length);let l=r;c!=null&&(l=bs({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Tn(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Rs(l.dtype,"int32"),p=Zn(we(l.shape),h),f=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<f.length;y+=m)for(let b=0;b<m;b++){const v=g(y,b);if(b===0)p[v]=i?0:f[v];else{const w=g(y,b-1);p[v]=i?f[w]+p[w]:f[v]+p[w]}}const x=t.makeTensorInfo(l.shape,h,p);if(c!=null){const y=_o(c),b=bs({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const ZO={kernelName:id,backendName:"cpu",kernelFunc:JO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=_g(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=zS(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const tL={kernelName:If,backendName:"cpu",kernelFunc:eL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;E(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],c=r.shape[1],l=r.shape[2],d=r.shape[3],h=c*o,p=l*o,f=d/(o*o),m=t.data.get(r.dataId).values,g=new Float32Array(a*h*p*f);let x=0;for(let y=0;y<a;++y)for(let b=0;b<h;++b){const v=Math.floor(b/o),w=b%o;for(let S=0;S<p;++S){const N=Math.floor(S/o),C=S%o,k=(w*o+C)*f;for(let I=0;I<f;++I){const _=I+k+d*(N+l*(v+c*y));g[x++]=m[_]}}}return t.makeTensorInfo([a,h,p,f],r.dtype,g)}const sL={kernelName:kf,backendName:"cpu",kernelFunc:nL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;st([r,o],"depthwiseConv2DNative");const d=pt(r.shape),h=pt(o.shape);let p=c;p==null&&(p=[1,1]),E(ts(i,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${p}'`);const f=Qn(r.shape,o.shape,i,p,a,l,!0),{filterHeight:m,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=f,v=b.left,w=b.top,S=f.outChannels/f.inChannels,N=new Kn(f.outShape,r.dtype),C=t.data.get(r.dataId).values,k=t.data.get(o.dataId).values,I=N.values;for(let T=0;T<f.batchSize;++T){const _=T*d[0],D=T*N.strides[0];for(let P=0;P<f.outHeight;++P){const A=D+P*N.strides[1],F=P*f.strideHeight-w;for(let O=0;O<m;++O){const V=F+O*x;if(V<0||V>=f.inHeight)continue;const L=O*h[0],H=_+V*d[1];for(let J=0;J<f.outWidth;++J){const X=A+J*N.strides[2],fe=J*f.strideWidth-v;for(let be=0;be<g;++be){const oe=fe+be*y;if(oe<0||oe>=f.inWidth)continue;const xe=L+be*h[1],$e=H+oe*f.inChannels;let Le=X,Re=xe;for(let ze=0;ze<f.inChannels;++ze){const Ye=C[$e+ze];for(let Te=0;Te<S;++Te)I[Le+Te]+=Ye*k[Re+Te];Le+=S,Re+=S}}}}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const rL={kernelName:ad,backendName:"cpu",kernelFunc:zC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s;st([r,o],"depthwiseConv2dNativeBackpropFilter");const h=Qn(r.shape,d,i,a,c,l,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=h,x=new Kn(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=t.data.get(r.dataId).values,S=new Kn(r.shape,r.dtype,w),N=t.data.get(o.dataId).values,C=new Kn(o.shape,o.dtype,N);for(let k=0;k<m;++k){const I=Math.max(0,Math.ceil((b-k)/p)),T=Math.min(h.outHeight,(h.inHeight+b-k)/p);for(let _=0;_<g;++_){const D=Math.max(0,Math.ceil((y-_)/f)),P=Math.min(h.outWidth,(h.inWidth+y-_)/f);for(let A=0;A<h.outChannels;++A){const F=Math.trunc(A/v),O=A%v;let V=0;for(let L=0;L<h.batchSize;++L)for(let H=I;H<T;++H){const J=k+H*p-b;for(let X=D;X<P;++X){const fe=_+X*f-y;V+=S.get(L,J,fe,F)*C.get(L,H,X,A)}}x.set(V,k,_,F,O)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const iL={kernelName:$f,backendName:"cpu",kernelFunc:oL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s;st([r,o],"depthwiseConv2DNativeBackpropInput");const h=pt(r.shape),p=pt(o.shape),f=Qn(d,o.shape,i,a,c,l,!0),m=new Kn(f.inShape,"float32"),g=m.values,[x,y,b]=m.strides,v=t.data.get(r.dataId).values,[w,S,N]=h,C=t.data.get(o.dataId).values,[k,I,T]=p,{batchSize:_,filterHeight:D,filterWidth:P,inChannels:A,inHeight:F,inWidth:O,outChannels:V,outHeight:L,outWidth:H,strideHeight:J,strideWidth:X}=f,fe=D-1-f.padInfo.top,be=P-1-f.padInfo.left,oe=V/A;for(let xe=0;xe<_;++xe)for(let $e=0;$e<A;++$e)for(let Le=0;Le<F;++Le){const Re=Le-fe,ze=Math.max(0,Math.ceil(Re/J)),Ye=Math.min(L,(D+Re)/J);for(let Te=0;Te<O;++Te){const ut=Te-be,ft=Math.max(0,Math.ceil(ut/X)),wt=Math.min(H,(P+ut)/X);let vt=0;for(let Nt=ze;Nt<Ye;++Nt){const mt=Nt*J-Re;for(let dt=ft;dt<wt;++dt){const re=dt*X-ut,de=w*xe+S*Nt+N*dt,q=k*(D-1-mt)+I*(P-1-re)+T*$e;for(let Z=0;Z<oe;++Z){const Ce=$e*oe+Z,_e=v[de+Ce],De=C[q+Z];vt+=_e*De}}}g[x*xe+y*Le+b*Te+$e]=vt}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const cL={kernelName:Tf,backendName:"cpu",kernelFunc:aL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n){const{inputs:e,backend:t}=n,{x:s}=e,r=we(s.shape),o=t.data.get(s.dataId).values,i=Ot([r,r],s.dtype),a=i.values;for(let l=0;l<o.length;l++)a[l*r+l]=o[l];const c=[...s.shape,...s.shape];return t.makeTensorInfo(c,i.dtype,i.values)}const uL={kernelName:ab,backendName:"cpu",kernelFunc:lL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dL={kernelName:cd,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=t,c=e,l=c.data.get(s.dataId).values,d=s.shape.length,h=c.data.get(r.dataId).values,p=r.shape.length,{batchSize:f,inHeight:m,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:S,filterHeight:N,filterWidth:C,dilationHeight:k,dilationWidth:I,outShape:T}=dl(s.shape,r.shape,o,i,"NHWC",a),_=we(T),D=T.length,P=In(s.dtype,_);for(let F=0;F<f;++F)for(let O=0;O<y;++O){const V=O*w-v.top;for(let L=0;L<b;++L){const H=L*S-v.left;for(let J=0;J<x;++J){let X=Number.MIN_SAFE_INTEGER;for(let be=0;be<N;++be){const oe=V+be*k;if(oe>=0&&oe<m)for(let xe=0;xe<C;++xe){const $e=H+xe*I;if($e>=0&&$e<g){const Le=jr([F,oe,$e,J],d,pt(s.shape)),Re=jr([be,xe,J],p,pt(r.shape)),ze=l[Le]+h[Re];ze>X&&(X=ze)}}}const fe=jr([F,O,L,J],D,pt(T));P[fe]=X}}}return{dataId:c.write(vi(P,s.dtype),T,s.dtype),shape:T,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hL={kernelName:yp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=mr(s.shape,l.data.get(s.dataId).values),h=mr(r.shape,l.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:N,dilationHeight:C,dilationWidth:k,outShape:I}=dl(s.shape,r.shape,i,a,"NHWC",c);E(o.rank===I.length,()=>`Error in ${yp}, dy must have the same rank as output ${I.length}, but got ${o.rank}`);const T=mr(I,l.data.get(o.dataId).values),_=sb(r.shape,r.dtype);for(let P=0;P<p;++P)for(let A=0;A<x;++A){const F=A*v-b.top;for(let O=0;O<y;++O){const V=O*w-b.left;for(let L=0;L<g;++L){let H=Number.MIN_SAFE_INTEGER,J=0,X=0;for(let fe=0;fe<S;++fe){const be=F+fe*C;if(be>=0&&be<f)for(let oe=0;oe<N;++oe){const xe=V+oe*k;if(xe>=0&&xe<m){const $e=d[P][be][xe][L]+h[fe][oe][L];$e>H&&(H=$e,J=fe,X=oe)}}}_[J][X][L]+=T[P][A][O][L]}}}return{dataId:l.write(vi(_,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL={kernelName:xp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=mr(s.shape,l.data.get(s.dataId).values),h=mr(r.shape,l.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:N,dilationHeight:C,dilationWidth:k,outShape:I}=dl(s.shape,r.shape,i,a,"NHWC",c);E(o.rank===I.length,()=>`Error in ${xp}, dy must have the same rank as output ${I.length}, but got ${o.rank}`);const T=mr(I,l.data.get(o.dataId).values),_=sb(s.shape,s.dtype);for(let P=0;P<p;++P)for(let A=0;A<x;++A){const F=A*v-b.top;for(let O=0;O<y;++O){const V=O*w-b.left;for(let L=0;L<g;++L){let H=Number.MIN_SAFE_INTEGER,J=F<0?0:F,X=V<0?0:V;for(let fe=0;fe<S;++fe){const be=F+fe*C;if(be>=0&&be<f)for(let oe=0;oe<N;++oe){const xe=V+oe*k;if(xe>=0&&xe<m){const $e=d[P][be][xe][L]+h[fe][oe][L];$e>H&&(H=$e,J=be,X=xe)}}}_[P][J][X][L]+=T[P][A][O][L]}}}return{dataId:l.write(vi(_,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:c}=i||{},l=(c==null?void 0:c.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=o.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${d} type.`);const[p,f]=r.shape.slice(0,2),m=r.shape.length===2?1:r.shape[2],g=t.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(f*p*4);for(let v=0;v<p*f;++v){const w=[0,0,0,255*l];for(let N=0;N<m;N++){const C=g[v*m+N];if(r.dtype==="float32"){if(C<0||C>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${C}.`)}else if(r.dtype==="int32"&&(C<0||C>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${C}.`);m===1?(w[0]=C*x,w[1]=C*x,w[2]=C*x):w[N]=C*x}const S=v*4;y[S+0]=Math.round(w[0]),y[S+1]=Math.round(w[1]),y[S+2]=Math.round(w[2]),y[S+3]=Math.round(w[3])}o.width=f,o.height=p;const b=new ImageData(y,f,p);return h.putImageData(b,0,0),r}const mL={kernelName:Tk,backendName:"cpu",kernelFunc:fL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;st(r,"sum");let a;r.dtype==="bool"?a=Ao({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Ur({inputs:{x:r},backend:t});const c=a.shape.length,l=Lt(o,a.shape),d=Sn(l,c);let h=l,p=a;d!=null&&(p=bs({inputs:{x:a},backend:t,attrs:{perm:d}}),h=Tn(h.length,c)),Xn("sum",h,p.shape.length);const[f,m]=Hn(p.shape,h),g=Rs(p.dtype,"int32");let x=ku(t,f,g);const y=we(m),b=t.data.get(x.dataId).values,v=t.data.get(p.dataId).values;for(let w=0;w<b.length;++w){const S=w*y;let N=0;for(let C=0;C<y;++C)N+=v[S+C];b[w]=N}if(i){const w=Dn(x.shape,l),S=x;x=hn({inputs:{x},backend:t,attrs:{shape:w}}),t.disposeIntermediateTensorInfo(S)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),x}const gL={kernelName:Wd,backendName:"cpu",kernelFunc:$l};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=rg(r,o.length);ig(i.length,c,o);const{path:l,steps:d}=ag(a,c),h=d.length;let p=null,f=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=og(f,c[x]);let v;cg(y)?v=o[x]:(v=bs({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(v));const w=v.shape.slice();for(let S=0;S<b.length;++S)w.splice(b[S],0,1);Jt(v.shape,w)||(v=hn({inputs:{x:v},backend:t,attrs:{shape:w}}),m.push(v)),p===null?p=v:(p=bh({inputs:{a:v,b:p},backend:t}),m.push(p))}g<h-1&&(l[g]>=0&&(p=$l({inputs:{x:p},backend:t,attrs:{axis:l[g]-(i.length-f),keepDims:!1}}),m.push(p)),f--)}for(const g of m)g!==p&&t.disposeIntermediateTensorInfo(g);return p}const yL={kernelName:Af,backendName:"cpu",kernelFunc:xL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;st([s,r],"eluGrad");const o=new Float32Array(we(r.shape)),i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let c=0;c<i.length;++c){const l=i[c];l>=0?o[c]=a[c]:o[c]=a[c]*(l+1)}return t.makeTensorInfo(r.shape,"float32",o)}const wL={kernelName:Ef,backendName:"cpu",kernelFunc:bL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vL=Ym,SL=Jm,CL=Zm,NL=eg,IL=tg,kL=ng,$L=sn(Ec,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+vL*t);return e*(1-((((kL*s+IL)*s+NL)*s+CL)*s+SL)*s*Math.exp(-t*t))}),TL={kernelName:Ec,backendName:"cpu",kernelFunc:$L};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Au(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let c=o;return o<0&&(E(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),hn({inputs:{x:r},backend:t,attrs:{shape:a}})}const AL={kernelName:ud,backendName:"cpu",kernelFunc:Au};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EL=En((n,e)=>n/e),zg=Wn(Tc,EL),Gp={kernelName:Tc,backendName:"cpu",kernelFunc:zg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WC(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,l=[r,o],d=we(l),h=Jn("float32",d),p=Jn("float32",d);for(let x=0;x<r;x++){const y=xi({inputs:{x:a},backend:t,attrs:{begin:[x,0],size:[1,o]}}),b=xi({inputs:{x:c},backend:t,attrs:{begin:[x,0],size:[1,o]}}),v=$s({inputs:{real:y,imag:b},backend:t}),{real:w,imag:S}=RL(v,e,t),N=to(w,S);for(let C=0;C<o;C++){const k=sg(N,C);h[x*o+C]=k.real,p[x*o+C]=k.imag}t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v)}const f=t.makeTensorInfo(l,"float32",h),m=t.makeTensorInfo(l,"float32",p),g=$s({inputs:{real:f,imag:m},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),g}function RL(n,e,t){const s=we(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(DL(s)){const a=Hp(o,i,s,e,t),c=[n.shape[0],n.shape[1]];if(e){const l=t.makeTensorInfo(c,"float32",a.real),d=t.makeTensorInfo(c,"float32",a.imag),h=t.makeTensorInfo([],"float32",Ro(s,"float32")),p=Ur({inputs:{x:h},backend:t}),f=Gp.kernelFunc({inputs:{a:l,b:h},backend:t}),m=Gp.kernelFunc({inputs:{a:d,b:p},backend:t}),g=t.data.get(f.dataId).values,x=t.data.get(m.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),{real:g,imag:x}}return a}else{const a=to(o,i),c=jL(a,s,e);return tv(c)}}function DL(n){return(n&n-1)===0}function Hp(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=to(n,e),i=t/2,a=nv(o),c=a.real,l=a.imag,d=[c.length],h=r.makeTensorInfo(d,"float32",c),p=r.makeTensorInfo(d,"float32",l),f=$s({inputs:{real:h,imag:p},backend:r}),m=sv(o),g=m.real,x=m.imag,y=[g.length],b=r.makeTensorInfo(y,"float32",g),v=r.makeTensorInfo(y,"float32",x),w=$s({inputs:{real:b,imag:v},backend:r}),S=Hp(c,l,i,s,r),N=S.real,C=S.imag,k=[N.length],I=r.makeTensorInfo(k,"float32",N),T=r.makeTensorInfo(k,"float32",C),_=$s({inputs:{real:I,imag:T},backend:r}),D=Hp(g,x,i,s,r),P=D.real,A=D.imag,F=[P.length],O=r.makeTensorInfo(F,"float32",P),V=r.makeTensorInfo(F,"float32",A),L=$s({inputs:{real:O,imag:V},backend:r}),H=ov(t,s),J=[H.real.length],X=r.makeTensorInfo(J,"float32",H.real),fe=r.makeTensorInfo(J,"float32",H.imag),be=$s({inputs:{real:X,imag:fe},backend:r}),oe=bh({inputs:{a:be,b:L},backend:r}),xe=da({inputs:{a:_,b:oe},backend:r}),$e=Og({inputs:{a:_,b:oe},backend:r}),Le=gi({inputs:{input:xe},backend:r}),Re=gi({inputs:{input:$e},backend:r}),ze=ha({inputs:{input:xe},backend:r}),Ye=ha({inputs:{input:$e},backend:r}),Te=pa({inputs:[Le,Re],backend:r,attrs:{axis:0}}),ut=pa({inputs:[ze,Ye],backend:r,attrs:{axis:0}}),ft=r.data.get(Te.dataId).values,wt=r.data.get(ut.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(fe),r.disposeIntermediateTensorInfo(be),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo($e),r.disposeIntermediateTensorInfo(Le),r.disposeIntermediateTensorInfo(ze),r.disposeIntermediateTensorInfo(Re),r.disposeIntermediateTensorInfo(Ye),r.disposeIntermediateTensorInfo(Te),r.disposeIntermediateTensorInfo(ut),{real:ft,imag:wt}}function jL(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const c=iv(r*a,e,t),l=sg(n,a);o+=l.real*c.real-l.imag*c.imag,i+=l.real*c.imag+l.imag*c.real}t&&(o/=e,i/=e),rv(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(n){const{inputs:e,backend:t}=n,{input:s}=e,r=we(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=hn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=WC(a,!1,t),l=hn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const PL={kernelName:Rf,backendName:"cpu",kernelFunc:_L};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||xa(r),a=In(i,we(s));return FL(a,r,i),e.makeTensorInfo(s,i,a)}const ML={kernelName:Df,backendName:"cpu",kernelFunc:Wg};function FL(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OL={kernelName:jf,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=Jn(s.dtype,we(s.shape)),[i,a,c,l]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<i;p++){const f=p*c*a*l;for(let m=0;m<a;m++){const g=m*(c*l);for(let x=0;x<c;x++){const y=x*l;for(let b=0;b<l;b++){const v=Math.round(c-x-1),w=f+g+y+b;let S=d[w];if(v>=0&&v<c){const N=v*l,C=f+g+N+b;S=d[C]}o[w]=S}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=s;let g=LC({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p}});if(i){const x=g;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const y=hn({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});g=da({inputs:{a:g,b:y},backend:t}),t.disposeIntermediateTensorInfo(y)}else g=da({inputs:{a:g,b:i},backend:t});t.disposeIntermediateTensorInfo(x)}if(f){const x=g;if(d==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=hn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});g=Tu(t,g,f,y,m),t.disposeIntermediateTensorInfo(y)}else g=Tu(t,g,f,a,m);t.disposeIntermediateTensorInfo(x)}return g}const zL={kernelName:iu,backendName:"cpu",kernelFunc:LL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=s;let g=zC({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p}});if(i){const x=g;g=da({inputs:{a:g,b:i},backend:t}),t.disposeIntermediateTensorInfo(x)}if(f){const x=g;g=Tu(t,g,f,a,m),t.disposeIntermediateTensorInfo(x)}return g}const BL={kernelName:kb,backendName:"cpu",kernelFunc:WL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=we(s.shape),i=r.shape,a=i[i.length-1],[c,l,d,h]=zm(s,r);if(l===0)return t.makeTensorInfo(c,s.dtype,[]);const p=t.data.get(r.dataId).values,f=t.bufferSync(s),m=YS(p,f,s.dtype,l,a,d,h,s.shape,o);return t.makeTensorInfo(c,s.dtype,m.values)}const UL={kernelName:cb,backendName:"cpu",kernelFunc:VL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;st([r,o],"gatherV2");const c=Lt(i,r.shape)[0],l=t.data.get(o.dataId).values,d=r.shape[c];for(let w=0;w<l.length;++w){const S=l[w];E(S<=d-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${d-1}]`)}let h=a;a==null&&(h=0);const p=we(o.shape),f=ug(r,o,c,h),m=hn({inputs:{x:r},backend:t,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),g=hn({inputs:{x:o},backend:t,attrs:{shape:[f.batchSize,p/f.batchSize]}}),x=[f.batchSize,f.outerSize,p/f.batchSize,f.sliceSize],y=t.bufferSync(g),b=t.bufferSync(m),v=JS(b,y,x);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(f.outputShape,v.dtype,v.values)}const HL={kernelName:hd,backendName:"cpu",kernelFunc:GL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(n){const{inputs:e,backend:t}=n,{input:s}=e,r=we(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=hn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=WC(a,!0,t),l=hn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const KL={kernelName:_f,backendName:"cpu",kernelFunc:qL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QL=sn(Fc,n=>Number.isFinite(n)?1:0,"bool"),XL={kernelName:Fc,backendName:"cpu",kernelFunc:QL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YL=sn(Oc,n=>Math.abs(n)===1/0?1:0,"bool"),JL={kernelName:Oc,backendName:"cpu",kernelFunc:YL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZL=sn(Lc,n=>Number.isNaN(n)?1:0,"bool"),e3={kernelName:Lc,backendName:"cpu",kernelFunc:ZL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t3(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=sC(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const n3={kernelName:lb,backendName:"cpu",kernelFunc:t3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s3=sn(Wc,n=>Math.log1p(n)),r3={kernelName:Wc,backendName:"cpu",kernelFunc:s3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o3=En((n,e)=>n&&e),i3=Wn(xd,o3,null,"bool"),a3={kernelName:xd,backendName:"cpu",kernelFunc:i3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c3=sn(yd,n=>n?0:1,"bool"),l3={kernelName:yd,backendName:"cpu",kernelFunc:c3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3=En((n,e)=>n||e),d3=Wn(bd,u3,null,"bool"),h3={kernelName:bd,backendName:"cpu",kernelFunc:d3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s;st(r,"LRN");const l=r.shape[3],d=l-1,h=t.data.get(r.dataId).values,p=we(r.shape),f=new Float32Array(p);function m(g){const x=g%l;let y=g-x+Math.max(0,x-o);const b=g-x+Math.min(x+o,d);let v=0;for(;y<=b;y++){const w=h[y];v+=w*w}return v}for(let g=0;g<p;g++){const x=m(g),y=h[g]*Math.pow(i+a*x,-c);f[g]=y}return t.makeTensorInfo(r.shape,r.dtype,f)}const f3={kernelName:wd,backendName:"cpu",kernelFunc:p3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s;st(i,"LRNGrad");const h=we(i.shape),p=i.shape[3],f=t.data.get(i.dataId).values,m=t.data.get(r.dataId).values,g=t.data.get(o.dataId).values,x=new Float32Array(h),y=h;for(let b=0;b<y;b++){const v=b%p,w=b-v+Math.max(0,v-a),S=b-v+Math.min(p,v+a+1);let N=0;for(let C=w;C<S;C++)N+=Math.pow(m[C],2);N=l*N+c;for(let C=w;C<S;C++){let k=-2*l*d*m[C]*g[b]/N;b===C&&(k+=Math.pow(N,-d)),k*=f[b],x[C]+=k}}return t.makeTensorInfo(i.shape,r.dtype,x)}const g3={kernelName:Mf,backendName:"cpu",kernelFunc:m3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=t;let c=r.shape;const l=c.length,d=Lt(o,c);let h=d;const p=Sn(h,l);let f=a.data.get(r.dataId).values;if(p!=null){const w=new Array(l);for(let S=0;S<w.length;S++)w[S]=c[p[S]];f=Mg(f,c,r.dtype,p,w),h=Tn(h.length,l),c=w}st(r,"max"),Xn("max",h,l);const[m,g]=Hn(c,h),x=we(g),y=oC(f,x,m,r.dtype),b=a.write(y,m,r.dtype);let v=m;return i&&(v=Dn(m,d)),{dataId:b,shape:v,dtype:r.dtype}}const x3={kernelName:vd,backendName:"cpu",kernelFunc:BC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;st(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&Jt(d.inShape,d.outShape))h=Ur({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,f=pt(r.shape),m=Lg(p,r.shape,r.dtype,f,d,"max");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const b3={kernelName:Sd,backendName:"cpu",kernelFunc:y3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;st(r,"maxPool3d");const d=oo(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,p=OC(h,r.shape,r.dtype,pt(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const v3={kernelName:Cd,backendName:"cpu",kernelFunc:w3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;st([r,o],"maxPool3DGrad");const d=oo(o.shape,i,a,1,c,l),h=t.bufferSync(o),p=uO(h,d),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,x=d.dilationDepth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterDepth,w=d.effectiveFilterHeight,S=d.effectiveFilterWidth,N=v-1-d.padInfo.front,C=S-1-d.padInfo.left,k=w-1-d.padInfo.top,I=Ot(o.shape,"float32"),T=t.bufferSync(r);for(let _=0;_<d.batchSize;++_)for(let D=0;D<d.inChannels;++D)for(let P=0;P<d.inDepth;++P)for(let A=0;A<d.inHeight;++A)for(let F=0;F<d.inWidth;++F){const O=P-N,V=A-k,L=F-C;let H=0;for(let J=0;J<v;J+=x){const X=(O+J)/f;if(!(X<0||X>=d.outDepth||Math.floor(X)!==X))for(let fe=0;fe<w;fe+=y){const be=(V+fe)/m;if(!(be<0||be>=d.outHeight||Math.floor(be)!==be))for(let oe=0;oe<S;oe+=b){const xe=(L+oe)/g;if(xe<0||xe>=d.outWidth||Math.floor(xe)!==xe)continue;const $e=v*w*S-1-p.get(_,X,be,xe,D),Le=J*w*S+fe*S+oe,Re=$e===Le?1:0;if(Re===0)continue;const ze=T.get(_,X,be,xe,D);H+=ze*Re}}}I.set(H,_,P,A,F,D)}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const C3={kernelName:Of,backendName:"cpu",kernelFunc:S3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;st([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,p=tr(a.shape,c,l,1,d,h),f=t.data.get(a.dataId).values,m=Ot(p.outShape,a.dtype,FC(f,a.shape,a.dtype,p).values),g=p.strideHeight,x=p.strideWidth,y=p.dilationHeight,b=p.dilationWidth,v=p.effectiveFilterHeight,w=p.effectiveFilterWidth,S=w-1-p.padInfo.left,N=v-1-p.padInfo.top,C=Ot(a.shape,"float32"),k=t.data.get(r.dataId).values,I=Ot(r.shape,"float32",k);for(let T=0;T<p.batchSize;++T)for(let _=0;_<p.inChannels;++_)for(let D=0;D<p.inHeight;++D)for(let P=0;P<p.inWidth;++P){const A=D-N,F=P-S;let O=0;for(let V=0;V<v;V+=y){const L=(A+V)/g;if(!(L<0||L>=p.outHeight||Math.floor(L)!==L))for(let H=0;H<w;H+=b){const J=(F+H)/x;if(J<0||J>=p.outWidth||Math.floor(J)!==J)continue;const X=v*w-1-m.get(T,L,J,_),fe=V*w+H,be=X===fe?1:0;if(be===0)continue;const oe=I.get(T,L,J,_);O+=oe*be}}C.set(O,T,D,P,_)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const I3={kernelName:Ff,backendName:"cpu",kernelFunc:N3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k3(n,e,t,s,r){const o=pt(e),i=Lg(n,e,t,o,r,"max"),a=FC(n,e,t,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $3={kernelName:ub,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;st(s,"MaxPoolWithArgmax");const l=c.data.get(s.dataId).values,d=tr(s.shape,r,o,[1,1],i),[h,p]=k3(l,s.shape,s.dtype,a,d),f=c.write(h,d.outShape,s.dtype),m=c.write(p,d.outShape,s.dtype);return[{dataId:f,shape:d.outShape,dtype:s.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=Lt(o,r.shape),l=Hn(r.shape,a)[1],d=we(l),h=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));h.push(p);const f=Ao({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});h.push(f);const m=zg({inputs:{a:f,b:p},backend:t});h.push(m);const g=$l({inputs:{x:m},backend:t,attrs:{axis:o,keepDims:i}});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const A3={kernelName:Nd,backendName:"cpu",kernelFunc:T3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;st(r,"min");const a=Lt(o,r.shape);let c=a;const l=Sn(c,r.shape.length);let d=r;l!=null&&(d=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Xn("min",c,d.shape.length);const[h,p]=Hn(d.shape,c),f=we(p),m=Zn(we(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*f;let v=g[b];for(let w=0;w<f;++w){const S=g[b+w];(Number.isNaN(S)||S<v)&&(v=S)}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=Dn(h,a),b=hn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const R3={kernelName:Id,backendName:"cpu",kernelFunc:E3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;st(r,"mirrorPad");const a=o.map((v,w)=>v[0]+r.shape[w]+v[1]),c=o.map(v=>v[0]),l=o.map((v,w)=>v[0]+r.shape[w]),d=i==="reflect"?0:1,h=t.data.get(r.dataId).values,p=r.shape.length,f=pt(r.shape),m=we(a),g=a.length,x=pt(a),y=Jn(r.dtype,m);for(let v=0;v<m;v++){let w=ya(v,g,x);for(let N=0;N<g;N++)w[N]<c[N]?w[N]=c[N]*2-w[N]-d:w[N]>=l[N]&&(w[N]=(l[N]-1)*2-w[N]+d);w=w.map((N,C)=>N-c[C]);const S=jr(w,p,f);y[v]=h[S]}return{dataId:t.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const j3={kernelName:kd,backendName:"cpu",kernelFunc:D3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _3=En((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),P3=Wn(Uc,_3),M3={kernelName:Uc,backendName:"cpu",kernelFunc:P3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VC(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const c=Lt([a],r.shape),l=BC({inputs:{x:r},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),d=Dn(l.shape,c),h=hn({inputs:{x:l},backend:t,attrs:{shape:d}}),p=Og({inputs:{a:r,b:h},backend:t}),f=qS({inputs:{x:p},backend:t}),m=$l({inputs:{x:f},backend:t,attrs:{axis:c,keepDims:!1}}),g=hn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=zg({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const F3={kernelName:Ud,backendName:"cpu",kernelFunc:VC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O3(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;st(r,"multinomial");const c=a?r:VC({inputs:{logits:r},backend:t,attrs:{dim:-1}}),l=c.shape[0],d=c.shape[1],h=t.data.get(c.dataId).values,p=[l,o],f=Zn(we(p),"int32");for(let m=0;m<l;++m){const g=m*d,x=new Float32Array(d-1);x[0]=h[g];for(let v=1;v<x.length;++v)x[v]=x[v-1]+h[g+v];const y=Im.alea(i.toString()),b=m*o;for(let v=0;v<o;++v){const w=y();f[b+v]=x.length;for(let S=0;S<x.length;S++)if(w<x[S]){f[b+v]=S;break}}}return a||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(p,"int32",f)}const L3={kernelName:db,backendName:"cpu",kernelFunc:O3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3=_m;function W3(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s;st(r,"NonMaxSuppression");const l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:h}=z3(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const B3={kernelName:Lf,backendName:"cpu",kernelFunc:W3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V3=Pm;function U3(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s;st(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,{selectedIndices:p,validOutputs:f}=V3(d,h,i,a,c,l);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([f]))]}const G3={kernelName:zf,backendName:"cpu",kernelFunc:U3};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H3=Mm;function q3(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s;st(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,p=i,f=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=H3(d,h,p,f,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const K3={kernelName:Wf,backendName:"cpu",kernelFunc:q3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s;st(r,"oneHot");const l=we(r.shape),d=new Float32Array(l*i);d.fill(c);const h=t.data.get(r.dataId).values;for(let p=0;p<l;++p)h[p]>=0&&h[p]<i&&(d[p*i+h[p]]=a);return t.makeTensorInfo([...r.shape,i],o,d)}const X3={kernelName:Ed,backendName:"cpu",kernelFunc:Q3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eu(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=gi({inputs:{input:s},backend:t}),o=Eu({inputs:{x:r},backend:t}),i=ha({inputs:{input:s},backend:t}),a=Eu({inputs:{x:i},backend:t}),c=$s({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Wg({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Y3={kernelName:qd,backendName:"cpu",kernelFunc:Eu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UC(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=gi({inputs:{input:s},backend:t}),o=UC({inputs:{x:r},backend:t}),i=ha({inputs:{input:s},backend:t}),a=Eu({inputs:{x:i},backend:t}),c=$s({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Wg({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const J3={kernelName:Ad,backendName:"cpu",kernelFunc:UC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GC(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Au({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{cf(o,d.shape,"All tensors passed to stack must have matching shapes"),E(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=Au({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=pa({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const Z3={kernelName:Rd,backendName:"cpu",kernelFunc:GC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ez(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;st(r,"pad");const a=o.map((b,v)=>b[0]+r.shape[v]+b[1]),c=o.map(b=>b[0]),l=t.data.get(r.dataId).values,d=we(r.shape),h=r.shape.length,p=pt(r.shape),f=we(a),m=a.length,g=pt(a),x=Jn(r.dtype,f);i!==0&&x.fill(i);for(let b=0;b<d;b++){const w=ya(b,h,p).map((N,C)=>N+c[C]),S=jr(w,m,g);x[S]=l[b]}return{dataId:t.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const HC={kernelName:Dd,backendName:"cpu",kernelFunc:ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tz=En((n,e)=>Math.pow(n,e)),nz=Wn(Hc,tz),sz={kernelName:Hc,backendName:"cpu",kernelFunc:nz};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.data.get(y.dataId).values),l=r.map(y=>y.shape),d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,[p,f,m]=dC(c,l,d,o.shape,o.dtype,h,i.shape),g=p.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,f);return g.concat([x])}const oz={kernelName:hb,backendName:"cpu",kernelFunc:rz};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=hC(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([d.length],s.dtype,d);return[h,p]}const az={kernelName:pb,backendName:"cpu",kernelFunc:iz};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,p=a.map(x=>t.data.get(x.dataId).values),f=a.map(x=>x.shape),[m,g]=pC(l,r.shape,d,o.shape,o.dtype,h,i.shape,p,f,c);return t.makeTensorInfo(m,o.dtype,g)}const lz={kernelName:fb,backendName:"cpu",kernelFunc:cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,a=fC(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const dz={kernelName:Bf,backendName:"cpu",kernelFunc:uz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hz=sn(qc,n=>1/n),pz={kernelName:qc,backendName:"cpu",kernelFunc:hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;st(r,"resizeBilinear");const c=pt(r.shape),[l,d]=a,[h,p,f,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(we([h,l,d,m])),y=[o&&l>1?p-1:p,o&&d>1?f-1:f],b=[o&&l>1?l-1:l,o&&d>1?d-1:d];let v=0;const w=y[0]/b[0],S=y[1]/b[1];for(let N=0;N<h;N++)for(let C=0;C<l;C++){let k;i?k=w*(C+.5)-.5:k=w*C;const I=Math.max(0,Math.floor(k)),T=k-I,_=Math.min(p-1,Math.ceil(k)),D=N*c[0]+I*c[1],P=N*c[0]+_*c[1];for(let A=0;A<d;A++){let F;i?F=S*(A+.5)-.5:F=S*A;const O=Math.max(0,Math.floor(F)),V=F-O,L=Math.min(f-1,Math.ceil(F)),H=D+O*c[2],J=P+O*c[2],X=D+L*c[2],fe=P+L*c[2];for(let be=0;be<m;be++){const oe=g[H+be],xe=g[J+be],$e=g[X+be],Le=g[fe+be],Re=oe+($e-oe)*V,ze=xe+(Le-xe)*V,Ye=Re+(ze-Re)*T;x[v++]=Ye}}}return t.makeTensorInfo([h,l,d,m],"float32",x)}const mz={kernelName:Fd,backendName:"cpu",kernelFunc:fz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;st([o,r],"resizeBilinearGrad");const a=pt(r.shape),[c,l,d,h]=r.shape,[,p,f]=o.shape,m=new Float32Array(c*l*d*h),g=[i&&p>1?l-1:l,i&&f>1?d-1:d],x=[i&&p>1?p-1:p,i&&f>1?f-1:f],y=g[0]/x[0],b=g[1]/x[1],v=t.data.get(o.dataId).values;let w=0;for(let S=0;S<c;S++){const N=S*a[0];for(let C=0;C<p;C++){const k=C*y,I=Math.floor(k),T=Math.min(Math.ceil(k),l-1),_=N+I*a[1],D=N+T*a[1],P=k-I,A=1-P;for(let F=0;F<f;F++){const O=F*b,V=Math.floor(O),L=Math.min(Math.ceil(O),d-1),H=O-V,J=1-H,X=_+V*a[2],fe=_+L*a[2],be=D+V*a[2],oe=D+L*a[2],xe=A*J,$e=A*H,Le=P*J,Re=P*H;for(let ze=0;ze<h;ze++){const Ye=v[w++];m[X+ze]+=Ye*xe,m[fe+ze]+=Ye*$e,m[be+ze]+=Ye*Le,m[oe+ze]+=Ye*Re}}}}return t.makeTensorInfo([c,d,l,h],"float32",m)}const xz={kernelName:Gf,backendName:"cpu",kernelFunc:gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;st(r,"resizeNearestNeighbor");const c=pt(r.shape),[l,d]=a,[h,p,f,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(h*l*d*m),y=[o&&l>1?p-1:p,o&&d>1?f-1:f],b=[o&&l>1?l-1:l,o&&d>1?d-1:d],v=y[0]/b[0],w=y[1]/b[1];let S=0;for(let N=0;N<h;N++){const C=N*c[0];for(let k=0;k<l;k++){const I=i?v*(k+.5):v*k;let T=Math.min(p-1,o?Math.round(I):Math.floor(I));i&&(T=Math.max(0,T));const _=C+T*c[1];for(let D=0;D<d;D++){const P=i?w*(D+.5):w*D;let A=Math.min(f-1,o?Math.round(P):Math.floor(P));i&&(A=Math.max(0,A));const F=_+A*c[2];for(let O=0;O<m;O++){const V=g[F+O];x[S++]=V}}}}return t.makeTensorInfo([h,l,d,m],r.dtype,x)}const bz={kernelName:Md,backendName:"cpu",kernelFunc:yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;st([o,r],"resizeNearestNeighborGrad");const a=pt(r.shape),c=pt(o.shape),[l,d,h,p]=r.shape,[,f,m]=o.shape,g=new Float32Array(l*d*h*p),x=t.data.get(o.dataId).values,y=[i&&f>1?d-1:d,i&&m>1?h-1:h],b=[i&&f>1?f-1:f,i&&m>1?m-1:m],v=y[0]/b[0],w=y[1]/b[1],S=1/v,N=1/w,C=Math.ceil(S)*2+2,k=Math.ceil(N)*2+2;for(let I=0;I<l;I++){const T=I*a[0];for(let _=0;_<d;_++){const D=T+_*a[1],P=Math.floor(_*S),A=Math.floor(P-C/2);for(let F=0;F<h;F++){const O=D+F*a[2],V=Math.floor(F*N),L=Math.floor(V-k/2);for(let H=0;H<p;H++){let J=0;for(let X=0;X<C;X++){const fe=X+A;if(fe<0||fe>=f)continue;const be=T+fe*c[1],oe=fe*v,xe=Math.min(d-1,i?Math.round(oe):Math.floor(oe));if(_===xe)for(let $e=0;$e<k;$e++){const Le=$e+L;if(Le<0||Le>=m)continue;const Re=be+Le*c[2],ze=Le*w,Ye=Math.min(h-1,i?Math.round(ze):Math.floor(ze));F===Ye&&(J+=x[Re+H])}}g[O+H]=J}}}}return t.makeTensorInfo(r.shape,r.dtype,g)}const vz={kernelName:Uf,backendName:"cpu",kernelFunc:wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;st(r,"reverse");const i=r.shape.length,a=Lt(o,r.shape);if(i===0)return Ur({inputs:{x:r},backend:t});const c=new Kn(r.shape,r.dtype),l=t.bufferSync(r);for(let d=0;d<c.size;d++){const h=c.indexToLoc(d),p=h.slice();a.forEach(f=>p[f]=r.shape[f]-1-p[f]),c.set(l.get(...p),...h)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}const Cz={kernelName:Od,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nz={kernelName:Jf,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=Jn(s.dtype,we(s.shape)),[l,d,h,p]=s.shape,[f,m]=Km(i,d,h),g=255,x=Math.sin(r),y=Math.cos(r),b=a.data.get(s.dataId).values;for(let w=0;w<l;w++){const S=w*h*d*p;for(let N=0;N<d;N++){const C=N*(h*p);for(let k=0;k<h;k++){const I=k*p;for(let T=0;T<p;T++){const _=[l,N,k,T],D=_[2],P=_[1];let A=(D-f)*y-(P-m)*x,F=(D-f)*x+(P-m)*y;A=Math.round(A+f),F=Math.round(F+m);let O=o;if(typeof o!="number"&&(T===3?O=g:O=o[T]),A>=0&&A<h&&F>=0&&F<d){const L=F*(h*p),H=A*p,J=S+L+H+T;O=b[J]}const V=S+C+I+T;c[V]=O}}}}return{dataId:a.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iz=sn(Xc,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),kz={kernelName:Xc,backendName:"cpu",kernelFunc:Iz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=Ii(o,r,i),p=!0,f=t.bufferSync(r),m=t.bufferSync(o),g=Jo(f,m,i,h,l,c,a,d,0,p);return t.makeTensorInfo(i,g.dtype,g.values)}const Tz={kernelName:mb,backendName:"cpu",kernelFunc:$z};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function Ez(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function Rz(n,e,t,s,r,o){const i=In("int32",t*r);for(let a=0;a<t;++a){const c=n.slice(a*s,(a+1)*s),l=a*r;for(let d=0;d<r;++d)i[l+d]=o==="left"?Az(c,e[d+l]):Ez(c,e[d+l])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dz(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=Rz(a,c,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",l)}const jz={kernelName:xb,backendName:"cpu",kernelFunc:Dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _z(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;st([s,r,o],"select");const i=s.shape.length,a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=Rs(r.dtype,o.dtype),h=Zn(we(r.shape),d);let p=0;const f=i===0||i>1||r.shape.length===1?1:we(r.shape.slice(1));for(let m=0;m<a.length;m++)for(let g=0;g<f;g++)a[m]===1?h[p++]=c[m]:h[p++]=l[m];return t.makeTensorInfo(r.shape,d,h)}const Pz={kernelName:Ld,backendName:"cpu",kernelFunc:_z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mz=oh,Fz=ih,Oz=sn(Jc,n=>n>=0?Fz*n:Mz*(Math.exp(n)-1)),Lz={kernelName:Jc,backendName:"cpu",kernelFunc:Oz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zz=sn(tl,n=>n<0?-1:n>0?1:0),Wz={kernelName:tl,backendName:"cpu",kernelFunc:zz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bz=sn(Zc,n=>Math.sin(n)),Vz={kernelName:Zc,backendName:"cpu",kernelFunc:Bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uz=sn(el,n=>Math.sinh(n)),Gz={kernelName:el,backendName:"cpu",kernelFunc:Uz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hz=11920928955078125e-23,Wx=Math.log(Hz)+2,qz=sn(sl,n=>{const e=n>-Wx,t=n<Wx,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),Kz={kernelName:sl,backendName:"cpu",kernelFunc:qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;st([r],"spaceToBatchND");const a=we(o),c=[[0,0]];c.push(...i);for(let N=1+o.length;N<r.shape.length;++N)c.push([0,0]);const l=HC.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),d=gl(l.shape,o,a,!1),h=xl(d.length,o.length,!1),p=yl(l.shape,o,a,!1),g=hn({inputs:{x:l},backend:t,attrs:{shape:d}}),b=bs({inputs:{x:g},backend:t,attrs:{perm:h}}),S=hn({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),S}const Xz={kernelName:Bd,backendName:"cpu",kernelFunc:Qz};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[h,p,f,m,g]=yC(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(p,s.dtype,h),t.makeTensorInfo([p[0]],r.dtype,f),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const Jz={kernelName:yb,backendName:"cpu",kernelFunc:Yz};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,c=Array.from(t.data.get(o.dataId).values),[l,d,h]=bC(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const eW={kernelName:bb,backendName:"cpu",kernelFunc:Zz};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=Fg(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const nW={kernelName:wb,backendName:"cpu",kernelFunc:tW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=Fg(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const rW={kernelName:vb,backendName:"cpu",kernelFunc:sW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:p}=Ii(o,r,a),f=!1,m=t.bufferSync(r);let g;switch(o.dtype){case"bool":{const x=t.bufferSync(o),y=!!t.data.get(i.dataId).values[0];g=Jo(m,x,a,p,d,l,c,h,y,f);break}case"float32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=Jo(m,x,a,p,d,l,c,h,y,f);break}case"int32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=Jo(m,x,a,p,d,l,c,h,y,f);break}case"string":{const x=t.bufferSync(o),y=No(t.data.get(i.dataId).values[0]);g=Jo(m,x,a,p,d,l,c,h,y,f);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,g.dtype,g.values)}const iW={kernelName:Sb,backendName:"cpu",kernelFunc:oW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Lt(i,r.shape)[0],c=lg(r,o,a),l=new Array(r.shape.length).fill(0),d=r.shape.slice();return c.map(h=>{const p=[...d];p[a]=h;const f=xi({inputs:{x:r},backend:t,attrs:{begin:l,size:p}});return l[a]+=h,f})}const cW={kernelName:Vd,backendName:"cpu",kernelFunc:aW};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lW={kernelName:Hf,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;st(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const c=r[a];o[a]=c*c}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uW=sn(ul,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),dW={kernelName:ul,backendName:"cpu",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:p}=s;st(r,"stridedSlice");const{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=Gm(r.shape,o,i,a,c,l,d,h,p);let S;if(g)S=hn({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){E(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const N=Bm(b,v,w),C=xi({inputs:{x:r},backend:t,attrs:{begin:b,size:N}});S=hn({inputs:{x:C},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(C)}else{const N=t.bufferSync(r),C=SC(f,N,w,b);S=t.makeTensorInfo(m,C.dtype,C.values)}return S}const pW={kernelName:Kf,backendName:"cpu",kernelFunc:hW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,p=t.data.get(d.dataId).values,f=t.data.get(h.dataId).values,[m,g]=CC(p,f,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const mW={kernelName:Cb,backendName:"cpu",kernelFunc:fW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values[0],[l,d,h]=NC(a,c,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const xW={kernelName:Nb,backendName:"cpu",kernelFunc:gW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=IC(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const bW={kernelName:Ib,backendName:"cpu",kernelFunc:yW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wW=sn(al,n=>Math.tan(n)),vW={kernelName:al,backendName:"cpu",kernelFunc:wW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SW=sn(cl,n=>Math.tanh(n)),CW={kernelName:cl,backendName:"cpu",kernelFunc:SW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NW(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:c,strides:l,outputSize:d}=Ii(o,r,s.shape),h=!1,p=t.bufferSync(r),f=t.bufferSync(o),m=t.bufferSync(s),g=Jo(p,f,s.shape,d,c,a,i,l,m,h);return t.makeTensorInfo(s.shape,g.dtype,g.values)}const IW={kernelName:gb,backendName:"cpu",kernelFunc:NW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;st(r,"tile");const i=$C(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const $W={kernelName:ll,backendName:"cpu",kernelFunc:kW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;st(r,"topk");const a=t.data.get(r.dataId).values,[c,l]=AC(a,r.shape,r.dtype,o,i);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}const AW={kernelName:Qf,backendName:"cpu",kernelFunc:TW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=t,[d,h,p,f]=r.shape,[m,g]=l??[h,p],x=[d,m,g,f],y=pt(r.shape),b=y[0],v=y[1],w=y[2],S=pt(x),N=S[0],C=S[1],k=S[2],I=Jn(r.dtype,we(x));I.fill(c);const T=s.data.get(r.dataId).values,_=s.data.get(o.dataId).values;for(let P=0;P<d;++P){const A=o.shape[0]===1?_:_.subarray(P*8,P*8+8);for(let F=0;F<m;++F)for(let O=0;O<g;++O)for(let V=0;V<f;++V){let L;const H=A[6]*O+A[7]*F+1;if(H===0)continue;const J=(A[0]*O+A[1]*F+A[2])/H,X=(A[3]*O+A[4]*F+A[5])/H,fe=Bx(J,p,a),be=Bx(X,h,a);switch(i){case"nearest":L=MW(T,h,p,b,v,w,P,be,fe,V,c);break;case"bilinear":L=FW(T,h,p,b,v,w,P,be,fe,V,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const oe=P*N+F*C+O*k+V;I[oe]=L}return s.makeTensorInfo(x,r.dtype,I)}return{dataId:s.write(I,x,r.dtype),shape:r.shape,dtype:r.dtype}}const RW={kernelName:Xf,backendName:"cpu",kernelFunc:EW};function Bx(n,e,t){switch(t){case"reflect":return DW(n,e);case"wrap":return jW(n,e);case"nearest":return PW(n,e);case"constant":default:return _W(n)}}function DW(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return ri(0,t,e-1)}function jW(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return ri(0,t,e-1)}function _W(n,e){return n}function PW(n,e){return ri(0,n,e-1)}function Ua(n,e,t,s,r,o,i,a,c,l,d){const h=i*s+a*r+c*o+l;return 0<=a&&a<e&&0<=c&&c<t?n[h]:d}function MW(n,e,t,s,r,o,i,a,c,l,d){const h=Math.round(a),p=Math.round(c);return Ua(n,e,t,s,r,o,i,h,p,l,d)}function FW(n,e,t,s,r,o,i,a,c,l,d){const h=Math.floor(a),p=Math.floor(c),f=h+1,m=p+1,g=(m-c)*Ua(n,e,t,s,r,o,i,h,p,l,d)+(c-p)*Ua(n,e,t,s,r,o,i,h,m,l,d),x=(m-c)*Ua(n,e,t,s,r,o,i,f,p,l,d)+(c-p)*Ua(n,e,t,s,r,o,i,f,m,l,d);return(f-a)*g+(a-h)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;st(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:c,indices:l}=EC(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const LW={kernelName:Yf,backendName:"cpu",kernelFunc:OW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],c=new Array(i-1);let l=0;for(let f=0;f<i;f++)f!==o&&(c[l++]=r.shape[f]);const d=new Array(i).fill(0),h=r.shape.slice();h[o]=1;const p=new Array(a);for(let f=0;f<p.length;f++){d[o]=f;const m=xi({inputs:{x:r},backend:t,attrs:{begin:d,size:h}});p[f]=hn({inputs:{x:m},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(m)}return p}const WW={kernelName:Gd,backendName:"cpu",kernelFunc:zW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;st(r,"unsortedSegmentSum");const a=r.shape.length,c=o.shape.length,l=[],d=[],h=a-c;let p=o;for(let m=0;m<h;++m){const g=Au({inputs:{input:p},backend:t,attrs:{dim:m+1}});p=g,d.push(g)}for(let m=0;m<i;++m){const g=Ro(m,"int32"),x=t.makeTensorInfo([],"int32",g),y=GS({inputs:{a:x,b:p},backend:t}),b=Ao({inputs:{x:y},backend:t,attrs:{dtype:"float32"}}),v=bh({inputs:{a:b,b:r},backend:t}),w=$l({inputs:{x:v},backend:t,attrs:{axis:0,keepDims:!1}});l.push(w),d.push(x),d.push(y),d.push(b),d.push(v),d.push(w)}const f=GC({inputs:l,backend:t,attrs:{axis:0}});return d.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}const VW={kernelName:Hd,backendName:"cpu",kernelFunc:BW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW=[OF,yM,zF,BF,NM,UF,HF,KF,XF,JF,eO,nO,rO,aO,lO,hO,fO,gO,yO,MF,wO,SO,NO,kM,kO,SM,TM,TO,bM,EO,DO,jO,PO,FO,LO,WO,VO,GO,qO,QO,YO,ZO,tL,sL,rL,iL,cL,uL,dL,hL,pL,mL,yL,AF,wL,AM,TL,EM,AL,DM,PL,ML,OL,_M,MM,zL,BL,UL,HL,OM,zM,wM,KL,RO,XL,JL,e3,EF,BM,UM,n3,HM,r3,a3,l3,h3,f3,g3,x3,KM,b3,v3,C3,I3,$3,A3,R3,XM,j3,M3,L3,JM,eF,B3,G3,K3,nF,X3,J3,Z3,HC,sz,DF,oF,oz,az,lz,dz,vM,Gp,pz,jF,_F,PF,mz,xz,bz,vz,Cz,Nz,kz,pF,Tz,jz,Pz,Lz,mF,Wz,Vz,Gz,gF,F3,Kz,Xz,Jz,eW,nW,rW,iW,cW,bF,lW,vF,CF,dW,pW,mW,xW,bW,$F,gL,vW,CW,IW,$W,AW,RW,sF,LW,WW,VW,Y3];for(const n of UW)$b(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ko={},Wl={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function GW(n,e){Ko[n]=e}function wr(n,e){if(!(n in Ko)||e!=null){const s=qW(n,e);if(s!==null)Ko[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Ko[n];return t==null||t.isContextLost()?(delete Ko[n],wr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ko[n])}function HW(n){if(!he().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function qW(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??HW(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Ko[n]},!1),he().getBool("SOFTWARE_WEBGL_ENABLED")&&(Wl.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Wl)||t.getContext("experimental-webgl",Wl):t.getContext("webgl2",Wl)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ac;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(ac||(ac={}));var Fs;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Fs||(Fs={}));var qn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qn||(qn={}));function Tl(n,e){return[e,n]}function KW(n,e){return n*e}function Bl(n){const e=we(n),t=Math.ceil(e/4);return pp(t)}function Ia(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function QW(n,e){const[t,s]=Ia(n,e);return t*s*4}function Bg(n,e){const t=n;let s,r,o,i,a,c,l,d,h,p;return he().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,l=4,d=1,h=t.HALF_FLOAT,p=t.FLOAT,c=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,l=4,d=4,h=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,c=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qe(n,e){const t=e();return he().getBool("DEBUG")&&XW(n),t}function XW(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+e4(n,e))}const YW=596e-10,JW=65504;function ZW(n){return!!(he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||YW<Math.abs(n)&&Math.abs(n)<JW)}function e4(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Vl(n,e){return ao(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function t4(n,e){const t=ao(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Qe(n,()=>n.shaderSource(t,e)),Qe(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function n4(n,e){const t=ao(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Qe(n,()=>n.shaderSource(t,e)),Qe(n,()=>n.compileShader(t)),he().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw qC(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const s4=/ERROR: [0-9]+:([0-9]+):/g;function qC(n,e){const t=s4.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((h,p)=>qi((p+1).toString(),o)+h);let a=0;for(let h=0;h<i.length;h++)a=Math.max(i[h].length,a);const c=i.slice(0,s-1),l=i.slice(s-1,s),d=i.slice(s);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${qi(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function r4(n){return ao(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function o4(n,e){if(Qe(n,()=>n.linkProgram(e)),!he().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Jh(n,e){if(Qe(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function i4(n,e){const t=ao(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Qe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Qe(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function a4(n,e){const t=ao(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Qe(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Qe(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function c4(n){return ao(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function l4(n,e){const t=he().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function u4(n){return ao(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Vx(n,e,t,s,r,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Qe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Qe(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Qe(n,()=>n.enableVertexAttribArray(a)),!0)}function d4(n,e,t){g4(n,t),Qe(n,()=>n.activeTexture(n.TEXTURE0+t)),Qe(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function h4(n,e,t){return ao(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function p4(n,e,t){return n.getUniformLocation(e,t)}function f4(n,e,t,s){Qe(n,()=>d4(n,e,s)),Qe(n,()=>n.uniform1i(t,s))}function Zh(n,e,t){Qe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Qe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function Ux(n,e){Qe(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Qe(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Ul(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+m4(n,e))}function m4(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ao(n,e,t){const s=Qe(n,()=>e());if(s==null)throw new Error(t);return s}function g4(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function fa(n,e=2){return we(n.slice(0,n.length-e))}function ma(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Gl(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[fa(n),...ma(n)]),e}function x4(n,e=!1){let t=he().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=he().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&he().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,c)=>c>=n.length-2?af(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Eo(n).newShape);let r=we(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=fa(n);let c=2,l=2;n.length&&([c,l]=ma(n)),r=a*(c/2)*(l/2),o=pp(r).map(d=>d*2)}else o=pp(r);return o}function Hl(n){return n%2===0}function Ru(n,e){if(n=n.slice(-2),e=e.slice(-2),Jt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Hl(t)&&Hl(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Hl(n[0])&&Hl(e[0])}let ep,tp;function y4(n){if(ep==null){const e=wr(n);ep=e.getParameter(e.MAX_TEXTURE_SIZE)}return ep}function b4(n){if(tp==null){const e=wr(n);tp=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,tp)}function w4(n){if(n===0)return 0;let e;const t=wr(n);return Js(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Js(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Js(n,e){return n.getExtension(e)!=null}function Gx(n){try{if(wr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function v4(n){if(n===0)return!1;const e=wr(n);if(n===1){if(!Js(e,"OES_texture_float"))return!1}else if(!Js(e,"EXT_color_buffer_float"))return!1;return qp(e)}function S4(n){if(n===0)return!1;const e=wr(n);if(n===1){if(!Js(e,"OES_texture_float")||!Js(e,"WEBGL_color_buffer_float"))return!1}else{if(Js(e,"EXT_color_buffer_float"))return qp(e);const s="EXT_color_buffer_half_float";if(Js(e,s)){const r=e.getExtension(s);return C4(e,r)}return!1}return qp(e)}function qp(n){const e=Bg(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function C4(n,e){const t=Bg(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function N4(n){return n!==2?!1:wr(n).fenceSync!=null}function Al(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&E(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rt=he();rt.registerFlag("HAS_WEBGL",()=>rt.getNumber("WEBGL_VERSION")>0);rt.registerFlag("WEBGL_VERSION",()=>Gx(2)?2:Gx(1)?1:0);rt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);rt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>rt.get("WEBGL_VERSION")===2);rt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);rt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);rt.registerFlag("WEBGL_PACK",()=>rt.getBool("HAS_WEBGL"));rt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_CLIP",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_REDUCE",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_LAZILY_UNPACK",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_CONV_IM2COL",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>rt.getBool("WEBGL_PACK"));rt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>y4(rt.getNumber("WEBGL_VERSION")));rt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>b4(rt.getNumber("WEBGL_VERSION")));rt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=rt.getNumber("WEBGL_VERSION");return n===0?0:w4(n)});rt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>rt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Ub());rt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>v4(rt.getNumber("WEBGL_VERSION")));rt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>rt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:rt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));rt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>S4(rt.getNumber("WEBGL_VERSION")));rt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>N4(rt.getNumber("WEBGL_VERSION")));rt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>rt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);rt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});rt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Ub()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});rt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);rt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);rt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);rt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);rt.registerFlag("WEBGL_EXP_CONV",()=>!1);rt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>rt.getBool("IS_TEST"));rt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);rt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);rt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);rt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function us(){let n,e,t,s,r,o,i,a,c,l;return he().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=he().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ti(n,e,t="index"){const s=pt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function wh(n,e,t="index"){const s=pt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function I4(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function k4(n,e,t="index"){const s=n.map((o,i)=>i),r=I4(s,e);return r.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${r[i]}`,c=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${c};`}).join("")}function Vg(n){const e=pt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Ug(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const KC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:QC}=dD;function $4(n,e,t){const s=[];if(n.forEach(f=>{const m=we(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${m>1?`[${m}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),t.enableShapeUniforms){const{uniformShape:g}=Gg(t.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(f=>T4(f,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=us(),c=R4(a);let l,d,h=_4(a);return e.isPacked?(l=A4(e.logicalShape,i,t.enableShapeUniforms),d=j4(a)):(l=E4(e.logicalShape,i,t.enableShapeUniforms),d=D4(a)),t.packedInputs&&(h+=O4),[h,c,d,r,l,o,t.userCode].join(`
`)}function ka(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return X4(n,e);case 1:return J4(n,e);case 2:return eB(n,e);case 3:return nB(n,e);case 4:return rB(n,e);case 5:return oB(n);case 6:return iB(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function XC(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return Q4(n);case 1:return Y4(n,e);case 2:return Z4(n,e);case 3:return tB(n,e);default:return sB(n,e)}}function T4(n,e,t=!1,s){let r="";t?r+=XC(n,s):r+=ka(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=aB(n,e):r+=cB(n,e)),r}function A4(n,e,t){switch(n.length){case 0:return YC();case 1:return L4(n,e,t);case 2:return q4(n,e,t);case 3:return W4(n,e,t);default:return V4(n,e,t)}}function E4(n,e,t){switch(n.length){case 0:return YC();case 1:return z4(n,e,t);case 2:return K4(n,e,t);case 3:return B4(n,e,t);case 4:return U4(n,e,t);case 5:return G4(n,e);case 6:return H4(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function R4(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function D4(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function j4(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function _4(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${P4}
    ${M4}
    ${F4}
  `}const P4=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,M4=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,F4=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,O4=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function YC(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function L4(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function z4(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function W4(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function B4(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${wh(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Ti(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function V4(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",c="b, r, c";for(let l=2;l<n.length-1;l++)i*=n[n.length-l-1],a=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+a,c=`b${l}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${c});
    }
  `}function U4(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${wh(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ti(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function G4(n,e){const t=Ti(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function H4(n,e){const t=Ti(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function q4(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Jt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function K4(n,e,t){return Jt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ai(n){return`offset${n}`}function Q4(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=us();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function X4(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Ai(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,c]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function Y4(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=us();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function J4(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${$a(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ai(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function Z4(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],c=us();if(o!=null&&Jt(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function eB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&Jt(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=o[0],f=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Eo(t),c=i;if(c.length<t.length){const p=Ta(n,c),f=["row","col"];return`
      ${ka(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Aa(f,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${$a(n)}
      }
    `;const l=o[0],d=o[1],h=Ai(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function tB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const p=t.slice(1),f=[1,2],m=Ta(n,p),g=["b","row","col"];return`
        ${XC(m,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Aa(g,f)});
        }
      `}const a=us();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const c=i[0],l=i[1],d=Math.ceil(t[2]/2),h=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function nB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:c}=Eo(t),l=a;if(l.length<t.length){const g=Ta(n,l),x=["row","col","depth"];return`
        ${ka(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Aa(x,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${$a(n)}
      }
    `;const d=n.shapeInfo.texShape,h=d[0],p=d[1],f=n.shapeInfo.flatOffset;if(p===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const m=Ai(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function sB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=us();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],d=c[1],h=Math.ceil(o[i-1]/2);let p=h*Math.ceil(o[i-2]/2),f="int b, int row, int col",m=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<i-1;g++)f=`int b${g}, `+f,p*=o[i-g-1],m=`b${g} * ${p} + `+m;return`
    vec4 ${s}(${f}) {
      int index = ${m};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${l});
      return ${r.texture2D}(${t}, uv);
    }
  `}function rB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:c,keptDims:l}=Eo(t);if(c.length<t.length){const b=Ta(n,c),v=["row","col","depth","depth2"];return`
      ${ka(b,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Aa(v,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${$a(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,p=h[0],f=h[1],m=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${m}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Ai(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${p}, ${f}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function oB(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:c,keptDims:l}=Eo(e);if(c.length<e.length){const g=Ta(n,c),x=["row","col","depth","depth2","depth3"];return`
      ${ka(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Aa(x,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${$a(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,p=h[0],f=h[1];if(f===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(f===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const m=Ai(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${t}, uv);
    }
  `}function iB(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=Eo(e);if(r.length<e.length){const x=Ta(n,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${ka(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Aa(y,o)});
      }
    `}const i=e[5],a=e[4]*i,c=e[3]*a,l=e[2]*c,d=e[1]*l;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${$a(n)}
      }
    `;const h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,f=p[0],m=p[1];if(m===d&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(m===i&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const g=Ai(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${t}, uv);
    }
  `}function $a(n){const e=n.name,t=we(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function aB(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=QC(n.shapeInfo.logicalShape,e.logicalShape),c=on(i),l=i-o;let d;const h=["x","y","z","w","u","v"];o===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(b=>`coords.${h[b+l]} = 0;`).join(`
`);let p="";i<2&&o>0?p="coords":p=n.shapeInfo.logicalShape.map((b,v)=>`coords.${h[v+l]}`).join(", ");let f="return outputValue;";const g=we(n.shapeInfo.logicalShape)===1,y=we(e.logicalShape)===1;if(o===1&&!g&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)i===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=o-2,v=o-1;a.indexOf(b)>-1&&a.indexOf(v)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${f}
    }
  `}function cB(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===c&&n.shapeInfo.flatOffset==null&&Jt(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const l=on(c),d=QC(n.shapeInfo.logicalShape,e.logicalShape),h=c-a;let p;const f=["x","y","z","w","u","v"];a===0?p="":c<2&&d.length>=1?p="coords = 0;":p=d.map(g=>`coords.${f[g+h]} = 0;`).join(`
`);let m="";return c<2&&a>0?m="coords":m=n.shapeInfo.logicalShape.map((g,x)=>`coords.${f[x+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${p}
      return get${s}(${m});
    }
  `}function on(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Gg(n,e,t){const{newShape:s,keptDims:r}=Eo(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):s,c=!n&&o>1&&!Jt(e,t)&&s.length<o||i;return{useSqueezeShape:c,uniformShape:c?a:e,keptDims:r}}function Ta(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Aa(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n,e,t,s){const r=t.map((d,h)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:p}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=$4(r,i,e),c=n4(n.gl,a),l=n.createProgram(c);return he().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i},JC(n,e,l)))}function JC(n,e,t){const s=[],r=[];let o,i,a,c=null,l=null;l=n.getUniformLocation(t,"NAN",!1),he().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const h of e.variableNames){const p={name:h,uniform:n.getUniformLocation(t,h,d),offset:n.getUniformLocation(t,`offset${h}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${h}Shape`,d),p.texShape=n.getUniformLocation(t,`${h}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),i=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const h of e.customUniforms)r.push(n.getUniformLocation(t,h.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:c,nanLoc:l,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function Hx(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!Jt(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,c=o.isUniform?null:o.texData.texShape;if(!Jt(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function uB(n,e,t,s,r){e.program.enableShapeUniforms||(Hx(e.inShapeInfos,t),Hx([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),he().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){const l=t[c],{uniform:d,offset:h,shape:p,texShape:f}=e.variablesLocations[c];if(p){const{uniformShape:m}=Gg(e.program.packedInputs,l.shape,l.texData.texShape);switch(m.length){case 1:n.gl.uniform1iv(p,new Int32Array(m));break;case 2:n.gl.uniform2iv(p,new Int32Array(m));break;case 3:n.gl.uniform3iv(p,new Int32Array(m));break;case 4:n.gl.uniform4iv(p,new Int32Array(m));break}}if(f&&n.gl.uniform2i(f,l.texData.texShape[0],l.texData.texShape[1]),d!=null){if(l.isUniform){if(we(l.shape)<2)n.gl.uniform1f(d,l.uniformValues[0]);else{let m=l.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),n.gl.uniform1fv(d,m)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,d,c)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const c=pt(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const l=e.program.customUniforms[c],d=e.customUniformLocations[c],h=r[c];if(l.type==="float")n.gl.uniform1fv(d,h);else if(l.type==="vec2")n.gl.uniform2fv(d,h);else if(l.type==="vec3")n.gl.uniform3fv(d,h);else if(l.type==="vec4")n.gl.uniform4fv(d,h);else if(l.type==="int")n.gl.uniform1iv(d,h);else if(l.type==="ivec2")n.gl.uniform2iv(d,h);else if(l.type==="ivec3")n.gl.uniform3iv(d,h);else if(l.type==="ivec4")n.gl.uniform4iv(d,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function dB(n,e,t){let s="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const c=i.texData.texShape,{useSqueezeShape:l,uniformShape:d,keptDims:h}=Gg(n.packedInputs,i.shape,c);let p="",f="",m="";if(d.length===1&&n.packedInputs){const S=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];p=`${S[0]>1}_${S[1]>1}`}else if(d.length===2&&!n.packedInputs)f=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const S=pt(d);m=`${S[0]===c[1]}_${S[S.length-1]===c[1]}`}const g=i.shape.length,x=d.length===2&&Jt(i.shape,c),y=we(i.shape)===1,b=aa(i.shape,t.shape),v=!n.packedInputs&&g===t.shape.length&&Jt(c,t.texData.texShape),w=n.packedInputs||d.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${g}_${v}_${l?h:""}_${d.length}_${y}_${b}_${x}_${p}_${f}_${m}_${w}_${a}`}else{const c=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${c}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${he().getNumber("WEBGL_VERSION")}`,o}function ss(n){return he().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hB{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ac.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=us();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?wh(["r","c","d"],e):Ti(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pB{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ac.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=us();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?wh(["r","c","d"],e):Ti(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fB{constructor(e){this.variableNames=["A"],this.outTexUsage=Fs.DOWNLOAD;const t=us();this.outputShape=e,this.userCode=`
      ${KC}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mB{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Fs.DOWNLOAD;const t=us();this.outputShape=e,this.userCode=`
      ${KC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gB={R:0,G:1,B:2,A:3};class qx{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=us();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const c=s[a];i+=`
          if(offset == ${a}) {
            result = values[${gB[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Ug():Vg(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xB{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=us();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const c=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Ug():Vg(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n){const e=us(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return t4(n,t)}function bB(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return i4(n,e)}function wB(n){const e=new Uint16Array([0,1,2,2,1,3]);return a4(n,e)}function El(n,e,t,s,r,o){l4(e,t);const i=c4(n),a=n.TEXTURE_2D;return Qe(n,()=>n.bindTexture(a,i)),Qe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Qe(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Qe(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Qe(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),he().getNumber("WEBGL_VERSION")===1?Qe(n,()=>n.texImage2D(a,0,s,e,t,0,r,o,null)):Qe(n,()=>n.texStorage2D(a,1,s,e,t)),Qe(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function ZC(n){return n.internalFormatFloat}function vB(n,e,t,s){const[r,o]=Tl(e,t);return El(n,r,o,ZC(s),s.textureFormatFloat,n.FLOAT)}function eN(n){return n.internalFormatHalfFloat}function SB(n,e,t,s){const[r,o]=Tl(e,t);return El(n,r,o,eN(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function tN(n){return n.downloadTextureFormat}function CB(n,e,t,s){const[r,o]=Tl(e,t);return El(n,r,o,tN(s),n.RGBA,n.UNSIGNED_BYTE)}function nN(n){return n.internalFormatPackedFloat}function NB(n,e,t,s){const[r,o]=Ia(e,t);return El(n,r,o,nN(s),n.RGBA,n.FLOAT)}function sN(n){return n.internalFormatPackedHalfFloat}function IB(n,e,t,s){const[r,o]=Ia(e,t);return El(n,r,o,sN(s),n.RGBA,s.textureTypeHalfFloat)}function kB(n,e,t){return Qe(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Vx(n,e,"clipSpacePos",t,3,20,0)&&Vx(n,e,"uv",t,2,20,12)}function $B(n,e,t,s,r,o){Qe(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,c;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,c=n.RGBA):(i=new Float32Array(t*s*4),a=n.FLOAT,c=o.internalFormatPackedFloat),i.set(r),he().getNumber("WEBGL_VERSION")===2?Qe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,i)):Qe(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,t,s,0,n.RGBA,a,i)),Qe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function TB(n,e,t){Qe(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?he().getNumber("WEBGL_VERSION")===2?Qe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Qe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):he().getNumber("WEBGL_VERSION")===2?Qe(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Qe(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Qe(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function AB(n,e,t,s){const r=n.createBuffer();Qe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Qe(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Qe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Qe(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function EB(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function RB(n,e,t,s){const[r,o]=Tl(e,t),i=4,a=new Uint8Array(KW(e*t,i));return Qe(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function DB(n,e,t,s,r,o,i,a){const c=n,l=new Float32Array(QW(o,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function jB(n,e,t){const s=new Float32Array(e*t*4);return Qe(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class np{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=he().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,GW(t,e)):this.gl=wr(t),e=this.gl,he().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Qe(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Qe(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Qe(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Qe(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Qe(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Qe(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Qe(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Qe(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),he().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Vl(this.gl,o),Js(this.gl,i))this.textureHalfFloatExtension=Vl(this.gl,i);else if(he().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Js(this.gl,r))this.colorBufferHalfFloatExtension=Vl(this.gl,r);else if(he().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Js(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Js(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=bB(this.gl),this.indexBuffer=wB(this.gl),this.framebuffer=u4(this.gl),this.textureConfig=Bg(this.gl,this.textureHalfFloatExtension)}get debug(){return he().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Qe(e,()=>e.finish()),Qe(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Qe(e,()=>e.deleteFramebuffer(this.framebuffer)),Qe(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Qe(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Qe(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),vB(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),SB(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),CB(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),TB(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),$B(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),IB(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),NB(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Ux(this.gl,this.framebuffer),this.outputTexture=null),Qe(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>RB(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return DB(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return EB(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=AB(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(he().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>jB(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=yB(t));const s=r4(t);Qe(t,()=>t.attachShader(s,this.vertexShader)),Qe(t,()=>t.attachShader(s,e)),o4(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Jh(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Qe(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),kB(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Qe(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Jh(this.gl,this.program),Qe(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?h4(this.gl,e,t):p4(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Qe(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),f4(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=Ia(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Jh(this.gl,this.program),Ul(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Qe(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Qe(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Vl(this.gl,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await D0(()=>this.disposed||this.isQueryAvailable(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=_B(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in he().platform&&(s=he().platform.setTimeoutCustom.bind(he().platform)),D0(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Zh(this.gl,e,this.framebuffer),this.debug&&Ul(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Zh(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ul(this.gl)):Ux(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;Zh(r,e,this.framebuffer),this.debug&&Ul(r),this.outputTexture=e,Qe(r,()=>r.viewport(0,0,t,s)),Qe(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Qe(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function _B(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:PB,bincountImpl:rN,bincountReduceImpl:MB,bitwiseAndImpl:FB,castImpl:OB,ceilImpl:LB,concatImpl:zB,equalImpl:WB,expImpl:BB,expm1Impl:VB,floorImpl:UB,gatherNdImpl:GB,gatherV2Impl:HB,greaterImpl:qB,greaterEqualImpl:KB,lessImpl:QB,lessEqualImpl:XB,linSpaceImpl:YB,logImpl:JB,maxImpl:ZB,maximumImpl:e5,minimumImpl:t5,multiplyImpl:n5,negImpl:s5,notEqualImpl:r5,prodImpl:o5,raggedGatherImpl:i5,raggedRangeImpl:a5,raggedTensorToTensorImpl:c5,rangeImpl:l5,rsqrtImpl:u5,scatterImpl:d5,sigmoidImpl:h5,simpleAbsImpl:oN,sliceImpl:p5,sparseFillEmptyRowsImpl:f5,sparseReshapeImpl:m5,sparseSegmentReductionImpl:iN,sqrtImpl:g5,staticRegexReplaceImpl:x5,stridedSliceImpl:y5,stringNGramsImpl:b5,stringSplitImpl:w5,stringToHashBucketFastImpl:v5,subImpl:S5,tileImpl:C5,topKImpl:N5,transposeImpl:Hg,uniqueImpl:I5}=TF;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function as(n,e){return e===1?[n]:aN(n,e)}function k5(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $5{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ss(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=as("rc",this.rank),s=on(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${T5(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Ug():Vg(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function T5(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?k4(["r","c","d"],"inputShape"):Ti(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A5{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=Qx(t,s),o=Xx(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=Kx(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const c=this.freeTextures[o].pop();return this.usedTextures[o].push(c),c}let a;return r===qn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===qn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===qn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=Qx(s,r),i=Xx(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=Kx(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=he().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[i],d=l&&l.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[d]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function E5(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function Kx(n,e,t,s,r){const o=R5(e,s);let i;if(r){const[c,l]=Ia(n[0],n[1]);i=c*l}else{const[c,l]=Tl(n[0],n[1]);i=c*l}const a=E5(t,o);return i*a}function R5(n,e){switch(n){case qn.PACKED_2X2_FLOAT32:return nN(e);case qn.PACKED_2X2_FLOAT16:return sN(e);case qn.UNPACKED_FLOAT32:return ZC(e);case qn.UNPACKED_FLOAT16:return eN(e);case qn.PACKED_4X1_UNSIGNED_BYTE:return tN(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function D5(n){return he().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qn.PACKED_2X2_FLOAT32:qn.UNPACKED_FLOAT32:n?qn.PACKED_2X2_FLOAT16:qn.UNPACKED_FLOAT16}function Qx(n,e){if(n===Fs.UPLOAD)return qn.PACKED_2X2_FLOAT32;if(n===Fs.RENDER||n==null)return D5(e);if(n===Fs.DOWNLOAD||n===Fs.PIXELS)return qn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function Xx(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const sr="if (isnan(x)) return x;",j5="return x;",Yx="return abs(x);",_5="return (x >= 0.0) ? x : (exp(x) - 1.0);",P5=sr+`
  return (x < 0.0) ? 0.0 : x;
`,M5=sr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,fo="return x;",F5="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O5="return x;",L5=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,z5=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,W5=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,B5="return 1.0 / (1.0 + exp(-1.0 * x));";class xo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V5{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);const t=e.length,s=as("rc",t),r=on(t),o=k5(t,s),i=s.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U5=Rw,G5=1e-7,H5=1e-4,ql={};function q5(n){return n in ql||(ql[n]={}),ql[n]}const K5=he().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Q5=600;function X5(){return he().global.screen==null?1024:he().global.screen.height*he().global.screen.width*window.devicePixelRatio*Q5/1024/1024}class vh extends of{nextDataId(){return vh.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!he().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof np)t=e;else{const s=wr(he().getNumber("WEBGL_VERSION"),e);t=new np(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=wr(he().getNumber("WEBGL_VERSION"));t=new np(s),this.binaryCache=q5(he().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new A5(this.gpgpu),this.numMBBeforeWarning=X5(),this.texData=new Jy(this,Ir())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,i){const a=this.makeTensorInfo(t,s),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,o]},c.texShape=[r,o];const l=Gl(t),d=new qx(l,!1,i),h=this.runWebGLProgram(d,[a],s,[[r,o]]);return h.shape=t,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,t,s){if((he().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||he().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Fs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(he().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Fs.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:c}=t;if(i!=null){let p;c?p=new xo(a,fo):p=new Rr(a,fo);const f=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),m=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),m}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const l=this.activeTimers!=null;let d;l&&(d=hs());let h;if(r==="complex64"){const p=this.readSync(o.real.dataId),f=this.readSync(o.imag.dataId);h=to(p,f)}else h=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=hs()-d),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:c}=t;if(o!=null){let m;c?m=new xo(r,fo):m=new Rr(r,fo);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:i}],i),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(he().getBool("DEBUG")&&!he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&he().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,d;if(i!=="complex64"&&he().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const m=this.texData.get(d.dataId);l=this.gpgpu.createBufferFromTexture(m.texture.texture,...Bl(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=m[0],x=m[1];h=to(g,x)}else if(l==null)h=this.getValuesFromTexture(e);else{const m=we(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,m)}if(d!=null&&this.disposeIntermediateTensorInfo(d),l!=null){const m=this.gpgpu.gl;Qe(m,()=>m.deleteBuffer(l))}const p=this.convertAndCacheOnCPU(e,h),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(m=>m(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ir().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:c,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let f;c?f=new xo(o,fo):f=new Rr(o,fo);const m=this.runWebGLProgram(f,[{dataId:e,shape:o,dtype:a}],a),g=this.readToGPU(m,t);return this.disposeIntermediateTensorInfo(m),g}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),h=Ir().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:h},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>No(r));return Ot(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ot(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!ZW(s))throw he().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=we(t);if(he().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),f=this.texData.get(p.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...Bl(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(p),m}const i=he().getBool("WEBGL_PACK")&&r===!0,a=i?Gl(t):t,c=i?new mB(a):new fB(a),l=this.runWebGLProgram(c,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=oi(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),i=oi(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(o);a.kernelMs=mk(c),a.getExtraProfileInfo=()=>c.map((l,d)=>({name:i[d],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:hs(),endMs:null}}endTimer(e){return he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=hs(),e)}async getQueryTime(e){if(he().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),c=a&&a.origDataId||e,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=K5){return he().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&we(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Ms("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return U5(e.shape,t)}packedUnaryOp(e,t,s){const r=new xo(e.shape,t),o=this.compileAndRun(r,[e],s);return Ir().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=oN(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(he().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Yx,e.dtype);const t=new Rr(e.shape,Yx),s=this.compileAndRun(t,[e]);return Ir().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&mc(s[0])){const o=s.map(i=>bo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return Ir().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new V5(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new $5(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[fa(e.shape),...ma(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[fa(t),...ma(t)],i=new cN(o,s),a=!0,c=[s],l=this.runWebGLProgram(i,[r],e.dtype,c,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const p=we(o),f=t[0]*t[1]*4;E(p<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Gl(o);let c;r?c=new pB(a):c=new hB(a);const l=!0,d=[t??Bl(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:i,dataId:e}],i,d,l,t);return{dtype:i,shape:o,dataId:h.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),c=this.texData.get(a.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===ac.DENSE){const y=i??Bl(e.outputShape);c.texShape=y.map(b=>b*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),we(a.shape)===0)return c.values=Jn(a.dtype,0),a;const l=[],d=t.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!e.packedInputs&&we(y.shape)<=he().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!e.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!Ru(b.shape,y.shape)){const v=y,w=y.shape;y.shape=b.shape,y=this.packedReshape(y,w),l.push(y),b=this.texData.get(y.dataId),v.shape=w}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},p=dB(e,d,h),f=this.getAndSaveBinary(p,()=>lB(this.gpgpu,e,d,h)),m=this.activeTimers!=null;let g;m&&(g=this.startTimer()),he().get("ENGINE_COMPILE_ONLY")||uB(this.gpgpu,f,d,h,r),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=he().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const y=hs();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!he().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(he().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ae(()=>{if(!he().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=he().getBool("DEBUG");he().set("DEBUG",!1);const t=this.abs(Yt(1e-8)).dataSync()[0];if(he().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?G5:H5}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:c}=t;if(i!=null)return;const l=this.activeTimers!=null;let d;l&&(d=hs());let h=t.texShape;if(h==null&&(h=x4(s,c),t.texShape=h),o!=null){const p=Gl(s);let f,m=h[1],g=h[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(c||!x)&&([m,g]=Ia(h[0],h[1])),c?f=new xB(p,x):f=new qx(p,x);const y=x?[g,m]:h,b=this.makeTensorInfo(y,r),v=this.texData.get(b.dataId);x?v.usage=Fs.PIXELS:v.usage=Fs.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,g,o);const w=[[g,m]],N=this.runWebGLProgram(f,[b],r,w,!0),C=this.texData.get(N.dataId);t.texShape=C.texShape,t.isPacked=C.isPacked,t.usage=C.usage,he().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(t.texture=C.texture,t.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=hs()-d)}else{const p=this.acquireTexture(h,a,r,c);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=Y5(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*ru(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Xw(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(qC(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:c}=JC(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,c=Ir().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(r,t,s,o,i,a);return Ir().makeTensorFromDataId(l,t,s,c)}}vh.nextDataId=0;function Y5(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Gb()&&Kb("webgl",()=>new vh,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qg=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class yi{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=At(t,s),this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ei=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Ea{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=At(t,s);const o=this.outputShape.length;this.enableShapeUniforms=ss(o);let i="";if(r)if(o===0||we(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${on(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=as("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const J5={kernelName:Mc,backendName:"webgl",kernelFunc:js};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zo(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),a=js({inputs:{x:s},backend:t}),c=js({inputs:{x:r},backend:t});return i.complexTensorInfos={real:a,imag:c},o}const Z5={kernelName:bf,backendName:"webgl",kernelFunc:zo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lN="return (a < 0.) ? b * a : a;",uN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function eV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",Ro(o,"float32")),a=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ea(uN,r.shape,i.shape):new yi(lN,r.shape,i.shape),c=t.runWebGLProgram(a,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),c}const tV={kernelName:fd,backendName:"webgl",kernelFunc:eV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dN="return (a < 0.) ? b * a : a;",hN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function nV(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ea(hN,s.shape,r.shape):new yi(dN,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const sV={kernelName:jd,backendName:"webgl",kernelFunc:nV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ra="if (isnan(x)) return x;";function qt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,c=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const h=a.texData.get(i.dataId),p=t(h.values,c);return a.makeTensorInfo(i.shape,c,p)}const l=he().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return l?d=new xo(i.shape,e):d=new Rr(i.shape,n),a.runWebGLProgram(d,[i],c)}}function Yn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:c,b:l}=i,d=a;if(s&&c.dtype==="complex64"){const m=d.texData.get(c.dataId),g=d.texData.get(l.dataId),[x,y]=[[m.complexTensorInfos.real,g.complexTensorInfos.real],[m.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[w,S]=v,N={dataId:w.dataId,dtype:w.dtype,shape:c.shape},C={dataId:S.dataId,dtype:S.dtype,shape:l.shape},k=new yi(n,c.shape,l.shape);return d.runWebGLProgram(k,[N,C],Rs(w.dtype,S.dtype))}),b=zo({inputs:{real:x,imag:y},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(y),b}const h=o||Rs(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||d.shouldExecuteOnCPU([c,l]))&&r!=null){const m=d.texData.get(c.dataId).values,g=d.texData.get(l.dataId).values,x=c.dtype==="string"?no(m):m,y=c.dtype==="string"?no(g):g,[b,v]=r(c.shape,l.shape,x,y,h),w=d.makeTensorInfo(v,h),S=d.texData.get(w.dataId);return S.values=b,w}const p=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return p?f=new Ea(e,c.shape,l.shape,t):f=new yi(n,c.shape,l.shape),d.runWebGLProgram(f,[c,l],h)}}function cc(n,e=!1){if(n==="linear")return e?O5:j5;if(n==="relu")return e?z5:P5;if(n==="elu")return e?L5:_5;if(n==="relu6")return e?W5:M5;if(n==="prelu")return e?hN:dN;if(n==="leakyrelu")return e?uN:lN;if(n==="sigmoid")return e?B5:F5;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pN{constructor(e,t,s,r=!1,o=!1,i=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ss(this.outputShape.length);const d=r?e[1]:e[2],h=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",f=o?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",y="";a&&(c?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",w="rc.x";e[0]<t[0]?v=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(w=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${w};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${g[0]});
          result += (${m[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jx={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class Zx{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=At(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ey="return a * b;";function Kg(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=Rs(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),l=new Zx(Jx.REAL,s.shape,r.shape),d=new Zx(Jx.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(l,h,"float32"),f=t.runWebGLProgram(d,h,"float32"),m=zo({inputs:{real:p,imag:f},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),m}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),[l,d]=n5(s.shape,r.shape,a.values,c.values,o),h=t.makeTensorInfo(d,o),p=t.texData.get(h.dataId);return p.values=l,h}let i;return he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Ea(ey,s.shape,r.shape):i=new yi(ey,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const rV={kernelName:Gc,backendName:"webgl",kernelFunc:Kg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n,e,t){const s=[fa(n.shape),...ma(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[fa(e),...ma(e)],i=new cN(o,s),a=!0,c=[s],l=t.runWebGLProgram(i,[r],n.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,a=we(r.shape),c=eb(o,a),l=we(c);E(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!Ru(r.shape,c)&&!(d.texture!==null&&Ru(d.shape,c))?oV(r,c,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const iV={kernelName:Pd,backendName:"webgl",kernelFunc:We};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ty{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,c=s%4;let l="sumValue += dot(values, ones);";if(t!=null){const h=1/t;l=`sumValue += dot(values * ${sa(h)?h.toPrecision(2):h}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aV{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",c="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",c="min"):t==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");const d=Math.floor(s/4)*4,h=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=rh(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function Ri(n,e,t,s){const r=cV(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:c,outSize:l}=r[i];let d,h;t==="mean"?d=i===0?new ty({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},a):new ty({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l}):d=new aV({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},t),h=o,o=s.runWebGLProgram(d,[o],e),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lV{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=on(this.rank),o=uV(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function uV(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dV{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=on(this.rank),o=aN("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const a=`vec2(${i.slice(-2).join()})`,c=`++${o[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(n,e,t){const s=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dV(n.shape,e):new lV(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e,t,s){const r=e,o=n.shape.length,i=Lt(r,n.shape);let a=i;const c=Sn(a,o),l=c!=null;let d=n;l&&(d=Sh(n,c,s),a=Tn(a.length,o)),Xn("sum",a,o);const[h,p]=Hn(d.shape,a);let f=h;t&&(f=Dn(h,i));const m=we(p),x=we(n.shape)/m,y=We({inputs:{x:d},attrs:{shape:[x,m]},backend:s}),b=em(n.dtype),v=Ri(y,b,"sum",s),w=We({inputs:{x:v},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),l&&s.disposeIntermediateTensorInfo(d),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ch(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return hV(r,o,i,t)}const pV={kernelName:Wd,backendName:"webgl",kernelFunc:Ch};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ls(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,a=r.shape.length,c=new Array(a);for(let d=0;d<c.length;d++)c[d]=r.shape[o[d]];let l;if(i.shouldExecuteOnCPU([r])){const h=i.texData.get(r.dataId).values,p=Hg(h,r.shape,r.dtype,o,c);l=i.makeTensorInfo(c,r.dtype);const f=i.texData.get(l.dataId);f.values=p}else l=Sh(r,o,i);return l}const fV={kernelName:Ki,backendName:"webgl",kernelFunc:ls};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fN=1e3;function Du({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){const l=n.shape.length,d=e.shape.length,h=t?n.shape[l-2]:n.shape[l-1],p=s?e.shape[d-1]:e.shape[d-2],f=t?n.shape[l-1]:n.shape[l-2],m=s?e.shape[d-2]:e.shape[d-1],g=n.shape.slice(0,-2),x=e.shape.slice(0,-2),y=we(g),b=we(x),w=At(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,m]);E(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=t?[y,h,f]:[y,f,h],N=s?[b,m,p]:[b,p,m],C=We({inputs:{x:n},backend:r,attrs:{shape:S}}),k=We({inputs:{x:e},backend:r,attrs:{shape:N}}),I=[C,k],T=Math.max(y,b),_=t?C.shape[1]:C.shape[2],D=o!=null,P=i!=null,A=c==="leakyrelu",F=c!=null?cc(c,!0):null,O=D||P||A||F!=null;let V;if((f===1||m===1)&&_>fN&&O===!1){let H=C,J=k;t&&(H=ls({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),I.push(H)),s&&(J=ls({inputs:{x:k},backend:r,attrs:{perm:[0,2,1]}}),I.push(J));const X=m!==1,fe=m===1;let be=H;X&&(be=We({inputs:{x:H},backend:r,attrs:{shape:[T,_,1]}}),I.push(be));const oe=m===1?2:1;let xe=J;fe&&(xe=We({inputs:{x:J},backend:r,attrs:{shape:[T,1,_]}}),I.push(xe));const $e=Kg({inputs:{a:be,b:xe},backend:r});V=Ch({inputs:{x:$e},backend:r,attrs:{axis:oe,keepDims:!0}}),I.push($e)}else{const H=Rs(n.dtype,e.dtype),J=new pN(S,N,[T,f,m],t,s,D,F,P,A),X=[C,k];if(o!=null&&X.push(o),P&&X.push(i),A){const fe=r.makeTensorInfo([],"float32",Ro(a,"float32"));X.push(fe),I.push(fe)}V=r.runWebGLProgram(J,X,H)}const L=We({inputs:{x:V},backend:r,attrs:{shape:w}});I.push(V);for(const H of I)r.disposeIntermediateTensorInfo(H);return L}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;return Du({a:r,b:o,transposeA:c,transposeB:l,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const gV={kernelName:ou,backendName:"webgl",kernelFunc:mV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ny="return abs(x);";function xV(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=oN(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return he().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new xo(s.shape,ny):r=new Rr(s.shape,ny),t.runWebGLProgram(r,[s],s.dtype)}const yV={kernelName:Ku,backendName:"webgl",kernelFunc:xV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV=sr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,wV=qt({opSnippet:bV}),vV={kernelName:gc,backendName:"webgl",kernelFunc:wV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SV=sr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,CV=qt({opSnippet:SV}),NV={kernelName:xc,backendName:"webgl",kernelFunc:CV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sy="return a + b;",IV=Yn({opSnippet:sy,packedOpSnippet:sy,supportsComplex:!0,cpuKernelImpl:PB}),kV={kernelName:ba,backendName:"webgl",kernelFunc:IV};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $V{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TV{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function su(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return js({inputs:{x:s[0]},backend:t});if(s.length>he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),l=su({inputs:s.slice(0,c),backend:t}),d=su({inputs:s.slice(c),backend:t});return su({inputs:[l,d],backend:t})}const r=s.map(c=>c.dtype).reduce((c,l)=>Rs(c,l)),o=s.map(c=>c.shape),a=he().getBool("WEBGL_PACK")?new TV(s[0].shape,o):new $V(s[0].shape,o);return t.runWebGLProgram(a,s,r)}const AV={kernelName:hf,backendName:"webgl",kernelFunc:su};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=Sn(l,a);let h=r;d!=null&&(h=ls({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,a)),Xn("all",l,a);const[p,f]=Hn(h.shape,l),m=we(f),g=We({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=Ri(g,g.dtype,"all",t);let y;if(i){const b=Dn(p,c);y=We({inputs:{x},backend:t,attrs:{shape:b}})}else y=We({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const RV={kernelName:pf,backendName:"webgl",kernelFunc:EV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=Sn(l,a);let h=r;d!=null&&(h=ls({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,a)),Xn("any",l,a);const[p,f]=Hn(h.shape,l),m=we(f),g=We({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=Ri(g,g.dtype,"any",t);let y;if(i){const b=Dn(p,c);y=We({inputs:{x},backend:t,attrs:{shape:b}})}else y=We({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const jV={kernelName:ff,backendName:"webgl",kernelFunc:DV};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _V{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PV{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=on(c),d=as("coords",c);let h,p;if(i===1){p=c+1;const k=on(p);h=`
        ${k} sourceLocR = ${k}(${d.join()}, 0);
        ++${d[c-1]};
        ${k} sourceLocG = ${k}(${d.join()}, 0);
        ++${d[c-2]};
        ${k} sourceLocA = ${k}(${d.join()}, 0);
        --${d[c-1]};
        ${k} sourceLocB = ${k}(${d.join()}, 0);
        --${d[c-2]};`}else p=c,h=`
        ${l} sourceLocR = coords;
        ++${d[c-1]};
        ${l} sourceLocG = coords;
        ++${d[c-2]};
        ${l} sourceLocA = coords;
        --${d[c-1]};
        ${l} sourceLocB = coords;
        --${d[c-2]};`;const f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],g=f.map(k=>"int "+k),x=as("sourceLocR",p-1).concat("inIdx.r"),y=as("sourceLocG",p-1).concat("inIdx.g"),b=as("sourceLocB",p-1).concat("inIdx.b"),v=as("sourceLocA",p-1).concat("inIdx.a"),w=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${v.join()})));`,N=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,C=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${C}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${d[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${d[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mN(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=rh(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},c=new _V(a,t,s==null),l=[e];s!=null&&l.push(s);const d=n.runWebGLProgram(c,l,"int32");if(d.shape[1]===1)return d;const h=mN(n,e,t,d);return n.disposeIntermediateTensorInfo(d),h}function gN(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=rh(o),a=new PV(r,i,t,s==null),c=s==null?[e]:[e,s],l=n.runWebGLProgram(a,c,"int32");if(l.shape.length===e.shape.length){const d=gN(n,e,t,l);return n.disposeIntermediateTensorInfo(l),d}return l}function xN(n,e,t,s){const r=[t];if(Xn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!he().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let c=e;a&&(c=n.unpackTensor(e),o.push(c));const[l,d]=Hn(c.shape,r),h=we(d),p=We({inputs:{x:c},backend:n,attrs:{shape:[-1,h]}});o.push(p);const f=mN(n,p,s);o.push(f);const m=We({inputs:{x:f},backend:n,attrs:{shape:l}});return o.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}return gN(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Lt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=ls({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),Xn("argMax",[i[0]],c.shape.length);const d=xN(t,c,i[0],"max");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const FV={kernelName:Qu,backendName:"webgl",kernelFunc:MV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Lt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=ls({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),Xn("argMin",[i[0]],c.shape.length);const d=xN(t,c,i[0],"min");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const LV={kernelName:Xu,backendName:"webgl",kernelFunc:OV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zV=sr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,WV=qt({opSnippet:zV}),BV={kernelName:yc,backendName:"webgl",kernelFunc:WV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VV=sr+"return log(x + sqrt(x * x + 1.0));",UV=qt({opSnippet:VV}),GV={kernelName:bc,backendName:"webgl",kernelFunc:UV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HV=sr+`
  return atan(x);
`,qV=qt({opSnippet:HV}),KV={kernelName:wc,backendName:"webgl",kernelFunc:qV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QV=qg+`
  return atan(a, b);
`,XV=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ei+`
  return result;
`,YV=Yn({opSnippet:QV,packedOpSnippet:XV}),JV={kernelName:Sc,backendName:"webgl",kernelFunc:YV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZV=sr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,eU=qt({opSnippet:ZV}),tU={kernelName:vc,backendName:"webgl",kernelFunc:eU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lc{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const g=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),s){const k=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:y:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let w=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(w="avgValue / max(count, 1.0)");const S=Math.floor(i/4)*4,N=i%4,C=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${C}
          }

          int xC = xCCorner + ${S};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${C}
          }
        }
        setOutput(${w});
      }
    `}}class Qg{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,c=e.strideHeight,l=e.strideWidth,d=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,y=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg";let w="0.0";if(v||(w="-1.0 / 1e-20"),s){const T=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${x}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${T} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let N=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(N="avgValue / max(count, 1.0)");const C=Math.floor(i/4)*4,k=i%4,I=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${I}
            }

            int xC = xCCorner + ${C};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${I}
            }
          }
        }
        setOutput(${N});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Al(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&Jt(d.inShape,d.outShape))return js({inputs:{x:r},backend:t});const h=new lc(d,"avg",!1);return t.runWebGLProgram(h,[r],"float32")}const sU={kernelName:Yu,backendName:"webgl",kernelFunc:nU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s,d=[1,1,1],h=oo(r.shape,o,i,d,a,c,l),p=new Qg(h,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const oU={kernelName:Ju,backendName:"webgl",kernelFunc:rU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iU{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=c-1-e.padInfo.top,h=l-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${h});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class aU{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=h-1-e.padInfo.front,g=p-1-e.padInfo.top,x=f-1-e.padInfo.left,y=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${g}, ${x});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cU(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],p=oo(i.shape,a,c,h,l,d),f=new aU(p);return t.runWebGLProgram(f,[r],i.dtype)}const lU={kernelName:gf,backendName:"webgl",kernelFunc:cU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uU(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Al([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=tr(i.shape,a,c,1,l),h=new iU(d);return t.runWebGLProgram(h,[r],i.dtype)}const dU={kernelName:mf,backendName:"webgl",kernelFunc:uU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hU(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return Du({a:r,b:o,transposeA:i,transposeB:a,backend:t})}const pU={kernelName:Zu,backendName:"webgl",kernelFunc:hU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fU{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],At(e,t),At(e,s);let a="0.0";r!=null&&(At(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";o!=null&&(At(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mU{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],At(e,t),At(e,s);let a="vec4(0.0)";r!=null&&(At(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";o!=null&&(At(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;E(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);const l=[s,r,o];let d=null;i!=null&&(d=i.shape,l.push(i));let h=null;a!=null&&(h=a.shape,l.push(a));const p=he().getBool("WEBGL_PACK_NORMALIZATION")?new mU(s.shape,r.shape,o.shape,d,h,c):new fU(s.shape,r.shape,o.shape,d,h,c);return e.runWebGLProgram(p,l,l[0].dtype)},xU={kernelName:dd,backendName:"webgl",kernelFunc:gU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yU{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=on(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=bU(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${Kp[a]} = start[${a}] + coords.${Kp[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Kp=["x","y","z","w","u","v"];function bU(n){if(n===1)return"sourceLoc";if(n<=6)return Kp.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wU{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=on(this.rank),s=as("coords",this.rank),r=as("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,h)=>`start[${h}]`).join()});`:e.map((d,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vU(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=Um(e,pt(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const c=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,c+1),o}function Da(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[a,c]=sh(r,o,i);if(Wm(r,a,c),we(c)===0)return t.makeTensorInfo(c,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=t.texData.get(r.dataId),p=p5(h.values,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,p)}const{isPacked:l}=t.texData.get(r.dataId),d=Vm(r.shape,a,c);if(l||!d){const h=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wU(c):new yU(c),p=[a];return t.runWebGLProgram(h,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),vU(r,a,c,t)}const SU={kernelName:zd,backendName:"webgl",kernelFunc:Da};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;E(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,v)=>b*v),c=gl(r.shape,o,a),l=xl(c.length,o.length),d=yl(r.shape,o,a),h=Qm(i,o.length),p=Xm(d,i,o.length),f=[],m=We({inputs:{x:r},backend:t,attrs:{shape:c}}),g=ls({inputs:{x:m},backend:t,attrs:{perm:l}}),x=We({inputs:{x:g},backend:t,attrs:{shape:d}}),y=Da({inputs:{x},backend:t,attrs:{begin:h,size:p}});return f.push(m),f.push(g),f.push(x),f.forEach(b=>t.disposeIntermediateTensorInfo(b)),y},NU={kernelName:ed,backendName:"webgl",kernelFunc:CU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.readSync(r.dataId),c=t.readSync(o.dataId),l=rN(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const kU={kernelName:xf,backendName:"webgl",kernelFunc:IU};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,TU=`
  return float(int(a.r) & int(b.r));
`;function AU(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=he().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=he().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||i===1){const c=t.texData.get(s.dataId).values,l=t.texData.get(r.dataId).values,[d,h]=FB(s.shape,r.shape,c,l,s.dtype),p=t.makeTensorInfo(h,s.dtype),f=t.texData.get(p.dataId);return f.values=d,p}let a;return o?a=new Ea($U,s.shape,r.shape,!1):a=new yi(TU,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const EU={kernelName:yf,backendName:"webgl",kernelFunc:AU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RU(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),a=At(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const DU={kernelName:ib,backendName:"webgl",kernelFunc:RU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU="return float(a != b);",yN=Yn({opSnippet:jU,cpuKernelImpl:r5,dtype:"bool"}),_U={kernelName:Td,backendName:"webgl",kernelFunc:yN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rl(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return js({inputs:{x:r.complexTensorInfos.real},backend:t})}const PU={kernelName:Vf,backendName:"webgl",kernelFunc:Rl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU="return float(int(x));";function FU(n,e){const t=new Rr(n.shape,MU),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qp(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return js({inputs:{x:r},backend:t});const i=Un(r.shape),a=Qp({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),c=zo({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),c}if(r.dtype==="complex64"){const i=Rl({inputs:{input:r},backend:t}),a=Qp({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!tb(r.dtype,o)){const i=js({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[a,c,l]=OB(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}if(o==="int32")return FU(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",Jn("bool",1)),c=yN({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const OU={kernelName:Cc,backendName:"webgl",kernelFunc:Qp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ry="return ceil(x);",LU=qt({opSnippet:ry,packedOpSnippet:ry,cpuKernelImpl:LB}),zU={kernelName:Nc,backendName:"webgl",kernelFunc:LU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WU{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BU{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;he().getBool("WEBGL_PACK_CLIP")?a=new BU(r.shape):a=new WU(r.shape);const c=[[o],[i]];return t.runWebGLProgram(a,[r],r.dtype,c)}const UU={kernelName:Ic,backendName:"webgl",kernelFunc:VU};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GU{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oy(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function HU(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new GU(s.shape),i=[oy(s,r.complexTensorInfos.real),oy(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const qU={kernelName:td,backendName:"webgl",kernelFunc:HU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KU{constructor(e){this.outputShape=[],this.outputShape=Pr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QU{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Pr(e,t);const s=this.outputShape,r=s.length,o=on(r),i=as("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const c=new Array(e.length-1);c[0]=e[0][t];for(let g=1;g<c.length;g++)c[g]=c[g-1]+e[g][t];const l=a[t],d=a.slice(-2),h=a.join();let p=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${d.join()}));
        }`;for(let g=1;g<c.length;g++){const x=c[g-1];p+=`
        if (${l} < ${c[g]}  && ${l} >= ${c[g-1]}) {
          return getChannel(
            getT${g}(${Kl(a,l,x)}),
            vec2(${Kl(d,l,x)}));
        }`}const f=c.length,m=c[c.length-1];p+=`
        return getChannel(
          getT${f}(${Kl(a,l,m)}),
          vec2(${Kl(d,l,m)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${p}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Kl(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return js({inputs:{x:r.complexTensorInfos.imag},backend:t})}const XU={kernelName:Pf,backendName:"webgl",kernelFunc:Nh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ga(n,e,t){const s=n[0].dtype;if(s==="complex64"){const f=n.map(b=>Rl({inputs:{input:b},backend:t})),m=n.map(b=>Nh({inputs:{input:b},backend:t})),g=Ga(f,e,t),x=Ga(m,e,t),y=zo({inputs:{real:g,imag:x},backend:t});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),m.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const f=n.map(w=>{const N=[-1,we(w.shape.slice(e))];return We({inputs:{x:w},backend:t,attrs:{shape:N}})}),m=f.map(w=>({vals:t.readSync(w.dataId),shape:w.shape})),g=Pr(f.map(w=>w.shape),1),x=f[0].shape[0]===1,y=zB(m,g,s,x),b=Pr(n.map(w=>w.shape),e),v=t.makeTensorInfo(b,s,y);return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const o=n.filter(f=>we(f.shape)>0),i=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const f=i?new Rr(n[0].shape,fo):new xo(n[0].shape,fo);return t.runWebGLProgram(f,n,s)}const a=he().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const f=[];for(let g=0;g<o.length;g+=a){const x=o.slice(g,g+a);f.push(Ga(x,e,t))}const m=Ga(f,e,t);for(const g of f)t.disposeIntermediateTensorInfo(g);return m}if(i){const f=new QU(o.map(m=>m.shape),e);return t.runWebGLProgram(f,o,s)}const{tensors2D:c,outShape:l}=YU(o,e,t),d=new KU(c.map(f=>f.shape)),h=t.runWebGLProgram(d,c,s);c.forEach(f=>t.disposeIntermediateTensorInfo(f));const p=We({inputs:{x:h},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(h),p}function YU(n,e,t){const s=Pr(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>We({inputs:{x:o},attrs:{shape:[-1,we(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Lt(r,e[0].shape)[0],i=e.map(l=>l.shape);Hm(i,o);const a=Pr(e.map(l=>l.shape),o);if(we(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(l=>we(l.shape)>0);return c.length===1?js({inputs:{x:c[0]},backend:t}):Ga(c,o,t)}const JU={kernelName:nd,backendName:"webgl",kernelFunc:bN};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",y=x?1:2,b=x?2:3,v=x?3:1;let w="",S="";s&&(r?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:w=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${S}
        setOutput(result);
      }
    `}}class ZU{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.filterDepth,p=e.filterHeight,f=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ss(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,h=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)p+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;p+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)p+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(h+1)/2;x++){const y=x*2;if(p+=`
           xC = xCCorner + ${y*c};
           `,a===1){if(y<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,c===1&&y>0?p+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<d)){const b=i%2===0?af(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,c>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:p+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?p+=`
                     xC${y+1} = xTexelC${y};
                     `:p+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<d&&(p+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<d&&(p+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<d&&(p+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let f="",m="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e6{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);const{dataFormat:s}=t,r=us(),o=s==="channelsLast",i=o?1:2,a=o?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let d=0;d<=1;d++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${d};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ju(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function SN({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const c=n.shape,l=s.texData.get(n.dataId),d=t.inChannels,h=c[0]*c[1]*c[2],p=t.outChannels,f=t.dataFormat==="channelsLast",m=!1,g=!1;let x;const y=[];if(o!=null){const w=ju(o.shape,f);w!=null&&(o=We({inputs:{x:o},backend:s,attrs:{shape:w}}),y.push(o))}if(r!=null){const w=ju(r.shape,f);w!=null&&(r=We({inputs:{x:r},backend:s,attrs:{shape:w}}),y.push(r))}if(!((h===1||p===1)&&d>fN)&&l.isPacked&&f&&l.texture!=null&&c[2]%2!==0&&Jt(l.shape.slice(-3),c.slice(-3))){const w=c[0]*c[1]*(c[2]+1),S={dataId:n.dataId,shape:[1,w,t.inChannels],dtype:n.dtype},N=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,E(Ru(l.shape,S.shape),()=>`packed reshape ${l.shape} to ${S.shape} isn't free`);const C=We({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});y.push(C);const k=Du({a:S,b:C,backend:s,transposeA:m,transposeB:g,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),I=s.texData.get(k.dataId);E(I.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=N,I.shape=t.outShape,x=js({inputs:{x:k},backend:s}),x.shape=t.outShape,y.push(k)}else{const w=t.outHeight*t.outWidth,S=We({inputs:{x:n},backend:s,attrs:{shape:f?[t.batchSize,w,t.inChannels]:[t.batchSize,t.inChannels,w]}}),N=We({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),C=Du({a:f?S:N,b:f?N:S,transposeA:!f,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});x=We({inputs:{x:C},backend:s,attrs:{shape:t.outShape}}),y.push(S),y.push(N),y.push(C)}for(const w of y)s.disposeIntermediateTensorInfo(w);return x}function CN({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:d,outWidth:h,outHeight:p,dataFormat:f}=t,m=f==="channelsLast",g=c*l*d,x=p*h,y=[t.batchSize,g,x],b=!0,v=!1,w=[];if(o!=null){const L=ju(o.shape,m);L!=null&&(o=We({inputs:{x:o},backend:s,attrs:{shape:L}}),w.push(o))}if(r!=null){const L=ju(r.shape,m);L!=null&&(r=We({inputs:{x:r},backend:s,attrs:{shape:L}}),w.push(r))}const S=We({inputs:{x:e},backend:s,attrs:{shape:[1,g,we(e.shape)/g]}});w.push(S);const N=new e6(y,t),C=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],k=s.runWebGLProgram(N,[n],"float32",C),I=We({inputs:{x:k},backend:s,attrs:{shape:y}});w.push(k),w.push(I);const T=r!=null,_=o!=null,D=a==="leakyrelu",P=a?cc(a,!0):null,A=new pN(m?I.shape:S.shape,m?S.shape:I.shape,m?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],b,v,T,P,_,D),F=m?[I,S]:[S,I];if(r&&F.push(r),_&&F.push(o),D){const L=s.makeTensorInfo([],"float32",Ro(i,"float32"));F.push(L),w.push(L)}const O=s.runWebGLProgram(A,F,"float32"),V=We({inputs:{x:O},backend:s,attrs:{shape:t.outShape}});w.push(O);for(const L of w)s.disposeIntermediateTensorInfo(L);return V}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s,h=io(c),p=Qn(r.shape,o.shape,i,l,a,d,!1,h);let f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=SN({x:r,filter:o,convInfo:p,backend:t});else if(p.strideWidth<=2&&h==="channelsLast"&&he().getBool("WEBGL_EXP_CONV")){const g=new vN(p),x=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];f=t.runWebGLProgram(g,[r,o],"float32",x)}else if(he().getBool("WEBGL_CONV_IM2COL"))f=CN({x:r,filter:o,convInfo:p,backend:t});else{const g=new wN(p);f=t.runWebGLProgram(g,[r,o],"float32")}const m=We({inputs:{x:f},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(f),m}const n6={kernelName:sd,backendName:"webgl",kernelFunc:t6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class r6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,c=s-1-e.padInfo.left,l=i?1:2,d=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class o6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class i6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=t-1-e.padInfo.front,l=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s,h=io(c),p=Qn(r.shape,d,i,1,a,l,!1,h),f=new s6(p);return t.runWebGLProgram(f,[r,o],"float32")}const c6={kernelName:wf,backendName:"webgl",kernelFunc:a6};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l6{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ss(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s,h=io(l),p=Qn(i,o.shape,a,1,c,d,!1,h);if(he().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const f=[[p.strideHeight,p.strideWidth]],m=new l6(p);return t.runWebGLProgram(m,[r,o],"float32",f)}else{const f=new r6(p);return t.runWebGLProgram(f,[r,o],"float32")}}const d6={kernelName:rd,backendName:"webgl",kernelFunc:u6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=jo(r.shape,o.shape,i,c,a),d=new ZU(l);return t.runWebGLProgram(d,[r,o],"float32")}const p6={kernelName:od,backendName:"webgl",kernelFunc:h6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s,l=jo(r.shape,c,i,1,a),d=new o6(l);return t.runWebGLProgram(d,[r,o],"float32")}const m6={kernelName:vf,backendName:"webgl",kernelFunc:f6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s,l=jo(c,o.shape,a,1,i),d=new i6(l);return t.runWebGLProgram(d,[r,o],"float32")}const x6={kernelName:Sf,backendName:"webgl",kernelFunc:g6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y6=Ra+`
  return cos(x);
`,b6=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Ei}
  return result;
`,w6=qt({opSnippet:y6,packedOpSnippet:b6}),v6={kernelName:kc,backendName:"webgl",kernelFunc:w6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,C6=qt({opSnippet:S6}),N6={kernelName:$c,backendName:"webgl",kernelFunc:C6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I6{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,c,l]=e,[d]=t,[h,p]=s;this.outputShape=[d,h,p,l];const f=r==="bilinear"?1:0,[m,g]=[`${a-1}.0`,`${c-1}.0`],[x,y,b]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[v,w,S]=p>1?[`${(c-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k6=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,d=new I6(r.shape,o.shape,a,c,l);return t.runWebGLProgram(d,[r,o,i],"float32")},$6={kernelName:Nf,backendName:"webgl",kernelFunc:k6};var uc;(function(n){n.Prod="*",n.Sum="+"})(uc||(uc={}));class iy{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===uc.Prod?"1.0":"0.0",a=s?i:`getX(${ay(o,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",d="";s?(l=r?`end != ${c-1}`:"end != 0",d=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${c}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${on(o)} coords = getOutputCoords();
        int end = ${cy(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${d};
          ${cy(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${ay(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function ay(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function cy(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NN(n,e,t,s,r,o){const i=e.shape.length,a=Sn([s],i);let c=e;a!=null&&(c=ls({inputs:{x:e},backend:t,attrs:{perm:a}}));const l=Tn(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=c.shape[l];let h=js({inputs:{x:c},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const f=new iy(n,c.shape,!1,o),m=[[p]],g=h;h=t.runWebGLProgram(f,[h],h.dtype,m),t.disposeIntermediateTensorInfo(g)}if(r){const p=new iy(n,c.shape,r,o),f=h;h=t.runWebGLProgram(p,[h],h.dtype),t.disposeIntermediateTensorInfo(f)}if(a!=null){const p=_o(a),f=ls({inputs:{x:h},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(c),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return NN(uc.Prod,r,t,o,i,a)}const A6={kernelName:Cf,backendName:"webgl",kernelFunc:T6};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return NN(uc.Sum,r,t,o,i,a)}const R6={kernelName:id,backendName:"webgl",kernelFunc:E6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=rN(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=MB(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const j6={kernelName:If,backendName:"webgl",kernelFunc:D6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _6{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],c=i==="NHWC"?r.shape[1]:r.shape[2],l=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],h=c*o,p=l*o,f=d/(o*o),m=i==="NHWC"?[a,h,p,f]:[a,f,h,p],g=new _6(m,o,i);return t.runWebGLProgram(g,[r],r.dtype)}const M6={kernelName:kf,backendName:"webgl",kernelFunc:P6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ss(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,c=e.outChannels/e.inChannels;let l="",d="";s&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const h=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ss(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,c=e.strideWidth,l=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)f+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;f+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let y=0;y<h;y++)f+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(p+1)/2;y++){const b=y*2;if(f+=`
          xC = xCCorner + ${b*l};
          `,c===1){if(b<h&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?f+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<h)){const v=a%2===0?af(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:f+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):v===1?f+=`
                    xC${b+1} = xTexelC${b};
                    `:f+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<h&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<h&&(f+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<h&&(f+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<h&&(f+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let m="",g="";s&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:m=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;let d=c;d==null&&(d=[1,1]),E(ts(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const h=Qn(r.shape,o.shape,i,d,a,l,!0);let p;he().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?p=new kN(h):p=new IN(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return t.runWebGLProgram(p,[r,o],"float32",f)}const O6={kernelName:ad,backendName:"webgl",kernelFunc:F6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class z6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=s-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s,h=Qn(r.shape,d,i,a,c,l,!0),p=new L6(h);return t.runWebGLProgram(p,[r,o],"float32")}const B6={kernelName:$f,backendName:"webgl",kernelFunc:W6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s,h=Qn(d,o.shape,i,a,c,l,!0),p=new z6(h);return t.runWebGLProgram(p,[r,o],"float32")}const U6={kernelName:Tf,backendName:"webgl",kernelFunc:V6};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G6{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=we(s.shape),i=We({inputs:{x:s},backend:t,attrs:{shape:[o]}}),a=new G6(o),c=t.runWebGLProgram(a,[i],i.dtype),l=We({inputs:{x:c},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(c),l}const q6={kernelName:ab,backendName:"webgl",kernelFunc:H6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K6{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:d}=e,{top:h,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${h}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=dl(r.shape,o.shape,i,a,"NHWC",c);let d;const h=new K6(l);d=t.runWebGLProgram(h,[r,o],"float32");const p=We({inputs:{x:d},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(d),p}const X6={kernelName:cd,backendName:"webgl",kernelFunc:Q6};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=rg(r,o.length);ig(i.length,c,o);const{path:l,steps:d}=ag(a,c),h=d.length;let p=null,f=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=og(f,c[x]);let v;cg(y)?v=o[x]:(v=ls({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(v));const w=v.shape.slice();for(let S=0;S<b.length;++S)w.splice(b[S],0,1);Jt(v.shape,w)||(v=We({inputs:{x:v},backend:t,attrs:{shape:w}}),m.push(v)),p===null?p=v:(p=Kg({inputs:{a:v,b:p},backend:t}),m.push(p))}g<h-1&&(l[g]>=0&&(p=Ch({inputs:{x:p},backend:t,attrs:{axis:l[g]-(i.length-f),keepDims:!1}}),m.push(p)),f--)}for(const g of m)g!==p&&t.disposeIntermediateTensorInfo(g);return p}const J6={kernelName:Af,backendName:"webgl",kernelFunc:Y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z6="return (x >= 0.0) ? x : (exp(x) - 1.0);",eG=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,tG=qt({opSnippet:Z6,packedOpSnippet:eG}),nG={kernelName:Ac,backendName:"webgl",kernelFunc:tG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG="return (b >= 0.0) ? a : a * (b + 1.0);",rG=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,oG=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=he().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ea(rG,s.shape,r.shape):new yi(sG,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},iG={kernelName:Ef,backendName:"webgl",kernelFunc:oG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG=`
  return vec4(equal(a, b));
`,cG="return float(a == b);",lG=Yn({opSnippet:cG,packedOpSnippet:aG,dtype:"bool",cpuKernelImpl:WB}),uG={kernelName:ld,backendName:"webgl",kernelFunc:lG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Ym};
  float a1 = ${Jm};
  float a2 = ${Zm};
  float a3 = ${eg};
  float a4 = ${tg};
  float a5 = ${ng};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,hG=qt({opSnippet:dG}),pG={kernelName:Ec,backendName:"webgl",kernelFunc:hG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG=Ra+`
  return exp(x);
`,mG=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$N=qt({opSnippet:fG,packedOpSnippet:mG,cpuKernelImpl:BB,dtype:"float32"}),gG={kernelName:Rc,backendName:"webgl",kernelFunc:$N};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xp(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let c=r;return r<0&&(E(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+r+1),a.splice(c,0,1),We({inputs:{x:o},backend:s,attrs:{shape:a}})}const xG={kernelName:ud,backendName:"webgl",kernelFunc:Xp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ly="return exp(x) - 1.0;",yG=qt({opSnippet:ly,packedOpSnippet:ly,cpuKernelImpl:VB}),bG={kernelName:Dc,backendName:"webgl",kernelFunc:yG};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uy{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TN(n,e,t){const s=t.texData.get(n.dataId),r=we(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=We({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),c=a.shape,l=new uy("real",c,e),d=new uy("imag",c,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],p=t.runWebGLProgram(l,h,"float32"),f=t.runWebGLProgram(d,h,"float32"),m=zo({inputs:{real:p,imag:f},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f);const g=We({inputs:{x:m},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(m),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wG(n){const{inputs:e,backend:t}=n,{input:s}=e;return TN(s,!1,t)}const vG={kernelName:Rf,backendName:"webgl",kernelFunc:wG};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SG{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dl(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||xa(r),o==="string"){const i=In(o,we(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new SG(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const CG={kernelName:Df,backendName:"webgl",kernelFunc:Dl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NG{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:jf,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new NG(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dy="return floor(x);",kG=qt({opSnippet:dy,packedOpSnippet:dy,cpuKernelImpl:UB}),$G={kernelName:jc,backendName:"webgl",kernelFunc:kG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,AG=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,EG=Yn({opSnippet:TG,packedOpSnippet:AG,dtype:"int32"}),RG={kernelName:_c,backendName:"webgl",kernelFunc:EG};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DG{constructor(e){this.variableNames=["A"];const t=us(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jG{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=us(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:Ek,backendName:"webgl",kernelFunc:PG};let Fi,sp=he().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function PG(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,l]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[l,c],h=[l,c,o];if(a||i){const g=he().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Fi==null||g!==sp)&&(sp=g,Fi=document.createElement("canvas").getContext("2d",{willReadFrequently:sp})),Fi.canvas.width=c,Fi.canvas.height=l,Fi.drawImage(r,0,0,c,l),r=Fi.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=Fs.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const f=he().getBool("WEBGL_PACK")?new jG(h):new DG(h),m=t.runWebGLProgram(f,[p],"int32");return t.disposeData(p.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=s,g=io(d),x=Qn(r.shape,o.shape,c,h,l,p,!1,g);let y;const b=[],v=i!=null,w=a!=null,S=f==="leakyrelu",N=()=>{const k=[r,o],I=(T,_)=>{if(_==="NCHW"&&T.shape.length===1&&T.shape[0]!==1){const D=We({inputs:{x:T},backend:t,attrs:{shape:[T.shape[0],1,1]}});return b.push(D),D}return T};if(v&&k.push(I(i,d)),w&&k.push(I(a,d)),S){const T=t.makeTensorInfo([],"float32",Ro(m,"float32"));k.push(T),b.push(T)}return k};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=SN({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(x.strideWidth<=2&&g==="channelsLast"&&he().getBool("WEBGL_EXP_CONV")){const k=f?cc(f,!0):null,I=new vN(x,v,k,w,S),T=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],_=N();y=t.runWebGLProgram(I,_,"float32",T)}else if(he().getBool("WEBGL_CONV_IM2COL"))y=CN({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{const k=f?cc(f,!1):null,I=new wN(x,v,k,w,S),T=N();y=t.runWebGLProgram(I,T,"float32")}const C=We({inputs:{x:y},backend:t,attrs:{shape:x.outShape}});return b.push(y),b.forEach(k=>t.disposeIntermediateTensorInfo(k)),C}const FG={kernelName:iu,backendName:"webgl",kernelFunc:MG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s,m=[];let g=d;g==null&&(g=[1,1]),E(ts(c,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const x=Qn(r.shape,o.shape,c,g,l,h,!0),y=he().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,b=p?cc(p,y):null,v=[r,o],w=i!=null,S=a!=null,N=p==="leakyrelu";if(w&&v.push(i),S&&v.push(a),N){const T=t.makeTensorInfo([],"float32",Ro(f,"float32"));v.push(T),m.push(T)}let C;y?C=new kN(x,w,b,S,N):C=new IN(x,w,b,S,N);const k=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],I=t.runWebGLProgram(C,v,"float32",k);return m.forEach(T=>t.disposeIntermediateTensorInfo(T)),I}const LG={kernelName:kb,backendName:"webgl",kernelFunc:OG};class zG{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=on(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WG(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=we(s.shape),[c,l,d,h]=zm(s,r),p=We({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),f=We({inputs:{x:s},backend:t,attrs:{shape:[we(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=t.readSync(r.dataId),b=t.bufferSync(s),v=GB(y,b,s.dtype,l,i,d,h,s.shape,a);return t.makeTensorInfo(c,s.dtype,v.values)}const m=new zG(i,h,[l,d],s.shape),g=t.runWebGLProgram(m,[f,p],f.dtype),x=We({inputs:{x:g},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),x}const BG={kernelName:cb,backendName:"webgl",kernelFunc:WG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VG{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=on(this.rank),r=UG(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function UG(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,c=Lt(i,r.shape)[0];if(he().get("DEBUG")){const b=t.readSync(o.dataId),v=r.shape[c];for(let w=0;w<b.length;++w){const S=b[w];E(S<=v-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${v-1}]`)}}const l=ug(r,o,c,a),d=we(o.shape),h=[],p=We({inputs:{x:r},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=We({inputs:{x:o},backend:t,attrs:{shape:[l.batchSize,d/l.batchSize]}});h.push(p),h.push(f);const m=[l.batchSize,l.outerSize,d/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=t.bufferSync(f),v=t.bufferSync(p),w=HB(v,b,m);return h.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(l.outputShape,w.dtype,w.values)}const g=new VG(p.shape,m),x=t.runWebGLProgram(g,[p,f],p.dtype);h.push(x);const y=We({inputs:{x},backend:t,attrs:{shape:l.outputShape}});return h.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const GG={kernelName:hd,backendName:"webgl",kernelFunc:AN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG="return float(a > b);",qG=`
  return vec4(greaterThan(a, b));
`,KG=Yn({opSnippet:HG,packedOpSnippet:qG,cpuKernelImpl:qB,dtype:"bool"}),QG={kernelName:pd,backendName:"webgl",kernelFunc:KG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG="return float(a >= b);",YG=`
  return vec4(greaterThanEqual(a, b));
`,JG=Yn({opSnippet:XG,packedOpSnippet:YG,dtype:"bool",cpuKernelImpl:KB}),ZG={kernelName:Pc,backendName:"webgl",kernelFunc:JG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eH(n){const{inputs:e,backend:t}=n,{input:s}=e;return TN(s,!0,t)}const tH={kernelName:_f,backendName:"webgl",kernelFunc:eH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nH="return float(!isnan(x) && !isinf(x));",sH=qt({opSnippet:nH,dtype:"bool"}),rH={kernelName:Fc,backendName:"webgl",kernelFunc:sH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oH="return float(isinf(x));",iH=qt({opSnippet:oH,dtype:"bool"}),aH={kernelName:Oc,backendName:"webgl",kernelFunc:iH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cH="return float(isnan(x));",lH=qt({opSnippet:cH,dtype:"bool"}),uH={kernelName:Lc,backendName:"webgl",kernelFunc:lH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dH="return float(a < b);",hH=`
  return vec4(lessThan(a, b));
`,pH=Yn({opSnippet:dH,packedOpSnippet:hH,cpuKernelImpl:QB,dtype:"bool"}),fH={kernelName:md,backendName:"webgl",kernelFunc:pH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mH="return float(a <= b);",gH=`
  return vec4(lessThanEqual(a, b));
`,xH=Yn({opSnippet:mH,packedOpSnippet:gH,cpuKernelImpl:XB,dtype:"bool"}),yH={kernelName:gd,backendName:"webgl",kernelFunc:xH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bH(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=YB(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const wH={kernelName:lb,backendName:"webgl",kernelFunc:bH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vH=Ra+`
  return x < 0.0 ? 0./0. : log(x);
`,SH=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,CH=qt({opSnippet:vH,packedOpSnippet:SH,cpuKernelImpl:JB}),NH={kernelName:zc,backendName:"webgl",kernelFunc:CH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IH=Ra+`
  return log(1.0 + x);
`,kH=qt({opSnippet:IH}),$H={kernelName:Wc,backendName:"webgl",kernelFunc:kH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TH="return float(a >= 1.0 && b >= 1.0);",AH=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,EH=Yn({opSnippet:TH,packedOpSnippet:AH,dtype:"bool"}),RH={kernelName:xd,backendName:"webgl",kernelFunc:EH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH="return float(!(x >= 1.0));",jH=qt({opSnippet:DH}),_H={kernelName:yd,backendName:"webgl",kernelFunc:jH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PH="return float(a >= 1.0 || b >= 1.0);",MH=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,FH=Yn({opSnippet:PH,packedOpSnippet:MH,dtype:"bool"}),OH={kernelName:bd,backendName:"webgl",kernelFunc:FH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LH{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zH{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WH=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s,l=he().getBool("WEBGL_PACK_NORMALIZATION")?new zH(r.shape,o,i,a,c):new LH(r.shape,o,i,a,c);return t.runWebGLProgram(l,[r],r.dtype)},BH={kernelName:wd,backendName:"webgl",kernelFunc:WH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VH{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s,h=new VH(r.shape,a,c,l,d);return t.runWebGLProgram(h,[r,o,i],r.dtype)},GH={kernelName:Mf,backendName:"webgl",kernelFunc:UH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HH(n,e,t,s){const r=we(e),i=we(n.shape)/r,a=We({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=Ri(a,n.dtype,"max",s),l=We({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=Sn(l,a),h=d!=null,p=t.shouldExecuteOnCPU([r]);let f=r;if(h){if(p){const v=t.texData.get(f.dataId).values,w=new Array(a);for(let C=0;C<w.length;C++)w[C]=r.shape[d[C]];const S=Hg(v,r.shape,r.dtype,d,w);f=t.makeTensorInfo(w,r.dtype);const N=t.texData.get(f.dataId);N.values=S}else f=Sh(r,d,t);l=Tn(l.length,a)}Xn("max",l,a);const[m,g]=Hn(f.shape,l);let x=m;i&&(x=Dn(m,c));let y;if(p){const v=t.texData.get(f.dataId).values,w=ZB(v,we(g),x,r.dtype);y=t.makeTensorInfo(x,r.dtype);const S=t.texData.get(y.dataId);S.values=w}else y=HH(f,g,x,t);return h&&t.disposeIntermediateTensorInfo(f),y}const qH={kernelName:vd,backendName:"webgl",kernelFunc:EN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH=qg+`
  return max(a, b);
`,QH=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ei+`
  return result;
`,XH=Yn({opSnippet:KH,packedOpSnippet:QH,cpuKernelImpl:e5}),YH={kernelName:Bc,backendName:"webgl",kernelFunc:XH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Al(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&Jt(d.inShape,d.outShape))return js({inputs:{x:r},backend:t});const h=new lc(d,"max",!1);return t.runWebGLProgram(h,[r],r.dtype)}const ZH={kernelName:Sd,backendName:"webgl",kernelFunc:JH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=s,d=[1,1,1],h=oo(r.shape,o,i,d,a,l,c),p=new Qg(h,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const tq={kernelName:Cd,backendName:"webgl",kernelFunc:eq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nq{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,c=i-1-e.padInfo.left,l=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class sq{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=c-1-e.padInfo.front,p=l-1-e.padInfo.top,f=d-1-e.padInfo.left,m=c*l*d-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],p=oo(i.shape,a,c,h,l,d),f=new Qg(p,"max",!0),m=t.runWebGLProgram(f,[i],i.dtype),g=new sq(p),x=t.runWebGLProgram(g,[r,m],i.dtype);return t.disposeIntermediateTensorInfo(m),x}const oq={kernelName:Of,backendName:"webgl",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;Al([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,p=tr(a.shape,c,l,1,d,h),f=!0,m=new lc(p,"max",f),g=t.runWebGLProgram(m,[a],a.dtype),x=new nq(p),y=t.runWebGLProgram(x,[r,g],a.dtype);return t.disposeIntermediateTensorInfo(g),y}const aq={kernelName:Ff,backendName:"webgl",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cq(n,e,t,s){let r=new lc(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new lc(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq={kernelName:ub,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;E(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];E(ts(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const d=tr(s.shape,r,o,l,i),[h,p]=cq(s,a,d,c);return[h,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(n,e,t,s){const r=we(e),i=we(n.shape)/r,a=We({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=Ri(a,"float32","mean",s),l=We({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dq={kernelName:Nd,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,a=s.shape.length,c=Lt(o,s.shape);let l=c;const d=Sn(l,a),h=d!=null,p=i.shouldExecuteOnCPU([s]),f=[];let m=s;if(h){if(p){const w=i.texData.get(m.dataId).values,S=new Array(a);for(let k=0;k<S.length;k++)S[k]=s.shape[d[k]];const N=Hg(w,s.shape,s.dtype,d,S);m=i.makeTensorInfo(S,s.dtype);const C=i.texData.get(m.dataId);C.values=N}else m=Sh(s,d,i);f.push(m),l=Tn(l.length,a)}Xn("sum",l,a);const[g,x]=Hn(m.shape,l);let y=g;r&&(y=Dn(g,c));const b=uq(m,x,y,i);for(const v of f)i.disposeIntermediateTensorInfo(v);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=Sn(l,a);let h=r;d!=null&&(h=ls({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,r.shape.length)),Xn("min",l,a);const[p,f]=Hn(h.shape,l),m=we(f),g=We({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=Ri(g,g.dtype,"min",t);let y;if(i){const b=Dn(p,c);y=We({inputs:{x},backend:t,attrs:{shape:b}})}else y=We({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const pq={kernelName:Id,backendName:"webgl",kernelFunc:hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fq=qg+`
  return min(a, b);
`,mq=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ei+`
  return result;
`,gq=Yn({opSnippet:fq,packedOpSnippet:mq,cpuKernelImpl:t5}),xq={kernelName:Vc,backendName:"webgl",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yq{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,h)=>d[0]+e[h]+d[1]);const r=e.length,o=on(r),i=t.map(d=>d[0]).join(","),a=t.map((d,h)=>d[0]+e[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bq{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,o=on(r),i=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),c=as("rc",r),l=as("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,p=s==="reflect"?0:1;let f="";if(r===1){const m=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const m=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wq=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bq(s.shape,r,o):new yq(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},vq={kernelName:kd,backendName:"webgl",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sq=`if (b == 0.0) return NAN;
  return mod(a, b);`,Cq=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Ei+`
  return result;
`,Nq=Yn({opSnippet:Sq,packedOpSnippet:Cq}),Iq={kernelName:Uc,backendName:"webgl",kernelFunc:Nq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kq{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $q=`
if (a == b) {
  return 1.0;
};
return a / b;`,Tq=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,RN=Yn({opSnippet:$q,packedOpSnippet:Tq,checkOutOfBounds:!0}),Aq={kernelName:Tc,backendName:"webgl",kernelFunc:RN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hy="return a - b;",DN=Yn({opSnippet:hy,packedOpSnippet:hy,supportsComplex:!0,cpuKernelImpl:S5}),Eq={kernelName:il,backendName:"webgl",kernelFunc:DN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jN(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=Lt([o],r.shape),a=EN({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),c=Dn(a.shape,i),l=We({inputs:{x:a},backend:t,attrs:{shape:c}}),d=DN({inputs:{a:r,b:l},backend:t}),h=$N({inputs:{x:d},backend:t}),p=Ch({inputs:{x:h},backend:t,attrs:{axis:i,keepDims:!1}}),f=We({inputs:{x:p},backend:t,attrs:{shape:c}}),m=RN({inputs:{a:h,b:f},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),m}const Rq={kernelName:Ud,backendName:"webgl",kernelFunc:jN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,c=a?r:jN({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),l=c.shape[0],d=c.shape[1],h=new kq(l,d,o),p=[[i]],f=t.runWebGLProgram(h,[c],"int32",p);return a||t.disposeIntermediateTensorInfo(c),f}const jq={kernelName:db,backendName:"webgl",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _q=sr+`
  return -x;
`,Pq=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Mq(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,a]=s5(o.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}let r;return he().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new xo(s.shape,Pq):r=new Rr(s.shape,_q),t.runWebGLProgram(r,[s],s.dtype)}const Fq={kernelName:$d,backendName:"webgl",kernelFunc:Mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oq=_m;function Lq(n){Ms("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:h}=Oq(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const zq={kernelName:Lf,backendName:"webgl",kernelFunc:Lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wq=Pm;function Bq(n){Ms("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),{selectedIndices:p,validOutputs:f}=Wq(d,h,i,a,c,l);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([f]))]}const Vq={kernelName:zf,backendName:"webgl",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uq=Mm;function Gq(n){Ms("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),p=i,f=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=Uq(d,h,p,f,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Hq={kernelName:Wf,backendName:"webgl",kernelFunc:Gq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qq{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s,l=we(r.shape),d=new qq(l,i,a,c),h=We({inputs:{x:r},backend:t,attrs:{shape:[l]}}),p=t.runWebGLProgram(d,[h],o);t.disposeIntermediateTensorInfo(h);const f=[...r.shape,i],m=We({inputs:{x:p},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(p),m},Qq={kernelName:Ed,backendName:"webgl",kernelFunc:Kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _u(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Rl({inputs:{input:s},backend:t}),o=_u({inputs:{x:r},backend:t}),i=Nh({inputs:{input:s},backend:t}),a=_u({inputs:{x:i},backend:t}),c=zo({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Dl({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const Xq={kernelName:qd,backendName:"webgl",kernelFunc:_u};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _N(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Rl({inputs:{input:s},backend:t}),o=_N({inputs:{x:r},backend:t}),i=Nh({inputs:{input:s},backend:t}),a=_u({inputs:{x:i},backend:t}),c=zo({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Dl({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const Yq={kernelName:Ad,backendName:"webgl",kernelFunc:_N};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Xp({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{cf(o,d.shape,"All tensors passed to stack must have matching shapes"),E(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=Xp({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=bN({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const Zq={kernelName:Rd,backendName:"webgl",kernelFunc:Jq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e8{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,d)=>l[0]+e[d]+l[1]);const r=e.length,o=on(r),i=t.map(l=>l[0]).join(","),a=t.map((l,d)=>l[0]+e[d]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t8{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,o=on(r),i=t.map(g=>g[0]).join(","),a=t.map((g,x)=>g[0]+e[x]).join(","),c=as("rc",r),l=as("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,p=[`${o} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${d}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let g=0,x=r===1?2:4;g<x;g++)m+=`
        ${p[g]}
        if (${f}) {
          result[${g}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${h});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PN=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(we(r.shape)===0){const l=o.map((d,h)=>d[0]+r.shape[h]+d[1]);return Dl({backend:t,attrs:{shape:l,value:i,dtype:r.dtype}})}const a=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new t8(r.shape,o,i):new e8(r.shape,o,i),c=[[i]];return t.runWebGLProgram(a,[r],r.dtype,c)},n8={kernelName:Dd,backendName:"webgl",kernelFunc:PN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s8=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,r8=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Ei+`
  return result;
`,o8=Yn({opSnippet:s8,packedOpSnippet:r8}),i8={kernelName:Hc,backendName:"webgl",kernelFunc:o8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=[],l=Lt(o,r.shape);let d=l;const h=Sn(d,a);let p=r;h!=null&&(p=ls({inputs:{x:r},backend:t,attrs:{perm:h}}),d=Tn(d.length,a),c.push(p)),Xn("prod",d,a);let f;if(t.shouldExecuteOnCPU([p])){const m=t.texData.get(p.dataId).values,{outVals:g,outShape:x,outDtype:y}=o5(p.shape,p.dtype,m,d);f=t.makeTensorInfo(x,y,g)}else{const[m,g]=Hn(p.shape,d),x=we(g),y=We({inputs:{x:p},backend:t,attrs:{shape:[-1,x]}}),b=em(r.dtype),v=Ri(y,b,"prod",t);f=We({inputs:{x:v},backend:t,attrs:{shape:m}}),c.push(y),c.push(v)}if(i){c.push(f);const m=Dn(f.shape,l);f=We({inputs:{x:f},backend:t,attrs:{shape:m}})}return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}const c8={kernelName:_d,backendName:"webgl",kernelFunc:a8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.readSync(y.dataId)),l=r.map(y=>y.shape),d=t.readSync(o.dataId),h=t.readSync(i.dataId),[p,f,m]=i5(c,l,d,o.shape,o.dtype,h,i.shape,a),g=p.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,f);return g.concat([x])}const u8={kernelName:hb,backendName:"webgl",kernelFunc:l8};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=a5(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([d.length],s.dtype,d);return[h,p]}const h8={kernelName:pb,backendName:"webgl",kernelFunc:d8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),h=t.readSync(i.dataId),p=a.map(x=>t.readSync(x.dataId)),f=a.map(x=>x.shape),[m,g]=c5(l,r.shape,d,o.shape,o.dtype,h,i.shape,p,f,c);return t.makeTensorInfo(m,o.dtype,g)}const f8={kernelName:fb,backendName:"webgl",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,a=l5(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},m8={kernelName:Bf,backendName:"webgl",kernelFunc:MN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8="return 1.0 / x;",x8=qt({opSnippet:g8}),y8={kernelName:qc,backendName:"webgl",kernelFunc:x8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b8=sr+`
  return (x < 0.0) ? 0.0 : x;
`,w8=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,v8=qt({opSnippet:b8,packedOpSnippet:w8}),S8={kernelName:Kc,backendName:"webgl",kernelFunc:v8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8=sr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,N8=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,I8=qt({opSnippet:C8,packedOpSnippet:N8}),k8={kernelName:Qc,backendName:"webgl",kernelFunc:I8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $8{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;o?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T8{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;o?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new T8(r.shape,c,l,o,i):new $8(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],"float32")}const E8={kernelName:Fd,backendName:"webgl",kernelFunc:A8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R8{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],p=1/d,f=1/h,m=Math.ceil(p)*2+2,g=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new R8(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const j8={kernelName:Gf,backendName:"webgl",kernelFunc:D8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _8{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let f;o?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P8{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let f;o?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=he().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new P8(r.shape,c,l,o,i):new _8(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const F8={kernelName:Md,backendName:"webgl",kernelFunc:M8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O8{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],p=1/d,f=1/h,m=Math.ceil(p)*2+2,g=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new O8(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const z8={kernelName:Uf,backendName:"webgl",kernelFunc:L8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W8{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,c)=>r(c)).join(","),i=on(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B8{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=as("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=on(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${o}){
            result.g = ${l(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(m){return p(m)}function l(m){return m[s-1]="("+m[s-1]+" + 1)",p(m)}function d(m){return m[s-2]="("+m[s-2]+" + 1)",p(m)}function h(m){return m[s-1]="("+m[s-1]+" + 1)",m[s-2]="("+m[s-2]+" + 1)",p(m)}function p(m){const g=e.map((b,v)=>f(v,m)),x=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${y}))`}function f(m,g){return t.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${g[m]} - 1`:`${g[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,a=Lt(o,r.shape);if(i===0)return js({inputs:{x:r},backend:t});const c=he().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B8(r.shape,a):new W8(r.shape,a);return t.runWebGLProgram(c,[r],r.dtype)}const U8={kernelName:Od,backendName:"webgl",kernelFunc:V8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G8{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8={kernelName:Jf,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=new G8(s.shape,o),[l,d]=Km(i,s.shape[1],s.shape[2]),h=[[l,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(c,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,K8=qt({opSnippet:q8}),Q8={kernelName:Xc,backendName:"webgl",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8="return inversesqrt(x);",Y8=qt({opSnippet:X8,cpuKernelImpl:u5}),J8={kernelName:Yc,backendName:"webgl",kernelFunc:Y8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xg{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=on(o.length),d=on(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const p=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const m=`getUpdates(${f})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z8{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=on(o.length),d=on(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const p=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const m=`getUpdates(${f})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides",b=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=Ii(o,r,i),p=[h/l,l];if(h===0)return t.makeTensorInfo(i,r.dtype);const f=We({inputs:{x:r},backend:t,attrs:{shape:[c,a]}}),m=We({inputs:{x:o},backend:t,attrs:{shape:[c,l]}}),g=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;he().getBool("WEBGL_PACK")?x=new Z8(c,a,f.shape.length,m.shape.length,d,p):x=new Xg(c,a,f.shape.length,m.shape.length,d,p);const y=t.runWebGLProgram(x,[m,f,g],m.dtype),b=We({inputs:{x:y},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(g),b}const t7={kernelName:mb,backendName:"webgl",kernelFunc:e7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n7{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=he().getNumber("WEBGL_VERSION")===2?o:i,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=new n7(r.shape[0],r.shape[1],o.shape[1],i),c=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",c)}const r7={kernelName:xb,backendName:"webgl",kernelFunc:s7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o7{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let d=0;d<t.length;d++)l.push(`${a[d]}`),d<e&&c.push(`${a[d]}`);r=c.join(),o=l.join()}const i=on(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new o7(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],Rs(r.dtype,o.dtype))}const a7={kernelName:Ld,backendName:"webgl",kernelFunc:i7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${oh};
  float scale = ${ih};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,l7=qt({opSnippet:c7}),u7={kernelName:Jc,backendName:"webgl",kernelFunc:l7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7=Ra+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,h7=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,p7=qt({opSnippet:d7,packedOpSnippet:h7,cpuKernelImpl:h5}),f7={kernelName:nl,backendName:"webgl",kernelFunc:p7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,g7=qt({opSnippet:m7}),x7={kernelName:tl,backendName:"webgl",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=Ra+`
  return sin(x);
`,b7=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Ei}
  return result;
`,w7=qt({opSnippet:y7,packedOpSnippet:b7}),v7={kernelName:Zc,backendName:"webgl",kernelFunc:w7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,C7=qt({opSnippet:S7}),N7={kernelName:el,backendName:"webgl",kernelFunc:C7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,k7=qt({opSnippet:I7}),$7={kernelName:sl,backendName:"webgl",kernelFunc:k7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;E(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,b)=>y*b),c=[[0,0]];c.push(...i);for(let y=1+o.length;y<r.shape.length;++y)c.push([0,0]);const l=[],d=PN({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),h=gl(d.shape,o,a,!1),p=xl(h.length,o.length,!1),f=yl(d.shape,o,a,!1),m=We({inputs:{x:d},backend:t,attrs:{shape:h}}),g=ls({inputs:{x:m},backend:t,attrs:{perm:p}}),x=We({inputs:{x:g},backend:t,attrs:{shape:f}});return l.push(d),l.push(m),l.push(g),l.forEach(y=>t.disposeIntermediateTensorInfo(y)),x},A7={kernelName:Bd,backendName:"webgl",kernelFunc:T7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(s.dataId),c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[h,p,f,m,g]=f5(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(p,s.dtype,h),t.makeTensorInfo([p[0]],r.dtype,f),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const R7={kernelName:yb,backendName:"webgl",kernelFunc:E7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),c=Array.from(t.readSync(o.dataId)),[l,d,h]=m5(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const j7={kernelName:bb,backendName:"webgl",kernelFunc:D7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=iN(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const P7={kernelName:wb,backendName:"webgl",kernelFunc:_7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=iN(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const F7={kernelName:vb,backendName:"webgl",kernelFunc:M7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:p}=Ii(o,r,a),f=!1;if(o.dtype==="string"){const y=t.bufferSync(r),b=t.bufferSync(o),v=No(t.readSync(i.dataId)[0]),w=d5(y,b,a,p,d,l,c,h,v,f);return t.makeTensorInfo(a,w.dtype,w.values)}const m=new Xg(l,c,r.shape.length,o.shape.length,h,[p,1],f),g=t.runWebGLProgram(m,[o,r,i],o.dtype),x=We({inputs:{x:g},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(g),x}const L7={kernelName:Sb,backendName:"webgl",kernelFunc:O7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Lt(i,r.shape)[0],c=lg(r,o,a),l=r.shape.length,d=new Array(l).fill(0),h=r.shape.slice();return c.map(p=>{const f=[...h];f[a]=p;const m=Da({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});return d[a]+=p,m})}const W7={kernelName:Vd,backendName:"webgl",kernelFunc:z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const py="return sqrt(x);",B7=qt({opSnippet:py,packedOpSnippet:py,cpuKernelImpl:g5}),V7={kernelName:rl,backendName:"webgl",kernelFunc:B7};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7="return x * x;",G7=qt({opSnippet:U7}),H7={kernelName:Hf,backendName:"webgl",kernelFunc:G7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fy="return (a - b) * (a - b);",q7=Yn({opSnippet:fy,packedOpSnippet:fy}),K7={kernelName:ol,backendName:"webgl",kernelFunc:q7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),i=no(o),a=x5(i,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const X7={kernelName:qf,backendName:"webgl",kernelFunc:Q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=sr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Rr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const J7={kernelName:ul,backendName:"webgl",kernelFunc:Y7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z7{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=on(s.length),i=on(s.length);let a="";if(r===1)a="coords * strides + begin";else{let c=0;a=s.map((l,d)=>(c++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${c-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:p}=s,{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=Gm(r.shape,o,i,a,c,l,d,h,p);let S;if(g)S=We({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){E(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=Bm(b,v,w),k=Da({inputs:{x:r},backend:t,attrs:{begin:b,size:C}});S=We({inputs:{x:k},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(k)}else if(t.shouldExecuteOnCPU([r])){const k=t.readSync(r.dataId),I=Ot(r.shape,r.dtype,k),T=y5(f,I,w,b);S=t.makeTensorInfo(m,r.dtype,T.values)}else{const k=new Z7(b,w,f);S=t.runWebGLProgram(k,[r],r.dtype)}const N=We({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),N}const tK={kernelName:Kf,backendName:"webgl",kernelFunc:eK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,p=t.readSync(d.dataId),f=t.readSync(h.dataId),[m,g]=b5(p,f,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const sK={kernelName:Cb,backendName:"webgl",kernelFunc:nK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),c=t.readSync(i.dataId)[0],[l,d,h]=w5(a,c,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const oK={kernelName:Nb,backendName:"webgl",kernelFunc:rK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=v5(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const aK={kernelName:Ib,backendName:"webgl",kernelFunc:iK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK="return tan(x);",lK=qt({opSnippet:cK}),uK={kernelName:al,backendName:"webgl",kernelFunc:lK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,hK=qt({opSnippet:dK}),pK={kernelName:cl,backendName:"webgl",kernelFunc:hK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=Ii(i,o,r.shape),p=[h/l,l];if(h===0)return t.makeTensorInfo(r.shape,o.dtype);const f=We({inputs:{x:o},backend:t,attrs:{shape:[c,a]}}),m=We({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),g=We({inputs:{x:r},backend:t,attrs:{shape:p}}),x=new Xg(c,a,f.shape.length,m.shape.length,d,p,!1,!0),y=t.runWebGLProgram(x,[m,f,g],g.dtype),b=We({inputs:{x:y},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const mK={kernelName:gb,backendName:"webgl",kernelFunc:fK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gK{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=on(this.rank),o=xK(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function xK(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const c=t.readSync(r.dataId),l=r.dtype==="string"?c.map(p=>No(p)):c,d=Ot(r.shape,r.dtype,l),h=C5(d,o);return t.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new gK(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const yK={kernelName:ll,backendName:"webgl",kernelFunc:FN};class bK{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class wK{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vo(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function my(n){let e=1;for(;e<n;)e*=2;return e}function vK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,a=he().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=he().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,d=l[l.length-1];if(t.shouldExecuteOnCPU([r])||d<a||o>c){const T=t.readSync(r.dataId),[_,D]=N5(T,l,r.dtype,o,i);return[t.makeTensorInfo(_.shape,_.dtype,_.values),t.makeTensorInfo(D.shape,D.dtype,D.values)]}if(o===0)return l[l.length-1]=0,[t.makeTensorInfo(l,r.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(d===1)return[r,Dl({attrs:{shape:l,dtype:"int32",value:0},backend:t})];const h=t.texData.get(r.dataId),p=h!==null&&h.isPacked,f=p?t.unpackTensor(r):r,g=we(l)/d,x=We({inputs:{x:f},attrs:{shape:[g,d]},backend:t});p&&Vo(t,f);const y=my(o),b=my(d);let v=null;const w=()=>v===null?[x,x]:[x,v],S=(T,_,D)=>{const P=w(),A=new bK(D),O=[[d],[v===null?1:0],[Number.NEGATIVE_INFINITY],[T],[_]],V=v;v=t.runWebGLProgram(A,P,"int32",O),Vo(t,V)};for(let T=1;T<y;T*=2){const _=T*2;for(let D=T;D>=1;D/=2)S(_,D,[g,b])}for(let T=b;T>y;T/=2){const _=w(),D=new wK([g,T/2]),A=[[d],[v===null?1:0],[y]],F=v;v=t.runWebGLProgram(D,_,"int32",A),Vo(t,F);const O=y/2,V=O*2;for(let L=O;L>=1;L/=2)S(V,L,v.shape)}let N=v;v=Da({inputs:{x:v},backend:t,attrs:{begin:0,size:[g,o]}}),Vo(t,N);let C=AN({inputs:{x,indices:v},backend:t,attrs:{axis:1,batchDims:1}});Vo(t,x);const k=l.slice(0,-1);k.push(o),N=v,v=We({inputs:{x:v},attrs:{shape:k},backend:t}),Vo(t,N);const I=C;return C=We({inputs:{x:C},attrs:{shape:k},backend:t}),Vo(t,I),[C,v]}const SK={kernelName:Qf,backendName:"webgl",kernelFunc:vK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CK{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NK(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=s,[d,h,p,f]=r.shape,[m,g]=l??[h,p],x=[d,m,g,f],y=new CK(h,p,i,a,c,x);return t.runWebGLProgram(y,[r,o],"float32")}const IK={kernelName:Xf,backendName:"webgl",kernelFunc:NK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kK(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Al(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:c,indices:l}=I5(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const $K={kernelName:Yf,backendName:"webgl",kernelFunc:kK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,c=r.shape[o],l=new Array(a-1);let d=0;for(let g=0;g<a;g++)g!==o&&(l[d++]=i.shape[g]);const h=[],p=new Array(a).fill(0),f=i.shape.slice();f[o]=1;const m=new Array(c);for(let g=0;g<m.length;g++){p[o]=g;const x=Da({inputs:{x:i},backend:t,attrs:{begin:p,size:f}}),y=We({inputs:{x},backend:t,attrs:{shape:l}});m[g]=y,h.push(x)}return h.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const AK={kernelName:Gd,backendName:"webgl",kernelFunc:TK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EK{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const c="0.0",l="sumValue",d=Math.floor(s/4)*4,h=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let f="";o%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,c=[];let l=0;const d=Sn([l],a);let h=r;d!=null&&(h=ls({inputs:{x:r},backend:t,attrs:{perm:d}}),c.push(h),l=Tn(1,a)[0]);const p=bv(h.shape,l,i),f=we([h.shape[l]]),m=We({inputs:{x:h},backend:t,attrs:{shape:[-1,f]}});c.push(m);const g=em(r.dtype),x=(w,S,N,C,k)=>{const I=w.shape[0],T=w.shape[1],_=yv(T,k),D={windowSize:_,inSize:T,batchSize:I,numSegments:k},P=new EK(D,S),A=t.compileAndRun(P,[w,N],C);if(c.push(A),A.shape[1]===k)return A;const F=MN({backend:t,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),O=FN({inputs:{x:F},backend:t,attrs:{reps:[T/_]}});return c.push(F),c.push(O),x(A,S,O,C,k)},y=x(m,"unsortedSegmentSum",o,g,i),b=We({inputs:{x:y},backend:t,attrs:{shape:p}});let v=b;if(d!=null){c.push(b);const w=_o(d);v=ls({inputs:{x:v},backend:t,attrs:{perm:w}})}return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const DK={kernelName:Hd,backendName:"webgl",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jK=[gV,yV,vV,NV,kV,AV,RV,jV,FV,LV,BV,GV,KV,JV,tU,sU,oU,lU,dU,pU,xU,NU,kU,EU,DU,OU,zU,UU,Z5,qU,JU,n6,c6,d6,p6,m6,x6,v6,N6,$6,A6,R6,j6,M6,O6,B6,U6,q6,X6,J6,nG,iG,uG,pG,gG,xG,bG,vG,CG,IG,$G,RG,_G,FG,LG,BG,GG,QG,ZG,J5,tH,XU,rH,aH,uH,tV,fH,yH,wH,NH,$H,RH,_H,OH,BH,GH,qH,YH,ZH,tq,oq,aq,lq,dq,pq,xq,vq,Iq,jq,rV,Fq,zq,Vq,Hq,_U,Qq,Yq,Zq,n8,i8,sV,c8,u8,h8,f8,m8,PU,Aq,y8,S8,k8,iV,E8,j8,F8,z8,U8,H8,Q8,J8,t7,r7,a7,u7,f7,x7,v7,N7,SU,Rq,$7,A7,R7,j7,P7,F7,L7,W7,V7,H7,K7,X7,J7,tK,sK,oK,aK,Eq,pV,uK,pK,mK,yK,SK,IK,fV,$K,AK,DK,Xq];for(const n of jK)$b(n);const Is=class Is{constructor(){Ne(this,"mlModel",null);Ne(this,"mlEnabled",!1);Ne(this,"mlState",{initialized:!1,ready:!1,trainingCount:0,lastTrainedAt:null,accuracy:null})}async analyze(e){const t=this.analyzeByRules(e);if(this.canUseML(e))try{const s=await this.analyzeByML(e);return this.mergeSignals(t,s,e)}catch(s){R.warn(`[${this.name}] ML analysis failed, using rules only`,s)}return t}async initializeML(e){if(this.mlState.initialized){R.info(`[${this.name}] ML already initialized`);return}try{const t=e||`/models/${this.id}/model.json`,s=`${this.id}_${t}`,r=Is.modelCache.get(s);if(r){this.mlModel=r,await this.loadPersonalWeights(),this.mlState.initialized=!0,this.mlState.ready=!0,R.info(`[${this.name}] ‚úÖ ML model loaded from cache (weights reloaded)`);return}R.info(`[${this.name}] Loading ML model from ${t}`),this.mlModel=await qP(t),await this.loadPersonalWeights(),Is.modelCache.set(s,this.mlModel),this.updateMemoryUsage(),this.mlState.initialized=!0,this.mlState.ready=!0,R.info(`[${this.name}] ‚úÖ ML initialized successfully`)}catch{this.mlState.initialized=!1,this.mlState.ready=!1,await this.createFallbackModel()}}async createFallbackModel(){try{const e=this.getFeatureDimension();this.mlModel=XP({layers:[Yh({inputShape:[e],units:Math.ceil(e*.7),activation:"relu",kernelInitializer:"glorotUniform"}),fM({rate:.2}),Yh({units:Math.ceil(e*.5),activation:"relu"}),Yh({units:this.getOutputDimension(),activation:"sigmoid"})]}),this.mlModel.compile({optimizer:Go.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.mlState.initialized=!0,this.mlState.ready=!0,R.info(`[${this.name}] ‚úÖ Fallback model created`)}catch(e){R.error(`[${this.name}] Failed to create fallback model`,e)}}async learn(e,t){if(!(!this.mlEnabled||!this.mlState.ready||!this.mlModel))try{const s=this.extractFeatures(e),r=this.outcomeToLabel(t),o=await this.mlModel.fit(Yi([s]),Yi([r]),{epochs:1,verbose:0,shuffle:!1});this.mlState.trainingCount++,this.mlState.lastTrainedAt=Date.now(),o.history.acc&&(this.mlState.accuracy=o.history.acc[0]),this.mlState.trainingCount%10===0&&(await this.savePersonalWeights(),R.debug(`[${this.name}] Weights saved (${this.mlState.trainingCount} trainings)`))}catch(s){R.error(`[${this.name}] Learning failed`,s)}}async predict(e){if(!this.mlModel)throw new Error("ML model not initialized");const t=performance.now(),s=Yi([e]),r=this.mlModel.predict(s),o=await r.data();return s.dispose(),r.dispose(),performance.now()-t,{values:Array.from(o),confidence:this.calculatePredictionConfidence(Array.from(o)),timestamp:Date.now()}}canUseML(e){return this.mlEnabled&&this.mlState.ready&&this.mlModel!==null&&this.hasEnoughData(e)}hasEnoughData(e){const t=e.progress;return t?(t.memorizationAttempts??0)>=10:!1}outcomeToLabel(e){return[e.wasCorrect?0:1]}calculatePredictionConfidence(e){return 1-Array.from(e).reduce((s,r)=>r>0&&r<1?s-(r*Math.log2(r)+(1-r)*Math.log2(1-r)):s,0)/e.length}async savePersonalWeights(){if(this.mlModel)try{const e=this.mlModel.getWeights(),t=await this.serializeWeights(e),s={version:"1.0",timestamp:Date.now(),weights:t,metadata:{trainingCount:this.mlState.trainingCount,accuracy:this.mlState.accuracy}};localStorage.setItem(`ml-weights-${this.id}`,JSON.stringify(s))}catch(e){R.error(`[${this.name}] Failed to save weights`,e)}}async loadPersonalWeights(){try{const e=localStorage.getItem(`ml-weights-${this.id}`);if(!e||!this.mlModel)return;const t=JSON.parse(e),s=await this.deserializeWeights(t.weights);this.mlModel.setWeights(s),this.mlState.trainingCount=t.metadata.trainingCount,this.mlState.accuracy=t.metadata.accuracy,R.info(`[${this.name}] Personal weights loaded (${t.metadata.trainingCount} trainings)`)}catch(e){R.warn(`[${this.name}] Failed to load personal weights`,e)}}async serializeWeights(e){const t=await Promise.all(e.map(async s=>Array.from(await s.data())));return btoa(JSON.stringify(t))}async deserializeWeights(e){return JSON.parse(atob(e)).map(s=>Qi(s))}enableML(){this.mlEnabled=!0,R.info(`[${this.name}] ML enabled`)}disableML(){this.mlEnabled=!1,R.info(`[${this.name}] ML disabled`)}getMLState(){return{...this.mlState}}updateMemoryUsage(){try{const t=kp().numBytes/(1024*1024);Is.memoryUsage.current=t,Is.memoryUsage.peak=Math.max(Is.memoryUsage.peak,t),Is.memoryUsage.lastCheck=Date.now(),t>100}catch(e){R.warn(`[${this.name}] Memory check failed`,e)}}static getMemoryUsage(){return{...Is.memoryUsage}}static clearModelCache(){Is.modelCache.forEach(e=>{try{e.dispose()}catch(t){R.warn("Failed to dispose model",t)}}),Is.modelCache.clear(),R.info("ML model cache cleared")}};Ne(Is,"modelCache",new Map),Ne(Is,"memoryUsage",{current:0,peak:0,lastCheck:Date.now()}),Ne(Is,"initWarningShown",new Set);let so=Is;const Nr={MASTERED:3,LEARNING:2,STRUGGLING:1,INCORRECT:3,HIGH_PRIORITY:2},Ui={EXCELLENT:.9,GOOD:.8,FAIR:.6,POOR:.5},_n={MASTERED_PERFECT:10,MASTERED_ALMOST:15,ONE_SHOT_CORRECT:18,NEAR_MASTERY:25,NEW_NEAR_MASTERY:30,NEW_DEFAULT:35,STILL_LEARNING_LOW:45,STILL_LEARNING_DEFAULT:50,INCORRECT_LIGHT:55,INCORRECT_MEDIUM:70,INCORRECT_HIGH:75,INCORRECT_URGENT:85},Oi={STILL_LEARNING_MAX:15,STILL_LEARNING_MULTIPLIER:5,TIME_DECAY_MAX:15,TIME_DECAY_MULTIPLIER:1.5},_K={QUICK_LEARNER:2};function PK(n){return Math.max(0,Math.min(100,n))}function ON(n,e){switch(e){case"memorization":return n.memorizationPosition;case"translation":return n.translationPosition;case"spelling":return n.spellingPosition;case"grammar":return n.grammarPosition}}function LN(n,e){switch(e){case"memorization":return{attempts:n.memorizationAttempts||0,correct:n.memorizationCorrect||0,stillLearning:n.memorizationStillLearning||0};case"translation":return{attempts:n.translationAttempts||0,correct:n.translationCorrect||0,stillLearning:0};case"spelling":return{attempts:n.spellingAttempts||0,correct:n.spellingCorrect||0,stillLearning:0};case"grammar":return{attempts:n.grammarAttempts||0,correct:n.grammarCorrect||0,stillLearning:0}}}function zN(n){const{mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}=n,c=s>0?(r+o*.5)/s:0,l=t>=40&&t<70;return e==="memorization"&&o===0&&l&&i===Nr.STRUGGLING&&a===0&&c>=Ui.FAIR?{decision:"ignore_saved_position",reason:"auto_promoted_still_learning_progress",accuracyForOverride:c}:{decision:"use_saved_position",reason:"other",accuracyForOverride:c}}function MK(n,e="memorization"){if(!n)return null;const t=ON(n,e);if(t==null)return null;const{attempts:s,correct:r,stillLearning:o}=LN(n,e),i=n.consecutiveCorrect||0,a=n.consecutiveIncorrect||0,c=zN({mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a});return{mode:e,savedPosition:t,decision:c.decision,reason:c.reason,accuracyForOverride:c.accuracyForOverride,modeAttempts:s,modeCorrect:r,modeStillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}}function Bt(n,e="memorization"){if(!n)return _n.NEW_DEFAULT;const t=ON(n,e),s=LN(n,e),r=s.attempts,o=s.correct,i=s.stillLearning,a=n.consecutiveCorrect||0,c=n.consecutiveIncorrect||0,l=n.lastStudied||Date.now();if(t!=null){if(a>=Nr.MASTERED)return _n.MASTERED_PERFECT;if(a>=Nr.LEARNING)return(r>0?(o+i*.5)/r:0)>=Ui.GOOD?_n.MASTERED_ALMOST:_n.NEAR_MASTERY;if(zN({mode:e,savedPosition:t,attempts:r,correct:o,stillLearning:i,consecutiveCorrect:a,consecutiveIncorrect:c}).decision!=="ignore_saved_position")return t}const d=(Date.now()-l)/(1e3*60*60*24),h=o+i*.5,p=r>0?h/r:0;if(r===0)return _n.NEW_DEFAULT;if(a>=Nr.MASTERED)return _n.MASTERED_PERFECT;if(a>=Nr.LEARNING)return p>=Ui.GOOD?_n.MASTERED_ALMOST:_n.NEAR_MASTERY;if(e==="memorization"&&i>0&&c===0&&a<Nr.LEARNING){const y=Math.min(i*Oi.STILL_LEARNING_MULTIPLIER,Oi.STILL_LEARNING_MAX);return Math.min(_n.STILL_LEARNING_LOW+y,_n.STILL_LEARNING_DEFAULT)}if(a===Nr.STRUGGLING)return p>=Ui.EXCELLENT&&r<=_K.QUICK_LEARNER?_n.ONE_SHOT_CORRECT:p>=Ui.FAIR?_n.NEW_NEAR_MASTERY:_n.STILL_LEARNING_LOW;if(c>=Nr.INCORRECT)return _n.INCORRECT_URGENT;if(c>=Nr.HIGH_PRIORITY)return _n.INCORRECT_HIGH;if(c>=Nr.STRUGGLING)return p>=Ui.POOR?_n.INCORRECT_LIGHT:_n.INCORRECT_MEDIUM;if(i>0&&a===0&&c===0){const y=Math.min(i*Oi.STILL_LEARNING_MULTIPLIER,Oi.STILL_LEARNING_MAX);return Math.min(_n.STILL_LEARNING_LOW+y,_n.STILL_LEARNING_DEFAULT)}const f=_n.STILL_LEARNING_DEFAULT-p*30+c*10,m=Math.min(d*Oi.TIME_DECAY_MULTIPLIER,Oi.TIME_DECAY_MAX),g=f+m;return PK(g)}function Qr(n){return n>=70?"incorrect":n>=40?"still_learning":n>=20?"new":"mastered"}const Gs=class Gs{calculateNextReview(e,t=Gs.DEFAULT_EASE_FACTOR,s=Gs.FIRST_INTERVAL,r=0){const o=this.updateEaseFactor(t,e),i=this.updateRepetitions(r,e),a=this.calculateInterval(i,s,o,e),c=new Date(Date.now()+a*24*60*60*1e3);return{nextInterval:a,easeFactor:o,repetitions:i,nextReviewDate:c}}updateEaseFactor(e,t){const s=e+(.1-(5-t)*(.08+(5-t)*.02));return Math.max(Gs.MIN_EASE_FACTOR,s)}updateRepetitions(e,t){return t<3?0:e+1}calculateInterval(e,t,s,r){if(r<3)return Gs.FIRST_INTERVAL;switch(e){case 1:return Gs.FIRST_INTERVAL;case 2:return Gs.SECOND_INTERVAL;default:return Math.round(t*s)}}determineQuality(e,t,s=!1,r=1){return e?t<3e3&&!s?5:t<5e3&&!s?4:t<1e4?3:2:r>2?0:1}getQualityDescription(e){return{0:"ÂÆåÂÖ®Â§±Êïó - ÂÖ®„ÅèÊÄù„ÅÑÂá∫„Åõ„Å™„ÅÑ",1:"Â§±Êïó - ÊÄù„ÅÑÂá∫„Åõ„Å™„Åã„Å£„Åü„Åå„ÄÅÁ≠î„Åà„ÇíË¶ã„Å¶Á¥çÂæó",2:"Èï∑ËÄÉÊ≠£Ëß£ - „Åã„Å™„ÇäËÄÉ„Åà„Å¶Ê≠£Ëß£",3:"Ê≠£Ëß£ÔºàËø∑„ÅÑÊúâÔºâ - Â∞ë„ÅóËÄÉ„Åà„Å¶Ê≠£Ëß£",4:"Ê≠£Ëß£ÔºàËø∑„ÅÑÁÑ°Ôºâ - „Åô„Åê„Å´Ê≠£Ëß£",5:"ÂÆåÁíß - Áû¨ÊôÇ„Å´Ê≠£Ëß£"}[e]}logCalculation(e,t,s,r,o){}};Ne(Gs,"MIN_EASE_FACTOR",1.3),Ne(Gs,"DEFAULT_EASE_FACTOR",2.5),Ne(Gs,"FIRST_INTERVAL",1),Ne(Gs,"SECOND_INTERVAL",6);let Yp=Gs;const ks=class ks{calculateRetention(e,t){const r=1/Math.max(ks.MIN_STRENGTH,Math.min(ks.MAX_STRENGTH,t)),o=Math.exp(-e*r);return Math.max(0,Math.min(1,o))}calculateMemoryStrength(e){const t=ks.MIN_STRENGTH,s=(e.consecutiveCorrect||0)*1.5,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0,a=(r>0?o/r:0)*3,c=Math.min(r*.2,2),d=(e.memorizationStillLearning||0)*.5,p=(e.consecutiveIncorrect||0)*1,f=t+s+a+c-d-p;return Math.max(ks.MIN_STRENGTH,Math.min(ks.MAX_STRENGTH,f))}suggestReviewTiming(e,t=ks.TARGET_RETENTION){return e<t-.2?"now":e<t-.1?"soon":e<t+.1?"scheduled":"later"}analyzeRetention(e,t,s=ks.TARGET_RETENTION){const r=this.calculateMemoryStrength(e),o=this.calculateRetention(t,r),i=this.suggestReviewTiming(o,s);return{retention:o,memoryStrength:r,daysSince:t,reviewUrgency:i}}predictDecayDays(e,t=ks.TARGET_RETENTION){const s=-e*Math.log(t);return Math.max(0,s)}calculateNextReviewDate(e,t=ks.TARGET_RETENTION){const s=this.calculateMemoryStrength(e),r=this.predictDecayDays(s,t),o=Date.now()+r*24*60*60*1e3;return new Date(o)}logAnalysis(e,t){}getReviewUrgencyLabel(e){return{now:"‰ªä„Åô„ÅêÂæ©Áøí",soon:"ËøëÊó•‰∏≠„Å´Âæ©Áøí",scheduled:"„Çπ„Ç±„Ç∏„É•„Éº„É´ÈÄö„Çä",later:"ÂæåÂõû„Åó„ÅßOK"}[e]}getStrengthDescription(e){return e>=9?"Ë∂ÖÂº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂ÂÆåÂÖ®ÂÆöÁùÄÔºâ":e>=7?"Âº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠Ôºâ":e>=5?"‰∏≠Á®ãÂ∫¶ÔºàÁü≠ÊúüË®òÊÜ∂„Åã„ÇâÁßªË°å‰∏≠Ôºâ":e>=3?"Âº±„ÅÑÔºà„Åæ„Å†Áü≠ÊúüË®òÊÜ∂Ôºâ":"ÈùûÂ∏∏„Å´Âº±„ÅÑÔºà‰ΩúÊ•≠Ë®òÊÜ∂„É¨„Éô„É´Ôºâ"}};Ne(ks,"TARGET_RETENTION",.9),Ne(ks,"MIN_STRENGTH",1),Ne(ks,"MAX_STRENGTH",10);let Jp=ks;var Ha=(n=>(n.WORKING_MEMORY="working",n.SHORT_TERM="short",n.CONSOLIDATING="consolidating",n.LONG_TERM="long",n))(Ha||{});const kr=class kr{determineMemoryStage(e){const t=this.getDaysSinceFirstAttempt(e),s=e.consecutiveCorrect||0,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0;if(t>=30&&s>=3&&r>=10)return"long";const i=r>0?o/r:0;return t>=7&&s>=2&&i>=.7?"consolidating":t>=1&&o>0?"short":"working"}getDaysSinceFirstAttempt(e){const t=e.firstAttempted||Date.now(),s=(Date.now()-t)/(1e3*60*60*24);return Math.max(0,s)}getReviewIntervals(e){return{working:kr.WORKING_MEMORY_INTERVALS,short:kr.SHORT_TERM_INTERVALS,consolidating:kr.CONSOLIDATING_INTERVALS,long:kr.LONG_TERM_INTERVALS}[e]}calculateNextReviewInterval(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s),o=t.repetitions,i=r[Math.min(o,r.length-1)],a=t.nextInterval,c=(i+a)/2;return Math.max(.01,c)}analyzeMemoryStage(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s);let o;t?o=this.calculateNextReviewInterval(e,t):o=r[0];const i=this.getStageDescription(s);return{stage:s,recommendedIntervals:r,nextInterval:o,description:i}}getStageDescription(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂ - ÂàùÂõûÂ≠¶ÁøíÁõ¥Âæå„ÄÅÁü≠ÊúüÈñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å",short:"Áü≠ÊúüË®òÊÜ∂ - 1-2ÈÄ±Èñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å„ÄÅÂÆöÁùÄ„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„Çã",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠ - Èï∑ÊúüË®òÊÜ∂„Å∏„ÅÆÁßªË°åÈÅéÁ®ã„ÄÅÊúàÂçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅåÊé®Â•®",long:"Èï∑ÊúüË®òÊÜ∂ - ÂÆåÂÖ®„Å´ÂÆöÁùÄ„ÄÅÂçäÂπ¥ÔΩûÂπ¥Âçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅßÂçÅÂàÜ"}[e]}suggestPriorityAdjustment(e,t){const r=this.getReviewIntervals(e)[0];return t>r*1.5?20:t>r?10:t<r*.5?-10:0}logAnalysis(e,t){}getStageLabel(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂",short:"Áü≠ÊúüË®òÊÜ∂",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠",long:"Èï∑ÊúüË®òÊÜ∂"}[e]}};Ne(kr,"WORKING_MEMORY_INTERVALS",[1/1440,10/1440,1/24,.5]),Ne(kr,"SHORT_TERM_INTERVALS",[1,3,7,14]),Ne(kr,"CONSOLIDATING_INTERVALS",[14,30,60,90]),Ne(kr,"LONG_TERM_INTERVALS",[180,365,730]);let Zp=kr;class WN extends so{constructor(){super();Ne(this,"id","memory");Ne(this,"name","Memory AI");Ne(this,"icon","üß†");Ne(this,"sm2");Ne(this,"forgettingCurve");Ne(this,"longTermStrategy");this.sm2=new Yp,this.forgettingCurve=new Jp,this.longTermStrategy=new Zp}proposePosition(t,s,r,o,i){if(i===0)return 35;let a=50;const c=this.longTermStrategy.determineMemoryStage(t),l=this.longTermStrategy.suggestPriorityAdjustment(c,r);a+=l;const d=this.determineQuality(t),h=this.sm2.calculateNextReview(d,t.easeFactor||2.5,t.lastInterval||1,t.repetitions||0),p=new Date,f=Math.floor((h.nextReviewDate.getTime()-p.getTime())/(1e3*60*60*24));f<=0?a+=30:f<=2?a+=15:f>=7&&(a-=20);const m=this.forgettingCurve.analyzeRetention(t,r);m.retention<.5?a+=25:m.retention>.8&&(a-=15);const g=o*30;a-=g;const x=Math.min(r*5,40);return a+=x,Math.max(0,Math.min(100,a))}analyzeByRules(t){const{word:s,progress:r,currentTab:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"";if(!r||!r.memorizationAttempts)return this.createNewWordSignal(i);const a=this.determineCategory(r),c=this.calculateForgettingRisk(r),l=this.calculateTimeBoost(r,o),d=this.calculateRetentionStrength(r),h=this.getDaysSinceLastStudy(r),p=this.determineQuality(r),f=this.sm2.calculateNextReview(p,r.easeFactor||2.5,r.lastInterval||1,r.repetitions||0),m=this.forgettingCurve.analyzeRetention(r,h),g=this.longTermStrategy.analyzeMemoryStage(r,f),x={[Ha.WORKING_MEMORY]:"WORKING_MEMORY",[Ha.SHORT_TERM]:"SHORT_TERM",[Ha.CONSOLIDATING]:"CONSOLIDATING",[Ha.LONG_TERM]:"LONG_TERM"};return{aiId:"memory",confidence:this.calculateConfidence(r),timestamp:Date.now(),forgettingRisk:c,timeBoost:l,category:a,retentionStrength:d,sm2Data:{quality:p,easeFactor:f.easeFactor,interval:f.nextInterval,repetitions:f.repetitions,nextReviewDate:f.nextReviewDate},retention:m.retention,memoryStage:x[g.stage],recommendedNextReview:f.nextReviewDate}}determineCategory(t){return Qr(Bt(t))}calculateForgettingRisk(t){const s=t.lastStudied||0,r=t.reviewInterval||1;if(s===0)return 0;const i=(Date.now()-s)/(1e3*60*60*24),a=t.memorizationAttempts||0,c=t.memorizationCorrect||0,l=t.memorizationStillLearning||0,d=c+l*.5,h=a>0?d/a*100:0;let p=i/r*100;return h<50?p*=1.5:h<70&&(p*=1.2),Math.min(p,200)}calculateTimeBoost(t,s){const r=t.lastStudied||0;if(r===0)return 0;const o=Date.now()-r,i=o/(1e3*60);if(s==="memorization")return i>=30?.6:i>=15?.5:i>=5?.3:i>=2?.15:0;const a=o/(1e3*60*60*24);return a>=7?.5:a>=3?.3:a>=1?.15:0}calculateRetentionStrength(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0,i=t.memorizationStreak||0;if(s===0)return 0;const c=(r+o*.5)/s,l=Math.min(i*.1,.3);return Math.min(c+l,1)}calculateConfidence(t){const s=t.memorizationAttempts||0;return s>=10?1:s>=5?.8:s>=3?.6:s>=1?.4:.2}createNewWordSignal(t){return{aiId:"memory",confidence:.1,timestamp:Date.now(),forgettingRisk:0,timeBoost:0,category:"new",retentionStrength:0}}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}determineQuality(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0;if(s===0)return 3;const a=(r+o*.5)/s,c=Bt(t,"memorization");switch(Qr(c)){case"incorrect":return c>=90?0:c>=80?1:2;case"still_learning":return a>=.9?4:a>=.7?3:2;case"new":return a>=.9?5:a>=.7?4:3;case"mastered":return a>=.9?5:(a>=.7,4);default:return 3}}logEnhancedAnalysis(t,s,r,o,i){console.log("[MemoryAI Phase 4 ÂàÜÊûê]",{word:t.word,sm2:{quality:i,easeFactor:s.easeFactor,interval:s.nextInterval,nextReview:s.nextReviewDate},retention:{retention:r.retention,memoryStrength:r.memoryStrength,reviewUrgency:r.reviewUrgency},memoryStage:{stage:o.stage,nextReview:o.nextInterval,description:o.description}})}validateSignal(t){return!(!t.aiId||t.aiId!=="memory"||t.confidence<0||t.confidence>1||t.forgettingRisk<0||t.forgettingRisk>200||t.timeBoost<0||t.timeBoost>1||t.retentionStrength<0||t.retentionStrength>1||!["new","incorrect","still_learning","mastered"].includes(t.category))}calculateOptimalInterval(t,s=2.5){if(t===0)return 0;if(t===1)return 1;if(t===2)return 6;const r=this.calculateOptimalInterval(t-1,s);return Math.round(r*s)}updateEasinessFactor(t,s){const r=t+(.1-(5-s)*(.08+(5-s)*.02));return Math.max(r,1.3)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"memory",confidence:r.confidence,timestamp:Date.now(),forgettingRisk:r.values[0]*100,timeBoost:r.values[1],category:this.predictCategory(r.values[2]),retentionStrength:r.values[3]}}mergeSignals(t,s,r){var c;const o=((c=r.progress)==null?void 0:c.memorizationAttempts)||0,i=Math.min(Math.max((o-10)/20,0),.7),a=1-i;return{aiId:"memory",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),forgettingRisk:t.forgettingRisk*a+s.forgettingRisk*i,timeBoost:t.timeBoost*a+s.timeBoost*i,category:o>30?s.category:t.category,retentionStrength:t.retentionStrength*a+s.retentionStrength*i,sm2Data:t.sm2Data,retention:t.retention,memoryStage:t.memoryStage,recommendedNextReview:t.recommendedNextReview}}extractFeatures(t){const{word:s,progress:r}=t;if(!r)return Array(15).fill(0);const o=r.memorizationAttempts||0,i=r.memorizationCorrect||0,a=r.consecutiveCorrect||0,c=r.consecutiveIncorrect||0;return[s.word.length/15,s.meaning.split(",").length/5,o/20,o>0?i/o:0,a/10,c/5,this.getDaysSinceLastStudy(r)/30,new Date().getHours()/24,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,t.sessionStats.questionsAnswered||t.sessionStats.totalAttempts/50,t.sessionStats.currentAccuracy||(t.sessionStats.totalAttempts>0?t.sessionStats.correctAnswers/t.sessionStats.totalAttempts:0),r.easeFactor||r.easinessFactor||2.5,this.forgettingCurve.analyzeRetention(r,this.getDaysSinceLastStudy(r)).retention]}predictCategory(t){return t<.25?"new":t<.5?"incorrect":t<.75?"still_learning":"mastered"}getFeatureDimension(){return 15}getOutputDimension(){return 4}}class BN extends so{constructor(){super(...arguments);Ne(this,"id","cognitiveLoad");Ne(this,"name","Cognitive Load AI");Ne(this,"icon","üí§")}proposePosition(t,s){const i=50+s*15;return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{sessionStats:s}=t,r=this.determineLoadLevel(s),o=this.calculateFatigueScore(s),i=this.shouldRecommendBreak(r,o,s),a=this.calculateDifficultyAdjustment(r,s);return{aiId:"cognitiveLoad",confidence:this.calculateConfidence(s),timestamp:Date.now(),loadLevel:r,fatigueScore:o,recommendedBreak:i,difficultyAdjustment:a}}determineLoadLevel(t){const s=t.totalAttempts,r=s>0?t.correctAnswers/s:1,o=t.consecutiveIncorrect;return o>=5||r<.3&&s>=10?"overload":o>=3||r<.5&&s>=5?"high":r<.7?"medium":"low"}calculateFatigueScore(t){const s=t.sessionDuration/6e4,r=t.totalAttempts,o=t.avgResponseTime||0;let i=0;return s>45?i+=.5:s>30?i+=.3:s>15&&(i+=.1),r>50?i+=.3:r>30&&(i+=.2),o>5e3?i+=.2:o>4e3&&(i+=.1),Math.min(i,1)}shouldRecommendBreak(t,s,r){return t==="overload"||s>=.7||r.consecutiveIncorrect>=4||r.sessionDuration/(1e3*60)>=45}calculateDifficultyAdjustment(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return t==="overload"?-.2:t==="high"?-.15:t==="low"&&o>=.85&&r>=10?.15:t==="low"&&o>=.75?.1:0}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.3;return s>=20?o+=.3:s>=10?o+=.2:s>=5&&(o+=.1),r>=15?o+=.3:r>=5?o+=.2:r>=2&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="cognitiveLoad"||t.confidence<0||t.confidence>1||t.fatigueScore<0||t.fatigueScore>1||t.difficultyAdjustment<-.2||t.difficultyAdjustment>.2||!["low","medium","high","overload"].includes(t.loadLevel))}logAnalysis(t,s){}getRecommendedActions(t){const s=[];return t.loadLevel==="overload"?(s.push("5-10ÂàÜ„ÅÆ‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Á∞°Âçò„Å™ÂïèÈ°å„Åã„ÇâÂÜçÈñã„Åó„Åæ„Åó„Çá„ÅÜ"),s.push("Ê∞¥ÂàÜË£úÁµ¶„Çí„Åó„Åæ„Åó„Çá„ÅÜ")):t.loadLevel==="high"?(s.push("2-3ÂàÜ„ÅÆÂ∞è‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Â∞ë„ÅóÁ∞°Âçò„Å™ÂïèÈ°å„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô")):t.recommendedBreak&&s.push("„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅÂ∞ë„Åó‰ºëÊÜ©„Åó„Åæ„Åó„Çá„ÅÜ"),t.fatigueScore>=.7&&s.push("ÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ"),s}isInFlowState(t,s){if(t.loadLevel!=="medium"&&t.loadLevel!=="low"||t.fatigueScore>.5)return!1;const r=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0;if(r<.6||r>.85)return!1;const o=s.sessionDuration/(1e3*60);return!(o<5||o>45)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="low":o<.5?i="medium":o<.75?i="high":i="overload";const a=r.values[1],c=r.values[2],l=(r.values[3]-.5)*.4;return{aiId:"cognitiveLoad",confidence:r.confidence,timestamp:Date.now(),loadLevel:i,fatigueScore:a,recommendedBreak:c>.5,difficultyAdjustment:l}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.floor(o/20),a=Math.min(Math.max((i-3)/10,0),.7),c=1-a;return{aiId:"cognitiveLoad",confidence:t.confidence*c+s.confidence*a,timestamp:Date.now(),loadLevel:i>10?s.loadLevel:t.loadLevel,fatigueScore:t.fatigueScore*c+s.fatigueScore*a,recommendedBreak:t.recommendedBreak||s.recommendedBreak,difficultyAdjustment:t.difficultyAdjustment*c+s.difficultyAdjustment*a}}extractFeatures(t){const{sessionStats:s,progress:r}=t,o=s.sessionDuration/(1e3*60),i=r&&r.memorizationAttempts||0,a=r&&r.memorizationCorrect||0,c=r&&r.consecutiveIncorrect||0;return[o/60,s.totalAttempts/50,s.questionsAnswered||s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveIncorrect/5,s.consecutiveCorrect||0,(s.averageResponseTime||s.avgResponseTime||0)/1e4,s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0,new Date().getHours()/24,new Date().getDay()/7,s.sessionStartTime?(Date.now()-s.sessionStartTime)/(1e3*60*60):0,i/20,i>0?a/i:.5,c/5,s.responseTimeVariance||0,s.slowResponseCount||0,s.fastResponseCount||0,s.timeoutCount||0]}getFeatureDimension(){return 18}getOutputDimension(){return 4}}class VN extends so{constructor(){super(...arguments);Ne(this,"id","errorPrediction");Ne(this,"name","Error Prediction AI");Ne(this,"icon","üîÆ")}proposePosition(t,s,r){const o=(1-s)*40,i=r>5&&s<.5?20:0,c=50+o+i;return Math.max(0,Math.min(100,c))}analyzeByRules(t){const{word:s,progress:r,allProgress:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"",a=this.identifyWeaknessAreas(r,o),c=this.findConfusionPairs(i,o),l=this.recommendPreemptiveReview(i,o),d=this.calculatePatternConfidence(r);return{aiId:"errorPrediction",confidence:this.calculateConfidence(r),timestamp:Date.now(),weaknessAreas:a,confusionPairs:c,preemptiveReview:l,patternConfidence:d}}identifyWeaknessAreas(t,s){const r=[],o={};return Object.values(s).forEach(i=>{const a=i.errorHistory;a==null||a.forEach(c=>{c.grammarPoint&&(o[c.grammarPoint]=(o[c.grammarPoint]||0)+1)})}),Object.entries(o).forEach(([i,a])=>{a>=3&&r.push(i)}),r}findConfusionPairs(t,s){const r=[],o=s[t],i=o==null?void 0:o.errorHistory;if(!i)return[];const a={};return i.forEach(c=>{c.userAnswer&&(a[c.userAnswer]=(a[c.userAnswer]||0)+1)}),Object.entries(a).forEach(([c,l])=>{l>=2&&r.push([t,c])}),r}recommendPreemptiveReview(t,s){const r=[];return Object.keys(s).forEach(o=>{if(o!==t&&o.substring(0,3)===t.substring(0,3)){const i=s[o],a=i.memorizationAttempts||0,c=i.memorizationCorrect||0;(a>0?c/a:0)<.6&&a>=2&&r.push(o)}}),r.slice(0,5)}calculatePatternConfidence(t){const s=t==null?void 0:t.errorHistory;if(!s)return 0;const r=s.length;return r>=5?.9:r>=3?.7:r>=2?.5:r>=1?.3:.1}calculateConfidence(t){const s=t==null?void 0:t.errorHistory,r=(s==null?void 0:s.length)||0,o=(t==null?void 0:t.memorizationAttempts)||0,i=Math.min(o/10,.5),a=Math.min(r/5,.5);return i+a}validateSignal(t){return!(!t.aiId||t.aiId!=="errorPrediction"||t.confidence<0||t.confidence>1||t.patternConfidence<0||t.patternConfidence>1||!Array.isArray(t.weaknessAreas)||!Array.isArray(t.confusionPairs)||!Array.isArray(t.preemptiveReview))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0],i=r.values[1],a=r.values[2];return{aiId:"errorPrediction",confidence:r.confidence,timestamp:Date.now(),weaknessAreas:i>.7?["predicted_weakness"]:[],confusionPairs:a>.7?[["predicted","confusion"]]:[],preemptiveReview:o>.6?["predicted_review"]:[],patternConfidence:r.confidence,errorProbability:o,weaknessLevel:i,confusionScore:a}}mergeSignals(t,s,r){var h,p;const o=r.progress,i=((h=o==null?void 0:o.errorHistory)==null?void 0:h.length)||0,a=((p=r.progress)==null?void 0:p.memorizationAttempts)||0,c=i+a;let l=Math.min(Math.max((c-10)/15,0),.8);c>50&&(l=.9);const d=1-l;return{aiId:"errorPrediction",confidence:t.confidence*d+s.confidence*l,timestamp:Date.now(),weaknessAreas:t.weaknessAreas,confusionPairs:t.confusionPairs,preemptiveReview:t.preemptiveReview,patternConfidence:t.patternConfidence*d+s.patternConfidence*l,errorProbability:s.errorProbability,weaknessLevel:s.weaknessLevel,confusionScore:s.confusionScore}}extractFeatures(t){var p;const{word:s,progress:r,allProgress:o,sessionStats:i}=t;if(!r)return Array(20).fill(0);Object.keys(o).length;const a=r,c=((p=a.errorHistory)==null?void 0:p.length)||0,l=r.memorizationAttempts||0,d=r.memorizationCorrect||0,h=l>0?d/l:0;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?1:0,s.katakana?1:0,c/10,(r.consecutiveIncorrect||0)/5,l>0?1-h:.5,0,a.lastErrorType==="spelling"?1:0,a.lastErrorType==="meaning"?1:0,l/20,(r.consecutiveCorrect||0)/10,this.getDaysSinceLastStudy(r)/30,(r.memorizationStreak||0)/10,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,i.questionsAnswered||i.totalAttempts/50,i.currentAccuracy||(i.totalAttempts>0?i.correctAnswers/i.totalAttempts:0),(i.averageResponseTime||i.avgResponseTime||0)/1e4]}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}getFeatureDimension(){return 20}getOutputDimension(){return 3}}class UN extends so{constructor(){super(...arguments);Ne(this,"id","learningStyle");Ne(this,"name","Learning Style AI");Ne(this,"icon","üéØ")}proposePosition(t,s,r){const a=50+(r>10&&s<.6?25:0);return Math.max(0,Math.min(100,a))}analyzeByRules(t){const{progress:s,allProgress:r,sessionStats:o}=t,i=this.determineStyleProfile(s,r),a=this.calculateOptimalSessionLength(r,o),c=this.inferDifficultyPreference(r,o),l=this.inferMotivationType(r);return{aiId:"learningStyle",confidence:this.calculateConfidence(r),timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:c,motivationType:l}}determineStyleProfile(t,s){var i;const r={};Object.values(s).forEach(a=>{var c;(c=a.preferredQuestionTypes)==null||c.forEach(l=>{r[l]=(r[l]||0)+1})});const o=(i=Object.entries(r).sort((a,c)=>c[1]-a[1])[0])==null?void 0:i[0];return o!=null&&o.includes("audio")||o!=null&&o.includes("pronunciation")?"auditory":o!=null&&o.includes("image")||o!=null&&o.includes("visual")?"visual":o!=null&&o.includes("writing")||o!=null&&o.includes("typing")?"kinesthetic":"reading"}calculateOptimalSessionLength(t,s){const r=[];if(Object.values(t).forEach(a=>{const c=a.studyTimePatterns;c&&r.push(...c)}),r.length===0)return 20;r.sort((a,c)=>a-c);const o=[];for(let a=1;a<r.length;a++){const l=(r[a]-r[a-1])/(1e3*60);l>=5&&l<=60&&o.push(l)}if(o.length===0)return 20;o.sort((a,c)=>a-c);const i=o[Math.floor(o.length/2)];return Math.round(i)}inferDifficultyPreference(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return o>=.8&&r>=20?"challenge":o<.6?"gradual":"mixed"}inferMotivationType(t){const s=Object.keys(t).length,r=Object.values(t).filter(i=>(i.memorizationStreak||0)>=3).length,o=s>0?r/s:0;return o>=.7?"mastery":o>=.4?"performance":"social"}calculateConfidence(t){const s=Object.keys(t).length,r=Object.values(t).reduce((i,a)=>i+(a.memorizationAttempts||0),0);let o=.3;return s>=50?o+=.3:s>=20?o+=.2:s>=10&&(o+=.1),r>=100?o+=.4:r>=50?o+=.2:r>=20&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="learningStyle"||t.confidence<0||t.confidence>1||t.optimalSessionLength<5||t.optimalSessionLength>120||!["visual","auditory","kinesthetic","reading"].includes(t.styleProfile)||!["gradual","challenge","mixed"].includes(t.preferredDifficulty)||!["mastery","performance","social"].includes(t.motivationType))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="visual":o<.5?i="auditory":o<.75?i="kinesthetic":i="reading";const a=Math.round(r.values[1]*60+10),c=r.values[2];let l;c<.33?l="gradual":c<.67?l="mixed":l="challenge";const d=r.values[3];let h;return d<.33?h="mastery":d<.67?h="performance":h="social",{aiId:"learningStyle",confidence:r.confidence,timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:l,motivationType:h}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"learningStyle",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),styleProfile:o>50?s.styleProfile:t.styleProfile,optimalSessionLength:Math.round(t.optimalSessionLength*a+s.optimalSessionLength*i),preferredDifficulty:o>50?s.preferredDifficulty:t.preferredDifficulty,motivationType:o>50?s.motivationType:t.motivationType}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=Object.values(r).reduce((a,c)=>a+(c.memorizationAttempts||0),0);return[s.sessionDuration/(1e3*60*60),s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,o/100,i/200,s.questionsAnswered||s.totalAttempts/50,(s.averageResponseTime||s.avgResponseTime||0)/1e4,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 4}}class GN extends so{constructor(){super(...arguments);Ne(this,"id","linguistic");Ne(this,"name","Linguistic AI");Ne(this,"icon","üìö")}proposePosition(t,s){const r=t.word||"",o=Math.min(r.length*2,20),i=this.calculateIrregularity(r),a=(1-s)*30,l=40+o+i+a;return Math.max(0,Math.min(100,l))}calculateIrregularity(t){const s=/([bcdfghjklmnpqrstvwxyz])\1/.test(t),r=/([qx]|[^aeiou]{4})/.test(t);return(s?5:0)+(r?10:0)}analyzeByRules(t){const{word:s,allProgress:r}=t,o=typeof s=="string"?s:(s==null?void 0:s.word)||"",i=this.calculateInherentDifficulty(o),a=this.findPhoneticallySimilarWords(o,r),c=this.findSemanticCluster(o,r),l=this.assessGrammarComplexity(o);return{aiId:"linguistic",confidence:.8,timestamp:Date.now(),inherentDifficulty:i,phoneticSimilarity:a,semanticCluster:c,grammarComplexity:l}}calculateInherentDifficulty(t){let s=0;t.length>12?s+=.3:t.length>8?s+=.2:t.length>5&&(s+=.1);const r=t.match(/[aeiou]/gi),o=r?r.length:1;return o>4?s+=.2:o>3&&(s+=.1),/[bcdfghjklmnpqrstvwxyz]{3,}/i.test(t)&&(s+=.2),/gh|ph|th|ough|augh/i.test(t)&&(s+=.1),Math.min(s,1)}findPhoneticallySimilarWords(t,s){const r=[];return Object.keys(s).forEach(o=>{o!==t&&(o.substring(0,3)===t.substring(0,3)||o.substring(o.length-3)===t.substring(t.length-3))&&r.push(o)}),r.slice(0,5)}findSemanticCluster(t,s){const r=[],o=this.extractWordRoot(t);return Object.keys(s).forEach(i=>{if(i===t)return;const a=this.extractWordRoot(i);o&&a&&o===a&&r.push(i)}),r.slice(0,5)}extractWordRoot(t){const s=["ing","ed","er","est","ly","s","es","tion","ment"];for(const r of s)if(t.endsWith(r))return t.substring(0,t.length-r.length);return t}assessGrammarComplexity(t){let s=0;return["be","have","do","go","take","get","make","know","think","see","come","want","use","find","give"].some(o=>t.includes(o))&&(s+=.3),(t.includes("-")||t.includes(" "))&&(s+=.2),(t.endsWith("tion")||t.endsWith("ment")||t.endsWith("ness"))&&(s+=.2),Math.min(s,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="linguistic"||t.confidence<0||t.confidence>1||t.inherentDifficulty<0||t.inherentDifficulty>1||t.grammarComplexity<0||t.grammarComplexity>1||!Array.isArray(t.phoneticSimilarity)||!Array.isArray(t.semanticCluster))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"linguistic",confidence:r.confidence,timestamp:Date.now(),inherentDifficulty:r.values[0],phoneticSimilarity:[],semanticCluster:[],grammarComplexity:r.values[1]}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-30)/50,0),.5),a=1-i;return{aiId:"linguistic",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),inherentDifficulty:t.inherentDifficulty*a+s.inherentDifficulty*i,phoneticSimilarity:t.phoneticSimilarity,semanticCluster:t.semanticCluster,grammarComplexity:t.grammarComplexity*a+s.grammarComplexity*i}}extractFeatures(t){var r;const{word:s}=t;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?s.ipa.length/20:0,s.katakana?s.katakana.length/20:0,/[^aeiou]{3}/.test(s.word)?1:0,/([bcdfghjklmnpqrstvwxyz])\1/.test(s.word)?1:0,s.word.split("-").length/3,s.word.includes(" ")?1:0,((r=s.word.match(/[A-Z]/g))==null?void 0:r.length)||0,/(tion|ment|ness|ing|ed)$/.test(s.word)?1:0]}getFeatureDimension(){return 10}getOutputDimension(){return 2}}class HN extends so{constructor(){super(...arguments);Ne(this,"id","contextual");Ne(this,"name","Contextual AI");Ne(this,"icon","üåç")}proposePosition(t,s){const i=50+Math.min(s*3,30);return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{word:s,currentTab:r,allProgress:o,sessionStats:i}=t,a=typeof s=="string"?s:(s==null?void 0:s.word)||"",c=this.calculateContextRelevance(a,r),l=this.evaluateTopicContinuity(a,o,i),d=this.assessEnvironmentFit(r,i),h=this.identifyCrossTabSynergy(a,r,o);return{aiId:"contextual",confidence:this.calculateConfidence(i),timestamp:Date.now(),contextRelevance:c,topicContinuity:l,environmentFit:d,crossTabSynergy:h}}calculateContextRelevance(t,s){let r=.5;return s==="memorization"&&(r+=.2),s==="grammar"&&(r+=.3),s==="comprehensive"&&(r+=.1),Math.min(r,1)}evaluateTopicContinuity(t,s,r){return r.totalAttempts>=5}assessEnvironmentFit(t,s){let r=.5;const o=s.sessionDuration/(1e3*60),i=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5,a=new Date().getHours();return a>=6&&a<12&&t==="memorization"&&(r+=.2),a>=12&&a<18&&t==="grammar"&&(r+=.2),a>=18&&t==="memorization"&&i>=.7&&(r+=.2),o<15&&t==="memorization"&&(r+=.1),Math.min(r,1)}identifyCrossTabSynergy(t,s,r){const o=[];if(s==="memorization"){const i=r[t];i!=null&&i.grammarAttempts&&i.grammarAttempts>0&&o.push("grammar-memorization-link")}if(s==="grammar"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&o.push("memorization-grammar-link")}if(s==="comprehensive"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&(i!=null&&i.grammarAttempts)&&i.grammarAttempts>0&&o.push("comprehensive-integration")}return o}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.4;return s>=10?o+=.3:s>=5&&(o+=.2),r>=10?o+=.3:r>=5&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="contextual"||t.confidence<0||t.confidence>1||t.contextRelevance<0||t.contextRelevance>1||t.environmentFit<0||t.environmentFit>1||typeof t.topicContinuity!="boolean"||!Array.isArray(t.crossTabSynergy))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"contextual",confidence:r.confidence,timestamp:Date.now(),contextRelevance:r.values[0],topicContinuity:r.values[1]>.5,environmentFit:r.values[2],crossTabSynergy:[]}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"contextual",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),contextRelevance:t.contextRelevance*a+s.contextRelevance*i,topicContinuity:t.topicContinuity||s.topicContinuity,environmentFit:t.environmentFit*a+s.environmentFit*i,crossTabSynergy:t.crossTabSynergy}}extractFeatures(t){const{currentTab:s,sessionStats:r,progress:o}=t;return[s==="memorization"?1:0,s==="grammar"?1:0,s==="comprehensive"?1:0,r.sessionDuration/(1e3*60*60),r.totalAttempts/50,r.currentAccuracy||(r.totalAttempts>0?r.correctAnswers/r.totalAttempts:0),o?(o.memorizationAttempts||0)/20:0,o?(o.grammarAttempts||0)/20:0,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class qa extends so{constructor(){super(...arguments);Ne(this,"id","gamification");Ne(this,"name","Gamification AI");Ne(this,"icon","üéÆ")}proposePosition(t,s,r){const o=s>=3?-15:0,i=r>=.8?-10:0,c=50+o+i;return Math.max(0,Math.min(100,c))}adjustPositionForInterleaving(t){var l;const s=t.filter(d=>d.position>=40),r=t.filter(d=>d.position<40);t.filter(d=>d.position>=25&&d.position<40);const o=!1;if(s.length===0)return{result:t,changed:[]};if(r.length===0)return{result:t,changed:[]};let i=0,a=0;s.length>=50?(i=.17,a=10):s.length>=20?(i=.25,a=8):s.length>=5?(i=.33,a=8):s.length>=1&&(i=.5,a=15);const c=[];if(i>0&&r.length>0){const d=Math.floor(r.length*i),h=[...r].filter(m=>m.position>=20).sort((m,g)=>g.position-m.position),p=Math.min(d,h.length);for(let m=0;m<p;m++){const g=h[m].position;h[m].position=Math.min(h[m].position+a,59);const x=((l=h[m].question)==null?void 0:l.word)||"(unknown)";c.push({word:x,before:g,after:h[m].position})}const f=t.filter(m=>{const g=(m.attempts??0)===0,x=m.position>=40;return g&&x&&m.position>=60});f.length>0;try{localStorage.setItem("debug_position_hierarchy_new",JSON.stringify({violations:f.map(m=>{var g;return{word:((g=m.question)==null?void 0:g.word)||"(unknown)",position:m.position,type:"new_exceeds_60"}}),totalNew:t.filter(m=>(m.attempts??0)===0&&m.position>=40).length,violationCount:f.length,timestamp:new Date().toISOString()}))}catch{}}return{result:t,changed:c}}boostStillLearningQuestions(t){var h;const s=t.filter(p=>p.position>=40&&p.position<70&&(p.attempts??0)>0),r=t.filter(p=>p.position>=70&&(p.attempts??0)>0),o=!1,i=r.length===0&&s.length>0;if(s.length===0)return{result:t,changed:[]};const a=[];for(const p of s){const f=p.position;let m;if(i){const x=f<50?25:f<60?15:8;m=Math.min(f+x,69),m=Math.max(m,68)}else{const x=f<50?20:f<60?10:5;m=Math.min(f+x,69),m=Math.max(m,60)}p.position=m;const g=((h=p.question)==null?void 0:h.word)||"(unknown)";a.push({word:g,before:f,after:p.position})}const c=i?68:60,l=69,d=s.filter(p=>p.position<c||p.position>l);d.length>0;try{localStorage.setItem("debug_position_hierarchy_still",JSON.stringify({mode:i?"focus":"normal",targetRange:`${c}-${l}`,violations:d.map(p=>{var f;return{word:((f=p.question)==null?void 0:f.word)||"(unknown)",position:p.position,type:p.position<c?`still_below_${c}`:`still_above_${l}`}}),totalStill:s.length,violationCount:d.length,timestamp:new Date().toISOString()})),localStorage.setItem("debug_still_learning_boost",JSON.stringify({boosted:a.length,changes:a,working:a.length>0,timestamp:new Date().toISOString()}))}catch{}return{result:t,changed:a}}interleaveByCategory(t){const r=Math.max(1,Math.round(4)),o=t.filter(p=>p.position>=40&&(p.attempts??0)>0),i=t.filter(p=>p.position>=40&&p.position<70&&(p.attempts??0)===0),a=t.filter(p=>p.position<40);if(o.length===0&&i.length===0)return t;if(i.length===0)return[...o,...a];if(o.length===0)return[...i,...a];const c=[];let l=0,d=0;for(;l<o.length||d<i.length;){const p=Math.min(r,o.length-l);for(let f=0;f<p;f++)c.push(o[l++]);d<i.length&&c.push(i[d++])}return[...c,...a]}analyzeByRules(t){const{allProgress:s,sessionStats:r}=t,o=this.calculateMotivationLevel(s,r),i=this.shouldTriggerReward(s,r),a=this.determineChallengeLevel(r),c=this.generateSocialFeedback(s,r);return{aiId:"gamification",confidence:this.calculateConfidence(s),timestamp:Date.now(),motivationLevel:o,rewardTiming:i,challengeLevel:a,socialFeedback:c}}calculateMotivationLevel(t,s){let r=.5;const o=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5;o>=.8?r+=.3:o>=.6?r+=.2:o>=.4?r+=.1:r-=.2,s.consecutiveIncorrect===0&&s.totalAttempts>=5&&(r+=.2);const i=s.masteredCount||0,a=Object.keys(t).length,c=a>0?i/a:0;c>=.7?r+=.2:c>=.5&&(r+=.1);const l=s.sessionDuration/(1e3*60);return l>45?r-=.2:l>30&&(r-=.1),Math.max(0,Math.min(r,1))}shouldTriggerReward(t,s){const r=s.masteredCount||0;if(r>0&&r%10===0||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0)>=.9&&s.totalAttempts>=10)return!0;const i=new Set;return Object.values(t).forEach(a=>{if(a.lastStudied){const c=new Date(a.lastStudied).toDateString();i.add(c)}}),i.size>=7}determineChallengeLevel(t){const s=t.totalAttempts>0?t.correctAnswers/t.totalAttempts:.5;return s>=.85?"hard":s>=.6?"medium":"easy"}generateSocialFeedback(t,s){const r=s.masteredCount||0,o=s.totalAttempts,i=o>0?s.correctAnswers/o:0;if(r>=100)return"üéâ 100Ë™û‰ª•‰∏ä„Éû„Çπ„Çø„ÉºÔºÅËã±Ë™ûÂ≠¶Áøí„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö„ÅØÂäõ„Å™„Çä";if(r>=50)return"üåü 50Ë™û„Éû„Çπ„Çø„ÉºÈÅîÊàêÔºÅÁùÄÂÆü„Å´ÊàêÈï∑‰∏≠ÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁõÆÊ®ôÈÅîÊàê";if(r>=10)return"üìö 10Ë™û„Éû„Çπ„Çø„ÉºÔºÅ„Ç≥„ÉÑ„Ç≥„ÉÑÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÂàùÂøÉËÄÖ";if(i>=.9&&o>=10)return"üíØ Ê≠£Á≠îÁéá90%‰ª•‰∏äÔºÅË™øÂ≠ê„Åå„ÅÑ„ÅÑ„Åß„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Â•ΩË™ø";const a=this.calculateStudyDays(t);return a>=30?"üî• 30Êó•ÈÄ£Á∂öÂ≠¶ÁøíÈÅîÊàêÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁøíÊÖ£Âåñ":a>=7?"‚ú® 1ÈÄ±ÈñìÈÄ£Á∂öÂ≠¶ÁøíÔºÅÁøíÊÖ£Âåñ„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö‰∏≠":""}calculateStudyDays(t){const s=new Set;return Object.values(t).forEach(r=>{if(r.lastStudied){const o=new Date(r.lastStudied).toDateString();s.add(o)}}),s.size}calculateConfidence(t){const s=Object.keys(t).length,r=this.calculateStudyDays(t);let o=.3;return s>=50?o+=.3:s>=20&&(o+=.2),r>=7?o+=.4:r>=3&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="gamification"||t.confidence<0||t.confidence>1||t.motivationLevel<0||t.motivationLevel>1||typeof t.rewardTiming!="boolean"||typeof t.socialFeedback!="string"||!["easy","medium","hard"].includes(t.challengeLevel))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[1];let i;return o<.33?i="easy":o<.67?i="medium":i="hard",{aiId:"gamification",confidence:r.confidence,timestamp:Date.now(),motivationLevel:r.values[0],rewardTiming:r.values[2]>.5,challengeLevel:i,socialFeedback:""}}mergeSignals(t,s,r){Object.keys(r.allProgress).length;const o=this.calculateStudyDays(r.allProgress),i=Math.min(Math.max((o-3)/10,0),.6),a=1-i;return{aiId:"gamification",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),motivationLevel:t.motivationLevel*a+s.motivationLevel*i,rewardTiming:t.rewardTiming||s.rewardTiming,challengeLevel:o>7?s.challengeLevel:t.challengeLevel,socialFeedback:t.socialFeedback}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=this.calculateStudyDays(r),a=s.masteredCount||0;return[s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,s.consecutiveIncorrect/5,s.sessionDuration/(1e3*60*60),s.totalAttempts/50,o/100,i/30,a/o||0,s.questionsAnswered||s.totalAttempts/50,new Date().getHours()/24]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class FK{constructor(e={}){Ne(this,"memoryAI");Ne(this,"cognitiveLoadAI");Ne(this,"errorPredictionAI");Ne(this,"learningStyleAI");Ne(this,"linguisticAI");Ne(this,"contextualAI");Ne(this,"gamificationAI");Ne(this,"config");this.memoryAI=new WN,this.cognitiveLoadAI=new BN,this.errorPredictionAI=new VN,this.learningStyleAI=new UN,this.linguisticAI=new GN,this.contextualAI=new HN,this.gamificationAI=new qa,this.config={...Lh,...e,weights:{...Lh.weights,...e.weights||{}},emergencyThresholds:{...Lh.emergencyThresholds,...e.emergencyThresholds||{}}},this.initializeMLModels().catch(t=>{console.warn("[AICoordinator] ML initialization failed, using rules only",t)}),this.checkAndEnableML()}checkAndEnableML(){try{if(typeof localStorage>"u"){console.warn("[AICoordinator] localStorage not available");return}localStorage.getItem("ab_ml_enabled")==="true"?(console.log("‚úÖ [AICoordinator] ML enabled by user setting"),this.enableML()):console.log("‚ÑπÔ∏è [AICoordinator] ML disabled by user setting")}catch(e){console.warn("[AICoordinator] Failed to check ML setting",e)}}enableML(){var e,t,s,r,o,i,a,c,l,d,h,p,f,m;try{(t=(e=this.memoryAI).enableML)==null||t.call(e),(r=(s=this.cognitiveLoadAI).enableML)==null||r.call(s),(i=(o=this.errorPredictionAI).enableML)==null||i.call(o),(c=(a=this.learningStyleAI).enableML)==null||c.call(a),(d=(l=this.linguisticAI).enableML)==null||d.call(l),(p=(h=this.contextualAI).enableML)==null||p.call(h),(m=(f=this.gamificationAI).enableML)==null||m.call(f),console.log("‚úÖ [AICoordinator] ML enabled for all specialists")}catch(g){console.warn("[AICoordinator] Failed to enable ML",g)}}async initializeMLModels(){var e,t,s,r,o,i,a,c,l,d,h,p,f,m;try{await Promise.all([(t=(e=this.memoryAI).initializeML)==null?void 0:t.call(e),(r=(s=this.cognitiveLoadAI).initializeML)==null?void 0:r.call(s),(i=(o=this.errorPredictionAI).initializeML)==null?void 0:i.call(o),(c=(a=this.learningStyleAI).initializeML)==null?void 0:c.call(a),(d=(l=this.linguisticAI).initializeML)==null?void 0:d.call(l),(p=(h=this.contextualAI).initializeML)==null?void 0:p.call(h),(m=(f=this.gamificationAI).initializeML)==null?void 0:m.call(f)]),console.log("‚úÖ [AICoordinator] ML models initialized")}catch(g){console.warn("‚ö†Ô∏è [AICoordinator] ML initialization partial failure",g)}}async learn(e,t){var s,r,o,i,a,c,l,d,h,p,f,m,g,x;try{await Promise.all([(r=(s=this.memoryAI).learn)==null?void 0:r.call(s,e,t),(i=(o=this.cognitiveLoadAI).learn)==null?void 0:i.call(o,e,t),(c=(a=this.errorPredictionAI).learn)==null?void 0:c.call(a,e,t),(d=(l=this.learningStyleAI).learn)==null?void 0:d.call(l,e,t),(p=(h=this.linguisticAI).learn)==null?void 0:p.call(h,e,t),(m=(f=this.contextualAI).learn)==null?void 0:m.call(f,e,t),(x=(g=this.gamificationAI).learn)==null?void 0:x.call(g,e,t)]),this.config.debugMode&&console.log("‚úÖ [AICoordinator] learn() completed",{word:e.word,outcome:t})}catch(y){console.warn("‚ö†Ô∏è [AICoordinator] learn() partial failure",y)}}async analyzeAndCoordinate(e,t){const[s,r,o,i,a,c,l]=await Promise.all([Promise.resolve(this.memoryAI.analyze(e)),Promise.resolve(this.cognitiveLoadAI.analyze(e)),Promise.resolve(this.errorPredictionAI.analyze(e)),Promise.resolve(this.learningStyleAI.analyze(e)),Promise.resolve(this.linguisticAI.analyze(e)),Promise.resolve(this.contextualAI.analyze(e)),Promise.resolve(this.gamificationAI.analyze(e))]);this.memoryAI.validateSignal(s)||console.warn("‚ùå Invalid MemorySignal"),this.cognitiveLoadAI.validateSignal(r)||console.warn("‚ùå Invalid CognitiveLoadSignal");const d=this.checkEmergencyConditions(s,r,e.sessionStats),h=this.calculateFinalPriority(t,s,r,o,i,a,c,l),p=this.generateRecommendedAction(s,r,l),f=this.config.debugMode?this.generateDebugInfo(t,h,s,r,o):void 0;return{finalPriority:d?.1:h,signals:{memory:s,cognitiveLoad:r,errorPrediction:o,learningStyle:i,linguistic:a,contextual:c,gamification:l},urgentFlag:d,recommendedAction:p,debug:f}}checkEmergencyConditions(e,t,s){return!!(e.forgettingRisk>=this.config.emergencyThresholds.forgettingRisk||this.config.emergencyThresholds.cognitiveOverload&&t.loadLevel==="overload"||s.consecutiveIncorrect>=this.config.emergencyThresholds.consecutiveErrors)}calculateFinalPriority(e,t,s,r,o,i,a,c){let l=e;return l*=1-t.timeBoost*this.config.weights.memory,l*=1+s.difficultyAdjustment*this.config.weights.cognitiveLoad,r.weaknessAreas.length>0&&(l*=1-r.patternConfidence*.3*this.config.weights.errorPrediction),l*=1+i.inherentDifficulty*.2*this.config.weights.linguistic,l*=1-(a.contextRelevance-.5)*.3*this.config.weights.contextual,c.motivationLevel<.3&&(l*=1-.2*this.config.weights.gamification),Math.max(.1,Math.min(l,10))}generateRecommendedAction(e,t,s){if(t.recommendedBreak)return"‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ5-10ÂàÜ„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";if(s.rewardTiming)return`üéâ ${s.socialFeedback}`;if(e.forgettingRisk>=100)return"Âæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇË®òÊÜ∂„ÅåËñÑ„Çå„ÇãÂâç„Å´Á¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}generateDebugInfo(e,t,s,r,o){const i={timeBoost:-s.timeBoost*this.config.weights.memory,difficultyAdjustment:r.difficultyAdjustment*this.config.weights.cognitiveLoad,weaknessPenalty:o.weaknessAreas.length>0?-o.patternConfidence*.3*this.config.weights.errorPrediction:0},a=`
      Base Priority: ${e.toFixed(2)}
      Time Boost: ${(i.timeBoost*100).toFixed(1)}%
      Difficulty Adjustment: ${(i.difficultyAdjustment*100).toFixed(1)}%
      Weakness Penalty: ${(i.weaknessPenalty*100).toFixed(1)}%
      Final Priority: ${t.toFixed(2)}
    `.trim();return{basePriority:e,adjustments:i,reasoning:a}}logCoordinationResult(e){}updateConfig(e){this.config={...this.config,...e,weights:{...this.config.weights,...e.weights||{}},emergencyThresholds:{...this.config.emergencyThresholds,...e.emergencyThresholds||{}}}}getConfig(){return{...this.config}}}const OK=[{prefix:"un-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["unhappy","unable","unfair"]},{prefix:"re-",meaning:"ÂÜç„Å≥„ÉªÂÖÉ„Å´",examples:["return","rebuild","review"]},{prefix:"dis-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["disagree","dislike","disappear"]},{prefix:"in-/im-",meaning:"Âê¶ÂÆö",examples:["impossible","inactive","impolite"]},{prefix:"pre-",meaning:"Ââç„Å´",examples:["preview","predict","prepare"]},{prefix:"post-",meaning:"Âæå„Å´",examples:["postwar","postpone","postgraduate"]},{prefix:"mis-",meaning:"Ë™§„Å£„Å¶",examples:["mistake","misunderstand","mislead"]},{prefix:"over-",meaning:"ÈÅéÂ∫¶„Å´",examples:["overwork","overlook","overcome"]},{prefix:"under-",meaning:"‰∏çË∂≥„Éª‰∏ã„Å´",examples:["understand","underground","underline"]},{prefix:"sub-",meaning:"‰∏ã„Å´„ÉªÂâØ„ÅÆ",examples:["subway","submarine","subtitle"]}],qN=[{suffix:"-tion/-sion",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁä∂ÊÖã",examples:["action","decision","confusion"]},{suffix:"-ment",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁµêÊûú",examples:["development","movement","agreement"]},{suffix:"-ness",pos:"noun",meaning:"ÊÄßË≥™„ÉªÁä∂ÊÖã",examples:["happiness","kindness","darkness"]},{suffix:"-ly",pos:"adverb",meaning:"ÊßòÊÖã",examples:["quickly","slowly","carefully"]},{suffix:"-ful",pos:"adjective",meaning:"ÔΩû„Å´Ê∫Ä„Å°„Åü",examples:["beautiful","careful","wonderful"]},{suffix:"-less",pos:"adjective",meaning:"ÔΩû„ÅÆ„Å™„ÅÑ",examples:["hopeless","careless","endless"]},{suffix:"-able/-ible",pos:"adjective",meaning:"ÔΩû„Åß„Åç„Çã",examples:["readable","possible","comfortable"]},{suffix:"-er/-or",pos:"noun",meaning:"‰∫∫„Éª„ÇÇ„ÅÆ",examples:["teacher","actor","writer"]},{suffix:"-ist",pos:"noun",meaning:"ÔΩû„Åô„Çã‰∫∫",examples:["artist","scientist","pianist"]},{suffix:"-ize",pos:"verb",meaning:"ÔΩûÂåñ„Åô„Çã",examples:["realize","organize","modernize"]},{suffix:"-ing",pos:"noun/adjective",meaning:"ÂãïÂêçË©û„ÉªÁèæÂú®ÂàÜË©û",examples:["running","interesting","learning"]},{suffix:"-ed",pos:"adjective",meaning:"ÈÅéÂéªÂàÜË©û„ÉªÂΩ¢ÂÆπË©û",examples:["tired","excited","surprised"]}],LK=[{root:"act",meaning:"Ë°åÂãï",words:["action","react","actor","activity","actual"]},{root:"struct",meaning:"Âª∫„Å¶„Çã",words:["structure","construct","destruction","instruct"]},{root:"dict",meaning:"Ë®Ä„ÅÜ",words:["dictionary","predict","contradict","dictate"]},{root:"port",meaning:"ÈÅã„Å∂",words:["transport","import","export","portable","report"]},{root:"duct",meaning:"Â∞é„Åè",words:["conduct","produce","reduce","introduce"]},{root:"scrib/script",meaning:"Êõ∏„Åè",words:["describe","script","prescription","manuscript"]},{root:"spect",meaning:"Ë¶ã„Çã",words:["inspect","respect","expect","spectator"]},{root:"form",meaning:"ÂΩ¢",words:["reform","inform","transform","uniform"]},{root:"ject",meaning:"Êäï„Åí„Çã",words:["project","reject","subject","object"]},{root:"miss/mit",meaning:"ÈÄÅ„Çã",words:["mission","permit","submit","transmit"]}];function zK(n){const e=n.toLowerCase();return["in the","at the","on the","to the","for the","with the","by the"].some(r=>e.startsWith(r))?"preposition_phrase":["take a","make a","have a","get a","give a","do a"].some(r=>e.startsWith(r))?"verb_phrase":n.includes(" ")?"idiom":"none"}function KN(n){const e=n.toLowerCase();for(const{prefix:t}of OK){const s=t.replace(/-/g,""),r=[s];(s==="in"||s==="im")&&r.push("in","im","il","ir");for(const o of r)if(e.startsWith(o)&&n.length>o.length+2)return o}}function QN(n){const e=n.toLowerCase();for(const{suffix:t}of qN){const s=t.split("/")[0].replace(/-/g,"");if(e.endsWith(s)&&n.length>s.length+2)return s}}function WK(n){const e=n.toLowerCase();for(const{root:o,words:i}of LK)if(i.some(a=>a===e)||e.includes(o))return o;let t=e;const s=KN(n);s&&(t=t.substring(s.length));const r=QN(n);if(r&&(t=t.substring(0,t.length-r.length)),!(t.length<3))return t!==e?t:void 0}function BK(n,e){const t=n.toLowerCase();if(n.includes(" "))return"phrase";for(const{suffix:s,pos:r}of qN){const o=s.split("/")[0].replace(/-/g,"");if(t.endsWith(o))return r.split("/")[0]}if(e){if(e.includes("„Åô„Çã")||e.includes("„Åï„Çå„Çã"))return"verb";if(e.includes("ÁöÑ„Å™")||e.includes("„ÅÑÔºàÂΩ¢ÂÆπË©ûË™ûÂ∞æÔºâ"))return"adjective";if(e.includes("„Å´")||e.includes("„ÅßÔºàÂâØË©ûÔºâ"))return"adverb"}return"other"}function VK(n,e){const t=KN(n),s=QN(n),r=WK(n),o=t||s||r?{prefix:t,suffix:s,root:r}:void 0,i=BK(n,e),a=zK(n);return{word:n,family:o,pos:i,phrasePattern:a!=="none"?a:void 0}}class UK{constructor(){Ne(this,"cache",new Map);Ne(this,"ttl",24*60*60*1e3)}getMetadata(e,t){const s=this.getCacheKey(e,t),r=this.cache.get(s);if(r&&Date.now()-r.timestamp<this.ttl)return r.metadata;const o=VK(e,t);return this.cache.set(s,{word:e,metadata:o,timestamp:Date.now()}),o}getMetadataFromQuestion(e){return this.getMetadata(e.word,e.meaning)}getBulkMetadata(e){const t=new Map;return e.forEach(s=>{t.set(s,this.getMetadata(s))}),t}getBulkMetadataFromQuestions(e){const t=new Map;return e.forEach(s=>{t.set(s.word,this.getMetadataFromQuestion(s))}),t}clear(){this.cache.clear()}purgeExpired(){const e=Date.now();let t=0;for(const[s,r]of this.cache.entries())e-r.timestamp>=this.ttl&&(this.cache.delete(s),t++);return t}getStats(){const e=Date.now();let t=0,s=1/0;for(const r of this.cache.values()){const o=e-r.timestamp;o>t&&(t=o),o<s&&(s=o)}return{size:this.cache.size,ttl:this.ttl,oldestEntryAge:t,newestEntryAge:s===1/0?0:s}}getCacheKey(e,t){return t?`${e}::${t}`:e}setTTL(e){this.ttl=e}}const XN=new UK;function gy(n,e){return XN.getMetadata(n,e)}function xy(n){return XN.getMetadataFromQuestion(n)}const YN={emotions:{name:"ÊÑüÊÉÖ",keywords:["happy","sad","angry","excited","worried","nervous","calm","joy","fear","love","hate","surprise"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},movement:{name:"Âãï‰Ωú„ÉªÁßªÂãï",keywords:["walk","run","jump","fly","swim","climb","move","go","come","enter","leave","return"],relatedCategories:["ÂãïË©û"]},time:{name:"ÊôÇÈñì",keywords:["day","night","morning","evening","week","month","year","today","tomorrow","yesterday","always","never","sometimes"],relatedCategories:["ÂêçË©û","ÂâØË©û"]},weather:{name:"Â§©Ê∞ó",keywords:["sunny","rainy","cloudy","windy","snowy","hot","cold","warm","cool","weather","temperature"],relatedCategories:["ÂΩ¢ÂÆπË©û","ÂêçË©û"]},food:{name:"È£ü„ÅπÁâ©",keywords:["food","eat","drink","cook","meal","breakfast","lunch","dinner","hungry","thirsty","delicious"],relatedCategories:["ÂêçË©û","ÂãïË©û","ÂΩ¢ÂÆπË©û"]},nature:{name:"Ëá™ÁÑ∂",keywords:["tree","flower","mountain","river","sea","sky","sun","moon","star","nature","plant","animal"],relatedCategories:["ÂêçË©û"]},family:{name:"ÂÆ∂Êóè„Éª‰∫∫ÈñìÈñ¢‰øÇ",keywords:["family","father","mother","brother","sister","parent","child","friend","teacher","student"],relatedCategories:["ÂêçË©û"]},size:{name:"Â§ß„Åç„Åï„ÉªÁ®ãÂ∫¶",keywords:["big","small","large","tiny","huge","long","short","tall","high","low","wide","narrow"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},communication:{name:"„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥",keywords:["say","speak","talk","tell","ask","answer","listen","hear","write","read","call","email"],relatedCategories:["ÂãïË©û"]},learning:{name:"Â≠¶Áøí",keywords:["learn","study","teach","understand","know","remember","forget","practice","improve","test","exam"],relatedCategories:["ÂãïË©û","ÂêçË©û"]}},JN=[["big","small"],["large","small"],["long","short"],["tall","short"],["high","low"],["wide","narrow"],["deep","shallow"],["heavy","light"],["strong","weak"],["hard","soft"],["hot","cold"],["warm","cool"],["fast","slow"],["quick","slow"],["early","late"],["young","old"],["new","old"],["happy","sad"],["good","bad"],["right","wrong"],["easy","difficult"],["simple","complex"],["start","end"],["begin","finish"],["open","close"],["love","hate"],["day","night"],["morning","evening"],["always","never"],["often","rarely"],["many","few"],["much","little"],["more","less"],["increase","decrease"],["rise","fall"],["up","down"],["front","back"],["before","after"],["first","last"],["enter","leave"],["come","go"],["push","pull"],["give","take"],["buy","sell"],["win","lose"],["remember","forget"],["find","lose"]],ZN=[["big","large","huge","enormous"],["small","little","tiny"],["happy","glad","joyful","pleased"],["sad","unhappy","sorrowful"],["angry","mad","furious"],["beautiful","pretty","lovely"],["ugly","unattractive"],["important","significant","essential"],["difficult","hard","tough","challenging"],["easy","simple"],["fast","quick","rapid","swift"],["slow","sluggish"],["smart","intelligent","clever","bright"],["stupid","foolish","dumb"],["funny","amusing","humorous"],["boring","dull","tedious"],["interesting","fascinating","engaging"],["tired","exhausted","weary"],["afraid","scared","frightened","terrified"],["brave","courageous","bold"],["kind","nice","gentle","friendly"],["mean","cruel","unkind"],["rich","wealthy","affluent"],["poor","needy"],["famous","well-known","renowned"],["strange","odd","weird","unusual"],["normal","ordinary","common","typical"]];function GK(n,e){const t=[],s=new Set;Object.entries(YN).forEach(([o,i])=>{const a=n.filter(c=>{const l=c.word.toLowerCase(),d=c.meaning.toLowerCase();return i.keywords.some(h=>l.includes(h)||d.includes(h))&&!s.has(c.word)}).map(c=>c.word);if(a.length>=2){a.forEach(d=>s.add(d));const l=50+a.filter(d=>{const h=e[d];return h&&h.incorrectCount>h.correctCount}).length/a.length*50;t.push({id:`theme_${o}`,name:i.name,theme:o,words:a,relationType:"theme",priority:l})}}),JN.forEach((o,i)=>{const[a,c]=o,l=n.filter(d=>{const h=d.word.toLowerCase();return(h===a||h===c)&&!s.has(d.word)}).map(d=>d.word);l.length===2&&(l.forEach(d=>s.add(d)),t.push({id:`antonym_${i}`,name:`ÂØæÁæ©Ë™û: ${a} ‚áî ${c}`,theme:"antonyms",words:l,relationType:"antonym",priority:70}))}),ZN.forEach((o,i)=>{const a=n.filter(c=>{const l=c.word.toLowerCase();return o.includes(l)&&!s.has(c.word)}).map(c=>c.word);a.length>=2&&(a.forEach(c=>s.add(c)),t.push({id:`synonym_${i}`,name:`È°ûÁæ©Ë™û: ${o.join(", ")}`,theme:"synonyms",words:a,relationType:"synonym",priority:60}))});const r=new Map;return n.forEach(o=>{if(!s.has(o.word)&&o.category){const i=r.get(o.category)||[];i.push(o.word),r.set(o.category,i)}}),r.forEach((o,i)=>{o.length>=3&&(o.forEach(a=>s.add(a)),t.push({id:`category_${i}`,name:`„Ç´„ÉÜ„Ç¥„É™„Éº: ${i}`,theme:i,words:o,relationType:"category",priority:40}))}),t.sort((o,i)=>i.priority-o.priority)}function HK(n,e,t,s){var c,l,d,h,p,f;const r=n.toLowerCase(),o=e.toLowerCase(),i=t?xy(t):gy(n),a=s?xy(s):gy(e);if((c=i.family)!=null&&c.root&&((l=a.family)!=null&&l.root)&&i.family.root===a.family.root)return{word1:n,word2:e,relationType:"word_family",strength:.95,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòË™ûÊ†πÔºà${i.family.root}Ôºâ`};if((d=i.family)!=null&&d.prefix&&((h=a.family)!=null&&h.prefix)&&i.family.prefix===a.family.prefix)return{word1:n,word2:e,relationType:"word_family",strength:.7,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•È†≠ËæûÔºà${i.family.prefix}-Ôºâ`};if((p=i.family)!=null&&p.suffix&&((f=a.family)!=null&&f.suffix)&&i.family.suffix===a.family.suffix&&i.pos===a.pos)return{word1:n,word2:e,relationType:"word_family",strength:.65,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•Â∞æËæûÔºà-${i.family.suffix}Ôºâ`};if(i.phrasePattern&&a.phrasePattern&&i.phrasePattern===a.phrasePattern&&i.phrasePattern!=="none")return{word1:n,word2:e,relationType:"collocation",strength:.75,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÁÜüË™û„Éë„Çø„Éº„É≥`};for(const m of JN)if(m[0]===r&&m[1]===o||m[0]===o&&m[1]===r)return{word1:n,word2:e,relationType:"antonym",strength:.9,description:`"${n}"„Å®"${e}"„ÅØÂØæÁæ©Ë™û`};for(const m of ZN)if(m.includes(r)&&m.includes(o))return{word1:n,word2:e,relationType:"synonym",strength:.8,description:`"${n}"„Å®"${e}"„ÅØÈ°ûÁæ©Ë™û`};for(const[,m]of Object.entries(YN)){const g=m.keywords.some(y=>r.includes(y)||y.includes(r)),x=m.keywords.some(y=>o.includes(y)||y.includes(o));if(g&&x)return{word1:n,word2:e,relationType:"theme",strength:.6,description:`"${n}"„Å®"${e}"„ÅØÂêå„Åò„ÉÜ„Éº„ÉûÔºà${m.name}Ôºâ`}}return null}function eI(n,e,t=[]){const s=GK(n,e),r=[],o=[],i=new Set;return t.forEach(a=>i.add(a)),s.forEach(a=>{const c=a.words.filter(d=>!i.has(d));if(c.length===0)return;c.sort((d,h)=>{const p=e[d],f=e[h];if(!p&&!f)return 0;if(!p)return-1;if(!f)return 1;const m=p.incorrectCount/(p.correctCount+p.incorrectCount||1);return f.incorrectCount/(f.correctCount+f.incorrectCount||1)-m}).forEach(d=>{if(i.has(d))return;const h=r[r.length-1];if(h){const p=n.find(g=>g.word===h),f=n.find(g=>g.word===d),m=HK(h,d,p,f);o.push({from:h,to:d,reason:m?m.description:`Âêå„Åò„ÇØ„É©„Çπ„Çø„ÉºÔºà${a.name}Ôºâ`})}r.push(d),i.add(d)})}),n.forEach(a=>{i.has(a.word)||(r.push(a.word),i.add(a.word))}),{clusters:s,sequence:r,transitions:o}}function qK(n){switch(n){case"incorrect":return!0;default:return!1}}function tI(n){switch(n){case"incorrect":case"still_learning":return!0;default:return!1}}class Pu{static startTrace(e="weak-words-flow"){return""}static startSpan(e,t,s){return""}static endSpan(e,t){}static addEvent(e,t,s){}static endTrace(){return""}static detectLostWords(e){if(e.length===0)return[];const t=[],s=new Map;for(const r of e){const o=r.attributes.weakWords||[];for(const i of o)s.set(i,{span:r.name,count:r.attributes.weakWordsCount})}if(e.length>=2){const r=new Set(e[0].attributes.weakWords||[]),o=new Set(e[e.length-1].attributes.weakWords||[]);for(const i of r)if(!o.has(i)){const a=s.get(i);a&&t.push({word:i,lastSeenSpan:a.span,lastSeenCount:a.count})}}return t}static generateSummary(e){if(!this.currentContext)return"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó";const t=Array.from(this.currentContext.spans.values()).sort((l,d)=>l.startTime-d.startTime);if(t.length===0)return"„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó";let s="";try{const l=localStorage.getItem("debug_ab_session_info");if(l){const d=JSON.parse(l);s+=`## üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±

`,s+=`**ÁèæÂú®„ÅÆVariant**: ${d.variant}
`,s+=`- **A**: ÈÄöÂ∏∏„É¢„Éº„ÉâÔºàcalculatePrioritiesÔºâ
`,s+=`- **B**: „Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„ÉâÔºàPosition‰∏ªËª∏+AIÂ∞èË£úÊ≠£Ôºâ
`,s+=`- **C**: AI‰∏ªËª∏„É¢„Éº„ÉâÔºàfinalPriorityMode„ÄÅGamificationAI„Éñ„Éº„Çπ„ÉàÔºâ

`,d.variant==="A"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant A„Åß„Åô„ÄÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„ÅØÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):d.variant==="B"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant B„Åß„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅØÈÉ®ÂàÜÁöÑ„Å´„Åó„ÅãÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):d.variant==="C"&&(s+=`‚úÖ **Ê≠£Â∏∏**: Variant C„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅåÊúâÂäπ„Åß„Åô„ÄÇ

`)}}catch{}s+=`## üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ

`,s+=`| „Çπ„Éë„É≥ | ÈñãÂßãÊôÇÂàª | ÊâÄË¶ÅÊôÇÈñì | „Åæ„Å†„Åæ„Å†Ë™û | Á∑èÂçòË™ûÊï∞ | Áä∂ÊÖã |
`,s+=`|---|---|---|---|---|---|
`;const r=30,o=t.length>r?t.slice(-r):t;t.length>r&&(s+=`> ‚ÑπÔ∏è „Çπ„Éë„É≥„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂÖ®${t.length}‰ª∂‰∏≠„ÄÅÊú´Â∞æ${r}‰ª∂„ÅÆ„ÅøË°®Á§∫„Åó„Åæ„Åô

`);let i=-1;for(const l of o){const d=l.endTime?`${(l.endTime-l.startTime).toFixed(2)}ms`:"ÂÆüË°å‰∏≠",h=new Date(Date.now()-performance.now()+l.startTime).toISOString().split("T")[1],p=l.attributes.weakWordsCount??l.attributes.weakWordsCountAfter??0,f=l.attributes.totalCount??l.attributes.totalCountAfter??0;let m="‚úÖ Ê≠£Â∏∏",g="";if(i!==-1){const x=p-i;p===0&&i>0?(m="‚ùå Ê∂àÂ§±",g=` (-${i}Ë™û)`):x<0?(m="‚ö†Ô∏è Ê∏õÂ∞ë",g=` (${x}Ë™û)`):x>0&&(m="üìà Â¢óÂä†",g=` (+${x}Ë™û)`)}i=p,s+=`| ${l.name} | ${h} | ${d} | ${p}Ë™û${g} | ${f}Ë™û | ${m} |
`}const a=t.find(l=>l.name==="MemorizationView.prepareScheduling");if(a){const l=a.attributes.weakWordsCount??0,d=a.attributes.weakWordsCountAfter??0,h=a.attributes.totalCount??0,p=a.attributes.totalCountAfter??0;if(s+=`
### üìä „Çπ„Ç±„Ç∏„É•„Éº„É´ÂâçÂæå„ÅÆÊØîËºÉ

`,s+=`**MemorizationView.prepareScheduling**:
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Ââç: ${l}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${h}Ë™û„ÅÆÂÄôË£ú
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Âæå: ${d}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${p}Ë™û„ÅÆÁµêÊûú
`,l>d){const y=l-d,b=(y/l*100).toFixed(1);s+=`- **Â§âÂåñ**: ${y}Ë™ûÊ∏õÂ∞ëÔºà${b}%Ê∂àÂ§±Ôºâ ‚ö†Ô∏è
`}else if(l<d){const y=d-l;s+=`- **Â§âÂåñ**: ${y}Ë™ûÂ¢óÂä† üìà
`}else s+=`- **Â§âÂåñ**: Â§âÂåñ„Å™„Åó ‚úÖ
`;const f=new Set(a.attributes.weakWords||[]),m=new Set(a.attributes.weakWordsAfter||[]),g=[...f].filter(y=>!m.has(y)),x=[...m].filter(y=>!f.has(y));g.length>0&&(s+=`
**Ê∂àÂ§±„Åó„ÅüÂçòË™ûÔºà${g.length}Ë™ûÔºâ**:
`,s+=`- ${g.slice(0,10).join(", ")}`,g.length>10&&(s+=` (+${g.length-10}Ë™û)`),s+=`
`),x.length>0&&(s+=`
**Êñ∞„Åü„Å´ËøΩÂä†„Åï„Çå„ÅüÂçòË™ûÔºà${x.length}Ë™ûÔºâ**:
`,s+=`- ${x.slice(0,10).join(", ")}`,x.length>10&&(s+=` (+${x.length-10}Ë™û)`),s+=`
`)}const c=this.detectLostWords(t);c.length>0?(s+=`
### ‚ùå Ê∂àÂ§±„Åó„ÅüÂçòË™û

`,c.slice(0,10).forEach(l=>{s+=`- **${l.word}**: ÊúÄÂæå„Å´Á¢∫Ë™ç ‚Üí ${l.lastSeenSpan}
`}),c.length>10&&(s+=`
_...‰ªñ${c.length-10}Ë™û_
`)):s+=`
### ‚úÖ Ê∂àÂ§±„Åó„ÅüÂçòË™û„Å™„Åó

`,s+=`
### üìä „Çπ„Éë„É≥„Åî„Å®„ÅÆÂçòË™û„É™„Çπ„ÉàÂ§âÂåñ

`;for(const l of t){const d=l.attributes.weakWords||[];if(d.length>0){const h=d.slice(0,5).join(", "),p=d.length>5?` (+${d.length-5}Ë™û)`:"";s+=`- **${l.name}**: ${d.length}Ë™û ‚Üí [${h}${p}]
`}else s+=`- **${l.name}**: 0Ë™û
`}if(c.length>0){s+=`
### üîç Ê∂àÂ§±„ÅÆË©≥Á¥∞ÂàÜÊûê

`,s+=`**Á∑èÊ∂àÂ§±Êï∞**: ${c.length}Ë™û

`;for(let l=0;l<t.length-1;l++){const d=new Set(t[l].attributes.weakWords||t[l].attributes.weakWordsAfter||[]),h=new Set(t[l+1].attributes.weakWords||[]),p=[...d].filter(m=>!h.has(m)),f=[...h].filter(m=>!d.has(m));if(p.length>0||f.length>0){const m=d.size,g=h.size,x=g-m,y=m>0?(Math.abs(x)/m*100).toFixed(1):"0.0";s+=`
**${t[l].name} ‚Üí ${t[l+1].name}**:
`,s+=`- ÂçòË™ûÊï∞Â§âÂåñ: ${m}Ë™û ‚Üí ${g}Ë™û`,x<0?s+=` (${x}Ë™û„ÄÅ-${y}%) ‚ö†Ô∏è`:x>0&&(s+=` (+${x}Ë™û„ÄÅ+${y}%) üìà`),s+=`
`,p.length>0&&(s+=`- Ê∂àÂ§±Ôºà${p.length}Ë™ûÔºâ: ${p.slice(0,5).join(", ")}`,p.length>5&&(s+=` (+${p.length-5}Ë™û)`),s+=`
`),f.length>0&&(s+=`- ËøΩÂä†Ôºà${f.length}Ë™ûÔºâ: ${f.slice(0,5).join(", ")}`,f.length>5&&(s+=` (+${f.length-5}Ë™û)`),s+=`
`)}}}try{const l=tu("debug_finalPriority_output",{mode:e}).raw,d=tu("debug_finalPriority_sessionStats",{mode:e}).raw;if(l&&d){const h=JSON.parse(l),p=JSON.parse(d);s+=`
### üß† finalPriority„É¢„Éº„ÉâÔºàAI‰∏ªËª∏Ôºâ„ÅÆË©≥Á¥∞

`,s+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊÉÖÂ†±**:
`,s+=`- „Çø„Éñ: ${p.currentTab}
`,s+=`- Á∑èÂïèÈ°åÊï∞: ${p.totalQuestions}Âïè
`,s+=`- ÈÄ≤Êçó„Éá„Éº„Çø: ${p.allProgressCount}Ë™û
`,s+=`- „Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${p.timestamp}

`,s+=`**TOP10„ÅÆÂïèÈ°åÔºàfinalPriorityÈôçÈ†ÜÔºâ**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | finalPriority | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|---|
`,h.slice(0,10).forEach(m=>{const g=m.position>=70?"üî¥":m.position>=40?"üü°":m.position>=20?"‚ö™":"‚úÖ";s+=`| ${m.rank} | **${m.word}** | ${m.position} ${g} | ${m.finalPriority.toFixed(3)} | ${m.category||"-"} | ${m.attempts}Âõû |
`});const f=h.filter(m=>m.position>=40&&m.attempts>0);s+=`
**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞**:
`,s+=`- TOP10„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${f.slice(0,10).length}Ë™û
`,s+=`- TOP30„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${f.length}Ë™û
`,f.length>0?(s+=`
**„Åæ„Å†„Åæ„Å†Ë™ûTOP5**:
`,f.slice(0,5).forEach(m=>{s+=`- **${m.word}** („É©„É≥„ÇØ${m.rank}, Position ${m.position}, finalPriority ${m.finalPriority.toFixed(3)})
`})):(s+=`
‚ö†Ô∏è **Ë≠¶Âëä**: TOP30„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,s+=`‚Üí GamificationAI„ÅÆ„Éñ„Éº„Çπ„ÉàÂá¶ÁêÜ„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`)}else s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì

`,s+=`finalPriorityMode„Åå‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÄÅ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`}catch(l){s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${l}
`}try{const l=tu("debug_postProcess_output",{mode:e}).raw,d=localStorage.getItem("debug_sortAndBalance_output");if(l||d){if(s+=`
### üîç sortAndBalance ‚Üí postProcess „ÅÆÈ†ÜÂ∫èÊ§úË®º

`,d){const h=JSON.parse(d);s+=`**sortAndBalanceÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|
`,h.slice(0,10).forEach((f,m)=>{const g=f.position>=70?"üî¥":f.position>=60?"üü°":f.position>=40?"üîµ":f.position>=20?"‚ö™":"‚úÖ";s+=`| ${m+1} | **${f.word}** | ${f.position} ${g} | ${f.category||"-"} | ${f.attempts}Âõû |
`});const p={incorrect:h.filter(f=>f.position>=70).length,stillLearning:h.filter(f=>f.position>=60&&f.position<70&&f.attempts>0).length,newBoosted:h.filter(f=>f.position>=40&&f.position<60&&f.attempts===0).length,newNormal:h.filter(f=>f.position>=20&&f.position<40).length,mastered:h.filter(f=>f.position<20).length};s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${p.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å† (Position 60-69, attempts>0): ${p.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà (Position 40-59, attempts=0): ${p.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏ (Position 20-39): ${p.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à (Position <20): ${p.mastered}Ë™û

`}if(l){const h=JSON.parse(l),f=(Array.isArray(h)?h:Array.isArray(h==null?void 0:h.top30)?h.top30:[]).slice(0,30).map((g,x)=>({rank:Number(g==null?void 0:g.rank)||x+1,word:String((g==null?void 0:g.word)??""),position:Number((g==null?void 0:g.position)??0),attempts:Number((g==null?void 0:g.attempts)??0)})),m={incorrect:f.filter(g=>g.position>=70).length,stillLearning:f.filter(g=>g.position>=60&&g.position<70&&g.attempts>0).length,newBoosted:f.filter(g=>g.position>=40&&g.position<60&&g.attempts===0).length,newNormal:f.filter(g=>g.position>=20&&g.position<40).length,mastered:f.filter(g=>g.position<20).length};if(s+=`**postProcessÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | Áä∂ÊÖã |
`,s+=`|---|---|---|---|
`,f.slice(0,10).forEach(g=>{const x=g.position>=70?"üî¥":g.position>=60?"üü°":g.position>=40?"üîµ":g.position>=20?"‚ö™":"‚úÖ",y=g.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":g.position>=60?"„Åæ„Å†„Åæ„Å†":g.position>=40?"Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà":g.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";s+=`| ${g.rank} | **${g.word}** | ${g.position} ${x} | ${y} |
`}),s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${m.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å†: ${m.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà: ${m.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏: ${m.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à: ${m.mastered}Ë™û

`,d){const x=JSON.parse(d).slice(0,10).map(v=>v.word),y=f.slice(0,10).map(v=>v.word);x.some((v,w)=>v!==y[w])?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`,s+=`‚Üí postProcess()„ÅÆÈñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„ÅåPositionÈöéÂ±§„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

`):s+=`‚úÖ **È†ÜÂ∫è‰øùÊåÅ**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

`}}else s+=`‚ö†Ô∏è postProcessÂæå„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
`}}catch(l){s+=`
### ‚ö†Ô∏è postProcessÊÉÖÂ†±„ÅÆË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${l}
`}return s}static saveContext(){if(this.currentContext)try{const e={traceId:this.currentContext.traceId,spans:Array.from(this.currentContext.spans.entries()),activeSpanId:this.currentContext.activeSpanId};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch{}}static restoreContext(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return this.currentContext={traceId:t.traceId,spans:new Map(t.spans),activeSpanId:t.activeSpanId},this.currentContext}catch{return null}}static clearTrace(){this.currentContext=null;try{localStorage.removeItem(this.STORAGE_KEY)}catch{}}}Ne(Pu,"STORAGE_KEY","debug_trace_context"),Ne(Pu,"currentContext",null);class jl{constructor(){Ne(this,"antiVibration");Ne(this,"recentAnswersCache",new Map);Ne(this,"aiCoordinator",null);Ne(this,"useAICoordinator",!1);Ne(this,"incorrectSkipQueue",[]);Ne(this,"skipCounter",0);Ne(this,"skipTarget",0);this.antiVibration=new uk}getRandomSkipCount(){const e=Math.random();return e<.4?2:e<.7?3:e<.9?4:5}enableAICoordination(e=!0){this.useAICoordinator=e,e&&!this.aiCoordinator&&(this.aiCoordinator=new FK({debugMode:!1}))}async schedule(e){const t=performance.now(),s={timestamp:new Date().toISOString(),mode:e.mode,questionCount:e.questions.length,useMetaAI:e.useMetaAI,hybridMode:e.hybridMode||!1,firstQuestions:e.questions.slice(0,10).map(f=>f.word)};try{const f=JSON.parse(localStorage.getItem("debug_scheduler_calls")||"[]");f.push(s),f.length>10&&f.shift(),localStorage.setItem("debug_scheduler_calls",JSON.stringify(f))}catch{}if(this.skipCounter>=this.skipTarget&&this.incorrectSkipQueue.length>0){const f=this.incorrectSkipQueue.shift();this.skipCounter=0,this.skipTarget=0;const m=e.questions.filter(g=>g.word!==f.question.word);return this.schedule({...e,questions:[f.question,...m]})}if(this.skipTarget>0&&this.skipCounter++,e.hybridMode)return this.scheduleHybridMode(e,t);if(e.finalPriorityMode)return this.scheduleFinalPriorityMode(e,t);const r=this.buildContext(e),o=e.useMetaAI?this.detectSignals(r):[],i=this.calculatePriorities(e.questions,r,o,!1),a=this.applyAntiVibration(i,r),c=this.sortAndBalance(a,e,r),l=this.postProcess(c,r);try{const f=l.slice(0,30).map((g,x)=>{var b,v;const y=c.find(w=>w.question.word===g.word);return{word:g.word,position:(y==null?void 0:y.position)||0,category:(b=y==null?void 0:y.status)==null?void 0:b.category,attempts:((v=y==null?void 0:y.status)==null?void 0:v.attempts)||0}}),m={timestamp:new Date().toISOString(),mode:r.mode,source:"schedule",top30:f};Pi("debug_postProcess_output",m,{mode:r.mode})}catch{}const d=this.antiVibration.calculateVibrationScore(c,r.recentAnswers,20),h=performance.now()-t,p={top10Words:l.slice(0,10).map(f=>f.word),top10Positions:c.slice(0,10).map(f=>({word:f.question.word,position:f.position}))};R.info("[QuestionScheduler] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(h)+"ms",vibrationScore:d,signalCount:o.length,resultDebug:p});try{const f=JSON.parse(localStorage.getItem("debug_scheduler_results")||"[]");f.push({timestamp:new Date().toISOString(),...p}),f.length>10&&f.shift(),localStorage.setItem("debug_scheduler_results",JSON.stringify(f))}catch{}if(c.length>0&&r.recentAnswers.length>0){const f=c[0],m=r.recentAnswers.find(g=>g.word===f.question.word);if(m&&!m.correct&&!this.incorrectSkipQueue.some(x=>x.question.word===f.question.word)){this.incorrectSkipQueue.push(f),this.skipTarget=this.getRandomSkipCount(),this.skipCounter=0;const x=l.slice(1);if(x.length>0)return{scheduledQuestions:x,vibrationScore:d,processingTime:h,signalCount:o.length,debug:{dtaApplied:c.filter(y=>{var b;return(((b=y.status)==null?void 0:b.position)??50)<20}).length,antiVibrationApplied:c.filter(y=>y.antiVibrationApplied).length,signalsDetected:o,randomSkipApplied:!0}}}}return{scheduledQuestions:l,vibrationScore:d,processingTime:h,signalCount:o.length,debug:{dtaApplied:c.filter(f=>{var m;return(((m=f.status)==null?void 0:m.position)??50)<20}).length,antiVibrationApplied:c.filter(f=>f.antiVibrationApplied).length,signalsDetected:o}}}buildContext(e){const s=new Date().getHours(),r=s<12?"morning":s<17?"afternoon":s<21?"evening":"night",o=this.calculateCognitiveLoad(e.sessionStats),i=this.getRecentAnswers(e.mode),a=et(),c={};if(a&&a.wordProgress)for(const l of e.questions){const d=a.wordProgress[l.word];d&&(c[l.word]=d)}return{mode:e.mode,sessionStats:e.sessionStats,recentAnswers:i,timeOfDay:r,cognitiveLoad:o,useMetaAI:e.useMetaAI||!1,isReviewFocusMode:e.isReviewFocusMode||!1,sessionStartTime:Date.now()-(e.sessionStats.duration||0),wordProgress:c}}calculateCognitiveLoad(e){const t=e.correct+e.incorrect>0?e.incorrect/(e.correct+e.incorrect):0,s=(e.duration||0)/6e4,r=Math.min(s/30,1);return Math.min(t*.7+r*.3,1)}getRecentAnswers(e){if(this.recentAnswersCache.has(e))return this.recentAnswersCache.get(e);try{const t=et(),s=[];Object.entries(t.wordProgress||{}).forEach(([o,i])=>{if(i.lastStudied>0){const a=Qr(Bt(i,e));s.push({word:o,correct:!qK(a),timestamp:i.lastStudied,consecutiveCorrect:i.streak||0})}}),s.sort((o,i)=>i.timestamp-o.timestamp);const r=s.slice(0,100);return this.recentAnswersCache.set(e,r),r}catch(t){return R.error("[QuestionScheduler] Ëß£Á≠îÂ±•Ê≠¥„ÅÆÂèñÂæó„Å´Â§±Êïó",t),[]}}detectSignals(e){try{const t=[],s=e.sessionStats,r=s.correct+s.incorrect+s.still_learning,o=r>0?s.incorrect/r:0,i=(s.duration||0)/6e4;if(i>20||e.cognitiveLoad>.7){const c=Math.min(i/30*.5+e.cognitiveLoad*.5,1);t.push({type:"fatigue",confidence:c,action:"easier"}),R.debug(`[Signal] Áñ≤Âä¥Ê§úÂá∫: ${(c*100).toFixed(0)}%`)}if(o>.4&&r>=5){const c=Math.min(o,.9);t.push({type:"struggling",confidence:c,action:"review"}),R.debug(`[Signal] Ëã¶Êà¶Ê§úÂá∫: ${(c*100).toFixed(0)}% („Ç®„É©„ÉºÁéá${(o*100).toFixed(0)}%)`)}const a=s.consecutiveCorrect||0;if(a>10){const c=Math.min(a/15,.9);t.push({type:"overlearning",confidence:c,action:"harder"}),R.debug(`[Signal] ÈÅéÂ≠¶ÁøíÊ§úÂá∫: ${(c*100).toFixed(0)}% (ÈÄ£Á∂ö${a}ÂõûÊ≠£Ëß£)`)}return o>=.2&&o<=.35&&a<8&&(t.push({type:"optimal",confidence:.8,action:"continue"}),R.debug("[Signal] ÊúÄÈÅ©Â≠¶ÁøíÁä∂ÊÖãÊ§úÂá∫")),t.length===0&&R.debug("[Signal] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Å™„Åó - ÈÄöÂ∏∏„É¢„Éº„Éâ"),t}catch(t){return R.error("[QuestionScheduler] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Ç®„É©„Éº",t),[]}}calculatePriorities(e,t,s,r=!1){this.recordFunctionCall("calculatePriorities",{questionsCount:e.length,hybridMode:r});const o=this.loadProgressCache(),i=this.calculateDifficultyAdaptation(o),a=e.map((l,d)=>{const h=this.getWordStatusFromCache(l.word,t.mode,o);if(r){const f=d/e.length*100;return{question:l,position:f,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}}let p=(h==null?void 0:h.position)||35;return p=this.applyDifficultyAdaptation(p,l,i),{question:l,position:p,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}});return this.applyInterleavingAdjustment(a,t.mode,e.length)}applyInterleavingAdjustment(e,t,s){this.recordFunctionCall("applyInterleavingAdjustment",{prioritizedCount:e.length,mode:t,questionsCount:s});const r=new qa,o={stillLearning:e.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0).length,incorrect:e.filter(x=>x.position>=70).length,new:e.filter(x=>x.position<40).length,boostable:e.filter(x=>x.position>=25&&x.position<40&&(x.attempts??0)===0).length},{result:i,changed:a}=r.boostStillLearningQuestions(e),{result:c,changed:l}=r.adjustPositionForInterleaving(i),d={stillLearning:c.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0).length,incorrect:c.filter(x=>x.position>=70).length,new:c.filter(x=>x.position<40).length,boostable:c.filter(x=>x.position>=25&&x.position<40&&(x.attempts??0)===0).length},h=c.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0&&x.position>=60&&x.position<70).length,p=c.filter(x=>x.position>=40&&(x.attempts??0)===0&&x.position>=40&&x.position<60).length,f=c.filter(x=>{const y=(x.attempts??0)===0,b=(x.attempts??0)>0&&x.position>=40&&x.position<70;return y&&x.position>=60||b&&x.position<60});try{const x={mode:t,questionsCount:s,stillInBoostedZone:h,newInBoostedZone:p,violations:f.map(y=>({word:y.question.word,position:y.position,attempts:y.attempts??0,type:(y.attempts??0)===0?"new_exceeds_60":"still_below_60"})),violationCount:f.length,isValid:f.length===0,timestamp:new Date().toISOString()};localStorage.setItem("debug_position_hierarchy_validation",JSON.stringify(x)),localStorage.setItem(`debug_position_hierarchy_validation_${t}`,JSON.stringify(x))}catch{}try{const x={mode:t,questionsCount:s,timestamp:new Date().toISOString(),before:o,after:d,stillChanged:a,changed:l,summary:{stillBoosted:a.length,newBoosted:l.length,working:a.length>0||l.length>0}};localStorage.setItem("debug_position_interleaving",JSON.stringify(x));const y=`debug_position_interleaving_${t}`;localStorage.setItem(y,JSON.stringify(x));const b=`debug_position_interleaving_history_${t}`;try{const v=localStorage.getItem(b),w=JSON.parse(v||"[]"),S=Array.isArray(w)?w:[];for(S.push(x);S.length>5;)S.shift();localStorage.setItem(b,JSON.stringify(S))}catch{}}catch{}const{result:m,changed:g}=r.boostStillLearningQuestions(c);try{const x={mode:t,questionsCount:s,timestamp:new Date().toISOString(),boosted:g.length,changes:g,working:g.length>0};localStorage.setItem("debug_still_learning_boost",JSON.stringify(x)),localStorage.setItem(`debug_still_learning_boost_${t}`,JSON.stringify(x))}catch{}return m}recordFunctionCall(e,t){try{const s=localStorage.getItem("debug_function_calls"),r=s?JSON.parse(s):[];r.push({timestamp:new Date().toISOString(),function:e,params:t}),r.length>30&&r.shift(),localStorage.setItem("debug_function_calls",JSON.stringify(r))}catch{}}calculateForgettingRisk(e){if(e.lastStudied===0)return 0;const t=(Date.now()-e.lastStudied)/(1e3*60*60*24);let r=(e.reviewInterval>0?t/e.reviewInterval:0)*100;return e.accuracy<50?r*=1.5:e.accuracy>=80&&(r*=.7),Math.round(Math.min(r,200))}applySignals(e,t,s){if(t.length===0)return e;let r=e;for(const o of t)switch(o.type){case"fatigue":e>8&&(r*=1-o.confidence*.2);break;case"struggling":e<2&&(r*=1-o.confidence*.3);break;case"overlearning":e>=3&&e<=5&&(r*=1-o.confidence*.15);break}return r}loadProgressCache(){try{return et()}catch{return null}}getWordStatusFromCache(e,t,s){if(!s||!s.wordProgress)return null;const r=s.wordProgress[e];if(!r)return null;const o=Bt(r,t),i=Qr(o);let a=0,c=0;switch(t){case"memorization":a=r.memorizationAttempts||0,c=r.memorizationCorrect||0;break;case"translation":a=r.translationAttempts||0,c=r.translationCorrect||0;break;case"spelling":a=r.spellingAttempts||0,c=r.spellingCorrect||0;break;case"grammar":a=r.grammarAttempts||0,c=r.grammarCorrect||0;break;default:a=(r.correctCount||0)+(r.incorrectCount||0),c=r.correctCount||0}return{category:i,position:o,lastStudied:r.lastStudied||0,attempts:a,correct:c,streak:r.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1}}getWordStatus(e,t){var s;try{const o=(s=et().wordProgress)==null?void 0:s[e];if(!o)return null;const i=Bt(o,t),a=Qr(i);let c=0,l=0;switch(t){case"memorization":c=o.memorizationAttempts||0,l=o.memorizationCorrect||0;break;case"translation":c=o.translationAttempts||0,l=o.translationCorrect||0;break;case"spelling":c=o.spellingAttempts||0,l=o.spellingCorrect||0;break;case"grammar":c=o.grammarAttempts||0,l=o.grammarCorrect||0;break;default:c=(o.correctCount||0)+(o.incorrectCount||0),l=o.correctCount||0}const d={category:a,position:i,lastStudied:o.lastStudied||0,attempts:c,correct:l,streak:o.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1};return tI(a)&&R.debug(`[WordStatus] ${e}: ${a} (position=${i}, attempts=${d.attempts}, consecutiveIncorrect=${o.consecutiveIncorrect||0})`),d}catch(r){return R.error("[QuestionScheduler] Â≠¶ÁøíÁä∂Ê≥Å„ÅÆÂèñÂæó„Å´Â§±Êïó",r),null}}applyAntiVibration(e,t){return this.antiVibration.filter(e,{recentAnswers:t.recentAnswers,minInterval:6e4,consecutiveThreshold:3})}sortAndBalance(e,t,s){this.recordFunctionCall("sortAndBalance",{questionsCount:e.length});const r=e.filter(p=>p.position>=70),o=e.filter(p=>p.position>=40&&p.position<70),i=e.filter(p=>p.position<40);e.reduce((p,f)=>{var g;const m=((g=f.status)==null?void 0:g.category)||"null";return p[m]=(p[m]||0)+1,p},{}).null,e.length;const c=(p,f)=>p.position!==f.position?f.position-p.position:(p.originalIndex||0)-(f.originalIndex||0);r.sort(c),o.sort(c),i.sort(c);const l=[...e].sort((p,f)=>p.position!==f.position?f.position-p.position:(p.originalIndex||0)-(f.originalIndex||0)),h=new qa().interleaveByCategory(l);try{const p=h.slice(0,30).map(w=>{var S,N;return{word:w.question.word,position:w.position,category:(S=w.status)==null?void 0:S.category,attempts:w.attempts??((N=w.status)==null?void 0:N.attempts)??0}});localStorage.setItem("debug_sortAndBalance_output",JSON.stringify(p));const f=h.slice(0,100).map((w,S)=>{var N,C;return{rank:S+1,word:w.question.word,position:w.position,category:(N=w.status)==null?void 0:N.category,attempts:w.attempts??((C=w.status)==null?void 0:C.attempts)??0}}),m=f.filter(w=>w.position>=40&&w.position<70&&w.attempts>0),g=h.slice(0,600).map((w,S)=>{var N;return{rank:S+1,word:w.question.word,position:w.position,attempts:w.attempts??((N=w.status)==null?void 0:N.attempts)??0}}),x=g.filter(w=>w.position>=40&&w.position<70&&w.attempts>0),y={timestamp:new Date().toISOString(),mode:t.mode,questionsCount:e.length,interleavedCount:h.length,top100:f,top600:g,top600Count:g.length,stillLearningInTop100:m.length,stillLearningInTop600:x.length,stillLearningWordsInTop100:m.map(w=>`${w.rank}‰Ωç: ${w.word} (Position ${w.position}, ${w.attempts}Âõû)`),stillLearningWordsInTop600:x.slice(0,20).map(w=>`${w.rank}‰Ωç: ${w.word} (Position ${w.position}, ${w.attempts}Âõû)`),position50Count:g.filter(w=>w.position===50&&w.attempts===0).length};localStorage.setItem("debug_sortAndBalance_top100",JSON.stringify(y));const b=`debug_sortAndBalance_top100_${t.mode}`;localStorage.setItem(b,JSON.stringify(y));const v=`debug_sortAndBalance_top100_history_${t.mode}`;try{const w=localStorage.getItem(v),S=JSON.parse(w||"[]"),N=Array.isArray(S)?S:[];for(N.push(y);N.length>5;)N.shift();localStorage.setItem(v,JSON.stringify(N))}catch{}}catch{}return h}scheduleHybridMode(e,t){const s=this.buildContext(e),r=e.useMetaAI?this.detectSignals(s):[],o=this.calculatePriorities(e.questions,s,r,!1),i=this.applyAntiVibration(o,s),a=this.sortAndBalance(i,e,s),c=a.filter(g=>g.position>=70),l=a.filter(g=>g.position>=40&&g.position<70),d=c.length+l.length,h=a.length;R.info("[QuestionScheduler Hybrid] ÂÑ™ÂÖàÂçòË™ûÈÖçÁΩÆÂÆå‰∫Ü",{incorrectWords:c.slice(0,5).map(g=>g.question.word),stillLearningWords:l.slice(0,5).map(g=>g.question.word),incorrectCount:c.length,stillLearningCount:l.length,otherCount:h-d,reviewRatio:h>0?`${(d/h*100).toFixed(0)}%`:"0%",top5:a.slice(0,5).map(g=>{var x;return`${g.question.word}(${(x=g.status)==null?void 0:x.category})`})});const p=this.postProcess(a,s);try{const g=p.slice(0,30).map((x,y)=>{var v,w;const b=a.find(S=>S.question.word===x.word);return{word:x.word,position:(b==null?void 0:b.position)||0,category:(v=b==null?void 0:b.status)==null?void 0:v.category,attempts:((w=b==null?void 0:b.status)==null?void 0:w.attempts)||0}});localStorage.setItem("debug_postProcess_output",JSON.stringify({timestamp:new Date().toISOString(),mode:s.mode,source:"scheduleHybridMode",top30:g}))}catch{}const f=this.antiVibration.calculateVibrationScore(a,s.recentAnswers,20),m=performance.now()-t;return R.info("[QuestionScheduler Hybrid] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(m)+"ms",vibrationScore:f,incorrectCount:c.length,stillLearningCount:l.length,aiEnabled:this.useAICoordinator,totalCount:p.length}),{scheduledQuestions:p,vibrationScore:f,processingTime:m,signalCount:r.length}}async scheduleFinalPriorityMode(e,t){var k;const s=this.buildContext(e),r=e.useMetaAI?this.detectSignals(s):[],o=this.loadProgressCache(),i=(o==null?void 0:o.wordProgress)??{},a=e.mode==="grammar"?"grammar":e.mode==="memorization"?"memorization":"comprehensive",c=(e.sessionStats.correct||0)+(e.sessionStats.incorrect||0)+(e.sessionStats.still_learning||0)+(e.sessionStats.mastered||0);let l=0,d=0,h=0,p=0;for(const I of Object.values(i)){const T=Bt(I,e.mode);T>=70?h++:T>=40?d++:T>=20?p++:l++}const f={totalAttempts:c,correctAnswers:e.sessionStats.correct||0,incorrectAnswers:e.sessionStats.incorrect||0,stillLearningAnswers:e.sessionStats.still_learning||0,sessionStartTime:s.sessionStartTime,sessionDuration:e.sessionStats.duration||0,consecutiveIncorrect:0,masteredCount:l,stillLearningCount:d,incorrectCount:h,newCount:p,consecutiveCorrect:e.sessionStats.consecutiveCorrect||0};if(!this.useAICoordinator||!this.aiCoordinator)return R.warn("[QuestionScheduler FinalPriority] AICoordinator„ÅåÊú™ÂàùÊúüÂåñ„ÄÅ„Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„Éâ„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ"),this.scheduleHybridMode(e,t);const m=[];for(const I of e.questions){const T=i[I.word]??s.wordProgress[I.word]??null,_=this.getWordStatusFromCache(I.word,s.mode,o),D=(_==null?void 0:_.position)??Bt(T,e.mode);let P=0,A=0;if(T)switch(e.mode){case"memorization":P=T.memorizationAttempts||0,A=T.memorizationCorrect||0;break;case"translation":P=T.translationAttempts||0,A=T.translationCorrect||0;break;case"spelling":P=T.spellingAttempts||0,A=T.spellingCorrect||0;break;case"grammar":P=T.grammarAttempts||0,A=T.grammarCorrect||0;break}const F=_??{category:Qr(D),position:D,lastStudied:(T==null?void 0:T.lastStudied)||0,attempts:P,correct:A,streak:(T==null?void 0:T.consecutiveCorrect)||0,forgettingRisk:0,reviewInterval:1},O=await this.aiCoordinator.analyzeAndCoordinate({word:{word:I.word,meaning:I.meaning,reading:I.reading,difficulty:I.difficulty,category:I.category,source:I.source,type:I.type,isPhraseOnly:I.isPhraseOnly},progress:T,sessionStats:f,currentTab:a,allProgress:i},D/100);m.push({question:I,position:D,finalPriority:O.finalPriority,status:F,attempts:(F==null?void 0:F.attempts)??0,timeBoost:1})}const g=new qa,y=g.boostStillLearningQuestions(m).result;for(const I of y)I.position>=60&&I.position<70&&(((k=I.status)==null?void 0:k.attempts)??0)>0&&(I.finalPriority=(I.finalPriority??0)+100);const{result:b}=g.adjustPositionForInterleaving(y),v=[...b].sort((I,T)=>(T.finalPriority??0)-(I.finalPriority??0)),w=g.interleaveByCategory(v);try{const I=w.slice(0,30).map((_,D)=>{var P,A;return{rank:D+1,word:_.question.word,position:_.position,finalPriority:_.finalPriority??0,category:(P=_.status)==null?void 0:P.category,attempts:((A=_.status)==null?void 0:A.attempts)??0}});Pi("debug_finalPriority_output",I,{mode:s.mode});const T={currentTab:a,totalQuestions:e.questions.length,allProgressCount:Object.keys(i||{}).length,aiSessionStats:f,timestamp:new Date().toISOString(),mode:s.mode};Pi("debug_finalPriority_sessionStats",T,{mode:s.mode})}catch{}const S=this.postProcess(w,s);try{const I=S.slice(0,30).map(_=>{var P,A;const D=w.find(F=>F.question.word===_.word);return{word:_.word,position:(D==null?void 0:D.position)||_.position||0,category:(P=D==null?void 0:D.status)==null?void 0:P.category,attempts:((A=D==null?void 0:D.status)==null?void 0:A.attempts)||0,finalPriority:(D==null?void 0:D.finalPriority)??_.finalPriority??0}}),T={timestamp:new Date().toISOString(),mode:s.mode,source:"scheduleFinalPriorityMode",top30:I};Pi("debug_postProcess_output",T,{mode:s.mode})}catch{}const N=this.antiVibration.calculateVibrationScore(w,s.recentAnswers,20),C=performance.now()-t;return R.info("[QuestionScheduler FinalPriority] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(C)+"ms",vibrationScore:N,aiEnabled:!0,totalCount:S.length,top5FinalPriority:w.slice(0,5).map(I=>({word:I.question.word,finalPriority:(I.finalPriority??0).toFixed(3),position:I.position}))}),{scheduledQuestions:S,vibrationScore:N,processingTime:C,signalCount:r.length}}postProcess(e,t){const s=e.map(a=>({...a.question,position:a.position,finalPriority:a.finalPriority})),r=a=>a>=70?0:a>=60?1:a>=40?2:a>=20?3:4;let o=!1,i=-1;for(const a of e){const c=r(a.position);if(i!==-1&&c<i){o=!0;break}i=c}try{const a=e.slice(0,30).map(l=>{var d;return{word:l.question.word,position:l.position??0,attempts:((d=l.status)==null?void 0:d.attempts)??0}}),c={timestamp:new Date().toISOString(),mode:t.mode,isInterleavedAcrossBands:o,action:o?"skipped_contextual_reorder":"applied_contextual_reorder",top30:a};Pi("debug_postProcess_meta",c,{mode:t.mode})}catch{}if(o)return s;try{const a=this.getAllProgress(),c=this.getRecentlyStudiedWords(t),l=this.splitByPositionBands(e,t),d=[];let h=0,p=0;for(const f of l){if(f.questions.length===0)continue;const m=f.questions.map(b=>({...b.question,position:b.position,finalPriority:b.finalPriority})),g=eI(m,a,[]),x=new Map(m.map(b=>[b.word,b])),y=g.sequence.map(b=>x.get(b)).filter(b=>b!==void 0);d.push(...y),h+=g.clusters.length,p+=g.transitions.length}try{const f=d.slice(0,30).map((x,y)=>({rank:y+1,word:x.word,position:x.position??0,attempts:x.attempts??0})),m={incorrect:f.filter(x=>x.position>=70).length,stillLearning:f.filter(x=>x.position>=60&&x.position<70).length,newBoosted:f.filter(x=>x.position>=40&&x.position<60).length,newNormal:f.filter(x=>x.position>=20&&x.position<40).length,mastered:f.filter(x=>x.position<20).length},g={timestamp:new Date().toISOString(),mode:t.mode,source:"postProcess",top30:f,positionDistribution:m,totalQuestions:d.length};Pi("debug_postProcess_output",g,{mode:t.mode})}catch{}return d}catch(a){return R.warn("[postProcess] Èñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„Åß„Ç®„É©„Éº„ÄÅÂü∫Êú¨È†ÜÂ∫è„Çí‰ΩøÁî®:",a),s}}splitByPositionBands(e,t){const s=[{range:"70-100 (incorrect)",min:70,max:100,questions:[]},{range:"60-69 (still_learning)",min:60,max:69,questions:[]},{range:"40-59 (new boosted)",min:40,max:59,questions:[]},{range:"20-39 (new normal)",min:20,max:39,questions:[]},{range:"0-19 (mastered)",min:0,max:19,questions:[]}];return e.forEach(r=>{const o=r.position;for(const i of s)if(o>=i.min&&o<=i.max){i.questions.push(r);break}}),s.filter(r=>r.questions.length>0)}getRecentlyStudiedWords(e){const t=[],s=Date.now(),r=5*60*1e3;for(const[o,i]of Object.entries(e.wordProgress)){const a=i==null?void 0:i.lastStudied;a&&s-new Date(a).getTime()<r&&t.push(o)}return t.slice(-20)}clearCache(){this.recentAnswersCache.clear(),R.info("[QuestionScheduler] „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü")}getWordProgress(e){var t;try{return((t=et().wordProgress)==null?void 0:t[e])||null}catch{return null}}getAllProgress(){try{return et().wordProgress||{}}catch{return{}}}convertToAISessionStats(e){return{totalAttempts:e.correct+e.incorrect+e.still_learning,correctAnswers:e.correct||0,incorrectAnswers:e.incorrect||0,stillLearningAnswers:e.still_learning||0,sessionStartTime:Date.now()-(e.duration||0),sessionDuration:e.duration||0,avgResponseTime:e.avgResponseTime,consecutiveIncorrect:e.consecutiveIncorrect||0,masteredCount:e.masteredCount||0,stillLearningCount:e.still_learningCount||0,incorrectCount:e.incorrectCount||0,newCount:e.newCount||0}}recalculatePriorityAfterAnswer(e,t,s="memorization"){const r=(()=>{switch(s){case"memorization":return t.memorizationPosition??50;case"translation":return t.translationPosition??50;case"spelling":return t.spellingPosition??50;case"grammar":return t.grammarPosition??50;default:return 50}})(),o=this.determinePositionAfterAnswer(t,s),i=Bt(t,s),a=MK(t,s);(Date.now()-(t.lastStudied||Date.now()))/(1e3*60*60*24);const c=Qr(o),l=t.correctCount+t.incorrectCount;t.accuracyRate=l>0?t.correctCount/l:0;let d=0,h=0,p=0;switch(s){case"memorization":d=t.memorizationAttempts||0,h=t.memorizationCorrect||0,p=t.memorizationStillLearning||0;break;case"translation":d=t.translationAttempts||0,h=t.translationCorrect||0;break;case"spelling":d=t.spellingAttempts||0,h=t.spellingCorrect||0;break;case"grammar":d=t.grammarAttempts||0,h=t.grammarCorrect||0;break}try{const f={timestamp:new Date().toISOString(),word:e,mode:s,positionBefore:r,positionAfter:o,positionWithSavedPosition:i,category:c,savedPositionDebug:a,progress:{correctCount:t.correctCount,incorrectCount:t.incorrectCount,consecutiveCorrect:t.consecutiveCorrect||0,consecutiveIncorrect:t.consecutiveIncorrect||0,accuracy:t.accuracyRate||0,modeAttempts:d,modeCorrect:h,modeStillLearning:p}},m=localStorage.getItem("debug_answer_logs"),g=m?JSON.parse(m):[];g.push(f),g.length>20&&g.shift(),localStorage.setItem("debug_answer_logs",JSON.stringify(g))}catch{}return o}calculateAIEvaluations(e,t,s){const r=e.correctCount+e.incorrectCount,o=r>0?e.correctCount/r:0,i=e.consecutiveCorrect||0,a=e.consecutiveIncorrect||0,c=new WN,l=new BN,d=new VN,h=new GN,p=new HN,f=new UN,m=new qa;return{memory:c.proposePosition(e,"",s,o,r),cognitiveLoad:l.proposePosition(e,a),errorPrediction:d.proposePosition(e,o,r),linguistic:h.proposePosition(e,o),contextual:p.proposePosition(e,s),learningStyle:f.proposePosition(e,o,r),gamification:m.proposePosition(e,i,o)}}recordAIEvaluation(e,t){try{const s="debug_ai_evaluations",r=localStorage.getItem(s),o=r?JSON.parse(r):{};o[e]={...t,word:e};const i=Object.entries(o);if(i.length>100){const d=Object.fromEntries(i.slice(-100));localStorage.setItem(s,JSON.stringify(d))}else localStorage.setItem(s,JSON.stringify(o));const a=(t==null?void 0:t.aiEvaluations)??(t==null?void 0:t.aiProposals)??{},c=Object.values(a).map(d=>Number(d).toFixed(1)).join("/"),l=Number((t==null?void 0:t.finalPriority)??(t==null?void 0:t.position)??0);console.log(`ü§ñ [AIË©ï‰æ°] ${e}: ${l.toFixed(1)}[${c}] (${(t==null?void 0:t.category)??"n/a"})`)}catch{}}determinePosition(e,t="memorization"){return Bt(e,t)}determinePositionAfterAnswer(e,t="memorization"){const s={...e};switch(t){case"memorization":s.memorizationPosition=void 0;break;case"translation":s.translationPosition=void 0;break;case"spelling":s.spellingPosition=void 0;break;case"grammar":s.grammarPosition=void 0;break}return Bt(s,t)}enforceCompletionRequirement(e){return e>=70?100:e>=40?75:e<20?10:50}calculateDifficultyAdaptation(e){if(!e||!e.wordProgress)return{beginner:70,intermediate:60,advanced:50,shouldPrioritizeBeginner:!1,priorityBoost:0};const t=Object.values(e.wordProgress||{}),s={beginner:{correct:0,total:0},intermediate:{correct:0,total:0},advanced:{correct:0,total:0}};t.forEach(a=>{const l={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[a.difficulty];if(l&&s[l]){const d=(a.correctCount||0)+(a.incorrectCount||0);s[l].total+=d,s[l].correct+=a.correctCount||0}});const r={beginner:s.beginner.total>0?s.beginner.correct/s.beginner.total*100:70,intermediate:s.intermediate.total>0?s.intermediate.correct/s.intermediate.total*100:60,advanced:s.advanced.total>0?s.advanced.correct/s.advanced.total*100:50},o=r.intermediate<60||r.advanced<50;let i=0;if(o){const a=Math.max(0,60-r.intermediate),c=Math.max(0,50-r.advanced);i=Math.min(20,(a+c)/2)}return{...r,shouldPrioritizeBeginner:o,priorityBoost:i}}applyDifficultyAdaptation(e,t,s){if(!s.shouldPrioritizeBeginner)return e;const o={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[t.difficulty];return o?o==="beginner"?Math.max(0,e-s.priorityBoost):o==="intermediate"||o==="advanced"?Math.min(100,e+Math.min(10,s.priorityBoost/2)):e:e}}const yy={maxReviewCount:10};function Yg(){try{const n=localStorage.getItem("study-settings");if(n)return{maxReviewCount:JSON.parse(n).maxReviewCount??yy.maxReviewCount}}catch(n){R.error("Â≠¶ÁøíË®≠ÂÆö„ÅÆÂèñÂæó„Ç®„É©„Éº:",n)}return{...yy}}const KK="session-history",QK=50;async function ga(n,e){const t=tf()&&sf();try{if(t)await pr(Nn.SESSION_HISTORY,{mode:e,status:n.status,word:n.word,timestamp:n.timestamp});else{const s=`${KK}-${e}`,r=localStorage.getItem(s),o=r?JSON.parse(r):[];o.push(n),o.length>QK&&o.shift(),localStorage.setItem(s,JSON.stringify(o))}}catch(s){R.error("„Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",s)}}function Mu(){const n=et(),e=new Date().toLocaleDateString("ja-JP"),t=new Set;return n.results.forEach(s=>{new Date(s.date).toLocaleDateString("ja-JP")===e&&s.incorrectWords.forEach(r=>t.add(r))}),Array.from(t)}function Fu(n){const e=et(),t=new Date().setHours(0,0,0,0),s=t+24*60*60*1e3;let r=e.results.filter(c=>c.date>=t&&c.date<s);n&&(r=r.filter(c=>c.mode===n));const o=r.reduce((c,l)=>c+l.score,0),i=r.reduce((c,l)=>c+l.total,0),a=i>0?Math.round(o/i*100):0;return{todayCorrectCount:o,todayTotalAnswered:i,todayAccuracy:a}}function Jg(){const n=et(),e=new Date,t=e.getDay(),s=t===0?-6:1-t,r=new Date(e);r.setDate(e.getDate()+s),r.setHours(0,0,0,0);const o=new Date(r);o.setDate(r.getDate()+7);const i=new Date(r);i.setDate(r.getDate()-7);const a=new Date(r),c=n.results.filter(b=>b.date>=r.getTime()&&b.date<o.getTime()),l=n.results.filter(b=>b.date>=i.getTime()&&b.date<a.getTime()),d=new Set;c.forEach(b=>{const v=new Date(b.date).toISOString().split("T")[0];d.add(v)});const h=c.reduce((b,v)=>b+v.total,0),p=c.reduce((b,v)=>b+v.score,0),f=h>0?p/h*100:0,m=l.reduce((b,v)=>b+v.total,0),g=l.reduce((b,v)=>b+v.score,0),x=m>0?g/m*100:0;let y=0;return Object.values(n.wordProgress).forEach(b=>{b.masteryLevel==="mastered"&&b.lastStudied>=r.getTime()&&y++}),{studyDays:d.size,totalDays:7,totalAnswered:h,accuracy:f,newMastered:y,previousWeekAccuracy:x}}function Zg(){const n=et(),e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const s=new Date(e.getFullYear(),e.getMonth()+1,0);s.setHours(23,59,59,999);const r=n.results.filter(h=>h.date>=t.getTime()&&h.date<=s.getTime()),o=new Set;r.forEach(h=>{const p=new Date(h.date).toISOString().split("T")[0];o.add(p)});const i=r.reduce((h,p)=>h+p.total,0),a=r.reduce((h,p)=>h+p.score,0),c=i>0?a/i*100:0;let l=0;Object.values(n.wordProgress).forEach(h=>{h.masteryLevel==="mastered"&&h.lastStudied>=t.getTime()&&l++});const d=s.getDate();return{studyDays:o.size,totalDays:d,totalAnswered:i,accuracy:c,newMastered:l}}function Ou(){const n=et(),e=Object.values(n.wordProgress),t=e.filter(d=>(d.totalAttempts||0)>0);let s=0,r=0,o=0;const i=t.slice(0,Math.min(500,t.length)),a=t.length/i.length;i.forEach(d=>{const h=Bt(d);h<40?s++:h>=40&&h<70?r++:h>=70&&o++}),s=Math.round(s*a),r=Math.round(r*a),o=Math.round(o*a);const c=t.length,l=s*1+r*.5;return{totalWords:e.length,appearedWords:c,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:c>0?Math.round(s/c*100):0,weightedRetentionRate:c>0?Math.round(l/c*100):0,masteredPercentage:c>0?Math.round(s/c*100):0,learningPercentage:c>0?Math.round(r/c*100):0,strugglingPercentage:c>0?Math.round(o/c*100):0,masteredWords:s,learningWords:r,newWords:e.length-c,retentionRate:c>0?Math.round(s/c*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function nI(){const n=et();let e=0,t=0,s=0,r=0,o=0;return Object.values(n.wordProgress).forEach(i=>{const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=Bt(i);if(c<20){i.consecutiveCorrect>=7?o++:i.consecutiveCorrect>=5&&r++;return}if(c>=40){t++;const{consecutiveCorrect:l}=i,d=i.correctCount/a;l===2||d>=.9&&l===1&&a>=2||a>=4&&d>=.75?(e++,s+=1):s+=Math.max(1,3-l)}}),{nearMasteryCount:e,learningCount:t,averageRemainingAnswers:t>0?Math.round(s/t*10)/10:0,longTermMemoryCount:r,superMemoryCount:o}}function e0(n=7,e=10){const t=et(),s=Date.now()-n*24*60*60*1e3;return Object.entries(t.wordProgress).filter(([o,i])=>i.masteryLevel==="mastered"&&i.lastStudied>=s).map(([o,i])=>({word:o,masteredDate:i.lastStudied,totalAttempts:i.correctCount+i.incorrectCount})).sort((o,i)=>i.masteredDate-o.masteredDate).slice(0,e)}function Lu(){const n=et(),t=Object.values(n.wordProgress).filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.word.startsWith("grammar_")||l.word.includes("_g")),s=t.filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.correctCount+l.incorrectCount>0);let r=0,o=0,i=0;s.forEach(l=>{const d=l.grammarAttempts||l.correctCount+l.incorrectCount,h=l.grammarCorrect||l.correctCount,p=l.grammarStreak||l.consecutiveCorrect,f=d>0?h/d*100:0;d===1&&h===1||p>=3||p>=2&&f>=80?r++:f>=50?o++:i++});const a=s.length,c=r*1+o*.5;return{totalWords:t.length,appearedWords:a,masteredCount:r,learningCount:o,strugglingCount:i,basicRetentionRate:a>0?Math.round(r/a*100):0,weightedRetentionRate:a>0?Math.round(c/a*100):0,masteredPercentage:a>0?Math.round(r/a*100):0,learningPercentage:a>0?Math.round(o/a*100):0,strugglingPercentage:a>0?Math.round(i/a*100):0,masteredWords:r,learningWords:o,newWords:t.length-a,retentionRate:a>0?Math.round(r/a*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function zu(){const n=et(),e=Object.values(n.wordProgress),t=e.filter(c=>c.memorizationAttempts&&c.memorizationAttempts>0);let s=0,r=0,o=0;t.forEach(c=>{c.category}),t.forEach(c=>{const l=Bt(c,"memorization");l<40?s++:l>=40&&l<70?r++:l>=70&&o++});const i=t.length,a=s*1+r*.5;return{totalWords:e.length,appearedWords:i,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:i>0?Math.round(s/i*100):0,weightedRetentionRate:i>0?Math.round(a/i*100):0,masteredPercentage:i>0?Math.round(s/i*100):0,learningPercentage:i>0?Math.round(r/i*100):0,strugglingPercentage:i>0?Math.round(o/i*100):0,masteredWords:s,learningWords:r,newWords:e.length-i,retentionRate:i>0?Math.round(s/i*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function t0(){const n=et(),e=Object.entries(n.wordProgress).filter(([r,o])=>r.startsWith("grammar_")),t=new Map;e.forEach(([r,o])=>{const i=r.match(/grammar_(?:\w+-)?g(\d+)-u(\d+)/);if(!i){r.startsWith("grammar_")&&!r.includes("unknown")&&console.warn(`‚ö†Ô∏è ÊñáÊ≥ïÂïèÈ°åID„Åå„Éë„Çø„Éº„É≥„Å´„Éû„ÉÉ„ÉÅ„Åó„Åæ„Åõ„Çì: ${r}`);return}const a=i[1],c=i[2],l=`‰∏≠${a}_Unit${c}`;t.has(l)||t.set(l,{questions:[],answered:[],correct:0,incorrect:0,mastered:0,allHistory:[]});const d=t.get(l);d.questions.push([r,o]);const h=o.grammarAttempts||o.correctCount+o.incorrectCount;if(h>0){d.answered.push([r,o]);const p=o.grammarCorrect||o.correctCount||0,f=h-p;if(d.correct+=p,d.incorrect+=f,o.learningHistory&&o.learningHistory.length>0){const v=o.learningHistory.slice(-10);d.allHistory.push(...v)}const m=o.grammarStreak||o.consecutiveCorrect||0,g=h>0?p/h*100:0,x=o.masteryLevel==="mastered",y=h===1&&p===1,b=h>=3&&g>=85;(x||y||b||m>=3)&&d.mastered++}});const s=Array.from(t.entries()).map(([r,o])=>{const i=o.correct+o.incorrect,a=i>0?o.correct/i*100:0,c=o.questions.length>0?o.answered.length/o.questions.length*100:0,d=o.allHistory.sort((h,p)=>h.timestamp-p.timestamp).slice(-10).map(h=>h.wasCorrect?"üü©":"üü•").join("");return{unit:r,totalQuestions:o.questions.length,answeredQuestions:o.answered.length,correctCount:o.correct,incorrectCount:o.incorrect,masteredCount:o.mastered,accuracy:Math.round(a),progress:Math.round(c),historyIcons:d}});return s.sort((r,o)=>r.unit.localeCompare(o.unit)),s}function rp(n){const e=et(),s=Object.entries(e.wordProgress).map(([r,o])=>{let i=0;if(n){switch(n){case"memorization":i=o.memorizationAttempts||0;break;case"translation":i=o.translationAttempts||0;break;case"spelling":i=o.spellingAttempts||0;break;case"grammar":i=o.grammarAttempts||0;break}if(i===0)return null}else if(i=o.totalAttempts||0,i===0)return null;const a=n?Bt(o,n):Bt(o);if(a<40)return null;const c=a>=70?"incorrect":"still_learning";return{word:r,position:a,category:c,attempts:i,correctCount:o.correctCount||0,incorrectCount:o.incorrectCount||0,lastStudied:o.lastStudied||0}}).filter(r=>r!==null);return s.sort((r,o)=>o.position-r.position),s}const sI="english-progress",by=9999,wy=3;function si(){return{results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},categoryStats:{},difficultyStats:{},wordProgress:{}}}async function ps(){try{const n=await Xy();if(!n){const i=si();return Jr(i),i}const e=n,t={results:e.results||[],statistics:e.statistics||{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:e.questionSetStats||{},categoryStats:{},difficultyStats:{},wordProgress:e.wordProgress||{}};t.statistics||(t.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),t.questionSetStats||(t.questionSetStats={}),t.wordProgress||(t.wordProgress={}),t.results||(t.results=[]),n0(t);let s=0,r=0,o=!1;Object.values(t.wordProgress).forEach(i=>{i.category||(i.category="Êú™ÂàÜÈ°û",s++,o=!0);const a=i.memorizationAttempts||0,c=i.memorizationStillLearning||0,l=i.consecutiveIncorrect||0,d=i.memorizationPosition;if(a>0&&(c>0||l>0)){const h=typeof d=="number"?d:-1;if(h<40){const p=Bt({...i,memorizationPosition:void 0},"memorization");typeof p=="number"&&p>=40&&p>h&&(i.memorizationPosition=p,r++,o=!0)}}}),o&&(s>0&&R.info(`[Category Repair] ${s}ÂÄã„ÅÆÂçòË™û„Å´category„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`),r>0&&R.info(`[Position Repair] memorizationPosition„ÇíÂÜçË®àÁÆó„Åó„Å¶Ë£úÊ≠£: ${r}Ë™û`),await rf(t));try{localStorage.setItem("debug_progress_repair_summary",JSON.stringify({timestamp:new Date().toISOString(),categoryAdded:s,memorizationPositionRepaired:r,saved:o}))}catch{}return Jr(t),t}catch(n){R.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=si();return Jr(e),e}}let ur=null;function XK(){return ur||(ur=si(),R.log("üì¶ Progress cache initialized with default data")),ur}function et(){if(ur)return ur.statistics||(R.warn("‚ö†Ô∏è Cache missing statistics, reinitializing"),ur=si()),ur;XK();try{const n=localStorage.getItem(sI);if(!n){const t=si();return ur=t,t}const e=JSON.parse(n);return e.statistics||(e.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),e.questionSetStats||(e.questionSetStats={}),e.wordProgress||(e.wordProgress={}),e.results||(e.results=[]),e.results||(e.results=[]),n0(e),ur=e,e}catch(n){R.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=si();return ur=e,e}}function Jr(n){ur=n,R.log("üîÑ progressCacheÊõ¥Êñ∞ - results‰ª∂Êï∞:",n.results.length)}async function co(n){try{n0(n),Jr(n);try{localStorage.setItem(sI,JSON.stringify(n))}catch(s){R.warn("LocalStorage‰øùÂ≠òÂ§±ÊïóÔºàÂÆπÈáè‰∏çË∂≥„ÅÆÂèØËÉΩÊÄßÔºâ:",s)}const e={quizzes:{},lastUpdated:Date.now(),totalAnswered:{},totalMastered:{},results:n.results,statistics:n.statistics,questionSetStats:n.questionSetStats,wordProgress:n.wordProgress};await rf(e)||R.error("„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}catch(e){R.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:",e)}}function n0(n){n.results.length>by&&(n.results.sort((e,t)=>t.date-e.date),n.results=n.results.slice(0,by)),Object.values(n.wordProgress).forEach(e=>{e.responseTimes&&e.responseTimes.length>wy&&(e.responseTimes=e.responseTimes.slice(-wy))})}async function dc(n){const e=await ps();e.results.push(n),R.log("‚úÖ addQuizResultÂëº„Å≥Âá∫„Åó:",{mode:n.mode,score:n.score,total:n.total,date:new Date(n.date).toISOString(),resultsCount:e.results.length}),YK(e,n),await co(e),R.log("üíæ saveProgressÂÆå‰∫Ü - results‰ª∂Êï∞:",e.results.length);try{if(typeof window<"u"){const t=new CustomEvent(ea,{detail:{result:n}});window.dispatchEvent(t)}}catch{}}function YK(n,e){const t=n.statistics;t.totalQuizzes++,t.totalQuestions+=e.total,t.totalCorrect+=e.score,t.averageScore=t.totalQuestions>0?t.totalCorrect/t.totalQuestions*100:0,t.bestScore=Math.max(t.bestScore,e.percentage),t.lastStudyDate=e.date;const s=new Date(e.date).setHours(0,0,0,0);t.studyDates.includes(s)||(t.studyDates.push(s),t.studyDates.sort((a,c)=>c-a)),t.streakDays=JK(t.studyDates),n.questionSetStats[e.questionSetId]||(n.questionSetStats[e.questionSetId]={attempts:0,bestScore:0,averageScore:0,lastAttempt:0,totalTimeSpent:0});const r=n.questionSetStats[e.questionSetId];r.attempts++,r.bestScore=Math.max(r.bestScore,e.percentage),r.lastAttempt=e.date,r.totalTimeSpent+=e.timeSpent;const o=n.results.filter(a=>a.questionSetId===e.questionSetId),i=o.reduce((a,c)=>a+c.percentage,0);r.averageScore=i/o.length}function JK(n){if(n.length===0)return 0;const e=new Date().setHours(0,0,0,0),t=e-24*60*60*1e3,s=n[0];if(s!==e&&s!==t)return 0;let r=1;for(let o=1;o<n.length&&(n[o-1]-n[o])/(24*60*60*1e3)===1;o++)r++;return r}function s0(n=10){const e=et(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{if(r<5)return;const i=e.wordProgress[o];if(!i)return;const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=i.correctCount/a*100,l=c>=80,h=a===1&&i.correctCount===1||i.consecutiveCorrect>=3||c>=85;if(l&&h){const p=r*c;s.push({word:o,totalMistakes:r,recentAccuracy:Math.round(c),overcomeScore:p})}}),s.sort((r,o)=>o.overcomeScore-r.overcomeScore).slice(0,n)}function Ih(n=10){const e=et(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{const i=e.wordProgress[o];if(!i){s.push({word:o,mistakes:r,recentAccuracy:0,meaning:void 0,reading:void 0});return}const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=a===1&&i.correctCount===1;r>=5&&c>=80&&(l||i.consecutiveCorrect>=3||c>=85)||s.push({word:o,mistakes:r,recentAccuracy:Math.round(c),meaning:i.meaning,reading:i.reading})}),s.sort((r,o)=>o.mistakes-r.mistakes).slice(0,n)}function rI(n){return{word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,firstAttempted:Date.now(),lastStudied:0,totalResponseTime:0,averageResponseTime:0,difficultyScore:50,masteryLevel:"new",responseTimes:[],category:"new"}}function ZK(n){const e=n.correctCount+n.incorrectCount;if(e===0)return 50;const s=(1-n.correctCount/e)*100,r=Math.min(n.consecutiveIncorrect*5,20),o=n.averageResponseTime/1e3,i=Math.min(o>5?(o-5)*3:0,15),a=n.userDifficultyRating?(n.userDifficultyRating-5.5)*5:0,c=s+r+i+a;return Math.max(0,Math.min(100,c))}function ho(n){const e=[1,1,3,7,14,30,90,180,365];return n>=e.length?365:e[n]||1}function r0(n,e){const t=n.correctCount+n.incorrectCount,s=t>0?n.correctCount/t:0,{consecutiveCorrect:r,lastStudied:o}=n,a=(Date.now()-o)/(1e3*60*60)/24;if(t===1&&e){const c=ho(1);return{isMastered:!0,excludeDays:c,reason:`1Áô∫Ê≠£Ëß£Ôºà${c}Êó•Âæå„Å´ÂÜçÁ¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:1}}if(r>=2&&e){const c=ho(r),l=Math.min(7,Math.floor(r/1));let d="";return r>=7?d=`Ë∂ÖÈï∑ÊúüË®òÊÜ∂ÈÅîÊàêÔºÅÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âπ¥Ê¨°Á¢∫Ë™çÔºâ`:r>=5?d=`Èï∑ÊúüË®òÊÜ∂ÂÆöÁùÄÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:r>=3?d=`Áü≠Êúü‚ÜíÈï∑ÊúüË®òÊÜ∂ÁßªË°åÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:d=`Â≠¶Áøí‰∏≠ÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âæ©ÁøíÔºâ`,{isMastered:!0,excludeDays:c,reason:d,confidence:Math.min(.99,.75+r*.05),masteryLevel:l}}if(t>=3&&s>=.9&&r>=2){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`È´òÁ≤æÂ∫¶ÂÆâÂÆöÂûãÔºàÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.88,masteryLevel:2}}if(r>=2&&a>=7&&e){const c=ho(r),l=Math.floor(c*1.5);return{isMastered:!0,excludeDays:l,reason:`Èï∑ÊúüË®òÊÜ∂ÂûãÔºà7Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.92,masteryLevel:3}}if(r>=2&&a>=3&&e){const c=ho(r),l=Math.floor(c*1.2);return{isMastered:!0,excludeDays:l,reason:`‰∏≠ÊúüË®òÊÜ∂ÂûãÔºà3Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:2}}if(r>=2&&a<=1&&s>=.85&&t>=4){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`Áü≠ÊúüÂÆåÁíßÂûãÔºà24ÊôÇÈñìÂÜÖ„Å´ÈÄ£Á∂öÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.8,masteryLevel:1}}if(t>=5&&s>=.8&&e){const c=Math.max(7,ho(2));return{isMastered:!0,excludeDays:c,reason:`È´òÂõûÊï∞ÂÆâÂÆöÂûãÔºà${t}ÂõûÊåëÊà¶„ÉªÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.83,masteryLevel:2}}if(r>=2&&s>=.75&&t>=3&&e){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`Ê¨°ÂõûÂÆöÁùÄÈÅîÊàêÔºà${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.78,masteryLevel:1}}return{isMastered:!1,excludeDays:0,reason:"Êú™ÂÆöÁùÄ",confidence:1,masteryLevel:0}}function eQ(n){const e=n.correctCount+n.incorrectCount;if(e===0)return"new";const t=n.correctCount/e,s=e===1&&n.correctCount===1,r=e===2&&t===1,o=e>=5&&t>=.85,i=e>=3&&t>=.9,a=n.consecutiveCorrect>=5,c=e>=10&&t>=.75&&n.consecutiveCorrect>=2;return s||r||o||i||a||c?"mastered":"learning"}async function So(n,e,t,s,r,o){const i=await ps();let a=i.wordProgress[n];if(a||(a=rI(n),i.wordProgress[n]=a),a.lastRetentionRate!==void 0){const m=a.lastRetentionRate,g=e?1:o?.5:0;gs(async()=>{const{getPredictionLogger:x}=await Promise.resolve().then(()=>IY);return{getPredictionLogger:x}},void 0).then(({getPredictionLogger:x})=>{x().logPrediction(n,m,g).catch(y=>{console.warn("Failed to log prediction:",y)})})}e?(a.correctCount++,a.consecutiveCorrect++,a.consecutiveIncorrect=0):o?(a.consecutiveCorrect=0,a.consecutiveIncorrect=0):(a.incorrectCount++,a.consecutiveIncorrect++,a.consecutiveCorrect=0);const c=r;c==="translation"?(a.translationAttempts=(a.translationAttempts||0)+1,e?(a.translationCorrect=(a.translationCorrect||0)+1,a.translationStreak=(a.translationStreak||0)+1):a.translationStreak=0):c==="spelling"?(a.spellingAttempts=(a.spellingAttempts||0)+1,e?(a.spellingCorrect=(a.spellingCorrect||0)+1,a.spellingStreak=(a.spellingStreak||0)+1):a.spellingStreak=0):c==="grammar"?(a.grammarAttempts=(a.grammarAttempts||0)+1,e?(a.grammarCorrect=(a.grammarCorrect||0)+1,a.grammarStreak=(a.grammarStreak||0)+1):a.grammarStreak=0):c==="memorization"&&(a.memorizationAttempts=(a.memorizationAttempts||0)+1,e?(a.memorizationCorrect=(a.memorizationCorrect||0)+1,a.memorizationStreak=(a.memorizationStreak||0)+1):o?a.memorizationStillLearning=(a.memorizationStillLearning||0)+1:a.memorizationStreak=0),a.totalAttempts=(a.translationAttempts||0)+(a.spellingAttempts||0)+(a.grammarAttempts||0)+(a.memorizationAttempts||0),a.totalResponseTime+=t;const l=a.correctCount+a.incorrectCount;if(l>0&&(a.averageResponseTime=a.totalResponseTime/l),s!==void 0&&(a.userDifficultyRating=s),a.lastStudied=Date.now(),c==="memorization"){a.easinessFactor===void 0&&(a.easinessFactor=2.5),e?a.easinessFactor=Math.min(2.5,a.easinessFactor+.1):o||(a.easinessFactor=Math.max(1.3,a.easinessFactor-.2));const m=a.memorizationStreak||0,g=a.easinessFactor;let x=0;if(m===0)x=0;else if(m===1)x=1;else if(m===2)x=3;else if(m===3)x=7;else{const y=a.reviewInterval||7;x=Math.round(y*g)}a.reviewInterval=x,a.lastReviewDate=Date.now(),a.totalReviews=(a.totalReviews||0)+1,a.avgResponseSpeed?a.avgResponseSpeed=a.avgResponseSpeed*.8+t*.2:a.avgResponseSpeed=t,t<2e3&&e&&(a.easinessFactor=Math.min(2.5,a.easinessFactor+.05))}a.learningHistory||(a.learningHistory=[]),a.learningHistory.push({timestamp:Date.now(),wasCorrect:e,responseTime:t,sessionIndex:0}),o||(a.responseTimes||(a.responseTimes=[]),a.responseTimes.push(t),a.responseTimes.length>10&&(a.responseTimes=a.responseTimes.slice(-10))),a.learningHistory.length>20&&(a.learningHistory=a.learningHistory.slice(-20)),a.difficultyScore=ZK(a);const d=a.masteryLevel;a.masteryLevel=eQ(a),d!==a.masteryLevel&&R.log(`üîÑ ${n}: ${d} ‚Üí ${a.masteryLevel} (Ê≠£Ëß£: ${a.correctCount}, ‰∏çÊ≠£Ëß£: ${a.incorrectCount}, ÈÄ£Á∂ö: ${a.consecutiveCorrect})`);const h=r0(a,e);h.isMastered&&(a.skipExcludeUntil=Date.now()+h.excludeDays*24*60*60*1e3,tQ(n),h.reason!=="Êú™ÂÆöÁùÄ"&&R.log(`‚úÖ ${n} „ÅåÂÆöÁùÄ: ${h.reason} (Èô§Â§ñÊúüÈñì: ${h.excludeDays}Êó•)`));const f=new jl().recalculatePriorityAfterAnswer(n,a,c);if(c==="memorization"?a.memorizationPosition=f:c==="translation"?a.translationPosition=f:c==="spelling"?a.spellingPosition=f:c==="grammar"&&(a.grammarPosition=f),a.position=f,c){const m=c==="translation"?"ÂíåË®≥":c==="spelling"?"„Çπ„Éö„É´":c==="grammar"?"ÊñáÊ≥ï":c==="memorization"?"ÊöóË®ò":"Ë™≠Ëß£";i.results.push({id:`word-${n}-${Date.now()}`,questionSetId:"individual-word",questionSetName:m,score:e?1:0,total:1,percentage:e?100:0,date:Date.now(),timeSpent:t/1e3,incorrectWords:e?[]:[n],mode:c,difficulty:a.difficultyScore>.7?"advanced":a.difficultyScore>.4?"intermediate":"beginner"})}await co(i);try{if(typeof window<"u"){const m=new CustomEvent(ea,{detail:{word:n,isCorrect:e,responseTime:t,mode:c}});window.dispatchEvent(m)}}catch{}try{if(typeof window<"u"&&f>=60){const m=new CustomEvent("weak-word-detected",{detail:{word:n,position:f,mode:c,isIncorrect:!e,timestamp:Date.now()}});window.dispatchEvent(m)}}catch{}}function tQ(n){const e="reading-passages-data",t=localStorage.getItem(e);if(t)try{const s=JSON.parse(t);let r=!1;if(s.forEach(o=>{o.phrases&&o.phrases.forEach(i=>{i.segments&&i.segments.forEach(a=>{a.word.toLowerCase()===n.toLowerCase()&&a.isUnknown&&(a.isUnknown=!1,r=!0)})})}),r)try{localStorage.setItem(e,JSON.stringify(s))}catch(o){if(o instanceof DOMException&&o.name==="QuotaExceededError")R.warn("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±ÊïóÔºàÂÆπÈáèË∂ÖÈÅéÔºâ„ÄÇ„Éá„Éº„Çø„ÇíÂúßÁ∏Æ„Åó„Åæ„Åô„ÄÇ"),localStorage.removeItem(e),R.log("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇÊ¨°ÂõûË™≠„ÅøËæº„ÅøÊôÇ„Å´ÂÜçÂèñÂæó„Åï„Çå„Åæ„Åô„ÄÇ");else throw o}}catch(s){R.error("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞„Ç®„É©„Éº:",s)}}function kh(n,e=30){const t=et();t.wordProgress[n]||(t.wordProgress[n]=rI(n));const s=t.wordProgress[n];s.skippedCount=(s.skippedCount||0)+1,s.lastSkipped=Date.now(),s.skipExcludeUntil=Date.now()+e*24*60*60*1e3,co(t)}function o0(n){const t=et().wordProgress[n];return t?!!(t.skipExcludeUntil&&Date.now()<t.skipExcludeUntil||t.masteryLevel==="mastered"&&t.nextReviewDate&&Date.now()<t.nextReviewDate):!1}function i0(n){return n.filter(e=>!o0(e.word))}function Wu(n){return et().wordProgress[n]||null}function Di(){const n=et();return Object.values(n.wordProgress)}async function a0(n,e){const t=await ps();t.wordProgress[n]||(t.wordProgress[n]={word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,lastStudied:Date.now(),totalResponseTime:0,averageResponseTime:0,difficultyScore:0,masteryLevel:"new",responseTimes:[],confusedWith:[],confusionCount:0,lastConfused:Date.now()});const s=t.wordProgress[n];s.confusedWith||(s.confusedWith=[]),s.confusedWith.push({word:e,timestamp:Date.now()}),s.confusedWith.length>10&&(s.confusedWith=s.confusedWith.slice(-10)),s.confusionCount=(s.confusionCount||0)+1,s.lastConfused=Date.now(),s.difficultyScore=Math.min(100,(s.difficultyScore||0)+5),await co(t),Jr(t)}function c0(n=20){return Di().filter(t=>(t.confusionCount||0)>0).sort((t,s)=>{const r=(s.confusionCount||0)-(t.confusionCount||0);return r!==0?r:(s.lastConfused||0)-(t.lastConfused||0)}).slice(0,n)}function l0(n){let t=et().results;return n&&(t=t.filter(s=>s.mode===n)),t.reduce((s,r)=>s+r.total,0)}function oI(n){const e=et(),t=new Set;for(const[s,r]of Object.entries(e.wordProgress)){const o=r.correctCount>0||r.incorrectCount>0,i=r.skippedCount&&r.skippedCount>0;(o||i)&&t.add(s)}return t.size}function $h(){const n=et();let e=0;for(const t of Object.values(n.wordProgress)){const r=t.correctCount+t.incorrectCount===1&&t.correctCount===1,o=t.consecutiveCorrect>=3,i=t.skippedCount&&t.skippedCount>0;(r||o||i)&&e++}return e}function Bu(){const n=et(),t=Object.values(n.wordProgress).filter(i=>i.correctCount+i.incorrectCount>0);let s=0;t.forEach(i=>{const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=i.masteryLevel==="mastered",d=a===1&&i.correctCount===1,h=a>=5&&c>=85,p=a>=3&&c>=90,f=i.consecutiveCorrect>=5,m=a>=10&&c>=75;(l||d||h||p||f||m)&&s++});const r=t.length>0?s/t.length*100:0,o=Math.min(100,Math.max(0,r));return{retentionRate:Math.round(o),masteredCount:s,appearedCount:t.length}}async function u0(){try{await tk(),R.log("‚úÖ IndexedDBÂâäÈô§ÂÆå‰∫Ü")}catch(t){R.error("IndexedDBÂâäÈô§„Ç®„É©„Éº:",t)}const n=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&(s.startsWith("quiz-result-")||s==="quiz-app-user-progress"||s==="progress-data"||s.startsWith("session-history-")||s==="session-history"||s==="skipped-words"||s==="skip-groups"||s==="improvement-progress"||s==="study-settings"||s==="reading-passages-data"||s==="all-questions-cache")&&n.push(s)}n.forEach(t=>{try{localStorage.removeItem(t)}catch(s){R.error(`Failed to remove ${t}:`,s)}});const e=si();co(e),R.log(`‚úÖ „É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü: LocalStorage ${n.length}ÂÄã„ÅÆ„Ç≠„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`),window.location.reload()}function d0(n=14){const e=et(),t=new Date,s=[];R.log("üìä getStudyCalendarByModeÂëº„Å≥Âá∫„Åó - progress.results‰ª∂Êï∞:",e.results.length);for(let r=n-1;r>=0;r--){const o=new Date(t);o.setDate(o.getDate()-r);const i=v0(o),a=new Date(o).setHours(0,0,0,0),c=new Date(o).setHours(23,59,59,999),l=e.results.filter(g=>g.date>=a&&g.date<=c),d={count:0,correct:0},h={count:0,correct:0},p={count:0,correct:0},f={count:0,correct:0};l.forEach(g=>{var y;const x=((y=g.mode)==null?void 0:y.toLowerCase())||"";x.includes("memorization")||x.includes("ÊöóË®ò")?(d.count+=g.total,d.correct+=g.score):x.includes("translation")||x.includes("ÂíåË®≥")?(h.count+=g.total,h.correct+=g.score):x.includes("spelling")||x.includes("„Çπ„Éö„É´")?(p.count+=g.total,p.correct+=g.score):(x.includes("grammar")||x.includes("ÊñáÊ≥ï"))&&(f.count+=g.total,f.correct+=g.score)});const m=d.count+h.count+p.count+f.count;s.push({date:i,memorization:d,translation:h,spelling:p,grammar:f,total:m})}return s}function h0(n=12){const e=et(),t=new Date,s=[];let r=0,o=0;for(let i=n-1;i>=0;i--){const a=new Date(t);a.setDate(t.getDate()-i*7),a.setHours(23,59,59,999);const c=new Date(a);c.setDate(a.getDate()-6),c.setHours(0,0,0,0);const d=e.results.filter(f=>f.date>=c.getTime()&&f.date<=a.getTime()).reduce((f,m)=>f+m.total,0);o+=d;let h=0;Object.values(e.wordProgress).forEach(f=>{f.masteryLevel==="mastered"&&f.lastStudied>=c.getTime()&&f.lastStudied<=a.getTime()&&h++}),r+=h;const p=`${c.getMonth()+1}/${c.getDate()}`;s.push({weekLabel:p,cumulativeMastered:r,weeklyMastered:h,cumulativeAnswered:o,weeklyAnswered:d})}return s}function p0(){const n=et(),e=Date.now(),t=e-7*24*60*60*1e3,s=e-30*24*60*60*1e3,r=new Set,o=new Set,i=new Set,a=new Set,c=new Set,l=new Set;return n.results.forEach(d=>{d.incorrectWords.forEach(h=>{c.add(h),d.date>=s&&i.add(h),d.date>=t&&r.add(h)})}),Object.entries(n.wordProgress).forEach(([d,h])=>{h.masteryLevel==="mastered"&&(l.add(d),h.lastStudied>=s&&a.add(d),h.lastStudied>=t&&o.add(d))}),{last7Days:Math.min(100,Math.max(0,r.size>0?o.size/r.size*100:0)),last30Days:Math.min(100,Math.max(0,i.size>0?a.size/i.size*100:0)),allTime:Math.min(100,Math.max(0,c.size>0?l.size/c.size*100:0))}}function Vu(n){const t=et().wordProgress[n];if(!t)return null;const s=t.correctCount,r=t.correctCount+t.incorrectCount,a=(t.learningHistory||[]).slice(-10).map(p=>p.wasCorrect?"üü©":"üü•").join("");let c=0;if(r===0)c=0;else{const p=s/r*70,f=Math.min(20,(t.consecutiveCorrect||0)*5),m=(Date.now()-t.lastStudied)/(24*60*60*1e3),g=Math.min(10,Math.max(0,(m-1)*2));c=Math.min(100,Math.max(0,p+f-g)),t.masteryLevel==="mastered"&&(c=Math.max(90,c))}let l="new",d="Êú™Â≠¶Áøí",h="‚ö™";return r===0?(l="new",d="Êú™Â≠¶Áøí",h="‚ö™"):t.masteryLevel==="mastered"||c>=80?(l="mastered",d="ÂÆöÁùÄÊ∏à",h="üü¢"):c>=50?(l="learning",d="Â≠¶Áøí‰∏≠",h="üü°"):(l="struggling",d="Ë¶ÅÂæ©Áøí",h="üî¥"),{correctCount:s,totalCount:r,accuracyHistory:a,retentionRate:Math.round(c),status:l,statusLabel:d,statusIcon:h,position:t.position,memorizationPosition:t.memorizationPosition,translationPosition:t.translationPosition,spellingPosition:t.spellingPosition,grammarPosition:t.grammarPosition}}async function f0(n){try{await pc("memorization-card-settings",n)}catch(e){R.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-card-settings",JSON.stringify(n))}}async function m0(){try{const n=await fc("memorization-card-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"showFurigana"in n?n:null:null}catch(n){R.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-card-settings");return e?JSON.parse(e):null}}async function g0(n){try{await pc("memorization-settings",n)}catch(e){R.error("ÊöóË®òË®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-settings",JSON.stringify(n))}}async function x0(){try{const n=await fc("memorization-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"shuffleOrder"in n?n:null:null}catch(n){R.error("ÊöóË®òË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-settings");return e?JSON.parse(e):null}}async function y0(n){try{const e=await fc("memorization-behaviors"),s=[...e?typeof e=="string"?JSON.parse(e):e:[],n].slice(-1e3);await pc("memorization-behaviors",s)}catch(e){R.error("ÊöóË®òË°åÂãïË®òÈå≤„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}const iI="custom-question-sets";async function Th(){try{const n=await fc(iI);return n?typeof n=="string"?JSON.parse(n):Array.isArray(n)?n:[]:[]}catch(n){return R.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÂèñÂæó„Ç®„É©„Éº:",n),[]}}async function Uu(n){try{const e=await Th(),t=e.findIndex(s=>s.id===n.id);t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),await pc(iI,e)}catch(e){throw R.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà‰øùÂ≠ò„Ç®„É©„Éº:",e),e}}async function Gu(n,e=20,t=3,s=60,r){const a=Ih(100).filter(l=>l.mistakes>=t&&l.recentAccuracy<=s).slice(0,e).map(l=>{const d=r.find(h=>h.word.toLowerCase()===l.word.toLowerCase());return d||{word:l.word,reading:l.reading||"",meaning:l.meaning||"",etymology:"",relatedWords:"",relatedFields:"",difficulty:"intermediate"}});return{id:`weak-words-${Date.now()}`,name:n,source:"weak-words",questions:a,createdAt:Date.now(),updatedAt:Date.now(),isAutoUpdate:!0,autoUpdateConfig:{limit:e,minMistakes:t,maxAccuracy:s},metadata:{description:`Ëã¶ÊâãË™ûÂè•„Åã„ÇâËá™ÂãïÁîüÊàêÔºàÈñìÈÅï„ÅÑ${t}Âõû‰ª•‰∏ä„ÄÅÊ≠£Á≠îÁéá${s}%‰ª•‰∏ãÔºâ`,totalWords:a.length}}}function Hu(){const n=et(),s=Object.values(n.wordProgress).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.word.startsWith("grammar_")||a.word.includes("_g")).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.correctCount+a.incorrectCount>0);let r=0;s.forEach(a=>{const c=a.grammarAttempts||a.correctCount+a.incorrectCount,l=a.grammarCorrect||a.correctCount,d=a.grammarStreak||a.consecutiveCorrect,h=c>0?l/c*100:0,p=a.masteryLevel==="mastered",f=c===1&&l===1,m=c>=5&&h>=85,g=c>=3&&h>=90,x=d>=5,y=c>=10&&h>=75;(p||f||m||g||x||y)&&r++});const o=s.length>0?r/s.length*100:0,i=Math.min(100,Math.max(0,o));return{retentionRate:Math.round(i),masteredCount:r,appearedCount:s.length}}async function b0(){const n=t0();return(await Promise.all(n.map(async t=>{const s=t.unit.match(/‰∏≠(\d+)_Unit(\d+)/);if(!s)return null;const r=s[1],o=s[2];try{const i=await fetch(`/data/grammar/grammar_grade${r}_unit${o}.json`);if(i.ok){const a=await i.json();return a.enabled===!1?null:{...t,title:a.title||""}}}catch{return null}return null}))).filter(t=>t!==null)}function w0(n,e="memorization"){const t=et(),s={incorrect:0,still_learning:0,mastered:0,new:0,total:n.length};return n.forEach(r=>{const o=t.wordProgress[r.word];if(!o){s.new++;return}const i=Bt(o,e);i>=70?s.incorrect++:i>=40?s.still_learning++:i>=20?s.new++:s.mastered++}),s}const vy=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:dc,addSessionHistory:ga,calculateSessionStats:w0,checkFlexibleMastery:r0,createWeakWordsQuestionSet:Gu,filterSkippedWords:i0,getAllWordProgress:Di,getConfusedWords:c0,getCumulativeProgressData:h0,getCurrentWeakWords:Ih,getCustomQuestionSets:Th,getDetailedRetentionStats:Ou,getGrammarDetailedRetentionStats:Lu,getGrammarRetentionRateWithAI:Hu,getGrammarUnitStats:t0,getGrammarUnitStatsWithTitles:b0,getMemorizationCardSettings:m0,getMemorizationDetailedRetentionStats:zu,getMemorizationSettings:x0,getMonthlyStats:Zg,getNearMasteryStats:nI,getOvercomeWeakWords:s0,getRecentlyMasteredWords:e0,getRetentionRateWithAI:Bu,getRetentionTrend:p0,getStudyCalendarByMode:d0,getStudySettings:Yg,getTodayIncorrectWords:Mu,getTodayStats:Fu,getTotalAnsweredCount:l0,getTotalMasteredWordsCount:$h,getUniqueQuestionedWordsCount:oI,getWeeklyStats:Jg,getWordDetailedData:Vu,getWordProgress:Wu,isWordSkipExcluded:o0,loadProgress:ps,loadProgressSync:et,recordConfusion:a0,recordMemorizationBehavior:y0,recordWordSkip:kh,resetAllProgress:u0,saveCustomQuestionSet:Uu,saveMemorizationCardSettings:f0,saveMemorizationSettings:g0,saveProgress:co,updateProgressCache:Jr,updateWordProgress:So},Symbol.toStringTag,{value:"Module"}));function Ka(n){const e=n.trim().split(`
`);if(e.length===0)return[];function t(i){const a=[];let c="",l=!1;for(let d=0;d<i.length;d++){const h=i[d],p=i[d+1];h==='"'?l&&p==='"'?(c+='"',d++):l=!l:h===","&&!l?(a.push(c.trim()),c=""):c+=h}return a.push(c.trim()),a}let s=0;const r=e[0].trim();(r.includes("Ë™ûÂè•")||r.includes("term")||r.includes("Ë™≠„Åø")||r.includes("reading")||r.includes("ÊÑèÂë≥")||r.includes("meaning"))&&(s=1);const o=[];for(let i=s;i<e.length;i++){const a=e[i].trim();if(!a||a.startsWith("//")||a.startsWith("#"))continue;const c=t(a);if(c.length>=3){const l=c[0]||"",d=c[1]||"",h=c[2]||"",p=c[3]||"";let f="",m="",g="";c.length>=8?(f=(c[4]||"")+(c[5]||""),m=c[6]||"",g=c[7]||""):(f=c[4]||"",m=c[5]||"",g=c[6]||"");let x="";g.includes("ÂàùÁ¥ö")||g==="beginner"?x="beginner":g.includes("‰∏≠Á¥ö")||g==="intermediate"?x="intermediate":(g.includes("‰∏äÁ¥ö")||g==="advanced")&&(x="advanced"),m&&!KI(m)&&R.warn(`[„Éá„Éº„ÇøÊï¥ÂêàÊÄßË≠¶Âëä] ‰∏çÊ≠£„Å™„Ç´„ÉÜ„Ç¥„É™: "${m}" (ÂçòË™û: "${l}")
ÊúâÂäπ„Å™„Ç´„ÉÜ„Ç¥„É™: ${Gy.join(", ")}
ÂèÇÁÖß: docs/specifications/19-junior-high-vocabulary.md`),l&&h&&o.push({word:l,reading:d,meaning:h,etymology:p,relatedWords:f,relatedFields:m,category:m,difficulty:x})}}return o}function Co(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function aI(n,e,t){const s=[],r=e.filter((a,c)=>c!==t),o=Co(r);for(let a=0;a<o.length&&s.length<2;a++){const c=o[a];c.meaning!==n.meaning&&!s.some(l=>l.meaning===c.meaning)&&s.push(c)}for(;s.length<2;)s.push({word:`„ÉÄ„Éü„Éº${s.length+1}`,meaning:`ÈÅ∏ÊäûËÇ¢${s.length+1}`,reading:"",etymology:"",relatedWords:"",relatedFields:"",category:"",difficulty:""});return[...Co([{text:n.meaning,question:n},...s.map(a=>({text:a.meaning,question:a}))]),{text:"ÂàÜ„Åã„Çâ„Å™„ÅÑ",question:null}]}const nQ="quizApp_questionSets";function cI(n){try{localStorage.setItem(nQ,JSON.stringify(n))}catch(e){R.error("Failed to save question sets:",e)}}function v0(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${s}`}const ea="quiz-result-added";function hc(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function lI(n,e=10){const s=Di().filter(o=>o.difficultyScore>=50).sort((o,i)=>i.difficultyScore-o.difficultyScore).map(o=>o.word.toLowerCase()),r=n.filter(o=>s.includes(o.word.toLowerCase()));return Co(r).slice(0,Math.min(e,r.length))}function uI(n){if(!n.includes(" "))return"word";const e=n.toLowerCase(),t=e.split(" "),s=["get","go","come","take","make","put","look","turn","break","bring","call","carry","check","figure","fill","find","give","hand","hang","hold","keep","knock","lay","let","pass","pick","pull","push","run","set","show","shut","sit","stand","stay","stick","take","talk","think","throw","try","work","write"],r=["up","down","in","out","on","off","away","back","over","through","around","across","along","about","after","for","from","into","to","with"];return t.length>=2&&s.includes(t[0])&&t.slice(1).some(d=>r.includes(d))?"phrasal-verb":[/^a .+ of$/,/^the .+ (of|in)$/,/^(break|beat|hit|kick) (the|a)/,/^(catch|have|take|make) (a|an|the)/,/(eye|eyes|face|hand|tongue|ear|nose|heart|mind|bone)/i,/^once in a/,/^(cost|pay|worth) (an|a)/,/^at .+ (heart|first|last|once)/].some(l=>l.test(e))?"idiom":[/^(in|on|at|by|with|from|to) (the|a|an) /,/^(make|take|do|have|get) (a|an|the) /,/(strong|weak|heavy|light|high|low|good|bad|big|small) /i].some(l=>l.test(e))?"collocation":"other"}function sQ(n,e=90){const t=Math.floor(e/3),s=Math.floor(e*2/3);return n<=t?1:n<=s?2:3}function rQ(n){const e=Di(),t=new Map;return e.forEach(s=>{t.set(s.word.toLowerCase(),s)}),n.filter(s=>{const r=t.get(s.word.toLowerCase());return!r||r.masteryLevel==="new"})}function oQ(n){const e=Date.now(),t=Di(),s=new Map;return t.forEach(r=>{s.set(r.word.toLowerCase(),r)}),n.filter(r=>{const o=s.get(r.word.toLowerCase());if(!o)return!1;const i=(e-o.lastStudied)/(1e3*60*60*24);let a;switch(o.masteryLevel){case"new":a=1;break;case"learning":a=Math.min(7,o.consecutiveCorrect+1);break;case"mastered":a=Math.min(30,o.consecutiveCorrect*2);break;default:a=1}return i>=a})}function iQ(n,e,t){let s;switch(e){case 1:s=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),s.length<t&&(s=[...s,...n.filter(c=>c.difficulty==="‰∏≠Á¥ö")]);break;case 2:const r=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),o=n.filter(c=>c.difficulty==="‰∏≠Á¥ö");s=[...r,...o];break;case 3:const i=n.filter(c=>c.difficulty==="‰∏≠Á¥ö"),a=n.filter(c=>c.difficulty==="‰∏äÁ¥ö");s=[...i,...a];break}return Co(s).slice(0,t)}function dI(n,e){const t=n.currentDay,s=sQ(t,n.totalDays),r=rQ(e),o=oQ(e),i=Math.ceil(n.dailyGoals.newWords*.3),a=iQ(r,s,i),c=Math.ceil(n.dailyGoals.reviewWords*.4),l=lI(o.length>0?o:e,c),d=Math.floor(i*.3),h=Math.ceil(n.dailyGoals.reviewWords*.3),p=[...Co(a).slice(0,d),...Co(o.length>0?o:e).slice(0,h)];return{date:n.startDate+(t-1)*24*60*60*1e3,dayNumber:t,phase:s,morning:{newWords:a,duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"discovery"},afternoon:{reviewWords:l,duration:Math.ceil(n.dailyGoals.timeMinutes*.3),mode:"weakness"},evening:{mixedWords:Co(p),duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"mixed"},completed:!1,actualAccuracy:0}}function hI(n){const e=Di(),t=e.filter(l=>l.masteryLevel!=="new").length,s=e.reduce((l,d)=>l+d.correctCount+d.incorrectCount,0),r=e.reduce((l,d)=>l+d.correctCount,0),o=s>0?r/s*100:0,i=t/n.currentDay,c=(4700-t)/(i||50);return{totalLearned:t,totalReviewed:s,averageAccuracy:o,estimatedCompletion:Math.ceil(c)}}function pI(n){const e=Math.ceil(n.currentDay/7),t=n.dailyGoals.newWords*7,s=n.weeklyProgress.find(r=>r.week===e);return s?s.wordsLearned/t*100:0}const aQ=Object.freeze(Object.defineProperty({__proto__:null,QUIZ_RESULT_EVENT:ea,calculateProgress:hI,calculateWeeklyAchievement:pI,classifyPhraseType:uI,formatLocalYYYYMMDD:v0,generateChoicesWithQuestions:aI,generateDailyPlan:dI,generateId:hc,parseCSV:Ka,saveQuestionSets:cI,selectWeakQuestions:lI,shuffle:Co},Symbol.toStringTag,{value:"Module"}));function cQ(){const[n]=$.useState(()=>{const t=localStorage.getItem("autoAdvance");return t?JSON.parse(t):!1}),[e]=$.useState(()=>{const t=localStorage.getItem("autoAdvanceDelay");return t?parseInt(t,10):1500});return{autoAdvance:n,autoAdvanceDelay:e}}function lQ(){const[n,e]=$.useState([]),[t,s]=$.useState("all"),[r,o]=$.useState("all"),[i,a]=$.useState("all"),[c,l]=$.useState("all"),[d,h]=$.useState(()=>{const p=localStorage.getItem("selectedDataSource");if(p)try{return JSON.parse(p)}catch{return"all"}return"all"});return{categoryList:n,setCategoryList:e,selectedCategory:t,setSelectedCategory:s,selectedDifficulty:r,setSelectedDifficulty:o,selectedWordPhraseFilter:i,setSelectedWordPhraseFilter:a,selectedPhraseTypeFilter:c,setSelectedPhraseTypeFilter:l,selectedDataSource:d,setSelectedDataSource:h}}function uQ(){const[n,e]=$.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[t,s]=$.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),[r,o]=$.useState(!1),[i,a]=$.useState([]),[c,l]=$.useState(new Map);return{sessionStats:n,setSessionStats:e,quizState:t,setQuizState:s,reviewFocusMode:r,setReviewFocusMode:o,reviewQuestionPool:i,setReviewQuestionPool:a,reviewCorrectStreak:c,setReviewCorrectStreak:l}}const fI="customQuestionSets";function dQ(){try{const n=localStorage.getItem(fI);if(n){const e=JSON.parse(n);return{sets:e.sets||[],activeSetId:e.activeSetId||null,recentSetIds:e.recentSetIds||[]}}}catch(n){console.error("Failed to load custom question state:",n)}return{sets:[],activeSetId:null,recentSetIds:[]}}function hQ(n){try{localStorage.setItem(fI,JSON.stringify(n))}catch(e){console.error("Failed to save custom question state:",e)}}function pQ(n,e,t,s){const r=new Date().toISOString();return{id:`set_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:n,description:e,words:[],createdAt:r,updatedAt:r,icon:t,color:s}}function fQ(n,e,t){const s=n.sets.map(r=>r.id!==e||r.words.some(o=>o.word===t.word)?r:{...r,words:[...r.words,{...t,addedAt:new Date().toISOString()}],updatedAt:new Date().toISOString()});return{...n,sets:s,recentSetIds:yQ(n.recentSetIds,e)}}function mQ(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,words:r.words.filter(o=>o.word!==t.word),updatedAt:new Date().toISOString()});return{...n,sets:s}}function gQ(n,e){return{...n,sets:n.sets.filter(t=>t.id!==e),activeSetId:n.activeSetId===e?null:n.activeSetId,recentSetIds:n.recentSetIds.filter(t=>t!==e)}}function xQ(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,...t,updatedAt:new Date().toISOString()});return{...n,sets:s}}function yQ(n,e){const t=n.filter(r=>r!==e);return[e,...t].slice(0,5)}class bQ{constructor(){Ne(this,"map",new Map);Ne(this,"seqIndex",0);Ne(this,"startedAt",Date.now())}reset(){this.map.clear(),this.seqIndex=0,this.startedAt=Date.now()}onShown(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.timesShown+=1,this.map.set(e,t),this.seqIndex+=1}onAnswer(e,t){const s=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};if(!t)s.timesWrong+=1,s.lastWrongIndex=this.seqIndex;else if(s.lastWrongIndex!==void 0){const r=Math.max(0,this.seqIndex-s.lastWrongIndex);s.lags.push(r),s.lastWrongIndex=void 0}this.map.set(e,s)}onReAdd(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.readds+=1,this.map.set(e,t)}summarize(){const e=Array.from(this.map.values()),t=e.length,s=e.filter(c=>c.timesShown>=2).length,r=t>0?s/t:0,o=e.flatMap(c=>c.lags),i=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length/2)]:0,a=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length*.9)]:0;return{totalItems:t,reappearanceRate:r,medianLag:i,p90Lag:a,durationSec:Math.round((Date.now()-this.startedAt)/1e3)}}}const Lr=new bQ;function _l(){const n=$.useCallback((i,a,c,l)=>{if(!a||!Array.isArray(a))return console.warn("[useQuestionRequeue] questions is null or not an array"),[];const d=i.id??i.word??String(i.japanese??""),h=i.position,p=Number.isFinite(h)?Number(h):void 0,f=(()=>{var L;if(l)try{const H=et(),J=String(i.word??d??""),X=(L=H==null?void 0:H.wordProgress)==null?void 0:L[J];return X?Bt(X,l):35}catch{return}})(),m=f??p,g={...i,sessionPriority:Date.now(),reAddedCount:(i.reAddedCount||0)+1},x=i.reAddedCount||0,y=m!==void 0&&m>=70,b=y?1+Math.floor(Math.random()*2):3+Math.floor(Math.random()*3),v=y?Math.min(x*3,18):Math.min(x*2,12),S=Math.min(c+1+12,a.length),C=a.slice(c+1,S).filter(L=>!!(L!=null&&L.sessionPriority)).length,k=y?Math.min(C*2,12):Math.min(C,8),I=b+v+k,T=L=>{try{const H="debug_requeue_events",J=localStorage.getItem(H),X=J?JSON.parse(J):[];X.push(L),X.length>30&&X.shift(),localStorage.setItem(H,JSON.stringify(X))}catch{}},_=Math.min(30,Math.max(10,I+5)),D=Math.min(c+_+1,a.length);if(a.slice(c+1,D).some(L=>((L==null?void 0:L.id)??(L==null?void 0:L.word)??String((L==null?void 0:L.japanese)??""))===d))return T({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"skipped_exists_nearby",reason:y?"incorrect_like":"still_learning_like",currentIndex:c,windowEnd:D,baseOffset:b,extraDelay:v,plannedOffset:I,questionPosition:p??null,ssotPosition:f??null,effectivePosition:m??null,reAddedCountBefore:x}),a;let F=Math.min(c+I,a.length);const O=F;let V=!1;if(m!==void 0&&m>=40){const L=Math.max(F,c+1),H=Math.min(L+30,a.length);let J=-1;for(let X=L;X<H;X++){const fe=a[X].position;fe!==void 0&&fe>=40&&(J=X)}if(J>=0){const X=F;F=J+1,V=F!==X;try{const fe={timestamp:new Date().toISOString(),word:String(d),position:m,baseOffset:b,extraDelay:v,originalInsert:X,adjustedInsert:F,currentIndex:c,nearbyHighPositions:a.slice(L,H).filter(xe=>{const $e=xe.position;return $e!==void 0&&$e>=40}).map(xe=>({word:xe.word||xe.id,position:xe.position}))},be=localStorage.getItem("debug_position_aware_insertions"),oe=be?JSON.parse(be):[];oe.push(fe),oe.length>30&&oe.shift(),localStorage.setItem("debug_position_aware_insertions",JSON.stringify(oe))}catch{}}}try{Lr.onReAdd(String(d))}catch{}return T({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"inserted",reason:y?"incorrect_like":"still_learning_like",currentIndex:c,baseOffset:b,extraDelay:v,plannedOffset:I,insertAt:F,originalInsertAt:O,positionAwareAdjusted:V,questionPosition:p??null,ssotPosition:f??null,effectivePosition:m??null,reAddedCountBefore:x,reAddedCountAfter:x+1}),[...a.slice(0,F),g,...a.slice(F)]},[]),e=$.useCallback((i,a)=>a>=i.length-1?i:i.map((c,l)=>{if(c.sessionPriority&&l>a&&l-a>5){const{sessionPriority:d,...h}=c;return h}return c}),[]),t=$.useCallback(i=>(i.reAddedCount||0)>0,[]),s=$.useCallback((i,a,c)=>{const l=(i.reAddedCount||0)>0;c(d=>({...d,newQuestions:l?d.newQuestions:(d.newQuestions||0)+1,reviewQuestions:l?(d.reviewQuestions||0)+1:d.reviewQuestions||0,consecutiveNew:l?0:(d.consecutiveNew||0)+1,consecutiveReview:l?(d.consecutiveReview||0)+1:0}))},[]),r=$.useCallback((i,a)=>{const c=[];return i.forEach((l,d)=>{if(d>a&&l.sessionPriority){const h=String(l.word||l.japanese||"(unknown)");c.push({word:h,reason:"still_learning",insertAt:d+1,timestamp:l.sessionPriority})}}),c},[]),o=$.useCallback((i,a)=>{try{const c=et();if(!(c!=null&&c.wordProgress))return{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"LocalStorageÊú™ÂàùÊúüÂåñ"};let l=0,d=0;for(const p of i){const f=p.word;if(!f)continue;const m=p.position,g=Number.isFinite(m)?Number(m):null;if(g===null)continue;const x=c.wordProgress[f];if(!x)continue;const y=Bt(x,a),b=Math.abs(y-g);b>=5&&(l++,d+=b)}const h=l>=10&&d>=200;return{needsRescheduling:h,mismatchCount:l,totalDiff:d,reason:h?`‰∏çÊï¥Âêà${l}Ë™ûÔºàÂ∑ÆÂàÜÂêàË®à: ${d}Ôºâ`:"Ê≠£Â∏∏ÁØÑÂõ≤ÂÜÖ"}}catch(c){return console.error("[useQuestionRequeue] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",c),{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"„ÉÅ„Çß„ÉÉ„ÇØÂ§±Êïó"}}},[]);return{reAddQuestion:n,clearExpiredFlags:e,isReviewQuestion:t,updateRequeueStats:s,getRequeuedWords:r,checkPositionMismatch:o}}const mI="learning-assistant-skip-groups",wQ=5*60*1e3;function S0(){try{const n=localStorage.getItem(mI);return n?JSON.parse(n):[]}catch(n){return R.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n),[]}}function C0(n){try{localStorage.setItem(mI,JSON.stringify(n))}catch(e){R.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}function gI(n){const e=S0(),t=Date.now(),s=e.find(r=>r.verificationStatus==="pending"&&t-r.timestamp<wQ);s?s.words.includes(n)||s.words.push(n):e.push({timestamp:t,words:[n],verificationStatus:"pending",suspiciousWords:[]}),C0(e)}function xI(n){const e=S0(),t=et(),s=e.find(r=>r.words.includes(n));s&&s.verificationStatus==="pending"&&(s.verificationStatus="suspicious",s.suspiciousWords=s.words.filter(r=>r!==n),s.suspiciousWords.forEach(r=>{if(t.wordProgress[r]){const o=t.wordProgress[r];delete o.skipExcludeUntil,o.masteryLevel="learning",o.consecutiveCorrect=0,o.needsVerification=!0,o.verificationReason=`ÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü„Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Å†„Å£„Åü„Åü„ÇÅ`}}),co(t),C0(e),R.log(`AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü${s.suspiciousWords.length}ÂÄã„ÅÆÂçòË™û„ÇíÂÜçÂá∫È°åÂØæË±°„Å´„Åó„Åæ„Åô„ÄÇ`))}function yI(n){const e=S0(),t=et(),s=e.find(r=>r.words.includes(n));s&&(s.suspiciousWords=s.suspiciousWords.filter(o=>o!==n),s.words.every(o=>{const i=t.wordProgress[o];return i&&(i.correctCount>0||i.incorrectCount>0)})&&s.suspiciousWords.length===0&&(s.verificationStatus="verified"),t.wordProgress[n]&&(delete t.wordProgress[n].needsVerification,delete t.wordProgress[n].verificationReason),co(t),C0(e))}function vQ(n,e){const t=et(),s=new Map;e.forEach(l=>{s.set(l,{correct:0,total:0,mastered:0,wordCount:0})}),t.results.forEach(l=>{if(l.category&&s.has(l.category)){const d=s.get(l.category);d.correct+=l.score,d.total+=l.total}}),n.forEach(l=>{const d=l.category;if(!d||!s.has(d))return;const h=s.get(d);h.wordCount++;const p=t.wordProgress[l.word];if(p){const f=p.correctCount+p.incorrectCount,m=f===1&&p.correctCount===1||p.consecutiveCorrect>=3||p.skippedCount&&p.skippedCount>0,g=f>=3&&p.correctCount/f>=.8&&p.consecutiveCorrect>=2;(m||g)&&h.mastered++}});const r=[],o=[];s.forEach((l,d)=>{if(l.total===0&&l.wordCount===0)return;const h=l.total>0?l.correct/l.total*100:0,p=l.wordCount>0?l.mastered/l.wordCount*100:0,f=h*.6+p*.4;if(f<60){let m,g,x;f<40?(m="critical",g=100,x=14):f<50?(m="moderate",g=70,x=10):(m="minor",g=40,x=7),l.total<10&&(g+=20),r.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,weaknessLevel:m,priorityScore:g,estimatedImprovementDays:x})}else if(f>=75){let m;f>=90?m="expert":f>=80?m="proficient":m="good",o.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,strengthLevel:m})}}),r.sort((l,d)=>d.priorityScore-l.priorityScore),o.sort((l,d)=>d.accuracy-l.accuracy);const i=SQ(s),a=CQ(r),c=NQ(r,o,i);return{weakCategories:r,strongCategories:o,balanceScore:i,improvementPlan:a,aiRecommendations:c}}function SQ(n){const e=[];if(n.forEach(i=>{if(i.total>0){const a=i.correct/i.total*100;e.push(a)}}),e.length===0)return 50;const t=e.reduce((i,a)=>i+a,0)/e.length,s=e.reduce((i,a)=>i+Math.pow(a-t,2),0)/e.length,r=Math.sqrt(s),o=Math.max(0,Math.min(100,100-r*2));return Math.round(o)}function CQ(n){const e=[],t={},s=[],r=n.slice(0,3);r.forEach(i=>{e.push(i.category);let a;i.weaknessLevel==="critical"?a=15:i.weaknessLevel==="moderate"?a=10:a=5,t[i.category]=a;const c={day:Math.ceil(i.estimatedImprovementDays/2),category:i.category,targetAccuracy:Math.min(i.accuracy+20,80),description:`${i.category}„ÅÆÊ≠£Á≠îÁéá„Çí${Math.round(i.accuracy)}%„Åã„Çâ${Math.min(i.accuracy+20,80)}%„Å´ÊîπÂñÑ`};s.push(c)});const o=r.length>0?Math.max(...r.map(i=>i.estimatedImprovementDays)):0;return{targetCategories:e,dailyQuestions:t,estimatedCompletionDays:o,milestones:s}}function NQ(n,e,t){const s=[];if(n.length>0){const o=n[0];s.push(`üéØ ÊúÄÂÑ™ÂÖà: „Äå${o.category}„Äç„ÇíÈáçÁÇπÂ≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºàÁèæÂú®${Math.round(o.accuracy)}% ‚Üí ÁõÆÊ®ô80%Ôºâ`),o.weaknessLevel==="critical"&&s.push(`‚ö†Ô∏è „Äå${o.category}„Äç„ÅØÈáçË¶Å„Å™Âº±ÁÇπ„Åß„Åô„ÄÇÊØéÊó•15Âïè‰ª•‰∏äÂèñ„ÇäÁµÑ„ÇÄ„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô`),n.length>=3&&s.push(`üìö ${n.length}ÂÄã„ÅÆÂº±ÁÇπÂàÜÈáé„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ1„Å§„Åö„Å§ÈõÜ‰∏≠„Åó„Å¶ÊîπÂñÑ„Åó„Åæ„Åó„Çá„ÅÜ`)}if(t<50?s.push(`‚öñÔ∏è Â≠¶Áøí„Éê„É©„É≥„Çπ„ÅåÂÅè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„ÄÇÂº±ÁÇπÂàÜÈáé„Å´ÊôÇÈñì„ÇíÈÖçÂàÜ„Åó„Åæ„Åó„Çá„ÅÜ`):t>=80&&s.push(`‚ú® Á¥†Êô¥„Çâ„Åó„ÅÑ„Éê„É©„É≥„Çπ„Åß„ÅôÔºÅÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ`),e.length>0&&n.length>0){const o=e[0];s.push(`üí™ „Äå${o.category}„Äç„ÅØÂæóÊÑèÂàÜÈáé„Åß„ÅôÔºà${Math.round(o.accuracy)}%Ôºâ„ÄÇ„Åì„ÅÆÂ≠¶ÁøíÊñπÊ≥ï„Çí‰ªñ„ÅÆÂàÜÈáé„Å´„ÇÇÂøúÁî®„Åó„Åæ„Åó„Çá„ÅÜ`)}return n.length>0&&s.push("üß† AIÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅåÂº±ÁÇπÂàÜÈáé„ÅÆÂïèÈ°å„ÇíËá™ÂãïÁöÑ„Å´ÂÑ™ÂÖàÂá∫È°å„Åó„Åæ„Åô"),[...n,...e].reduce((o,i)=>o+i.totalAttempts,0)<50&&s.push("üìà „Åæ„Å†Â≠¶Áøí„Éá„Éº„Çø„ÅåÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ50Âïè‰ª•‰∏äËß£„Åè„Å®„Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Åå„Åß„Åç„Åæ„Åô"),s}function IQ(n,e,t=30){if(e.length===0)return n.slice(0,t);const s=[],r=new Map,o=e.slice(0,3).reduce((h,p)=>h+p.priorityScore,0);e.slice(0,3).forEach(h=>{const p=Math.ceil(h.priorityScore/o*t*.7);r.set(h.category,p)}),e.slice(0,3).forEach(h=>{const p=r.get(h.category)||0,f=n.filter(y=>y.category===h.category),m=et(),g=f.filter(y=>{const b=m.wordProgress[y.word];return b?b.consecutiveCorrect<3:!0}),x=op(g).slice(0,p);s.push(...x)});const i=t-s.length,a=new Set(e.slice(0,3).map(h=>h.category)),c=n.filter(h=>!a.has(h.category||"")),l=new Set(s.map(h=>h.word)),d=c.filter(h=>!l.has(h.word));return s.push(...op(d).slice(0,i)),op(s)}function op(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function kQ(n){const e={startDate:Date.now(),currentDay:1,targetCategories:n.improvementPlan.targetCategories,initialAccuracies:{},currentAccuracies:{},improvements:{},overallProgress:0,isCompleted:!1};n.weakCategories.forEach(t=>{n.improvementPlan.targetCategories.includes(t.category)&&(e.initialAccuracies[t.category]=t.accuracy,e.currentAccuracies[t.category]=t.accuracy,e.improvements[t.category]=0)}),localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function bI(){const n=localStorage.getItem("radar-improvement-progress");if(!n)return null;try{return JSON.parse(n)}catch{return null}}function $Q(n){const e=bI();if(!e)return;const t=Math.floor((Date.now()-e.startDate)/(1e3*60*60*24));e.currentDay=t+1;let s=0;e.targetCategories.forEach(r=>{const o=n.weakCategories.find(c=>c.category===r),i=(o==null?void 0:o.accuracy)||80;e.currentAccuracies[r]=i;const a=i-e.initialAccuracies[r];e.improvements[r]=a,i>=80&&s++}),e.overallProgress=s/e.targetCategories.length*100,e.isCompleted=s===e.targetCategories.length,localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function TQ(n,e,t){const s=AQ(t),r=EQ(t),o=RQ(e,t,s);return{word:n,attempts:t,confusedWith:r,learningCurve:s,predictionModel:o}}function AQ(n){if(n.length===0)return{accuracyHistory:[],stabilityScore:0,stage:"initial",forgettingPattern:{typicalDecayDays:7,forgettingCount:0},efficiency:{attemptsToMastery:10,currentProgress:0,estimatedDaysToMastery:30}};const e=[],t=5;for(let y=0;y<n.length;y++){const b=Math.max(0,y-t+1),v=n.slice(b,y+1),w=v.filter(S=>S.wasCorrect).length/v.length*100;e.push({timestamp:n[y].timestamp,accuracy:w})}const s=n.slice(-10),r=s.map((y,b)=>{const v=Math.max(0,s.length-5),w=s.slice(v,b+1);return w.filter(S=>S.wasCorrect).length/w.length*100}),o=r.reduce((y,b)=>y+b,0)/r.length,i=r.reduce((y,b)=>y+Math.pow(b-o,2),0)/r.length,a=Math.sqrt(i),c=Math.max(0,Math.min(100,100-a/30*100)),l=s.filter(y=>y.wasCorrect).length/s.length;let d;n.length<3?d="initial":l<.3?d="struggling":l<.7&&c<50?d="improving":l>=.7&&c>=50?d="consolidating":l>=.9&&c>=80?d="mastered":d="improving";const h=n.filter(y=>!y.wasCorrect),p=h.length;let f=7;if(h.length>=2){const y=[];for(let b=1;b<h.length;b++){const v=(h[b].timestamp-h[b-1].timestamp)/864e5;y.push(v)}f=y.reduce((b,v)=>b+v,0)/y.length}const m=Math.min(100,(l*100+c)/2),g=n.length<5?10:Math.ceil(10/(m/100)),x=Math.max(1,Math.ceil((100-m)/5));return{accuracyHistory:e,stabilityScore:c,stage:d,forgettingPattern:{typicalDecayDays:f,lastForgetDate:h.length>0?h[h.length-1].timestamp:void 0,forgettingCount:p},efficiency:{attemptsToMastery:g,currentProgress:m,estimatedDaysToMastery:x}}}function EQ(n){const e=new Map;return n.forEach(t=>{if(!t.wasCorrect&&t.userAnswer){const s=t.userAnswer;if(e.has(s)){const r=e.get(s);r.frequency++,r.lastConfusion=t.timestamp}else e.set(s,{confusedWord:t.userAnswer,frequency:1,lastConfusion:t.timestamp,confusionType:"meaning",similarity:.7})}}),Array.from(e.values()).sort((t,s)=>s.frequency-t.frequency).slice(0,5)}function RQ(n,e,t){const s=e.slice(-5),r=s.length>0?s.filter(p=>p.wasCorrect).length/s.length*100:50,o=t.stabilityScore/100,i=e.length>0?(Date.now()-e[e.length-1].timestamp)/(1e3*60*60*24):0,a=e.slice(-10).filter(p=>!p.wasCorrect&&p.userAnswer),c=Math.min(1,a.length/5);let l=r;l+=o*20;const d=Math.exp(-i/t.forgettingPattern.typicalDecayDays);l*=d,l-=c*30,l=Math.max(0,Math.min(100,l));const h=Math.min(1,e.length/10);return{nextCorrectProbability:l,predictors:{recentAccuracy:r,stabilityFactor:o,timeSinceLastStudy:i,confusionRisk:c},confidence:h}}function DQ(n,e,t){const s=[];return n.forEach(r=>{const o=e[r.word],i=t.get(r.word),a=jQ(r,o,i);s.push(a)}),s.sort((r,o)=>o.priority-r.priority)}function jQ(n,e,t){if(!e||!t)return{word:n.word,priority:50,reason:"Êñ∞Ë¶èÂçòË™û",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60};const s=t.learningCurve,r=t.predictionModel;switch(s.stage){case"struggling":return{word:n.word,priority:90,reason:`Ëã¶Êà¶‰∏≠ÔºàÊ≠£Á≠îÁéá${r.predictors.recentAccuracy.toFixed(0)}%Ôºâ`,strategy:"immediate_review",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:80};case"improving":{const o=r.predictors.timeSinceLastStudy,i=o>=1&&o<=3;return{word:n.word,priority:i?85:70,reason:`ÊîπÂñÑ‰∏≠Ôºà${o.toFixed(1)}Êó•ÁµåÈÅé„ÄÅÊàêÂäüÁéá${r.nextCorrectProbability.toFixed(0)}%Ôºâ`,strategy:i?"consolidation":"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:75}}case"consolidating":{const o=s.forgettingPattern.typicalDecayDays*.7,i=r.predictors.timeSinceLastStudy,a=Math.abs(i-o)<2;return{word:n.word,priority:a?60:40,reason:`ÂÆöÁùÄÂåñ‰∏≠ÔºàÊ¨°ÂõûÂæ©Áøí„Åæ„Åß${Math.max(0,o-i).toFixed(1)}Êó•Ôºâ`,strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:50}}case"mastered":return{word:n.word,priority:20,reason:"ÁøíÂæóÊ∏à„ÅøÔºàÈï∑ÊúüË®òÊÜ∂Á¢∫Ë™çÔºâ",strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:20};default:return{word:n.word,priority:50,reason:"ÂàùÊúüÊÆµÈöé",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60}}}function _Q(n,e){const t=n.filter(a=>a.strategy==="immediate_review");if(t.length===0)return n;const s=[],r=t.slice(0,3);s.push(...r);const o=n.filter(a=>a.strategy==="consolidation");o.length>0&&s.push(o[0]),r.length>0&&e>=10&&s.push(r[0]);const i=n.filter(a=>!s.includes(a));return s.push(...i),s.slice(0,e)}function Sy(n,e){const s=(Date.now()-e)/(1e3*60),r=n.slice(-5),o=n.slice(-10),i=r.length>0?r.filter(b=>b.wasCorrect).length/r.length*100:100,a=o.length>0?o.filter(b=>b.wasCorrect).length/o.length*100:100,c=a-i>10,l=n.length>0?n.reduce((b,v)=>b+v.responseTime,0)/n.length:3e3,d=n.slice(-5).map(b=>b.responseTime),h=PQ(d);let p=0;p+=Math.min(40,s*2),c&&(p+=25),h>1.3&&(p+=20),n.slice(-3).filter(b=>!b.wasCorrect).length>=2&&(p+=15),p=Math.min(100,Math.max(0,p));const m=100-p,g=new Date().getHours();let x;g>=6&&g<12?x="morning":g>=12&&g<18?x="afternoon":g>=18&&g<22?x="evening":x="night";const y=MQ(p,s,c);return{fatigueLevel:p,concentrationLevel:m,recentPerformance:{last5Accuracy:i,last10Accuracy:a,isDecreasing:c,averageResponseTime:l},sessionStats:{duration:s,questionsAnswered:n.length,correctCount:n.filter(b=>b.wasCorrect).length,startTime:e},breakRecommendation:y,timeOfDay:x}}function PQ(n){if(n.length<2)return 1;const e=n.slice(-3),t=n.slice(0,Math.max(1,n.length-3)),s=e.reduce((o,i)=>o+i,0)/e.length,r=t.reduce((o,i)=>o+i,0)/t.length;return r>0?s/r:1}function MQ(n,e,t){if(n>=70)return{shouldBreak:!0,reason:"Áñ≤Âä¥„ÅåËìÑÁ©ç„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ5ÂàÜ‰ºëÊÜ©„Åó„Å¶ÈõÜ‰∏≠Âäõ„ÇíÂõûÂæ©„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:5};if(e>=25&&n>=50)return{shouldBreak:!0,reason:"25ÂàÜÁµåÈÅé„Åó„Åæ„Åó„Åü„ÄÇÁü≠„ÅÑ‰ºëÊÜ©„ÅßÂäπÁéá„Åå„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÄÇ",suggestedDuration:5};if(t&&n>=40)return{shouldBreak:!0,reason:"Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ÄÂ∫¶„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:3}}function FQ(n,e){const{fatigueLevel:t,concentrationLevel:s,timeOfDay:r,sessionStats:o}=e;return R.log(`üß† Ë™çÁü•Ë≤†Ëç∑AI: Áñ≤Âä¥Â∫¶${t}%, ÈõÜ‰∏≠Âäõ${s}%, ÊôÇÈñìÂ∏Ø: ${r}`),t>=70?(R.log("  üí§ Áñ≤Âä¥Â∫¶È´ò: Á∞°Âçò„Å™Âæ©ÁøíÂïèÈ°å„ÇíÂÑ™ÂÖà"),n.filter(i=>i.estimatedSuccessRate>=70||i.strategy==="spaced_repetition").map(i=>({...i,priority:i.priority+(i.estimatedSuccessRate>=80?20:0),reason:i.reason+" (Áñ≤Âä¥ÊôÇ„ÉªÊòìÂïèÂÑ™ÂÖà)"}))):t>=40?(R.log("  üòê Áñ≤Âä¥Â∫¶‰∏≠: „Éê„É©„É≥„ÇπÈáçË¶ñ"),n.map(i=>i.estimatedSuccessRate<40?{...i,priority:i.priority-20}:i)):s>=70&&o.duration<15?(R.log("  ‚ö° ÈõÜ‰∏≠ÂäõÈ´ò: Êñ∞Ë¶èÂçòË™û„ÉªÈõ£Âïè„ÇíÂÑ™ÂÖà"),n.map(i=>i.strategy==="new_learning"?{...i,priority:i.priority+30,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÊñ∞Ë¶èÂÑ™ÂÖà)"}:i.strategy==="immediate_review"&&i.estimatedSuccessRate<60?{...i,priority:i.priority+20,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÈõ£ÂïèÊåëÊà¶)"}:i)):OQ(n,r)}function OQ(n,e){switch(e){case"morning":return R.log("  üåÖ Êúù: Êñ∞Ë¶èÂ≠¶Áøí„ÇíÂÑ™ÂÖà"),n.map(t=>t.strategy==="new_learning"?{...t,priority:t.priority+15,reason:t.reason+" (Êúù„ÉªÊñ∞Ë¶èÊúÄÈÅ©)"}:t);case"afternoon":return R.log("  ‚òÄÔ∏è ÂçàÂæå: „Éê„É©„É≥„ÇπÂûã"),n;case"evening":return R.log("  üåÜ Â§ïÊñπ: Âæ©Áøí‰∏≠ÂøÉ"),n.map(t=>t.strategy==="spaced_repetition"||t.strategy==="consolidation"?{...t,priority:t.priority+10,reason:t.reason+" (Â§ïÊñπ„ÉªÂæ©ÁøíÊúÄÈÅ©)"}:t);case"night":return R.log("  üåô Â§ú: ËªΩ„ÅÑÂæ©Áøí„ÅÆ„Åø"),n.filter(t=>t.strategy!=="new_learning"||t.estimatedSuccessRate>=60).map(t=>t.estimatedSuccessRate>=70?{...t,priority:t.priority+15,reason:t.reason+" (Â§ú„ÉªÂæ©ÁøíÊé®Â•®)"}:t);default:return n}}function LQ(n){const{fatigueLevel:e,breakRecommendation:t}=n;return t!=null&&t.shouldBreak?`üí° ${t.reason}`:e>=60?"üòå Â∞ë„ÅóÁñ≤„Çå„Å¶„Åç„Åü„Åã„ÇÇ„ÄÇÁÑ°ÁêÜ„Åõ„Åö„Éû„Ç§„Éö„Éº„Çπ„ÅßÔºÅ":e<=20?"‚ú® ÈõÜ‰∏≠Âäõ„Éê„ÉÉ„ÉÅ„É™ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ":""}function zQ(n,e){const t=new Map,s=[],r=[];let o=0;const i=e.slice(-10),a=i.length>0?i.filter(h=>!h.wasCorrect).length/i.length*100:0;Object.entries(n).forEach(([h,p])=>{o+=p.incorrectCount,p.learningHistory&&p.learningHistory.filter(m=>!m.wasCorrect).forEach(m=>{if(m.userAnswer&&UQ(h,m.userAnswer)&&t.set("similar_spelling",(t.get("similar_spelling")||0)+1),m.userAnswer){const g=s.find(x=>x.word1===h&&x.word2===m.userAnswer||x.word2===h&&x.word1===m.userAnswer);g?(g.confusionCount++,g.lastConfusion=m.timestamp):m.userAnswer!==h&&s.push({word1:h,word2:m.userAnswer,confusionCount:1,lastConfusion:m.timestamp,pattern:"confusion_pair"})}})});const c=e.slice(-5),l=c.length>0?c.filter(h=>!h.wasCorrect).length/c.length*100:0,d=l<a-10?"improving":l>a+10?"declining":"stable";return{totalErrors:o,errorsByPattern:t,confusionPairs:s.sort((h,p)=>p.confusionCount-h.confusionCount),weakCategories:r,recentErrorRate:a,errorTrend:d}}function WQ(n,e,t,s,r){const o=[];let i=30;if(e){const p=e.correctCount+e.incorrectCount;if(p>0){const f=e.incorrectCount/p*100;f>50&&(i+=30,o.push({type:"category_weakness",weight:.3,description:"„Åì„ÅÆÂçòË™û„ÅÆÈÅéÂéª„ÅÆË™§Á≠îÁéá„ÅåÈ´ò„ÅÑ",evidence:[`Ë™§Á≠îÁéá: ${f.toFixed(0)}%`]}))}if(e.learningHistory&&e.learningHistory.length>0){const f=e.learningHistory.slice(-3),m=f.filter(g=>!g.wasCorrect).length/f.length*100;m>66&&(i+=25,o.push({type:"timing_based",weight:.25,description:"ÊúÄËøë3Âõû„ÅÆ„ÅÜ„Å°2Âõû‰ª•‰∏äÈñìÈÅï„Åà„Å¶„ÅÑ„Çã",evidence:[`Áõ¥Ëøë3Âõû„ÅÆË™§Á≠îÁéá: ${m.toFixed(0)}%`]}))}if(e.lastStudied){const f=(Date.now()-e.lastStudied)/864e5;if(f>7){const m=Math.min(20,f*2);i+=m,o.push({type:"timing_based",weight:m/100,description:"ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµåÈÅé„Åó„Å¶„ÅÑ„Çã",evidence:[`${f.toFixed(1)}Êó•Ââç„Å´Âæ©Áøí`]})}}}else i+=20,o.push({type:"category_weakness",weight:.2,description:"„Åæ„Å†Â≠¶Áøí„Åó„Åü„Åì„Å®„Åå„Å™„ÅÑÂçòË™û",evidence:["ÂàùË¶ã"]});const a=t.confusionPairs.find(p=>p.word1===n||p.word2===n);if(a&&a.confusionCount>=2){i+=15;const p=a.word1===n?a.word2:a.word1;o.push({type:"confusion_pair",weight:.15,description:`"${p}"„Å®Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ`,evidence:[`${a.confusionCount}ÂõûÊ∑∑Âêå`]})}if(s>60){const p=(s-60)/2;i+=p,o.push({type:"timing_based",weight:p/100,description:"Áñ≤Âä¥„Å´„Çà„ÇäÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Çã",evidence:[`Áñ≤Âä¥Â∫¶: ${s.toFixed(0)}%`]})}t.errorTrend==="declining"&&(i+=10,o.push({type:"category_weakness",weight:.1,description:"ÂÖ®‰ΩìÁöÑ„Å´Ë™§Á≠îÁéá„Åå‰∏äÊòáÂÇæÂêë",evidence:[`ÊúÄËøë10Âïè„ÅÆË™§Á≠îÁéá: ${t.recentErrorRate.toFixed(0)}%`]}));const c=Math.min(100,Math.max(0,i)),l=c>=80?"critical":c>=60?"high":c>=40?"medium":"low",d=BQ(n,c,l,o,a),h=VQ(e,o.length);return{word:n,errorRisk:c,confidence:h,primaryPattern:o.length>0?o[0].type:"category_weakness",riskFactors:o,warningLevel:l,suggestedSupport:d}}function BQ(n,e,t,s,r){const o=[],i=[];let a="",c="";return t==="critical"?(a=`‚ö†Ô∏è Ê≥®ÊÑè: „Åì„ÅÆÂïèÈ°å„ÅØÈñìÈÅï„Åà„ÇÑ„Åô„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„ÅôÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÅ„Åó„Å£„Åã„ÇäËÄÉ„Åà„Å¶„Åã„ÇâÁ≠î„Åà„Åæ„Åó„Çá„ÅÜÔºÅ"):t==="high"?(a=`üîî „Åì„ÅÆÂïèÈ°å„ÅØÂ∞ë„ÅóÈõ£„Åó„ÅÑ„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„ÇìÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Çå„Å∞Â§ß‰∏àÂ§´„Åß„ÅôÔºÅ"):t==="medium"&&(a=`üí° ÊÖéÈáç„Å´Á≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶Âèñ„ÇäÁµÑ„Åø„Åæ„Åó„Çá„ÅÜÔºÅ"),s.forEach(l=>{switch(l.type){case"confusion_pair":if(r){const d=r.word1===n?r.word2:r.word1;o.push(`"${d}"„Å®Ê∑∑Âêå„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Ê≥®ÊÑè`),i.push(d)}break;case"similar_spelling":o.push("Á∂¥„Çä„Çí„Çà„ÅèÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ");break;case"timing_based":l.description.includes("ÊôÇÈñì„ÅåÁµåÈÅé")?o.push("ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÑèÂë≥„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"):l.description.includes("Áñ≤Âä¥")&&o.push("Áñ≤„Çå„Å¶„ÅÑ„Çã„Å®„Åç„ÅØÁÑ¶„Çâ„Åö„ÄÅ„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Åæ„Åó„Çá„ÅÜ");break;case"category_weakness":o.push("„Åì„ÅÆÂçòË™û„ÅØÈÅéÂéª„Å´ÈñìÈÅï„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÖéÈáç„Å´ÔºÅ");break}}),{showWarning:t!=="low",warningMessage:a,hints:o.slice(0,2),reviewWords:i,confidenceBooster:c}}function VQ(n,e){let t=50;if(n){const s=n.correctCount+n.incorrectCount;t+=Math.min(30,s*5),n.learningHistory&&n.learningHistory.length>=3&&(t+=10)}return t+=Math.min(10,e*3),Math.min(100,t)}function UQ(n,e){const t=GQ(n.toLowerCase(),e.toLowerCase());return t>0&&t<=2}function GQ(n,e){const t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=n.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let r=1;r<=n.length;r++)e.charAt(s-1)===n.charAt(r-1)?t[s][r]=t[s-1][r-1]:t[s][r]=Math.min(t[s-1][r-1]+1,t[s][r-1]+1,t[s-1][r]+1);return t[e.length][n.length]}function HQ(n,e,t,s,r){const o=new Map;return n.forEach(i=>{const a=WQ(i,e[i],t,s);o.set(i,a)}),o}function wI(n=Date.now()){const e=new Date(n).getHours();return e>=5&&e<12?"morning":e>=12&&e<17?"afternoon":e>=17&&e<21?"evening":"night"}function qQ(n,e,t,s,r,o,i,a){const c=(e-n)/6e4,l=t>0?s/t*100:0;return{sessionId:`session_${n}`,startTime:n,endTime:e,duration:c,timeOfDay:wI(n),questionsAnswered:t,correctAnswers:s,accuracy:l,averageResponseTime:r,fatigueLevel:o,newWordsLearned:i,reviewedWords:a}}function KQ(n){return["morning","afternoon","evening","night"].map(t=>{const s=n.filter(g=>g.timeOfDay===t);if(s.length===0)return{timeOfDay:t,sessionCount:0,totalQuestions:0,averageAccuracy:0,averageResponseTime:0,averageFatigue:0,efficiencyScore:0,bestForNewLearning:!1,bestForReview:!1};const r=s.reduce((g,x)=>g+x.questionsAnswered,0),i=s.reduce((g,x)=>g+x.correctAnswers,0)/r*100,a=s.reduce((g,x)=>g+x.averageResponseTime,0)/s.length,c=s.reduce((g,x)=>g+x.fatigueLevel,0)/s.length,l=s.reduce((g,x)=>g+x.newWordsLearned,0),d=s.reduce((g,x)=>g+x.reviewedWords,0),h=i,p=Math.max(0,100-a/50),f=100-c,m=h*.4+p*.3+f*.3;return{timeOfDay:t,sessionCount:s.length,totalQuestions:r,averageAccuracy:i,averageResponseTime:a,averageFatigue:c,efficiencyScore:m,bestForNewLearning:l>d,bestForReview:d>=l}}).sort((t,s)=>s.efficiencyScore-t.efficiencyScore)}function QQ(n){if(n.length===0)return{optimalDuration:15,currentAverageDuration:0,performanceByDuration:[],recommendation:"Â≠¶Áøí„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åæ„Åö„ÅØ15ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ"};const e=n.reduce((a,c)=>a+c.duration,0)/n.length,s=[{min:0,max:5,label:"0-5ÂàÜ"},{min:5,max:10,label:"5-10ÂàÜ"},{min:10,max:15,label:"10-15ÂàÜ"},{min:15,max:20,label:"15-20ÂàÜ"},{min:20,max:30,label:"20-30ÂàÜ"},{min:30,max:999,label:"30ÂàÜ‰ª•‰∏ä"}].map(a=>{const c=n.filter(p=>p.duration>=a.min&&p.duration<a.max);if(c.length===0)return{durationRange:a.label,accuracy:0,efficiency:0};const l=c.reduce((p,f)=>p+f.accuracy,0)/c.length,d=c.reduce((p,f)=>p+f.fatigueLevel,0)/c.length,h=l-d*.5;return{durationRange:a.label,accuracy:l,efficiency:h}}).filter(a=>a.efficiency>0),r=s.reduce((a,c)=>c.efficiency>a.efficiency?c:a,s[0]||{durationRange:"10-15ÂàÜ",efficiency:0}),o=r?parseInt(r.durationRange.split("-")[0])+5:15;let i="";return o<10?i=`Áü≠ÊúüÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆÁü≠„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥„Çí1Êó•Ë§áÊï∞ÂõûË°å„ÅÜ„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:o<20?i=`${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Åì„ÅÆÈï∑„Åï„ÇíÁõÆÂÆâ„Å´Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`:i=`Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Å™„Çà„ÅÜ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅßÊ∑±„ÅÑÂ≠¶Áøí„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åü„Å†„Åó„ÄÅÁñ≤Âä¥„Å´Ê≥®ÊÑè„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,{optimalDuration:o,currentAverageDuration:e,performanceByDuration:s,recommendation:i}}function XQ(n){if(n.length<5)return"moderate";const e=n.reduce((r,o)=>r+o.duration,0)/n.length,t=new Set(n.map(r=>new Date(r.startTime).toDateString())),s=n.length/t.size;return e<10&&s>=2?"distributed":e<10?"short_burst":e<20?"moderate":"extended"}function YQ(n,e){var p,f,m;const t=XQ(e),s=KQ(e),r=QQ(e),o=((p=s[0])==null?void 0:p.timeOfDay)||"morning",i=r.optimalDuration;let a=1;t==="distributed"||t==="short_burst"?a=3:t==="moderate"&&(a=2);const c=[],l=[];((f=s[0])==null?void 0:f.averageAccuracy)>80&&c.push(`${s[0].timeOfDay}„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑèÔºàÊ≠£Á≠îÁéá${s[0].averageAccuracy.toFixed(0)}%Ôºâ`),t==="distributed"?c.push("ÂàÜÊï£Â≠¶Áøí„Å´„Çà„ÇäË®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåËâØÂ•Ω"):t==="extended"&&c.push("Èï∑ÊôÇÈñì„ÅÆÈõÜ‰∏≠Â≠¶Áøí„ÅåÂèØËÉΩ"),e.reduce((g,x)=>g+x.fatigueLevel,0)/e.length>60&&l.push("Áñ≤Âä¥„É¨„Éô„É´„ÅåÈ´ò„ÇÅ„ÄÇ‰ºëÊÜ©„ÇíÂ¢ó„ÇÑ„Åô„Åã„ÄÅ„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÁü≠Á∏Æ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"),((m=s[s.length-1])==null?void 0:m.averageAccuracy)<60&&l.push(`${s[s.length-1].timeOfDay}„ÅÆÂ≠¶ÁøíÂäπÁéá„Åå‰Ωé„ÅÑ„Åü„ÇÅ„ÄÅÈÅø„Åë„Çã„Åì„Å®„ÇíÊé®Â•®`);const h=[];return h.push(`ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø: ${o==="morning"?"Êúù":o==="afternoon"?"ÂçàÂæå":o==="evening"?"Â§ïÊñπ":"Â§ú"}`),h.push(`Êé®Â•®„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑: ${i}ÂàÜ`),h.push(`1Êó•„ÅÆÊé®Â•®Â≠¶ÁøíÂõûÊï∞: ${a}Âõû`),t==="distributed"?h.push("Áü≠„ÅÑÂ≠¶Áøí„ÇíË§áÊï∞ÂõûË°å„ÅÜ„Çπ„Çø„Ç§„É´„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇÊúù„ÉªÊòº„ÉªÂ§ú„Å´ÂàÜ„Åë„Å¶Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ"):t==="extended"&&h.push("Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Åß„Åô„ÄÇÈÄ±Êú´„Å™„Å©„Å´„Åæ„Å®„ÇÅ„Å¶Â≠¶Áøí„Åô„ÇãÊñπÊ≥ï„ÇÇÊúâÂäπ„Åß„Åô"),{userId:n,primaryStyle:t,bestTimeOfDay:o,optimalSessionLength:i,optimalDailyFrequency:a,strengths:c,improvements:l,personalizedRecommendations:h}}function JQ(n){try{const e="learning-style-sessions",t=localStorage.getItem(e),s=t?JSON.parse(t):[];s.push(n);const r=s.slice(-100);localStorage.setItem(e,JSON.stringify(r))}catch(e){R.error("Failed to save session history:",e)}}function ZQ(){try{const e=localStorage.getItem("learning-style-sessions");return e?JSON.parse(e):[]}catch(n){return R.error("Failed to load session history:",n),[]}}function eX(n,e){const t=e===n.bestTimeOfDay,s={morning:"Êúù",afternoon:"ÂçàÂæå",evening:"Â§ïÊñπ",night:"Â§ú"};return t?`‚ú® ‰ªä„ÅØ${s[e]}„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆÊúÄ„ÇÇÂ≠¶ÁøíÂäπÁéá„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„Åß„ÅôÔºÅ${n.optimalSessionLength}ÂàÜÁ®ãÂ∫¶„ÅÆÂ≠¶Áøí„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:`üí° ${s[n.bestTimeOfDay]}„ÅÆÂ≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÊûúÁöÑ„Åß„Åô„ÄÇÁèæÂú®„ÅØ${s[e]}„Å™„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ`}const tX={first_session:{type:"first_session",name:"Â≠¶ÁøíÈñãÂßã",description:"Âàù„ÇÅ„Å¶„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÂÆå‰∫Ü",icon:"üéì",rarity:"common"},streak_3_days:{type:"streak_3_days",name:"‰∏âÊó•Âùä‰∏ªÂÖãÊúç",description:"3Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üî•",rarity:"common"},streak_7_days:{type:"streak_7_days",name:"‰∏ÄÈÄ±Èñì„ÅÆÁøíÊÖ£",description:"7Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"‚≠ê",rarity:"rare"},streak_30_days:{type:"streak_30_days",name:"ÁøíÊÖ£„ÅÆÈÅî‰∫∫",description:"30Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üèÜ",rarity:"epic"},total_100_words:{type:"total_100_words",name:"ÁôæÂçòË™û",description:"Á¥ØË®à100ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìö",rarity:"common"},total_500_words:{type:"total_500_words",name:"‰∫îÁôæÂçòË™û",description:"Á¥ØË®à500ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìñ",rarity:"rare"},total_1000_words:{type:"total_1000_words",name:"ÂçÉÂçòË™û„Éû„Çπ„Çø„Éº",description:"Á¥ØË®à1000ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üéñÔ∏è",rarity:"epic"},perfect_session:{type:"perfect_session",name:"„Éë„Éº„Éï„Çß„ÇØ„Éà",description:"1„Çª„ÉÉ„Ç∑„Éß„É≥ÂÖ®ÂïèÊ≠£Ëß£",icon:"üíØ",rarity:"rare"},accuracy_90:{type:"accuracy_90",name:"È´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá90%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üéØ",rarity:"rare"},accuracy_95:{type:"accuracy_95",name:"Ë∂ÖÈ´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá95%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üíé",rarity:"epic"},early_bird:{type:"early_bird",name:"Êó©Ëµ∑„ÅçÈ≥•",description:"ÊúùÔºà6-9ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåÖ",rarity:"common"},night_owl:{type:"night_owl",name:"Â§úÂûãÂ≠¶Áøí",description:"Â§úÔºà21-24ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåô",rarity:"common"},speed_master:{type:"speed_master",name:"„Çπ„Éî„Éº„Éâ„Éû„Çπ„Çø„Éº",description:"Âπ≥ÂùáÂøúÁ≠îÊôÇÈñì2Áßí‰ª•‰∏ã„Çí10ÂõûÈÅîÊàê",icon:"‚ö°",rarity:"rare"},review_champion:{type:"review_champion",name:"Âæ©Áøí„ÉÅ„É£„É≥„Éî„Ç™„É≥",description:"Ë¶ÅÂæ©ÁøíÂçòË™û50ÂÄã„Çí„Éû„Çπ„Çø„Éº",icon:"‚ôªÔ∏è",rarity:"rare"},master_100:{type:"master_100",name:"ÁôæÂçòË™û„Éû„Çπ„Çø„Éº",description:"100ÂçòË™û„ÇíÂÆåÂÖ®ÁøíÂæó",icon:"üëë",rarity:"epic"},comeback:{type:"comeback",name:"„Ç´„É†„Éê„ÉÉ„ÇØ",description:"1ÈÄ±Èñì‰ª•‰∏ä„ÅÆ‰∏≠Êñ≠Âæå„Å´ÂÜçÈñã",icon:"üí™",rarity:"common"},marathon:{type:"marathon",name:"„Éû„É©„ÇΩ„É≥„É©„É≥„Éä„Éº",description:"1ÊôÇÈñì‰ª•‰∏ä„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥",icon:"üèÉ",rarity:"rare"},focused:{type:"focused",name:"ÈõÜ‰∏≠Âäõ„ÅÆÊ•µ„Åø",description:"ÈõÜ‰∏≠Âäõ„ÅÆÈ´ò„ÅÑÂ≠¶Áøí„Çí10Âõû",icon:"üßò",rarity:"rare"}},vI=n=>Math.floor(100*Math.pow(1.15,n-1)),Oa={CORRECT_ANSWER:10,PERFECT_SESSION:100,STREAK_BONUS_PER_DAY:5,SESSION_COMPLETION:50,BADGE_EARNED:200},SI=()=>{const n=localStorage.getItem("gamificationStats");if(n){const e=JSON.parse(n);return e.lastSessionDate&&(e.lastSessionDate=new Date(e.lastSessionDate)),e.badges=e.badges.map(t=>({...t,earnedAt:t.earnedAt?new Date(t.earnedAt):void 0})),e.milestones=e.milestones.map(t=>({...t,completedAt:t.completedAt?new Date(t.completedAt):void 0})),e.challenges=e.challenges.map(t=>({...t,startDate:new Date(t.startDate),endDate:new Date(t.endDate)})),e}return{level:{level:1,currentXP:0,requiredXP:vI(1),totalXP:0},badges:[],streak:{current:0,longest:0,lastStudyDate:""},milestones:sX(),challenges:[],totalSessions:0,totalWordsLearned:0,totalCorrectAnswers:0,averageAccuracy:0}},nX=n=>{localStorage.setItem("gamificationStats",JSON.stringify(n))},sX=()=>[{id:"first_10_words",title:"ÊúÄÂàù„ÅÆ10ÂçòË™û",description:"10ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:10,current:0,reward:{xp:100},completed:!1},{id:"first_50_words",title:"50ÂçòË™ûÈÅîÊàê",description:"50ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:50,current:0,reward:{xp:300,badge:"total_100_words"},completed:!1},{id:"accuracy_80",title:"Ê≠£Á≠îÁéá80%",description:"Ê≠£Á≠îÁéá80%‰ª•‰∏ä„ÇíÈÅîÊàê",target:80,current:0,reward:{xp:200},completed:!1}],rX=(n,e)=>{const t={...n};t.level.currentXP+=e,t.level.totalXP+=e;let s=!1,r;for(;t.level.currentXP>=t.level.requiredXP;)t.level.currentXP-=t.level.requiredXP,t.level.level+=1,t.level.requiredXP=vI(t.level.level),s=!0,r=t.level.level;return{stats:t,leveledUp:s,newLevel:r}},oX=n=>{const e=new Date().toISOString().split("T")[0],t=n.streak.lastStudyDate;if(!t)return{...n,streak:{current:1,longest:1,lastStudyDate:e}};if(t===e)return n;const s=new Date;s.setDate(s.getDate()-1);const r=s.toISOString().split("T")[0];if(t===r){const o=n.streak.current+1;return{...n,streak:{current:o,longest:Math.max(o,n.streak.longest),lastStudyDate:e}}}else return{...n,streak:{current:1,longest:n.streak.longest,lastStudyDate:e}}},iX=(n,e)=>{const t=[],s=new Set(n.badges.map(a=>a.type)),r=a=>{if(!s.has(a)){const c={...tX[a],earnedAt:new Date};t.push(c),s.add(a)}};n.totalSessions===1&&!s.has("first_session")&&r("first_session"),n.streak.current>=3&&r("streak_3_days"),n.streak.current>=7&&r("streak_7_days"),n.streak.current>=30&&r("streak_30_days"),n.totalWordsLearned>=100&&r("total_100_words"),n.totalWordsLearned>=500&&r("total_500_words"),n.totalWordsLearned>=1e3&&r("total_1000_words"),e.perfectScore&&r("perfect_session");const o=n.totalSessions;return e.accuracy>=90&&o>=10&&r("accuracy_90"),e.accuracy>=95&&o>=10&&r("accuracy_95"),e.timeOfDay==="morning"&&n.totalSessions>=5&&r("early_bird"),e.timeOfDay==="night"&&n.totalSessions>=5&&r("night_owl"),e.avgResponseTime<=2e3&&n.totalSessions>=10&&r("speed_master"),e.sessionDuration>=60&&r("marathon"),e.focused&&n.totalSessions>=10&&r("focused"),n.lastSessionDate&&(new Date().getTime()-n.lastSessionDate.getTime())/864e5>=7&&r("comeback"),{stats:{...n,badges:[...n.badges,...t]},newBadges:t}},aX=n=>{const e=[],t=n.milestones.map(s=>{if(s.completed)return s;let r=s.current;if(s.id.includes("words")?r=n.totalWordsLearned:s.id.includes("accuracy")&&(r=n.averageAccuracy),r>=s.target&&!s.completed){const i={...s,current:r,completed:!0,completedAt:new Date};return e.push(i),i}return{...s,current:r}});return{stats:{...n,milestones:t},completedMilestones:e}},cX=(n,e,t,s,r,o)=>{let i=SI();const a=[];let c=0;i.totalSessions+=1,i.totalWordsLearned+=r,i.totalCorrectAnswers+=n,i.averageAccuracy=(i.averageAccuracy*(i.totalSessions-1)+n/e*100)/i.totalSessions,i.lastSessionDate=new Date;const l=i.streak.current;i=oX(i),i.streak.current>l&&(a.push({type:"streak",message:`üî• ${i.streak.current}Êó•ÈÄ£Á∂öÂ≠¶ÁøíÔºÅ`,icon:"üî•",priority:4}),c+=Oa.STREAK_BONUS_PER_DAY*i.streak.current);const d=n/e*100,h=n===e;c+=n*Oa.CORRECT_ANSWER,c+=Oa.SESSION_COMPLETION,h&&(c+=Oa.PERFECT_SESSION,a.push({type:"praise",message:"üíØ „Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅÂÖ®ÂïèÊ≠£Ëß£„Åß„ÅôÔºÅ",icon:"üíØ",priority:5}));const p=new Date().getHours();let f;p>=6&&p<12?f="morning":p>=12&&p<18?f="afternoon":p>=18&&p<21?f="evening":f="night";const m=o<.3,g=iX(i,{accuracy:d,avgResponseTime:t,perfectScore:h,timeOfDay:f,sessionDuration:s,focused:m});i=g.stats,g.newBadges.length>0&&g.newBadges.forEach(b=>{a.push({type:"milestone",message:`üéñÔ∏è „Éê„ÉÉ„Ç∏Áç≤Âæó: ${b.name}`,icon:b.icon,priority:5}),c+=Oa.BADGE_EARNED});const x=aX(i);i=x.stats,x.completedMilestones.length>0&&x.completedMilestones.forEach(b=>{a.push({type:"milestone",message:`üéØ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÈÅîÊàê: ${b.title}`,icon:"üéØ",priority:4}),c+=b.reward.xp});const y=rX(i,c);return i=y.stats,y.leveledUp&&y.newLevel&&a.push({type:"level_up",message:`‚≠ê „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ Lv.${y.newLevel}`,icon:"‚≠ê",priority:5}),d<50?a.push({type:"encouragement",message:"üí™ ÁÑ¶„Çâ„ÅöÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºÅÁ∂ôÁ∂ö„ÅåÂ§ßÂàá„Åß„Åô",icon:"üí™",priority:2}):d>=50&&d<80?a.push({type:"encouragement",message:"üëç ËâØ„ÅÑ„Éö„Éº„Çπ„Åß„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÔºÅ",icon:"üëç",priority:2}):d>=80&&d<95&&a.push({type:"praise",message:"üåü Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÈ´ò„ÅÑÊ≠£Á≠îÁéá„Åß„Åô",icon:"üåü",priority:3}),nX(i),{stats:i,feedback:a.sort((b,v)=>v.priority-b.priority),xpGained:c,leveledUp:y.leveledUp,newLevel:y.newLevel}},lX=()=>{const n=SI(),e=[];return n.streak.current>0&&e.push(`üî• ${n.streak.current}Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ`),n.level.level>1&&e.push(`‚≠ê „É¨„Éô„É´ ${n.level.level}`),n.level.currentXP/n.level.requiredXP*100>80&&e.push("Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ"),e.length===0&&e.push("‰ªäÊó•„ÇÇÂ≠¶Áøí„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ"),e.join(" | ")},Zo=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:dc,addSessionHistory:ga,calculateSessionStats:w0,checkFlexibleMastery:r0,createWeakWordsQuestionSet:Gu,filterSkippedWords:i0,getAllWordProgress:Di,getConfusedWords:c0,getCumulativeProgressData:h0,getCurrentWeakWords:Ih,getCustomQuestionSets:Th,getDetailedRetentionStats:Ou,getGrammarDetailedRetentionStats:Lu,getGrammarRetentionRateWithAI:Hu,getGrammarUnitStats:t0,getGrammarUnitStatsWithTitles:b0,getMemorizationCardSettings:m0,getMemorizationDetailedRetentionStats:zu,getMemorizationSettings:x0,getMonthlyStats:Zg,getNearMasteryStats:nI,getOvercomeWeakWords:s0,getRecentlyMasteredWords:e0,getRetentionRateWithAI:Bu,getRetentionTrend:p0,getStudyCalendarByMode:d0,getStudySettings:Yg,getTodayIncorrectWords:Mu,getTodayStats:Fu,getTotalAnsweredCount:l0,getTotalMasteredWordsCount:$h,getUniqueQuestionedWordsCount:oI,getWeeklyStats:Jg,getWordDetailedData:Vu,getWordProgress:Wu,isWordSkipExcluded:o0,loadProgress:ps,loadProgressSync:et,recordConfusion:a0,recordMemorizationBehavior:y0,recordWordSkip:kh,resetAllProgress:u0,saveCustomQuestionSet:Uu,saveMemorizationCardSettings:f0,saveMemorizationSettings:g0,saveProgress:co,updateProgressCache:Jr,updateWordProgress:So},Symbol.toStringTag,{value:"Module"}));function po(n){return n[Math.floor(Math.random()*n.length)]}function uX(){const n=localStorage.getItem("progress-data");if(!n)return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0};try{const t=JSON.parse(n).results||[],s=t.slice(-10),r=s.length>0?s.reduce((g,x)=>g+x.score/x.total*100,0)/s.length:0,o=new Map;t.forEach(g=>{if(g.category){const x=o.get(g.category)||{correct:0,total:0};x.correct+=g.score,x.total+=g.total,o.set(g.category,x)}});const i=[],a=[];o.forEach((g,x)=>{const y=g.total>0?g.correct/g.total*100:0;y>=80&&i.push(x),y<60&&a.push(x)});const c=s.slice(0,5),l=s.slice(-5),d=c.length>0?c.reduce((g,x)=>g+x.score/x.total*100,0)/c.length:0,p=(l.length>0?l.reduce((g,x)=>g+x.score/x.total*100,0)/l.length:0)>d+5,f=new Set(t.map(g=>new Date(g.date).toDateString())),m=Math.min(100,f.size*5);return{totalSessions:t.length,averageAccuracy:r,strongCategories:i,weakCategories:a,recentImprovement:p,consistencyScore:m}}catch{return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0}}}function N0(){const n=new Date().getHours();return n>=5&&n<12?"morning":n>=12&&n<17?"afternoon":n>=17&&n<21?"evening":"night"}class dX{generateCorrectComment(e){const t=[],s=uX();return e.attemptCount===1?(e.responseTime<3e3&&t.push(po(["ÈÄü„ÅÑÔºÅ","ÂèçÂøú„ÅåÈã≠„ÅÑ„ÅûÔºÅ","Âç≥Á≠î„Å†„Å™ÔºÅ"])),t.push(po(["„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","Ê≠£Ëß£„Å†ÔºÅ"]))):e.attemptCount===2?t.push(po(["2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ","„ÇÑ„Å£„Å®Ê≠£Ëß£„Åó„Åü„Å™„ÄÇ"])):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèÊ±∫„ÇÅ„ÇçÔºÅ")),e.difficulty==="advanced"&&e.attemptCount===1?t.push(po(["‰∏äÁ¥öÂçòË™û„Çí‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ","Èõ£„Åó„ÅÑÂçòË™û„ÇÇ„ÇØ„É™„Ç¢„Å†„Å™ÔºÅ"])):e.difficulty==="beginner"&&e.attemptCount>1&&t.push("ÂàùÁ¥ö„Åß„ÇÇ„Åü„Å§„Åè„Å™ÔºÅ"),e.correctStreak>=10?(t.push(`È©öÁï∞„ÅÆ${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(po(["ÂÆåÂÖ®„Å´Ê≥¢„Å´‰πó„Å£„Å¶„Çã„Å™ÔºÅ","„Åì„ÅÆ„Åæ„ÅæÁ™Å„Å£Ëµ∞„ÇåÔºÅ"]))):e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(po(["Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åü„Å™ÔºÅ","„ÅÑ„ÅÑÊµÅ„Çå„Å†ÔºÅ"]))):e.correctStreak>=3&&t.push("3ÈÄ£Á∂ö„Å†„ÄÇ"),s.recentImprovement&&s.totalSessions>=10&&t.push(po(["ÊúÄËøë„ÅÆÊàêÈï∑„ÅåËëó„Åó„ÅÑ„ÅûÔºÅ","Ââç„Çà„ÇäÁ¢∫ÂÆü„Å´Âº∑„Åè„Å™„Å£„Å¶„ÇãÔºÅ"])),e.isWeakCategory&&e.isCorrect&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push(po(["ÊàêÈï∑„ÇíÊÑü„Åò„Çã„ÅûÔºÅ","Âº±ÁÇπ„ÇíÊΩ∞„Åó„Åü„Å™ÔºÅ"]))),e.todayQuestions>=50&&e.todayAccuracy>=80&&t.push("‰ªäÊó•„ÅØÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ"),e.timeOfDay==="night"&&e.todayQuestions>=30&&t.push("Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÇãÔºÅ"),e.hasSeenBefore&&e.previousAttempts>2&&(t.push(`Ââç„ÅØ${e.previousAttempts}Âõû„ÇÇ„Åã„Åã„Å£„ÅüÂçòË™û„Å†„ÅûÔºÅ`),t.push("„Çà„ÅÜ„ÇÑ„ÅèË¶ö„Åà„Åü„Å™ÔºÅ")),e.learningPhase==="ENCODING"?t.push("Êñ∞Ë¶èË®òÊÜ∂„ÇíËÑ≥„Å´Âàª„ÅøËæº„Çì„Åß„Çã„ÅûÔºÅ"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„Çã„Å™ÔºÅ"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠„Å†ÔºÅ"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åü„Å™ÔºÅ"),t.push("„Åì„ÅÆË™øÂ≠ê„Å†ÔºÅüí™"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÈÅï„ÅÜÔºÅ"):t.push("„Åæ„ÅüÈñìÈÅï„Åà„ÅüÔºÅ"),e.difficulty==="beginner"&&(t.push("ÂàùÁ¥ö„ÅßÈñìÈÅï„Åà„Çã„Å®„ÅØ‚Ä¶"),t.push("Âü∫Á§é„Åã„Çâ„ÇÑ„ÇäÁõ¥„ÅõÔºÅ")),e.incorrectStreak>=3&&(t.push(`${e.incorrectStreak}ÈÄ£Á∂ö„Éü„ÇπÔºÅ`),t.push("„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ")),e.hasSeenBefore&&(t.push(`Ââç„Å´„ÇÇÈñìÈÅï„Åà„Åü${e.word}„Å†„ÅûÔºÅ`),t.push("‰ΩïÂ∫¶„ÇÑ„Çâ„Åõ„ÇãÊ∞ó„Å†ÔºÅ")),e.todayAccuracy<60&&(t.push("‰ªäÊó•„ÅÆÊ≠£Á≠îÁéá„Åå‰Ωé„ÅÑÔºÅ"),t.push("ÈõÜ‰∏≠„Åó„ÇçÔºÅ")),e.timeOfDay==="night"&&e.todayQuestions>=40?(t.push("Áñ≤„Çå„Å¶„Çã„Å™„Çâ‰ºë„ÇÅÔºÅ"),t.push("„Å†„ÅåÊòéÊó•„ÅØÂÄç„ÇÑ„Çã„Çì„Å†„ÅûÔºÅ")):t.push("Ê∞óÂêà„ÇíÂÖ•„Çå„ÇçÔºÅüî•"),t.join(" ")}}class hX{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„ÅôÔºÅ"),e.attemptCount===1?e.responseTime<3e3?t.push("Á¥†Êó©„ÅÑÂà§Êñ≠„Åß„Åó„Åü„Å≠ ‚ú®"):t.push("„Åó„Å£„Åã„ÇäËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠"):e.attemptCount===2?(t.push("2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü"),t.push("ËêΩ„Å°ÁùÄ„ÅÑ„Å¶ËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠")):e.attemptCount>=3&&(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü`),t.push("Á≤ò„ÇäÂº∑„ÅèÂèñ„ÇäÁµÑ„ÇÅ„Åæ„Åó„Åü„Å≠")),e.difficulty==="advanced"&&(t.push(`${e.word}„ÅØÈõ£„Åó„ÅÑÂçòË™û„Åß„Åó„Åü„Åå„ÄÅ`),t.push("Ë¶ã‰∫ã„Å´Ê≠£Ëß£„Åó„Åæ„Åó„ÅüÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„Åß„ÅôÔºÅ`),t.push("Á¥†Êô¥„Çâ„Åó„ÅÑÈõÜ‰∏≠Âäõ„Åß„Åô„Å≠ üå∏")):e.correctStreak>=3&&t.push("Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åæ„Åó„Åü„Å≠"),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push("Â∞ë„Åó„Åö„Å§ÂæóÊÑè„Å´„Å™„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Çà üòä")),e.hasSeenBefore&&e.previousAttempts>2&&(t.push("ÂâçÂõû„Çà„ÇäÊó©„ÅèÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠"),t.push("Á¢∫ÂÆü„Å´ÊàêÈï∑„Åó„Å¶„ÅÑ„Åæ„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ„ÇÇ„ÅÜ${e.todayQuestions}Âïè„ÇÇÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠`),t.push("ÁÑ°ÁêÜ„Åó„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„Å≠")),e.learningPhase==="ENCODING"?t.push("Ë®òÊÜ∂„ÅÆÁ¨¶Âè∑Âåñ„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô üìù"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Å≠ ‚ú®"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å„Åß„Åç„Å¶„ÅÑ„Åæ„Åô üåü"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Åü„Å≠ üéâ"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÊÉú„Åó„ÅÑ„Åß„Åô"):t.push("Èõ£„Åó„Åã„Å£„Åü„Åß„Åô„Å≠"),t.push("„Åß„ÇÇÂ§ß‰∏àÂ§´„Åß„Åô"),e.difficulty==="advanced"?(t.push(`${e.word}„ÅØ‰∏äÁ¥öÂçòË™û„Å™„ÅÆ„Åß`),t.push("‰ΩïÂ∫¶„ÅãÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ")):e.difficulty==="beginner"&&(t.push("Âü∫Á§éÁöÑ„Å™ÂçòË™û„Å™„ÅÆ„Åß"),t.push("„ÇÜ„Å£„Åè„ÇäË¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.incorrectStreak>=3&&(t.push("Â∞ë„ÅóÁñ≤„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü"),t.push("Ê∑±ÂëºÂê∏„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ üå±")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØË¶ÅÊ≥®ÊÑè„ÅÆÂçòË™û„Åß„Åô„Å≠`),t.push("‰∏ÄÁ∑í„Å´Ë¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.timeOfDay==="night"&&(t.push("Â§ú„ÅØÈõÜ‰∏≠„Åó„Å•„Çâ„ÅÑ„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô"),t.push("ÁÑ°ÁêÜ„Åõ„Åö‰ºëÊÜ©„ÇÇÂ§ßÂàá„Åß„Åô„Çà")),t.push("Ê¨°„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åô„Çà üòä"),t.join(" ")}}class pX{generateCorrectComment(e){const t=[];if(t.push("Ê≠£Ëß£„ÄÇ"),t.push(`ÂøúÁ≠îÊôÇÈñì: ${(e.responseTime/1e3).toFixed(1)}Áßí`),e.attemptCount>1&&t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.correctStreak>0){t.push(`ÈÄ£Á∂öÊ≠£Ëß£: ${e.correctStreak}`);const s=Math.min(100,e.userAccuracy+2);t.push(`Ê≠£Á≠îÁéá: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}if(e.difficulty==="advanced"&&(t.push("Èõ£ÊòìÂ∫¶: ‰∏äÁ¥ö"),t.push("ÊúüÂæÖÊ≠£Á≠îÁéá„Çí‰∏äÂõû„Çã„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ")),e.isWeakCategory){t.push(`Ëã¶Êâã„Ç´„ÉÜ„Ç¥„É™„Éº(${e.category})„ÅßÊ≠£Ëß£`);const s=Math.min(100,e.categoryAccuracy+3);t.push(`„Ç´„ÉÜ„Ç¥„É™„ÉºÊ≠£Á≠îÁéá: ${e.categoryAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return t.push("üìä"),t.join(" ")}generateIncorrectComment(e){const t=[];if(t.push("‰∏çÊ≠£Ëß£„ÄÇ"),t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.incorrectStreak>0){t.push(`ÈÄ£Á∂ö‰∏çÊ≠£Ëß£: ${e.incorrectStreak}`);const s=Math.max(0,e.userAccuracy-2);t.push(`Ê≠£Á≠îÁéáÂΩ±Èüø: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return e.difficulty==="beginner"&&(t.push("Âü∫Á§é„É¨„Éô„É´‰∏çÊ≠£Ëß£Ê§úÂá∫"),t.push("ÂÑ™ÂÖàÂæ©ÁøíÂØæË±°„Å´ËøΩÂä†")),e.hasSeenBefore&&(t.push(`Êó¢Âá∫ÂçòË™û: ${e.previousAttempts+1}ÂõûÁõÆ„ÅÆ‰∏çÊ≠£Ëß£`),t.push("ÁøíÂæóÈõ£ÊòìÂ∫¶„Çπ„Ç≥„Ç¢: È´ò")),t.push("Ê¨°ÂõûÂá∫È°åÁ¢∫Áéá: 80%"),t.join(" ")}}class fX{generateCorrectComment(e){const t=[],s=["„Éä„Ç§„ÇπÔºÅ","„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","„ÇÑ„Å£„ÅüÔºÅ"];return t.push(s[Math.floor(Math.random()*s.length)]),e.attemptCount===1?t.push("‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ"):e.attemptCount===2?t.push("Á´ã„Å¶Áõ¥„Åó„Åü„Å™ÔºÅ"):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ±∫„ÇÅ„ÅüÔºÅ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèË°å„Åì„ÅÜÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÔºÅ`),t.push("„ÅäÂâç„ÅØÁÑ°Êïµ„Å†ÔºÅüî•")):e.correctStreak>=3&&t.push("Ê≥¢„Å´‰πó„Å£„Å¶„Åç„Åü„ÅûÔºÅ"),e.difficulty==="advanced"&&(t.push(`${e.word}„ÇíÂÄí„Åó„ÅüÔºÅ`),t.push("„ÅäÂâç„ÅØÂº∑„ÅÑÔºÅüí™")),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÇíÂÖãÊúçÔºÅ`),t.push("„Åì„Çå„ÅåÊàêÈï∑„Å†ÔºÅ")),e.todayQuestions>=50&&e.todayAccuracy>=80&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÇØ„É™„Ç¢ÔºÅ`),t.push("Áµ∂Â•ΩË™ø„Å†ÔºÅüèÜ")),t.push("„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ"),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÊÉú„Åó„ÅÑÔºÅ"),e.incorrectStreak<3?(t.push("„Å†„Åå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑÔºÅ"),t.push("„ÇÇ„ÅÜ‰∏Ä‰∏ÅÔºÅ")):(t.push("ÈÄ£Á∂ö„Éü„ÇπÔºÅ"),t.push("„Å†„ÅåÂãùË≤†„ÅØ„Åì„Çå„Åã„Çâ„Å†ÔºÅ")),e.difficulty==="beginner"&&(t.push("ÁÑ¶„Å£„Åü„Å™ÔºÅ"),t.push("ËêΩ„Å°ÁùÄ„ÅëÔºÅ")),e.hasSeenBefore&&(t.push(`„Åæ„Åü${e.word}„ÅãÔºÅ`),t.push("‰ªäÂ∫¶„Åì„Åù„É™„Éô„É≥„Ç∏„Å†ÔºÅüí™")),e.todayAccuracy<60?(t.push("Ë™øÂ≠ê„ÅåÊÇ™„ÅÑ„Å™ÔºÅ"),t.push("„Å†„ÅåË≤†„Åë„Çã„Å™ÔºÅ"),t.push("„Åì„Åì„Åã„ÇâÈÄÜËª¢„Å†ÔºÅüî•")):t.push("„ÅäÂâç„Å™„Çâ„Åß„Åç„ÇãÔºÅ"),t.join(" ")}}class mX{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„Åô„ÄÇ"),t.push(`${e.word}„Å®„ÅÑ„ÅÜË®ÄËëâ„Åå„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏ÄÈÉ®„Å´„Å™„Çä„Åæ„Åó„Åü`),e.attemptCount>1&&t.push("Ëø∑„ÅÑ„ÅåÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô"),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„ÄÇ`),t.push("Ë®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåÁ¢∫ÂÆü„Å´„Å™„Çä„Åæ„Åó„Åü üåô")):e.correctStreak>=3&&t.push("Áü•Ë≠ò„ÅåÊ†π„ÇíÂºµ„ÇäÂßã„ÇÅ„Å¶„ÅÑ„Åæ„Åô üå±"),e.difficulty==="advanced"&&(t.push("Èõ£„Åó„ÅÑË®ÄËëâ„ÇíÁêÜËß£„Åó„Åæ„Åó„Åü„Å≠"),t.push("Áü•ÊÅµ„ÅåÊ∑±„Åæ„Çä„Åæ„Åô")),e.isWeakCategory&&(t.push("Ëã¶Êâã„ÇíÂÖãÊúç„Åó„Åæ„Åó„Åü"),t.push("ÊàêÈï∑„Å®„ÅØÂ§âÂåñ„ÇíÂèó„ÅëÂÖ•„Çå„Çã„Åì„Å®„Åß„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÅÆÁµåÈ®ì„ÇíÁ©ç„Åø„Åæ„Åó„Åü`),t.push("‰∏ÄÊó•‰∏ÄÊó•„ÅåÊú™Êù•„Å∏„ÅÆÊäïË≥á„Åß„Åô üìñ")),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÈñìÈÅï„ÅÑ„ÅØÂ≠¶„Å≥„ÅÆÂßã„Åæ„Çä„Åß„Åô„ÄÇ"),e.attemptCount===1?t.push("ÂÜçÂ∫¶ÊåëÊà¶„Åó„Åæ„Åó„Çá„ÅÜ"):(t.push("„Åæ„Å†ÁêÜËß£„ÅÆÈÄî‰∏≠„Åß„Åô"),t.push("ÁÑ¶„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì üå±")),e.difficulty==="beginner"&&t.push("Âü∫Á§é„Å´Êàª„Çã„Åì„Å®„ÅØÊÅ•„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"),e.incorrectStreak>=3&&(t.push("ÈÄ£Á∂ö„ÅßÈñìÈÅï„Åà„Åæ„Åó„Åü"),t.push("‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åß„Åô")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØ„ÅÇ„Å™„Åü„ÅÆË™≤È°å„Åß„Åô`),t.push("‰ΩïÂ∫¶„Åß„ÇÇÂêë„ÅçÂêà„ÅÑ„Åæ„Åó„Çá„ÅÜ")),e.todayAccuracy<60&&(t.push("Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô"),t.push("„Åó„Åã„ÅóÈÅì„ÅØÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô")),t.push("Ë®òÊÜ∂„Å®„ÅØÁπ∞„ÇäËøî„Åó„ÅÆËä∏Ë°ì„Åß„Åô üìñ"),t.join(" ")}}function CI(n,e){let t;switch(n){case"drill-sergeant":t=new dX;break;case"kind-teacher":t=new hX;break;case"analyst":t=new pX;break;case"enthusiastic-coach":t=new fX;break;case"wise-sage":t=new mX;break}return e.isCorrect?t.generateCorrectComment(e):t.generateIncorrectComment(e)}const gX={"drill-sergeant":{avatar:"üëπ",name:"È¨ºËªçÊõπ",description:"Âé≥„Åó„ÅèÈçõ„Åà„Çã",tone:"Âé≥„Åó„Åè„ÄÅÂ¶•Âçî„Å™„Åó„ÄÅÁµêÊûúÈáçË¶ñ"},"kind-teacher":{avatar:"üòä",name:"ÂÑ™„Åó„ÅÑÂÖàÁîü",description:"‰∏ÅÂØß„Å´„Çµ„Éù„Éº„Éà",tone:"ÂÑ™„Åó„Åè„ÄÅ‰∏ÅÂØß„ÄÅ„Åß„ÇÇÊ≠£Á¢∫"},analyst:{avatar:"ü§ñ",name:"ÂÜ∑Èùô„Å™ÂàÜÊûêÂÆò",description:"„Éá„Éº„Çø„ÅßÂà§Êñ≠",tone:"ÊÑüÊÉÖ„Å™„Åó„ÄÅ‰∫ãÂÆü„ÅÆ„Åø„ÄÅÁµ±Ë®àÈáçË¶ñ"},"enthusiastic-coach":{avatar:"üòº",name:"ÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ",description:"ÁÜ±„ÅèÂøúÊè¥",tone:"ÁÜ±„Åè„ÄÅ„Éù„Ç∏„ÉÜ„Ç£„Éñ„ÄÅÊåëÊà¶ÁöÑ"},"wise-sage":{avatar:"üßô",name:"Ë≥¢ËÄÖ",description:"Èï∑ÊúüË¶ñÁÇπ„ÅßÂ∞é„Åè",tone:"ËêΩ„Å°ÁùÄ„Åç„ÄÅÈï∑ÊúüË¶ñÁÇπ„ÄÅÊú¨Ë≥™ÈáçË¶ñ"}};function NI(){return localStorage.getItem("lastLoginDate")}function xX(){const n=localStorage.getItem("loginStreak");return n?parseInt(n,10):0}function yX(){const n=NI();if(!n)return 0;const e=new Date().toISOString().split("T")[0],t=new Date(n),r=new Date(e).getTime()-t.getTime();return Math.floor(r/(1e3*60*60*24))}function bX(){const n=new Date().toISOString().split("T")[0],e=localStorage.getItem(`studyStats-${n}`);if(!e)return{count:0,accuracy:0};const t=JSON.parse(e);return{count:t.count||0,accuracy:t.correct&&t.count?t.correct/t.count*100:0}}function wX(n){const e=N0(),t=yX(),s=xX(),{count:r,accuracy:o}=bX(),i={lastLoginDate:NI(),todayStudyCount:r,todayAccuracy:o};return t>=3?vX(n,t):s>=7&&r===0?SX(n,s):CX(n,e,i)}function vX(n,e){switch(n){case"drill-sergeant":return e>=7?`${e}Êó•„ÇÇÁ©∫„Åë„Çã„Å®„ÅØ‰Ωï‰∫ã„Å†ÔºÅ‰ªä„Åô„ÅêÂæ©Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ`:`${e}Êó•„Å∂„Çä„Åã„ÄÇÈÅÖ„Çå„ÇíÂèñ„ÇäÊàª„Åô„ÅûÔºÅ`;case"kind-teacher":return e>=7?`üòÉ „Åä‰πÖ„Åó„Å∂„Çä„Åß„ÅôÔºÅ${e}Êó•Áµå„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÁÑ¶„Çâ„ÅöÂ∞ë„Åó„Åö„Å§ÊÄù„ÅÑÂá∫„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`:`üòÉ ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ„ÇÜ„Å£„Åè„ÇäÂæ©Áøí„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`;case"analyst":return e>=7?`ü§ñ ÂâçÂõû„Åã„Çâ${e}Êó•ÁµåÈÅé„ÄÇË®òÊÜ∂ÂÆöÁùÄÁéá„ÅØÊé®ÂÆö40-60%„ÄÇ‰ΩìÁ≥ªÁöÑ„Å™Âæ©Áøí„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`:`ü§ñ ${e}Êó•„ÅÆÈñìÈöî„ÄÇÂøòÂç¥Êõ≤Á∑ö„ÇíËÄÉÊÖÆ„Åó„ÅüÂæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;case"enthusiastic-coach":return e>=7?`üòº ${e}Êó•„Å∂„Çä„ÅÆ„Ç´„É†„Éê„ÉÉ„ÇØÔºÅ‰ªäÊó•„Åã„ÇâÂÜç„Çπ„Çø„Éº„Éà„Å†ÔºÅÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ`:`üòº ÂæÖ„Å£„Å¶„Åü„ÅúÔºÅ${e}Êó•„ÅÆÈÅÖ„Çå„ÅØ‰ªäÊó•Âèñ„ÇäÊàª„Åù„ÅÜÔºÅ`;case"wise-sage":return e>=7?`üßô ${e}Êó•„ÅÆ‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ`:`üßô ${e}Êó•„ÅÆÁ©∫ÁôΩ„ÇÇ„ÄÅ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅÆÊôÇÈñì„Å†„Å£„Åü„ÅÆ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ„Åï„ÅÇ„ÄÅ„ÇÜ„Å£„Åè„ÇäÂÜçÈñã„Åò„ÇÉ„ÄÇ`;default:return`„ÅäÂ∏∞„Çä„Å™„Åï„ÅÑÔºÅ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ`}}function SX(n,e){switch(n){case"drill-sergeant":return`${e}Êó•ÈÄ£Á∂öÔºÅÁ¥†Êô¥„Çâ„Åó„ÅÑÁ∂ôÁ∂öÂäõ„Å†ÔºÅ‰ªäÊó•„ÇÇÊ≤πÊñ≠„Åô„Çã„Å™ÔºÅ`;case"kind-teacher":return`üòÉ ${e}Êó•ÈÄ£Á∂ö„É≠„Ç∞„Ç§„É≥„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„Çä„Åß„Åô„ÄÇ`;case"analyst":return`ü§ñ ${e}Êó•ÈÄ£Á∂ö„ÄÇÁ∂ôÁ∂öÁéá100%„ÄÇÁµ±Ë®àÁöÑ„Å´Â≠¶ÁøíÂäπÊûú„ÅØÊúÄÂ§ßÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;case"enthusiastic-coach":return`üòº ${e}Êó•ÈÄ£Á∂öÈÅîÊàêÔºÅ„Åì„ÅÆÂã¢„ÅÑ„ÅßÁ™Å„ÅçÈÄ≤„ÇÅÔºÅË®òÈå≤Êõ¥Êñ∞„Å†ÔºÅ`;case"wise-sage":return`üßô ${e}Êó•„ÅÆÁ∂ôÁ∂ö„ÄÅË¶ã‰∫ã„Åò„ÇÉ„ÄÇÂçÉÈáå„ÅÆÈÅì„ÇÇ‰∏ÄÊ≠©„Åã„Çâ„ÄÅ„Åò„ÇÉ„Å™„ÄÇ`;default:return""}}function CX(n,e,t){const{todayStudyCount:s,todayAccuracy:r}=t;switch(n){case"drill-sergeant":return NX(e,s);case"kind-teacher":return IX(e,s);case"analyst":return kX(e,s,r);case"enthusiastic-coach":return $X(e,s);case"wise-sage":return TX(e,s);default:return null}}function NX(n,e,t){switch(n){case"morning":return e===0?"Êúù„Å†„ÅûÔºÅËÑ≥„Åå‰∏ÄÁï™ÂÜ¥„Åà„Å¶„ÇãÊôÇÈñì„Å†ÔºÅ‰ªä„Åô„ÅêÂ≠¶Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ":e>=20?"Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÇíÁ∂≠ÊåÅ„Åó„ÇçÔºÅ":"Êúù„ÅÆÂ≠¶Áøí„ÅØÂäπÊûúÁöÑ„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÑ„Çå„Çã„ÅØ„Åö„Å†ÔºÅ";case"afternoon":return e===0?"ÂçàÂæå„Å´„Å™„Å£„Åü„ÅûÔºÅ‰ªäÊó•„ÅØ„Åæ„Å†‰Ωï„ÇÇ„ÇÑ„Å£„Å¶„Å™„ÅÑ„ÅÆ„ÅãÔºü„Åï„Å£„Åï„Å®Âßã„ÇÅ„ÇçÔºÅ":e>=20?"ÂçàÂæå„ÇÇÈ†ÜË™ø„Å†„Å™ÔºÅÂçàÂâç‰∏≠„ÅÆÂã¢„ÅÑ„ÇíËêΩ„Å®„Åô„Å™ÔºÅ":"ÂçàÂæå„ÅØÈõÜ‰∏≠Âäõ„ÅåËêΩ„Å°„ÇÑ„Åô„ÅÑ„ÄÇÊ∞óÂêà„ÇíÂÖ•„ÇåÁõ¥„ÅõÔºÅ";case"evening":return e===0?"„ÇÇ„ÅÜÂ§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÂàÜ„ÅØ‰ªäÊó•‰∏≠„Å´ÁµÇ„Çè„Çâ„Åõ„ÇçÔºÅ":e>=30?"‰ªäÊó•„ÅØ„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅ„ÅÇ„Å®Â∞ë„Åó„ÅßÂÆåÁíß„Å†ÔºÅ":"Â§ïÊñπ„ÅØÂæ©Áøí„ÅÆ„Ç¥„Éº„É´„Éá„É≥„Çø„Ç§„É†„Å†ÔºÅËøΩ„ÅÑËæº„Åø„Çí„Åã„Åë„ÇçÔºÅ";case"night":return e===0?"Â§ú„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„Åü„ÅûÔºÅÂ∞ë„Åó„Åß„ÇÇ„ÅÑ„ÅÑ„Åã„ÇâÂ≠¶Áøí„Åó„ÇçÔºÅ0„Çà„Çä1„Å†ÔºÅ":e>=30?"Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅÊó©„Åè‰ºë„Çì„ÅßÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ":"Â§ú„ÅØËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåÂäπÊûúÁöÑ„Å†ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™ÔºÅ";default:return"„Åï„ÅÇ„ÄÅÂ≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„ÅûÔºÅ"}}function IX(n,e,t){switch(n){case"morning":return e===0?"üòÉ „Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅÊúù„ÅØË®òÊÜ∂Âäõ„ÅåÈ´ò„Åæ„ÇãÊôÇÈñì„Åß„Åô„Çà„ÄÇ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ":e>=20?"üòÉ Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Åß„ÇÇÁÑ°ÁêÜ„ÅØ„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åß„Åô„Å≠ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"afternoon":return e===0?"üòÉ „Åì„Çì„Å´„Å°„ÅØÔºÅÂçàÂæå„ÅØÂ∞ë„ÅóÁú†„Åè„Å™„Çä„ÇÑ„Åô„ÅÑ„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„Çà„ÄÇ":e>=20?"üòÉ ÂçàÂæå„ÇÇ„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅ‰ºëÊÜ©„ÇÇÂøò„Çå„Åö„Å´Âèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ ÂçàÂæå„ÇÇÈ†ÜË™ø„Åß„Åô„Å≠„ÄÇ„Éû„Ç§„Éö„Éº„Çπ„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ";case"evening":return e===0?"üòÉ „Åì„Çì„Å∞„Çì„ÅØ„ÄÇÂ§ïÊñπ„ÅØÂæ©Áøí„Å´ÊúÄÈÅ©„Å™ÊôÇÈñì„Åß„Åô„ÄÇ‰ªäÊó•Â≠¶„Çì„Å†„Åì„Å®„ÇíËªΩ„ÅèË¶ãÁõ¥„Åó„Å¶„Åø„Åæ„Åõ„Çì„ÅãÔºü":e>=30?"üòÉ ‰ªäÊó•„ÅØÊú¨ÂΩì„Å´„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠ÔºÅ„ÇÇ„ÅÜÂçÅÂàÜ„Åß„Åô„Çà„ÄÇ":"üòÉ Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑ„Åß„Åô„Å≠ÔºÅÁÑ¶„Çâ„Åö„ÇÜ„Å£„Åè„ÇäÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"night":return e===0?"üòÉ Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßò„Åß„Åô„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅ„Åß„Åç„ÇãÁØÑÂõ≤„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ":e>=30?"üòÉ ‰ªäÊó•„ÅØÂçÅÂàÜÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅ„Åù„Çç„Åù„Çç‰ºë„Çì„Åß„ÄÅÊòéÊó•„Å´ÂÇô„Åà„Åæ„Åó„Çá„ÅÜ„Å≠„ÄÇ":"üòÉ Â§ú„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åß„Åô„Åå„ÄÅÁù°Áú†„ÇÇÂêå„Åò„Åè„Çâ„ÅÑÂ§ßÂàá„Åß„Åô„Çà„ÄÇ";default:return"üòÉ ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Å≠ÔºÅ"}}function kX(n,e,t){switch(n){case"morning":return e===0?"ü§ñ ÁèæÂú®ÊôÇÂàªÔºöÊúù„ÄÇËÑ≥„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÔºöÊúÄÈÅ©„ÄÇÊñ∞Ë¶èÂ≠¶ÁøíÂäπÁéáÔºö+30%„ÄÇÂ≠¶ÁøíÈñãÂßã„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êúù„ÅÆÂ≠¶Áøí${e}ÂïèÂÆå‰∫Ü„ÄÇÊ≠£Á≠îÁéá${t.toFixed(1)}%„ÄÇËâØÂ•Ω„Å™„Éö„Éº„Çπ„ÄÇ`:"ü§ñ Êúù„ÅÆÂ≠¶ÁøíÈÄ≤Ë°å‰∏≠„ÄÇË™çÁü•Ê©üËÉΩ„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÇíÊ¥ªÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";case"afternoon":return e===0?"ü§ñ ÂçàÂæå„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÈõÜ‰∏≠ÂäõÔºö„ÇÑ„ÇÑ‰Ωé‰∏ãÂÇæÂêë„ÄÇÁü≠ÊôÇÈñìÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êú¨Êó•${e}ÂïèÂ≠¶ÁøíÊ∏à„Åø„ÄÇÂçàÂæå„ÅÆÁîüÁî£ÊÄßÔºöÁ∂≠ÊåÅ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`:"ü§ñ ÂçàÂæå„ÅÆÂ≠¶ÁøíÁ∂ôÁ∂ö‰∏≠„ÄÇ15ÂàÜ√ó3„Çª„ÉÉ„Éà„ÅÆÂàÜÂâ≤Â≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";case"evening":return e===0?"ü§ñ Â§ïÊñπ„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÂæ©ÁøíÂäπÁéáÔºöÊúÄÈ´ò„É¨„Éô„É´„ÄÇ‰ªäÊó•„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÆöÁùÄ„Å´ÊúÄÈÅ©„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÈÅîÊàê„ÄÇÂçÅÂàÜ„Å™Â≠¶ÁøíÈáè„Åß„Åô„ÄÇ‰ºëÊÅØ„ÇíÊé®Â•®„ÄÇ`:"ü§ñ Â§ïÊñπ„ÅÆÂæ©Áøí„Çø„Ç§„É†„ÄÇÊúù„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÜçÁ¢∫Ë™ç„ÅåË®òÊÜ∂ÂÆöÁùÄÁéá„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ";case"night":return e===0?"ü§ñ Â§úÈñì„ÄÇÊñ∞Ë¶èÂ≠¶Áøí„Çà„ÇäÂæ©Áøí„ÇíÊé®Â•®„ÄÇÁù°Áú†Ââç„ÅÆËªΩ„ÅÑÂæ©Áøí„ÅØË®òÊÜ∂„ÅÆÂõ∫ÂÆöÂåñ„Å´ÊúâÂäπ„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÂÆå‰∫Ü„ÄÇÂ≠¶ÁøíÁõÆÊ®ôÈÅîÊàê„ÄÇ22-23ÊôÇ„ÅÆÂ∞±ÂØù„ÅßË®òÊÜ∂ÂÆöÁùÄÁéá„ÅåÂêë‰∏ä„Åó„Åæ„Åô„ÄÇ`:"ü§ñ Â§úÈñìÂ≠¶Áøí‰∏≠„ÄÇÈÅéÂ∫¶„Å™Â≠¶Áøí„ÅØÁù°Áú†„ÅÆË≥™„Çí‰Ωé‰∏ã„Åï„Åõ„Åæ„Åô„ÄÇÈÅ©Â∫¶„Å™Â≠¶Áøí„ÇíÊé®Â•®„ÄÇ";default:return"ü§ñ Â≠¶Áøí„Éá„Éº„Çø„ÇíË®òÈå≤‰∏≠„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Â≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ"}}function $X(n,e,t){switch(n){case"morning":return e===0?"üòº Êúù„Å†ÔºÅÊñ∞„Åó„ÅÑ‰∏ÄÊó•„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ‰ªäÊó•„ÇÇÊúÄÈ´ò„ÅÆÂ≠¶Áøí„Çí„Åó„Çà„ÅÜÔºÅ":e>=20?"üòº Êúù„Åã„ÇâÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ„Åì„ÅÆÂã¢„ÅÑ„Åß‰ªäÊó•„ÇÇÂÆåÁíß„Å´„ÇÑ„ÇäÈÅÇ„Åí„Çà„ÅÜÔºÅ":"üòº Êúù„ÅÆÂ≠¶Áøí„ÄÅÊúÄÈ´ò„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ";case"afternoon":return e===0?"üòº ÂçàÂæå„ÇÇÂÖÉÊ∞óÂá∫„Åó„Å¶„ÅÑ„Åì„ÅÜÔºÅ‰ªä„Åã„Çâ„Åß„ÇÇÈÅÖ„Åè„Å™„ÅÑ„ÅûÔºÅÂÖ®Âäõ„ÅßË°å„ÅëÔºÅ":e>=20?"üòº ÂçàÂæå„ÇÇÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ":"üòº ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÊ∞óÂêàÂçÅÂàÜ„Å†„Å™ÔºÅ„Åì„ÅÆË™øÂ≠ê„Åì„ÅÆË™øÂ≠êÔºÅ";case"evening":return e===0?"üòº Â§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÁõÆÊ®ô„ÅØ„Åæ„Å†ÈÅîÊàê„Åó„Å¶„Å™„ÅÑ„Å†„ÇçÔºü„Åï„ÅÇ„ÄÅ„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº ‰ªäÊó•„ÅØÂÆåÁíß„Å†ÔºÅ„ÅäÂâç„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅË™á„Çä„Å´ÊÄù„ÅàÔºÅ":"üòº Â§ïÊñπ„ÅÆËøΩ„ÅÑËæº„Åø„ÄÅËâØ„ÅÑ„ÅûÔºÅ„É©„Çπ„Éà„Çπ„Éë„Éº„Éà„Å†ÔºÅ";case"night":return e===0?"üòº Â§ú„Å†„Åë„Å©Ë´¶„ÇÅ„Çã„Å™ÔºÅ„Åü„Å£„Åü10ÂàÜ„Åß„ÇÇ„ÅÑ„ÅÑ„ÄÅ‰ªäÊó•„ÅÆÂàÜ„Çí„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßòÔºÅ‰ªäÊó•„ÅÆ„ÅäÂâç„ÅØÊúÄÈ´ò„Å†„Å£„ÅüÔºÅ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÅÔºÅ":"üòº Â§ú„ÅÆÂ≠¶Áøí„ÇÇÈ†ëÂºµ„Å£„Å¶„Çã„Å™ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™„Çà„ÄÅ„Åß„ÇÇÈ†ëÂºµ„ÇåÔºÅ";default:return"üòº „Åï„ÅÇ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ"}}function TX(n,e,t){switch(n){case"morning":return e===0?"üßô Êúù„ÅÆÈùô„Åë„Åï„ÅØÂ≠¶„Å≥„Å´ÊúÄÈÅ©„Åò„ÇÉ„ÄÇÂøÉ„ÇíËêΩ„Å°ÁùÄ„Åë„Å¶„ÄÅ„ÇÜ„Å£„Åè„ÇäÂßã„ÇÅ„Çã„Åå„Çà„ÅÑ„ÄÇ":e>=20?"üßô Êúù„Åã„ÇâËâØ„ÅÑ„Éö„Éº„Çπ„Åò„ÇÉ„ÅÆ„ÅÜ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ":"üßô Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åò„ÇÉ„Å™„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅËá™ÂàÜ„ÅÆ„Éö„Éº„Çπ„ÅßÈÄ≤„ÇÄ„ÅÆ„Åò„ÇÉ„ÄÇ";case"afternoon":return e===0?"üßô ÂçàÂæå„ÅØÂ∞ë„Åó‰ºë„Çì„Åß„Åã„ÇâÂßã„ÇÅ„Çã„ÅÆ„ÇÇËâØ„ÅÑ„Åû„ÄÇÁÑ¶„ÇãÂøÖË¶Å„ÅØ„Å™„ÅÑ„ÄÇ":e>=20?"üßô ÂçàÂæå„ÇÇÁùÄÂÆü„Å´ÈÄ≤„Çì„Åß„Åä„Çã„ÅÆ„ÅÜ„ÄÇÁ∂ôÁ∂ö„Åì„Åù„ÅåÂäõ„Åò„ÇÉ„ÄÇ":"üßô ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åå„ÄÅ‰ºëÊÅØ„ÇÇÂøò„Çå„Å¨„Çà„ÅÜ„Å´„Å™„ÄÇ";case"evening":return e===0?"üßô Â§ïÊöÆ„ÇåÊôÇ„ÅØ‰∏ÄÊó•„ÇíÊåØ„ÇäËøî„ÇãÊôÇÈñì„Åò„ÇÉ„ÄÇÂ≠¶„Å≥„ÇÇÂêå„Åò„Åè„ÄÅÂæ©Áøí„ÅåÂ§ßÂàá„Åò„ÇÉ„Åû„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅØ„Çà„ÅèÂä±„Çì„Å†„ÅÆ„ÅÜ„ÄÇÂ≠¶„Å≥„ÅØÈáè„Çà„ÇäË≥™„Åò„ÇÉ„ÄÇÂçÅÂàÜ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ":"üßô Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑÁøíÊÖ£„Åò„ÇÉ„ÄÇÊÄ•„Åå„Åö„ÄÅÁ¢∫ÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ";case"night":return e===0?"üßô Â§ú„ÅØÂøÉÁ©è„ÇÑ„Åã„Å´ÈÅé„Åî„Åô„ÅåËâØ„ÅÑ„ÄÇËªΩ„ÅÑÂæ©Áøí„Å†„Åë„Åß„ÇÇÂçÅÂàÜ„Åò„ÇÉ„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅÆÂ≠¶„Å≥„ÅØÂçÅÂàÜ„Åò„ÇÉ„ÄÇËâØ„ÅçÁù°Áú†„ÅåÊòéÊó•„Å∏„ÅÆÂäõ„Å®„Å™„Çã„ÄÇ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÄ„Åå„Çà„ÅÑ„ÄÇ":"üßô Â§úÊõ¥„Åã„Åó„ÅØ„Åª„Å©„Åª„Å©„Å´„Å™„ÄÇÁù°Áú†„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„Åû„ÄÇ";default:return"üßô Â≠¶„Å≥„Å®„ÅØÈï∑„ÅÑÊóÖ„Åò„ÇÉ„ÄÇ‰∏ÄÊ≠©„Åö„Å§„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ"}}function AX(n,e,t){if(Math.random()>.1)return null;const s=EX(n,e,t);return s.length===0?null:s[Math.floor(Math.random()*s.length)]}function EX(n,e,t){const s=[];n==="drill-sergeant"&&(e&&t>=5&&(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå„Çà„ÅóÔºÅ„Åù„ÅÆË™øÂ≠ê„Å†ÔºÅ„Äç üòÉ„Äå„Å°„Çá„ÄÅ„Å°„Çá„Å£„Å®Ë§í„ÇÅ„Åô„Åé„Åß„ÅØ...„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅËâØ„ÅÑ„ÇÇ„ÅÆ„ÅØËâØ„ÅÑ„Çì„Å†ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"wise-sage",message:"üòà„ÄåÂÆåÁíß„Å†ÔºÅ„Äç üßô„Äå„Åµ„ÇÄ„ÄÅÈ¨ºËªçÊõπÊÆø„ÇÇÂ¨â„Åó„Åù„ÅÜ„Åò„ÇÉ„ÅÆ„ÅÜ„Äç üòà„Äå„Åπ„ÄÅÂà•„Å´...„Äç",type:"banter"})),e||(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå‰ΩïÂ∫¶Âêå„ÅòÈñìÈÅï„ÅÑ„Çí...ÔºÅ„Äç üòÉ„Äå„Åæ„ÅÇ„Åæ„ÅÇ„ÄÅËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÇË™∞„Å´„Åß„ÇÇËã¶Êâã„ÅØ„ÅÇ„Çä„Åæ„Åô„Åã„Çâ„Äç üòà„ÄåÁîò„ÇÑ„Åã„Åô„Å™ÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"analyst",message:"üòà„Äå„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´„ÅØË®±ÂÆπÁØÑÂõ≤ÂÜÖ„ÅÆ„Éü„Çπ„Åß„Åô„Äç üòà„Äå„Éá„Éº„Çø„Åò„ÇÉ„Å™„ÅÑ„ÄÅÊ∞óÊåÅ„Å°„ÅÆÂïèÈ°å„Å†ÔºÅ„Äç",type:"argument"})),s.push({mainTeacher:"drill-sergeant",otherTeacher:"enthusiastic-coach",message:"üòºÔºàÈÄö„Çä„Åô„Åå„ÇäÔºâ„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„ÅÆÁâπË®ì„ÅãÔºÅÈ†ëÂºµ„Çå„ÇàÔºÅ„Äç üòà„Äå...‰ΩôË®à„Å™Âè£Âá∫„Åó„Åô„Çã„Å™„Äç",type:"passerby"})),n==="kind-teacher"&&(e&&(s.push({mainTeacher:"kind-teacher",otherTeacher:"drill-sergeant",message:"üòÉ„ÄåÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå„Åæ„Å†„Åæ„Å†Ê≤πÊñ≠„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå...ËÅû„Åì„Åà„Å¶„Åæ„ÅôÔºü„Äç",type:"passerby"}),s.push({mainTeacher:"kind-teacher",otherTeacher:"wise-sage",message:"üòÉ„Äå„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ„Äç üßô„Äå„ÅÜ„ÇÄ„ÄÅÁùÄÂÆü„Å™ÊàêÈï∑„Åò„ÇÉ„Äç üòÉ„ÄåË≥¢ËÄÖÂÖàÁîü„ÇÇ„Åù„ÅÜÊÄù„Çè„Çå„Åæ„Åô„Çà„Å≠„Äç",type:"support"})),e||s.push({mainTeacher:"kind-teacher",otherTeacher:"enthusiastic-coach",message:"üòÉ„ÄåÂ§ß‰∏àÂ§´„ÄÅÊ¨°„ÅØÂøÖ„Åö„Åß„Åç„Åæ„Åô„Çà„Äç üòº„Äå„Åù„ÅÜ„Åù„ÅÜÔºÅÂ§±Êïó„ÅØÊàêÂäü„ÅÆÊØç„Å†ÔºÅ„Äç üòÉ„ÄåÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ„ÇÇÂøúÊè¥„Åó„Å¶„Åæ„Åô„Çà„Äç",type:"support"}),s.push({mainTeacher:"kind-teacher",message:"üòÉ„Äå„ÅÇ„ÄÅ„ÅäËå∂„ÇíÂÖ•„ÇåÂøò„Çå„Å¶...„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå‰ªï‰∫ã‰∏≠„Å´‰Ωï„Åó„Å¶„ÇãÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„ÇìÔºÅ„Äç",type:"joke"})),n==="analyst"&&(t>=10&&s.push({mainTeacher:"analyst",otherTeacher:"enthusiastic-coach",message:"ü§ñ„Äå10ÈÄ£Á∂öÊ≠£Ëß£„ÄÇÁµ±Ë®àÁöÑ„Å´ÊúâÊÑè„Åß„Åô„Äç üòº„Äå„Åô„Åí„ÉºÔºÅÊúÄÈ´ò„Å†ÔºÅ„Äç ü§ñ„Äå...ÊÑüÊÉÖË°®Áèæ„ÅØ‰∏çË¶Å„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",otherTeacher:"drill-sergeant",message:"ü§ñ„Äå„Éá„Éº„Çø„Å´Âü∫„Å•„Åè„Å®...„Äç üòà„ÄåÁêÜÂ±à„ÅØ„ÅÑ„ÅÑÔºÅÊ∞óÂêà„Å†ÔºÅ„Äç ü§ñ„ÄåÈùûÁßëÂ≠¶ÁöÑ„Åß„Åô„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"analyst",otherTeacher:"kind-teacher",message:"ü§ñ„ÄåÊ≠£Á≠îÁéá73.4%„Äç üòÉ„Äå„ÅÇ„ÅÆ...„ÇÇ„ÅÜÂ∞ë„ÅóÂÑ™„Åó„Åè‰ºù„Åà„Çâ„Çå„Åæ„Åõ„Çì„ÅãÔºü„Äç ü§ñ„Äå‰∫ãÂÆü„ÇíËø∞„Åπ„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",message:"ü§ñ„Äå...„Ç≥„Éº„Éí„Éº„ÅÆ„Ç´„Éï„Çß„Ç§„É≥Âê´ÊúâÈáè„ÅØ...„Äç üòÉ„ÄåÂàÜÊûêÂÆòÂÖàÁîü„ÄÅ‰ªä„ÅØÊéàÊ•≠‰∏≠„Åß„Åô„Çà„Äç ü§ñ„ÄåÂ§±Á§º„Åó„Åæ„Åó„Åü„Äç",type:"joke"})),n==="enthusiastic-coach"&&(e&&t>=5&&(s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"wise-sage",message:"üòº„ÄåÊúÄ„Å£È´ò„Å†„ÅÅ„ÅÅÔºÅÔºÅ„Äç üßô„Äå...Â∞ë„ÅóÂ£∞„ÅåÂ§ß„Åç„ÅÑ„Åã„ÅÆ„ÅÜ„Äç üòº„Äå„ÅÜ„Çã„Åï„Åè„Å¶ÊÇ™„Åã„Å£„Åü„Å™ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"drill-sergeant",message:"üòº„Äå„Çà„Å£„Åó„ÇÉ„ÉºÔºÅ„Äç üòà„ÄåÈ®í„Åå„Åó„ÅÑ...„Å†„Åå„ÄÅÊÇ™„Åè„Å™„ÅÑ„Å™„Äç üòº„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„Å´Ë§í„ÇÅ„Çâ„Çå„ÅüÔºÅ„Äç",type:"support"})),e||s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"kind-teacher",message:"üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅÊ¨°„Å†Ê¨°ÔºÅ„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÁÑ¶„Çâ„Åö„Å´„Äç üòº„Äå‰∫å‰∫∫„ÅßÂøúÊè¥„Åó„Å¶„Çã„ÅûÔºÅ„Äç",type:"support"}),s.push({mainTeacher:"enthusiastic-coach",message:"üòº„Äå‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨„ÅØ...„Äç ü§ñ„Äå„Åù„Çå„ÅØËã±Ë™ûÂ≠¶Áøí„Å®ÁÑ°Èñ¢‰øÇ„Åß„Åô„Äç üòº„Äå‰Ωì„ÅåË≥áÊú¨„Å†„ÇçÔºÅÔºü„Äç",type:"joke"})),n==="wise-sage"&&(e&&s.push({mainTeacher:"wise-sage",otherTeacher:"drill-sergeant",message:"üßô„ÄåËâØ„ÅçÊàêÈï∑„Åò„ÇÉ„Äç üòà„ÄåÂΩì„Åü„ÇäÂâç„Å†„ÄÅ‰ø∫„ÅÆÊïô„ÅàÂ≠ê„Å†„Åã„Çâ„Å™„Äç üßô„Äå...„Åä‰∏ª„ÇÇÊïô„Åà„Å¶„Åä„Å£„Åü„ÅÆ„ÅãÔºü„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",otherTeacher:"analyst",message:"üßô„ÄåÊôÇ„Å´„ÅØÊÑüË¶ö„ÇÇÂ§ß‰∫ã„Åò„ÇÉ„Åû„Äç ü§ñ„ÄåÊÑüË¶ö„ÅØÊ∏¨ÂÆö‰∏çÂèØËÉΩ„Åß„Åô„Äç üßô„Äå...Ëã•„ÅÑ„ÅÆ„ÅÜ„Äç",type:"argument"}),s.push({mainTeacher:"wise-sage",otherTeacher:"enthusiastic-coach",message:"üßô„ÄåÁÑ¶„Çâ„Åö„ÄÅ„Åò„Å£„Åè„Çä„Å®...„Äç üòº„Äå„Åü„Åæ„Å´„ÅØÂÖ®ÂäõÁñæËµ∞„ÇÇÂ§ß‰∫ã„Å£„Åô„ÇàÔºÅ„Äç üßô„Äå...„Åù„Çå„ÇÇ‰∏ÄÁêÜ„ÅÇ„Çã„Åã„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",message:"üßô„ÄåÊòî„ÅØ„ÅÆ„ÅÜ...„Äç üòÉüòàüòºü§ñ„Äå„Äå„Äå„Äå„Åæ„ÅüÊòîË©±ÔºÅÔºü„Äç„Äç„Äç„Äç üßô„Äå...ÊúÄËøë„ÅÆËã•ËÄÖ„ÅØ„Äç",type:"joke"}));const r=[{mainTeacher:n,message:"üòÉ„Äå„ÅäÊòº„ÅØ‰ΩïÈ£ü„Åπ„Åæ„ÅôÔºü„Äç üòà„ÄåÊôÇÈñì„ÅÆÁÑ°ÈßÑ„Å†„Äç üòº„Äå‰ø∫„ÅØ„Ç´„ÉÑ‰∏ºÔºÅ„Äç ü§ñ„ÄåÊ†ÑÈ§ä„Éê„É©„É≥„Çπ„ÇíËÄÉÊÖÆ„Åô„Åπ„Åç„Åß„Åô„Äç üßô„Äå...„Çè„Åó„ÅØËïéÈ∫¶„Åå„ÅÑ„ÅÑ„ÅÆ„ÅÜ„Äç",type:"joke"},{mainTeacher:n,message:"üòà„Äå...Ë™∞„Å†„ÄÅËÅ∑Âì°ÂÆ§„Åß„Ç≥„Éº„Éí„Éº„Åì„Åº„Åó„Åü„ÅÆ„ÅØÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„Çì...„Äç üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅ„Äç ü§ñ„ÄåÊ∏ÖÊéÉÊñπÊ≥ï„ÇíÊèêÁ§∫„Åó„Åæ„Åô„Äç",type:"joke"},{mainTeacher:n,message:"üßô„Äå...Âç∞Âà∑Ê©ü„ÅåÂãï„Åã„Çì„ÅÆ„Åò„ÇÉ„Åå„Äç ü§ñ„ÄåITÊãÖÂΩì„ÇíÂëº„Å≥„Åæ„Åô„Äç üòÉ„ÄåÁßÅ„ÅåË¶ã„Å¶„Åø„Åæ„Åô„Å≠„Äç üòà„Äå„Åï„Å£„Åï„Å®Áõ¥„ÅõÔºÅ„Äç üòº„Äå„Åø„Çì„Å™„ÅßÂçîÂäõ„Å†ÔºÅ„Äç",type:"joke"},{mainTeacher:n,message:"üòº„Äå‰ªäÊó•„ÅÆÊéàÊ•≠„Å©„ÅÜ„Å†„Å£„ÅüÔºü„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Å£„Å¶„Åæ„Åó„Åü„Çà„Äç üòà„Äå„Åæ„Å†„Åæ„Å†„Å†„Äç ü§ñ„Äå„Éá„Éº„Çø„ÅßË¶ã„Çã„Å®ÊîπÂñÑÂÇæÂêë„Åß„Åô„Äç üßô„Äå„Åù„Çå„Åû„Çå„ÅÆÊàêÈï∑„Åå„ÅÇ„Çã„ÅÆ„ÅÜ„Äç",type:"banter"}];return Math.random()<.05&&s.push(...r),s}function RX(){const n=new Date().getHours();if(Math.random()>.05)return null;if(n>=6&&n<9){const e=["üòÉ„Äå„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç üòà„ÄåÊúù„Åã„ÇâÂÖÉÊ∞ó„Å†„Å™„Äç üòº„Äå„Çà„Å£„Åó„ÇÉ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„Å†ÔºÅ„Äç","üßô„Äå„ÅÜ„ÇÄ„ÄÅËâØ„ÅÑÊúù„Åò„ÇÉ„ÅÆ„ÅÜ„Äç ü§ñ„ÄåÊ∞óÊ∏©18Â∫¶„ÄÅÂ≠¶Áøí„Å´ÊúÄÈÅ©„Åß„Åô„Äç üòÉ„ÄåÂ§©Ê∞ó„ÇÇËâØ„ÅÑ„Åß„Åô„Å≠„Äç","üòà„ÄåÈÅÖÂàª„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå„Åæ„ÄÅ„Åæ„Å†ÈñãÂßã10ÂàÜÂâç„Åß„Åô„Çà...„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=12&&n<13){const e=["üòº„ÄåËÖπÊ∏õ„Å£„Åü„ÄúÔºÅ„Äç üòÉ„Äå„ÅäÂºÅÂΩìË≤∑„Å£„Å¶„Åç„Åæ„Åó„Åü„Çà„Äç üòà„ÄåÊòº‰ºë„Åø„ÅØ30ÂàÜ„Å†„Åû„Äç","üßô„Äå‰ªäÊó•„ÅÆÂÆöÈ£ü„ÅØ‰Ωï„Åã„ÅÆ„ÅÜ„Äç ü§ñ„Äå„Ç´„É≠„É™„ÉºË®àÁÆó„ÅåÂøÖË¶Å„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™„ÅßÈ£ü„Åπ„Åæ„Åó„Çá„ÅÜ„Äç","üòà„ÄåÈ£üÂæå„ÅØ‰ºë„ÇÄ„Å™ÔºÅ„Äç üòÉ„ÄåÊ∂àÂåñ„Å´ÊÇ™„ÅÑ„Åß„Åô„Çà...„Äç üòº„ÄåÂ∞ë„Åó„ÅØ‰ºë„ÇÇ„ÅÜ„ÅúÔºÅ„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=17&&n<19){const e=["üòÉ„Äå‰ªäÊó•„ÇÇ„ÅäÁñ≤„ÇåÊßò„Åß„Åó„Åü„Äç üòà„Äå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑ„Äç üòº„Äå„ÅÑ„ÇÑ„ÄÅÂçÅÂàÜÈ†ëÂºµ„Å£„Åü„Å£„Å¶ÔºÅ„Äç","üßô„ÄåÊó•„ÅåÊöÆ„Çå„Å¶„Åç„Åü„ÅÆ„ÅÜ„Äç ü§ñ„Äå17ÊôÇ32ÂàÜ„ÄÅÂÆöÂàª„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠„Äç","üòº„Äå‰ªäÊó•„ÅÆÂèçÁúÅ‰ºö„Åô„ÇãÔºü„Äç üòÉ„Äå„ÅÑ„ÅÑ„Åß„Åô„Å≠„Äç üòà„ÄåÁÑ°ÈßÑË©±„ÅØ„Åô„Çã„Å™„Äç üßô„Äå„Åù„Çå„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åû„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=22){const e=["üòÉ„Äå„ÇÇ„ÅÜÈÅÖ„ÅÑ„Åß„Åô„Å≠...„Äç üòà„ÄåÂ∏∞„ÇåÔºÅÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ„Äç üßô„ÄåÁÑ°ÁêÜ„ÅØ„ÅÑ„Åã„Çì„Åû„Äç","ü§ñ„Äå22ÊôÇ„ÇíË∂ÖÈÅé„ÄÇÁù°Áú†ÊôÇÈñìÁ¢∫‰øù„ÇíÊé®Â•®„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÂ∏∞„Çä„Åæ„Åó„Çá„ÅÜ„Äç","üòº„ÄåÂ§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÔºÅ„Äç üòÉ„ÄåÊòéÊó•„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„Äå...Êó©„ÅèÂØù„Çç„Äç"];return e[Math.floor(Math.random()*e.length)]}return null}function DX(n){return n===10?"üòº„Äå10ÈÄ£Á∂öÔºÅÔºÅ„Äç üòà„Äå„Çà„ÅóÔºÅ„Äç üòÉ„Äå„Åô„Åî„ÅÑÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´ÂÑ™ÁßÄ„Äç üßô„ÄåË¶ã‰∫ã„Åò„ÇÉ„Äç":n===20?"üòà„Äå20ÈÄ£Á∂ö„Å†„Å®...ÔºÅÔºü„Äç üòÉ„Äå‰ø°„Åò„Çâ„Çå„Åæ„Åõ„ÇìÔºÅ„Äç üòº„ÄåÊúÄ„Å£È´ò„Å†ÔºÅ„Äç ü§ñ„ÄåÁï∞Â∏∏ÂÄ§„Åß„ÅôÔºàË§í„ÇÅË®ÄËëâÔºâ„Äç üßô„ÄåÂ§©Êâç„Åã...„Äç":n===50?"üòàüòÉüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå50ÈÄ£Á∂öÔºÅÔºÅÔºÅÔºÅÔºÅ„Äç„Äç„Äç„Äç„ÄçÔºàÂÖ®Âì°„Çπ„Çø„É≥„Éá„Ç£„É≥„Ç∞„Ç™„Éô„Éº„Ç∑„Éß„É≥Ôºâ":null}function jX(){const n=new Date,e=n.getMonth()+1,t=n.getDate(),s=n.getDay();return s===1?"üòÉ„Äå‰ªäÈÄ±„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„ÄåÊúàÊõú„Åã„ÇâÈ£õ„Å∞„ÅõÔºÅ„Äç üòº„ÄåÈÄ±„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ„Äç":s===5?"üòº„ÄåÈáëÊõú„Å†ÔºÅ„ÅÇ„Å®Â∞ë„ÅóÔºÅ„Äç üòÉ„Äå„Åß„ÇÇÊ∞ó„ÇíÊäú„Åã„Åö„Å´„Äç üòà„ÄåÊúÄÂæå„Åæ„ÅßÊ∞óÂêà„Å†ÔºÅ„Äç":e===12&&t===25?"üòÉ„Äå„É°„É™„Éº„ÇØ„É™„Çπ„Éû„ÇπÔºÅ„Äç üòà„ÄåÊµÆ„Åã„Çå„Çã„Å™„Äç üòº„Äå„Åü„Åæ„Å´„ÅØ„ÅÑ„ÅÑ„Å†„ÇçÔºÅ„Äç üßô„Äå„Åª„Å£„Åª„Å£„Åª„Äç":e===1&&t===1?"üòÉüòàüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå„ÅÇ„Åë„Åæ„Åó„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç„Äç„Äç„Äç„Äç":null}const _X=[{type:"common-mistake",message:`üòÉ„Äå"I'm exciting"„Å£„Å¶Ë®Ä„Å£„Å¶„Åæ„Åõ„Çì„ÅãÔºüÊ≠£„Åó„Åè„ÅØ"I'm excited"„Åß„Åô„Çà„ÄÇËá™ÂàÜ„Åå„ÉØ„ÇØ„ÉØ„ÇØ„Åó„Å¶„ÇãÊôÇ„ÅØedÂΩ¢„Åß„ÅôÔºÅ„Äç`,teacher:"kind-teacher"},{type:"common-mistake",message:`„Äå"I'm boring"„ÅØ„ÄåÁßÅ„ÅØÈÄÄÂ±à„Å™‰∫∫Èñì„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†„ÅûÔºÅ"I'm bored"„ÅåÊ≠£Ëß£„Å†ÔºÅÈñìÈÅï„Åà„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"},{type:"common-mistake",message:'ü§ñ„Äå"funny"„Å®"fun"„ÅØÁï∞„Å™„Çä„Åæ„Åô„ÄÇ"funny"„ÅØ„ÄåÈù¢ÁôΩ„ÅÑÔºàÁ¨ë„Åà„ÇãÔºâ„Äç„ÄÅ"fun"„ÅØ„ÄåÊ•Ω„Åó„ÅÑ„Äç„ÄÇ‰Ωø„ÅÑÂàÜ„Åë„ÅåÈáçË¶Å„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:'üòÉ„Äå"advice"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å™„ÅÆ„Åß„ÄÅ"an advice"„Å®„ÅØË®Ä„Åà„Åæ„Åõ„Çì„ÄÇ"a piece of advice"„Å®Ë®Ä„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'„Äå"How do you think?"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"What do you think?"„ÅåÊ≠£Ëß£ÔºÅ‰ΩïÂ∫¶Ë®Ä„Çè„Åõ„ÇãÔºÅ„Äç',teacher:"drill-sergeant"},{type:"common-mistake",message:'üòº„Äå"see a dream"„Åò„ÇÉ„Å™„ÅÑ„ÅûÔºÅ"have a dream"„Å†ÔºÅÂ§¢„ÅØË¶ã„Çã„Çì„Åò„ÇÉ„Å™„Åè„Å¶ÊåÅ„Å§„Çì„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"common-mistake",message:'üßô„Äå"say"„Å®"tell"„ÅÆÈÅï„ÅÑ„Åò„ÇÉ„Åå..."say"„ÅØÂÜÖÂÆπ„Çí„ÄÅ"tell"„ÅØÁõ∏Êâã„ÇíÂº∑Ë™ø„Åô„Çã„ÅÆ„Åò„ÇÉ„ÄÇ"tell me"„Å®„ÅØË®Ä„Åà„Çã„Åå"say me"„Å®„ÅØË®Ä„Åà„Å¨„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"common-mistake",message:'üòÉ„Äå"enjoy"„ÅÆÂæå„ÅØÂøÖ„Åö-ingÂΩ¢„Åß„Åô„ÇàÔºÅ"enjoy to study"„Åß„ÅØ„Å™„Åè"enjoy studying"„Åß„Åô„ÄÇ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'ü§ñ„Äå"remember to do"Ôºà„Åì„Çå„Åã„Çâ„Åô„Çã„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„Å®"remember doing"Ôºà„Åó„Åü„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:`„Äå"I'm agree"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"agree"„ÅØÂãïË©û„Å†„Åã„Çâ"I agree"„Å†ÔºÅÂü∫Êú¨„ÇíÂøò„Çå„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"}],PX=[{type:"fun-fact",message:'üßô„ÄåÊé•È†≠Ëæû"re-"„ÅØ„ÄåÂÜç„Å≥„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇreturnÔºàÊàª„ÇãÔºâ„ÄÅreviewÔºàÂæ©ÁøíÔºâ„ÄÅrepeatÔºàÁπ∞„ÇäËøî„ÅôÔºâ„Å™„Å©„ÄÅË¶ö„Åà„ÇÑ„Åô„ÅÑ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÈï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑÔºöÊúÄÂàù„Å®ÊúÄÂæå„ÅÆÊÆµËêΩ„ÄÅÂêÑÊÆµËêΩ„ÅÆÊúÄÂàù„ÅÆÊñá„ÇíË™≠„ÇÅ„Å∞ÂÖ®‰Ωì„ÅÆÊµÅ„Çå„Åå„Å§„Åã„ÇÅ„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„Äå"however"Ôºà„Åó„Åã„ÅóÔºâ„ÄÅ"therefore"Ôºà„Åó„Åü„Åå„Å£„Å¶Ôºâ„ÄÅ"moreover"Ôºà„Åï„Çâ„Å´Ôºâ„Å™„Å©„ÅÆÊé•Á∂öË©û„ÇíË¶ö„Åà„Çã„Å®„ÄÅË´ñÁêÜÂ±ïÈñã„ÅåË¶ã„Åà„ÇÑ„Åô„Åè„Å™„Çä„Åæ„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-tion"„Çí„Å§„Åë„Çã„Å®ÂãïË©û„ÅåÂêçË©û„Å´„Å™„Çã„ÅûÔºÅeducate‚Üíeducation„ÄÅcommunicate‚Üícommunication„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"fun-fact",message:'üßô„Äå"compare A with B"ÔºàA„Å®B„ÇíÊØîËºÉ„Åô„ÇãÔºâ„Å®"compare A to B"ÔºàA„ÇíB„Å´‰æã„Åà„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÈÅï„ÅÜ„Åû„ÄÇË©¶È®ì„Åß„Çà„ÅèÂá∫„Çã„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÂêåÁæ©Ë™û„ÇíÂ¢ó„ÇÑ„Åô„Å®Ë°®ÁèæÂäõ„Åå‰∏ä„Åå„Çä„Åæ„Åô„ÄÇimportant=significant=crucial„ÄÅshow=demonstrate=illustrate „Å™„Å©„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„ÄåÊé•È†≠Ëæû"un-"„ÄÅ"in-"„ÄÅ"dis-"„ÅØÂê¶ÂÆö„ÅÆÊÑèÂë≥„ÄÇunhappy„ÄÅimpossible„ÄÅdisagree„Å™„Å©„ÄÅ„Éë„Çø„Éº„É≥„ÅßË¶ö„Åà„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'„Äå"not only A but also B"ÔºàA„Å†„Åë„Åß„Å™„ÅèB„ÇÇÔºâ„ÅØÈ†ªÂá∫ÊßãÊñá„Å†ÔºÅ„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„ÇçÔºÅ„Äç',teacher:"drill-sergeant"},{type:"fun-fact",message:'üßô„Äå"although"„Å®"though"„ÅØ„Åª„ÅºÂêå„ÅòÊÑèÂë≥Ôºà„Äú„Å†„Åë„Çå„Å©„ÇÇÔºâ„Åò„ÇÉ„Åå„ÄÅthough„ÅÆÊñπ„Åå„Ç´„Ç∏„É•„Ç¢„É´„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-able"„ÅØ„Äå„Äú„Åß„Åç„Çã„Äç„ÅÆÊÑèÂë≥„Å†ÔºÅreadableÔºàË™≠„ÇÅ„ÇãÔºâ„ÄÅcomfortableÔºàÂø´ÈÅ©„Å™Ôºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"}],MX=[{type:"cultural",message:"üòÉ„ÄåËã±Êñá„Ç®„ÉÉ„Çª„Ç§„ÅØÁµêË´ñ„ÇíÊúÄÂàù„Å´Êõ∏„Åè„ÅÆ„ÅåÂü∫Êú¨„ÄÇIntroduction‚ÜíBody‚ÜíConclusion„ÅÆ3ÈÉ®ÊßãÊàê„Åß„Åô„Çà„ÄÇ„Äç",teacher:"kind-teacher"},{type:"cultural",message:'üßô„ÄåËã±Ë™û„ÅÆË´ñÁêÜÂ±ïÈñã„ÅØ"‰∏ªÂºµ‚ÜíÁêÜÁî±‚ÜíÂÖ∑‰Ωì‰æã"„ÅåÂü∫Êú¨„Åò„ÇÉ„ÄÇFor example, For instance „Çí‰Ωø„ÅÑ„Åì„Å™„Åù„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"cultural",message:"ü§ñ„ÄåÂ≠¶Ë°ìÁöÑ„Å™ÊñáÁ´†„Åß„ÅØ„ÄÅcontractionsÔºàÁü≠Á∏ÆÂΩ¢Ôºâ„ÅØ‰Ωø„ÅÑ„Åæ„Åõ„Çì„ÄÇdon't‚Üído not„ÄÅit's‚Üíit is „Å®Êõ∏„Åç„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"cultural",message:"üòº„ÄåÊÑèË¶ã„ÇíËø∞„Åπ„ÇãË°®ÁèæÔºÅI think, In my opinion, From my perspective „Å™„Å©„ÄÅ„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥„ÇíÂ¢ó„ÇÑ„Åù„ÅÜÔºÅ„Äç",teacher:"enthusiastic-coach"},{type:"cultural",message:'üòÉ„ÄåÁêÜÁî±„ÇíËø∞„Åπ„ÇãÊôÇ„ÅØ"because"„Å†„Åë„Åò„ÇÉ„Å™„Åè„ÄÅ"since"„ÄÅ"as"„ÄÅ"due to"„Å™„Å©„ÇÇ‰Ωø„Åà„Åæ„Åô„Çà„ÄÇ„Äç',teacher:"kind-teacher"},{type:"cultural",message:'„ÄåÂèóÂãïÊÖã„Çí‰Ωø„ÅÑ„Åì„Å™„ÅõÔºÅ"The experiment was conducted"„Å™„Å©„ÄÅÂÆ¢Ë¶≥ÁöÑ„Å™Ë°®Áèæ„Å´ÂøÖË¶Å„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"cultural",message:'üßô„ÄåÂØæÊØî„ÅÆË°®ÁèæÔºö"on the other hand"Ôºà‰∏ÄÊñπ„ÅßÔºâ„ÄÅ"in contrast"ÔºàÂØæÁÖßÁöÑ„Å´Ôºâ„ÅØË´ñËø∞ÂïèÈ°å„ÅßÈáçÂÆù„Åô„Çã„Åû„ÄÇ„Äç',teacher:"wise-sage"}],FX=[{type:"etymology",message:'üßô„Äå"pre-"„ÅØ„ÄåÂâç„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇpreviewÔºà‰∫àÁøí„ÉªË©¶ÂÜôÔºâ„ÄÅpredictÔºà‰∫àÊ∏¨„Åô„ÇãÔºâ„ÄÅprepareÔºàÊ∫ñÂÇô„Åô„ÇãÔºâ„Å®Ë¶ö„Åà„Çà„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'ü§ñ„Äå"post-"„ÅØ„ÄåÂæå„Äç„ÄÇpostponeÔºàÂª∂Êúü„Åô„ÇãÔºâ„ÄÅpostwarÔºàÊà¶Âæå„ÅÆÔºâ„Å™„Å©„ÄÇpre-„Å®„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Çã„Å®ÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"tele-"„ÅØ„ÇÆ„É™„Ç∑„É£Ë™û„Åß„ÄåÈÅ†„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„ÄÇtelephoneÔºàÈõªË©±Ôºâ„ÄÅtelevisionÔºà„ÉÜ„É¨„ÉìÔºâ„ÄÅtelescopeÔºàÊúõÈÅ†Èè°Ôºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"bi-"„ÅØ„Äå2„Å§„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇbicycleÔºà‰∫åËº™ËªäÔºâ„ÄÅbilingualÔºà2Ë®ÄË™ûË©±„Åõ„ÇãÔºâ„ÄÅbiweeklyÔºàÈöîÈÄ±„ÅÆÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'üòº„Äå"auto-"„ÅØ„ÄåËá™Âãï„ÉªËá™Â∑±„Äç„Å†ÔºÅautomaticÔºàËá™Âãï„ÅÆÔºâ„ÄÅautobiographyÔºàËá™‰ºùÔºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"etymology",message:'ü§ñ„Äå"micro-"„ÅØ„ÄåÂ∞è„Åï„ÅÑ„Äç„ÄÅ"macro-"„ÅØ„ÄåÂ§ß„Åç„ÅÑ„Äç„ÄÇmicroscopeÔºàÈ°ïÂæÆÈè°Ôºâ„ÄÅmacroeconomicsÔºà„Éû„ÇØ„É≠ÁµåÊ∏àÂ≠¶Ôºâ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"sub-"„ÅØ„Äå‰∏ã„Äç„ÅÆÊÑèÂë≥„ÄÇsubwayÔºàÂú∞‰∏ãÈâÑÔºâ„ÄÅsubmarineÔºàÊΩúÊ∞¥Ëâ¶Ôºâ„ÄÅsubtitleÔºàÂ≠óÂπïÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"super-"„ÅØ„Äå‰∏ä„ÉªË∂Ö„Äç„Åò„ÇÉ„ÄÇsuperiorÔºàÂÑ™„Çå„ÅüÔºâ„ÄÅsupernaturalÔºàË∂ÖËá™ÁÑ∂ÁöÑ„Å™Ôºâ„ÄÅsuperviseÔºàÁõ£Áù£„Åô„ÇãÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"}],OX=[{type:"grammar-tip",message:'üòÉ„Äå"a"„Å®"an"„ÅÆ‰Ωø„ÅÑÂàÜ„Åë„ÅØ„ÄÅÊ¨°„ÅÆÂçòË™û„ÅÆ„ÄåÈü≥„Äç„ÅßÊ±∫„Åæ„Çä„Åæ„Åô„ÄÇ"an hour"Ôºàhour„ÅÆh„ÅØÁô∫Èü≥„Åó„Å™„ÅÑÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„ÄåÁèæÂú®ÂÆå‰∫Ü„ÅØ„Äå‰ªä„Å´Èñ¢‰øÇ„Åå„ÅÇ„ÇãÈÅéÂéª„Äç„Å†ÔºÅ"I have lost my key"„ÅØ‰ªä„ÇÇË¶ã„Å§„Åã„Å£„Å¶„Å™„ÅÑ„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"grammar-tip",message:'ü§ñ„Äå"fewer"„ÅØÊï∞„Åà„Çâ„Çå„ÇãÂêçË©û„ÄÅ"less"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å´‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"fewer people"„ÄÅ"less water"„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"grammar-tip",message:'üßô„Äå"used to"„ÅØÈÅéÂéª„ÅÆÁøíÊÖ£„ÄÅ"be used to"„ÅØÊÖ£„Çå„Å¶„ÅÑ„Çã„ÄÅ"get used to"„ÅØÊÖ£„Çå„Çã„Åò„ÇÉ„ÄÇÂÖ®„Å¶ÈÅï„ÅÜ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"grammar-tip",message:'üòº„Äå"will"„ÅØÊÑèÂøó„ÄÅ"be going to"„ÅØ‰∫àÂÆö„ÇÑ‰∫àÊ∏¨„Å†ÔºÅ‰Ωø„ÅÑÂàÜ„Åë„Çâ„Çå„Çã„Å®Ëã±Ë™û„Å£„ÅΩ„Åè„Å™„Çã„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"grammar-tip",message:'üòÉ„Äå"some"„Å®"any"„ÄÅËÇØÂÆöÊñá„ÅØsome„ÄÅÁñëÂïèÊñá„ÉªÂê¶ÂÆöÊñá„ÅØany„ÅåÂü∫Êú¨„Åß„Åô„Åå„ÄÅ"Would you like some tea?"„ÅÆ„Çà„ÅÜ„Å´Âãß„ÇÅ„ÇãÊôÇ„ÅØsome„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„Äå‰∏âÂçòÁèæ„ÅÆsÔºÅÂøò„Çå„Çã„Å™ÔºÅ"He go"„Åß„ÅØ„Å™„Åè"He goes"„Å†ÔºÅÂü∫Êú¨‰∏≠„ÅÆÂü∫Êú¨„Å†„ÅûÔºÅ„Äç',teacher:"drill-sergeant"}];function LX(n){if(Math.random()>.08)return null;if(n){const e=[...PX,...FX,...MX];return e[Math.floor(Math.random()*e.length)].message}else{const e=[..._X,...OX];return e[Math.floor(Math.random()*e.length)].message}}function zX(n,e){const t=e&&(e.includes(" ")||e.includes("-")),s=["üòÉüí° ÂèóÈ®ì„ÉÜ„ÇØÔºÅÂêå„ÅòÂçòË™û„ÅÆÁπ∞„ÇäËøî„Åó„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÄÅ‰ª£ÂêçË©ûÔºàit, they, thisÔºâ„ÇÑÂêåÁæ©Ë™û„Å´Ê≥®ÁõÆ„Åô„Çã„Å®Ë™≠Ëß£„ÅåÊ•Ω„Å´„Å™„Çä„Åæ„Åô„Çà„ÄÇ","üßôüí° Èï∑Êñá„ÅÆ„Ç≥„ÉÑÔºöË®≠Âïè„ÇíÂÖà„Å´Ë™≠„Çì„Åß„Åã„ÇâÊú¨Êñá„ÇíË™≠„ÇÄ„Å®„ÄÅ‰Ωï„ÇíÊé¢„Åõ„Å∞„ÅÑ„ÅÑ„ÅãÂàÜ„Åã„Å£„Å¶ÂäπÁéáÁöÑ„Åò„ÇÉ„ÄÇ","ü§ñüí° Áµ±Ë®à„Éá„Éº„ÇøÔºöÂàùÁ¥ö„ÅØÁ¥Ñ1,077Ë™û„ÄÅ‰∏≠Á¥ö„ÅØÁ¥Ñ1,616Ë™û„ÄÅ‰∏äÁ¥ö„ÅØÁ¥Ñ885Ë™û„Åß„Åô„ÄÇË®àÁîªÁöÑ„Å´Ë™ûÂΩô„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üí° ÊôÇÂà∂„ÅÆ‰∏ÄËá¥ÔºÅ‰∏ªÁØÄ„ÅåÈÅéÂéªÂΩ¢„Å™„ÇâÂæìÂ±ûÁØÄ„ÇÇÈÅéÂéªÂΩ¢„Å†ÔºÅ"He said that he was tired"„Å†„ÅûÔºÅ',"üòÉüí° Êï¥Â∫èÂïèÈ°å„ÅÆ„Ç≥„ÉÑÔºÅ„Åæ„Åö‰∏ªË™û„Å®ÂãïË©û„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ‰øÆÈ£æË™û„ÇíÂæå„Åã„Çâ‰ªò„ÅëË∂≥„Åô„Å®Ëß£„Åç„ÇÑ„Åô„ÅÑ„Åß„Åô„Çà„ÄÇ",'üßôüí° ÂÜ†Ë©û„ÅÆ‰Ωø„ÅÑÂàÜ„ÅëÔºö"a/an"„ÅØÂàù„ÇÅ„Å¶Âá∫„Çã„ÉªÁâπÂÆö„Åß„Åç„Å™„ÅÑ„ÇÇ„ÅÆ„ÄÅ"the"„ÅØÊó¢Âá∫„ÉªÁâπÂÆö„Åß„Åç„Çã„ÇÇ„ÅÆ„Åò„ÇÉ„ÄÇ',"üòºüí° „É™„Çπ„Éã„É≥„Ç∞ÂØæÁ≠ñÔºÅÊ∂àÂéªÊ≥ï„ÅåÊúâÂäπ„Å†ÔºÅÊòé„Çâ„Åã„Å´ÈÅï„ÅÜÈÅ∏ÊäûËÇ¢„ÇíÊ∂à„Åó„Å¶„ÅÑ„Åè„Å®Ê≠£Ëß£Áéá„Åå‰∏ä„Åå„Çã„ÅûÔºÅ","ü§ñüí° ÂäπÁéáÁöÑÂ≠¶ÁøíÊ≥ïÔºöÂçòË™û„ÅØÊñáËÑà„ÅÆ‰∏≠„ÅßË¶ö„Åà„Çã„Å®ÂÆöÁùÄÁéá„Åå3ÂÄç‰ª•‰∏äÈ´ò„Åæ„Çä„Åæ„Åô„ÄÇ‰æãÊñá„Åî„Å®Ë¶ö„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üòÉüí° ÊØîËºÉË°®ÁèæÔºö"as...as"ÔºàÂêåÁ≠âÔºâ„ÄÅ"-er than"ÔºàÊØîËºÉÁ¥öÔºâ„ÄÅ"the -est"ÔºàÊúÄ‰∏äÁ¥öÔºâ„ÅÆ3„Éë„Çø„Éº„É≥„Çí„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Çá„ÅÜÔºÅ'];return t&&s.push("üòºüí° Ë¶ö„ÅàÊñπÔºÅÁÜüË™û„ÅØÂãïË©û„Å®ÂâçÁΩÆË©û„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶Ë¶ö„Åà„Çã„Å®„ÅÑ„ÅÑ„ÅûÔºÅË¶ñË¶öÁöÑ„Å´„Ç§„É°„Éº„Ç∏„Åô„Çã„Å®Âøò„Çå„Å´„Åè„ÅÑ„ÅûÔºÅ"),s[Math.floor(Math.random()*s.length)]}function WX(n){const{mode:e="translation",currentWord:t,wordProgress:s}=n,r={once:0,twice:0,three:0,four:0,five:0,sixOrMore:0};let o=!1;return Object.entries(s).forEach(([i,a])=>{if(!a)return;let c=0;e==="memorization"?c=a.memorizationAttempts||0:e==="translation"?c=a.translationAttempts??a.quizAttempts??0:e==="spelling"?c=a.spellingAttempts||0:e==="grammar"?c=a.grammarAttempts||0:c=a.totalAttempts||0,t&&i===t&&(o=!0),c===1?r.once++:c===2?r.twice++:c===3?r.three++:c===4?r.four++:c===5?r.five++:c>=6&&r.sixOrMore++}),t&&!o&&r.once++,r}function Ah({mode:n="translation",currentScore:e=0,totalAnswered:t=0,sessionCorrect:s=0,_sessionIncorrect:r=0,_sessionReview:o=0,isReviewFocusMode:i=!1,onReviewFocus:a,onShowSettings:c,currentWord:l,onAnswerTime:d,lastAnswerCorrect:h,lastAnswerWord:p,lastAnswerDifficulty:f,correctStreak:m=0,incorrectStreak:g=0,learningPhase:x,estimatedSpeed:y,forgettingRate:b,dataSource:v="",category:w="",difficulty:S="",wordPhraseFilter:N="",grammarUnit:C,sessionStats:k,_currentQuestionTimesShown:I,onResetProgress:T,onDebugRequeue:_,learningStatusTabPulseKey:D}){const[P,A]=$.useState("ai"),[F,O]=$.useState(!1),V=$.useRef(null);$.useEffect(()=>{if(D)return O(!0),V.current&&window.clearTimeout(V.current),V.current=window.setTimeout(()=>{O(!1),V.current=null},1600),()=>{V.current&&(window.clearTimeout(V.current),V.current=null)}},[D]);const[L,H]=$.useState(()=>{const z=localStorage.getItem("aiPersonality")||"kind-teacher";return wX(z)||"„Åì„Çì„Å´„Å°„ÅØÔºÅ‰∏ÄÁ∑í„Å´Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),[J,X]=$.useState("");$.useEffect(()=>{if(l){const z=localStorage.getItem("aiPersonality")||"kind-teacher",U=Vu(l);let M="";if(U){const{totalCount:ie,correctCount:te}=U,Q=ie-te,ce=ie>0?Math.round(te/ie*100):0;if(ie===0)switch(z){case"drill-sergeant":M="Êñ∞„Åó„ÅÑÂçòË™û„Å†ÔºÅÊ∞óÂêà„ÇíÂÖ•„Çå„Å¶Ë¶ö„Åà„ÇçÔºÅ";break;case"kind-teacher":M="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô„Å≠„ÄÇ„Åò„Å£„Åè„ÇäËÄÉ„Åà„Å¶„Åø„Åæ„Åó„Çá„ÅÜ";break;case"analyst":M="Êñ∞Ë¶èÂçòË™û„ÄÇ„Éá„Éº„Çø„Å™„Åó„ÄÇÂàùÂõûÊ∏¨ÂÆö„ÇíÈñãÂßã„Åó„Åæ„Åô";break;case"enthusiastic-coach":M="Êñ∞„Åó„ÅÑ„ÉÅ„É£„É¨„É≥„Ç∏„Å†ÔºÅÊÄù„ÅÑÂàá„Å£„Å¶Ë°å„Åì„ÅÜÔºÅ";break;case"wise-sage":M="Âàù„ÇÅ„Å¶Âá∫‰ºö„ÅÜÂçòË™û„Åò„ÇÉ„Å™„ÄÇÁÑ¶„Çâ„ÅöÂêë„ÅçÂêà„Åä„ÅÜ";break;default:M="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô"}else if(ie===1){const le=te===1;switch(z){case"drill-sergeant":M=le?"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÊ≠£Ëß£„Åó„Åü„Åû„ÄÇ„Åæ„Åü„ÇÑ„ÇåÔºÅ":"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÈñìÈÅï„Åà„Åü„ÄÇ‰ªäÂ∫¶„Åì„ÅùÊ±∫„ÇÅ„ÇçÔºÅ";break;case"kind-teacher":M=le?"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠":"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÈñìÈÅï„Åà„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅÂ§ß‰∏àÂ§´„Åß„Åô";break;case"analyst":M=`2ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÂâçÂõû: ${le?"Ê≠£Ëß£":"‰∏çÊ≠£Ëß£"}`;break;case"enthusiastic-coach":M=le?"2ÂõûÁõÆÔºÅÂâçÂõû„ÅØÂÆåÁíß„Å†„Å£„Åü„Å™ÔºÅ":"2ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É≥„ÇπÔºÅÂâçÂõû„ÅÆ„É™„Éô„É≥„Ç∏„Å†ÔºÅ";break;case"wise-sage":M=le?"2Â∫¶ÁõÆ„ÅÆÂá∫‰ºö„ÅÑ„Åò„ÇÉ„ÄÇÂâçÂõû„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Å£„Åü„ÅÆ„ÅÜ":"2Â∫¶ÁõÆ„Åò„ÇÉ„Å™„ÄÇÂâçÂõû„ÅÆÁµåÈ®ì„ÇíÊ¥ª„Åã„Åù„ÅÜ";break;default:M="2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô"}}else switch(z){case"drill-sergeant":ce>=80?M=`${ie}ÂõûÁõÆ„Å†„ÄÇÊ≠£Á≠îÁéá${ce}%ÔºÅ„ÅÑ„ÅÑË™øÂ≠ê„Å†ÔºÅ`:ce>=50?M=`${ie}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${ce}%„ÄÇ„ÇÇ„Å£„Å®‰∏ä„Åí„ÇçÔºÅ`:M=`${ie}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${ce}%ÔºÅË¶ö„Åà„ÅåÊÇ™„ÅÑ„ÅûÔºÅ`;break;case"kind-teacher":ce>=80?M=`${ie}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${ce}%„ÄÅ„Çà„ÅèË¶ö„Åà„Å¶„ÅÑ„Åæ„Åô„Å≠`:ce>=50?M=`${ie}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${ce}%„ÄÅÂ∞ë„Åó„Åö„Å§Ë¶ö„Åà„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô`:M=`${ie}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${ce}%„ÄÅÁπ∞„ÇäËøî„ÅóÁ∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ`;break;case"analyst":M=`${ie}ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÊ≠£Á≠îÁéá: ${ce}% (Ê≠£Ëß£${te}/‰∏çÊ≠£Ëß£${Q})`;break;case"enthusiastic-coach":ce>=80?M=`${ie}ÂõûÁõÆÔºÅÊ≠£Á≠îÁéá${ce}%ÔºÅÂÆåÁíß„Å´Ëøë„ÅÑ„ÅûÔºÅ`:M=`${ie}ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏ÔºÅÊ≠£Á≠îÁéá${ce}%„ÄÅ„Åæ„Å†‰º∏„Å≥„Çã„ÅûÔºÅ`;break;case"wise-sage":ce>=80?M=`${ie}ÂõûÁõÆ„Åò„ÇÉ„Å™„ÄÇÊ≠£Á≠îÁéá${ce}%„ÄÅ„Çà„ÅèÂÆöÁùÄ„Åó„Å¶„Åä„Çã`:M=`${ie}ÂõûÁõÆ„Åò„ÇÉ„ÄÇÊ≠£Á≠îÁéá${ce}%„ÄÅÁÑ¶„Çâ„ÅöÁùÄÂÆü„Å´„Å™`;break;default:M=`${ie}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${ce}%`}}else M="Êñ∞„Åó„ÅÑÂïèÈ°å„Åß„Åô";H(M),X("")}},[l]),$.useEffect(()=>{if(h===void 0||!p||!l||p!==l)return;const z=localStorage.getItem("aiPersonality")||"kind-teacher",U=Fu(n||"translation"),M=U.todayTotalAnswered,ie=U.todayAccuracy,te=t>0?(s||0)/t*100:0,ce={isCorrect:h,word:p,difficulty:f||S||"intermediate",category:w||"ÂÖ®ÂàÜÈáé",attemptCount:1,responseTime:0,correctStreak:m,incorrectStreak:g,userAccuracy:te,categoryAccuracy:te,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:M,todayAccuracy:ie,planProgress:0,timeOfDay:N0(),learningPhase:x,estimatedSpeed:y,forgettingRate:b};let le=CI(z,ce);if(Math.random()<.15){const Pe=[];if(Math.random()<.33){const ve=zX(z,l);ve&&Pe.push(ve)}else if(Math.random()<.5){const ve=jX();ve&&Pe.push(ve)}else{const ve=RX();ve&&Pe.push(ve)}Pe.length>0&&(le=`${le}

${Pe[0]}`)}X(le)},[d,h,p,f,m,g,n,t,s,w,S]);const fe=$.useRef(null),be=$.useRef(null),oe=$.useRef(null),[xe,$e]=$.useState(()=>{const z=localStorage.getItem(`learning-limit-${n}`);return z?parseInt(z):null}),[Le,Re]=$.useState(()=>{const z=localStorage.getItem(`review-limit-${n}`);return z?parseInt(z):null}),[ze,Ye]=$.useState(()=>{const z=localStorage.getItem("memorization-still-learning-limit");return z?parseInt(z):null}),[Te,ut]=$.useState(()=>{const z=localStorage.getItem("memorization-incorrect-limit");return z?parseInt(z):null}),[ft,wt]=$.useState(!1);$.useEffect(()=>{if((n==="translation"||n==="spelling"||n==="grammar")&&k&&a){const{incorrect:z,review:U}=k,M=z+U;(xe!==null&&M>=xe||Le!==null&&U>=Le)&&(i||a())}},[k,xe,Le,i,n,a]);const[vt,Nt]=$.useState(()=>{if(n==="grammar"){const{retentionRate:z,appearedCount:U}=Hu();return{retentionRate:z,appearedCount:U}}else{const{retentionRate:z,appearedCount:U}=Bu();return{retentionRate:z,appearedCount:U}}}),[mt,dt]=$.useState(()=>n==="grammar"?Lu():n==="memorization"?zu():Ou()),[re,de]=$.useState(null),q=$.useMemo(()=>{const U=et().wordProgress||{};return WX({mode:n,currentWord:l,wordProgress:U})},[n,l,d]),[Z,Ce]=$.useState([]);$.useEffect(()=>{n==="grammar"&&b0().then(z=>{if(C){const U=C.match(/g(\d+)-(?:unit|u)(\d+)/);if(U){const M=`‰∏≠${U[1]}_Unit${U[2]}`,ie=z.filter(te=>te.unit===M);Ce(ie)}else Ce(z)}else Ce(z)})},[n,d,C]),$.useEffect(()=>{if(n==="grammar"){const{retentionRate:z,appearedCount:U}=Hu();Nt({retentionRate:z,appearedCount:U}),dt(Lu())}else if(n==="memorization"){const z=zu();dt(z),Nt({retentionRate:z.basicRetentionRate,appearedCount:z.appearedWords})}else{const{retentionRate:z,appearedCount:U}=Bu();Nt({retentionRate:z,appearedCount:U}),dt(Ou())}},[d,n]),$.useEffect(()=>{de(l?Vu(l):null)},[l,d]),$.useEffect(()=>{if(fe.current){const z=Math.round(mt.masteredPercentage);fe.current.style.setProperty("--segment-width",String(z)),fe.current.setAttribute("data-width",String(z))}if(be.current){const z=Math.round(mt.learningPercentage);be.current.style.setProperty("--segment-width",String(z)),be.current.setAttribute("data-width",String(z))}if(oe.current){const z=Math.round(mt.strugglingPercentage);oe.current.style.setProperty("--segment-width",String(z)),oe.current.setAttribute("data-width",String(z))}},[mt,P,n]);const{todayAccuracy:_e,todayTotalAnswered:De}=$.useMemo(()=>Fu(n),[n,d]),Ie=n==="memorization"&&!i&&((mt==null?void 0:mt.learningCount)??0)>0&&((mt==null?void 0:mt.strugglingCount)??0)===0;$.useMemo(()=>l0(n),[n,d]),$.useMemo(()=>$h(),[d]);const{retentionRate:Dt}=vt,j=mt;return $.useMemo(()=>t>0?Math.round(e/t*100):0,[e,t]),u.jsxs("div",{className:"score-board-compact",children:[u.jsxs("div",{className:"score-board-tabs grid grid-cols-3 sm:grid-cols-5 gap-1 sm:gap-2",children:[u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${P==="ai"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("ai"),title:"AI„Ç≥„É°„É≥„Éà",children:[u.jsx("span",{className:"hidden sm:inline",children:"ü§ñ AI"}),u.jsx("span",{className:"sm:hidden",children:"ü§ñ"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${P==="plan"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("plan"),title:"„Éó„É©„É≥",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìã „Éó„É©„É≥"}),u.jsx("span",{className:"sm:hidden",children:"üìã"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${P==="breakdown"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("breakdown"),title:"Â≠¶ÁøíÁä∂Ê≥Å",children:[u.jsx("span",{className:`hidden sm:inline ${F?"animate-pulse drop-shadow-sm "+(P==="breakdown"?"":"text-primary"):""}`,children:"üìà Â≠¶ÁøíÁä∂Ê≥Å"}),u.jsx("span",{className:`sm:hidden ${F?"animate-pulse drop-shadow-sm "+(P==="breakdown"?"":"text-primary"):""}`,children:"üìà"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${P==="history"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("history"),title:"Â±•Ê≠¥",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìú Â±•Ê≠¥"}),u.jsx("span",{className:"sm:hidden",children:"üìú"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${P==="settings"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>{c?c():A("settings")},title:"Â≠¶ÁøíË®≠ÂÆö",children:[u.jsx("span",{className:"hidden sm:inline",children:"‚öôÔ∏è Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("span",{className:"sm:hidden",children:"‚öôÔ∏è"})]})]}),P==="ai"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"ai-comment-container",children:u.jsxs("div",{className:"flex items-center gap-2 w-full",children:[u.jsx("div",{className:"text-2xl flex-shrink-0",children:(()=>{const z=localStorage.getItem("aiPersonality")||"kind-teacher";return{"kind-teacher":"üòÉ","drill-sergeant":"üëπ","enthusiastic-coach":"üòº",analyst:"ü§ñ","wise-sage":"üßô"}[z]||"üòÉ"})()}),u.jsx("div",{className:"flex-1 min-w-0",children:u.jsx("div",{className:"text-sm text-gray-700 leading-snug break-words",children:(J||L).replace(/^[üòÉüëπüòºü§ñüßô]+„Äå?/gu,"").replace(/„Äç$/gu,"").replace(/[‚ú®üå∏üòäüå±üí™üî•üìäüèÜ]/gu,"").trim()})})]})})})}),P==="plan"&&u.jsx("div",{className:"score-board-content",children:u.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:[u.jsxs("div",{className:"plan-text-line",children:[u.jsxs("span",{className:"stat-text-label",children:["üìö ",v||"ÂÖ®ÂïèÈ°åÈõÜ"]}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:w||"ÂÖ®ÂàÜÈáé"}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:S==="all"?"ÂÖ®Èõ£ÊòìÂ∫¶":S==="basic"?"Âü∫Á§é":S==="standard"?"Ê®ôÊ∫ñ":S==="advanced"?"Áô∫Â±ï":S}),(n==="translation"||n==="spelling"||n==="memorization")&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("button",{onClick:()=>wt(!0),className:"stat-text-label cursor-pointer hover:text-primary transition-colors",title:"Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö",children:"‚öôÔ∏è ‰∏äÈôêË®≠ÂÆö"})]}),N&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:N==="all"?"ÂçòË™û„ÉªÁÜüË™û":N==="word"?"ÂçòË™û„ÅÆ„Åø":N==="phrase"?"ÁÜüË™û„ÅÆ„Åø":"ÂçòË™û„ÉªÁÜüË™û"})]})]}),ft&&(n==="translation"||n==="spelling")&&u.jsx("div",{className:"plan-settings-modal",children:u.jsxs("div",{className:"plan-settings-content",children:[u.jsx("h4",{children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö"}),u.jsx("p",{className:"plan-settings-description",children:"0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"Â≠¶Áøí‰∏≠„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"Â≠¶Áøí‰∏≠„ÅÆË™ûÊï∞‰∏äÈôê",value:xe||0,onChange:z=>{const U=parseInt(z.target.value),M=U===0?null:U;$e(M),M===null?localStorage.removeItem(`learning-limit-${n}`):localStorage.setItem(`learning-limit-${n}`,M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"Ë¶ÅÂæ©Áøí„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"Ë¶ÅÂæ©Áøí„ÅÆË™ûÊï∞‰∏äÈôê",value:Le||0,onChange:z=>{const U=parseInt(z.target.value),M=U===0?null:U;Re(M),M===null?localStorage.removeItem(`review-limit-${n}`):localStorage.setItem(`review-limit-${n}`,M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsx("button",{className:"plan-settings-close",onClick:()=>wt(!1),children:"Èñâ„Åò„Çã"})]})}),ft&&n==="memorization"&&u.jsx("div",{className:"plan-settings-modal",children:u.jsxs("div",{className:"plan-settings-content",children:[u.jsx("h4",{children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö"}),u.jsx("p",{className:"plan-settings-description",children:"0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê",value:ze||0,onChange:z=>{const U=parseInt(z.target.value),M=U===0?null:U;Ye(M),M===null?localStorage.removeItem("memorization-still-learning-limit"):localStorage.setItem("memorization-still-learning-limit",M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê",value:Te||0,onChange:z=>{const U=parseInt(z.target.value),M=U===0?null:U;ut(M),M===null?localStorage.removeItem("memorization-incorrect-limit"):localStorage.setItem("memorization-incorrect-limit",M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsx("button",{className:"plan-settings-close",onClick:()=>wt(!1),children:"Èñâ„Åò„Çã"})]})})]})}),P==="breakdown"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsxs("div",{className:"retention-breakdown-container",children:[u.jsxs("div",{className:"retention-breakdown-header",children:[u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsxs("div",{className:"attempt-counts-summary flex-1",children:["Âá∫È°åÊï∞Ôºö1Âõû ",q.once,"Âïè 2Âõû ",q.twice,"Âïè 3Âõû"," ",q.three,"Âïè 4Âõû ",q.four,"Âïè 5Âõû ",q.five,"Âïè 6Âõû‰ª•‰∏ä ",q.sixOrMore,"Âïè"]}),!1]}),j.appearedWords>0?u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?u.jsxs(u.Fragment,{children:[j.appearedWords,"Ë™ûÁ¢∫Ë™çÔºö üü¢Ë¶ö„Åà„Å¶„Çã"," ",j.masteredCount,"Ë™û"," ",u.jsxs("span",{className:"retention-label",title:i?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":Ie?"üî• „Åæ„Å†„Åæ„Å†„Éñ„Éº„Çπ„Éà‰∏≠":void 0,children:["üü°„Åæ„Å†„Åæ„Å† ",j.learningCount,"Ë™û"]})," ",u.jsxs("span",{className:"retention-label",title:i?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":void 0,children:["üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ",j.strugglingCount,"Ë™û"]}),a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):n==="grammar"?u.jsxs(u.Fragment,{children:[j.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",j.masteredCount,"Âïè üü°Â≠¶Áøí‰∏≠ ",j.learningCount,"Âïè üî¥Ë¶ÅÂæ©Áøí"," ",j.strugglingCount,"Âïè",a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):u.jsxs(u.Fragment,{children:[j.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",j.masteredCount,"Ë™û üü°Â≠¶Áøí‰∏≠ ",j.learningCount,"Ë™û üî¥Ë¶ÅÂæ©Áøí"," ",j.strugglingCount,"Ë™û",(n==="translation"||n==="spelling")&&a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]})}):u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?"„Åæ„Å†Ë™ûÂè•„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì":"„Åæ„Å†ÂïèÈ°å„Å´Âèñ„ÇäÁµÑ„Çì„Åß„ÅÑ„Åæ„Åõ„Çì"})]}),j.appearedWords>0&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"retention-progress-bar",children:n==="memorization"?u.jsxs(u.Fragment,{children:[j.masteredPercentage>0&&u.jsx("div",{ref:fe,className:"retention-segment retention-mastered","data-width":Math.round(j.masteredPercentage),title:`üü¢ Ë¶ö„Åà„Å¶„Çã: ${j.masteredCount}Ë™û (${Math.round(j.masteredPercentage)}%)`,children:j.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(j.masteredPercentage),"%"]})}),j.learningCount>0&&u.jsx("div",{ref:be,className:`retention-segment retention-learning ${i||Ie?"pulsing":""}`,"data-width":Math.round(j.learningPercentage),title:`üü° „Åæ„Å†„Åæ„Å†: ${j.learningCount}Ë™û (${Math.round(j.learningPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":Ie?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":""}`,children:j.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(j.learningPercentage),"%"]})}),j.strugglingCount>0&&u.jsx("div",{ref:oe,className:`retention-segment retention-struggling ${i?"pulsing":""}`,"data-width":Math.round(j.strugglingPercentage),title:`üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${j.strugglingCount}Ë™û (${Math.round(j.strugglingPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":""}`,children:j.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(j.strugglingPercentage),"%"]})})]}):u.jsxs(u.Fragment,{children:[j.masteredPercentage>0&&u.jsx("div",{ref:fe,className:"retention-segment retention-mastered","data-width":Math.round(j.masteredPercentage),title:`üü¢ ÂÆöÁùÄ: ${j.masteredCount}Ë™û (${Math.round(j.masteredPercentage)}%)`,children:j.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(j.masteredPercentage),"%"]})}),j.learningPercentage>0&&u.jsx("div",{ref:be,className:`retention-segment retention-learning ${Ie||i?"pulsing":""}`,"data-width":Math.round(j.learningPercentage),title:`üü° Â≠¶Áøí‰∏≠: ${j.learningCount}Ë™û (${Math.round(j.learningPercentage)}%) ${Ie?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":i?"üìö Âæ©Áøí‰∏≠":""}`,children:j.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(j.learningPercentage),"%"]})}),j.strugglingPercentage>0&&u.jsx("div",{ref:oe,className:`retention-segment retention-struggling ${i?"pulsing":""}`,"data-width":Math.round(j.strugglingPercentage),title:`üî¥ Ë¶ÅÂæ©Áøí: ${j.strugglingCount}Ë™û (${Math.round(j.strugglingPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":""}`,children:j.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(j.strugglingPercentage),"%"]})})]})})})]})})}),P==="history"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"history-compact",children:n==="grammar"?u.jsx("div",{className:"word-detail-container",children:Z.length>0?u.jsx("div",{className:"grammar-units-list",children:Z.map(z=>{const U=(z.correctCount||0)+(z.incorrectCount||0),M=z.masteredCount||0,ie=z.answeredQuestions||0,te=ie>0?Math.round(M/ie*100):0,Q=z.historyIcons||"";let ce="üü¢",le="ÂÆöÁùÄÊ∏à";M===0&&ie>0?(ce="üî¥",le="Ë¶ÅÂæ©Áøí"):te<80&&ie>0&&(ce="üü°",le="Â≠¶Áøí‰∏≠");const Pe=z.unit.match(/‰∏≠(\d+)/),ve=Pe?`${Pe[1]}Âπ¥`:z.unit,Je=z.unit.match(/Unit(\d+)/),ee=Je?`Unit${Je[1]}`:"",ge=ee?`${ve} ${ee}Ôºö${z.title}`:`${ve}Ôºö${z.title}`;return u.jsxs("div",{className:"grammar-unit-card",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",ge," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[ce," ",le]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[z.correctCount,"/",U,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),Q&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:Q}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[te,"%"]})]})]},z.unit)})}):u.jsxs("div",{className:"word-detail-empty",children:[u.jsx("p",{children:"„Åæ„Å†ÊñáÊ≥ïÂïèÈ°å„ÅÆËß£Á≠î„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"stat-text-sub",children:"ÂïèÈ°å„ÇíËß£„Åè„Å®ÂçòÂÖÉ„Åî„Å®„ÅÆÊàêÁ∏æ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})}):l&&re?u.jsxs("div",{className:"word-detail-container",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",l," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[re.statusIcon," ",re.statusLabel]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[re.correctCount,"/",re.totalCount,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),re.accuracyHistory&&re.accuracyHistory.length>0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:re.accuracyHistory}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[re.retentionRate,"%"]}),re.position!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),u.jsx("span",{className:"word-stat-label",children:"Position:"}),u.jsx("strong",{className:"word-stat-value",children:re.position.toFixed(0)})]})]}),(re.memorizationPosition!==void 0||re.translationPosition!==void 0||re.spellingPosition!==void 0||re.grammarPosition!==void 0)&&u.jsxs("div",{className:"word-detail-stats",children:[re.memorizationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊöóË®ò:"}),u.jsx("strong",{className:"word-stat-value",children:re.memorizationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),re.translationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÂíåË®≥:"}),u.jsx("strong",{className:"word-stat-value",children:re.translationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),re.spellingPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"„Çπ„Éö„É´:"}),u.jsx("strong",{className:"word-stat-value",children:re.spellingPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),re.grammarPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊñáÊ≥ï:"}),u.jsx("strong",{className:"word-stat-value",children:re.grammarPosition.toFixed(0)})]})]})]}):l&&!re?u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì"})}):u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"ÂïèÈ°å„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅÁèæÂú®„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})})})})}),P==="settings"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"settings-tab-container",children:u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆ„Çø„Éñ„ÅÆË®≠ÂÆö„ÅØÂ≠¶ÁøíË®≠ÂÆö„Éë„Éç„É´„Åã„ÇâË°å„Åà„Åæ„Åô"})})})})})]})}const ip=[{id:"beginner-basic",name:"ÂàùÁ¥öÂü∫Á§é",requiredWords:600,requiredAccuracy:70,description:"Âü∫Êú¨ÁöÑ„Å™ÂçòË™û",icon:"üå±"},{id:"beginner-complete",name:"ÂàùÁ¥öÂÆå‰∫Ü",requiredWords:1077,requiredAccuracy:70,description:"ÂàùÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üåø"},{id:"intermediate-half",name:"‰∏≠Á¥öÂçäÂàÜ",requiredWords:1900,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´50%",icon:"üå≥"},{id:"intermediate-complete",name:"‰∏≠Á¥öÂÆå‰∫Ü",requiredWords:2693,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üéì"},{id:"advanced-half",name:"‰∏äÁ¥öÂçäÂàÜ",requiredWords:3150,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´50%",icon:"üìö"},{id:"advanced-complete",name:"‰∏äÁ¥öÂÆå‰∫Ü",requiredWords:3578,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üöÄ"},{id:"master",name:"„Éû„Çπ„Çø„Éº",requiredWords:4e3,requiredAccuracy:85,description:"ÂÖ®„É¨„Éô„É´Âà∂Ë¶á",icon:"‚≠ê"}];function BX(){const n=localStorage.getItem("user-goal-level");if(n){const e=JSON.parse(n),t=ip.find(s=>s.id===e);if(t)return t}return ip.find(e=>e.id==="intermediate-complete")||ip[0]}function II(n){const e=n||BX(),t=et(),s=$h();let r=0,o=0;Object.values(t.wordProgress).forEach(m=>{r+=m.correctCount,o+=m.correctCount+m.incorrectCount});const i=o>0?r/o*100:0,a=Math.min(100,s/e.requiredWords*100),c=Math.min(100,i/e.requiredAccuracy*100),l=(a+c)/2,d=s>=e.requiredWords&&i>=e.requiredAccuracy,h=VX(s,e.requiredWords,i,e.requiredAccuracy),p=Math.max(0,e.requiredWords-s),f=h>0?Math.ceil(p/h):0;return{goal:e,currentWords:s,currentAccuracy:Math.round(i),wordsProgress:Math.round(a),accuracyProgress:Math.round(c),overallProgress:Math.round(l),isAchieved:d,estimatedDaysToAchieve:h,recommendedDailyWords:Math.min(50,f)}}function VX(n,e,t,s){if(n>=e&&t>=s)return 0;const r=et(),i=Date.now()-7*24*60*60*1e3;let a=0;Object.values(r.wordProgress).forEach(g=>{g.lastStudied>=i&&g.masteryLevel==="mastered"&&a++});const c=a/7,l=Math.max(5,c),h=Math.max(0,e-n)/l,f=Math.max(0,s-t)*2,m=Math.ceil(h+f);return Math.max(1,m)}function QY(n=!0){const e=II();if(e.isAchieved)return`üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ${e.goal.name}„É¨„Éô„É´„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅ`;const t=[];if(t.push(`${e.goal.icon} ${e.goal.name}„Åæ„Åß ${e.overallProgress}%`),e.currentWords<e.goal.requiredWords){const s=e.goal.requiredWords-e.currentWords;t.push(`„ÅÇ„Å®${s}Ë™û`)}return e.estimatedDaysToAchieve>0&&(e.estimatedDaysToAchieve<=7?t.push(`„ÅÇ„Å®${e.estimatedDaysToAchieve}Êó•„ÅßÈÅîÊàêÔºÅ`):e.estimatedDaysToAchieve<=30?t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/7)}ÈÄ±Èñì„ÅßÈÅîÊàêË¶ãËæº„Åø`):t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/30)}„É∂Êúà„ÅßÈÅîÊàêË¶ãËæº„Åø`)),n&&(e.overallProgress>=80?t.push("„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÈÅîÊàê„Åß„ÅôÔºÅÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=50?t.push("È†ÜË™ø„Å´ÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=25&&t.push("ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ")),t.join(" ")}const UX={accept:["except"],except:["accept"],affect:["effect"],effect:["affect"],dessert:["desert"],desert:["dessert"],quiet:["quite"],quite:["quiet"],lose:["loose"],loose:["lose"],advice:["advise"],advise:["advice"],breath:["breathe"],breathe:["breath"],cloth:["clothe","clothes"],clothe:["cloth","clothes"],clothes:["cloth","clothe"],borrow:["lend"],lend:["borrow"],teach:["learn"],learn:["teach"],speak:["talk","say","tell"],talk:["speak","say","tell"],say:["speak","talk","tell"],tell:["speak","talk","say"],see:["look","watch"],look:["see","watch"],watch:["see","look"],hear:["listen"],listen:["hear"],bring:["take"],take:["bring"],come:["go"],go:["come"],in:["on","at"],on:["in","at"],at:["in","on"],for:["to","of"],to:["for","of"],of:["for","to"],already:["all ready"],"all ready":["already"],altogether:["all together"],"all together":["altogether"],everyday:["every day"],"every day":["everyday"]};function kI(n){const e=n.toLowerCase();return UX[e]||[]}function GX(){const n=et(),e=[],t=new Set;return Object.entries(n.wordProgress).forEach(([s])=>{if(t.has(s.toLowerCase()))return;const r=kI(s);if(r.length===0)return;const o=[s,...r].map(p=>p.toLowerCase()),i=Array.from(new Set(o));let a=0,c=0;i.forEach(p=>{const f=n.wordProgress[p];f&&(a+=f.incorrectCount,c+=f.correctCount+f.incorrectCount)});const l=c>0?a/c:0,d=Math.min(100,l*100*Math.log1p(c));let h="spelling";["speak","talk","say","tell","see","look","watch"].includes(s.toLowerCase())?h="meaning":["in","on","at","for","to","of"].includes(s.toLowerCase())&&(h="grammar"),e.push({words:i,type:h,description:HX(i,h),confusionScore:Math.round(d),totalErrors:a,needsReview:d>30||l>.3}),i.forEach(p=>t.add(p))}),e.filter(s=>s.totalErrors>0).sort((s,r)=>r.confusionScore-s.confusionScore)}function HX(n,e){return e==="spelling"?`„Çπ„Éö„É´„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:e==="meaning"?`ÊÑèÂë≥„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:`ÊñáÊ≥ïÁöÑ„Å´Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ: ${n.join(", ")}`}function qX(n){const e=et(),t={},s=[];n.words.forEach(i=>{const a=e.wordProgress[i];if(a){const c=a.correctCount+a.incorrectCount,l=c>0?a.correctCount/c*100:0;t[i]=l,s.push(l)}});const r=s.length>0?s.reduce((i,a)=>i+a,0)/s.length:0,o=s.length>0?s.reduce((i,a)=>i+Math.pow(a-r,2),0)/s.length:0;return{groupRetention:Math.round(r),individualRetentions:t,variance:Math.round(o)}}function KX(n){const e=qX(n);return e.groupRetention<50?`‚ö†Ô∏è ${n.words.join(", ")} „ÅÆÂå∫Âà•„ÅåÊõñÊòß„Åß„Åô„ÄÇÈõÜ‰∏≠ÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`:e.variance>500?`üìä ${n.words.join(", ")} „ÅßÂÆöÁùÄÂ∫¶„Å´„Å∞„Çâ„Å§„Åç„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂº±„ÅÑÂçòË™û„ÇíÈáçÁÇπÁöÑ„Å´„ÄÇ`:e.groupRetention<70?`üí™ ${n.words.join(", ")} „Çí„ÇÇ„ÅÜÂ∞ë„ÅóÁ∑¥Áøí„Åô„Çã„Å®ÂÆåÁíß„Åß„ÅôÔºÅ`:`‚úÖ ${n.words.join(", ")} „ÅÆÂå∫Âà•„Åå„Åó„Å£„Åã„Çä„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ`}function QX(n){const e=/^[^:]+:\s*[""](.+?)[""]$/,t=n.match(e);if(t)return t[1].trim();const s=/^[^:]+:\s*(.+)$/,r=n.match(s);return r?r[1].trim():n}function Ts(n,e={}){if(!("speechSynthesis"in window)){R.warn("„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØWeb Speech API„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì");return}const t=QX(n);if(window.speechSynthesis.speaking||window.speechSynthesis.pending){window.speechSynthesis.cancel(),setTimeout(()=>{Cy(t,e)},50);return}Cy(t,e)}function Cy(n,e){const t=new SpeechSynthesisUtterance(n),s=localStorage.getItem("speechRate"),r=localStorage.getItem("voiceGender");t.lang=e.lang||"en-US",t.rate=e.rate||(s?parseFloat(s):.85),t.pitch=e.pitch||1,t.volume=e.volume||1;const i=window.speechSynthesis.getVoices().filter(c=>c.lang.startsWith("en-")),a=["Google US English","Google UK English Female","Google UK English Male","Samantha","Alex","Microsoft Aria Online","Microsoft Guy Online","Karen","Daniel"];if(r==="female"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("female")||l.name.toLowerCase().includes("woman")||l.name.toLowerCase().includes("samantha")||l.name.toLowerCase().includes("karen")||l.name.toLowerCase().includes("aria"));c&&(t.voice=c)}else if(r==="male"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("male")||l.name.toLowerCase().includes("man")||l.name.toLowerCase().includes("alex")||l.name.toLowerCase().includes("daniel")||l.name.toLowerCase().includes("guy"));c&&(t.voice=c)}else{const c=i.find(l=>a.some(d=>l.name.includes(d)));c&&(t.voice=c)}t.onerror=c=>{R.error("Èü≥Â£∞ÂêàÊàê„Ç®„É©„Éº:",c)},window.speechSynthesis.speak(t)}function yn(){return"speechSynthesis"in window}function XX(){"speechSynthesis"in window&&window.speechSynthesis.cancel()}function YX(){"speechSynthesis"in window&&window.speechSynthesis.speaking&&window.speechSynthesis.pause()}function JX(){"speechSynthesis"in window&&window.speechSynthesis.paused&&window.speechSynthesis.resume()}function ZX(){return"speechSynthesis"in window&&window.speechSynthesis.speaking}function e9(){return"speechSynthesis"in window&&window.speechSynthesis.paused}const ta=({word:n,sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:o="medium",variant:i="icon"})=>{const[a,c]=$.useState(!1),l=e.filter(g=>g.words.some(x=>x.word===n.word)),d=l.length>0,h={small:"text-sm px-2 py-1",medium:"text-base px-3 py-1.5",large:"text-lg px-4 py-2"},p={small:"text-base",medium:"text-lg",large:"text-xl"},f=g=>{if(g.stopPropagation(),e.length===0){r();return}if(e.length===1){const x=e[0];d?s(x.id,n):t(x.id,n)}else c(!a)},m=(g,x)=>{x?s(g,n):t(g,n)};return u.jsxs("div",{className:"relative inline-block",children:[u.jsxs("button",{onClick:f,className:`
          ${h[o]}
          ${d?"bg-green-500 hover:bg-green-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}
          rounded-md font-medium transition-colors duration-200
          flex items-center gap-1
        `,title:d?`${l.length}ÂÄã„ÅÆ„Çª„ÉÉ„Éà„Å´ËøΩÂä†Ê∏à„Åø`:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Å´ËøΩÂä†",children:[u.jsx("span",{className:p[o],children:d?"‚úì":"+"}),i!=="icon"&&u.jsx("span",{children:d?"ËøΩÂä†Ê∏à„Åø":"ËøΩÂä†"})]}),a&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),u.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-80 overflow-y-auto",children:[u.jsx("div",{className:"p-2 border-b border-gray-200",children:u.jsx("p",{className:"text-sm font-medium text-gray-700",children:"„Çª„ÉÉ„Éà„ÇíÈÅ∏Êäû"})}),u.jsx("div",{className:"p-2",children:e.map(g=>{const x=g.words.some(y=>y.word===n.word);return u.jsxs("button",{onClick:()=>{m(g.id,x),c(!1)},className:`
                      w-full text-left px-3 py-2 rounded-md mb-1
                      flex items-center justify-between
                      ${x?"bg-green-50 text-green-700":"hover:bg-gray-100:bg-gray-700 text-gray-700"}
                    `,children:[u.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[u.jsx("span",{children:g.icon||"üìñ"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("p",{className:"text-sm font-medium truncate",children:g.name}),u.jsxs("p",{className:"text-xs text-gray-500",children:[g.words.length,"Ë™û"]})]})]}),u.jsx("span",{className:"text-lg ml-2",children:x?"‚úì":"+"})]},g.id)})}),u.jsx("div",{className:"p-2 border-t border-gray-200",children:u.jsx("button",{onClick:()=>{c(!1),r()},className:"w-full text-left px-3 py-2 rounded-md hover:bg-gray-100:bg-gray-700 text-blue-600 text-sm font-medium",children:"‚ûï Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})})]})]})]})};var ds=(n=>(n.MEMORY_ACQUISITION="memory_acquisition",n.COGNITIVE_LOAD="cognitive_load",n.ERROR_PREDICTION="error_prediction",n.LEARNING_STYLE="learning_style",n.LINGUISTIC_RELATIONS="linguistic_relations",n.CONTEXTUAL_LEARNING="contextual_learning",n))(ds||{}),It=(n=>(n.IMMEDIATE_REPETITION="immediate_repetition",n.TAKE_BREAK="take_break",n.USE_CONFUSION_PAIRS="use_confusion_pairs",n.REDUCE_DIFFICULTY="reduce_difficulty",n.SPACED_REPETITION="spaced_repetition",n.CONTEXTUAL_LEARNING="contextual_learning",n.GROUP_BY_THEME="group_by_theme",n.ADJUST_SESSION_LENGTH="adjust_session_length",n.USE_ETYMOLOGY="use_etymology",n.TIME_OF_DAY_OPTIMIZATION="time_of_day_optimization",n.INCREASE_EXPOSURE="increase_exposure",n.CONTINUE_NORMAL="continue_normal",n))(It||{});const t9={enabled:!1,minSignalStrength:.3,minConfidence:.5,maxActiveSignals:10,effectivenessWindowSize:50},Ns={debug:(n,e)=>{},info:(n,e)=>console.info(`[SignalDetector] ${n}`,e),warn:(n,e)=>console.warn(`[SignalDetector] ${n}`,e),error:(n,e)=>console.error(`[SignalDetector] ${n}`,e)};class n9{constructor(e){Ne(this,"config");Ne(this,"signalCache",new Map);Ne(this,"cacheTimeout",5e3);this.config=e}async initialize(){Ns.info("SignalDetector initializing..."),Ns.info("SignalDetector initialized")}async detectSignals(e,t,s){const r=Date.now(),o=[],i=[],a=`${e}-${t}-${s.attemptNumber}`,c=this.getCachedSignals(a);if(c)return c;const l=[this.detectMemoryAcquisitionSignals(e,t,s),this.detectCognitiveLoadSignals(s),this.detectErrorPredictionSignals(e,t),this.detectLearningStyleSignals(s),this.detectLinguisticRelationsSignals(e),this.detectContextualLearningSignals(e,t)];if((await Promise.allSettled(l)).forEach((f,m)=>{const g=this.getModuleName(m);f.status==="fulfilled"?(o.push(...f.value),Ns.debug(`${g} signals detected`,{count:f.value.length})):(i.push({module:g,error:f.reason}),Ns.warn(`${g} failed`,f.reason))}),o.length===0&&i.length>0)return Ns.error("All AI modules failed",{errors:i}),[];i.length>0&&o.length>0&&Ns.warn("Some AI modules failed",{failed:i.length,succeeded:o.length});const h=this.filterAndSortSignals(o);this.cacheSignals(a,h);const p=Date.now()-r;return Ns.debug("Signal detection completed",{duration:p,signalCount:h.length}),h}async detectMemoryAcquisitionSignals(e,t,s){const r=[];try{const o=this.getAcquisitionProgress(e);if(!o)return r;t==="incorrect"&&this.shouldImmediateRepeat(o)&&r.push({source:ds.MEMORY_ACQUISITION,type:It.IMMEDIATE_REPETITION,strength:this.calculateImmediateRepeatStrength(o),confidence:.9,priority:9,timestamp:Date.now(),metadata:{currentExposure:o.totalAttempts,targetExposure:o.dynamicThreshold,consecutiveErrors:this.getConsecutiveErrors(o),acquisitionProgress:this.calculateAcquisitionProgress(o)}}),t==="correct"&&o.correctRate>=.5&&r.push({source:ds.MEMORY_ACQUISITION,type:It.SPACED_REPETITION,strength:Math.min(o.correctRate,.8),confidence:.85,priority:7,timestamp:Date.now(),metadata:{correctRate:o.correctRate,consecutiveCorrect:o.consecutiveCorrectStreak}}),t==="incorrect"&&o.totalAttempts<o.dynamicThreshold&&r.push({source:ds.MEMORY_ACQUISITION,type:It.INCREASE_EXPOSURE,strength:1-o.totalAttempts/o.dynamicThreshold,confidence:.8,priority:8,timestamp:Date.now(),metadata:{currentAttempts:o.totalAttempts,targetAttempts:o.dynamicThreshold}})}catch(o){Ns.error("Memory Acquisition signal detection failed",o)}return r}async detectCognitiveLoadSignals(e){const t=[];try{const s=e.cognitiveLoad??this.estimateCognitiveLoad(e);s>.8&&t.push({source:ds.COGNITIVE_LOAD,type:It.TAKE_BREAK,strength:Math.min(s,1),confidence:.95,priority:10,timestamp:Date.now(),metadata:{cognitiveLoad:s,sessionDuration:e.sessionDuration,recommendedBreakDuration:this.calculateBreakDuration(s),fatigueLevel:this.getFatigueLevel(s)}}),s>.6&&e.recentErrors>=2&&t.push({source:ds.COGNITIVE_LOAD,type:It.REDUCE_DIFFICULTY,strength:(s+e.recentErrors/5)/2,confidence:.8,priority:8,timestamp:Date.now(),metadata:{cognitiveLoad:s,recentErrors:e.recentErrors}});const r=e.sessionDuration?e.sessionDuration/6e4:0;r>30&&t.push({source:ds.COGNITIVE_LOAD,type:It.ADJUST_SESSION_LENGTH,strength:Math.min(r/60,.6),confidence:.7,priority:6,timestamp:Date.now(),metadata:{sessionDuration:e.sessionDuration,sessionMinutes:r}})}catch(s){Ns.error("Cognitive Load signal detection failed",s)}return t}async detectErrorPredictionSignals(e,t){const s=[];try{if(t==="incorrect"){const r=this.getConfusionPairs(e);r.length>0&&s.push({source:ds.ERROR_PREDICTION,type:It.USE_CONFUSION_PAIRS,strength:Math.min(.7+r.length*.1,.9),confidence:.85,priority:8,timestamp:Date.now(),metadata:{confusionPairs:r,errorType:this.detectErrorType(e)}}),this.needsContextualLearning(e)&&s.push({source:ds.ERROR_PREDICTION,type:It.CONTEXTUAL_LEARNING,strength:.6,confidence:.75,priority:7,timestamp:Date.now(),metadata:{reason:"context_insufficient"}})}}catch(r){Ns.error("Error Prediction signal detection failed",r)}return s}async detectLearningStyleSignals(e){const t=[];try{const s=new Date().getHours(),r=this.getOptimalLearningHour(),o=Math.abs(s-r);o>3&&t.push({source:ds.LEARNING_STYLE,type:It.TIME_OF_DAY_OPTIMIZATION,strength:Math.min(o/12,.5),confidence:.6,priority:4,timestamp:Date.now(),metadata:{currentHour:s,optimalHour:r}});const i=25*60*1e3,a=Math.abs((e.sessionDuration??0)-i);a>10*60*1e3&&t.push({source:ds.LEARNING_STYLE,type:It.ADJUST_SESSION_LENGTH,strength:Math.min(a/(30*60*1e3),.6),confidence:.65,priority:5,timestamp:Date.now(),metadata:{currentSessionLength:e.sessionDuration,optimalSessionLength:i}})}catch(s){Ns.error("Learning Style signal detection failed",s)}return t}async detectLinguisticRelationsSignals(e){const t=[];try{e.length>3&&t.push({source:ds.LINGUISTIC_RELATIONS,type:It.GROUP_BY_THEME,strength:.6,confidence:.5,priority:6,timestamp:Date.now(),metadata:{simplified:!0,reason:"Èñ¢ÈÄ£Ë™ûÂΩô„Å´„Çà„Çã„Ç∞„É´„Éº„ÉóÂ≠¶Áøí„ÇíÊé®Â•®"}}),e.length>=4&&t.push({source:ds.LINGUISTIC_RELATIONS,type:It.USE_ETYMOLOGY,strength:.4,confidence:.5,priority:5,timestamp:Date.now(),metadata:{simplified:!0,reason:"Ë™ûÊ∫êÊÉÖÂ†±„ÇíÊ¥ªÁî®„Åó„ÅüÂ≠¶Áøí„ÇíÊé®Â•®"}})}catch(s){Ns.error("Linguistic Relations signal detection failed",s)}return t}async detectContextualLearningSignals(e,t){const s=[];try{if(t==="incorrect"){this.hasAvailableContexts(e)&&s.push({source:ds.CONTEXTUAL_LEARNING,type:It.CONTEXTUAL_LEARNING,strength:.75,confidence:.85,priority:7,timestamp:Date.now(),metadata:{availableContexts:this.getAvailableContextCount(e)}});const o=this.getThemeCategory(e);o&&s.push({source:ds.CONTEXTUAL_LEARNING,type:It.GROUP_BY_THEME,strength:.6,confidence:.75,priority:6,timestamp:Date.now(),metadata:{themeCategory:o}})}}catch(r){Ns.error("Contextual Learning signal detection failed",r)}return s}filterAndSortSignals(e){const t=this.config.minSignalStrength??.3,s=e.filter(r=>r.strength>=t);return s.sort((r,o)=>o.priority-r.priority),s.slice(0,this.config.maxActiveSignals)}cacheSignals(e,t){this.signalCache.set(e,t),setTimeout(()=>{this.signalCache.delete(e)},this.cacheTimeout)}getCachedSignals(e){return this.signalCache.get(e)||null}getModuleName(e){return["MemoryAcquisition","CognitiveLoad","ErrorPrediction","LearningStyle","LinguisticRelations","ContextualLearning"][e]||"Unknown"}getAcquisitionProgress(e){try{const t=`acquisition_${e}`,s=localStorage.getItem(t);if(s)return JSON.parse(s)}catch(t){Ns.warn("Failed to load acquisition progress",t)}return null}shouldImmediateRepeat(e){return this.getConsecutiveErrors(e)>=3}getConsecutiveErrors(e){let t=0;for(let s=e.todayReviews.length-1;s>=0&&!e.todayReviews[s].isCorrect;s--)t++;return t}calculateImmediateRepeatStrength(e){const t=this.getConsecutiveErrors(e);return Math.min(.8+t*.05,1)}calculateAcquisitionProgress(e){return Math.min(e.totalAttempts/e.dynamicThreshold*100,100)}estimateCognitiveLoad(e){const t=Math.min((e.sessionDuration??0)/36e5,1),s=Math.min(e.recentErrors/5,1);return(t+s)/2}calculateBreakDuration(e){return e>=.9?10*60*1e3:e>=.8?5*60*1e3:3*60*1e3}getFatigueLevel(e){return e>=.8?"high":e>=.5?"medium":"low"}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}detectErrorType(e){return"meaning"}needsContextualLearning(e){return["abstract","concept","theory","principle"].includes(e)}getOptimalLearningHour(){return 10}hasAvailableContexts(e){return!0}getAvailableContextCount(e){return 3}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const cr={debug:(n,e)=>{},info:(n,e)=>console.info(`[StrategyExecutor] ${n}`,e),warn:(n,e)=>console.warn(`[StrategyExecutor] ${n}`,e),error:(n,e)=>console.error(`[StrategyExecutor] ${n}`,e)};class s9{constructor(e){Ne(this,"config");Ne(this,"strategyHistory",[]);Ne(this,"MAX_HISTORY",20);this.config=e}async initialize(){cr.info("StrategyExecutor initializing..."),this.loadHistory(),cr.info("StrategyExecutor initialized")}selectBestStrategy(e,t){try{if(!Array.isArray(e))throw new Error("Signals must be an array");if(e.length===0)return cr.info("No signals provided, using default strategy"),this.getDefaultRecommendation();const s=this.config.minConfidence??.5,r=e.filter(c=>c.confidence>=s);if(r.length===0)return cr.warn("No signals meet confidence threshold",{totalSignals:e.length,minConfidence:this.config.minConfidence}),this.getDefaultRecommendation();const o=r.find(c=>c.priority===10);if(o)return cr.info("Critical priority signal detected",{type:o.type}),this.createRecommendation(o,r,"critical_priority");const i=r.map(c=>({signal:c,score:this.calculateScore(c,t)}));i.forEach(c=>{const l=this.calculateDiversityPenalty(c.signal.type);c.score-=l}),i.sort((c,l)=>l.score-c.score);const a=i[0];return cr.debug("Strategy selected",{strategy:a.signal.type,score:a.score,totalSignals:r.length}),this.createRecommendation(a.signal,r,"score_based",a.score)}catch(s){return cr.error("Strategy selection failed",{signals:e,error:s}),this.getFallbackRecommendation(s)}}async executeStrategy(e,t,s){const r=Date.now();try{if(!Object.values(It).includes(e))throw new Error(`Invalid strategy type: ${e}`);const o=[];switch(e){case It.IMMEDIATE_REPETITION:o.push(await this.executeImmediateRepetition(t));break;case It.TAKE_BREAK:o.push(...await this.executeTakeBreak(s));break;case It.USE_CONFUSION_PAIRS:o.push(await this.executeConfusionPairs(t));break;case It.REDUCE_DIFFICULTY:o.push(await this.executeReduceDifficulty(t));break;case It.SPACED_REPETITION:o.push(await this.executeSpacedRepetition(t));break;case It.CONTEXTUAL_LEARNING:o.push(await this.executeContextualLearning(t));break;case It.GROUP_BY_THEME:o.push(await this.executeGroupByTheme(t));break;case It.ADJUST_SESSION_LENGTH:o.push(await this.executeAdjustSessionLength(s));break;case It.USE_ETYMOLOGY:o.push(await this.executeUseEtymology(t));break;case It.TIME_OF_DAY_OPTIMIZATION:o.push(await this.executeTimeOfDayOptimization());break;case It.INCREASE_EXPOSURE:o.push(await this.executeIncreaseExposure(t));break;case It.CONTINUE_NORMAL:break;default:cr.warn(`No execution logic for strategy: ${e}`)}return this.recordUsage(e),{success:!0,strategy:e,actions:o,duration:Date.now()-r}}catch(o){return cr.error("Strategy execution failed",{strategy:e,word:t,error:o}),{success:!1,strategy:e,actions:[],duration:Date.now()-r,error:o instanceof Error?o.message:String(o)}}}async executeImmediateRepetition(e){return{type:"QUEUE_FRONT",timestamp:Date.now(),metadata:{word:e,position:0,queueType:"immediate"}}}async executeTakeBreak(e){const t=this.calculateBreakDuration(e);return[{type:"PAUSE_SESSION",timestamp:Date.now(),metadata:{duration:t,reason:"cognitive_load"}},{type:"SHOW_BREAK_NOTIFICATION",timestamp:Date.now(),metadata:{message:`${t/6e4}ÂàÜÈñì„ÅÆ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô`}}]}async executeConfusionPairs(e){const t=this.getConfusionPairs(e);return{type:"LOAD_CONFUSION_PAIRS",timestamp:Date.now(),metadata:{word:e,pairs:t}}}async executeReduceDifficulty(e){return{type:"ADJUST_DIFFICULTY",timestamp:Date.now(),metadata:{word:e,direction:"decrease",amount:1}}}async executeSpacedRepetition(e){return{type:"SCHEDULE_SPACED_REVIEW",timestamp:Date.now(),metadata:{word:e,nextReviewTime:Date.now()+24*60*60*1e3}}}async executeContextualLearning(e){return{type:"SHOW_CONTEXT_EXAMPLES",timestamp:Date.now(),metadata:{word:e,exampleCount:3}}}async executeGroupByTheme(e){const t=this.getThemeCategory(e);return{type:"GROUP_WORDS_BY_THEME",timestamp:Date.now(),metadata:{word:e,theme:t}}}async executeAdjustSessionLength(e){return{type:"ADJUST_SESSION_LENGTH",timestamp:Date.now(),metadata:{currentLength:e.sessionDuration,recommendedLength:15e5}}}async executeUseEtymology(e){return{type:"SHOW_ETYMOLOGY",timestamp:Date.now(),metadata:{word:e}}}async executeTimeOfDayOptimization(){return{type:"SUGGEST_OPTIMAL_TIME",timestamp:Date.now(),metadata:{optimalHour:10,message:"Â≠¶ÁøíÂäπÊûú„ÅåÊúÄ„ÇÇÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÅØ10ÊôÇÈ†É„Åß„Åô"}}}async executeIncreaseExposure(e){return{type:"INCREASE_EXPOSURE_FREQUENCY",timestamp:Date.now(),metadata:{word:e,multiplier:1.5}}}calculateScore(e,t){const s=e.strength*e.priority,r=e.confidence*2;let o=0;const i=t.get(e.type);if(i){o=i.successRate*3;const a=Date.now()-i.lastUsed,c=Math.max(0,2-a/1e6);o-=c}return s+r+o}calculateDiversityPenalty(e){return this.strategyHistory.slice(-5).filter(s=>s.strategy===e).length*.5}createRecommendation(e,t,s,r){return{strategy:e.type,confidence:e.confidence,reason:this.generateReason(e),signals:t,metadata:{selectionMethod:s,score:r,signalSource:e.source}}}generateReason(e){return{[It.IMMEDIATE_REPETITION]:"ÈÄ£Á∂ö„Ç®„É©„Éº„ÅåÊ§úÂá∫„Åï„Çå„Åü„Åü„ÇÅ„ÄÅÂç≥Â∫ß„Å´Âæ©Áøí„Åó„Åæ„Åô",[It.TAKE_BREAK]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô",[It.USE_CONFUSION_PAIRS]:"Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑÂçòË™û„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü",[It.REDUCE_DIFFICULTY]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅÈõ£ÊòìÂ∫¶„Çí‰∏ã„Åí„Åæ„Åô",[It.SPACED_REPETITION]:"ÁøíÂæó„ÅåÈÄ≤„Çì„Åß„ÅÑ„Çã„Åü„ÇÅ„ÄÅÈñìÈöî„ÇíÁ©∫„Åë„Å¶Âæ©Áøí„Åó„Åæ„Åô",[It.CONTEXTUAL_LEARNING]:"ÊñáËÑà‰æãÊñá„ÅßÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô",[It.GROUP_BY_THEME]:"Èñ¢ÈÄ£Ë™ûÂΩô„Å®„Çª„ÉÉ„Éà„ÅßÂ≠¶Áøí„Åó„Åæ„Åô",[It.ADJUST_SESSION_LENGTH]:"„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑„ÇíÊúÄÈÅ©Âåñ„Åó„Åæ„Åô",[It.USE_ETYMOLOGY]:"Ë™ûÊ∫êÊÉÖÂ†±„ÅßË®òÊÜ∂„ÇíÂº∑Âåñ„Åó„Åæ„Åô",[It.TIME_OF_DAY_OPTIMIZATION]:"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø„ÇíÊèêÊ°à„Åó„Åæ„Åô",[It.INCREASE_EXPOSURE]:"Èú≤Âá∫ÂõûÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Å¶ÂÆöÁùÄ„Çí‰øÉÈÄ≤„Åó„Åæ„Åô",[It.CONTINUE_NORMAL]:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô"}[e.type]||"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊà¶Áï•„ÇíÈÅ©Áî®„Åó„Åæ„Åô"}getDefaultRecommendation(){return{strategy:It.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!1,default:!0}}}getFallbackRecommendation(e){return{strategy:It.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:e==null?void 0:e.message}}}recordUsage(e){this.strategyHistory.push({strategy:e,timestamp:Date.now()}),this.strategyHistory.length>this.MAX_HISTORY&&this.strategyHistory.shift(),this.saveHistory()}saveHistory(){try{localStorage.setItem("adaptive_strategy_history",JSON.stringify(this.strategyHistory))}catch(e){cr.warn("Failed to save strategy history",e)}}loadHistory(){try{const e=localStorage.getItem("adaptive_strategy_history");e&&(this.strategyHistory=JSON.parse(e))}catch(e){cr.warn("Failed to load strategy history",e)}}calculateBreakDuration(e){const t=e.cognitiveLoad??.5;return t>=.9?10*60*1e3:t>=.8?5*60*1e3:3*60*1e3}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const Cr={debug:(n,e)=>{},info:(n,e)=>console.info(`[EffectivenessTracker] ${n}`,e),warn:(n,e)=>console.warn(`[EffectivenessTracker] ${n}`,e),error:(n,e)=>console.error(`[EffectivenessTracker] ${n}`,e)},Ny="adaptive_network_effectiveness";class r9{constructor(e){Ne(this,"effectiveness",new Map);Ne(this,"measurements",[]);Ne(this,"config");Ne(this,"saveTimer",null);this.config=e}async initialize(){Cr.info("EffectivenessTracker initializing..."),await this.loadHistory(),Cr.info("EffectivenessTracker initialized",{strategies:this.effectiveness.size,measurements:this.measurements.length})}recordOutcome(e,t){try{if(!Object.values(It).includes(e))throw new Error(`Invalid strategy: ${e}`);if(typeof t.success!="boolean")throw new Error("Outcome.success must be boolean");let s=this.effectiveness.get(e);s||(s=this.createDefaultEffectiveness(e),this.effectiveness.set(e,s)),s.totalUses++,t.success?s.successCount++:s.failureCount++,s.successRate=s.successCount/s.totalUses,s.lastUsed=t.timestamp,t.timeToMastery!==void 0&&this.updateAverage(s,"averageTimeToMastery",t.timeToMastery),t.retentionRate!==void 0&&this.updateAverage(s,"averageRetentionRate",t.retentionRate),s.confidence=this.calculateConfidence(s.totalUses),this.measurements.push({strategy:e,outcome:t,timestamp:Date.now()});const r=this.config.effectivenessWindowSize??50;this.measurements.length>r*2&&(this.measurements=this.measurements.slice(-r)),Cr.debug("Outcome recorded",{strategy:e,success:t.success,totalUses:s.totalUses,successRate:s.successRate}),this.debounceSave()}catch(s){Cr.error("Failed to record outcome",{strategy:e,outcome:t,error:s})}}getEffectiveness(e){return this.effectiveness.get(e)}getAllEffectiveness(){return new Map(this.effectiveness)}compareStrategies(e,t){const s=this.effectiveness.get(e),r=this.effectiveness.get(t);if(!s||!r)return{strategy1:e,strategy2:t,betterStrategy:null,successRateDiff:0,confidenceLevel:0,recommendation:"„Éá„Éº„Çø‰∏çË∂≥„ÅÆ„Åü„ÇÅÊØîËºÉ„Åß„Åç„Åæ„Åõ„Çì"};const o=s.successRate-r.successRate,i=this.calculateStatisticalSignificance(s,r);let a=null;Math.abs(o)>.05&&i>.8&&(a=o>0?e:t);let c="";return a?c=`${a}„ÅÆÊñπ„ÅåÂäπÊûúÁöÑ„Åß„ÅôÔºàÂ∑Æ: ${(Math.abs(o)*100).toFixed(1)}%Ôºâ`:i<.8?c="„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô":c="‰∏°Êà¶Áï•„ÅÆÂäπÊûú„ÅØÂêåÁ®ãÂ∫¶„Åß„Åô",{strategy1:e,strategy2:t,betterStrategy:a,successRateDiff:o,confidenceLevel:i,recommendation:c}}exportMetrics(){const e=Array.from(this.effectiveness.values()),t=e.filter(i=>i.totalUses>=10).sort((i,a)=>a.successRate-i.successRate).slice(0,3).map(i=>({strategy:i.strategyType,successRate:i.successRate,uses:i.totalUses})),s=[];t.length>0&&s.push(`ÊúÄ„ÇÇÂäπÊûúÁöÑ„Å™Êà¶Áï•: ${t[0].strategy}ÔºàÊàêÂäüÁéá: ${(t[0].successRate*100).toFixed(1)}%Ôºâ`);const r=e.filter(i=>i.totalUses>=10&&i.successRate<.5).map(i=>i.strategyType);r.length>0&&s.push(`ÊîπÂñÑ„ÅåÂøÖË¶Å„Å™Êà¶Áï•: ${r.join(", ")}`);const o=e.filter(i=>i.totalUses<10);return o.length>0&&s.push(`„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å: ${o.length}ÂÄã„ÅÆÊà¶Áï•`),{topPerformers:t,recommendations:s,timestamp:Date.now()}}reset(){Cr.info("Resetting effectiveness data"),this.effectiveness.clear(),this.measurements=[],this.saveToStorage()}createDefaultEffectiveness(e){return{strategyType:e,totalUses:0,successCount:0,failureCount:0,successRate:0,averageTimeToMastery:0,averageRetentionRate:0,lastUsed:0,confidence:0}}updateAverage(e,t,s){const r=e[t],o=e.totalUses;e[t]=(r*(o-1)+s)/o}calculateConfidence(e){return Math.min(1,e/(e+2+2))}calculateStatisticalSignificance(e,t){const s=e.totalUses,r=t.totalUses,o=Math.abs(e.successRate-t.successRate);return(Math.min(1,(s+r)/100)+o)/2}async loadHistory(){try{const e=localStorage.getItem(Ny);if(!e){Cr.info("No stored effectiveness data found");return}const t=JSON.parse(e);t.strategies&&t.strategies.forEach(s=>{this.effectiveness.set(s.strategyType,s)}),Array.isArray(t.measurements)&&(this.measurements=t.measurements),Cr.info("Effectiveness data loaded",{strategies:this.effectiveness.size,measurements:this.measurements.length})}catch(e){Cr.error("Failed to load effectiveness data",e)}}saveToStorage(){try{const e={version:"1.0.0",strategies:Array.from(this.effectiveness.values()),measurements:this.measurements,lastUpdated:Date.now()};localStorage.setItem(Ny,JSON.stringify(e)),Cr.debug("Effectiveness data saved")}catch(e){Cr.warn("Failed to save effectiveness data",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveToStorage(),this.saveTimer=null},500)}}const tn={debug:(n,e)=>{},info:(n,e)=>console.info(`[AdaptiveNetwork] ${n}`,e),warn:(n,e)=>console.warn(`[AdaptiveNetwork] ${n}`,e),error:(n,e)=>console.error(`[AdaptiveNetwork] ${n}`,e)},ap="adaptive_network_state",o9="adaptive_network_config";class i9{constructor(e){Ne(this,"signalDetector");Ne(this,"strategyExecutor");Ne(this,"effectivenessTracker");Ne(this,"state");Ne(this,"config");Ne(this,"saveTimer",null);this.config={...t9,...e},this.state=this.createInitialState(),this.signalDetector=new n9(this.config),this.strategyExecutor=new s9(this.config),this.effectivenessTracker=new r9(this.config),this.loadState(),tn.info("AdaptiveEducationalAINetwork created",{enabled:this.config.enabled})}async initialize(){tn.info("Initializing AdaptiveEducationalAINetwork...");try{await Promise.all([this.signalDetector.initialize(),this.strategyExecutor.initialize(),this.effectivenessTracker.initialize()]),this.validateAndRepairState(),tn.info("AdaptiveEducationalAINetwork initialized successfully")}catch(e){tn.error("Initialization failed",e);try{this.initializeWithDefaults(),tn.info("Initialized with default configuration")}catch{throw new Error(`Failed to initialize Adaptive Network: ${e instanceof Error?e.message:String(e)}`)}}}async processQuestion(e,t,s){try{this.validateInput(e,t,s)}catch(r){return tn.error("Invalid input",{word:e,result:t,context:s,error:r}),this.getDefaultRecommendation()}if(!this.state.enabled)return this.getDefaultRecommendation();try{const r=await this.signalDetector.detectSignals(e,t,s);tn.debug("Signals detected",{word:e,result:t,signalCount:r.length});const o=this.strategyExecutor.selectBestStrategy(r,this.state.effectiveness);return tn.info("Strategy selected",{word:e,result:t,strategy:o.strategy,confidence:o.confidence}),this.executeStrategyAsync(o.strategy,e,s),this.updateState(o,r),this.updateSessionStats(t),this.debounceSave(),o}catch(r){return tn.error("Question processing failed",{word:e,result:t,context:s,error:r}),{strategy:It.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{error:!0,fallback:!0,errorMessage:r instanceof Error?r.message:String(r)}}}}getState(){return{...this.state}}updateConfig(e){this.config={...this.config,...e},e.enabled!==void 0&&(this.state.enabled=e.enabled),this.saveConfig(),tn.info("Configuration updated",e)}resetState(){tn.info("Resetting network state"),this.state=this.createInitialState(),this.effectivenessTracker.reset();try{localStorage.removeItem(ap)}catch(e){tn.warn("Failed to remove state from storage",e)}tn.info("Network state reset complete")}exportState(){const e={version:"1.0.0",state:this.state,config:this.config,effectiveness:Array.from(this.state.effectiveness.entries()),exportedAt:Date.now()};return JSON.stringify(e,null,2)}importState(e){try{const t=JSON.parse(e);t.version!=="1.0.0"&&tn.warn("Version mismatch, attempting migration",{expected:"1.0.0",actual:t.version}),t.state&&(this.state={...t.state,effectiveness:new Map(t.effectiveness||[])}),t.config&&(this.config=t.config),this.saveState(),this.saveConfig(),tn.info("State imported successfully")}catch(t){throw tn.error("Failed to import state",t),new Error(`Invalid state data: ${t instanceof Error?t.message:String(t)}`)}}createInitialState(){return{enabled:this.config.enabled,currentStrategy:null,activeSignals:[],effectiveness:new Map,sessionStats:{questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0},lastUpdated:Date.now()}}initializeWithDefaults(){this.state=this.createInitialState(),tn.info("Initialized with defaults")}validateInput(e,t,s){if(!e||typeof e!="string")throw new Error("Invalid word parameter");if(t!=="correct"&&t!=="incorrect")throw new Error('Result must be "correct" or "incorrect"');if(!s||typeof s!="object")throw new Error("Invalid context parameter")}getDefaultRecommendation(){return{strategy:It.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}async executeStrategyAsync(e,t,s){try{const r=await this.strategyExecutor.executeStrategy(e,t,s);r.success?tn.debug("Strategy executed",{strategy:e,actionCount:r.actions.length,duration:r.duration}):tn.warn("Strategy execution failed",{strategy:e,error:r.error})}catch(r){tn.error("Strategy execution error",{strategy:e,error:r})}}updateState(e,t){this.state.currentStrategy=e.strategy,this.state.activeSignals=t,this.state.lastUpdated=Date.now()}updateSessionStats(e){this.state.sessionStats.questionsAnswered++,e==="correct"?this.state.sessionStats.correctAnswers++:this.state.sessionStats.incorrectAnswers++,this.state.sessionStats.totalSessionTime=Date.now()-this.state.sessionStats.sessionStartTime}validateAndRepairState(){typeof this.state.enabled!="boolean"&&(tn.warn("Invalid enabled state, repairing"),this.state.enabled=!1),Array.isArray(this.state.activeSignals)||(tn.warn("Invalid activeSignals, repairing"),this.state.activeSignals=[]),this.state.effectiveness instanceof Map||(tn.warn("Invalid effectiveness map, repairing"),this.state.effectiveness=new Map),(!this.state.sessionStats||typeof this.state.sessionStats!="object")&&(tn.warn("Invalid sessionStats, repairing"),this.state.sessionStats={questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0})}loadState(){try{const e=localStorage.getItem(ap);if(!e){tn.info("No stored state found");return}const t=JSON.parse(e);t.effectiveness&&Array.isArray(t.effectiveness)&&(t.effectiveness=new Map(t.effectiveness)),this.state={...this.state,...t},tn.info("State loaded from storage")}catch(e){tn.error("Failed to load state",e)}}saveState(){try{const e={...this.state,effectiveness:Array.from(this.state.effectiveness.entries())};localStorage.setItem(ap,JSON.stringify(e)),tn.debug("State saved to storage")}catch(e){tn.warn("Failed to save state",e)}}saveConfig(){try{localStorage.setItem(o9,JSON.stringify(this.config))}catch(e){tn.warn("Failed to save config",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveState(),this.saveTimer=null},500)}}function Eh(){const n=$.useRef(null),[e,t]=$.useState(!0),[s,r]=$.useState(null),[o,i]=$.useState(new Map),[a,c]=$.useState(!1),[l,d]=$.useState(null),[h,p]=$.useState(!1);$.useEffect(()=>{(async()=>{try{if(!n.current){n.current=new i9({enabled:!0}),await n.current.initialize();const b=n.current.getState();t(b.enabled),r(b.currentStrategy),i(b.effectiveness),p(!0),console.log("[useAdaptiveNetwork] Network initialized")}}catch(b){d(b instanceof Error?b:new Error(String(b))),console.error("[useAdaptiveNetwork] Initialization failed",b)}})()},[]);const f=$.useCallback(async(y,b,v)=>{if(!n.current)return console.warn("[useAdaptiveNetwork] Network not initialized"),a9();c(!0),d(null);try{const w=await n.current.processQuestion(y,b,v);r(w.strategy);const S=n.current.getState();return i(S.effectiveness),w}catch(w){const S=w instanceof Error?w:new Error(String(w));return d(S),console.error("[useAdaptiveNetwork] Question processing failed",w),c9(S)}finally{c(!1)}},[e]),m=$.useCallback(()=>{if(!n.current)return;const y=!e;n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`)},[e]),g=$.useCallback(y=>{n.current&&(n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`))},[]),x=$.useCallback(()=>{n.current&&(n.current.resetState(),r(null),i(new Map),d(null),console.log("[useAdaptiveNetwork] State reset"))},[]);return{enabled:e,currentStrategy:s,processQuestion:f,toggleEnabled:m,setEnabled:g,resetState:x,effectiveness:o,isLoading:a,error:l,isInitialized:h}}function a9(){return{strategy:It.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}function c9(n){return{strategy:It.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:n.message}}}function Iy({question:n,allQuestions:e,currentIndex:t,answered:s,selectedAnswer:r,onAnswer:o,onNext:i,onPrevious:a,onDifficultyRate:c,customQuestionSets:l=[],onAddWordToCustomSet:d,onRemoveWordFromCustomSet:h,onOpenCustomSetManagement:p,onFullscreen:f}){const m=$.useMemo(()=>aI(n,e,t),[n.word,e,t]),[g,x]=$.useState(null),[y,b]=$.useState(new Set),[v,w]=$.useState(""),[S,N]=$.useState(0),[,C]=$.useState(()=>{const V=sessionStorage.getItem("currentCorrectStreak");return V?parseInt(V,10):0}),{processQuestion:k}=Eh(),I=async(V,L)=>{try{const H=xe=>{const $e=(xe.grade||1)/9;return Math.min(Math.max($e,0),1)},J=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter($e=>!$e.correct).length,X=()=>{const xe=sessionStorage.getItem("sessionStartTime");return xe?Math.floor((Date.now()-parseInt(xe))/6e4):0},fe=()=>parseInt(sessionStorage.getItem("currentCorrectStreak")||"0"),be=()=>{const xe=new Date().getHours();return xe<12?"morning":xe<18?"afternoon":xe<22?"evening":"night"},oe=await k(V,L?"correct":"incorrect",{currentDifficulty:H(n),timeOfDay:be(),recentErrors:J(),sessionLength:X(),consecutiveCorrect:fe()});console.log("[AdaptiveAI]",oe.reason,{strategy:oe.strategy,confidence:oe.confidence})}catch(H){console.error("[QuestionCard] Adaptive AI error:",H)}},T=$.useRef(0),_=$.useRef(0),D=$.useRef(null),P=$.useRef(!1);$.useEffect(()=>{x(null),b(new Set),w(""),N(0)},[t]);const A=V=>{b(L=>{const H=new Set(L);return s?H.size>0?new Set:new Set(m.map((J,X)=>X)):(H.has(V)?H.delete(V):H.add(V),H)})};$.useEffect(()=>{const V=localStorage.getItem("autoShowDetails")!=="false";s&&r&&r!==n.meaning&&V&&b(new Set(m.map((L,H)=>H)))},[s,r,n.meaning,m]),$.useEffect(()=>{if(s&&r){const V=localStorage.getItem("aiPersonality")||"kind-teacher",L=r===n.meaning,H=parseInt(sessionStorage.getItem("currentCorrectStreak")||"0",10);let J=CI(V,{isCorrect:L,word:n.word,difficulty:"intermediate",category:"",attemptCount:S+1,responseTime:0,correctStreak:0,incorrectStreak:0,userAccuracy:0,categoryAccuracy:0,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:0,todayAccuracy:0,planProgress:0,timeOfDay:N0()});const X=[];if(L&&Math.random()<.1){const oe=II();oe.estimatedDaysToAchieve>0&&oe.estimatedDaysToAchieve<=30&&(oe.overallProgress>=90?X.push(`üéØ ${oe.goal.name}„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ`):oe.overallProgress>=75&&X.push(`üìà „Åì„ÅÆ„Éö„Éº„Çπ„Å™„Çâ${oe.estimatedDaysToAchieve}Êó•„Åß${oe.goal.name}ÈÅîÊàê„Åß„ÅôÔºÅ`))}if(!L){const oe=kI(n.word);oe.length>0&&X.push(`üí° „Äå${n.word}„Äç„Å®„Äå${oe.join(", ")}„Äç„ÇíÊ∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßÊ≥®ÊÑèÔºÅ`)}if(!L&&Math.random()<.05){const xe=GX().find($e=>$e.words.includes(n.word.toLowerCase())&&$e.needsReview);xe&&X.push(KX(xe))}const fe=AX(V,L,H);if(fe&&X.push(fe.message),L){const oe=DX(H+1);oe&&X.push(oe)}const be=LX(L);if(be&&X.push(be),L){const oe=H+1;C(oe),sessionStorage.setItem("currentCorrectStreak",String(oe))}else C(0),sessionStorage.setItem("currentCorrectStreak","0");X.length>0&&(J=`${J} ${X[0]}`),w(J)}else w("")},[s,r,n,S]);const F=()=>{b(new Set),N(0),i()};$.useEffect(()=>{const V=X=>{const fe=X.target;fe.closest(".choice-btn")||fe.closest(".toggle-details-btn")||fe.closest(".rating-btn")||fe.closest(".inline-nav-btn")||fe.closest(".question-text")||(T.current=X.touches[0].clientX,P.current=!0)},L=X=>{T.current!==0&&(_.current=X.touches[0].clientX)},H=()=>{if(T.current===0){P.current=!1;return}const X=T.current-_.current;Math.abs(X)>80&&(X>0?s?F():i():t>0&&a()),T.current=0,_.current=0,setTimeout(()=>{P.current=!1},300)},J=D.current;if(J)return J.addEventListener("touchstart",V,{passive:!0}),J.addEventListener("touchmove",L,{passive:!0}),J.addEventListener("touchend",H),()=>{J.removeEventListener("touchstart",V),J.removeEventListener("touchmove",L),J.removeEventListener("touchend",H)}},[s,t,i,a]),$.useEffect(()=>{const V=L=>{if(!s&&["1","2","3","4"].includes(L.key)){const H=parseInt(L.key)-1;if(H<m.length){L.preventDefault();const J=m[H].text,X=m[H].question,fe=J===n.meaning;fe||N(be=>be+1),o(J,n.meaning,X),I(n.word,fe)}}else!s&&L.key===" "?(L.preventDefault(),i()):L.key==="Enter"&&(L.preventDefault(),s?F():i())};return window.addEventListener("keydown",V),()=>{window.removeEventListener("keydown",V)}},[s,m,n,o,S]);const O=V=>{const L="w-full min-h-11 sm:min-h-14 p-2 sm:p-4 text-sm sm:text-base rounded-xl border-2 cursor-pointer transition-all duration-300 flex flex-col items-center text-center touch-manipulation select-none shadow-sm",H="hover:border-blue-600 hover:bg-gray-100:bg-gray-800 hover:-translate-y-1 hover:shadow-lg",J="active:bg-gray-200:bg-gray-700 active:translate-y-0";return V==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?s?V===r?`${L} bg-red-600 border-red-600 text-white`:`${L} bg-gray-100 text-gray-600 border-gray-400`:`${L} bg-gray-100 text-gray-600 border-gray-400 ${H} ${J}`:s?V===n.meaning?`${L} bg-green-600 border-green-600 text-white`:V===r&&V!==n.meaning?`${L} bg-red-600 border-red-600 text-white`:`${L} bg-gray-50 text-gray-900 border-gray-300`:`${L} bg-gray-50 text-gray-900 border-gray-300 ${H} ${J}`};return u.jsxs("div",{className:"question-card",ref:D,children:[f&&u.jsx("button",{onClick:f,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:a,disabled:t===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:`question-content-inline ${yn()?"clickable-pronunciation":""}`,onClick:V=>{yn()&&(V.preventDefault(),V.stopPropagation(),Ts(n.word,{rate:.85}))},onTouchEnd:V=>{yn()&&(V.preventDefault(),V.stopPropagation(),Ts(n.word,{rate:.85}))},title:yn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 break-words ${n.word.includes(" ")?"phrase-text":""} ${yn()?"clickable-word":""}`,children:[n.word,yn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),n.reading&&u.jsxs("div",{className:"question-reading text-sm sm:text-base text-gray-600 mt-1",children:["„Äê",n.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[n.difficulty&&u.jsx("div",{className:`difficulty-badge ${n.difficulty}`,children:n.difficulty==="beginner"?"ÂàùÁ¥ö":n.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),d&&h&&p&&l&&u.jsx(ta,{word:{word:n.word,meaning:n.meaning,katakana:n.reading,source:"translation"},sets:l,onAddWord:d,onRemoveWord:h,onOpenManagement:p,size:"medium",variant:"both"})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:F,title:"Ê¨°„Å∏",children:"‚Üí"})]}),u.jsx("div",{className:"choices",children:m.map((V,L)=>{const H=y.has(L),J=V.question;return u.jsxs("div",{className:"choice-wrapper",children:[u.jsx("button",{className:O(V.text),onClick:X=>{if(s){X.preventDefault(),X.stopPropagation(),J&&A(L);return}const fe=V.text===n.meaning;fe||N(be=>be+1),o(V.text,n.meaning,J),I(n.word,fe)},disabled:!1,children:u.jsx("div",{className:"choice-content",children:u.jsx("div",{className:"choice-text",children:V.text})})}),s&&J&&H&&u.jsxs("div",{className:"choice-details",children:[u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™ûÂè•:"}),u.jsx("span",{className:"detail-text",children:J.word})]}),J.reading&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-text",children:J.reading})]}),J.meaning&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-text",children:J.meaning})]}),J.etymology&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠â:"}),u.jsx("span",{className:"detail-text",children:J.etymology})]}),J.relatedWords&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-text",children:J.relatedWords})]}),J.relatedFields&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è ÂàÜÈáé:"}),u.jsx("span",{className:"detail-text",children:J.relatedFields})]}),J.difficulty&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("span",{className:"detail-text",children:J.difficulty})]})]})]},L)})})]})}const I0="ab_session_logs_v1",ky=300;function l9(n){try{const e=k0();e.push(n),e.length>ky&&e.splice(0,e.length-ky),localStorage.setItem(I0,JSON.stringify(e))}catch(e){console.error("[AB Storage] Failed to append session log:",e)}}function k0(){try{const n=localStorage.getItem(I0);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch(n){return console.error("[AB Storage] Failed to load session logs:",n),[]}}function u9(){const n=k0();return JSON.stringify(n,null,2)}function d9(){try{localStorage.removeItem(I0)}catch(n){console.error("[AB Storage] Failed to clear session logs:",n)}}function cp(n){if(n.length===0)return 0;const e=[...n].sort((s,r)=>s-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}function Ql(n){return n.length===0?0:n.reduce((e,t)=>e+t,0)/n.length}function lp(n,e){const t=n.filter(a=>a.variant===e);if(t.length===0)return null;const s=t.map(a=>a.acquiredWordCount),r=t.map(a=>a.acquisitionRate),o=t.map(a=>a.vibrationScore),i=t.map(a=>a.durationSec);return{variant:e,sessionCount:t.length,avgAcquiredWords:Ql(s),medianAcquiredWords:cp(s),avgAcquisitionRate:Ql(r),medianAcquisitionRate:cp(r),avgVibrationScore:Ql(o),medianVibrationScore:cp(o),avgDurationSec:Ql(i)}}function $y(){const n=k0();return{totalSessions:n.length,byVariant:{A:lp(n,"A"),B:lp(n,"B"),C:lp(n,"C")},lastUpdated:Date.now()}}function Yr(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function h9(n,e){if(!n)return null;switch(e){case"memorization":return n.memorizationPosition??null;case"translation":return n.translationPosition??null;case"spelling":return n.spellingPosition??null;case"grammar":return n.grammarPosition??null}}function up(n,e){if(!n)return 0;switch(e){case"memorization":return Yr(n.memorizationAttempts,0);case"translation":return Yr(n.translationAttempts,0);case"spelling":return Yr(n.spellingAttempts,0);case"grammar":return Yr(n.grammarAttempts,0)}}function Ty(n,e){if(!n)return 0;switch(e){case"memorization":return Yr(n.memorizationCorrect,0);case"translation":return Yr(n.translationCorrect,0);case"spelling":return Yr(n.spellingCorrect,0);case"grammar":return Yr(n.grammarCorrect,0)}}function Ay(n,e){return!n||e!=="memorization"?0:Yr(n.memorizationStillLearning,0)}function Li(n){const{value:e}=Yy("debug_postProcess_output",{mode:n});return e?Array.isArray(e)?e:Array.isArray(e==null?void 0:e.top30)?e.top30:[]:[]}function p9(n){return Yy("debug_postProcess_meta",{mode:n}).value}function Rh({mode:n,currentIndex:e,totalQuestions:t,questions:s,requeuedWords:r=[],initialExpanded:o=!0}){const[i,a]=$.useState(o),[c,l]=$.useState([]),[d,h]=$.useState(!1),[p,f]=$.useState([]),[m,g]=$.useState(null),[x,y]=$.useState([]),[b,v]=$.useState([]),[w,S]=$.useState(null);$.useEffect(()=>{const C=rp(n);f(C)},[e,n]),$.useEffect(()=>{if(i){const C=$y();S(C)}},[i,e]);const N=()=>{var dt,re,de,q,Z,Ce,_e,De,Ie,Dt;const C=new Date().toISOString(),k=et(),I=Object.keys(k.wordProgress||{}).length,T=Object.values(k.wordProgress||{}),_=T.filter(j=>h9(j,n)==null).length,D=T.filter(j=>(j==null?void 0:j.category)==null).length,P=T.filter(j=>(j==null?void 0:j.lastStudied)==null).length,A=T.filter(j=>(j==null?void 0:j.correctCount)==null||(j==null?void 0:j.incorrectCount)==null||(j==null?void 0:j.consecutiveCorrect)==null).length;let F=0,O=0,V=0,L=0,H=0,J=0,X=0;for(const j of T){const z=up(j,n),U=Ty(j,n),M=Ay(j,n),ie=Bt(j,n);H+=z,J+=U,X+=M,z!==0&&(ie>=70?(V++,L++):ie>=40?(O++,L++):ie<20&&F++)}const fe=Math.max(0,H-J-X),be=H>0?(J/H*100).toFixed(1):"0.0",oe=k.wordProgress||{},xe=j=>String(j??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),$e=j=>xe(j).toLowerCase(),Le=new Map;for(const j of Object.keys(oe)){const z=$e(j);Le.has(z)||Le.set(z,j)}const Re=j=>{const z=xe(j);if(!z)return null;const U=oe[z];if(U)return U;const M=oe[z.toLowerCase()];if(M)return M;const ie=Le.get($e(z));return ie?oe[ie]??null:null},Ye=Li(n).slice(0,10).map(j=>String((j==null?void 0:j.word)??"")).filter(Boolean),Te=s.slice(e+1,e+11).map(j=>String(j.word??"")).filter(Boolean),ut=Ye.length>0?Ye:Te,ft=Ye.length>0?"postProcess() TOP10":"propsÔºàÁèæÂú®‰ΩçÁΩÆ„ÅÆÊ¨°10ÂïèÔºâ",wt=j=>{const z=Re(j),U=Bt(z,n),M=up(z,n),ie=M===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":U>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":U>=40?"üü° „Åæ„Å†„Åæ„Å†":U>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return{position:U,attempts:M,status:ie}},vt=ut.length>0&&ut.every(j=>wt(j).position<40),Nt=c.length===0?"_Ôºà„Éá„Éº„Çø„Å™„ÅóÔºâ_":`| ÂçòË™û | Position | Category | üß† Memory | üí§ CogLoad | üîÆ Error | üìö Linguistic | üåç Context | üéØ Style | üéÆ Gamify |
|------|----------|----------|-----------|-----------|----------|--------------|-----------|----------|----------|
`+c.map(j=>{const z=(()=>{switch(j.category){case"incorrect":return"‚ùå ÂàÜ„Åã„Çâ„Å™„ÅÑ";case"still_learning":return"üü° „Åæ„Å†„Åæ„Å†";case"mastered":return"‚úÖ ÂÆöÁùÄÊ∏à";case"new":return"‚ö™ Êñ∞Ë¶è";default:return"‚ö™ Êñ∞Ë¶è"}})(),U=(j.position??0).toFixed(0),M=j.aiProposals||{};return`| **${j.word}** | ${U} | ${z} | ${(M.memory??0).toFixed(0)} | ${(M.cognitiveLoad??0).toFixed(0)} | ${(M.errorPrediction??0).toFixed(0)} | ${(M.linguistic??0).toFixed(0)} | ${(M.contextual??0).toFixed(0)} | ${(M.learningStyle??0).toFixed(0)} | ${(M.gamification??0).toFixed(0)} |`}).join(`
`),mt=`# üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„É¨„Éù„Éº„ÉàÔºàË©≥Á¥∞ÁâàÔºâ

**ÁîüÊàêÊó•ÊôÇ**: ${C}
    **mode**: ${n}
**ÁèæÂú®‰ΩçÁΩÆ**: ${e+1} / ${t} ÂïèÁõÆ

---

${Pu.generateSummary(n)}

---

${(()=>{var j,z;try{const U=localStorage.getItem("debug_weak_words_detection");if(U){const M=JSON.parse(U),ie=(M.allWeakWordsInLS||0)-(((j=M.missingFromBase)==null?void 0:j.length)||0),te=((z=M.missingFromBase)==null?void 0:z.length)||0;let Q=`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

`;return Q+=`**timestamp**: ${M.timestamp||"N/A"}

`,Q+=`- üìä LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û: **${M.allWeakWordsInLS||0}Ë™û**
`,Q+=`- ‚úÖ Ê§úÂá∫ÊàêÂäüÔºàbaseQuestions„Å´Â≠òÂú®Ôºâ: **${ie}Ë™û**
`,Q+=`- ‚ùå „Éá„Éº„ÇøÊ¨†ÊêçÔºàbaseQuestions„Å´‰∏çÂú®Ôºâ: **${te}Ë™û**
`,Q+=`- üìÅ baseQuestionsÁ∑èÊï∞: ${M.baseQuestionsCount||0}Ë™û
`,Q+=`- üîç filteredÁ∑èÊï∞: ${M.filteredCount||0}Ë™û

`,te>0&&(Q+=`### ‚ùå Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº: baseQuestions„Å´Â≠òÂú®„Åó„Å™„ÅÑ„Åæ„Å†„Åæ„Å†Ë™û

`,M.missingFromBase&&M.missingFromBase.length>0&&(Q+="```\n",M.missingFromBase.forEach((ce,le)=>{Q+=`${le+1}. ${ce}
`}),Q+="```\n\n",Q+=`**ÂéüÂõ†**: „Åì„Çå„Çâ„ÅÆÂçòË™û„ÅåÂÖÉ„ÅÆJSON„Éá„Éº„ÇøÔºàjuniorWords.jsonÁ≠âÔºâ„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
`,Q+=`**ÂØæÁ≠ñ**: „Éá„Éº„Çø„ÇΩ„Éº„Çπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅ„Åì„Çå„Çâ„ÅÆÂçòË™û„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

`)),M.weakWordsList&&M.weakWordsList.length>0&&(Q+=`### üìã LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û„É™„Çπ„Éà

`,Q+=`| # | ÂçòË™û | Position | memPos | attempts |
`,Q+=`|---|------|----------|--------|----------|
`,M.weakWordsList.slice(0,20).forEach((ce,le)=>{Q+=`| ${le+1} | **${ce.word}** | ${ce.position} | ${ce.memPos??"-"} | ${ce.attempts}Âõû |
`}),M.weakWordsList.length>20&&(Q+=`
_‚Ä¶‰ªñ${M.weakWordsList.length-20}Ë™ûÁúÅÁï•_
`),Q+=`
`),M.weakQuestionsWords&&M.weakQuestionsWords.length>0&&(Q+=`### ‚úÖ Ê§úÂá∫„Åï„Çå„ÅüweakQuestions

`,Q+="```\n",M.weakQuestionsWords.slice(0,10).forEach((ce,le)=>{Q+=`${le+1}. ${ce}
`}),M.weakQuestionsWords.length>10&&(Q+=`...‰ªñ${M.weakQuestionsWords.length-10}Ë™û
`),Q+="```\n\n"),Q+=`---

`,Q}}catch(U){return`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

‚ö†Ô∏è Ê§úÂá∫„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${U}

---

`}return""})()}

## üìä „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ

**Á∑èÂêàÁµ±Ë®à**:
- üìö Á∑èÂçòË™ûÊï∞: ${I}Ë™û
- ‚úÖ ÁøíÂæóÊ∏à„Åø (Position < 20): ${F}Ë™û (${I>0?(F/I*100).toFixed(1):"0.0"}%)
- üü° „Åæ„Å†„Åæ„Å† (Position 40-70, attempts>0): ${O}Ë™û
- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${V}Ë™û
- ‚ö†Ô∏è Ëã¶ÊâãË™ûÂêàË®à (Position‚â•40): ${L}Ë™û

**Ëß£Á≠îÁµ±Ë®à**:
- Á∑èË©¶Ë°åÂõûÊï∞: ${H}Âõû
- Ê≠£Á≠î: ${J}Âõû
- Ë™§Á≠î: ${fe}Âõû
- ÂÖ®‰ΩìÊ≠£Á≠îÁéá: ${be}%

**ÈÄ≤ÊçóÁéá**: ${(e/t*100).toFixed(1)}% (${e} / ${t}Âïè)

**progressCacheÂÅ•ÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ**:
- tabPosition Êú™Ë®≠ÂÆö: ${_} / ${I}
- category Êú™Ë®≠ÂÆö: ${D} / ${I}
- lastStudied Êú™Ë®≠ÂÆö: ${P} / ${I}
- ‰∏ªË¶Å„Ç´„Ç¶„É≥„ÉàÊ¨†ÊêçÔºàcorrect/incorrect/streakÔºâ: ${A} / ${I}

---

## üõ†Ô∏è Ëµ∑ÂãïÊôÇ‰øÆÂæ©„É≠„Ç∞Ôºà„Çµ„Éû„É™„ÉºÔºâ

${(()=>{const j=localStorage.getItem("debug_progress_repair_summary");if(!j)return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†loadProgress()„ÅåËµ∞„Å£„Å¶„ÅÑ„Å™„ÅÑ/‰øùÂ≠ò„Åß„Åç„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const z=JSON.parse(j),U=z.timestamp?String(z.timestamp):"-",M=Number(z.categoryAdded??0),ie=Number(z.memorizationPositionRepaired??0),te=!!z.saved;return`**timestamp**: ${U}
**categoryAdded**: ${M}
**memorizationPositionRepaired**: ${ie}
**saved**: ${te?"trueÔºà‰øÆÂæ©„Çí‰øùÂ≠òÔºâ":"falseÔºà‰øÆÂæ©„Å™„Åó or ‰øùÂ≠ò‰∏çË¶ÅÔºâ"}`}catch{return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"}})()}

---

## üéØ „Ç§„É≥„Çø„Éº„É™„Éº„ÉñË®∫Êñ≠

### PositionÂàÜÂ∏ÉÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ${p.length}Ë™ûÔºâ
${p.length===0?"_Ôºà„Å™„ÅóÔºâ_":`
- **Position 85-100**: ${p.filter(j=>j.position>=85).length}Ë™û
- **Position 70-84**: ${p.filter(j=>j.position>=70&&j.position<85).length}Ë™û
- **Position 40-69**: ${p.filter(j=>j.position>=40&&j.position<70).length}Ë™û

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÇíPosition +15
- ÁµêÊûú: Position 40-55„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰Ωç10Âïè‰∏≠„Å´Ê∑∑ÂÖ•„Åô„Çã„ÅØ„Åö
`}

### Ê¨°10Âïè„ÅÆPositionÂàÜÊûê
**ÂèÇÁÖß**: ${ft}

${ut.map((j,z)=>{const{position:U,attempts:M,status:ie}=wt(j);return`${z+1}. **${j}** - Position ${U.toFixed(0)} (${M}Âõû) ${ie}`}).join(`
`)}

**ÂïèÈ°åÊ§úÂá∫**:
${vt?"‚ùå **ÂÖ®„Å¶Êñ∞Ë¶èÔºàPosition < 40Ôºâ** ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß":"‚úÖ Êñ∞Ë¶è„Å®„Åæ„Å†„Åæ„Å†„ÅåÊ∑∑Âú® ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ‰∏≠"}

---

## üéÆ PositionÂàÜÊï£Ë®∫Êñ≠

${m?`**ÂàÜÊï£Ââç**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((dt=m.before)==null?void 0:dt.stillLearning)||0)+(((re=m.before)==null?void 0:re.incorrect)||0)}Ë™û
- Êñ∞Ë¶è: ${((de=m.before)==null?void 0:de.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((q=m.before)==null?void 0:q.boostable)||0}Ë™û

**ÂàÜÊï£Âæå**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((Z=m.after)==null?void 0:Z.stillLearning)||0)+(((Ce=m.after)==null?void 0:Ce.incorrect)||0)}Ë™û
- Êñ∞Ë¶è (PositionÂºï„Åç‰∏ä„ÅíÂæå): ${((_e=m.after)==null?void 0:_e.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((De=m.after)==null?void 0:De.boostable)||0}Ë™û

**PositionÂºï„Åç‰∏ä„Åí**: ${((Ie=m.summary)==null?void 0:Ie.newBoosted)||0}Ë™û ${((Dt=m.summary)==null?void 0:Dt.working)??!1?"‚úÖ":"‚ùå"}

<details>
<summary>Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${m.changed.slice(0,10).map(j=>"- **"+j.word+"**: "+j.before.toFixed(0)+" ‚Üí "+j.after.toFixed(0)+" (+"+(j.after-j.before).toFixed(0)+")").join(`
`)}

${m.changed.length>10?`
_‚Ä¶‰ªñ`+(m.changed.length-10)+"Ë™û_":""}
</details>`:"‚ö†Ô∏è PositionÂàÜÊï£Ë®∫Êñ≠ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàcalculatePriorities()„ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

### üéØ „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà

${(()=>{try{const j=localStorage.getItem("debug_still_learning_boost");if(!j)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const z=JSON.parse(j);return!z.working||z.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û (Position 40-70, attempts>0) „ÇíÂºï„Åç‰∏ä„Åí**: ${z.boosted}Ë™û ‚úÖ

<details>
<summary>„Éñ„Éº„Çπ„Éà„Åï„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${z.changes.slice(0,10).map(U=>{const M=Number(U.after)-Number(U.before);return"- **"+U.word+"**: "+U.before.toFixed(0)+" ‚Üí "+U.after.toFixed(0)+" (+"+(Number.isFinite(M)?M.toFixed(0):"0")+")"}).join(`
`)}

${z.boosted>10?`
_‚Ä¶‰ªñ`+(z.boosted-10)+"Ë™û_":""}
</details>`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

### üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ

${(()=>{const j=Li(n).slice(0,30);if(j.length===0)return"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const z=j.map(Q=>Q.attempts>0&&Q.position>=40&&Q.position<70?"„Åæ„Å†„Åæ„Å†":Q.attempts===0&&Q.position>=40&&Q.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":Q.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":Q.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),U={„Åæ„Å†„Åæ„Å†:z.filter(Q=>Q==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:z.filter(Q=>Q==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:z.filter(Q=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(Q)).length},M=z.slice(0,20).map(Q=>{switch(Q){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join(""),ie=j.slice(0,15).map((Q,ce)=>{const le=z[ce],Pe=le==="„Åæ„Å†„Åæ„Å†"?"üü°":le==="Êñ∞Ë¶è(Âºï‰∏ä)"?"üîµ":le==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"üî¥":le==="ÂÆöÁùÄÊ∏à"?"‚úÖ":"‚ö™";return`${ce+1}. ${Pe} **${Q.word}** (Pos ${Q.position.toFixed(0)}, ${Q.attempts}Âõû) - ${le}`}).join(`
`);let te=`**TOP30„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÂ∏É**:
- üü° „Åæ„Å†„Åæ„Å†: ${U.„Åæ„Å†„Åæ„Å†}Ë™û
- üîµ Êñ∞Ë¶è(PositionÂºï‰∏ä): ${U.Êñ∞Ë¶èÂºï‰∏ä}Ë™û
- „Åù„ÅÆ‰ªñ: ${U.„Åù„ÅÆ‰ªñ}Ë™û

**„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ** (TOP20):
${M}

**Âá°‰æã**: üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à

<details>
<summary>Ë©≥Á¥∞„É™„Çπ„Éà (TOP15)</summary>

${ie}
</details>

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆ„Çµ„Ç§„ÇØ„É´„Åß‰∫§‰∫íÈÖçÁΩÆ
- ‰æã: üü°üü°üîµüü°üü°üü°üîµüü°üü°üîµ...`;if(U.„Åæ„Å†„Åæ„Å†===0&&U.Êñ∞Ë¶èÂºï‰∏ä===0)te+=`

‚ö†Ô∏è **„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„Åó**Ôºà„Åæ„Å†„Åæ„Å†Ë™û„ÉªPositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å®„ÇÇ„Å´0Ôºâ`;else if(U.„Åæ„Å†„Åæ„Å†>0&&U.Êñ∞Ë¶èÂºï‰∏ä===0)te+=`

‚ö†Ô∏è **PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å™„Åó** ‚Üí „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else if(U.„Åæ„Å†„Åæ„Å†===0&&U.Êñ∞Ë¶èÂºï‰∏ä>0)te+=`

‚ö†Ô∏è **„Åæ„Å†„Åæ„Å†Ë™û„Å™„Åó** ‚Üí PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else{let Q=0;for(let ce=0;ce<z.length-1;ce++){const le=z[ce],Pe=z[ce+1];le==="„Åæ„Å†„Åæ„Å†"&&Pe==="Êñ∞Ë¶è(Âºï‰∏ä)"&&Q++,le==="Êñ∞Ë¶è(Âºï‰∏ä)"&&Pe==="„Åæ„Å†„Åæ„Å†"&&Q++}Q>=3?te+=`

‚úÖ **‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+Q+"ÂõûÔºâ":te+=`

‚ö†Ô∏è **‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑÂèØËÉΩÊÄß**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+Q+"ÂõûÔºâ"}return te}catch(z){return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº: "+z.message}})()}

---

## ÔøΩÔ∏è PositionÈöéÂ±§Ê§úË®ºÔºà„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÈò≤Ê≠¢Ôºâ

${(()=>{try{const j=localStorage.getItem("debug_position_hierarchy_validation"),z=localStorage.getItem("debug_position_hierarchy_still"),U=localStorage.getItem("debug_position_hierarchy_new");if(!j&&!z&&!U)return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";let M=`**PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂**:
`;M+="```\n",M+=`70-100: ÂàÜ„Åã„Çâ„Å™„ÅÑÔºàÁ¨¨1ÂÑ™ÂÖàÔºâ
`,M+=`60-69:  „Åæ„Å†„Åæ„Å†ÔºàÁ¨¨2ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ‚Üê üîí Âõ∫ÂÆö
`,M+=`40-59:  Êñ∞Ë¶èÔºàÁ¨¨3ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ    ‚Üê üîí Âõ∫ÂÆö
`,M+=`20-39:  Êñ∞Ë¶èÔºàÁ¨¨4ÂÑ™ÂÖà„ÉªÈÄöÂ∏∏Ôºâ
`,M+=`0-19:   ÂÆöÁùÄÊ∏àÔºàÁ¨¨5ÂÑ™ÂÖàÔºâ
`,M+="```\n\n";let ie=!1;const te=[];if(j){const Q=JSON.parse(j);Q.isValid?(M+=`‚úÖ **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§„ÅåÊ≠£Â∏∏„Åß„Åô
`,M+="  - „Åæ„Å†„Åæ„Å†Ë™ûÔºà60-69ÁØÑÂõ≤ÂÜÖÔºâ: "+Q.stillInBoostedZone+`Ë™û
`,M+="  - Êñ∞Ë¶èË™ûÔºà40-59ÁØÑÂõ≤ÂÜÖÔºâ: "+Q.newInBoostedZone+`Ë™û

`):(ie=!0,M+=`‚ùå **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§ÈÅïÂèç„ÇíÊ§úÂá∫
`,M+="  - ÈÅïÂèç‰ª∂Êï∞: "+Q.violationCount+`Ë™û
`,te.push(...Q.violations))}if(z){const Q=JSON.parse(z);Q.violationCount===0?M+="‚úÖ **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: ÂÖ®"+Q.totalStill+`Ë™û„ÅåPosition 60-69ÁØÑÂõ≤ÂÜÖ

`:(ie=!0,M+=`‚ùå **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: Position 60-69ÁØÑÂõ≤Â§ñ„ÅÆË™û„ÇíÊ§úÂá∫
`,M+="  - ÈÅïÂèç‰ª∂Êï∞: "+Q.violationCount+"Ë™ûÔºàÂÖ®"+Q.totalStill+`Ë™û‰∏≠Ôºâ
`,te.push(...Q.violations))}if(U){const Q=JSON.parse(U);Q.violationCount===0?M+="‚úÖ **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: ÂÖ®"+Q.totalNew+`Ë™û„ÅåPosition 60Êú™Ê∫Ä

`:(ie=!0,M+=`‚ùå **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: Position 60‰ª•‰∏ä„ÅÆË™û„ÇíÊ§úÂá∫
`,M+="  - ÈÅïÂèç‰ª∂Êï∞: "+Q.violationCount+"Ë™ûÔºàÂÖ®"+Q.totalNew+`Ë™û‰∏≠Ôºâ
`,te.push(...Q.violations))}return ie&&te.length>0?(M+=`
**üö® ÈÅïÂèç„ÅÆË©≥Á¥∞**:
`,te.slice(0,10).forEach((Q,ce)=>{const le=Q.type==="new_exceeds_60"?"Êñ∞Ë¶èË™û„ÅåPosition 60‰ª•‰∏ä":Q.type==="still_below_60"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 60Êú™Ê∫Ä":Q.type==="still_above_70"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 70‰ª•‰∏ä":"‰∏çÊòé";M+=ce+1+". **"+Q.word+"**: Position "+Q.position.toFixed(0)+" ‚Üê "+le+`
`}),te.length>10&&(M+=`
_‚Ä¶‰ªñ`+(te.length-10)+`‰ª∂_
`),M+=`
**üìñ ÂéüÂõ†„Å®ÂØæÁ≠ñ**:
`,M+=`- „Åì„Çå„ÅØ„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÂïèÈ°å„Åß„Åô
`,M+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÇíÂÑ™ÂÖà„Åï„Åõ„Çã„Åü„ÇÅ„Å´Êñ∞Ë¶èË™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,M+=`- Êñ∞Ë¶èË™û„ÇíÊ∑∑„Åú„Çã„Åü„ÇÅ„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,M+=`- PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂Ôºà60-69: „Åæ„Å†„Åæ„Å†„ÄÅ40-59: Êñ∞Ë¶èÔºâ„ÇíÂÆà„Å£„Å¶„Åè„Å†„Åï„ÅÑ
`):ie||(M+=`üéâ **PositionÈöéÂ±§„ÅØÂÆåÁíß„Å´ÂÆà„Çâ„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ**
`,M+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÅØÁ¢∫ÂÆü„Å´Êñ∞Ë¶èË™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Åæ„Åô
`,M+=`- Êñ∞Ë¶èË™û„ÅØ„Åæ„Å†„Åæ„Å†Ë™û„ÇíÈÇ™È≠î„Åó„Åæ„Åõ„Çì
`),M}catch(j){return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„ÅÆËß£Êûê„Ç®„É©„Éº: "+j.message}})()}

---

## ÔøΩüìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞30‰ª∂)

${b.length>0?b.slice(-10).reverse().map((j,z)=>z+1+". **"+j.function+"** "+JSON.stringify(j.params)+" - "+new Date(j.timestamp).toLocaleTimeString()).join(`
`):"‚ö†Ô∏è Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}

---

## üîç sortAndBalance() Âá∫ÂäõÊ§úË®º

**sortAndBalance()Âæå„ÅÆTOP30ÔºàPositionÈôçÈ†Ü„ÇΩ„Éº„ÉàÂæåÔºâ**:
${(()=>{const j=localStorage.getItem("debug_sortAndBalance_output");if(!j)return"‚ö†Ô∏è sortAndBalance()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{return JSON.parse(j).slice(0,30).map((U,M)=>{const ie=U.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":U.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":U.position>=40?"üü° „Åæ„Å†„Åæ„Å†":U.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return M+1+". **"+U.word+"** - Position "+(U.position??0).toFixed(0)+" ("+U.attempts+"Âõû) "+ie}).join(`
`)}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

**postProcess()Âæå„ÅÆTOP30ÔºàÂÆüÈöõ„ÅÆÂá∫È°å„Ç≠„É•„ÉºÔºâ**:
${(()=>{const j=p9(n),z=Li(n);return!z||z.length===0?"‚ö†Ô∏è postProcess()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì":(j?`
(„É°„Çø) action=${j.action}, interleavedAcrossBands=${!!j.isInterleavedAcrossBands}
`:"")+z.slice(0,30).map((M,ie)=>{const te=M.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":M.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":M.position>=40?"üü° „Åæ„Å†„Åæ„Å†":M.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return ie+1+". **"+M.word+"** - Position "+(M.position??0).toFixed(0)+" ("+M.attempts+"Âõû) "+te}).join(`
`)})()}

**üö® ÈáçË¶Å**: sortAndBalance()„Å®postProcess()„ÅÆÂá∫Âäõ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÄÅpostProcess()„ÅåÈ†ÜÂ∫è„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ

**üîç „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞ÂàÜÊûê**:
${(()=>{const j=n,z=t,U=Se=>{if(!Se)return null;try{return JSON.parse(Se)}catch{return null}},M=(Se,ue=!1)=>{const Ve=Se.filter(Boolean);if(Ve.length===0)return null;const yt=at=>{const He=typeof at=="number"?at:Number(at);return Number.isFinite(He)?He:null},ot=at=>{const He=Date.parse(String(at??""));return Number.isFinite(He)?He:0};if(ue){const at=Ve.filter(ct=>String((ct==null?void 0:ct.mode)??"")===j);if(at.length===0)return null;const He=at.filter(ct=>yt(ct==null?void 0:ct.questionsCount)===z);return He.length>0?(He.sort((ct,Mt)=>ot(Mt==null?void 0:Mt.timestamp)-ot(ct==null?void 0:ct.timestamp)),He[0]):[...at].sort((ct,Mt)=>{const Wt=yt(ct==null?void 0:ct.questionsCount)??-1,Kt=yt(Mt==null?void 0:Mt.questionsCount)??-1;return Kt!==Wt?Kt-Wt:ot(Mt==null?void 0:Mt.timestamp)-ot(ct==null?void 0:ct.timestamp)})[0]}const Ge=Ve.filter(at=>yt(at==null?void 0:at.questionsCount)===z);return Ge.length>0?(Ge.sort((at,He)=>ot(He==null?void 0:He.timestamp)-ot(at==null?void 0:at.timestamp)),Ge[0]):[...Ve].sort((at,He)=>{const qe=yt(at==null?void 0:at.questionsCount)??-1,ct=yt(He==null?void 0:He.questionsCount)??-1;return ct!==qe?ct-qe:ot(He==null?void 0:He.timestamp)-ot(at==null?void 0:at.timestamp)})[0]},ie=`debug_sortAndBalance_top100_history_${j}`,te=U(localStorage.getItem(ie)),Q=Array.isArray(te)?te:[],ce=M(Q,!0),le=`debug_sortAndBalance_top100_${j}`,Pe=U(localStorage.getItem(le)),ve=Pe&&String((Pe==null?void 0:Pe.mode)??"")===j?Pe:null,Je=U(localStorage.getItem("debug_sortAndBalance_top100")),ee=Je&&String((Je==null?void 0:Je.mode)??"")===j?Je:null,ge=ce??ve??ee??Je;if(!ge)return"‚ö†Ô∏è TOP100„Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{const Se=ce?`history:${ie}`:ve?`byMode:${le}`:"legacy:debug_sortAndBalance_top100",ue=Array.isArray(ge==null?void 0:ge.top100)?ge.top100:[],Ve=Array.isArray(ge==null?void 0:ge.top600)?ge.top600:[],yt=typeof(ge==null?void 0:ge.timestamp)=="string"?ge.timestamp:null,ot=typeof(ge==null?void 0:ge.mode)=="string"?ge.mode:null,Ge=Number.isFinite(Number(ge==null?void 0:ge.questionsCount))?Number(ge.questionsCount):null,Ut=Number.isFinite(Number(ge==null?void 0:ge.interleavedCount))?Number(ge.interleavedCount):null,at=Number.isFinite(Number(ge==null?void 0:ge.stillLearningInTop100))?Number(ge.stillLearningInTop100):null,He=Number.isFinite(Number(ge==null?void 0:ge.stillLearningInTop600))?Number(ge.stillLearningInTop600):null,ct=et().wordProgress||{},Mt=nt=>String(nt??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),Wt=nt=>Mt(nt).toLowerCase(),Kt=new Map;for(const nt of Object.keys(ct)){const Fe=Wt(nt);Kt.has(Fe)||Kt.set(Fe,nt)}const lt=nt=>{const Fe=Mt(nt);if(!Fe)return{key:null,wp:null,hit:"empty"};const Ze=ct[Fe];if(Ze)return{key:Fe,wp:Ze,hit:"direct"};const $t=Fe.toLowerCase(),gn=ct[$t];if(gn)return{key:$t,wp:gn,hit:"lower"};const xn=Wt(Fe),kt=Kt.get(xn)??null;return kt?{key:kt,wp:ct[kt]??null,hit:"normalized"}:{key:null,wp:null,hit:"miss"}},Zt=nt=>lt(nt).wp,_t=(nt,Fe=0)=>{const Ze=typeof nt=="number"?nt:Number(nt);return Number.isFinite(Ze)?Ze:Fe},Ke=(nt,Fe)=>{const Ze=Zt(nt);if(Ze){const $t=_t(Ze==null?void 0:Ze.memorizationAttempts,NaN);if(Number.isFinite($t))return $t}return _t(Fe,0)},B=(nt,Fe)=>{const Ze=Zt(nt);if(Ze){const $t=_t(Bt(Ze,n),NaN);if(Number.isFinite($t))return $t}return _t(Fe,0)},pe=ue.filter(nt=>{const Fe=String(nt.word??""),Ze=B(Fe,nt.position),$t=Ke(Fe,nt.attempts);return Ze>=40&&Ze<70&&$t>0}),Ae=Ve.filter(nt=>{const Fe=String(nt.word??""),Ze=B(Fe,nt.position),$t=Ke(Fe,nt.attempts);return Ze>=40&&Ze<70&&$t>0}),je=Ve.filter(nt=>{const Fe=String(nt.word??""),Ze=B(Fe,nt.position),$t=Ke(Fe,nt.attempts);return Ze===50&&$t===0}).length;let Me="";yt&&(Me+=`üïí **snapshot timestamp**: ${yt}

`),Me+=`üß≠ **snapshot selectedFrom**: ${Se}

`,Me+=`**üì¶ snapshot meta**
`,Me+=`- mode: ${ot??"-"}
`,Me+=`- questionsCount: ${Ge??"-"}
`,Me+=`- interleavedCount: ${Ut??"-"}
`,Me+=`- top100Count: ${ue.length}
`,Me+=`- top600Count: ${Ve.length}
`,Me+=`- stillLearningInTop100 (snapshot): ${at??"-"}
`,Me+=`- stillLearningInTop600 (snapshot): ${He??"-"}

`,ot&&ot!==j&&(Me+=`‚ö†Ô∏è **„É¢„Éº„Éâ‰∏ç‰∏ÄËá¥**: „Åì„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅØ \`${ot}\` „Åß„Åô„ÄÇÊöóË®ò„Çø„Éñ„ÅÆÂàÜÊûê„Å´„ÅØ \`${j}\` „ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
‚Üí translation/spellingÁ≠â„ÅÆ„Äå30Âïè„ÉÜ„Çπ„ÉàÂÆüË°å„Äç„Åå‰∏äÊõ∏„Åç„Åó„Å¶„ÇÇÂ£ä„Çå„Å™„ÅÑ„Çà„ÅÜ„ÄÅmodeÂà•„Ç≠„Éº„ÇíË™≠„ÅøÂèñ„Çã„Çà„ÅÜ„Å´‰øÆÊ≠£Ê∏à„Åø„Åß„Åô„ÄÇ

`);const Ue={direct:0,lower:0,normalized:0,miss:0,empty:0};for(const nt of ue){const Fe=String((nt==null?void 0:nt.word)??""),Ze=lt(Fe);Ue[Ze.hit]=(Ue[Ze.hit]||0)+1}Me+=`**üîë progressCacheÁÖßÂêàÔºàTOP100Ôºâ**
`,Me+=`- direct: ${Ue.direct}
`,Me+=`- lower: ${Ue.lower}
`,Me+=`- normalized: ${Ue.normalized}
`,Me+=`- miss: ${Ue.miss}

`;const Et=rp(n),Ct=new Set(Et.map(nt=>Wt(nt.word))),tt=new Set(ue.map(nt=>Wt(String((nt==null?void 0:nt.word)??"")))),Ft=[];for(const nt of Ct)tt.has(nt)&&Ft.push(nt);if(Me+=`**üü° Ëã¶ÊâãË™û√óTOP100ÔºàÊöóË®òSSOTÔºâ**
`,Me+=`- strugglingWords: ${Et.length}
`,Me+=`- inTop100: ${Ft.length}

`,ue.length===0&&(Me+=`‚ö†Ô∏è TOP100ÈÖçÂàó„ÅåÁ©∫„Åß„ÅôÔºàÂè§„ÅÑ/Â£ä„Çå„Åü„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆÂèØËÉΩÊÄßÔºâ

`),je>0?Me+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: ${je}Ë™ûÔºà„Åì„Çå„Åå„Åæ„Å†„Åæ„Å†Ë™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄßÔºâ

`:Me+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: 0Ë™ûÔºàË©≤ÂΩì„Å™„ÅóÔºâ

`,pe.length===0){if(Me+=`‚ùå **„Åæ„Å†„Åæ„Å†Ë™ûÔºàPosition 40-70, attempts>0Ôºâ„ÅåTOP100„Å´1„Å§„ÇÇÂÖ•„Å£„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ**
`,ue.length>0){const nt=ue.slice(0,10).map(Fe=>{const Ze=String(Fe.word??""),$t=lt(Ze),gn=!!$t.wp,xn=Ke(Ze,Fe.attempts),kt=B(Ze,Fe.position),me=_t(Fe.attempts,0),Oe=_t(Fe.position,0);return{word:Ze,matchedKey:$t.key,hitType:$t.hit,cacheHit:gn,usedPos:kt,usedAttempts:xn,snapshotPos:Oe,snapshotAttempts:me}});Me+=`
**üß™ Âà§ÂÆö„Éá„Éê„ÉÉ„Ç∞ÔºàTOP10„Çµ„É≥„Éó„É´Ôºâ**
`+nt.map((Fe,Ze)=>{const $t=Fe.cacheHit?Fe.hitType:"miss",gn=Fe.matchedKey?` key:${Fe.matchedKey}`:"";return`${Ze+1}. ${Fe.word} | cache:${$t}${gn} | pos used:${Fe.usedPos} (snap:${Fe.snapshotPos}) | attempts used:${Fe.usedAttempts} (snap:${Fe.snapshotAttempts})`}).join(`
`)+`
`}}else Me+="‚úÖ „Åæ„Å†„Åæ„Å†Ë™û„Åå**"+pe.length+`Ë™û**„ÄÅTOP100ÂÜÖ„Å´„ÅÇ„Çä„Åæ„Åô:
`+pe.slice(0,10).map(nt=>{const Fe=String(nt.word??""),Ze=Ke(Fe,nt.attempts),$t=B(Fe,nt.position);return`${nt.rank??""}‰Ωç: ${Fe} (Position ${$t}, ${Ze}Âõû)`}).join(`
`)+(pe.length>10?`
_‚Ä¶‰ªñ`+(pe.length-10)+"Ë™û_":"")+`

`;return Ve.length===0?Me+="‚ö†Ô∏è TOP600ÈÖçÂàó„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàÊúÄÊñ∞„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É©Âá∫ÂäõÂæÖ„Å°Ôºâ":Ae.length>0?(Me+="üìç **TOP600ÂÜÖ„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û**: "+Ae.length+`Ë™û
`,Me+=Ae.slice(0,5).map(nt=>{const Fe=String(nt.word??""),Ze=Ke(Fe,nt.attempts),$t=B(Fe,nt.position);return`${nt.rank??""}‰Ωç: ${Fe} (Position ${$t}, ${Ze}Âõû)`}).join(`
`),Ae.length>5&&(Me+=`
_‚Ä¶‰ªñ`+(Ae.length-5)+"Ë™û_")):Me+="‚ùå **TOP600ÂÜÖ„Å´„ÇÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì**",je>0&&pe.length===0&&(Me+=`

**üö® ÁµêË´ñ**: Position 50„ÅÆÊñ∞Ë¶è`+je+`Ë™û„ÅåÂÖàË°å„Åó„ÄÅ„Åæ„Å†„Åæ„Å†Ë™û„ÅåÊäº„ÅóÂá∫„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô
`,Me+="‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅßÊñ∞Ë¶è„ÅåÂÑ™ÂÖà„Åï„Çå„ÄÅ„Åæ„Å†„Åæ„Å†„Åå"+(je+1)+"‰Ωç‰ª•Èôç„Å´ËøΩ„ÅÑ„ÇÑ„Çâ„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß"),Me}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

---

### üéØ ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÂÜÖPositionÂàÜÂ∏ÉÔºà„É™„Ç¢„É´„Çø„Ç§„É†Ôºâ

${(()=>{if(!s||s.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const j=s.slice(e);if(j.length===0)return"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ";const z=et(),U=ve=>{if(!ve)return 0;switch(n){case"memorization":return ve.memorizationAttempts??0;case"translation":return ve.translationAttempts??0;case"spelling":return ve.spellingAttempts??0;case"grammar":return ve.grammarAttempts??0;default:return ve.totalAttempts??0}},M=j.map(ve=>{const Je=String(ve.word??""),ee=z.wordProgress[Je],ge=Number.isFinite(ve.position)?ve.position:null;if(ee){const Se=Bt(ee,n);return{...ve,position:Se,_originalPosition:ge,_wpMissing:!1,_attempts:U(ee)}}return{...ve,position:35,_originalPosition:ge,_wpMissing:!0,_attempts:0}}),ie=M.filter(ve=>{if(!Number.isFinite(ve._originalPosition))return!1;const Je=ve._originalPosition,ee=ve.position??0;return Math.abs(Je-ee)>5}).slice(0,20);let te="**üìä Êú™Âá∫È°å„Ç≠„É•„ÉºÂàÜÊûêÔºàÊÆã„Çä"+j.length+`ÂïèÔºâ**:

`;ie.length>0&&(te+="üö® **Position‰∏çÊï¥ÂêàÊ§úÂá∫**: "+ie.length+`Ë™û
`,te+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåLocalStorage„Å®‰∏ÄËá¥„Åó„Åæ„Åõ„ÇìÔºÅ

`,te+=`**‰∏çÊï¥Âêà„É™„Çπ„ÉàÔºàÂ∑ÆÂàÜ‚â•5Ôºâ**:
`,te+=ie.map(ve=>{const Je=ve._originalPosition??0,ee=ve.position??0,ge=ee-Je,Se=ee>=70?"üî¥":ee>=40?"üü°":"‚ö™",ue=ge>0?"üî∫":ge<0?"üîª":"‚Üí";return"  "+Se+" **"+ve.word+"**: "+Je+" "+ue+" "+ee+" (Â∑ÆÂàÜ: "+(ge>0?"+":"")+ge+")"}).join(`
`),te+=`

**ÂéüÂõ†ÂÄôË£ú**:
`,te+=`- questionsÈÖçÂàó„ÅåÂè§„ÅÑ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åã„Çâ‰ΩúÊàê„Åï„Çå„Åü
`,te+=`- Ëß£Á≠îÂæå„Å´Position„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„Åå„ÄÅ„Ç≠„É•„Éº„Å´ÂèçÊò†„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ
`,te+=`- QuestionScheduler„ÅÆÂëº„Å≥Âá∫„Åó„Çø„Ç§„Éü„É≥„Ç∞„Åå‰∏çÈÅ©Âàá

`);const Q={incorrect:M.filter(ve=>(ve.position??0)>=70),stillLearning:M.filter(ve=>{const Je=ve.position??0,ee=ve._attempts??0;return Je>=40&&Je<70&&ee>0}),newBoosted:M.filter(ve=>{const Je=ve.position??0,ee=ve._attempts??0;return Je>=40&&Je<60&&ee===0}),newNormal:M.filter(ve=>{const Je=ve.position??0;return Je>=20&&Je<40}),mastered:M.filter(ve=>(ve.position??0)<20)};te+=`**PositionÂà•ÂÜÖË®≥**:
`,te+="- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑÔºà70-100Ôºâ: "+Q.incorrect.length+`Ë™û
`,te+="- üü° „Åæ„Å†„Åæ„Å†Ôºà40-69, attempts>0Ôºâ: "+Q.stillLearning.length+`Ë™û
`,te+="- üîµ Êñ∞Ë¶èÂºï‰∏äÔºà40-59, attempts=0Ôºâ: "+Q.newBoosted.length+`Ë™û
`,te+="- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏Ôºà20-39Ôºâ: "+Q.newNormal.length+`Ë™û
`,te+="- ‚úÖ ÂÆöÁùÄÊ∏àÔºà0-19Ôºâ: "+Q.mastered.length+`Ë™û

`;const ce=M.slice(0,30),le=ce.filter(ve=>(ve.position??0)>=40);te+=`**Ê¨°„ÅÆ30Âïè„ÅÆÊßãÊàê**:
`,te+="- È´òPositionË™ûÔºà‚â•40Ôºâ: "+le.length+"Ë™û / "+ce.length+`Âïè
`,te+="- Ââ≤Âêà: "+(le.length/ce.length*100).toFixed(1)+`%

`,le.length>0?(te+=`**Ê¨°„ÅÆ30ÂïèÂÜÖ„ÅÆÈ´òPositionË™û**ÔºàLocalStorageÂÜçË®àÁÆóÊ∏à„ÅøÔºâ:
`,te+=le.slice(0,10).map((ve,Je)=>{const ee=ve.position??0,ge=ve._originalPosition,Se=ee>=70?"üî¥":"üü°",ue=ee>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":"„Åæ„Å†„Åæ„Å†",Ve=ve.reAddedCount>0?" üîÑ√ó"+ve.reAddedCount:"",yt=ge!==void 0&&ge!==ee?" (ÂÖÉ:"+ge+")":"";return"  "+Se+" "+ve.word+" (Pos "+ee+yt+", "+ue+")"+Ve}).join(`
`),le.length>10&&(te+=`
  _...‰ªñ`+(le.length-10)+"Ë™û_")):te+="‚ö†Ô∏è Ê¨°„ÅÆ30Âïè„Å´È´òPositionË™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàLocalStorageÂÜçË®àÁÆóÂæåÔºâ„ÄÇ";const Pe=Q.incorrect.length+Q.stillLearning.length;return Pe>10&&le.length<5?(te+=`

‚ùå **Ë≠¶Âëä**: È´òPositionË™û„Åå`+Pe+"Ë™ûÂ≠òÂú®„Åó„Åæ„Åô„Åå„ÄÅÊ¨°„ÅÆ30Âïè„Å´„ÅØ"+le.length+"Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ",te+=`
‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØ„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„Åå‰∏çÂçÅÂàÜ„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`):Pe>0&&le.length>=Math.min(Pe,15)&&(te+=`

‚úÖ **ËâØÂ•Ω**: È´òPositionË™û„ÅåÈÅ©Âàá„Å´ÂâçÊñπ„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`),te})()}

---

## üîÑ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Áä∂ÊÖãË®∫Êñ≠

${(()=>{var Je;et();const j=JSON.parse(localStorage.getItem("debug_function_calls")||"[]"),z=JSON.parse(localStorage.getItem("debug_answer_logs")||"[]"),U=JSON.parse(localStorage.getItem("debug_reschedule_events")||"[]"),M=ee=>{const ge=(ee==null?void 0:ee.function)??(ee==null?void 0:ee.name)??(ee==null?void 0:ee.functionName)??"unknown",Se=(ee==null?void 0:ee.params)??(ee==null?void 0:ee.args)??(ee==null?void 0:ee.parameters)??null,ue=(ee==null?void 0:ee.timestamp)??null;return{name:ge,params:Se,ts:ue}},ie=Array.isArray(j)?j.map(M):[],te=Array.isArray(U)?U:[],Q=ie.filter(ee=>ee.name==="sortAndBalance").slice(-1)[0],ce=te.filter(ee=>(ee==null?void 0:ee.mode)===n&&(ee==null?void 0:ee.phase)==="triggered").slice(-1)[0],le=te.filter(ee=>(ee==null?void 0:ee.mode)===n&&(ee==null?void 0:ee.phase)==="applied").slice(-1)[0],Pe=z.slice(-1)[0];let ve=`**üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÁîüÊàêÊÉÖÂ†±**:
`;if(ve+=`
**üîÑ ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºàdebug_reschedule_eventsÔºâ**:
`,le){const ee=new Date(le.timestamp).toLocaleTimeString("ja-JP");if(ve+=`- ÊúÄÂæå„ÅÆÈÅ©Áî®: ${ee} (${le.reason||"ÁêÜÁî±„Å™„Åó"})
`,le.details){const ge=le.details.remainingBefore,Se=le.details.remainingAfter;(ge!=null||Se!=null)&&(ve+=`- ÊÆã„Çä„Ç≠„É•„Éº: ${ge??"‰∏çÊòé"} ‚Üí ${Se??"‰∏çÊòé"}
`)}}else ve+=`- „Åæ„Å†ÈÅ©Áî®„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
`;if(ce){const ee=new Date(ce.timestamp).toLocaleTimeString("ja-JP");ve+=`- ÊúÄÂæå„ÅÆ„Éà„É™„Ç¨„Éº: ${ee} (${ce.reason||"ÁêÜÁî±„Å™„Åó"})
`}if(ve+=`
`,Q){const ee=new Date(Q.ts).toLocaleTimeString("ja-JP");ve+="- ÊúÄÂæå„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞: "+ee+`
`,ve+="- ÂïèÈ°åÊï∞: "+(((Je=Q.params)==null?void 0:Je.questionsCount)||"‰∏çÊòé")+`Âïè
`}else ve+=`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Â±•Ê≠¥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
`;if(Pe){const ee=new Date(Pe.timestamp).toLocaleTimeString("ja-JP");ve+="- ÊúÄÂæå„ÅÆËß£Á≠î: "+ee+" ("+Pe.word+`)
`,ve+="- PositionÂ§âÂåñ: "+Pe.positionBefore+" ‚Üí "+Pe.positionAfter+`
`}if(ve+=`
`,Q&&Pe){const ee=new Date(Q.ts).getTime();if(new Date(Pe.timestamp).getTime()>ee){const Se=z.filter(Ve=>new Date(Ve.timestamp).getTime()>ee).length;ve+="üö® **Ë≠¶Âëä**: „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´"+Se+`ÂõûËß£Á≠î„Åï„Çå„Åæ„Åó„Åü
`,ve+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåÂè§„Åè„Å™„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„ÅåÈ´ò„ÅÑ„Åß„ÅôÔºÅ

`;const ue=z.filter(Ve=>new Date(Ve.timestamp).getTime()>ee&&Math.abs(Ve.positionAfter-Ve.positionBefore)>=10).slice(-10);ue.length>0&&(ve+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÂ§ßÂπÖÂ§âÂåñÔºà¬±10‰ª•‰∏äÔºâ**:
`,ve+=ue.map(Ve=>{const yt=Ve.positionAfter-Ve.positionBefore;return"  "+(yt>0?"üî∫":"üîª")+" "+Ve.word+": "+Ve.positionBefore+" ‚Üí "+Ve.positionAfter+" ("+(yt>0?"+":"")+yt+")"}).join(`
`),ve+=`

`),ve+=`**Êé®Â•®ÂØæÂøú**:
`,ve+=`- ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÇíÂÆüË°åÔºà„Éá„Éº„Çø„ÇΩ„Éº„ÇπÈÅ∏Êäû„Çí„ÇÑ„ÇäÁõ¥„ÅôÔºâ
`,ve+=`- „Åæ„Åü„ÅØ„ÄÅuseQuestionRequeu„ÅÆPosition-awareÊ©üËÉΩ„ÅåËá™ÂãïË™øÊï¥„Åó„Åæ„Åô
`}else ve+=`‚úÖ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÅØÊúÄÊñ∞„Åß„ÅôÔºàËß£Á≠îÂæå„Å´ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Ê∏à„ÅøÔºâ
`}return ve})()}

---

## üß† finalPriority„É¢„Éº„ÉâÔºàvariant CÔºâ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà

${(()=>{const j=localStorage.getItem(`debug_finalPriority_output_${n}`)||localStorage.getItem("debug_finalPriority_output"),z=localStorage.getItem(`debug_finalPriority_sessionStats_${n}`)||localStorage.getItem("debug_finalPriority_sessionStats");if(!j&&!z)return"‚ö†Ô∏è finalPriority„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàfinalPriorityMode„ÅåÊú™‰ΩøÁî® or „Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÔºâ";let U="";if(z)try{const M=JSON.parse(z);U+=`**currentTab**: ${M.currentTab}
`,U+=`**allProgressCount**: ${M.allProgressCount}
`,U+=`**totalQuestions**: ${M.totalQuestions}
`,U+=`**timestamp**: ${M.timestamp}

`,U+=`**aiSessionStats**: ${JSON.stringify(M.aiSessionStats)}

`}catch{U+=`‚ö†Ô∏è sessionStatsËß£Êûê„Å´Â§±Êïó

`}if(!j)return U+"‚ö†Ô∏è debug_finalPriority_output „Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const M=JSON.parse(j);if(!Array.isArray(M)||M.length===0)return U+"‚ö†Ô∏è finalPriority TOP„ÅåÁ©∫„Åß„Åô";const ie=`| # | ÂçòË™û | finalPriority | position | attempts | category |
|---|------|--------------|----------|----------|----------|
`+M.slice(0,30).map(te=>{const Q=Number(te.finalPriority??0),ce=Number(te.position??0),le=Number(te.attempts??0),Pe=te.category??"";return`| ${te.rank??""} | **${te.word}** | ${Q.toFixed(3)} | ${ce.toFixed(0)} | ${le} | ${Pe} |`}).join(`
`);return U+ie}catch{return U+"‚ö†Ô∏è finalPriorityËß£Êûê„Å´Â§±Êïó"}})()}

---

## üìù Ëß£Á≠îÂá¶ÁêÜ„É≠„Ç∞ (ÊúÄÊñ∞10‰ª∂)
${x.length>0?x.map((j,z)=>{var Ve;const M=Math.abs(j.positionAfter-j.positionBefore)>1?j.positionAfter>j.positionBefore?"üî∫":"üîª":"‚Üí",te=(Ve=et().wordProgress)==null?void 0:Ve[j.word],Q=(()=>{if(!te)return{attempts:0,correct:0,stillLearning:0,incorrect:0};const yt=(()=>{switch(j.mode){case"memorization":return te.memorizationAttempts??0;case"translation":return te.translationAttempts??0;case"spelling":return te.spellingAttempts??0;case"grammar":return te.grammarAttempts??0;default:return te.totalAttempts??0}})(),ot=(()=>{switch(j.mode){case"memorization":return te.memorizationCorrect??0;case"translation":return te.translationCorrect??0;case"spelling":return te.spellingCorrect??0;case"grammar":return te.grammarCorrect??0;default:return te.correctCount??0}})(),Ge=j.mode==="memorization"?te.memorizationStillLearning??0:0,Ut=yt-ot-Ge;return{attempts:yt,correct:ot,stillLearning:Ge,incorrect:Ut}})(),ce=(()=>{var at,He,qe;const yt=Number(((at=j.progress)==null?void 0:at.modeAttempts)??0),ot=Number(((He=j.progress)==null?void 0:He.modeCorrect)??0),Ge=Number(((qe=j.progress)==null?void 0:qe.modeStillLearning)??0),Ut=yt-ot-Ge;return{attempts:yt,correct:ot,stillLearning:Ge,incorrect:Ut}})(),le=Q.correct!==ce.correct||Q.stillLearning!==ce.stillLearning||Q.incorrect!==ce.incorrect,Pe=" | **ÂÆüÈöõ„ÅÆLS**: Ê≠£Ëß£"+Q.correct+"/„Åæ„Å†„Åæ„Å†"+Q.stillLearning+"/Ë™§Á≠î"+Q.incorrect+" (Ë®à"+Q.attempts+"Âõû)"+(le?" ‚ö†Ô∏è**‰∏ç‰∏ÄËá¥**":""),ve=j.savedPositionDebug,Je=ve==null?void 0:ve.savedPosition,ee=ve==null?void 0:ve.decision,ge=ve==null?void 0:ve.reason,Se=j.positionWithSavedPosition,ue=Je!==void 0||Se!==void 0?" | **savedPosition**: "+(Je??"-")+" | **calc(savedÊúâ„Çä)**: "+(Se??"-")+" | **calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå)**: "+(j.positionAfter??"-")+(ee?" | **savedÂà§ÂÆö**: "+ee+(ge?" ("+ge+")":""):""):"";return z+1+". **"+j.word+"**: Position "+j.positionBefore.toFixed(0)+" "+M+" "+j.positionAfter.toFixed(0)+" ("+j.category+") [„É≠„Ç∞(mode): Ê≠£Ëß£"+ce.correct+"/„Åæ„Å†„Åæ„Å†"+ce.stillLearning+"/Ë™§Á≠î"+ce.incorrect+"]"+Pe+ue}).join(`
`):"‚ö†Ô∏è Ëß£Á≠î„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†Ëß£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

---

## üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (${p.length}Ë™û)

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„ÅÆË°®„ÅØ**LocalStorage„ÅÆÁîüPosition„Éá„Éº„Çø**„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
GamificationAI„Å´„Çà„Çã„Éñ„Éº„Çπ„ÉàÂæå„ÅÆPositionÔºà„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊôÇÔºâ„ÅØ„ÄÅÊ¨°„ÅÆ„Äå„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„Äç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

| # | ÂçòË™û | Position (LS) | Áä∂ÊÖã | Ë©¶Ë°åÂõûÊï∞ | ÊúÄÁµÇÂ≠¶Áøí | ÈÄ£Á∂öË™§Á≠î |
|---|------|---------------|------|----------|----------|----------|
${p.slice(0,30).map((j,z)=>{var ce;const U=j.lastStudied?new Date(j.lastStudied).toLocaleDateString():"-",M=j.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†",te=(ce=et().wordProgress)==null?void 0:ce[j.word],Q=(te==null?void 0:te.consecutiveIncorrect)??0;return`| ${z+1} | **${j.word}** | ${j.position.toFixed(0)} | ${M} | ${j.attempts}Âõû | ${U} | ${Q}Âõû |`}).join(`
`)}

_‚Ä¶‰ªñ${Math.max(0,p.length-30)}Ë™ûÁúÅÁï•_

### üìä „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÔºà„Éñ„Éº„Çπ„ÉàÂæåÔºâ

${(()=>{try{const j=localStorage.getItem("debug_still_learning_boost");if(!j)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const z=JSON.parse(j);return!z.working||z.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÁµêÊûú**: ${z.boosted}Ë™û„Åå Position 60-69 „Å´Âºï„Åç‰∏ä„Åí ‚úÖ

| # | ÂçòË™û | Before | After | Â¢óÂä†Èáè |
|---|------|--------|-------|--------|
${z.changes.slice(0,20).map((U,M)=>`| ${M+1} | **${U.word}** | ${U.before.toFixed(0)} | ${U.after.toFixed(0)} | +${(U.after-U.before).toFixed(0)} |`).join(`
`)}

${z.changes.length>20?"_‚Ä¶‰ªñ"+(z.changes.length-20)+"Ë™û_":""}

**üéØ ÈáçË¶Å**: „Åì„ÅÆË°®„ÅÆ„ÄåAfter„Äç„Ç´„É©„É†„Åå„ÄÅÂÆüÈöõ„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Åß‰Ωø„Çè„Çå„ÇãPositionÂÄ§„Åß„Åô„ÄÇ`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

---

## üìã postProcess()Âæå„ÅÆTOP30Ôºà„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: **debug_postProcess_output** „ÅØ **postProcess()Âæå„ÅÆTOP30„ÅÆ„Åø**„Çí‰øùÂ≠ò„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÁèæÂú®‰ΩçÁΩÆÔºàcurrentIndexÔºâ„Å´ËøΩÂæì„Åô„Çã„ÄåÊ¨°„ÅÆ30Âïè„Äç„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ

${(()=>{const j=Li(n);return!j||j.length===0?`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÁµêÊûú„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

**ÂÖÉ„ÅÆJSONÈ†ÜÂ∫èÔºàÂèÇËÄÉÊÉÖÂ†±„ÅÆ„ÅøÔºâ**:
`+s.slice(e+1,e+31).map((z,U)=>{var le;const ie=(le=et().wordProgress)==null?void 0:le[z.word],te=ie?Bt(ie,n):35,Q=(()=>{if(!ie)return 0;switch(n){case"memorization":return ie.memorizationAttempts??0;case"translation":return ie.translationAttempts??0;case"spelling":return ie.spellingAttempts??0;case"grammar":return ie.grammarAttempts??0;default:return ie.totalAttempts??0}})(),ce=Q===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":te>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":te>=40?"üü° „Åæ„Å†„Åæ„Å†":te>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(U+1)+" | "+(e+U+2)+"ÂïèÁõÆ | **"+z.word+"** | "+te.toFixed(0)+" | "+Q+"Âõû | "+(z.difficulty||"unknown")+" | "+ce+" |"}).join(`
`):`| # | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Áä∂ÊÖã |
|---|------|----------|----------|------|
`+j.map((z,U)=>{const M=z.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":z.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":z.position>=40?"üü° „Åæ„Å†„Åæ„Å†":z.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(U+1)+" | **"+z.word+"** | "+(z.position??0).toFixed(0)+" | "+z.attempts+"Âõû | "+M+" |"}).join(`
`)})()}

---

## üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÔºöÊ¨°„ÅÆÂá∫È°å‰∫àÂÆö (30ÂïèÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„Çå„ÅØ„Äå„ÅÑ„Åæ‰øùÊåÅ„Åó„Å¶„ÅÑ„Çã„Ç≠„É•„ÉºÔºàquestionsÔºâ„Äç„ÅÆ„ÄåcurrentIndex+1..+30„Äç„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ
Position„ÅØ LocalStorage „Åã„ÇâÂÜçË®àÁÆó„Åó„ÅüÂÄ§„Åß„ÅôÔºàdetermineWordPosition()Ôºâ„ÄÇ

${(()=>{if(!s||s.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const j=et(),z=s.slice(e+1,e+31);return z.length===0?"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ":`| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
`+z.map((U,M)=>{var ve;const ie=String((U==null?void 0:U.word)??""),te=(ve=j.wordProgress)==null?void 0:ve[ie],Q=te?Bt(te,n):35,ce=(()=>{if(!te)return 0;switch(n){case"memorization":return te.memorizationAttempts??0;case"translation":return te.translationAttempts??0;case"spelling":return te.spellingAttempts??0;case"grammar":return te.grammarAttempts??0;default:return te.totalAttempts??0}})(),le=(U==null?void 0:U.difficulty)??"‰∏çÊòé",Pe=ce===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":Q>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":Q>=40?"üü° „Åæ„Å†„Åæ„Å†":Q>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return`| ${M+1} | ${e+M+2}ÂïèÁõÆ | **${ie}** | ${Q.toFixed(0)} | ${ce}Âõû | ${le} | ${Pe} |`}).join(`
`)})()}

**üîç ÂàÜÊûê**:
- „Åæ„Å†„Åæ„Å†(Position 45)„Åå‰∏ä‰Ωç„Å´Êù•„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 50„ÅÆÂºï„Åç‰∏ä„ÅíÂçòË™û„ÅåÊ∑∑ÂÖ•„Åó„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 0„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰ΩçÁã¨Âç†„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÔºü ‚Üí ‚ùå ÂïèÈ°å„ÅÇ„Çä

---

## üìã ÊÆã„Çä„Ç≠„É•„ÉºÔºàLocalStorage PositionÈôçÈ†Ü TOP30Ôºâ

„Åì„ÅÆË°®Á§∫„ÅØ„ÄÅÊÆã„ÇäÂïèÈ°å„Çí LocalStorage „ÅÆÁîüPosition„Åß **ÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„ÅüTOP30** „Åß„ÅôÔºàÂèÇËÄÉÔºâ„ÄÇ

| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
${(()=>{const j=et();return s.slice(e+1).map(U=>{var Pe;const M=U==null?void 0:U.word,ie=(Pe=j.wordProgress)==null?void 0:Pe[M],te=ie?Bt(ie,n):35,Q=(()=>{if(!ie)return 0;switch(n){case"memorization":return ie.memorizationAttempts??0;case"translation":return ie.translationAttempts??0;case"spelling":return ie.spellingAttempts??0;case"grammar":return ie.grammarAttempts??0;default:return ie.totalAttempts??0}})(),ce=(U==null?void 0:U.difficulty)??"‰∏çÊòé",le=Q===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":te>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":te>=40?"üü° „Åæ„Å†„Åæ„Å†":te>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return{word:M,position:te,attempts:Q,difficulty:ce,status:le,originalQuestion:U}}).sort((U,M)=>M.position-U.position).slice(0,30).map((U,M)=>`| ${M+1} | - | **${U.word}** | ${U.position.toFixed(0)} | ${U.attempts}Âõû | ${U.difficulty} | ${U.status} |`).join(`
`)})()}

---

## ü§ñ AIË©ï‰æ°Â±•Ê≠¥ (ÊúÄÊñ∞${Math.max(c.length,20)}‰ª∂)

${Nt}

---

## üìä Áµ±Ë®à„Çµ„Éû„É™„Éº

- **Á∑èÂïèÈ°åÊï∞**: ${t}Âïè
- **ÁèæÂú®ÈÄ≤Êçó**: ${((e+1)/t*100).toFixed(1)}%
- **LocalStorage‰øùÂ≠ò‰∏≠Ôºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÔºâ**: ${p.length}Ë™û
  - ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${p.filter(j=>j.position>=70).length}Ë™û
  - „Åæ„Å†„Åæ„Å† (Position‚â•40): ${p.filter(j=>j.position>=40&&j.position<70).length}Ë™û
- **Ê¨°30Âïè‰∏≠„ÅÆÁä∂ÊÖãÂà•**Ôºà„Ç≠„É•„ÉºÈ†ÜÔºèPosition„ÅØLocalStorage„Åã„ÇâÂÜçË®àÁÆóÔºâ:
  - üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(()=>{const j=et();return s.slice(e+1,e+31).filter(U=>{var Q;const M=String((U==null?void 0:U.word)??""),ie=(Q=j.wordProgress)==null?void 0:Q[M];return(ie?Bt(ie,n):35)>=70}).length})()}Âïè
  - üü° „Åæ„Å†„Åæ„Å†: ${(()=>{const j=et();return s.slice(e+1,e+31).filter(U=>{var Q;const M=String((U==null?void 0:U.word)??""),ie=(Q=j.wordProgress)==null?void 0:Q[M],te=ie?Bt(ie,n):35;return te>=40&&te<70}).length})()}Âïè
  - ‚ö™ Êñ∞Ë¶è: ${(()=>{const j=et();return s.slice(e+1,e+31).filter(U=>{var ce;const M=String((U==null?void 0:U.word)??""),ie=(ce=j.wordProgress)==null?void 0:ce[M],te=(()=>{if(!ie)return 0;switch(n){case"memorization":return ie.memorizationAttempts??0;case"translation":return ie.translationAttempts??0;case"spelling":return ie.spellingAttempts??0;case"grammar":return ie.grammarAttempts??0;default:return ie.totalAttempts??0}})(),Q=ie?Bt(ie,n):35;return te===0||Q>=20&&Q<40}).length})()}Âïè
  - ‚úÖ ÂÆöÁùÄÊ∏à: ${(()=>{const j=et();return s.slice(e+1,e+31).filter(U=>{var ce;const M=String((U==null?void 0:U.word)??""),ie=(ce=j.wordProgress)==null?void 0:ce[M],te=(()=>{if(!ie)return 0;switch(n){case"memorization":return ie.memorizationAttempts??0;case"translation":return ie.translationAttempts??0;case"spelling":return ie.spellingAttempts??0;case"grammar":return ie.grammarAttempts??0;default:return ie.totalAttempts??0}})(),Q=ie?Bt(ie,n):35;return te>0&&Q<20}).length})()}Âïè

## üîç „Éá„Éê„ÉÉ„Ç∞„Éí„É≥„Éà

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
1. „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÇíPositionÂºï„Åç‰∏ä„Åí
2. Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „Åå Position +15 ‚Üí 40-55„Çæ„Éº„É≥„Å´Ê∑∑ÂÖ•
3. PositionÈôçÈ†Ü„ÇΩ„Éº„Éà ‚Üí „Åæ„Å†„Åæ„Å†5Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆÊØîÁéá„ÅßÂá∫È°å

**Á¢∫Ë™ç„Éù„Ç§„É≥„Éà**:
- [ ] calculatePriorities() „ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] applyInterleavingAdjustment() „ÅåÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] Êñ∞Ë¶è„ÅÆPosition„Åå +15 „Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºüÔºà„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞Á¢∫Ë™çÔºâ
- [ ] sortAndBalance() „ÅåPositionÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„Å¶„ÅÑ„Çã„ÅãÔºü

---

## üéØ ÂÆü„Éá„Éº„ÇøÊ§úË®ºÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÂê∏ÂºïÁ¢∫Ë™çÔºâ

${(()=>{const j=Li(n);if(!j||j.length===0)return"‚ö†Ô∏è postProcessÂá∫Âäõ„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´ÂÜçÂ∫¶Á¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";const z=rp(n),U=new Set(z.map(Pe=>$e(Pe.word))),M=j.slice(0,30).map((Pe,ve)=>{const Je=String((Pe==null?void 0:Pe.word)??""),ee=$e(Je),ge=U.has(ee),Se=Number((Pe==null?void 0:Pe.position)??0),ue=Number((Pe==null?void 0:Pe.attempts)??0);return{rank:ve+1,word:Je,position:Se,attempts:ue,isStruggling:ge}}),ie=M.filter(Pe=>Pe.isStruggling).length,te=M.slice(0,10).filter(Pe=>Pe.isStruggling).length,Q=Math.min(z.length,30),ce=z.length>0?(ie/z.length*100).toFixed(1):"0.0";let le=`**üìä ÂÆü„Éá„Éº„ÇøÂàÜÊûêÁµêÊûúÔºàpostProcessÂá∫ÂäõÔºâ**:
`;return le+="- ÂÖ®„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: "+z.length+`Ë™û
`,le+="- TOP30ÂÜÖ„Å´Â≠òÂú®: "+ie+"Ë™û / "+Q+`Ë™ûÔºàÊúüÂæÖÂÄ§Ôºâ
`,le+="- TOP10ÂÜÖ„Å´Â≠òÂú®: "+te+`Ë™û
`,le+="- „Ç´„Éê„ÉºÁéá: "+ce+`%

`,z.length===0?le+=`‚úÖ **„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì** ‚Üí Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ
`:ie>=Math.min(z.length,20)?le+="‚úÖ **Âê∏ÂºïÊàêÂäü**: TOP30„Å´"+ie+`Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ¢∫ÂÆü„Å´ÂÑ™ÂÖàÂá∫È°å„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`:ie>=Math.ceil(z.length*.5)?le+="‚ö†Ô∏è **ÈÉ®ÂàÜÁöÑÂê∏Âºï**: TOP30„Å´"+ie+"Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÊúüÂæÖÂÄ§Ôºà"+Q+`Ë™ûÔºâ„Çà„ÇäÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ
`:(le+="‚ùå **Âê∏ÂºïÂ§±Êïó**: TOP30„Å´"+ie+`Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,le+=`‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØPositionÂÄ§„Åå‰∏çÊ≠£Á¢∫„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),le+=`
**TOP10„ÅÆÂÜÖË®≥**:
`,le+=M.slice(0,10).map(Pe=>{const ve=Pe.isStruggling?"üî¥":Pe.position>=40?"üîµ":Pe.position>=20?"‚ö™":"‚úÖ",Je=Pe.isStruggling?"„Åæ„Å†„Åæ„Å†/ÂàÜ„Åã„Çâ„Å™„ÅÑ":Pe.position>=40?"Êñ∞Ë¶è(Âºï‰∏ä)":Pe.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";return Pe.rank+". "+ve+" **"+Pe.word+"** (Pos "+Pe.position+", "+Pe.attempts+"Âõû) - "+Je}).join(`
`),le})()}

---

### üéØ Position-aware InsertionÔºà„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥ÔºâÊ§úË®º

${(()=>{const j=localStorage.getItem("debug_position_aware_insertions");if(!j)return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÂÜçÂá∫È°å„Åï„Çå„Çã„Å®Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ`;try{const z=JSON.parse(j);if(!Array.isArray(z)||z.length===0)return"‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåÁ©∫„Åß„Åô„ÄÇ";let U=`**üìä ÊåøÂÖ•Ë™øÊï¥„ÅÆÂÆüË°åÂ±•Ê≠¥ÔºàÊúÄÊñ∞${z.length}‰ª∂Ôºâ**:

`;z.slice(-10).forEach((Q,ce)=>{const le=new Date(Q.timestamp).toLocaleTimeString("ja-JP"),Pe=Q.adjustedInsert!==Q.originalInsert;if(U+=`${Pe?"üéØ":"‚ö™"} **${Q.word}** (Position ${Q.position})
`,U+=`  - ÊôÇÂàª: ${le}
`,U+=`  - ÂÖÉ„ÅÆÊåøÂÖ•‰ΩçÁΩÆ: index ${Q.originalInsert} (ÁèæÂú®‰ΩçÁΩÆ+${Q.originalInsert-Q.currentIndex})
`,Pe){if(U+=`  - üéØ Ë™øÊï¥Âæå: index ${Q.adjustedInsert} (ÁèæÂú®‰ΩçÁΩÆ+${Q.adjustedInsert-Q.currentIndex})
`,U+=`  - ÁêÜÁî±: È´òPositionÂçòË™ûÁæ§„Å´Ââ≤„ÇäËæº„Åø
`,Q.nearbyHighPositions&&Q.nearbyHighPositions.length>0){const Je=Q.nearbyHighPositions.slice(0,3).map(ee=>`${ee.word}(${ee.position})`).join(", ");U+=`  - ËøëÈö£„ÅÆÈ´òPositionË™û: ${Je}${Q.nearbyHighPositions.length>3?"...":""}
`}}else U+=`  - Ë™øÊï¥„Å™„ÅóÔºàËøë„Åè„Å´È´òPositionË™û„ÅåË¶ã„Å§„Åã„Çâ„Å™„Åã„Å£„ÅüÔºâ
`;U+=`
`});const ie=z.filter(Q=>Q.adjustedInsert!==Q.originalInsert).length,te=(ie/z.length*100).toFixed(1);return U+=`**üìà Áµ±Ë®à„Çµ„Éû„É™**:
`,U+=`- Á∑èÊåøÂÖ•ÂõûÊï∞: ${z.length}Âõû
`,U+=`- Position-awareË™øÊï¥: ${ie}Âõû (${te}%)
`,U+=`- ÈÄöÂ∏∏ÊåøÂÖ•: ${z.length-ie}Âõû

`,ie>0?(U+=`‚úÖ **„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**
`,U+=`‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÊó¢Â≠ò„ÅÆÈ´òPositionË™û„ÅÆËøë„Åè„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`):(U+=`‚ö†Ô∏è **Ë™øÊï¥„Åå1Â∫¶„ÇÇÁô∫Áîü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì**
`,U+=`‚Üí „Ç≠„É•„ÉºÂÜÖ„Å´È´òPositionË™û„ÅåÂ∞ë„Å™„ÅÑ„Åã„ÄÅÂÜçÂá∫È°å„Åå„Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),U}catch(z){return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅÆËß£Êûê„Å´Â§±Êïó: ${z}`}})()}

---

### üîÑ ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„É≠„Ç∞ÔºàuseQuestionRequeueÔºâ

${(()=>{const j=localStorage.getItem("debug_requeue_events");if(!j)return"‚ö†Ô∏è debug_requeue_events „Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const z=JSON.parse(j);if(!Array.isArray(z)||z.length===0)return"‚ö†Ô∏è debug_requeue_events „ÅåÁ©∫„Åß„Åô";const U=z.filter(ce=>String((ce==null?void 0:ce.mode)??"")===n),M=(U.length>0?U:z).slice(-30),ie=M.filter(ce=>(ce==null?void 0:ce.decision)==="inserted").length,te=M.filter(ce=>String((ce==null?void 0:ce.decision)??"").startsWith("skipped")).length;let Q=`**üìä „Çµ„Éû„É™**: inserted=${ie}, skipped=${te}ÔºàË°®Á§∫: ${U.length>0?n:"ÂÖ®„É¢„Éº„Éâ"} / ÊúÄÊñ∞${M.length}‰ª∂Ôºâ

`;return Q+=M.map((ce,le)=>{const Pe=ce!=null&&ce.timestamp?new Date(ce.timestamp).toLocaleTimeString("ja-JP"):"-",ve=String((ce==null?void 0:ce.word)??(ce==null?void 0:ce.qid)??"(unknown)"),Je=String((ce==null?void 0:ce.decision)??"unknown"),ee=String((ce==null?void 0:ce.reason)??""),ge=Number.isFinite(Number(ce==null?void 0:ce.plannedOffset))?Number(ce.plannedOffset):null,Se=Number.isFinite(Number(ce==null?void 0:ce.insertAt))?Number(ce.insertAt):null,ue=Number.isFinite(Number(ce==null?void 0:ce.currentIndex))?Number(ce.currentIndex):null,Ve=(ce==null?void 0:ce.questionPosition)??null,yt=(ce==null?void 0:ce.ssotPosition)??null,ot=(ce==null?void 0:ce.effectivePosition)??null,Ge=`pos(q)=${Ve??"-"}, pos(ssot)=${yt??"-"}, pos(used)=${ot??"-"}`,Ut=Je==="inserted"&&Se!=null&&ue!=null?`insert@index ${Se} (ÁèæÂú®‰ΩçÁΩÆ+${Se-ue})`:Je.startsWith("skipped")?`skip (windowEnd=${(ce==null?void 0:ce.windowEnd)??"-"})`:"",at=ge!=null?`offset=${ge}`:"";return`${le+1}. ${Pe} [${Je}] **${ve}** (${ee}) ${at} ${Ut} | ${Ge}`}).join(`
`),Q}catch(z){return`‚ö†Ô∏è debug_requeue_events „ÅÆËß£Êûê„Å´Â§±Êïó: ${String(z)}`}})()}

---

_„Åì„ÅÆ„É¨„Éù„Éº„Éà„Çí„Ç≥„Éî„Éº„Åó„Å¶GitHub Copilot Chat„ÅßÂàÜÊûê„Åß„Åç„Åæ„Åô_
`.trim();navigator.clipboard.writeText(mt).then(()=>{h(!0),setTimeout(()=>h(!1),2e3)})};return $.useEffect(()=>{const C=localStorage.getItem("debug_ai_evaluations");if(C)try{const T=JSON.parse(C);l(Object.values(T).slice(-10))}catch{}{const T="memorization",_=t,D=oe=>{if(!oe)return null;try{return JSON.parse(oe)}catch{return null}},P=oe=>{const xe=typeof oe=="number"?oe:Number(oe);return Number.isFinite(xe)?xe:null},A=oe=>{const xe=Date.parse(String(oe??""));return Number.isFinite(xe)?xe:0},F=oe=>{const xe=oe.filter(Boolean);if(xe.length===0)return null;const $e=xe.filter(Re=>P(Re==null?void 0:Re.questionsCount)===_);return $e.length>0?($e.sort((Re,ze)=>A(ze==null?void 0:ze.timestamp)-A(Re==null?void 0:Re.timestamp)),$e[0]):[...xe].sort((Re,ze)=>{const Ye=P(Re==null?void 0:Re.questionsCount)??-1,Te=P(ze==null?void 0:ze.questionsCount)??-1;return Te!==Ye?Te-Ye:A(ze==null?void 0:ze.timestamp)-A(Re==null?void 0:Re.timestamp)})[0]},O=`debug_position_interleaving_history_${T}`,V=D(localStorage.getItem(O)),L=Array.isArray(V)?V:[],H=F(L),J=`debug_position_interleaving_${T}`,X=D(localStorage.getItem(J)),fe=D(localStorage.getItem("debug_position_interleaving")),be=H??X??fe;be&&g(be)}const k=localStorage.getItem("debug_answer_logs");if(k)try{y(JSON.parse(k))}catch{}const I=localStorage.getItem("debug_function_calls");if(I)try{v(JSON.parse(I))}catch{}localStorage.getItem("debug_position_hierarchy_validation"),localStorage.getItem("debug_position_hierarchy_still"),localStorage.getItem("debug_position_hierarchy_new")},[e]),i?u.jsxs("div",{className:"fixed bottom-4 right-4 w-96 max-h-96 bg-white rounded-lg shadow-2xl overflow-auto z-50 border-2 border-blue-500",children:[u.jsxs("div",{className:"sticky top-0 bg-blue-600 text-white p-3 flex justify-between items-center",children:[u.jsx("h3",{className:"font-bold",children:"üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„Éë„Éç„É´"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:N,className:`px-3 py-1 rounded ${d?"bg-green-500":"bg-blue-500 hover:bg-blue-700"}`,title:"„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„Åß„Ç≥„Éî„Éº",children:d?"‚úì „Ç≥„Éî„ÉºÂÆå‰∫Ü":"üìã „Ç≥„Éî„Éº"}),u.jsx("button",{onClick:()=>a(!1),className:"text-white hover:bg-blue-700 px-2 py-1 rounded",children:"‚úï"})]})]}),u.jsxs("div",{className:"p-4 space-y-4 text-sm",children:[(()=>{try{const C=localStorage.getItem("debug_ab_session_info");if(!C)return null;const k=JSON.parse(C),I=JSON.stringify(k,null,2);return u.jsxs("div",{className:"bg-orange-50 p-3 rounded border-2 border-orange-300",children:[u.jsx("p",{className:"font-semibold text-orange-800",children:"üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±Ôºà„Ç≥„Éî„ÉöÁî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„ÇØ„É™„ÉÉ„ÇØ„ÅßJSON„Çí„Ç≥„Éî„Éº"}),u.jsx("pre",{className:"mt-2 bg-white p-2 rounded text-xs cursor-pointer whitespace-pre-wrap break-words",onClick:()=>{navigator.clipboard.writeText(I),h(!0),setTimeout(()=>h(!1),1500)},title:"„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Ç≥„Éî„Éº",children:I})]})}catch{return null}})(),(()=>{const C=Pu.generateSummary(n);if(C==="„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó"||C==="„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó")return u.jsxs("div",{className:"bg-gray-50 p-3 rounded border-2 border-gray-300",children:[u.jsx("p",{className:"font-semibold text-gray-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°"}),u.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„ÅóÔºàÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ"})]});const I=C.split(`
`).filter(F=>F.trim()).filter(F=>F.startsWith("|"));if(I.length===0)return null;const[T,_,...D]=I,P=T.split("|").filter(F=>F.trim()).map(F=>F.trim()),A=D.map(F=>F.split("|").filter(O=>O.trim()).map(O=>O.trim()));return u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ"}),u.jsx("div",{className:"mt-2 overflow-x-auto",children:u.jsxs("table",{className:"min-w-full text-xs",children:[u.jsx("thead",{children:u.jsx("tr",{className:"bg-purple-100",children:P.map((F,O)=>u.jsx("th",{className:"px-2 py-1 text-left font-semibold",children:F},O))})}),u.jsx("tbody",{children:A.map((F,O)=>u.jsx("tr",{className:O%2===0?"bg-white":"bg-purple-50",children:F.map((V,L)=>u.jsx("td",{className:"px-2 py-1",children:V},L))},O))})]})})]})})(),(()=>{const C=et(),k=Object.keys(C.wordProgress||{}).length,I=Object.values(C.wordProgress||{});let T=0,_=0,D=0,P=0,A=0,F=0;for(const H of I){const J=up(H,n),X=Ty(H,n),fe=Ay(H,n),be=Bt(H,n);P+=J,A+=X,F+=fe,J!==0&&(be>=70?D++:be>=40?_++:be<20&&T++)}const O=Math.max(0,P-A-F),V=P>0?(A/P*100).toFixed(1):"0.0",L=k>0?(T/k*100).toFixed(1):"0.0";return u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsx("p",{className:"font-semibold text-green-800",children:"„Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"Á∑èÂçòË™ûÊï∞"}),u.jsxs("p",{className:"text-lg font-bold",children:[k,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÁøíÂæóÊ∏à„Åø"}),u.jsxs("p",{className:"text-lg font-bold text-green-600",children:[T,"Ë™û"]}),u.jsxs("p",{className:"text-xs text-gray-500",children:["(",L,"%)"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"„Åæ„Å†„Åæ„Å†"}),u.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:[_,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"}),u.jsxs("p",{className:"text-lg font-bold text-red-600",children:[D,"Ë™û"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÂÖ®‰ΩìÊ≠£Á≠îÁéá:"}),u.jsxs("span",{className:"font-bold",children:[V,"%"]})]}),u.jsxs("div",{className:"flex justify-between mt-1",children:[u.jsx("span",{className:"text-gray-600",children:"Á∑èË©¶Ë°åÂõûÊï∞:"}),u.jsxs("span",{children:[P,"Âõû"]})]}),u.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[u.jsxs("span",{className:"text-green-600",children:["Ê≠£Á≠î: ",A,"Âõû"]}),u.jsxs("span",{className:"text-red-600",children:["Ë™§Á≠î: ",O,"Âõû"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÈÄ≤ÊçóÁéá:"}),u.jsxs("span",{className:"font-bold",children:[(e/t*100).toFixed(1),"%"]})]}),u.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e," / ",t," ÂïèÁõÆ"]}),u.jsx("progress",{className:"w-full h-2 rounded-full mt-2 [&::-webkit-progress-bar]:bg-gray-200 [&::-webkit-progress-value]:bg-blue-600 [&::-moz-progress-bar]:bg-blue-600",value:e,max:Math.max(1,t)})]})]})]})})(),b.length>0&&u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsxs("p",{className:"font-semibold text-blue-800",children:["üìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞",b.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:b.slice().reverse().map((C,k)=>u.jsxs("div",{className:"text-xs bg-white p-2 rounded flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-mono font-bold text-blue-600",children:C.function}),u.jsx("span",{className:"ml-2 text-gray-600",children:JSON.stringify(C.params)})]}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})]},k))})]}),x.length>0&&u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsxs("p",{className:"font-semibold text-green-800",children:["üìù Ëß£Á≠îÁõ¥Âæå„ÅÆPositionË®àÁÆó (ÊúÄÊñ∞",x.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:x.slice().reverse().map((C,k)=>{const I=Math.abs(C.positionAfter-C.positionBefore)>1,T=C.positionAfter>C.positionBefore;return u.jsxs("div",{className:"text-xs bg-white p-2 rounded border",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:C.word}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})]}),u.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-600",children:"Position: "}),u.jsxs("span",{className:I?T?"text-red-600 font-bold":"text-green-600 font-bold":"",children:[C.positionBefore.toFixed(0)," ‚Üí ",C.positionAfter.toFixed(0)]}),I&&u.jsxs("span",{className:"ml-2",children:[T?"üî∫":"üîª",Math.abs(C.positionAfter-C.positionBefore).toFixed(0)]})]}),(()=>{const _=(()=>{switch(C.category){case"incorrect":return{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded text-xs",label:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs",label:"üü° „Åæ„Å†„Åæ„Å†"};case"new":return{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs",label:"‚ö™ Êñ∞Ë¶è"};case"mastered":return{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs",label:"‚úÖ ÂÆöÁùÄÊ∏à"};default:return{className:"bg-gray-100 text-gray-800 px-2 py-0.5 rounded text-xs",label:String(C.category??"")}}})();return u.jsx("span",{className:_.className,children:_.label})})()]}),u.jsxs("div",{className:"mt-1 flex gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["Ê≠£Á≠î: ",C.progress.correctCount]}),u.jsxs("span",{children:["Ë™§Á≠î: ",C.progress.incorrectCount]}),u.jsxs("span",{children:["ÈÄ£Á∂öÊ≠£Á≠î: ",C.progress.consecutiveCorrect]}),u.jsxs("span",{children:["ÈÄ£Á∂öË™§Á≠î: ",C.progress.consecutiveIncorrect]}),u.jsxs("span",{children:["Ê≠£Á≠îÁéá: ",(C.progress.accuracy*100).toFixed(0),"%"]})]}),(()=>{var O,V;const _=C.savedPositionDebug,D=_==null?void 0:_.savedPosition,P=_==null?void 0:_.decision,A=_==null?void 0:_.reason,F=C.positionWithSavedPosition;return D===void 0&&F===void 0&&!P?null:u.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["savedPosition: ",D??"-"]}),u.jsxs("span",{children:["calc(savedÊúâ„Çä): ",F??"-"]}),u.jsxs("span",{children:["calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå): ",((V=(O=C.positionAfter)==null?void 0:O.toFixed)==null?void 0:V.call(O,0))??"-"]}),P&&u.jsxs("span",{children:["savedÂà§ÂÆö: ",String(P),A?` (${String(A)})`:""]})]})})()]},k)})})]}),m&&u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üéÆ PositionÂàÜÊï£Ë®∫Êñ≠"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Ââç:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",m.before.struggling,"Ë™û / Êñ∞Ë¶è",m.before.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Âæå:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",m.after.struggling,"Ë™û / Êñ∞Ë¶è",m.after.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between font-bold",children:[u.jsx("span",{children:"PositionÂºï„Åç‰∏ä„Åí:"}),u.jsxs("span",{className:m.summary.working?"text-green-600":"text-red-600",children:[m.summary.boosted,"Ë™û",m.summary.working?" ‚úÖ":" ‚ùå"]})]}),m.changed.length>0&&u.jsxs("details",{className:"mt-2",children:[u.jsxs("summary",{className:"cursor-pointer text-purple-700",children:["Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û (",m.changed.length,"Ë™û)"]}),u.jsx("ul",{className:"mt-1 space-y-1 max-h-40 overflow-y-auto",children:m.changed.slice(0,10).map((C,k)=>u.jsxs("li",{className:"text-xs bg-white p-1 rounded",children:[u.jsx("span",{className:"font-mono",children:C.word}),":"," ",u.jsxs("span",{className:"text-gray-500",children:[C.before.toFixed(0)," ‚Üí ",C.after.toFixed(0)]})]},k))})]}),!m.summary.working&&u.jsx("div",{className:"text-red-600 font-bold mt-2",children:"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„Éñ„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ"})]})]}),(()=>{const C=Li(n).slice(0,30);if(C.length===0)return null;try{const k=C.map(P=>P.attempts>0&&P.position>=40&&P.position<70?"„Åæ„Å†„Åæ„Å†":P.attempts===0&&P.position>=40&&P.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":P.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":P.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),I={„Åæ„Å†„Åæ„Å†:k.filter(P=>P==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:k.filter(P=>P==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:k.filter(P=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(P)).length},T=k.slice(0,20).map(P=>{switch(P){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join("");let _=0;for(let P=0;P<k.length-1;P++){const A=k[P],F=k[P+1];A==="„Åæ„Å†„Åæ„Å†"&&F==="Êñ∞Ë¶è(Âºï‰∏ä)"&&_++,A==="Êñ∞Ë¶è(Âºï‰∏ä)"&&F==="„Åæ„Å†„Åæ„Å†"&&_++}const D=_>=3;return u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üü° „Åæ„Å†„Åæ„Å†:"}),u.jsxs("span",{className:"font-bold",children:[I.„Åæ„Å†„Åæ„Å†,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üîµ Êñ∞Ë¶è(Âºï‰∏ä):"}),u.jsxs("span",{className:"font-bold",children:[I.Êñ∞Ë¶èÂºï‰∏ä,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"„Åù„ÅÆ‰ªñ:"}),u.jsxs("span",{children:[I.„Åù„ÅÆ‰ªñ,"Ë™û"]})]}),u.jsxs("div",{className:"mt-3 p-2 bg-white rounded",children:[u.jsx("p",{className:"text-xs font-semibold mb-1",children:"„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ (TOP20):"}),u.jsx("div",{className:"text-lg leading-relaxed break-all",children:T}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à"})]}),u.jsxs("div",{className:`mt-2 p-2 rounded ${D?"bg-green-100":"bg-yellow-100"}`,children:[u.jsx("p",{className:"font-semibold",children:D?"‚úÖ ‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ":"‚ö†Ô∏è ‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑ"}),u.jsxs("p",{className:"text-xs mt-1",children:["Âàá„ÇäÊõø„ÅàÂõûÊï∞: ",_,"Âõû",D?" (ÊúüÂæÖ: „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè)":""]})]}),I.„Åæ„Å†„Åæ„Å†===0&&I.Êñ∞Ë¶èÂºï‰∏ä===0&&u.jsx("div",{className:"text-gray-600 mt-2",children:"‚ÑπÔ∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„ÅóÔºàÊ≠£Â∏∏Âãï‰ΩúÔºâ"})]})]})}catch{return null}})(),u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsx("p",{className:"font-semibold",children:"üìç ÁèæÂú®‰ΩçÁΩÆ"}),u.jsxs("p",{className:"text-lg",children:[e+1," / ",t," ÂïèÁõÆ"]})]}),u.jsxs("div",{className:"bg-yellow-50 p-3 rounded",children:[u.jsxs("p",{className:"font-semibold text-yellow-800",children:["üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (",p.length,"Ë™û)"]}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"LocalStorage„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãËã¶ÊâãÂçòË™ûÔºàPosition ‚â• 40Ôºâ"}),p.length===0?u.jsx("p",{className:"text-gray-600 mt-2",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-1 max-h-60 overflow-y-auto",children:p.slice(0,20).map((C,k)=>u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:C.word}),u.jsx("span",{className:C.position>=70?"bg-red-100 text-red-800 px-2 py-0.5 rounded":"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:C.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-500",children:[u.jsxs("span",{children:["Position: ",C.position.toFixed(0)]}),u.jsxs("span",{children:["Ë©¶Ë°å: ",C.attempts,"Âõû"]}),u.jsxs("span",{children:["ÊúÄÁµÇ: ",new Date(C.lastStudied).toLocaleDateString()]})]})]},k))}),p.length>20&&u.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["‚Äª ÊúÄÂàù„ÅÆ20Ë™û„ÅÆ„ÅøË°®Á§∫ÔºàÂÖ®",p.length,"Ë™ûÔºâ"]})]}),u.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üìã Ê¨°„ÅÆ30ÂïèÔºàPositionÂàÜÊï£Ë®∫Êñ≠Áî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„Åæ„Å†„Åæ„Å†58Ë™û ‚Üí Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÅåPosition +15„Åï„Çå„Å¶„ÅÑ„Çã„ÅØ„Åö"}),u.jsx("ul",{className:"mt-2 space-y-1 max-h-80 overflow-y-auto",children:s.slice(e+1,e+31).map((C,k)=>{var V;const I=C==null?void 0:C.word,_=(V=et().wordProgress)==null?void 0:V[I],D=(_==null?void 0:_.memorizationPosition)??0,P=(_==null?void 0:_.totalAttempts)??0,A=(C==null?void 0:C.difficulty)??"‰∏çÊòé",F=D>=40,O=D>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":D>=40?"üü° „Åæ„Å†„Åæ„Å†":D>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return u.jsxs("li",{className:`text-xs p-2 rounded ${F?"bg-yellow-200 font-bold":"bg-white"}`,children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"text-gray-500",children:[e+k+2,"ÂïèÁõÆ"]})," ",u.jsx("span",{className:"font-mono font-bold",children:I})]}),u.jsx("div",{className:"text-xs",children:O})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-600",children:[u.jsxs("span",{children:["Position: ",D.toFixed(0)]}),u.jsxs("span",{children:["Âá∫È°å: ",P,"Âõû"]}),u.jsx("span",{children:A}),F&&u.jsx("span",{className:"text-yellow-800 font-bold",children:D>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]})]},k)})})]}),u.jsxs("div",{className:"bg-purple-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"ü§ñ AIË©ï‰æ°ÔºàÊúÄÊñ∞10‰ª∂Ôºâ"}),c.length===0?u.jsx("p",{className:"text-gray-600",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-2",children:c.slice(-10).map((C,k)=>{const I=C.word||"(ÂçòË™ûÂêç„Å™„Åó)",T=(()=>{switch(C.category){case"incorrect":return{className:"bg-red-100 text-red-800",label:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800",label:"„Åæ„Å†„Åæ„Å†"};case"mastered":return{className:"bg-green-100 text-green-800",label:"ÂÆöÁùÄÊ∏à"};case"new":return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"};default:return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"}}})();return u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"text-gray-500",children:["#",k+1]}),u.jsx("span",{className:"font-mono font-bold text-base text-blue-600",children:I})]}),u.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${T.className}`,children:T.label})]}),u.jsxs("div",{className:"flex flex-col gap-1 text-gray-600",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"font-semibold",children:["Position: ",(C.position??0).toFixed(0)]}),u.jsxs("span",{className:"ml-2 text-xs",children:["(ÈÄ£Á∂öÊ≠£Ëß£: ",C.consecutiveCorrect??0,", ÈÄ£Á∂ö‰∏çÊ≠£Ëß£:"," ",C.consecutiveIncorrect??0,")"]})]}),u.jsxs("div",{className:"text-xs",children:[u.jsxs("span",{children:["Ê≠£Ëß£Áéá: ",((C.accuracy??0)*100).toFixed(0),"%"]}),u.jsxs("span",{className:"ml-2",children:["Ë©¶Ë°å: ",C.attempts??0,"Âõû"]}),u.jsxs("span",{className:"ml-2",children:["ÁµåÈÅé: ",C.daysSince??0,"Êó•"]})]}),C.aiProposals&&u.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[u.jsx("div",{className:"text-xs font-semibold mb-1",children:"ü§ñ 7„Å§„ÅÆAIÊèêÊ°à:"}),u.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[u.jsxs("span",{children:["üß† Memory: ",(C.aiProposals.memory??0).toFixed(0)]}),u.jsxs("span",{children:["üí§ CogLoad: ",(C.aiProposals.cognitiveLoad??0).toFixed(0)]}),u.jsxs("span",{children:["üîÆ Error: ",(C.aiProposals.errorPrediction??0).toFixed(0)]}),u.jsxs("span",{children:["üìö Linguistic: ",(C.aiProposals.linguistic??0).toFixed(0)]}),u.jsxs("span",{children:["üåç Context: ",(C.aiProposals.contextual??0).toFixed(0)]}),u.jsxs("span",{children:["üéØ Style: ",(C.aiProposals.learningStyle??0).toFixed(0)]}),u.jsxs("span",{className:"col-span-2",children:["üéÆ Gamify: ",(C.aiProposals.gamification??0).toFixed(0)]})]})]})]})]},k)})})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_ai_evaluations"),l([])},className:"flex-1 bg-red-100 text-red-800 px-3 py-2 rounded hover:bg-red-200",children:"üóëÔ∏è AIË©ï‰æ°„ÇØ„É™„Ç¢"}),u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_memorization_latest")},className:"flex-1 bg-gray-100 text-gray-800 px-3 py-2 rounded hover:bg-gray-200",children:"üóëÔ∏è „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞„ÇØ„É™„Ç¢"})]}),u.jsxs("div",{className:"mt-6 border-t-2 border-blue-300 pt-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"font-bold text-lg",children:"üìä A/B„ÉÜ„Çπ„ÉàÈõÜË®à"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{const C=$y();S(C)},className:"bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200",children:"üîÑ Êõ¥Êñ∞"}),u.jsx("button",{onClick:()=>{const C=u9(),k=new Blob([C],{type:"application/json"}),I=URL.createObjectURL(k),T=document.createElement("a");T.href=I,T.download=`ab-session-logs-${Date.now()}.json`,T.click(),URL.revokeObjectURL(I)},className:"bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200",children:"üíæ JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà"}),u.jsx("button",{onClick:()=>{window.confirm("„Åô„Åπ„Å¶„ÅÆA/B„Çª„ÉÉ„Ç∑„Éß„É≥„É≠„Ç∞„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")&&(d9(),S(null))},className:"bg-red-100 text-red-800 px-3 py-1 rounded text-sm hover:bg-red-200",children:"üóëÔ∏è „ÇØ„É™„Ç¢"})]})]}),w&&w.totalSessions>0?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsxs("div",{className:"text-sm",children:[u.jsx("strong",{children:"Á∑è„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞:"})," ",w.totalSessions]}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["ÊúÄÁµÇÊõ¥Êñ∞: ",new Date(w.lastUpdated).toLocaleString("ja-JP")]})]}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm border-collapse",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-gray-200",children:[u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"Variant"}),u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"N"}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(‰∏≠Â§ÆÂÄ§)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóÁéá",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊåØÂãï„Çπ„Ç≥„Ç¢",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊâÄË¶ÅÊôÇÈñì",u.jsx("br",{}),"(Âπ≥Âùá)"]})]})}),u.jsx("tbody",{children:["A","B","C"].map(C=>{const k=w.byVariant[C];return k?u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:C}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.sessionCount}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.avgAcquiredWords.toFixed(2)}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.medianAcquiredWords.toFixed(0)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[(k.avgAcquisitionRate*100).toFixed(1),"%"]}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.avgVibrationScore.toFixed(1)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[Math.round(k.avgDurationSec),"Áßí"]})]},C):u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:C}),u.jsx("td",{colSpan:6,className:"border border-gray-300 px-2 py-1 text-center text-gray-500",children:"„Éá„Éº„Çø„Å™„Åó"})]},C)})})]})}),(()=>{try{const k=JSON.parse(localStorage.getItem("ab_session_logs")||"[]").filter(I=>I.mlEnabled===!0).length;if(k>0)return u.jsxs("div",{className:"bg-blue-50/20 p-3 rounded border border-blue-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"ü§ñ MLÁµ±Ë®à"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["ML ON„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞: ",k]}),u.jsx("div",{className:"text-gray-600",children:"‚Äª MLÊúâÂäπÂåñÂæå„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø„ÅØÂêÑvariant„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô"})]})]})}catch{}return null})(),w.byVariant.A&&u.jsxs("div",{className:"bg-yellow-50/20 p-3 rounded border border-yellow-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"üìà Âà§ÂÆöÂü∫Ê∫ñÔºàÊö´ÂÆöÔºâ"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["‚úÖ ",u.jsx("strong",{children:"ÂêàÊ†º:"})," B or C „Åå A „Å´ÂØæ„Åó„Å¶„ÄåÂèñÂæóË™ûÊï∞/„Çª„ÉÉ„Ç∑„Éß„É≥ +10%„Äç„Åã„Å§ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ„Å™„Åó"]}),u.jsxs("div",{children:["‚ùå ",u.jsx("strong",{children:"‰∏çÂêàÊ†º:"})," ÊîπÂñÑ„Å™„Åó or ÊåØÂãï„Çπ„Ç≥„Ç¢ > 50"]})]}),w.byVariant.B&&w.byVariant.A&&u.jsxs("div",{className:"mt-2 text-xs",children:[u.jsx("strong",{children:"B vs A:"})," ",w.byVariant.B.avgAcquiredWords>=w.byVariant.A.avgAcquiredWords*1.1&&w.byVariant.B.avgVibrationScore<=w.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]}),w.byVariant.C&&w.byVariant.A&&u.jsxs("div",{className:"mt-1 text-xs",children:[u.jsx("strong",{children:"C vs A:"})," ",w.byVariant.C.avgAcquiredWords>=w.byVariant.A.avgAcquiredWords*1.1&&w.byVariant.C.avgVibrationScore<=w.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]})]})]}):u.jsx("div",{className:"text-center text-gray-500 py-8",children:"„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})]})]}):null}const Ey=[0,5,10,20,30,50,100,150,200];function $0({learningLimit:n,reviewLimit:e,onLearningLimitChange:t,onReviewLimitChange:s,idPrefix:r=""}){return u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:`${r}learning-limit`,children:"üéØ Â≠¶Áøí‰∏≠„ÅÆ‰∏äÈôê:"}),u.jsx("select",{id:`${r}learning-limit`,value:n,onChange:o=>t(parseInt(o.target.value)),className:"select-input",children:Ey.map(o=>u.jsx("option",{value:o,children:o===0?"Ë®≠ÂÆöÁÑ°„Åó":o},o))})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:`${r}review-limit`,children:"‚ö†Ô∏è Ë¶ÅÂæ©Áøí„ÅÆ‰∏äÈôê:"}),u.jsx("select",{id:`${r}review-limit`,value:e,onChange:o=>s(parseInt(o.target.value)),className:"select-input",children:Ey.map(o=>u.jsx("option",{value:o,children:o===0?"Ë®≠ÂÆöÁÑ°„Åó":o},o))})]})]})}function T0(n){const[e,t]=$.useState(()=>{const a=localStorage.getItem(`learning-limit-${n}`);return a?parseInt(a):30}),[s,r]=$.useState(()=>{const a=localStorage.getItem(`review-limit-${n}`);return a?parseInt(a):10}),o=$.useCallback(a=>{const c=Math.max(0,a)||30;t(c),localStorage.setItem(`learning-limit-${n}`,c.toString())},[n]),i=$.useCallback(a=>{const c=Math.max(0,a)||10;r(c),localStorage.setItem(`review-limit-${n}`,c.toString())},[n]);return{learningLimit:e,reviewLimit:s,setLearningLimit:o,setReviewLimit:i}}var Gi=(n=>(n.ENCODING="encoding",n.INITIAL_CONSOLIDATION="initial",n.INTRADAY_REVIEW="intraday",n.SHORT_TERM="short_term",n.LONG_TERM="long_term",n))(Gi||{});const Ry={encodingTime:3e4,initialConsolidation:36e5,intradayWindow:864e5,shortTermWindow:6048e5,longTermThreshold:6048e5,correctRateThreshold:.8,responseTimeThreshold:1500},f9=1e3,m9=100,g9=100,x9=0,y9=6e4,b9=1e3;class w9{constructor(e,t){Ne(this,"thresholds");Ne(this,"cache");Ne(this,"CACHE_DURATION",5e3);const s={...Ry,...t};e?this.thresholds=this.adjustThresholds(s,e):this.thresholds=s,this.cache=new Map}adjustThresholds(e,t){return{encodingTime:e.encodingTime,initialConsolidation:e.initialConsolidation/t.learningSpeed,intradayWindow:e.intradayWindow,shortTermWindow:e.shortTermWindow/t.learningSpeed,longTermThreshold:e.longTermThreshold/t.learningSpeed,correctRateThreshold:e.correctRateThreshold,responseTimeThreshold:e.responseTimeThreshold*t.learningSpeed}}detectPhase(e,t){const s=Date.now(),r=this.cache.get(e);if(r&&s-r.timestamp<this.CACHE_DURATION)return r.phase;const o=this.detectPhaseWithReason(e,t);return this.cache.set(e,{phase:o.phase,timestamp:s}),o.phase}detectPhaseWithReason(e,t){const s=Date.now(),r=this.sanitizeTimestamp(t.lastReviewTime,s),o=this.sanitizeTimestamp(t.lastCorrectTime,s),i=this.sanitizeResponseTime(t.averageResponseTime),a=s-r,c=a/864e5,l=t.reviewCount>0?t.correctCount/t.reviewCount:0,d={reviewCount:t.reviewCount,correctCount:t.correctCount,correctRate:l,daysSinceLastReview:c,timeSinceLastReview:a,averageResponseTime:i};if(t.reviewCount===0)return{phase:"encoding",reason:"ÂàùË¶ãÂçòË™ûÔºàreviewCount=0Ôºâ",matchedCondition:1,metrics:d};if(a<this.thresholds.encodingTime)return{phase:"encoding",reason:`‰ΩúÊ•≠Ë®òÊÜ∂ÊÆµÈöéÔºà${Math.round(a/1e3)}ÁßíÂâçÔºâ`,matchedCondition:2,metrics:d};if(t.correctCount===0)return{phase:"encoding",reason:"‰∏ÄÂ∫¶„ÇÇÊ≠£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑ",matchedCondition:3,metrics:d};if(c>f9)return{phase:"encoding",reason:`Ë∂ÖÈï∑ÊúüÊîæÁΩÆÔºà${Math.round(c)}Êó•ÂâçÔºâ`,matchedCondition:101,metrics:d};if(t.consecutiveCorrect>=m9)return{phase:"long_term",reason:`ÂÆåÂÖ®ÁøíÂæóÔºà${t.consecutiveCorrect}ÂõûÈÄ£Á∂öÊ≠£Á≠îÔºâ`,matchedCondition:102,metrics:d};if(t.consecutiveWrong>=g9)return{phase:"encoding",reason:`Â≠¶ÁøíÊñπÊ≥ïË¶ÅË¶ãÁõ¥„ÅóÔºà${t.consecutiveWrong}ÂõûÈÄ£Á∂öË™§Á≠îÔºâ`,matchedCondition:103,metrics:d};const h=(s-o)/36e5;if(t.correctCount===1&&s-o<this.thresholds.initialConsolidation)return{phase:"initial",reason:`ÂàùÊúüÁµ±ÂêàÊÆµÈöéÔºàÂàùÂõûÊ≠£Á≠îÂæå${Math.round(h*60)}ÂàÜÔºâ`,matchedCondition:4,metrics:d};if(this.isSameDay(s,o)&&t.correctCount>=2)return{phase:"intraday",reason:`ÂêåÊó•Âæ©ÁøíÊÆµÈöéÔºà‰ªäÊó•${t.correctCount}ÂõûÊ≠£Á≠îÔºâ`,matchedCondition:5,metrics:d};if(c>=1&&c<=7){if(l>=.5&&l<this.thresholds.correctRateThreshold)return{phase:"short_term",reason:`Áü≠ÊúüË®òÊÜ∂ÊÆµÈöéÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d};if(l<.5)return{phase:"encoding",reason:`ÂøòÂç¥„Å´„Çà„Çä„É™„Çª„ÉÉ„ÉàÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d}}return c>7?l>=this.thresholds.correctRateThreshold&&i<this.thresholds.responseTimeThreshold?{phase:"long_term",reason:`Èï∑ÊúüË®òÊÜ∂Á¢∫Á´ãÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%„ÄÅÂøúÁ≠î${Math.round(i)}msÔºâ`,matchedCondition:7,metrics:d}:l>=.5&&l<this.thresholds.correctRateThreshold?{phase:"short_term",reason:`„Åæ„Å†‰∏çÂÆâÂÆöÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"encoding",reason:`ÂÆåÂÖ®ÂøòÂç¥ÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"short_term",reason:"„Éá„Éï„Ç©„É´„ÉàÂà§ÂÆö",matchedCondition:0,metrics:d}}canTransition(e,t,s){const r=this.detectPhase(e,t);if(r===s)return!0;const o=["encoding","initial","intraday","short_term","long_term"],i=o.indexOf(r),a=o.indexOf(s);return a>i?a-i===1:!0}isSameDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}sanitizeResponseTime(e){return e<=x9||e>y9||isNaN(e)?b9:e}sanitizeTimestamp(e,t){return e>t?(console.warn(`Êú™Êù•„ÅÆ„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„ÇíÊ§úÂá∫: ${e}`),t):e<0||isNaN(e)?t:e}clearCache(){this.cache.clear()}updateThresholds(e){this.thresholds=this.adjustThresholds(Ry,e),this.clearCache()}}var Qa=(n=>(n.IMMEDIATE="immediate",n.EARLY="early",n.MID="mid",n.END="end",n))(Qa||{}),ja=(n=>(n.MEMORIZATION="memorization",n.TRANSLATION="translation",n.SPELLING="spelling",n.GRAMMAR="grammar",n))(ja||{});const v9={memorization:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5},translation:{consolidationThreshold:4,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.6},spelling:{consolidationThreshold:6,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.4},grammar:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5}},Xl={immediate:50,early:100,mid:150,end:200},S9=72e5,Dy=3,C9=1/0,N9=2,I9=1,jy=.85,La=4;class k9{constructor(e){Ne(this,"queues");Ne(this,"currentQuestionNumber",0);Ne(this,"sessionStartTime",Date.now());Ne(this,"wordAttempts",new Map);Ne(this,"acquisitionProgress",new Map);Ne(this,"tabConfigs");if(this.queues={immediate:[],early:[],mid:[],end:[]},this.tabConfigs={...v9},e)for(const[t,s]of Object.entries(e))this.tabConfigs[t]={...this.tabConfigs[t],...s}}enqueueNewWord(e,t,s){const r=Date.now();this.currentQuestionNumber++;const o=this.tabConfigs[s];if(this.acquisitionProgress.has(e)||this.acquisitionProgress.set(e,{todayFirstSeen:r,todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:o.consolidationThreshold,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:r}),o.enableImmediateReview&&this.shouldEnqueueImmediate(t)){const i=this.calculateImmediateGap(t);this.enqueueToImmediate(e,t,s,i)}}enqueueToImmediate(e,t,s,r){const o=Date.now();if(this.isDuplicateInQueue(e,"immediate"))return;const i={word:e,queueType:"immediate",enqueuedAt:o,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+r,targetTime:o+6e4,priority:100,difficulty:t,category:s};this.enqueueWithLimit(this.queues.immediate,i,Xl.immediate);const a=this.acquisitionProgress.get(e);a.currentQueue="immediate",a.queuedAt=o}enqueueToEarly(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEarlyReview||this.isDuplicateInQueue(e,"early"))return;const i=this.calculateEarlyGap(t),a={word:e,queueType:"early",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+6e5,priority:80,difficulty:t,category:s};this.enqueueWithLimit(this.queues.early,a,Xl.early);const c=this.acquisitionProgress.get(e);c.currentQueue="early",c.queuedAt=r}enqueueToMid(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableMidReview||this.isDuplicateInQueue(e,"mid"))return;const i=this.calculateMidGap(t),a={word:e,queueType:"mid",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+36e5,priority:60,difficulty:t,category:s};this.enqueueWithLimit(this.queues.mid,a,Xl.mid);const c=this.acquisitionProgress.get(e);c.currentQueue="mid",c.queuedAt=r}enqueueToEnd(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEndReview||this.isDuplicateInQueue(e,"end"))return;const i={word:e,queueType:"end",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:1/0,targetTime:1/0,priority:40,difficulty:t,category:s};this.enqueueWithLimit(this.queues.end,i,Xl.end);const a=this.acquisitionProgress.get(e);a.currentQueue="end",a.queuedAt=r}getNextReviewQuestion(){this.cleanupExpiredEntries();const e=Date.now(),t=this.currentQuestionNumber,s=[];for(const r of this.queues.immediate)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.early)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.mid)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);if(s.sort((r,o)=>o.priority-r.priority),s.length>0){const r=s[0];return this.removeFromQueue(r),r}return null}handleCorrectAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayCorrectCount++,i.consecutiveCorrectStreak++,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!0,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.consecutiveCorrectStreak>=5&&i.dynamicThreshold>Dy&&(i.dynamicThreshold=Math.max(Dy,i.dynamicThreshold-I9),i.lastThresholdAdjustment=Date.now(),console.log(`üìâ ÂãïÁöÑÈñæÂÄ§„Çí‰∏ã„Åí„Åæ„Åó„Åü: ${e} ‚Üí ${i.dynamicThreshold}Âõû`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),t==="immediate"&&this.shouldEnqueueEarly(e,i)?this.enqueueToEarly(e,a,c):t==="early"&&this.shouldEnqueueMid(e,i)?this.enqueueToMid(e,a,c):t==="mid"&&this.shouldEnqueueEnd(e,i)?this.enqueueToEnd(e,a,c):i.todayCorrectCount===1&&t==="immediate"&&this.enqueueToImmediate(e,a,c,1),this.isAcquisitionComplete(e,i)&&(i.isAcquisitionComplete=!0,console.log(`‚úÖ Ë®òÊÜ∂Áç≤ÂæóÂÆå‰∫Ü: ${e}`))}handleWrongAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayWrongCount++,i.consecutiveCorrectStreak=0,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!1,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.dynamicThreshold,i.dynamicThreshold=Math.min(C9,i.dynamicThreshold+N9),i.lastThresholdAdjustment=Date.now(),i.isAcquisitionComplete&&(i.isAcquisitionComplete=!1,console.log(`üîÑ Ë™§Á≠î„Å´„Çà„ÇäÂÆöÁùÄÂÆå‰∫Ü„Çí„É™„Çª„ÉÉ„Éà: ${e}`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),this.removeFromAllQueues(e),t!=="immediate"&&console.log(`‚ùå Ë™§Á≠î„Å´„Çà„ÇäÂç≥ÊôÇÂæ©Áøí„Ç≠„É•„Éº„Å´Êàª„Åó„Åæ„Åô: ${e}`),this.enqueueToImmediate(e,Math.min(a+1,5),c,1)}startSessionEndReview(){const e=[...this.queues.end];return e.length===0?(console.log("ÁµÇ‰∫ÜÊôÇÂæ©Áøí„Å™„Åó"),[]):(console.log(`ÁµÇ‰∫ÜÊôÇÂæ©Áøí„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºà${e.length}Ë™ûÔºâ`),e)}generateAcquisitionReport(){const e=Array.from(this.acquisitionProgress.keys()),t=[],s=[];for(const r of e)this.acquisitionProgress.get(r).isAcquisitionComplete?t.push(r):s.push(r);return{totalWords:e.length,completed:t.length,incomplete:s.length,completionRate:e.length>0?t.length/e.length:0,incompleteWords:s}}getQueueStatistics(){var e,t,s,r;return{immediate:{size:this.queues.immediate.length,oldestEntry:(e=this.queues.immediate[0])==null?void 0:e.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.immediate)},early:{size:this.queues.early.length,oldestEntry:(t=this.queues.early[0])==null?void 0:t.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.early)},mid:{size:this.queues.mid.length,oldestEntry:(s=this.queues.mid[0])==null?void 0:s.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.mid)},end:{size:this.queues.end.length,oldestEntry:(r=this.queues.end[0])==null?void 0:r.enqueuedAt,averageWaitTime:0}}}getAcquisitionProgress(e){if(!this.acquisitionProgress.has(e)){const t=this.findWordInQueues(e),s=(t==null?void 0:t.category)||"memorization",r=this.tabConfigs[s].consolidationThreshold;this.acquisitionProgress.set(e,{todayFirstSeen:Date.now(),todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:r,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:Date.now()})}return this.acquisitionProgress.get(e)}incrementQuestionNumber(){this.currentQuestionNumber++}reset(){this.queues={immediate:[],early:[],mid:[],end:[]},this.currentQuestionNumber=0,this.sessionStartTime=Date.now(),this.wordAttempts.clear(),this.acquisitionProgress.clear()}getQueueInfo(e){const t=this.findWordInQueues(e);return t?{queueType:t.queueType,questionNumber:t.targetQuestionNumber}:null}getQueueSizes(){return{immediate:this.queues.immediate.length,early:this.queues.early.length,mid:this.queues.mid.length,end:this.queues.end.length}}exportQueues(){return{immediate:[...this.queues.immediate],early:[...this.queues.early],mid:[...this.queues.mid],end:[...this.queues.end]}}clearQueues(){this.queues.immediate=[],this.queues.early=[],this.queues.mid=[],this.queues.end=[]}recordAnswer(e,t,s){const o=this.getAcquisitionProgress(e).currentQueue||"immediate";t?this.handleCorrectAnswer(e,o,s):this.handleWrongAnswer(e,o,s)}shouldEnqueueImmediate(e){return e>=3}shouldEnqueueEarly(e,t){return t.todayCorrectCount>=1}shouldEnqueueMid(e,t){return t.todayCorrectCount>=2}shouldEnqueueEnd(e,t){return t.todayCorrectCount>=3}calculateImmediateGap(e){return e>=4?1:e===3?2:3}calculateEarlyGap(e){return e>=4?5:e===3?7:10}calculateMidGap(e){return e>=4?20:e===3?25:30}isAcquisitionComplete(e,t){if(t.todayCorrectCount<t.dynamicThreshold)return!1;if(t.correctRate<jy)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}% < ${(jy*100).toFixed(0)}%`),!1;if(t.consecutiveCorrectStreak<La)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): ÈÄ£Á∂öÊ≠£Á≠îÊï∞ ${t.consecutiveCorrectStreak} < ${La}`),!1;const s=new Set(t.todayReviews.filter(i=>i.isCorrect).map(i=>i.queueType));if(s.size<3)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): „Ç≠„É•„ÉºÈÄöÈÅéÊï∞ ${s.size} < 3ÔºàÈñìÈöîÂèçÂæ©„Åå‰∏çË∂≥Ôºâ`),!1;if(t.totalAttempts<6)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Á∑èÂá∫È°åÂõûÊï∞ ${t.totalAttempts} < 6`),!1;const r=t.todayReviews.slice(-La);return r.length>=La&&r.every(i=>i.isCorrect)?(console.log(`‚úÖ ÂÆöÁùÄÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}%, ÈÄ£Á∂öÊ≠£Á≠î ${t.consecutiveCorrectStreak}, ÈñæÂÄ§ ${t.dynamicThreshold}, Á∑èÂá∫È°å ${t.totalAttempts}Âõû`),!0):(console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Áõ¥Ëøë${La}Âõû„ÅåÂÖ®„Å¶Ê≠£Á≠î„Åß„ÅØ„Å™„ÅÑ`),!1)}isDuplicateInQueue(e,t){return this.queues[t].some(s=>s.word===e)}enqueueWithLimit(e,t,s){e.length>=s&&e.shift(),e.push(t)}removeFromQueue(e){const t=e.queueType,s=this.queues[t],r=s.findIndex(o=>o.word===e.word);r!==-1&&s.splice(r,1)}removeFromAllQueues(e){for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>s.word!==e)}findWordInQueues(e){for(const t of Object.keys(this.queues)){const s=this.queues[t].find(r=>r.word===e);if(s)return s}return null}cleanupExpiredEntries(){const e=Date.now();for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>e-s.enqueuedAt>S9?(console.warn(`ÊúüÈôêÂàá„Çå„Ç®„É≥„Éà„É™„ÇíÂâäÈô§: ${s.word}`),!1):!0)}trackWordAttempts(e){this.wordAttempts.has(e)||this.wordAttempts.set(e,0);const t=this.wordAttempts.get(e)+1;this.wordAttempts.set(e,t);const s=this.getAcquisitionProgress(e);return t%50===0&&s.todayCorrectCount<s.dynamicThreshold&&(console.log(`üîÑ ÂçòË™û "${e}" „Çí${t}ÂõûÂá∫È°å„Åó„Åæ„Åó„ÅüÔºàÊ≠£Á≠îÁéá: ${(s.correctRate*100).toFixed(1)}%, ÈñæÂÄ§: ${s.dynamicThreshold}ÂõûÔºâ`),console.log("   ‚úÖ ÂÆöÁùÄ„Åæ„ÅßÁ∂ôÁ∂öÂá∫È°å„Åó„Åæ„ÅôÔºà‰∏çÊ≠£Ëß£„ÅåÁ∂ö„ÅèÈôê„ÇäÊ∞∏ÈÅ†„Å´Âá∫È°åÔºâ")),!0}calculateAverageWaitTime(e){if(e.length===0)return 0;const t=Date.now();return e.reduce((r,o)=>r+(t-o.enqueuedAt),0)/e.length}}const $9={minEaseFactor:1.3,maxEaseFactor:2.5,easeFactorIncrement:.1,easeFactorDecrement:.2,initialInterval:1,forgettingCurveDecay:.5,confidenceWeight:.15};class T9{constructor(e){Ne(this,"retentionData",new Map);Ne(this,"config");this.config={...$9,...e}}getRetentionStatus(e){return this.retentionData.has(e)||this.retentionData.set(e,this.createInitialStatus()),this.retentionData.get(e)}recordReview(e,t){const s=this.getRetentionStatus(e);s.totalReviews++,s.lastReviewDate=t.timestamp,s.lastResponseTime=t.responseTime;const r=.3;return s.averageResponseTime=s.averageResponseTime*(1-r)+t.responseTime*r,t.isCorrect?(s.totalCorrect++,s.consecutiveCorrect++,s.consecutiveWrong=0,this.updateSM2OnCorrect(s,t.confidence)):(s.consecutiveCorrect=0,s.consecutiveWrong++,this.updateSM2OnWrong(s)),s.retentionRate=this.estimateRetentionRate(s),s.forgettingIndex=this.calculateForgettingIndex(s),s}getDueWords(e,t=Date.now()){const s=[];for(const r of e){const o=this.getRetentionStatus(r);if(t>=o.nextReviewDate){const a=(t-o.nextReviewDate)/864e5*o.forgettingIndex;s.push({word:r,priority:a})}}return s.sort((r,o)=>o.priority-r.priority),s.map(r=>r.word)}getReviewSchedule(e,t=7){const s=new Map,r=Date.now();for(const o of e){const i=this.getRetentionStatus(o),a=[];let c=i.nextReviewDate;const l=r+t*864e5;for(;c<=l;)a.push(new Date(c)),c+=i.sm2.interval*864e5;a.length>0&&s.set(o,a)}return s}getRetentionStatistics(e){const t=Date.now();let s=0,r=0,o=0,i=0,a=0,c=0;for(const d of e){const h=this.getRetentionStatus(d);s+=h.retentionRate,r+=h.sm2.easeFactor,o+=h.sm2.interval,t>=h.nextReviewDate&&(i++,(t-h.nextReviewDate)/864e5>1&&a++),h.consecutiveCorrect>=5&&h.sm2.interval>=30&&c++}const l=e.length||1;return{averageRetentionRate:s/l,averageEaseFactor:r/l,averageInterval:o/l,dueCount:i,overdueCount:a,wellLearnedCount:c}}estimateRetentionRate(e){const t=Date.now(),s=(t-e.lastReviewDate)/864e5,r=(e.nextReviewDate-t)/864e5;if(r>=0){const o=Math.exp(-this.config.forgettingCurveDecay*s/e.sm2.interval);return Math.max(.1,Math.min(1,o))}else{const o=-r,i=Math.exp(-this.config.forgettingCurveDecay*(s+o)/e.sm2.interval);return Math.max(.05,Math.min(.9,i))}}reset(){this.retentionData.clear()}importRetentionData(e){this.retentionData=new Map(e)}exportRetentionData(){return new Map(this.retentionData)}createInitialStatus(){return{lastReviewDate:Date.now(),nextReviewDate:Date.now()+this.config.initialInterval*864e5,sm2:{interval:this.config.initialInterval,repetition:0,easeFactor:2.5},retentionRate:1,forgettingIndex:1,totalReviews:0,totalCorrect:0,consecutiveCorrect:0,consecutiveWrong:0,averageResponseTime:0,lastResponseTime:0}}updateSM2OnCorrect(e,t){const s=e.sm2;s.repetition++;const r=this.mapConfidenceToQuality(t),o=s.easeFactor+(.1-(5-r)*(.08+(5-r)*.02));s.easeFactor=Math.max(this.config.minEaseFactor,Math.min(this.config.maxEaseFactor,o)),s.repetition===1?s.interval=1:s.repetition===2?s.interval=6:s.interval=Math.round(s.interval*s.easeFactor),e.lastResponseTime>3e3&&e.lastResponseTime>e.averageResponseTime*1.5&&(s.interval=Math.max(1,Math.round(s.interval*.8))),e.nextReviewDate=e.lastReviewDate+s.interval*864e5}updateSM2OnWrong(e){const t=e.sm2;t.repetition=0,t.easeFactor=Math.max(this.config.minEaseFactor,t.easeFactor-this.config.easeFactorDecrement),t.interval=1,e.nextReviewDate=e.lastReviewDate+t.interval*864e5}mapConfidenceToQuality(e){return Math.max(0,Math.min(5,e))}calculateForgettingIndex(e){const r=(e.totalReviews>0?1-e.totalCorrect/e.totalReviews:0)*2,o=e.averageResponseTime>2e3?(e.averageResponseTime-2e3)/5e3:0,i=Math.min(e.consecutiveWrong*.3,1.5),a=1+r+o+i;return Math.max(.5,Math.min(5,a))}}const A9={minSampleSize:20,confidenceThreshold:.7,learningSpeedWindow:7,forgettingSpeedWindow:30},_y={learningSpeed:1,forgettingSpeed:1,consolidationThreshold:3,responseTimeProfile:{averageResponseTime:2e3,fastThreshold:1e3,slowThreshold:3e3,consistencyScore:.5},confidenceLevel:0,sampleSize:0,lastUpdated:Date.now()};class E9{constructor(e){Ne(this,"config");Ne(this,"parameters");Ne(this,"historyCache",[]);this.config={...A9,...e},this.parameters={..._y}}addHistory(e){this.historyCache.push(e),this.historyCache.length>100&&this.historyCache.shift()}estimateParameters(e){const t=e||this.historyCache;return t.length<this.config.minSampleSize?(this.parameters.sampleSize=t.length,this.parameters.confidenceLevel=0,{...this.parameters}):(this.parameters.learningSpeed=this.estimateLearningSpeed(t),this.parameters.forgettingSpeed=this.estimateForgettingSpeed(t),this.parameters.consolidationThreshold=this.estimateConsolidationThreshold(t),this.parameters.responseTimeProfile=this.estimateResponseTimeProfile(t),this.parameters.confidenceLevel=this.calculateConfidenceLevel(t.length),this.parameters.sampleSize=t.length,this.parameters.lastUpdated=Date.now(),{...this.parameters})}getParameters(){return{...this.parameters}}importParameters(e){this.parameters={...e}}clearHistory(){this.historyCache=[]}estimateLearningSpeed(e){const t=new Map,s=new Map;for(const i of e){const a=i.word;t.has(a)||t.set(a,0),t.set(a,t.get(a)+1),i.isCorrect&&!s.has(a)&&s.set(a,t.get(a))}const r=Array.from(s.values());if(r.length===0)return 1;const o=r.reduce((i,a)=>i+a,0)/r.length;return o<=2?1.8:o<=2.5?1.5:o<=3.5?1:o<=5?.7:.5}estimateForgettingSpeed(e){const t=new Map,s=[];for(const o of e){const i=o.word;if(o.isCorrect)t.set(i,o.timestamp);else if(t.has(i)){const a=t.get(i),c=(o.timestamp-a)/864e5;s.push(c),t.delete(i)}}if(s.length===0)return 1;const r=s.reduce((o,i)=>o+i,0)/s.length;return r>=7?.6:r>=5?.8:r>=3?1:r>=1?1.5:2}estimateConsolidationThreshold(e){const t=new Map,s=new Map,r=[];for(const i of e){const a=i.word;if(t.has(a)||(t.set(a,0),s.set(a,0)),i.isCorrect){const c=t.get(a)+1;t.set(a,c);const l=Math.max(s.get(a),c);s.set(a,l),c===5&&r.push(this.getWordTotalReviews(a,e))}else t.set(a,0)}if(r.length===0)return 3;const o=r.reduce((i,a)=>i+a,0)/r.length;return Math.max(2,Math.min(5,Math.round(o*.6)))}estimateResponseTimeProfile(e){const t=e.map(d=>d.responseTime);if(t.length===0)return _y.responseTimeProfile;const s=t.reduce((d,h)=>d+h,0)/t.length,r=t.reduce((d,h)=>d+Math.pow(h-s,2),0)/t.length,o=Math.sqrt(r),i=Math.max(500,s-o),a=Math.min(5e3,s+o),c=o/s,l=Math.max(0,Math.min(1,1-c));return{averageResponseTime:Math.round(s),fastThreshold:Math.round(i),slowThreshold:Math.round(a),consistencyScore:Math.round(l*100)/100}}calculateConfidenceLevel(e){return e<this.config.minSampleSize?0:e<50?(e-this.config.minSampleSize)/(50-this.config.minSampleSize)*.7:e<100?.7+(e-50)/50*.2:.9+Math.min((e-100)/200*.1,.1)}getWordTotalReviews(e,t){return t.filter(s=>s.word===e).length}}const $I={acquisitionRatio:.6,retentionRatio:.4,adaptiveAdjustment:!0,sessionQuestionNumber:0};class R9{constructor(e=$I){Ne(this,"strategy");Ne(this,"personalParams",null);this.strategy={...e}}setPersonalParameters(e){this.personalParams=e}updateStrategy(e){this.strategy={...this.strategy,...e}}selectNextQuestion(e){if(e.length===0)return null;const t=e.map(r=>this.calculatePriority(r));t.sort((r,o)=>o.priority-r.priority);const s=t.find(r=>r.candidate.queueType!==void 0);return s?s.candidate:this.selectByStrategy(t)}calculatePriority(e){const t={queuePriority:this.calculateQueuePriority(e),phasePriority:this.calculatePhasePriority(e),timingPriority:this.calculateTimingPriority(e),personalPriority:this.calculatePersonalPriority(e)},s=Object.values(t).reduce((o,i)=>o+i,0),r=this.generatePriorityReason(e,t);return{candidate:e,priority:s,breakdown:t,reason:r}}calculateQueuePriority(e){if(!e.queueType)return 0;let s={[Qa.IMMEDIATE]:40,[Qa.EARLY]:30,[Qa.MID]:20,[Qa.END]:10}[e.queueType]||0;if(e.questionNumber!==void 0){const r=Math.max(0,5-e.questionNumber*.5);s+=r}return Math.min(40,s)}calculatePhasePriority(e){return{[Gi.ENCODING]:25,[Gi.INITIAL_CONSOLIDATION]:30,[Gi.INTRADAY_REVIEW]:20,[Gi.SHORT_TERM]:15,[Gi.LONG_TERM]:10}[e.phase]||0}calculateTimingPriority(e){const t=Date.now();if(e.reviewCount===0&&e.firstSeenTime){const o=(t-e.firstSeenTime)/1e3;return o>=600?15:o>=300?10:o>=120?7:o>=60?5:0}if(!e.nextReviewTime)return 15;const s=t-e.nextReviewTime;if(s>=0){const o=s/36e5;return Math.min(20,10+o*2)}const r=Math.abs(s)/(1e3*60*60);return r<=1?10-r*5:0}calculatePersonalPriority(e){if(!this.personalParams)return 5;let t=5;return e.reviewCount===0&&this.personalParams.learningSpeed<.8&&(t-=2),e.reviewCount===0&&this.personalParams.learningSpeed>1.2&&(t+=2),e.reviewCount>0&&this.personalParams.forgettingSpeed>1.2&&(t+=3),e.reviewCount>0&&this.personalParams.forgettingSpeed<.8&&(t-=2),Math.max(0,Math.min(10,t))}selectByStrategy(e){if(e.length===0)return null;const t=this.calculateAdaptiveBias(),s=e.map(c=>({...c,adjustedPriority:c.candidate.reviewCount===0?c.priority+t:c.priority})),r=s.filter(c=>c.adjustedPriority>=60),o=s.filter(c=>c.adjustedPriority>=30&&c.adjustedPriority<60),i=s.filter(c=>c.adjustedPriority<30),a=r.length>0?r:o.length>0?o:i;return a.length===0?null:(a.sort((c,l)=>{const d=l.adjustedPriority-c.adjustedPriority;if(Math.abs(d)>=5)return d;const h=c.candidate.lastReviewTime||c.candidate.firstSeenTime||0,p=l.candidate.lastReviewTime||l.candidate.firstSeenTime||0;return h===0&&p===0?c.candidate.word.localeCompare(l.candidate.word):h-p}),a[0].candidate)}hashString(e){let t=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}calculateAdaptiveBias(){if(!this.strategy.adaptiveAdjustment||this.strategy.sessionQuestionNumber===void 0)return 0;const e=this.strategy.sessionQuestionNumber;return e<=10?15:e<=20?10:e<=30?5:0}generatePriorityReason(e,t){const s=[];if(e.queueType&&s.push(`„Ç≠„É•„Éº: ${e.queueType}`),s.push(`„Éï„Çß„Éº„Ç∫: ${e.phase}`),e.nextReviewTime){const o=Date.now()-e.nextReviewTime,i=Math.abs(o/(1e3*60*60));o>=0?s.push(`ÈÅÖÂª∂: ${i.toFixed(1)}ÊôÇÈñì`):s.push(`‰∫àÂÆö„Åæ„Åß: ${i.toFixed(1)}ÊôÇÈñì`)}return e.reviewCount===0?s.push("Êñ∞Ë¶èÂçòË™û"):s.push(`Âæ©Áøí${e.reviewCount}ÂõûÁõÆ`),s.join(", ")}getAllPriorities(e){return e.map(t=>this.calculatePriority(t)).sort((t,s)=>s.priority-t.priority)}}function Py(n,e){return e?{word:n,reviewCount:e.correctCount+e.incorrectCount,correctCount:e.correctCount,wrongCount:e.incorrectCount,lastReviewTime:e.lastStudied||0,lastCorrectTime:e.consecutiveCorrect>0?e.lastStudied:0,averageResponseTime:e.averageResponseTime||0,consecutiveCorrect:e.consecutiveCorrect,consecutiveWrong:e.consecutiveIncorrect}:{word:n,reviewCount:0,correctCount:0,wrongCount:0,lastReviewTime:0,lastCorrectTime:0,averageResponseTime:0,consecutiveCorrect:0,consecutiveWrong:0}}function Dh(n=ja.MEMORIZATION,e){const t=$.useRef(null),s=$.useRef(null),r=$.useRef(null),o=$.useRef(null),i=$.useRef(null),[a,c]=$.useState(0),[l,d]=$.useState({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}});$.useEffect(()=>{R.info("[useAdaptiveLearning] Initializing adaptive learning algorithms",{category:n,sessionId:e}),t.current=new w9,s.current=new k9,r.current=new T9,o.current=new E9,i.current=new R9({...$I,sessionQuestionNumber:0});try{localStorage.getItem(`adaptive-learning-queues-${n}`)&&s.current&&R.debug("[useAdaptiveLearning] Restored queues from localStorage")}catch(g){R.error("[useAdaptiveLearning] Failed to restore queues:",g)}try{if(o.current){const g=o.current.estimateParameters();d(x=>({...x,personalParams:g})),i.current&&i.current.setPersonalParameters(g),R.info("[useAdaptiveLearning] Personal parameters estimated:",g)}}catch(g){R.error("[useAdaptiveLearning] Failed to estimate personal parameters:",g)}return()=>{try{if(s.current){const g=s.current.exportQueues();localStorage.setItem(`adaptive-learning-queues-${n}`,JSON.stringify(g)),R.debug("[useAdaptiveLearning] Saved queues to localStorage")}}catch(g){R.error("[useAdaptiveLearning] Failed to save queues:",g)}}},[n,e]);const h=$.useCallback(g=>{if(!i.current||!t.current||!s.current)return R.warn("[useAdaptiveLearning] Algorithms not initialized"),g.length>0?g[0]:null;try{const x=g.map(b=>{const v=Wu(b.word),w=Py(b.word,v),S=t.current.detectPhase(b.word,w),N=s.current.getQueueInfo(b.word);return{id:b.word,word:b.word,category:n,phase:S,reviewCount:w.reviewCount,correctCount:w.correctCount,lastReviewTime:w.lastReviewTime||Date.now(),queueType:N==null?void 0:N.queueType,questionNumber:N==null?void 0:N.questionNumber,difficulty:parseInt(b.difficulty)||3}});i.current.updateStrategy({sessionQuestionNumber:a});const y=i.current.selectNextQuestion(x);if(y){const b=g.find(v=>v.word===y.word);return c(v=>v+1),d(v=>({...v,currentPhase:y.phase,sessionProgress:{totalQuestions:v.sessionProgress.totalQuestions+1,newWords:v.sessionProgress.newWords+(y.reviewCount===0?1:0),reviews:v.sessionProgress.reviews+(y.reviewCount>0?1:0)}})),R.debug("[useAdaptiveLearning] Selected question:",{word:y.word,phase:y.phase,queueType:y.queueType}),b||null}return null}catch(x){return R.error("[useAdaptiveLearning] Error selecting question:",x),g.length>0?g[0]:null}},[n,a]),p=$.useCallback((g,x,y)=>{try{if(t.current){const b=Wu(g),v=Py(g,b),w=t.current.detectPhase(g,v);d(S=>({...S,currentPhase:w}))}if(s.current){s.current.recordAnswer(g,x,y);const b=s.current.getQueueSizes();d(v=>({...v,queueSizes:b}))}if(r.current&&r.current.recordReview(g,{isCorrect:x,confidence:x?3:0,responseTime:y,timestamp:Date.now()}),o.current&&(o.current.addHistory({word:g,timestamp:Date.now(),isCorrect:x,responseTime:y,reviewNumber:1,daysSinceFirstSeen:0}),a>0&&a%20===0)){const b=o.current.estimateParameters();d(v=>({...v,personalParams:b})),i.current&&i.current.setPersonalParameters(b),R.info("[useAdaptiveLearning] Personal parameters updated:",b)}R.debug("[useAdaptiveLearning] Recorded answer:",{word:g,isCorrect:x,responseTime:y})}catch(b){R.error("[useAdaptiveLearning] Error recording answer:",b)}},[a]),f=$.useCallback(()=>{R.info("[useAdaptiveLearning] Resetting adaptive learning algorithms"),c(0),d({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}}),s.current&&s.current.clearQueues(),o.current&&o.current.clearHistory()},[]),m=$.useCallback(()=>{var g;return{sessionQuestionCount:a,state:l,queues:((g=s.current)==null?void 0:g.exportQueues())||null,personalParams:l.personalParams}},[a,l]);return{selectNextQuestion:h,recordAnswer:p,state:l,reset:f,getDebugInfo:m}}function D9({quizState:n,_categoryList:e,selectedCategory:t,onCategoryChange:s,selectedDifficulty:r,onDifficultyChange:o,selectedWordPhraseFilter:i="all",onWordPhraseFilterChange:a,selectedPhraseTypeFilter:c="all",onPhraseTypeFilterChange:l,selectedDataSource:d="all",onDataSourceChange:h,questionSets:p=[],onStartQuiz:f,onAnswer:m,onNext:g,onPrevious:x,onSkip:y,onDifficultyRate:b,onReviewFocus:v,sessionStats:w,isReviewFocusMode:S=!1,errorPrediction:N,customQuestionSets:C=[],onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:T}){var Q,ce;const{questions:_,currentIndex:D,answered:P,selectedAnswer:A}=n,F=_.length>0,O=F?_[D]:null,[V,L]=$.useState(!1),[H,J]=$.useState(!1),[X,fe]=$.useState(!1),[be,oe]=$.useState(Date.now()),[xe,$e]=$.useState(void 0),[Le,Re]=$.useState(void 0),[ze,Ye]=$.useState(0),[Te,ut]=$.useState(0),ft=Dh(ja.TRANSLATION),{learningLimit:wt,reviewLimit:vt,setLearningLimit:Nt,setReviewLimit:mt}=T0("translation"),[dt,re]=$.useState(()=>localStorage.getItem("autoNext")==="true"),[de,q]=$.useState(()=>{const le=localStorage.getItem("autoNextDelay");return le?parseInt(le,10):1500}),[Z,Ce]=$.useState(()=>localStorage.getItem("autoShowDetails")!=="false"),_e=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:le}=await gs(async()=>{const{resetAllProgress:Pe}=await Promise.resolve().then(()=>Zo);return{resetAllProgress:Pe}},void 0);await le(),R.info("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(le){R.error("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",le),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},{getRequeuedWords:De}=_l(),Ie=()=>{fe(!0)},Dt=async(le,Pe)=>{const ve=le===Pe;$e(ve),Re(O==null?void 0:O.word),ve?(Ye(Je=>Je+1),ut(0)):(ut(Je=>Je+1),Ye(0)),await m(le,Pe),oe(Date.now()),O!=null&&O.word&&ft.recordAnswer(O.word,ve,3e3),dt&&ve&&setTimeout(()=>{Re(void 0),g()},de)},j=()=>{Re(void 0),g()},z=async()=>{y&&(await y(),oe(Date.now()))},U=localStorage.getItem("learning-schedule-90days"),M=!!U;let ie=null;if(M)try{const le=JSON.parse(U),Pe=Math.floor((Date.now()-le.startDate)/(1e3*60*60*24)),ve=Math.min(Pe+1,le.totalDays),Je=Math.round(ve/le.totalDays*100);ie={currentDay:ve,totalDays:le.totalDays,progressPercent:Je,phase:le.phase}}catch(le){R.error("Failed to parse learning plan:",le)}const te=()=>{J(!H)};return H&&F&&O?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:te,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4",children:u.jsx(Iy,{question:O,questionNumber:D+1,allQuestions:_,currentIndex:D,answered:P,selectedAnswer:A,onAnswer:Dt,onNext:y?P?j:z:j,onPrevious:x,onDifficultyRate:b,errorPrediction:N,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:T,onFullscreen:te})})]})}):u.jsxs("div",{className:"quiz-view",children:[M&&ie&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[ie.currentDay,"Êó•ÁõÆ / ",ie.totalDays,"Êó• (Phase ",ie.phase,") -"," ",ie.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),F&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Ah,{mode:"translation",currentScore:n.score,totalAnswered:n.totalAnswered,sessionCorrect:w==null?void 0:w.correct,sessionIncorrect:w==null?void 0:w.incorrect,sessionReview:w==null?void 0:w.review,sessionMastered:w==null?void 0:w.mastered,sessionStats:w,onReviewFocus:v,isReviewFocusMode:S,onShowSettings:()=>L(!0),currentWord:O==null?void 0:O.word,onAnswerTime:be,lastAnswerCorrect:xe,lastAnswerWord:Le,lastAnswerDifficulty:O==null?void 0:O.difficulty,correctStreak:ze,incorrectStreak:Te,learningPhase:ft.state.currentPhase??void 0,estimatedSpeed:(Q=ft.state.personalParams)==null?void 0:Q.learningSpeed,dataSource:((ce=p==null?void 0:p.find(le=>le.id===d))==null?void 0:ce.name)||"ÂÖ®ÂïèÈ°åÈõÜ",onResetProgress:_e,onDebugRequeue:Ie,category:t==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":t,difficulty:r,wordPhraseFilter:i})})}),V&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>L(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-quiz",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-quiz",value:t,onChange:le=>s(le.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),MI.map(le=>u.jsx("option",{value:le,children:le},le))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-quiz",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-quiz",value:r,onChange:le=>o(le.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),h&&p&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-quiz",children:"üìö Âá∫È°åÂÖÉ:"}),u.jsx("select",{id:"data-source-select-quiz",value:d,onChange:le=>h(le.target.value),className:"select-input",children:p.map(le=>u.jsx("option",{value:le.id,children:le.name},le.id))})]}),a&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-quiz",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-quiz",value:i,onChange:le=>a(le.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),l&&i==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-quiz",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-quiz",value:c,onChange:le=>l(le.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsx($0,{learningLimit:wt,reviewLimit:vt,onLearningLimitChange:Nt,onReviewLimitChange:mt,idPrefix:"quiz-"}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle",checked:dt,onChange:le=>{re(le.target.checked),localStorage.setItem("autoNext",le.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",dt?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),dt&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay",min:"500",max:"3000",step:"100",value:de,onChange:le=>{const Pe=parseInt(le.target.value,10);q(Pe),localStorage.setItem("autoNextDelay",Pe.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(de/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-toggle",checked:Z,onChange:le=>{Ce(le.target.checked),localStorage.setItem("autoShowDetails",le.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-show-details-toggle",className:"checkbox-label",children:["‰∏çÊ≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",Z?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:te,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),O&&u.jsx(u.Fragment,{children:u.jsx(Iy,{question:O,questionNumber:D+1,allQuestions:_,currentIndex:D,answered:P,selectedAnswer:A,onAnswer:Dt,onNext:y?P?j:z:j,onPrevious:x,onDifficultyRate:b,errorPrediction:N,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:T})})]})})})]}),X&&u.jsx(Rh,{mode:"translation",currentIndex:D,totalQuestions:_.length,questions:_,requeuedWords:De(_,D)})]})}function j9(n){const[e,t]=$.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""}),[s,r]=$.useState([]),[o,i]=$.useState([]),[a,c]=$.useState([]),[l,d]=$.useState(0),[h,p]=$.useState([]),f=$.useRef(0);return $.useEffect(()=>{n.length>0&&t({questions:n,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""})},[n]),$.useEffect(()=>{if(e.questions.length>0){const w=e.questions[e.currentIndex].word.toLowerCase();if(w.includes(" ")){const S=w.split(/\s+/);c(S),d(0),p([]);const C=[...S[0].split("")].sort(()=>Math.random()-.5);r(C),t(k=>({...k,correctWord:w.replace(/\s+/g,""),answered:!1}))}else{c([]),d(0),p([]);const N=[...w.split("")].sort(()=>Math.random()-.5);r(N),t(C=>({...C,correctWord:w,answered:!1}))}i([]),f.current=Date.now()}},[e.currentIndex,e.questions]),{spellingState:e,setSpellingState:t,shuffledLetters:s,selectedSequence:o,setSelectedSequence:i,phraseWords:a,currentWordIndex:l,completedWords:h,handleLetterClick:v=>{if(e.answered){if(o.includes(`${v}`))i(o.filter(S=>S!==`${v}`));else{const S=[...o,`${v}`];i(S)}return}if(o.includes(`${v}`))return;const w=[...o,`${v}`];return i(w),w.length===s.length?w:null},checkAnswer:v=>{const w=v.map(N=>s[parseInt(N)]).join(""),S=Date.now()-f.current;if(a.length>0){const N=a[l];if(w===N){const k=[...h,w];if(p(k),l<a.length-1){const I=l+1;d(I);const _=[...a[I].split("")].sort(()=>Math.random()-.5);return r(_),i([]),{isPartialCorrect:!0,isComplete:!1,userWord:w,responseTime:S}}else{const I=k.join("");return{isPartialCorrect:!0,isComplete:!0,isCorrect:I===e.correctWord,userWord:I,responseTime:S}}}else return{isPartialCorrect:!1,isComplete:!0,isCorrect:!1,userWord:[...h,w].join(""),responseTime:S}}else return{isComplete:!0,isCorrect:w===e.correctWord,userWord:w,responseTime:S}},moveToNextQuestion:()=>{t(v=>({...v,currentIndex:v.currentIndex+1,answered:!1}))},updateScore:v=>{t(w=>({...w,score:v?w.score+1:w.score,totalAnswered:w.totalAnswered+1,answered:!0}))},resetAnswer:()=>{if(i([]),t(v=>({...v,answered:!1})),a.length>0){const w=[...a[l].split("")].sort(()=>Math.random()-.5);r(w)}else{const S=[...e.questions[e.currentIndex].word.toLowerCase().split("")].sort(()=>Math.random()-.5);r(S)}f.current=Date.now()}}}function _9(){const[n,e]=$.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0});return{sessionStats:n,setSessionStats:e,resetStats:()=>{e({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0})},updateStats:r=>{e(o=>({...o,correct:o.correct+(r==="correct"?1:0),incorrect:o.incorrect+(r==="incorrect"?1:0),review:o.review+(r==="review"?1:0),mastered:o.mastered+(r==="mastered"?1:0)}))}}}function P9({questions:n,_categoryList:e,selectedCategory:t,onCategoryChange:s,selectedDifficulty:r,onDifficultyChange:o,selectedWordPhraseFilter:i="all",onWordPhraseFilterChange:a,selectedPhraseTypeFilter:c="all",onPhraseTypeFilterChange:l,selectedDataSource:d="all",onDataSourceChange:h,onStartQuiz:p,onReviewFocus:f,isReviewFocusMode:m=!1,customQuestionSets:g=[],onAddWordToCustomSet:x,onRemoveWordFromCustomSet:y,onOpenCustomSetManagement:b}){var Zt,_t,Ke;const{learningLimit:v,reviewLimit:w,setLearningLimit:S,setReviewLimit:N}=T0("spelling"),[C,k]=$.useState([]),{spellingState:I,setSpellingState:T,shuffledLetters:_,selectedSequence:D,setSelectedSequence:P,phraseWords:A,completedWords:F,handleLetterClick:O,checkAnswer:V,moveToNextQuestion:L,updateScore:H}=j9(C),{sessionStats:J,setSessionStats:X,resetStats:fe,updateStats:be}=_9(),oe=Dh(ja.SPELLING),{processQuestion:xe}=Eh(),$e=async(B,pe)=>{try{const Ae=()=>{const tt=new Date().getHours();return tt<12?"morning":tt<18?"afternoon":tt<22?"evening":"night"},je=()=>{const tt=I.questions[I.currentIndex];if(!tt)return .5;const Ft=(tt.grade||1)/9;return Math.min(Math.max(Ft,0),1)},Me=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(Ft=>!Ft.correct).length,Ue=()=>{const tt=sessionStorage.getItem("sessionStartTime");return tt?Math.floor((Date.now()-parseInt(tt))/6e4):0},Et=()=>z,Ct=await xe(B,pe?"correct":"incorrect",{currentDifficulty:je(),timeOfDay:Ae(),recentErrors:Me(),sessionLength:Ue(),consecutiveCorrect:Et()});console.log("[AdaptiveAI]",Ct.reason,{strategy:Ct.strategy,confidence:Ct.confidence})}catch(Ae){console.error("[SpellingView] Adaptive AI error:",Ae)}},[Le]=$.useState(()=>{const B=new jl;return localStorage.getItem("enable-ai-coordination")==="true"&&(B.enableAICoordination(!0),R.info("ü§ñ [SpellingView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),B}),{reAddQuestion:Re,clearExpiredFlags:ze,updateRequeueStats:Ye,getRequeuedWords:Te,checkPositionMismatch:ut}=_l(),[ft,wt]=$.useState(!1),[vt,Nt]=$.useState(!1),[mt,dt]=$.useState(!1),[re,de]=$.useState(Date.now()),[q,Z]=$.useState(0),[Ce,_e]=$.useState(!1),[De,Ie]=$.useState(void 0),[Dt,j]=$.useState(void 0),[z,U]=$.useState(0),[M,ie]=$.useState(0),[te,Q]=$.useState(()=>localStorage.getItem("autoNext")==="true"),[ce,le]=$.useState(()=>{const B=localStorage.getItem("autoNextDelay");return B?parseInt(B,10):1500}),Pe=$.useRef(null),ve=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:B}=await gs(async()=>{const{resetAllProgress:pe}=await Promise.resolve().then(()=>Zo);return{resetAllProgress:pe}},void 0);await B(),fe(),U(0),ie(0),console.log("‚úÖ [„Çπ„Éö„É´„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(B){console.error("‚ùå [„Çπ„Éö„É´„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",B),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Je=()=>{dt(!0)},ee=$.useRef(0),ge=$.useRef(0),Se=$.useRef([]);$.useEffect(()=>{(async()=>{if(n.length===0){k([]);return}ee.current=Date.now(),Se.current=[],fe();const pe=await Le.schedule({questions:n,mode:"spelling",limits:{learningLimit:v,reviewLimit:w},sessionStats:{correct:J.correct,incorrect:J.incorrect,still_learning:0,mastered:J.mastered||0,duration:Date.now()-ee.current},useMetaAI:!0,isReviewFocusMode:m||!1}),Ae=pe.scheduledQuestions;pe.vibrationScore>50&&R.warn("[SpellingView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:pe.vibrationScore,processingTime:pe.processingTime}),k(Ae),Z(0),_e(!1),R.log("[SpellingView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:Ae.length,vibrationScore:pe.vibrationScore})})()},[n,v,w,m,Le]),$.useEffect(()=>{if(!Ce||I.questions.length===0)return;const B=I.currentIndex;(async()=>{try{const Ae=I.questions.slice(B);if(Ae.length===0){_e(!1);return}R.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:q,currentIndex:B,remaining:Ae.length});const je=await Le.schedule({questions:Ae,mode:"spelling",limits:{learningLimit:v,reviewLimit:w},sessionStats:{correct:J.correct,incorrect:J.incorrect,still_learning:0,mastered:J.mastered||0,duration:Date.now()-ee.current},useMetaAI:!0,isReviewFocusMode:m||!1});T(Me=>Me.currentIndex!==B?Me:{...Me,questions:[...Me.questions.slice(0,B),...je.scheduledQuestions]}),Z(0),_e(!1),R.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:je.scheduledQuestions.length})}catch(Ae){R.error("[SpellingView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",Ae),_e(!1)}})()},[Ce,I.currentIndex,I.questions,Le,v,w,J,m,q]),$.useEffect(()=>{if(!I.answered&&Pe.current){const B=setTimeout(()=>{var pe;(pe=Pe.current)==null||pe.focus()},100);return()=>clearTimeout(B)}},[I.answered,I.currentIndex,I.questions.length]);const ue=(B,pe)=>{const Ae=O(pe);Ae&&Ae.length===_.length&&setTimeout(()=>Ve(Ae),300)},Ve=async B=>{const pe=V(B);pe&&(pe.isPartialCorrect&&!pe.isComplete||pe.isComplete&&await yt(pe.userWord,pe.isCorrect||!1,pe.responseTime))},yt=async(B,pe,Ae)=>{var Et;const je=I.questions[I.currentIndex];Ie(pe),j(je.word),pe?(U(Ct=>Ct+1),ie(0)):(ie(Ct=>Ct+1),U(0));const Me=pe?0:M+1;if(!Ce&&Me>=5&&_e(!0),je){await So(je.word,pe,Ae,void 0,"spelling"),de(Date.now()),oe.recordAnswer(je.word,pe,Ae),await $e(je.word,pe);const tt=(Et=(await ps()).wordProgress)==null?void 0:Et[je.word];let Ft=pe?"correct":"incorrect";tt&&tt.masteryLevel==="mastered"?Ft="mastered":!pe&&tt&&tt.incorrectCount>=2&&(Ft="review"),be(Ft),ga({status:Ft,word:je.word,timestamp:Date.now()},"spelling"),tt&&tt.skippedCount&&tt.skippedCount>0&&(pe?yI(je.word):xI(je.word))}!pe&&je&&Se.current.push(je.word);let Ue=I.questions;if(!pe&&je){const Ct=Re(je,I.questions,I.currentIndex,"spelling");Ue=Ct,Ct!==I.questions&&T(tt=>({...tt,questions:Ct}))}if(Z(Ct=>{const tt=Ct+1;return tt>=50?(_e(!0),0):(tt%10===0&&ut(Ue,"spelling").needsRescheduling&&_e(!0),tt)}),je){const Ct=String(je.word);Lr.onShown(Ct),Lr.onAnswer(Ct,pe),Ye(je,J,X)}H(pe),je&&dc({id:hc(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:pe?1:0,total:1,percentage:pe?100:0,date:Date.now(),timeSpent:Math.floor(Ae/1e3),incorrectWords:pe?[]:[je.word],mode:"spelling"})},ot=()=>{const B=I.currentIndex+1;if(B<I.questions.length){const pe=ze(I.questions,B-1);pe!==I.questions&&T(Ae=>({...Ae,questions:pe}))}if(B>=I.questions.length&&!window.location.hostname.includes("github.io"))try{const pe=Lr.summarize();R.log("üß™ KPI Summary (spelling):",pe)}catch{}j(void 0),B<I.questions.length?L():T(pe=>({...pe,answered:!1}))},Ge=async()=>{const B=I.questions[I.currentIndex];if(!B)return;if(I.answered){ot();return}const pe=Date.now()-ge.current;console.log("[SpellingView] SkipÂá¶ÁêÜÈñãÂßã:",{word:B.word,responseTime:pe,currentScore:I.score,totalAnswered:I.totalAnswered}),Ie(!0),j(B.word),U(Ae=>Ae+1),ie(0),kh(B.word,30),gI(B.word),await So(B.word,!0,pe,void 0,"spelling"),de(Date.now()),P([]),T(Ae=>({...Ae,totalAnswered:Ae.totalAnswered+1,score:Ae.score+1,answered:!1})),be("correct"),be("mastered"),ga({status:"correct",word:B.word,timestamp:Date.now()},"spelling"),console.log("[SpellingView] SkipÂá¶ÁêÜÂÆå‰∫Ü:",{word:B.word,newScore:I.score+1,newTotalAnswered:I.totalAnswered+1}),dc({id:hc(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:1,total:1,percentage:100,date:Date.now(),timeSpent:Math.floor(pe/1e3),incorrectWords:[],mode:"spelling",difficulty:B.difficulty}),ot(),Z(Ae=>{const je=Ae+1;return je>=50?(_e(!0),0):(je%10===0&&ut(I.questions,"spelling").needsRescheduling&&_e(!0),je)})},Ut=()=>{P([]),T(B=>({...B,currentIndex:B.currentIndex>0?B.currentIndex-1:0,answered:!1})),ge.current=Date.now()},at=()=>{if(D.length>0){const B=D.slice(0,-1);P(B)}},He=I.questions.length>0,qe=He?I.questions[I.currentIndex]:null,ct=D.map(B=>_[parseInt(B)]).join(""),Mt=qe?{word:qe.word,meaning:qe.meaning,katakana:qe.reading,source:"spelling"}:null,Wt=localStorage.getItem("learning-schedule-90days"),Kt=!!Wt;let lt=null;if(Kt)try{const B=JSON.parse(Wt),pe=Math.floor((Date.now()-B.startDate)/(1e3*60*60*24)),Ae=Math.min(pe+1,B.totalDays),je=Math.round(Ae/B.totalDays*100);lt={currentDay:Ae,totalDays:B.totalDays,progressPercent:je,phase:B.phase}}catch(B){R.error("Failed to parse learning plan:",B)}return u.jsxs("div",{className:"spelling-view",children:[Kt&&lt&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[lt.currentDay,"Êó•ÁõÆ / ",lt.totalDays,"Êó• (Phase ",lt.phase,") -"," ",lt.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),!He&&u.jsx("div",{className:"quiz-controls",children:u.jsx("button",{onClick:p,className:"w-64 px-8 py-4 text-lg font-bold bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-xl:bg-primary-hover",children:"üéØ „ÇØ„Ç§„Ç∫ÈñãÂßã"})}),He?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Ah,{mode:"spelling",currentScore:I.score,totalAnswered:I.totalAnswered,sessionCorrect:J.correct,sessionIncorrect:J.incorrect,sessionReview:J.review,sessionMastered:J.mastered,sessionStats:J,onReviewFocus:f,isReviewFocusMode:m,onShowSettings:()=>wt(!0),onResetProgress:ve,onDebugRequeue:Je,currentWord:(Zt=I.questions[I.currentIndex])==null?void 0:Zt.word,onAnswerTime:re,lastAnswerCorrect:De,lastAnswerWord:Dt,lastAnswerDifficulty:(_t=I.questions[I.currentIndex])==null?void 0:_t.difficulty,correctStreak:z,incorrectStreak:M,learningPhase:oe.state.currentPhase??void 0,estimatedSpeed:(Ke=oe.state.personalParams)==null?void 0:Ke.learningSpeed,dataSource:d==="all"?"ÂÖ®ÂïèÈ°åÈõÜ":d==="junior"?"È´òÊ†°ÂèóÈ®ì":"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ",category:t==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":t,difficulty:r,wordPhraseFilter:i})})}),ft&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>wt(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 text-sm shadow-sm:bg-gray-600:border-gray-500",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-spelling",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-spelling",value:t,onChange:B=>s(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),MI.map(B=>u.jsx("option",{value:B,children:B},B))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-spelling",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-spelling",value:r,onChange:B=>o(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),h&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-spelling",children:"üìö ÂïèÈ°åÈõÜ:"}),u.jsxs("select",{id:"data-source-select-spelling",value:d,onChange:B=>h(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"junior",children:"È´òÊ†°ÂèóÈ®ì"}),u.jsx("option",{value:"intermediate",children:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ"})]})]}),a&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-spelling",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-spelling",value:i,onChange:B=>a(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),l&&i==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-spelling",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-spelling",value:c,onChange:B=>{l&&l(B.target.value)},className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsx($0,{learningLimit:v,reviewLimit:w,onLearningLimitChange:S,onReviewLimitChange:N,idPrefix:"spelling-quiz-"})]}),qe&&u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>Nt(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row meaning-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:Ut,disabled:I.currentIndex===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"meaning-display",children:[u.jsxs("div",{className:"meaning-line",children:[u.jsx("span",{className:"text-xl text-gray-600",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"text-4xl font-bold text-gray-900 ml-2",children:qe.meaning})]}),u.jsxs("div",{className:"meaning-meta",children:[qe.difficulty&&u.jsx("div",{className:`difficulty-badge ${qe.difficulty}`,children:qe.difficulty==="beginner"?"ÂàùÁ¥ö":qe.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),Mt&&x&&y&&b&&g&&u.jsx("div",{className:"mt-3 flex justify-center",children:u.jsx(ta,{word:Mt,sets:g,onAddWord:x,onRemoveWord:y,onOpenManagement:b,size:"medium",variant:"both"})}),qe.word.includes(" ")&&u.jsxs("div",{className:"phrase-hint",children:["üí° ÁÜüË™û(",A.length,"Ë™û): ÂçòË™û„Åî„Å®„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",F.length>0&&u.jsxs("span",{className:"phrase-progress",children:[" ","(ÂÆåÊàê: ",F.join(" "),")"]})]})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:I.answered?ot:Ge,disabled:I.currentIndex>=I.questions.length-1,title:I.answered?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó",children:"‚Üí"})]}),u.jsx("div",{className:"question-content-inline",children:u.jsxs("div",{className:"user-word-display",children:[u.jsx("div",{className:"user-word-label",children:"„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà:"}),u.jsx("div",{className:"user-word-text",children:A.length>0?u.jsxs(u.Fragment,{children:[F.join(" "),F.length>0&&" ",ct||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"]}):ct||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"})]})}),u.jsx("div",{className:"letter-cards",ref:Pe,tabIndex:0,onKeyDown:B=>{if(I.answered)B.key==="Enter"&&(B.preventDefault(),ot());else{const pe=B.key.toLowerCase();if(pe.length===1&&pe>="a"&&pe<="z"){B.preventDefault();const Ae=_.findIndex((je,Me)=>je===pe&&!D.includes(`${Me}`));Ae!==-1&&ue(pe,Ae)}else B.key==="Backspace"?(B.preventDefault(),at()):(B.key===" "||B.key==="Enter")&&(B.preventDefault(),Ge())}},children:_.map((B,pe)=>{const Ae=D.includes(`${pe}`),je=D.indexOf(`${pe}`)+1;let Me="";return I.answered&&Ae&&(Me=D.map(Ct=>_[parseInt(Ct)]).join("")===I.correctWord?"correct":"incorrect"),u.jsxs("button",{className:`letter-card ${Ae?"selected":""} ${I.answered?"practice-mode":""} ${Me}`,onClick:()=>ue(B,pe),children:[B,Ae&&u.jsx("span",{className:"selection-number",children:je})]},pe)})}),!I.answered&&u.jsxs("div",{className:"spelling-reset-button-container",children:[D.length>0&&u.jsx("button",{className:"btn-reset-selection",onClick:at,children:"‚å´ 1ÊñáÂ≠óÊàª„Åô"}),u.jsx("button",{className:"btn-skip-word",onClick:Ge,children:"‚è≠Ô∏è ÂàÜ„Åã„Çâ„Å™„ÅÑ („Çπ„Éö„Éº„Çπ„Ç≠„Éº)"})]}),I.answered&&u.jsxs("div",{className:"result-display",children:[u.jsxs("div",{className:"correct-answer",children:[ct===I.correctWord?"‚úÖ Ê≠£Ëß£: ":ct===""?"‚è≠Ô∏è „Çπ„Ç≠„ÉÉ„Éó - Ê≠£Ëß£: ":"‚ùå ‰∏çÊ≠£Ëß£ - Ê≠£Ëß£: ",u.jsxs("strong",{className:yn()?"clickable-word":"",onClick:B=>{B.stopPropagation(),yn()&&qe&&Ts(qe.word,{rate:.85})},title:yn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":void 0,children:[(qe==null?void 0:qe.word)||I.correctWord,yn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"}),(qe==null?void 0:qe.reading)&&u.jsxs("span",{className:"pronunciation-hint",children:["(",qe.reading,")"]})]})]}),u.jsxs("div",{className:"question-details-spelling",children:[qe.reading&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>yn()&&Ts(qe.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-content",children:qe.reading})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-content",children:qe.meaning})]}),qe.etymology&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠âËß£Ë™¨:"}),u.jsx("span",{className:"detail-content",children:qe.etymology})]}),qe.relatedWords&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-content",children:qe.relatedWords})]}),qe.relatedFields&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsx("span",{className:"detail-content",children:qe.relatedFields})]}),qe.difficulty&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>yn()&&Ts(qe.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("div",{className:`difficulty-badge ${qe.difficulty}`,children:qe.difficulty==="beginner"?"ÂàùÁ¥ö":qe.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]})]})]})]})]}):u.jsx("div",{className:"empty-state",children:u.jsx("p",{children:"üìñ Êù°‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Äå„ÇØ„Ç§„Ç∫ÈñãÂßã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})}),mt&&u.jsx(Rh,{mode:"spelling",currentIndex:I.currentIndex,totalQuestions:I.questions.length,questions:I.questions,requeuedWords:Te(I.questions,I.currentIndex)})]})}function M9(n){const e=n.split("/").pop()||"",s=e.replace(/\.txt$/,"").split("_");return s.length>=3?s.slice(2).join("_"):e}const F9=[{id:"beginner-morning-routine",level:"beginner",topic:"daily-life",wordCount:50,filePath:"/data/passages-for-phrase-work/beginner_50_Morning-Routine.txt"},{id:"beginner-supermarket-shopping",level:"beginner",topic:"daily-life",wordCount:1910,filePath:"/data/passages-for-phrase-work/beginner_1910_Shopping-at-the-Supermarket.txt"},{id:"beginner-cafe-day",level:"beginner",topic:"food-culture",wordCount:1380,filePath:"/data/passages-for-phrase-work/beginner_1380_A-Day-at-the-Cafe.txt"},{id:"beginner-conversation-daily",level:"beginner",topic:"communication",wordCount:3018,filePath:"/data/passages-for-phrase-work/beginner_3018_Daily-Conversations.txt"},{id:"beginner-weather-seasons",level:"beginner",topic:"nature",wordCount:2111,filePath:"/data/passages-for-phrase-work/beginner_2111_Weather-and-Seasons.txt"},{id:"beginner-wildlife-park-guide",level:"beginner",topic:"animals",wordCount:2097,filePath:"/data/passages-for-phrase-work/beginner_2097_Wildlife-Park-Guide.txt"},{id:"intermediate-exchange-student-australia",level:"intermediate",topic:"culture-exchange",wordCount:3199,filePath:"/data/passages-for-phrase-work/intermediate_3199_Exchange-Student-in-Australia.txt"},{id:"intermediate-homestay-america",level:"intermediate",topic:"culture-exchange",wordCount:3148,filePath:"/data/passages-for-phrase-work/intermediate_3148_Homestay-in-America.txt"},{id:"intermediate-career-day",level:"intermediate",topic:"education-career",wordCount:2895,filePath:"/data/passages-for-phrase-work/intermediate_2895_Career-Day-at-School.txt"},{id:"intermediate-hospital-visit",level:"intermediate",topic:"health",wordCount:2721,filePath:"/data/passages-for-phrase-work/intermediate_2721_A-Visit-to-the-Hospital.txt"},{id:"intermediate-science-museum",level:"intermediate",topic:"science-education",wordCount:3265,filePath:"/data/passages-for-phrase-work/intermediate_3265_Science-Museum-Experience.txt"},{id:"intermediate-community-events",level:"intermediate",topic:"community",wordCount:2216,filePath:"/data/passages-for-phrase-work/intermediate_2216_Community-Events.txt"},{id:"intermediate-school-events-year",level:"intermediate",topic:"school-life",wordCount:2558,filePath:"/data/passages-for-phrase-work/intermediate_2558_A-Year-of-School-Events.txt"},{id:"intermediate-school-news",level:"intermediate",topic:"school-life",wordCount:1937,filePath:"/data/passages-for-phrase-work/intermediate_1937_School-News.txt"},{id:"advanced-environmental-issues",level:"advanced",topic:"environment",wordCount:4263,filePath:"/data/passages-for-phrase-work/advanced_4263_Environmental-Issues-and-Solutions.txt"},{id:"advanced-family-gathering",level:"advanced",topic:"culture-family",wordCount:4493,filePath:"/data/passages-for-phrase-work/advanced_4493_Family-Gathering-Traditions.txt"},{id:"advanced-health-statistics",level:"advanced",topic:"health-data",wordCount:3422,filePath:"/data/passages-for-phrase-work/advanced_3422_Health-Statistics-Analysis.txt"},{id:"advanced-historical-figures",level:"advanced",topic:"history",wordCount:3115,filePath:"/data/passages-for-phrase-work/advanced_3115_Historical-Figures-Study.txt"},{id:"advanced-international-exchange",level:"advanced",topic:"culture-global",wordCount:3813,filePath:"/data/passages-for-phrase-work/advanced_3813_Cultural-Exchange-Insights.txt"},{id:"advanced-school-festival",level:"advanced",topic:"school-events",wordCount:4419,filePath:"/data/passages-for-phrase-work/advanced_4419_School-Festival-Planning.txt"},{id:"advanced-summer-vacation-stories",level:"advanced",topic:"personal-growth",wordCount:3255,filePath:"/data/passages-for-phrase-work/advanced_3255_Summer-Vacation-Stories.txt"},{id:"advanced-technology-future",level:"advanced",topic:"technology-innovation",wordCount:3161,filePath:"/data/passages-for-phrase-work/advanced_3161_Technology-and-Future.txt"}],A0=F9.map(n=>({...n,title:M9(n.filePath),level:n.level}));function TI(){return A0}async function AI(n){try{const e=A0.find(i=>i.id===n);if(!e)return R.error(`Passage not found: ${n}`),"";const s=`/data/passages-original/${e.filePath.split("/").pop()||""}`,r=await fetch(s);return r.ok?await r.text():(R.log(`Original file not found: ${s}`),"")}catch(e){return R.error(`Error loading original passage ${n}:`,e),""}}async function O9(n){const e=A0.find(t=>t.id===n);if(!e)return R.error(`Passage not found: ${n}`),null;try{const t=await fetch(e.filePath);if(!t.ok)throw new Error(`Failed to fetch: ${t.statusText}`);const s=await t.text(),r=L9(s);return{...e,content:s,sections:r}}catch(t){return R.error(`Error loading passage ${n}:`,t),null}}function L9(n){const e=n.split(`
`),t=[];let s=null;for(const r of e){const o=r.trim();o&&(!r.startsWith("    ")&&o.length>0&&o.length<80?(s&&t.push(s),s={title:o,paragraphs:[]}):r.startsWith("    ")&&s&&s.paragraphs.push(o))}return s&&t.push(s),t}function zi(n){const e=n.toLowerCase().trim();if(e.endsWith("ing")&&e.length>4){const t=e.slice(0,-3);return t.endsWith("n")||t.endsWith("m")||t.endsWith("t")?t.slice(0,-1):t+"e"}if(e.endsWith("ed")&&e.length>3){const t=e.slice(0,-2);return t.endsWith("i")?t.slice(0,-1)+"y":t}return e.endsWith("es")&&e.length>3?e.slice(0,-2):e.endsWith("s")&&e.length>2&&!e.endsWith("ss")?e.slice(0,-1):e}async function EI(n){try{let e=`/data/passages/passages-translations/${n}-ja.txt`;console.log(`[ÂÖ®Ë®≥] Attempting to load: ${e} for passageId: ${n}`);let t=await fetch(e);if(t.ok||(e=`/data/passages-translations/${n}-ja.txt`,console.log(`[ÂÖ®Ë®≥] Trying old path: ${e}`),t=await fetch(e)),!t.ok)return console.log(`[ÂÖ®Ë®≥] File not found (${t.status}): ${e}`),"";const s=await t.text();return console.log(`[ÂÖ®Ë®≥] Successfully loaded ${s.length} characters from ${e}`),s}catch(e){return console.error(`[ÂÖ®Ë®≥] Error loading full translation for ${n}:`,e),""}}async function z9(n){try{const e=TI().find(a=>a.id===n);if(!e)return[];const s=`/data/passages-for-phrase-work-ja/${(e.filePath.split("/").pop()||"").replace(/\.txt$/,"-ja.txt")}`,r=await fetch(s);if(!r.ok)return R.log(`No Japanese phrase file found: ${s}`),[];const i=(await r.text()).split(`
`).map(a=>a.trim()).filter(a=>a.length>0);return R.log(`Loaded ${i.length} Japanese phrases from ${s}`),i}catch(e){return R.error(`Error loading Japanese phrases for ${n}:`,e),[]}}async function W9(n,e){const t=await O9(n);if(!t)return null;const[s,r,o]=await Promise.all([z9(n),EI(n),AI(n)]);let i=0;const a=[];return t.sections.forEach(l=>{l.paragraphs.forEach(d=>{if(d.match(/^([^:]+):\s*"([^"]+)"$/)){const p=d.trim(),f=p.split(/\s+/),m=f.map(x=>{let y=x,b="";if(y.startsWith('"')&&(b='"',y=y.substring(1)),/^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\.$|^[A-Z]\.$|^vs\.$|^e\.g\.$|^i\.e\.$/.test(y)){const S=zi(y.replace(/\.$/,"")),N=e.get(S),C=(N==null?void 0:N.meaning)||"",k=[];return b&&k.push({word:b,meaning:"",isUnknown:!1}),k.push({word:y,meaning:C==="-"?"":C,isUnknown:!1}),k}const w=y.match(/([.,!?;:‚Äî"])$/);if(w){const S=y.replace(/[.,!?;:‚Äî"]$/,""),N=w[1];if(!S){const _=[];return b&&_.push({word:b,meaning:"",isUnknown:!1}),_.push({word:N,meaning:"",isUnknown:!1}),_}const C=zi(S),k=e.get(C),I=(k==null?void 0:k.meaning)||"",T=[];return b&&T.push({word:b,meaning:"",isUnknown:!1}),T.push({word:S,meaning:I==="-"?"":I,isUnknown:!1}),T.push({word:N,meaning:"",isUnknown:!1}),T}else{const S=zi(y),N=e.get(S),C=(N==null?void 0:N.meaning)||"",k=[];return b&&k.push({word:b,meaning:"",isUnknown:!1}),k.push({word:y,meaning:C==="-"?"":C,isUnknown:!1}),k}}).flat(),g=s[i]||"";i++,a.push({english:p,japanese:g,phraseMeaning:g,words:f,segments:m})}else{const p=d.trim(),f=p.split(/\s+/),m=f.map(x=>{if(/^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\.$|^[A-Z]\.$|^vs\.$|^e\.g\.$|^i\.e\.$/.test(x)){const v=zi(x.replace(/\.$/,"")),w=e.get(v),S=(w==null?void 0:w.meaning)||"";return{word:x,meaning:S==="-"?"":S,isUnknown:!1}}const b=x.match(/([.,!?;:‚Äî])$/);if(b){const v=x.replace(/[.,!?;:‚Äî]$/,""),w=b[1];if(!v)return{word:w,meaning:"",isUnknown:!1};const S=zi(v),N=e.get(S),C=(N==null?void 0:N.meaning)||"";return[{word:v,meaning:C==="-"?"":C,isUnknown:!1},{word:w,meaning:"",isUnknown:!1}]}else{const v=zi(x),w=e.get(v),S=(w==null?void 0:w.meaning)||"";return{word:x,meaning:S==="-"?"":S,isUnknown:!1}}}).flat(),g=s[i]||"";i++,a.push({english:p,japanese:g,phraseMeaning:g,words:f,segments:m})}})}),{id:t.id,title:t.title,level:t.level,actualWordCount:t.wordCount,phrases:a,translation:r,originalText:o}}async function B9(n){var e;try{const t=await fetch(`/data/passages-phrase-learning/${n}.json`);if(!t.ok)return R.log(`No phrase learning JSON found for ${n}, will use .txt conversion`),null;const s=await t.json();R.log(`Loaded phrase learning JSON for ${n}, phrases: ${((e=s.phrases)==null?void 0:e.length)||0}`);const[r,o]=await Promise.all([EI(n),AI(n)]);return{...s,phrases:s.phrases||[],translation:r,originalText:o}}catch{return R.log(`Skipping phrase learning JSON for ${n} (file may be old or moved), will use .txt conversion`),null}}async function V9(n){var s;const e=TI(),t=[];R.log(`Loading ${e.length} passages...`);for(const r of e){let o=await B9(r.id);o||(o=await W9(r.id,n)),o?(R.log(`‚úì Loaded passage: ${r.id} (${((s=o.phrases)==null?void 0:s.length)||0} phrases)`),t.push(o)):R.error(`‚úó Failed to load passage: ${r.id}`)}return R.log(`Total passages loaded: ${t.length}`),t}const My=new Set(["be","am","is","are","was","were","been","being","have","has","had","having","do","does","did","done","doing","can","could","will","would","shall","should","may","might","must","go","goes","went","gone","going","get","gets","got","gotten","getting","make","makes","made","making","take","takes","took","taken","taking","see","sees","saw","seen","seeing","come","comes","came","coming","want","wants","wanted","wanting","use","uses","used","using","find","finds","found","finding","give","gives","gave","given","giving","tell","tells","told","telling","work","works","worked","working","call","calls","called","calling","try","tries","tried","trying","ask","asks","asked","asking","need","needs","needed","needing","feel","feels","felt","feeling","become","becomes","became","becoming","leave","leaves","left","leaving","put","puts","putting","mean","means","meant","meaning","keep","keeps","kept","keeping","let","lets","letting","begin","begins","began","begun","beginning","seem","seems","seemed","seeming","help","helps","helped","helping","talk","talks","talked","talking","turn","turns","turned","turning","start","starts","started","starting","show","shows","showed","shown","showing","hear","hears","heard","hearing","play","plays","played","playing","run","runs","ran","running","move","moves","moved","moving","like","likes","liked","liking","live","lives","lived","living","believe","believes","believed","believing","bring","brings","brought","bringing","happen","happens","happened","happening","write","writes","wrote","written","writing","sit","sits","sat","sitting","stand","stands","stood","standing","lose","loses","lost","losing","pay","pays","paid","paying","meet","meets","met","meeting","include","includes","included","including","continue","continues","continued","continuing","set","sets","setting","learn","learns","learned","learning","change","changes","changed","changing","lead","leads","led","leading","understand","understands","understood","understanding","watch","watches","watched","watching","follow","follows","followed","following","stop","stops","stopped","stopping","create","creates","created","creating","speak","speaks","spoke","spoken","speaking","read","reads","reading","spend","spends","spent","spending","grow","grows","grew","grown","growing","open","opens","opened","opening","walk","walks","walked","walking","win","wins","won","winning","teach","teaches","taught","teaching","offer","offers","offered","offering","remember","remembers","remembered","remembering","consider","considers","considered","considering","appear","appears","appeared","appearing","buy","buys","bought","buying","serve","serves","served","serving","die","dies","died","dying","send","sends","sent","sending","build","builds","built","building","stay","stays","stayed","staying","fall","falls","fell","fallen","falling","cut","cuts","cutting","reach","reaches","reached","reaching","kill","kills","killed","killing","raise","raises","raised","raising","pass","passes","passed","passing","sell","sells","sold","selling","decide","decides","decided","deciding","return","returns","returned","returning","explain","explains","explained","explaining","hope","hopes","hoped","hoping","develop","develops","developed","developing","carry","carries","carried","carrying","break","breaks","broke","broken","breaking","receive","receives","received","receiving","agree","agrees","agreed","agreeing","support","supports","supported","supporting","hit","hits","hitting","produce","produces","produced","producing","eat","eats","ate","eaten","eating","cover","covers","covered","covering","catch","catches","caught","catching","draw","draws","drew","drawn","drawing","wake","wakes","woke","woken","waking","brush","brushes","brushed","brushing","wash","washes","washed","washing","prepare","prepares","prepared","preparing","check","checks","checked","checking"]),RI=new Set(["in","on","at","to","for","with","from","by","about","as","into","like","through","after","over","between","out","against","during","without","before","under","around","among","of","up"]),U9=new Set(["and","but","or","so","yet","for","nor","because","although","if","when","while","since","unless","that","which","who","whom","whose","where"]),G9=new Set(["the","a","an","this","that","these","those","my","your","his","her","its","our","their","some","any","no","every","each","either","neither","much","many","more","most","few","little","several"]),H9=new Set(["i","you","he","she","it","we","they","me","him","her","us","them","myself","yourself","himself","herself","itself","ourselves","themselves"]),q9=new Set(["good","new","first","last","long","great","little","own","other","old","right","big","high","different","small","large","next","early","young","important","few","public","bad","same","able","ready","usual","toast","juice"]),K9=new Set(["not","so","up","out","just","now","how","then","more","also","here","well","only","very","even","back","there","down","still","in","as","too","when","never","really","usually","finally","first","after","before"]);function Q9(n){return{S:"#3b82f6",V:"#ef4444",O:"#10b981",C:"#f59e0b",M:"#8b5cf6",Prep:"#6366f1",Conj:"#ec4899",Det:"#14b8a6",Adj:"#f97316",Adv:"#a855f7",Unknown:"#6b7280"}[n]}function X9(n){return{S:"‰∏ªË™û",V:"ÂãïË©û",O:"ÁõÆÁöÑË™û",C:"Ë£úË™û",M:"‰øÆÈ£æË™û",Prep:"ÂâçÁΩÆË©û",Conj:"Êé•Á∂öË©û",Det:"ÂÜ†Ë©û„ÉªÈôêÂÆöË©û",Adj:"ÂΩ¢ÂÆπË©û",Adv:"ÂâØË©û",Unknown:"‰∏çÊòé"}[n]}function Y9(n,e,t){var r;const s=n.toLowerCase();return/^[.,!?;:]$/.test(n)?"Unknown":My.has(s)?"V":RI.has(s)?"Prep":U9.has(s)?"Conj":G9.has(s)?"Det":q9.has(s)?"Adj":K9.has(s)?"Adv":H9.has(s)?e===0||e>0&&My.has((r=t[e+1])==null?void 0:r.toLowerCase())?"S":"O":"Unknown"}function J9(n){return{".":"Êñá„ÅÆÁµÇ„Çè„Çä",",":"Âå∫Âàá„Çä„ÉªÂàóÊåô","!":"ÊÑüÂòÜ„ÉªÂº∑Ë™ø","?":"ÁñëÂïè",";":"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",":":"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•","-":"Ë£úË∂≥Ë™¨Êòé„ÉªË®Ä„ÅÑÊèõ„Åà","‚Äî":"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•","‚Äì":"ÁØÑÂõ≤„ÉªÈñ¢‰øÇ",'"':"ÂºïÁî®","'":"ÂºïÁî®„ÉªÊâÄÊúâÊ†º","(":"Ë£úË∂≥ÊÉÖÂ†±„ÅÆÈñãÂßã",")":"Ë£úË∂≥ÊÉÖÂ†±„ÅÆÁµÇ‰∫Ü"}[n]||"Âè•Ë™≠ÁÇπ"}function Yl(n){const e=n.match(/\b[\w']+\b|[.,!?;:\-‚Äî‚Äì"'()]/g)||[],t=[];let s=!1,r=!1;for(let o=0;o<e.length;o++){const i=e[o];if(/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(i)){t.push({word:i,tag:"Unknown",color:"#6b7280",description:J9(i)});continue}let a=Y9(i,o,e);a==="Unknown"&&(o===0&&/^[A-Z]/.test(i)&&!r?(a="S",r=!0):s&&!r?a="O":(o>0&&RI.has(e[o-1].toLowerCase()),a="M")),a==="V"&&(s=!0),a==="S"&&(r=!0),t.push({word:i,tag:a,color:Q9(a),description:X9(a)})}return t}const Z9=[{words:["wake","up"],meaning:"Ëµ∑„Åç„Çã",type:"phrasal-verb"},{words:["get","up"],meaning:"Ëµ∑Â∫ä„Åô„Çã",type:"phrasal-verb"},{words:["wake","up"],meaning:"ÁõÆ„ÇíË¶ö„Åæ„Åô",type:"phrasal-verb"},{words:["brush","my","teeth"],meaning:"Ê≠Ø„ÇíÁ£®„Åè",type:"phrasal-verb"},{words:["wash","my","face"],meaning:"È°î„ÇíÊ¥ó„ÅÜ",type:"phrasal-verb"},{words:["have","breakfast"],meaning:"ÊúùÈ£ü„ÇíÈ£ü„Åπ„Çã",type:"phrasal-verb"},{words:["go","to","school"],meaning:"Â≠¶Ê†°„Å´Ë°å„Åè",type:"phrasal-verb"},{words:["come","back"],meaning:"Â∏∞„Å£„Å¶„Åè„Çã",type:"phrasal-verb"},{words:["come","home"],meaning:"Â∏∞ÂÆÖ„Åô„Çã",type:"phrasal-verb"},{words:["do","homework"],meaning:"ÂÆøÈ°å„Çí„Åô„Çã",type:"phrasal-verb"},{words:["go","to","bed"],meaning:"ÂØù„Çã",type:"phrasal-verb"},{words:["at","seven"],meaning:"7ÊôÇ„Å´",type:"time-expression"},{words:["in","the","morning"],meaning:"Êúù„Å´",type:"time-expression"},{words:["in","the","afternoon"],meaning:"ÂçàÂæå„Å´",type:"time-expression"},{words:["in","the","evening"],meaning:"Â§ïÊñπ„Å´",type:"time-expression"},{words:["at","night"],meaning:"Â§ú„Å´",type:"time-expression"},{words:["every","morning"],meaning:"ÊØéÊúù",type:"determiner-noun"},{words:["every","day"],meaning:"ÊØéÊó•",type:"determiner-noun"},{words:["every","night"],meaning:"ÊØéÊô©",type:"determiner-noun"},{words:["every","week"],meaning:"ÊØéÈÄ±",type:"determiner-noun"}];function eY(n){const e=[],t=n.map(s=>s.toLowerCase());for(const s of Z9){const r=s.words.map(o=>o.toLowerCase());for(let o=0;o<=t.length-r.length;o++){let i=!0;for(let a=0;a<r.length;a++)if(t[o+a]!==r[a]){i=!1;break}i&&e.push({...s,words:n.slice(o,o+r.length)})}}return e}const tY=[{name:"too ~ to ...",meaning:"„Äú„Åô„Åé„Å¶...„Åß„Åç„Å™„ÅÑ",pattern:/\btoo\s+\w+\s+to\s+\w+/i,explanation:"„Äåtoo + ÂΩ¢ÂÆπË©û/ÂâØË©û + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Åé„Å¶...„Åß„Åç„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"so ~ that ...",meaning:"„Å®„Å¶„ÇÇ„Äú„Å™„ÅÆ„Åß...",pattern:/\bso\s+\w+\s+that\b/i,explanation:"„Äåso + ÂΩ¢ÂÆπË©û/ÂâØË©û + that ~„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Å®„Å¶„ÇÇ„Äú„Å™„ÅÆ„Åß...„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"so that ...",meaning:"„Äú„Åô„Çã„Åü„ÇÅ„Å´",pattern:/\bso\s+that\b/i,explanation:"„Äåso that ~„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åü„ÇÅ„Å´„Äç„Å®„ÅÑ„ÅÜÁõÆÁöÑ„ÇíË°®„Åô"},{name:"It is ~ for ... to",meaning:"...„Åå„Äú„Åô„Çã„ÅÆ„ÅØ",pattern:/\bit\s+is\s+\w+\s+for\s+\w+\s+to\b/i,explanation:"„ÄåIt is + ÂΩ¢ÂÆπË©û + for + ‰∫∫ + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå(‰∫∫)„Åå„Äú„Åô„Çã„ÅÆ„ÅØ...„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"It is ~ to ...",meaning:"„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†",pattern:/\bit\s+is\s+\w+\s+to\s+\w+/i,explanation:"„ÄåIt is + ÂΩ¢ÂÆπË©û + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"It is ~ that ...",meaning:"...„Å™„ÅÆ„ÅØ„Äú„Å† (Âº∑Ë™ø)",pattern:/\bit\s+is\s+\w+\s+that\b/i,explanation:"Âº∑Ë™øÊßãÊñá„ÄÇ„ÄåIt is ~ that ...„Äç„ÅÆÂΩ¢„Åß„ÄÅÁâπÂÆö„ÅÆÈÉ®ÂàÜ„ÇíÂº∑Ë™ø„Åô„Çã"},{name:"not only ~ but also ...",meaning:"„Äú„Å†„Åë„Åß„Å™„Åè...„ÇÇ",pattern:/\bnot\s+only\s+.+\s+but\s+also\b/i,explanation:"„Äånot only A but also B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„Å†„Åë„Åß„Å™„ÅèB„ÇÇ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"either ~ or ...",meaning:"„Äú„Åã...„Åã„Å©„Å°„Çâ„Åã",pattern:/\beither\s+.+\s+or\b/i,explanation:"„Äåeither A or B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÅãB„Åã„Å©„Å°„Çâ„Åã„Äç„Å®„ÅÑ„ÅÜÈÅ∏Êäû„ÇíË°®„Åô"},{name:"neither ~ nor ...",meaning:"„Äú„ÇÇ...„ÇÇ„Å™„ÅÑ",pattern:/\bneither\s+.+\s+nor\b/i,explanation:"„Äåneither A nor B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÇÇB„ÇÇ„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÂê¶ÂÆö„ÇíË°®„Åô"},{name:"both ~ and ...",meaning:"„Äú„ÇÇ...„ÇÇ‰∏°Êñπ",pattern:/\bboth\s+.+\s+and\b/i,explanation:"„Äåboth A and B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÇÇB„ÇÇ‰∏°Êñπ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"as ~ as ...",meaning:"...„Å®Âêå„Åò„Åè„Çâ„ÅÑ„Äú",pattern:/\bas\s+\w+\s+as\b/i,explanation:"„Äåas + ÂΩ¢ÂÆπË©û/ÂâØË©û + as ...„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå...„Å®Âêå„Åò„Åè„Çâ„ÅÑ„Äú„Äç„Å®„ÅÑ„ÅÜÂêåÁ≠âÊØîËºÉ"},{name:"not as ~ as ...",meaning:"...„Åª„Å©„Äú„Å™„ÅÑ",pattern:/\bnot\s+as\s+\w+\s+as\b/i,explanation:"„Äånot as + ÂΩ¢ÂÆπË©û/ÂâØË©û + as ...„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå...„Åª„Å©„Äú„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"one of the ~est",meaning:"ÊúÄ„ÇÇ„Äú„Å™„ÇÇ„ÅÆ„ÅÆ1„Å§",pattern:/\bone\s+of\s+the\s+\w+est\b/i,explanation:"„Äåone of the + ÊúÄ‰∏äÁ¥ö + Ë§áÊï∞ÂêçË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåÊúÄ„ÇÇ„Äú„Å™„ÇÇ„ÅÆ„ÅÆ1„Å§„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"make/let/have + ‰∫∫ + ÂãïË©û",meaning:"‰∫∫„Å´„Äú„Åï„Åõ„Çã",pattern:/\b(make|let|have|help)\s+\w+\s+\w+/i,explanation:"‰ΩøÂΩπÂãïË©û„ÅÆÊßãÊñá„ÄÇ„Äåmake/let/have + ‰∫∫ + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„Åß„Äå‰∫∫„Å´„Äú„Åï„Åõ„Çã„Äç"},{name:"be used to ~ing",meaning:"„Äú„Åô„Çã„Åì„Å®„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã",pattern:/\b(am|is|are|was|were)\s+used\s+to\s+\w+ing\b/i,explanation:"„Äåbe used to + ÂãïÂêçË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"used to + ÂãïË©û",meaning:"Êòî„ÅØ„Äú„Åó„Åü„ÇÇ„ÅÆ„Å†",pattern:/\bused\s+to\s+\w+/i,explanation:"„Äåused to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåÊòî„ÅØ„Äú„Åó„Åü„ÇÇ„ÅÆ„Å†„Äç„Å®„ÅÑ„ÅÜÈÅéÂéª„ÅÆÁøíÊÖ£„ÇíË°®„Åô"}];function nY(n){const e=[];for(const t of tY)t.pattern.test(n)&&e.push(t);return e}function Fy(n){return{beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö",Advanced:"‰∏äÁ¥ö",ÂàùÁ¥ö:"ÂàùÁ¥ö",‰∏≠Á¥ö:"‰∏≠Á¥ö",‰∏äÁ¥ö:"‰∏äÁ¥ö"}[n]||n}function DI({onSaveUnknownWords:n,customQuestionSets:e=[],onAddWordToCustomSet:t,onRemoveWordFromCustomSet:s,onOpenCustomSetManagement:r}){var dt;const[o,i]=$.useState([]),[a,c]=$.useState(null),[l,d]=$.useState([]),[h,p]=$.useState([]),[f,m]=$.useState("all"),[g,x]=$.useState(null),[y,b]=$.useState(new Map),[v,w]=$.useState(new Map),[S,N]=$.useState(null),[C,k]=$.useState(!1),[I,T]=$.useState(!0),[_,D]=$.useState("reading"),[P,A]=$.useState(0),[F,O]=$.useState(!1),[V,L]=$.useState(!1),[H,J]=$.useState(null),[X,fe]=$.useState(null),[be,oe]=$.useState(!1),[xe,$e]=$.useState(!1),[Le,Re]=$.useState(!0);$.useEffect(()=>{if(o.length>0){const re="reading-unknown-words-state";try{const de=o.map(q=>({id:q.id,unknownWords:q.phrases.flatMap((Z,Ce)=>Z.segments.map((_e,De)=>_e.isUnknown?`${Ce}-${De}`:null).filter(Boolean))}));localStorage.setItem(re,JSON.stringify(de))}catch(de){R.warn("ÂàÜ„Åã„Çâ„Å™„ÅÑÂçòË™û„ÅÆÁä∂ÊÖã‰øùÂ≠ò„Å´Â§±Êïó:",de)}}},[o]),$.useEffect(()=>{R.log("[Èï∑Êñá] ËæûÊõ∏„ÅÆË™≠„ÅøËæº„Åø„ÇíÈñãÂßã..."),fetch("/data/vocabulary/high-school-entrance-words.csv").then(re=>{if(!re.ok)throw new Error(`CSVË™≠„ÅøËæº„ÅøÂ§±Êïó: ${re.status}`);return re.text()}).then(re=>{const de=re.split(`
`),q=new Map;de.slice(1).forEach(Z=>{if(!Z.trim())return;const Ce=Z.split(",").map(_e=>_e.trim());if(Ce.length>=7){const _e=Ce[0].toLowerCase().trim();q.set(_e,{word:Ce[0],reading:Ce[1],meaning:Ce[2],etymology:Ce[3],relatedWords:Ce[4],relatedFields:Ce[5],difficulty:Ce[6]})}}),R.log(`[Èï∑Êñá] „É°„Ç§„É≥ËæûÊõ∏: ${q.size}ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`),b(q)}).catch(re=>{}),fetch("/data/dictionaries/reading-passages-dictionary.json").then(re=>{if(!re.ok)throw new Error(`JSONË™≠„ÅøËæº„ÅøÂ§±Êïó: ${re.status}`);return re.json()}).then(re=>{const de=new Map;Object.entries(re).forEach(([q,Z])=>{de.set(q.toLowerCase(),Z)}),w(de),R.log(`[Èï∑Êñá] Èï∑ÊñáË™≠Ëß£ËæûÊõ∏: ${de.size}ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`)}).catch(re=>{R.error("[Èï∑Êñá] Error loading reading dictionary:",re)})},[]);const ze=$.useCallback(re=>{const de=re.toLowerCase().replace(/[.,!?;:"']/g,"").trim();if(y.has(de)||v.has(de))return de;if(de.endsWith("es")){const q=de.slice(0,-2);if(y.has(q)||v.has(q))return q}if(de.endsWith("s")){const q=de.slice(0,-1);if(y.has(q)||v.has(q))return q}if(de.endsWith("ed")){const q=de.slice(0,-2);if(y.has(q)||v.has(q))return q;if(y.has(q+"e")||v.has(q+"e"))return q+"e";if(q.length>2&&q[q.length-1]===q[q.length-2]){const Z=q.slice(0,-1);if(y.has(Z)||v.has(Z))return Z}}if(de.endsWith("ing")){const q=de.slice(0,-3);if(y.has(q)||v.has(q))return q;if(y.has(q+"e")||v.has(q+"e"))return q+"e";if(q.length>2&&q[q.length-1]===q[q.length-2]){const Z=q.slice(0,-1);if(y.has(Z)||v.has(Z))return Z}}if(de.endsWith("ly")){const q=de.slice(0,-2);if(y.has(q)||v.has(q))return q}if(de.endsWith("er")){const q=de.slice(0,-2);if(y.has(q)||v.has(q))return q}if(de.endsWith("est")){const q=de.slice(0,-3);if(y.has(q)||v.has(q))return q}return de},[y,v]),Ye=$.useCallback((re,de)=>{if(de&&typeof de=="string"&&de.trim()&&de!=="-")return de;if(de&&typeof de=="object"&&"meaning"in de&&typeof de.meaning=="string")return de.meaning;const q=re.toLowerCase();if(q==="who")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„ÅØ";if(q==="whom")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„Çí";if(q==="which")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆÁâ©Á≠â„ÅØ„Éª„Çí";if(q==="that")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„ÉªÁâ©Á≠â„ÅØ„Éª„Çí";const Z=ze(re),Ce=y.get(Z),_e=v.get(Z);return(Ce==null?void 0:Ce.meaning)||(_e==null?void 0:_e.meaning)||""},[ze,y,v]);$.useEffect(()=>{const re=setInterval(()=>{F&&!ZX()&&!e9()&&(O(!1),L(!1))},500);return()=>clearInterval(re)},[F]),$.useEffect(()=>{if(y.size===0){R.log("[Èï∑Êñá] ËæûÊõ∏„ÅÆË™≠„ÅøËæº„Åø„ÇíÂæÖÊ©ü‰∏≠...");return}R.log(`[Èï∑Êñá] „Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„ÇíÈñãÂßã... (ËæûÊõ∏: ${y.size}ÂçòË™û)`);try{localStorage.removeItem("reading-passages-data")}catch{}const re="reading-unknown-words-state";let de=[];try{const q=localStorage.getItem(re);q&&(de=JSON.parse(q))}catch(q){R.warn("[Èï∑Êñá] ‰øùÂ≠òÊ∏à„ÅøÈÄ≤Êçó„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",q)}Re(!0),V9(y).then(q=>{var Z,Ce;if(q&&q.length>0){R.log(`[Èï∑Êñá] ${q.length}‰ª∂„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);const _e=q.map(Dt=>{const j=de.find(z=>z.id===Dt.id);return j!=null&&j.unknownWords&&j.unknownWords.length>0?{...Dt,phrases:Dt.phrases.map((z,U)=>({...z,segments:z.segments.map((M,ie)=>{var te;return{...M,isUnknown:((te=j.unknownWords)==null?void 0:te.includes(`${U}-${ie}`))??!1}})}))}:Dt}),De={ÂàùÁ¥ö:1,beginner:1,‰∏≠Á¥ö:2,intermediate:2,‰∏äÁ¥ö:3,advanced:3,Advanced:3},Ie=_e.sort((Dt,j)=>{const z=De[Dt.level||""]||999,U=De[j.level||""]||999;if(z!==U)return z-U;const M=Dt.actualWordCount||0,ie=j.actualWordCount||0;return M-ie});i(Ie),R.log(`[Èï∑Êñá] „Éë„ÉÉ„Çª„Éº„Ç∏„ÇíË®≠ÂÆöÂÆå‰∫Ü: ${Ie.length}‰ª∂`),Ie.length>0&&(c(Ie[0].id),d(new Array(((Z=Ie[0].phrases)==null?void 0:Z.length)||0).fill(!1)),p(new Array(((Ce=Ie[0].phrases)==null?void 0:Ce.length)||0).fill(!1)),R.log(`[Èï∑Êñá] ÂàùÊúü„Éë„ÉÉ„Çª„Éº„Ç∏„ÇíÈÅ∏Êäû: ${Ie[0].id}`)),Re(!1)}else R.error("[Èï∑Êñá] loadAllPassagesAsReadingFormat„ÅåÁ©∫„ÅÆÈÖçÂàó„ÇíËøî„Åó„Åæ„Åó„Åü"),x("„Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºà„Éá„Éº„Çø„ÅåÁ©∫„Åß„ÅôÔºâ"),Re(!1)}).catch(q=>{R.error("[Èï∑Êñá] Error loading passages:",q),x("„Éë„ÉÉ„Çª„Éº„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+q.message),Re(!1)})},[y]);const Te=$.useMemo(()=>o.find(re=>re.id===a),[o,a]),ut=$.useMemo(()=>{const re=f==="all"?o:o.filter(q=>q.level===f),de={ÂàùÁ¥ö:1,beginner:1,‰∏≠Á¥ö:2,intermediate:2,‰∏äÁ¥ö:3,advanced:3,Advanced:3};return re.sort((q,Z)=>{const Ce=de[q.level||""]||999,_e=de[Z.level||""]||999;if(Ce!==_e)return Ce-_e;const De=q.actualWordCount||0,Ie=Z.actualWordCount||0;return De-Ie})},[o,f]),ft=$.useCallback(re=>{var q,Z;c(re);const de=o.find(Ce=>Ce.id===re);de&&(d(new Array(((q=de.phrases)==null?void 0:q.length)||0).fill(!1)),p(new Array(((Z=de.phrases)==null?void 0:Z.length)||0).fill(!1)),A(0))},[o]);$.useCallback((re,de)=>{if(de.preventDefault(),de.stopPropagation(),!Te||!yn())return;const Z=Te.phrases[re].segments.filter(_e=>_e.word&&_e.word.trim()!=="").map(_e=>_e.word).join(" ");Ts(Z,{rate:.85});const Ce=de.currentTarget;Ce.classList.add("speaking"),setTimeout(()=>{Ce.classList.remove("speaking")},600)},[Te]);const wt=(re,de)=>{if(de.preventDefault(),de.stopPropagation(),S&&S.word===re){N(null);return}const q=re.toLowerCase().replace(/[.,!?;:"']/g,"").trim(),Ce=(De=>{if(y.has(De))return De;if(De.endsWith("es")&&y.has(De.slice(0,-2)))return De.slice(0,-2);if(De.endsWith("s")&&y.has(De.slice(0,-1)))return De.slice(0,-1);if(De.endsWith("ed")){const Ie=De.slice(0,-2);if(y.has(Ie))return Ie;if(y.has(Ie+"e"))return Ie+"e";if(Ie.length>2&&Ie[Ie.length-1]===Ie[Ie.length-2]){const Dt=Ie.slice(0,-1);if(y.has(Dt))return Dt}}if(De.endsWith("ing")){const Ie=De.slice(0,-3);if(y.has(Ie))return Ie;if(y.has(Ie+"e"))return Ie+"e";if(Ie.length>2&&Ie[Ie.length-1]===Ie[Ie.length-2]){const Dt=Ie.slice(0,-1);if(y.has(Dt))return Dt}}return De.endsWith("ly")&&y.has(De.slice(0,-2))||De.endsWith("er")&&y.has(De.slice(0,-2))?De.slice(0,-2):De.endsWith("est")&&y.has(De.slice(0,-3))?De.slice(0,-3):null})(q),_e=Ce?y.get(Ce):null;if(_e){const De=de.currentTarget.getBoundingClientRect();N({word:_e.word,meaning:_e.meaning,reading:_e.reading,etymology:_e.etymology,relatedWords:_e.relatedWords,x:De.left+window.scrollX,y:De.bottom+window.scrollY+5})}else{const De=v.get(Ce||q);if(De){const Ie=de.currentTarget.getBoundingClientRect();N({word:De.word,meaning:De.meaning,reading:De.reading||"",etymology:De.etymology||"",relatedWords:De.relatedWords||"",x:Ie.left+window.scrollX,y:Ie.bottom+window.scrollY+5})}else R.warn(`Word not found in dictionary: ${q}`)}},vt=()=>{if(!Te)return;const re=[];if(Te.phrases.forEach(de=>{de.segments.forEach(q=>{q.isUnknown&&q.word.trim()!==""&&(re.some(Z=>Z.word.toLowerCase()===q.word.toLowerCase())||re.push({word:q.word,meaning:q.meaning,reading:q.reading||"",etymology:q.etymology||"",relatedWords:q.relatedWords||"",relatedFields:q.relatedFields||"",difficulty:q.difficulty||"intermediate"}))})}),re.length===0){alert(`ÂàÜ„Åã„Çâ„Å™„ÅÑÂçòË™û„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
ÂçòË™û„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Éû„Éº„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);return}n&&n(re),i(de=>de.map(q=>q.id===Te.id?{...q,phrases:q.phrases.map(Z=>({...Z,segments:Z.segments.map(Ce=>({...Ce,isUnknown:!1}))}))}:q)),alert(`${re.length}ÂÄã„ÅÆÂçòË™û„Çí„Äå${Te.title}„Äç„Åã„Çâ‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ`)},Nt=()=>{Te&&(i(re=>re.map(de=>de.id===Te.id?{...de,phrases:de.phrases.map(q=>({...q,segments:q.segments.map(Z=>({...Z,isUnknown:!1}))}))}:de)),d(new Array(Te.phrases.length).fill(!1)),p(new Array(Te.phrases.length).fill(!1)))};if(g)return u.jsx("div",{className:"error-message",children:g});if(Le)return u.jsx("div",{className:"empty-container",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."});if(o.length===0)return u.jsx("div",{className:"empty-container",children:"„Éë„ÉÉ„Çª„Éº„Ç∏„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"});if(ut.length===0)return u.jsxs("div",{className:"comprehensive-reading-view",children:[u.jsx("div",{className:"reading-header",children:u.jsxs("div",{className:"filter-controls",children:[u.jsx("label",{htmlFor:"difficulty-filter",children:"Èõ£ÊòìÂ∫¶: "}),u.jsxs("select",{id:"difficulty-filter",value:f,onChange:re=>m(re.target.value),title:"Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]})}),u.jsx("div",{className:"empty-container",children:"ÈÅ∏Êäû„Åó„ÅüÈõ£ÊòìÂ∫¶„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂà•„ÅÆÈõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]});const mt=((dt=Te==null?void 0:Te.phrases)==null?void 0:dt.reduce((re,de)=>re+de.segments.filter(q=>q.isUnknown).length,0))||0;return u.jsxs("div",{className:"comprehensive-reading-view",children:[!I&&C&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-filter",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-filter",value:f,onChange:re=>m(re.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"passage-select",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏:"}),u.jsx("select",{id:"passage-select",value:a||"",onChange:re=>ft(re.target.value),className:"select-input",children:ut.map(re=>u.jsxs("option",{value:re.id,children:[Fy(re.level||"beginner"),"_",re.actualWordCount,"Ë™û_",re.title]},re.id))})]})]}),I&&u.jsxs("div",{className:"reading-sub-tabs grid grid-cols-6 gap-1 sm:gap-2",children:[u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${_==="reading"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>D("reading"),children:"üìñ Ë™≠Ëß£"}),u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${_==="fullText"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>D("fullText"),children:"üìÑ ÂÖ®Êñá"}),u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${_==="fullTranslation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>D("fullTranslation"),children:"üìù ÂÖ®Ë®≥"}),u.jsxs("button",{onClick:vt,className:"px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium bg-success text-white rounded-t-lg border-b-2 border-success transition-all duration-200 hover:bg-success-hover disabled:opacity-50 disabled:cursor-not-allowed:bg-success-hover",disabled:mt===0,title:"Êú™Áü•Ë™û„Çí‰øùÂ≠ò",children:["üíæ ‰øùÂ≠ò (",mt,")"]}),u.jsx("button",{onClick:Nt,className:"px-4 py-2 text-sm font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md:bg-warning-hover",title:"„É™„Çª„ÉÉ„Éà",children:"üîÑ „É™„Çª„ÉÉ„Éà"}),u.jsx("button",{className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",onClick:()=>k(!C),title:"Â≠¶ÁøíË®≠ÂÆö„ÇíÈñã„Åè",children:"‚öôÔ∏è Â≠¶ÁøíË®≠ÂÆö"})]}),I&&C&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-filter-reading",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-filter-reading",value:f,onChange:re=>m(re.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"passage-select-reading",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏:"}),u.jsx("select",{id:"passage-select-reading",value:a||"",onChange:re=>ft(re.target.value),className:"select-input",children:ut.map(re=>u.jsxs("option",{value:re.id,children:[Fy(re.level||"beginner"),"_",re.actualWordCount,"Ë™û_",re.title]},re.id))})]})]}),S&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"word-popup-overlay",onClick:()=>N(null)}),u.jsxs("div",{className:"word-popup","data-popup-x":S.x,"data-popup-y":S.y,children:[u.jsx("button",{className:"popup-close",onClick:()=>N(null),title:"Èñâ„Åò„Çã",children:"‚úï"}),u.jsx("div",{className:"popup-word",children:S.word}),S.reading&&u.jsx("div",{className:"popup-reading",children:S.reading}),u.jsx("div",{className:"popup-meaning",children:S.meaning}),S.etymology&&u.jsxs("div",{className:"popup-etymology",children:[u.jsx("strong",{children:"Ë™ûÊ∫ê:"})," ",S.etymology]}),S.relatedWords&&u.jsxs("div",{className:"popup-related",children:[u.jsx("strong",{children:"Èñ¢ÈÄ£Ë™û:"})," ",S.relatedWords]})]})]}),I&&Te&&Te.phrases&&Te.phrases.length>0&&u.jsxs("div",{className:"passage-content",children:[u.jsx("h3",{className:"passage-title",children:Te.title}),_==="reading"&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"reading-full-text-area",children:[u.jsx("h4",{className:"text-lg font-semibold mb-3",children:"üìñ ÂÖ®Êñá"}),u.jsx("div",{className:"full-text-content",children:(()=>{if(Te.originalText){const de=Te.originalText.split(/([.!?])\s+/).filter(Z=>Z.trim()),q=[];for(let Z=0;Z<de.length;Z+=2){const Ce=de[Z],_e=de[Z+1]||"";q.push((Ce+_e).trim())}return u.jsx("div",{className:"sentences-container",children:q.map((Z,Ce)=>u.jsxs("span",{className:`sentence-clickable ${H===Ce?"selected-reading":""}`,onClick:()=>{J(Ce);const _e=Yl(Z);fe({text:Z,grammarAnalysis:_e,showMeanings:!1})},children:[Z," "]},Ce))})}if(Te.title.toLowerCase().includes("conversation")){const de=[];return Te.phrases.forEach(q=>{let Z=q.segments.map(Ce=>Ce.word).join(" ").trim();!Z||Z==="-"||(Z=Z.replace(/\s+([.,!?;:"])/g,"$1"),de.push(Z))}),u.jsx("div",{className:"sentences-container",children:de.map((q,Z)=>u.jsxs("span",{className:`sentence-clickable ${H===Z?"selected-reading":""}`,onClick:()=>{J(Z);const Ce=Yl(q);fe({text:q,grammarAnalysis:Ce,showMeanings:!1})},children:[q," "]},Z))})}else{let de="",q=!0;Te.phrases.forEach(_e=>{_e.segments.forEach(De=>{let Ie=De.word.trim();Ie&&Ie!=="-"&&(/^[.,!?;:]$/.test(Ie)?(de+=Ie,q=/^[.!?]$/.test(Ie)):(Ie==='"'||Ie==="'"||(q&&Ie.length>0&&(Ie=Ie.charAt(0).toUpperCase()+Ie.slice(1),q=!1),de.length>0&&!de.endsWith(" ")&&!de.endsWith('"')&&!de.endsWith("'")&&(de+=" ")),de+=Ie))})}),de=de.replace(/\s+"/g,'"').replace(/\s+'/g,"'");const Z=de.split(/([.!?])\s+/).filter(_e=>_e.trim()),Ce=[];for(let _e=0;_e<Z.length;_e+=2){const De=Z[_e],Ie=Z[_e+1]||"";Ce.push((De+Ie).trim())}return u.jsx("div",{className:"sentences-container",children:Ce.map((_e,De)=>u.jsxs("span",{className:`sentence-clickable ${H===De?"selected-reading":""}`,onClick:()=>{J(De);const Ie=Yl(_e);fe({text:_e,grammarAnalysis:Ie,showMeanings:!1})},children:[_e," "]},De))})}})()})]}),H!==null&&X&&u.jsxs("div",{className:"selected-sentence-analysis mt-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h4",{className:"m-0 text-lg font-semibold",children:"üìù ÈÅ∏Êäû„Åó„ÅüÊñá„ÅÆË™≠Ëß£"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"px-3 py-1 text-sm bg-primary text-white rounded hover:bg-primary-hover",onClick:()=>Ts(X.text),title:"„Åì„ÅÆÊñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-3 py-1 text-sm bg-info text-white rounded hover:bg-info-hover",onClick:()=>fe({...X,showMeanings:!X.showMeanings}),children:X.showMeanings?"ÊÑèÂë≥„ÇíÈö†„Åô":"ÊÑèÂë≥„ÇíË°®Á§∫"})]})]}),u.jsx("div",{className:"selected-sentence-text mb-4",children:X.text}),u.jsxs("div",{className:"grammar-structure mb-4",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("h5",{className:"text-sm font-semibold m-0",children:"üî§ ÊñáÊ≥ïÊßãÈÄ†:"}),u.jsx("button",{className:"px-2 py-1 text-xs bg-gray-200 rounded hover:bg-gray-300:bg-gray-600",onClick:()=>oe(!be),children:be?"Âá°‰æã„ÇíÈö†„Åô":"Âá°‰æã„ÇíË°®Á§∫"})]}),be&&u.jsxs("div",{className:"grammar-legend mb-3 p-3 bg-gray-50 rounded",children:[u.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center mb-2",children:[u.jsx("h6",{className:"text-xs font-semibold m-0",children:"üìñ ÊñáÊ≥ï„Çø„Ç∞‰∏ÄË¶ß"}),u.jsx("button",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200:bg-blue-800",onClick:()=>$e(!xe),children:xe?"Á∞°ÊòìË°®Á§∫":"üìö „Åï„Çâ„Å´Ë©≥„Åó„Åè"})]}),xe?u.jsxs("div",{className:"detailed-grammar-explanation text-xs space-y-3 break-words",children:[u.jsxs("div",{className:"explanation-section",children:[u.jsx("h6",{className:"font-semibold text-sm mb-2",children:"üéØ Êñá„ÅÆÈ™®Ê†º (ÂøÖÈ†àË¶ÅÁ¥†)"}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"S",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"S",children:"[S]"})}),u.jsx("strong",{children:"‰∏ªË™û (Subject)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"„ÄåË™∞„Åå„Äç„Äå‰Ωï„Åå„Äç"}),"„ÇíË°®„Åô„ÄÇÊñá„ÅÆ‰∏ªÂΩπ„ÄÇ",u.jsx("br",{}),"‰æã: ",u.jsx("em",{children:"I"})," study English. / ",u.jsx("em",{children:"The cat"})," is cute."]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"V",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"V",children:"[V]"})}),u.jsx("strong",{children:"ÂãïË©û (Verb)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"„Äå„Äú„Åô„Çã„Äç„Äå„Äú„Åß„ÅÇ„Çã„Äç"}),"„ÇíË°®„Åô„ÄÇ‰∏ªË™û„ÅÆÂãï‰Ωú„ÇÑÁä∂ÊÖã„ÄÇ",u.jsx("br",{}),"‰æã: I ",u.jsx("em",{children:"study"})," English. / The cat ",u.jsx("em",{children:"is"})," cute."]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"O",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"O",children:"[O]"})}),u.jsx("strong",{children:"ÁõÆÁöÑË™û (Object)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"„Äå‰Ωï„Çí„Äç„ÄåË™∞„Çí„Äç"}),"„ÇíË°®„Åô„ÄÇÂãïË©û„ÅÆÂØæË±°„ÄÇ",u.jsx("br",{}),"‰æã: I study ",u.jsx("em",{children:"English"}),". / I like ",u.jsx("em",{children:"cats"}),"."]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"C",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"C",children:"[C]"})}),u.jsx("strong",{children:"Ë£úË™û (Complement)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"„Äå„Å©„ÅÜ„Åß„ÅÇ„Çã„Äç„Äå‰Ωï„Åß„ÅÇ„Çã„Äç"}),"„ÇíË°®„Åô„ÄÇ‰∏ªË™û„ÇÑÁõÆÁöÑË™û„ÅÆÁä∂ÊÖã„ÉªÊÄßË≥™„ÄÇ",u.jsx("br",{}),"‰æã: The cat is ",u.jsx("em",{children:"cute"}),". / I am ",u.jsx("em",{children:"a student"}),"."]})]})]}),u.jsxs("div",{className:"explanation-section",children:[u.jsx("h6",{className:"font-semibold text-sm mb-2",children:"‚ú® Êñá„ÇíË©≥„Åó„Åè„Åô„ÇãË¶ÅÁ¥†"}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"M",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"M",children:"[M]"})}),u.jsx("strong",{children:"‰øÆÈ£æË™û (Modifier)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"„Äå„Å©„Çì„Å™„Äç„Äå„Å©„ÅÆ„Çà„ÅÜ„Å´„Äç„Äå„ÅÑ„Å§„Äç„Äå„Å©„Åì„Åß„Äç"}),"„ÇíË°®„Åô„ÄÇÊñá„ÇíË±ä„Åã„Å´„Åô„Çã„ÄÇ",u.jsx("br",{}),"‰æã: I wake up at ",u.jsx("em",{children:"seven"}),". / I read a ",u.jsx("em",{children:"good"})," book."]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Adj",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Adj",children:"[Adj]"})}),u.jsx("strong",{children:"ÂΩ¢ÂÆπË©û (Adjective)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"ÂêçË©û„ÇíË©≥„Åó„ÅèË™¨Êòé"}),"„Åô„ÇãË™û„ÄÇ",u.jsx("br",{}),"‰æã: a ",u.jsx("em",{children:"beautiful"})," flower / ",u.jsx("em",{children:"happy"})," students"]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Adv",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Adv",children:"[Adv]"})}),u.jsx("strong",{children:"ÂâØË©û (Adverb)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"ÂãïË©û„ÉªÂΩ¢ÂÆπË©û„ÉªÂâØË©û„ÇíË©≥„Åó„ÅèË™¨Êòé"}),"„Åô„ÇãË™û„ÄÇ",u.jsx("br",{}),"‰æã: run ",u.jsx("em",{children:"quickly"})," / ",u.jsx("em",{children:"very"})," happy / ",u.jsx("em",{children:"always"})," ","study"]})]})]}),u.jsxs("div",{className:"explanation-section",children:[u.jsx("h6",{className:"font-semibold text-sm mb-2",children:"üîó „Å§„Å™„Åê„ÉªÈôêÂÆö„Åô„ÇãË¶ÅÁ¥†"}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Prep",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Prep",children:"[Prep]"})}),u.jsx("strong",{children:"ÂâçÁΩÆË©û (Preposition)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"ÂêçË©û„ÅÆÂâç„Å´ÁΩÆ„ÅÑ„Å¶Â†¥ÊâÄ„ÉªÊôÇÈñì„ÉªÊñπÊ≥ï"}),"„Å™„Å©„ÇíÁ§∫„Åô„ÄÇ",u.jsx("br",{}),"‰æã: ",u.jsx("em",{children:"at"})," school / ",u.jsx("em",{children:"in"})," the morning / ",u.jsx("em",{children:"with"})," ","friends"]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Conj",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Conj",children:"[Conj]"})}),u.jsx("strong",{children:"Êé•Á∂öË©û (Conjunction)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"Ë™û„ÉªÂè•„ÉªÊñá„Çí„Å§„Å™„Åê"}),"Ë™û„ÄÇ",u.jsx("br",{}),"‰æã: I ",u.jsx("em",{children:"and"})," you / study ",u.jsx("em",{children:"but"})," tired /"," ",u.jsx("em",{children:"because"})," I like it"]})]}),u.jsxs("div",{className:"explanation-item mb-2",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Det",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Det",children:"[Det]"})}),u.jsx("strong",{children:"ÈôêÂÆöË©û (Determiner)"})]}),u.jsxs("p",{className:"ml-6 text-gray-600",children:[u.jsx("strong",{children:"ÂêçË©û„ÅÆÁØÑÂõ≤„ÉªÊï∞Èáè„ÇíÈôêÂÆö"}),"„Åô„ÇãË™û„ÄÇÂÜ†Ë©û„ÉªÊåáÁ§∫Ë©û„ÉªÊï∞ÈáèË©û„Å™„Å©„ÄÇ",u.jsx("br",{}),"‰æã: ",u.jsx("em",{children:"the"})," book / ",u.jsx("em",{children:"my"})," cat / ",u.jsx("em",{children:"every"})," day /"," ",u.jsx("em",{children:"some"})," water"]})]})]})]}):u.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"S",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"S",children:"[S]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"‰∏ªË™û (Subject)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"V",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"V",children:"[V]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"ÂãïË©û (Verb)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"O",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"O",children:"[O]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"ÁõÆÁöÑË™û (Object)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"C",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"C",children:"[C]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"Ë£úË™û (Complement)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"M",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"M",children:"[M]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"‰øÆÈ£æË™û (Modifier)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Prep",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Prep",children:"[Prep]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"ÂâçÁΩÆË©û (Preposition)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Conj",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Conj",children:"[Conj]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"Êé•Á∂öË©û (Conjunction)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Det",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Det",children:"[Det]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"ÈôêÂÆöË©û (Determiner)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Adj",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Adj",children:"[Adj]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"ÂΩ¢ÂÆπË©û (Adjective)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Adv",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Adv",children:"[Adv]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"ÂâØË©û (Adverb)"})]}),u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"grammar-tag","data-tag":"Unknown",children:u.jsx("span",{className:"grammar-tag-label","data-tag":"Unknown",children:"[?]"})}),u.jsx("span",{className:"flex-1 min-w-0 break-words",children:"„Åù„ÅÆ‰ªñ"})]})]})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:X.grammarAnalysis.filter(re=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(re.word)).map((re,de)=>u.jsxs("div",{className:"grammar-tag","data-tag":re.tag,title:re.description,children:[u.jsx("span",{className:"font-semibold",children:re.word}),u.jsxs("span",{className:"ml-1 text-xs grammar-tag-label","data-tag":re.tag,children:["[",re.tag,"]"]})]},de))}),X.grammarAnalysis.some(re=>/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(re.word))&&u.jsxs("div",{className:"mt-3",children:[u.jsx("h6",{className:"text-xs font-semibold mb-2 text-gray-600",children:"üìå Ë®òÂè∑„ÅÆÊÑèÂë≥:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:X.grammarAnalysis.filter(re=>/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(re.word)).map((re,de)=>u.jsxs("div",{className:"punctuation-card",title:re.description,children:[u.jsx("span",{className:"font-bold text-lg",children:re.word}),u.jsx("span",{className:"ml-2 text-xs text-gray-600",children:re.description})]},de))})]})]}),(()=>{const re=X.grammarAnalysis.map(q=>q.word),de=eY(re);return de.length===0?null:u.jsxs("div",{className:"phrasal-expressions-section mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üîó ÁÜüË™û:"}),u.jsx("div",{className:"space-y-2",children:de.map((q,Z)=>u.jsxs("div",{className:"phrasal-expression-card",children:[u.jsx("div",{className:"phrasal-expression-words",children:q.words.map((Ce,_e)=>{const De=Ye(Ce,void 0);return u.jsxs("div",{className:"phrasal-word-item",children:[u.jsx("div",{className:"phrasal-word",children:Ce}),u.jsx("div",{className:"phrasal-word-meaning",children:De||"-"})]},_e)})}),u.jsxs("div",{className:"phrasal-expression-divider",children:[u.jsx("div",{className:"phrasal-divider-line"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("div",{className:"phrasal-type-label",children:"ÁÜüË™û"}),t&&s&&r&&u.jsx(ta,{word:{word:q.words.join(" "),meaning:q.meaning,source:"reading",sourceDetail:Te==null?void 0:Te.title},sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:"small"})]})]}),u.jsx("div",{className:"phrasal-expression-meaning",children:q.meaning})]},Z))})]})})(),(()=>{const re=nY(X.text);return re.length===0?null:u.jsxs("div",{className:"grammar-patterns-section mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üìê ÈáçË¶ÅÊßãÊñá:"}),u.jsx("div",{className:"space-y-2",children:re.map((de,q)=>u.jsxs("div",{className:"grammar-pattern-card",children:[u.jsxs("div",{className:"pattern-header",children:[u.jsx("div",{className:"pattern-name",children:de.name}),u.jsx("div",{className:"pattern-meaning",children:de.meaning})]}),u.jsx("div",{className:"pattern-sentence",children:X.text}),u.jsxs("div",{className:"pattern-explanation",children:["üí° ",de.explanation]})]},q))})]})})(),X.showMeanings&&u.jsxs("div",{className:"word-cards-container",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üìö ÂçòË™û„ÅÆÊÑèÂë≥:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:X.grammarAnalysis.filter(re=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(re.word)).map((re,de)=>{const q=Ye(re.word,void 0);return u.jsxs("div",{className:"word-card",onDoubleClick:Z=>wt(re.word,Z),title:"„ÉÄ„Éñ„É´„Çø„ÉÉ„Éó: Ë©≥Á¥∞Ë°®Á§∫",children:[u.jsx("div",{className:"word-card-word",children:re.word}),q&&q!=="-"&&u.jsx("div",{className:"word-card-meaning text-xs",children:q})]},de)})})]})]})]}),_==="fullText"&&u.jsxs("div",{className:"full-text-display",children:[u.jsx("h3",{children:"üìÑ ÂÖ®Êñá"}),u.jsxs("div",{className:"full-text-controls",children:[u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-primary text-white border-2 border-primary rounded-lg transition-all duration-200 hover:bg-primary-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-primary-hover",onClick:()=>{const re=Te.phrases.map(de=>de.segments.map(Z=>Z.word).join(" ").replace(/^[A-Z][a-z]*(?:\s+\d+)?:\s*/,"").replace(/"/g,"")).join(" ").replace(/\s+([.,!?;:])/g,"$1");Ts(re),O(!0),L(!1)},disabled:F&&!V,title:"ÂÖ®Êñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-warning-hover",onClick:()=>{V?(JX(),L(!1)):(YX(),L(!0))},disabled:!F,title:V?"Áô∫Èü≥„ÇíÂÜçÈñã":"Áô∫Èü≥„Çí‰∏ÄÊôÇÂÅúÊ≠¢",children:V?"‚ñ∂Ô∏è ÂÜçÈñã":"‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢"}),u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-error text-white border-2 border-error rounded-lg transition-all duration-200 hover:bg-error-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-error-hover",onClick:()=>{XX(),O(!1),L(!1)},disabled:!F,title:"Áô∫Èü≥„ÇíÂÅúÊ≠¢",children:"‚èπÔ∏è ÂÅúÊ≠¢"})]}),u.jsx("div",{className:"full-text-content",children:(()=>{if(Te.originalText)return u.jsx("div",{className:"paragraph-en",children:Te.originalText});if(Te.title.toLowerCase().includes("conversation")){const de=[];return Te.phrases.forEach(q=>{let Z=q.segments.map(Ce=>Ce.word).join(" ").trim();!Z||Z==="-"||(Z=Z.replace(/\s+([.,!?;:"])/g,"$1"),de.push(Z))}),u.jsx("div",{children:de.map((q,Z)=>u.jsx("p",{className:"paragraph-en conversation-line",children:q},Z))})}else{const q=Te.phrases[0].segments.map(te=>te.word).join(" ").trim(),Z=q.length<100&&!/[.!?]$/.test(q);let Ce="",_e=!0;Te.phrases.forEach((te,Q)=>{Q===0&&Z||te.segments.forEach(ce=>{let le=ce.word.trim();le&&le!=="-"&&(/^[.,!?;:]$/.test(le)?(Ce+=le,_e=/^[.!?]$/.test(le)):(le==='"'||le==="'"||(_e&&le.length>0&&(le=le.charAt(0).toUpperCase()+le.slice(1),_e=!1),Ce.length>0&&!Ce.endsWith(" ")&&!Ce.endsWith('"')&&!Ce.endsWith("'")&&(Ce+=" ")),Ce+=le))})}),Ce=Ce.replace(/\s+"/g,'"').replace(/\s+'/g,"'");const De=Ce.split(/([.!?])\s+/).filter(te=>te.trim()),Ie=[];for(let te=0;te<De.length;te+=2){const Q=De[te],ce=De[te+1]||"";Ie.push((Q+ce).trim())}const Dt=[];let j=[],z=0;const U=60;Ie.forEach((te,Q)=>{const ce=te.split(/\s+/).length;j.push(te),z+=ce,(z>=U||Q===Ie.length-1)&&(Dt.push(j.join(" ")),j=[],z=0)}),j.length>0&&Dt.push(j.join(" "));const M=Ie,ie=te=>{J(te);const Q=M[te],ce=Yl(Q);fe({text:Q,grammarAnalysis:ce,showMeanings:!1})};return u.jsxs("div",{children:[u.jsx("div",{className:"sentences-container",children:M.map((te,Q)=>u.jsxs("span",{className:`sentence-clickable ${H===Q?"selected":""}`,onClick:()=>ie(Q),children:[te," "]},Q))}),H!==null&&X&&u.jsxs("div",{className:"selected-sentence-analysis",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h4",{className:"m-0",children:"üìñ ÈÅ∏Êäû„Åó„ÅüÊñá„ÅÆË™≠Ëß£"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"px-3 py-1 text-sm bg-primary text-white rounded hover:bg-primary-hover",onClick:()=>Ts(X.text),title:"„Åì„ÅÆÊñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-3 py-1 text-sm bg-info text-white rounded hover:bg-info-hover",onClick:()=>fe({...X,showMeanings:!X.showMeanings}),children:X.showMeanings?"ÊÑèÂë≥„ÇíÈö†„Åô":"ÊÑèÂë≥„ÇíË°®Á§∫"})]})]}),u.jsx("div",{className:"selected-sentence-text",children:X.text}),u.jsxs("div",{className:"grammar-structure mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üî§ ÊñáÊ≥ïÊßãÈÄ†:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:X.grammarAnalysis.map((te,Q)=>u.jsxs("div",{className:"grammar-tag","data-tag":te.tag,title:te.description,children:[u.jsx("span",{className:"font-semibold",children:te.word}),u.jsxs("span",{className:"ml-1 text-xs grammar-tag-label","data-tag":te.tag,children:["[",te.tag,"]"]})]},Q))})]}),X.showMeanings&&u.jsxs("div",{className:"word-cards-container mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üìö ÂçòË™û„ÅÆÊÑèÂë≥:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:X.grammarAnalysis.filter(te=>!/^[.,!?;:]$/.test(te.word)).map((te,Q)=>{const ce=Ye(te.word,void 0);return u.jsxs("div",{className:"word-card",onDoubleClick:le=>wt(te.word,le),title:"„ÉÄ„Éñ„É´„Çø„ÉÉ„Éó: Ë©≥Á¥∞Ë°®Á§∫",children:[u.jsx("div",{className:"word-card-word",children:te.word}),ce&&ce!=="-"&&u.jsx("div",{className:"word-card-meaning text-xs",children:ce})]},Q)})})]})]})]})}})()})]}),_==="fullTranslation"&&u.jsx("div",{className:"full-translation-display",children:u.jsx("div",{className:"full-translation-content",children:(()=>{var de;if(console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.id:",Te.id),console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.translation exists:",!!Te.translation),console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.translation length:",((de=Te.translation)==null?void 0:de.length)||0),Te.translation){const q=Te.translation.split(/\n+/).map(Z=>Z.trim()).filter(Z=>Z.length>0);return u.jsx("div",{className:"full-translation-text",children:q.map((Z,Ce)=>u.jsx("p",{className:"paragraph-ja",children:Z},Ce))})}if(Te.title.toLowerCase().includes("conversation")){const q=[];return Te.phrases.forEach(Z=>{let Ce=Z.phraseMeaning||"";Ce=Ce.replace(/\[Ë¶Å‰øÆÊ≠£\]/g,"").trim(),!(!Ce||Ce==="-")&&q.push(Ce)}),q.map((Z,Ce)=>u.jsx("p",{className:"paragraph-ja conversation-line",children:Z},Ce))}else{const q=[];let Z="";Te.phrases.forEach(De=>{let Ie=De.phraseMeaning||"";if(Ie){if(Ie=Ie.replace(/\[Ë¶Å‰øÆÊ≠£\]/g,"").trim(),!Ie)return;const Dt=De.segments.map(z=>z.word).join(" ").trim(),j=/[.!?]$/.test(Dt);/[„ÄÇÔºÅÔºü]$/.test(Ie)?(Z+=Ie,j&&(q.push(Z.trim()),Z="")):j?(Z+=Ie+"„ÄÇ",q.push(Z.trim()),Z=""):Z+=Ie+"„ÄÅ"}}),Z.trim()&&q.push(Z.trim()+"„ÄÇ");const Ce=[],_e=4;for(let De=0;De<q.length;De+=_e){const Ie=q.slice(De,De+_e);Ce.push(Ie.join(""))}return Ce.map((De,Ie)=>u.jsx("p",{className:"paragraph-ja",children:De},Ie))}})()})})]}),u.jsx("style",{children:`
        .comprehensive-reading-view {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
          width: 100%;
        }

        @media (max-width: 768px) {
          .comprehensive-reading-view {
            max-width: 100%;
            margin: 0;
            padding: 8px;
          }
        }

        .reading-header {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-bottom: 20px;
        }

        .dark-mode .reading-header {
          background: var(--gray-800);
        }

        .reading-header h2 {
          margin: 0 0 20px 0;
        }

        .filter-controls, .passage-selector {
          margin-bottom: 15px;
        }

        .filter-controls label, .passage-selector label {
          font-weight: bold;
          margin-right: 10px;
          color: #333;
        }

        .dark-mode .filter-controls label,
        .dark-mode .passage-selector label {
          color: var(--gray-200);
        }

        .filter-controls select, .passage-selector select {
          padding: 8px 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
          background: white;
          color: #333;
        }

        .dark-mode .filter-controls select,
        .dark-mode .passage-selector select {
          background: var(--gray-700);
          border-color: var(--gray-600);
          color: var(--gray-200);
        }

        .passage-stats {
          display: flex;
          gap: 10px;
          margin: 15px 0;
          flex-wrap: wrap;
        }

        .stat-badge {
          display: inline-block;
          padding: 6px 12px;
          background: #f0f0f0;
          border-radius: 4px;
          font-size: 14px;
          color: #333;
        }

        .dark-mode .stat-badge {
          background: var(--gray-700);
          color: var(--gray-200);
        }

        .stat-badge.unknown-count {
          background: #fff3cd;
          color: #856404;
          font-weight: bold;
        }

        .dark-mode .stat-badge.unknown-count {
          background: var(--yellow-500);
          color: var(--black);
        }

        .action-buttons {
          display: flex;
          gap: 10px;
          margin-top: 15px;
        }

        .action-buttons button {
          padding: 10px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: bold;
          transition: all 0.3s;
        }

        .btn-primary {
          background: #007bff;
          color: white;
        }

        .btn-primary:hover {
          background: #0056b3;
        }

        .btn-info {
          background: #17a2b8;
          color: white;
        }

        .btn-info:hover {
          background: #138496;
        }

        .btn-success {
          background: #28a745;
          color: white;
        }

        .btn-success:hover {
          background: #218838;
        }

        .btn-success:disabled {
          background: #ccc;
          cursor: not-allowed;
        }

        .btn-secondary {
          background: #6c757d;
          color: white;
        }

        .btn-secondary:hover {
          background: #545b62;
        }

        .passage-content {
          background: white;
          padding: 30px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dark-mode .passage-content {
          background: var(--gray-800);
          color: var(--gray-100);
        }

        .passage-title {
          text-align: center;
          color: #333;
          margin-bottom: 30px;
          font-size: 24px;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .passage-title {
          color: var(--white);
        }

        .passage-body {
          line-height: 1.5;
          font-family: 'Times New Roman', Georgia, serif;
          color: #333;
        }

        .dark-mode .passage-body {
          color: var(--gray-200);
        }

        .phrase-block {
          margin-bottom: 8px;
          padding: 8px 12px;
          background: #ffffff;
          border-left: 3px solid #007bff;
          border-radius: 2px;
        }

        .dark-mode .phrase-block {
          background: var(--gray-700);
          border-left-color: var(--blue-400);
        }

        .phrase-english {
          font-size: 16px;
          line-height: 1.6;
          margin-bottom: 6px;
          font-family: 'Times New Roman', 'Georgia', serif;
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          align-items: flex-start;
        }

        .word-card {
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          padding: 2px 5px;
          margin: 1px;
          background: #f8f9fa;
          border: 1px solid #dee2e6;
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s;
          min-width: 60px;
        }

        .dark-mode .word-card {
          background: var(--gray-700);
          border-color: var(--gray-600);
        }

        .word-card:hover {
          background: #e7f3ff;
          border-color: #007bff;
        }

        .dark-mode .word-card:hover {
          background: var(--gray-600);
          border-color: var(--blue-400);
        }

        .word-card.unknown {
          background: #ffc107;
          color: #000;
          border-color: #ff9800;
          font-weight: bold;
        }

        .word-card.phrase-card {
          background: #e8f5e9;
          border-color: #4caf50;
        }

        .dark-mode .word-card.phrase-card {
          background: var(--gray-700);
          border-color: var(--green-400);
        }

        .word-card.phrase-card:hover {
          background: #c8e6c9;
        }

        .dark-mode .word-card.phrase-card:hover {
          background: var(--gray-600);
        }

        .word-card.punctuation-card {
          min-width: 20px;
          background: transparent;
          border: none;
          cursor: default;
          padding: 2px 4px;
        }

        .word-card.punctuation-card:hover {
          background: transparent;
          border: none;
        }

        .word-card-word {
          font-size: 16px;
          font-weight: 500;
          color: #333;
          text-align: center;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .word-card-word {
          color: var(--gray-200);
        }

        .phrase-card .word-card-word {
          font-size: 15px;
          color: #2e7d32;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .phrase-card .word-card-word {
          color: var(--green-400);
        }

        .word-card-meaning {
          font-size: 12px;
          color: #666;
          margin-top: 1px;
          text-align: center;
          padding: 1px 3px;
          background: rgba(255, 255, 255, 0.8);
          border-radius: 2px;
          min-height: 14px;
        }

        .dark-mode .word-card-meaning {
          color: var(--gray-300);
          background: rgba(48, 48, 48, 0.8);
        }

        .word-segment {
          display: inline-block;
          padding: 2px 4px;
          margin: 0 2px;
          cursor: pointer;
          border-radius: 3px;
          transition: all 0.2s;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .word-segment:hover {
          background: #e7f3ff;
        }

        .word-segment.unknown {
          background: #ffc107;
          color: #000;
          font-weight: bold;
        }

        .show-translation-btn {
          background: #f8f9fa;
          border: 1px solid #ddd;
          padding: 8px 16px;
          border-radius: 4px;
          cursor: pointer;
          color: #666;
          font-size: 14px;
        }

        .show-translation-btn:hover {
          background: #e9ecef;
        }

        .phrase-translation {
          margin-top: 10px;
          padding: 15px;
          background: white;
          border-radius: 4px;
          border: 1px solid #dee2e6;
        }

        .dark-mode .phrase-translation {
          background: var(--gray-800);
          border-color: var(--gray-600);
        }

        .translation-text {
          font-size: 16px;
          color: #333;
          margin-bottom: 10px;
          font-weight: 500;
        }

        .dark-mode .translation-text {
          color: var(--gray-200);
        }

        .word-meanings {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          font-size: 14px;
          color: #666;
        }

        .dark-mode .word-meanings {
          color: var(--gray-300);
        }

        .word-meaning-pair {
          background: #e7f3ff;
          padding: 4px 8px;
          border-radius: 3px;
        }

        .dark-mode .word-meaning-pair {
          background: var(--gray-700);
          color: var(--gray-200);
        }

        .error-message, .empty-container {
          text-align: center;
          padding: 50px;
          font-size: 18px;
          color: #666;
        }

        .dark-mode .error-message,
        .dark-mode .empty-container {
          color: var(--gray-300);
        }

        .error-message {
          color: #dc3545;
        }

        .dark-mode .error-message {
          color: var(--red-400);
        }

        /* ÂçòË™û„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Çπ„Çø„Ç§„É´ */
        .word-popup-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: transparent;
          z-index: 999;
        }

        .word-popup {
          position: absolute;
          left: var(--popup-x, 0);
          top: var(--popup-y, 0);
          background: white;
          border: 2px solid #007bff;
          border-radius: 8px;
          padding: 16px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          z-index: 1000;
          max-width: 400px;
          min-width: 250px;
        }

        .dark-mode .word-popup {
          background: var(--gray-800);
          border-color: var(--blue-400);
          color: var(--gray-200);
        }

        .popup-close {
          position: absolute;
          top: 8px;
          right: 8px;
          background: #f8f9fa;
          border: none;
          border-radius: 4px;
          width: 24px;
          height: 24px;
          cursor: pointer;
          font-size: 16px;
          line-height: 1;
          color: #666;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .popup-close:hover {
          background: #e9ecef;
          color: #000;
        }

        .popup-word {
          font-size: 20px;
          font-weight: bold;
          color: #007bff;
          margin-bottom: 4px;
          padding-right: 30px;
        }

        .popup-reading {
          font-size: 14px;
          color: #666;
          margin-bottom: 8px;
        }

        .popup-meaning {
          font-size: 16px;
          color: #333;
          margin-bottom: 12px;
          padding: 8px;
          background: #f0f8ff;
          border-radius: 4px;
        }

        .popup-etymology {
          font-size: 13px;
          color: #555;
          margin-bottom: 8px;
          padding: 6px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .popup-related {
          font-size: 13px;
          color: #555;
          padding: 6px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .popup-etymology strong,
        .popup-related strong {
          color: #007bff;
        }

        .full-text-display, .full-translation-display {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-top: 20px;
        }

        .dark-mode .full-text-display,
        .dark-mode .full-translation-display {
          background: var(--gray-800);
          color: var(--gray-100);
        }

        .full-text-display h3, .full-translation-display h3 {
          margin: 0 0 15px 0;
          color: #667eea;
        }

        .dark-mode .full-text-display h3,
        .dark-mode .full-translation-display h3 {
          color: var(--blue-400);
        }

        .full-text-content {
          font-size: 1.1em;
          line-height: 1.8;
          color: #333;
          font-family: 'Times New Roman', 'Georgia', serif;
        }

        .full-text-content .paragraph-en {
          margin-bottom: 1.5em;
          text-indent: 2em;
          text-align: left;
        }

        .full-text-content .paragraph-en:first-child {
          margin-top: 0;
        }

        /* ‰ºöË©±ÂΩ¢Âºè„ÅÆË°å„Çπ„Çø„Ç§„É´ */
        .full-text-content .conversation-line {
          text-indent: 0;
          margin-bottom: 1em;
          padding-left: 1em;
          border-left: 3px solid #667eea;
        }

        .full-translation-content {
          font-size: 1.05em;
          line-height: 2;
          color: #333;
        }

        .full-translation-text {
          white-space: pre-wrap;
          line-height: 2;
        }

        .full-translation-content .paragraph-ja {
          margin-bottom: 1.5em;
          text-indent: 1em;
          text-align: left;
        }

        .full-translation-content .paragraph-ja:first-child {
          margin-top: 0;
        }

        /* ‰ºöË©±ÂΩ¢Âºè„ÅÆÊó•Êú¨Ë™ûË®≥„Çπ„Çø„Ç§„É´ */
        .full-translation-content .conversation-line {
          text-indent: 0;
          margin-bottom: 1em;
          padding-left: 1em;
          border-left: 3px solid #667eea;
        }

        .translation-line {
          margin-bottom: 10px;
          padding: 8px;
          background: #f8f9fa;
          border-radius: 4px;
        }
      `})]})}const sY=Object.freeze(Object.defineProperty({__proto__:null,default:DI},Symbol.toStringTag,{value:"Module"}));function jI(n){var lt,Zt,_t,Ke;const[e,t]=$.useState(()=>localStorage.getItem("grammar-quiz-type")||"verb-form"),[s,r]=$.useState(()=>localStorage.getItem("grammar-grade")||"all"),[o,i]=$.useState([]),[a,c]=$.useState(!1),[l,d]=$.useState(!1),[h,p]=$.useState(!1),f=Dh(ja.GRAMMAR),{processQuestion:m}=Eh(),[g]=$.useState(()=>{const B=new jl;return localStorage.getItem("enable-ai-coordination")==="true"&&(B.enableAICoordination(!0),R.info("ü§ñ [GrammarQuizView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),B}),{reAddQuestion:x,clearExpiredFlags:y,updateRequeueStats:b,getRequeuedWords:v,checkPositionMismatch:w}=_l(),[S,N]=$.useState(Date.now()),[C,k]=$.useState(void 0),[I,T]=$.useState(void 0),[_,D]=$.useState(0),[P,A]=$.useState(0),{learningLimit:F,reviewLimit:O,setLearningLimit:V,setReviewLimit:L}=T0("grammar"),[H,J]=$.useState(!1),[X,fe]=$.useState(0),[be,oe]=$.useState(!1),xe=()=>{J(!H)},$e=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:B}=await gs(async()=>{const{resetAllProgress:pe}=await Promise.resolve().then(()=>Zo);return{resetAllProgress:pe}},void 0);await B(),Nt(!1),de([]),Z(0),_e(null),Ie([]),j([]),U(""),ie(!1),Q(!1),le(0),ve(0),ee({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),D(0),A(0),console.log("‚úÖ [ÊñáÊ≥ï„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(B){console.error("‚ùå [ÊñáÊ≥ï„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",B),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Le=()=>{p(!0)},Re=async(B,pe)=>{try{const Ae=Me=>Me.difficulty==="beginner"?.3:Me.difficulty==="intermediate"?.6:Me.difficulty==="advanced"?.9:.5,je=()=>{const Me=new Date().getHours();return Me<12?"morning":Me<18?"afternoon":Me<22?"evening":"night"};await m(B,pe?"correct":"incorrect",{currentDifficulty:Ae(ue),timeOfDay:je(),recentErrors:Je.incorrect,sessionLength:Math.floor((Date.now()-Ge.current)/6e4),consecutiveCorrect:_})}catch(Ae){console.error("[GrammarQuizView] Adaptive AI error:",Ae)}},[ze,Ye]=$.useState(()=>localStorage.getItem("autoNext-grammar")==="true"),[Te,ut]=$.useState(()=>{const B=localStorage.getItem("autoNextDelay-grammar");return B?parseInt(B,10):1500}),[ft,wt]=$.useState(()=>localStorage.getItem("autoReadAloud-grammar")==="true"),[vt,Nt]=$.useState(!1),[mt,dt]=$.useState(!1),[re,de]=$.useState([]),[q,Z]=$.useState(0),[Ce,_e]=$.useState(null),[De,Ie]=$.useState([]),[Dt,j]=$.useState([]),[z,U]=$.useState(""),[M,ie]=$.useState(!1),[te,Q]=$.useState(!1),[ce,le]=$.useState(0),[Pe,ve]=$.useState(0),[Je,ee]=$.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[ge,Se]=$.useState(null),ue=re[q],Ve=(ue==null?void 0:ue.type)==="sentenceOrdering"||e==="sentence-ordering",yt=ue!=null&&ue.id?(()=>{const B=ue.id.match(/^g(\d+)-u(\d+)/);if(B)return`g${B[1]}-unit${B[2]}`})():void 0,ot=$.useRef({quizType:e,grade:s}),Ge=$.useRef(Date.now()),Ut=$.useCallback(()=>{if(q<re.length-1){const B=q+1,pe=y(re,B-1);pe!==re&&de(pe),Z(B),_e(null),Ie([]),ie(!1),Q(!1),Ge.current=Date.now(),T(void 0)}},[q,re]),at=$.useCallback(async()=>{var B,pe;if(!mt){dt(!0),Se(null);try{let Ae=[],je=null;if(s==="all")Ae=["1","2","3"];else if(s.match(/^[123]$/))Ae=[s];else if(s.endsWith("-all"))Ae=[s.charAt(0)];else if(s.match(/^g\d+-unit\d+$/)){const Fe=(B=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:B[1],Ze=(pe=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:pe[2];Fe&&Ze!==void 0&&(Ae=[Fe],je=parseInt(Ze))}const Me=[];for(const Fe of Ae)for(let Ze=0;Ze<10;Ze++)if(!(je!==null&&Ze!==je))try{const $t=await fetch(`/data/grammar/grammar_grade${Fe}_unit${Ze}.json`);if($t.ok){const gn=await $t.json();if(gn.enabled===!1){R.log(`grammar_grade${Fe}_unit${Ze}.json is disabled: ${gn.disabledReason||"No reason provided"}`);continue}Me.push(gn)}else R.log(`grammar_grade${Fe}_unit${Ze}.json returned status ${$t.status}, skipping...`)}catch($t){R.log(`Failed to fetch grammar_grade${Fe}_unit${Ze}.json:`,$t)}if(Me.length===0)throw new Error(`ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºàÂ≠¶Âπ¥: ${s}, ÂΩ¢Âºè: ${e}Ôºâ`);const Ue=[];if(Me.forEach(Fe=>{const Ze=Fe.questions||[],$t={"verb-form":"verbForm","fill-in-blank":"fillInBlank","sentence-ordering":"sentenceOrdering"};if(e==="all"||e==="random")Ue.push(...Ze);else{const gn=$t[e]||e,xn=Ze.filter(kt=>kt.type===gn);Ue.push(...xn)}}),Ue.length===0)throw new Error("ÈÅ∏Êäû„Åï„Çå„ÅüÊù°‰ª∂„Å´Ë©≤ÂΩì„Åô„ÇãÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");if(R.log(`Total questions: ${Ue.length}`),Ue.length===0)throw new Error("ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");const Et=Fe=>{if(Fe.word)return Fe.word;if(Fe.id)return`grammar_${Fe.id}`;if(Fe.question)return`grammar_${Fe.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const Ze=Fe.japanese||Fe.sentence||"unknown";return`grammar_${String(Ze).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`},Ct=Ue.map(Fe=>({word:Et(Fe),meaning:Fe.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:Fe.difficulty||"beginner"})),tt=await g.schedule({questions:Ct,mode:"grammar",limits:{learningLimit:F,reviewLimit:O},sessionStats:{correct:Je.correct,incorrect:Je.incorrect,still_learning:Je.review||0,mastered:Je.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:H}),Ft=new Map(Ue.map(Fe=>[Et(Fe),Fe])),nt=tt.scheduledQuestions.map(Fe=>{const Ze=Ft.get(Fe.word);if(Ze)return{...Ze,word:Fe.word,position:Fe.position,finalPriority:Fe.finalPriority}}).filter(Fe=>Fe!==void 0);tt.vibrationScore>50&&R.warn("[GrammarQuizView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:tt.vibrationScore,processingTime:tt.processingTime}),R.log("[GrammarQuizView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:nt.length,vibrationScore:tt.vibrationScore}),de(nt),Z(0),_e(null),Ie([]),j([]),ie(!1),Q(!1),le(0),ve(0),ee({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),fe(0),oe(!1),Nt(!0),dt(!1)}catch(Ae){R.error("„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Ae),Se(Ae instanceof Error?Ae.message:String(Ae)),dt(!1)}}},[e,s]);$.useEffect(()=>{if(!be||re.length===0)return;const B=q,pe=je=>{if(je.word)return je.word;if(je.id)return`grammar_${je.id}`;if(je.question)return`grammar_${je.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const Me=je.japanese||je.sentence||"unknown";return`grammar_${String(Me).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`};(async()=>{try{const je=re.slice(B);if(je.length===0){oe(!1);return}const Me=je.map(tt=>({word:pe(tt),meaning:tt.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:tt.difficulty||"beginner"})),Ue=new Map(je.map(tt=>[pe(tt),tt]));R.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:X,currentIndex:B,remaining:je.length});const Ct=(await g.schedule({questions:Me,mode:"grammar",limits:{learningLimit:F,reviewLimit:O},sessionStats:{correct:Je.correct,incorrect:Je.incorrect,still_learning:Je.review||0,mastered:Je.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:H})).scheduledQuestions.map(tt=>{const Ft=Ue.get(tt.word);if(Ft)return{...Ft,word:tt.word,position:tt.position,finalPriority:tt.finalPriority}}).filter(tt=>tt!==void 0);de(tt=>tt.length===0||q!==B?tt:[...tt.slice(0,B),...Ct]),fe(0),oe(!1),R.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:Ct.length})}catch(je){R.error("[GrammarQuizView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",je),oe(!1)}})()},[be,re,q,g,F,O,Je,H,X]);const He=$.useCallback(async()=>{if(M)Ut();else{le(Ue=>Ue+1),ve(Ue=>Ue+1),ee(Ue=>({...Ue,correct:Ue.correct+1,mastered:Ue.mastered+1}));const B=Date.now()-Ge.current,{updateWordProgress:pe,addSessionHistory:Ae}=await gs(async()=>{const{updateWordProgress:Ue,addSessionHistory:Et}=await Promise.resolve().then(()=>Zo);return{updateWordProgress:Ue,addSessionHistory:Et}},void 0),je=ue.id?`grammar_${ue.id}`:ue.question?`grammar_${ue.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;if(await pe(je,!0,B,void 0,"grammar"),Ae({status:"correct",word:je,timestamp:Date.now()},"grammar"),N(Date.now()),q<re.length-1)Z(Ue=>Ue+1),_e(null),Ie([]),ie(!1),Q(!1),Ge.current=Date.now();else{if(!window.location.hostname.includes("github.io"))try{const Ue=Lr.summarize();R.log("üß™ KPI Summary (grammar):",Ue)}catch{}ie(!1)}fe(Ue=>{const Et=Ue+1;return Et>=50?(oe(!0),0):(Et%10===0&&w(re,"grammar").needsRescheduling&&oe(!0),Et)})}},[M,q,re,ue,Ut,w]);$.useEffect(()=>{localStorage.setItem("grammar-quiz-type",e)},[e]),$.useEffect(()=>{localStorage.setItem("grammar-grade",s)},[s]),$.useEffect(()=>{(async()=>{const pe=[],Ae=s.match(/^g?(\d+)/),je=Ae?Ae[1]:null;if(!je||s==="all"){i([]);return}for(let Me=0;Me<10;Me++)try{const Ue=await fetch(`/data/grammar/grammar_grade${je}_unit${Me}.json`);if(Ue.ok){const Et=await Ue.json();if(Et.enabled===!1)continue;pe.push({value:`g${je}-unit${Me}`,label:`‰∏≠${je}_Unit${Me}_${Et.title}`})}}catch{}i(pe)})()},[s,e]),$.useEffect(()=>{const B=ot.current,pe=B.quizType!==e||B.grade!==s;vt&&pe&&at(),ot.current={quizType:e,grade:s}},[e,s,vt,at]),$.useEffect(()=>{if(Ve&&ue&&ue.words){const B=[...ue.words].sort(()=>Math.random()-.5);j(B),Ie([]),ie(!1),Q(!1)}},[q,re,Ve,ue]),$.useEffect(()=>{_e(null),U(""),ie(!1),Q(!1)},[q]),$.useEffect(()=>{const B=pe=>{vt&&!M&&pe.key==="Enter"&&(pe.preventDefault(),He())};return window.addEventListener("keydown",B),()=>{window.removeEventListener("keydown",B)}},[vt,M,He]);const qe=async B=>{var xn;if(M||Ve)return;_e(B),ie(!0);const pe=B===ue.correctAnswer,Ae=B==="ÂàÜ„Åã„Çâ„Å™„ÅÑ";k(pe),T(ue.question||ue.sentence),pe?(D(kt=>kt+1),A(0)):(A(kt=>kt+1),D(0));const je=pe?0:P+1;!be&&je>=5&&oe(!0),ft&&ue.sentence&&setTimeout(()=>{const kt=new SpeechSynthesisUtterance(ue.sentence);kt.lang="en-US",kt.rate=.9,window.speechSynthesis.speak(kt)},300),ve(kt=>kt+1);const Me=Date.now()-Ge.current;if(pe){le(me=>me+1);const kt=ue&&ce>=2;ee(me=>({...me,correct:me.correct+1,mastered:kt?me.mastered+1:me.mastered}))}else ee(Ae?kt=>({...kt,incorrect:kt.incorrect+1,review:kt.review+1}):kt=>({...kt,incorrect:kt.incorrect+1}));const{updateWordProgress:Ue,loadProgress:Et,addSessionHistory:Ct,addQuizResult:tt}=await gs(async()=>{const{updateWordProgress:kt,loadProgress:me,addSessionHistory:Oe,addQuizResult:it}=await Promise.resolve().then(()=>Zo);return{updateWordProgress:kt,loadProgress:me,addSessionHistory:Oe,addQuizResult:it}},void 0),Ft=ue.id?`grammar_${ue.id}`:ue.question?`grammar_${ue.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`,{generateId:nt}=await gs(async()=>{const{generateId:kt}=await Promise.resolve().then(()=>aQ);return{generateId:kt}},void 0);await tt({id:nt(),questionSetId:"grammar-set",questionSetName:"ÊñáÊ≥ïÂïèÈ°å",score:pe?1:0,total:1,percentage:pe?100:0,date:Date.now(),timeSpent:Math.floor(Me/1e3),incorrectWords:pe?[]:[Ft],mode:"grammar",category:void 0,difficulty:ue.difficulty}),await Ue(Ft,pe,Me,void 0,"grammar"),f.recordAnswer(Ft,pe,Me),await Re(Ft,pe);const Ze=(xn=(await Et()).wordProgress)==null?void 0:xn[Ft];let $t=pe?"correct":"incorrect";Ze&&Ze.masteryLevel==="mastered"?$t="mastered":!pe&&Ze&&Ze.incorrectCount>=2&&($t="review"),Ct({status:$t,word:Ft,timestamp:Date.now()},"grammar"),N(Date.now());let gn=re;if(!pe&&ue){const kt=x(ue,re,q,"grammar");gn=kt,kt!==re&&de(kt)}fe(kt=>{const me=kt+1;return me>=50?(oe(!0),0):(me%10===0&&w(gn,"grammar").needsRescheduling&&oe(!0),me)});{const kt=String(ue.word);Lr.onShown(kt),Lr.onAnswer(kt,pe)}b(ue,Je,ee)},ct=(B,pe)=>{M||!Ve||(pe?(j(Ae=>Ae.filter(je=>je!==B)),Ie(Ae=>{var Me;const je=[...Ae,B];return je.length===((Me=ue.words)==null?void 0:Me.length)&&!M&&setTimeout(async()=>{var kt;ie(!0);const Ue=je.join(" "),Et=(ue.correctAnswer||ue.correctOrder||ue.sentence||"").replace(/[.!?]/g,"").trim(),Ct=Ue.toLowerCase()===Et.toLowerCase();ve(me=>me+1);const tt=Date.now()-Ge.current;if(ft&&setTimeout(()=>{const me=new SpeechSynthesisUtterance(Et);me.lang="en-US",me.rate=.9,window.speechSynthesis.speak(me)},300),Ct){le(Oe=>Oe+1);const me=ce>=2;ee(Oe=>({...Oe,correct:Oe.correct+1,mastered:me?Oe.mastered+1:Oe.mastered}))}else ee(me=>({...me,incorrect:me.incorrect+1}));const{updateWordProgress:Ft,loadProgress:nt,addSessionHistory:Fe}=await gs(async()=>{const{updateWordProgress:me,loadProgress:Oe,addSessionHistory:it}=await Promise.resolve().then(()=>Zo);return{updateWordProgress:me,loadProgress:Oe,addSessionHistory:it}},void 0),Ze=ue.id?`grammar_${ue.id}`:ue.question?`grammar_${ue.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;await Ft(Ze,Ct,tt,void 0,"grammar");const gn=(kt=(await nt()).wordProgress)==null?void 0:kt[Ze];let xn=Ct?"correct":"incorrect";gn&&gn.masteryLevel==="mastered"?xn="mastered":!Ct&&gn&&gn.incorrectCount>=2&&(xn="review"),Fe({status:xn,word:Ze,timestamp:Date.now()},"grammar"),await Re(Ze,Ct),N(Date.now())},100),je})):(Ie(Ae=>Ae.filter(je=>je!==B)),j(Ae=>[...Ae,B])))},Mt=()=>{Q(!te)},Wt=()=>{q>0&&(Z(B=>B-1),_e(null),Ie([]),ie(!1),Q(!1),Ge.current=Date.now())},Kt=()=>{var B;return!ue||!M?!1:Ve?De.join(" ")===((B=ue.words)==null?void 0:B.join(" ")):Ce===ue.correctAnswer};return $.useEffect(()=>{vt||at()},[vt,at]),u.jsxs("div",{className:"quiz-view",children:[ge&&u.jsxs("div",{className:"error-message",children:[u.jsxs("p",{children:["‚ùå ",ge]}),u.jsx("button",{onClick:at,className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"ÂÜçË©¶Ë°å"})]}),!ge&&vt&&ue&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Ah,{mode:"grammar",currentScore:ce,totalAnswered:Pe,sessionCorrect:Je.correct,sessionIncorrect:Je.incorrect,sessionReview:Je.review,sessionMastered:Je.mastered,sessionStats:Je,onReviewFocus:xe,isReviewFocusMode:H,onShowSettings:()=>c(!0),onResetProgress:$e,onDebugRequeue:Le,currentWord:ue!=null&&ue.id?`grammar_${ue.id}`:ue!=null&&ue.question?`grammar_${ue.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:void 0,onAnswerTime:S,lastAnswerCorrect:C,lastAnswerWord:I,lastAnswerDifficulty:ue==null?void 0:ue.difficulty,correctStreak:_,incorrectStreak:P,learningPhase:f.state.currentPhase??void 0,estimatedSpeed:(lt=f.state.personalParams)==null?void 0:lt.learningSpeed,dataSource:s.startsWith("g")&&s.includes("-unit")?`ÊñáÊ≥ïÂïèÈ°åÈõÜÔΩú${s.replace("g","").replace("-unit","-unit")}`:s==="all"?"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ":`${s}Âπ¥„ÅÆÂÜÖÂÆπ`,category:e==="all"?"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û":e==="verb-form"?"ÂãïË©ûÂ§âÂåñ":e==="fill-in-blank"?"Á©¥Âüã„ÇÅ":e==="sentence-ordering"?"‰∏¶„Å≥Êõø„Åà":"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û",difficulty:"",wordPhraseFilter:"all",grammarUnit:yt})})}),a&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"grade-select-active",children:"üìö Â≠¶Âπ¥„ÉªÂçòÂÖÉ:"}),u.jsxs("select",{id:"grade-select-active",value:s,onChange:B=>r(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ"}),u.jsx("option",{value:"1",children:"1Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(B=>B.value.startsWith("g1-")).map(B=>u.jsxs("option",{value:B.value,children:["1Âπ¥_",B.label.replace(/^‰∏≠\d+_/,"")]},B.value)),u.jsx("option",{value:"2",children:"2Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(B=>B.value.startsWith("g2-")).map(B=>u.jsxs("option",{value:B.value,children:["2Âπ¥_",B.label.replace(/^‰∏≠\d+_/,"")]},B.value)),u.jsx("option",{value:"3",children:"3Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(B=>B.value.startsWith("g3-")).map(B=>u.jsxs("option",{value:B.value,children:["3Âπ¥_",B.label.replace(/^‰∏≠\d+_/,"")]},B.value))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"quiz-type-select-active",children:"üìù ÂïèÈ°å„ÅÆÁ®ÆÈ°û:"}),u.jsxs("select",{id:"quiz-type-select-active",value:e,onChange:B=>t(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û"}),u.jsx("option",{value:"verb-form",children:"ÂãïË©ûÂ§âÂåñ"}),u.jsx("option",{value:"fill-in-blank",children:"Á©¥Âüã„ÇÅ"}),u.jsx("option",{value:"sentence-ordering",children:"‰∏¶„Å≥Êõø„Åà"})]})]}),u.jsx($0,{learningLimit:F,reviewLimit:O,onLearningLimitChange:V,onReviewLimitChange:L,idPrefix:"grammar-quiz-"}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle-grammar-quiz",checked:ze,onChange:B=>{Ye(B.target.checked),localStorage.setItem("autoNext-grammar",B.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle-grammar-quiz",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",ze?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),ze&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay-grammar-quiz",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay-grammar-quiz",min:"500",max:"3000",step:"100",value:Te,onChange:B=>{const pe=parseInt(B.target.value,10);ut(pe),localStorage.setItem("autoNextDelay-grammar",pe.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(Te/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-read-aloud-toggle-grammar-quiz",checked:ft,onChange:B=>{wt(B.target.checked),localStorage.setItem("autoReadAloud-grammar",B.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-read-aloud-toggle-grammar-quiz",className:"checkbox-label",children:["ÂõûÁ≠îÊôÇËá™Âãï„ÅßË™≠„Åø‰∏ä„ÅíÔºö",ft?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>d(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:Wt,disabled:q===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"question-content-inline",children:[u.jsxs("div",{className:`question-text ${te?"hint-active":""} ${M?"":"clickable"}`,onClick:M?void 0:Mt,title:M?"":"„Çø„ÉÉ„Éó„Åó„Å¶„Éí„É≥„Éà„ÇíË°®Á§∫ üí°",children:[ue.japanese,!M&&u.jsx("span",{className:"hint-icon",children:"üí°"})]}),ue.difficulty&&u.jsx("div",{className:`difficulty-badge ${ue.difficulty}`,children:ue.difficulty==="beginner"?"ÂàùÁ¥ö":ue.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:He,disabled:q>=re.length-1,title:M?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó (Enter)",children:"‚Üí"})]}),te&&!M&&u.jsx("div",{className:"hint-box",children:ue.hint}),ue.passage&&u.jsxs("div",{className:"passage-context",children:[u.jsx("div",{className:"passage-label",children:"üìñ ÊñáËÑà"}),u.jsxs("div",{className:"passage-content",children:[u.jsx("div",{className:"passage-english",children:ue.passage}),ue.passageJapanese&&u.jsx("div",{className:"passage-japanese",children:ue.passageJapanese})]})]}),Ve?u.jsxs("div",{className:"word-area",children:[u.jsxs("div",{className:"selected-words-area",children:[u.jsxs("div",{className:"area-label-with-reset",children:[u.jsxs("span",{className:"area-label",children:["ÈÅ∏Êäû„Åó„ÅüÂçòË™û (",De.length,"Ë™û)"]}),!M&&u.jsx("button",{className:`reset-ordering-button ${De.length===0?"disabled":""}`,onClick:()=>{if(De.length>0){const B=De[De.length-1];Ie(pe=>pe.slice(0,-1)),j(pe=>[...pe,B])}},disabled:De.length===0,title:De.length===0?"ÂçòË™û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ":"ÊúÄÂæå„ÅÆÂçòË™û„ÇíÊàª„Åô",children:"‚Ü∂ 1„Å§Êàª„Çã"})]}),u.jsxs("div",{className:"word-container",children:[De.map((B,pe)=>u.jsx("button",{className:"word-button selected",onClick:()=>ct(B,!1),disabled:M,children:B},`selected-${pe}`)),De.length===0&&u.jsx("div",{className:"placeholder",children:"„Åì„Åì„Å´ÂçòË™û„Çí‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑ"})]})]}),u.jsxs("div",{className:"remaining-words-area",children:[u.jsxs("div",{className:"area-label",children:["‰Ωø„Åà„ÇãÂçòË™û (",Dt.length,"Ë™û)"]}),u.jsx("div",{className:"word-container",children:Dt.map((B,pe)=>u.jsx("button",{className:"word-button remaining",onClick:()=>ct(B,!0),disabled:M,children:B},`remaining-${pe}`))})]})]}):u.jsxs("div",{className:"choices-area",children:[ue.conversation?u.jsxs(u.Fragment,{children:[ue.japanese&&ue.japanese.includes("A:")&&ue.japanese.includes("B:")&&u.jsx("div",{className:"japanese-conversation",children:ue.japanese.split(/([AB]:)/).map((B,pe)=>B==="A:"||B==="B:"?u.jsx("span",{className:"conversation-speaker",children:B},pe):B.trim()?u.jsx("span",{className:"conversation-text",children:B.trim()},pe):null)}),u.jsx("div",{className:"conversation-display",children:(ue.conversation||((Zt=ue.dialogue)==null?void 0:Zt.map(B=>`${B.speaker}: ${B.text}`))||[]).map((B,pe)=>u.jsx("div",{className:"conversation-line",children:B.split("____").map((Ae,je,Me)=>u.jsxs("span",{children:[Ae,je<Me.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},je))},pe))})]}):ue.originalSentence||ue.targetSentence?u.jsxs("div",{className:"paraphrase-display",children:[u.jsx("div",{className:"paraphrase-label",children:"üìù ÂÖÉ„ÅÆÊñá:"}),u.jsx("div",{className:"sentence-display original",children:ue.originalSentence||ue.sentence}),u.jsx("div",{className:"paraphrase-arrow",children:"‚Üì Ë®Ä„ÅÑÊèõ„Åà"}),u.jsx("div",{className:"paraphrase-label",children:"‚úèÔ∏è Êõ∏„ÅçÊèõ„ÅàÂæå:"}),u.jsx("div",{className:"sentence-display target",children:(_t=ue.question||ue.targetSentence)==null?void 0:_t.split("____").map((B,pe,Ae)=>u.jsxs("span",{children:[B,pe<Ae.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},pe))})]}):u.jsx("div",{className:"sentence-display",children:(Ke=ue.sentence)==null?void 0:Ke.split("____").map((B,pe,Ae)=>u.jsxs("span",{children:[B,pe<Ae.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},pe))}),ue.choices&&ue.choices.length>0?u.jsxs("div",{className:"choices-grid",children:[ue.choices.map((B,pe)=>{const Ae=Ce===B,je=B===ue.correctAnswer,Me=M&&je,Ue=M&&Ae&&!je;return u.jsxs("button",{className:`choice-button ${Ae?"selected":""} ${Me?"correct":""} ${Ue?"incorrect":""}`,onClick:()=>qe(B),disabled:M,children:[B,Me&&" ‚úì",Ue&&" ‚úó"]},pe)}),u.jsxs("button",{className:`choice-button dont-know ${Ce==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""} ${M&&Ce==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"incorrect":""}`,onClick:()=>qe("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:M,children:["ÂàÜ„Åã„Çâ„Å™„ÅÑ",M&&Ce==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"&&" ‚úó"]})]}):u.jsxs("div",{className:"text-input-container",children:[u.jsx("input",{type:"text",className:"text-answer-input",value:z,onChange:B=>U(B.target.value),onKeyPress:B=>{B.key==="Enter"&&z.trim()&&qe(z.trim())},placeholder:"Á≠î„Åà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",disabled:M,autoFocus:!0}),u.jsx("button",{className:"submit-answer-button",onClick:()=>qe(z.trim()),disabled:M||!z.trim(),children:"ÂõûÁ≠î„Åô„Çã"}),u.jsx("button",{className:`choice-button dont-know ${Ce==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""}`,onClick:()=>qe("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:M,children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]})]}),M&&u.jsx(u.Fragment,{children:Ve?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:`result-box ${Kt()?"correct":"incorrect"}`,children:[u.jsx("div",{className:"result-header",children:Kt()?"‚úÖ Ê≠£Ëß£ÔºÅ":"‚ùå ‰∏çÊ≠£Ëß£"}),u.jsx("div",{className:"result-content",children:u.jsxs("div",{className:"answer-comparison",children:[u.jsxs("div",{className:"user-answer",children:[u.jsx("strong",{children:"„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î:"}),u.jsx("br",{}),De.join(" ")]}),!Kt()&&u.jsxs("div",{className:"correct-answer",children:[u.jsx("strong",{children:"Ê≠£Ëß£:"}),u.jsx("br",{}),ue.correctAnswer||ue.correctOrder||ue.sentence||""]})]})})]}),ue.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),ue.explanation]})})]}):u.jsx(u.Fragment,{children:ue.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),ue.explanation]})})})})]})})]}),h&&u.jsx(Rh,{mode:"grammar",currentIndex:q,totalQuestions:re.length,questions:re.map(B=>({word:B.id,difficulty:B.difficulty})),requeuedWords:v(re,q)})]})}const rY=Object.freeze(Object.defineProperty({__proto__:null,default:jI},Symbol.toStringTag,{value:"Module"}));class Dr{static recordDataSave(e,t,s){this.enabled&&this.addEvent({type:"data-save",success:e,duration:t,errorMessage:s,timestamp:Date.now()})}static recordAIAnalysis(e,t,s,r){this.enabled&&this.addEvent({type:"ai-analysis",category:e,confidence:t,actualResult:s,errorMessage:r,timestamp:Date.now()})}static recordCategoryDetermination(e,t,s,r){this.enabled&&this.addEvent({type:"category-determination",category:e,confidence:t,duration:s,actualResult:r,timestamp:Date.now()})}static recordPriorityCalculation(e,t=!0){this.enabled&&this.addEvent({type:"priority-calculation",duration:e,success:t,timestamp:Date.now()})}static addEvent(e){this.events.push(e),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}static getMetrics(){const e=this.events.filter(o=>o.type==="data-save"),t=this.events.filter(o=>o.type==="ai-analysis"),s=this.events.filter(o=>o.type==="category-determination"),r=this.events.filter(o=>o.type==="priority-calculation");return{dataSave:{totalAttempts:e.length,successRate:e.length>0?e.filter(o=>o.success).length/e.length:0,avgDuration:e.length>0?e.reduce((o,i)=>o+(i.duration||0),0)/e.length:0,errorRate:e.length>0?e.filter(o=>!o.success).length/e.length:0},aiAnalysis:{totalAnalyses:t.length,avgConfidence:t.length>0?t.reduce((o,i)=>o+(i.confidence||0),0)/t.length:0,accuracy:t.filter(o=>o.actualResult).length>0?t.filter(o=>o.actualResult&&o.category===o.actualResult).length/t.filter(o=>o.actualResult).length:0,lowConfidenceRate:t.length>0?t.filter(o=>(o.confidence||0)<.7).length/t.length:0},categoryDetermination:{total:s.length,avgConfidence:s.length>0?s.reduce((o,i)=>o+(i.confidence||0),0)/s.length:0,accuracy:s.filter(o=>o.actualResult).length>0?s.filter(o=>o.actualResult&&o.category===o.actualResult).length/s.filter(o=>o.actualResult).length:0},priorityCalculation:{total:r.length,avgDuration:r.length>0?r.reduce((o,i)=>o+(i.duration||0),0)/r.length:0}}}static report(){if(!this.enabled)return;const e=this.getMetrics();console.group("üìà Quality Report"),console.group("üíæ Data Save"),console.log(`Total Attempts: ${e.dataSave.totalAttempts}`),console.log(`Success Rate: ${(e.dataSave.successRate*100).toFixed(2)}%`),console.log(`Avg Duration: ${e.dataSave.avgDuration.toFixed(2)}ms`),console.log(`Error Rate: ${(e.dataSave.errorRate*100).toFixed(2)}%`),console.groupEnd(),console.group("ü§ñ AI Analysis"),console.log(`Total Analyses: ${e.aiAnalysis.totalAnalyses}`),console.log(`Avg Confidence: ${(e.aiAnalysis.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),console.log(`Low Confidence Rate: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`),console.groupEnd(),console.group("üè∑Ô∏è Category Determination"),console.log(`Total: ${e.categoryDetermination.total}`),console.log(`Avg Confidence: ${(e.categoryDetermination.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.categoryDetermination.accuracy*100).toFixed(2)}%`),console.groupEnd(),console.group("‚öñÔ∏è Priority Calculation"),console.log(`Total: ${e.priorityCalculation.total}`),console.log(`Avg Duration: ${e.priorityCalculation.avgDuration.toFixed(2)}ms`),console.groupEnd(),console.groupEnd()}static export(){return JSON.stringify({timestamp:new Date().toISOString(),events:this.events,metrics:this.getMetrics()},null,2)}static saveToStorage(){try{localStorage.setItem("quality-monitor-data",this.export()),console.log("‚úÖ Quality data saved to localStorage")}catch(e){console.error("‚ùå Failed to save quality data:",e)}}static loadFromStorage(){try{const e=localStorage.getItem("quality-monitor-data");if(e){const t=JSON.parse(e);this.events=t.events||[],console.log(`‚úÖ Loaded ${this.events.length} quality events from localStorage`)}}catch(e){console.error("‚ùå Failed to load quality data:",e)}}static clear(){this.events=[],localStorage.removeItem("quality-monitor-data")}static checkThresholds(){if(!this.enabled)return;const e=this.getMetrics();e.dataSave.successRate<.99&&e.dataSave.totalAttempts>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] Data save success rate is low: ${(e.dataSave.successRate*100).toFixed(2)}%`),e.aiAnalysis.accuracy<.9&&e.aiAnalysis.totalAnalyses>=20&&console.warn(`‚ö†Ô∏è [QualityMonitor] AI analysis accuracy is low: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),e.aiAnalysis.lowConfidenceRate>.3&&e.aiAnalysis.totalAnalyses>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] High rate of low-confidence analyses: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`)}static startPeriodicCheck(e=6e4){return setInterval(()=>{this.checkThresholds()},e)}}Ne(Dr,"events",[]),Ne(Dr,"maxEvents",1e3),Ne(Dr,"enabled",!1);Dr.enabled&&(Dr.loadFromStorage(),window.addEventListener("beforeunload",()=>{Dr.saveToStorage()}),Dr.startPeriodicCheck(6e4));const Oy="ab_anonymous_user_id_v1";function _I(){try{const n=localStorage.getItem(Oy);if(n)return n;const e=`anon_${Date.now()}_${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem(Oy,e),e}catch{return console.warn("[AB Identity] localStorage not available, using session-only ID"),`temp_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}}function oY(){const n=_I(),e=Date.now(),t=Math.random().toString(36).substring(2,11);return`${n}-${e}-${t}`}function iY(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}function aY(n){switch(iY(n)%3){case 0:return"A";case 1:return"B";case 2:return"C";default:return"A"}}function cY(n){var e;try{const s=(e=et().wordProgress)==null?void 0:e[n];if(!s)return!1;const r=s.memorizationPosition??50;return r>=0&&r<20}catch(t){return console.warn(`[AB Snapshot] Failed to check mastered status for "${n}":`,t),!1}}function Ly(n){const e=[];for(const t of n)cY(t)&&e.push(t);return e}function lY(n,e){const t=new Set(n),s=new Set(e);let r=0;for(const o of s)t.has(o)||r++;return r}function uY(n,e){return e===0?0:n/e}function dY(n){return new Set(n).size}function hY(n){return n.map(e=>e.word)}const pY={targetScore:30,warningScore:40,criticalScore:50,fallbackQuestionCount:20};function fY(n,e=0,t=pY){let s="good",r=!1,o=!1,i="";return n<=t.targetScore?(s="good",i="ÊåØÂãï„Çπ„Ç≥„Ç¢ËâØÂ•Ω"):n<=t.warningScore?(s="warning",i="ÊåØÂãï„Çπ„Ç≥„Ç¢Ê≥®ÊÑè„É¨„Éô„É´"):n<=t.criticalScore?(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®"):(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®",e>=2&&(o=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™ÂåñÁ∂ôÁ∂ö: variant=A„Å∏ÂàáÊàª„ÅóÊé®Â•®")),{level:s,shouldFallback:r,shouldSwitchToA:o,score:n,message:i}}function mY(n,e,t){try{const s=`ab_consecutive_critical_${n}_${e}`,r=parseInt(localStorage.getItem(s)||"0",10),o=t?r+1:0;return localStorage.setItem(s,String(o)),o}catch{return 0}}function gY(n,e,t,s,r){try{const o={sessionId:n,variant:e,timestamp:Date.now(),score:t,level:s,fallbackApplied:r},i=JSON.parse(localStorage.getItem("ab_vibration_history")||"[]");i.push(o),i.length>300&&i.splice(0,i.length-300),localStorage.setItem("ab_vibration_history",JSON.stringify(i))}catch{}}function xY({allQuestions:n,questionSets:e,customQuestionSets:t=[],onAddWordToCustomSet:s,onRemoveWordFromCustomSet:r,onOpenCustomSetManagement:o}){var kt;const[i,a]=$.useState(!1),[c,l]=$.useState("all"),[d,h]=$.useState("all"),[p,f]=$.useState("all"),[m,g]=$.useState("all"),[x,y]=$.useState(()=>{const me=localStorage.getItem("memorization-still-learning-limit");return me?parseInt(me):null}),[b,v]=$.useState(()=>{const me=localStorage.getItem("memorization-incorrect-limit");return me?parseInt(me):null}),[w,S]=$.useState({showWord:!0,showMeaning:!0,showPronunciation:!1,showExample:!1,showEtymology:!1,showRelated:!1}),[N,C]=$.useState(!1),[k,I]=$.useState(!0),[T,_]=$.useState(!1),[D,P]=$.useState(1.5),[A,F]=$.useState(null),[O,V]=$.useState(0),[L,H]=$.useState([]),[J]=$.useState(()=>`session-${Date.now()}`),[X,fe]=$.useState(0),[be]=$.useState(()=>oY()),[oe]=$.useState(()=>aY(be)),[xe]=$.useState(()=>Date.now()),[$e,Le]=$.useState([]),[Re,ze]=$.useState([]),[Ye,Te]=$.useState(0),[ut,ft]=$.useState(0),[wt,vt]=$.useState(!1),[Nt,mt]=$.useState(0),[dt,re]=$.useState(()=>{try{return localStorage.getItem("ab_ml_enabled")==="true"}catch{return!1}}),[de,q]=$.useState(!1),[Z,Ce]=$.useState({correct:0,still_learning:0,incorrect:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[_e,De]=$.useState(0),[Ie,Dt]=$.useState(0),[j,z]=$.useState(0),[U,M]=$.useState(!1),[ie,te]=$.useState(null),[Q,ce]=$.useState(0),le=(me,Oe,it)=>{try{const rn=localStorage.getItem("debug_reschedule_events"),Rt=rn?JSON.parse(rn):[];Rt.push({timestamp:new Date().toISOString(),mode:"memorization",phase:me,reason:Oe,details:it??{}}),Rt.length>30&&Rt.shift(),localStorage.setItem("debug_reschedule_events",JSON.stringify(Rt))}catch{}},[Pe,ve]=$.useState(void 0),[Je,ee]=$.useState(void 0),[ge,Se]=$.useState(0),[ue,Ve]=$.useState(0),[yt,ot]=$.useState(null),Ge=$.useRef(0),[Ut,at]=$.useState(!0),He=$.useRef(0),qe=$.useRef(null),ct=$.useRef(null),[Mt,Wt]=$.useState(!1),[Kt,lt]=$.useState(!1),Zt=Dh(ja.MEMORIZATION),{processQuestion:_t}=Eh(),[Ke]=$.useState(()=>{const me=new jl;return localStorage.getItem("enable-ai-coordination")==="true"&&(me.enableAICoordination(!0),R.info("ü§ñ [MemorizationView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),me}),B=$.useRef(0),pe=$.useRef(null);$.useEffect(()=>{B.current=O,pe.current=(A==null?void 0:A.word)??null},[O,A==null?void 0:A.word]),$.useEffect(()=>{const me=Oe=>{const it=Oe,{word:rn,position:Rt,mode:jn}=it.detail;jn==="memorization"&&(M(!0),te(`Âº±ÁÇπË™ûÊ§úÂá∫: ${rn} (Position=${Rt})`))};return window.addEventListener("weak-word-detected",me),()=>{window.removeEventListener("weak-word-detected",me)}},[]);const{reAddQuestion:Ae,clearExpiredFlags:je,updateRequeueStats:Me,getRequeuedWords:Ue,checkPositionMismatch:Et}=_l();$.useMemo(()=>{Vt.start("calculate-category-stats");const me={incorrect:Z.incorrect,still_learning:Z.still_learning,correct:Z.correct,mastered:Z.mastered,total:Z.total,incorrectRate:Z.total>0?Z.incorrect/Z.total:0,correctRate:Z.total>0?Z.correct/Z.total:0};return Vt.end("calculate-category-stats"),me},[Z.incorrect,Z.still_learning,Z.correct,Z.mastered,Z.total]),$.useMemo(()=>{Vt.start("get-available-categories");const me=new Set;n.forEach(it=>{it.relatedFields&&Array.isArray(it.relatedFields)&&it.relatedFields.forEach(rn=>me.add(rn))});const Oe=Array.from(me).sort();return Vt.end("get-available-categories"),Oe},[n]),$.useMemo(()=>{Vt.start("filter-questions");let me=n;return p!=="all"&&(me=me.filter(Oe=>Oe.difficulty===p)),d!=="all"&&(me=me.filter(Oe=>Oe.relatedFields&&Array.isArray(Oe.relatedFields)&&Oe.relatedFields.includes(d))),m==="words"?me=me.filter(Oe=>!Oe.word.includes(" ")||Oe.word.split(" ").length<=2):m==="phrases"&&(me=me.filter(Oe=>Oe.word.includes(" ")&&Oe.word.split(" ").length>2)),Vt.end("filter-questions"),me},[n,c,p,d,m]),$.useEffect(()=>{(async()=>{try{const Oe=await m0();Oe&&S(Oe);const it=await x0();it&&(C(it.autoVoice||!1),I(it.voiceWord!==void 0?it.voiceWord:!0),_(it.voiceMeaning||!1),P(it.voiceDelay!==void 0?it.voiceDelay:1.5)),at(!1)}catch(Oe){R.error("Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Oe),at(!1)}})()},[]);const Ct=()=>{const me=new Set;return n.forEach(Oe=>{Oe.relatedFields&&Array.isArray(Oe.relatedFields)&&Oe.relatedFields.forEach(it=>me.add(it))}),Array.from(me).sort()};$.useEffect(()=>{if(Ut)return;(async()=>{try{const Oe=n;if(Oe.length===0){R.warn("[MemorizationView] ÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}let it=Oe;if(p!=="all"&&(it=it.filter(Tt=>Tt.difficulty===p)),d!=="all"&&(it=it.filter(Tt=>Tt.relatedFields&&Array.isArray(Tt.relatedFields)&&Tt.relatedFields.includes(d))),m==="words"?it=it.filter(Tt=>!Tt.word.includes(" ")||Tt.word.split(" ").length<=2):m==="phrases"&&(it=it.filter(Tt=>Tt.word.includes(" ")&&Tt.word.split(" ").length>2)),it.length===0){R.warn("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂïèÈ°å„Åå0‰ª∂„Åß„Åô");return}R.info("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂçòË™ûÊï∞",{totalFiltered:it.length,sessionStats:{correct:Z.correct,incorrect:Z.incorrect,still_learning:Z.still_learning||0}}),oe==="B"||oe==="C"?Ke.enableAICoordination(!0):Ke.enableAICoordination(!1),await ps();const Rt=et().wordProgress||{},jn=[],rr=Object.entries(Rt).filter(([Tt,en])=>(en.memorizationAttempts??en.totalAttempts??0)<=0?!1:Bt(en,"memorization")>=40).map(([Tt,en])=>({word:Tt,position:Bt(en,"memorization"),memPos:en.memorizationPosition,attempts:en.memorizationAttempts??en.totalAttempts??0})),lo=new Set(Oe.map(Tt=>Tt.word)),Wo=rr.filter(Tt=>!lo.has(Tt.word));try{localStorage.setItem("debug_weak_words_detection",JSON.stringify({timestamp:new Date().toISOString(),allWeakWordsInLS:rr.length,weakWordsList:rr,missingFromBase:Wo.map(Tt=>Tt.word),baseQuestionsCount:Oe.length,filteredCount:it.length}))}catch{}for(const Tt of Oe){const en=Rt[Tt.word];if(!en||(en.memorizationAttempts??en.totalAttempts??0)<=0)continue;Bt(en,"memorization")>=40&&jn.push(Tt)}try{const Tt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");localStorage.setItem("debug_weak_words_detection",JSON.stringify({...Tt,weakQuestionsCount:jn.length,weakQuestionsWords:jn.map(en=>en.word)}))}catch{}try{const Tt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");Tt.weakQuestionsDetected=jn.length,Tt.weakQuestionsWords=jn.map(en=>en.word),Tt.dataMissing=rr.length-jn.length,localStorage.setItem("debug_weak_words_detection",JSON.stringify(Tt))}catch{}let uo=it;if(jn.length>0){const Tt=new Map;for(const en of it)Tt.set(en.word,en);for(const en of jn)Tt.set(en.word,en);uo=Array.from(Tt.values())}let vs;const cn=await Ke.schedule({questions:uo,mode:"memorization",limits:{learningLimit:x,reviewLimit:b},sessionStats:{correct:Z.correct,incorrect:Z.incorrect,still_learning:Z.still_learning||0,mastered:Z.mastered||0,duration:Date.now()-Ge.current},useMetaAI:!0,isReviewFocusMode:de,hybridMode:oe==="B",finalPriorityMode:oe==="C"});if(!cn||!cn.scheduledQuestions){R.error("[MemorizationView] „Çπ„Ç±„Ç∏„É•„Éº„É´ÁµêÊûú„ÅåÁÑ°Âäπ„Åß„Åô",{scheduleResult:cn});return}const Ps=cn.scheduledQuestions,or={totalScheduled:Ps.length,top10Words:Ps.slice(0,10).map(Tt=>Tt.word),timestamp:new Date().toISOString()};try{localStorage.setItem("debug_memorization_latest",JSON.stringify(or))}catch{}const rs=cn.vibrationScore,jh=_I(),Hr=fY(rs,ut),ji=mY(jh,oe,Hr.level==="critical");if(ft(ji),gY(be,oe,rs,Hr.level,Hr.shouldFallback),Hr.shouldFallback&&!wt&&(oe==="B"||oe==="C")&&(R.warn("[MemorizationView] ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈÅ©Áî®",{score:rs,variant:oe,consecutiveCritical:ji}),vt(!0),Ps.splice(20)),Hr.shouldSwitchToA&&R.error("[MemorizationView] variant=AÂàáÊàª„ÅóÊé®Â•®",{score:rs,variant:oe,consecutiveCritical:ji,message:Hr.message}),cn.vibrationScore>50&&R.warn("[MemorizationView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:cn.vibrationScore,processingTime:cn.processingTime}),H(Ps),Ps.length>0&&O===0&&!A){const Tt=hY(Ps);ze(Tt),Te(cn.vibrationScore);const en=Ly(Tt);Le(en)}if(Ps.length>0&&O===0&&!A){const Tt=Ps[0];F(Tt),V(0),Ge.current=Date.now(),Ce(en=>({...en,total:en.total+1}))}}catch(Oe){R.error("[MemorizationView] ÂïèÈ°åÈÅ∏Êäû„Ç®„É©„Éº:",Oe),at(!1)}})()},[c,p,d,m,n,Ut,de]);const tt=()=>{q(!de)},Ft=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:me}=await gs(async()=>{const{resetAllProgress:Oe}=await Promise.resolve().then(()=>Zo);return{resetAllProgress:Oe}},void 0);await me(),Ce({correct:0,still_learning:0,incorrect:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),Se(0),Ve(0),V(0),Te(0),ft(0),mt(0),R.info("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(me){R.error("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",me),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},nt=()=>{lt(!0)},Fe=async(me,Oe)=>{try{const it=Rt=>{const jn=(Rt.grade||1)/9;return Math.min(Math.max(jn,0),1)},rn=()=>{const Rt=new Date().getHours();return Rt<12?"morning":Rt<18?"afternoon":Rt<22?"evening":"night"};A&&await _t(me,Oe?"correct":"incorrect",{currentDifficulty:it(A),timeOfDay:rn(),recentErrors:Z.incorrect,sessionLength:Math.floor((Date.now()-Ge.current)/6e4),consecutiveCorrect:ge})}catch(it){console.error("[MemorizationView] Adaptive AI error:",it)}};$.useEffect(()=>{(x!==null&&Z.still_learning>=x||b!==null&&Z.incorrect>=b)&&(de||q(!0))},[Z,x,b,de]),$.useEffect(()=>{_e!==0&&L.length!==0&&setTimeout(()=>{const me=w0(L,"memorization");Ce(Oe=>({...Oe,incorrect:me.incorrect,still_learning:me.still_learning,mastered:me.mastered}))},100)},[_e,L]),$.useEffect(()=>{if(!U||Ut||L.length===0)return;(async()=>{try{R.info("[MemorizationView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:j,reason:ie});const Oe=B.current,it=pe.current,rn=Math.min(Oe+1,L.length),Rt=L.slice(rn),rr=et().wordProgress||{},lo=[];for(const vs of n){const cn=rr[vs.word];if(!cn||(cn.memorizationAttempts??cn.totalAttempts??0)<=0)continue;Bt(cn,"memorization")>=40&&(Rt.find(rs=>rs.word===vs.word)||lo.push(vs))}let Wo=Rt;if(lo.length>0){const vs=new Map;for(const cn of Rt)vs.set(cn.word,cn);for(const cn of lo)vs.set(cn.word,cn);Wo=Array.from(vs.values())}if(Wo.length===0){R.warn("[MemorizationView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂØæË±°„Å™„Åó"),z(0),M(!1),te(null),le("skipped","ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂØæË±°„Å™„Åó",{lockedPrefixCount:rn,total:L.length});return}const uo=await Ke.schedule({questions:Wo,mode:"memorization",limits:{learningLimit:x??null,reviewLimit:b??null},sessionStats:{correct:Z.correct,incorrect:Z.incorrect,still_learning:Z.still_learning,mastered:Z.mastered,duration:0},useMetaAI:!0,hybridMode:oe==="A"||oe==="B"});H(vs=>B.current!==Oe||pe.current!==it?vs:[...vs.slice(0,rn),...uo.scheduledQuestions]),ce(Date.now()),le("applied",ie??"Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞",{lockedPrefixCount:rn,remainingBefore:Wo.length,remainingAfter:uo.scheduledQuestions.length}),z(0),M(!1),te(null),R.info("[MemorizationView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newLength:uo.scheduledQuestions.length})}catch(Oe){R.error("[MemorizationView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",Oe),M(!1),te(null),le("error","ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº",{error:String(Oe)})}})()},[U,Ut,L,x,b,Z,oe,Ke,j,ie]),$.useEffect(()=>{if(!A||!N||ct.current===A.word)return;ct.current=A.word,(async()=>{if(k&&Ts(A.word,{rate:.85}),T&&A.meaning){await new Promise(it=>setTimeout(it,D*1e3));const Oe=new SpeechSynthesisUtterance(A.meaning);Oe.lang="ja-JP",Oe.rate=.85,window.speechSynthesis.speak(Oe)}})()},[A,N,k,T,D]);const Ze=()=>{Wt(!Mt)},$t=async me=>{if(me==="showWord")return;const Oe={...w,[me]:!w[me]};S(Oe),await f0(Oe)},gn=async(me,Oe,it,rn)=>{C(me),I(Oe),_(it),rn!==void 0&&P(rn),await g0({autoVoice:me,voiceWord:Oe,voiceMeaning:it,voiceDelay:rn!==void 0?rn:D,interleavingMode:"off",cardDisplaySettings:w})},xn=$.useCallback(async me=>{var Hr,ji,Tt,en;if(!A)return;const Oe=(Date.now()-Ge.current)/1e3,it=me==="right",rn=me==="center",Rt=A,jn=Oe,rr=O;ve(it),ee(A.word);const lo=!it&&!rn?ue+1:0;!U&&lo>=5&&(M(!0),te("‰∏çÊ≠£Ëß£ÈÄ£Êâì„ÅßÊñ∞Ë¶èÊûØÊ∏á„ÇíÂõûÈÅø"),le("triggered","‰∏çÊ≠£Ëß£ÈÄ£Êâì„ÅßÊñ∞Ë¶èÊûØÊ∏á„ÇíÂõûÈÅø",{word:A.word,incorrectStreak:lo})),it?(Se(ht=>ht+1),Ve(0)):rn?(Se(0),Ve(0)):(Ve(ht=>ht+1),Se(0)),Ce(ht=>{const ln=A.reAddedCount&&A.reAddedCount>0;let Cn=ht.incorrect,Ss=ht.still_learning;return it&&ln&&(Cn>0?Cn=Math.max(0,Cn-1):Ss>0&&(Ss=Math.max(0,Ss-1))),{correct:it?ht.correct+1:ht.correct,still_learning:rn?Ss+1:Ss,incorrect:!it&&!rn?Cn+1:Cn,mastered:it?ht.mastered+1:ht.mastered,total:ht.total,newQuestions:ht.newQuestions,reviewQuestions:ht.reviewQuestions,consecutiveNew:ht.consecutiveNew,consecutiveReview:ht.consecutiveReview}}),Vt.start("quick-category-determination");const uo=(Hr=et().wordProgress)==null?void 0:Hr[Rt.word],vs=Bt(uo,"memorization"),cn=Qr(vs),Ps=Vt.end("quick-category-determination");if(Ps>50&&Vt.warnIfSlow("quick-category-determination",Ps,50),Dr.recordCategoryDetermination(cn,1,Ps),jn<16){Vt.start("data-save");try{await So(Rt.word,it,jn*1e3,void 0,"memorization",rn);try{const Cn=(ji=et().wordProgress)==null?void 0:ji[Rt.word],Ss=Bt(Cn,"memorization"),Bs=Qr(Ss);tI(Bs)&&Bs!==cn&&(M(!0),te(`Â≠¶ÁøíÁä∂ÊÖãÂ§âÂåñ: ${cn}‚Üí${Bs}`),le("triggered",`Â≠¶ÁøíÁä∂ÊÖãÂ§âÂåñ: ${cn}‚Üí${Bs}`,{word:Rt.word,categoryBefore:cn,categoryAfter:Bs,posAfter:Ss}))}catch(ln){R.error("[MemorizationView] „Ç´„ÉÜ„Ç¥„É™Â§âÂåñÊ§úÁü•„Ç®„É©„Éº:",ln)}if(it)try{const Cn=(Tt=et().wordProgress)==null?void 0:Tt[Rt.word];Bt(Cn,"memorization")<40&&H(ir=>{if(!Array.isArray(ir)||ir.length===0)return ir;const _i=Math.min(rr,ir.length-1);return ir.filter((_h,Ph)=>Ph<=_i||_h.word!==Rt.word?!0:!((_h.reAddedCount||0)>0))})}catch{}const ht=Vt.end("data-save");Dr.recordDataSave(!0,ht)}catch(ht){const ln=Vt.end("data-save");Dr.recordDataSave(!1,ln,String(ht)),R.error("[MemorizationView] Â≠¶Áøí„Éá„Éº„ÇøË®òÈå≤„Ç®„É©„Éº:",ht)}finally{De(Date.now())}Promise.all([(async()=>{try{const ht={word:Rt.word,timestamp:Date.now(),viewDuration:jn,swipeDirection:me==="center"?"left":me,sessionId:J,consecutiveViews:X+1};await y0(ht),fe(ln=>ln+1)}catch(ht){R.error("[MemorizationView] Ë°åÂãïË®òÈå≤„Ç®„É©„Éº:",ht)}})(),(async()=>{try{Zt.recordAnswer(Rt.word,it,jn*1e3)}catch(ht){R.error("[MemorizationView] Áµ±Ë®àË®òÈå≤„Ç®„É©„Éº:",ht)}})(),(async()=>{await new Promise(ht=>setTimeout(ht,1e3)),Vt.start("ai-detailed-analysis");try{await Fe(Rt.word,it);const ht=Vt.end("ai-detailed-analysis")}catch(ht){Vt.end("ai-detailed-analysis"),R.error("[MemorizationView] AIÂàÜÊûê„Ç®„É©„Éº:",ht)}})()]).catch(ht=>{R.error("[MemorizationView] „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂá¶ÁêÜ„Ç®„É©„Éº:",ht)})}if(Me(A,Z,Ce),ot(A.word),z(ht=>{const ln=ht+1;if(ln>=50)return M(!0),te("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),le("triggered","50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü",{answerCountSinceSchedule:ln}),ln;if(ln%10===0)try{const Cn=Et(L,"memorization");Cn.needsRescheduling&&(M(!0),te(Cn.reason),le("triggered",Cn.reason,{answerCountSinceSchedule:ln}))}catch(Cn){R.error("[MemorizationView] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",Cn)}return ln}),dt&&Ke.aiCoordinator)try{const ht=et(),ln=(ht==null?void 0:ht.wordProgress)??{},Cn=ln[A.word]??((en=ht==null?void 0:ht.wordProgress)==null?void 0:en[A.word])??null;let Ss=0,Bs=0,ir=0,_i=0;for(const Mh of Object.values(ln)){const Fh=Bt(Mh,"memorization");Fh>=70?ir++:Fh>=40?Bs++:Fh>=20?_i++:Ss++}const Ph={totalAttempts:(Z.correct||0)+(Z.incorrect||0)+(Z.still_learning||0)+(Z.mastered||0),correctAnswers:Z.correct||0,incorrectAnswers:Z.incorrect||0,stillLearningAnswers:Z.still_learning||0,sessionStartTime:xe,sessionDuration:Date.now()-xe,consecutiveIncorrect:0,masteredCount:Ss,stillLearningCount:Bs,incorrectCount:ir,newCount:_i,consecutiveCorrect:Z.consecutiveCorrect||0},FI={word:{word:A.word,meaning:A.meaning,reading:A.reading,difficulty:A.difficulty,category:A.category,source:A.source,type:A.type,isPhraseOnly:A.isPhraseOnly},progress:Cn,sessionStats:Ph,currentTab:"memorization",allProgress:ln},OI={wasCorrect:it,responseTime:Math.round(jn*1e3),timestamp:Date.now(),features:[]};Ke.aiCoordinator.learn(FI,OI).catch(Mh=>{console.warn("[ML] learn() failed",Mh)})}catch(ht){console.warn("[ML] learn() error",ht)}let or=L;if(!it||rn){const ht=Ae(A,L,O,"memorization");ht!==L&&(or=ht,H(ht))}let rs=O+1;const jh=Math.min(rs+5,or.length);for(;rs<jh&&or[rs].word===A.word;)R.warn("[MemorizationView] ÈÄ£Á∂öÂá∫È°å„ÇíÊ§úÂá∫„ÄÅ„Çπ„Ç≠„ÉÉ„Éó",{word:or[rs].word,nextIndex:rs}),rs++;if(rs<or.length){const ht=je(or,O);ht!==or&&H(ht);const ln=or[rs];F(ln),V(rs),Ge.current=Date.now(),Ce(Cn=>({...Cn,total:Cn.total+1})),ee(void 0)}else{if(Re.length>0)try{const ht=Ly(Re),ln=lY($e,ht),Cn=dY(Re),Ss=uY(ln,Cn),Bs=Date.now(),ir=Math.round((Bs-xe)/1e3),_i={sessionId:be,variant:oe,mode:"memorization",sessionLength:Re.length,questionWords:Re,uniqueWordCount:Cn,startMasteredWords:$e,endMasteredWords:ht,acquiredWordCount:ln,acquisitionRate:Ss,vibrationScore:Ye,startedAt:xe,endedAt:Bs,durationSec:ir,mlEnabled:dt};l9(_i)}catch(ht){console.error("[AB Session End] Failed to save log:",ht)}F(null),ee(void 0)}},[A,O,L,J,X,Z,x,b]);return $.useEffect(()=>{const me=qe.current;if(!me)return;const Oe=Rt=>{He.current=Rt.touches[0].clientX},it=Rt=>{const rr=Rt.changedTouches[0].clientX-He.current;Math.abs(rr)>100&&(rr>0?xn("right"):xn("left"))},rn=Rt=>{Rt.key==="ArrowLeft"||Rt.key==="1"?(Rt.preventDefault(),xn("left")):Rt.key==="ArrowDown"||Rt.key==="2"?(Rt.preventDefault(),xn("center")):(Rt.key==="ArrowRight"||Rt.key==="3")&&(Rt.preventDefault(),xn("right"))};return me.addEventListener("touchstart",Oe),me.addEventListener("touchend",it),document.addEventListener("keydown",rn),()=>{me.removeEventListener("touchstart",Oe),me.removeEventListener("touchend",it),document.removeEventListener("keydown",rn)}},[xn]),Ut?u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})}):A?u.jsxs("div",{className:"quiz-view",children:[Mt?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:Ze,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4 h-[90vh] flex items-center",children:u.jsxs("div",{ref:qe,className:"question-card h-[600px] sm:h-[650px] md:h-[700px] flex flex-col w-full",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${yn()?"clickable-pronunciation":""}`,onClick:me=>{yn()&&(me.preventDefault(),me.stopPropagation(),Ts(A.word,{rate:.85}))},onTouchEnd:me=>{yn()&&(me.preventDefault(),me.stopPropagation(),Ts(A.word,{rate:.85}))},title:yn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${A.word.includes(" ")?"phrase-text":""} ${yn()?"clickable-word":""}`,children:[A.word,yn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),A.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",A.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[A.difficulty&&u.jsx("div",{className:`difficulty-badge ${A.difficulty}`,children:A.difficulty==="beginner"?"ÂàùÁ¥ö":A.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),s&&r&&o&&u.jsx(ta,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4 flex-shrink-0",children:[u.jsxs("button",{onClick:()=>xn("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>xn("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>xn("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),s&&r&&o&&u.jsx("div",{className:"mb-2 flex justify-center flex-shrink-0",children:u.jsx(ta,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})}),u.jsxs("div",{className:"space-y-3 overflow-y-auto flex-1 min-h-0",children:[u.jsx("button",{onClick:()=>$t("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showMeaning?"‚ñº":"‚ñ∂"})]}),w.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words",children:A.meaning})]})}),A.etymology&&A.etymology.trim()!==""&&A.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>$t("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showEtymology?"‚ñº":"‚ñ∂"})]}),w.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.etymology})]})}),A.relatedWords&&A.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>$t("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showRelated?"‚ñº":"‚ñ∂"})]}),w.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.relatedWords})]})})]})]})})]})}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Ah,{mode:"memorization",sessionCorrect:Z.correct,sessionReview:Z.still_learning,sessionIncorrect:Z.incorrect,totalAnswered:Z.total,currentWord:A==null?void 0:A.word,onAnswerTime:_e,learningStatusTabPulseKey:Q,lastAnswerCorrect:Pe,lastAnswerWord:Je,lastAnswerDifficulty:A==null?void 0:A.difficulty,correctStreak:ge,incorrectStreak:ue,learningPhase:Zt.state.currentPhase??void 0,estimatedSpeed:(kt=Zt.state.personalParams)==null?void 0:kt.learningSpeed,onShowSettings:()=>a(!0),dataSource:c,category:d==="all"?"ÂÖ®ÂàÜÈáé":d,difficulty:p,wordPhraseFilter:m,onReviewFocus:tt,isReviewFocusMode:de,onResetProgress:Ft,onDebugRequeue:nt})})}),i&&u.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-lg p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold",children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-datasource",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsxs("select",{id:"memorization-datasource",value:c,onChange:me=>l(me.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂïèÈ°åÈõÜ"}),u.jsx("option",{value:"standard",children:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ"}),u.jsx("option",{value:"advanced",children:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö"}),u.jsx("option",{value:"comprehensive",children:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-difficulty",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìä Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"memorization-difficulty",value:p,onChange:me=>f(me.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®Èõ£ÊòìÂ∫¶"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-category",className:"block text-sm font-medium mb-2 text-gray-700",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"memorization-category",value:d,onChange:me=>h(me.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂàÜÈáé"}),Ct().map(me=>u.jsx("option",{value:me,children:me},me))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-filter",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìù ÂçòË™û„ÉªÁÜüË™û:"}),u.jsxs("select",{id:"memorization-filter",value:m,onChange:me=>g(me.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂçòË™ûÔºãÁÜüË™û"}),u.jsx("option",{value:"words",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö:"}),u.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Êú™ÂÖ•Âäõ„ÅÆÂ†¥Âêà„ÅØÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„ÅôÔºàÊé®Â•®ÔºöLeitner„Ç∑„Çπ„ÉÜ„É†ÊñπÂºèÔºâ"}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center mb-2",children:[u.jsx("input",{type:"checkbox",checked:x!==null,onChange:me=>{me.target.checked?(y(50),localStorage.setItem("memorization-still-learning-limit","50")):(y(null),localStorage.removeItem("memorization-still-learning-limit"))},className:"mr-2 w-4 h-4"}),u.jsx("span",{className:"text-sm",children:"üü° „Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê„ÇíË®≠ÂÆö"})]}),x!==null&&u.jsxs("div",{className:"ml-6",children:[u.jsx("select",{value:x,title:"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê",onChange:me=>{const Oe=parseInt(me.target.value);y(Oe),localStorage.setItem("memorization-still-learning-limit",Oe.toString())},className:"w-full px-3 py-2 border rounded-lg bg-white",children:[5,10,20,30,50,100,150,200].map(me=>u.jsx("option",{value:me,children:me},me))}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„Çâ„ÄÅÂæ©Áøí„É¢„Éº„Éâ„Å´Ëá™Âãï„ÅßÂàá„ÇäÊõø„Çè„Çä„Åæ„Åô"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center mb-2",children:[u.jsx("input",{type:"checkbox",checked:b!==null,onChange:me=>{me.target.checked?(v(30),localStorage.setItem("memorization-incorrect-limit","30")):(v(null),localStorage.removeItem("memorization-incorrect-limit"))},className:"mr-2 w-4 h-4"}),u.jsx("span",{className:"text-sm",children:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê„ÇíË®≠ÂÆö"})]}),b!==null&&u.jsxs("div",{className:"ml-6",children:[u.jsx("select",{value:b,title:"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê",onChange:me=>{const Oe=parseInt(me.target.value);v(Oe),localStorage.setItem("memorization-incorrect-limit",Oe.toString())},className:"w-full px-3 py-2 border rounded-lg bg-white",children:[5,10,20,30,50,100,150,200].map(me=>u.jsx("option",{value:me,children:me},me))}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„Çâ„ÄÅÂæ©Áøí„É¢„Éº„Éâ„Å´Ëá™Âãï„ÅßÂàá„ÇäÊõø„Çè„Çä„Åæ„Åô"})]})]})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üîä Ëá™ÂãïÁô∫Èü≥Ë®≠ÂÆö:"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:N,onChange:me=>gn(me.target.checked,k,T),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ëá™Âãï„ÅßÁô∫Èü≥„Åô„Çã"})]}),N&&u.jsxs("div",{className:"ml-6 space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:k,onChange:me=>gn(N,me.target.checked,T),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ë™ûÂè•„ÇíË™≠„Åø‰∏ä„Åí"})]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:T,onChange:me=>gn(N,k,me.target.checked),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"ÊÑèÂë≥„ÇíË™≠„Åø‰∏ä„Åí"})]}),T&&u.jsxs("div",{className:"ml-6 mt-2",children:[u.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["‚è±Ô∏è Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî: ",D.toFixed(1),"Áßí"]}),u.jsx("input",{type:"range",min:"0.5",max:"5.0",step:"0.5",value:D,onChange:me=>{const Oe=parseFloat(me.target.value);P(Oe),gn(N,k,T,Oe)},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer","aria-label":"Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî"}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0.5Áßí"}),u.jsx("span",{children:"5.0Áßí"})]})]})]})]})]}),u.jsx("div",{className:"border-t pt-4 mt-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ü§ñ Ê©üÊ¢∞Â≠¶ÁøíÔºàMLÔºâ"}),u.jsx("p",{className:"text-xs text-gray-500",children:"ÂÄã‰∫∫„ÅÆÂ≠¶Áøí„Éë„Çø„Éº„É≥„Å´ÈÅ©ÂøúÔºàÂÆüÈ®ìÁöÑÊ©üËÉΩÔºâ"})]}),u.jsx("button",{onClick:()=>{try{const me=!dt;localStorage.setItem("ab_ml_enabled",String(me)),re(me),alert(me?"MLÊ©üËÉΩ„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åó„Åü„ÄÇË®≠ÂÆö„ÇíÂèçÊò†„Åô„Çã„Å´„ÅØ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ":"MLÊ©üËÉΩ„ÇíÁÑ°Âäπ„Å´„Åó„Åæ„Åó„Åü„ÄÇË®≠ÂÆö„ÇíÂèçÊò†„Åô„Çã„Å´„ÅØ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")}catch{alert("Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:`px-4 py-2 rounded-lg font-medium transition ${dt?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-700 hover:bg-gray-400"}`,children:dt?"ON":"OFF"})]})})]})]}),u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:Ze,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{ref:qe,className:"question-card w-full h-[600px] sm:h-[650px] md:h-[700px] flex flex-col",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${yn()?"clickable-pronunciation":""}`,onClick:me=>{yn()&&(me.preventDefault(),me.stopPropagation(),Ts(A.word,{rate:.85}))},onTouchEnd:me=>{yn()&&(me.preventDefault(),me.stopPropagation(),Ts(A.word,{rate:.85}))},title:yn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${A.word.includes(" ")?"phrase-text":""} ${yn()?"clickable-word":""}`,children:[A.word,yn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),A.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",A.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[A.difficulty&&u.jsx("div",{className:`difficulty-badge ${A.difficulty}`,children:A.difficulty==="beginner"?"ÂàùÁ¥ö":A.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),s&&r&&o&&u.jsx(ta,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[u.jsxs("button",{onClick:()=>xn("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>xn("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>xn("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("button",{onClick:()=>$t("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showMeaning?"‚ñº":"‚ñ∂"})]}),w.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words",children:A.meaning})]})}),A.etymology&&A.etymology.trim()!==""&&A.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>$t("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showEtymology?"‚ñº":"‚ñ∂"})]}),w.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.etymology})]})}),A.relatedWords&&A.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>$t("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showRelated?"‚ñº":"‚ñ∂"})]}),w.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.relatedWords})]})})]})]})]})})]}),Kt&&u.jsx(Rh,{mode:"memorization",currentIndex:O,totalQuestions:L.length,questions:L,requeuedWords:Ue(L,O)})]}):u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})})}const yY=()=>{const[n,e]=$.useState("prepositions");return u.jsxs("div",{className:"grammar-guide-view p-4 max-w-app mx-auto",children:[u.jsxs("div",{className:"grammar-guide-tabs grid grid-cols-3 gap-1 sm:gap-2 mb-4",children:[u.jsxs("button",{onClick:()=>e("prepositions"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="prepositions"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üìç ÂâçÁΩÆË©û"}),u.jsx("span",{className:"sm:hidden",children:"üìç"})]}),u.jsxs("button",{onClick:()=>e("punctuation"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="punctuation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"‚úèÔ∏è Ë®òÂè∑"}),u.jsx("span",{className:"sm:hidden",children:"‚úèÔ∏è"})]}),u.jsxs("button",{onClick:()=>e("tips"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="tips"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° Ë™≠Ëß£„Ç≥„ÉÑ"}),u.jsx("span",{className:"sm:hidden",children:"üí°"})]})]}),u.jsxs("div",{className:"content-area bg-white rounded-lg p-4 shadow-md border border-gray-200",children:[n==="prepositions"&&u.jsx(bY,{}),n==="punctuation"&&u.jsx(wY,{}),n==="tips"&&u.jsx(vY,{})]})]})},bY=()=>u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"ÂâçÁΩÆË©û„ÅÆ„Éã„É•„Ç¢„É≥„Çπ„Å®‰Ωø„ÅÑÂàÜ„Åë"}),u.jsx("p",{className:"text-text-secondary mb-6",children:"Ëã±Ë™û„ÅßÊúÄ„ÇÇÈ†ªÁπÅ„Å´‰Ωø„ÅÜÂâçÁΩÆË©û„ÇíÈáçË¶ÅÂ∫¶È†Ü„Å´Á¥π‰ªã„Åó„Åæ„Åô„ÄÇ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Ç¢„Ç§„É°„Éº„Ç∏„ÇíÁêÜËß£„Åô„Çã„Åì„Å®„Åß„ÄÅËá™ÁÑ∂„Å™Ëã±Ë™ûË°®Áèæ„ÅåË∫´„Å´„Å§„Åç„Åæ„Åô„ÄÇ"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üåü ÊúÄÈáçË¶ÅÔºöÊôÇÈñì„ÉªÂ†¥ÊâÄ„ÅÆÂü∫Êú¨3„Å§"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚û°Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"TO"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„ÄåÊñπÂêë„ÉªÂà∞ÈÅîÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß≠"})," ÊñπÂêë„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üè´ ",u.jsx("strong",{children:"to school"})," ‚Üí Â≠¶Ê†°„Å∏ÔºàÊñπÂêëÔºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üóº ",u.jsx("strong",{children:"to Tokyo"})," ‚Üí Êù±‰∫¨„Å∏ÔºàÁõÆÁöÑÂú∞Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üîÑ"})," ÁØÑÂõ≤„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üìä ",u.jsx("strong",{children:"from A to B"})," ‚Üí A„Åã„ÇâB„Åæ„ÅßÔºàÁØÑÂõ≤Ôºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üïê ",u.jsx("strong",{children:"from 9 to 5"})," ‚Üí 9ÊôÇ„Åã„Çâ5ÊôÇ„Åæ„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üéØ"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"FOR"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„ÄåÁõÆÁöÑ„ÉªÂØæË±°„ÉªÊúüÈñì„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üíù"})," ÁõÆÁöÑ„ÉªÂØæË±°„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üë§ ",u.jsx("strong",{children:"for you"})," ‚Üí „ÅÇ„Å™„Åü„ÅÆ„Åü„ÇÅ„Å´ÔºàÂØæË±°Ôºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üç≥ ",u.jsx("strong",{children:"for breakfast"})," ‚Üí ÊúùÈ£ü„Å®„Åó„Å¶ÔºàÁõÆÁöÑÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"})," ÊúüÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["‚è∞ ",u.jsx("strong",{children:"for 3 hours"})," ‚Üí 3ÊôÇÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üìÖ ",u.jsx("strong",{children:"for a week"})," ‚Üí 1ÈÄ±ÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]})]})]})]})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üé¨"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"FROM"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„ÄåËµ∑ÁÇπ„ÉªÂá∫Áô∫ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," Ëµ∑ÁÇπ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üè† ",u.jsx("strong",{children:"from home"})," ‚Üí ÂÆ∂„Åã„ÇâÔºàÂá∫Áô∫ÁÇπÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üáØüáµ ",u.jsx("strong",{children:"from Japan"})," ‚Üí Êó•Êú¨„Åã„ÇâÔºàÂá∫Ë∫´Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," ÊôÇÈñì„ÅÆËµ∑ÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["‚è∞ ",u.jsx("strong",{children:"from 9 am"})," ‚Üí 9ÊôÇ„Åã„ÇâÔºàÈñãÂßãÊôÇÂàªÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"from Monday"})," ‚Üí ÊúàÊõúÊó•„Åã„Çâ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üìå „Çà„Åè‰Ωø„ÅÜÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"ü§ù"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"WITH"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå‰∏ÄÁ∑í„Å´„Éª‰Ωø„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë•"})," ‰º¥„ÅÜÁõ∏ÊâãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üë®‚Äçüë©‚Äçüëß ",u.jsx("strong",{children:"with my family"})," ‚Üí ÂÆ∂Êóè„Å®‰∏ÄÁ∑í„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üßë‚Äçü§ù‚Äçüßë ",u.jsx("strong",{children:"with friends"})," ‚Üí ÂèãÈÅî„Å®"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üõ†Ô∏è"})," ‰Ωø„ÅÜÈÅìÂÖ∑Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["‚úèÔ∏è ",u.jsx("strong",{children:"with a pen"})," ‚Üí „Éö„É≥„ÅßÔºàÈÅìÂÖ∑Ôºâ"]}),u.jsxs("div",{className:"text-indigo-600",children:["üç¥ ",u.jsx("strong",{children:"with chopsticks"})," ‚Üí ÁÆ∏„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-amber-50/20 rounded-lg p-5 border-2 border-amber-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöó"}),u.jsx("div",{className:"text-2xl font-bold text-amber-600 mt-2",children:"BY"}),u.jsx("div",{className:"text-sm text-amber-700 mt-1",children:"„Äå„Äú„ÅÆ„Åù„Å∞„Å´„ÉªÊâãÊÆµ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üöå"})," ÊâãÊÆµ„ÉªÊñπÊ≥ïÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üöÜ ",u.jsx("strong",{children:"by train"})," ‚Üí ÈõªËªä„ÅßÔºà‰∫§ÈÄöÊâãÊÆµÔºâ"]}),u.jsxs("div",{className:"text-amber-600",children:["‚úâÔ∏è ",u.jsx("strong",{children:"by email"})," ‚Üí „É°„Éº„É´„ÅßÔºàÈÄö‰ø°ÊâãÊÆµÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," „Åù„Å∞„Å´Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üåä ",u.jsx("strong",{children:"by the sea"})," ‚Üí Êµ∑„ÅÆ„Åù„Å∞„Å´"]}),u.jsxs("div",{className:"text-amber-600",children:["ü™ü ",u.jsx("strong",{children:"by the window"})," ‚Üí Á™ì„ÅÆ„Åù„Å∞„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-rose-50/20 rounded-lg p-5 border-2 border-rose-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üîó"}),u.jsx("div",{className:"text-2xl font-bold text-rose-600 mt-2",children:"OF"}),u.jsx("div",{className:"text-sm text-rose-700 mt-1",children:"„Äå„Äú„ÅÆÔºàÊâÄÂ±û„ÉªÈÉ®ÂàÜÔºâ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üëë"})," ÊâÄÂ±û„ÉªÊâÄÊúâÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üìö ",u.jsx("strong",{children:"the book of mine"})," ‚Üí ÁßÅ„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-rose-600",children:["üèõÔ∏è ",u.jsx("strong",{children:"the capital of Japan"})," ‚Üí Êó•Êú¨„ÅÆÈ¶ñÈÉΩ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß©"})," ÈÉ®ÂàÜÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üç∞ ",u.jsx("strong",{children:"a piece of cake"})," ‚Üí „Ç±„Éº„Ç≠‰∏ÄÂàá„Çå"]}),u.jsxs("div",{className:"text-rose-600",children:["üíß ",u.jsx("strong",{children:"a glass of water"})," ‚Üí „Ç≥„ÉÉ„Éó‰∏ÄÊùØ„ÅÆÊ∞¥"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üí´ ‰∏≠È†ªÂ∫¶„ÅÆÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üí≠"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"ABOUT"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„Å´„Å§„ÅÑ„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"})," Ë©±È°å„ÉªÂÜÖÂÆπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üìö ",u.jsx("strong",{children:"a book about history"})," ‚Üí Ê≠¥Âè≤„Å´„Å§„ÅÑ„Å¶„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-cyan-600",children:["üí¨ ",u.jsx("strong",{children:"talk about sports"})," ‚Üí „Çπ„Éù„Éº„ÉÑ„Å´„Å§„ÅÑ„Å¶Ë©±„Åô"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," „Åä„Åä„Çà„Åù„ÅÆÊï∞Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["‚è∞ ",u.jsx("strong",{children:"about 10 minutes"})," ‚Üí Á¥Ñ10ÂàÜ"]}),u.jsxs("div",{className:"text-cyan-600",children:["üë• ",u.jsx("strong",{children:"about 50 people"})," ‚Üí Á¥Ñ50‰∫∫"]})]})]})]})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≠Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"AFTER"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂæåÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"after dinner"})," ‚Üí Â§ïÈ£ü„ÅÆÂæå"]}),u.jsxs("div",{className:"text-lime-600",children:["üè´ ",u.jsx("strong",{children:"after school"})," ‚Üí ÊîæË™≤Âæå"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫èÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üî§ ",u.jsx("strong",{children:"after you"})," ‚Üí „ÅäÂÖà„Å´„Å©„ÅÜ„Åû"]}),u.jsxs("div",{className:"text-lime-600",children:["üìù ",u.jsx("strong",{children:"one after another"})," ‚Üí Ê¨°„ÄÖ„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-sky-50/20 rounded-lg p-5 border-2 border-sky-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚èÆÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-sky-600 mt-2",children:"BEFORE"}),u.jsx("div",{className:"text-sm text-sky-700 mt-1",children:"„Äå„Äú„ÅÆÂâç„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂâçÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"before breakfast"})," ‚Üí ÊúùÈ£üÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üéÑ ",u.jsx("strong",{children:"before Christmas"})," ‚Üí „ÇØ„É™„Çπ„Éû„Çπ„ÅÆÂâç"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫è„Éª‰ΩçÁΩÆÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üö™ ",u.jsx("strong",{children:"before the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üë• ",u.jsx("strong",{children:"before everyone"})," ‚Üí „Åø„Çì„Å™„ÅÆÂâç„Åß"]})]})]})]})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-violet-50/20 rounded-lg p-5 border-2 border-violet-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-violet-600 mt-2",children:"OVER"}),u.jsx("div",{className:"text-sm text-violet-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ä„ÇíË∂ä„Åà„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"ü¶Ö"})," ‰∏äÊñπ„ÉªË∂ä„Åà„ÇãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üåâ ",u.jsx("strong",{children:"over the bridge"})," ‚Üí Ê©ã„ÇíË∂ä„Åà„Å¶"]}),u.jsxs("div",{className:"text-violet-600",children:["üèîÔ∏è ",u.jsx("strong",{children:"over the mountain"})," ‚Üí Â±±„ÇíË∂ä„Åà„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," ‰ª•‰∏ä„ÉªË∂ÖÈÅéÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üë• ",u.jsx("strong",{children:"over 100 people"})," ‚Üí 100‰∫∫‰ª•‰∏ä"]}),u.jsxs("div",{className:"text-violet-600",children:["üí∞ ",u.jsx("strong",{children:"over $50"})," ‚Üí 50„Éâ„É´‰ª•‰∏ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-slate-50/20 rounded-lg p-5 border-2 border-slate-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚¨áÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-slate-600 mt-2",children:"UNDER"}),u.jsx("div",{className:"text-sm text-slate-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ã„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨áÔ∏è"})," ‰∏ãÊñπ„Éª‰∏ãÂÅ¥Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üå≥ ",u.jsx("strong",{children:"under the tree"})," ‚Üí Êú®„ÅÆ‰∏ã„Å´"]}),u.jsxs("div",{className:"text-slate-600",children:["üåâ ",u.jsx("strong",{children:"under the bridge"})," ‚Üí Ê©ã„ÅÆ‰∏ã„Å´"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," Êú™Ê∫ÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üë∂ ",u.jsx("strong",{children:"under 18"})," ‚Üí 18Ê≠≥Êú™Ê∫Ä"]}),u.jsxs("div",{className:"text-slate-600",children:["üí∞ ",u.jsx("strong",{children:"under $10"})," ‚Üí 10„Éâ„É´Êú™Ê∫Ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-fuchsia-50/20 rounded-lg p-5 border-2 border-fuchsia-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöá"}),u.jsx("div",{className:"text-2xl font-bold text-fuchsia-600 mt-2",children:"THROUGH"}),u.jsx("div",{className:"text-sm text-fuchsia-700 mt-1",children:"„Äå„Äú„ÇíÈÄö„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üö™"})," ÈÄöÈÅé„ÉªË≤´ÈÄöÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["ü™ü ",u.jsx("strong",{children:"through the window"})," ‚Üí Á™ì„ÇíÈÄö„Å£„Å¶"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üå≤ ",u.jsx("strong",{children:"through the forest"})," ‚Üí Ê£Æ„ÇíÊäú„Åë„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊúüÈñìÂÖ®‰ΩìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["üåô ",u.jsx("strong",{children:"through the night"})," ‚Üí ‰∏ÄÊô©‰∏≠"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üåßÔ∏è ",u.jsx("strong",{children:"through the winter"})," ‚Üí ÂÜ¨„ÅÆÈñì„Åö„Å£„Å®"]})]})]})]})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚ú® Áü•„Å£„Å¶„Åä„Åè„Å®‰æøÂà©„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-emerald-50/20 rounded-lg p-5 border-2 border-emerald-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚ÜîÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-emerald-600 mt-2",children:"BETWEEN"}),u.jsx("div",{className:"text-sm text-emerald-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà2„Å§Ôºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-emerald-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," 2„Å§„ÅÆÈñìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-emerald-600",children:["üè´üè• ",u.jsx("strong",{children:"between the school and hospital"})," ‚Üí Â≠¶Ê†°„Å®ÁóÖÈô¢„ÅÆÈñì"]}),u.jsxs("div",{className:"text-emerald-600",children:["üë• ",u.jsx("strong",{children:"between you and me"})," ‚Üí „ÅÇ„Å™„Åü„Å®ÁßÅ„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë•"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AMONG"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà3„Å§‰ª•‰∏äÔºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶"})," Ë§áÊï∞„ÅÆ‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üå∏ ",u.jsx("strong",{children:"among the flowers"})," ‚Üí Ëä±„ÄÖ„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-orange-600",children:["üë• ",u.jsx("strong",{children:"among friends"})," ‚Üí Âèã‰∫∫„Åü„Å°„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-red-50/20 rounded-lg p-5 border-2 border-red-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üö´"}),u.jsx("div",{className:"text-2xl font-bold text-red-600 mt-2",children:"WITHOUT"}),u.jsx("div",{className:"text-sm text-red-700 mt-1",children:"„Äå„Äú„Å™„Åó„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-red-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ùå"})," Ê¨†Â¶Ç„Éª‰∏çÂú®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-red-600",children:["üíß ",u.jsx("strong",{children:"without water"})," ‚Üí Ê∞¥„Å™„Åó„Åß"]}),u.jsxs("div",{className:"text-red-600",children:["üë§ ",u.jsx("strong",{children:"without you"})," ‚Üí „ÅÇ„Å™„Åü„Å™„Åó„Åß"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-yellow-50/20 rounded-lg p-5 border-2 border-yellow-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≥"}),u.jsx("div",{className:"text-2xl font-bold text-yellow-600 mt-2",children:"DURING"}),u.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-yellow-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," ÊúüÈñì‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-yellow-600",children:["üå¥ ",u.jsx("strong",{children:"during summer vacation"})," ‚Üí Â§è‰ºë„Åø„ÅÆÈñì"]}),u.jsxs("div",{className:"text-yellow-600",children:["üé• ",u.jsx("strong",{children:"during the movie"})," ‚Üí Êò†Áîª„ÅÆÈñì"]})]})]})})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è∞"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"UNTIL/TILL"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„Äå„Äú„Åæ„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," Á∂ôÁ∂ö„ÅÆÁµÇÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üåô ",u.jsx("strong",{children:"until midnight"})," ‚Üí ÁúüÂ§ú‰∏≠„Åæ„Åß"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"until next week"})," ‚Üí Êù•ÈÄ±„Åæ„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÜ"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"SINCE"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„Äå„Äú‰ª•Êù•„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," Ëµ∑ÁÇπ„Åã„ÇâÁ∂ôÁ∂öÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üéÇ ",u.jsx("strong",{children:"since last year"})," ‚Üí ÂéªÂπ¥„Åã„ÇâÔºà„Åö„Å£„Å®Ôºâ"]}),u.jsxs("div",{className:"text-blue-600",children:["üë∂ ",u.jsx("strong",{children:"since childhood"})," ‚Üí Â≠ê‰æõ„ÅÆÈ†É„Åã„Çâ"]})]})]})})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üè† Â†¥ÊâÄ„ÇíË°®„ÅôÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üè¢"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"INSIDE"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„Äå„Äú„ÅÆÂÜÖÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üì¶"})," ÂÜÖÂÅ¥„ÉªÂÜÖÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üè† ",u.jsx("strong",{children:"inside the house"})," ‚Üí ÂÆ∂„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-purple-600",children:["üì¶ ",u.jsx("strong",{children:"inside the box"})," ‚Üí ÁÆ±„ÅÆ‰∏≠„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üå≥"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"OUTSIDE"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„Äå„Äú„ÅÆÂ§ñÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üå≤"})," Â§ñÂÅ¥„ÉªÂ§ñÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üè° ",u.jsx("strong",{children:"outside the house"})," ‚Üí ÂÆ∂„ÅÆÂ§ñ„Å´"]}),u.jsxs("div",{className:"text-green-600",children:["üè´ ",u.jsx("strong",{children:"outside the school"})," ‚Üí Â≠¶Ê†°„ÅÆÂ§ñ„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"NEAR"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„ÅÆËøë„Åè„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üéØ"})," ËøëÊé•Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üöâ ",u.jsx("strong",{children:"near the station"})," ‚Üí ÈßÖ„ÅÆËøë„Åè„Å´"]}),u.jsxs("div",{className:"text-cyan-600",children:["üåä ",u.jsx("strong",{children:"near the sea"})," ‚Üí Êµ∑„ÅÆËøë„Åè„Å´"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë§"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"BEHIND"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Çç„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨ÖÔ∏è"})," ÂæåÊñπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üö™ ",u.jsx("strong",{children:"behind the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂæå„Çç„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üè† ",u.jsx("strong",{children:"behind the house"})," ‚Üí ÂÆ∂„ÅÆË£è„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"ACROSS"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„Äå„Äú„ÇíÊ®™Âàá„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ÜîÔ∏è"})," Ê®™Êñ≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"across the street"})," ‚Üí ÈÄö„Çä„ÇíÊ®™Âàá„Å£„Å¶"]}),u.jsxs("div",{className:"text-pink-600",children:["üåä ",u.jsx("strong",{children:"across the river"})," ‚Üí Â∑ù„ÇíÊ∏°„Å£„Å¶"]})]})]})})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üõ§Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"ALONG"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„Å´Ê≤ø„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚û°Ô∏è"})," Ê≤ø„Å£„Å¶ÈÄ≤„ÇÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"along the street"})," ‚Üí ÈÄö„Çä„Å´Ê≤ø„Å£„Å¶"]}),u.jsxs("div",{className:"text-lime-600",children:["üåä ",u.jsx("strong",{children:"along the river"})," ‚Üí Â∑ùÊ≤ø„ÅÑ„Å´"]})]})]})})]})]})})]}),wY=()=>{const n=[{symbol:".",name:"Period („Éî„É™„Ç™„Éâ)",usage:"Êñá„ÅÆÁµÇ„Çè„Çä",example:"I like cats.",explanation:"Âπ≥ÂèôÊñá„ÉªÂëΩ‰ª§Êñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:",",name:"Comma („Ç≥„É≥„Éû)",usage:"Âå∫Âàá„Çä„ÉªÂàóÊåô",example:"I bought apples, oranges, and bananas.",explanation:"ÂçòË™û„ÇÑÂè•„ÇíÂå∫Âàá„Çã„ÄÇÊé•Á∂öË©û„ÅÆÂâç„Å´„ÇÇ‰ΩøÁî®"},{symbol:"!",name:"Exclamation Mark (ÊÑüÂòÜÁ¨¶)",usage:"ÊÑüÂòÜ„ÉªÂº∑Ë™ø",example:"What a beautiful day!",explanation:"È©ö„Åç„ÉªÂñú„Å≥„ÉªÂº∑„ÅÑÊÑüÊÉÖ„ÇíË°®„Åô"},{symbol:"?",name:"Question Mark (ÁñëÂïèÁ¨¶)",usage:"ÁñëÂïè",example:"Do you like music?",explanation:"ÁñëÂïèÊñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:":",name:"Colon („Ç≥„É≠„É≥)",usage:"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•",example:"I have three pets: a dog, a cat, and a bird.",explanation:"Âæå„Çç„Å´Ë™¨Êòé„ÇÑÂàóÊåô„ÅåÁ∂ö„Åè„Åì„Å®„ÇíÁ§∫„Åô"},{symbol:";",name:"Semicolon („Çª„Éü„Ç≥„É≠„É≥)",usage:"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",example:"I love reading; my sister prefers sports.",explanation:"„Éî„É™„Ç™„Éâ„Çà„ÇäÂº±„Åè„ÄÅ„Ç≥„É≥„Éû„Çà„ÇäÂº∑„ÅÑÂå∫Âàá„Çä"},{symbol:"-",name:"Hyphen („Éè„Ç§„Éï„É≥)",usage:"Ë§áÂêàË™û„ÉªË£úË∂≥",example:"a well-known writer",explanation:"2„Å§‰ª•‰∏ä„ÅÆÂçòË™û„ÇíÁπã„Åí„Çã"},{symbol:"‚Äî",name:"Em Dash („ÉÄ„ÉÉ„Ç∑„É•)",usage:"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•",example:"My friends‚ÄîJohn and Mary‚Äîare coming.",explanation:"Ë£úË∂≥ÊÉÖÂ†±„ÇíÊåøÂÖ•„Åô„Çã"}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Ëã±ÊñáË®òÂè∑„ÅÆÊÑèÂë≥„Å®‰Ωø„ÅÑÊñπ"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-5 hover:shadow-lg transition-shadow border border-border-color",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[u.jsx("div",{className:"text-5xl font-bold text-primary flex-shrink-0",children:e.symbol}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-lg font-bold text-text-color",children:e.name}),u.jsx("p",{className:"text-sm text-primary font-semibold",children:e.usage})]})]}),u.jsx("div",{className:"bg-blue-50/20 rounded p-3 mb-3",children:u.jsx("div",{className:"font-mono text-sm text-blue-600",children:e.example})}),u.jsx("p",{className:"text-sm text-text-secondary",children:e.explanation})]},t))})]})},vY=()=>{const n=[{icon:"üìù",title:"ÊúÄÂàù„Å´Ê≥®Èáà„Å®Ë®≠Âïè„ÇíÁ¢∫Ë™ç",description:"Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´„ÄÅÊ≥®Èáà„Å®ÂïèÈ°å„Åã„ÇâÈáçË¶Å„Å™Êâã„Åå„Åã„Çä„ÇíÂæó„Çã",details:["Ê≥®Èáà„ÅØÂçò„Å´Èõ£„Åó„ÅÑÂçòË™û„ÅÆÊÑèÂë≥„Åß„ÅØ„Å™„Åè„ÄÅÂÜÖÂÆπÁêÜËß£„ÅÆ„Ç´„ÇÆ","Ê≥®Èáà„ÅÆÂçòË™û„ÇíÈÄ£ÊÉ≥„Åô„Çã„Å®Èï∑Êñá„ÅÆ„ÅÇ„Çâ„Åô„Åò„ÅåË¶ã„Åà„Å¶„Åè„Çã","Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ„ÇÑÂ§ßÊÑè„ÇíÂïè„ÅÜË®≠Âïè„Åã„Çâ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÊãæ„ÅÜ","ÈÉ®ÂàÜÁöÑ„Å™ÈÅ∏ÊäûÂïèÈ°å„ÅÆÈÅ∏ÊäûËÇ¢„Å´„ÇÇÂÖ±ÈÄö„Ç≠„Éº„ÉØ„Éº„Éâ„ÅåÈö†„Çå„Å¶„ÅÑ„Çã"]},{icon:"üéØ",title:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÅßÂÖ®‰ΩìÂÉè„ÇíÊé¥„ÇÄ",description:"Ëã±Ë™û„ÅÆÊñáÁ´†„ÅØ„ÄåÁµêË´ñÂÖàÂá∫„Åó„Äç„ÅåÂü∫Êú¨„ÄÇÊúÄÂàù„Å´ÂÖ®‰Ωì„ÅÆÊñπÂêëÊÄß„ÅåÁ§∫„Åï„Çå„Çã",example:{title:"The Importance of Reading Books",para1:"Reading books is one of the best ways to improve your knowledge and imagination. Many people think that reading is boring, but it actually helps you learn new things and understand the world better.",explanation:`„Çø„Ç§„Éà„É´: „ÄåÊú¨„ÇíË™≠„ÇÄÈáçË¶ÅÊÄß„Äç‚Üí „ÉÜ„Éº„ÉûÁ¢∫ÂÆö
Á¨¨1ÊÆµËêΩ: „ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅØÁü•Ë≠ò„Å®ÊÉ≥ÂÉèÂäõ„ÇíÈ´ò„ÇÅ„ÇãÊúÄËâØ„ÅÆÊñπÊ≥ï„ÅÆ1„Å§„Äç‚Üí Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ
‚Üí „Åì„ÅÆÊôÇÁÇπ„Åß„ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅÆËâØ„ÅÑÁÇπ„Å´„Å§„ÅÑ„Å¶Ëø∞„Åπ„ÇãÊñáÁ´†„Äç„Å†„Å®ÂàÜ„Åã„Çã`},details:["„Çø„Ç§„Éà„É´ ‚Üí Ë©±È°åÔºà„Éà„Éî„ÉÉ„ÇØÔºâ„ÇíÁ§∫„Åô","Á¨¨1ÊÆµËêΩ ‚Üí Á≠ÜËÄÖ„ÅÆÁ´ãÂ†¥„Éª‰∏ªÂºµ„ÇíÊòéÁ¢∫„Å´„Åô„Çã","„Äå‰Ωï„Å´„Å§„ÅÑ„Å¶„Äç„Äå„Å©„ÅÜËÄÉ„Åà„Å¶„ÅÑ„Çã„Åã„Äç„Çí„É°„É¢„Åô„Çã„Å®Êï¥ÁêÜ„Åó„ÇÑ„Åô„ÅÑ","ÂïèÈ°åÊèêËµ∑ÔºàÁñëÂïèÔºâ‚Üí Êú¨Êñá„ÅßÁ≠î„Åà„ÇíÊé¢„Åô„Éë„Çø„Éº„É≥„ÇÇÂ§ö„ÅÑ"]},{icon:"üìç",title:"ÊÆµËêΩ„ÅÆÊúÄÂàù„Å®ÊúÄÂæå„Å´Ê≥®ÁõÆ",description:"Ëã±Ë™û„ÅØ„Äå„Éë„É©„Ç∞„É©„Éï„Éª„É™„Éº„Éá„Ç£„É≥„Ç∞„Äç„ÄÇ1ÊÆµËêΩ = 1„Å§„ÅÆ‰∏ªÂºµ",example:{structure:`„ÄêÂÖ∏ÂûãÁöÑ„Å™ÊÆµËêΩÊßãÈÄ†„Äë
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ
„ÄåÈÅãÂãï„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Äç‚Üê ÊÆµËêΩ„ÅÆ‰∏ªÂºµ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‰∏≠ÈñìÈÉ®Ôºà„Çµ„Éù„Éº„ÉàÔºâ
ÁêÜÁî±1: ‰Ωì„ÅåÂº∑„Åè„Å™„Çã
ÁêÜÁî±2: „Çπ„Éà„É¨„ÇπËß£Ê∂à„Å´„Å™„Çã
ÂÖ∑‰Ωì‰æã: ÊØéÊó•30ÂàÜÊ≠©„Åè„Å†„Åë„ÅßÂäπÊûú
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ÊúÄÁµÇÊñáÔºà„Åæ„Å®„ÇÅÔºâ
„Äå„Å†„Åã„ÇâÈÅãÂãï„ÇíÁøíÊÖ£„Å´„Åô„Åπ„Åç„Äç‚Üê ÁµêË´ñ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`,tips:"Á¨¨1Êñá„Å®ÊúÄÁµÇÊñá„Å†„ÅëË™≠„ÇÅ„Å∞„ÄÅ„Åù„ÅÆÊÆµËêΩ„Åß‰Ωï„ÇíË®Ä„ÅÑ„Åü„ÅÑ„Åã„ÅåÂàÜ„Åã„ÇãÔºÅ"},details:["Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ: „Åù„ÅÆÊÆµËêΩ„ÅßÊúÄ„ÇÇË®Ä„ÅÑ„Åü„ÅÑ„Åì„Å®","‰∏≠ÈñìÈÉ®: ÁêÜÁî±„ÉªÂÖ∑‰Ωì‰æã„Éª„Éá„Éº„ÇøÔºàÈ£õ„Å∞„ÅóË™≠„ÅøOKÔºâ","ÊúÄÁµÇÊñá: „Åæ„Å®„ÇÅ„ÉªÁµêË´ñ„ÉªÊ¨°„ÅÆÊÆµËêΩ„Å∏„ÅÆÊ©ãÊ∏°„Åó","ÊÄ•„ÅÑ„Åß„ÅÑ„ÇãÊôÇ„ÅØÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å†„ÅëË™≠„ÇÄ„ÅÆ„ÇÇÊúâÂäπ"]},{icon:"üîó",title:"„Éá„Ç£„Çπ„Ç≥„Éº„Çπ„Éû„Éº„Ç´„Éº„ÇíË¶ãÈÄÉ„Åï„Å™„ÅÑ",description:"ÊñáÁ´†„ÅÆÊµÅ„Çå„ÇíÁ§∫„Åô„Å§„Å™„ÅéË®ÄËëâ„ÅåË´ñÁêÜÂ±ïÈñã„ÅÆ„Ç´„ÇÆ",details:["ÈÄÜÊé•: However, But, Yet, On the other hand","Âõ†Êûú: Therefore, So, Thus, As a result","‰æãÁ§∫: For example, For instance, Such as","ËøΩÂä†: In addition, Moreover, Furthermore","Ë®Ä„ÅÑÊèõ„Åà: In other words, That is, Namely"]},{icon:"üîç",title:"Ë®≠Âïè„ÅÆÁ®ÆÈ°ûÂà•„ÅÆÊîªÁï•Ê≥ï",description:"ÂïèÈ°å„ÅÆ„Çø„Ç§„Éó„Å´Âøú„Åò„ÅüË™≠„ÅøÊñπ„Çí‰Ωø„ÅÑÂàÜ„Åë„Çã",details:["‰∏ªÊó®ÂïèÈ°å: ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å®ÊúÄÁµÇÊÆµËêΩ„ÇíÈáçÁÇπÁöÑ„Å´","Ë©≥Á¥∞ÂïèÈ°å: „Ç≠„Éº„ÉØ„Éº„Éâ„ÅßË©≤ÂΩìÁÆáÊâÄ„ÇíÁâπÂÆö„Åó„Å¶Á≤æË™≠","Ë™ûÂΩôÂïèÈ°å: ÂâçÂæå„ÅÆÊñáËÑà„Åã„ÇâÊÑèÂë≥„ÇíÊé®Ê∏¨","ÊåáÁ§∫Ë™ûÂïèÈ°å: Áõ¥Ââç„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç","NOTÂïèÈ°å: Êú¨Êñá„Å´Êõ∏„Åã„Çå„Å¶„ÅÑ„Å™„ÅÑÈÅ∏ÊäûËÇ¢„ÇíÊé¢„Åô"]},{icon:"‚è±Ô∏è",title:"ÊôÇÈñìÈÖçÂàÜ„Å®ÂÑ™ÂÖàÈ†Ü‰Ωç",description:"ÂÖ®ÂïèËß£„Åè„Åü„ÇÅ„ÅÆÊà¶Áï•ÁöÑ„Å™ÊôÇÈñìÁÆ°ÁêÜ",details:["1Âïè„ÅÇ„Åü„Çä„ÅÆÁõÆÂÆâÊôÇÈñì„ÇíÊ±∫„ÇÅ„ÇãÔºà‰æã: 3ÂàÜ/ÂïèÔºâ","Êòì„Åó„ÅÑÂïèÈ°å„Åã„ÇâËß£„ÅÑ„Å¶ÂæóÁÇπ„ÇíÁ¢∫‰øù","Èõ£Âïè„ÅØÂæåÂõû„Åó„ÄÅÊúÄÂæå„Å´Êàª„Çã","ÊúÄ‰Ωé5ÂàÜ„ÅØË¶ãÁõ¥„ÅóÊôÇÈñì„ÇíÁ¢∫‰øù"]},{icon:"‚ùì",title:"ÂàÜ„Åã„Çâ„Å™„ÅÑÈÉ®ÂàÜ„ÅÆÂØæÂá¶Ê≥ï",description:"ÂÆåÁíß„ÇíÁõÆÊåá„Åï„Åö„ÄÅÂäπÁéáÁöÑ„Å´ÂæóÁÇπ„Åô„Çã",details:["Áü•„Çâ„Å™„ÅÑÂçòË™û„ÅØÂâçÂæå„Åã„ÇâÊé®Ê∏¨ÔºàÂìÅË©û„ÉªËÇØÂÆöÂê¶ÂÆö„ÇíÂà§Êñ≠Ôºâ","‰∏ÄÊñá„ÅåÂàÜ„Åã„Çâ„Å™„Åè„Å¶„ÇÇÊÆµËêΩÂÖ®‰Ωì„Åã„ÇâÊÑèÂë≥„ÇíÊé¥„ÇÄ","Á¥∞ÈÉ®„Çà„ÇäÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÂÑ™ÂÖà","Ê∂àÂéªÊ≥ï„ÅßÈÅ∏ÊäûËÇ¢„ÇíÁµû„ÇãÔºàÊòé„Çâ„Åã„Å´ÈÅï„ÅÜ„ÇÇ„ÅÆ„ÇíÈô§Â§ñÔºâ"]}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Èï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑ"}),u.jsx("div",{className:"bg-yellow-50/20 rounded-lg p-6 border-l-4 border-yellow-500 mb-6",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl",children:"üí°"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-lg text-yellow-800 mb-2",children:"Âü∫Êú¨Êà¶Áï•"}),u.jsx("p",{className:"text-yellow-700 mb-3",children:"Èï∑ÊñáË™≠Ëß£„ÅØ„ÄåÂÆåÁíß„Å´ÁêÜËß£„Åô„Çã„Äç„ÅÆ„Åß„ÅØ„Å™„Åè„ÄåÂøÖË¶Å„Å™ÊÉÖÂ†±„ÇíÂäπÁéáÁöÑ„Å´Ë¶ã„Å§„Åë„Çã„Äç‰ΩúÊ•≠„Åß„Åô„ÄÇ Ê≥®Èáà„Å®Ë®≠Âïè„Åã„ÇâÊâã„Åå„Åã„Çä„ÇíÂæó„Å¶„ÄÅÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÊé¥„Åø„Å™„Åå„Çâ„ÄÅËß£Á≠î„Å´ÂøÖË¶Å„Å™ÈÉ®ÂàÜ„ÇíÊé¢„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),u.jsxs("div",{className:"bg-yellow-100/30 rounded p-3 text-sm",children:[u.jsx("p",{className:"font-semibold text-yellow-900 mb-1",children:"‚ö° ÊúÄÈáçË¶Å„Éù„Ç§„É≥„Éà"}),u.jsx("p",{className:"text-yellow-800",children:"Ë™≠„ÇÄÈ†ÜÁï™: ‚ë† Ê≥®Èáà ‚Üí ‚ë° Ë®≠Âïè„ÉªÈÅ∏ÊäûËÇ¢ ‚Üí ‚ë¢ „Çø„Ç§„Éà„É´„ÉªÁ¨¨1ÊÆµËêΩ ‚Üí ‚ë£ ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá ‚Üí ‚ë§ ÂøÖË¶ÅÁÆáÊâÄ„ÇíÁ≤æË™≠"})]})]})]})}),u.jsx("div",{className:"space-y-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6 hover:shadow-lg transition-shadow border-l-4 border-primary/30",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[u.jsx("span",{className:"text-4xl",children:e.icon}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-text-color mb-2",children:e.title}),u.jsx("p",{className:"text-text-secondary",children:e.description})]})]}),e.example&&u.jsx("div",{className:"ml-14 mb-4 bg-blue-50/20 rounded-lg p-4 border border-blue-200",children:u.jsxs("div",{className:"space-y-3",children:[e.example.title&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìå „Çø„Ç§„Éà„É´‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 font-mono text-sm text-blue-700",children:e.example.title})]}),e.example.para1&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìÑ Á¨¨1ÊÆµËêΩ‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 text-sm text-gray-700 leading-relaxed",children:e.example.para1})]}),e.example.structure&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìä ÊÆµËêΩ„ÅÆÊßãÈÄ†"}),u.jsx("div",{className:"bg-white rounded p-3 text-sm font-mono whitespace-pre-line text-gray-700",children:e.example.structure})]}),e.example.explanation&&u.jsxs("div",{className:"bg-yellow-50/30 rounded p-3 border-l-2 border-yellow-500",children:[u.jsx("div",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"üí° Ë™≠„ÅøÂèñ„Çå„Çã„Åì„Å®"}),u.jsx("div",{className:"text-sm text-yellow-700 whitespace-pre-line",children:e.example.explanation})]}),e.example.tips&&u.jsx("div",{className:"bg-green-50/30 rounded p-3 border-l-2 border-green-500",children:u.jsxs("div",{className:"text-sm font-semibold text-green-700",children:["‚ú® ",e.example.tips]})})]})}),u.jsx("ul",{className:"space-y-2 ml-14",children:e.details.map((s,r)=>u.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[u.jsx("span",{className:"text-primary mt-1",children:"‚úì"}),u.jsx("span",{className:"text-text-color",children:s})]},r))})]},t))}),u.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50/20/20 rounded-lg p-6 mt-8 border-2 border-blue-300",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"}),u.jsx("span",{children:"ÂÆüË∑µÔºÅÂäπÁéáÁöÑ„Å™Ë™≠Ëß£ÊâãÈ†Ü"})]}),u.jsx("ol",{className:"space-y-3",children:[{step:"Ê≥®Èáà„ÇíË™≠„ÇÄ",detail:"‚Üí ÈáçË¶ÅÂçòË™û„Åã„ÇâÂÜÖÂÆπ„Çí‰∫àÊÉ≥"},{step:"Ë®≠Âïè„Å®ÈÅ∏ÊäûËÇ¢„ÇíË™≠„ÇÄ",detail:"‚Üí ‰Ωï„ÇíËÅû„Åã„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ"},{step:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÇíË™≠„ÇÄ",detail:"‚Üí „ÉÜ„Éº„Éû„Å®Ë´ñÁÇπ„ÇíÊääÊè°"},{step:"ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„ÇíÊµÅ„ÅóË™≠„Åø",detail:"‚Üí ÂÖ®‰ΩìÊßãÊàê„ÇíÁêÜËß£"},{step:"Ë®≠Âïè„Å´Èñ¢ÈÄ£„Åô„ÇãÊÆµËêΩ„ÇíÁ≤æË™≠",detail:"‚Üí Á≠î„Åà„ÅÆÊ†πÊã†„ÇíÊé¢„Åô"},{step:"ÈÅ∏ÊäûËÇ¢„ÇíÊú¨Êñá„Å®ÁÖß„Çâ„ÅóÂêà„Çè„Åõ„Çã",detail:"‚Üí Ê†πÊã†„Åå„ÅÇ„ÇãÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏„Å∂"},{step:"Ë¶ãÁõ¥„Åó",detail:"‚Üí ÈÅ∏„Çì„Å†Á≠î„Åà„ÅåÊú¨Êñá„ÅÆÂÜÖÂÆπ„Å®ÁüõÁõæ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç"}].map((e,t)=>u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:t+1}),u.jsxs("div",{children:[u.jsx("span",{className:"text-text-color font-semibold",children:e.step}),u.jsx("span",{className:"text-text-secondary text-sm ml-2",children:e.detail})]})]},t))})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-6 border-l-4 border-green-500",children:[u.jsxs("h3",{className:"text-lg font-bold text-green-800 mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üìå"}),u.jsx("span",{children:"Ê≥®Èáà„ÅÆÂäπÊûúÁöÑ„Å™Ê¥ªÁî®Ê≥ï"})]}),u.jsxs("div",{className:"space-y-2 text-sm text-green-700",children:[u.jsxs("p",{children:["‚úì ",u.jsx("strong",{children:"Ê≥®Èáà„Åå„ÅÇ„Çã = „Åù„ÅÆÂçòË™û„ÅåÂÜÖÂÆπÁêÜËß£„Å´ÂøÖÈ†à"}),"„Å®„ÅÑ„ÅÜÂá∫È°åËÄÖ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏"]}),u.jsx("p",{children:"‚úì Ê≥®Èáà„ÅÆÂçòË™û„Çí‰∏¶„Åπ„Çã„Å®„ÄÅÈï∑Êñá„ÅÆ„ÉÜ„Éº„Éû„ÇÑ„Çπ„Éà„Éº„É™„Éº„ÅåÊµÆ„Åã„Å≥‰∏ä„Åå„Çã"}),u.jsx("p",{children:"‚úì ‰æã: „ÄåÁí∞Â¢É„Äç„ÄåÊ±öÊüì„Äç„ÄåÂØæÁ≠ñ„Äç‚Üí Áí∞Â¢ÉÂïèÈ°å„Å´„Å§„ÅÑ„Å¶„ÅÆÊñáÁ´†„Å†„Å®‰∫àÊ∏¨„Åß„Åç„Çã"}),u.jsx("p",{className:"pt-2 italic",children:"üí° Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´Ê≥®Èáà„Å†„Åë„ÅßÂÜÖÂÆπ„Çí‰∫àÊÉ≥„Åô„ÇãÁ∑¥Áøí„Çí„Åô„Çã„Å®ÂäπÊûúÁöÑÔºÅ"})]})]})]})},SY=()=>u.jsx("div",{className:"dictionary-view",children:u.jsxs("div",{className:"dictionary-container",children:[u.jsx("h2",{children:"üìö Ëã±ÂçòË™ûËæûÊõ∏"}),u.jsx("p",{className:"coming-soon",children:"ËæûÊõ∏Ê©üËÉΩ„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô"})]})}),CY=({isOpen:n,onClose:e,sets:t,onCreateSet:s,onDeleteSet:r,onEditSet:o,onRemoveWord:i})=>{const[a,c]=$.useState("manage"),[l,d]=$.useState(""),[h,p]=$.useState(""),[f,m]=$.useState(null),[g,x]=$.useState(null),[y,b]=$.useState(""),[v,w]=$.useState("");if(!n)return null;const S=()=>{l.trim()&&(s(l.trim(),h.trim()||void 0),d(""),p(""),c("manage"))},N=I=>{x(I.id),b(I.name),w(I.description||"")},C=()=>{g&&y.trim()&&(o(g,y.trim(),v.trim()||void 0),x(null))},k=()=>{x(null),b(""),w("")};return u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl sm:max-w-4xl w-full mx-auto max-h-[90vh] flex flex-col",children:[u.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"üìö „Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÁÆ°ÁêÜ"}),u.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700:text-gray-200 text-2xl","aria-label":"Èñâ„Åò„Çã",children:"‚úï"})]}),u.jsxs("div",{className:"flex border-b border-gray-200",children:[u.jsxs("button",{onClick:()=>c("manage"),className:`flex-1 px-6 py-3 font-medium ${a==="manage"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:["üìã „Çª„ÉÉ„ÉàÁÆ°ÁêÜ (",t.length,")"]}),u.jsx("button",{onClick:()=>c("create"),className:`flex-1 px-6 py-3 font-medium ${a==="create"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:"‚ûï Êñ∞Ë¶è‰ΩúÊàê"})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a==="manage"?u.jsx("div",{className:"space-y-4",children:t.length===0?u.jsxs("div",{className:"text-center py-12 text-gray-500",children:[u.jsx("p",{className:"text-lg mb-2",children:"üìù „Åæ„Å†„Çª„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-sm",children:"„ÄåÊñ∞Ë¶è‰ΩúÊàê„Äç„Çø„Éñ„Åã„ÇâÊúÄÂàù„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Çä„Åæ„Åó„Çá„ÅÜ"})]}):t.map(I=>u.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[u.jsx("div",{className:"bg-gray-50 p-4",children:g===I.id?u.jsxs("div",{className:"space-y-2",children:[u.jsx("input",{type:"text",value:y,onChange:T=>b(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"„Çª„ÉÉ„ÉàÂêç"}),u.jsx("textarea",{value:v,onChange:T=>w(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ",rows:2}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"‰øùÂ≠ò"}),u.jsx("button",{onClick:k,className:"px-4 py-2 bg-gray-300 text-gray-900 rounded-md hover:bg-gray-400:bg-gray-500",children:"„Ç≠„É£„É≥„Çª„É´"})]})]}):u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-2xl",children:I.icon||"üìñ"}),u.jsx("h3",{className:"text-lg font-bold text-gray-900",children:I.name}),u.jsxs("span",{className:"text-sm text-gray-500",children:["(",I.words.length,"Ë™û)"]})]}),I.description&&u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:I.description}),u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["‰ΩúÊàê: ",new Date(I.createdAt).toLocaleDateString("ja-JP")]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>N(I),className:"text-blue-600 hover:text-blue-700:text-blue-300 text-sm","aria-label":"Á∑®ÈõÜ",children:"‚úèÔ∏è"}),u.jsx("button",{onClick:()=>m(f===I.id?null:I.id),className:"text-gray-600 hover:text-gray-700:text-gray-300 text-sm","aria-label":f===I.id?"Êäò„Çä„Åü„Åü„ÇÄ":"Â±ïÈñã",children:f===I.id?"‚ñ≤":"‚ñº"}),u.jsx("button",{onClick:()=>{confirm(`„Äå${I.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)&&r(I.id)},className:"text-red-600 hover:text-red-700:text-red-300 text-sm","aria-label":"ÂâäÈô§",children:"üóëÔ∏è"})]})]})}),f===I.id&&u.jsx("div",{className:"p-4 bg-white",children:I.words.length===0?u.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"„Åæ„Å†ÂçòË™û„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):u.jsx("div",{className:"space-y-2",children:I.words.map((T,_)=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-semibold text-gray-900",children:T.word}),T.ipa&&u.jsxs("span",{className:"text-sm text-blue-600",children:["/",T.ipa,"/"]})]}),u.jsx("p",{className:"text-sm text-gray-700 mt-1",children:T.meaning}),T.source&&u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Âá∫ÂÖ∏: ",T.source,T.sourceDetail&&` (${T.sourceDetail})`]})]}),u.jsx("button",{onClick:()=>i(I.id,T),className:"ml-4 text-red-600 hover:text-red-700:text-red-300","aria-label":"ÂâäÈô§",children:"‚ûñ"})]},`${T.word}-${_}`))})})]},I.id))}):u.jsxs("div",{className:"max-w-2xl mx-auto",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["„Çª„ÉÉ„ÉàÂêç ",u.jsx("span",{className:"text-red-500",children:"*"})]}),u.jsx("input",{type:"text",value:l,onChange:I=>d(I.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: Ëã¶Êâã„Å™ÂâçÁΩÆË©û"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ"}),u.jsx("textarea",{value:h,onChange:I=>p(I.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: È´òÊ†°ÂÖ•Ë©¶„Åß„Çà„ÅèÂá∫„ÇãÂâçÁΩÆË©û„Çí„Åæ„Å®„ÇÅ„Åü„Çª„ÉÉ„Éà",rows:3})]}),u.jsx("button",{onClick:S,disabled:!l.trim(),className:"w-full px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300:bg-gray-600 disabled:cursor-not-allowed font-medium",children:"‚ûï „Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})]}),u.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[u.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"üí° „Éí„É≥„Éà"}),u.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„Éà„Çí‰ΩúÊàêÂæå„ÄÅÂêÑ„Çø„Éñ„ÅÆ+„Éú„Çø„É≥„ÅßÂçòË™û„ÇíËøΩÂä†„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„ÉàÂêç„ÅØÂæå„Åã„ÇâÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ Ë§áÊï∞„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Å£„Å¶„ÄÅ„ÉÜ„Éº„Éû„Åî„Å®„Å´Êï¥ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ"})]})]})]})})]})})},zy="ai_predictions_log",Wy=1e4;class ef{constructor(e){Ne(this,"cache",null);Ne(this,"storage");this.storage=e||NY()}async logPrediction(e,t,s){const r={predicted:t,actual:s,word:e,timestamp:Date.now()};if(this.cache===null&&await this.loadCache(),this.cache.push(r),this.cache.length>Wy){const o=this.cache.length-Wy;this.cache.splice(0,o)}await this.saveCache()}async getRecentPredictions(e=1e3){this.cache===null&&await this.loadCache();const t=Math.max(0,this.cache.length-e);return this.cache.slice(t).reverse()}async getAllPredictions(){return this.cache===null&&await this.loadCache(),[...this.cache]}async getPredictionsByTimeRange(e,t=Date.now()){return this.cache===null&&await this.loadCache(),this.cache.filter(s=>s.timestamp&&s.timestamp>=e&&s.timestamp<=t)}async getPredictionsByWord(e){return this.cache===null&&await this.loadCache(),this.cache.filter(t=>t.word===e)}async getStats(){this.cache===null&&await this.loadCache();const e=this.cache.map(s=>s.timestamp).filter(s=>s!==void 0),t=new Set(this.cache.map(s=>s.word)).size;return{total:this.cache.length,oldest:e.length>0?Math.min(...e):null,newest:e.length>0?Math.max(...e):null,uniqueWords:t}}async clearLogs(){this.cache=[],await this.saveCache()}async loadCache(){try{const e=await this.storage.getItem(zy);e&&Array.isArray(e)?this.cache=e:this.cache=[]}catch(e){console.error("Failed to load prediction logs:",e),this.cache=[]}}async saveCache(){try{await this.storage.setItem(zy,this.cache)}catch(e){console.error("Failed to save prediction logs:",e)}}}function NY(){const n=new Map;return{async getItem(e){return n.get(e)},async setItem(e,t){n.set(e,t)}}}let Jl=null;function PI(){return Jl||(typeof window<"u"&&gs(async()=>{const{loadSetting:n,saveSetting:e}=await Promise.resolve().then(()=>lk);return{loadSetting:n,saveSetting:e}},void 0).then(({loadSetting:n,saveSetting:e})=>{const t={async getItem(s){return n(s)},async setItem(s,r){await e(s,r)}};Jl=new ef(t)}),Jl=new ef),Jl}const IY=Object.freeze(Object.defineProperty({__proto__:null,PredictionLogger:ef,getPredictionLogger:PI},Symbol.toStringTag,{value:"Module"}));function kY(n){return n.length===0?0:n.reduce((t,s)=>t+Math.abs(s.predicted-s.actual),0)/n.length*100}function $Y(n,e=10){if(n.length===0)return{ece:0,mae:0,count:0,bins:[],overallAccuracy:0,averagePrediction:0};const t=TY(n,e),s=t.reduce((l,d)=>l+d.weight*d.error,0),r=kY(n),i=n.filter(l=>l.actual===1).length/n.length,c=n.reduce((l,d)=>l+d.predicted,0)/n.length;return{ece:s,mae:r,count:n.length,bins:t,overallAccuracy:i,averagePrediction:c}}function TY(n,e){const t=1/e,s=[];for(let r=0;r<e;r++){const o=r*t,i=(r+1)*t,a=n.filter(g=>r===e-1?g.predicted>=o&&g.predicted<=i:g.predicted>=o&&g.predicted<i);if(a.length===0){s.push({range:[o,i],midpoint:(o+i)/2,count:0,averagePrediction:0,actualAccuracy:0,weight:0,error:0});continue}const c=a.length,l=c/n.length,h=a.reduce((g,x)=>g+x.predicted,0)/c,f=a.filter(g=>g.actual===1).length/c,m=Math.abs(h-f);s.push({range:[o,i],midpoint:(o+i)/2,count:c,averagePrediction:h,actualAccuracy:f,weight:l,error:m})}return s}function AY(n){return n<=.05?"excellent":n<=.1?"good":n<=.15?"fair":"poor"}function EY(n){return n<=10?"excellent":n<=20?"good":n<=30?"fair":"poor"}const RY=({minPredictions:n=100})=>{const[e,t]=$.useState(null),[s,r]=$.useState(!0),[o,i]=$.useState(null),a=async()=>{r(!0),i(null);try{const m=await PI().getAllPredictions();if(m.length===0){i("‰∫àÊ∏¨„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),t(null);return}const g=$Y(m,10);t(g)}catch(f){console.error("Failed to load calibration data:",f),i("„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}finally{r(!1)}};if($.useEffect(()=>{a()},[]),s)return u.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:u.jsxs("div",{className:"animate-pulse",children:[u.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})});if(o||!e)return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",children:[u.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsx("p",{className:"text-yellow-800",children:o||"‰∫àÊ∏¨„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})})]});const c=AY(e.ece),l=EY(e.mae),d={excellent:"text-green-600",good:"text-blue-600",fair:"text-yellow-600",poor:"text-red-600"},h={excellent:"üåü",good:"üëç",fair:"‚ö†Ô∏è",poor:"‚ùå"},p=e.count<n;return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"üîÑ Êõ¥Êñ∞"})]}),p&&u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsxs("p",{className:"text-yellow-800",children:["‚ö†Ô∏è ‰∫àÊ∏¨Êï∞„Åå",n,"‰ª∂Êú™Ê∫Ä„Åß„ÅôÔºàÁèæÂú®",e.count,"‰ª∂Ôºâ„ÄÇ „Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Å´„ÅØ",n,"‰ª∂‰ª•‰∏ä„ÅÆ‰∫àÊ∏¨„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô„ÄÇ"]})}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ECEÔºàExpected Calibration ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.ece*100).toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[c]}`,children:[h[c]," ",c]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"‰∫àÊ∏¨Á¢∫Áéá„Å®ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá„ÅÆÂ∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"MAEÔºàMean Absolute ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[e.mae.toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[l]}`,children:[h[l]," ",l]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Âπ≥ÂùáÁµ∂ÂØæË™§Â∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ÂÖ®‰ΩìÊ≠£Ëß£Áéá"}),u.jsx("div",{className:"flex items-baseline gap-2",children:u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})}),u.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["‰∫àÊ∏¨Êï∞: ",e.count,"‰ª∂"]})]})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:"„Éì„É≥Âà•„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥"}),u.jsx("div",{className:"space-y-2",children:e.bins.filter(f=>f.count>0).map((f,m)=>u.jsx(DY,{bin:f},m))}),u.jsx("div",{className:"mt-4 text-xs text-gray-500",children:"ÁêÜÊÉ≥ÁöÑ„Å™‰∫àÊ∏¨„Åß„ÅØ„ÄÅÂêÑ„Éì„É≥„ÅÆ„Äå‰∫àÊ∏¨„Äç„Å®„ÄåÂÆüÈöõ„Äç„Åå‰∏ÄËá¥„Åó„Åæ„Åô„ÄÇ „Éì„É≥„ÅØ‰∫àÊ∏¨Á¢∫Áéá„Çí10ÂàÜÂâ≤„Åó„Åü„Ç∞„É´„Éº„Éó„Åß„Åô„ÄÇ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-800",children:"‰∫àÊ∏¨„ÅÆÂÇæÂêë"}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"Âπ≥Âùá‰∫àÊ∏¨Á¢∫Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.averagePrediction*100).toFixed(1),"%"]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})]}),u.jsx("div",{className:"ml-auto",children:e.averagePrediction>e.overallAccuracy+.05?u.jsx("span",{className:"px-3 py-1 bg-red-100/30 text-red-700 rounded-full text-sm",children:"ÈÅé‰ø°ÂÇæÂêë"}):e.averagePrediction<e.overallAccuracy-.05?u.jsx("span",{className:"px-3 py-1 bg-blue-100/30 text-blue-700 rounded-full text-sm",children:"ÈÅéÂ∞èË©ï‰æ°ÂÇæÂêë"}):u.jsx("span",{className:"px-3 py-1 bg-green-100/30 text-green-700 rounded-full text-sm",children:"„Éê„É©„É≥„ÇπËâØÂ•Ω"})})]})]})]})},DY=({bin:n})=>{const[e,t]=n.range,s=n.averagePrediction*100,r=n.actualAccuracy*100,o=Math.abs(s-r),i=o<5?"bg-green-500":o<10?"bg-blue-500":o<15?"bg-yellow-500":"bg-red-500";return u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[u.jsxs("span",{children:[(e*100).toFixed(0),"%-",(t*100).toFixed(0),"% Ôºà",n.count,"‰ª∂Ôºâ"]}),u.jsxs("span",{children:["Ë™§Â∑Æ: ",o.toFixed(1),"%"]})]}),u.jsxs("div",{className:"relative h-6 bg-gray-200 rounded",children:[u.jsx("div",{className:"absolute h-full bg-blue-300 rounded opacity-50",style:{width:`${s}%`}}),u.jsx("div",{className:`absolute h-full ${i} rounded`,style:{width:`${r}%`}}),u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800",children:["‰∫àÊ∏¨ ",s.toFixed(0),"% / ÂÆüÈöõ ",r.toFixed(0),"%"]})]})]})};function jY({onResetComplete:n,allQuestions:e,onQuestionSetsUpdated:t}){const[s,r]=$.useState(!1),[o,i]=$.useState(null),[a,c]=$.useState(!1),[l,d]=$.useState(null),[h,p]=$.useState(null),[f,m]=$.useState([]),[g,x]=$.useState(null),[y,b]=$.useState([]),[v,w]=$.useState([]),[S,N]=$.useState([]),[C,k]=$.useState(0),I=()=>{try{let D=0;const P=[];for(let A=0;A<localStorage.length;A++){const F=localStorage.key(A);if(F){const O=localStorage.getItem(F);if(O){const V=new Blob([O]).size;D+=V,P.push({key:F,sizeMB:V/(1024*1024)})}}}P.sort((A,F)=>F.sizeMB-A.sizeMB),i({totalMB:D/(1024*1024),details:P.slice(0,5)})}catch(D){R.error("„Çπ„Éà„É¨„Éº„Ç∏„Çµ„Ç§„Ç∫„ÅÆÂèñÂæó„Ç®„É©„Éº:",D)}},T=$.useCallback(()=>{d(Jg()),p(Zg()),m(h0(12)),x(p0());const P=Ih(10).map(F=>{const O=e.find(V=>V.word&&F.word&&V.word.toLowerCase()===F.word.toLowerCase());return{...F,etymology:O==null?void 0:O.etymology,relatedWords:O==null?void 0:O.relatedWords,difficulty:O==null?void 0:O.difficulty}});b(P),w(s0(10)),N(e0(7,5));const A=et();k(A.statistics.streakDays),I()},[e]);$.useEffect(()=>{T();const D=async()=>{const F=(await Th()).some(O=>O.source==="weak-words");c(F)};D();const P=()=>{T(),D()};if(typeof window<"u"&&window.addEventListener(ea,P),s){const A=setInterval(()=>{T(),D()},1e3);return()=>{clearInterval(A),typeof window<"u"&&window.removeEventListener(ea,P)}}return()=>{typeof window<"u"&&window.removeEventListener(ea,P)}},[s,T]);const _=()=>{confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ")&&(u0(),d(null),p(null),m([]),x(null),b([]),w([]),N([]),k(0),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),T(),n&&n())};return u.jsxs("div",{className:"stats-view",children:[u.jsx("div",{className:"w-full mb-4 px-2",children:u.jsx(RY,{minPredictions:50})}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üìÜ Â≠¶Áøí„Ç´„É¨„É≥„ÉÄ„Éº",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàÈÅéÂéª7Êó•ÈñìÔºâ"})]}),u.jsx(_Y,{streakDays:C})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üò∞ Ëã¶ÊâãÂçòË™û„Éà„ÉÉ„Éó10",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàË¶ÅÂæ©ÁøíÔºâ"})]}),y.length>0?u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-orange-200 p-6",children:[u.jsx("ul",{className:"space-y-3",children:y.map((D,P)=>u.jsx("li",{className:"p-4 bg-gradient-to-r from-orange-50 to-red-50/30/30 rounded-lg border border-orange-200 hover:shadow-md hover:scale-[1.02] transition-all duration-200",children:u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[u.jsx("span",{className:"flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full text-sm",children:P+1}),u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:D.word}),D.meaning&&u.jsx("span",{className:"text-sm text-gray-600 mt-1",children:D.meaning}),D.reading&&u.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:D.reading}),D.etymology&&u.jsxs("span",{className:"text-xs text-blue-600 mt-1",children:["üìñ ",D.etymology]}),D.relatedWords&&u.jsxs("span",{className:"text-xs text-purple-600 mt-0.5",children:["üîó ",D.relatedWords]})]})]}),u.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[u.jsxs("span",{className:"px-3 py-1 bg-red-100/50 text-red-700 rounded-full font-medium",children:["‚ùå ",D.mistakes,"Âõû"]}),D.recentAccuracy>0&&u.jsxs("span",{className:"px-3 py-1 bg-blue-100/50 text-blue-700 rounded-full font-medium",children:["Ê≠£Ëß£Áéá ",D.recentAccuracy,"%"]})]})]})},P))}),u.jsxs("div",{className:"mt-6 flex gap-3",children:[u.jsxs("button",{onClick:async()=>{try{const D=await Gu(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")}`,20,3,60,e);await Uu(D),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${D.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(D){R.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",D),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2",children:["üìö ÂïèÈ°å„Çª„ÉÉ„Éà„Çí",a?"Êõ¥Êñ∞":"‰ΩúÊàê",u.jsx("span",{className:"text-xs opacity-90",children:"(‰∏ä‰Ωç20Ë™û)"})]}),u.jsx("button",{onClick:async()=>{const D=prompt("ÂèñÂæó„Åô„ÇãËã¶ÊâãË™ûÂè•„ÅÆÊï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1-100Ôºâ","30");if(!D)return;const P=parseInt(D);if(isNaN(P)||P<1||P>100){alert("1„Åã„Çâ100„Åæ„Åß„ÅÆÊï∞ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}try{const A=await Gu(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")} (${P}Ë™û)`,P,3,60,e);await Uu(A),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${A.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(A){R.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",A),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚öôÔ∏è „Ç´„Çπ„Çø„É†"})]})]}):u.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50/20/20 rounded-xl border-2 border-dashed border-green-300 p-8 text-center",children:[u.jsx("p",{className:"text-xl font-semibold text-green-700",children:"Ëã¶Êâã„Å™ÂçòË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅüéâ"}),u.jsx("p",{className:"text-sm text-green-600 mt-2",children:"È†ÜË™ø„Å´Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô"})]})]}),u.jsx("div",{className:"w-full mb-4 px-2",children:u.jsx("div",{className:"bg-white rounded-xl shadow-lg border-2 border-red-200 p-6",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"‚ö†Ô∏è „Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„Éà"}),u.jsx("p",{className:"text-sm text-gray-600",children:"„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"})]}),u.jsx("button",{onClick:_,className:"px-8 py-3 bg-red-600 hover:bg-red-700:bg-red-800 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2",children:"üóëÔ∏è „É™„Çª„ÉÉ„ÉàÂÆüË°å"})]})})}),o&&u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"üíæ „Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè"}),u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-purple-200 p-6",children:[u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"ÂêàË®à‰ΩøÁî®Èáè"}),u.jsxs("span",{className:`text-xl font-bold ${o.totalMB>4?"text-red-600":"text-green-600"}`,children:[o.totalMB.toFixed(2)," MB"," ",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/ Á¥Ñ 5-10 MB"})]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden relative",children:u.jsx("div",{className:`h-full rounded-full transition-all duration-500 absolute left-0 top-0 ${o.totalMB>8?"bg-red-600 w-full":o.totalMB>4?"bg-yellow-500":"bg-green-500"}`,"data-progress":Math.min(o.totalMB/10*100,100)})}),o.totalMB>4&&u.jsx("p",{className:"mt-2 text-sm font-medium text-red-600 flex items-center gap-1",children:"‚ö†Ô∏è ÂÆπÈáè„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})]}),u.jsxs("details",{className:"mt-4",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-700:text-blue-300 font-medium flex items-center gap-2",children:"üìä Ë©≥Á¥∞„ÇíË°®Á§∫"}),u.jsx("ul",{className:"mt-4 space-y-2",children:o.details.map((D,P)=>u.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[u.jsx("code",{className:"text-sm text-gray-700 font-mono",children:D.key}),u.jsxs("span",{className:"text-sm font-semibold text-gray-800",children:[D.sizeMB.toFixed(2)," MB"]})]},P))}),u.jsx("div",{className:"mt-4 p-4 bg-blue-50/20 rounded-lg border border-blue-200",children:u.jsxs("p",{className:"text-sm text-blue-700 flex items-start gap-2",children:[u.jsx("span",{className:"text-lg",children:"üí°"}),u.jsx("span",{children:"„Éí„É≥„Éà: „Éá„Éº„Çø„ÅåÂ§ß„Åç„Åè„Å™„Çä„Åô„Åé„ÅüÂ†¥Âêà„ÅØ„ÄÅÂè§„ÅÑÊàêÁ∏æ„ÇíÂâäÈô§„Åô„Çã„Å®ÂÆπÈáè„ÇíÁØÄÁ¥Ñ„Åß„Åç„Åæ„Åô„ÄÇ"})]})})]})]})]})]})}function _Y({streakDays:n}){const[e,t]=$.useState([]);if($.useEffect(()=>{const o=d0(14);t(o)},[]),e.length===0)return u.jsxs("div",{className:"w-full p-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center",children:[u.jsx("p",{className:"text-gray-500 text-lg",children:"üìä „Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Â≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„Å®ÈÄ≤Êçó„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]});const s=e.slice(-7),r={memorization:{bg:"bg-green-500",text:"üü¢ ÊöóË®ò"},translation:{bg:"bg-blue-500",text:"üîµ ÂíåË®≥"},spelling:{bg:"bg-yellow-500",text:"üü° „Çπ„Éö„É´"},grammar:{bg:"bg-red-500",text:"üî¥ ÊñáÊ≥ï"}};return u.jsxs("div",{className:"w-full p-3 sm:p-6 bg-white rounded-xl shadow-lg border-2 border-blue-200",children:[u.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-gradient-to-r from-orange-100 to-yellow-100 rounded-lg border-2 border-orange-300 text-center",children:[u.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u.jsx("span",{className:"text-2xl sm:text-3xl",children:"üî•"}),u.jsxs("span",{className:"text-lg sm:text-2xl font-bold text-orange-600",children:[n,"Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ"]})]}),n>0&&u.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1 sm:mt-2",children:"„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ"})]}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2",children:s.map((o,i)=>{const c=new Date(o.date).getDay(),d=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"][c];return u.jsx("div",{className:"text-center",children:u.jsx("div",{className:"text-xs sm:text-sm font-bold text-gray-700 mb-1",children:d})},i)})}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:s.map((o,i)=>{const a=[{key:"memorization",data:o.memorization},{key:"translation",data:o.translation},{key:"spelling",data:o.spelling},{key:"grammar",data:o.grammar}],c=a.reduce((m,g)=>m+g.data.correct,0),l=a.reduce((m,g)=>m+g.data.count,0),d=new Date(o.date),h=`${d.getMonth()+1}/${d.getDate()}`,p=o.date===v0(new Date),f=a.filter(m=>m.data.count>0).map(m=>{const g=m.data.count>0?Math.round(m.data.correct/m.data.count*100):0;return`${r[m.key].text}: ${m.data.correct}/${m.data.count}Âïè (${g}%)`}).join(`
`);return u.jsxs("div",{className:"flex flex-col items-center group",children:[u.jsx("div",{className:`relative w-full h-24 sm:h-32 bg-gray-200 rounded-lg overflow-hidden flex flex-col-reverse border-2 shadow-sm hover:shadow-xl hover:scale-105 transition-all duration-300 ${p?"border-orange-400 ring-2 ring-orange-300 ring-offset-1":"border-gray-300"}`,title:l>0?`${o.date}${p?" [‰ªäÊó•]":""}
${f}`:`${o.date}: Êú™Â≠¶Áøí`,children:c===0?u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Êú™Â≠¶Áøí"}):u.jsxs(u.Fragment,{children:[a.map(m=>m.data.correct>0&&u.jsx("div",{className:`mode-progress-bar w-full ${r[m.key].bg} flex items-center justify-center text-white text-xs font-bold transition-all duration-500 ease-out hover:brightness-110`,style:{"--height-percent":m.data.correct/c*100,"--animation-delay":i*.1},children:u.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:m.data.correct})},m.key)),u.jsx("div",{className:"hidden sm:flex absolute inset-0 bg-black/80 text-white p-2 text-[10px] leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none flex-col justify-center",children:a.filter(m=>m.data.count>0).map(m=>{const g=Math.round(m.data.correct/m.data.count*100);return u.jsxs("div",{className:"mb-1",children:[u.jsx("div",{className:"font-bold",children:r[m.key].text}),u.jsxs("div",{children:[m.data.correct,"/",m.data.count,"Âïè (",g,"%)"]})]},m.key)})})]})}),u.jsxs("div",{className:"mt-1 sm:mt-2 text-center",children:[u.jsxs("div",{className:`text-[10px] sm:text-xs ${p?"text-orange-600 font-bold":"text-gray-500"}`,children:[h,p&&" üéØ"]}),u.jsxs("div",{className:"text-xs sm:text-sm font-bold text-gray-800",children:[c,"Âïè"]})]})]},i)})}),u.jsx("style",{children:`
        @keyframes slideUp {
          from {
            height: 0%;
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        .mode-progress-bar {
          height: calc(var(--height-percent, 0) * 1%);
          animation: slideUp 0.6s ease-out calc(var(--animation-delay, 0) * 1s) both;
        }
      `}),u.jsx("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t-2 border-gray-200",children:u.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-4 text-xs sm:text-sm",children:Object.entries(r).map(([o,i])=>u.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[u.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 ${i.bg} rounded`}),u.jsx("span",{className:"text-gray-700",children:i.text})]},o))})})]})}function PY({allQuestions:n,onStartSession:e}){const[t,s]=$.useState(null),[r,o]=$.useState(null),[i]=$.useState(3),[a,c]=$.useState({totalLearned:0,totalReviewed:0,averageAccuracy:0,estimatedCompletion:90});if($.useEffect(()=>{const g=localStorage.getItem("learning-schedule-90days");if(g)try{const x=JSON.parse(g),y=Math.floor((Date.now()-x.startDate)/(1e3*60*60*24)),b=x.totalDays;x.currentDay=Math.min(y+1,b);const v=Math.floor(b/3),w=Math.floor(b*2/3);x.phase=x.currentDay<=v?1:x.currentDay<=w?2:3,s(x),o(dI(x,n))}catch(x){R.error("Failed to load schedule:",x)}},[n]),$.useEffect(()=>{if(t){c(hI(t));const g=document.querySelector(".progress-bar");if(g){const x=t.currentDay,y=t.totalDays,b=x/y*100;g.style.width=`${b}%`}}},[t]),!t)return null;const l=["Âü∫Á§éÂõ∫„ÇÅÊúü","ÂøúÁî®Êã°Â§ßÊúü","ÂÆåÊàê„ÉªÂÆöÁùÄÊúü"],d=t.phase,h=t.currentDay,p=t.totalDays,f=h/p*100,m=pI(t);return u.jsxs("div",{className:"learning-plan-dashboard",children:[u.jsxs("div",{className:"dashboard-header",children:[u.jsxs("div",{className:"day-counter",children:[u.jsx("span",{className:"day-number",children:h}),u.jsxs("span",{className:"day-label",children:["/ ",p,"Êó•ÁõÆ"]})]}),u.jsxs("div",{className:"phase-indicator",children:[u.jsxs("span",{className:`phase-badge phase-${d}`,children:["Phase ",d]}),u.jsx("span",{className:"phase-name",children:l[d-1]})]}),u.jsxs("div",{className:"progress-bar-container",children:[u.jsx("div",{className:`progress-bar phase-${d}`}),u.jsxs("span",{className:"progress-label",children:[f.toFixed(1),"%"]})]})]}),u.jsxs("div",{className:"stats-summary",children:[u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üìö"}),u.jsx("div",{className:"stat-value",children:a.totalLearned}),u.jsx("div",{className:"stat-label",children:"Â≠¶ÁøíÊ∏à„ÅøÂçòË™û"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚úÖ"}),u.jsxs("div",{className:"stat-value",children:[a.averageAccuracy.toFixed(1),"%"]}),u.jsx("div",{className:"stat-label",children:"Âπ≥ÂùáÊ≠£Á≠îÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üéØ"}),u.jsxs("div",{className:"stat-value",children:[m>0?m.toFixed(0):0,"%"]}),u.jsx("div",{className:"stat-label",children:"‰ªäÈÄ±„ÅÆÈÅîÊàêÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚è±Ô∏è"}),u.jsx("div",{className:"stat-value",children:a.estimatedCompletion}),u.jsx("div",{className:"stat-label",children:"ÂÆå‰∫Ü„Åæ„ÅßÔºàÊó•Ôºâ"})]})]}),r&&u.jsxs("div",{className:"today-plan",children:[u.jsxs("h2",{children:["üìñ ‰ªäÊó•„ÅÆÂ≠¶Áøí„Éó„É©„É≥ÔºàDay ",h,"Ôºâ"]}),u.jsxs("div",{className:"session-cards",children:[u.jsxs("div",{className:"session-card morning",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåÖ"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊúùÔºöÊñ∞Ë¶èÂ≠¶Áøí"}),u.jsxs("p",{children:[r.morning.newWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("morning",r.morning.newWords),className:"btn-start-session",disabled:r.morning.newWords.length===0,children:r.morning.newWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card afternoon",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"‚òÄÔ∏è"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊòºÔºöÂº±ÁÇπÂæ©Áøí"}),u.jsxs("p",{children:[r.afternoon.reviewWords.length,"Ë™û ¬∑ 15ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("afternoon",r.afternoon.reviewWords),className:"btn-start-session",disabled:r.afternoon.reviewWords.length===0,children:r.afternoon.reviewWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card evening",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåô"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"Â§úÔºöÁ∑èÂêàÊºîÁøí"}),u.jsxs("p",{children:[r.evening.mixedWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("evening",r.evening.mixedWords),className:"btn-start-session",disabled:r.evening.mixedWords.length===0,children:r.evening.mixedWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]})]})]}),u.jsxs("div",{className:"milestones",children:[u.jsx("h2",{children:"üèÜ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥"}),u.jsx("div",{className:"milestone-list",children:t.milestones.map((g,x)=>{const y=h>g.day,b=h===g.day,v=a.totalLearned>=g.wordsTarget;return u.jsxs("div",{className:`milestone-item ${v?"achieved":""} ${b?"current":""} ${y?"passed":""}`,children:[u.jsxs("div",{className:"milestone-day",children:["Day ",g.day]}),u.jsx("div",{className:"milestone-title",children:g.title}),u.jsxs("div",{className:"milestone-target",children:[g.wordsTarget,"Ë™û"]}),v&&u.jsx("span",{className:"check-mark",children:"‚úì"})]},x)})})]})]})}function MY({allQuestions:n,onStartSession:e,_selectedDataSource:t="all",_onDataSourceChange:s,customQuestionSets:r,onOpenCustomSetManagement:o}){const[i,a]=$.useState(()=>{const w=localStorage.getItem("batchSize");return w?parseInt(w,10):20}),[c,l]=$.useState(()=>localStorage.getItem("aiPersonality")||"kind-teacher"),d=w=>{l(w),localStorage.setItem("aiPersonality",w)},[h,p]=$.useState(()=>{const w=localStorage.getItem("voiceGender");return w==="female"||w==="male"?w:"female"}),[f,m]=$.useState(()=>{const w=localStorage.getItem("speechRate");return w?parseFloat(w):.9}),g=w=>{p(w),localStorage.setItem("voiceGender",w)},x=w=>{m(w),localStorage.setItem("speechRate",w.toString())},[y,b]=$.useState(()=>{const w=localStorage.getItem("darkMode");return w==="system"||w==="light"||w==="dark"?w:w==="true"?"dark":w==="false"?"light":"system"}),v=w=>{let S=!1;w==="system"?S=window.matchMedia("(prefers-color-scheme: dark)").matches:S=w==="dark",document.documentElement.classList.toggle("dark",S)};return $.useEffect(()=>{if(v(y),y==="system"){const w=window.matchMedia("(prefers-color-scheme: dark)"),S=()=>{v("system")};return w.addEventListener("change",S),()=>w.removeEventListener("change",S)}},[y]),n.length,u.jsxs("div",{className:"w-full px-4 py-6 space-y-6",children:[u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà"}),u.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:["(",r.length,"ÂÄã)"]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("button",{onClick:o,className:"w-full px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all shadow-md flex items-center justify-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÁÆ°ÁêÜ"})]}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg",children:"üí° Ëá™ÂàÜ„Å†„Åë„ÅÆ„Ç™„É™„Ç∏„Éä„É´ÂïèÈ°å„Çª„ÉÉ„Éà„Çí‰ΩúÊàê„ÉªÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇÂ≠¶Áøí„Åó„Åü„ÅÑÂçòË™û„ÇíËá™Áî±„Å´ËøΩÂä†„Åó„Å¶„ÄÅÂäπÁéáÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]})]}),u.jsx(PY,{allQuestions:n,onStartSession:e}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üé≠"}),u.jsx("span",{children:"AI„ÅÆ‰∫∫Ê†º"})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(gX).map(([w,S])=>u.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all duration-200 ${c===w?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md hover:scale-102"}`,onClick:()=>d(w),children:[u.jsx("div",{className:"text-3xl",children:S.avatar}),u.jsx("div",{className:"font-semibold text-sm",children:S.name}),u.jsx("div",{className:"text-xs opacity-80 text-center",children:S.description})]},w))})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üîä"}),u.jsx("span",{children:"Èü≥Â£∞Ë®≠ÂÆö"})]}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üé§"}),u.jsx("span",{children:"Â£∞„ÅÆÁ®ÆÈ°û"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${h==="female"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>g("female"),children:[u.jsx("div",{className:"text-3xl",children:"üë©"}),u.jsx("div",{className:"text-sm font-semibold",children:"Â•≥ÊÄß"})]}),u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${h==="male"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>g("male"),children:[u.jsx("div",{className:"text-3xl",children:"üë®"}),u.jsx("div",{className:"text-sm font-semibold",children:"Áî∑ÊÄß"})]})]})]}),u.jsxs("div",{children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"}),u.jsx("span",{children:"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsx("span",{className:"text-xs font-normal text-text-secondary",children:"(WPM: Words Per Minute)"})]}),u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6",children:[u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("div",{className:"font-bold text-primary text-4xl mb-1",children:Math.round(f*150)}),u.jsx("div",{className:"text-sm text-text-secondary",children:"WPM"}),u.jsx("div",{className:"text-xs text-text-secondary mt-2",children:f<.75?"üê¢ „ÇÜ„Å£„Åè„Çä„Å®Áô∫Èü≥":f>=.95?"üöÄ „Éç„Ç§„ÉÜ„Ç£„Éñ‰∏¶„ÅÆÈÄüÂ∫¶":"üéØ È´òÊ†°ÂÖ•Ë©¶„É™„Çπ„Éã„É≥„Ç∞Áõ∏ÂΩì"})]}),u.jsxs("div",{className:"relative mb-8",children:[u.jsx("input",{type:"range",min:"0.6",max:"1.0",step:"0.05",value:f,onChange:w=>x(parseFloat(w.target.value)),className:"w-full h-3 bg-border-color rounded-lg appearance-none cursor-pointer accent-primary","aria-label":"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsxs("div",{className:"absolute top-0 left-0 w-full h-3 pointer-events-none",children:[u.jsx("div",{className:"absolute top-1/2 left-0 -translate-y-1/2 w-0.5 h-5 bg-gray-400"}),u.jsx("div",{className:"absolute top-1/2 left-[37.5%] -translate-y-1/2 w-0.5 h-5 bg-blue-500"}),u.jsx("div",{className:"absolute top-1/2 left-[75%] -translate-y-1/2 w-0.5 h-5 bg-green-500"}),u.jsx("div",{className:"absolute top-1/2 left-full -translate-y-1/2 -translate-x-0.5 w-0.5 h-5 bg-orange-500"})]})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs",children:[u.jsxs("button",{onClick:()=>x(.6),className:"bg-gray-50/50 rounded-lg p-3 border border-gray-200 hover:bg-gray-100:bg-gray-700/50 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-gray-600",children:"90 WPM"}),u.jsx("div",{className:"text-gray-500 mt-1",children:"ÊúÄ‰ΩéÈÄüÂ∫¶"})]}),u.jsxs("button",{onClick:()=>x(.75),className:"bg-blue-50/20 rounded-lg p-3 border border-blue-200 hover:bg-blue-100:bg-blue-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-blue-600",children:"113 WPM"}),u.jsx("div",{className:"text-blue-500 mt-1",children:"ÂàùÂ≠¶ËÄÖÂêë„Åë"})]}),u.jsxs("button",{onClick:()=>x(.9),className:"bg-green-50/20 rounded-lg p-3 border border-green-200 hover:bg-green-100:bg-green-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-green-600",children:"135 WPM"}),u.jsx("div",{className:"text-green-500 mt-1",children:"È´òÊ†°ÂÖ•Ë©¶"})]}),u.jsxs("button",{onClick:()=>x(1),className:"bg-orange-50/20 rounded-lg p-3 border border-orange-200 hover:bg-orange-100:bg-orange-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-orange-600",children:"150 WPM"}),u.jsx("div",{className:"text-orange-500 mt-1",children:"„Éç„Ç§„ÉÜ„Ç£„Éñ"})]})]})]})]})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìã"}),u.jsx("span",{children:"„Éó„É©„Ç§„Éê„Ç∑„Éº"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("a",{href:"/privacy.html",target:"_blank",rel:"noopener noreferrer",className:"block w-full px-4 py-3 bg-primary text-white text-center rounded-lg font-semibold hover:bg-btn-primary-hover transition-colors shadow-md",children:"üìÑ „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg text-center",children:"Êú¨„Ç¢„Éó„É™„ÅØÂÄã‰∫∫ÊÉÖÂ†±„ÇíÂèéÈõÜ„Åõ„Åö„ÄÅÂ≠¶Áøí„Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂ÂÜÖ„Å´„ÅÆ„Åø‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ"})]})]})]})}const FY=({isVisible:n,message:e="Ë™≠„ÅøËæº„Åø‰∏≠..."})=>n?u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 pointer-events-auto",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-6 animate-in fade-in duration-300",children:[u.jsxs("div",{className:"relative w-16 h-16",children:[u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-gray-200"}),u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-600 animate-spin"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:e}),u.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Ê∫ñÂÇô‰∏≠„Åß„Åô..."})]})]})}):null;let Zl=null,eu=null;async function By(){return Zl||(Zl=(await gs(()=>Promise.resolve().then(()=>rY),void 0)).default,Zl)}async function Vy(){return eu||(eu=(await gs(()=>Promise.resolve().then(()=>sY),void 0)).default,eu)}function Uy(){typeof requestIdleCallback<"u"?requestIdleCallback(()=>{By(),Vy()}):setTimeout(()=>{By(),Vy()},2e3)}const MI=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function OY(){try{let n=0;const e=[];for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r){const o=localStorage.getItem(r);if(o){const i=new Blob([o]).size;n+=i,e.push({key:r,size:i})}}}const t=n/(1024*1024);R.log(`üìä LocalStorage‰ΩøÁî®Èáè: ${t.toFixed(2)}MB`),e.sort((s,r)=>r.size-s.size),e.slice(0,5).forEach(s=>{const r=s.size/1048576;R.log(`  - ${s.key}: ${r.toFixed(2)}MB`)}),t>4&&(R.warn("‚ö†Ô∏è LocalStorage„ÅÆ‰ΩøÁî®Èáè„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂè§„ÅÑ„Éá„Éº„Çø„ÇíËá™ÂãïÂâäÈô§„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"),ps(),R.log("Ëá™ÂãïÂúßÁ∏Æ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ"))}catch(n){R.error("LocalStorage„Çµ„Ç§„Ç∫„ÅÆÁ¢∫Ë™ç„Ç®„É©„Éº:",n)}}function LY(){const[n,e]=$.useState("translation"),[t,s]=$.useState(!1),[r,o]=$.useState([]),[i,a]=$.useState(()=>dQ()),[c,l]=$.useState(!1);$.useEffect(()=>{hQ(i)},[i]),$.useEffect(()=>{!window.location.hostname.includes("github.io")&&gs(()=>import("./scoreBoardTests-DWx7OdjV.js"),__vite__mapDeps([0,1,2])).then(()=>{R.log("‚úÖ „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü"),R.log("   ‰Ωø„ÅÑÊñπ: window.runScoreBoardTests()"),R.log('   „Åæ„Åü„ÅØ: window.checkCurrentScoreBoardDisplay("translation")')}).catch(ge=>{R.error("„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",ge)})},[]);const{categoryList:d,setCategoryList:h,selectedCategory:p,setSelectedCategory:f,selectedDifficulty:m,setSelectedDifficulty:g,selectedWordPhraseFilter:x,setSelectedWordPhraseFilter:y,selectedPhraseTypeFilter:b,setSelectedPhraseTypeFilter:v,selectedDataSource:w,setSelectedDataSource:S}=lQ(),[N,C]=$.useState([]),[k,I]=$.useState(!1),T=$.useRef(!1);$.useEffect(()=>{T.current=!1},[n]),$.useEffect(()=>{k&&(n==="translation"||n==="spelling")&&!T.current&&A.questions.length===0&&(T.current=!0,U())},[k,n]);const[_]=$.useState(()=>{const ee=localStorage.getItem("quiz-adaptive-mode");return ee?JSON.parse(ee):!1}),{sessionStats:D,setSessionStats:P,quizState:A,setQuizState:F,reviewFocusMode:O,setReviewFocusMode:V,reviewQuestionPool:L,setReviewQuestionPool:H,reviewCorrectStreak:J,setReviewCorrectStreak:X}=uQ(),[fe]=$.useState(()=>new jl),{reAddQuestion:be,clearExpiredFlags:oe,updateRequeueStats:xe,checkPositionMismatch:$e}=_l(),[Le,Re]=$.useState(0),[ze,Ye]=$.useState(!1),[Te,ut]=$.useState(null),ft=$.useRef(0),wt=$.useRef(0),vt=$.useRef([]),Nt=$.useRef(0),mt=$.useRef([]),dt=$.useRef(null),re=$.useRef(null),de=$.useRef(new Map),q=$.useRef([]),Z=$.useRef([]);$.useEffect(()=>{if(n!=="translation"||!ze||A.questions.length===0)return;const ee=A.currentIndex,ge=A.answered?ee+1:ee;(async()=>{try{const ue=A.questions.slice(ge);if(ue.length===0){Ye(!1),ut(null),Re(0);return}R.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:Le,reason:Te,currentIndex:ee,startIndex:ge,remaining:ue.length});const Ve=await fe.schedule({questions:ue,mode:"translation",limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:D.correct,incorrect:D.incorrect,still_learning:D.review||0,mastered:D.mastered||0,duration:Date.now()-ft.current},useMetaAI:!0,isReviewFocusMode:O,hybridMode:!0});F(yt=>{if(yt.currentIndex!==ee)return yt;const ot=yt.questions.slice(0,ge);return{...yt,questions:[...ot,...Ve.scheduledQuestions]}}),Re(0),Ye(!1),ut(null),R.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:Ve.scheduledQuestions.length})}catch(ue){R.error("[Translation] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",ue),Ye(!1),ut(null)}})()},[n,ze,Le,Te,A.questions,A.currentIndex,A.answered,fe,D,O]),cQ(),$.useEffect(()=>{const ee=yt=>{const ot=yt==="dark"||yt==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark-mode",ot)},Se=localStorage.getItem("darkMode")||"system";ee(Se);const ue=window.matchMedia("(prefers-color-scheme: dark)"),Ve=()=>{const yt=localStorage.getItem("darkMode");(!yt||yt==="system")&&ee("system")};return ue.addEventListener("change",Ve),()=>ue.removeEventListener("change",Ve)},[]),$.useEffect(()=>{(async()=>{try{R.log("üîÑ „Éá„Éº„ÇøÁßªË°å„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...");try{await ck()}catch(He){R.error("Migration error (continuing):",He)}Qy();let ge=!1;try{const He=await ps();He&&He.wordProgress&&He.statistics&&He.questionSetStats?(Jr(He),R.log("‚úÖ Progress data loaded successfully"),ge=!0):R.warn("‚ö†Ô∏è Progress data incomplete, reinitializing")}catch(He){R.error("Progress load error:",He)}if(!ge){R.log("üîß Initializing fresh progress data");const He={results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},wordProgress:{},categoryStats:{},difficultyStats:{}};Jr(He);try{localStorage.setItem("progress-data",JSON.stringify(He))}catch(qe){R.warn("Failed to save initial progress:",qe)}}OY();const ue=await(await fetch("/data/vocabulary/high-school-entrance-words.csv")).text(),Ve=Ka(ue).map(He=>({...He,source:"junior"}));let yt=[];try{const qe=await(await fetch("/data/vocabulary/high-school-entrance-phrases.csv")).text();yt=Ka(qe).map(ct=>({...ct,source:"junior"})),R.log(`üìö È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${yt.length}ÂÄã`)}catch(He){R.warn("È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",He)}let ot=[];try{const qe=await(await fetch("/data/vocabulary/high-school-intermediate-words.csv")).text();ot=Ka(qe).map(ct=>({...ct,source:"intermediate"})),R.log(`üìö ‰∏≠Á¥ö1800ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${ot.length}ÂÄã`)}catch(He){R.warn("‰∏≠Á¥ö1800ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",He)}let Ge=[];try{const qe=await(await fetch("/data/vocabulary/high-school-intermediate-phrases.csv")).text();Ge=Ka(qe).map(ct=>({...ct,source:"intermediate"})),R.log(`üìö ‰∏≠Á¥ö1800ÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${Ge.length}ÂÄã`)}catch(He){R.warn("‰∏≠Á¥ö1800ÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",He)}const Ut=new Map;try{for(const He of[1,2,3])try{const ct=await(await fetch(`/data/sentence-ordering-grade${He}.json`)).json();ct.units&&ct.units.forEach(Mt=>{const Wt=`${He}Âπ¥ ${Mt.unit}`;Ut.set(Mt.unit,`${Mt.unit}: ${Mt.title}`),Ut.set(Wt,`${He}Âπ¥ ${Mt.unit}: ${Mt.title}`)})}catch(qe){R.warn(`Grade ${He} sentence ordering data not found:`,qe)}}catch(He){R.warn("Unit title mapping failed:",He)}const at=[...Ve,...yt,...ot,...Ge];if(at.length>0){o(at);try{const Ke=at.map(B=>({word:B.word,difficulty:B.difficulty||"beginner"}));localStorage.setItem("all-questions-cache",JSON.stringify(Ke))}catch(Ke){R.warn("Questions cache save failed:",Ke)}const ct=Array.from(new Set(at.map(Ke=>Ke.category||"").filter(Ke=>Ke))).map(Ke=>Ut.has(Ke)?Ut.get(Ke):Ke).sort((Ke,B)=>{const pe=/(\d+)Âπ¥\s+Unit\s+(\d+)/i,Ae=Ke.match(pe),je=B.match(pe);if(Ae&&je){const Ct=parseInt(Ae[1],10),tt=parseInt(je[1],10);if(Ct!==tt)return Ct-tt;const Ft=parseInt(Ae[2],10),nt=parseInt(je[2],10);return Ft-nt}const Me=/Unit\s+(\d+)/i,Ue=Ke.match(Me),Et=B.match(Me);if(Ue&&Et){const Ct=parseInt(Ue[1],10),tt=parseInt(Et[1],10);return Ct-tt}return Ke.localeCompare(B,"ja")});h(ct);const Mt={id:"all-set",name:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà",questions:at,createdAt:Date.now(),isBuiltIn:!0,source:"È´òÊ†°ÂèóÈ®ì2758Ë™û + È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ1791Ë™û"},Wt={id:"advanced-set",name:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö",questions:at.filter(Ke=>Ke.difficulty==="advanced"),createdAt:Date.now(),isBuiltIn:!0,source:"high-school-entrance (ÂçòË™û2662 + ÁÜüË™û96)"},Kt={id:"standard-set",name:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ",questions:at.filter(Ke=>Ke.difficulty==="intermediate"||Ke.difficulty==="beginner"),createdAt:Date.now(),isBuiltIn:!0,source:"high-school-intermediate (ÂçòË™û1579 + ÁÜüË™û212)"},{getCustomQuestionSets:lt}=await gs(async()=>{const{getCustomQuestionSets:Ke}=await Promise.resolve().then(()=>vy);return{getCustomQuestionSets:Ke}},void 0),_t=(await lt()).map(Ke=>{const B=new Date(Ke.createdAt),pe=`${B.getMonth()+1}/${B.getDate()}`,Ae=Ke.source==="reading"?"Èï∑Êñá":Ke.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï";return{id:Ke.id,name:`„Ç´„Çπ„Çø„É†ÂïèÈ°åÔºà${Ae}_${pe}Ôºâ`,questions:Ke.questions,createdAt:Ke.createdAt,isBuiltIn:!1,source:Ke.source==="reading"?"Èï∑ÊñáË™≠Ëß£":Ke.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}});C([Mt,Wt,Kt,..._t]),I(!0)}}catch(ge){R.error("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",ge),alert("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}})()},[]);const Ce=async()=>{try{const{getCustomQuestionSets:ee}=await gs(async()=>{const{getCustomQuestionSets:Ve}=await Promise.resolve().then(()=>vy);return{getCustomQuestionSets:Ve}},void 0),ge=await ee(),Se=N.find(Ve=>Ve.isBuiltIn),ue=ge.map(Ve=>({id:Ve.id,name:Ve.name,questions:Ve.questions,createdAt:Ve.createdAt,isBuiltIn:!1,source:Ve.source==="reading"?"Èï∑ÊñáË™≠Ëß£":Ve.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}));Se&&C([Se,...ue])}catch(ee){R.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆÂÜçË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",ee)}};$.useEffect(()=>{localStorage.setItem("quiz-adaptive-mode",JSON.stringify(_))},[_]),$.useEffect(()=>{localStorage.setItem("selectedDataSource",w)},[w]),$.useEffect(()=>{A.questions.length>0&&U()},[w,p,m,x,b]);const _e=()=>{let ee=r;if(w!=="all"&&(ee=ee.filter(ge=>ge.source===w)),p!=="all"&&(ee=ee.filter(ge=>ge.category===p)),m!=="all"){const ge={all:"",beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö"};ee=ee.filter(Se=>Se.difficulty===ge[m])}return x==="words-only"?ee=ee.filter(ge=>!ge.word.includes(" ")):x==="phrases-only"&&(ee=ee.filter(ge=>ge.word.includes(" ")),b!=="all"&&(ee=ee.filter(ge=>uI(ge.word)===b))),ee=i0(ee),ee},De=(ee,ge)=>{const Se=pQ(ee,ge);a(ue=>({...ue,sets:[...ue.sets,Se]})),R.log(`‚úÖ „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${ee}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü`)},Ie=ee=>{a(ge=>gQ(ge,ee)),R.log("üóëÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü")},Dt=(ee,ge,Se)=>{a(ue=>xQ(ue,ee,{name:ge,description:Se})),R.log(`‚úèÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${ge}„Äç„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`)},j=(ee,ge)=>{a(Se=>fQ(Se,ee,ge)),R.log(`‚ûï „Äå${ge.word}„Äç„Çí„Çª„ÉÉ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`)},z=(ee,ge)=>{a(Se=>mQ(Se,ee,ge)),R.log(`‚ûñ „Äå${ge.word}„Äç„Çí„Çª„ÉÉ„Éà„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü`)},U=async()=>{var Kt;const ee=lX();R.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥:",ee);const ge=Yg();let Se=_e();if(Se.length===0){alert("ÊåáÂÆö„Åï„Çå„ÅüÊù°‰ª∂„ÅÆÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}if(O){const lt=Mu();if(Se=Se.filter(Zt=>lt.some(_t=>_t&&Zt.word&&_t.toLowerCase()===Zt.word.toLowerCase())),Se.length===0){alert("Ë¶ÅÂæ©ÁøíÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"),V(!1),H([]);return}H([...Se]),R.log(`üéØ Ë£ú‰øÆ„É¢„Éº„ÉâÈñãÂßã: ${Se.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å`)}const ue=vQ(r,d),Ve=bI();Ve?($Q(ue),R.log(`üìä ÊîπÂñÑÈÄ≤Êçó: ${Ve.currentDay}Êó•ÁõÆ - ÂÖ®‰ΩìÈÄ≤Êçó${Ve.overallProgress.toFixed(1)}%`)):ue.weakCategories.length>0&&(kQ(ue),R.log("üéØ „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÊîπÂñÑ„Éó„É©„É≥„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü")),ue.aiRecommendations.length>0&&(R.log("üß† AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà „Åã„Çâ„ÅÆÊé®Â•®:"),ue.aiRecommendations.forEach(lt=>R.log(`  ${lt}`))),ue.weakCategories.length>0&&p==="all"&&(Se=IQ(Se,ue.weakCategories,Math.min(30,Se.length)),R.log(`üí° Âº±ÁÇπÂàÜÈáé„ÇíÂÑ™ÂÖàÂá∫È°å: ${ue.weakCategories.slice(0,3).map(lt=>lt.category).join(", ")}`));const yt=Mu(),Ge=c0(10).map(lt=>lt.word);let Ut=[];if(yt.length>0){const lt=Se.filter(_t=>yt.some(Ke=>Ke&&_t.word&&Ke.toLowerCase()===_t.word.toLowerCase()));Ut=ge.maxReviewCount>0?lt.slice(0,ge.maxReviewCount):[];const Zt=Se.filter(_t=>!yt.some(Ke=>Ke&&_t.word&&Ke.toLowerCase()===_t.word.toLowerCase()));Se=[...Ut,...Zt],Ut.length>0&&R.log(`üîÑ Ë¶ÅÂæ©ÁøíÂïèÈ°å: ${Ut.length}ÂïèÔºà‰∏äÈôê: ${ge.maxReviewCount}ÂïèÔºâ`)}if(Ge.length>0){const lt=Se.filter(Zt=>Ge.some(_t=>_t&&Zt.word&&_t.toLowerCase()===Zt.word.toLowerCase()));if(lt.length>0){const Zt=Se.filter(_t=>!Ge.some(Ke=>Ke&&_t.word&&Ke.toLowerCase()===_t.word.toLowerCase()));Se=[...lt,...Zt],R.log(`üîó Ê∑∑ÂêåÂ±•Ê≠¥: ${lt.length}Âïè„ÇíÂÑ™ÂÖàÂá∫È°å`)}}if(!O&&Se.length>0){const lt=await ps(),Zt=new Map;Se.forEach(Ue=>{const Et=lt.wordProgress[Ue.word];if(Et&&Et.learningHistory&&Et.learningHistory.length>0){const Ct=Et.learningHistory.map(Ft=>({timestamp:Ft.timestamp,wasCorrect:Ft.wasCorrect,responseTime:Ft.responseTime,userAnswer:Ft.userAnswer,confidenceLevel:Ft.responseTime<2e3?"instant":Ft.responseTime<5e3?"hesitant":"guessed",sessionContext:{questionIndex:Ft.sessionIndex||0,previousQuestions:[],sessionFatigue:0}})),tt=TQ(Ue.word,Et,Ct);Zt.set(Ue.word,tt)}});const _t=DQ(Se,lt.wordProgress,Zt),Ke=_Q(_t,Se.length),B=Sy(mt.current,ft.current);dt.current=B;const pe=FQ(Ke,B),Ae=new Map(pe.map(Ue=>[Ue.word,Ue]));if(Se=Se.filter(Ue=>Ae.has(Ue.word)).sort((Ue,Et)=>{const Ct=Ae.get(Ue.word).priority;return Ae.get(Et.word).priority-Ct}),R.log("üß† Â≠¶ÁøíÊõ≤Á∑öAI: ÊúÄÈÅ©„Å™Âá∫È°åÈ†ÜÂ∫è„ÇíÊ±∫ÂÆö"),R.log("  Âá∫È°åÊà¶Áï•:",pe.slice(0,5).map(Ue=>`${Ue.word}(${Ue.strategy}, ÊàêÂäüÁéá${Ue.estimatedSuccessRate.toFixed(0)}%)`).join(", ")),B.fatigueLevel>40){const Ue=LQ(B);R.log(`‚ö° Ë™çÁü•Ë≤†Ëç∑: ${B.fatigueLevel.toFixed(0)}% - ${Ue}`)}const je=eI(Se,lt.wordProgress,Z.current),Me=new Map;if(je.sequence.forEach((Ue,Et)=>{Me.set(Ue,Et)}),Se=Se.sort((Ue,Et)=>{const Ct=Me.get(Ue.word)??999,tt=Me.get(Et.word)??999;return Ct-tt}),R.log("üîó ÊñáËÑàÂ≠¶ÁøíAI: ÊÑèÂë≥ÁöÑ„ÇØ„É©„Çπ„Çø„É™„É≥„Ç∞ÂÆå‰∫Ü"),R.log(`  „ÇØ„É©„Çπ„Çø„ÉºÊï∞: ${je.clusters.length}`),je.transitions.length>0){const Ue=je.transitions[0];R.log(`  ‰æã: ${Ue.from} ‚Üí ${Ue.to} (${Ue.reason})`)}}if(n==="translation"&&Se.length>0){await ps();const lt=await fe.schedule({questions:Se,mode:"translation",limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:D.correct,incorrect:D.incorrect,still_learning:D.review||0,mastered:D.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:O,hybridMode:!0});Se=lt.scheduledQuestions,lt.vibrationScore>50&&R.warn("[Translation Hybrid] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:lt.vibrationScore,processingTime:lt.processingTime}),R.log("üß† „É°„ÇøAIÁµ±ÂêàÂ±§: „Éè„Ç§„Éñ„É™„ÉÉ„ÉâË™øÊï¥ÂÆå‰∫Ü",{total:Se.length,vibrationScore:lt.vibrationScore,adjustmentRange:"¬±20%"})}O?R.log(`üéØ Ë£ú‰øÆ„É¢„Éº„Éâ: ${Se.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å‰∏≠`):R.log(`üìö Â≠¶ÁøíÊï∞: ${Se.length}Âïè`),F({questions:Se,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),Re(0),Ye(!1),ut(null),P({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),ft.current=Date.now(),wt.current=Date.now(),vt.current=[],mt.current=[],dt.current=null;const at=await ps(),He=zQ(at.wordProgress,q.current);re.current=He;const qe=Se.map(lt=>lt.word),ct=((Kt=dt.current)==null?void 0:Kt.fatigueLevel)??0,Mt=HQ(qe,at.wordProgress,He,ct);de.current=Mt,R.log("üîÆ „Ç®„É©„Éº‰∫àÊ∏¨AI: Ë™§Á≠î„É™„Çπ„ÇØÂàÜÊûêÂÆå‰∫Ü");const Wt=Array.from(Mt.values()).filter(lt=>lt.warningLevel==="high"||lt.warningLevel==="critical").sort((lt,Zt)=>Zt.errorRisk-lt.errorRisk);Wt.length>0&&(R.log(`  È´ò„É™„Çπ„ÇØÂïèÈ°å: ${Wt.length}Âïè`),R.log(`  ÊúÄÈ´ò„É™„Çπ„ÇØ: ${Wt[0].word} (${Wt[0].errorRisk.toFixed(0)}% - ${Wt[0].primaryPattern})`))},M=()=>{O?(V(!1),H([]),X(new Map)):(V(!0),X(new Map))},ie=()=>{O?(V(!1),H([]),X(new Map)):(V(!0),X(new Map))},te=ee=>{f(ee),V(!1),H([]),A.questions.length>0&&U()},Q=ee=>{g(ee),V(!1),H([]),A.questions.length>0&&U()},ce=async(ee,ge,Se)=>{var He,qe,ct,Mt;if(A.answered)return;const ue=ee==="ÂàÜ„Åã„Çâ„Å™„ÅÑ",Ve=ee.trim(),yt=ge.trim(),ot=!ue&&Ve===yt,Ge=A.questions[A.currentIndex];!ot&&Se&&Se.word&&(await a0(Se.word,Ge.word),R.log(`üîó Ê∑∑Âêå„ÇíË®òÈå≤: ${Se.word} ‚Üê ${Ge.word}`));const Ut=Date.now()-wt.current;if(Ge){const Kt=(He=(await ps()).wordProgress)==null?void 0:He[Ge.word],Zt=1-(Kt?Kt.correctCount/(Kt.correctCount+Kt.incorrectCount):.5);mt.current.push({timestamp:Date.now(),wasCorrect:ot,responseTime:Ut,questionDifficulty:Zt});const _t=Sy(mt.current,ft.current);dt.current=_t,(qe=_t.breakRecommendation)!=null&&qe.shouldBreak&&R.log(`üí§ ‰ºëÊÜ©Êé®Â•®: ${_t.breakRecommendation.reason}`),q.current.push({word:Ge.word,wasCorrect:ot,userAnswer:Ve}),q.current.length>50&&(q.current=q.current.slice(-50))}if(Ge){await So(Ge.word,ot,Ut,void 0,"translation");const Kt=(ct=(await ps()).wordProgress)==null?void 0:ct[Ge.word];let lt=ot?"correct":"incorrect";Kt&&Kt.masteryLevel==="mastered"?lt="mastered":!ot&&Kt&&Kt.incorrectCount>=2&&(lt="review"),P(Ke=>({...Ke,correct:Ke.correct+(lt==="correct"?1:0),incorrect:Ke.incorrect+(lt==="incorrect"?1:0),review:Ke.review+(lt==="review"?1:0),mastered:Ke.mastered+(lt==="mastered"?1:0)})),ga({status:lt,word:Ge.word,timestamp:Date.now()},"translation"),Z.current.push(Ge.word),Z.current.length>10&&(Z.current=Z.current.slice(-10)),Nt.current++;const _t=(Mt=(await ps()).wordProgress)==null?void 0:Mt[Ge.word];if(_t&&_t.skippedCount&&_t.skippedCount>0&&(ot?yI(Ge.word):(xI(Ge.word),R.log("ü§î AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Çπ„Ç≠„ÉÉ„Éó„Åó„ÅüÂçòË™û„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„ÅÆÂçòË™û„ÇíÂÜçÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ"))),dc({id:hc(),questionSetId:"main-set-single",questionSetName:"È´òÊ†°ÂèóÈ®ìËã±ÂçòË™û",score:ot?1:0,total:1,percentage:ot?100:0,date:Date.now(),timeSpent:Math.floor(Ut/1e3),incorrectWords:ot?[]:[Ge.word],mode:"translation",category:p!=="all"?p:void 0,difficulty:m!=="all"?m:void 0}),ot||vt.current.push(Ge.word),O){const Ke=new Map(J);if(ot){const B=Ke.get(Ge.word)||0;if(Ke.set(Ge.word,B+1),B+1>=2){const pe=L.filter(Ae=>Ae.word!==Ge.word);H(pe),R.log(`‚úÖ ${Ge.word} „ÇíË£ú‰øÆÂØæË±°„Åã„ÇâÈô§Â§ñ (2ÂõûÈÄ£Á∂öÊ≠£Ëß£)`),pe.length===0&&(alert("üéâ „Åô„Åπ„Å¶„ÅÆË¶ÅÂæ©ÁøíÂïèÈ°å„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„ÅüÔºÅ"),V(!1),X(new Map))}}else Ke.set(Ge.word,0);X(Ke)}}if(Ge){const Wt=String(Ge.word);Lr.onShown(Wt),Lr.onAnswer(Wt,ot),xe(Ge,D,P)}let at=A.questions;!O&&Ge&&!ot&&(at=be(Ge,A.questions,A.currentIndex,"translation")),O||Re(Wt=>{const Kt=Wt+1;if(Kt>=50)return Ye(!0),ut("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(Kt%10===0){const lt=$e(at,"translation");lt.needsRescheduling&&(Ye(!0),ut(lt.reason))}return Kt}),F(Wt=>({...Wt,questions:at,answered:!0,selectedAnswer:ee,score:ot?Wt.score+1:Wt.score,totalAnswered:Wt.totalAnswered+1}))},le=()=>{F(ee=>{var ue;const ge=O?L:ee.questions,Se=ee.currentIndex+1;if(!O&&Se<ge.length){const Ve=oe(ge,Se-1);if(Ve!==ge)return{...ee,questions:Ve,currentIndex:Se,answered:!1,selectedAnswer:null}}if(!O&&Se>=ge.length){if(!window.location.hostname.includes("github.io"))try{const ct=Lr.summarize();R.log("üß™ KPI Summary (translation):",ct)}catch{}const Ve=Date.now(),yt=mt.current.reduce((ct,Mt)=>ct+Mt.responseTime,0),ot=mt.current.length>0?yt/mt.current.length:0,Ge=((ue=dt.current)==null?void 0:ue.fatigueLevel)??0,Ut=qQ(ft.current,Ve,ee.totalAnswered,ee.score,ot,Ge,D.correct+D.mastered,D.review);JQ(Ut);const at=ZQ();if(at.length>=3){const ct=YQ("user",at),Mt=wI(),Wt=eX(ct,Mt);R.log("üìä Â≠¶Áøí„Çπ„Çø„Ç§„É´AI:",Wt)}const He=(Ve-ft.current)/(1e3*60),qe=cX(ee.score,ee.totalAnswered,ot,He,D.correct+D.mastered,Ge);R.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥ÁµêÊûú:"),R.log(`  Áç≤ÂæóXP: ${qe.xpGained}`),qe.leveledUp&&R.log(`  üéâ „É¨„Éô„É´„Ç¢„ÉÉ„Éó! Lv.${qe.newLevel}`),qe.feedback.forEach(ct=>{R.log(`  ${ct.icon} ${ct.message}`)})}return O&&Se>=ge.length?(R.log("üîÑ Ë£ú‰øÆ„É¢„Éº„Éâ: ÂïèÈ°å„ÇíÁπ∞„ÇäËøî„Åó„Åæ„Åô"),{...ee,questions:ge,currentIndex:0,answered:!1,selectedAnswer:null}):{...ee,questions:ge,currentIndex:Se%ge.length,answered:!1,selectedAnswer:null}}),wt.current=Date.now()},Pe=()=>{F(ee=>({...ee,currentIndex:ee.currentIndex>0?ee.currentIndex-1:0,answered:!1,selectedAnswer:null}))},ve=async()=>{const ee=A.questions[A.currentIndex];if(ee){const ge=Date.now()-wt.current;await kh(ee.word,30),gI(ee.word),await So(ee.word,!0,ge,void 0,"translation"),F(Se=>({...Se,score:Se.score+1,totalAnswered:Se.totalAnswered+1,currentIndex:(Se.currentIndex+1)%Se.questions.length,answered:!1,selectedAnswer:null})),P(Se=>({...Se,correct:Se.correct+1,mastered:Se.mastered+1})),ga({status:"correct",word:ee.word,timestamp:Date.now()},"translation")}else F(ge=>({...ge,currentIndex:(ge.currentIndex+1)%ge.questions.length,answered:!1,selectedAnswer:null}));wt.current=Date.now(),!O&&n==="translation"&&Re(ge=>{const Se=ge+1;if(Se>=50)return Ye(!0),ut("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(Se%10===0){const ue=$e(A.questions,"translation");ue.needsRescheduling&&(Ye(!0),ut(ue.reason))}return Se})},Je=ee=>{const ge=A.questions[A.currentIndex];if(ge){const Se=Date.now()-wt.current;So(ge.word,A.selectedAnswer===ge.meaning,Se,ee,"translation")}};return u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx(FY,{isVisible:t,message:"Ë™≠„ÅøËæº„Åø‰∏≠..."}),u.jsxs("div",{className:"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2",children:[u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="memorization"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("memorization"),children:"üí° ÊöóË®ò"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="translation"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("translation"),children:"üìù ÂíåË®≥"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="spelling"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("spelling"),children:"‚úèÔ∏è „Çπ„Éö„É´"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="grammar"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>{e("grammar"),s(!0),setTimeout(()=>s(!1),1500),Uy()},children:"üìö ÊñáÊ≥ï"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="reading"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>{e("reading"),s(!0),setTimeout(()=>s(!1),1500),Uy()},children:"üìñ Èï∑Êñá"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="grammar-guide"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("grammar-guide"),children:"üîñ ÂèÇËÄÉ"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="dictionary"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("dictionary"),children:"üìï ËæûÊõ∏"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="stats"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("stats"),children:"üìä ÊàêÁ∏æ"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="settings"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("settings"),children:"‚öôÔ∏è Ë®≠ÂÆö"})]}),u.jsx(CY,{isOpen:c,onClose:()=>l(!1),sets:i.sets,onCreateSet:De,onDeleteSet:Ie,onEditSet:Dt,onRemoveWord:z}),u.jsx("div",{className:"p-2 md:p-6 bg-gray-50",children:u.jsx("div",{className:"max-w-app mx-auto",children:n==="memorization"?u.jsx(xY,{allQuestions:r,questionSets:N,customQuestionSets:i.sets,onAddWordToCustomSet:j,onRemoveWordFromCustomSet:z,onOpenCustomSetManagement:()=>l(!0)}):n==="translation"?u.jsx(D9,{quizState:A,_categoryList:d,selectedCategory:p,onCategoryChange:te,selectedDifficulty:m,onDifficultyChange:Q,selectedWordPhraseFilter:x,onWordPhraseFilterChange:y,selectedPhraseTypeFilter:b,onPhraseTypeFilterChange:v,selectedDataSource:w,onDataSourceChange:S,questionSets:N,onStartQuiz:U,onAnswer:ce,onNext:le,onPrevious:Pe,onSkip:ve,onDifficultyRate:Je,onReviewFocus:M,sessionStats:D,isReviewFocusMode:O,errorPrediction:A.questions.length>0&&A.currentIndex<A.questions.length?de.current.get(A.questions[A.currentIndex].word):void 0,customQuestionSets:i.sets,onAddWordToCustomSet:j,onRemoveWordFromCustomSet:z,onOpenCustomSetManagement:()=>l(!0)}):n==="spelling"?u.jsx(P9,{questions:A.questions,_categoryList:d,selectedCategory:p,onCategoryChange:te,selectedDifficulty:m,onDifficultyChange:Q,selectedWordPhraseFilter:x,onWordPhraseFilterChange:y,selectedPhraseTypeFilter:b,onPhraseTypeFilterChange:v,selectedDataSource:w,onDataSourceChange:S,onStartQuiz:U,onReviewFocus:ie,isReviewFocusMode:O,customQuestionSets:i.sets,onAddWordToCustomSet:j,onRemoveWordFromCustomSet:z,onOpenCustomSetManagement:()=>l(!0)}):n==="reading"?u.jsx(DI,{customQuestionSets:i.sets,onAddWordToCustomSet:j,onRemoveWordFromCustomSet:z,onOpenCustomSetManagement:()=>l(!0),onSaveUnknownWords:async ee=>{if(ee.length===0)return;const ge=new Date,ue=`Èï∑ÊñáÂçòË™ûÈõÜ (${`${ge.getMonth()+1}/${ge.getDate()}`})`,Ve=prompt(`${ee.length}ÂÄã„ÅÆÂçòË™û„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÂïèÈ°åÈõÜ„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`,ue);if(!Ve)return;const yt={id:hc(),name:Ve,questions:ee.map(Ge=>({word:Ge.word,reading:Ge.reading||"",meaning:Ge.meaning,etymology:Ge.etymology||"",relatedWords:Ge.relatedWords||"",relatedFields:Ge.relatedFields||"",difficulty:Ge.difficulty||"intermediate"})),createdAt:Date.now(),isBuiltIn:!1,source:"Èï∑ÊñáË™≠Ëß£"},ot=[...N,yt];C(ot),cI(ot),alert(`‚úÖ ÂïèÈ°åÈõÜ„Äå${Ve}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºà${ee.length}Ë™ûÔºâ`)}}):n==="grammar"?u.jsx(jI,{}):n==="grammar-guide"?u.jsx(yY,{}):n==="dictionary"?u.jsx(SY,{}):n==="stats"?u.jsx(jY,{questionSets:N,allQuestions:r,categoryList:d,onResetComplete:()=>e("stats"),onQuestionSetsUpdated:Ce}):u.jsx(MY,{allQuestions:r,_selectedDataSource:w,_onDataSourceChange:S,customQuestionSets:i.sets,onOpenCustomSetManagement:()=>l(!0),onStartSession:(ee,ge)=>{F({questions:ge,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),ft.current=Date.now(),wt.current=Date.now(),vt.current=[],e("translation")}})})})]})}const zY=()=>{const n=localStorage.getItem("darkMode");let e="system";n==="system"||n==="light"||n==="dark"?e=n:n==="true"?(e="dark",localStorage.setItem("darkMode","dark")):n==="false"&&(e="light",localStorage.setItem("darkMode","light"));let t=!1;e==="system"?t=window.matchMedia("(prefers-color-scheme: dark)").matches:t=e==="dark",document.documentElement.classList.toggle("dark",t)};zY();dp.createRoot(document.getElementById("root")).render(u.jsx(UI.StrictMode,{children:u.jsx(LY,{})}));export{GX as a,R as b,l0 as c,$h as d,Bu as e,Ou as f,Fu as g,nI as h,II as i,oI as j,QY as k,et as l};
//# sourceMappingURL=index-BGjqCIc8.js.map
