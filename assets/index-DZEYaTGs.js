const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HybridScheduleStrategy-BK2kzOV8.js","assets/ScheduleStrategy-BFw-1z1Q.js","assets/chart-vendor-Eu4deRvW.js","assets/react-vendor-C14am9Lm.js","assets/FinalPriorityScheduleStrategy-Dd7FKAyF.js","assets/DefaultScheduleStrategy-CnBVq84Z.js","assets/answerConfidence5-Bnbu2Rea.js","assets/ComprehensiveReadingView-DL2win2t.js","assets/scoreBoardTests-DzaGoxnK.js"])))=>i.map(i=>d[i]);
var Yk=Object.defineProperty;var Jk=(n,e,t)=>e in n?Yk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var me=(n,e,t)=>Jk(n,typeof e!="symbol"?e+"":e,t);import{j as u}from"./chart-vendor-Eu4deRvW.js";import{a as Zk,g as e$,c as zi,b as t$,r as N,R as n$}from"./react-vendor-C14am9Lm.js";function s$(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var Jf={},vx=Zk;Jf.createRoot=vx.createRoot,Jf.hydrateRoot=vx.hydrateRoot;const r$="modulepreload",o$=function(n){return"/"+n},Sx={},On=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=o$(c),c in Sx)return;Sx[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":r$,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return r.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},Kb=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function i$(n){return Kb.includes(n)}const a$={DEV:!1},mf=a$,c$=!!(mf!=null&&mf.DEV),nu=typeof window<"u"&&new URLSearchParams(window.location.search).get("debug")==="true",j={log:(...n)=>{nu&&console.log(...n)},warn:(...n)=>{(c$||nu)&&console.warn(...n)},error:(...n)=>{console.error(...n)},debug:(...n)=>{nu&&console.debug(...n)},info:(...n)=>{nu&&console.info(...n)}};class Ft{static start(e){this.enabled&&performance.mark(`${e}-start`)}static end(e){if(!this.enabled)return 0;try{if(performance.getEntriesByName(`${e}-start`,"mark").length===0)return 0;performance.mark(`${e}-end`),performance.measure(e,`${e}-start`,`${e}-end`);const s=performance.getEntriesByName(e),r=s[s.length-1],o=(r==null?void 0:r.duration)||0;return this.measurements.has(e)||this.measurements.set(e,[]),this.measurements.get(e).push(o),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e),o}catch{return 0}}static getStats(e){const t=this.measurements.get(e);return!t||t.length===0?null:{count:t.length,avg:t.reduce((s,r)=>s+r,0)/t.length,min:Math.min(...t),max:Math.max(...t),p50:this.percentile(t,.5),p95:this.percentile(t,.95),p99:this.percentile(t,.99)}}static percentile(e,t){if(e.length===0)return 0;const s=[...e].sort((o,i)=>o-i),r=Math.ceil(s.length*t)-1;return s[Math.max(0,r)]}static report(){if(!this.enabled)return;const e=Array.from(this.measurements.keys()).map(t=>{const s=this.getStats(t);return s?{label:t,count:s.count,avg:`${s.avg.toFixed(2)}ms`,min:`${s.min.toFixed(2)}ms`,max:`${s.max.toFixed(2)}ms`,p50:`${s.p50.toFixed(2)}ms`,p95:`${s.p95.toFixed(2)}ms`,p99:`${s.p99.toFixed(2)}ms`}:null}).filter(Boolean);console.group("üìä Performance Report"),console.table(e),console.groupEnd()}static export(){const e=Array.from(this.measurements.keys()).reduce((t,s)=>{const r=this.getStats(s);return r&&(t[s]=r),t},{});return JSON.stringify({timestamp:new Date().toISOString(),measurements:e},null,2)}static clear(){this.measurements.clear(),performance.clearMarks(),performance.clearMeasures()}static clearLabel(e){this.measurements.delete(e),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e)}static warnIfSlow(e,t,s){this.enabled&&t>s&&console.warn(`‚ö†Ô∏è [PerformanceMonitor] ${e} took ${t.toFixed(2)}ms (threshold: ${s}ms)`)}static logWithStats(e,t){if(!this.enabled)return;const s=this.getStats(e);s&&s.count>=5?console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms (avg: ${s.avg.toFixed(2)}ms, p95: ${s.p95.toFixed(2)}ms)`):console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms`)}}me(Ft,"measurements",new Map),me(Ft,"enabled",!1);const l$="Nanashi8DB",u$=1,$n={PROGRESS:"progress",SESSION_HISTORY:"sessionHistory",DAILY_STATS:"dailyStats",SETTINGS:"settings"},gi=class gi{constructor(){me(this,"connections",[]);me(this,"pendingConnectionCreations",0);me(this,"config",{maxConnections:5,connectionTimeout:5e3,idleTimeout:6e4});me(this,"initializationPromise",null);me(this,"cleanupInterval",null);this.startCleanupTimer()}static getInstance(){return gi.instance||(gi.instance=new gi),gi.instance}async initialize(){return this.initializationPromise?this.initializationPromise:(this.initializationPromise=this.performInitialization(),this.initializationPromise)}async performInitialization(){Ft.start("db-pool-init");try{this.pendingConnectionCreations++;const e=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:e,lastUsed:Date.now(),inUse:!1});const t=Ft.end("db-pool-init");j.log(`üèä [DBConnectionPool] ÂàùÊúüÂåñÂÆå‰∫Ü (${t.toFixed(2)}ms)`)}catch(e){throw j.error("‚ùå [DBConnectionPool] ÂàùÊúüÂåñÂ§±Êïó:",e),e}}createNewConnection(){return new Promise((e,t)=>{Ft.start("db-connection-open");const s=indexedDB.open(l$,u$),r=setTimeout(()=>{t(new Error("IndexedDB open timeout"))},this.config.connectionTimeout);s.onerror=()=>{clearTimeout(r),Ft.end("db-connection-open"),j.error("‚ùå IndexedDB open error:",s.error),t(s.error)},s.onsuccess=()=>{clearTimeout(r),Ft.end("db-connection-open"),e(s.result)},s.onupgradeneeded=o=>{const i=o.target.result;if(i.objectStoreNames.contains($n.PROGRESS)||i.createObjectStore($n.PROGRESS),!i.objectStoreNames.contains($n.SESSION_HISTORY)){const a=i.createObjectStore($n.SESSION_HISTORY,{keyPath:"id",autoIncrement:!0});a.createIndex("mode","mode",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("modeTimestamp",["mode","timestamp"],{unique:!1})}i.objectStoreNames.contains($n.DAILY_STATS)||i.createObjectStore($n.DAILY_STATS,{keyPath:"date"}).createIndex("date","date",{unique:!0}),i.objectStoreNames.contains($n.SETTINGS)||i.createObjectStore($n.SETTINGS),j.log("üì¶ [DBConnectionPool] Stores created")}})}async getConnection(){Ft.start("db-pool-get-connection"),await this.initialize();const e=this.connections.find(t=>!t.inUse);if(e)return e.inUse=!0,e.lastUsed=Date.now(),Ft.end("db-pool-get-connection"),e.db;if(this.connections.length+this.pendingConnectionCreations<this.config.maxConnections){this.pendingConnectionCreations++;const t=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:t,lastUsed:Date.now(),inUse:!0});const s=Ft.end("db-pool-get-connection");return j.log(`‚ûï [DBConnectionPool] Êñ∞Ë¶èÊé•Á∂ö‰ΩúÊàê (${this.connections.length}/${this.config.maxConnections}) (${s.toFixed(2)}ms)`),t}return j.warn("‚ö†Ô∏è [DBConnectionPool] Êé•Á∂ö„Éó„Éº„É´Ê∫ÄÊùØ„ÄÅÂæÖÊ©ü‰∏≠..."),new Promise(t=>{const s=setInterval(()=>{const r=this.connections.find(o=>!o.inUse);if(r){clearInterval(s),r.inUse=!0,r.lastUsed=Date.now();const o=Ft.end("db-pool-get-connection");j.log(`‚úÖ [DBConnectionPool] ÂæÖÊ©üÂæåÊé•Á∂öÂèñÂæó (${o.toFixed(2)}ms)`),t(r.db)}},10)})}releaseConnection(e){const t=this.connections.find(s=>s.db===e);t&&(t.inUse=!1,t.lastUsed=Date.now())}cleanupIdleConnections(){const t=Date.now()-this.config.idleTimeout,s=this.connections.filter(r=>!r.inUse&&r.lastUsed<t);s.length>0&&(s.forEach(r=>{r.db.close();const o=this.connections.indexOf(r);o!==-1&&this.connections.splice(o,1)}),j.log(`üßπ [DBConnectionPool] „Ç¢„Ç§„Éâ„É´Êé•Á∂öÂâäÈô§: ${s.length}ÂÄã`))}startCleanupTimer(){this.cleanupInterval=window.setInterval(()=>{this.cleanupIdleConnections()},3e4)}async closeAll(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.connections.forEach(e=>{try{e.db.close()}catch(t){j.error("‚ùå [DBConnectionPool] Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫„Ç®„É©„Éº:",t)}}),this.connections=[],this.initializationPromise=null,j.log("üîí [DBConnectionPool] ÂÖ®Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫ÂÆå‰∫Ü")}getStats(){return{totalConnections:this.connections.length,inUseConnections:this.connections.filter(e=>e.inUse).length,availableConnections:this.connections.filter(e=>!e.inUse).length,maxConnections:this.config.maxConnections,oldestConnectionAge:this.connections.length>0?Math.min(...this.connections.map(e=>Date.now()-e.lastUsed)):0}}};me(gi,"instance",null);let Zf=gi;const yc=Zf.getInstance();async function d$(){return await yc.initialize(),yc.getConnection()}async function qp(n,e,t){Ft.start("db-transaction");const s=await yc.getConnection();try{const r=s.transaction(n,e),o=await t(r),i=Ft.end("db-transaction");return o}finally{yc.releaseConnection(s)}}async function h$(){return yc.closeAll()}const f$="Nanashi8DB";function Cd(){try{return"indexedDB"in window&&indexedDB!==null}catch{return!1}}function p$(){return Ft.start("db-init-legacy"),d$().then(n=>(Ft.end("db-init-legacy"),n)).catch(n=>{throw Ft.end("db-init-legacy"),j.error("‚ùå IndexedDB initialization failed:",n),n})}async function Kp(n,e){try{Ft.start("db-get");const t=await qp(n,"readonly",async r=>new Promise((o,i)=>{const c=r.objectStore(n).get(e);c.onsuccess=()=>o(c.result||null),c.onerror=()=>i(c.error)})),s=Ft.end("db-get");return t}catch(t){return Ft.end("db-get"),j.error("getFromDB error:",t),null}}async function $r(n,e,t){try{Ft.start("db-put");const s=await qp(n,"readwrite",async o=>new Promise((i,a)=>{const c=o.objectStore(n),l=t!==void 0?c.put(e,t):c.put(e);l.onsuccess=()=>i(!0),l.onerror=()=>a(l.error)})),r=Ft.end("db-put");return s}catch(s){return Ft.end("db-put"),j.error("putToDB error:",s),!1}}async function Cx(n){try{Ft.start("db-get-all");const e=await qp(n,"readonly",async s=>new Promise((r,o)=>{const a=s.objectStore(n).getAll();a.onsuccess=()=>r(a.result||[]),a.onerror=()=>o(a.error)})),t=Ft.end("db-get-all");return e}catch(e){return Ft.end("db-get-all"),j.error("getAllFromDB error:",e),[]}}async function m$(){try{await h$(),j.log("üîí Connection pool closed before DB deletion")}catch(n){j.error("‚ö†Ô∏è Pool close error:",n)}return new Promise(n=>{const e=indexedDB.deleteDatabase(f$);e.onsuccess=()=>{j.log("üóëÔ∏è Database deleted"),n(!0)},e.onerror=()=>{j.error("Database delete error"),n(!1)}})}const Xb="indexeddb-migration-completed",Xp="1.1";function Nd(){try{return localStorage.getItem(Xb)===Xp}catch{return!1}}function gf(){try{localStorage.setItem(Xb,Xp),j.log("‚úÖ Migration flag set")}catch(n){j.error("Failed to set migration flag:",n)}}function Id(n){try{const e=localStorage.getItem(n);return!e||n.includes("lastLogin")||n.includes("Date")||n.includes("daily-plan")||n.includes("score-board")?null:JSON.parse(e)}catch{return j.warn(`${n} is not valid JSON (skipping)`),null}}function g$(n){try{return localStorage.getItem(n)}catch(e){return j.error(`Failed to get ${n} from localStorage:`,e),null}}async function x$(){try{const n=Id("progress-data");if(n)return n.wordProgress||(n.wordProgress={}),n.results||(n.results=[]),n.statistics||(n.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),n.questionSetStats||(n.questionSetStats={}),await $r($n.PROGRESS,n,"main"),j.log("üì¶ Progress data migrated:",Object.keys(n.wordProgress||{}).length,"words"),!0;j.log("‚ÑπÔ∏è No progress data to migrate, creating initial data");const e={wordProgress:{},results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{}};return await $r($n.PROGRESS,e,"main"),!0}catch(n){return j.error("Progress data migration error:",n),!1}}async function y$(){try{const n=["translation","spelling"];let e=0;for(const t of n){const s=`session-history-${t}`,r=Id(s);if(r&&Array.isArray(r))for(const o of r)await $r($n.SESSION_HISTORY,{mode:t,status:o.status,word:o.word,timestamp:o.timestamp}),e++}return e>0&&j.log("üìú Session history migrated:",e,"items"),!0}catch(n){return j.error("Session history migration error:",n),!1}}async function b$(){try{const n=new Date,e=new Date(n.getTime()-90*24*60*60*1e3);let t=0,s=0;for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.startsWith("studyStats-")){const i=o.replace("studyStats-","");if(new Date(i)>=e){const c=Id(o);c&&(await $r($n.DAILY_STATS,{date:i,...c}),t++)}else localStorage.removeItem(o),s++}}return(t>0||s>0)&&j.log(`üìä Daily stats: migrated ${t}, cleaned ${s}`),!0}catch(n){return j.error("Daily stats migration error:",n),!1}}async function w$(){try{const n=["user-goal-level","loginStreak","radar-improvement-progress","skip-exclude-groups"],e=["lastLoginDate","lastLoginData"];let t=0;for(const r of n)try{if(r.includes("lastLogin")){j.warn(`Skipping ${r} from JSON migration`);continue}const o=Id(r);o!==null&&(await $r($n.SETTINGS,o,r),t++)}catch(o){j.warn(`Failed to migrate ${r}:`,o)}for(const r of e)try{const o=g$(r);o!==null&&(await $r($n.SETTINGS,o,r),t++)}catch(o){j.warn(`Failed to migrate ${r}:`,o)}const s=["translation","spelling","reading"];for(const r of s){const o=`daily-plan-target-${r}`,i=`score-board-goal-${r}`;try{const a=localStorage.getItem(o);a&&(await $r($n.SETTINGS,a,o),t++)}catch(a){j.warn(`Failed to migrate ${o}:`,a)}try{const a=localStorage.getItem(i);a&&(await $r($n.SETTINGS,a,i),t++)}catch(a){j.warn(`Failed to migrate ${i}:`,a)}}return t>0&&j.log("‚öôÔ∏è Settings migrated:",t,"items"),!0}catch(n){return j.error("Settings migration error:",n),!1}}async function v$(){try{const n=await Kp($n.PROGRESS,"main");return n?!n.wordProgress||typeof n.wordProgress!="object"?(j.warn("‚ö†Ô∏è Progress data verification failed - invalid wordProgress"),!1):(j.log("‚úÖ Migration verification passed"),!0):(j.warn("‚ö†Ô∏è Progress data verification failed - no data found"),!1)}catch(n){return j.error("Migration verification error:",n),!1}}async function S$(){if(Nd())return j.log("‚ÑπÔ∏è Migration already completed"),!0;if(!Cd())return j.warn("‚ö†Ô∏è IndexedDB not supported, using localStorage"),!1;j.log("üöÄ Starting data migration to IndexedDB...");try{await p$();const n=await Promise.all([x$(),y$(),b$(),w$()]),e=["Progress","SessionHistory","DailyStats","Settings"];return n.forEach((s,r)=>{s||j.warn(`‚ö†Ô∏è ${e[r]} migration incomplete (may be empty)`)}),n[0]||n.some(s=>s)?await v$()?(gf(),j.log("üéâ Migration completed successfully!"),!0):(j.warn("‚ö†Ô∏è Migration verification failed, but marking as complete"),gf(),!0):(j.warn("‚ö†Ô∏è All migrations returned false, marking as complete anyway"),gf(),!0)}catch(n){return j.error("‚ùå Migration failed:",n),!1}}function C$(){return{completed:Nd(),indexedDBSupported:Cd(),version:Xp}}let wa=!1;function Qb(){wa=Cd()&&Nd(),j.log(`üì¶ Storage strategy: ${wa?"IndexedDB":"localStorage"}`)}async function Yb(n){try{return wa?await $r($n.PROGRESS,n,"main"):(localStorage.setItem("progress-data",JSON.stringify(n)),!0)}catch(e){j.error("saveProgressData error:",e);try{return localStorage.setItem("progress-data",JSON.stringify(n)),!0}catch(t){return j.error("localStorage fallback failed:",t),!1}}}async function Jb(){try{if(wa){const n=await Kp($n.PROGRESS,"main");if(n)return n;const e=localStorage.getItem("progress-data");return e?JSON.parse(e):null}else{const n=localStorage.getItem("progress-data");return n?JSON.parse(n):null}}catch(n){return j.error("loadProgressData error:",n),null}}async function Pa(n,e){try{return wa?await $r($n.SETTINGS,e,n):(localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0)}catch(t){j.error(`saveSetting(${n}) error:`,t);try{return localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0}catch{return!1}}}async function jc(n){try{if(wa){const e=await Kp($n.SETTINGS,n);return e!==null?e:localStorage.getItem(n)||null}else return localStorage.getItem(n)||null}catch(e){return j.error(`loadSetting(${n}) error:`,e),null}}const N$=Object.freeze(Object.defineProperty({__proto__:null,initStorageStrategy:Qb,loadProgressData:Jb,loadSetting:jc,saveProgressData:Yb,saveSetting:Pa},Symbol.toStringTag,{value:"Module"}));class I${filter(e,t){if(e.length===0)return e;const s=Date.now();let r=0;const o=e.map(i=>{if(i.position>=40)return i;const a=this.findRecentAnswer(i.question.word,t.recentAnswers);if(!a)return i;const c=s-a.timestamp;let l=!1,d=i.position;return c<3e4?(d-=100,l=!0,j.debug(`[AntiVibration] Âç≥Â∫ßÂÜçÂá∫È°åÈò≤Ê≠¢: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-100})):c<t.minInterval&&a.correct?(d-=5,l=!0,j.debug(`[AntiVibration] Áü≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-5})):c<t.minInterval*5&&a.correct&&(d-=2,l=!0,j.debug(`[AntiVibration] ‰∏≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-2})),a.consecutiveCorrect>=t.consecutiveThreshold&&(d-=2,l=!0,j.debug(`[AntiVibration] ÈÄ£Á∂öÊ≠£Ëß£È†ªÂ∫¶‰ΩéÊ∏õ: ${i.question.word}`,{consecutiveCorrect:a.consecutiveCorrect,penalty:-2})),l?(r++,{...i,position:d,antiVibrationApplied:!0}):i});return r>0&&j.info(`[AntiVibration] „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®: ${r}Âïè„Å´ÊåØÂãïÈò≤Ê≠¢„Éö„Éä„É´„ÉÜ„Ç£`),o}findRecentAnswer(e,t){return t.find(s=>s.word===e)||null}calculateVibrationScore(e,t,s=20){if(e.length===0)return 0;const r=Date.now();let o=0;const i=e.slice(0,Math.min(s,e.length));i.forEach(c=>{const l=this.findRecentAnswer(c.question.word,t);if(!l)return;const d=r-l.timestamp;d<6e4?o+=10:d<3e5?o+=5:d<6e5&&(o+=2),l.consecutiveCorrect>=3&&(o+=5)});const a=Math.min(o,100);return a>50&&j.warn(`[AntiVibration] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫: ${a}`,{topQuestions:i.slice(0,5).map(c=>c.question.word)}),a}extractSessionPriorityQuestions(e){return e.filter(t=>t.question.sessionPriority!==void 0)}extractNormalQuestions(e){return e.filter(t=>t.question.sessionPriority===void 0)}}const Vr={MASTERED:3,LEARNING:2,STRUGGLING:1,INCORRECT:3,HIGH_PRIORITY:2},oa={EXCELLENT:.9,GOOD:.8,FAIR:.6,POOR:.5},ns={MASTERED_PERFECT:10,MASTERED_ALMOST:15,ONE_SHOT_CORRECT:18,NEAR_MASTERY:25,NEW_NEAR_MASTERY:30,NEW_DEFAULT:35,STILL_LEARNING_LOW:45,STILL_LEARNING_DEFAULT:50,INCORRECT_LIGHT:55,INCORRECT_MEDIUM:70,INCORRECT_HIGH:75,INCORRECT_URGENT:85},Nx={TIME_DECAY_MAX:15,TIME_DECAY_MULTIPLIER:1.5},k$={QUICK_LEARNER:2};function $$(n){return Math.max(0,Math.min(100,n))}function T$(n,e){switch(e){case"memorization":return n.memorizationPosition;case"translation":return n.translationPosition;case"spelling":return n.spellingPosition;case"grammar":return n.grammarPosition}}function A$(n,e){switch(e){case"memorization":return{attempts:n.memorizationAttempts||0,correct:n.memorizationCorrect||0,stillLearning:n.memorizationStillLearning||0};case"translation":return{attempts:n.translationAttempts||0,correct:n.translationCorrect||0,stillLearning:0};case"spelling":return{attempts:n.spellingAttempts||0,correct:n.spellingCorrect||0,stillLearning:0};case"grammar":return{attempts:n.grammarAttempts||0,correct:n.grammarCorrect||0,stillLearning:0}}}function R$(n){const{mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}=n,c=s>0?(r+o*.5)/s:0,l=t>=40&&t<70;return e==="memorization"&&o===0&&l&&i===Vr.STRUGGLING&&a===0&&c>=oa.FAIR?{decision:"ignore_saved_position",reason:"auto_promoted_still_learning_progress",accuracyForOverride:c}:{decision:"use_saved_position",reason:"other",accuracyForOverride:c}}function Jt(n,e="memorization",t={}){if(!n)return ns.NEW_DEFAULT;const s=T$(n,e),r=!t.ignoreSaved,o=A$(n,e),i=o.attempts,a=o.correct,c=o.stillLearning,l=n.consecutiveCorrect||0,d=n.consecutiveIncorrect||0,h=n.lastStudied||Date.now();if(r&&s!==void 0&&s!==null){if(l>=Vr.MASTERED)return ns.MASTERED_PERFECT;if(l>=Vr.LEARNING)return(i>0?(a+c*.5)/i:0)>=oa.GOOD?ns.MASTERED_ALMOST:ns.NEAR_MASTERY;if(R$({mode:e,savedPosition:s,attempts:i,correct:a,stillLearning:c,consecutiveCorrect:l,consecutiveIncorrect:d}).decision!=="ignore_saved_position")return s}const f=(Date.now()-h)/(1e3*60*60*24),p=a+c*.5,m=i>0?p/i:0;if(i===0)return ns.NEW_DEFAULT;if(l>=Vr.MASTERED)return ns.MASTERED_PERFECT;if(l>=Vr.LEARNING)return m>=oa.GOOD?ns.MASTERED_ALMOST:ns.NEAR_MASTERY;if(e==="memorization"&&c>0&&d===0&&l<Vr.LEARNING)return ns.STILL_LEARNING_DEFAULT;if(l===Vr.STRUGGLING)return m>=oa.EXCELLENT&&i<=k$.QUICK_LEARNER?ns.ONE_SHOT_CORRECT:m>=oa.FAIR?ns.NEW_NEAR_MASTERY:ns.STILL_LEARNING_LOW;if(d>=Vr.INCORRECT)return ns.INCORRECT_URGENT;if(d>=Vr.HIGH_PRIORITY)return ns.INCORRECT_HIGH;if(d>=Vr.STRUGGLING)return m>=oa.POOR?ns.INCORRECT_LIGHT:ns.INCORRECT_MEDIUM;if(c>0&&l===0&&d===0)return ns.STILL_LEARNING_DEFAULT;const g=ns.STILL_LEARNING_DEFAULT-m*30+d*10,x=Math.min(f*Nx.TIME_DECAY_MULTIPLIER,Nx.TIME_DECAY_MAX),y=g+x;return $$(y)}function bc(n){return n>=70?"incorrect":n>=40?"still_learning":n>=20?"new":"mastered"}const Ix={incorrect:{min:70,max:100,category:"incorrect"},still_learning:{min:40,max:69,category:"still_learning"},new:{min:20,max:39,category:"new"},mastered:{min:0,max:19,category:"mastered"}};class E${extractStats(e){return{attempts:(e==null?void 0:e.memorizationAttempts)||0,correct:(e==null?void 0:e.memorizationCorrect)||0,stillLearning:(e==null?void 0:e.memorizationStillLearning)||0}}getSavedPosition(e){return e==null?void 0:e.memorizationPosition}}class D${extractStats(e){return{attempts:(e==null?void 0:e.translationAttempts)||0,correct:(e==null?void 0:e.translationCorrect)||0,stillLearning:0}}getSavedPosition(e){return e==null?void 0:e.translationPosition}}class j${extractStats(e){return{attempts:(e==null?void 0:e.spellingAttempts)||0,correct:(e==null?void 0:e.spellingCorrect)||0,stillLearning:0}}getSavedPosition(e){return e==null?void 0:e.spellingPosition}}class _${extractStats(e){return{attempts:(e==null?void 0:e.grammarAttempts)||0,correct:(e==null?void 0:e.grammarCorrect)||0,stillLearning:0}}getSavedPosition(e){return e==null?void 0:e.grammarPosition}}const P$={memorization:new E$,translation:new D$,spelling:new j$,grammar:new _$};class zs{constructor(e){me(this,"mode");me(this,"strategy");this.mode=e,this.strategy=P$[e]}calculate(e,t={}){return Jt(e,this.mode,{ignoreSaved:t.ignoreSaved})}getStats(e){return this.strategy.extractStats(e)}static rangeOf(e){for(const t of Object.values(Ix))if(e>=t.min&&e<=t.max)return t;return Ix.new}static categoryOf(e){return this.rangeOf(e).category}}function M$(n){switch(n){case"incorrect":return!0;default:return!1}}function Zb(n){switch(n){case"incorrect":case"still_learning":return!0;default:return!1}}class mo{static buildContext(e,t){const r=new Date().getHours(),o=r<12?"morning":r<17?"afternoon":r<21?"evening":"night",i=mo.calculateCognitiveLoad(e.sessionStats),a=mo.getRecentAnswers(e.mode,e.progressOverride,t),c=t.constructor.getProgressMapFromParams(e),l={};for(const d of e.questions){const h=c[d.word];h&&(l[d.word]=h)}return{mode:e.mode,sessionStats:e.sessionStats,recentAnswers:a,timeOfDay:o,cognitiveLoad:i,isReviewFocusMode:e.isReviewFocusMode||!1,sessionStartTime:Date.now()-(e.sessionStats.duration||0),wordProgress:l}}static calculateCognitiveLoad(e){const t=e.correct+e.incorrect>0?e.incorrect/(e.correct+e.incorrect):0,s=(e.duration||0)/6e4,r=Math.min(s/30,1);return Math.min(t*.7+r*.3,1)}static getRecentAnswers(e,t,s){if(s.recentAnswersCache.has(e)&&!t)return s.recentAnswersCache.get(e);try{const r=t??(nt().wordProgress||{}),o=[];Object.entries(r||{}).forEach(([a,c])=>{if(c.lastStudied>0){const d=new zs(e).calculate(c),h=zs.categoryOf(d);o.push({word:a,correct:!M$(h),timestamp:c.lastStudied,consecutiveCorrect:c.streak||0})}}),o.sort((a,c)=>c.timestamp-a.timestamp);const i=o.slice(0,100);return t||s.recentAnswersCache.set(e,i),i}catch(r){return j.error("[ScheduleHelpers] Ëß£Á≠îÂ±•Ê≠¥„ÅÆÂèñÂæó„Å´Â§±Êïó",r),[]}}static detectSignals(e){try{const t=[],s=e.sessionStats,r=s.correct+s.incorrect+s.still_learning,o=r>0?s.incorrect/r:0,i=(s.duration||0)/6e4;if(i>20||e.cognitiveLoad>.7){const c=Math.min(i/30*.5+e.cognitiveLoad*.5,1);t.push({type:"fatigue",confidence:c,action:"easier"}),j.debug(`[Signal] Áñ≤Âä¥Ê§úÂá∫: ${(c*100).toFixed(0)}%`)}if(o>.4&&r>=5){const c=Math.min(o,.9);t.push({type:"struggling",confidence:c,action:"review"}),j.debug(`[Signal] Ëã¶Êà¶Ê§úÂá∫: ${(c*100).toFixed(0)}% („Ç®„É©„ÉºÁéá${(o*100).toFixed(0)}%)`)}const a=s.consecutiveCorrect||0;if(a>10){const c=Math.min(a/15,.9);t.push({type:"overlearning",confidence:c,action:"harder"}),j.debug(`[Signal] ÈÅéÂ≠¶ÁøíÊ§úÂá∫: ${(c*100).toFixed(0)}% (ÈÄ£Á∂ö${a}ÂõûÊ≠£Ëß£)`)}return o>=.2&&o<=.35&&a<8&&(t.push({type:"optimal",confidence:.8,action:"continue"}),j.debug("[Signal] ÊúÄÈÅ©Â≠¶ÁøíÁä∂ÊÖãÊ§úÂá∫")),t.length===0&&j.debug("[Signal] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Å™„Åó - ÈÄöÂ∏∏„É¢„Éº„Éâ"),t}catch(t){return j.error("[ScheduleHelpers] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Ç®„É©„Éº",t),[]}}static loadProgressCache(){try{return nt()}catch(e){return j.error("[ScheduleHelpers] loadProgressCacheÂ§±Êïó",e),{wordProgress:{}}}}static getWordStatusFromCache(e,t,s){if(!s||!s.wordProgress)return null;const r=s.wordProgress[e];if(!r)return null;const o=new zs(t),i=o.calculate(r),a=o.getStats(r);return{category:zs.categoryOf(i),position:i,lastStudied:r.lastStudied||0,attempts:a.attempts,correct:a.correct,streak:r.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1}}static applyAntiVibration(e,t,s){return s.antiVibration.filter(e,{recentAnswers:t.recentAnswers,minInterval:6e4,consecutiveThreshold:3})}}function F$(n,e){const t=e!=null&&e.mode?String(e.mode):"";return t?[`${n}_${t}`,n]:[n]}function Nu(n,e){if(typeof localStorage>"u")return{raw:null,key:null};const t=F$(n,e);for(const s of t)try{const r=localStorage.getItem(s);if(r!=null)return{raw:r,key:s}}catch{}return{raw:null,key:null}}function Qp(n,e){const{raw:t,key:s}=Nu(n,e);if(!t)return{value:null,key:null};try{return{value:JSON.parse(t),key:s}}catch{return{value:null,key:null}}}function O$(n,e,t,s){if(typeof localStorage>"u")return;const r=t!=null&&t.mode?String(t.mode):"",o=(s==null?void 0:s.writeLegacy)!==!1;try{const i=JSON.stringify(e);r&&localStorage.setItem(`${n}_${r}`,i),o&&localStorage.setItem(n,i)}catch{}}const xf={weights:{memory:1,cognitiveLoad:.8,errorPrediction:.7,learningStyle:.5,linguistic:.4,contextual:.6,gamification:.3},emergencyThresholds:{forgettingRisk:150,cognitiveOverload:!0,consecutiveErrors:5},debugMode:!1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L$=1e-7,z$=1e-4;class ew{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Yp{refCount(e){return Fs("refCount")}incRef(e){return Fs("incRef")}timerAvailable(){return!0}time(e){return Fs("time")}read(e){return Fs("read")}readSync(e){return Fs("readSync")}readToGPU(e,t){return Fs("readToGPU")}numDataIds(){return Fs("numDataIds")}disposeData(e,t){return Fs("disposeData")}write(e,t,s){return Fs("write")}move(e,t,s,r,o){return Fs("move")}createTensorFromGPUData(e,t,s){return Fs("createTensorFromGPUData")}memory(){return Fs("memory")}floatPrecision(){return Fs("floatPrecision")}epsilon(){return this.floatPrecision()===32?L$:z$}dispose(){return Fs("dispose")}}function Fs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W$(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,ia(n,e,t)}function Ii(n,e,t){return Math.max(n,Math.min(e,t))}function Jp(n){return n%2===0?n:n+1}function ia(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function B$(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function R(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Zp(n,e,t=""){R(tn(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function tw(n){R(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function fe(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function tn(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function va(n){return n%1===0}function ep(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function da(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function kx(n,e=r=>0,t,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const c=e(i);if(t!=null&&i>=t){o();return}s!=null?s(a,c):setTimeout(a,c)};a()})}function nw(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Lt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),R(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),R(n.every(s=>va(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Ko(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Lt(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function us(n,e){return En(n,e)}function En(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function V$(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function U$(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function sw(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Ru(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function G$(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function _c(n){return typeof n=="string"||n instanceof String}function H$(n){return typeof n=="boolean"}function tp(n){return typeof n=="number"}function Ma(n){return Array.isArray(n)?Ma(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":tp(n)?"float32":_c(n)?"string":H$(n)?"bool":"float32"}function np(n){return!!(n&&n.constructor&&n.call&&n.apply)}function sp(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function xt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function rw(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((c,l)=>c*l)*(s?2:1);for(let c=0;c<o;c++)r[c]=rw(n+c*a,i,t,s)}return r}function Rr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return rw(0,n,e,t)}function q$(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function em(n,e){const t=ds(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function ds(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function ow(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Rr(n,new Float32Array(t));if(e==="int32")return Rr(n,new Int32Array(t));if(e==="bool")return Rr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function No(n){n.forEach(e=>{R(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Zr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Fa(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function tm(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $x="tfjsflags";class K${constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=X$,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ce().getBool("IS_TEST")||ce().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];ce().getBool("IS_TEST")||ce().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(tm(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);$x in e&&e[$x].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=Y$(r,o)})}}function X$(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Q$(e,s[0],s[1]),s.join("="))),e}function Q$(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Y$(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ce(){return iw}let iw=null;function J$(n){iw=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let yf;function aw(){if(yf==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");yf=n}return yf}function Z$(){const n=aw();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function nm(n,e){const t=Z$();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const kd="Abs",Pc="Acos",Mc="Acosh",Oa="Add",sm="AddN",rm="All",om="Any",$d="ArgMax",Td="ArgMin",Fc="Asin",Oc="Asinh",Lc="Atan",zc="Atanh",Wc="Atan2",Ad="AvgPool",im="AvgPoolGrad",Rd="AvgPool3D",am="AvgPool3DGrad",Ed="BatchMatMul",Dd="BatchToSpaceND",cm="Bincount",lm="BitwiseAnd",e2="BroadcastTo",cw="BroadcastArgs",Bc="Cast",Vc="Ceil",Uc="ClipByValue",um="Complex",jd="ComplexAbs",_d="Concat",Pd="Conv2D",dm="Conv2DBackpropFilter",Md="Conv2DBackpropInput",Fd="Conv3D",hm="Conv3DBackpropFilterV2",fm="Conv3DBackpropInputV2",Gc="Cos",Hc="Cosh",pm="Cumprod",Od="Cumsum",mm="CropAndResize",gm="DenseBincount",xm="DepthToSpace",Ld="DepthwiseConv2dNative",ym="DepthwiseConv2dNativeBackpropFilter",bm="DepthwiseConv2dNativeBackpropInput",lw="Diag",zd="Dilation2D",rp="Dilation2DBackpropInput",op="Dilation2DBackpropFilter",t2="Draw",qc="RealDiv",wm="Einsum",Kc="Elu",vm="EluGrad",Xc="Erf",Wd="Equal",Qc="Exp",Bd="ExpandDims",Yc="Expm1",Sm="FFT",Cm="Fill",Nm="FlipLeftRight",Jc="Floor",Zc="FloorDiv",Vd="FusedBatchNorm",Ud="GatherV2",uw="GatherNd",Gd="Greater",el="GreaterEqual",tl="Identity",Im="IFFT",km="Imag",nl="IsFinite",sl="IsInf",rl="IsNan",Hd="LeakyRelu",qd="Less",Kd="LessEqual",dw="LinSpace",ol="Log",il="Log1p",Xd="LogicalAnd",Qd="LogicalNot",Yd="LogicalOr",n2="LogSoftmax",Jd="LRN",$m="LRNGrad",Zd="Max",al="Maximum",eh="MaxPool",Tm="MaxPoolGrad",th="MaxPool3D",Am="MaxPool3DGrad",hw="MaxPoolWithArgmax",nh="Mean",sh="Min",cl="Minimum",rh="MirrorPad",ll="Mod",fw="Multinomial",ul="Multiply",oh="Neg",ih="NotEqual",Rm="NonMaxSuppressionV3",Em="NonMaxSuppressionV4",Dm="NonMaxSuppressionV5",ah="OnesLike",ch="OneHot",lh="Pack",uh="PadV2",dl="Pow",dh="Prelu",hh="Prod",pw="RaggedGather",mw="RaggedRange",gw="RaggedTensorToTensor",jm="Range",_m="Real",hl="Reciprocal",fl="Relu",fh="Reshape",ph="ResizeNearestNeighbor",Pm="ResizeNearestNeighborGrad",mh="ResizeBilinear",Mm="ResizeBilinearGrad",pl="Relu6",gh="Reverse",ml="Round",gl="Rsqrt",xw="ScatterNd",yw="TensorScatterUpdate",bw="SearchSorted",xh="Select",xl="Selu",yh="Slice",yl="Sin",bl="Sinh",wl="Sign",vl="Sigmoid",Sl="Softplus",Cl="Sqrt",bh="Sum",wh="SpaceToBatchND",vh="SplitV",Sh="Softmax",ww="SparseFillEmptyRows",vw="SparseReshape",Sw="SparseSegmentMean",Cw="SparseSegmentSum",Nw="SparseToDense",Nl="SquaredDifference",Fm="Square",Om="StaticRegexReplace",Lm="StridedSlice",Iw="StringNGrams",kw="StringSplit",$w="StringToHashBucketFast",Il="Sub",kl="Tan",$l="Tanh",Tl="Tile",zm="TopK",Wm="Transform",ha="Transpose",Bm="Unique",Ch="Unpack",Nh="UnsortedSegmentSum",Ih="ZerosLike",Al="Step",s2="FromPixels",Vm="RotateWithOffset",Eu="_FusedMatMul",Du="FusedConv2D",Tw="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xs(...n){ce().getBool("IS_TEST")||ce().getBool("PROD")||console.warn(...n)}function r2(...n){ce().getBool("IS_TEST")||ce().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ju=nm("kernelRegistry",()=>new Map),ip=nm("gradRegistry",()=>new Map);function Tx(n,e){const t=Rw(n,e);return ju.get(t)}function Ax(n){return ip.get(n)}function Rx(n){const e=ju.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&t.push(i)}return t}function Aw(n){const{kernelName:e,backendName:t}=n,s=Rw(e,t);ju.has(s)&&Xs(`The kernel '${e}' for backend '${t}' is already registered`),ju.set(s,n)}function o2(n){const{kernelName:e}=n;ip.has(e)&&ce().getBool("DEBUG")&&Xs(`Overriding the gradient for '${e}'`),ip.set(e,n)}function Rw(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ew(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Dw=wn,ar=null;try{ar=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function wn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}wn.prototype.__isLong__;Object.defineProperty(wn.prototype,"__isLong__",{value:!0});function qs(n){return(n&&n.__isLong__)===!0}wn.isLong=qs;var Ex={},Dx={};function Wi(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=Dx[n],s)?s:(t=vn(n,(n|0)<0?-1:0,!0),r&&(Dx[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=Ex[n],s)?s:(t=vn(n,n<0?-1:0,!1),r&&(Ex[n]=t),t))}wn.fromInt=Wi;function cr(n,e){if(isNaN(n))return e?xi:lr;if(e){if(n<0)return xi;if(n>=jw)return Mw}else{if(n<=-_x)return Bs;if(n+1>=_x)return Pw}return n<0?cr(-n,e).neg():vn(n%Sa|0,n/Sa|0,e)}wn.fromNumber=cr;function vn(n,e,t){return new wn(n,e,t)}wn.fromBits=vn;var _u=Math.pow;function Um(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return lr;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Um(n.substring(1),e,t).neg();for(var r=cr(_u(t,8)),o=lr,i=0;i<n.length;i+=8){var a=Math.min(8,n.length-i),c=parseInt(n.substring(i,i+a),t);if(a<8){var l=cr(_u(t,a));o=o.mul(l).add(cr(c))}else o=o.mul(r),o=o.add(cr(c))}return o.unsigned=e,o}wn.fromString=Um;function Mr(n,e){return typeof n=="number"?cr(n,e):typeof n=="string"?Um(n,e):vn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}wn.fromValue=Mr;var jx=65536,i2=1<<24,Sa=jx*jx,jw=Sa*Sa,_x=jw/2,Px=Wi(i2),lr=Wi(0);wn.ZERO=lr;var xi=Wi(0,!0);wn.UZERO=xi;var ua=Wi(1);wn.ONE=ua;var _w=Wi(1,!0);wn.UONE=_w;var ap=Wi(-1);wn.NEG_ONE=ap;var Pw=vn(-1,2147483647,!1);wn.MAX_VALUE=Pw;var Mw=vn(-1,-1,!0);wn.MAX_UNSIGNED_VALUE=Mw;var Bs=vn(0,-2147483648,!1);wn.MIN_VALUE=Bs;var Ue=wn.prototype;Ue.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ue.toNumber=function(){return this.unsigned?(this.high>>>0)*Sa+(this.low>>>0):this.high*Sa+(this.low>>>0)};Ue.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Bs)){var t=cr(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=cr(_u(e,6),this.unsigned),i=this,a="";;){var c=i.div(o),l=i.sub(c.mul(o)).toInt()>>>0,d=l.toString(e);if(i=c,i.isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}};Ue.getHighBits=function(){return this.high};Ue.getHighBitsUnsigned=function(){return this.high>>>0};Ue.getLowBits=function(){return this.low};Ue.getLowBitsUnsigned=function(){return this.low>>>0};Ue.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Bs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Ue.isZero=function(){return this.high===0&&this.low===0};Ue.eqz=Ue.isZero;Ue.isNegative=function(){return!this.unsigned&&this.high<0};Ue.isPositive=function(){return this.unsigned||this.high>=0};Ue.isOdd=function(){return(this.low&1)===1};Ue.isEven=function(){return(this.low&1)===0};Ue.equals=function(e){return qs(e)||(e=Mr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ue.eq=Ue.equals;Ue.notEquals=function(e){return!this.eq(e)};Ue.neq=Ue.notEquals;Ue.ne=Ue.notEquals;Ue.lessThan=function(e){return this.comp(e)<0};Ue.lt=Ue.lessThan;Ue.lessThanOrEqual=function(e){return this.comp(e)<=0};Ue.lte=Ue.lessThanOrEqual;Ue.le=Ue.lessThanOrEqual;Ue.greaterThan=function(e){return this.comp(e)>0};Ue.gt=Ue.greaterThan;Ue.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ue.gte=Ue.greaterThanOrEqual;Ue.ge=Ue.greaterThanOrEqual;Ue.compare=function(e){if(qs(e)||(e=Mr(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ue.comp=Ue.compare;Ue.negate=function(){return!this.unsigned&&this.eq(Bs)?Bs:this.not().add(ua)};Ue.neg=Ue.negate;Ue.add=function(e){qs(e)||(e=Mr(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,d=0,h=0,f=0,p=0;return p+=o+l,f+=p>>>16,p&=65535,f+=r+c,h+=f>>>16,f&=65535,h+=s+a,d+=h>>>16,h&=65535,d+=t+i,d&=65535,vn(f<<16|p,d<<16|h,this.unsigned)};Ue.subtract=function(e){return qs(e)||(e=Mr(e)),this.add(e.neg())};Ue.sub=Ue.subtract;Ue.multiply=function(e){if(this.isZero())return lr;if(qs(e)||(e=Mr(e)),ar){var t=ar.mul(this.low,this.high,e.low,e.high);return vn(t,ar.get_high(),this.unsigned)}if(e.isZero())return lr;if(this.eq(Bs))return e.isOdd()?Bs:lr;if(e.eq(Bs))return this.isOdd()?Bs:lr;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Px)&&e.lt(Px))return cr(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,d=e.low&65535,h=0,f=0,p=0,m=0;return m+=i*d,p+=m>>>16,m&=65535,p+=o*d,f+=p>>>16,p&=65535,p+=i*l,f+=p>>>16,p&=65535,f+=r*d,h+=f>>>16,f&=65535,f+=o*l,h+=f>>>16,f&=65535,f+=i*c,h+=f>>>16,f&=65535,h+=s*d+r*l+o*c+i*a,h&=65535,vn(p<<16|m,h<<16|f,this.unsigned)};Ue.mul=Ue.multiply;Ue.divide=function(e){if(qs(e)||(e=Mr(e)),e.isZero())throw Error("division by zero");if(ar){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ar.div_u:ar.div_s)(this.low,this.high,e.low,e.high);return vn(t,ar.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?xi:lr;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return xi;if(e.gt(this.shru(1)))return _w;o=xi}else{if(this.eq(Bs)){if(e.eq(ua)||e.eq(ap))return Bs;if(e.eq(Bs))return ua;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(lr)?e.isNegative()?ua:ap:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(Bs))return this.unsigned?xi:lr;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=lr}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:_u(2,a-48),l=cr(s),d=l.mul(e);d.isNegative()||d.gt(r);)s-=c,l=cr(s,this.unsigned),d=l.mul(e);l.isZero()&&(l=ua),o=o.add(l),r=r.sub(d)}return o};Ue.div=Ue.divide;Ue.modulo=function(e){if(qs(e)||(e=Mr(e)),ar){var t=(this.unsigned?ar.rem_u:ar.rem_s)(this.low,this.high,e.low,e.high);return vn(t,ar.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ue.mod=Ue.modulo;Ue.rem=Ue.modulo;Ue.not=function(){return vn(~this.low,~this.high,this.unsigned)};Ue.and=function(e){return qs(e)||(e=Mr(e)),vn(this.low&e.low,this.high&e.high,this.unsigned)};Ue.or=function(e){return qs(e)||(e=Mr(e)),vn(this.low|e.low,this.high|e.high,this.unsigned)};Ue.xor=function(e){return qs(e)||(e=Mr(e)),vn(this.low^e.low,this.high^e.high,this.unsigned)};Ue.shiftLeft=function(e){return qs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?vn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):vn(0,this.low<<e-32,this.unsigned)};Ue.shl=Ue.shiftLeft;Ue.shiftRight=function(e){return qs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?vn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):vn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ue.shr=Ue.shiftRight;Ue.shiftRightUnsigned=function(e){if(qs(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var s=this.low;return vn(s>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?vn(t,0,this.unsigned):vn(t>>>e-32,0,this.unsigned)};Ue.shru=Ue.shiftRightUnsigned;Ue.shr_u=Ue.shiftRightUnsigned;Ue.toSigned=function(){return this.unsigned?vn(this.low,this.high,!1):this};Ue.toUnsigned=function(){return this.unsigned?this:vn(this.low,this.high,!0)};Ue.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ue.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ue.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};wn.fromBytes=function(e,t,s){return s?wn.fromBytesLE(e,t):wn.fromBytesBE(e,t)};wn.fromBytesLE=function(e,t){return new wn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};wn.fromBytesBE=function(e,t){return new wn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Fw=e$(Dw),a2=s$({__proto__:null,default:Fw},[Dw]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fi=Fw||a2;function kh(n){return fi.fromString(n,!0,16)}const Ow=kh("c3a5c85c97cb3127"),ui=kh("b492b66fbe98f273"),ws=kh("9ae16a3b2f90404f");function cp(n){return n.xor(n.shru(47))}function Lw(n,e,t){const s=n.slice(e,e+t);return fi.fromBytes(Array.from(s),!0,!0)}function fn(n,e){return Lw(n,e,8)}function Mx(n,e){return Lw(n,e,4)}function Xn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Mo(n,e,t=kh("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function c2(n,e,t,s,r,o){r=r.add(n),o=Xn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(Xn(r,44)),[r.add(s),o.add(i)]}function su(n,e,t,s){return c2(fn(n,e),fn(n,e+8),fn(n,e+16),fn(n,e+24),t,s)}function l2(n,e=n.length){if(e>=8){const t=ws.add(e*2),s=fn(n,0).add(ws),r=fn(n,e-8),o=Xn(r,37).mul(t).add(s),i=Xn(s,25).add(r).mul(t);return Mo(o,i,t)}if(e>=4){const t=ws.add(e*2),s=Mx(n,0);return Mo(s.shl(3).add(e),Mx(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return cp(ws.mul(o).xor(Ow.mul(i))).mul(ws)}return ws}function u2(n,e=n.length){const t=ws.add(e*2),s=fn(n,0).mul(ui),r=fn(n,8),o=fn(n,e-8).mul(t),i=fn(n,e-16).mul(ws);return Mo(Xn(s.add(r),43).add(Xn(o,30)).add(i),s.add(Xn(r.add(ws),18)).add(o),t)}function d2(n,e=n.length){const t=ws.add(e*2),s=fn(n,0).mul(ws),r=fn(n,8),o=fn(n,e-8).mul(t),i=fn(n,e-16).mul(ws),a=Xn(s.add(r),43).add(Xn(o,30)).add(i),c=Mo(a,s.add(Xn(r.add(ws),18)).add(o),t),l=fn(n,16).mul(t),d=fn(n,24),h=a.add(fn(n,e-32)).mul(t),f=c.add(fn(n,e-24)).mul(t);return Mo(Xn(l.add(d),43).add(Xn(h,30)).add(f),l.add(Xn(d.add(s),18)).add(h),t)}function h2(n,e=n.length){const t=fi.fromNumber(81,!0);if(e<=32)return e<=16?l2(n,e):u2(n,e);if(e<=64)return d2(n,e);let s=t,r=t.mul(ui).add(113),o=cp(r.mul(ws).add(113)).mul(ws),i=[fi.UZERO,fi.UZERO],a=[fi.UZERO,fi.UZERO];s=s.mul(ws).add(fn(n,0));let c=0;const l=(e-1>>6)*64,d=l+(e-1&63)-63;do s=Xn(s.add(r).add(i[0]).add(fn(n,c+8)),37).mul(ui),r=Xn(r.add(i[1]).add(fn(n,c+48)),42).mul(ui),s=s.xor(a[1]),r=r.add(i[0]).add(fn(n,c+40)),o=Xn(o.add(a[0]),33).mul(ui),i=su(n,c,i[1].mul(ui),s.add(a[0])),a=su(n,c+32,o.add(a[1]),r.add(fn(n,c+16))),[o,s]=[s,o],c+=64;while(c!==l);const h=ui.add(o.and(255).shl(1));return c=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Xn(s.add(r).add(i[0]).add(fn(n,c+8)),37).mul(h),r=Xn(r.add(i[1]).add(fn(n,c+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(fn(n,c+40))),o=Xn(o.add(a[0]),33).mul(h),i=su(n,c,i[1].mul(h),s.add(a[0])),a=su(n,c+32,o.add(a[1]),r.add(fn(n,c+16))),[o,s]=[s,o],Mo(Mo(i[0],a[0],h).add(cp(r).mul(Ow)).add(o),Mo(i[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(n,e){return e==="string"?Fo(n):Bi([n],e)}function f2(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Bi(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ki(n)),ce().getBool("DEBUG")&&V$(n,e),f2(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Ts(){return ce().platform.now()}function Fo(n,e="utf-8"){return e=e||"utf-8",ce().platform.encode(n,e)}function Bo(n,e="utf-8"){return e=e||"utf-8",ce().platform.decode(n,e)}function hr(n){return ce().platform.isTypedArray!=null?ce().platform.isTypedArray(n):Ew(n)}function ki(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||tm(n)||n==null||hr(n)&&t)e.push(n);else if(Array.isArray(n)||hr(n))for(let s=0;s<n.length;++s)ki(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)ki(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p2{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new g2)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const a=Ts();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const l of r)l.dataSync();i=Promise.resolve({kernelMs:Ts()-a})}if(ce().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const d=r[l];d.data().then(h=>{m2(h,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(c=>{this.logger.logKernelProfile(t,a,c[0],c[1],o,c[2])})})}}function m2(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class g2{logKernelProfile(e,t,s,r,o,i){const a=typeof r=="number"?da(`${r}ms`,9):r.error,c=da(e,25),l=t.rank,d=t.size,h=da(t.shape.toString(),14);let f="";for(const p in o){const m=o[p];if(m!=null){const g=m.shape||t.shape,x=g.length;f+=`${p}: ${x}D ${x>0?g:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${d}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(n,e,t){const s={},r={};for(let c=0;c<e.length;c++)s[e[c].id]=!0;for(let c=0;c<n.length;c++){const l=n[c],d=l.inputs;for(const h in d){const f=d[h];let p=!1;for(let m=0;m<e.length;m++)if(s[f.id]){l.outputs.forEach(g=>s[g.id]=!0),p=!0,r[l.id]=!0;break}if(p)break}}const o={};o[t.id]=!0;const i={};for(let c=n.length-1;c>=0;c--){const l=n[c],d=l.inputs;for(let h=0;h<l.outputs.length;h++)if(o[l.outputs[h].id]){for(const f in d)o[d[f].id]=!0,i[l.id]=!0;break}}const a=[];for(let c=0;c<n.length;c++){const l=n[c];if(r[l.id]&&i[l.id]){const d={};for(const f in l.inputs){const p=l.inputs[f];s[p.id]&&(d[f]=p)}const h=Object.assign({},l);h.inputs=d,h.outputs=l.outputs,a.push(h)}}return a}function y2(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(c=>{const l=n[c.id];l!=null?i.push(l):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const c in o.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=t(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const d=o.inputs[c];if(!tn(l.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=l;else{const h=n[d.id];n[d.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fx=20,Za=3,bf=7;function b2(n,e,t,s){const r=xt(e),o=w2(n,e,t,r),i=e.length,a=Iu(n,e,t,r,o),c=["Tensor"];return s&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${i}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function w2(n,e,t,s){const r=fe(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,c=t==="complex64"?ic(n):n;if(a>1)for(let l=0;l<r/o;l++){const d=l*o;for(let h=0;h<o;h++)i[h]=Math.max(i[h],oc(c[d+h],0,t).length)}return i}function oc(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(bf))} + ${parseFloat(n[1].toFixed(bf))}j`:_c(n)?s=`'${n}'`:t==="bool"?s=zw(n):s=parseFloat(n.toFixed(bf)).toString(),da(s,e)}function zw(n){return n===0?"false":"true"}function Iu(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,a=e[0],c=e.length;if(c===0){if(t==="complex64"){const g=ic(n);return[oc(g[0],0,t)]}return t==="bool"?[zw(n[0])]:[n[0].toString()]}if(c===1){if(a>Fx){const x=Za*i;let y=Array.from(n.slice(0,x)),b=Array.from(n.slice((a-Za)*i,a*i));return t==="complex64"&&(y=ic(y),b=ic(b)),["["+y.map((w,v)=>oc(w,r[v],t)).join(", ")+", ..., "+b.map((w,v)=>oc(w,r[a-Za+v],t)).join(", ")+"]"]}return["["+(t==="complex64"?ic(n):Array.from(n)).map((x,y)=>oc(x,r[y],t)).join(", ")+"]"]}const l=e.slice(1),d=s.slice(1),h=s[0]*i,f=[];if(a>Fx){for(let g=0;g<Za;g++){const x=g*h,y=x+h;f.push(...Iu(n.slice(x,y),l,t,d,r,!1))}f.push("...");for(let g=a-Za;g<a;g++){const x=g*h,y=x+h;f.push(...Iu(n.slice(x,y),l,t,d,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*h,y=x+h;f.push(...Iu(n.slice(x,y),l,t,d,r,g===a-1))}const p=c===2?",":"";f[0]="["+(a>0?f[0]+p:"");for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+p;let m=`,
`;for(let g=2;g<c;g++)m+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":m),f}function ic(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rs{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=fe(e),s!=null){const r=s.length;R(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||En(t,this.size),this.strides=xt(e)}set(e,...t){t.length===0&&(t=[0]),R(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Nr().makeTensor(this.values,this.shape,this.dtype)}}let Nr=null,aa=null;function v2(n){Nr=n}function S2(n){aa=n}class Wn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=fe(e),this.strides=xt(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return aa.buffer(this.shape,this.dtype,e)}bufferSync(){return aa.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Rr(this.shape,e,this.dtype==="complex64")}arraySync(){return Rr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Nr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Bo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Nr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Nr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Bo(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Nr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Nr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return aa.print(this,e)}clone(){return this.throwIfDisposed(),aa.clone(this)}toString(e=!1){const t=this.dataSync();return b2(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),aa.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),Nr().makeVariable(this,e,t,s)}}Object.defineProperty(Wn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function de(){return nm("Tensor",()=>Wn)}de();class Pu extends Wn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!tn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Nr().disposeTensor(this),this.dataId=e.dataId,Nr().incRef(this,null)}dispose(){Nr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Pu,Symbol.hasInstance,{value:n=>n instanceof Wn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ox;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Ox||(Ox={}));var lp;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(lp||(lp={}));var up;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(up||(up={}));var dp;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(dp||(dp={}));var hp;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(hp||(hp={}));const C2={float32:dp,int32:lp,bool:up,complex64:hp};function Us(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return C2[n][e]}function Gm(n){return Us(n,"int32")}function Ww(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function Bw(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n,e){if(n.dtype===e.dtype)return[n,e];const t=Us(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function Vw(n){const e=[];return Uw(n,e,new Set),e}function Uw(n,e,t){if(n==null)return;if(n instanceof Wn){e.push(n);return}if(!N2(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),Uw(o,e,t))}}function N2(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wf(n){return n.kernelName!=null}class Lx{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Ca{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Lx}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Xs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new p2(this.backendInstance),!0}setupRegisteredKernels(){Rx(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Rx(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof Yp)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Xs(`Initialization of backend ${e} failed`),Xs(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Xs(`Initialization of backend ${e} failed`),Xs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return Ca.nextTensorId++}nextVariableId(){return Ca.nextVariableId++}clone(e){const t=Q.runKernel(tl,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",c={x:i},l={dtype:a};return Q.runKernel(Bc,c,l)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(Tx(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(c=>{o+=c.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=wf(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(wf(e)){const{kernelName:m,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const y=Tx(m,this.backendName);R(y!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();c=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});const w=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,b,w);const v=w.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(m,g,v);s=this.saveTensorsForBackwardMode(S)}return v}}else{const{forwardFunc:m}=e,g=x=>{r&&(s=x.map(y=>this.keep(this.clone(y))))};a=()=>{const x=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,g));const y=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,x,y),y}}const{inputs:d,attrs:h}=e,f=wf(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(p=this.profiler.profileKernel(l,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),r&&this.addTapeNode(l,d,t,f,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(m=>d[m]!=null?d[m].shape:null),outputShapes:t.map(m=>m.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(c)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=Ax(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(R(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(l=>t[l])):a=o.map(l=>t[l]);const c=s.filter((l,d)=>i[d]);return a.concat(c)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&_c(e[0])&&(o=e.map(c=>Fo(c)));const i=r.write(o,t,s),a=new Wn(t,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const c=this.state.tensorInfo.get(i),l=G$(o);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new Wn(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new Pu(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Ru(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Pu||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Ru(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},c=Ax(e);c!=null&&(r=c.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((d,h)=>{if(d==null){const f=s[h],p=ds(f.size,f.dtype);return this.makeTensor(p,f.shape,f.dtype)}return d}),r(l.length>1?l:l[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=Vw(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(R(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));R(o instanceof Wn,()=>"The result y returned by f() must be a tensor.");const i=x2(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??I2(o.shape),y2(a,i,l=>this.tidy(l),k2);const c=t.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const d of l.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:c}})}customGrad(e){return R(np(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{R(t.every(a=>a instanceof Wn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,c)=>{r[c]=a});const o=(a,c)=>(s=e(...t,c),R(s.value instanceof Wn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),R(np(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,c)=>{const l=s.gradFunc(a,c),d=Array.isArray(l)?l:[l];R(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),R(d.every(f=>f instanceof Wn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return d.forEach((f,p)=>{h[p]=()=>f}),h};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Ts(),s=await this.backend.time(e);return s.wallMs=Ts()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Lx;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Ca.nextTensorId=0;Ca.nextVariableId=0;function I2(n){const e=em(fe(n),"float32");return Q.makeTensor(e,n,"float32")}function Gw(){const n=aw();if(n._tfengine==null){const e=new K$(n);n._tfengine=new Ca(e)}return J$(n._tfengine.ENV),v2(()=>n._tfengine),n._tfengine}const Q=Gw();function k2(n,e){const t={a:n,b:e};return Q.runKernel(Oa,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(){return typeof navigator<"u"&&navigator!=null}function Hw(n){if(n||$2()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function qw(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ds=ce();Ds.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ds.registerFlag("IS_BROWSER",()=>qw());Ds.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ds.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ds.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ds.registerFlag("PROD",()=>!1);Ds.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ds.getBool("DEBUG"));Ds.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ds.registerFlag("IS_TEST",()=>!1);Ds.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ds.getBool("DEBUG"));Ds.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ds.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ds.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $h(n,e){let t=n;if(hr(n))return e==="string"?[]:[n.length];if(Ww(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(Bw(n))return[n.buffer.size/(e==null?4:Ru(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||hr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&ce().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Kw(n,s,[]),s}function Kw(n,e,t){if(t=t||[],!Array.isArray(n)&&!hr(n)){R(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}R(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),R(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)Kw(n[r],s,t.concat(r))}function zx(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function W(n,e,t,s="numeric"){if(n instanceof de())return zx(s,n.dtype,e,t),n;let r=Ma(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),zx(s,r,e,t),n==null||!hr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const c=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}const o=$h(n,r);!hr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Bi(n,r):ki(n,[],!0);return Q.makeTensor(a,o,r)}function Xw(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>W(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T2="__op";function J(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+T2;const r=(...o)=>{Q.startScope(t);try{const i=s(...o);return tm(i)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(i),i}catch(i){throw Q.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A2(n,e){const t=W(n,"real","complex"),s=W(e,"imag","complex");Zp(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return Q.runKernel(um,r)}const $i=J({complex_:A2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Th(n,e,t,s){if(s==null)s=Ma(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Bw(n)||Ww(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return Q.backend.createTensorFromGPUData(n,e||t,s)}if(!hr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){No(e);const r=fe(e),o=fe(t);R(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],c=i===t.length-1?a!==fe(e.slice(i)):!0;R(t[i]===e[i]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!hr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Bi(n,s):ki(n,[],!0),Q.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fa(n,e,t){const s=$h(n,t);return Th(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Qo{static join(e){return new Qo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>hr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let c=s;c<this.shards.length;c++){const l=this.shards[c],h=e+a-l.start,f=a,m=Math.min(t,l.end)-l.start,g=new Uint8Array(l.buffer,h,m-h);if(i.set(g,f),a+=g.length,t<l.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=R2(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function R2(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ur(){return Q}function fp(){return Q.memory()}function ie(n,e){return Q.tidy(n,e)}function Pt(n){Vw(n).forEach(t=>t.dispose())}function eo(n){return Q.keep(n)}function Qw(n,e,t=1){return Q.registerBackend(n,e,t)}function E2(){return Q.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Na=4;async function Wx(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],c=Array.isArray(n)?n[i].tensor:n[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);const l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const d=new Promise(async h=>{const f=await c.bytes(),p=f.reduce((x,y)=>x+y.length,0)+Na*f.length,m=new Uint8Array(p);let g=0;for(let x=0;x<f.length;x++){const y=f[x],b=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(b,g),g+=Na,m.set(y,g),g+=y.length}h(m)});s.push(d)}else s.push(c.data());e!=null&&(l.group=e),t.push(l)}const o=await Promise.all(s);return{data:P2(o),specs:t}}function D2(n,e){const t=new Qo(n),s={};let r=0;for(const o of e){const i=j2(o,(a,c)=>t.slice(r+a,r+c));s[o.name]=_2(o,t.slice(r,r+i)),r+=i}return s}function j2(n,e){const t=fe(n.shape);let s;if("quantization"in n){const r=n.quantization;s=Mu[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=Na+new Uint32Array(e(r,r+Na))[0];return r}else s=Mu[n.dtype];return t*s}function _2(n,e){const t=n.name,s=n.dtype,r=n.shape,o=fe(r);let i,a=0;if("quantization"in n){const c=n.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${n.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const l=Mu[c.dtype],d=c.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){i=new Float32Array(d.length);for(let h=0;h<d.length;h++){const f=d[h];i[h]=f*c.scale+c.min}}else if(c.dtype==="float16")i=G2()(d);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(s==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let h=0;h<d.length;h++){const f=d[h];i[h]=Math.round(f*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*l}else if(s==="string"){const c=fe(n.shape);i=[];for(let l=0;l<c;l++){const d=new Uint32Array(e.slice(a,a+Na))[0];a+=Na;const h=new Uint8Array(e.slice(a,a+d));i.push(h),a+=d}}else{const c=Mu[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const l=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let m=0;m<l.length;m++)l[m]=i[m*2],d[m]=i[m*2+1];const h=fa(l,r,"float32"),f=fa(d,r,"float32"),p=$i(h,f);return h.dispose(),f.dispose(),p}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*c}return fa(i,r,s)}function P2(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const Hm=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Bx(n){return Hm?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function M2(n){if(Hm)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function F2(n){if(Hm){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function O2(n){return Qo.join(n)}function L2(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function z2(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function W2(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),z2(n,t,s)}function qm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:Bx(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:Bx(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Qo(n.weightData).byteLength}}function Vx(n){const e=[];for(const t of n)e.push(...t.weights);return e}function B2(){const n=t=>{let s=t<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function V2(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function U2(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function G2(){const n=B2(),e=V2(),t=U2();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],c=n[t[a>>10]+(a&1023)]+e[a>>10];o[i]=c}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Kn.instance==null&&(Kn.instance=new Kn),Kn.instance}static registerSaveRouter(e){Kn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Kn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Kn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Kn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Kn.getInstance().loadRouters:Kn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const H2=n=>Kn.getSaveHandlers(n),q2=(n,e)=>Kn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pp="tensorflowjs",mp=1,yi="models_store",Do="model_info_store";function Yw(){if(!ce().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function gp(n){const e=n.result;e.createObjectStore(yi,{keyPath:"modelPath"}),e.createObjectStore(Do,{keyPath:"modelPath"})}class Ti{constructor(e){if(this.indexedDB=Yw(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(pp,mp);o.onupgradeneeded=()=>gp(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(yi,"readonly"),l=a.objectStore(yi).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=d=>(i.close(),r(l.error)),a.oncomplete=()=>i.close()}else{t.weightData=Qo.join(t.weightData);const a=qm(t),c=i.transaction(Do,"readwrite");let l=c.objectStore(Do),d;try{d=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return r(f)}let h;d.onsuccess=()=>{h=i.transaction(yi,"readwrite");const f=h.objectStore(yi);let p;try{p=f.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(m){return r(m)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=m=>{l=c.objectStore(Do);const g=l.delete(this.modelPath);g.onsuccess=()=>(i.close(),r(p.error)),g.onerror=x=>(i.close(),r(p.error))}},d.onerror=f=>(i.close(),r(d.error)),c.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}Ti.URL_SCHEME="indexeddb://";const Jw=n=>ce().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ti.URL_SCHEME)?K2(n.slice(Ti.URL_SCHEME.length)):null;Kn.registerSaveRouter(Jw);Kn.registerLoadRouter(Jw);function K2(n){return new Ti(n)}function X2(n){return n.startsWith(Ti.URL_SCHEME)?n.slice(Ti.URL_SCHEME.length):n}class Q2{constructor(){this.indexedDB=Yw()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(pp,mp);s.onupgradeneeded=()=>gp(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(Do,"readonly"),a=o.objectStore(Do).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;e(c)},a.onerror=c=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=X2(e),new Promise((t,s)=>{const r=this.indexedDB.open(pp,mp);r.onupgradeneeded=()=>gp(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(Do,"readwrite"),a=i.objectStore(Do),c=a.get(e);let l;c.onsuccess=()=>{if(c.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),h=()=>{l=o.transaction(yi,"readwrite");const p=l.objectStore(yi).delete(e);p.onsuccess=()=>t(c.result.modelArtifactsInfo),p.onerror=m=>s(c.error)};d.onsuccess=h,d.onerror=f=>(h(),o.close(),s(c.error))}},c.onerror=d=>(o.close(),s(c.error)),i.oncomplete=()=>{l==null?o.close():l.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xo="/",ca="tensorflowjs_models",Zw="info",Y2="model_topology",J2="weight_specs",Z2="weight_data",eT="model_metadata";function ev(n){return{info:[ca,n,Zw].join(xo),topology:[ca,n,Y2].join(xo),weightSpecs:[ca,n,J2].join(xo),weightData:[ca,n,Z2].join(xo),modelMetadata:[ca,n,eT].join(xo)}}function tv(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function tT(n){const e=n.split(xo);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(xo)}function nT(n){return n.startsWith(Ai.URL_SCHEME)?n.slice(Ai.URL_SCHEME.length):n}class Ai{constructor(e){if(!ce().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=ev(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=qm(e),o=Qo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,M2(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw tv(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=F2(i),t}}Ai.URL_SCHEME="localstorage://";const nv=n=>ce().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ai.URL_SCHEME)?sT(n.slice(Ai.URL_SCHEME.length)):null;Kn.registerSaveRouter(nv);Kn.registerLoadRouter(nv);function sT(n){return new Ai(n)}class rT{constructor(){R(ce().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),R(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=ca+xo,s=xo+Zw;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=tT(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=nT(e);const t=ev(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return tv(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ux="://";class Hr{constructor(){this.managers={}}static getInstance(){return Hr.instance==null&&(Hr.instance=new Hr),Hr.instance}static registerManager(e,t){R(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Ux)&&(e=e.slice(0,e.indexOf(Ux))),R(e.length>0,()=>"scheme must not be an empty string.");const s=Hr.getInstance();R(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Hr.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Hr.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oT{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ce().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return Ew(e)}}if(ce().get("IS_BROWSER")){ce().setPlatform("browser",new oT);try{Hr.registerManager(Ai.URL_SCHEME,new rT)}catch{}try{Hr.registerManager(Ti.URL_SCHEME,new Q2)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iT={importFetch:()=>require("node-fetch")};let vf;class aT{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ce().global.fetch!=null?ce().global.fetch(e,t):(vf==null&&(vf=iT.importFetch()),vf(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ce().get("IS_NODE")&&!ce().get("IS_BROWSER")&&ce().setPlatform("node",new aT);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ot(n,e="float32",t){return e=e||"float32",No(n),new rs(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cT(n,e){const t=W(n,"x","cast");if(!U$(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return Q.runKernel(Bc,s,r)}const Ze=J({cast_:cT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lT(n){const t={x:W(n,"x","clone","string_or_numeric")};return Q.runKernel(tl,t)}const vi=J({clone_:lT});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uT(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Gw();const dT={buffer:Ot,cast:Ze,clone:vi,print:uT};S2(dT);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hT(n,e){let t=W(n,"a","add"),s=W(e,"b","add");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(Oa,r)}const Te=J({add_:hT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(n,e){let t=W(n,"a","floorDiv"),s=W(e,"b","floorDiv");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(Zc,r)}const sv=J({floorDiv_:fT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pT(n,e){let t=W(n,"a","div"),s=W(e,"b","div");if([t,s]=jn(t,s),t.dtype==="int32"&&s.dtype==="int32")return sv(t,s);const r={a:t,b:s},o={};return Q.runKernel(qc,r,o)}const wt=J({div_:pT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(n,e){let t=W(n,"a","mul"),s=W(e,"b","mul");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(ul,r)}const X=J({mul_:mT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gT(n){const e=W(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Q.runKernel(jd,t)}else{const t={x:e};return Q.runKernel(kd,t)}}const ys=J({abs_:gT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(n){const t={x:W(n,"x","acos")};return Q.runKernel(Pc,t)}const yT=J({acos_:xT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(n){const t={x:W(n,"x","acosh")};return Q.runKernel(Mc,t)}const wT=J({acosh_:bT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vT(n,e=null,t=!1){const r={x:W(n,"x","all","bool")},o={axis:e,keepDims:t};return Q.runKernel(rm,r,o)}const rv=J({all_:vT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ST(n,e=null,t=!1){const r={x:W(n,"x","any","bool")},o={axis:e,keepDims:t};return Q.runKernel(om,r,o)}const xp=J({any_:ST});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CT(n,e=0){const s={x:W(n,"x","argMax")},r={axis:e};return Q.runKernel($d,s,r)}const wc=J({argMax_:CT});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(n,e=0){const s={x:W(n,"x","argMin")},r={axis:e};return Q.runKernel(Td,s,r)}const IT=J({argMin_:NT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kT(n){const t={x:W(n,"x","asin")};return Q.runKernel(Fc,t)}const $T=J({asin_:kT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TT(n){const t={x:W(n,"x","asinh")};return Q.runKernel(Oc,t)}const AT=J({asinh_:TT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RT(n){const t={x:W(n,"x","atan")};return Q.runKernel(Lc,t)}const ET=J({atan_:RT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DT(n,e){let t=W(n,"a","atan2"),s=W(e,"b","atan2");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(Wc,r)}const jT=J({atan2_:DT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _T(n){const t={x:W(n,"x","atanh")};return Q.runKernel(zc,t)}const PT=J({atanh_:_T});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rl(n,e,t,s,r="NHWC",o){const i=n[3],a=[...e,i],c=ko(r);return os(n,a,t,o,s,null,null,c)}function pr(n,e,t,s,r,o,i="channelsLast"){const[a,c]=vc(e);let l;if(i==="channelsLast")l=[a,c,n[3],n[3]];else if(i==="channelsFirst")l=[a,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return os(n,l,t,s,r,o,!1,i)}function Io(n,e,t,s,r,o,i="NDHWC"){const[a,c,l]=yp(e);let d,h;if(i==="NDHWC")h="channelsLast",d=[a,c,l,n[4],n[4]];else if(i==="NCDHW")h="channelsFirst",d=[a,c,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Yo(n,d,t,s,r,!1,h,o)}function os(n,e,t,s,r,o,i=!1,a="channelsLast"){let[c,l,d,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,d,h]=n;else if(a==="channelsFirst")[c,h,l,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[f,p,,m]=e,[g,x]=vc(t),[y,b]=vc(s),w=pa(f,y),v=pa(p,b),{padInfo:S,outHeight:C,outWidth:k}=OT(r,l,d,g,x,w,v,o,a),I=i?m*h:m;let A;return a==="channelsFirst"?A=[c,I,C,k]:a==="channelsLast"&&(A=[c,C,k,I]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:d,inChannels:h,outHeight:C,outWidth:k,outChannels:I,padInfo:S,strideHeight:g,strideWidth:x,filterHeight:f,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:y,dilationWidth:b,inShape:n,outShape:A,filterShape:e}}function Yo(n,e,t,s,r,o=!1,i="channelsLast",a){let[c,l,d,h,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[c,l,d,h,f]=n;else if(i==="channelsFirst")[c,f,l,d,h]=n;else throw new Error(`Unknown dataFormat ${i}`);const[p,m,g,,x]=e,[y,b,w]=yp(t),[v,S,C]=yp(s),k=pa(p,v),I=pa(m,S),A=pa(g,C),{padInfo:T,outDepth:E,outHeight:$,outWidth:D}=LT(r,l,d,h,y,b,w,k,I,A,a),M=o?x*f:x;let P;return i==="channelsFirst"?P=[c,M,E,$,D]:i==="channelsLast"&&(P=[c,E,$,D,M]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:d,inWidth:h,inChannels:f,outDepth:E,outHeight:$,outWidth:D,outChannels:M,padInfo:T,strideDepth:y,strideHeight:b,strideWidth:w,filterDepth:p,filterHeight:m,filterWidth:g,effectiveFilterDepth:k,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationDepth:v,dilationHeight:S,dilationWidth:C,inShape:n,outShape:P,filterShape:e}}function MT(n,e,t,s,r){s==null&&(s=Km(n,e,t));const o=n[0],i=n[1],a=Sc((o-e+2*s)/t+1,r),c=Sc((i-e+2*s)/t+1,r);return[a,c]}function FT(n,e,t,s,r,o){r==null&&(r=Km(n,e[0],s[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(i[a]=Sc((n[a]-e[a]+2*r)/s[a]+1,o));return i}function Km(n,e,t,s=1){const r=pa(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function vc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function yp(n){return typeof n=="number"?[n,n,n]:n}function pa(n,e){return e<=1?n:n+(n-1)*(e-1)}function OT(n,e,t,s,r,o,i,a,c){let l,d,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const p=MT([e,t],o,s,n,a);d=p[0],h=p[1]}else if(n==="same"){d=Math.ceil(e/s),h=Math.ceil(t/r);const f=Math.max(0,(d-1)*s+o-e),p=Math.max(0,(h-1)*r+i-t),m=Math.floor(f/2),g=f-m,x=Math.floor(p/2),y=p-x;l={top:m,bottom:g,left:x,right:y,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),h=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const f=c==="channelsLast"?n[1][0]:n[2][0],p=c==="channelsLast"?n[1][1]:n[2][1],m=c==="channelsLast"?n[2][0]:n[3][0],g=c==="channelsLast"?n[2][1]:n[3][1];l={top:f,bottom:p,left:m,right:g,type:f===0&&p===0&&m===0&&g===0?"VALID":"EXPLICIT"},d=Sc((e-o+f+p)/s+1,a),h=Sc((t-i+m+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:d,outWidth:h}}function LT(n,e,t,s,r,o,i,a,c,l,d){let h,f,p,m;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=FT([e,t,s,1],[a,c,l],1,[r,o,i],n,d);f=x[0],p=x[1],m=x[2]}else if(n==="same"){f=Math.ceil(e/r),p=Math.ceil(t/o),m=Math.ceil(s/i);const g=(f-1)*r+a-e,x=(p-1)*o+c-t,y=(m-1)*i+l-s,b=Math.floor(g/2),w=g-b,v=Math.floor(x/2),S=x-v,C=Math.floor(y/2),k=y-C;h={top:v,bottom:S,left:C,right:k,front:b,back:w,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:f,outHeight:p,outWidth:m}}function Sc(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ri(n){const[e,t,s]=vc(n);return e===1&&t===1&&s===1}function fs(n,e){return Ri(n)||Ri(e)}function Ei(n){return vc(n).every(e=>e>0)}function ko(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function _s(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")R(va(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{R(va(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zT(n,e){const s={x:W(n,"x","reshape","string_or_numeric")},r={shape:e};return Q.runKernel(fh,s,r)}const Y=J({reshape_:zT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WT(n,e,t,s,r){const o=W(n,"x","avgPool","float32"),i=1;R(fs(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,c=!1;o.rank===3&&(c=!0,a=Y(o,[1,o.shape[0],o.shape[1],o.shape[2]])),R(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),_s("avgPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let h=Q.runKernel(Ad,l,d);return h=Ze(h,o.dtype),c?Y(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Xm=J({avgPool_:WT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BT(n,e,t,s,r,o="NDHWC"){const i=W(n,"x","avgPool3d","float32");let a=i,c=!1;i.rank===4&&(c=!0,a=Y(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),R(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),R(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),R(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),_s("avgPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let h=Q.runKernel(Rd,l,d);return h=Ze(h,a.dtype),c?Y(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const VT=J({avgPool3d_:BT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(n,e=0){R(n.length>=1,()=>"Pass at least one tensor to concat");const t=Xw(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return vi(t[0]);const s=t,r={axis:e};return Q.runKernel(_d,s,r)}const Es=J({concat_:UT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GT(n,e,t=!1,s=!1){let r=W(n,"a","matMul"),o=W(e,"b","matMul");[r,o]=jn(r,o);const i={a:r,b:o},a={transposeA:t,transposeB:s};return Q.runKernel(Ed,i,a)}const Zt=J({matMul_:GT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HT(n){const t={x:W(n,"x","sigmoid","float32")};return Q.runKernel(vl,t)}const La=J({sigmoid_:HT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qT(n,e,t){const s=W(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return Q.runKernel(yh,r,o)}const pn=J({slice_:qT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KT(n){const t={x:W(n,"x","tanh","float32")};return Q.runKernel($l,t)}const Ah=J({tanh_:KT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XT(n,e,t){const s=W(n,"x","batchToSpaceND"),r=e.reduce((a,c)=>a*c);R(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),R(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),R(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return Q.runKernel(Dd,o,i)}const Qm=J({batchToSpaceND_:XT});function QT(n){let e;return n.rank===0||n.rank===1?e=Y(n,[1,1,1,n.size]):n.rank===2?e=Y(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=Y(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(n,e,t,s,r,o){o==null&&(o=.001);const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;s!=null&&(d=W(s,"offset","batchNorm")),R(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:QT(i),scale:l,offset:d,mean:a,variance:c},p={varianceEpsilon:o},m=Q.runKernel(Vd,f,p);return Y(m,i.shape)}const Rh=J({batchNorm_:YT});function JT(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),R(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),R(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),R(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&R(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),d!=null&&R(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),Rh(i,a,c,d,l,o)}const ZT=J({batchNorm2d_:JT});function eA(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),R(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),R(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),R(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&R(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),d!=null&&R(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),Rh(i,a,c,d,l,o)}const tA=J({batchNorm3d_:eA});function nA(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),R(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),R(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),R(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&R(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),d!=null&&R(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),Rh(i,a,c,d,l,o)}const sA=J({batchNorm4d_:nA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(n,e,t){const s=W(n,"x","bincount"),r=W(e,"weights","bincount");R(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),R(t>=0,()=>`size must be non-negative, but got ${t}.`),R(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return Q.runKernel(cm,o,i)}const oA=J({bincount_:rA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(n,e){let t=W(n,"broadcastTo","x");const s=t.shape;if(No(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=Y(t,l)}const r=t.shape,o=Array.from(e);for(let l=e.length-1;l>=0;l--)if(r[l]===e[l])o[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((l,d)=>l>1?d:-1).filter(l=>l>=0).length===0)return vi(t);const a={x:t},c={reps:o};return Q.runKernel(Tl,a,c)}const mc=J({broadcastTo_:iA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aA(n){const t={x:W(n,"x","ceil","float32")};return Q.runKernel(Vc,t)}const cA=J({ceil_:aA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eh(n,e,t){No(n),t=t||Ma(e);const s={shape:n,value:e,dtype:t};return Q.runKernel(Cm,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lA(n,e,t){const s=W(n,"x","clipByValue");if(R(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Eh(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return Q.runKernel(Uc,r,o)}const Js=J({clipByValue_:lA});function uA(n){return Es(n,0)}const dA=J({concat1d_:uA});function hA(n,e){return Es(n,e)}const fA=J({concat2d_:hA});function pA(n,e){return Es(n,e)}const mA=J({concat3d_:pA});function gA(n,e){return Es(n,e)}const xA=J({concat4d_:gA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(n,e,t,s,r="NHWC",o=[1,1],i){const a=W(n,"x","conv2d","float32"),c=W(e,"filter","conv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),_s("conv2d",s,i);const h=r==="NHWC"?l.shape[3]:l.shape[1];R(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),R(fs(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),R(Ei(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),R(Ei(t),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:l,filter:c},p={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=Q.runKernel(Pd,f,p);return d?Y(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Di=J({conv2d_:yA});function bA(n,e,t,s,r="NWC",o=1,i){const a=W(n,"x","conv1d"),c=W(e,"filter","conv1d");let l=a,d=!1;a.rank===2&&(d=!0,l=Y(a,[1,a.shape[0],a.shape[1]])),R(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),R(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),_s("conv1d",s,i),R(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),R(fs(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),R(Ei(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),R(Ei(t),()=>"Error in conv1D: Stride should be larger than 0."),R(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=Y(c,[1,c.shape[0],c.shape[1],c.shape[2]]),f=Y(l,[l.shape[0],1,l.shape[1],l.shape[2]]),x=Di(f,h,[1,t],s,"NHWC",[1,o],i);return d?Y(x,[x.shape[2],x.shape[3]]):Y(x,[x.shape[0],x.shape[2],x.shape[3]])}const ov=J({conv1d_:bA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(n,e,t,s,r,o="NHWC",i){R(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,c=e,l=!1;e.rank===3&&(l=!0,c=Y(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),R(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),R(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),R(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?c.shape[3]:c.shape[1];R(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),R(h===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[3]}.`),_s("conv2dDerInput",r,i);const f={dy:c,filter:t},p={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},m=Q.runKernel(Md,f,p);return l?Y(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Ym=J({conv2DBackpropInput_:wA});function vA(n,e,t,s,r,o){const i=W(n,"x","conv2dTranspose"),a=W(e,"filter","conv2dTranspose");return Ym(t,i,a,s,r,"NHWC",o)}const iv=J({conv2dTranspose_:vA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=W(n,"x","conv3d"),a=W(e,"filter","conv3d");let c=i,l=!1;i.rank===4&&(l=!0,c=Y(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),R(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),R(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),R(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),R(fs(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),R(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),R(Ei(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),R(Ei(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:c,filter:a},h={strides:t,pad:s,dataFormat:r,dilations:o},f=Q.runKernel(Fd,d,h);return l?Y(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const CA=J({conv3d_:SA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n,e,t,s,r){R(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=Y(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const c=o[4],l=i.shape[4];R(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),R(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),R(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),R(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),R(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},h={pad:r,strides:s,inputShape:o},f=Q.runKernel(fm,d,h);return a?Y(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const av=J({conv3DBackpropInput_:NA});function IA(n,e,t,s,r){const o=W(n,"x","conv3dTranspose"),i=W(e,"filter","conv3dTranspose");return av(t,o,i,s,r)}const kA=J({conv3dTranspose_:IA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n){const t={x:W(n,"x","cos","float32")};return Q.runKernel(Gc,t)}const Jm=J({cos_:$A});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n){const t={x:W(n,"x","cosh","float32")};return Q.runKernel(Hc,t)}const cv=J({cosh_:TA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AA(n,e=0,t=!1,s=!1){const o={x:W(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return Q.runKernel(pm,o,i)}const bp=J({cumprod_:AA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n,e=0,t=!1,s=!1){const o={x:W(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return Q.runKernel(Od,o,i)}const lv=J({cumsum_:RA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n,e,t,s=!1){const r=W(n,"x","denseBincount"),o=W(e,"weights","denseBincount");R(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),R(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),R(t>=0,()=>`size must be non-negative, but got ${t}.`),R(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:t,binaryOutput:s};return Q.runKernel(gm,i,a)}const Gx=J({denseBincount_:EA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n,e,t="NHWC"){const s=W(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];R(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),R(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),R(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),R(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},c={blockSize:e,dataFormat:t};return Q.runKernel(xm,a,c)}const jA=J({depthToSpace_:DA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n,e,t,s,r="NHWC",o=[1,1],i){const a=W(n,"x","depthwiseConv2d","float32"),c=W(e,"filter","depthwiseConv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=r==="NHWC"?l.shape[3]:l.shape[1];R(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),_s("depthwiseConv2d",s,i);const f={x:l,filter:c},p={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=Q.runKernel(Ld,f,p);return d?Y(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Zm=J({depthwiseConv2d_:_A});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PA(n,e,t,s,r=[1,1],o="NHWC"){const i=W(n,"x","dilation2d"),a=W(e,"filter","dilation2d");R(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),R(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),R(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let c=i,l=!1;i.rank===3&&(c=Y(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),R(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);const d={x:c,filter:a},h={strides:t,pad:s,dilations:r},f=Q.runKernel(zd,d,h);return l?Y(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const MA=J({dilation2d_:PA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ia(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function Hn(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function Dt(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[t-r-1]=i;else if(i===1)s[t-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FA(n,e){let t=W(n,"a","equal","string_or_numeric"),s=W(e,"b","equal","string_or_numeric");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Wd,r)}const io=J({equal_:FA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(n,e,t){const s=W(e,"a","where"),r=W(t,"b","where"),o=W(n,"condition","where","bool"),i=Dt(Dt(o.shape,s.shape),r.shape),a=mc(o,i),c=mc(s,i),l=mc(r,i),d={condition:a,t:c,e:l};return Q.runKernel(xh,d)}const Ss=J({where_:OA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n){const t={x:W(n,"x","zerosLike")};return Q.runKernel(Ih,t)}const Kt=J({zerosLike_:LA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n,e){let t=W(n,"a","div"),s=W(e,"b","div");[t,s]=jn(t,s);const r=wt(t,s),o=Kt(r),i=io(s,o);return Ss(i,o,r)}const WA=J({divNoNan_:zA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BA(n,e){const t=W(n,"t1","dot"),s=W(e,"t2","dot");R((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(R(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=Y(t,[1,-1]),a=Y(s,[-1,1]),c=Zt(i,a);return Y(c,[])}else if(t.rank===1&&s.rank===2){const i=Y(t,[1,-1]),a=Y(s,[s.shape[0],s.shape[1]]),c=Zt(i,a);return Y(c,[c.size])}else if(t.rank===2&&s.rank===1){const i=Y(s,[-1,1]),a=Zt(t,i);return Y(a,[a.size])}else{const i=Y(s,[s.shape[0],s.shape[1]]);return Zt(t,i)}}const VA=J({dot_:BA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UA(n,...e){const t=e.map((r,o)=>W(r,`tensors${o}`,"einsum")),s={equation:n};return Q.runKernel(wm,t,s)}const ec=J({einsum_:UA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GA(n){const t={x:W(n,"x","elu","float32")};return Q.runKernel(Kc,t)}const Dh=J({elu_:GA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HA(n){let e=W(n,"x","erf");R(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ze(e,"float32"));const t={x:e};return Q.runKernel(Xc,t)}const uv=J({erf_:HA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eg(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function dv(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[i++]);return r}function Zn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function zn(n,e){const t=e.map(s=>1);return dv(n,t,e)}function is(n,e,t){R(eg(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function An(n,e){if(eg(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function Jo(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function _n(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qA(n,e=null,t=!1){const r={x:W(n,"x","max")},o={reductionIndices:e,keepDims:t};return Q.runKernel(Zd,r,o)}const Er=J({max_:qA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KA(n,e=null,t=!1){const r={x:W(n,"x","min")},o={axis:e,keepDims:t};return Q.runKernel(sh,r,o)}const Fu=J({min_:KA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XA(n,e){let t=W(n,"base","pow"),s=W(e,"exp","pow");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(dl,r)}const ji=J({pow_:XA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function en(n,e){if((hr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&hr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Th(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QA(n){const t={x:W(n,"x","sqrt","float32")};return Q.runKernel(Cl,t)}const hs=J({sqrt_:QA});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YA(n){const e=W(n,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}const bn=J({square_:YA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(n,e=null,t=!1){let s=W(n,"x","sum");s.dtype==="bool"&&(s=Ze(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Q.runKernel(bh,r,o)}const bt=J({sum_:JA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZA(n,e="euclidean",t=null,s=!1){n=W(n,"x","norm");const r=hv(n,e,t);let o=r.shape;if(s){const i=Lt(t,n.shape);o=zn(r.shape,i)}return Y(r,o)}function hv(n,e,t=null){if(n.rank===0)return ys(n);if(n.rank!==1&&t===null)return hv(Y(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return bt(ys(n),t);if(e===1/0)return Er(ys(n),t);if(e===-1/0)return Fu(ys(n),t);if(e==="euclidean"||e===2)return hs(bt(ji(ys(n),en(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Er(bt(ys(n),t[0]),t[1]-1);if(e===1/0)return Er(bt(ys(n),t[1]),t[0]);if(e===-1/0)return Fu(bt(ys(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return hs(bt(bn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const jh=J({norm_:ZA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(n,e=null,t=!1){return jh(n,"euclidean",e,t)}const tR=J({euclideanNorm_:eR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n){const t={x:W(n,"x","exp")};return Q.runKernel(Qc,t)}const ao=J({exp_:nR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR(n,e=0){const t=W(n,"x","expandDims","string_or_numeric");R(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return Q.runKernel(Bd,s,r)}const As=J({expandDims_:sR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(n){const t={x:W(n,"x","expm1")};return Q.runKernel(Yc,t)}const oR=J({expm1_:rR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n,e){const t=W(n,"x","tile","string_or_numeric");R(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return Q.runKernel(Tl,s,r)}const Tr=J({tile_:iR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n,e,t,s="float32"){e==null&&(e=n);const r=Ot([n,e],s),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=Y(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return Tr(As(i,0),[t[0],1,1]);if(t.length===2)return Tr(As(As(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return Tr(As(As(As(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const fv=J({eye_:aR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cR(n){const t={x:W(n,"x","floor","float32")};return Q.runKernel(Jc,t)}const _h=J({floor_:cR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lR(n,e,t=0,s=0){const r=W(n,"x","gather"),o=W(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:t,batchDims:s};return Q.runKernel(Ud,i,a)}const tg=J({gather_:lR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uR(n,e){let t=W(n,"a","greater","string_or_numeric"),s=W(e,"b","greater","string_or_numeric");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Gd,r)}const Zs=J({greater_:uR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dR(n,e){let t=W(n,"a","greaterEqual","string_or_numeric"),s=W(e,"b","greaterEqual","string_or_numeric");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(el,r)}const Vi=J({greaterEqual_:dR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hR(n){const t={input:W(n,"input","imag")};return Q.runKernel(km,t)}const ng=J({imag_:hR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n){const t={x:W(n,"x","isFinite")};return Q.runKernel(nl,t)}const pR=J({isFinite_:fR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR(n){const t={x:W(n,"x","isInf")};return Q.runKernel(sl,t)}const gR=J({isInf_:mR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xR(n){const t={x:W(n,"x","isNaN")};return Q.runKernel(rl,t)}const yR=J({isNaN_:xR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bR(n,e=.2){const s={x:W(n,"x","leakyRelu")},r={alpha:e};return Q.runKernel(Hd,s,r)}const sg=J({leakyRelu_:bR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(n,e){let t=W(n,"a","less","string_or_numeric"),s=W(e,"b","less","string_or_numeric");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(qd,r)}const Ou=J({less_:wR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vR(n,e){let t=W(n,"a","lessEqual","string_or_numeric"),s=W(e,"b","lessEqual","string_or_numeric");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Kd,r)}const za=J({lessEqual_:vR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SR(n,e=5,t=1,s=1,r=.5){const o=W(n,"x","localResponseNormalization");R(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),R(va(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=Y(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={x:i},l={depthRadius:e,bias:t,alpha:s,beta:r},d=Q.runKernel(Jd,c,l);return a?Y(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const CR=J({localResponseNormalization_:SR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NR(n){const t={x:W(n,"x","log","float32")};return Q.runKernel(ol,t)}const co=J({log_:NR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(n){const t={x:W(n,"x","log1p")};return Q.runKernel(il,t)}const pv=J({log1p_:IR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kR(n,e){R(np(n),()=>"The f passed in variableGrads(f) must be a function"),R(e==null||Array.isArray(e)&&e.every(l=>l instanceof Pu),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const l in Q.registeredVariables)e.push(Q.registeredVariables[l])}const s=t?e.filter(l=>!l.trainable):null,r=e.length;e=e.filter(l=>l.trainable),R(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=Q.gradients(n,e,null,o);R(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),R(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const c={};return e.forEach((l,d)=>{a[d]!=null&&(c[l.name]=a[d])}),s!=null&&s.forEach(l=>c[l.name]=null),{value:i,grads:c}}function ka(n){return Q.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(n){const t={x:W(n,"x","neg")};return Q.runKernel(oh,t)}const Dn=J({neg_:$R});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TR(n){const t={x:W(n,"x","softplus")};return Q.runKernel(Sl,t)}const El=J({softplus_:TR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AR(n){const e=W(n,"x","logSigmoid");return ka(s=>({value:Dn(El(Dn(s))),gradFunc:i=>X(i,La(Dn(s)))}))(e)}const RR=J({logSigmoid_:AR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(n,e){let t=W(n,"a","sub"),s=W(e,"b","sub");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(Il,r)}const $t=J({sub_:ER});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(n,e=-1){const t=W(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return ka((r,o)=>{const a=Er(r,e,!0),c=$t(r,a),l=$t(Ze(c,"float32"),co(bt(ao(c),e,!0)));return o([l]),{value:l,gradFunc:(h,f)=>{const[p]=f,m=!0,g=ao(p);return $t(h,X(bt(h,e,m),g))}}})(t)}const mv=J({logSoftmax_:DR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n,e=null,t=!1){const s=W(n,"x","logSumExp"),r=Lt(e,s.shape),o=Er(s,r,!0),i=$t(s,o),a=ao(i),c=bt(a,r),l=co(c),d=Te(Y(o,l.shape),l);if(t){const h=zn(d.shape,r);return Y(d,h)}return d}const gv=J({logSumExp_:jR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(n,e){const t=W(n,"a","logicalAnd","bool"),s=W(e,"b","logicalAnd","bool");Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Xd,r)}const bo=J({logicalAnd_:_R});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PR(n){const t={x:W(n,"x","logicalNot","bool")};return Q.runKernel(Qd,t)}const rg=J({logicalNot_:PR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MR(n,e){const t=W(n,"a","logicalOr","bool"),s=W(e,"b","logicalOr","bool");Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Yd,r)}const xv=J({logicalOr_:MR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FR(n,e){const t=W(n,"a","logicalXor","bool"),s=W(e,"b","logicalXor","bool");return Dt(t.shape,s.shape),bo(xv(n,e),rg(bo(n,e)))}const OR=J({logicalXor_:FR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(n,e,t,s,r){const o=W(n,"x","maxPool"),i=1;let a=o,c=!1;o.rank===3&&(c=!0,a=Y(o,[1,o.shape[0],o.shape[1],o.shape[2]])),R(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),R(fs(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),_s("maxPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},h=Q.runKernel(eh,l,d);return c?Y(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const og=J({maxPool_:LR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=W(n,"x","maxPool3d");let a=i,c=!1;i.rank===4&&(c=!0,a=Y(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),R(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),R(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),_s("maxPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},h=Q.runKernel(th,l,d);return c?Y(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const WR=J({maxPool3d_:zR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n,e){let t=W(n,"a","maximum"),s=W(e,"b","maximum");[t,s]=jn(t,s),t.dtype==="bool"&&(t=Ze(t,"int32"),s=Ze(s,"int32")),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(al,r)}const Zo=J({maximum_:BR});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VR(n,e=null,t=!1){const r={x:W(n,"x","mean")},o={axis:e,keepDims:t};return Q.runKernel(nh,r,o)}const Ln=J({mean_:VR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qn(n,e="float32"){if(No(n),e==="complex64"){const s=Qn(n,"float32"),r=Qn(n,"float32");return $i(s,r)}const t=ds(fe(n),e);return Q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ei(n,e="float32"){if(No(n),e==="complex64"){const s=ei(n,"float32"),r=Qn(n,"float32");return $i(s,r)}const t=em(fe(n),e);return Q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UR(n,e){let t=W(n,"a","minimum"),s=W(e,"b","minimum");[t,s]=jn(t,s),t.dtype==="bool"&&(t=Ze(t,"int32"),s=Ze(s,"int32")),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(cl,r)}const Cc=J({minimum_:UR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,e,t){R(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=W(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");R(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)R(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),R(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return Q.runKernel(rh,i,o)}const HR=J({mirrorPad_:GR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n,e){let t=W(n,"a","mod"),s=W(e,"b","mod");[t,s]=jn(t,s);const r={a:t,b:s};return Q.runKernel(ll,r)}const KR=J({mod_:qR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(n,e=null,t=!1){n=W(n,"x","moments");const s=Lt(e,n.shape),r=Ln(n,s,t);let o=r.shape;t||(o=zn(r.shape,s));const i=bn($t(Ze(n,"float32"),Y(r,o))),a=Ln(i,s,t);return{mean:r,variance:a}}const ig=J({moments_:XR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QR(n,e){let t=W(n,"a","notEqual","string_or_numeric"),s=W(e,"b","notEqual","string_or_numeric");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(ih,r)}const Lu=J({notEqual_:QR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YR(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:W(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return Q.runKernel(ch,i,a)}const yv=J({oneHot_:YR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JR(n){const t={x:W(n,"x","onesLike")};return Q.runKernel(ah,t)}const fr=J({onesLike_:JR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZR(n,e,t=0){const s=W(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return Q.runKernel(uh,o,r)}const ag=J({pad_:ZR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eE(n,e,t){const s=W(n,"x","spaceToBatchND");R(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),R(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),R(s.shape.reduce((i,a,c)=>c>0&&c<=e.length?i&&(a+t[c-1][0]+t[c-1][1])%e[c-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return Q.runKernel(wh,r,o)}const cg=J({spaceToBatchND_:eE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tE(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=W(n,"x","maxPool");let c=a,l=!1;a.rank===3&&(l=!0,c=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(fs(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=pr(c.shape,e,o,r,s),h=[d.dilationHeight,d.dilationWidth];let f;s==="same"?f=sE([d.filterHeight,d.filterWidth],h):f=[[0,0],[0,0]];const p=h[0]===1&&h[1]===1,[m,g]=nE([d.inHeight,d.inWidth],h,f),x=p?s:"valid",y=p?c:cg(c,h,m),w=(t==="avg"?()=>Xm(y,e,o,x,i):()=>og(y,e,o,x,i))(),v=p?w:Qm(w,h,g);return l?Y(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function nE(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,h)=>(d-o[h]%d)%d),a=r.map((d,h)=>d+i[h]),c=e.map((d,h)=>[s[h],a[h]]),l=e.map((d,h)=>[0,i[h]]);return[c,l]}function sE(n,e){const s=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const rE=J({pool_:tE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(n,e){const t=W(n,"x","prelu"),s=W(e,"alpha","prelu"),r={x:t,alpha:s};return Q.runKernel(dh,r)}const lg=J({prelu_:oE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iE(n,e=null,t=!1){let s=W(n,"x","prod");s.dtype==="bool"&&(s=Ze(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Q.runKernel(hh,r,o)}const aE=J({prod_:iE});var ug={exports:{}};ug.exports;(function(n){(function(e,t,s){function r(c){var l=this,d=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=d(" "),l.s1=d(" "),l.s2=d(" "),l.s0-=d(c),l.s0<0&&(l.s0+=1),l.s1-=d(c),l.s1<0&&(l.s1+=1),l.s2-=d(c),l.s2<0&&(l.s2+=1),d=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function i(c,l){var d=new r(c),h=l&&l.state,f=d.next;return f.int32=function(){return d.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,d),f.state=function(){return o(d,{})}),f}function a(){var c=4022871197,l=function(d){d=String(d);for(var h=0;h<d.length;h++){c+=d.charCodeAt(h);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=i:this.alea=i})(zi,n)})(ug);var cE=ug.exports,dg={exports:{}};dg.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor128=i})(zi,n)})(dg);var lE=dg.exports,hg={exports:{}};hg.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,d==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorwow=i})(zi,n)})(hg);var uE=hg.exports,fg={exports:{}};fg.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.x,h=c.i,f,p;return f=d[h],f^=f>>>7,p=f^f<<24,f=d[h+1&7],p^=f^f>>>10,f=d[h+3&7],p^=f^f>>>3,f=d[h+4&7],p^=f^f<<7,f=d[h+7&7],f=f^f<<13,p^=f^f<<9,d[h]=p,c.i=h+1&7,p};function l(d,h){var f,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,f=0;f<h.length;++f)p[f&7]=p[f&7]<<15^h.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],d.x=p,d.i=0,f=256;f>0;--f)d.next()}l(c,a)}function o(a,c){return c.x=a.x.slice(),c.i=a.i,c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.x&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorshift7=i})(zi,n)})(fg);var dE=fg.exports,pg={exports:{}};pg.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.w,h=c.X,f=c.i,p,m;return c.w=d=d+1640531527|0,m=h[f+34&127],p=h[f=f+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,m=h[f]=m^p,c.i=f,m+(d^d>>>16)|0};function l(d,h){var f,p,m,g,x,y=[],b=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,b=Math.max(b,h.length)),m=0,g=-32;g<b;++g)h&&(p^=h.charCodeAt((g+32)%h.length)),g===0&&(x=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,g>=0&&(x=x+1640531527|0,f=y[g&127]^=p+x,m=f==0?m+1:0);for(m>=128&&(y[(h&&h.length||0)&127]=-1),m=127,g=4*128;g>0;--g)p=y[m+34&127],f=y[m=m+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,y[m]=p^f;d.w=x,d.X=y,d.i=m}l(c,a)}function o(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.X&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor4096=i})(zi,n)})(pg);var hE=pg.exports,mg={exports:{}};mg.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.b,f=c.c,p=c.d,m=c.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^f,c.c=f=f-p|0,c.d=p<<16^f>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var d=0;d<l.length+20;d++)c.b^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.tychei=i})(zi,n)})(mg);var fE=mg.exports,bv={exports:{}};const pE={},mE=Object.freeze(Object.defineProperty({__proto__:null,default:pE},Symbol.toStringTag,{value:"Module"})),gE=t$(mE);(function(n){(function(e,t,s){var r=256,o=6,i=52,a="random",c=s.pow(r,o),l=s.pow(2,i),d=l*2,h=r-1,f;function p(v,S,C){var k=[];S=S==!0?{entropy:!0}:S||{};var I=y(x(S.entropy?[v,w(t)]:v??b(),3),k),A=new m(k),T=function(){for(var E=A.g(o),$=c,D=0;E<l;)E=(E+D)*r,$*=r,D=A.g(1);for(;E>=d;)E/=2,$/=2,D>>>=1;return(E+D)/$};return T.int32=function(){return A.g(4)|0},T.quick=function(){return A.g(4)/4294967296},T.double=T,y(w(A.S),t),(S.pass||C||function(E,$,D,M){return M&&(M.S&&g(M,A),E.state=function(){return g(A,{})}),D?(s[a]=E,$):E})(T,I,"global"in S?S.global:this==s,S.state)}function m(v){var S,C=v.length,k=this,I=0,A=k.i=k.j=0,T=k.S=[];for(C||(v=[C++]);I<r;)T[I]=I++;for(I=0;I<r;I++)T[I]=T[A=h&A+v[I%C]+(S=T[I])],T[A]=S;(k.g=function(E){for(var $,D=0,M=k.i,P=k.j,L=k.S;E--;)$=L[M=h&M+1],D=D*r+L[h&(L[M]=L[P=h&P+$])+(L[P]=$)];return k.i=M,k.j=P,D})(r)}function g(v,S){return S.i=v.i,S.j=v.j,S.S=v.S.slice(),S}function x(v,S){var C=[],k=typeof v,I;if(S&&k=="object")for(I in v)try{C.push(x(v[I],S-1))}catch{}return C.length?C:k=="string"?v:v+"\0"}function y(v,S){for(var C=v+"",k,I=0;I<C.length;)S[h&I]=h&(k^=S[h&I]*19)+C.charCodeAt(I++);return w(S)}function b(){try{var v;return f&&(v=f.randomBytes)?v=v(r):(v=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(v)),w(v)}catch{var S=e.navigator,C=S&&S.plugins;return[+new Date,e,C,e.screen,w(t)]}}function w(v){return String.fromCharCode.apply(0,v)}if(y(s.random(),t),n.exports){n.exports=p;try{f=gE}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:zi,[],Math)})(bv);var xE=bv.exports,yE=cE,bE=lE,wE=uE,vE=dE,SE=hE,CE=fE,Ui=xE;Ui.alea=yE;Ui.xor128=bE;Ui.xorwow=wE;Ui.xorshift7=vE;Ui.xor4096=SE;Ui.tychei=CE;var gg=Ui;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wv{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=gg.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class NE{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=gg.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(n,e=0,t=1,s,r){if(No(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new wv(e,t,s,!1,r),i=Ot(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const kE=J({randomNormal_:IE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(n,e=0,t=1,s="float32",r){No(n);const o=Ot(n,s),i=new NE(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Dl=J({randomUniform_:$E});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nc(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return Q.runKernel(jm,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TE(n){const t={input:W(n,"input","real")};return Q.runKernel(_m,t)}const zu=J({real_:TE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(n){const t={x:W(n,"x","reciprocal")};return Q.runKernel(hl,t)}const RE=J({reciprocal_:AE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(n){const t={x:W(n,"x","relu")};return Q.runKernel(fl,t)}const Gi=J({relu_:EE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DE(n){const t={x:W(n,"x","relu6")};return Q.runKernel(pl,t)}const vv=J({relu6_:DE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jE(n,e){const s={x:W(n,"x","reverse")},r={dims:e};return Q.runKernel(gh,s,r)}const _i=J({reverse_:jE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _E(n){const t={x:W(n,"x","round")};return Q.runKernel(ml,t)}const Sv=J({round_:_E});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(n){const t={x:W(n,"x","rsqrt","float32")};return Q.runKernel(gl,t)}const Cv=J({rsqrt_:PE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ME(n){const t={x:W(n,"x","selu")};return Q.runKernel(xl,t)}const Nv=J({selu_:ME});function FE(n,e,t,s,r,o=[1,1],i="NHWC"){const a=W(n,"x","separableConv2d"),c=W(e,"depthwiseFilter","separableConv2d"),l=W(t,"pointwiseFilter","separableConv2d");let d=a,h=!1;if(a.rank===3&&(h=!0,d=Y(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");R(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),R(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),R(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),R(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const f=c.shape[2],p=c.shape[3];R(l.shape[2]===f*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*p}, but got ${l.shape[2]}.`);const m=Zm(d,c,s,r,i,o),x=Di(m,l,1,"valid",i);return h?Y(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Iv=J({separableConv2d_:FE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OE(n){const t={x:W(n,"x","sign")};return Q.runKernel(wl,t)}const LE=J({sign_:OE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(n){const t={x:W(n,"x","sin","float32")};return Q.runKernel(yl,t)}const kv=J({sin_:zE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WE(n){const t={x:W(n,"x","sinh")};return Q.runKernel(bl,t)}const $v=J({sinh_:WE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(n,e,t){const s=W(n,"x","slice1d");return R(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),pn(s,[e],[t])}const xg=J({slice1d_:BE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VE(n,e,t){const s=W(n,"x","slice2d");return R(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),pn(s,e,t)}const Tv=J({slice2d_:VE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UE(n,e,t){const s=W(n,"x","slice3d");return R(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),pn(s,e,t)}const yg=J({slice3d_:UE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GE(n,e,t){const s=W(n,"x","slice4d");return R(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),pn(s,e,t)}const Wu=J({slice4d_:GE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(n,e=-1){const t=W(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return Q.runKernel(Sh,s,r)}const bg=J({softmax_:HE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(n){R(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Q.runKernel(Sm,e)}const Av=J({fft_:qE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KE(n){R(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Q.runKernel(Im,e)}const wp=J({ifft_:KE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=Y(n,[t,e]);s=wp(r)}else{const r=[t,2*(e-1)],o=Y(zu(n),[t,e]),i=Y(ng(n),[t,e]),a=_i(pn(o,[0,1],[t,e-2]),1),c=X(_i(pn(i,[0,1],[t,e-2]),1),en(-1)),l=Es([o,a],1),d=Es([i,c],1),h=Y($i(l,d),[r[0],r[1]]);s=wp(h)}if(s=zu(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=Y(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const QE=J({irfft_:XE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(n,e,t=0){const r={x:W(n,"x","split")},o={numOrSizeSplits:e,axis:t};return Q.runKernel(vh,r,o)}const Ys=J({split_:YE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n,e){R(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const m=n.shape.map(x=>0),g=n.shape.map(x=>x);g[n.shape.length-1]=e,r=pn(n,m,g),t=e}else if(e!=null&&e>t){const m=n.shape.map(g=>g);m[n.shape.length-1]=e-t,r=Es([n,Qn(m)],n.shape.length-1),t=e}else r=n;const o=Kt(r),i=Y($i(r,o),[s,t]),a=Av(i),c=Math.floor(t/2)+1,l=zu(a),d=ng(a),h=Ys(l,[c,t-c],l.shape.length-1),f=Ys(d,[c,t-c],d.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=c,Y($i(h[0],f[0]),p)}const ZE=J({rfft_:JE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eD(n,e){let t=W(n,"a","squaredDifference"),s=W(e,"b","squaredDifference");[t,s]=jn(t,s),Dt(t.shape,s.shape);const r={a:t,b:s},o={};return Q.runKernel(Nl,r,o)}const tD=J({squaredDifference_:eD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nD(n,e){const t=W(n,"x","squeeze","string_or_numeric");return Y(t,Ko(t.shape,e).newShape)}const jl=J({squeeze_:nD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(n,e=0){const t=Xw(n,"tensors","stack","string_or_numeric");R(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&R(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return Q.runKernel(lh,s,r)}const wo=J({stack_:sD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(n,e=0){const s={x:W(n,"x","step")},r={alpha:e};return Q.runKernel(Al,s,r)}const _l=J({step_:rD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(n,e,t,s,r=0,o=0,i=0,a=0,c=0){const d={x:W(n,"x","stridedSlice","string_or_numeric")},h={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};return Q.runKernel(Lm,d,h)}const iD=J({stridedSlice_:oD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aD(n){const t={x:W(n,"x","tan","float32")};return Q.runKernel(kl,t)}const cD=J({tan_:aD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vs(n,e){tw(n);const t=$h(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Th(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ma(n,e,t){if(tw(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=$h(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Th(n,e,s,t)}function Rv(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function lD(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Rv(t,e,n)}function Hi(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let h=r;h<o;++h)i*=t[h];const a=r<1?1:r,c=fe(e.shape)/a,l=[...xt(t.slice(0,r)),1],d=fe(t);return{sliceRank:r,numUpdates:c,sliceSize:i,strides:l,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(n,e=1,t=!0){const s=W(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[a,c]=Q.runKernel(zm,o,i);return{values:a,indices:c}}const dD=J({topk_:uD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hD(n,e=0,t=1,s,r){if(No(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new wv(e,t,s,!0,r),i=Ot(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Ev=J({truncatedNormal_:hD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(n,e=0){const t=W(n,"x","unique","string_or_numeric");R(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=Q.runKernel(Bm,s,r);return{values:o,indices:i}}const pD=J({unique_:fD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(n,e,t){const s=W(n,"x","unsortedSegmentSum"),r=W(e,"segmentIds","unsortedSegmentSum","int32");R(va(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return Q.runKernel(Nh,o,i)}const Dv=J({unsortedSegmentSum_:mD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gD(n,e=0){const t=W(n,"x","unstack","string_or_numeric");R(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return Q.runKernel(Ch,s,r)}const Pi=J({unstack_:gD});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xD(n,e=!0,t,s){return Q.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jv(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=Ot(n,"int32"),r=Ot([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n,e,t){const s=W(n,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),R(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{R(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?ie(()=>{let i=zu(s),a=ng(s);return i=Q.runKernel(ha,{x:i},o),a=Q.runKernel(ha,{x:a},o),t&&(a=Dn(a)),$i(i,a)}):Q.runKernel(ha,r,o)}const qt=J({transpose_:yD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n,e){if(e==null)return n.shape.slice();if(tn(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wD(n,e,t,s){const r=W(n,"x","dropout");if(R(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),R(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Wn?r.clone():r;const o=bD(r,t),i=1-e,a=wt(_h(Te(Dl(o,0,1,"float32",s),i)),i);return X(r,a)}const vD=J({dropout_:wD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(n,e,t,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=Y(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=Y(e,[1,e.shape[0],e.shape[1],e.shape[2]])),R(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),R(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),R(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const l=o==="NHWC"?a.shape[3]:a.shape[1],d=o==="NHWC"?c.shape[3]:c.shape[1];R(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),R(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),_s("conv2dDerFilter",r,i);const h={x:a,dy:c},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return Q.runKernel(dm,h,f)}const wg=J({conv2DBackpropFilter_:SD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vg(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return X(n,_l(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function Sg(n,e){let t=e;const s=Hn(n.shape,e.shape);return s.length>0&&(t=bt(t,s)),Y(t,n.shape)}function Cg(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Gi(n);if(e==="elu")return Dh(n);if(e==="relu6")return vv(n);if(e==="prelu")return lg(n,t);if(e==="leakyrelu")return sg(n,s);if(e==="sigmoid")return La(n);throw new Error(`Unknown fused activation ${e}.`)}const Ng=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CD({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:d}){if(c=c||"linear",Ng(Q.state.gradientDepth,c)===!1){R(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Di(n,e,t,s,r,o,i);return a!=null&&(C=Te(C,a)),Cg(C,c,l,d)}const h=W(n,"x","conv2d","float32"),f=W(e,"filter","conv2d","float32");let p=h,m=!1;h.rank===3&&(m=!0,p=Y(h,[1,h.shape[0],h.shape[1],h.shape[2]])),R(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),R(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),_s("fused conv2d",s,i);const g=r==="NHWC"?p.shape[3]:p.shape[1];R(f.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${f.shape[2]}.`),R(fs(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const x=os(p.shape,f.shape,t,o,s,i);let y;a!=null&&(y=W(a,"bias","fused conv2d"),[y]=jn(y,h),r==="NHWC"?Dt(x.outShape,y.shape):(R(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),R(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let b;if(l!=null){const C=l.shape;if(R(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)R(C[0]===1||C[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${x.outChannels}).`);else if(C.length===3)try{Dt(C,x.outShape)}catch{const I=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(I)}b=W(l,"prelu weights","fused conv2d")}const w=(C,k)=>{R(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[I,A,T,E]=k,$=vg(C,T,c);R(Ri(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const D=Ym(A.shape,$,I,t,s),M=wg(A,$,I.shape,t,s),P=[D,M];if(E!=null){const L=Sg(E,$);P.push(L)}return P},v={x:p,filter:f,bias:y,preluActivationWeights:b},S={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:c,leakyreluAlpha:d};return a==null?ka((k,I,A)=>{let T=Q.runKernel(Du,v,S);return A([I,k,T]),m&&(T=Y(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:w}})(p,f):ka((k,I,A,T)=>{let E=Q.runKernel(Du,v,S);return T([I,k,E,A]),m&&(E=Y(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:w}})(p,f,y)}const ND=J({fusedConv2d_:CD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ID(n,e,t,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=Y(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=Y(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:a,dy:c},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return Q.runKernel(ym,l,d)}const kD=J({depthwiseConv2dNativeBackpropFilter_:ID});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $D(n,e,t,s,r,o=[1,1],i){let a=e,c=!1;e.rank===3&&(c=!0,a=Y(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},h=Q.runKernel(bm,l,d);return c?Y(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const TD=J({depthwiseConv2dNativeBackpropInput_:$D});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AD({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Ng(Q.state.gradientDepth,o)===!1){let E=Zt(n,e,t,s);return r!=null&&(E=Te(E,r)),Cg(E,o,i,a)}let c=W(n,"a","fused matMul"),l=W(e,"b","fused matMul");[c,l]=jn(c,l);const d=t?c.shape[c.rank-2]:c.shape[c.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],f=t?c.shape[c.rank-1]:c.shape[c.rank-2],p=s?l.shape[l.rank-2]:l.shape[l.rank-1],m=c.shape.slice(0,-2),g=l.shape.slice(0,-2),x=fe(m),y=fe(g);R(d===h,()=>`Error in fused matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${t} and transposeB=${s} must match.`);const w=Dt(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([f,p]),v=t?Y(c,[x,d,f]):Y(c,[x,f,d]),S=s?Y(l,[y,p,h]):Y(l,[y,h,p]);let C;r!=null&&(C=W(r,"bias","fused matMul"),[C]=jn(C,c),Dt(w,C.shape));let k;i!=null&&(k=W(i,"prelu weights","fused matMul"));const I=(E,$)=>{const[D,M,P,L]=$,O=vg(Y(E,P.shape),P,o);let F,V;if(!t&&!s?(F=Zt(O,M,!1,!0),V=Zt(D,O,!0,!1)):!t&&s?(F=Zt(O,M,!1,!1),V=Zt(O,D,!0,!1)):t&&!s?(F=Zt(M,O,!1,!0),V=Zt(D,O,!1,!1)):(F=Zt(M,O,!0,!0),V=Zt(O,D,!0,!0)),r!=null){const G=Sg(L,O);return[F,V,G]}else return[F,V]},A={a:v,b:S,bias:C,preluActivationWeights:k},T={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?ka(($,D,M)=>{const P=Q.runKernel(Eu,A,T);return M([$,D,P]),{value:Y(P,w),gradFunc:I}})(v,S):ka(($,D,M,P)=>{const L=Q.runKernel(Eu,A,T);return P([$,D,L,M]),{value:Y(L,w),gradFunc:I}})(v,S,C)}const Hx=J({fusedMatMul_:AD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,e,t,s,r="bilinear",o=0){const i=W(n,"image","cropAndResize"),a=W(e,"boxes","cropAndResize","float32"),c=W(t,"boxInd","cropAndResize","int32"),l=a.shape[0];R(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),R(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),R(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),R(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),R(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),R(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:a,boxInd:c},h={method:r,extrapolationValue:o,cropSize:s};return Q.runKernel(mm,d,h)}const ED=J({cropAndResize_:RD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DD(n){const e=W(n,"image","flipLeftRight","float32");R(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Q.runKernel(Nm,t,{})}const jD=J({flipLeftRight_:DD});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(n){const e=W(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];R(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),R(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Tr(e,r)}const PD=J({grayscaleToRGB_:_D});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n){const e=W(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];R(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),R(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=Ze(e,"float32"),i=Vs([.2989,.587,.114]);let a;switch(e.rank){case 2:a=ec("ij,j->i",o,i);break;case 3:a=ec("ijk,k->ij",o,i);break;case 4:a=ec("ijkl,l->ijk",o,i);break;case 5:a=ec("ijklm,m->ijkl",o,i);break;case 6:a=ec("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=As(a,-1),Ze(a,r)}const FD=J({rgbToGrayscale_:MD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OD(n,e,t=0,s=.5){const r=W(n,"image","rotateWithOffset","float32");R(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return Q.runKernel(Vm,o,i)}const LD=J({rotateWithOffset_:OD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wa(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),R(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),R(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),R(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),R(e.rank===1,()=>"scores must be a 1D tensor"),R(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),R(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=W(n,"boxes","nonMaxSuppression","float32"),i=W(e,"scores","nonMaxSuppression","float32"),a=Wa(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return Q.runKernel(Rm,{boxes:o,scores:i},c)}const WD=J({nonMaxSuppression_:zD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BD(n,e,t){const s=VD(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function VD(n,e,t){return GD(n,e,t||UD)}function UD(n,e){return n>e?1:n<e?-1:0}function GD(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=t(e,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ig(n,e,t,s,r){return Tg(n,e,t,s,r,0)}function kg(n,e,t,s,r,o){return Tg(n,e,t,s,r,0,!1,o,!0)}function $g(n,e,t,s,r,o){return Tg(n,e,t,s,r,o,!0)}function Tg(n,e,t,s,r,o,i=!1,a=!1,c=!1){const l=[];for(let x=0;x<e.length;x++)e[x]>r&&l.push({score:e[x],boxIndex:x,suppressBeginIndex:0});l.sort(qx);const d=o>0?-.5/o:0,h=[],f=[];for(;h.length<t&&l.length>0;){const x=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:w}=x;if(y<r)break;let v=!1;for(let S=h.length-1;S>=w;--S){const C=HD(n,b,h[S]);if(C>=s){v=!0;break}if(x.score=x.score*qD(s,d,C),x.score<=r)break}x.suppressBeginIndex=h.length,v||(x.score===y?(h.push(b),f.push(x.score)):x.score>r&&BD(l,x,qx))}const p=h.length,m=t-p;a&&m>0&&(h.push(...new Array(m).fill(0)),f.push(...new Array(m).fill(0)));const g={selectedIndices:h};return i&&(g.selectedScores=f),c&&(g.validOutputs=p),g}function HD(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),l=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),p=(a-o)*(c-i),m=(h-l)*(f-d);if(p<=0||m<=0)return 0;const g=Math.max(o,l),x=Math.max(i,d),y=Math.min(a,h),b=Math.min(c,f),w=Math.max(y-g,0)*Math.max(b-x,0);return w/(p+m-w)}function qD(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function qx(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function KD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=W(n,"boxes","nonMaxSuppressionAsync"),i=W(e,"scores","nonMaxSuppressionAsync"),a=Wa(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c=await Promise.all([o.data(),i.data()]),l=c[0],d=c[1],{selectedIndices:h}=Ig(l,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),Vs(h,"int32")}const XD=KD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),c=Wa(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l={boxes:i,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},h=Q.runKernel(Dm,l,d);return{selectedIndices:h[0],selectedScores:h[1]}}const YD=J({nonMaxSuppressionWithScore_:QD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function JD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),c=Wa(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l=await Promise.all([i.data(),a.data()]),d=l[0],h=l[1],{selectedIndices:f,selectedScores:p}=$g(d,h,t,s,r,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Vs(f,"int32"),selectedScores:Vs(p)}}const ZD=JD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),c=Wa(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,f={boxes:i,scores:a},p={maxOutputSize:l,iouThreshold:d,scoreThreshold:h,padToMaxOutputSize:o},m=Q.runKernel(Em,f,p);return{selectedIndices:m[0],validOutputs:m[1]}}const tj=J({nonMaxSuppressionPadded_:ej});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nj(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),c=Wa(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,[f,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:m,validOutputs:g}=kg(f,p,l,d,h,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Vs(m,"int32"),validOutputs:en(g,"int32")}}const sj=nj;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(n,e,t=!1,s=!1){const r=W(n,"images","resizeBilinear");R(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),R(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),R(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=Y(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=Q.runKernel(mh,a,c);return i?Y(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const _v=J({resizeBilinear_:rj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oj(n,e,t=!1,s=!1){const r=W(n,"images","resizeNearestNeighbor");R(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),R(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),R(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),R(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=Y(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=Q.runKernel(ph,a,c);return i?Y(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Pv=J({resizeNearestNeighbor_:oj});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ij(n,e="binary",t=!1,s=.5){const r=W(n,"image","threshold"),o=.2989,i=.587,a=.114,c=r.shape[0]*r.shape[1];let l=X(Vs([s]),255),d,h,f,p;if(R(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),R(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),R(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),R(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,h,f]=Ys(r,[1,1,1],-1);const x=X(d,o),y=X(h,i),b=X(f,a);p=Te(Te(x,y),b)}else p=n;if(e==="otsu"){const x=oA(Ze(Sv(p),"int32"),fa([]),256);l=aj(x,c)}const m=t?za(p,l):Zs(p,l);return Ze(X(m,255),"int32")}function aj(n,e){let t=Vs([-1]),s=Vs([0]),r=Vs([0]),o,i,a,c,l,d;for(let h=0;h<n.size-1;h++){o=pn(n,0,h+1),i=pn(n,h+1),l=wt(bt(o),e),d=wt(bt(i),e);const f=bt(X(o,Nc(0,o.size)));a=wt(f,bt(o));const p=Eh(i.shape,o.size),m=Te(Nc(0,i.size),p),g=X(i,m);c=wt(bt(g),bt(i));const x=$t(a,c),y=$t(a,c),b=X(l,d);r=X(X(b,x),y);const w=Zs(r,s);s=Ss(w,r,s),t=Ss(w,Vs([h]),t)}return t}const cj=J({threshold_:ij});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lj(n,e,t="nearest",s="constant",r=0,o){const i=W(n,"image","transform","float32"),a=W(e,"transforms","transform","float32");R(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),R(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),R(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const c={image:i,transforms:a},l={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return Q.runKernel(Wm,c,l)}const uj=J({transform_:lj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dj(n,e,t){const s=W(n,"a","bandPart");R(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,c;typeof e=="number"?(R(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),R(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=W(e<0?o:e,"numLower","bandPart")):(R(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Ss(Ou(e,0),o,Cc(e,o))),typeof t=="number"?(R(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),R(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),c=W(t<0?i:t,"numUpper","bandPart")):(R(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=Ss(Ou(t,0),i,Cc(t,i)));const l=Y(Nc(0,o,1,"int32"),[-1,1]),d=Nc(0,i,1,"int32"),h=$t(l,d),f=bo(za(h,a),Vi(h,Dn(c))),p=Qn([o,i],s.dtype);return Y(wo(Pi(Y(s,[-1,o,i])).map(m=>Ss(f,m,p))),r)}const hj=J({bandPart_:dj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fj(n){let e;if(Array.isArray(n)){e=!1,R(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)R(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Ys(n,n.shape[0],0).map(r=>jl(r,[0]));R(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(Q.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=X(bt(X(t[i],o)),t[i]);o=$t(o,a)}return wt(o,jh(o,"euclidean"))}));return e?wo(t,0):t}const pj=J({gramSchmidt_:fj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(n,e=!1){if(R(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return Kx(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((c,l)=>c*l),s=Pi(Y(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(c=>{const[l,d]=Kx(c,e);r.push(l),o.push(d)});const i=Y(wo(r,0),n.shape),a=Y(wo(o,0),n.shape);return[i,a]}}function Kx(n,e=!1){return Q.tidy(()=>{R(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=fv(t),o=vi(n);const i=ma([[1]],[1,1]);let a=vi(i);const c=t>=s?s:t;for(let l=0;l<c;++l){const d=o,h=a,f=r;[a,o,r]=Q.tidy(()=>{const p=pn(o,[l,l],[t-l,1]),m=jh(p),g=pn(o,[l,l],[1,1]),x=Ss(Zs(g,0),ma([[-1]]),ma([[1]])),y=$t(g,X(x,m)),b=wt(p,y);b.shape[0]===1?a=vi(i):a=Es([i,pn(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const w=Dn(wt(Zt(x,y),m)),v=pn(o,[l,0],[t-l,s]),S=X(w,a),C=qt(a);if(l===0)o=$t(v,Zt(S,Zt(C,v)));else{const A=$t(v,Zt(S,Zt(C,v)));o=Es([pn(o,[0,0],[l,s]),A],0)}const k=qt(S),I=pn(r,[0,l],[t,r.shape[1]-l]);if(l===0)r=$t(I,Zt(Zt(I,a),k));else{const A=$t(I,Zt(Zt(I,a),k));r=Es([pn(r,[0,0],[t,l]),A],1)}return[a,o,r]}),Pt([d,h,f])}return!e&&t>s&&(r=pn(r,[0,0],[t,s]),o=pn(o,[0,0],[s,s])),[r,o]})}const gj=J({qr_:mj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yo={flipLeftRight:jD,grayscaleToRGB:PD,resizeNearestNeighbor:Pv,resizeBilinear:_v,rgbToGrayscale:FD,rotateWithOffset:LD,cropAndResize:ED,nonMaxSuppression:WD,nonMaxSuppressionAsync:XD,nonMaxSuppressionWithScore:YD,nonMaxSuppressionWithScoreAsync:ZD,nonMaxSuppressionPadded:tj,nonMaxSuppressionPaddedAsync:sj,threshold:cj,transform:uj},xj={bandPart:hj,gramSchmidt:pj,qr:gj};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yj=new Map,bj=new Map;class Ba{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class ir{constructor(){this.classNameMap={}}static getMap(){return ir.instance==null&&(ir.instance=new ir),ir.instance}static register(e){ir.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ie(n,e,t){R(n.className!=null,()=>"Class being registered does not have the static className property defined."),R(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),R(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return ir.register(n),yj.set(r,n),bj.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ti extends Ba{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Pt(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return kR(e,t)}dispose(){this.iterations_!=null&&Pt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:en(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(ti,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mv extends ti{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ie(()=>Kt(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ie(()=>Kt(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;ie(()=>{const d=Te(X(c,this.rho),X(bn(a),1-this.rho)),h=X(wt(hs(Te(l,this.epsilon)),hs(Te(c,this.epsilon))),a),f=Te(X(l,this.rho),X(bn(h),1-this.rho));c.assign(d),l.assign(f);const p=Te(X(h,-this.learningRate),o);o.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Pt(this.accumulatedGrads.map(e=>e.variable)),Pt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fv extends ti{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ie(()=>Eh(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;ie(()=>{const c=Te(a,bn(i));a.assign(c);const l=Te(X(wt(i,hs(Te(c,Q.backend.epsilon()))),-this.learningRate),o);o.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Pt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ov extends ti{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ie(()=>{this.accBeta1=en(t).variable(),this.accBeta2=en(s).variable()}),r==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ie(()=>{const s=$t(1,this.accBeta1),r=$t(1,this.accBeta2);t.forEach((o,i)=>{const a=Q.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ie(()=>Kt(a).variable(c))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:ie(()=>Kt(a).variable(c))});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,f=Te(X(d,this.beta1),X(l,1-this.beta1)),p=Te(X(h,this.beta2),X(bn(l),1-this.beta2)),m=wt(f,s),g=wt(p,r);d.assign(f),h.assign(p);const x=Te(X(wt(m,Te(hs(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(X(this.accBeta1,this.beta1)),this.accBeta2.assign(X(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Pt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Pt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ie(()=>{this.accBeta1.assign(ji(this.beta1,this.iterations_+1)),this.accBeta2.assign(ji(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lv extends ti{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ie(()=>{this.iteration=en(0).variable(),this.accBeta1=en(t).variable()}),r==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ie(()=>{const s=$t(1,this.accBeta1),r=wt(-this.learningRate,Te(X(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=Q.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Kt(a).variable(c)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Kt(a).variable(c)});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,f=Te(X(d,this.beta1),X(l,1-this.beta1)),p=X(h,this.beta2),m=ys(l),g=Zo(p,m);d.assign(f),h.assign(g);const x=Te(X(wt(r,s),wt(f,Te(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(Te(this.iteration,1)),this.accBeta1.assign(X(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Pt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Pt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ag extends ti{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=Q.registeredVariables[s];ie(()=>{const a=Te(X(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=eo(en(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zv extends Ag{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=en(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ie(()=>Kt(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ie(()=>{let c;const l=Te(X(this.m,i),a);this.useNesterov?c=Te(X(this.c,Te(a,X(l,this.m))),o):c=Te(X(this.c,l),o),i.assign(l),o.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Pt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wv extends ti{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=Q.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ie(()=>Kt(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ie(()=>Kt(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ie(()=>Kt(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;ie(()=>{const d=Te(X(c,this.decay),X(bn(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,f=Te(X(h,this.decay),X(a,1-this.decay)),p=wt(X(a,this.learningRate),hs($t(d,Te(bn(f),this.epsilon)))),m=Te(X(l,this.momentum),p);c.assign(d),h.assign(f),l.assign(m);const g=$t(o,m);o.assign(g)}else{const h=Te(X(c,this.decay),X(bn(a),1-this.decay)),f=Te(X(l,this.momentum),wt(X(a,this.learningRate),hs(Te(h,this.epsilon))));c.assign(h),l.assign(f);const p=$t(o,f);o.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Pt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Pt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Pt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wj=[Mv,Fv,Ov,Lv,zv,Wv,Ag];function vj(){for(const n of wj)Ie(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xx(n,e,t,s){i(n),t=t??0,s=s??1,a(t,s);let r=0;const o=c=>(c.then(l=>{const d=t+ ++r/n.length*(s-t);return e(d),l}),c);function i(c){R(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function a(c,l){R(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),R(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),R(l>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${l}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Sj(n,e){e==null&&(e={});const t=e.fetchFunc==null?ce().platform.fetch:e.fetchFunc,s=n.map(h=>t(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await Xx(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await Xx(a,e.onProgress,.5,1)}function Cj(n,e){var t;const s=e.fetchFunc==null?ce().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:c,value:l}=await o.read();if(c){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}i.enqueue(l);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nj="application/octet-stream",Ij="application/json";class Rg{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(R(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ce().platform.fetch,R(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&R(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=L2(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:Ij}),"model.json"),e.weightData!=null){const i=Qo.join(e.weightData);t.body.append("model.weights.bin",new Blob([i],{type:Nj}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:qm(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return W2(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=Vx(e.weightsManifest),r=()=>Cj(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=kj(t),o=this.weightPathPrefix||s,i=[],a=[];for(const c of e)for(const l of c.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(l)):i.push(o+l+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const t=await this.getWeightUrls(e),s=Vx(e),r=await Sj(t,this.loadOptions);return[s,r]}}Rg.URL_SCHEME_REGEX=/^https?:\/\//;function kj(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function Qx(n){return n.match(Rg.URL_SCHEME_REGEX)!=null}const Bv=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>Qx(s)):t=Qx(n),t)return Vv(n,e)}return null};Kn.registerSaveRouter(Bv);Kn.registerLoadRouter(Bv);function Vv(n,e){return new Rg(n,e)}function $j(n,e){return Vv(n,e)}function Eg(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(fe(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let h=0;h<r.length-1;++h)i*=r[h];const a=n.shape,c=r.slice();c.pop();let l=1;for(let h=o;h<t;++h)l*=a[h],c.push(a[h]);const d=[...xt(n.shape).map(h=>h/l),1].slice(0,o);return[c,i,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vp=-2,Tj=-1;function Dg(n,e,t){const s=n.shape.length;R(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),R(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)R(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function Aj(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function jg(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function Uv(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Gv(n,e,t){return t<=n?t:t-(e-1)}function Hv(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function Rj(n,e,t,s,r,o,i,a,c){const l=n.length;let d=new Array(l),h=new Array(l),f=new Array(l);if(e.length&&t>0){const p=e[0],m=t+1;d=qv(i,p,m,s,n),h=Kv(a,p,m,r,n),f=Uv(o,p,m,n)}else for(let p=0;p<l;p++)d[p]=Qv(i,s,o,n,p,c),h[p]=Yv(a,r,o,n,p,c),f[p]=Xv(o,p,c);return{begin:d,end:h,strides:f}}function qv(n,e,t,s,r){const o=[...r],i=Hv(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const c=Gv(e,t,a);let l=s[c];n&1<<c&&(l=0),o[a]=l}return o}function Kv(n,e,t,s,r){const o=[...r],i=Hv(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const c=Gv(e,t,a);let l=s[c];n&1<<c&&(l=Number.MAX_SAFE_INTEGER),o[a]=l}for(let a=0;a<o.length;a++){const c=r[a];o[a]<0&&(o[a]+=c),o[a]=Ii(0,o[a],r[a])}return o}function Xv(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function Qv(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),i=Ii(0,i,c-1),i}function Yv(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),a>0?i=Ii(0,i,c):i=Ii(-1,i,c-1),i}function _g(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Pg(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function Ph(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{R(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(R(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function Mg(n,e,t,s,r,o,i,a,c){let l;if(s==null?(l=new Array(e.length),l.fill(1)):l=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};for(let w=0;w<h.dims;w++)d&&1<<w&a&&h.numAddAxisAfterEllipsis++,1<<w&i&&(d=!0);d||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Ej(h,f);let p=!0,m=!0,g=!0;const x=[],y=[];for(let w=0;w<n.length;++w){if(f.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);const v=!!(f.shrinkAxisMask&1<<w),S=n[w];if(S===-1){x.push(v?1:-1);continue}const C=[f.beginMask&1<<w,f.endMask&1<<w],k=[f.strides[w]>0?0:-1,f.strides[w]>0?S:S-1];if(v&&f.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&f.strides[w]===1;const I=!!(f.beginMask&1<<w&&f.endMask&1<<w);if(f.beginValid&&f.endValid){if(v){const $=f.begin[w]<0?S+f.begin[w]:f.begin[w];if(f.begin[w]=$,f.end[w]=f.begin[w]+1,$<0||$>=S)throw Error(`slice index ${f.begin[w]} of dimension ${w} out of bounds.`)}else f.begin[w]=Yx(f.begin[w],0,f.strides[w],S,C,k),f.end[w]=Yx(f.end[w],1,f.strides[w],S,C,k);const E=f.strides[w]===1&&f.begin[w]===0&&f.end[w]===S;p=p&&E,m=m&&(w===0&&f.strides[w]===1||E)}else p=p&&f.strides[w]===1&&I,m=m&&(w===0&&f.strides[w]===1||I);let A,T=!1;if(f.beginValid&&f.endValid?(A=f.end[w]-f.begin[w],T=!0):v?(A=1,T=!0):I&&S>=0&&(f.strides[w]<0?A=-S:A=S,T=!0),T){let E;A===0||A<0!=f.strides[w]<0?E=0:E=Math.trunc(A/f.strides[w])+(A%f.strides[w]!==0?1:0),x.push(E)}else x.push(-1)}for(let w=0;w<f.finalShapeGatherIndices.length;++w){const v=f.finalShapeGatherIndices[w];v>=0?y.push(x[v]):v===vp&&y.push(1)}return{finalShapeSparse:y.filter((w,v)=>f.finalShapeGatherIndices[v]!==vp),finalShape:y,isIdentity:p,sliceDim0:m,isSimpleSlice:g,begin:f.begin,end:f.end,strides:f.strides}}function Ej(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(vp),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(Tj),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function Yx(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const Dj=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Dg,computeFlatOffset:Pg,computeOutShape:jg,getNormalizedAxes:Rj,isSliceContinous:_g,maskToAxes:Aj,parseSliceParams:Ph,sliceInfo:Mg,startForAxis:Qv,startIndicesWithElidedDims:qv,stopForAxis:Yv,stopIndicesWithElidedDims:Kv,stridesForAxis:Xv,stridesWithElidedDims:Uv},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jj{static sgd(e){return new Ag(e)}static momentum(e,t,s=!1){return new zv(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new Wv(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new Ov(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new Mv(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new Lv(e,t,s,r,o)}static adagrad(e,t=.1){return new Fv(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const di=jj;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _j=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Jv(){return new Promise(n=>_j(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fg(n,e){const t=n[0].length;n.forEach((r,o)=>{R(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),R(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)R(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function to(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ir;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ir||(Ir={}));function Zv(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function e1(n){const e={FIRST_DIM_SIZE:Ir.FIRST_DIM_SIZE,VALUE_ROWIDS:Ir.VALUE_ROWIDS,ROW_LENGTHS:Ir.ROW_LENGTHS,ROW_SPLITS:Ir.ROW_SPLITS,ROW_LIMITS:Ir.ROW_LIMITS,ROW_STARTS:Ir.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function t1(n){return n.length===0?0:n[0]===Ir.FIRST_DIM_SIZE?n.length-1:n.length}function n1(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Og=30;function Mh(n){return n<=Og?n:sp(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lg(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pl(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function Ml(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function Fl(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function zg(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function Wg(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fh=1.7580993408473768,Oh=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bg=.3275911,Vg=.254829592,Ug=-.284496736,Gg=1.421413741,Hg=-1.453152027,qg=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vo(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function s1(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function r1(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function o1(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function Kg(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function i1(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function a1(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function c1(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sf="->",Pj=/->/g,Jx=",",Zx="...";function Xg(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Pj,"").length)/Sf.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Sf}").`);const[s,r]=n.split(Sf);R(s.indexOf(Zx)===-1,()=>`The ellipsis notation ("${Zx}") is not supported yet.`);const o=s.split(Jx),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<r.length;++f){const p=r[f];if(!o.some(m=>m.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let f=0;f<s.length;++f){const p=s[f];a.indexOf(p)===-1&&p!==Jx&&a.push(p)}const c=new Array(o.length);for(let f=0;f<i;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);c[f]=[];for(let p=0;p<o[f].length;++p)c[f].push(a.indexOf(o[f][p]))}const l=a.length,d=r.length,h=[];for(let f=d;f<l;++f)h.push(f);return{allDims:a,summedDims:h,idDims:c}}function Qg(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function Yg(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:R(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function Jg(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],c=Mj(e,a);for(const l of c)o.indexOf(l)===-1&&(s[i].push(l),o.push(l))}return{path:t,steps:s}}function Zg(n){return n.every((e,t)=>e===t)}function Mj(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function e0(n,e,t=0){let s=[];if(typeof e=="number")R(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);R(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,c)=>c>0?a+c:a);e[o]=n.shape[t]-i}R(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l1(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function u1(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function d1(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h1(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function f1(n,e){return`size ${n} must be non-negative, not ${e}`}function p1(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function m1(n,e){const t=fe(n),s=fe(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function g1(n,e){const t=fe(n),s=fe(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sp(){return"segment ids must be >= 0"}function x1(){return"segment ids are not increasing"}function y1(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function b1(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1(n,e){let t=!1,s;for(n<=Og?(s=n,t=!0):s=sp(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=sp(n,s+1);return s}function v1(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function t0(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let h=0;h<s;++h)if(n.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const i=n.shape[t],a=[];let c=1,l=1,d=1;for(let h=0;h<s;++h)a.push(n.shape[h]),c*=n.shape[h];for(let h=s;h<t;h++)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=t+1;h<o;h++)a.push(n.shape[h]),d*=n.shape[h];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:i,outputShape:a}}const Fj=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:t0,computeOutShape:v1,segOpComputeOptimalWindowSize:w1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function So(n){try{return n.map(e=>Bo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function S1(n){return n.map(e=>Fo(e))}const Oj=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Vg,ERF_A2:Ug,ERF_A3:Gg,ERF_A4:Hg,ERF_A5:qg,ERF_P:Bg,PARALLELIZE_THRESHOLD:Og,get RowPartitionType(){return Ir},SELU_SCALE:Oh,SELU_SCALEALPHA:Fh,applyActivation:Cg,assertAndGetBroadcastShape:Dt,assertAxesAreInnerMostDims:is,assertParamsConsistent:Fg,assignToTypedArray:i1,axesAreInnerMostDims:eg,calculateShapes:Hi,checkEinsumDimSizes:Yg,checkPadOnDimRoundingMode:_s,combineLocations:dv,combineRaggedTensorToTensorShapes:Zv,complexWithEvenIndex:r1,complexWithOddIndex:o1,computeConv2DInfo:os,computeConv3DInfo:Yo,computeDefaultPad:Km,computeDilation2DInfo:Rl,computeOptimalWindowSize:Mh,computeOutAndReduceShapes:Zn,computeOutShape:to,computePool2DInfo:pr,computePool3DInfo:Io,convertConv2DDataFormat:ko,decodeEinsumEquation:Xg,eitherStridesOrDilationsAreOne:fs,expandShapeToKeepDim:zn,exponent:c1,exponents:a1,fromStringArrayToUint8:S1,fromUint8ToStringArray:So,getAxesPermutation:An,getBroadcastDims:Ia,getComplexWithIndex:Kg,getEinsumComputePath:Jg,getEinsumPermutation:Qg,getFusedBiasGradient:Sg,getFusedDyActivation:vg,getImageCenter:Lg,getInnerMostAxes:_n,getPermuted:Ml,getRaggedRank:t1,getReductionAxes:Hn,getReshaped:Pl,getReshapedPermuted:Fl,getRowPartitionTypesHelper:e1,getSliceBeginCoords:zg,getSliceSize:Wg,getSparseFillEmptyRowsIndicesDenseShapeMismatch:l1,getSparseFillEmptyRowsNegativeIndexErrorMessage:u1,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:d1,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:p1,getSparseReshapeInputOutputMismatchErrorMessage:g1,getSparseReshapeInputOutputMultipleErrorMessage:m1,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:h1,getSparseReshapeNegativeOutputDimErrorMessage:f1,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:b1,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Sp,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:x1,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:y1,getUndoAxesPermutation:Jo,isIdentityPermutation:Zg,log:r2,mergeRealAndImagArrays:vo,prepareAndValidate:Eg,prepareSplitSize:e0,segment_util:Fj,shouldFuse:Ng,slice_util:Dj,splitRealAndImagArrays:s1,stridesOrDilationsArePositive:Ei,tupleValuesAreOne:Ri,upcastType:Us,validateDefaultValueShape:n1,validateInput:lD,validateUpdateShape:Rv,warn:Xs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vj();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C1={kernelName:kd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,_l(Ze(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj={kernelName:Pc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=bn(Ze(t,"float32")),r=hs($t(en(1),s));return Dn(wt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zj={kernelName:Mc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=hs($t(bn(Ze(t,"float32")),1));return wt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj={kernelName:Oa,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{let a=n;const c=Hn(t.shape,r);return c.length>0&&(a=bt(a,c)),Y(a,t.shape)},b:()=>{let a=n;const c=Hn(s.shape,r);return c.length>0&&(a=bt(a,c)),Y(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bj={kernelName:sm,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vj={kernelName:$d,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uj={kernelName:Td,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj={kernelName:Fc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,hs($t(en(1),bn(Ze(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hj={kernelName:Oc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=hs(Te(en(1),bn(Ze(t,"float32"))));return wt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qj={kernelName:Wc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const a=Te(bn(t),bn(s));let c=X(n,wt(s,a));const l=Hn(t.shape,r);return l.length>0&&(c=bt(c,l)),Y(c,t.shape)},b:()=>{const a=Te(bn(t),bn(s));let c=Dn(X(n,wt(t,a)));const l=Hn(s.shape,r);return l.length>0&&(c=bt(c,l)),Y(c,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kj={kernelName:Lc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,Te(bn(Ze(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xj={kernelName:zc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,$t(en(1),bn(Ze(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(n,e,t,s,r,o){const i=W(n,"dy","avgPool3dGrad"),a=W(e,"input","avgPool3dGrad");let c=i,l=a,d=!1;a.rank===4&&(d=!0,c=Y(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=Y(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),R(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),R(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),_s("avgPool3dGrad",r,o);const h={dy:c,input:l},f={filterSize:t,strides:s,pad:r,dimRoundingMode:o},p=Q.runKernel(am,h,f);return d?Y(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Yj=J({avgPool3dGrad_:Qj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj={kernelName:Rd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>Yj(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(n,e,t,s,r){const o=W(n,"dy","avgPoolGrad"),i=W(e,"input","avgPoolGrad");R(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,c=o,l=!1;i.rank===3&&(l=!0,a=Y(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=Y(o,[1,o.shape[0],o.shape[1],o.shape[2]])),R(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),R(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:c,input:a},h={filterSize:t,strides:s,pad:r},f=Q.runKernel(im,d,h);return l?Y(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const e_=J({avgPoolGrad_:Zj});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_={kernelName:Ad,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>e_(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n_={kernelName:Ed,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>Zt(n,r,!1,!0),b:()=>Zt(s,n,!0,!1)}:!o&&i?{a:()=>Zt(n,r,!1,!1),b:()=>Zt(n,s,!0,!1)}:o&&!i?{a:()=>Zt(r,n,!1,!0),b:()=>Zt(s,n,!1,!1)}:{a:()=>Zt(r,n,!0,!0),b:()=>Zt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_={kernelName:Dd,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>cg(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_={kernelName:e2,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let c=r.length-1;c>=0;c--)if(r[c]===o[c])i[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let c=0;c<i.length;c++)i[c]>1&&a.push(c);return{x:()=>bt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_={kernelName:Bc,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_={kernelName:Vc,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_={kernelName:Uc,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>Ss(bo(Vi(s,r),za(s,o)),n,Kt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_={kernelName:jd,inputsToSave:["x"],gradFunc:C1.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_={kernelName:_d,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(c=>c.shape),{axis:r}=t,o=Lt(r,e[0].shape)[0],i=s.map(c=>c[o]);return Ys(n,i,o).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:Pd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:c}=t;return R(Ri(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>Ym(s.shape,n,r,i,a,c),filter:()=>wg(s,n,r.shape,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_={kernelName:Md,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:c}=t;return{dy:()=>Di(n,r,o,i,a,1,c),filter:()=>wg(n,s,r.shape,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_(n,e,t,s,r){let o=n;n.rank===4&&(o=Y(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=Y(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),R(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),R(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),R(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),R(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),R(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},c={strides:s,pad:r,filterShape:t};return Q.runKernel(hm,a,c)}const f_=J({conv3DBackpropFilter_:h_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_={kernelName:Fd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;R(Ri(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>av(i.shape,n,a,r,o),filter:()=>f_(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_={kernelName:Gc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(Dn(kv(Ze(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_={kernelName:Hc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X($v(Ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_={kernelName:Od,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const a=An([r],s.rank);let c=lv(n,r,o,!i);return a!=null&&(c=qt(c,a)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_={kernelName:Ld,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,a=s??[1,1];R(Ri(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[c,l]=e;return R(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),R(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),R(fs(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),_s("depthwiseConv2d",o,i),{x:()=>TD(c.shape,n,l,r,o,a,i),filter:()=>kD(c,n,l.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_={kernelName:zd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>Q.runKernel(rp,o,t),filter:()=>Q.runKernel(op,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_={kernelName:Kc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>Q.runKernel(vm,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v_={kernelName:Xc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=X(ao(Dn(bn(t))),2/Math.sqrt(Math.PI));return{x:()=>X(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S_={kernelName:Qc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C_={kernelName:Bd,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>Y(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N_={kernelName:Yc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,ao(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I_={kernelName:Jc,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k_={kernelName:Zc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const a=wt(n,Ze(s,"float32")),c=Hn(t.shape,r);return c.length>0?Y(bt(a,c),t.shape):a},b:()=>{let a=X(n,Ze(t,"float32"));const c=Hn(s.shape,r);c.length>0&&(a=Y(bt(a,c),s.shape));const l=bn(s);return Dn(wt(a,Ze(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $_={kernelName:Vd,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,a]=e,c=a??en(1),l=Hn(o.shape,r.shape),d=[];if(o.rank===1){for(let v=0;v<r.shape.length-1;++v)d.push(r.shape[v]);d.push(1)}const h=$t(r,o),f=X(n,c),p=Cv(Te(i,en(s))),m=X(X(X(p,p),p),en(-.5));return{x:()=>o.rank===1?Y(X(X(n,Tr(Y(p,[1,1,1,o.shape[0]]),d)),c),r.shape):Y(X(X(n,p),c),r.shape),mean:()=>{let v=X(X(p,en(-1)),f);return o.rank===1&&(v=bt(v,l)),Y(v,o.shape)},variance:()=>{let v=X(X(m,h),f);return o.rank===1&&(v=bt(v,l)),Y(v,o.shape)},scale:()=>{const v=X(h,p);let S=X(n,v);return o.rank===1&&(S=bt(S,l)),Y(S,o.shape)},offset:()=>{let v=n;return o.rank===1&&(v=bt(v,l)),Y(v,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_={kernelName:Ud,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:i}=t,a=Lt(o,s.shape)[0],c=(l,d,h)=>()=>{const f=l.shape,p=d.size,m=f.slice(0,a),g=m.length,x=f.slice(o,f.length).slice(1),y=x.length,b=ey(0,g),w=ey(g+1,g+1+y),v=ty([m,[p],x]),S=Y(h,v),C=Y(d,[p]),k=ty([[g],b,w]),I=qt(S,k);let A=Dv(I,C,l.shape[a]);const T=Jo(k);return A=qt(A,T),A};if(i===1){const l=s.shape[0],d=s.split(l,0);return{x:()=>wo(d.map((p,m)=>c(p,r.slice(m,1),n.slice(m,1))())).reshape(s.shape),indices:()=>r}}else return{x:c(s,r,n),indices:()=>r}}};function ey(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function ty(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_={kernelName:el,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Kt(t),b:()=>Kt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_={kernelName:tl,gradFunc:n=>({x:()=>Ze(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_={kernelName:nl,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_={kernelName:sl,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j_={kernelName:rl,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __={kernelName:Hd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=Zs(s,0);return{x:()=>Ss(o,n,X(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_={kernelName:il,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,Te(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_={kernelName:ol,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,Ze(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F_={kernelName:n2,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=ao(s);return $t(n,X(bt(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_(n,e,t,s=5,r=1,o=1,i=.5){const a={x:n,y:e,dy:t},c={depthRadius:s,bias:r,alpha:o,beta:i};return Q.runKernel($m,a,c)}const L_=J({localResponseNormalizationBackprop_:O_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_={kernelName:Jd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:c}=t;return{x:()=>L_(s,r,n,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1(n,e,t,s){return e.rank<t.rank&&(e=Y(e,zn(e.shape,s))),n.rank<t.rank&&(n=Y(n,zn(n.shape,s))),{x:()=>X(n,Ze(io(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ny={kernelName:Zd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],a=Lt(r,o.shape),c=N1(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W_={kernelName:al,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>X(n,Ze(Vi(t,s),"float32")),b:()=>X(n,Ze(Ou(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_(n,e,t,s,r,o,i){const a=W(n,"dy","maxPool3dGrad"),c=W(e,"input","maxPool3dGrad"),l=W(t,"output","maxPool3dGrad");let d=a,h=c,f=l,p=!1;c.rank===4&&(p=!0,d=Y(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=Y(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=Y(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),R(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),R(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),R(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),_s("maxPool3dGrad",o,i);const m={dy:d,input:h,output:f},g={filterSize:s,strides:r,pad:o,dimRoundingMode:i},x=Q.runKernel(Am,m,g);return p?Y(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const V_=J({maxPool3dGrad_:B_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_={kernelName:th,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=t;return{x:()=>V_(n,s,r,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_(n,e,t,s,r,o,i){const a=W(n,"dy","maxPoolGrad"),c=W(e,"input","maxPoolGrad"),l=W(t,"output","maxPoolGrad");R(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),R(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),R(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),_s("maxPoolGrad",o,i);const d={dy:a,input:c,output:l},h={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return Q.runKernel(Tm,d,h)}const H_=J({maxPoolGrad_:G_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_={kernelName:eh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>H_(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=Lt(r,s.shape),a=Zn(s.shape,o)[1],c=fe(a);return{x:()=>{const d=s.shape.slice();o.forEach(p=>{d[p]=1});const h=Y(n,d);return wt(X(h,ei(s.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_={kernelName:sh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,a=Lt(r,o.shape),c=N1(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_={kernelName:cl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>X(n,Ze(za(t,s),"float32")),b:()=>X(n,Ze(Zs(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y_={kernelName:rh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>pn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J_={kernelName:ll,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const a=Hn(t.shape,r);return a.length>0?Y(bt(n,a),t.shape):n},b:()=>{const a=X(n,Dn(_h(wt(t,s)))),c=Hn(s.shape,r);return c.length>0?Y(bt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z_={kernelName:ul,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const a=X(n,Ze(s,"float32")),c=Hn(t.shape,r);return c.length>0?Y(bt(a,c),t.shape):a},b:()=>{const a=X(n,Ze(t,"float32")),c=Hn(s.shape,r);return c.length>0?Y(bt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP={kernelName:oh,gradFunc:n=>({x:()=>Dn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP={kernelName:ch,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Qn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP={kernelName:ah,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={kernelName:lh,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Pi(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sy={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>pn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP={kernelName:dl,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,a=Dt(o.shape,i.shape);return{a:()=>{const d=Ze(i,"float32");let h=X(n,X(d,ji(o,$t(d,en(1)))));const f=Hn(o.shape,a);return f.length>0&&(h=bt(h,f)),Y(h,o.shape)},b:()=>{const d=Zs(o,0),h=Ss(d,co(o),Kt(o));let f=X(n,X(r,h));const p=Hn(i.shape,a);return p.length>0&&(f=bt(f,p)),Y(f,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={kernelName:dh,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Zs(t,0);return{x:()=>Ss(r,n,X(n,s)),alpha:()=>{let o=Ss(r,Kt(n),X(n,t));const i=Hn(s.shape,n.shape);return i.length>0&&(o=bt(o,i)),Y(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iP(n,e,t){const s=n.shape.slice();s[t]=1;const r=Y(e,s),o=bp(n,t,!0,!1),i=bp(n,t,!0,!0),a=X(o,i);return X(r,a)}function aP(n,e,t){const s=n.shape.length,r=s-t.length,o=An(t,s);let i=n;o!=null&&(i=qt(n,o));const a=i.shape.slice(),l=a.splice(s-t.length,t.length).reduce((f,p)=>f*p,1);a.push(l);const d=i.reshape(a);let h=iP(d,e,r);if(h=h.reshape(i.shape),o!=null){const f=Jo(o);h=qt(h,f)}return h}const cP={kernelName:hh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>aP(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP={kernelName:qc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{const a=wt(n,Ze(s,"float32")),c=Hn(t.shape,r);return c.length>0?Y(bt(a,c),t.shape):a},b:()=>{let a=X(n,Ze(t,"float32"));const c=Hn(s.shape,r);c.length>0&&(a=Y(bt(a,c),s.shape));const l=bn(s);return Dn(wt(a,Ze(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uP={kernelName:hl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,Dn(bn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP={kernelName:pl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=X(za(t,6),_l(t));return{x:()=>X(n,Ze(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:fl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,Ze(_l(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP={kernelName:fh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pP={kernelName:mh,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Q.runKernel(Mm,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP={kernelName:ph,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Q.runKernel(Pm,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP={kernelName:gh,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Lt(s,n.shape);return{x:()=>_i(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP={kernelName:ml,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP={kernelName:gl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Dn(wt(n,X(ji(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP={kernelName:xh,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Ze(Kt(t),"float32"),t:()=>X(n,Ze(t,n.dtype)),e:()=>X(n,Ze(rg(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP={kernelName:xl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Zs(t,en(0)),r=en(Fh),o=en(Oh),i=X(n,o),a=X(X(n,r),ao(Ze(t,"float32")));return Ss(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP={kernelName:vl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,X(t,$t(en(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP={kernelName:wl,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CP={kernelName:yl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(Jm(Ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP={kernelName:bl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(cv(Ze(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IP={kernelName:yh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[a,c]=Ph(s,r,o),l=[];for(let d=0;d<n.rank;d++)l.push([a[d],i[d]-a[d]-c[d]]);return{x:()=>ag(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kP={kernelName:Sh,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=X(n,s);return{logits:()=>$t(i,X(bt(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $P={kernelName:Sl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,La(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ry={kernelName:wh,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>Qm(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oy={kernelName:vh,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Es(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TP={kernelName:Cl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,X(hs(Ze(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AP={kernelName:Fm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X(n,X(Ze(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RP={kernelName:Nl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=en(2);return{a:()=>X(n,X(r,$t(t,s))),b:()=>X(n,X(r,$t(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP={kernelName:Al,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DP={kernelName:Il,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Dt(t.shape,s.shape);return{a:()=>{let a=n;const c=Hn(t.shape,r);return c.length>0&&(a=bt(a,c)),Y(a,t.shape)},b:()=>{let a=n;const c=Hn(s.shape,r);return c.length>0&&(a=bt(a,c)),Y(Dn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jP={kernelName:bh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;Lt(o,s.shape).forEach(l=>{r[l]=1});const a=Y(n,r),c=X(a,ei(s.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _P={kernelName:kl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wt(n,bn(Jm(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PP={kernelName:$l,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>X($t(en(1),bn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MP={kernelName:Tl,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=Kt(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=Te(i,pn(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)i=Te(i,pn(n,[a*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)i=Te(i,pn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)for(let d=0;d<r[3];++d)i=Te(i,pn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FP={kernelName:ha,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=Jo(r);return{x:()=>qt(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OP={kernelName:Ch,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>wo(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP={kernelName:Nh,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>zP(n,t)}}};function zP(n,e){const t=Zo(e,Kt(e)),s=tg(n,t);let r=Vi(e,en(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=As(r,a+1);r=bo(r,ei(s.shape,"bool"));const i=Kt(s);return Ss(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WP={kernelName:Ih,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BP=[C1,Lj,zj,Wj,Bj,Vj,Uj,Gj,Hj,qj,Kj,Xj,Jj,t_,n_,s_,r_,o_,i_,a_,c_,l_,d_,u_,p_,m_,g_,x_,y_,b_,lP,w_,v_,S_,C_,N_,k_,I_,$_,T_,A_,R_,E_,D_,j_,__,P_,M_,F_,z_,ny,ny,W_,U_,q_,K_,X_,Q_,Y_,J_,Z_,eP,tP,nP,sP,sy,sy,rP,oP,cP,uP,dP,hP,fP,pP,mP,gP,xP,yP,bP,wP,vP,SP,CP,NP,IP,kP,$P,ry,ry,oy,oy,TP,RP,AP,EP,DP,jP,_P,PP,MP,FP,OP,LP,WP];for(const n of BP)o2(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.abs=function(){return this.throwIfDisposed(),ys(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.acos=function(){return this.throwIfDisposed(),yT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.acosh=function(){return this.throwIfDisposed(),wT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.add=function(n){return this.throwIfDisposed(),Te(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.all=function(n,e){return this.throwIfDisposed(),rv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.any=function(n,e){return this.throwIfDisposed(),xp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.argMax=function(n){return this.throwIfDisposed(),wc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.argMin=function(n){return this.throwIfDisposed(),IT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asScalar=function(){return this.throwIfDisposed(),R(this.size===1,()=>"The array must have only 1 element."),Y(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asType=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as1D=function(){return this.throwIfDisposed(),Y(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as2D=function(n,e){return this.throwIfDisposed(),Y(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),Y(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),Y(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),Y(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asin=function(){return this.throwIfDisposed(),$T(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asinh=function(){return this.throwIfDisposed(),AT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atan=function(){return this.throwIfDisposed(),ET(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atan2=function(n){return this.throwIfDisposed(),jT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atanh=function(){return this.throwIfDisposed(),PT(this)};de().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),Xm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Qm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Rh(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.broadcastTo=function(n){return this.throwIfDisposed(),mc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cast=function(n){return this.throwIfDisposed(),Ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.ceil=function(){return this.throwIfDisposed(),cA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Js(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Wn&&(n=[n]),Es([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),ov(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),iv(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Di(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cos=function(){return this.throwIfDisposed(),Jm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cosh=function(){return this.throwIfDisposed(),cv(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),bp(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),lv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),jA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Zm(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),MA(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.divNoNan=function(n){return this.throwIfDisposed(),WA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.div=function(n){return this.throwIfDisposed(),wt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.dot=function(n){return this.throwIfDisposed(),VA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.elu=function(){return this.throwIfDisposed(),Dh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.equal=function(n){return this.throwIfDisposed(),io(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.erf=function(){return this.throwIfDisposed(),uv(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),tR(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.exp=function(){return this.throwIfDisposed(),ao(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.expandDims=function(n){return this.throwIfDisposed(),As(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.expm1=function(){return this.throwIfDisposed(),oR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.fft=function(){return this.throwIfDisposed(),Av(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.flatten=function(){return this.throwIfDisposed(),Y(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.floor=function(){return this.throwIfDisposed(),_h(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.floorDiv=function(n){return this.throwIfDisposed(),sv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.gather=function(n,e,t){return this.throwIfDisposed(),tg(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Vi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.greater=function(n){return this.throwIfDisposed(),Zs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.ifft=function(){return this.throwIfDisposed(),wp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.irfft=function(){return this.throwIfDisposed(),QE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isFinite=function(){return this.throwIfDisposed(),pR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isInf=function(){return this.throwIfDisposed(),gR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isNaN=function(){return this.throwIfDisposed(),yR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.leakyRelu=function(n){return this.throwIfDisposed(),sg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.lessEqual=function(n){return this.throwIfDisposed(),za(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.less=function(n){return this.throwIfDisposed(),Ou(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),CR(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSigmoid=function(){return this.throwIfDisposed(),RR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSoftmax=function(n){return this.throwIfDisposed(),mv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),gv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.log=function(){return this.throwIfDisposed(),co(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.log1p=function(){return this.throwIfDisposed(),pv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalAnd=function(n){return this.throwIfDisposed(),bo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalNot=function(){return this.throwIfDisposed(),rg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalOr=function(n){return this.throwIfDisposed(),xv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalXor=function(n){return this.throwIfDisposed(),OR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Zt(this,n,e,t)};de().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),og(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.max=function(n,e){return this.throwIfDisposed(),Er(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.maximum=function(n){return this.throwIfDisposed(),Zo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mean=function(n,e){return this.throwIfDisposed(),Ln(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.min=function(n,e){return this.throwIfDisposed(),Fu(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.minimum=function(n){return this.throwIfDisposed(),Cc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),HR(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mod=function(n){return this.throwIfDisposed(),KR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mul=function(n){return this.throwIfDisposed(),X(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.neg=function(){return this.throwIfDisposed(),Dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.norm=function(n,e,t){return this.throwIfDisposed(),jh(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.notEqual=function(n){return this.throwIfDisposed(),Lu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),yv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.onesLike=function(){return this.throwIfDisposed(),fr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.pad=function(n,e){return this.throwIfDisposed(),ag(this,n,e)};de().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),rE(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.pow=function(n){return this.throwIfDisposed(),ji(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.prelu=function(n){return this.throwIfDisposed(),lg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.prod=function(n,e){return this.throwIfDisposed(),aE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reciprocal=function(){return this.throwIfDisposed(),RE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.relu=function(){return this.throwIfDisposed(),Gi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.relu6=function(){return this.throwIfDisposed(),vv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reshapeAs=function(n){return this.throwIfDisposed(),Y(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reshape=function(n){return this.throwIfDisposed(),Y(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),_v(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),Pv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reverse=function(n){return this.throwIfDisposed(),_i(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.rfft=function(){return this.throwIfDisposed(),ZE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.round=function(){return this.throwIfDisposed(),Sv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.rsqrt=function(){return this.throwIfDisposed(),Cv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.selu=function(){return this.throwIfDisposed(),Nv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Iv(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sigmoid=function(){return this.throwIfDisposed(),La(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sign=function(){return this.throwIfDisposed(),LE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sin=function(){return this.throwIfDisposed(),kv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sinh=function(){return this.throwIfDisposed(),$v(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.slice=function(n,e){return this.throwIfDisposed(),pn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.softmax=function(n){return this.throwIfDisposed(),bg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.softplus=function(){return this.throwIfDisposed(),El(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),cg(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.split=function(n,e){return this.throwIfDisposed(),Ys(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sqrt=function(){return this.throwIfDisposed(),hs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.square=function(){return this.throwIfDisposed(),bn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.squaredDifference=function(n){return this.throwIfDisposed(),tD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.squeeze=function(n){return this.throwIfDisposed(),jl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Wn?[this,n]:[this,...n];return wo(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.step=function(n){return this.throwIfDisposed(),_l(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.stridedSlice=function(n,e,t,s,r,o,i,a){return this.throwIfDisposed(),iD(this,n,e,t,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sub=function(n){return this.throwIfDisposed(),$t(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sum=function(n,e){return this.throwIfDisposed(),bt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tan=function(){return this.throwIfDisposed(),cD(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tanh=function(){return this.throwIfDisposed(),Ah(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tile=function(n){return this.throwIfDisposed(),Tr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toBool=function(){return this.throwIfDisposed(),Ze(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toFloat=function(){return this.throwIfDisposed(),Ze(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toInt=function(){return this.throwIfDisposed(),Ze(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.topk=function(n,e){return this.throwIfDisposed(),dD(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.transpose=function(n){return this.throwIfDisposed(),qt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unique=function(n){return this.throwIfDisposed(),pD(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),Dv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unstack=function(n){return this.throwIfDisposed(),Pi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.where=function(n,e){return this.throwIfDisposed(),Ss(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.zerosLike=function(){return this.throwIfDisposed(),Kt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qr.prototype)}}class ur extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ur.prototype)}}class H extends Error{constructor(e){super(e),Object.setPrototypeOf(this,H.prototype)}}class _t extends Error{constructor(e){super(e),Object.setPrototypeOf(this,_t.prototype)}}class n0 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,n0.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class I1{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Mi(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Kr(n,e){if(!n)throw new n0(e)}function iy(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Rs(n){return n.length===1?n[0]:n}function an(n){return Array.isArray(n)?n:[n]}function go(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function pi(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let tr={};function s0(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Cp(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Cp(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Cp(s))}}}function Ol(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in tr)i=tr[o];else if(i=e[o],i==null)throw new H(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new H(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,c;if(i in t?[a,c]=t[i]:i in tr?[a,c]=tr.className:i in e&&([a,c]=e[i]),a==null)throw new H(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const l={};for(const p of Object.keys(tr))l[p]=tr[p];for(const p of Object.keys(t))l[p]=t[p];const d=o.config;d.customObjects=l;const h=Object.assign({},tr);for(const p of Object.keys(t))tr[p]=t[p];Cp(o.config);const f=c(a,o.config,t,r);return tr=Object.assign({},h),f}else{const l=Object.assign({},tr);for(const h of Object.keys(t))tr[h]=t[h];const d=new a(o.config);return tr=Object.assign({},l),d}}}function VP(n,e){return n<e?-1:n>e?1:0}function ru(n,e){return-1*VP(n,e)}function Oo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function UP(n){if(n==null)throw new H(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function qi(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new H(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function r0(n,e,t=0,s=1/0){return Kr(t>=0),Kr(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Jn(n,e){Array.isArray(n)?(R(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Jn(t,`element ${s+1} of ${e}`))):R(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${k1(n)}.`)}function k1(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>k1(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function GP(n,e,t){let s=t!=null?t():Ts(),r;return(...i)=>{const a=t!=null?t():Ts();return a-s<e||(s=a,r=n(...i)),r}}function $1(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let HP=0;function T1(){return HP++}const ou={};function Lh(n=""){return n in ou||(ou[n]=0),ou[n]+=1,n+ou[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qP=["channelsFirst","channelsLast"],KP=["nearest","bilinear"],XP=["valid","same","causal"],QP=["max","avg"],YP=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const na=new Map;function Pn(n){qi(qP,"DataFormat",n)}function JP(n){qi(KP,"InterpolationFormat",n)}function er(n){qi(XP,"PaddingMode",n)}function A1(n){qi(QP,"PoolMode",n)}const gc=[],ay="/";function Si(n,e){gc.push(n);try{const t=e();return gc.pop(),t}catch(t){throw gc.pop(),t}}function ZP(){return gc.length===0?"":gc.join(ay)+ay}function R1(n){if(!D1(n))throw new Error("Not a valid tensor name: '"+n+"'");return ZP()+n}function E1(n){if(!D1(n))throw new Error("Not a valid tensor name: '"+n+"'");na.has(n)||na.set(n,0);const e=na.get(n);if(na.set(n,na.get(n)+1),e>0){const t=`${n}_${e}`;return na.set(t,1),t}else return n}const eM=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function D1(n){return!!n.match(eM)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tM(n){return n===parseInt(n.toString(),10)}function Lo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function $a(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Vo(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function jr(n,e){if(e<n)throw new H(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Cf;function Bn(){return Cf==null&&(Cf=E2().epsilon()),Cf}function _r(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function no(n,e){return Ze(n,e)}function Ll(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),Y(n,t)}function nM(n,e){return ie(()=>{if(n.shape.length!==2)throw new H(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Ll(n,1);return Np(t,[1,e,1])})}function sM(n){const e=[Lo(n.shape)];return Y(n,e)}function rM(n){if(n.rank<=1)throw new H(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Lo(n.shape,1)];return Y(n,e)}function Ci(n,e,t){return ie(()=>{switch(n.rank){case 1:return xg(n,e,t);case 2:return Tv(n,[e,0],[t,n.shape[1]]);case 3:return yg(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Wu(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return pn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return pn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new H(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Nf(n,e,t){return ie(()=>{switch(n.rank){case 1:return xg(n,e,t);case 2:return Tv(n,[0,e],[n.shape[0],t]);case 3:return yg(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Wu(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function iu(n,e,t,s){return ie(()=>{switch(n.rank){case 1:return xg(n,e,t);case 2:switch(s){case 1:return Ci(n,e,t);case 2:return Nf(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Ci(n,e,t);case 2:return yg(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Nf(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Ci(n,e,t);case 2:return Wu(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Wu(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Nf(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function o0(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Es(n,e)}function cy(n,e){switch(n.rank){case 1:return dA([n,e]);case 2:return fA([n,e],0);case 3:return mA([n,e],0);case 4:return xA([n,e],0);default:throw new H(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Np(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new H(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Tr(n,e)}function zh(n,e=0,t=1,s,r){return kE(n,e,t,s,r)}function so(n,e,t,s){if(n.rank<2||e.rank<2)throw new _t(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new _t(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return Hx({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Ip(n.rank,s,_r()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=Y(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),c=i.pop(),l=[...i,a],d=Array.from({length:e.rank},(m,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=Y(qt(e,d),[c,-1]);const h=[...r,...l];return Y(Hx({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Ip(n.rank,s,_r()):null,activation:t}),h)}}function j1(n,e,t){return ie(()=>(Array.isArray(e)?e=Vs(e,"int32"):e=Ze(e,"int32"),tg(n,e,t)))}function zl(n){return X(n,n)}function Ip(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new H(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?Y(e,[1,s[0],1,1,1]):Y(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?Y(e,[1,1,1,1,s[0]]):Y(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?Y(e,[1,s[0],1,1]):Y(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?Y(e,[1,1,1,s[0]]):Y(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?Y(e,[1,s[0],1]):Y(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?Y(e,[1,1,s[0]]):Y(e,[1].concat(s))}else if(n<3)return e;throw new H(`Unsupported input rank by biasAdd: ${e.rank}`)}function Fr(n,e,t){return ie(()=>(t==null&&(t=_r()),Pn(t),Te(n,Ip(n.rank,e,t))))}function oM(n,e=1){if(e!==1)throw new _t(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Dh(n)}function iM(n){return ie(()=>wt(n,Te(ys(n),1)))}function _1(n,e,t,s){return ie(()=>vD(n,e,t,s))}function aM(n){return ie(()=>{const e=Te(.5,X(.2,n));return Js(e,0,1)})}function Wl(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const cM=["fanIn","fanOut","fanAvg"],lM=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uM(n){qi(cM,"FanMode",n)}function dM(n){qi(lM,"Distribution",n)}class mr extends Ba{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class P1 extends mr{apply(e,t){return Qn(e,t)}}P1.className="Zeros";Ie(P1);class i0 extends mr{apply(e,t){return ei(e,t)}}i0.className="Ones";Ie(i0);class M1 extends mr{constructor(e){if(super(),typeof e!="object")throw new H(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new H(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ie(()=>X(en(this.value),ei(e,t)))}getConfig(){return{value:this.value}}}M1.className="Constant";Ie(M1);class F1 extends mr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Dl(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}F1.className="RandomUniform";Ie(F1);class O1 extends mr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new _t(`randomNormal does not support dType ${t}.`);return zh(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}O1.className="RandomNormal";Ie(O1);class L1 extends mr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new _t(`truncatedNormal does not support dType ${t}.`);return Ev(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}L1.className="TruncatedNormal";Ie(L1);class z1 extends mr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ie(()=>{if(e.length!==2||e[0]!==e[1])throw new H("Identity matrix initializer can only be used for 2D square matrices.");return X(this.gain,fv(e[0]))})}getConfig(){return{gain:this.gain}}}z1.className="Identity";Ie(z1);function hM(n,e="channelsLast"){let t,s;if(Pn(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Lo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Lo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Lo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Gs extends mr{constructor(e){if(super(),e.scale<0)throw new H(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,uM(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,dM(this.distribution),this.seed=e.seed}apply(e,t){const s=hM(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new _t(`${this.getClassName()} does not support dType ${t}.`);return Ev(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return Dl(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Gs.className="VarianceScaling";Ie(Gs);class a0 extends Gs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Gs.className}}a0.className="GlorotUniform";Ie(a0);class c0 extends Gs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Gs.className}}c0.className="GlorotNormal";Ie(c0);class l0 extends Gs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Gs.className}}l0.className="HeNormal";Ie(l0);class u0 extends Gs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Gs.className}}u0.className="HeUniform";Ie(u0);class d0 extends Gs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Gs.className}}d0.className="LeCunNormal";Ie(d0);class h0 extends Gs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Gs.className}}h0.className="LeCunUniform";Ie(h0);class W1 extends mr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ie(()=>{if(e.length<2)throw new _t("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=fe(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=zh(i,0,1,t,this.seed),c=xj.qr(a,!1);let l=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return l=X(l,h.sign()),s<r&&(l=l.transpose()),X(en(this.gain),l.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}W1.className="Orthogonal";Ie(W1);const ly={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function uy(n,e={}){return Ol(n,ir.getMap().classNameMap,e,"initializer")}function Tn(n){return s0(n)}function Sn(n){if(typeof n=="string"){const e=n in ly?ly[n]:n;if(e==="GlorotNormal")return new c0;if(e==="GlorotUniform")return new a0;if(e==="HeNormal")return new l0;if(e==="HeUniform")return new u0;if(e==="LeCunNormal")return new d0;if(e==="LeCunUniform")return new h0;{const t={};return t.className=e,t.config={},uy(t)}}else return n instanceof mr?n:uy(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kp(n){return Array.isArray(n)&&Array.isArray(n[0])}function Bu(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function At(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new H(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Qt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new H(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vu(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const dy="Variable";class fM{constructor(e,t="float32",s=dy,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=T1(),s=s??dy,this.originalName=R1(s),this.name=E1(this.originalName),this.trainable_=r,this.constraint=o,this.val=xD(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),pM(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function pM(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function $p(n){return n.map(e=>e.read())}function f0(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Vn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class lo{constructor(e,t,s,r,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=T1(),i!=null&&(this.originalName=R1(i),this.name=E1(this.originalName)),this.rank=t.length}}let mM=0;class Wh{constructor(e,t){this.callArgs=t,this.id=mM++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let gM=0;class zt extends Ba{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=gM++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=go(s)+"_"+Lh(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new ur(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new H(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Rs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Rs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new qr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new qr(`Layer ${this.name} is not connected, no input to return.`);return Rs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new qr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new qr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Rs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=an(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=an(this.inputSpec);if(t.length!==s.length)throw new H(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new H(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const c=o.shape;for(const l in i.axes){const d=Number(l),h=i.axes[l],f=d>=0?c[d]:c[c.length+d];if(h!=null&&[h,null].indexOf(f)===-1)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${h} but got shape ${c}.`)}}if(i.shape!=null)for(let c=0;c<i.shape.length;++c){const l=i.shape[c],d=o.shape[c];if(l!=null&&d!=null&&l!==d)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=an(e),r=bM(e),o=wM(e);if(r===o)throw new H("Arguments to apply() must be all SymbolicTensors or all Tensors");return Si(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of an(e))i.push(a.shape);this.build(Rs(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=an(i),c=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(i=Rs(c),this.activityRegularizer!=null)throw new _t("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=xM(e),a=this.computeOutputShape(i);let c;const l=yM(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((d,h)=>new lo(l,d,this,an(e),t,this.name,h)):c=new lo(l,a,this,an(e),t,this.name),this.addInboundNode(e,c,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new _t("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new qr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new qr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new ur(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Vu(this.weights)}build(e){this.built=!0}getWeights(e=!1){return $p(e?this.trainableWeights:this.weights)}setWeights(e){ie(()=>{const t=this.weights;if(t.length!==e.length)throw new H(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=$p(t);for(let o=0;o<r.length;++o){const i=r[o],a=t[o],c=e[o];if(!tn(i.shape,c.shape))throw new H(`Layer weight shape ${i.shape} not compatible with provided weight shape ${c.shape}`);s.push([a,c])}f0(s)})}addWeight(e,t,s,r,o,i,a,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new H(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():Sn("zeros"));const l=r.apply(t,s),d=new fM(l,s,e,i,a);return l.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=an(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=an(t),i=an(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,s,r,o,i,a=null){const c=an(e);t=an(t),s=an(s),r=an(r),o=Bu(o),i=Bu(i);const l=[],d=[],h=[];for(const f of c)l.push(f.sourceLayer),d.push(f.nodeIndex),h.push(f.tensorIndex);new Wh({outboundLayer:this,inboundLayers:l,nodeIndices:d,tensorIndices:h,inputTensors:c,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function xM(n){n=an(n);const e=[];for(const t of n)e.push(t.shape);return Rs(e)}function yM(n){return"float32"}function B1(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],c=s.nodeIndices[o],l=B1(i,a,c);for(const d of l)r.indexOf(d)===-1&&r.push(d)}return r}}}function bM(n){let e=!0;for(const t of an(n))if(!(t instanceof lo)){e=!1;break}return e}function wM(n){let e=!0;for(const t of an(n))if(t instanceof lo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Bl extends zt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Lh("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new H("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new H("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new H("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new lo(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Wh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new H(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Bl.className="InputLayer";Ie(Bl);function vM(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new H("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Bl({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function SM(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Ze(e,n.dtype)}catch{throw new H(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class jo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof jo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=SM(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new H(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof lo){if(this.id2Value[e.id]==null)throw new H(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new H(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof lo){if(this.id2Value[e.id]==null)throw new H(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new H(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Pt(this.id2Mask)}}const Uu=new I1,Gu=new I1;function CM(n){Uu!=null&&Uu.setMaxEntries(n),Gu!=null&&Gu.setMaxEntries(n)}function ac(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(m=>m.name),c=[],l=e.names();for(const m of a)l.indexOf(m)!==-1?c.push(e.getValue(m)):c.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let h=Uu.get(d),f;if(h==null){const m=NM(i,e);h=m.sorted,f=m.recipientCounts,Uu.put(d,h),Gu.put(d,f)}f={},r||Object.assign(f,Gu.get(d));const p=new jo(e);for(let m=0;m<h.length;++m){const g=h[m],x=g.sourceLayer;if(x instanceof Bl)continue;const y=[],b=[],w=[];let v=!1;for(const A of g.inputs){const T=p.getValue(A),E=p.getMask(A);y.push(T),b.push(E),E!=null&&(v=!0),r||(f[A.name]--,f[A.name]===0&&!e.hasKey(A)&&a.indexOf(A.name)===-1&&!T.isDisposed&&A.sourceLayer.stateful!==!0&&w.push(T))}v&&(t=t||{},t.mask=b[0]);const S=an(x.apply(y,t));let C=null;x.supportsMasking&&(C=x.computeMask(y,b));const k=kM(g),I=Array.isArray(k)?k:[k];for(let A=0;A<I.length;++A){p.hasKey(I[A])||p.add(I[A],S[A],Array.isArray(C)?C[0]:C);const T=a.indexOf(I[A].name);T!==-1&&(c[T]=S[A])}r||Pt(w)}return p.disposeMasks(),o?c:c[0]}function NM(n,e){R(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=hy(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=hy(o,e);for(const c of i)r.has(c.name)||(t.push(c),r.add(c.name));for(const c in a)s[c]==null&&(s[c]=new Set),a[c].forEach(l=>s[c].add(l))}}return{sorted:t,recipientCounts:IM(s)}}function IM(n){const e={};for(const t in n)e[t]=n[t].size;return e}function hy(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const c=i[i.length-1]===o.length-1;if(a.inputs.length===0||c)o.pop(),s.push(a),t.add(a.name),c&&i.pop();else{i.push(o.length-1);for(const l of a.inputs)r[l.name]==null&&(r[l.name]=new Set),r[l.name].add(a.name),!t.has(l.name)&&o.push(l)}}return{sorted:s,recipientMap:r}}function kM(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $M=ce();$M.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,CM);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function p0(n,e){return ie(()=>hs(bt(X(n,n),e,!0)))}class Vl extends Ba{getConfig(){return{}}}class V1 extends Vl{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>{const t=p0(e,this.axis),s=Js(t,0,this.maxValue);return X(e,wt(s,Te(Bn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}V1.className="MaxNorm";Ie(V1);class U1 extends Vl{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>wt(e,Te(Bn(),p0(e,this.axis))))}getConfig(){return{axis:this.axis}}}U1.className="UnitNorm";Ie(U1);class G1 extends Vl{apply(e){return Gi(e)}}G1.className="NonNeg";Ie(G1);class H1 extends Vl{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ie(()=>{const t=p0(e,this.axis),s=Te(X(this.rate,Js(t,this.minValue,this.maxValue)),X(1-this.rate,t));return X(e,wt(s,Te(Bn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}H1.className="MinMaxNorm";Ie(H1);const fy={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Un(n){return s0(n)}function py(n,e={}){return Ol(n,ir.getMap().classNameMap,e,"constraint")}function Gn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in fy?fy[n]:n,config:{}};return py(t)}else return n instanceof Vl?n:py(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ci(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Pt(s)}}function q1(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var my;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(my||(my={}));const TM=125;class Ic{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class AM{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class RM extends Ic{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=ie(()=>Te(this.totals[r],X(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ie(()=>{const r=X(wt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),eo(t[s])}))}}class EM extends Ic{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const c=i[a];e.push(c.data()),t.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class DM extends Ic{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Jv,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=TM),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");tp(this.yieldEvery)&&(this.maybeWait=GP(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await ci(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await ci(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await ci(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await ci(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await ci(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):tp(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await ci(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await ci(e),await this.trainEnd(e))}}function K1(n,e){return n==null&&(n={}),n instanceof Ic?[n]:Array.isArray(n)&&n[0]instanceof Ic?n:an(n).map(s=>new DM(s,e))}class rr{constructor(){}static registerCallbackConstructor(e,t){R(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),rr.checkForDuplicate(t),rr.constructors[e]==null&&(rr.constructors[e]=[]),rr.constructors[e].push(t)}static checkForDuplicate(e){for(const t in rr.constructors)rr.constructors[+t].forEach(r=>{if(r===e)throw new H("Duplicate callback constructor.")})}static clear(){rr.constructors={}}static createCallbacks(e){const t=[];for(const s in rr.constructors){const r=+s;e>=r&&t.push(...rr.constructors[r])}return t.map(s=>new s)}}rr.constructors={};function X1(n,e,t,s,r,o,i,a,c){const l=new EM,d=[new RM,...rr.createCallbacks(e)];n!=null&&d.push(...n),d.push(l);const h=new AM(d);return h.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:c}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ro(n,e={},t=!1){return Ol(n,ir.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Hu(n,e){return ie(()=>{n.dtype!=="float32"&&(n=Ze(n,"float32"));const t=bt(zl(n),e,!0),s=Eh(t.shape,Bn()),r=hs(Zo(t,s));return wt(n,r)})}function Bh(n,e){return ie(()=>Ln(zl($t(e,n)),-1))}function m0(n,e){return ie(()=>Ln(ys($t(e,n)),-1))}function g0(n,e){return ie(()=>{const t=$t(n,e),s=Js(ys(n),Bn(),Number.MAX_VALUE),r=ys(wt(t,s));return X(100,Ln(r,-1))})}function jM(n,e){return ie(()=>{const t=Js(e,Bn(),Number.MAX_VALUE),s=co(Te(1,t)),r=Js(n,Bn(),Number.MAX_VALUE),o=co(Te(1,r));return Ln(zl($t(s,o)),-1)})}function _M(n,e){return ie(()=>{const t=Zo(0,$t(1,X(n,e)));return Ln(zl(t),-1)})}function PM(n,e){return ie(()=>{const t=Zo(0,$t(1,X(n,e)));return Ln(t,-1)})}function MM(n,e){return ie(()=>{const t=bt(X(n,e),-1),s=Er(X($t(1,n),e),-1);return Zo(0,Te(1,$t(s,t)))})}function FM(n,e){return ie(()=>{const t=Math.log(2),s=$t(e,n),r=$t(Te(s,El(X(-2,s))),t);return Ln(r,-1)})}function kc(n,e,t=!1){return ie(()=>{if(t)e=bg(e);else{const s=bt(e,e.shape.length-1,!0);e=wt(e,s)}return e=Js(e,Bn(),1-Bn()),Dn(bt(X(Ze(n,"float32"),co(e)),e.shape.length-1))})}function qu(n,e,t=!1){return ie(()=>{const s=Ze(_h(sM(n)),"int32");e=Js(e,Bn(),1-Bn());const r=e.shape,o=Y(yv(s,r[r.length-1]),r);return kc(o,e,t)})}function OM(n,e){if(!tn(n.shape,e.shape))throw new H(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ie(()=>{const t=Gi(e),s=Dn(ys(e));return Te($t(t,X(e,n)),pv(ao(s)))})}function Vh(n,e){return ie(()=>{let t;return t=Js(e,Bn(),1-Bn()),t=co(wt(t,$t(1,t))),Ln(OM(n,t),-1)})}function LM(n,e){return ie(()=>{const t=Js(n,Bn(),1),s=Js(e,Bn(),1);return bt(X(n,co(wt(t,s))),-1)})}function zM(n,e){return ie(()=>{const t=co(Te(Bn(),e));return Ln($t(e,X(n,t)),-1)})}function Q1(n,e){return ie(()=>{const t=Hu(n,-1),s=Hu(e,-1),r=X(t,s);return Dn(bt(r,-1))})}const Ku={meanSquaredError:Bh,meanAbsoluteError:m0,meanAbsolutePercentageError:g0,meanSquaredLogarithmicError:jM,squaredHinge:_M,hinge:PM,categoricalHinge:MM,logcosh:FM,categoricalCrossentropy:kc,sparseCategoricalCrossentropy:qu,binaryCrossentropy:Vh,kullbackLeiblerDivergence:LM,poisson:zM,cosineProximity:Q1};function If(n){if(typeof n=="string"){if(n in Ku)return Ku[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new H(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Y1(n,e){return ie(()=>{const t=X(.5,fr(e)),s=no(Zs(e,t),n.dtype);return Ln(io(n,s),-1)})}function J1(n,e){return ie(()=>no(io(wc(n,-1),wc(e,-1)),"float32"))}function WM(n,e){return ie(()=>Ze(bt(bo(io(n,1),io(e,1))),"float32"))}function BM(n,e){return ie(()=>Ze(bt(bo(io(n,0),io(e,1))),"float32"))}function VM(n,e){return ie(()=>{const t=WM(n,e),s=BM(n,e),r=Te(t,s);return Ze(Ss(Zs(r,0),wt(t,r),0),"float32")})}function UM(n,e){return Vh(n,e)}function GM(n,e){return n.rank===e.rank&&(n=jl(n,[n.rank-1])),e=wc(e,-1),e.dtype!==n.dtype&&(e=Ze(e,n.dtype)),Ze(io(n,e),"float32")}const HM=Bh,qM=Bh,KM=m0,XM=m0,QM=g0,YM=g0,Z1=kc,JM=Q1,eS=qu,Xu={binaryAccuracy:Y1,categoricalAccuracy:J1,precision:VM,categoricalCrossentropy:Z1,sparseCategoricalCrossentropy:eS,mse:HM,MSE:qM,mae:KM,MAE:XM,mape:QM,MAPE:YM,cosine:JM};function ZM(n){if(typeof n=="string"&&n in Xu)return Xu[n];if(typeof n!="string"&&n!=null)return n;throw new H(`Unknown metric ${n}`)}function au(n){if(Kr(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Ku))if(Ku[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Xu))if(Xu[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eF(n){const e={Adagrad:()=>di.adagrad(.01),Adadelta:()=>di.adadelta(1,.95,Bn()),Adam:()=>di.adam(.001,.9,.999,Bn()),Adamax:()=>di.adamax(.002,.9,.999,Bn(),0),RMSProp:()=>di.rmsprop(.001,.9,0,Bn()),SGD:()=>di.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new H(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gy=1*1024*1024;function xy(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Tp(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>gy&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${gy}.`)}}function Tp(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Tp(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Tp(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tF(n,e,t,s=console.log){const r=sF(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),Qu(o,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?rF(a[d],t,s):oF(a[d],t,i,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const c=nF(n),l=Vu(n.nonTrainableWeights);s(`Total params: ${c+l}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${l}`),s("_".repeat(e))}function nF(n){let e;return n.collectedTrainableWeights!=null?e=Vu(n.collectedTrainableWeights):e=Vu(n.trainableWeights),e}function sF(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Qu(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function rF(n,e,t){let s,r;try{r=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];Qu(a,e,t)}function oF(n,e,t,s){let r,o;try{o=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const h of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(h)===-1))for(let f=0;f<h.inboundLayers.length;++f){const p=h.inboundLayers[f].name,m=h.nodeIndices[f],g=h.tensorIndices[f];i.push(`${p}[${m}][${g}]`)}const a=n.name,c=n.getClassName(),l=i.length===0?"":i[0],d=[`${a} (${c})`,o,r,n.countParams().toString(),l];Qu(d,e,s);for(let h=1;h<i.length;++h)Qu(["","","","",i[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tS(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Yu(n,e){if(n===null)return null;if(typeof n=="string")return pi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];tS(e,r,o)?t.push(o):t.push(Yu(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=pi(s);t[o]=Yu(r,o)}}return t}}function Ap(n,e){if(n==null)return null;if(typeof n=="string")return go(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];tS(e,r,o)?t.push(o):t.push(Ap(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=go(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=Ap(r,s)}return t}}/** @license See the LICENSE file. */const nS="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const iF=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class vr extends zt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=Lh(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Oo(this.inputs).length!==this.inputs.length)throw new H(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Oo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const w=b.sourceLayer,v=b.nodeIndex,S=b.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(S)}for(const b of this.inputs){const w=b.sourceLayer,v=b.nodeIndex,S=b.tensorIndex;Kr(v===0,"input layer has >1 nodes"),Kr(S===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const w=this.inputLayers[b];if(!(w instanceof Bl))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const t={},s={},r={},o={},i={},a=[],c=(b,w,v,S,C,k)=>{(S==null||C==null||k==null)&&(S=b.sourceLayer,C=b.nodeIndex,k=b.tensorIndex);const I=S.inboundNodes[C];if(v.indexOf(I)!==-1)throw new ur(`The tensor ${b.name} at layer "${S.name}" is part of a cycle.`);if(w.indexOf(I)!==-1)return;this.containerNodes.add(vr.nodeKey(S,C)),S.id in i||(i[S.id]=Object.keys(i).length),v.indexOf(I)===-1&&v.push(I);const A=I.inboundLayers.length;for(let T=0;T<A;T++){const E=I.inputTensors[T],$=I.inboundLayers[T],D=I.nodeIndices[T],M=I.tensorIndices[T];c(E,w,v,$,D,M)}for(w.push(I);v.indexOf(I)>=0;)v.splice(v.indexOf(I),1);a.push(I)},l=[],d=[];for(const b of this.outputs)c(b,l,d);const h=a.slice().reverse();for(const b of h){s[b.id]=b,b.id in t||(t[b.id]=0);let w=t[b.id];const v=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];w=Math.max(w,v),r[b.outboundLayer.id]=w,o[b.outboundLayer.id]=b.outboundLayer,t[b.id]=w;for(let S=0;S<b.inboundLayers.length;S++){const C=b.inboundLayers[S],k=b.nodeIndices[S],I=C.inboundNodes[k],A=t[I.id]==null?0:t[I.id];t[I.id]=Math.max(w+1,A),s[I.id]=I}}const f={};for(const b in t){const w=t[b];w in f||(f[w]=[]),f[w].push(s[b])}const p={};for(const b in r){const w=r[b];w in p||(p[w]=[]),p[w].push(o[b])}let m=Object.keys(p).map(b=>parseInt(b,10)).sort(ru);this.layers=[];for(const b of m){const w=p[b];w.sort((v,S)=>{const C=i[v.id],k=i[S.id];return C<k?-1:C>k?1:0});for(const v of w)v instanceof vr&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=p,m=Object.keys(f).map(b=>parseInt(b,10)).sort(ru);const g=this.inputs.slice(),x=[];for(const b of m)for(const w of f[b]){const v=w.outboundLayer;if(v!=null){for(const S of w.inputTensors)if(g.indexOf(S)===-1)throw new ur(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${v.name}". The following previous layers were accessed without issue: ${x}`);for(const S of w.outputTensors)g.push(S);x.push(v.name)}}this.nodesByDepth=f;const y=this.layers.map(b=>b.name);for(const b of y){const w=y.filter(v=>v===b).length;if(w!==1)throw new ur(`The name "${b}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Wh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new H("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=iF(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[c,l]of a.weights.entries()){const d=o?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(s[d]!=null)throw new H(`Duplicate weight name: ${d}`);s[d]=l,r++}const i=[];for(const a in e){let c=a;if(s[a]==null){const l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[c]!=null)i.push([s[c],e[a]]);else if(t)throw new H(`Provided weight data has no target variable: ${a}`);delete s[c]}if(t){const a=[];for(const c in s)a.push(c);if(a.length>0)throw new H(`${a.length} of ${r} weights are not set: ${a}`)}f0(i)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${nS}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Ap(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ie(()=>{e=an(e);const s=new jo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return ac(this.outputs,s,t)})}computeMask(e,t){return ie(()=>{e=an(e);let s;return t==null?s=Mi(null,e.length):s=an(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=Bu(e);if(t.length!==this.inputLayers.length)throw new H(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const c=this.inputLayers[a],l=t[a],d=c.name+"_0_0";s[d]=l}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(ru);if(r.length>1)for(const a of r){const c=this.nodesByDepth[a];for(const l of c){const d=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(d.id)!==-1)continue;const h=[];for(let g=0;g<l.inboundLayers.length;g++){const x=l.inboundLayers[g],y=l.nodeIndices[g],b=l.tensorIndices[g],w=`${x.name}_${y}_${b}`,v=s[w];h.push(v)}const f=d.computeOutputShape(Rs(h)),p=Bu(f),m=d.inboundNodes.indexOf(l);for(let g=0;g<p.length;g++){const x=`${d.name}_${m}_${g}`;s[x]=p[g]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],h=`${c.name}_${l}_${d}`;i.push(h)}for(let a=0;a<i.length;a++){const c=i[a];Kr(c in s),o.push(s[c])}return Rs(o)}runInternalGraph(e,t){t==null&&(t=Mi(null,e.length));const s={};for(let c=0;c<this.inputs.length;++c){const l=this.inputs[c],d=e[c],h=t[c];s[l.id]=[d,h]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(ru);for(const c of r){const l=this.nodesByDepth[c];for(const d of l){const h=d.outboundLayer,f=d.inputTensors,p=d.outputTensors,m=new Array;for(const g of f)g.id in s&&m.push(s[g.id]);if(m.length===f.length){let g={},x,y,b,w;if(d.callArgs!=null&&(g=d.callArgs),m.length===1){const[v,S]=m[0];g.mask==null&&(g.mask=S),b=an(h.call(v,g)),w=an(h.computeMask(v,S)),x=[v],y=[S]}else x=m.map(v=>v[0]),y=m.map(v=>v[1]),g.mask==null&&(g.mask=y),b=an(h.call(x,g)),w=an(h.computeMask(x,y));if(h.activityRegularizer)throw new _t("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<p.length;++v){const S=p[v],C=b[v],k=w[v];s[S.id]=[C,k]}}}}const o=[],i=[],a=[];for(const c of this.outputs){Kr(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[l,d]=s[c.id];a.push(l.shape),o.push(l),i.push(d)}return[o,i,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof vr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=vr.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new H("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new H(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new H(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ie(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=vr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),c=i.getConfig(),l=[];for(let h=0;h<i.inboundNodes.length;h++){const f=i.inboundNodes[h],p=vr.nodeKey(i,h);let m={};if(this.containerNodes.has(p)){if(f.callArgs)try{JSON.stringify(f.callArgs),m=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(f.inboundLayers.length>0){const g=[];for(let x=0;x<f.inboundLayers.length;x++){const y=f.inboundLayers[x],b=f.nodeIndices[x],w=f.tensorIndices[x],v=vr.nodeKey(y,b);let S=t[v];S==null&&(S=0),g.push([y.name,S,w,m])}l.push(g)}}}const d={};d.name=i.name,d.className=a,d.config=c,d.inboundNodes=l,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],c=this.inputLayersNodeIndices[i],l=vr.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.inputLayersTensorIndices[i];r.push([a.name,d,h])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],c=this.outputLayersNodeIndices[i],l=vr.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.outputLayersTensorIndices[i];o.push([a.name,d,h])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function a(x,y){x.name in i?i[x.name].push(y):i[x.name]=[y]}function c(x,y){const b=[];let w;for(const v of y){const S=v[0],C=v[1],k=v[2];if(w=v[3]==null?{}:v[3],!(S in o)){a(x,y);return}const I=o[S];if(I.inboundNodes.length<=C){a(x,y);return}const A=I.inboundNodes[C];b.push(A.outputTensors[k])}b.length>0&&x.apply(Rs(b),w)}function l(x){const y=x.name,b=ro(x,t.customObjects!=null?t.customObjects:{});b.setFastWeightInitDuringBuild(r),o[y]=b,x.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new H(`Corrupted configuration, expected array for nodeData: ${v}`);a(b,v)})}const d=t.name,h=t.layers;for(const x of h)l(x);for(;!UP(i);)for(const x of h){const y=o[x.name];if(y.name in i){const b=i[y.name];delete i[y.name];for(const w of b)c(y,w)}}const f=[],p=[],m=t.inputLayers;for(const x of m){const y=x[0],b=x[1],w=x[2];Kr(y in o);const S=o[y].inboundNodes[b].outputTensors;f.push(S[w])}const g=t.outputLayers;for(const x of g){const y=x[0],b=x[1],w=x[2];Kr(y in o);const S=o[y].inboundNodes[b].outputTensors;p.push(S[w])}return new e({inputs:f,outputs:p,name:d})}get stateful(){if(this._stateful)throw new H("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ie(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aF(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function sS(n,e){return aF(n,e,"classWeight")}async function rS(n,e,t,s){if(t!=null){const r=ie(()=>{if(n.shape.length===1)return vi(n);if(n.shape.length===2){if(n.shape[1]>1)return wc(n,1);if(n.shape[1]===1)return Y(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Pt(r);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Vs(i,"float32")}else return null}function cF(n,e){return X(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const lF=32;function oS(n,e){let t,s;const r=e;t=r.xs,s=r.ys,R(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=yy("input",n.inputNames,t),i=yy("output",n.outputNames,s),a=o[0].shape[0];R(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),R(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<o.length;c++)R(o[c].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${o[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let c=0;c<i.length;c++)R(i[c].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${i[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function yy(n,e,t){if(t instanceof Wn)return[t];if(Array.isArray(t))return R(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new H(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function uF(n){if(n.length===3)throw new _t("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function dF(n,e,t){const s=t.batchesPerEpoch!=null;if(R(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),R(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),R(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),R(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),R(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(by(t.validationData))R(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=uF(t.validationData);o=x.xs,i=x.ys}const a=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let l;r?l=c.slice().concat(c.map(x=>"val_"+x)):l=c.slice();const d=K1(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,{callbackList:f,history:p}=X1(d,h,t.epochs,null,null,hF(e,t),null,r,l);f.setModel(n),n.history=p,await f.onTrainBegin(),n.stopTraining_=!1;let m=t.initialEpoch==null?0:t.initialEpoch,g=await e.iterator();for(;m<t.epochs;){const x={};await f.onEpochBegin(m);let y=0,b=0;for(s||(g=await e.iterator());!s||y<t.batchesPerEpoch;){const w=await g.next();if(s&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){const{xs:v,ys:S}=oS(n,w.value),C={};C.batch=b,C.size=v[0].shape[0],await f.onBatchBegin(b,C);const k=[];if(t.classWeight!=null){const T=sS(t.classWeight,n.outputNames);for(let E=0;E<T.length;++E)k.push(await rS(S[E],null,T[E]))}const I=v.concat(S).concat(k),A=a(I);Pt(I);for(let T=0;T<c.length;++T){const E=c[T],$=A[T];C[E]=$,eo($)}await f.onBatchEnd(b,C),q1(C),b++,y++}if(s?y>=t.batchesPerEpoch:w.done){if(r){let v;by(t.validationData)?v=an(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):v=an(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?lF:t.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)x[`val_${n.metricsNames[S]}`]=v[S]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(m,x),m++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function hF(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function by(n){return typeof n.iterator=="function"}function fF(n){return typeof n.next=="function"}async function pF(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new _t("Verbose mode is not implemented yet.");R(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=fF(e)?e:await e.iterator();let a=0,c=0;for(;!s||c<t.batches;){const l=await i.next();if(o=ie(()=>{if(l.value){const{xs:d,ys:h}=oS(n,l.value),f=d.concat(h),p=ie(()=>r(f));if(Pt(f),c===0)for(let g=0;g<p.length;++g)o.push(en(0));const m=f[0].shape[0];for(let g=0;g<p.length;++g){const x=p[g],y=o[g];o[g]=ie(()=>Te(o[g],X(m,x))),c>0&&Pt(y)}Pt(p),a+=m,++c}return o}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<o.length;++l){const d=o[l];o[l]=wt(o[l],a),Pt(d)}return Rs(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kf(n){R(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function tc(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Ci(s,e,t-e)):Ci(n,e,t-e)}function Rp(n,e){return ie(()=>n==null?null:Array.isArray(n)?n.map(t=>Rp(t,e)):j1(n,e.dtype==="int32"?e:Ze(e,"int32")))}function $f(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function iS(n){const e=[];n instanceof Wn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Ll(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function br(n,e){if(n==null)return;const t=[];if(e instanceof Wn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof Wn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mF(n){return n instanceof Wn}function Ep(n){return Array.isArray(n)}function wy(n){return!mF(n)&&!Ep(n)}function vy(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(Ep(n)&&n.length>0)i=!0;else if(wy(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new H(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(wy(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new H(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(Ep(n)){if(n=n,n.length!==e.length)throw new H(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new H(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=iS(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new H(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d>=0&&l!==d)throw new H(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function gF(n,e,t){const s=Oo(n.map(o=>o.shape[0]));s.sort();const r=Oo(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new H(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new H(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!tn(s,r))throw new H(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function xF(n,e,t){const s=[Bh,Vh,kc];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],a=t[r];if(i!=null){if(i===kc&&o.shape[o.shape.length-1]===1)throw new H(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const c=o.shape.slice(1),l=a.slice(1);for(let d=0;d<c.length;++d){const h=c[d],f=l[d];if(f!=null&&h!==f)throw new H(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Sy(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new H(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new H(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new H(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d!==l)throw new H(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function yF(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const bF="layers-model";class ga extends vr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new H("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");tF(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=eF(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ti))throw new H("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new H(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(If(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new H(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>If(a))}else{const i=If(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],c=this.outputNames[i];this.feedOutputNames.push(c),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Si("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=yF(e.metrics,this.outputNames),o=(i,a,c)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([c,i])};Si("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(l=>{const d="";let h,f,p;for(const m of l){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===Vh?["accuracy","acc"].indexOf(m)!==-1?f=Y1:["crossentropy","ce"].indexOf(m)!==-1&&(f=UM):this.lossFunctions[i]===qu?["accuracy","acc"].indexOf(m)!==-1?f=GM:["crossentropy","ce"].indexOf(m)!==-1&&(f=eS):["accuracy","acc"].indexOf(m)!==-1?f=J1:["crossentropy","ce"].indexOf(m)!==-1&&(f=Z1);let y;["accuracy","acc"].indexOf(m)!==-1?y="acc":["crossentropy","ce"].indexOf(m)!==-1&&(y="ce"),p=f,h=d+y}else p=ZM(m),h=d+au(m);let g;Si(h,()=>{g=p}),o(i,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;kf(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const c=this.testFunction,l=this.testLoop(c,a,r,s.verbose,s.steps);return Rs(l)}finally{br(i[0],e),br(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),pF(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new H(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new H(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new H("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new jo;if(e instanceof Wn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new H(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)i.add(this.inputs[c],e[c])}else for(const c of this.inputs){const l=e[c.name];if(l==null)throw new H(`No value is provided for the model's input ${c.name}`);i.add(c,l)}const a=ac(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const t=Mi(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const c=i.indexOf(e[a]);if(c!==-1&&(t[a]=o[c],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new H(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ie(()=>{const r=this.checkNumSamples(e);if(s)throw new _t("Verbose predictLoop() is not implemented yet.");const o=$f(r,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ie(()=>{const l=o[a][0],d=o[a][1],h=tc(e,l,d),f=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)f.push({key:this.inputs[m],value:h[m]});else f.push({key:this.inputs[0],value:h});const p=new jo(f);return ac(this.outputs,p)}).forEach((l,d)=>i[d].push(l));return Rs(i.map(a=>Es(a,0)))})}predict(e,t={}){const s=iS(e);Sy(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return kf(r),this.predictLoop(s,r)}finally{br(s,e)}}predictOnBatch(e){Sy(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new ur("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===qu?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=vy(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=vy(t,this.feedOutputNames,o,!1,"target"),gF(e,t),xF(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new H(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[a,c]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){const d=sS(r,this.outputNames);l=[];for(let h=0;h<d.length;++h)l.push(await rS(c[h],null,d[h]))}return[a,c,l]}testLoop(e,t,s,r=0,o){return ie(()=>{const i=this.checkNumSamples(t,s,o,"steps"),a=[];if(r>0)throw new _t("Verbose mode is not implemented yet.");if(o!=null)throw new _t("steps mode in testLoop() is not implemented yet");{const c=$f(i,s),l=Vs(jr(0,i));for(let d=0;d<c.length;++d){const h=c[d][0],f=c[d][1],p=Ci(l,h,f-h),m=Rp(t,p),g=e(m);if(d===0)for(let x=0;x<g.length;++x)a.push(en(0));for(let x=0;x<g.length;++x){const y=g[x];a[x]=Te(a[x],X(f-h,y))}}for(let d=0;d<a.length;++d)a[d]=wt(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(iy(e,r)>1){const i=iy(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:s[g]});const f=new jo(h),p=ac(this.outputs,f,{training:!0});let m;for(let g=0;g<this.lossFunctions.length;++g){const x=this.lossFunctions[g];let y=x(r[g],p[g]);o[g]!=null&&(y=cF(y,o[g]));const b=Ln(y);t.push(b),g===0?m=y:m=Te(m,y)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=t[g];else{const y=this.metricsTensors[g][0],b=this.metricsTensors[g][1];x=Ln(y(r[b],p[b]))}eo(x),i.push(x)}return m=Ln(m),this.calculateLosses().forEach(g=>{m=Te(m,g)}),m},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,c)].concat(i)}}makeTestFunction(){this.testFunction=e=>ie(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let l=0;l<this.inputs.length;++l)i.push({key:this.inputs[l],value:r[l]});const a=new jo(i),c=ac(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const d=this.lossFunctions[l],h=Ln(d(o[l],c[l]));l===0?s=h:s=Te(s,h),t.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const d=this.metricsTensors[l][0],h=this.metricsTensors[l][1],f=Ln(d(o[h],c[h]));t.push(f)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,c,l,d,h,f;try{const p=s.batchSize==null?32:s.batchSize;kf(p);const g=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,p);r=g[0],o=g[1],f=g[2];let x=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)c=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new _t("validationData including sample weights is not supported yet."):new H(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const T=await this.standardizeUserData(c,l,null,null,!0,p);d=T[0],h=T[1],y=d.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const A=Math.floor(r[0].shape[0]*(1-s.validationSplit)),T=r[0].shape[0];d=tc(r,A,T),i=r,r=tc(r,0,A),h=tc(o,A,T),a=o,o=tc(o,0,A),y=d.concat(h)}else s.validationSteps!=null&&(x=!0);const b=r.concat(o).concat(f);this.checkTrainableWeightsConsistency();const w=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let S,C;x?(this.makeTestFunction(),S=this.testFunction,C=v.slice().concat(v.map(A=>"val_"+A))):(S=null,y=[],C=v.slice());const k=K1(s.callbacks,s.yieldEvery);return await this.fitLoop(w,b,v,p,s.epochs,s.verbose,k,S,y,s.shuffle,C,s.initialEpoch,null,null)}finally{this.isTraining=!1,br(r,e),br(o,t),br(i,e),br(a,t),br(d,c),br(h,l),f!=null&&Pt(f)}}async fitLoop(e,t,s,r,o,i,a,c,l,d,h,f,p,m){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),f==null&&(f=0);let g=!1;if(c!=null&&l!=null&&(g=!0),m!=null&&(g=!0,p==null))throw new H("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,r,p,"steps_per_epoch");let y;x!=null&&(y=jr(0,x)),i==null&&(i=1);const{callbackList:b,history:w}=X1(a,i,o,f,x,p,r,g,h);b.setModel(this),this.history=w,await b.onTrainBegin(),this.stopTraining_=!1;for(let v=f;v<o;++v){await b.onEpochBegin(v);const S={};if(p!=null)throw new _t("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new _t("batch shuffling is not implemneted yet");d&&W$(y);const C=Vs(y),k=$f(x,r);for(let I=0;I<k.length;++I){const A={};if(await b.onBatchBegin(I,A),ie(()=>{const T=k[I][0],E=k[I][1],$=Ci(C,T,E-T);A.batch=I,A.size=E-T;const D=Rp(t,$),M=e(D);for(let P=0;P<s.length;++P){const L=s[P],O=M[P];A[L]=O,eo(O)}if(I===k.length-1&&g){const P=this.testLoop(c,l,r);for(let L=0;L<s.length;++L){const O=s[L],F=P[L];eo(F),S["val_"+O]=F}}}),await b.onBatchEnd(I,A),q1(A),this.stopTraining_)break}C.dispose()}if(await b.onEpochEnd(v,S),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return dF(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),c=[];for(const l of a){const d=await l.data();c.push(d[0])}return Pt(a),br(s[0],e),br(s[1],t),Rs(c)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=fp().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-fp().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=go(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>go(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=go(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[go(au(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>go(au(e)));{const e={};for(const t in this.metrics)e[t]=go(au(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Yu(e.optimizer_config),s=ro(t);let r;if(typeof e.loss=="string")r=pi(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>pi(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=pi(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>pi(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=pi(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const l=H2(e);if(l.length===0)throw new H(`Cannot find any save handlers for URL '${e}'`);if(l.length>1)throw new H(`Found more than one (${l.length}) save handlers for URL '${e}'`);e=l[0]}if(e.save==null)throw new H("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Wx(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:bF,generatedBy:`TensorFlow.js tfjs-layers v${nS}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:d,specs:h}=await Wx(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=O2([s.data,d])}return this.userDefinedMetadata!=null&&(xy(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){xy(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ga.className="Model";Ie(ga);class aS extends ga{}aS.className="Functional";Ie(aS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function wF(n,e){if(e==null&&(e={}),typeof n=="string"){const t=q2(n,e);if(t.length===0)t.push($j(n,e));else if(t.length>1)throw new H(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return vF(n,void 0,e)}async function vF(n,e,t){if(t==null&&(t={}),n.load==null)throw new H("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=ro(Yu(r),e,i),c=s.trainingConfig;if(c!=null&&a.loadTrainingConfig(c),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new H("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:l,optimizerWeights:d}=SF(s.weightData,s.weightSpecs);a.loadWeights(l,o),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),Pt(l),Pt(d.map(h=>h.tensor))}return a}function SF(n,e){const t=D2(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class Ta extends ga{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Lh("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new H(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Ta||e instanceof ga;let s;if(t){if(s=e,s.outputs.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new H("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new H("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=vM({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new H(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=B1(this.outputs[0])}this.inboundNodes=[],new Wh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Mi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Qt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ga({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new ur("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new ur("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new ur("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new ur("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new H("Legacy serialization format not supported yet.");o=t}else R(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof Ta))throw new _t(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const c of o){const d=ro(c,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new H("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new H("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Ta.className="Sequential";Ie(Ta);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CF(n){return new Ta(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ps=class extends Ba{getConfig(){return{}}};class cS extends ps{apply(e,t=1){return oM(e,t)}}cS.className="elu";Ie(cS);class lS extends ps{apply(e){return Nv(e)}}lS.className="selu";Ie(lS);class uS extends ps{apply(e){return Gi(e)}}uS.className="relu";Ie(uS);class dS extends ps{apply(e){return ie(()=>Cc(6,Gi(e)))}}dS.className="relu6";Ie(dS);class hS extends ps{apply(e){return e}}hS.className="linear";Ie(hS);class fS extends ps{apply(e){return La(e)}}fS.className="sigmoid";Ie(fS);class pS extends ps{apply(e){return aM(e)}}pS.className="hardSigmoid";Ie(pS);class mS extends ps{apply(e){return El(e)}}mS.className="softplus";Ie(mS);class gS extends ps{apply(e){return iM(e)}}gS.className="softsign";Ie(gS);class xS extends ps{apply(e){return Ah(e)}}xS.className="tanh";Ie(xS);let x0=class extends ps{apply(e,t=-1){return bg(e,t)}};x0.className="softmax";Ie(x0);class yS extends ps{apply(e,t=-1){return mv(e,t)}}yS.className="logSoftmax";Ie(yS);class bS extends ps{apply(e){return ie(()=>ie(()=>{const t=Math.sqrt(2),s=X(.5,Te(1,uv(wt(e,t))));return X(e,s)}))}}bS.className="gelu";Ie(bS);class wS extends ps{apply(e){return ie(()=>X(.5,X(e,Te(1,Ah(X(hs(wt(2,Math.PI)),Te(e,X(.044715,ji(e,3)))))))))}}wS.className="gelu_new";Ie(wS);class vS extends ps{apply(e){return ie(()=>X(e,Ah(El(e))))}}vS.className="mish";Ie(vS);class SS extends ps{apply(e,t=1){return ie(()=>X(La(X(e,t)),e))}}SS.className="swish";Ie(SS);function Uo(n){return n.getClassName()}function Tf(n,e={}){return Ol(n,ir.getMap().classNameMap,e,"activation")}function Go(n){if(n==null){const e={};return e.className="linear",e.config={},Tf(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Tf(e)}else return n instanceof ps?n:Tf(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NF(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class CS extends Ba{}class NS extends CS{constructor(e){super(),NF(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ie(()=>{let t=Qn([1]);return this.hasL1&&(t=Te(t,bt(X(this.l1,ys(e))))),this.hasL2&&(t=Te(t,bt(X(this.l2,zl(e))))),Y(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}NS.className="L1L2";Ie(NS);const Cy={l1l2:"L1L2"};function dn(n){return s0(n)}function Ny(n,e={}){return Ol(n,ir.getMap().classNameMap,e,"regularizer")}function Cn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in Cy?Cy[n]:n,config:{}};return Ny(t)}else return n instanceof CS?n:Ny(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class IS extends zt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=At(e);let s=Gi(e);return this.maxValue!=null&&(s=Js(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}IS.className="ReLU";Ie(IS);class kS extends zt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=At(e);return sg(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}kS.className="LeakyReLU";Ie(kS);class $S extends zt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Sn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Cn(e.alphaRegularizer),this.alphaConstraint=Gn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new H(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Qt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Vn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=At(e),lg(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Tn(this.alphaInitializer),alphaRegularizer:dn(this.alphaRegularizer),alphaConstraint:Un(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}$S.className="PReLU";Ie($S);let TS=class extends zt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new _t(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=At(e);return Dh(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};TS.className="ELU";Ie(TS);class AS extends zt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=At(e);return X(s,Ze(Zs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}AS.className="ThresholdedReLU";Ie(AS);class RS extends zt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new x0().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ie(()=>{let s=At(e);const r=t.mask;if(r!=null){const o=X($t(ei(s.shape),Ze(r,s.dtype)),en(-1e9));s=Te(s,o)}return this.axis instanceof Array?this.axis.length>1?ao($t(s,gv(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}RS.className="Softmax";Ie(RS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xa(n,e,t){if(typeof n=="number")return Mi(n,e);if(n.length!==e)throw new H(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!tM(r))throw new H(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function Dr(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Xr(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Vo([t-e,0]);else if(s==="same")n=n*e;else throw new H(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function y0(n,e){return ie(()=>(Pn(e),e==="channelsFirst"?qt(n,[0,2,3,1]):n))}function ES(n,e){return ie(()=>(Pn(e),e==="channelsFirst"?qt(n,[0,2,3,4,1]):n))}function IF(n,e,t,s=1,r="valid",o,i=1){return ie(()=>{if(o==null&&(o=_r()),Pn(o),n.shape.length!==3)throw new H(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new H(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new H(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=qt(n,[0,2,1])),r==="causal")throw new _t("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=ov(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(a=Fr(a,t)),a})}function Iy(n,e,t,s=[1,1],r="valid",o,i,a=null){return ie(()=>{if(o==null&&(o=_r()),Pn(o),n.rank!==3&&n.rank!==4)throw new H(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new H(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=y0(n,o);if(r==="causal")throw new _t("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=ND({x:c,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(c=qt(c,[0,3,1,2])),c})}function kF(n,e,t,s=[1,1,1],r="valid",o,i){return ie(()=>{if(o==null&&(o=_r()),Pn(o),n.rank!==4&&n.rank!==5)throw new H(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new H(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=ES(n,o);if(r==="causal")throw new _t("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=CA(a,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(a=Fr(a,t)),o==="channelsFirst"&&(a=qt(a,[0,4,1,2,3])),a})}class Uh extends zt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Uh.verifyArgs(t),this.rank=e,Jn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new _t(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=xa(t.kernelSize,e,"kernelSize"),this.strides=xa(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,er(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Pn(this.dataFormat),this.activation=Go(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Sn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Gn(t.biasConstraint),this.biasRegularizer=Cn(t.biasRegularizer),this.activityRegularizer=Cn(t.activityRegularizer),this.dilationRate=xa(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new H(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new H(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new H(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Kr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!r0(e.kernelSize,"number",1,3))throw new H(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Uo(this.activation),useBias:this.useBias,biasInitializer:Tn(this.biasInitializer),biasRegularizer:dn(this.biasRegularizer),activityRegularizer:dn(this.activityRegularizer),biasConstraint:Un(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Va extends Uh{constructor(e,t){super(e,t),this.kernel=null,Va.verifyArgs(t),this.filters=t.filters,Jn(this.filters,"filters"),this.kernelInitializer=Sn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Gn(t.kernelConstraint),this.kernelRegularizer=Cn(t.kernelRegularizer)}build(e){e=Qt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ie(()=>{e=At(e);let s;const r=this.bias==null?null:this.bias.read(),o=$1(this.activation.getClassName());if(o!=null&&this.rank===2)s=Iy(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=IF(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Iy(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=kF(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new _t("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Qt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=Dr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Tn(this.kernelInitializer),kernelRegularizer:dn(this.kernelRegularizer),kernelConstraint:Un(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new H(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Ul extends Va{constructor(e){super(2,e),Ul.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!r0(e.kernelSize,"number",1,2))throw new H(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Ul.className="Conv2D";Ie(Ul);class Gl extends Va{constructor(e){super(3,e),Gl.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new H(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Gl.className="Conv3D";Ie(Gl);class DS extends Ul{constructor(e){if(super(e),this.inputSpec=[new Vn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qt(e),e.length!==4)throw new H("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ie(()=>{let s=At(e);if(s.shape.length!==4)throw new H(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const c=r[i],l=r[a],d=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],p=this.strides[1],m=Xr(c,f,d,this.padding),g=Xr(l,p,h,this.padding),x=[o,m,g,this.filters];this.dataFormat!=="channelsLast"&&(s=qt(s,[0,2,3,1]));let y=iv(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=qt(y,[0,3,1,2])),this.bias!=null&&(y=Fr(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Qt(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return t[s]=this.filters,t[r]=Xr(t[r],c,i,this.padding),t[o]=Xr(t[o],l,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}DS.className="Conv2DTranspose";Ie(DS);class jS extends Gl{constructor(e){if(super(e),this.inputSpec=[new Vn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qt(e),e.length!==5)throw new H("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ie(()=>{let s=At(e);if(s.shape.length!==5)throw new H(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,c;this.dataFormat==="channelsFirst"?(c=2,i=3,a=4):(c=1,i=2,a=3);const l=r[c],d=r[i],h=r[a],f=this.kernelSize[0],p=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],x=this.strides[1],y=this.strides[2],b=Xr(l,g,f,this.padding),w=Xr(d,x,p,this.padding),v=Xr(h,y,m,this.padding),S=[o,b,w,v,this.filters];this.dataFormat!=="channelsLast"&&(s=qt(s,[0,2,3,4,1]));let C=kA(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=qt(C,[0,4,1,2,3])),this.bias!==null&&(C=Fr(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=Qt(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],d=this.strides[0],h=this.strides[1],f=this.strides[2];return t[s]=this.filters,t[r]=Xr(t[r],d,a,this.padding),t[o]=Xr(t[o],h,c,this.padding),t[i]=Xr(t[i],f,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}jS.className="Conv3DTranspose";Ie(jS);class _S extends Va{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new H("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new H("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new H(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Sn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Cn(t.depthwiseRegularizer),this.depthwiseConstraint=Gn(t.depthwiseConstraint),this.pointwiseInitializer=Sn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Cn(t.pointwiseRegularizer),this.pointwiseConstraint=Gn(t.pointwiseConstraint)}build(e){if(e=Qt(e),e.length<this.rank+2)throw new H(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new H(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Vn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ie(()=>{e=At(e);let s;if(this.rank===1)throw new _t("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=qt(e,[0,2,3,1])),s=Iv(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Fr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=qt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Tn(this.depthwiseInitializer),e.pointwiseInitializer=Tn(this.pointwiseInitializer),e.depthwiseRegularizer=dn(this.depthwiseRegularizer),e.pointwiseRegularizer=dn(this.pointwiseRegularizer),e.depthwiseConstraint=Un(this.depthwiseConstraint),e.pointwiseConstraint=Un(this.pointwiseConstraint),e}}_S.className="SeparableConv";class PS extends _S{constructor(e){super(2,e)}}PS.className="SeparableConv2D";Ie(PS);class Gh extends Va{constructor(e){super(1,e),Gh.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!r0(e.kernelSize,"number",1,1))throw new H(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Gh.className="Conv1D";Ie(Gh);class MS extends zt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ie(()=>{if(e=At(e),this.dataFormat==="channelsLast"){const s=iu(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return iu(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=iu(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return iu(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}MS.className="Cropping2D";Ie(MS);class FS extends zt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,JP(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ie(()=>{let s=At(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=qt(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?yo.resizeNearestNeighbor(s,[o,i]):yo.resizeBilinear(s,[o,i]);return qt(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?yo.resizeNearestNeighbor(s,[o,i]):yo.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}FS.className="UpSampling2D";Ie(FS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $F(n,e,t=[1,1],s="valid",r,o){return ie(()=>{r==null&&(r=_r()),Pn(r);let i=y0(n,r);if(n.rank!==4)throw new H(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new H(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=Zm(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=qt(i,[0,3,1,2])),i})}class OS extends Uh{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Sn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Gn(e.depthwiseConstraint),this.depthwiseRegularizer=Cn(e.depthwiseRegularizer)}build(e){if(e=Qt(e),e.length<4)throw new H(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new H(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ie(()=>{e=At(e);let s=$F(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Fr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Qt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Dr(t,this.kernelSize[0],this.padding,this.strides[0]),i=Dr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Tn(this.depthwiseInitializer),e.depthwiseRegularizer=dn(this.depthwiseRegularizer),e.depthwiseConstraint=Un(this.depthwiseRegularizer),e}}OS.className="DepthwiseConv2D";Ie(OS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function LS(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new H("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function zS(n,e,t,s=!1,r,o,i=!1,a=!1){return ie(()=>{const c=e.shape.length;if(c<3)throw new H(`Input should be at least 3D, but is ${c}D.`);const l=[1,0].concat(jr(2,c));e=qt(e,l),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ze(Ze(r,"bool"),"float32"),r.rank===c-1&&(r=As(r,-1)),r=qt(r,l)),s&&(e=_i(e,0),r!=null&&(r=_i(r,0)));const d=[];let h,f=t;const p=e.shape[0],m=Pi(e);let g;r!=null&&(g=Pi(r));for(let y=0;y<p;++y){const b=m[y],w=ie(()=>n(b,f));if(r==null)h=w[0],f=w[1];else{const v=ie(()=>{const S=g[y],C=$t(fr(S),S),k=Te(X(w[0],S),X(f[0],C)),I=f.map((A,T)=>Te(X(w[1][T],S),X(A,C)));return{output:k,newStates:I}});h=v.output,f=v.newStates}a&&d.push(h)}let x;return a&&(x=wo(d,1)),[h,x,f]})}class ni extends zt{constructor(e){super(e);let t;if(e.cell==null)throw new H("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new v0({cells:e.cell}):t=e.cell,t.stateSize==null)throw new H("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Vn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return jr(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){kp(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return ie(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new _t("Constants support is not implemented in RNN yet.");kp(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Vn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!tn(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new H(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Vn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ie(()=>{if(!this.stateful)throw new qr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qn([s,r])):this.states_=[Qn([s,this.cell.stateSize])];else if(e==null)Pt(this.states_),this.keptStates!=null&&(Pt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Qn([s,r])):this.states_[0]=Qn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Pt(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!tn(o.shape,a))throw new H(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>eo(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=LS(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new Vn({shape:l.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof lo){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const f=super.apply(l,t);return this.inputSpec=h,f}else return super.apply(e,t)}call(e,t){return ie(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=At(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new H(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},l=zS((m,g)=>{const x=this.cell.call([m].concat(g),a);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=l[0],h=l[1],f=l[2];this.stateful&&this.resetStates(f,r);const p=this.returnSequences?h:d;return this.returnState?[p].concat(f):p})}getInitialState(e){return ie(()=>{let t=Qn(e.shape);return t=bt(t,[1,2]),t=Ll(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Np(t,[1,s]):t):this.cell.stateSize>1?[Np(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ni.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=ro(r,s);return new e(Object.assign(t,{cell:o}))}}ni.className="RNN";Ie(ni);class Hh extends zt{}class b0 extends Hh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Jn(this.units,"units"),this.activation=Go(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Sn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Cn(e.kernelRegularizer),this.recurrentRegularizer=Cn(e.recurrentRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.kernelConstraint=Gn(e.kernelConstraint),this.recurrentConstraint=Gn(e.recurrentConstraint),this.biasConstraint=Gn(e.biasConstraint),this.dropout=$a([1,Vo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=$a([1,Vo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ie(()=>{if(e=e,e.length!==2)throw new H(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ho({ones:()=>fr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ho({ones:()=>fr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=so(X(e,i),this.kernel.read()):o=so(e,this.kernel.read()),this.bias!=null&&(o=Fr(o,this.bias.read())),a!=null&&(s=X(s,a));let c=Te(o,so(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Uo(this.activation),useBias:this.useBias,kernelInitializer:Tn(this.kernelInitializer),recurrentInitializer:Tn(this.recurrentInitializer),biasInitializer:Tn(this.biasInitializer),kernelRegularizer:dn(this.kernelRegularizer),recurrentRegularizer:dn(this.recurrentRegularizer),biasRegularizer:dn(this.biasRegularizer),activityRegularizer:dn(this.activityRegularizer),kernelConstraint:Un(this.kernelConstraint),recurrentConstraint:Un(this.recurrentConstraint),biasConstraint:Un(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}b0.className="SimpleRNNCell";Ie(b0);class WS extends ni{constructor(e){e.cell=new b0(e),super(e)}call(e,t){return ie(()=>{this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}WS.className="SimpleRNN";Ie(WS);class w0 extends Hh{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new H("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Jn(this.units,"units"),this.activation=Go(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Go(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Sn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Cn(e.kernelRegularizer),this.recurrentRegularizer=Cn(e.recurrentRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.kernelConstraint=Gn(e.kernelConstraint),this.recurrentConstraint=Gn(e.recurrentConstraint),this.biasConstraint=Gn(e.biasConstraint),this.dropout=$a([1,Vo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=$a([1,Vo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ie(()=>{if(e=e,e.length!==2)throw new H(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ho({ones:()=>fr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ho({ones:()=>fr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,c,l;0<this.dropout&&this.dropout<1&&(e=X(e,o[0]));let d=so(e,this.kernel.read());this.useBias&&(d=Fr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=X(r,i[0]));const h=this.recurrentKernel.read(),[f,p]=Ys(h,[2*this.units,this.units],h.rank-1),m=so(r,f),[g,x,y]=Ys(d,3,d.rank-1),[b,w]=Ys(m,2,m.rank-1);a=this.recurrentActivation.apply(Te(g,b)),c=this.recurrentActivation.apply(Te(x,w));const v=so(X(c,r),p);l=this.activation.apply(Te(y,v));const S=Te(X(a,r),X(Te(1,Dn(a)),l));return[S,S]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Uo(this.activation),recurrentActivation:Uo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Tn(this.kernelInitializer),recurrentInitializer:Tn(this.recurrentInitializer),biasInitializer:Tn(this.biasInitializer),kernelRegularizer:dn(this.kernelRegularizer),recurrentRegularizer:dn(this.recurrentRegularizer),biasRegularizer:dn(this.biasRegularizer),activityRegularizer:dn(this.activityRegularizer),kernelConstraint:Un(this.kernelConstraint),recurrentConstraint:Un(this.recurrentConstraint),biasConstraint:Un(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}w0.className="GRUCell";Ie(w0);class BS extends ni{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new w0(e),super(e)}call(e,t){return ie(()=>{this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}BS.className="GRU";Ie(BS);class qh extends Hh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Jn(this.units,"units"),this.activation=Go(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Go(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Sn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Cn(e.kernelRegularizer),this.recurrentRegularizer=Cn(e.recurrentRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.kernelConstraint=Gn(e.kernelConstraint),this.recurrentConstraint=Gn(e.recurrentConstraint),this.biasConstraint=Gn(e.biasConstraint),this.dropout=$a([1,Vo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=$a([1,Vo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Qt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends mr{apply(c,l){const d=o.apply([i]),h=new i0().apply([i]),f=o.apply([i*2]);return cy(cy(d,h),f)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ie(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new H(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ho({ones:()=>fr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ho({ones:()=>fr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let c,l,d,h;0<this.dropout&&this.dropout<1&&(e=X(e,i[0]));let f=so(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=X(r,a[0])),f=Te(f,so(r,this.recurrentKernel.read())),this.useBias&&(f=Fr(f,this.bias.read()));const[p,m,g,x]=Ys(f,4,f.rank-1);c=this.recurrentActivation.apply(p),l=this.recurrentActivation.apply(m),d=Te(X(l,o),X(c,this.activation.apply(g))),h=this.recurrentActivation.apply(x);const y=X(h,this.activation.apply(d));return[y,y,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Uo(this.activation),recurrentActivation:Uo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Tn(this.kernelInitializer),recurrentInitializer:Tn(this.recurrentInitializer),biasInitializer:Tn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:dn(this.kernelRegularizer),recurrentRegularizer:dn(this.recurrentRegularizer),biasRegularizer:dn(this.biasRegularizer),activityRegularizer:dn(this.activityRegularizer),kernelConstraint:Un(this.kernelConstraint),recurrentConstraint:Un(this.recurrentConstraint),biasConstraint:Un(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}qh.className="LSTMCell";Ie(qh);class VS extends ni{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qh(e),super(e)}call(e,t){return ie(()=>{this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}VS.className="LSTM";Ie(VS);class v0 extends Hh{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ie(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const c=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=c.call(i,t),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){kp(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{Si(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(ro(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return $p(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}f0(t)}}v0.className="StackedRNNCells";Ie(v0);function Ho(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):_1(e(),t),a=()=>Wl(i,e,s);return!r||r<=1?eo(a().clone()):Array(r).fill(void 0).map(a).map(l=>eo(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var TF=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class US extends ni{constructor(e){if(e.unroll)throw new _t("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new _t("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Vn({ndim:5})]}call(e,t){return ie(()=>{if(this.cell.dropoutMask!=null&&(Pt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new H("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ie(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Qn(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){ie(()=>{if(!this.stateful)throw new qr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qn(o)):this.states_=[Qn(o)];else if(e==null)Pt(this.states_),this.keptStates!=null&&(Pt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Qn(o)):this.states_[0]=Qn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Pt(this.states_);for(let a=0;a<this.states_.length;++a){const c=e[a],l=o;if(!tn(c.shape,l))throw new H(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${c.shape}`);this.states_[a]=c}}this.states_=this.states_.map(a=>eo(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,c=t==="channelsFirst",l=e[c?3:2],d=e[c?4:3],h=Dr(l,r[0],o,i[0],a[0]),f=Dr(d,r[1],o,i[1],a[1]);return[...e.slice(0,2),...c?[s,h,f]:[h,f,s]]}}US.className="ConvRNN2D";class S0 extends qh{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Jn(this.filters,"filters"),this.kernelSize=xa(s,2,"kernelSize"),this.kernelSize.forEach(c=>Jn(c,"kernelSize")),this.strides=xa(r||1,2,"strides"),this.strides.forEach(c=>Jn(c,"strides")),this.padding=o||"valid",er(this.padding),this.dataFormat=i||"channelsLast",Pn(this.dataFormat),this.dilationRate=xa(a||1,2,"dilationRate"),this.dilationRate.forEach(c=>Jn(c,"dilationRate"))}build(e){var t;e=Qt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new H(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const l=this.biasInitializer,d=this.filters;c=new(t=class extends mr{apply(f,p){const m=l.apply([d]),g=ei([d]),x=l.apply([d*2]);return o0([m,g,x])}},t.className="CustomInit",t)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ie(()=>{if(e.length!==3)throw new H(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ho({ones:()=>fr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,l=(G,_,Z)=>!_||!_[Z]?G:X(_[Z],G);let d=l(r,c,0),h=l(r,c,1),f=l(r,c,2),p=l(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ho({ones:()=>fr(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let g=l(o,m,0),x=l(o,m,1),y=l(o,m,2),b=l(o,m,3);const w=3,[v,S,C,k]=Ys(this.kernel.read(),a,w),[I,A,T,E]=this.useBias?Ys(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,v,I,this.padding),h=this.inputConv(h,S,A,this.padding),f=this.inputConv(f,C,T,this.padding),p=this.inputConv(p,k,E,this.padding);const[$,D,M,P]=Ys(this.recurrentKernel.read(),a,w);g=this.recurrentConv(g,$),x=this.recurrentConv(x,D),y=this.recurrentConv(y,M),b=this.recurrentConv(b,P);const L=this.recurrentActivation.apply(Te(d,g)),O=this.recurrentActivation.apply(Te(h,x)),F=Te(X(O,i),X(L,this.activation.apply(Te(f,y)))),V=X(this.recurrentActivation.apply(Te(p,b)),this.activation.apply(F));return[V,V,F]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=TF(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=Di(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Fr(o,s,this.dataFormat):o}recurrentConv(e,t){return Di(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}S0.className="ConvLSTM2DCell";Ie(S0);class GS extends US{constructor(e){const t=new S0(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}GS.className="ConvLSTM2D";Ie(GS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Kh extends zt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Wl(()=>_1(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Kh.className="Dropout";Ie(Kh);class HS extends Kh{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}HS.className="SpatialDropout1D";Ie(HS);class C0 extends zt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Jn(this.units,"units"),this.activation=Go(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Sn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Sn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Gn(e.kernelConstraint),this.biasConstraint=Gn(e.biasConstraint),this.kernelRegularizer=Cn(e.kernelRegularizer),this.biasRegularizer=Cn(e.biasRegularizer),this.activityRegularizer=Cn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Qt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Qt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e),r=$1(this.activation.getClassName());let o;return r!=null?o=so(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=so(s,this.kernel.read()),this.bias!=null&&(o=Fr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:Uo(this.activation),useBias:this.useBias,kernelInitializer:Tn(this.kernelInitializer),biasInitializer:Tn(this.biasInitializer),kernelRegularizer:dn(this.kernelRegularizer),biasRegularizer:dn(this.biasRegularizer),activityRegularizer:dn(this.activityRegularizer),kernelConstraint:Un(this.kernelConstraint),biasConstraint:Un(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}C0.className="Dense";Ie(C0);class qS extends zt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Qt(e);for(const t of e.slice(1))if(t==null)throw new H(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Lo(e,1)]}call(e,t){return ie(()=>{this.invokeCallHook(e,t);let s=At(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=qt(s,r)}return rM(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}qS.className="Flatten";Ie(qS);class KS extends zt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Go(e.activation)}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e);return this.activation.apply(s)})}getConfig(){const e={activation:Uo(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}KS.className="Activation";Ie(KS);class XS extends zt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ie(()=>(e=At(e),nM(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}XS.className="RepeatVector";Ie(XS);class QS extends zt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let c=0;c<r.length;++c){const l=r[c];if(this.isUnknown(l))if(i===null)i=c;else throw new H("Can only specifiy one unknown dimension.");else o*=l}const a=Lo(e);if(i!==null){if(o===0||a%o!==0)throw new H(s);r[i]=a/o}else if(a!==o)throw new H(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return Y(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}QS.className="Reshape";Ie(QS);class YS extends zt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=jr(1,e.dims.length+1);if(!tn(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Vn({ndim:this.dims.length+1})]}computeOutputShape(e){e=Qt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return qt(At(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}YS.className="Permute";Ie(YS);class JS extends zt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=At(e);return xp(Lu(s,this.maskValue),-1)}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e),i=xp(Lu(s,this.maskValue),-1,!0);return X(s,Ze(i,s.dtype))})}}JS.className="Masking";Ie(JS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ZS extends zt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(an(e.inputLength))}this.inputDim=e.inputDim,Jn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Jn(this.outputDim,"outputDim"),this.embeddingsInitializer=Sn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Cn(e.embeddingsRegularizer),this.activityRegularizer=Cn(e.activityRegularizer),this.embeddingsConstraint=Gn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ie(()=>this.maskZero?(e=At(e),Lu(e,Kt(e))):null)}computeOutputShape(e){if(e=Qt(e),this.inputLength==null)return[...e,this.outputDim];const t=an(this.inputLength);if(t.length!==e.length-1)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ie(()=>{this.invokeCallHook(e,t);let s=At(e);s.dtype!=="int32"&&(s=no(s,"int32"));const r=j1(this.embeddings.read(),Y(s,[s.size]));return Y(r,Qt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Tn(this.embeddingsInitializer),embeddingsRegularizer:dn(this.embeddingsRegularizer),activityRegularizer:dn(this.activityRegularizer),embeddingsConstraint:Un(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}ZS.className="Embedding";Ie(ZS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ki extends zt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new _t}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new H("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Qt(e)]),e=e,e.length<2)throw new H(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=Oo(t),t.length>1)throw new H(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&Oo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ie(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Vo(r);for(let i of e){const a=i.rank;for(let c=0;c<o-a;++c)i=Ll(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const c of e){const l=c.rank;if(l==null){const d=c.shape,h=d[0],f=d.slice(1).concat([h]);let p=Y(c,[h].concat(Lo(d.slice(1))));p=qt(p,[1,0]),p=Y(p,f),s.push(p),o=!0}else if(l>1){const d=jr(1,l).concat([0]);s.push(qt(c,d)),o=!0}else s.push(c)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const c=i.shape,l=c.length,d=c[l-1],h=[d].concat(c.slice(0,c.length-1));i=Y(qt(Y(i,[-1,d]),[1,0]),h)}else if(a>1){const c=[a-1].concat(jr(0,a-1));i=qt(i,c)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Oo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ie(()=>{if(t==null)return null;if(!Array.isArray(t))throw new H("`mask` should be an Array");if(!Array.isArray(e))throw new H("`inputs` should be an Array");if(t.length!==e.length)throw new H(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:As(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=bo(s,t[r]);return s})}}class eC extends Ki{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Te(t,e[s]);return t})}}eC.className="Add";Ie(eC);class tC extends Ki{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=X(t,e[s]);return t})}}tC.className="Multiply";Ie(tC);class nC extends Ki{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Te(t,e[s]);return X(1/e.length,t)})}}nC.className="Average";Ie(nC);class sC extends Ki{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Zo(t,e[s]);return t})}}sC.className="Maximum";Ie(sC);class rC extends Ki{constructor(e){super(e)}mergeFunction(e){return ie(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Cc(t,e[s]);return t})}}rC.className="Minimum";Ie(rC);class oC extends Ki{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new H("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(tn(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new H("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ie(()=>o0(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new H("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new H("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new H("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new H(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ie(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(Ze(fr(e[i]),"bool")):t[i].rank<e[i].rank?r.push(As(t[i],-1)):r.push(t[i]);const o=Es(r,this.axis);return rv(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}oC.className="Concatenate";Ie(oC);function nc(n,e){for(;n<0;)n+=e;return n}function AF(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new _t("batchDot is not implemented for tensors of 4D or higher rank yet");if(R(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),R(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new _t("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return ie(()=>{let i;if(s>r){i=s-r;const c=[];for(let l=0;l<i;++l)c.push(1);e=Y(e,e.shape.concat(c))}else if(r>s){i=r-s;const c=[];for(let l=0;l<i;++l)c.push(1);n=Y(n,n.shape.concat(c))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=bt(X(n,e),o[0]):a=bt(X(qt(n,[1,0]),e),o[1]);else{const c=o[0]!==n.shape.length-1,l=o[1]===e.shape.length-1;a=Zt(n,e,c,l)}if(i>0){let c;s>r?c=s+r-3:c=s-1;const l=[];for(let d=c;d<c+i;++d)l.push(d);a=jl(a,l)}return a.shape.length===1&&(a=As(a,1)),a})}class iC extends Ki{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new _t("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new H(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new H(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>nc(o,e[i].shape.length)):r=[nc(this.axes,t.shape.length),nc(this.axes,s.shape.length)],this.normalize&&(t=Hu(t,r[0]),s=Hu(s,r[1])),AF(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[nc(this.axes,e.length),nc(this.axes,t.length)],s}computeOutputShape(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new _t("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}iC.className="Dot";Ie(iC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class aC extends zt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e);return Wl(()=>Te(zh(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}aC.className="GaussianNoise";Ie(aC);class cC extends zt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ie(()=>{this.invokeCallHook(e,t);const s=At(e);return this.rate>0&&this.rate<1?Wl(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return X(s,zh(s.shape,1,o))},()=>s,t.training||!1):s})}}cC.className="GaussianDropout";Ie(cC);class lC extends zt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||At(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ie(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Wl(()=>{const o=At(e),a=-1.6732632423543772*1.0507009873554805;let c=Vi(Dl(s),this.rate);c=no(c,"float32");const l=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-l*a*this.rate,h=Te(X(o,c),X(Te(c,-1),a));return Te(X(h,l),d)},()=>At(e),t.training||!1)}return e})}}lC.className="AlphaDropout";Ie(lC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $c(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=ZT(n,e,t,s,r,o);else if(n.rank===3)i=tA(n,e,t,s,r,o);else if(n.rank===4)i=sA(n,e,t,s,r,o);else throw new _t(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function RF(n,e,t,s,r=.001){return ie(()=>{const o=ig(n,s),i=o.mean,a=o.variance;return[$c(n,i,a,t,e,r),i,a]})}function EF(n,e,t,s,r=.001){return ie(()=>{const o=ig(n,s),i=o.mean,a=o.variance,c=[];for(const m of jr(0,n.rank))s.indexOf(m)!==-1?c.push(1):c.push(n.shape[m]);const l=Y(i,c),d=Y(a,c),h=e==null?null:Y(e,c),f=t==null?null:Y(t,c);return[$c(n,l,d,f,h,r),i,a]})}function DF(n,e,t,s,r=.001){return tn(s.slice().sort(),jr(0,n.rank-1))?RF(n,e,t,s,r):EF(n,e,t,s,r)}class uC extends zt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Sn(e.betaInitializer||"zeros"),this.gammaInitializer=Sn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Sn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Sn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Gn(e.betaConstraint),this.gammaConstraint=Gn(e.gammaConstraint),this.betaRegularizer=Cn(e.betaRegularizer),this.gammaRegularizer=Cn(e.gammaRegularizer)}build(e){e=Qt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new H(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Vn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ie(()=>{const s=t.training==null?!1:t.training,r=At(e),o=r.shape,i=o.length,a=jr(0,i),c=this.axis>=0?this.axis:this.axis+i;a.splice(c,1);const l=Mi(1,i);l[c]=o[c];const d=a.slice();d.sort();const h=!tn(d,jr(0,i).slice(0,i-1)),f=()=>{if(h){const b=Y(this.movingMean.read(),l),w=Y(this.movingVariance.read(),l),v=this.center?Y(this.beta.read(),l):null,S=this.scale?Y(this.gamma.read(),l):null;return $c(r,b,w,v,S,this.epsilon)}else return $c(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[p,m,g]=DF(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(b,w,v)=>{ie(()=>{const S=1-v,C=b.read(),k=X($t(C,w),S);b.write($t(C,k))})};return(()=>{x(this.movingMean,m,this.momentum),x(this.movingVariance,g,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Tn(this.betaInitializer),gammaInitializer:Tn(this.gammaInitializer),movingMeanInitializer:Tn(this.movingMeanInitializer),movingVarianceInitializer:Tn(this.movingVarianceInitializer),betaRegularizer:dn(this.betaRegularizer),gammaRegularizer:dn(this.gammaRegularizer),betaConstraint:Un(this.betaConstraint),gammaConstraint:Un(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}uC.className="BatchNormalization";Ie(uC);class dC extends zt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Sn(e.betaInitializer||"zeros"),this.gammaInitializer=Sn(e.gammaInitializer||"ones"),this.betaRegularizer=Cn(e.betaRegularizer),this.gammaRegularizer=Cn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Qt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==Oo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=At(e),r=s.shape,o=r.length;return ie(()=>{let{mean:a,variance:c}=ig(s,this.axis,!0);const l=Mi(1,o);for(const g of this.axis)l[g]=r[g];const d=g=>g!=null&&g.shape.length!==o?Y(g,l):g;let h=this.scale?d(this.gamma.read()):null,f=this.center?d(this.beta.read()):null;const p=[],m=[];for(let g=0;g<o;++g)this.axis.indexOf(g)!==-1?(p.push(r[g]),m.push(1)):(p.push(1),m.push(r[g]));return a=Tr(a,p),c=Tr(c,p),h!=null&&(h=Tr(h,m)),f!=null&&(f=Tr(f,m)),$c(s,a,c,f,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Tn(this.betaInitializer),gammaInitializer:Tn(this.gammaInitializer),betaRegularizer:dn(this.betaRegularizer),gammaRegularizer:dn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}dC.className="LayerNormalization";Ie(dC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jF(n,e,t){return ie(()=>{if(n.rank!==4)throw new H(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new H("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=_r()),t!=="channelsLast"&&t!=="channelsFirst")throw new H(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],ag(n,s)})}class hC extends zt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?_r():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new H(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new H(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new H(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Vn({ndim:4})]}computeOutputShape(e){e=Qt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ie(()=>jF(At(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}hC.className="ZeroPadding2D";Ie(hC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xh(n,e,t,s,r,o){return ie(()=>{Pn(r),A1(o),er(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=_r()),o==null&&(o="max"),n=y0(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=og(n,e,t,a):i=Xm(n,e,t,a),r==="channelsFirst"&&(i=qt(i,[0,3,1,2])),i})}function fC(n,e,t,s,r,o){return ie(()=>{Pn(r),A1(o),er(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=_r()),o==null&&(o="max"),n=ES(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=WR(n,e,t,a):i=VT(n,e,t,a),r==="channelsFirst"&&(i=qt(i,[0,4,1,2,3])),i})}class pC extends zt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new H(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Jn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new H(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Jn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,er(this.padding),this.inputSpec=[new Vn({ndim:3})]}computeOutputShape(e){e=Qt(e);const t=Dr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ie(()=>{this.invokeCallHook(e,t),e=Ll(At(e),2);const s=this.poolingFunction(At(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return jl(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class mC extends pC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Pn(o),er(r),Xh(e,t,s,r,o,"max")}}mC.className="MaxPooling1D";Ie(mC);class gC extends pC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Pn(o),er(r),Xh(e,t,s,r,o,"avg")}}gC.className="AveragePooling1D";Ie(gC);class xC extends zt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new H(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Jn(this.poolSize,"poolSize"),Jn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pn(this.dataFormat),er(this.padding),this.inputSpec=[new Vn({ndim:4})]}computeOutputShape(e){e=Qt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=Dr(t,this.poolSize[0],this.padding,this.strides[0]),s=Dr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ie(()=>(this.invokeCallHook(e,t),this.poolingFunction(At(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class yC extends xC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Pn(o),er(r),Xh(e,t,s,r,o,"max")}}yC.className="MaxPooling2D";Ie(yC);class bC extends xC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Pn(o),er(r),Xh(e,t,s,r,o,"avg")}}bC.className="AveragePooling2D";Ie(bC);class wC extends zt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new H(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Jn(this.poolSize,"poolSize"),Jn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pn(this.dataFormat),er(this.padding),this.inputSpec=[new Vn({ndim:5})]}computeOutputShape(e){e=Qt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=Dr(t,this.poolSize[0],this.padding,this.strides[0]),s=Dr(s,this.poolSize[1],this.padding,this.strides[1]),r=Dr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ie(()=>(this.invokeCallHook(e,t),this.poolingFunction(At(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class vC extends wC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Pn(o),er(r),fC(e,t,s,r,o,"max")}}vC.className="MaxPooling3D";Ie(vC);class SC extends wC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Pn(o),er(r),fC(e,t,s,r,o,"avg")}}SC.className="AveragePooling3D";Ie(SC);class CC extends zt{constructor(e){super(e),this.inputSpec=[new Vn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new _t}}class NC extends CC{constructor(e){super(e||{})}call(e,t){return ie(()=>{const s=At(e);return Ln(s,1)})}}NC.className="GlobalAveragePooling1D";Ie(NC);class IC extends CC{constructor(e){super(e||{})}call(e,t){return ie(()=>{const s=At(e);return Er(s,1)})}}IC.className="GlobalMaxPooling1D";Ie(IC);class kC extends zt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pn(this.dataFormat),this.inputSpec=[new Vn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new _t}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class $C extends kC{call(e,t){return ie(()=>{const s=At(e);return this.dataFormat==="channelsLast"?Ln(s,[1,2]):Ln(s,[2,3])})}}$C.className="GlobalAveragePooling2D";Ie($C);class TC extends kC{call(e,t){return ie(()=>{const s=At(e);return this.dataFormat==="channelsLast"?Er(s,[1,2]):Er(s,[2,3])})}}TC.className="GlobalMaxPooling2D";Ie(TC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AC extends zt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=ro(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class RC extends AC{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Qt(e),e.length<3)throw new H(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Qt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ie(()=>(e=At(e),zS((i,a)=>[At(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}RC.className="TimeDistributed";Ie(RC);function _F(n){qi(YP,"BidirectionalMergeMode",n)}const PF="concat";class EC extends AC{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=ro(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=ro(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?PF:e.mergeMode,_F(this.mergeMode),e.weights)throw new _t("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Rs(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=LS(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new H("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(h=>new Vn({shape:h.shape}));this.forwardLayer.stateSpec=d.slice(0,l/2),this.backwardLayer.stateSpec=d.slice(l/2),a.push(...d)}if(r!=null)throw new _t("Support for constants in Bidirectional layers is not implemented yet.");const c=i[0]instanceof lo;for(const l of i)if(l instanceof lo!==c)throw new H("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const f=super.apply(l,t);return this.inputSpec=h,f}else return super.apply(e,t)}call(e,t){return ie(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const c=s.slice(0,s.length/2),l=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:c})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:l}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=_i(o,1));let a;return this.mergeMode==="concat"?a=o0([r,o]):this.mergeMode==="sum"?a=Te(r,o):this.mergeMode==="ave"?a=X(.5,Te(r,o)):this.mergeMode==="mul"?a=X(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Si(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Si(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=ro(t.layer);if(delete t.layer,t.numConstants!=null)throw new _t("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}EC.className="Bidirectional";Ie(EC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class DC extends zt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ie(()=>(e=At(e),e.dtype!=="float32"&&(e=no(e,"float32")),Te(X(e,this.scale),this.offset)))}}DC.className="Rescaling";Ie(DC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:MF,cropAndResize:FF}=yo;class jC extends zt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,i,a,c){return ie(()=>{let l,d=!1;const h=t/i,f=s/a,p=(r+t)/i,m=(o+s)/a,g=[h,f,p,m],x=[];e.rank===3?(d=!0,l=wo([e])):l=e;for(let S=0;S<l.shape[0];S++)x.push(g);const y=fa(x,[x.length,4]),b=Nc(0,x.length,1,"int32"),v=FF(l,y,b,[r,o],"nearest");return no(d?At(Pi(v)):v,c)})}upsize(e,t,s,r){return ie(()=>{const o=MF(e,[t,s]);return no(o,r)})}call(e,t){return ie(()=>{const s=At(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let c=0;i!==this.height&&(c=Math.floor((i-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),c>=0&&l>=0?this.centerCrop(s,c,l,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Qt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}jC.className="CenterCrop";Ie(jC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function OF(n,e,t,s){let r=At(n);if(r.dtype!=="int32"&&(r=no(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=As(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=As(r,-1)),r.rank>2)throw new H(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let c;if(typeof s<"u"&&e==="count"?c=Gx(a,s,t,i):c=Gx(a,[],t,i),e!=="tfIdf")return c;if(s)return X(c,s);throw new H("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _C extends zt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Qt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ie(()=>{e=At(e),e.dtype!=="int32"&&(e=no(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new H(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=At(t.countWeights)}const r=Er(e),o=Fu(e),i=Zs(this.numTokens,r).bufferSync().get(0),a=Vi(o,0).bufferSync().get(0);if(!(i&&a))throw new H(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return OF(e,this.outputMode,this.numTokens,s)})}}_C.className="CategoryEncoding";Ie(_C);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const LF=["bilinear","nearest"],ky=new Set(LF);class PC extends zt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(ky.has(e.interpolation))this.interpolation=e.interpolation;else throw new H(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Qt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ie(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return yo.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return yo.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...ky]} are supported`)})}}PC.className="Resizing";Ie(PC);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class MC{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}MC.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FC extends zt{constructor(e){super(e),this.randomGenerator=new MC(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}FC.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zF=["bilinear","nearest"],$y=new Set(zF);class OC extends FC{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new H(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new H(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new H(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if($y.has(s))this.interpolation=s;else throw new H(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Qt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ie(()=>{const s=At(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Dl([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return yo.resizeBilinear(e,i);case"nearest":return yo.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...$y]} are supported`)}})}}OC.className="RandomWidth";Ie(OC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Af(n){return new C0(n)}function WF(n){return new Kh(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BF=ce();BF.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Ty;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ty||(Ty={}));var Ay;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(Ay||(Ay={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Ry;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Ry||(Ry={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ct(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&R(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VF=jv;class Qh extends Yp{nextDataId(){return Qh.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new ew(this,Ur())}write(e,t,s){this.firstUse&&(this.firstUse=!1,ce().get("IS_NODE")&&Xs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&_c(s[0])){const o=s.map(i=>Fo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return vo(r,o)}return q$(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Bo(r));return Ot(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ot(e.shape,e.dtype,t)}makeOutput(e,t,s){return Ur().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Ts();return e(),{kernelMs:Ts()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ct([e],"where");const t=this.readSync(e.dataId);return VF(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Qh.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LC(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const UF=n=>{const{x:e}=n.inputs,t=n.backend;ct(e,"abs");let s=new Float32Array(fe(e.shape));const r=t.data.get(e.dataId).values;return s=LC(r),t.makeOutput(s,e.shape,e.dtype)},GF={kernelName:kd,backendName:"cpu",kernelFunc:UF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mn(n){return(e,t,s,r,o)=>{const i=Dt(e,t),a=i.length,c=xt(i),l=fe(i),d=us(o,l),h=e.length,f=t.length,p=xt(e),m=xt(t),g=Ia(e,i),x=Ia(t,i);if(g.length+x.length===0)for(let y=0;y<d.length;++y)d[y]=n(s[y%s.length],r[y%r.length]);else for(let y=0;y<d.length;++y){const b=Fa(y,a,c),w=b.slice(-h);g.forEach(k=>w[k]=0);const v=Zr(w,h,p),S=b.slice(-f);x.forEach(k=>S[k]=0);const C=Zr(S,f,m);d[y]=n(s[v],r[C])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ws(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),c=t.data.get(a.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},a}const HF={kernelName:um,backendName:"cpu",kernelFunc:Ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(n,e,t="float32"){if(t==="complex64"){const r=Ju(n,e,"float32"),o=Ju(n,e,"float32");return Ws({inputs:{real:r,imag:o},backend:n})}const s=ds(fe(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uo(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const qF={kernelName:tl,backendName:"cpu",kernelFunc:uo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fi(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const KF={kernelName:_m,backendName:"cpu",kernelFunc:Fi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zC(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=Bi([0],t),[o,i]=Mn((a,c)=>a!==c?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function qo(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return uo({inputs:{x:r},backend:t});const d=Ju(t,r.shape,r.dtype),h=qo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),f=Ws({inputs:{real:h,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),f}if(r.dtype==="complex64"){const d=Fi({inputs:{input:r},backend:t}),h=qo({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),h}if(!sw(r.dtype,o)){const d=uo({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[a,c,l]=zC(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}const XF={kernelName:Bc,backendName:"cpu",kernelFunc:qo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;ct([i,a],n);const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=i.dtype==="string"?So(l):l,f=i.dtype==="string"?So(d):d,p=s||i.dtype,[m,g]=e(i.shape,a.shape,h,f,p);return c.makeTensorInfo(g,p,m)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const l=qo({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(l.dataId),h=d.complexTensorInfos.real,f=d.complexTensorInfos.imag,p=c.data.get(h.dataId).values,m=c.data.get(f.dataId).values,g=qo({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),x=c.data.get(g.dataId),y=x.complexTensorInfos.real,b=x.complexTensorInfos.imag,w=c.data.get(y.dataId).values,v=c.data.get(b.dataId).values,[S,C,k]=t(i.shape,a.shape,p,m,w,v),I=c.makeTensorInfo(k,"float32",S),A=c.makeTensorInfo(k,"float32",C),T=Ws({inputs:{real:I,imag:A},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(I),c.disposeIntermediateTensorInfo(A),T}else{const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=s||i.dtype,[f,p]=e(i.shape,a.shape,l,d,h);return c.makeTensorInfo(p,h,f)}}}function N0(n){return(e,t,s,r,o,i)=>{const a=Dt(e,t),c=fe(a),l=a.length,d=xt(a),h=us("float32",c),f=us("float32",c),p=Ia(e,a),m=Ia(t,a),g=vo(s,r),x=vo(o,i),y=e.length,b=xt(e),w=t.length,v=xt(t);if(p.length+m.length===0)for(let S=0;S<h.length;S++){const C=S%g.length,k=S%x.length,I=n(g[C*2],g[C*2+1],x[k*2],x[k*2+1]);h[S]=I.real,f[S]=I.imag}else for(let S=0;S<h.length;S++){const C=Fa(S,l,d),k=C.slice(-y);p.forEach($=>k[$]=0);const I=Zr(k,y,b),A=C.slice(-w);m.forEach($=>A[$]=0);const T=Zr(A,w,v),E=n(g[I*2],g[I*2+1],x[T*2],x[T*2+1]);h[S]=E.real,f[S]=E.imag}return[h,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WC=Mn((n,e)=>n+e),QF=N0((n,e,t,s)=>({real:n+t,imag:e+s})),Aa=qn(Oa,WC,QF),YF={kernelName:Oa,backendName:"cpu",kernelFunc:Aa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I0(n,e,t,s,r){const o=fe(s),i=ds(r,t);for(let a=0;a<n.length;a++){const c=n[a];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(o>0?i[c]+=e[a]:i[c]+=1)}return i}function BC(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=Ot([r,t],e.dtype);for(let a=0;a<r;a++)for(let c=0;c<o;c++){const l=n.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(s?i.set(1,a,l):e.size>0?i.set(i.get(a,l)+e.get(a,c),a,l):i.set(i.get(a,l)+1,a,l))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VC=Mn((n,e)=>n&e),JF=qn(lm,VC),ZF={kernelName:lm,backendName:"cpu",kernelFunc:JF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ho(n){return(e,t,s)=>{const r=En(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cn(n,e,t){const s=ho(e);return si(n,s,t)}function si(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;ct(i,n);const a=o,c=a.data.get(i.dataId).values;let l;if(i.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=So(c)}else l=c;const d=t||i.dtype,h=e(l,d,r);return a.makeTensorInfo(i.shape,d,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC=ho(n=>Math.ceil(n)),eO=si(Vc,UC),tO={kernelName:Vc,backendName:"cpu",kernelFunc:eO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GC(n,e,t,s){const r=En(t,fe(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const a=fe(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?So(i.vals):i.vals;let c=0;for(let l=0;l<i.shape[0];++l){const d=l*e[1]+o;for(let h=0;h<i.shape[1];++h)r[d+h]=a[c++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HC=Mn((n,e)=>n===e?1:0),qC=qn(Wd,HC,null,"bool"),nO={kernelName:Wd,backendName:"cpu",kernelFunc:qC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KC=ho(n=>Math.exp(n)),XC=si(Qc,KC,"float32"),sO={kernelName:Qc,backendName:"cpu",kernelFunc:XC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QC=ho(n=>Math.expm1(n)),rO=si(Yc,QC),oO={kernelName:Yc,backendName:"cpu",kernelFunc:rO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YC=ho(n=>Math.floor(n)),iO=si(Jc,YC),aO={kernelName:Jc,backendName:"cpu",kernelFunc:iO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JC=Mn((n,e)=>Math.floor(n/e)),cO=qn(Zc,JC,null,"int32"),lO={kernelName:Zc,backendName:"cpu",kernelFunc:cO};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZC(n,e,t,s,r,o,i,a,c){const l=Ot([s,o],t);for(let d=0;d<s;d++){const h=[];let f=0;for(let p=0;p<r;p++){const m=n[d*r+p];f+=m*i[p],h.push(m)}if(f<0||f>=c/o)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<o;p++)l.values[d*o+p]=e.get(...e.indexToLoc(f*o+p))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eN(n,e,t){const s=Ot(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],c=i[2],l=e.locToIndex([a,c]);i[2]=e.values[l];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tN=Mn((n,e)=>n>e?1:0),uO=qn(Gd,tN,null,"bool"),dO={kernelName:Gd,backendName:"cpu",kernelFunc:uO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nN=Mn((n,e)=>n>=e?1:0),hO=qn(el,nN,null,"bool"),fO={kernelName:el,backendName:"cpu",kernelFunc:hO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sN=Mn((n,e)=>n<e?1:0),pO=qn(qd,sN,null,"bool"),mO={kernelName:qd,backendName:"cpu",kernelFunc:pO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rN=Mn((n,e)=>n<=e?1:0),gO=qn(Kd,rN,null,"bool"),xO={kernelName:Kd,backendName:"cpu",kernelFunc:gO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oN(n,e,t){const s=(e-n)/(t-1),r=ds(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iN=ho(n=>Math.log(n)),yO=si(ol,iN),bO={kernelName:ol,backendName:"cpu",kernelFunc:yO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aN(n,e,t,s){const r=us(s,fe(t));for(let o=0;o<r.length;++o){const i=o*e;let a=n[i];for(let c=0;c<e;++c){const l=n[i+c];(Number.isNaN(l)||l>a)&&(a=l)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cN=Mn((n,e)=>Math.max(n,e)),wO=qn(al,cN),vO={kernelName:al,backendName:"cpu",kernelFunc:wO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lN=Mn((n,e)=>Math.min(n,e)),SO=qn(cl,lN),CO={kernelName:cl,backendName:"cpu",kernelFunc:SO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k0=Mn((n,e)=>n*e),NO=N0((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),Yh=qn(ul,k0,NO),IO={kernelName:ul,backendName:"cpu",kernelFunc:Yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uN(n,e,t){const s=Xo(-1,t);return k0([],e,s,n,t)}function kO(n){const{inputs:e,backend:t}=n,{x:s}=e;ct(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=uN(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const $O={kernelName:oh,backendName:"cpu",kernelFunc:kO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dN=Mn((n,e)=>n!==e?1:0),TO=qn(ih,dN,null,"bool"),AO={kernelName:ih,backendName:"cpu",kernelFunc:TO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $0(n,e,t,s,r){const o=e.length,i=fe(e),a=xt(e),c=xt(r),l=us(t,fe(r));for(let d=0;d<i;++d){const h=Fa(d,o,a),f=new Array(h.length);for(let m=0;m<f.length;m++)f[m]=h[s[m]];const p=Zr(f,o,c);l[p]=n[d]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function js(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;ct(r,"transpose");const i=r.shape.length,a=new Array(i);for(let h=0;h<a.length;h++)a[h]=r.shape[o[h]];const c=s.data.get(r.dataId).values,l=$0(c,r.shape,r.dtype,o,a);return{dataId:s.write(l,a,r.dtype),shape:a,dtype:r.dtype}}const RO={kernelName:ha,backendName:"cpu",kernelFunc:js};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hN(n,e,t,s){const[r,o]=Zn(n,s),i=Us(e,"int32"),a=ds(fe(r),i),c=fe(o);for(let l=0;l<a.length;++l){const d=l*c;let h=1;for(let f=0;f<c;++f)h*=t[d+f];a[l]=h}return{outVals:a,outShape:r,outDtype:i}}function EO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"prod");const a=r.shape.length,c=Lt(o,r.shape),l=An(c,a);let d=c,h=r;const f=[];l!=null&&(h=js({inputs:{x:r},backend:t,attrs:{perm:l}}),f.push(h),d=_n(d.length,a));const p=t.data.get(h.dataId).values,{outVals:m,outShape:g,outDtype:x}=hN(h.shape,h.dtype,p,d);let y=g;return i&&(y=zn(g,c)),f.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(y,x,m)}const DO={kernelName:hh,backendName:"cpu",kernelFunc:EO};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jO(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=Fa(r,e.length,xt(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function _O(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function PO(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);_O(t,s);let c=1;for(let l=0;l<e.length-1;++l){c*=e[l];const d=e[l+1];for(let h=1;h<c+1;++h)a[l].push(h*d)}for(let l=0;l<n.length;++l){let d=n[l],h=n[l]+1;for(let f=0;f<t.length;++f){const p=t[f],m=f+e.length-1;if(m>=0){const g=a[m],x=g[g.length-1]-p[d];for(let y=d;y<h;++y)a[m].push(p[y+1]+x)}d=p[d],h=p[h]}h!==d&&(r.push([d,h]),o+=h-d)}return{outSplits:a,valueSlices:r,numValues:o}}function MO(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=En("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function Ey(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function FO(n,e,t,s,r,o){const i=Ey(e,2)[1],a=Ey(o,2)[1];let c=0;for(const l of t)for(let d=l[0];d<l[1];++d){for(let h=0;h<s;++h)r[c*a+h]=n[d*i+h];++c}}function OO(n,e,t,s,r){const o=e.slice();o[0]=r;const i=En(t,fe(o)),a=n.length,c=a===0?0:a/e[0];return FO(n,e,s,c,i,o),[i,o]}function fN(n,e,t,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(jO(o,i,c),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:d,valueSlices:h,numValues:f}=PO(o,i,n,l),p=MO(d),m=OO(t,s,r,h,f);return[p,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dy=2147483647;function pN(n,e,t,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,c=r.length===0,l=i.length===0,d=[];a||d.push(e[0]),c||d.push(r[0]),l||d.push(i[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const h=d.length===0?1:d[0],f=En("int32",h+1);f[0]=0;for(let x=0;x<h;++x){const y=a?n[0]:n[x],b=c?s[0]:s[x],w=l?o[0]:o[x];if(w===0)throw new Error("Requires delta != 0");let v;if(w>0&&b<y||w<0&&b>y)v=0;else if(v=Math.ceil(Math.abs((b-y)/w)),v>Dy)throw new Error(`Requires ((limit - start) / delta) <= ${Dy}`);f[x+1]=f[x]+v}const p=f[h],m=En(t,p);let g=0;for(let x=0;x<h;++x){const y=f[x+1]-f[x];let b=a?n[0]:n[x];const w=l?o[0]:o[x];for(let v=0;v<y;++v)m[g++]=b,b+=w}return[f,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var nr=Ir;class Zu{constructor(e,t,s,r,o,i,a,c,l,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=e1(d),this.raggedRank=t1(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===nr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===nr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case nr.VALUE_ROWIDS:return Zu.getMaxWidthValueRowID(t);case nr.ROW_SPLITS:return Zu.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${nr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return _y(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;n1(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=Zv(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=t)o.push(i);for(let a=r;a<e;++a)o.push(-1);return R(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const c=e[a+1]-e[a];let l=Math.min(r,c),d=t[a];d===-1&&(l=0);for(let h=0;h<l;++h)i.push(d),d+=s;for(let h=0;h<c-l;++h)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let l=t[c];i.push(l);for(let d=1;d<o;++d){const h=e[d];if(h===c)l>=0&&(++a,a<r?l+=s:l=-1);else{if(a=0,c=h,h>=t.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${t.length}`);l=t[h]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case nr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case nr.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${nr[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case nr.FIRST_DIM_SIZE:return e[0];case nr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case nr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${nr[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*s[c+1];const o=_y(s,!1),i=En(this.valuesDType,fe(o));if(r[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,r[l],s[l]);this.setOutput(this.raggedRank,c,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const c=fe(a),l=t.length;let d=this.defaultValue;if(d.length!==c&&d.length!==1){const m=this.defaultValueShape;ie(()=>{const g=Y(d,m);d=mc(g,a).dataSync()})}let h=0,f=0,p=0;for(let m=0;m<=l;++m){let g=m<l?t[m]:-1;if(g===p){++p;continue}if(f<p){const x=o.subarray(h*c),y=i.subarray(f*c),b=(p-f)*c;jy(y,x,b)}if(m>=l){const x=s.length;g=Math.floor(x/c)}if(g>p)if(this.defaultValue.length===1)i.subarray(p*c,g*c).fill(this.defaultValue[0]),p=g;else for(;g>p;){const x=i.slice(p*c);jy(x,d,c),++p}g<0?(h=m+1,f=p):(h=m,f=p,p=f+1)}}}function jy(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function _y(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function mN(n,e,t,s,r,o,i,a,c,l){return new Zu(n,e,t,s,r,o,i,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gN(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return ds(0,s);const a=Math.abs(Math.ceil((e-n)/t)),c=ds(a,s);e<n&&t===1&&(t=-1),c[0]=n;for(let l=1;l<c.length;l++)c[l]=c[l-1]+t;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xN=ho(n=>1/Math.sqrt(n)),LO=si(gl,xN),zO={kernelName:gl,backendName:"cpu",kernelFunc:LO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bi(n,e,t,s,r,o,i,a,c,l){const d=[s/r,r],h=n.values,f=e.values;if(s===0)return Ot(t,e.dtype);const p=c instanceof rs?c:Ot(d,e.dtype);typeof c=="string"||typeof c=="number"?p.values.fill(c):typeof c=="boolean"&&p.values.fill(+c);for(let m=0;m<o;m++){const g=[];let x=0;for(let y=0;y<i;y++){const b=h[m*i+y];g.push(b),x+=b*a[y]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${t}`);for(let y=0;y<r;y++)l?p.values[x*r+y]+=f[m*r+y]:p.values[x*r+y]=e.rank===0?f[0]:f[m*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WO=ho(n=>1/(1+Math.exp(-n))),yN=cn(vl,n=>1/(1+Math.exp(-n))),BO={kernelName:vl,backendName:"cpu",kernelFunc:yN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bN(n,e,t,s,r){const o=_g(s,e,t),i=fe(t),a=xt(s);if(o){const h=Pg(e,a);return r==="string"?n.slice(h,h+i):n.subarray(h,h+i)}const c=r==="string"?So(n):n,l=Ot(s,r,c),d=Ot(t,r);for(let h=0;h<d.size;++h){const f=d.indexToLoc(h),p=f.map((m,g)=>m+e[g]);d.set(l.get(...p),...f)}return r==="string"?S1(d.values):d.values}function Oi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;ct(r,"slice");const[a,c]=Ph(r,o,i);Dg(r,a,c);const l=t.data.get(r.dataId).values,d=bN(l,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,d)}const VO={kernelName:yh,backendName:"cpu",kernelFunc:Oi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wN(n,e,t,s,r,o,i){const a=e[0],c=o[0],l=new Array(c),d=new Array(a),h=e[1];if(c===0){if(a!==0)throw new Error(l1(a));const x=En(t,0),y=En(r,0);return[x,[0,h],y,l,d]}let f=!0,p=0;const m=new Array(c).fill(0);for(let x=0;x<a;++x){const y=n[x*h];if(y<0)throw new Error(u1(x,y));if(y>=c)throw new Error(d1(x,y,c));++m[y],f=f&&y>=p,p=y}let g=!0;for(let x=0;x<c;++x){const y=m[x]===0;l[x]=y,g=g&&!y,m[x]=Math.max(m[x],1),x>0&&(m[x]+=m[x-1])}if(g&&f){const x=n,y=s;for(let b=0;b<a;++b)d[b]=b;return[x,[a,h],y,l,d]}else{const x=m[c-1],y=En(t,x*h),b=En(r,x),w=new Array(c).fill(0);for(let v=0;v<a;++v){const S=n[v*h],C=w[S],k=(S===0?0:m[S-1])+C;w[S]++;for(let I=0;I<h;++I)y[k*h+I]=n[v*h+I];b[k]=s[v],d[v]=k}for(let v=0;v<c;++v)if(w[v]===0){const C=v===0?0:m[v-1];y[C*h+0]=v;for(let k=1;k<h;++k)y[C*h+k]=0;b[C]=i}return[y,[x,h],b,l,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vN(n,e,t,s,r){const o=fe(s),i=e[0],a=r.length,c=[];let l=1,d=-1;for(let x=0;x<a;++x){const y=r[x];if(y===-1){if(d!==-1)throw new Error(h1(d,x));d=x,c.push(1)}else{if(y<0)throw new Error(f1(x,y));l*=y,c.push(y)}}if(d!==-1){if(l<=0)throw new Error(p1());const x=Math.trunc(o/l);if(l*x!==o)throw new Error(m1(s,c));c[d]=x}if(fe(c)!==o)throw new Error(g1(s,c));const f=s.length,p=[];if(f>0){p[f-1]=1;for(let x=f-2;x>=0;--x)p[x]=p[x+1]*s[x+1]}const m=[];if(a>0){m[a-1]=1;for(let x=a-2;x>=0;--x)m[x]=m[x+1]*c[x+1]}const g=En(t,i*a);for(let x=0;x<i;++x){let y=0;for(let b=0;b<f;++b)y+=n[x*f+b]*p[b];for(let b=0;b<a;++b)g[x*a+b]=Math.trunc(y/m[b]),y%=m[b]}return[g,[i,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T0(n,e,t,s,r,o=!1,i=0){const a=s.length,c=[e[0],n.length/e[0]],l=c[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(Sp());const f=e.slice();f[0]=h;const p=f.reduce((w,v)=>w*v,1),m=En(t,p);if(a===0)return h>0&&m.fill(i),[m,f];if(h<=0)throw new Error(Sp());let g=0,x=1,y=0,b=r[g];for(;;){let w=0;if(x<a){if(w=r[x],b===w){++x;continue}if(b>=w)throw new Error(x1())}if(b<0||b>=h)throw new Error(y1(b,h));b>y&&m.fill(i,y*l,b*l);for(let v=g;v<x;++v){const S=s[v];if(S<0||S>=c[0])throw new Error(b1(v,s[v],c[0]));for(let C=0;C<l;C++)m[b*l+C]+=n[S*l+C]}if(o)for(let v=0;v<l;v++)m[b*l+v]/=x-g;if(g=x,++x,y=b+1,b=w,x>a)break}return y<h&&m.fill(i,y*l,h*l),[m,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UO=ho(n=>Math.sqrt(n)),GO=cn(Cl,n=>Math.sqrt(n)),HO={kernelName:Cl,backendName:"cpu",kernelFunc:GO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SN=Mn((n,e)=>{const t=n-e;return t*t}),qO=qn(Nl,SN),KO={kernelName:Nl,backendName:"cpu",kernelFunc:qO};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CN=ho((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),XO=si(Om,CN),QO={kernelName:Om,backendName:"cpu",kernelFunc:XO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NN(n,e,t,s){const r=Ot(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let c=0;c<a.length;c++)a[c]=i[c]*t[c]+s[c];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YO{constructor(e,t,s,r,o,i){this.separator=Fo(e),this.nGramWidths=t,this.leftPad=Fo(s),this.rightPad=Fo(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let a=0;a<o;++a){const c=this.getPadWidth(i),l=Math.max(0,c-a),d=Math.max(0,c-(o-(a+1))),h=i-(l+d),f=t+(l>0?0:a-c);let p=0;p+=l*this.leftPad.length;for(let b=0;b<h;++b)p+=e[f+b].length;p+=d*this.rightPad.length;const m=l+d+h-1;p+=m*this.separator.length,s[r+a]=new Uint8Array(p);const g=s[r+a];let x=0;const y=b=>b.forEach(w=>g[x++]=w);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<h-1;++b)y(e[f+b]),y(this.separator);if(h>0){y(e[f+h-1]);for(let b=0;b<d;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<d-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<r;++l){let d=t[l]>=c;if(d=d&&t[l]<=s,!d)throw new Error(`Invalid split value ${t[l]}, must be in [${c}, ${s}]`);c=t[l]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const o=r-1,i=En("int32",r);if(s===0||r===0){const c=new Array(s);for(let l=0;l<=o;++l)i[l]=0;return[c,i]}i[0]=0;for(let c=1;c<=o;++c){const l=t[c]-t[c-1];let d=0;this.nGramWidths.forEach(h=>{d+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&d===0&&(d=1),i[c]=i[c-1]+d}const a=new Array(i[o]);for(let c=0;c<o;++c){const l=t[c];let d=i[c];if(this.nGramWidths.forEach(h=>{const f=t[c+1]-t[c],p=this.getNumNGrams(f,h);this.createNGrams(e,l,a,d,p,h),d+=p}),this.preserveShort&&d===i[c]){const h=t[c+1]-t[c];if(h===0)continue;const f=h+2*this.padWidth;this.createNGrams(e,l,a,d,1,f)}}return[a,i]}}function IN(n,e,t,s,r,o,i,a){return new YO(t,s,r,o,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JO(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function kN(n,e,t){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let f=0;f<s;++f){const p=r.length;JO(n[f],e,t,r);const m=r.length-p;a[f]=m,o+=m,i=Math.max(i,m)}const c=En("int32",o*2),l=new Array(o),d=[s,i];let h=0;for(let f=0;f<s;++f)for(let p=0;p<a[f];++p)c[h*2]=f,c[h*2+1]=p,l[h]=r[h],++h;return[c,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(n,e){const t=En("int32",n.length);for(let s=0;s<n.length;++s)t[s]=h2(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TN=Mn((n,e)=>n-e),ZO=N0((n,e,t,s)=>({real:n-t,imag:e-s})),A0=qn(Il,TN,ZO),eL={kernelName:Il,backendName:"cpu",kernelFunc:A0};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AN(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=Ot(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let c=0;c<i.length;c++)i[c]=o[c]%n.shape[c];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cc=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function RN(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,c=e-t+1,l=Math.log(a),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(a-d)/a)*Math.sign(c-a/2),f=Math.max(t,Math.floor(e-c*d/a+h)),p=Math.min(s,Math.floor(e+(a-c)*d/a+h));RN(n,e,f,p)}const r=n[e];let o=t,i=s;for(ia(n,t,e),cc(n[s],r)>0&&ia(n,t,s);o<i;){for(ia(n,o,i),o++,i--;cc(n[o],r)<0;)o=o+1;for(;cc(n[i],r)>0;)i=i-1}cc(n[t],r)===0?ia(n,t,i):(i=i+1,ia(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function EN(n,e,t,s,r){const o=e[e.length-1],[i,a]=[n.length/o,o],c=us(t,i*s),l=us("int32",i*s);for(let h=0;h<i;h++){const f=h*a,p=n.subarray(f,f+a);let m=new Array(p.length);p.forEach((b,w)=>m[w]={value:b,index:w}),s<m.length&&(RN(m,s),m=m.slice(0,s)),r&&m.sort(cc);const g=h*s,x=c.subarray(g,g+s),y=l.subarray(g,g+s);for(let b=0;b<s;b++)x[b]=m[b].value,y[b]=m[b].index}const d=e.slice();return d[d.length-1]=s,[Ot(d,t,c),Ot(d,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DN(n,e,t,s){const r=Lt(e,t)[0],o=[1,t[0],1];for(let m=0;m<r;m++)o[0]*=t[m];o[1]=t[r];for(let m=r+1;m<t.length;m++)o[2]*=t[m];const i=new Map,a=new Int32Array(t[r]),c=new rs(o,s,n),l=[],d=o[0]===1&&o[2]===1;for(let m=0;m<t[r];m++){let g;if(d)g=n[m].toString();else{const y=[];for(let b=0;b<o[0];b++)for(let w=0;w<o[2];w++)y.push(c.get(b,m,w));g=y.join(",")}const x=i.get(g);if(x!=null)a[m]=x;else{const y=i.size;i.set(g,y),a[m]=y,l.push(m)}}const h=o.slice();h[1]=i.size;const f=new rs(h,s);l.forEach((m,g)=>{for(let x=0;x<o[0];x++)for(let y=0;y<o[2];y++)f.set(c.get(x,m,y),x,g,y)});const p=t.slice();return p[r]=h[1],{outputValues:f.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL=Object.freeze(Object.defineProperty({__proto__:null,addImpl:WC,bincountImpl:I0,bincountReduceImpl:BC,bitwiseAndImpl:VC,castImpl:zC,ceilImpl:UC,concatImpl:GC,equalImpl:HC,expImpl:KC,expm1Impl:QC,floorDivImpl:JC,floorImpl:YC,gatherNdImpl:ZC,gatherV2Impl:eN,greaterEqualImpl:nN,greaterImpl:tN,lessEqualImpl:rN,lessImpl:sN,linSpaceImpl:oN,logImpl:iN,maxImpl:aN,maximumImpl:cN,minimumImpl:lN,multiplyImpl:k0,negImpl:uN,notEqualImpl:dN,prodImpl:hN,raggedGatherImpl:fN,raggedRangeImpl:pN,raggedTensorToTensorImpl:mN,rangeImpl:gN,rsqrtImpl:xN,scatterImpl:bi,sigmoidImpl:WO,simpleAbsImpl:LC,sliceImpl:bN,sparseFillEmptyRowsImpl:wN,sparseReshapeImpl:vN,sparseSegmentReductionImpl:T0,sqrtImpl:UO,squaredDifferenceImpl:SN,staticRegexReplaceImpl:CN,stridedSliceImpl:NN,stringNGramsImpl:IN,stringSplitImpl:kN,stringToHashBucketFastImpl:$N,subImpl:TN,tileImpl:AN,topKImpl:EN,transposeImpl:$0,uniqueImpl:DN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Qw("cpu",()=>new Qh,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jN=cn(Kc,n=>n>=0?n:Math.exp(n)-1),nL={kernelName:Kc,backendName:"cpu",kernelFunc:jN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _N(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;ct([r],"leakyRelu");const i=fe(r.shape),a=t.data.get(r.dataId).values,c=us("float32",i);for(let l=0;l<a.length;l++)c[l]=a[l]<0?o*a[l]:a[l];return t.makeTensorInfo(r.shape,"float32",c)}const sL={kernelName:Hd,backendName:"cpu",kernelFunc:_N};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rL=Mn((n,e)=>n<0?e*n:n);function PN(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;ct([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[a,c]=rL(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(c,"float32",a)}const oL={kernelName:dh,backendName:"cpu",kernelFunc:PN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MN=cn(fl,n=>Math.max(0,n)),iL={kernelName:fl,backendName:"cpu",kernelFunc:MN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FN=cn(pl,n=>Math.min(Math.max(0,n),6)),aL={kernelName:pl,backendName:"cpu",kernelFunc:FN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ed(n,e,t,s,r){if(t==="linear")return uo({inputs:{x:e},backend:n});if(t==="relu")return MN({inputs:{x:e},backend:n});if(t==="elu")return jN({inputs:{x:e},backend:n});if(t==="relu6")return FN({inputs:{x:e},backend:n});if(t==="prelu")return PN({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return _N({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return yN({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=fe(r.shape),a=nw(o,i),c=fe(a);R(i===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const l=t.data.get(r.dataId);if(l.complexTensorInfos!=null){const d=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;d.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const cL={kernelName:fh,backendName:"cpu",kernelFunc:mn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ON(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;ct([r,o],"matMul");const c=r.shape.length,l=o.shape.length,d=i?r.shape[c-2]:r.shape[c-1],h=a?o.shape[l-1]:o.shape[l-2],f=i?r.shape[c-1]:r.shape[c-2],p=a?o.shape[l-2]:o.shape[l-1],m=r.shape.slice(0,-2),g=o.shape.slice(0,-2),x=fe(m),y=fe(g),w=Dt(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,p]);R(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const v=i?[x,d,f]:[x,f,d],S=a?[y,p,h]:[y,h,p],C=mn({inputs:{x:r},backend:t,attrs:{shape:v}}),k=mn({inputs:{x:o},backend:t,attrs:{shape:S}}),I=i?C.shape[1]:C.shape[2],A=i?C.shape[2]:C.shape[1],T=a?k.shape[1]:k.shape[2],E=Math.max(x,y),$=t.data.get(C.dataId).values,D=t.data.get(k.dataId).values,M=xt(C.shape),P=xt(k.shape),[L,O,F]=i?[M[0],1,M[1]]:[M[0],M[1],1],[V,G,_]=a?[1,P[1],P[0]]:[P[1],1,P[0]],Z=A*T,te=Ot([E,A,T],C.dtype),he=te.values,oe=t.blockSize;for(let ve=0;ve<E;ve++){const $e=ve%x,Ae=ve%y;for(let De=0;De<A;De+=oe){const we=Math.min(De+oe,A);for(let Re=0;Re<T;Re+=oe){const et=Math.min(Re+oe,T);for(let je=0;je<I;je+=oe){const lt=Math.min(je+oe,I);for(let ht=De;ht<we;ht++)for(let it=Re;it<et;it++){let st=0;for(let Ye=je;Ye<lt;Ye++){const pt=$[$e*L+ht*O+Ye*F],Tt=D[Ye*V+it*G+Ae*_];st+=pt*Tt}he[ve*Z+(ht*T+it)]+=st}}}}}return t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo(k),t.makeTensorInfo(w,te.dtype,te.values)}const lL={kernelName:Ed,backendName:"cpu",kernelFunc:ON};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;let f,p,m;const g=[];f=ON({inputs:{a:r,b:o},attrs:{transposeA:c,transposeB:l},backend:t}),i&&(p=Aa({inputs:{a:f,b:i},backend:t}),g.push(f),f=p),d&&(m=ed(t,f,d,a,h),g.push(f),f=m);for(const y of g)t.disposeIntermediateTensorInfo(y);return f}const dL={kernelName:Eu,backendName:"cpu",kernelFunc:uL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hL=cn(Pc,n=>Math.acos(n)),fL={kernelName:Pc,backendName:"cpu",kernelFunc:hL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL=cn(Mc,n=>Math.acosh(n)),mL={kernelName:Mc,backendName:"cpu",kernelFunc:pL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(n){const{inputs:e,backend:t}=n,s=e;ct(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),o=Ot(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const c=r[a];for(let l=0;l<i.length;l++)i[l]+=c[l]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const xL={kernelName:sm,backendName:"cpu",kernelFunc:gL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"all");const a=Lt(o,r.shape);let c=a;const l=An(c,r.shape.length);let d=r;l!=null&&(d=js({inputs:{x:r},backend:t,attrs:{perm:l}}),c=_n(c.length,r.shape.length)),is("all",c,d.shape.length);const[h,f]=Zn(d.shape,c),p=fe(f),m=ds(fe(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*p;let w=g[b];for(let v=0;v<p;++v){const S=g[b+v];w=w&&S}m[y]=w}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=zn(h,a),b=mn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const bL={kernelName:rm,backendName:"cpu",kernelFunc:yL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"any");const a=Lt(o,r.shape);let c=a;const l=An(c,r.shape.length);let d=r;l!=null&&(d=js({inputs:{x:r},backend:t,attrs:{perm:l}}),c=_n(c.length,r.shape.length)),is("any",c,d.shape.length);const[h,f]=Zn(d.shape,c),p=fe(f),m=ds(fe(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*p;let w=g[b];for(let v=0;v<p;++v){const S=g[b+v];w=w||S}m[y]=w}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=zn(h,a),b=mn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const vL={kernelName:om,backendName:"cpu",kernelFunc:wL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;ct(r,"argMax");let i=Lt(o,r.shape);const a=An(i,r.shape.length);let c=r;const l=[];a!=null&&(c=js({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=_n(i.length,c.shape.length)),i=[i[0]],is("argMax",i,c.shape.length);const[d,h]=Zn(c.shape,i),f=fe(d),p=ds(f,"int32"),m=fe(h),g=t.data.get(c.dataId).values;for(let x=0;x<p.length;++x){const y=x*m;let b=g[y],w=0;for(let v=0;v<m;++v){const S=g[y+v];S>b&&(b=S,w=v)}p[x]=w}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",p)}const CL={kernelName:$d,backendName:"cpu",kernelFunc:SL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;ct(r,"argMin");let i=Lt(o,r.shape);const a=An(i,r.shape.length);let c=r;const l=[];a!=null&&(c=js({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=_n(i.length,c.shape.length)),i=[i[0]],is("argMin",i,c.shape.length);const[d,h]=Zn(c.shape,i),f=fe(d),p=ds(f,"int32"),m=fe(h),g=t.data.get(c.dataId).values;for(let x=0;x<p.length;++x){const y=x*m;let b=g[y],w=0;for(let v=0;v<m;++v){const S=g[y+v];S<b&&(b=S,w=v)}p[x]=w}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",p)}const IL={kernelName:Td,backendName:"cpu",kernelFunc:NL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL=cn(Fc,n=>Math.asin(n)),$L={kernelName:Fc,backendName:"cpu",kernelFunc:kL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TL=cn(Oc,n=>Math.asinh(n)),AL={kernelName:Oc,backendName:"cpu",kernelFunc:TL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RL=cn(Lc,n=>Math.atan(n)),EL={kernelName:Lc,backendName:"cpu",kernelFunc:RL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DL=Mn((n,e)=>Math.atan2(n,e)),jL=qn(Wc,DL),_L={kernelName:Wc,backendName:"cpu",kernelFunc:jL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PL=cn(zc,n=>Math.atanh(n)),ML={kernelName:zc,backendName:"cpu",kernelFunc:PL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0(n,e,t,s,r,o){const i=r.strideHeight,a=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Ot(r.outShape,t),x=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],w=r.outShape[3];for(let v=0;v<r.batchSize;++v){const S=v*y,C=v*s[0];for(let k=0;k<r.inChannels;++k)for(let I=0;I<r.outHeight;++I){const A=I*i-f,T=Math.max(0,A),E=Math.min(r.inHeight,d+A),$=S+I*b;for(let D=0;D<r.outWidth;++D){const M=D*a-p,P=Math.max(0,M),L=Math.min(r.inWidth,h+M);let O=m,F=0,V=0;for(let _=T;_<E;_+=c){const Z=C+_*s[1];for(let te=P;te<L;te+=l){const he=Z+te*s[2],oe=n[he+k];o==="max"&&oe>O?O=oe:o==="avg"&&(F+=oe,V++)}if(isNaN(O))break}const G=$+D*w+k;x[G]=o==="avg"?F/V:O}}}return g}function LN(n,e,t,s,r=!1,o=!1){const i=Ot(s.outShape,"int32"),a=s.strideHeight,c=s.strideWidth,l=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,f=s.effectiveFilterWidth,p=s.padInfo.top,m=s.padInfo.left,g=Ot(e,t,n);for(let x=0;x<s.batchSize;++x)for(let y=0;y<s.inChannels;++y)for(let b=0;b<s.outHeight;++b){const w=b*a-p;let v=w;for(;v<0;)v+=l;const S=Math.min(s.inHeight,h+w);for(let C=0;C<s.outWidth;++C){const k=C*c-m;let I=k;for(;I<0;)I+=d;const A=Math.min(s.inWidth,f+k);let T=Number.NEGATIVE_INFINITY,E=-1;for(let $=v;$<S;$+=l){const D=$-w;for(let M=I;M<A;M+=d){const P=M-k,L=g.get(x,$,M,y);L>T&&(T=L,r?E=o?((x*s.inHeight+$)*s.inWidth+M)*s.inChannels+y:($*s.inWidth+M)*s.inChannels+y:E=D*f+P)}}i.set(E,x,b,C,y)}}return i}function zN(n,e,t,s,r,o){const i=r.strideDepth,a=r.strideHeight,c=r.strideWidth,l=r.dilationDepth,d=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Ot(r.outShape,t),v=w.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],I=r.outShape[4];for(let A=0;A<r.batchSize;++A){const T=A*S,E=A*s[0];for(let $=0;$<r.inChannels;++$)for(let D=0;D<r.outDepth;++D){const M=D*i-g;let P=M;for(;P<0;)P+=l;const L=Math.min(r.inDepth,f+M),O=T+D*C;for(let F=0;F<r.outHeight;++F){const V=F*a-x;let G=V;for(;G<0;)G+=d;const _=Math.min(r.inHeight,p+V),Z=O+F*k;for(let te=0;te<r.outWidth;++te){const he=te*c-y;let oe=he;for(;oe<0;)oe+=h;const ve=Math.min(r.inWidth,m+he),$e=Z+te*I;let Ae=b,De=0,we=0;for(let et=P;et<L;et+=l){const je=E+et*s[1];for(let lt=G;lt<_;lt+=d){const ht=je+lt*s[2];for(let it=oe;it<ve;it+=h){const st=ht+it*s[3],Ye=n[st+$];if(o==="max"&&Ye>Ae?Ae=Ye:o==="avg"&&(De+=Ye,we++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}const Re=$e+$;v[Re]=o==="avg"?De/Math.max(we,1):Ae}}}}return w}function FL(n,e){const t=Ot(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let x=0;x<e.inChannels;++x)for(let y=0;y<e.outDepth;++y){const b=y*s-f;let w=b;for(;w<0;)w+=i;const v=Math.min(e.inDepth,l+b);for(let S=0;S<e.outHeight;++S){const C=S*r-p;let k=C;for(;k<0;)k+=a;const I=Math.min(e.inHeight,d+C);for(let A=0;A<e.outWidth;++A){const T=A*o-m;let E=T;for(;E<0;)E+=c;const $=Math.min(e.inWidth,h+T);let D=Number.NEGATIVE_INFINITY,M=-1;for(let P=w;P<v;P+=i){const L=P-b;for(let O=k;O<I;O+=a){const F=O-C;for(let V=E;V<$;V+=c){const G=V-T,_=n.get(g,P,O,V,x);_>=D&&(D=_,M=L*d*h+F*d+G)}}}t.set(M,g,y,S,A,x)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;ct(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(fs(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=pr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&tn(d.inShape,d.outShape))h=uo({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,p=xt(r.shape),m=R0(f,r.shape,r.dtype,p,d,"avg");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const LL={kernelName:Ad,backendName:"cpu",kernelFunc:OL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;ct(r,"avgPool3d");const d=Io(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,f=zN(h,r.shape,r.dtype,xt(r.shape),d,"avg");return t.makeTensorInfo(f.shape,"float32",f.values)}const WL={kernelName:Rd,backendName:"cpu",kernelFunc:zL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;ct([r,o],"avgPool3DGrad");const d=Io(o.shape,i,a,1,c,l),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,x=d.filterWidth,y=d.dilationDepth,b=d.dilationHeight,w=d.dilationWidth,v=d.effectiveFilterDepth,S=d.effectiveFilterHeight,C=d.effectiveFilterWidth,k=v-1-d.padInfo.front,I=C-1-d.padInfo.left,A=S-1-d.padInfo.top,T=Ot(o.shape,"float32"),E=1/(m*g*x),$=t.bufferSync(r);for(let D=0;D<d.batchSize;++D)for(let M=0;M<d.inChannels;++M)for(let P=0;P<d.inDepth;++P)for(let L=0;L<d.inHeight;++L)for(let O=0;O<d.inWidth;++O){const F=P-k,V=L-A,G=O-I;let _=0;for(let Z=0;Z<v;Z+=y){const te=(F+Z)/h;if(!(te<0||te>=d.outDepth||Math.floor(te)!==te))for(let he=0;he<S;he+=b){const oe=(V+he)/f;if(!(oe<0||oe>=d.outHeight||Math.floor(oe)!==oe))for(let ve=0;ve<C;ve+=w){const $e=(G+ve)/p;if($e<0||$e>=d.outWidth||Math.floor($e)!==$e)continue;const Ae=$.get(D,te,oe,$e,M);_+=Ae}}}T.set(_*E,D,P,L,O,M)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const VL={kernelName:am,backendName:"cpu",kernelFunc:BL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;ct([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=pr(i.shape,a,c,1,l),h=d.strideHeight,f=d.strideWidth,p=d.filterHeight,m=d.filterWidth,g=d.dilationHeight,x=d.dilationWidth,y=d.effectiveFilterHeight,b=d.effectiveFilterWidth,w=b-1-d.padInfo.left,v=y-1-d.padInfo.top,S=Ot(i.shape,"float32"),C=1/(p*m),k=t.data.get(r.dataId).values,I=Ot(r.shape,"float32",k);for(let A=0;A<d.batchSize;++A)for(let T=0;T<d.inChannels;++T)for(let E=0;E<d.inHeight;++E)for(let $=0;$<d.inWidth;++$){const D=E-v,M=$-w;let P=0;for(let L=0;L<y;L+=g){const O=(D+L)/h;if(!(O<0||O>=d.outHeight||Math.floor(O)!==O))for(let F=0;F<b;F+=x){const V=(M+F)/f;if(V<0||V>=d.outWidth||Math.floor(V)!==V)continue;const G=I.get(A,O,V,T);P+=G}}S.set(P*C,A,E,$,T)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const GL={kernelName:im,backendName:"cpu",kernelFunc:UL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:c}=e;R(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ct([r,a,c,o,i],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const d=t.data.get(r.dataId).values,h=t.data.get(a.dataId).values,f=t.data.get(c.dataId).values,p=o?t.data.get(o.dataId).values:new Float32Array([1]),m=i?t.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(d.length),x=m.length,y=p.length,b=f.length,w=h.length;let v=0,S=0,C=0,k=0;for(let I=0;I<d.length;++I)g[I]=m[v++]+(d[I]-h[S++])*p[C++]/Math.sqrt(f[k++]+l),v>=x&&(v=0),S>=w&&(S=0),C>=y&&(C=0),k>=b&&(k=0);return t.makeTensorInfo(r.shape,r.dtype,g)}const qL={kernelName:Vd,backendName:"cpu",kernelFunc:HL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;ct([r],"batchToSpaceND");const a=o.reduce((y,b)=>y*b),c=Pl(r.shape,o,a),l=Ml(c.length,o.length),d=Fl(r.shape,o,a),h=zg(i,o.length),f=Wg(d,i,o.length),p=mn({inputs:{x:r},backend:t,attrs:{shape:c}}),m=js({inputs:{x:p},backend:t,attrs:{perm:l}}),g=mn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=Oi({inputs:{x:g},backend:t,attrs:{begin:h,size:f}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const XL={kernelName:Dd,backendName:"cpu",kernelFunc:KL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=I0(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const YL={kernelName:cm,backendName:"cpu",kernelFunc:QL};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=Dt(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const ZL={kernelName:cw,backendName:"cpu",kernelFunc:JL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e3=cn(Uc,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),t3={kernelName:Uc,backendName:"cpu",kernelFunc:e3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n3=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(fe(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values;for(let l=0;l<a.length;l++){const d=a[l],h=c[l];s[l]=Math.hypot(d,h)}return t.makeOutput(s,e.shape,"float32")},s3={kernelName:jd,backendName:"cpu",kernelFunc:n3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ra(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const r3={kernelName:km,backendName:"cpu",kernelFunc:Ra};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ea(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Lt(r,e[0].shape)[0],i=e.map(g=>g.shape);Fg(i,o);let a=to(e.map(g=>g.shape),o);if(fe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(g=>fe(g.shape)>0);if(c.length===1)return uo({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){const g=c.map(v=>Fi({inputs:{input:v},backend:t})),x=c.map(v=>Ra({inputs:{input:v},backend:t})),y=Ea({inputs:g,backend:t,attrs:{axis:o}}),b=Ea({inputs:x,backend:t,attrs:{axis:o}}),w=Ws({inputs:{real:y,imag:b},backend:t});return g.forEach(v=>t.disposeIntermediateTensorInfo(v)),x.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),w}const l=c.map(g=>{const y=[-1,fe(g.shape.slice(o))];return mn({inputs:{x:g},backend:t,attrs:{shape:y}})}),d=l.map(g=>({vals:t.data.get(g.dataId).values,shape:g.shape}));a=to(l.map(g=>g.shape),1);const h=l[0].shape[0]===1,f=GC(d,a,e[0].dtype,h),p=to(c.map(g=>g.shape),o),m=t.makeTensorInfo(p,e[0].dtype,f);return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const o3={kernelName:_d,backendName:"cpu",kernelFunc:Ea};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s;ct([r,o],"conv2d");const h=ko(c),f=os(r.shape,o.shape,i,l,a,d,!1,h),p=f.filterHeight,m=f.filterWidth,g=f.dilationHeight,x=f.dilationWidth,y=f.padInfo.left,b=f.padInfo.top,w=f.dataFormat==="channelsLast",v=new rs(f.outShape,r.dtype),S=xt(r.shape),C=xt(o.shape),k=S[0],I=w?S[1]:S[2],A=w?S[2]:1,T=w?1:S[1],E=v.strides[0],$=w?v.strides[1]:v.strides[2],D=w?v.strides[2]:1,M=w?1:v.strides[1],P=t.data.get(r.dataId).values,L=t.data.get(o.dataId).values,O=v.values;for(let F=0;F<f.batchSize;++F){const V=F*k,G=F*E;for(let _=0;_<f.outHeight;++_){const Z=G+_*$,te=_*f.strideHeight-b;for(let he=0;he<p;++he){const oe=te+he*g;if(oe<0||oe>=f.inHeight)continue;const ve=he*C[0],$e=V+oe*I;for(let Ae=0;Ae<f.outWidth;++Ae){const De=Z+Ae*D,we=Ae*f.strideWidth-y;for(let Re=0;Re<m;++Re){const et=we+Re*x;if(et<0||et>=f.inWidth)continue;const je=ve+Re*C[1],lt=$e+et*A;let ht=je;for(let it=0;it<f.inChannels;++it){const st=P[lt+it*T];for(let Ye=0;Ye<f.outChannels;++Ye)O[De+Ye*M]+=st*L[ht+Ye];ht+=f.outChannels}}}}}}return t.makeTensorInfo(v.shape,v.dtype,O)}const i3={kernelName:Pd,backendName:"cpu",kernelFunc:WN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s;ct([r,o],"conv2dBackpropFilter");const h=ko(c),f=os(r.shape,d,i,1,a,l,!1,h),{strideHeight:p,strideWidth:m,filterHeight:g,filterWidth:x}=f,y=f.dataFormat==="channelsLast",b=new rs(f.filterShape,"float32"),w=f.padInfo.left,v=f.padInfo.top,S=t.data.get(r.dataId).values,C=t.data.get(o.dataId).values,k=new rs(r.shape,r.dtype,S),I=new rs(o.shape,o.dtype,C);for(let A=0;A<g;++A){const T=Math.max(0,Math.ceil((v-A)/p)),E=Math.min(f.outHeight,(f.inHeight+v-A)/p);for(let $=0;$<x;++$){const D=Math.max(0,Math.ceil((w-$)/m)),M=Math.min(f.outWidth,(f.inWidth+w-$)/m);for(let P=0;P<f.inChannels;++P)for(let L=0;L<f.outChannels;++L){let O=0;for(let F=0;F<f.batchSize;++F)for(let V=T;V<E;++V){const G=A+V*p-v;for(let _=D;_<M;++_){const Z=$+_*m-w;y?O+=k.get(F,G,Z,P)*I.get(F,V,_,L):O+=k.get(F,P,G,Z)*I.get(F,L,V,_)}}b.set(O,A,$,P,L)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const c3={kernelName:dm,backendName:"cpu",kernelFunc:a3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s;ct([r,o],"conv2dBackpropInput");const h=xt(o.shape),f=xt(r.shape);let p=ko(l);const m=os(i,o.shape,a,1,c,d,!1,p),g=new rs(m.inShape,"float32"),x=g.values,y=t.data.get(r.dataId).values,b=t.data.get(o.dataId).values,[w,v,S]=h,{batchSize:C,filterHeight:k,filterWidth:I,inChannels:A,inHeight:T,inWidth:E,outChannels:$,outHeight:D,outWidth:M,strideHeight:P,strideWidth:L}=m;p=m.dataFormat;const O=k-1-m.padInfo.top,F=I-1-m.padInfo.left,V=p==="channelsLast",G=g.strides[0],_=V?g.strides[1]:g.strides[2],Z=V?g.strides[2]:1,te=V?1:g.strides[1],he=f[0],oe=V?f[1]:f[2],ve=V?f[2]:1,$e=V?1:f[1];for(let Ae=0;Ae<C;++Ae)for(let De=0;De<A;++De)for(let we=0;we<T;++we){const Re=we-O,et=Math.max(0,Math.ceil(Re/P)),je=Math.min(D,(k+Re)/P);for(let lt=0;lt<E;++lt){const ht=lt-F,it=Math.max(0,Math.ceil(ht/L)),st=Math.min(M,(I+ht)/L);let Ye=0;for(let Tt=et;Tt<je;++Tt){const se=Tt*P-Re;for(let Ge=it;Ge<st;++Ge){const ze=Ge*L-ht,Nt=he*Ae+oe*Tt+ve*Ge,sn=w*(k-1-se)+v*(I-1-ze)+S*De;for(let Ht=0;Ht<$;++Ht){const Fe=y[Nt+$e*Ht],ge=b[sn+Ht];Ye+=Fe*ge}}}const pt=G*Ae+_*we+Z*lt+te*De;x[pt]=Ye}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const u3={kernelName:Md,backendName:"cpu",kernelFunc:l3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s;ct([r,o],"conv3d");const l=Yo(r.shape,o.shape,i,c,a),{filterDepth:d,filterHeight:h,filterWidth:f,dilationDepth:p,dilationHeight:m,dilationWidth:g,padInfo:x}=l,y=x.front,b=x.left,w=x.top,v=new rs(l.outShape,r.dtype),S=t.data.get(r.dataId).values,C=t.data.get(o.dataId).values,k=v.values,I=xt(r.shape),A=xt(o.shape);for(let T=0;T<l.batchSize;++T){const E=T*I[0],$=T*v.strides[0];for(let D=0;D<l.outDepth;++D){const M=$+D*v.strides[1],P=D*l.strideDepth-y;for(let L=0;L<d;++L){const O=P+L*p;if(O<0||O>=l.inDepth)continue;const F=L*A[0],V=E+O*I[1];for(let G=0;G<l.outHeight;++G){const _=M+G*v.strides[2],Z=G*l.strideHeight-w;for(let te=0;te<h;++te){const he=Z+te*m;if(he<0||he>=l.inHeight)continue;const oe=F+te*A[1],ve=V+he*I[2];for(let $e=0;$e<l.outWidth;++$e){const Ae=_+$e*l.outChannels,De=$e*l.strideWidth-b;for(let we=0;we<f;++we){const Re=De+we*g;if(Re<0||Re>=l.inWidth)continue;const et=oe+we*A[2],je=ve+Re*l.inChannels;let lt=et;for(let ht=0;ht<l.inChannels;++ht){const it=S[je+ht];for(let st=0;st<l.outChannels;++st)k[Ae+st]+=it*C[lt+st];lt+=l.outChannels}}}}}}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const h3={kernelName:Fd,backendName:"cpu",kernelFunc:d3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s;ct([r,o],"conv3dBackpropFilterV2");const l=xt(r.shape),d=xt(o.shape),h=Yo(r.shape,c,i,1,a),f=h.strideDepth,p=h.strideHeight,m=h.strideWidth,g=h.filterDepth,x=h.filterHeight,y=h.filterWidth,b=new rs(h.filterShape,"float32"),w=b.values,[v,S,C,k]=b.strides,I=t.data.get(o.dataId).values,[A,T,E,$]=d,D=t.data.get(r.dataId).values,[M,P,L,O]=l,F=h.padInfo.front,V=h.padInfo.left,G=h.padInfo.top;for(let _=0;_<g;++_){const Z=Math.max(0,Math.ceil((F-_)/f)),te=Math.min(h.outDepth,(h.inDepth+F-_)/f),he=_*v;for(let oe=0;oe<x;++oe){const ve=Math.max(0,Math.ceil((G-oe)/p)),$e=Math.min(h.outHeight,(h.inHeight+G-oe)/p),Ae=oe*S+he;for(let De=0;De<y;++De){const we=Math.max(0,Math.ceil((V-De)/m)),Re=Math.min(h.outWidth,(h.inWidth+V-De)/m),et=De*C+Ae;for(let je=0;je<h.inChannels;++je){const lt=je*k+et;for(let ht=0;ht<h.outChannels;++ht){let it=0;for(let st=0;st<h.batchSize;++st){const Ye=st*M,pt=st*A;for(let Tt=Z;Tt<te;++Tt){const Ge=(_+Tt*f-F)*P+Ye,ze=Tt*T+pt;for(let Nt=ve;Nt<$e;++Nt){const Ht=(oe+Nt*p-G)*L+Ge,Fe=Nt*E+ze;for(let ge=we;ge<Re;++ge){const tt=(De+ge*m-V)*O+Ht,vt=ge*$+Fe;it+=D[tt+je]*I[vt+ht]}}}}w[lt+ht]=it}}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const p3={kernelName:hm,backendName:"cpu",kernelFunc:f3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s;ct([r],"conv3dBackpropInputV2");const l=xt(r.shape),d=xt(o.shape),h=Yo(c,o.shape,a,1,i),f=new rs(h.inShape,"float32"),p=f.values,[m,g,x,y]=f.strides,b=t.data.get(r.dataId).values,[w,v,S,C]=l,k=t.data.get(o.dataId).values,[I,A,T,E]=d,{batchSize:$,filterDepth:D,filterHeight:M,filterWidth:P,inChannels:L,inDepth:O,inHeight:F,inWidth:V,outChannels:G,outDepth:_,outHeight:Z,outWidth:te,strideDepth:he,strideHeight:oe,strideWidth:ve}=h,$e=D-1-h.padInfo.front,Ae=M-1-h.padInfo.top,De=P-1-h.padInfo.left;for(let we=0;we<$;++we)for(let Re=0;Re<L;++Re)for(let et=0;et<O;++et){const je=et-$e,lt=Math.max(0,Math.ceil(je/he)),ht=Math.min(_,(D+je)/he);for(let it=0;it<F;++it){const st=it-Ae,Ye=Math.max(0,Math.ceil(st/oe)),pt=Math.min(Z,(M+st)/oe);for(let Tt=0;Tt<V;++Tt){const se=Tt-De,Ge=Math.max(0,Math.ceil(se/ve)),ze=Math.min(te,(P+se)/ve);let Nt=0;for(let sn=lt;sn<ht;++sn){const Ht=sn*he-je;for(let Fe=Ye;Fe<pt;++Fe){const ge=Fe*oe-st;for(let Pe=Ge;Pe<ze;++Pe){const tt=Pe*ve-se,vt=w*we+v*sn+S*Fe+C*Pe,Yt=I*(D-1-Ht)+A*(M-1-ge)+T*(P-1-tt)+E*Re;for(let gn=0;gn<G;++gn){const jt=b[vt+gn],hn=k[Yt+gn];Nt+=jt*hn}}}}p[m*we+g*et+x*it+y*Tt+Re]=Nt}}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const g3={kernelName:fm,backendName:"cpu",kernelFunc:m3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x3=cn(Gc,n=>Math.cos(n)),y3={kernelName:Gc,backendName:"cpu",kernelFunc:x3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3=cn(Hc,n=>Math.cosh(n)),w3={kernelName:Hc,backendName:"cpu",kernelFunc:b3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,[d,h,f,p]=r.shape,m=o.shape[0],[g,x]=a,y=Ot([m,g,x,p],"float32"),b=t.data.get(o.dataId).values,w=t.data.get(i.dataId).values,v=t.data.get(r.dataId).values,S=xt(r.shape),C=xt(y.shape);for(let k=0;k<m;k++){const I=k*4,A=b[I],T=b[I+1],E=b[I+2],$=b[I+3],D=w[k];if(D>=d)continue;const M=g>1?(E-A)*(h-1)/(g-1):0,P=x>1?($-T)*(f-1)/(x-1):0;for(let L=0;L<g;L++){const O=g>1?A*(h-1)+L*M:.5*(A+E)*(h-1);if(O<0||O>h-1){for(let F=0;F<x;F++)for(let V=0;V<p;V++){const G=V+F*C[2]+L*C[1]+k*C[0];y.values[G]=l}continue}if(c==="bilinear"){const F=Math.floor(O),V=Math.ceil(O),G=O-F;for(let _=0;_<x;_++){const Z=x>1?T*(f-1)+_*P:.5*(T+$)*(f-1);if(Z<0||Z>f-1){for(let ve=0;ve<p;ve++){const $e=ve+_*C[2]+L*C[1]+k*C[0];y.values[$e]=l}continue}const te=Math.floor(Z),he=Math.ceil(Z),oe=Z-te;for(let ve=0;ve<p;ve++){let $e=ve+te*S[2]+F*S[1]+D*S[0];const Ae=v[$e];$e=ve+he*S[2]+F*S[1]+D*S[0];const De=v[$e];$e=ve+te*S[2]+V*S[1]+D*S[0];const we=v[$e];$e=ve+he*S[2]+V*S[1]+D*S[0];const Re=v[$e],et=Ae+(De-Ae)*oe,je=we+(Re-we)*oe;$e=ve+_*C[2]+L*C[1]+k*C[0],y.values[$e]=et+(je-et)*G}}}else for(let F=0;F<x;++F){const V=x>1?T*(f-1)+F*P:.5*(T+$)*(f-1);if(V<0||V>f-1){for(let Z=0;Z<p;Z++){const te=Z+F*C[2]+L*C[1]+k*C[0];y.values[te]=l}continue}const G=Math.round(V),_=Math.round(O);for(let Z=0;Z<p;Z++){const te=Z+G*S[2]+_*S[1]+D*S[0],he=Z+F*C[2]+L*C[1]+k*C[0];y.values[he]=v[te]}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const S3={kernelName:mm,backendName:"cpu",kernelFunc:v3};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;ct(r,"cumprod");const c=An([o],r.shape.length);let l=r;c!=null&&(l=js({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=_n(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Us(l.dtype,"int32"),f=em(fe(l.shape),h),p=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<p.length;y+=m)for(let b=0;b<m;b++){const w=g(y,b);if(b===0)f[w]=i?1:p[w];else{const v=g(y,b-1);f[w]=i?p[v]*f[v]:p[w]*f[v]}}const x=t.makeTensorInfo(l.shape,h,f);if(c!=null){const y=Jo(c),b=js({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const N3={kernelName:pm,backendName:"cpu",kernelFunc:C3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;ct(r,"cumsum");const c=An([o],r.shape.length);let l=r;c!=null&&(l=js({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=_n(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Us(l.dtype,"int32"),f=ds(fe(l.shape),h),p=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<p.length;y+=m)for(let b=0;b<m;b++){const w=g(y,b);if(b===0)f[w]=i?0:p[w];else{const v=g(y,b-1);f[w]=i?p[v]+f[v]:p[w]+f[v]}}const x=t.makeTensorInfo(l.shape,h,f);if(c!=null){const y=Jo(c),b=js({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const k3={kernelName:Od,backendName:"cpu",kernelFunc:I3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=I0(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=BC(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const T3={kernelName:gm,backendName:"cpu",kernelFunc:$3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;R(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],c=r.shape[1],l=r.shape[2],d=r.shape[3],h=c*o,f=l*o,p=d/(o*o),m=t.data.get(r.dataId).values,g=new Float32Array(a*h*f*p);let x=0;for(let y=0;y<a;++y)for(let b=0;b<h;++b){const w=Math.floor(b/o),v=b%o;for(let S=0;S<f;++S){const C=Math.floor(S/o),k=S%o,I=(v*o+k)*p;for(let A=0;A<p;++A){const E=A+I+d*(C+l*(w+c*y));g[x++]=m[E]}}}return t.makeTensorInfo([a,h,f,p],r.dtype,g)}const R3={kernelName:xm,backendName:"cpu",kernelFunc:A3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;ct([r,o],"depthwiseConv2DNative");const d=xt(r.shape),h=xt(o.shape);let f=c;f==null&&(f=[1,1]),R(fs(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);const p=os(r.shape,o.shape,i,f,a,l,!0),{filterHeight:m,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=p,w=b.left,v=b.top,S=p.outChannels/p.inChannels,C=new rs(p.outShape,r.dtype),k=t.data.get(r.dataId).values,I=t.data.get(o.dataId).values,A=C.values;for(let T=0;T<p.batchSize;++T){const E=T*d[0],$=T*C.strides[0];for(let D=0;D<p.outHeight;++D){const M=$+D*C.strides[1],P=D*p.strideHeight-v;for(let L=0;L<m;++L){const O=P+L*x;if(O<0||O>=p.inHeight)continue;const F=L*h[0],V=E+O*d[1];for(let G=0;G<p.outWidth;++G){const _=M+G*C.strides[2],Z=G*p.strideWidth-w;for(let te=0;te<g;++te){const he=Z+te*y;if(he<0||he>=p.inWidth)continue;const oe=F+te*h[1],ve=V+he*p.inChannels;let $e=_,Ae=oe;for(let De=0;De<p.inChannels;++De){const we=k[ve+De];for(let Re=0;Re<S;++Re)A[$e+Re]+=we*I[Ae+Re];$e+=S,Ae+=S}}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const E3={kernelName:Ld,backendName:"cpu",kernelFunc:BN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s;ct([r,o],"depthwiseConv2dNativeBackpropFilter");const h=os(r.shape,d,i,a,c,l,!0),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=h,x=new rs(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,w=h.outChannels/h.inChannels,v=t.data.get(r.dataId).values,S=new rs(r.shape,r.dtype,v),C=t.data.get(o.dataId).values,k=new rs(o.shape,o.dtype,C);for(let I=0;I<m;++I){const A=Math.max(0,Math.ceil((b-I)/f)),T=Math.min(h.outHeight,(h.inHeight+b-I)/f);for(let E=0;E<g;++E){const $=Math.max(0,Math.ceil((y-E)/p)),D=Math.min(h.outWidth,(h.inWidth+y-E)/p);for(let M=0;M<h.outChannels;++M){const P=Math.trunc(M/w),L=M%w;let O=0;for(let F=0;F<h.batchSize;++F)for(let V=A;V<T;++V){const G=I+V*f-b;for(let _=$;_<D;++_){const Z=E+_*p-y;O+=S.get(F,G,Z,P)*k.get(F,V,_,M)}}x.set(O,I,E,P,L)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const j3={kernelName:ym,backendName:"cpu",kernelFunc:D3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s;ct([r,o],"depthwiseConv2DNativeBackpropInput");const h=xt(r.shape),f=xt(o.shape),p=os(d,o.shape,i,a,c,l,!0),m=new rs(p.inShape,"float32"),g=m.values,[x,y,b]=m.strides,w=t.data.get(r.dataId).values,[v,S,C]=h,k=t.data.get(o.dataId).values,[I,A,T]=f,{batchSize:E,filterHeight:$,filterWidth:D,inChannels:M,inHeight:P,inWidth:L,outChannels:O,outHeight:F,outWidth:V,strideHeight:G,strideWidth:_}=p,Z=$-1-p.padInfo.top,te=D-1-p.padInfo.left,he=O/M;for(let oe=0;oe<E;++oe)for(let ve=0;ve<M;++ve)for(let $e=0;$e<P;++$e){const Ae=$e-Z,De=Math.max(0,Math.ceil(Ae/G)),we=Math.min(F,($+Ae)/G);for(let Re=0;Re<L;++Re){const et=Re-te,je=Math.max(0,Math.ceil(et/_)),lt=Math.min(V,(D+et)/_);let ht=0;for(let it=De;it<we;++it){const st=it*G-Ae;for(let Ye=je;Ye<lt;++Ye){const pt=Ye*_-et,Tt=v*oe+S*it+C*Ye,se=I*($-1-st)+A*(D-1-pt)+T*ve;for(let Ge=0;Ge<he;++Ge){const ze=ve*he+Ge,Nt=w[Tt+ze],sn=k[se+Ge];ht+=Nt*sn}}}g[x*oe+y*$e+b*Re+ve]=ht}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const P3={kernelName:bm,backendName:"cpu",kernelFunc:_3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M3(n){const{inputs:e,backend:t}=n,{x:s}=e,r=fe(s.shape),o=t.data.get(s.dataId).values,i=Ot([r,r],s.dtype),a=i.values;for(let l=0;l<o.length;l++)a[l*r+l]=o[l];const c=[...s.shape,...s.shape];return t.makeTensorInfo(c,i.dtype,i.values)}const F3={kernelName:lw,backendName:"cpu",kernelFunc:M3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O3={kernelName:zd,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=t,c=e,l=c.data.get(s.dataId).values,d=s.shape.length,h=c.data.get(r.dataId).values,f=r.shape.length,{batchSize:p,inHeight:m,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:w,strideHeight:v,strideWidth:S,filterHeight:C,filterWidth:k,dilationHeight:I,dilationWidth:A,outShape:T}=Rl(s.shape,r.shape,o,i,"NHWC",a),E=fe(T),$=T.length,D=En(s.dtype,E);for(let P=0;P<p;++P)for(let L=0;L<y;++L){const O=L*v-w.top;for(let F=0;F<b;++F){const V=F*S-w.left;for(let G=0;G<x;++G){let _=Number.MIN_SAFE_INTEGER;for(let te=0;te<C;++te){const he=O+te*I;if(he>=0&&he<m)for(let oe=0;oe<k;++oe){const ve=V+oe*A;if(ve>=0&&ve<g){const $e=Zr([P,he,ve,G],d,xt(s.shape)),Ae=Zr([te,oe,G],f,xt(r.shape)),De=l[$e]+h[Ae];De>_&&(_=De)}}}const Z=Zr([P,L,F,G],$,xt(T));D[Z]=_}}}return{dataId:c.write(Bi(D,s.dtype),T,s.dtype),shape:T,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L3={kernelName:op,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=Rr(s.shape,l.data.get(s.dataId).values),h=Rr(r.shape,l.data.get(r.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:w,strideWidth:v,filterHeight:S,filterWidth:C,dilationHeight:k,dilationWidth:I,outShape:A}=Rl(s.shape,r.shape,i,a,"NHWC",c);R(o.rank===A.length,()=>`Error in ${op}, dy must have the same rank as output ${A.length}, but got ${o.rank}`);const T=Rr(A,l.data.get(o.dataId).values),E=ow(r.shape,r.dtype);for(let D=0;D<f;++D)for(let M=0;M<x;++M){const P=M*w-b.top;for(let L=0;L<y;++L){const O=L*v-b.left;for(let F=0;F<g;++F){let V=Number.MIN_SAFE_INTEGER,G=0,_=0;for(let Z=0;Z<S;++Z){const te=P+Z*k;if(te>=0&&te<p)for(let he=0;he<C;++he){const oe=O+he*I;if(oe>=0&&oe<m){const ve=d[D][te][oe][F]+h[Z][he][F];ve>V&&(V=ve,G=Z,_=he)}}}E[G][_][F]+=T[D][M][L][F]}}}return{dataId:l.write(Bi(E,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z3={kernelName:rp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=Rr(s.shape,l.data.get(s.dataId).values),h=Rr(r.shape,l.data.get(r.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:w,strideWidth:v,filterHeight:S,filterWidth:C,dilationHeight:k,dilationWidth:I,outShape:A}=Rl(s.shape,r.shape,i,a,"NHWC",c);R(o.rank===A.length,()=>`Error in ${rp}, dy must have the same rank as output ${A.length}, but got ${o.rank}`);const T=Rr(A,l.data.get(o.dataId).values),E=ow(s.shape,s.dtype);for(let D=0;D<f;++D)for(let M=0;M<x;++M){const P=M*w-b.top;for(let L=0;L<y;++L){const O=L*v-b.left;for(let F=0;F<g;++F){let V=Number.MIN_SAFE_INTEGER,G=P<0?0:P,_=O<0?0:O;for(let Z=0;Z<S;++Z){const te=P+Z*k;if(te>=0&&te<p)for(let he=0;he<C;++he){const oe=O+he*I;if(oe>=0&&oe<m){const ve=d[D][te][oe][F]+h[Z][he][F];ve>V&&(V=ve,G=te,_=oe)}}}E[D][G][_][F]+=T[D][M][L][F]}}}return{dataId:l.write(Bi(E,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W3(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:c}=i||{},l=(c==null?void 0:c.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=o.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${d} type.`);const[f,p]=r.shape.slice(0,2),m=r.shape.length===2?1:r.shape[2],g=t.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(p*f*4);for(let w=0;w<f*p;++w){const v=[0,0,0,255*l];for(let C=0;C<m;C++){const k=g[w*m+C];if(r.dtype==="float32"){if(k<0||k>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${k}.`)}else if(r.dtype==="int32"&&(k<0||k>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${k}.`);m===1?(v[0]=k*x,v[1]=k*x,v[2]=k*x):v[C]=k*x}const S=w*4;y[S+0]=Math.round(v[0]),y[S+1]=Math.round(v[1]),y[S+2]=Math.round(v[2]),y[S+3]=Math.round(v[3])}o.width=p,o.height=f;const b=new ImageData(y,p,f);return h.putImageData(b,0,0),r}const B3={kernelName:t2,backendName:"cpu",kernelFunc:W3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"sum");let a;r.dtype==="bool"?a=qo({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=uo({inputs:{x:r},backend:t});const c=a.shape.length,l=Lt(o,a.shape),d=An(l,c);let h=l,f=a;d!=null&&(f=js({inputs:{x:a},backend:t,attrs:{perm:d}}),h=_n(h.length,c)),is("sum",h,f.shape.length);const[p,m]=Zn(f.shape,h),g=Us(f.dtype,"int32");let x=Ju(t,p,g);const y=fe(m),b=t.data.get(x.dataId).values,w=t.data.get(f.dataId).values;for(let v=0;v<b.length;++v){const S=v*y;let C=0;for(let k=0;k<y;++k)C+=w[S+k];b[v]=C}if(i){const v=zn(x.shape,l),S=x;x=mn({inputs:{x},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(S)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(f),x}const V3={kernelName:bh,backendName:"cpu",kernelFunc:Hl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U3(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=Xg(r,o.length);Yg(i.length,c,o);const{path:l,steps:d}=Jg(a,c),h=d.length;let f=null,p=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=Qg(p,c[x]);let w;Zg(y)?w=o[x]:(w=js({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(w));const v=w.shape.slice();for(let S=0;S<b.length;++S)v.splice(b[S],0,1);tn(w.shape,v)||(w=mn({inputs:{x:w},backend:t,attrs:{shape:v}}),m.push(w)),f===null?f=w:(f=Yh({inputs:{a:w,b:f},backend:t}),m.push(f))}g<h-1&&(l[g]>=0&&(f=Hl({inputs:{x:f},backend:t,attrs:{axis:l[g]-(i.length-p),keepDims:!1}}),m.push(f)),p--)}for(const g of m)g!==f&&t.disposeIntermediateTensorInfo(g);return f}const G3={kernelName:wm,backendName:"cpu",kernelFunc:U3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H3(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;ct([s,r],"eluGrad");const o=new Float32Array(fe(r.shape)),i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let c=0;c<i.length;++c){const l=i[c];l>=0?o[c]=a[c]:o[c]=a[c]*(l+1)}return t.makeTensorInfo(r.shape,"float32",o)}const q3={kernelName:vm,backendName:"cpu",kernelFunc:H3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K3=Bg,X3=Vg,Q3=Ug,Y3=Gg,J3=Hg,Z3=qg,ez=cn(Xc,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+K3*t);return e*(1-((((Z3*s+J3)*s+Y3)*s+Q3)*s+X3)*s*Math.exp(-t*t))}),tz={kernelName:Xc,backendName:"cpu",kernelFunc:ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function td(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let c=o;return o<0&&(R(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),mn({inputs:{x:r},backend:t,attrs:{shape:a}})}const nz={kernelName:Bd,backendName:"cpu",kernelFunc:td};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sz=Mn((n,e)=>n/e),E0=qn(qc,sz),Dp={kernelName:qc,backendName:"cpu",kernelFunc:E0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VN(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,l=[r,o],d=fe(l),h=us("float32",d),f=us("float32",d);for(let x=0;x<r;x++){const y=Oi({inputs:{x:a},backend:t,attrs:{begin:[x,0],size:[1,o]}}),b=Oi({inputs:{x:c},backend:t,attrs:{begin:[x,0],size:[1,o]}}),w=Ws({inputs:{real:y,imag:b},backend:t}),{real:v,imag:S}=rz(w,e,t),C=vo(v,S);for(let k=0;k<o;k++){const I=Kg(C,k);h[x*o+k]=I.real,f[x*o+k]=I.imag}t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w)}const p=t.makeTensorInfo(l,"float32",h),m=t.makeTensorInfo(l,"float32",f),g=Ws({inputs:{real:p,imag:m},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}function rz(n,e,t){const s=fe(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(oz(s)){const a=jp(o,i,s,e,t),c=[n.shape[0],n.shape[1]];if(e){const l=t.makeTensorInfo(c,"float32",a.real),d=t.makeTensorInfo(c,"float32",a.imag),h=t.makeTensorInfo([],"float32",Xo(s,"float32")),f=uo({inputs:{x:h},backend:t}),p=Dp.kernelFunc({inputs:{a:l,b:h},backend:t}),m=Dp.kernelFunc({inputs:{a:d,b:f},backend:t}),g=t.data.get(p.dataId).values,x=t.data.get(m.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),{real:g,imag:x}}return a}else{const a=vo(o,i),c=iz(a,s,e);return s1(c)}}function oz(n){return(n&n-1)===0}function jp(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=vo(n,e),i=t/2,a=r1(o),c=a.real,l=a.imag,d=[c.length],h=r.makeTensorInfo(d,"float32",c),f=r.makeTensorInfo(d,"float32",l),p=Ws({inputs:{real:h,imag:f},backend:r}),m=o1(o),g=m.real,x=m.imag,y=[g.length],b=r.makeTensorInfo(y,"float32",g),w=r.makeTensorInfo(y,"float32",x),v=Ws({inputs:{real:b,imag:w},backend:r}),S=jp(c,l,i,s,r),C=S.real,k=S.imag,I=[C.length],A=r.makeTensorInfo(I,"float32",C),T=r.makeTensorInfo(I,"float32",k),E=Ws({inputs:{real:A,imag:T},backend:r}),$=jp(g,x,i,s,r),D=$.real,M=$.imag,P=[D.length],L=r.makeTensorInfo(P,"float32",D),O=r.makeTensorInfo(P,"float32",M),F=Ws({inputs:{real:L,imag:O},backend:r}),V=a1(t,s),G=[V.real.length],_=r.makeTensorInfo(G,"float32",V.real),Z=r.makeTensorInfo(G,"float32",V.imag),te=Ws({inputs:{real:_,imag:Z},backend:r}),he=Yh({inputs:{a:te,b:F},backend:r}),oe=Aa({inputs:{a:E,b:he},backend:r}),ve=A0({inputs:{a:E,b:he},backend:r}),$e=Fi({inputs:{input:oe},backend:r}),Ae=Fi({inputs:{input:ve},backend:r}),De=Ra({inputs:{input:oe},backend:r}),we=Ra({inputs:{input:ve},backend:r}),Re=Ea({inputs:[$e,Ae],backend:r,attrs:{axis:0}}),et=Ea({inputs:[De,we],backend:r,attrs:{axis:0}}),je=r.data.get(Re.dataId).values,lt=r.data.get(et.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(O),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(te),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo($e),r.disposeIntermediateTensorInfo(De),r.disposeIntermediateTensorInfo(Ae),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(Re),r.disposeIntermediateTensorInfo(et),{real:je,imag:lt}}function iz(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const c=c1(r*a,e,t),l=Kg(n,a);o+=l.real*c.real-l.imag*c.imag,i+=l.real*c.imag+l.imag*c.real}t&&(o/=e,i/=e),i1(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(n){const{inputs:e,backend:t}=n,{input:s}=e,r=fe(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=mn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=VN(a,!1,t),l=mn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const cz={kernelName:Sm,backendName:"cpu",kernelFunc:az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D0(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||Ma(r),a=En(i,fe(s));return uz(a,r,i),e.makeTensorInfo(s,i,a)}const lz={kernelName:Cm,backendName:"cpu",kernelFunc:D0};function uz(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dz={kernelName:Nm,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=us(s.dtype,fe(s.shape)),[i,a,c,l]=s.shape,d=r.data.get(s.dataId).values;for(let f=0;f<i;f++){const p=f*c*a*l;for(let m=0;m<a;m++){const g=m*(c*l);for(let x=0;x<c;x++){const y=x*l;for(let b=0;b<l;b++){const w=Math.round(c-x-1),v=p+g+y+b;let S=d[v];if(w>=0&&w<c){const C=w*l,k=p+g+C+b;S=d[k]}o[v]=S}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s;let g=WN({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f}});if(i){const x=g;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const y=mn({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});g=Aa({inputs:{a:g,b:y},backend:t}),t.disposeIntermediateTensorInfo(y)}else g=Aa({inputs:{a:g,b:i},backend:t});t.disposeIntermediateTensorInfo(x)}if(p){const x=g;if(d==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=mn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});g=ed(t,g,p,y,m),t.disposeIntermediateTensorInfo(y)}else g=ed(t,g,p,a,m);t.disposeIntermediateTensorInfo(x)}return g}const fz={kernelName:Du,backendName:"cpu",kernelFunc:hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s;let g=BN({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f}});if(i){const x=g;g=Aa({inputs:{a:g,b:i},backend:t}),t.disposeIntermediateTensorInfo(x)}if(p){const x=g;g=ed(t,g,p,a,m),t.disposeIntermediateTensorInfo(x)}return g}const mz={kernelName:Tw,backendName:"cpu",kernelFunc:pz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=fe(s.shape),i=r.shape,a=i[i.length-1],[c,l,d,h]=Eg(s,r);if(l===0)return t.makeTensorInfo(c,s.dtype,[]);const f=t.data.get(r.dataId).values,p=t.bufferSync(s),m=ZC(f,p,s.dtype,l,a,d,h,s.shape,o);return t.makeTensorInfo(c,s.dtype,m.values)}const xz={kernelName:uw,backendName:"cpu",kernelFunc:gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;ct([r,o],"gatherV2");const c=Lt(i,r.shape)[0],l=t.data.get(o.dataId).values,d=r.shape[c];for(let v=0;v<l.length;++v){const S=l[v];R(S<=d-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${d-1}]`)}let h=a;a==null&&(h=0);const f=fe(o.shape),p=t0(r,o,c,h),m=mn({inputs:{x:r},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=mn({inputs:{x:o},backend:t,attrs:{shape:[p.batchSize,f/p.batchSize]}}),x=[p.batchSize,p.outerSize,f/p.batchSize,p.sliceSize],y=t.bufferSync(g),b=t.bufferSync(m),w=eN(b,y,x);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(p.outputShape,w.dtype,w.values)}const bz={kernelName:Ud,backendName:"cpu",kernelFunc:yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(n){const{inputs:e,backend:t}=n,{input:s}=e,r=fe(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=mn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=VN(a,!0,t),l=mn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const vz={kernelName:Im,backendName:"cpu",kernelFunc:wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sz=cn(nl,n=>Number.isFinite(n)?1:0,"bool"),Cz={kernelName:nl,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nz=cn(sl,n=>Math.abs(n)===1/0?1:0,"bool"),Iz={kernelName:sl,backendName:"cpu",kernelFunc:Nz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kz=cn(rl,n=>Number.isNaN(n)?1:0,"bool"),$z={kernelName:rl,backendName:"cpu",kernelFunc:kz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=oN(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const Az={kernelName:dw,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rz=cn(il,n=>Math.log1p(n)),Ez={kernelName:il,backendName:"cpu",kernelFunc:Rz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dz=Mn((n,e)=>n&&e),jz=qn(Xd,Dz,null,"bool"),_z={kernelName:Xd,backendName:"cpu",kernelFunc:jz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pz=cn(Qd,n=>n?0:1,"bool"),Mz={kernelName:Qd,backendName:"cpu",kernelFunc:Pz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fz=Mn((n,e)=>n||e),Oz=qn(Yd,Fz,null,"bool"),Lz={kernelName:Yd,backendName:"cpu",kernelFunc:Oz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s;ct(r,"LRN");const l=r.shape[3],d=l-1,h=t.data.get(r.dataId).values,f=fe(r.shape),p=new Float32Array(f);function m(g){const x=g%l;let y=g-x+Math.max(0,x-o);const b=g-x+Math.min(x+o,d);let w=0;for(;y<=b;y++){const v=h[y];w+=v*v}return w}for(let g=0;g<f;g++){const x=m(g),y=h[g]*Math.pow(i+a*x,-c);p[g]=y}return t.makeTensorInfo(r.shape,r.dtype,p)}const Wz={kernelName:Jd,backendName:"cpu",kernelFunc:zz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s;ct(i,"LRNGrad");const h=fe(i.shape),f=i.shape[3],p=t.data.get(i.dataId).values,m=t.data.get(r.dataId).values,g=t.data.get(o.dataId).values,x=new Float32Array(h),y=h;for(let b=0;b<y;b++){const w=b%f,v=b-w+Math.max(0,w-a),S=b-w+Math.min(f,w+a+1);let C=0;for(let k=v;k<S;k++)C+=Math.pow(m[k],2);C=l*C+c;for(let k=v;k<S;k++){let I=-2*l*d*m[k]*g[b]/C;b===k&&(I+=Math.pow(C,-d)),I*=p[b],x[k]+=I}}return t.makeTensorInfo(i.shape,r.dtype,x)}const Vz={kernelName:$m,backendName:"cpu",kernelFunc:Bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=t;let c=r.shape;const l=c.length,d=Lt(o,c);let h=d;const f=An(h,l);let p=a.data.get(r.dataId).values;if(f!=null){const v=new Array(l);for(let S=0;S<v.length;S++)v[S]=c[f[S]];p=$0(p,c,r.dtype,f,v),h=_n(h.length,l),c=v}ct(r,"max"),is("max",h,l);const[m,g]=Zn(c,h),x=fe(g),y=aN(p,x,m,r.dtype),b=a.write(y,m,r.dtype);let w=m;return i&&(w=zn(m,d)),{dataId:b,shape:w,dtype:r.dtype}}const Uz={kernelName:Zd,backendName:"cpu",kernelFunc:UN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;ct(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(fs(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=pr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&tn(d.inShape,d.outShape))h=uo({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,p=xt(r.shape),m=R0(f,r.shape,r.dtype,p,d,"max");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const Hz={kernelName:eh,backendName:"cpu",kernelFunc:Gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;ct(r,"maxPool3d");const d=Io(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,f=zN(h,r.shape,r.dtype,xt(r.shape),d,"max");return t.makeTensorInfo(f.shape,"float32",f.values)}const Kz={kernelName:th,backendName:"cpu",kernelFunc:qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;ct([r,o],"maxPool3DGrad");const d=Io(o.shape,i,a,1,c,l),h=t.bufferSync(o),f=FL(h,d),p=d.strideDepth,m=d.strideHeight,g=d.strideWidth,x=d.dilationDepth,y=d.dilationHeight,b=d.dilationWidth,w=d.effectiveFilterDepth,v=d.effectiveFilterHeight,S=d.effectiveFilterWidth,C=w-1-d.padInfo.front,k=S-1-d.padInfo.left,I=v-1-d.padInfo.top,A=Ot(o.shape,"float32"),T=t.bufferSync(r);for(let E=0;E<d.batchSize;++E)for(let $=0;$<d.inChannels;++$)for(let D=0;D<d.inDepth;++D)for(let M=0;M<d.inHeight;++M)for(let P=0;P<d.inWidth;++P){const L=D-C,O=M-I,F=P-k;let V=0;for(let G=0;G<w;G+=x){const _=(L+G)/p;if(!(_<0||_>=d.outDepth||Math.floor(_)!==_))for(let Z=0;Z<v;Z+=y){const te=(O+Z)/m;if(!(te<0||te>=d.outHeight||Math.floor(te)!==te))for(let he=0;he<S;he+=b){const oe=(F+he)/g;if(oe<0||oe>=d.outWidth||Math.floor(oe)!==oe)continue;const ve=w*v*S-1-f.get(E,_,te,oe,$),$e=G*v*S+Z*S+he,Ae=ve===$e?1:0;if(Ae===0)continue;const De=T.get(E,_,te,oe,$);V+=De*Ae}}}A.set(V,E,D,M,P,$)}return t.makeTensorInfo(A.shape,A.dtype,A.values)}const Qz={kernelName:Am,backendName:"cpu",kernelFunc:Xz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;ct([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,f=pr(a.shape,c,l,1,d,h),p=t.data.get(a.dataId).values,m=Ot(f.outShape,a.dtype,LN(p,a.shape,a.dtype,f).values),g=f.strideHeight,x=f.strideWidth,y=f.dilationHeight,b=f.dilationWidth,w=f.effectiveFilterHeight,v=f.effectiveFilterWidth,S=v-1-f.padInfo.left,C=w-1-f.padInfo.top,k=Ot(a.shape,"float32"),I=t.data.get(r.dataId).values,A=Ot(r.shape,"float32",I);for(let T=0;T<f.batchSize;++T)for(let E=0;E<f.inChannels;++E)for(let $=0;$<f.inHeight;++$)for(let D=0;D<f.inWidth;++D){const M=$-C,P=D-S;let L=0;for(let O=0;O<w;O+=y){const F=(M+O)/g;if(!(F<0||F>=f.outHeight||Math.floor(F)!==F))for(let V=0;V<v;V+=b){const G=(P+V)/x;if(G<0||G>=f.outWidth||Math.floor(G)!==G)continue;const _=w*v-1-m.get(T,F,G,E),Z=O*v+V,te=_===Z?1:0;if(te===0)continue;const he=A.get(T,F,G,E);L+=he*te}}k.set(L,T,$,D,E)}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Jz={kernelName:Tm,backendName:"cpu",kernelFunc:Yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(n,e,t,s,r){const o=xt(e),i=R0(n,e,t,o,r,"max"),a=LN(n,e,t,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eW={kernelName:hw,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;ct(s,"MaxPoolWithArgmax");const l=c.data.get(s.dataId).values,d=pr(s.shape,r,o,[1,1],i),[h,f]=Zz(l,s.shape,s.dtype,a,d),p=c.write(h,d.outShape,s.dtype),m=c.write(f,d.outShape,s.dtype);return[{dataId:p,shape:d.outShape,dtype:s.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=Lt(o,r.shape),l=Zn(r.shape,a)[1],d=fe(l),h=[],f=t.makeTensorInfo([],"float32",new Float32Array([d]));h.push(f);const p=qo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});h.push(p);const m=E0({inputs:{a:p,b:f},backend:t});h.push(m);const g=Hl({inputs:{x:m},backend:t,attrs:{axis:o,keepDims:i}});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const nW={kernelName:nh,backendName:"cpu",kernelFunc:tW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"min");const a=Lt(o,r.shape);let c=a;const l=An(c,r.shape.length);let d=r;l!=null&&(d=js({inputs:{x:r},backend:t,attrs:{perm:l}}),c=_n(c.length,r.shape.length)),is("min",c,d.shape.length);const[h,f]=Zn(d.shape,c),p=fe(f),m=ds(fe(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*p;let w=g[b];for(let v=0;v<p;++v){const S=g[b+v];(Number.isNaN(S)||S<w)&&(w=S)}m[y]=w}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=zn(h,a),b=mn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const rW={kernelName:sh,backendName:"cpu",kernelFunc:sW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;ct(r,"mirrorPad");const a=o.map((w,v)=>w[0]+r.shape[v]+w[1]),c=o.map(w=>w[0]),l=o.map((w,v)=>w[0]+r.shape[v]),d=i==="reflect"?0:1,h=t.data.get(r.dataId).values,f=r.shape.length,p=xt(r.shape),m=fe(a),g=a.length,x=xt(a),y=us(r.dtype,m);for(let w=0;w<m;w++){let v=Fa(w,g,x);for(let C=0;C<g;C++)v[C]<c[C]?v[C]=c[C]*2-v[C]-d:v[C]>=l[C]&&(v[C]=(l[C]-1)*2-v[C]+d);v=v.map((C,k)=>C-c[k]);const S=Zr(v,f,p);y[w]=h[S]}return{dataId:t.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const iW={kernelName:rh,backendName:"cpu",kernelFunc:oW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aW=Mn((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),cW=qn(ll,aW),lW={kernelName:ll,backendName:"cpu",kernelFunc:cW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GN(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const c=Lt([a],r.shape),l=UN({inputs:{x:r},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),d=zn(l.shape,c),h=mn({inputs:{x:l},backend:t,attrs:{shape:d}}),f=A0({inputs:{a:r,b:h},backend:t}),p=XC({inputs:{x:f},backend:t}),m=Hl({inputs:{x:p},backend:t,attrs:{axis:c,keepDims:!1}}),g=mn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=E0({inputs:{a:p,b:g},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const uW={kernelName:Sh,backendName:"cpu",kernelFunc:GN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;ct(r,"multinomial");const c=a?r:GN({inputs:{logits:r},backend:t,attrs:{dim:-1}}),l=c.shape[0],d=c.shape[1],h=t.data.get(c.dataId).values,f=[l,o],p=ds(fe(f),"int32");for(let m=0;m<l;++m){const g=m*d,x=new Float32Array(d-1);x[0]=h[g];for(let w=1;w<x.length;++w)x[w]=x[w-1]+h[g+w];const y=gg.alea(i.toString()),b=m*o;for(let w=0;w<o;++w){const v=y();p[b+w]=x.length;for(let S=0;S<x.length;S++)if(v<x[S]){p[b+w]=S;break}}}return a||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(f,"int32",p)}const hW={kernelName:fw,backendName:"cpu",kernelFunc:dW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fW=Ig;function pW(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s;ct(r,"NonMaxSuppression");const l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:h}=fW(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const mW={kernelName:Rm,backendName:"cpu",kernelFunc:pW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gW=kg;function xW(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s;ct(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,{selectedIndices:f,validOutputs:p}=gW(d,h,i,a,c,l);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const yW={kernelName:Em,backendName:"cpu",kernelFunc:xW};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bW=$g;function wW(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s;ct(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,f=i,p=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=bW(d,h,f,p,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const vW={kernelName:Dm,backendName:"cpu",kernelFunc:wW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s;ct(r,"oneHot");const l=fe(r.shape),d=new Float32Array(l*i);d.fill(c);const h=t.data.get(r.dataId).values;for(let f=0;f<l;++f)h[f]>=0&&h[f]<i&&(d[f*i+h[f]]=a);return t.makeTensorInfo([...r.shape,i],o,d)}const CW={kernelName:ch,backendName:"cpu",kernelFunc:SW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nd(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Fi({inputs:{input:s},backend:t}),o=nd({inputs:{x:r},backend:t}),i=Ra({inputs:{input:s},backend:t}),a=nd({inputs:{x:i},backend:t}),c=Ws({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return D0({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const NW={kernelName:Ih,backendName:"cpu",kernelFunc:nd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HN(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Fi({inputs:{input:s},backend:t}),o=HN({inputs:{x:r},backend:t}),i=Ra({inputs:{input:s},backend:t}),a=nd({inputs:{x:i},backend:t}),c=Ws({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return D0({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const IW={kernelName:ah,backendName:"cpu",kernelFunc:HN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return td({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Zp(o,d.shape,"All tensors passed to stack must have matching shapes"),R(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=td({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=Ea({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const kW={kernelName:lh,backendName:"cpu",kernelFunc:qN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $W(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;ct(r,"pad");const a=o.map((b,w)=>b[0]+r.shape[w]+b[1]),c=o.map(b=>b[0]),l=t.data.get(r.dataId).values,d=fe(r.shape),h=r.shape.length,f=xt(r.shape),p=fe(a),m=a.length,g=xt(a),x=us(r.dtype,p);i!==0&&x.fill(i);for(let b=0;b<d;b++){const v=Fa(b,h,f).map((C,k)=>C+c[k]),S=Zr(v,m,g);x[S]=l[b]}return{dataId:t.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const KN={kernelName:uh,backendName:"cpu",kernelFunc:$W};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TW=Mn((n,e)=>Math.pow(n,e)),AW=qn(dl,TW),RW={kernelName:dl,backendName:"cpu",kernelFunc:AW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.data.get(y.dataId).values),l=r.map(y=>y.shape),d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,[f,p,m]=fN(c,l,d,o.shape,o.dtype,h,i.shape),g=f.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,p);return g.concat([x])}const DW={kernelName:pw,backendName:"cpu",kernelFunc:EW};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=pN(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),f=t.makeTensorInfo([d.length],s.dtype,d);return[h,f]}const _W={kernelName:mw,backendName:"cpu",kernelFunc:jW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PW(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,f=a.map(x=>t.data.get(x.dataId).values),p=a.map(x=>x.shape),[m,g]=mN(l,r.shape,d,o.shape,o.dtype,h,i.shape,f,p,c);return t.makeTensorInfo(m,o.dtype,g)}const MW={kernelName:gw,backendName:"cpu",kernelFunc:PW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,a=gN(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const OW={kernelName:jm,backendName:"cpu",kernelFunc:FW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LW=cn(hl,n=>1/n),zW={kernelName:hl,backendName:"cpu",kernelFunc:LW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;ct(r,"resizeBilinear");const c=xt(r.shape),[l,d]=a,[h,f,p,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(fe([h,l,d,m])),y=[o&&l>1?f-1:f,o&&d>1?p-1:p],b=[o&&l>1?l-1:l,o&&d>1?d-1:d];let w=0;const v=y[0]/b[0],S=y[1]/b[1];for(let C=0;C<h;C++)for(let k=0;k<l;k++){let I;i?I=v*(k+.5)-.5:I=v*k;const A=Math.max(0,Math.floor(I)),T=I-A,E=Math.min(f-1,Math.ceil(I)),$=C*c[0]+A*c[1],D=C*c[0]+E*c[1];for(let M=0;M<d;M++){let P;i?P=S*(M+.5)-.5:P=S*M;const L=Math.max(0,Math.floor(P)),O=P-L,F=Math.min(p-1,Math.ceil(P)),V=$+L*c[2],G=D+L*c[2],_=$+F*c[2],Z=D+F*c[2];for(let te=0;te<m;te++){const he=g[V+te],oe=g[G+te],ve=g[_+te],$e=g[Z+te],Ae=he+(ve-he)*O,De=oe+($e-oe)*O,we=Ae+(De-Ae)*T;x[w++]=we}}}return t.makeTensorInfo([h,l,d,m],"float32",x)}const BW={kernelName:mh,backendName:"cpu",kernelFunc:WW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;ct([o,r],"resizeBilinearGrad");const a=xt(r.shape),[c,l,d,h]=r.shape,[,f,p]=o.shape,m=new Float32Array(c*l*d*h),g=[i&&f>1?l-1:l,i&&p>1?d-1:d],x=[i&&f>1?f-1:f,i&&p>1?p-1:p],y=g[0]/x[0],b=g[1]/x[1],w=t.data.get(o.dataId).values;let v=0;for(let S=0;S<c;S++){const C=S*a[0];for(let k=0;k<f;k++){const I=k*y,A=Math.floor(I),T=Math.min(Math.ceil(I),l-1),E=C+A*a[1],$=C+T*a[1],D=I-A,M=1-D;for(let P=0;P<p;P++){const L=P*b,O=Math.floor(L),F=Math.min(Math.ceil(L),d-1),V=L-O,G=1-V,_=E+O*a[2],Z=E+F*a[2],te=$+O*a[2],he=$+F*a[2],oe=M*G,ve=M*V,$e=D*G,Ae=D*V;for(let De=0;De<h;De++){const we=w[v++];m[_+De]+=we*oe,m[Z+De]+=we*ve,m[te+De]+=we*$e,m[he+De]+=we*Ae}}}}return t.makeTensorInfo([c,d,l,h],"float32",m)}const UW={kernelName:Mm,backendName:"cpu",kernelFunc:VW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;ct(r,"resizeNearestNeighbor");const c=xt(r.shape),[l,d]=a,[h,f,p,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(h*l*d*m),y=[o&&l>1?f-1:f,o&&d>1?p-1:p],b=[o&&l>1?l-1:l,o&&d>1?d-1:d],w=y[0]/b[0],v=y[1]/b[1];let S=0;for(let C=0;C<h;C++){const k=C*c[0];for(let I=0;I<l;I++){const A=i?w*(I+.5):w*I;let T=Math.min(f-1,o?Math.round(A):Math.floor(A));i&&(T=Math.max(0,T));const E=k+T*c[1];for(let $=0;$<d;$++){const D=i?v*($+.5):v*$;let M=Math.min(p-1,o?Math.round(D):Math.floor(D));i&&(M=Math.max(0,M));const P=E+M*c[2];for(let L=0;L<m;L++){const O=g[P+L];x[S++]=O}}}}return t.makeTensorInfo([h,l,d,m],r.dtype,x)}const HW={kernelName:ph,backendName:"cpu",kernelFunc:GW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;ct([o,r],"resizeNearestNeighborGrad");const a=xt(r.shape),c=xt(o.shape),[l,d,h,f]=r.shape,[,p,m]=o.shape,g=new Float32Array(l*d*h*f),x=t.data.get(o.dataId).values,y=[i&&p>1?d-1:d,i&&m>1?h-1:h],b=[i&&p>1?p-1:p,i&&m>1?m-1:m],w=y[0]/b[0],v=y[1]/b[1],S=1/w,C=1/v,k=Math.ceil(S)*2+2,I=Math.ceil(C)*2+2;for(let A=0;A<l;A++){const T=A*a[0];for(let E=0;E<d;E++){const $=T+E*a[1],D=Math.floor(E*S),M=Math.floor(D-k/2);for(let P=0;P<h;P++){const L=$+P*a[2],O=Math.floor(P*C),F=Math.floor(O-I/2);for(let V=0;V<f;V++){let G=0;for(let _=0;_<k;_++){const Z=_+M;if(Z<0||Z>=p)continue;const te=T+Z*c[1],he=Z*w,oe=Math.min(d-1,i?Math.round(he):Math.floor(he));if(E===oe)for(let ve=0;ve<I;ve++){const $e=ve+F;if($e<0||$e>=m)continue;const Ae=te+$e*c[2],De=$e*v,we=Math.min(h-1,i?Math.round(De):Math.floor(De));P===we&&(G+=x[Ae+V])}}g[L+V]=G}}}}return t.makeTensorInfo(r.shape,r.dtype,g)}const KW={kernelName:Pm,backendName:"cpu",kernelFunc:qW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;ct(r,"reverse");const i=r.shape.length,a=Lt(o,r.shape);if(i===0)return uo({inputs:{x:r},backend:t});const c=new rs(r.shape,r.dtype),l=t.bufferSync(r);for(let d=0;d<c.size;d++){const h=c.indexToLoc(d),f=h.slice();a.forEach(p=>f[p]=r.shape[p]-1-f[p]),c.set(l.get(...f),...h)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}const QW={kernelName:gh,backendName:"cpu",kernelFunc:XW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW={kernelName:Vm,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=us(s.dtype,fe(s.shape)),[l,d,h,f]=s.shape,[p,m]=Lg(i,d,h),g=255,x=Math.sin(r),y=Math.cos(r),b=a.data.get(s.dataId).values;for(let v=0;v<l;v++){const S=v*h*d*f;for(let C=0;C<d;C++){const k=C*(h*f);for(let I=0;I<h;I++){const A=I*f;for(let T=0;T<f;T++){const E=[l,C,I,T],$=E[2],D=E[1];let M=($-p)*y-(D-m)*x,P=($-p)*x+(D-m)*y;M=Math.round(M+p),P=Math.round(P+m);let L=o;if(typeof o!="number"&&(T===3?L=g:L=o[T]),M>=0&&M<h&&P>=0&&P<d){const F=P*(h*f),V=M*f,G=S+F+V+T;L=b[G]}const O=S+k+A+T;c[O]=L}}}}return{dataId:a.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JW=cn(ml,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),ZW={kernelName:ml,backendName:"cpu",kernelFunc:JW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=Hi(o,r,i),f=!0,p=t.bufferSync(r),m=t.bufferSync(o),g=bi(p,m,i,h,l,c,a,d,0,f);return t.makeTensorInfo(i,g.dtype,g.values)}const tB={kernelName:xw,backendName:"cpu",kernelFunc:eB};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function sB(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function rB(n,e,t,s,r,o){const i=En("int32",t*r);for(let a=0;a<t;++a){const c=n.slice(a*s,(a+1)*s),l=a*r;for(let d=0;d<r;++d)i[l+d]=o==="left"?nB(c,e[d+l]):sB(c,e[d+l])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=rB(a,c,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",l)}const iB={kernelName:bw,backendName:"cpu",kernelFunc:oB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;ct([s,r,o],"select");const i=s.shape.length,a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=Us(r.dtype,o.dtype),h=ds(fe(r.shape),d);let f=0;const p=i===0||i>1||r.shape.length===1?1:fe(r.shape.slice(1));for(let m=0;m<a.length;m++)for(let g=0;g<p;g++)a[m]===1?h[f++]=c[m]:h[f++]=l[m];return t.makeTensorInfo(r.shape,d,h)}const cB={kernelName:xh,backendName:"cpu",kernelFunc:aB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lB=Fh,uB=Oh,dB=cn(xl,n=>n>=0?uB*n:lB*(Math.exp(n)-1)),hB={kernelName:xl,backendName:"cpu",kernelFunc:dB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fB=cn(wl,n=>n<0?-1:n>0?1:0),pB={kernelName:wl,backendName:"cpu",kernelFunc:fB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mB=cn(yl,n=>Math.sin(n)),gB={kernelName:yl,backendName:"cpu",kernelFunc:mB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xB=cn(bl,n=>Math.sinh(n)),yB={kernelName:bl,backendName:"cpu",kernelFunc:xB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bB=11920928955078125e-23,Py=Math.log(bB)+2,wB=cn(Sl,n=>{const e=n>-Py,t=n<Py,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),vB={kernelName:Sl,backendName:"cpu",kernelFunc:wB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;ct([r],"spaceToBatchND");const a=fe(o),c=[[0,0]];c.push(...i);for(let C=1+o.length;C<r.shape.length;++C)c.push([0,0]);const l=KN.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),d=Pl(l.shape,o,a,!1),h=Ml(d.length,o.length,!1),f=Fl(l.shape,o,a,!1),g=mn({inputs:{x:l},backend:t,attrs:{shape:d}}),b=js({inputs:{x:g},backend:t,attrs:{perm:h}}),S=mn({inputs:{x:b},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),S}const CB={kernelName:wh,backendName:"cpu",kernelFunc:SB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[h,f,p,m,g]=wN(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(f,s.dtype,h),t.makeTensorInfo([f[0]],r.dtype,p),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const IB={kernelName:ww,backendName:"cpu",kernelFunc:NB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,c=Array.from(t.data.get(o.dataId).values),[l,d,h]=vN(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const $B={kernelName:vw,backendName:"cpu",kernelFunc:kB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=T0(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const AB={kernelName:Sw,backendName:"cpu",kernelFunc:TB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=T0(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const EB={kernelName:Cw,backendName:"cpu",kernelFunc:RB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:f}=Hi(o,r,a),p=!1,m=t.bufferSync(r);let g;switch(o.dtype){case"bool":{const x=t.bufferSync(o),y=!!t.data.get(i.dataId).values[0];g=bi(m,x,a,f,d,l,c,h,y,p);break}case"float32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=bi(m,x,a,f,d,l,c,h,y,p);break}case"int32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=bi(m,x,a,f,d,l,c,h,y,p);break}case"string":{const x=t.bufferSync(o),y=Bo(t.data.get(i.dataId).values[0]);g=bi(m,x,a,f,d,l,c,h,y,p);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,g.dtype,g.values)}const jB={kernelName:Nw,backendName:"cpu",kernelFunc:DB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Lt(i,r.shape)[0],c=e0(r,o,a),l=new Array(r.shape.length).fill(0),d=r.shape.slice();return c.map(h=>{const f=[...d];f[a]=h;const p=Oi({inputs:{x:r},backend:t,attrs:{begin:l,size:f}});return l[a]+=h,p})}const PB={kernelName:vh,backendName:"cpu",kernelFunc:_B};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MB={kernelName:Fm,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;ct(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const c=r[a];o[a]=c*c}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FB=cn(Al,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),OB={kernelName:Al,backendName:"cpu",kernelFunc:FB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=s;ct(r,"stridedSlice");const{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:w,strides:v}=Mg(r.shape,o,i,a,c,l,d,h,f);let S;if(g)S=mn({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){R(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=jg(b,w,v),k=Oi({inputs:{x:r},backend:t,attrs:{begin:b,size:C}});S=mn({inputs:{x:k},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(k)}else{const C=t.bufferSync(r),k=NN(p,C,v,b);S=t.makeTensorInfo(m,k.dtype,k.values)}return S}const zB={kernelName:Lm,backendName:"cpu",kernelFunc:LB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,f=t.data.get(d.dataId).values,p=t.data.get(h.dataId).values,[m,g]=IN(f,p,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const BB={kernelName:Iw,backendName:"cpu",kernelFunc:WB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values[0],[l,d,h]=kN(a,c,r),f=d.length;return[t.makeTensorInfo([f,2],"int32",l),t.makeTensorInfo([f],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const UB={kernelName:kw,backendName:"cpu",kernelFunc:VB};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=$N(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const HB={kernelName:$w,backendName:"cpu",kernelFunc:GB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qB=cn(kl,n=>Math.tan(n)),KB={kernelName:kl,backendName:"cpu",kernelFunc:qB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XB=cn($l,n=>Math.tanh(n)),QB={kernelName:$l,backendName:"cpu",kernelFunc:XB};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:c,strides:l,outputSize:d}=Hi(o,r,s.shape),h=!1,f=t.bufferSync(r),p=t.bufferSync(o),m=t.bufferSync(s),g=bi(f,p,s.shape,d,c,a,i,l,m,h);return t.makeTensorInfo(s.shape,g.dtype,g.values)}const JB={kernelName:yw,backendName:"cpu",kernelFunc:YB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;ct(r,"tile");const i=AN(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const e4={kernelName:Tl,backendName:"cpu",kernelFunc:ZB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;ct(r,"topk");const a=t.data.get(r.dataId).values,[c,l]=EN(a,r.shape,r.dtype,o,i);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}const n4={kernelName:zm,backendName:"cpu",kernelFunc:t4};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=t,[d,h,f,p]=r.shape,[m,g]=l??[h,f],x=[d,m,g,p],y=xt(r.shape),b=y[0],w=y[1],v=y[2],S=xt(x),C=S[0],k=S[1],I=S[2],A=us(r.dtype,fe(x));A.fill(c);const T=s.data.get(r.dataId).values,E=s.data.get(o.dataId).values;for(let D=0;D<d;++D){const M=o.shape[0]===1?E:E.subarray(D*8,D*8+8);for(let P=0;P<m;++P)for(let L=0;L<g;++L)for(let O=0;O<p;++O){let F;const V=M[6]*L+M[7]*P+1;if(V===0)continue;const G=(M[0]*L+M[1]*P+M[2])/V,_=(M[3]*L+M[4]*P+M[5])/V,Z=My(G,f,a),te=My(_,h,a);switch(i){case"nearest":F=l4(T,h,f,b,w,v,D,te,Z,O,c);break;case"bilinear":F=u4(T,h,f,b,w,v,D,te,Z,O,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const he=D*C+P*k+L*I+O;A[he]=F}return s.makeTensorInfo(x,r.dtype,A)}return{dataId:s.write(A,x,r.dtype),shape:r.shape,dtype:r.dtype}}const r4={kernelName:Wm,backendName:"cpu",kernelFunc:s4};function My(n,e,t){switch(t){case"reflect":return o4(n,e);case"wrap":return i4(n,e);case"nearest":return c4(n,e);case"constant":default:return a4(n)}}function o4(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return Ii(0,t,e-1)}function i4(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return Ii(0,t,e-1)}function a4(n,e){return n}function c4(n,e){return Ii(0,n,e-1)}function lc(n,e,t,s,r,o,i,a,c,l,d){const h=i*s+a*r+c*o+l;return 0<=a&&a<e&&0<=c&&c<t?n[h]:d}function l4(n,e,t,s,r,o,i,a,c,l,d){const h=Math.round(a),f=Math.round(c);return lc(n,e,t,s,r,o,i,h,f,l,d)}function u4(n,e,t,s,r,o,i,a,c,l,d){const h=Math.floor(a),f=Math.floor(c),p=h+1,m=f+1,g=(m-c)*lc(n,e,t,s,r,o,i,h,f,l,d)+(c-f)*lc(n,e,t,s,r,o,i,h,m,l,d),x=(m-c)*lc(n,e,t,s,r,o,i,p,f,l,d)+(c-f)*lc(n,e,t,s,r,o,i,p,m,l,d);return(p-a)*g+(a-h)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;ct(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:c,indices:l}=DN(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const h4={kernelName:Bm,backendName:"cpu",kernelFunc:d4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],c=new Array(i-1);let l=0;for(let p=0;p<i;p++)p!==o&&(c[l++]=r.shape[p]);const d=new Array(i).fill(0),h=r.shape.slice();h[o]=1;const f=new Array(a);for(let p=0;p<f.length;p++){d[o]=p;const m=Oi({inputs:{x:r},backend:t,attrs:{begin:d,size:h}});f[p]=mn({inputs:{x:m},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(m)}return f}const p4={kernelName:Ch,backendName:"cpu",kernelFunc:f4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;ct(r,"unsortedSegmentSum");const a=r.shape.length,c=o.shape.length,l=[],d=[],h=a-c;let f=o;for(let m=0;m<h;++m){const g=td({inputs:{input:f},backend:t,attrs:{dim:m+1}});f=g,d.push(g)}for(let m=0;m<i;++m){const g=Xo(m,"int32"),x=t.makeTensorInfo([],"int32",g),y=qC({inputs:{a:x,b:f},backend:t}),b=qo({inputs:{x:y},backend:t,attrs:{dtype:"float32"}}),w=Yh({inputs:{a:b,b:r},backend:t}),v=Hl({inputs:{x:w},backend:t,attrs:{axis:0,keepDims:!1}});l.push(v),d.push(x),d.push(y),d.push(b),d.push(w),d.push(v)}const p=qN({inputs:l,backend:t,attrs:{axis:0}});return d.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const g4={kernelName:Nh,backendName:"cpu",kernelFunc:m4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x4=[dL,GF,fL,mL,YF,xL,bL,vL,CL,IL,$L,AL,EL,_L,ML,LL,WL,VL,GL,lL,qL,XL,YL,ZF,ZL,XF,tO,t3,HF,s3,o3,i3,c3,u3,h3,p3,g3,y3,w3,S3,N3,k3,T3,R3,E3,j3,P3,F3,O3,L3,z3,B3,G3,nL,q3,nO,tz,sO,nz,oO,cz,lz,dz,aO,lO,fz,mz,xz,bz,dO,fO,qF,vz,r3,Cz,Iz,$z,sL,mO,xO,Az,bO,Ez,_z,Mz,Lz,Wz,Vz,Uz,vO,Hz,Kz,Qz,Jz,eW,nW,rW,CO,iW,lW,hW,IO,$O,mW,yW,vW,AO,CW,IW,kW,KN,RW,oL,DO,DW,_W,MW,OW,KF,Dp,zW,iL,aL,cL,BW,UW,HW,KW,QW,YW,ZW,zO,tB,iB,cB,hB,BO,pB,gB,yB,VO,uW,vB,CB,IB,$B,AB,EB,jB,PB,HO,MB,KO,QO,OB,zB,BB,UB,HB,eL,V3,KB,QB,JB,e4,n4,r4,RO,h4,p4,g4,NW];for(const n of x4)Aw(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mi={},cu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function y4(n,e){mi[n]=e}function Pr(n,e){if(!(n in mi)||e!=null){const s=w4(n,e);if(s!==null)mi[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=mi[n];return t==null||t.isContextLost()?(delete mi[n],Pr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),mi[n])}function b4(n){if(!ce().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function w4(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??b4(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete mi[n]},!1),ce().getBool("SOFTWARE_WEBGL_ENABLED")&&(cu.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",cu)||t.getContext("experimental-webgl",cu):t.getContext("webgl2",cu)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Tc;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Tc||(Tc={}));var Qs;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Qs||(Qs={}));var ss;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ss||(ss={}));function ql(n,e){return[e,n]}function v4(n,e){return n*e}function lu(n){const e=fe(n),t=Math.ceil(e/4);return ep(t)}function Ua(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function S4(n,e){const[t,s]=Ua(n,e);return t*s*4}function j0(n,e){const t=n;let s,r,o,i,a,c,l,d,h,f;return ce().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,l=4,d=1,h=t.HALF_FLOAT,f=t.FLOAT,c=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,l=4,d=4,h=e!=null?e.HALF_FLOAT_OES:null,f=n.FLOAT,c=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Je(n,e){const t=e();return ce().getBool("DEBUG")&&C4(n),t}function C4(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+$4(n,e))}const N4=596e-10,I4=65504;function k4(n){return!!(ce().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||N4<Math.abs(n)&&Math.abs(n)<I4)}function $4(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function uu(n,e){return $o(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function T4(n,e){const t=$o(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Je(n,()=>n.shaderSource(t,e)),Je(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function A4(n,e){const t=$o(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Je(n,()=>n.shaderSource(t,e)),Je(n,()=>n.compileShader(t)),ce().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw XN(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const R4=/ERROR: [0-9]+:([0-9]+):/g;function XN(n,e){const t=R4.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((h,f)=>da((f+1).toString(),o)+h);let a=0;for(let h=0;h<i.length;h++)a=Math.max(i[h].length,a);const c=i.slice(0,s-1),l=i.slice(s-1,s),d=i.slice(s);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${da(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function E4(n){return $o(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function D4(n,e){if(Je(n,()=>n.linkProgram(e)),!ce().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Rf(n,e){if(Je(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function j4(n,e){const t=$o(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Je(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Je(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function _4(n,e){const t=$o(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Je(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Je(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function P4(n){return $o(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function M4(n,e){const t=ce().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function F4(n){return $o(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Fy(n,e,t,s,r,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Je(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Je(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Je(n,()=>n.enableVertexAttribArray(a)),!0)}function O4(n,e,t){V4(n,t),Je(n,()=>n.activeTexture(n.TEXTURE0+t)),Je(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function L4(n,e,t){return $o(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function z4(n,e,t){return n.getUniformLocation(e,t)}function W4(n,e,t,s){Je(n,()=>O4(n,e,s)),Je(n,()=>n.uniform1i(t,s))}function Ef(n,e,t){Je(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Je(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function Oy(n,e){Je(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Je(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function du(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+B4(n,e))}function B4(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function $o(n,e,t){const s=Je(n,()=>e());if(s==null)throw new Error(t);return s}function V4(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Da(n,e=2){return fe(n.slice(0,n.length-e))}function ja(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function hu(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Da(n),...ja(n)]),e}function U4(n,e=!1){let t=ce().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ce().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ce().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,c)=>c>=n.length-2?Jp(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Ko(n).newShape);let r=fe(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=Da(n);let c=2,l=2;n.length&&([c,l]=ja(n)),r=a*(c/2)*(l/2),o=ep(r).map(d=>d*2)}else o=ep(r);return o}function fu(n){return n%2===0}function sd(n,e){if(n=n.slice(-2),e=e.slice(-2),tn(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||fu(t)&&fu(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&fu(n[0])&&fu(e[0])}let Df,jf;function G4(n){if(Df==null){const e=Pr(n);Df=e.getParameter(e.MAX_TEXTURE_SIZE)}return Df}function H4(n){if(jf==null){const e=Pr(n);jf=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,jf)}function q4(n){if(n===0)return 0;let e;const t=Pr(n);return dr(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:dr(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function dr(n,e){return n.getExtension(e)!=null}function Ly(n){try{if(Pr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function K4(n){if(n===0)return!1;const e=Pr(n);if(n===1){if(!dr(e,"OES_texture_float"))return!1}else if(!dr(e,"EXT_color_buffer_float"))return!1;return _p(e)}function X4(n){if(n===0)return!1;const e=Pr(n);if(n===1){if(!dr(e,"OES_texture_float")||!dr(e,"WEBGL_color_buffer_float"))return!1}else{if(dr(e,"EXT_color_buffer_float"))return _p(e);const s="EXT_color_buffer_half_float";if(dr(e,s)){const r=e.getExtension(s);return Q4(e,r)}return!1}return _p(e)}function _p(n){const e=j0(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function Q4(n,e){const t=j0(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function Y4(n){return n!==2?!1:Pr(n).fenceSync!=null}function Kl(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&R(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ut=ce();ut.registerFlag("HAS_WEBGL",()=>ut.getNumber("WEBGL_VERSION")>0);ut.registerFlag("WEBGL_VERSION",()=>Ly(2)?2:Ly(1)?1:0);ut.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ut.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ut.get("WEBGL_VERSION")===2);ut.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ut.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ut.registerFlag("WEBGL_PACK",()=>ut.getBool("HAS_WEBGL"));ut.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_CLIP",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_REDUCE",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_LAZILY_UNPACK",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_CONV_IM2COL",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ut.getBool("WEBGL_PACK"));ut.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>G4(ut.getNumber("WEBGL_VERSION")));ut.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>H4(ut.getNumber("WEBGL_VERSION")));ut.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=ut.getNumber("WEBGL_VERSION");return n===0?0:q4(n)});ut.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ut.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Hw());ut.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>K4(ut.getNumber("WEBGL_VERSION")));ut.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ut.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ut.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ut.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>X4(ut.getNumber("WEBGL_VERSION")));ut.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Y4(ut.getNumber("WEBGL_VERSION")));ut.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ut.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ut.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});ut.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Hw()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});ut.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ut.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ut.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ut.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ut.registerFlag("WEBGL_EXP_CONV",()=>!1);ut.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ut.getBool("IS_TEST"));ut.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ut.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ut.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ut.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ns(){let n,e,t,s,r,o,i,a,c,l;return ce().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=ce().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(n,e,t="index"){const s=xt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function Jh(n,e,t="index"){const s=xt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function J4(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function Z4(n,e,t="index"){const s=n.map((o,i)=>i),r=J4(s,e);return r.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${r[i]}`,c=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${c};`}).join("")}function _0(n){const e=xt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function P0(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const QN=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:YN}=Oj;function e5(n,e,t){const s=[];if(n.forEach(p=>{const m=fe(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${m>1?`[${m}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),t.enableShapeUniforms){const{uniformShape:g}=M0(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(p=>t5(p,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=Ns(),c=r5(a);let l,d,h=a5(a);return e.isPacked?(l=n5(e.logicalShape,i,t.enableShapeUniforms),d=i5(a)):(l=s5(e.logicalShape,i,t.enableShapeUniforms),d=o5(a)),t.packedInputs&&(h+=d5),[h,c,d,r,l,o,t.userCode].join(`
`)}function Ga(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return C5(n,e);case 1:return I5(n,e);case 2:return $5(n,e);case 3:return A5(n,e);case 4:return E5(n,e);case 5:return D5(n);case 6:return j5(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function JN(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return S5(n);case 1:return N5(n,e);case 2:return k5(n,e);case 3:return T5(n,e);default:return R5(n,e)}}function t5(n,e,t=!1,s){let r="";t?r+=JN(n,s):r+=Ga(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=_5(n,e):r+=P5(n,e)),r}function n5(n,e,t){switch(n.length){case 0:return ZN();case 1:return h5(n,e,t);case 2:return w5(n,e,t);case 3:return p5(n,e,t);default:return g5(n,e,t)}}function s5(n,e,t){switch(n.length){case 0:return ZN();case 1:return f5(n,e,t);case 2:return v5(n,e,t);case 3:return m5(n,e,t);case 4:return x5(n,e,t);case 5:return y5(n,e);case 6:return b5(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function r5(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function o5(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function i5(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function a5(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${c5}
    ${l5}
    ${u5}
  `}const c5=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,l5=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,u5=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,d5=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ZN(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function h5(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function f5(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function p5(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function m5(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Jh(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Xi(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function g5(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",c="b, r, c";for(let l=2;l<n.length-1;l++)i*=n[n.length-l-1],a=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+a,c=`b${l}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${c});
    }
  `}function x5(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Jh(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Xi(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function y5(n,e){const t=Xi(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function b5(n,e){const t=Xi(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function w5(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(tn(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function v5(n,e,t){return tn(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Qi(n){return`offset${n}`}function S5(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Ns();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function C5(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Qi(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,c]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function N5(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=Ns();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function I5(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Ha(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Qi(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function k5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],c=Ns();if(o!=null&&tn(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function $5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&tn(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Ko(t),c=i;if(c.length<t.length){const f=qa(n,c),p=["row","col"];return`
      ${Ga(f,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ka(p,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Ha(n)}
      }
    `;const l=o[0],d=o[1],h=Qi(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function T5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const f=t.slice(1),p=[1,2],m=qa(n,f),g=["b","row","col"];return`
        ${JN(m,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ka(g,p)});
        }
      `}const a=Ns();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const c=i[0],l=i[1],d=Math.ceil(t[2]/2),h=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function A5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:c}=Ko(t),l=a;if(l.length<t.length){const g=qa(n,l),x=["row","col","depth"];return`
        ${Ga(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ka(x,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Ha(n)}
      }
    `;const d=n.shapeInfo.texShape,h=d[0],f=d[1],p=n.shapeInfo.flatOffset;if(f===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const m=Qi(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function R5(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ns();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],d=c[1],h=Math.ceil(o[i-1]/2);let f=h*Math.ceil(o[i-2]/2),p="int b, int row, int col",m=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<i-1;g++)p=`int b${g}, `+p,f*=o[i-g-1],m=`b${g} * ${f} + `+m;return`
    vec4 ${s}(${p}) {
      int index = ${m};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${l});
      return ${r.texture2D}(${t}, uv);
    }
  `}function E5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:c,keptDims:l}=Ko(t);if(c.length<t.length){const b=qa(n,c),w=["row","col","depth","depth2"];return`
      ${Ga(b,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ka(w,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Ha(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],p=h[1],m=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${m}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Qi(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function D5(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:c,keptDims:l}=Ko(e);if(c.length<e.length){const g=qa(n,c),x=["row","col","depth","depth2","depth3"];return`
      ${Ga(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Ka(x,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Ha(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],p=h[1];if(p===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const m=Qi(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function j5(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=Ko(e);if(r.length<e.length){const x=qa(n,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ga(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Ka(y,o)});
      }
    `}const i=e[5],a=e[4]*i,c=e[3]*a,l=e[2]*c,d=e[1]*l;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ha(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],m=f[1];if(m===d&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(m===i&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const g=Qi(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Ha(n){const e=n.name,t=fe(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function _5(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=YN(n.shapeInfo.logicalShape,e.logicalShape),c=ln(i),l=i-o;let d;const h=["x","y","z","w","u","v"];o===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(b=>`coords.${h[b+l]} = 0;`).join(`
`);let f="";i<2&&o>0?f="coords":f=n.shapeInfo.logicalShape.map((b,w)=>`coords.${h[w+l]}`).join(", ");let p="return outputValue;";const g=fe(n.shapeInfo.logicalShape)===1,y=fe(e.logicalShape)===1;if(o===1&&!g&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)i===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=o-2,w=o-1;a.indexOf(b)>-1&&a.indexOf(w)>-1?p="return vec4(outputValue.x);":a.indexOf(b)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(w)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${f});
      ${p}
    }
  `}function P5(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===c&&n.shapeInfo.flatOffset==null&&tn(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const l=ln(c),d=YN(n.shapeInfo.logicalShape,e.logicalShape),h=c-a;let f;const p=["x","y","z","w","u","v"];a===0?f="":c<2&&d.length>=1?f="coords = 0;":f=d.map(g=>`coords.${p[g+h]} = 0;`).join(`
`);let m="";return c<2&&a>0?m="coords":m=n.shapeInfo.logicalShape.map((g,x)=>`coords.${p[x+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${f}
      return get${s}(${m});
    }
  `}function ln(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function M0(n,e,t){const{newShape:s,keptDims:r}=Ko(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):s,c=!n&&o>1&&!tn(e,t)&&s.length<o||i;return{useSqueezeShape:c,uniformShape:c?a:e,keptDims:r}}function qa(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Ka(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(n,e,t,s){const r=t.map((d,h)=>{const f={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(f.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:f}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=e5(r,i,e),c=A4(n.gl,a),l=n.createProgram(c);return ce().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i},eI(n,e,l)))}function eI(n,e,t){const s=[],r=[];let o,i,a,c=null,l=null;l=n.getUniformLocation(t,"NAN",!1),ce().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const h of e.variableNames){const f={name:h,uniform:n.getUniformLocation(t,h,d),offset:n.getUniformLocation(t,`offset${h}`,d)};e.enableShapeUniforms&&(f.shape=n.getUniformLocation(t,`${h}Shape`,d),f.texShape=n.getUniformLocation(t,`${h}TexShape`,d)),s.push(f)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),i=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const h of e.customUniforms)r.push(n.getUniformLocation(t,h.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:c,nanLoc:l,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function zy(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!tn(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,c=o.isUniform?null:o.texData.texShape;if(!tn(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function F5(n,e,t,s,r){e.program.enableShapeUniforms||(zy(e.inShapeInfos,t),zy([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),ce().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){const l=t[c],{uniform:d,offset:h,shape:f,texShape:p}=e.variablesLocations[c];if(f){const{uniformShape:m}=M0(e.program.packedInputs,l.shape,l.texData.texShape);switch(m.length){case 1:n.gl.uniform1iv(f,new Int32Array(m));break;case 2:n.gl.uniform2iv(f,new Int32Array(m));break;case 3:n.gl.uniform3iv(f,new Int32Array(m));break;case 4:n.gl.uniform4iv(f,new Int32Array(m));break}}if(p&&n.gl.uniform2i(p,l.texData.texShape[0],l.texData.texShape[1]),d!=null){if(l.isUniform){if(fe(l.shape)<2)n.gl.uniform1f(d,l.uniformValues[0]);else{let m=l.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),n.gl.uniform1fv(d,m)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,d,c)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const c=xt(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const l=e.program.customUniforms[c],d=e.customUniformLocations[c],h=r[c];if(l.type==="float")n.gl.uniform1fv(d,h);else if(l.type==="vec2")n.gl.uniform2fv(d,h);else if(l.type==="vec3")n.gl.uniform3fv(d,h);else if(l.type==="vec4")n.gl.uniform4fv(d,h);else if(l.type==="int")n.gl.uniform1iv(d,h);else if(l.type==="ivec2")n.gl.uniform2iv(d,h);else if(l.type==="ivec3")n.gl.uniform3iv(d,h);else if(l.type==="ivec4")n.gl.uniform4iv(d,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function O5(n,e,t){let s="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const c=i.texData.texShape,{useSqueezeShape:l,uniformShape:d,keptDims:h}=M0(n.packedInputs,i.shape,c);let f="",p="",m="";if(d.length===1&&n.packedInputs){const S=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];f=`${S[0]>1}_${S[1]>1}`}else if(d.length===2&&!n.packedInputs)p=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const S=xt(d);m=`${S[0]===c[1]}_${S[S.length-1]===c[1]}`}const g=i.shape.length,x=d.length===2&&tn(i.shape,c),y=fe(i.shape)===1,b=Ia(i.shape,t.shape),w=!n.packedInputs&&g===t.shape.length&&tn(c,t.texData.texShape),v=n.packedInputs||d.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${g}_${w}_${l?h:""}_${d.length}_${y}_${b}_${x}_${f}_${p}_${m}_${v}_${a}`}else{const c=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${c}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${ce().getNumber("WEBGL_VERSION")}`,o}function ms(n){return ce().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L5{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Tc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Ns();this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Jh(["r","c","d"],e):Xi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z5{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Tc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Ns();this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Jh(["r","c","d"],e):Xi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W5{constructor(e){this.variableNames=["A"],this.outTexUsage=Qs.DOWNLOAD;const t=Ns();this.outputShape=e,this.userCode=`
      ${QN}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B5{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Qs.DOWNLOAD;const t=Ns();this.outputShape=e,this.userCode=`
      ${QN}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V5={R:0,G:1,B:2,A:3};class Wy{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Ns();this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const c=s[a];i+=`
          if(offset == ${a}) {
            result = values[${V5[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?P0():_0(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U5{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Ns();this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const c=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?P0():_0(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G5(n){const e=Ns(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return T4(n,t)}function H5(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return j4(n,e)}function q5(n){const e=new Uint16Array([0,1,2,2,1,3]);return _4(n,e)}function Xl(n,e,t,s,r,o){M4(e,t);const i=P4(n),a=n.TEXTURE_2D;return Je(n,()=>n.bindTexture(a,i)),Je(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Je(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Je(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Je(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),ce().getNumber("WEBGL_VERSION")===1?Je(n,()=>n.texImage2D(a,0,s,e,t,0,r,o,null)):Je(n,()=>n.texStorage2D(a,1,s,e,t)),Je(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function tI(n){return n.internalFormatFloat}function K5(n,e,t,s){const[r,o]=ql(e,t);return Xl(n,r,o,tI(s),s.textureFormatFloat,n.FLOAT)}function nI(n){return n.internalFormatHalfFloat}function X5(n,e,t,s){const[r,o]=ql(e,t);return Xl(n,r,o,nI(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function sI(n){return n.downloadTextureFormat}function Q5(n,e,t,s){const[r,o]=ql(e,t);return Xl(n,r,o,sI(s),n.RGBA,n.UNSIGNED_BYTE)}function rI(n){return n.internalFormatPackedFloat}function Y5(n,e,t,s){const[r,o]=Ua(e,t);return Xl(n,r,o,rI(s),n.RGBA,n.FLOAT)}function oI(n){return n.internalFormatPackedHalfFloat}function J5(n,e,t,s){const[r,o]=Ua(e,t);return Xl(n,r,o,oI(s),n.RGBA,s.textureTypeHalfFloat)}function Z5(n,e,t){return Je(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Fy(n,e,"clipSpacePos",t,3,20,0)&&Fy(n,e,"uv",t,2,20,12)}function eV(n,e,t,s,r,o){Je(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,c;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,c=n.RGBA):(i=new Float32Array(t*s*4),a=n.FLOAT,c=o.internalFormatPackedFloat),i.set(r),ce().getNumber("WEBGL_VERSION")===2?Je(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,i)):Je(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,t,s,0,n.RGBA,a,i)),Je(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function tV(n,e,t){Je(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ce().getNumber("WEBGL_VERSION")===2?Je(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Je(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ce().getNumber("WEBGL_VERSION")===2?Je(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Je(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Je(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function nV(n,e,t,s){const r=n.createBuffer();Je(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Je(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Je(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Je(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function sV(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function rV(n,e,t,s){const[r,o]=ql(e,t),i=4,a=new Uint8Array(v4(e*t,i));return Je(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function oV(n,e,t,s,r,o,i,a){const c=n,l=new Float32Array(S4(o,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function iV(n,e,t){const s=new Float32Array(e*t*4);return Je(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _f{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=ce().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,y4(t,e)):this.gl=Pr(t),e=this.gl,ce().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Je(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Je(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Je(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Je(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Je(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Je(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Je(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Je(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ce().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=uu(this.gl,o),dr(this.gl,i))this.textureHalfFloatExtension=uu(this.gl,i);else if(ce().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),dr(this.gl,r))this.colorBufferHalfFloatExtension=uu(this.gl,r);else if(ce().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",dr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(dr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=H5(this.gl),this.indexBuffer=q5(this.gl),this.framebuffer=F4(this.gl),this.textureConfig=j0(this.gl,this.textureHalfFloatExtension)}get debug(){return ce().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Je(e,()=>e.finish()),Je(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Je(e,()=>e.deleteFramebuffer(this.framebuffer)),Je(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Je(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Je(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),K5(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),X5(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),Q5(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),tV(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),eV(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),J5(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),Y5(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Oy(this.gl,this.framebuffer),this.outputTexture=null),Je(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>rV(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return oV(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return sV(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=nV(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(ce().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>iV(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=G5(t));const s=E4(t);Je(t,()=>t.attachShader(s,this.vertexShader)),Je(t,()=>t.attachShader(s,e)),D4(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Rf(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Je(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Z5(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Je(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Rf(this.gl,this.program),Je(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?L4(this.gl,e,t):z4(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Je(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),W4(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=Ua(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Rf(this.gl,this.program),du(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Je(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Je(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=uu(this.gl,ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await kx(()=>this.disposed||this.isQueryAvailable(e,ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=aV(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ce().platform&&(s=ce().platform.setTimeoutCustom.bind(ce().platform)),kx(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Ef(this.gl,e,this.framebuffer),this.debug&&du(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Ef(this.gl,this.outputTexture,this.framebuffer),this.debug&&du(this.gl)):Oy(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;Ef(r,e,this.framebuffer),this.debug&&du(r),this.outputTexture=e,Je(r,()=>r.viewport(0,0,t,s)),Je(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Je(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function aV(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:cV,bincountImpl:iI,bincountReduceImpl:lV,bitwiseAndImpl:uV,castImpl:dV,ceilImpl:hV,concatImpl:fV,equalImpl:pV,expImpl:mV,expm1Impl:gV,floorImpl:xV,gatherNdImpl:yV,gatherV2Impl:bV,greaterImpl:wV,greaterEqualImpl:vV,lessImpl:SV,lessEqualImpl:CV,linSpaceImpl:NV,logImpl:IV,maxImpl:kV,maximumImpl:$V,minimumImpl:TV,multiplyImpl:AV,negImpl:RV,notEqualImpl:EV,prodImpl:DV,raggedGatherImpl:jV,raggedRangeImpl:_V,raggedTensorToTensorImpl:PV,rangeImpl:MV,rsqrtImpl:FV,scatterImpl:OV,sigmoidImpl:LV,simpleAbsImpl:aI,sliceImpl:zV,sparseFillEmptyRowsImpl:WV,sparseReshapeImpl:BV,sparseSegmentReductionImpl:cI,sqrtImpl:VV,staticRegexReplaceImpl:UV,stridedSliceImpl:GV,stringNGramsImpl:HV,stringSplitImpl:qV,stringToHashBucketFastImpl:KV,subImpl:XV,tileImpl:QV,topKImpl:YV,transposeImpl:F0,uniqueImpl:JV}=tL;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lI(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function vs(n,e){return e===1?[n]:lI(n,e)}function ZV(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eU{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ms(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=vs("rc",this.rank),s=ln(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uI{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${tU(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?P0():_0(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function tU(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Z4(["r","c","d"],"inputShape"):Xi(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nU{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=Vy(t,s),o=Uy(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=By(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const c=this.freeTextures[o].pop();return this.usedTextures[o].push(c),c}let a;return r===ss.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===ss.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===ss.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===ss.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===ss.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=Vy(s,r),i=Uy(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=By(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=ce().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[i],d=l&&l.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[d]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function sU(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function By(n,e,t,s,r){const o=rU(e,s);let i;if(r){const[c,l]=Ua(n[0],n[1]);i=c*l}else{const[c,l]=ql(n[0],n[1]);i=c*l}const a=sU(t,o);return i*a}function rU(n,e){switch(n){case ss.PACKED_2X2_FLOAT32:return rI(e);case ss.PACKED_2X2_FLOAT16:return oI(e);case ss.UNPACKED_FLOAT32:return tI(e);case ss.UNPACKED_FLOAT16:return nI(e);case ss.PACKED_4X1_UNSIGNED_BYTE:return sI(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function oU(n){return ce().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ss.PACKED_2X2_FLOAT32:ss.UNPACKED_FLOAT32:n?ss.PACKED_2X2_FLOAT16:ss.UNPACKED_FLOAT16}function Vy(n,e){if(n===Qs.UPLOAD)return ss.PACKED_2X2_FLOAT32;if(n===Qs.RENDER||n==null)return oU(e);if(n===Qs.DOWNLOAD||n===Qs.PIXELS)return ss.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function Uy(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const gr="if (isnan(x)) return x;",iU="return x;",Gy="return abs(x);",aU="return (x >= 0.0) ? x : (exp(x) - 1.0);",cU=gr+`
  return (x < 0.0) ? 0.0 : x;
`,lU=gr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ro="return x;",uU="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU="return x;",hU=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,fU=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pU=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,mU="return 1.0 / (1.0 + exp(-1.0 * x));";class _o{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gU{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length);const t=e.length,s=vs("rc",t),r=ln(t),o=ZV(t,s),i=s.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU=jv,yU=1e-7,bU=1e-4,pu={};function wU(n){return n in pu||(pu[n]={}),pu[n]}const vU=ce().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),SU=600;function CU(){return ce().global.screen==null?1024:ce().global.screen.height*ce().global.screen.width*window.devicePixelRatio*SU/1024/1024}class Zh extends Yp{nextDataId(){return Zh.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ce().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof _f)t=e;else{const s=Pr(ce().getNumber("WEBGL_VERSION"),e);t=new _f(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Pr(ce().getNumber("WEBGL_VERSION"));t=new _f(s),this.binaryCache=wU(ce().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new nU(this.gpgpu),this.numMBBeforeWarning=CU(),this.texData=new ew(this,Ur())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,i){const a=this.makeTensorInfo(t,s),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,o]},c.texShape=[r,o];const l=hu(t),d=new Wy(l,!1,i),h=this.runWebGLProgram(d,[a],s,[[r,o]]);return h.shape=t,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,t,s){if((ce().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ce().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Qs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(ce().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Qs.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:c}=t;if(i!=null){let f;c?f=new _o(a,Ro):f=new Qr(a,Ro);const p=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:r}],r),m=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),m}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const l=this.activeTimers!=null;let d;l&&(d=Ts());let h;if(r==="complex64"){const f=this.readSync(o.real.dataId),p=this.readSync(o.imag.dataId);h=vo(f,p)}else h=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=Ts()-d),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:c}=t;if(o!=null){let m;c?m=new _o(r,Ro):m=new Qr(r,Ro);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:i}],i),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(ce().getBool("DEBUG")&&!ce().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ce().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,d;if(i!=="complex64"&&ce().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const m=this.texData.get(d.dataId);l=this.gpgpu.createBufferFromTexture(m.texture.texture,...lu(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=m[0],x=m[1];h=vo(g,x)}else if(l==null)h=this.getValuesFromTexture(e);else{const m=fe(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,m)}if(d!=null&&this.disposeIntermediateTensorInfo(d),l!=null){const m=this.gpgpu.gl;Je(m,()=>m.deleteBuffer(l))}const f=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(m=>m(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ur().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:c,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let p;c?p=new _o(o,Ro):p=new Qr(o,Ro);const m=this.runWebGLProgram(p,[{dataId:e,shape:o,dtype:a}],a),g=this.readToGPU(m,t);return this.disposeIntermediateTensorInfo(m),g}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),h=Ur().makeTensorFromTensorInfo(d),f=this.texData.get(d.dataId);return Object.assign({tensorRef:h},f.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Bo(r));return Ot(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ot(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!k4(s))throw ce().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=fe(t);if(ce().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),p=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...lu(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),m}const i=ce().getBool("WEBGL_PACK")&&r===!0,a=i?hu(t):t,c=i?new B5(a):new W5(a),l=this.runWebGLProgram(c,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=ki(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),i=ki(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(o);a.kernelMs=B$(c),a.getExtraProfileInfo=()=>c.map((l,d)=>({name:i[d],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ts(),endMs:null}}endTimer(e){return ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Ts(),e)}async getQueryTime(e){if(ce().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),c=a&&a.origDataId||e,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=vU){return ce().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&fe(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Xs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return xU(e.shape,t)}packedUnaryOp(e,t,s){const r=new _o(e.shape,t),o=this.compileAndRun(r,[e],s);return Ur().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=aI(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(ce().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Gy,e.dtype);const t=new Qr(e.shape,Gy),s=this.compileAndRun(t,[e]);return Ur().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&_c(s[0])){const o=s.map(i=>Fo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return Ur().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new gU(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new eU(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[Da(e.shape),...ja(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[Da(t),...ja(t)],i=new uI(o,s),a=!0,c=[s],l=this.runWebGLProgram(i,[r],e.dtype,c,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const f=fe(o),p=t[0]*t[1]*4;R(f<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=hu(o);let c;r?c=new z5(a):c=new L5(a);const l=!0,d=[t??lu(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:i,dataId:e}],i,d,l,t);return{dtype:i,shape:o,dataId:h.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),c=this.texData.get(a.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Tc.DENSE){const y=i??lu(e.outputShape);c.texShape=y.map(b=>b*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),fe(a.shape)===0)return c.values=us(a.dtype,0),a;const l=[],d=t.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!e.packedInputs&&fe(y.shape)<=ce().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!e.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!sd(b.shape,y.shape)){const w=y,v=y.shape;y.shape=b.shape,y=this.packedReshape(y,v),l.push(y),b=this.texData.get(y.dataId),w.shape=v}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},f=O5(e,d,h),p=this.getAndSaveBinary(f,()=>M5(this.gpgpu,e,d,h)),m=this.activeTimers!=null;let g;m&&(g=this.startTimer()),ce().get("ENGINE_COMPILE_ONLY")||F5(this.gpgpu,p,d,h,r),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=ce().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const y=Ts();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!ce().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ce().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ie(()=>{if(!ce().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ce().getBool("DEBUG");ce().set("DEBUG",!1);const t=this.abs(en(1e-8)).dataSync()[0];if(ce().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?yU:bU}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:c}=t;if(i!=null)return;const l=this.activeTimers!=null;let d;l&&(d=Ts());let h=t.texShape;if(h==null&&(h=U4(s,c),t.texShape=h),o!=null){const f=hu(s);let p,m=h[1],g=h[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(c||!x)&&([m,g]=Ua(h[0],h[1])),c?p=new U5(f,x):p=new Wy(f,x);const y=x?[g,m]:h,b=this.makeTensorInfo(y,r),w=this.texData.get(b.dataId);x?w.usage=Qs.PIXELS:w.usage=Qs.UPLOAD,w.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,g,o);const v=[[g,m]],C=this.runWebGLProgram(p,[b],r,v,!0),k=this.texData.get(C.dataId);t.texShape=k.texShape,t.isPacked=k.isPacked,t.usage=k.usage,ce().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(t.texture=k.texture,t.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=Ts()-d)}else{const f=this.acquireTexture(h,a,r,c);t.texture=f}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=NU(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Ru(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Jv(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(XN(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:c}=eI(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,c=Ur().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(r,t,s,o,i,a);return Ur().makeTensorFromDataId(l,t,s,c)}}Zh.nextDataId=0;function NU(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */qw()&&Qw("webgl",()=>new Zh,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O0=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Li{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Dt(t,s),this.enableShapeUniforms=ms(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Xa{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Dt(t,s);const o=this.outputShape.length;this.enableShapeUniforms=ms(o);let i="";if(r)if(o===0||fe(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${ln(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=vs("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hs(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const IU={kernelName:tl,backendName:"webgl",kernelFunc:Hs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ri(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),a=Hs({inputs:{x:s},backend:t}),c=Hs({inputs:{x:r},backend:t});return i.complexTensorInfos={real:a,imag:c},o}const kU={kernelName:um,backendName:"webgl",kernelFunc:ri};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dI="return (a < 0.) ? b * a : a;",hI=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function $U(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",Xo(o,"float32")),a=ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(hI,r.shape,i.shape):new Li(dI,r.shape,i.shape),c=t.runWebGLProgram(a,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),c}const TU={kernelName:Hd,backendName:"webgl",kernelFunc:$U};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fI="return (a < 0.) ? b * a : a;",pI=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function AU(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(pI,s.shape,r.shape):new Li(fI,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const RU={kernelName:dh,backendName:"webgl",kernelFunc:AU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qa="if (isnan(x)) return x;";function Xt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,c=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const h=a.texData.get(i.dataId),f=t(h.values,c);return a.makeTensorInfo(i.shape,c,f)}const l=ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return l?d=new _o(i.shape,e):d=new Qr(i.shape,n),a.runWebGLProgram(d,[i],c)}}function as({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:c,b:l}=i,d=a;if(s&&c.dtype==="complex64"){const m=d.texData.get(c.dataId),g=d.texData.get(l.dataId),[x,y]=[[m.complexTensorInfos.real,g.complexTensorInfos.real],[m.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(w=>{const[v,S]=w,C={dataId:v.dataId,dtype:v.dtype,shape:c.shape},k={dataId:S.dataId,dtype:S.dtype,shape:l.shape},I=new Li(n,c.shape,l.shape);return d.runWebGLProgram(I,[C,k],Us(v.dtype,S.dtype))}),b=ri({inputs:{real:x,imag:y},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(y),b}const h=o||Us(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||d.shouldExecuteOnCPU([c,l]))&&r!=null){const m=d.texData.get(c.dataId).values,g=d.texData.get(l.dataId).values,x=c.dtype==="string"?So(m):m,y=c.dtype==="string"?So(g):g,[b,w]=r(c.shape,l.shape,x,y,h),v=d.makeTensorInfo(w,h),S=d.texData.get(v.dataId);return S.values=b,v}const f=ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return f?p=new Xa(e,c.shape,l.shape,t):p=new Li(n,c.shape,l.shape),d.runWebGLProgram(p,[c,l],h)}}function Ac(n,e=!1){if(n==="linear")return e?dU:iU;if(n==="relu")return e?fU:cU;if(n==="elu")return e?hU:aU;if(n==="relu6")return e?pU:lU;if(n==="prelu")return e?pI:fI;if(n==="leakyrelu")return e?hI:dI;if(n==="sigmoid")return e?mU:uU;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mI{constructor(e,t,s,r=!1,o=!1,i=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ms(this.outputShape.length);const d=r?e[1]:e[2],h=Math.ceil(d/2),f=r?"i * 2, rc.y":"rc.y, i * 2",p=o?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",y="";a&&(c?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let w="rc.x",v="rc.x";e[0]<t[0]?w=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(v=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${w};
        int batchB = ${v};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${g[0]});
          result += (${m[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hy={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class qy{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Dt(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ky="return a * b;";function L0(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=Us(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),l=new qy(Hy.REAL,s.shape,r.shape),d=new qy(Hy.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],f=t.runWebGLProgram(l,h,"float32"),p=t.runWebGLProgram(d,h,"float32"),m=ri({inputs:{real:f,imag:p},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),m}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),[l,d]=AV(s.shape,r.shape,a.values,c.values,o),h=t.makeTensorInfo(d,o),f=t.texData.get(h.dataId);return f.values=l,h}let i;return ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Xa(Ky,s.shape,r.shape):i=new Li(Ky,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const EU={kernelName:ul,backendName:"webgl",kernelFunc:L0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DU(n,e,t){const s=[Da(n.shape),...ja(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[Da(e),...ja(e)],i=new uI(o,s),a=!0,c=[s],l=t.runWebGLProgram(i,[r],n.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ve(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,a=fe(r.shape),c=nw(o,a),l=fe(c);R(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!sd(r.shape,c)&&!(d.texture!==null&&sd(d.shape,c))?DU(r,c,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const jU={kernelName:fh,backendName:"webgl",kernelFunc:Ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xy{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,c=s%4;let l="sumValue += dot(values, ones);";if(t!=null){const h=1/t;l=`sumValue += dot(values * ${va(h)?h.toPrecision(2):h}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _U{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",c="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",c="min"):t==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");const d=Math.floor(s/4)*4,h=s%4;let f=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=Mh(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function Ji(n,e,t,s){const r=PU(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:c,outSize:l}=r[i];let d,h;t==="mean"?d=i===0?new Xy({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},a):new Xy({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l}):d=new _U({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},t),h=o,o=s.runWebGLProgram(d,[o],e),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MU{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=ln(this.rank),o=FU(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function FU(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OU{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=ln(this.rank),o=lI("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const a=`vec2(${i.slice(-2).join()})`,c=`++${o[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ef(n,e,t){const s=ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new OU(n.shape,e):new MU(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LU(n,e,t,s){const r=e,o=n.shape.length,i=Lt(r,n.shape);let a=i;const c=An(a,o),l=c!=null;let d=n;l&&(d=ef(n,c,s),a=_n(a.length,o)),is("sum",a,o);const[h,f]=Zn(d.shape,a);let p=h;t&&(p=zn(h,i));const m=fe(f),x=fe(n.shape)/m,y=Ve({inputs:{x:d},attrs:{shape:[x,m]},backend:s}),b=Gm(n.dtype),w=Ji(y,b,"sum",s),v=Ve({inputs:{x:w},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(w),l&&s.disposeIntermediateTensorInfo(d),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tf(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return LU(r,o,i,t)}const zU={kernelName:bh,backendName:"webgl",kernelFunc:tf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cs(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,a=r.shape.length,c=new Array(a);for(let d=0;d<c.length;d++)c[d]=r.shape[o[d]];let l;if(i.shouldExecuteOnCPU([r])){const h=i.texData.get(r.dataId).values,f=F0(h,r.shape,r.dtype,o,c);l=i.makeTensorInfo(c,r.dtype);const p=i.texData.get(l.dataId);p.values=f}else l=ef(r,o,i);return l}const WU={kernelName:ha,backendName:"webgl",kernelFunc:Cs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gI=1e3;function rd({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){const l=n.shape.length,d=e.shape.length,h=t?n.shape[l-2]:n.shape[l-1],f=s?e.shape[d-1]:e.shape[d-2],p=t?n.shape[l-1]:n.shape[l-2],m=s?e.shape[d-2]:e.shape[d-1],g=n.shape.slice(0,-2),x=e.shape.slice(0,-2),y=fe(g),b=fe(x),v=Dt(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,m]);R(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=t?[y,h,p]:[y,p,h],C=s?[b,m,f]:[b,f,m],k=Ve({inputs:{x:n},backend:r,attrs:{shape:S}}),I=Ve({inputs:{x:e},backend:r,attrs:{shape:C}}),A=[k,I],T=Math.max(y,b),E=t?k.shape[1]:k.shape[2],$=o!=null,D=i!=null,M=c==="leakyrelu",P=c!=null?Ac(c,!0):null,L=$||D||M||P!=null;let O;if((p===1||m===1)&&E>gI&&L===!1){let V=k,G=I;t&&(V=Cs({inputs:{x:k},backend:r,attrs:{perm:[0,2,1]}}),A.push(V)),s&&(G=Cs({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),A.push(G));const _=m!==1,Z=m===1;let te=V;_&&(te=Ve({inputs:{x:V},backend:r,attrs:{shape:[T,E,1]}}),A.push(te));const he=m===1?2:1;let oe=G;Z&&(oe=Ve({inputs:{x:G},backend:r,attrs:{shape:[T,1,E]}}),A.push(oe));const ve=L0({inputs:{a:te,b:oe},backend:r});O=tf({inputs:{x:ve},backend:r,attrs:{axis:he,keepDims:!0}}),A.push(ve)}else{const V=Us(n.dtype,e.dtype),G=new mI(S,C,[T,p,m],t,s,$,P,D,M),_=[k,I];if(o!=null&&_.push(o),D&&_.push(i),M){const Z=r.makeTensorInfo([],"float32",Xo(a,"float32"));_.push(Z),A.push(Z)}O=r.runWebGLProgram(G,_,V)}const F=Ve({inputs:{x:O},backend:r,attrs:{shape:v}});A.push(O);for(const V of A)r.disposeIntermediateTensorInfo(V);return F}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BU(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;return rd({a:r,b:o,transposeA:c,transposeB:l,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const VU={kernelName:Eu,backendName:"webgl",kernelFunc:BU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qy="return abs(x);";function UU(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=aI(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new _o(s.shape,Qy):r=new Qr(s.shape,Qy),t.runWebGLProgram(r,[s],s.dtype)}const GU={kernelName:kd,backendName:"webgl",kernelFunc:UU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU=gr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,qU=Xt({opSnippet:HU}),KU={kernelName:Pc,backendName:"webgl",kernelFunc:qU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU=gr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,QU=Xt({opSnippet:XU}),YU={kernelName:Mc,backendName:"webgl",kernelFunc:QU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yy="return a + b;",JU=as({opSnippet:Yy,packedOpSnippet:Yy,supportsComplex:!0,cpuKernelImpl:cV}),ZU={kernelName:Oa,backendName:"webgl",kernelFunc:JU};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eG{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tG{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ku(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Hs({inputs:{x:s[0]},backend:t});if(s.length>ce().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),l=ku({inputs:s.slice(0,c),backend:t}),d=ku({inputs:s.slice(c),backend:t});return ku({inputs:[l,d],backend:t})}const r=s.map(c=>c.dtype).reduce((c,l)=>Us(c,l)),o=s.map(c=>c.shape),a=ce().getBool("WEBGL_PACK")?new tG(s[0].shape,o):new eG(s[0].shape,o);return t.runWebGLProgram(a,s,r)}const nG={kernelName:sm,backendName:"webgl",kernelFunc:ku};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=An(l,a);let h=r;d!=null&&(h=Cs({inputs:{x:r},backend:t,attrs:{perm:d}}),l=_n(l.length,a)),is("all",l,a);const[f,p]=Zn(h.shape,l),m=fe(p),g=Ve({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=Ji(g,g.dtype,"all",t);let y;if(i){const b=zn(f,c);y=Ve({inputs:{x},backend:t,attrs:{shape:b}})}else y=Ve({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const rG={kernelName:rm,backendName:"webgl",kernelFunc:sG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=An(l,a);let h=r;d!=null&&(h=Cs({inputs:{x:r},backend:t,attrs:{perm:d}}),l=_n(l.length,a)),is("any",l,a);const[f,p]=Zn(h.shape,l),m=fe(p),g=Ve({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=Ji(g,g.dtype,"any",t);let y;if(i){const b=zn(f,c);y=Ve({inputs:{x},backend:t,attrs:{shape:b}})}else y=Ve({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const iG={kernelName:om,backendName:"webgl",kernelFunc:oG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aG{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cG{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,R(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=ln(c),d=vs("coords",c);let h,f;if(i===1){f=c+1;const I=ln(f);h=`
        ${I} sourceLocR = ${I}(${d.join()}, 0);
        ++${d[c-1]};
        ${I} sourceLocG = ${I}(${d.join()}, 0);
        ++${d[c-2]};
        ${I} sourceLocA = ${I}(${d.join()}, 0);
        --${d[c-1]};
        ${I} sourceLocB = ${I}(${d.join()}, 0);
        --${d[c-2]};`}else f=c,h=`
        ${l} sourceLocR = coords;
        ++${d[c-1]};
        ${l} sourceLocG = coords;
        ++${d[c-2]};
        ${l} sourceLocA = coords;
        --${d[c-1]};
        ${l} sourceLocB = coords;
        --${d[c-2]};`;const p=["x","y","z","w","u","v"].slice(0,f),m="."+p[f-1],g=p.map(I=>"int "+I),x=vs("sourceLocR",f-1).concat("inIdx.r"),y=vs("sourceLocG",f-1).concat("inIdx.g"),b=vs("sourceLocB",f-1).concat("inIdx.b"),w=vs("sourceLocA",f-1).concat("inIdx.a"),v=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()})));`,C=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,k=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${k}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${d[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${d[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xI(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=Mh(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},c=new aG(a,t,s==null),l=[e];s!=null&&l.push(s);const d=n.runWebGLProgram(c,l,"int32");if(d.shape[1]===1)return d;const h=xI(n,e,t,d);return n.disposeIntermediateTensorInfo(d),h}function yI(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=Mh(o),a=new cG(r,i,t,s==null),c=s==null?[e]:[e,s],l=n.runWebGLProgram(a,c,"int32");if(l.shape.length===e.shape.length){const d=yI(n,e,t,l);return n.disposeIntermediateTensorInfo(l),d}return l}function bI(n,e,t,s){const r=[t];if(is("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!ce().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let c=e;a&&(c=n.unpackTensor(e),o.push(c));const[l,d]=Zn(c.shape,r),h=fe(d),f=Ve({inputs:{x:c},backend:n,attrs:{shape:[-1,h]}});o.push(f);const p=xI(n,f,s);o.push(p);const m=Ve({inputs:{x:p},backend:n,attrs:{shape:l}});return o.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}return yI(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Lt(o,r.shape);const a=An(i,r.shape.length);let c=r;const l=[];a!=null&&(c=Cs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=_n(i.length,c.shape.length)),is("argMax",[i[0]],c.shape.length);const d=bI(t,c,i[0],"max");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const uG={kernelName:$d,backendName:"webgl",kernelFunc:lG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Lt(o,r.shape);const a=An(i,r.shape.length);let c=r;const l=[];a!=null&&(c=Cs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=_n(i.length,c.shape.length)),is("argMin",[i[0]],c.shape.length);const d=bI(t,c,i[0],"min");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const hG={kernelName:Td,backendName:"webgl",kernelFunc:dG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG=gr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,pG=Xt({opSnippet:fG}),mG={kernelName:Fc,backendName:"webgl",kernelFunc:pG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG=gr+"return log(x + sqrt(x * x + 1.0));",xG=Xt({opSnippet:gG}),yG={kernelName:Oc,backendName:"webgl",kernelFunc:xG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG=gr+`
  return atan(x);
`,wG=Xt({opSnippet:bG}),vG={kernelName:Lc,backendName:"webgl",kernelFunc:wG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG=O0+`
  return atan(a, b);
`,CG=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yi+`
  return result;
`,NG=as({opSnippet:SG,packedOpSnippet:CG}),IG={kernelName:Wc,backendName:"webgl",kernelFunc:NG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG=gr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,$G=Xt({opSnippet:kG}),TG={kernelName:zc,backendName:"webgl",kernelFunc:$G};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rc{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const g=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),s){const I=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${p}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${I} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:y:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(v="avgValue / max(count, 1.0)");const S=Math.floor(i/4)*4,C=i%4,k=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${p}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${k}
          }

          int xC = xCCorner + ${S};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${k}
          }
        }
        setOutput(${v});
      }
    `}}class z0{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,c=e.strideHeight,l=e.strideWidth,d=e.dilationDepth,h=e.dilationHeight,f=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,y=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg";let v="0.0";if(w||(v="-1.0 / 1e-20"),s){const T=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${x}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${T} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let C=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(C="avgValue / max(count, 1.0)");const k=Math.floor(i/4)*4,I=i%4,A=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${A}
            }

            int xC = xCCorner + ${k};
            if (${I===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${I===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${I===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${A}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Kl(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(fs(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=pr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&tn(d.inShape,d.outShape))return Hs({inputs:{x:r},backend:t});const h=new Rc(d,"avg",!1);return t.runWebGLProgram(h,[r],"float32")}const RG={kernelName:Ad,backendName:"webgl",kernelFunc:AG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s,d=[1,1,1],h=Io(r.shape,o,i,d,a,c,l),f=new z0(h,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const DG={kernelName:Rd,backendName:"webgl",kernelFunc:EG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jG{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=c-1-e.padInfo.top,h=l-1-e.padInfo.left,f=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class _G{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=h-1-e.padInfo.front,g=f-1-e.padInfo.top,x=p-1-e.padInfo.left,y=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${g}, ${x});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],f=Io(i.shape,a,c,h,l,d),p=new _G(f);return t.runWebGLProgram(p,[r],i.dtype)}const MG={kernelName:am,backendName:"webgl",kernelFunc:PG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Kl([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=pr(i.shape,a,c,1,l),h=new jG(d);return t.runWebGLProgram(h,[r],i.dtype)}const OG={kernelName:im,backendName:"webgl",kernelFunc:FG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LG(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return rd({a:r,b:o,transposeA:i,transposeB:a,backend:t})}const zG={kernelName:Ed,backendName:"webgl",kernelFunc:LG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WG{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Dt(e,t),Dt(e,s);let a="0.0";r!=null&&(Dt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";o!=null&&(Dt(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BG{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Dt(e,t),Dt(e,s);let a="vec4(0.0)";r!=null&&(Dt(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";o!=null&&(Dt(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;R(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);const l=[s,r,o];let d=null;i!=null&&(d=i.shape,l.push(i));let h=null;a!=null&&(h=a.shape,l.push(a));const f=ce().getBool("WEBGL_PACK_NORMALIZATION")?new BG(s.shape,r.shape,o.shape,d,h,c):new WG(s.shape,r.shape,o.shape,d,h,c);return e.runWebGLProgram(f,l,l[0].dtype)},UG={kernelName:Vd,backendName:"webgl",kernelFunc:VG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GG{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=ln(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=HG(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${Pp[a]} = start[${a}] + coords.${Pp[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Pp=["x","y","z","w","u","v"];function HG(n){if(n===1)return"sourceLoc";if(n<=6)return Pp.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qG{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=ln(this.rank),s=vs("coords",this.rank),r=vs("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,h)=>`start[${h}]`).join()});`:e.map((d,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=Pg(e,xt(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const c=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,c+1),o}function Ya(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[a,c]=Ph(r,o,i);if(Dg(r,a,c),fe(c)===0)return t.makeTensorInfo(c,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=t.texData.get(r.dataId),f=zV(h.values,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,f)}const{isPacked:l}=t.texData.get(r.dataId),d=_g(r.shape,a,c);if(l||!d){const h=ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qG(c):new GG(c),f=[a];return t.runWebGLProgram(h,[r],r.dtype,f)}return t.uploadToGPU(r.dataId),KG(r,a,c,t)}const XG={kernelName:yh,backendName:"webgl",kernelFunc:Ya};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;R(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,w)=>b*w),c=Pl(r.shape,o,a),l=Ml(c.length,o.length),d=Fl(r.shape,o,a),h=zg(i,o.length),f=Wg(d,i,o.length),p=[],m=Ve({inputs:{x:r},backend:t,attrs:{shape:c}}),g=Cs({inputs:{x:m},backend:t,attrs:{perm:l}}),x=Ve({inputs:{x:g},backend:t,attrs:{shape:d}}),y=Ya({inputs:{x},backend:t,attrs:{begin:h,size:f}});return p.push(m),p.push(g),p.push(x),p.forEach(b=>t.disposeIntermediateTensorInfo(b)),y},YG={kernelName:Dd,backendName:"webgl",kernelFunc:QG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.readSync(r.dataId),c=t.readSync(o.dataId),l=iI(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const ZG={kernelName:cm,backendName:"webgl",kernelFunc:JG};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e6=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,t6=`
  return float(int(a.r) & int(b.r));
`;function n6(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=ce().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=ce().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||i===1){const c=t.texData.get(s.dataId).values,l=t.texData.get(r.dataId).values,[d,h]=uV(s.shape,r.shape,c,l,s.dtype),f=t.makeTensorInfo(h,s.dtype),p=t.texData.get(f.dataId);return p.values=d,f}let a;return o?a=new Xa(e6,s.shape,r.shape,!1):a=new Li(t6,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const s6={kernelName:lm,backendName:"webgl",kernelFunc:n6};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),a=Dt(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const o6={kernelName:cw,backendName:"webgl",kernelFunc:r6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i6="return float(a != b);",wI=as({opSnippet:i6,cpuKernelImpl:EV,dtype:"bool"}),a6={kernelName:ih,backendName:"webgl",kernelFunc:wI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ql(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Hs({inputs:{x:r.complexTensorInfos.real},backend:t})}const c6={kernelName:_m,backendName:"webgl",kernelFunc:Ql};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l6="return float(int(x));";function u6(n,e){const t=new Qr(n.shape,l6),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mp(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Hs({inputs:{x:r},backend:t});const i=Qn(r.shape),a=Mp({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),c=ri({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),c}if(r.dtype==="complex64"){const i=Ql({inputs:{input:r},backend:t}),a=Mp({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!sw(r.dtype,o)){const i=Hs({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[a,c,l]=dV(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}if(o==="int32")return u6(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",us("bool",1)),c=wI({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const d6={kernelName:Bc,backendName:"webgl",kernelFunc:Mp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jy="return ceil(x);",h6=Xt({opSnippet:Jy,packedOpSnippet:Jy,cpuKernelImpl:hV}),f6={kernelName:Vc,backendName:"webgl",kernelFunc:h6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p6{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m6{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;ce().getBool("WEBGL_PACK_CLIP")?a=new m6(r.shape):a=new p6(r.shape);const c=[[o],[i]];return t.runWebGLProgram(a,[r],r.dtype,c)}const x6={kernelName:Uc,backendName:"webgl",kernelFunc:g6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y6{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zy(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function b6(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new y6(s.shape),i=[Zy(s,r.complexTensorInfos.real),Zy(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const w6={kernelName:jd,backendName:"webgl",kernelFunc:b6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v6{constructor(e){this.outputShape=[],this.outputShape=to(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class S6{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=to(e,t);const s=this.outputShape,r=s.length,o=ln(r),i=vs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const c=new Array(e.length-1);c[0]=e[0][t];for(let g=1;g<c.length;g++)c[g]=c[g-1]+e[g][t];const l=a[t],d=a.slice(-2),h=a.join();let f=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${d.join()}));
        }`;for(let g=1;g<c.length;g++){const x=c[g-1];f+=`
        if (${l} < ${c[g]}  && ${l} >= ${c[g-1]}) {
          return getChannel(
            getT${g}(${mu(a,l,x)}),
            vec2(${mu(d,l,x)}));
        }`}const p=c.length,m=c[c.length-1];f+=`
        return getChannel(
          getT${p}(${mu(a,l,m)}),
          vec2(${mu(d,l,m)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function mu(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nf(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Hs({inputs:{x:r.complexTensorInfos.imag},backend:t})}const C6={kernelName:km,backendName:"webgl",kernelFunc:nf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uc(n,e,t){const s=n[0].dtype;if(s==="complex64"){const p=n.map(b=>Ql({inputs:{input:b},backend:t})),m=n.map(b=>nf({inputs:{input:b},backend:t})),g=uc(p,e,t),x=uc(m,e,t),y=ri({inputs:{real:g,imag:x},backend:t});return p.forEach(b=>t.disposeIntermediateTensorInfo(b)),m.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const p=n.map(v=>{const C=[-1,fe(v.shape.slice(e))];return Ve({inputs:{x:v},backend:t,attrs:{shape:C}})}),m=p.map(v=>({vals:t.readSync(v.dataId),shape:v.shape})),g=to(p.map(v=>v.shape),1),x=p[0].shape[0]===1,y=fV(m,g,s,x),b=to(n.map(v=>v.shape),e),w=t.makeTensorInfo(b,s,y);return p.forEach(v=>t.disposeIntermediateTensorInfo(v)),w}const o=n.filter(p=>fe(p.shape)>0),i=ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const p=i?new Qr(n[0].shape,Ro):new _o(n[0].shape,Ro);return t.runWebGLProgram(p,n,s)}const a=ce().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const p=[];for(let g=0;g<o.length;g+=a){const x=o.slice(g,g+a);p.push(uc(x,e,t))}const m=uc(p,e,t);for(const g of p)t.disposeIntermediateTensorInfo(g);return m}if(i){const p=new S6(o.map(m=>m.shape),e);return t.runWebGLProgram(p,o,s)}const{tensors2D:c,outShape:l}=N6(o,e,t),d=new v6(c.map(p=>p.shape)),h=t.runWebGLProgram(d,c,s);c.forEach(p=>t.disposeIntermediateTensorInfo(p));const f=Ve({inputs:{x:h},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(h),f}function N6(n,e,t){const s=to(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>Ve({inputs:{x:o},attrs:{shape:[-1,fe(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vI(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Lt(r,e[0].shape)[0],i=e.map(l=>l.shape);Fg(i,o);const a=to(e.map(l=>l.shape),o);if(fe(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(l=>fe(l.shape)>0);return c.length===1?Hs({inputs:{x:c[0]},backend:t}):uc(c,o,t)}const I6={kernelName:_d,backendName:"webgl",kernelFunc:vI};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",y=x?1:2,b=x?2:3,w=x?3:1;let v="",S="";s&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:v=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const C=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${S}
        setOutput(result);
      }
    `}}class k6{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.filterDepth,f=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ms(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,h=d;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)f+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;f+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)f+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(h+1)/2;x++){const y=x*2;if(f+=`
           xC = xCCorner + ${y*c};
           `,a===1){if(y<d&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,c===1&&y>0?f+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<d)){const b=i%2===0?Jp(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,c>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:f+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?f+=`
                     xC${y+1} = xTexelC${y};
                     `:f+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<d&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<d&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<d&&(f+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<d&&(f+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<d&&(f+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $6{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ms(this.outputShape.length);const{dataFormat:s}=t,r=Ns(),o=s==="channelsLast",i=o?1:2,a=o?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let d=0;d<=1;d++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${d};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function od(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function NI({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const c=n.shape,l=s.texData.get(n.dataId),d=t.inChannels,h=c[0]*c[1]*c[2],f=t.outChannels,p=t.dataFormat==="channelsLast",m=!1,g=!1;let x;const y=[];if(o!=null){const v=od(o.shape,p);v!=null&&(o=Ve({inputs:{x:o},backend:s,attrs:{shape:v}}),y.push(o))}if(r!=null){const v=od(r.shape,p);v!=null&&(r=Ve({inputs:{x:r},backend:s,attrs:{shape:v}}),y.push(r))}if(!((h===1||f===1)&&d>gI)&&l.isPacked&&p&&l.texture!=null&&c[2]%2!==0&&tn(l.shape.slice(-3),c.slice(-3))){const v=c[0]*c[1]*(c[2]+1),S={dataId:n.dataId,shape:[1,v,t.inChannels],dtype:n.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,R(sd(l.shape,S.shape),()=>`packed reshape ${l.shape} to ${S.shape} isn't free`);const k=Ve({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});y.push(k);const I=rd({a:S,b:k,backend:s,transposeA:m,transposeB:g,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),A=s.texData.get(I.dataId);R(A.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=C,A.shape=t.outShape,x=Hs({inputs:{x:I},backend:s}),x.shape=t.outShape,y.push(I)}else{const v=t.outHeight*t.outWidth,S=Ve({inputs:{x:n},backend:s,attrs:{shape:p?[t.batchSize,v,t.inChannels]:[t.batchSize,t.inChannels,v]}}),C=Ve({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),k=rd({a:p?S:C,b:p?C:S,transposeA:!p,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});x=Ve({inputs:{x:k},backend:s,attrs:{shape:t.outShape}}),y.push(S),y.push(C),y.push(k)}for(const v of y)s.disposeIntermediateTensorInfo(v);return x}function II({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:d,outWidth:h,outHeight:f,dataFormat:p}=t,m=p==="channelsLast",g=c*l*d,x=f*h,y=[t.batchSize,g,x],b=!0,w=!1,v=[];if(o!=null){const F=od(o.shape,m);F!=null&&(o=Ve({inputs:{x:o},backend:s,attrs:{shape:F}}),v.push(o))}if(r!=null){const F=od(r.shape,m);F!=null&&(r=Ve({inputs:{x:r},backend:s,attrs:{shape:F}}),v.push(r))}const S=Ve({inputs:{x:e},backend:s,attrs:{shape:[1,g,fe(e.shape)/g]}});v.push(S);const C=new $6(y,t),k=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],I=s.runWebGLProgram(C,[n],"float32",k),A=Ve({inputs:{x:I},backend:s,attrs:{shape:y}});v.push(I),v.push(A);const T=r!=null,E=o!=null,$=a==="leakyrelu",D=a?Ac(a,!0):null,M=new mI(m?A.shape:S.shape,m?S.shape:A.shape,m?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],b,w,T,D,E,$),P=m?[A,S]:[S,A];if(r&&P.push(r),E&&P.push(o),$){const F=s.makeTensorInfo([],"float32",Xo(i,"float32"));P.push(F),v.push(F)}const L=s.runWebGLProgram(M,P,"float32"),O=Ve({inputs:{x:L},backend:s,attrs:{shape:t.outShape}});v.push(L);for(const F of v)s.disposeIntermediateTensorInfo(F);return O}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s,h=ko(c),f=os(r.shape,o.shape,i,l,a,d,!1,h);let p;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))p=NI({x:r,filter:o,convInfo:f,backend:t});else if(f.strideWidth<=2&&h==="channelsLast"&&ce().getBool("WEBGL_EXP_CONV")){const g=new CI(f),x=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];p=t.runWebGLProgram(g,[r,o],"float32",x)}else if(ce().getBool("WEBGL_CONV_IM2COL"))p=II({x:r,filter:o,convInfo:f,backend:t});else{const g=new SI(f);p=t.runWebGLProgram(g,[r,o],"float32")}const m=Ve({inputs:{x:p},backend:t,attrs:{shape:f.outShape}});return t.disposeIntermediateTensorInfo(p),m}const A6={kernelName:Pd,backendName:"webgl",kernelFunc:T6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class E6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,c=s-1-e.padInfo.left,l=i?1:2,d=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class D6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class j6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=t-1-e.padInfo.front,l=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s,h=ko(c),f=os(r.shape,d,i,1,a,l,!1,h),p=new R6(f);return t.runWebGLProgram(p,[r,o],"float32")}const P6={kernelName:dm,backendName:"webgl",kernelFunc:_6};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M6{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ms(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s,h=ko(l),f=os(i,o.shape,a,1,c,d,!1,h);if(ce().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[f.strideHeight,f.strideWidth]],m=new M6(f);return t.runWebGLProgram(m,[r,o],"float32",p)}else{const p=new E6(f);return t.runWebGLProgram(p,[r,o],"float32")}}const O6={kernelName:Md,backendName:"webgl",kernelFunc:F6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=Yo(r.shape,o.shape,i,c,a),d=new k6(l);return t.runWebGLProgram(d,[r,o],"float32")}const z6={kernelName:Fd,backendName:"webgl",kernelFunc:L6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s,l=Yo(r.shape,c,i,1,a),d=new D6(l);return t.runWebGLProgram(d,[r,o],"float32")}const B6={kernelName:hm,backendName:"webgl",kernelFunc:W6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s,l=Yo(c,o.shape,a,1,i),d=new j6(l);return t.runWebGLProgram(d,[r,o],"float32")}const U6={kernelName:fm,backendName:"webgl",kernelFunc:V6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G6=Qa+`
  return cos(x);
`,H6=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Yi}
  return result;
`,q6=Xt({opSnippet:G6,packedOpSnippet:H6}),K6={kernelName:Gc,backendName:"webgl",kernelFunc:q6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X6=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Q6=Xt({opSnippet:X6}),Y6={kernelName:Hc,backendName:"webgl",kernelFunc:Q6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J6{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,c,l]=e,[d]=t,[h,f]=s;this.outputShape=[d,h,f,l];const p=r==="bilinear"?1:0,[m,g]=[`${a-1}.0`,`${c-1}.0`],[x,y,b]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[w,v,S]=f>1?[`${(c-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${v};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z6=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,d=new J6(r.shape,o.shape,a,c,l);return t.runWebGLProgram(d,[r,o,i],"float32")},eH={kernelName:mm,backendName:"webgl",kernelFunc:Z6};var Ec;(function(n){n.Prod="*",n.Sum="+"})(Ec||(Ec={}));class eb{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===Ec.Prod?"1.0":"0.0",a=s?i:`getX(${tb(o,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",d="";s?(l=r?`end != ${c-1}`:"end != 0",d=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${c}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ln(o)} coords = getOutputCoords();
        int end = ${nb(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${d};
          ${nb(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${tb(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function tb(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function nb(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kI(n,e,t,s,r,o){const i=e.shape.length,a=An([s],i);let c=e;a!=null&&(c=Cs({inputs:{x:e},backend:t,attrs:{perm:a}}));const l=_n(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=c.shape[l];let h=Hs({inputs:{x:c},backend:t});for(let f=0;f<=Math.ceil(Math.log2(d))-1;f++){const p=new eb(n,c.shape,!1,o),m=[[f]],g=h;h=t.runWebGLProgram(p,[h],h.dtype,m),t.disposeIntermediateTensorInfo(g)}if(r){const f=new eb(n,c.shape,r,o),p=h;h=t.runWebGLProgram(f,[h],h.dtype),t.disposeIntermediateTensorInfo(p)}if(a!=null){const f=Jo(a),p=Cs({inputs:{x:h},backend:t,attrs:{perm:f}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(c),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return kI(Ec.Prod,r,t,o,i,a)}const nH={kernelName:pm,backendName:"webgl",kernelFunc:tH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return kI(Ec.Sum,r,t,o,i,a)}const rH={kernelName:Od,backendName:"webgl",kernelFunc:sH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=iI(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=lV(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const iH={kernelName:gm,backendName:"webgl",kernelFunc:oH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aH{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],c=i==="NHWC"?r.shape[1]:r.shape[2],l=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],h=c*o,f=l*o,p=d/(o*o),m=i==="NHWC"?[a,h,f,p]:[a,p,h,f],g=new aH(m,o,i);return t.runWebGLProgram(g,[r],r.dtype)}const lH={kernelName:xm,backendName:"webgl",kernelFunc:cH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $I{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ms(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,c=e.outChannels/e.inChannels;let l="",d="";s&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const h=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ms(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,c=e.strideWidth,l=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let y=0;y<h;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(f+1)/2;y++){const b=y*2;if(p+=`
          xC = xCCorner + ${b*l};
          `,c===1){if(b<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?p+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<h)){const w=a%2===0?Jp(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:p+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):w===1?p+=`
                    xC${b+1} = xTexelC${b};
                    `:p+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<h&&(p+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<h&&(p+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<h&&(p+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let m="",g="";s&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:m=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;let d=c;d==null&&(d=[1,1]),R(fs(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const h=os(r.shape,o.shape,i,d,a,l,!0);let f;ce().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?f=new TI(h):f=new $I(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return t.runWebGLProgram(f,[r,o],"float32",p)}const dH={kernelName:Ld,backendName:"webgl",kernelFunc:uH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hH{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class fH{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=s-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s,h=os(r.shape,d,i,a,c,l,!0),f=new hH(h);return t.runWebGLProgram(f,[r,o],"float32")}const mH={kernelName:ym,backendName:"webgl",kernelFunc:pH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gH(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s,h=os(d,o.shape,i,a,c,l,!0),f=new fH(h);return t.runWebGLProgram(f,[r,o],"float32")}const xH={kernelName:bm,backendName:"webgl",kernelFunc:gH};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yH{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bH(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=fe(s.shape),i=Ve({inputs:{x:s},backend:t,attrs:{shape:[o]}}),a=new yH(o),c=t.runWebGLProgram(a,[i],i.dtype),l=Ve({inputs:{x:c},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(c),l}const wH={kernelName:lw,backendName:"webgl",kernelFunc:bH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vH{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:d}=e,{top:h,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=Rl(r.shape,o.shape,i,a,"NHWC",c);let d;const h=new vH(l);d=t.runWebGLProgram(h,[r,o],"float32");const f=Ve({inputs:{x:d},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(d),f}const CH={kernelName:zd,backendName:"webgl",kernelFunc:SH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=Xg(r,o.length);Yg(i.length,c,o);const{path:l,steps:d}=Jg(a,c),h=d.length;let f=null,p=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=Qg(p,c[x]);let w;Zg(y)?w=o[x]:(w=Cs({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(w));const v=w.shape.slice();for(let S=0;S<b.length;++S)v.splice(b[S],0,1);tn(w.shape,v)||(w=Ve({inputs:{x:w},backend:t,attrs:{shape:v}}),m.push(w)),f===null?f=w:(f=L0({inputs:{a:w,b:f},backend:t}),m.push(f))}g<h-1&&(l[g]>=0&&(f=tf({inputs:{x:f},backend:t,attrs:{axis:l[g]-(i.length-p),keepDims:!1}}),m.push(f)),p--)}for(const g of m)g!==f&&t.disposeIntermediateTensorInfo(g);return f}const IH={kernelName:wm,backendName:"webgl",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kH="return (x >= 0.0) ? x : (exp(x) - 1.0);",$H=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,TH=Xt({opSnippet:kH,packedOpSnippet:$H}),AH={kernelName:Kc,backendName:"webgl",kernelFunc:TH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RH="return (b >= 0.0) ? a : a * (b + 1.0);",EH=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,DH=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=ce().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xa(EH,s.shape,r.shape):new Li(RH,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},jH={kernelName:vm,backendName:"webgl",kernelFunc:DH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _H=`
  return vec4(equal(a, b));
`,PH="return float(a == b);",MH=as({opSnippet:PH,packedOpSnippet:_H,dtype:"bool",cpuKernelImpl:pV}),FH={kernelName:Wd,backendName:"webgl",kernelFunc:MH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OH=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Bg};
  float a1 = ${Vg};
  float a2 = ${Ug};
  float a3 = ${Gg};
  float a4 = ${Hg};
  float a5 = ${qg};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,LH=Xt({opSnippet:OH}),zH={kernelName:Xc,backendName:"webgl",kernelFunc:LH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WH=Qa+`
  return exp(x);
`,BH=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,AI=Xt({opSnippet:WH,packedOpSnippet:BH,cpuKernelImpl:mV,dtype:"float32"}),VH={kernelName:Qc,backendName:"webgl",kernelFunc:AI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fp(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let c=r;return r<0&&(R(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+r+1),a.splice(c,0,1),Ve({inputs:{x:o},backend:s,attrs:{shape:a}})}const UH={kernelName:Bd,backendName:"webgl",kernelFunc:Fp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sb="return exp(x) - 1.0;",GH=Xt({opSnippet:sb,packedOpSnippet:sb,cpuKernelImpl:gV}),HH={kernelName:Yc,backendName:"webgl",kernelFunc:GH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rb{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RI(n,e,t){const s=t.texData.get(n.dataId),r=fe(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=Ve({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),c=a.shape,l=new rb("real",c,e),d=new rb("imag",c,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],f=t.runWebGLProgram(l,h,"float32"),p=t.runWebGLProgram(d,h,"float32"),m=ri({inputs:{real:f,imag:p},backend:t});t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p);const g=Ve({inputs:{x:m},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(m),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(n){const{inputs:e,backend:t}=n,{input:s}=e;return RI(s,!1,t)}const KH={kernelName:Sm,backendName:"webgl",kernelFunc:qH};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XH{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yl(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||Ma(r),o==="string"){const i=En(o,fe(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new XH(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const QH={kernelName:Cm,backendName:"webgl",kernelFunc:Yl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YH{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JH={kernelName:Nm,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new YH(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ob="return floor(x);",ZH=Xt({opSnippet:ob,packedOpSnippet:ob,cpuKernelImpl:xV}),eq={kernelName:Jc,backendName:"webgl",kernelFunc:ZH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tq=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,nq=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,sq=as({opSnippet:tq,packedOpSnippet:nq,dtype:"int32"}),rq={kernelName:Zc,backendName:"webgl",kernelFunc:sq};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oq{constructor(e){this.variableNames=["A"];const t=Ns(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iq{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Ns(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aq={kernelName:s2,backendName:"webgl",kernelFunc:cq};let sa,Pf=ce().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function cq(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,l]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[l,c],h=[l,c,o];if(a||i){const g=ce().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(sa==null||g!==Pf)&&(Pf=g,sa=document.createElement("canvas").getContext("2d",{willReadFrequently:Pf})),sa.canvas.width=c,sa.canvas.height=l,sa.drawImage(r,0,0,c,l),r=sa.canvas}const f=t.makeTensorInfo(d,"int32");t.texData.get(f.dataId).usage=Qs.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),r);const p=ce().getBool("WEBGL_PACK")?new iq(h):new oq(h),m=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s,g=ko(d),x=os(r.shape,o.shape,c,h,l,f,!1,g);let y;const b=[],w=i!=null,v=a!=null,S=p==="leakyrelu",C=()=>{const I=[r,o],A=(T,E)=>{if(E==="NCHW"&&T.shape.length===1&&T.shape[0]!==1){const $=Ve({inputs:{x:T},backend:t,attrs:{shape:[T.shape[0],1,1]}});return b.push($),$}return T};if(w&&I.push(A(i,d)),v&&I.push(A(a,d)),S){const T=t.makeTensorInfo([],"float32",Xo(m,"float32"));I.push(T),b.push(T)}return I};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=NI({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:m});else if(x.strideWidth<=2&&g==="channelsLast"&&ce().getBool("WEBGL_EXP_CONV")){const I=p?Ac(p,!0):null,A=new CI(x,w,I,v,S),T=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],E=C();y=t.runWebGLProgram(A,E,"float32",T)}else if(ce().getBool("WEBGL_CONV_IM2COL"))y=II({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:m});else{const I=p?Ac(p,!1):null,A=new SI(x,w,I,v,S),T=C();y=t.runWebGLProgram(A,T,"float32")}const k=Ve({inputs:{x:y},backend:t,attrs:{shape:x.outShape}});return b.push(y),b.forEach(I=>t.disposeIntermediateTensorInfo(I)),k}const uq={kernelName:Du,backendName:"webgl",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,m=[];let g=d;g==null&&(g=[1,1]),R(fs(c,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const x=os(r.shape,o.shape,c,g,l,h,!0),y=ce().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,b=f?Ac(f,y):null,w=[r,o],v=i!=null,S=a!=null,C=f==="leakyrelu";if(v&&w.push(i),S&&w.push(a),C){const T=t.makeTensorInfo([],"float32",Xo(p,"float32"));w.push(T),m.push(T)}let k;y?k=new TI(x,v,b,S,C):k=new $I(x,v,b,S,C);const I=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],A=t.runWebGLProgram(k,w,"float32",I);return m.forEach(T=>t.disposeIntermediateTensorInfo(T)),A}const hq={kernelName:Tw,backendName:"webgl",kernelFunc:dq};class fq{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=ln(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=fe(s.shape),[c,l,d,h]=Eg(s,r),f=Ve({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),p=Ve({inputs:{x:s},backend:t,attrs:{shape:[fe(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=t.readSync(r.dataId),b=t.bufferSync(s),w=yV(y,b,s.dtype,l,i,d,h,s.shape,a);return t.makeTensorInfo(c,s.dtype,w.values)}const m=new fq(i,h,[l,d],s.shape),g=t.runWebGLProgram(m,[p,f],p.dtype),x=Ve({inputs:{x:g},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const mq={kernelName:uw,backendName:"webgl",kernelFunc:pq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gq{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=ln(this.rank),r=xq(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function xq(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,c=Lt(i,r.shape)[0];if(ce().get("DEBUG")){const b=t.readSync(o.dataId),w=r.shape[c];for(let v=0;v<b.length;++v){const S=b[v];R(S<=w-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${w-1}]`)}}const l=t0(r,o,c,a),d=fe(o.shape),h=[],f=Ve({inputs:{x:r},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=Ve({inputs:{x:o},backend:t,attrs:{shape:[l.batchSize,d/l.batchSize]}});h.push(f),h.push(p);const m=[l.batchSize,l.outerSize,d/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=t.bufferSync(p),w=t.bufferSync(f),v=bV(w,b,m);return h.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(l.outputShape,v.dtype,v.values)}const g=new gq(f.shape,m),x=t.runWebGLProgram(g,[f,p],f.dtype);h.push(x);const y=Ve({inputs:{x},backend:t,attrs:{shape:l.outputShape}});return h.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const yq={kernelName:Ud,backendName:"webgl",kernelFunc:EI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bq="return float(a > b);",wq=`
  return vec4(greaterThan(a, b));
`,vq=as({opSnippet:bq,packedOpSnippet:wq,cpuKernelImpl:wV,dtype:"bool"}),Sq={kernelName:Gd,backendName:"webgl",kernelFunc:vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cq="return float(a >= b);",Nq=`
  return vec4(greaterThanEqual(a, b));
`,Iq=as({opSnippet:Cq,packedOpSnippet:Nq,dtype:"bool",cpuKernelImpl:vV}),kq={kernelName:el,backendName:"webgl",kernelFunc:Iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $q(n){const{inputs:e,backend:t}=n,{input:s}=e;return RI(s,!0,t)}const Tq={kernelName:Im,backendName:"webgl",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aq="return float(!isnan(x) && !isinf(x));",Rq=Xt({opSnippet:Aq,dtype:"bool"}),Eq={kernelName:nl,backendName:"webgl",kernelFunc:Rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dq="return float(isinf(x));",jq=Xt({opSnippet:Dq,dtype:"bool"}),_q={kernelName:sl,backendName:"webgl",kernelFunc:jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pq="return float(isnan(x));",Mq=Xt({opSnippet:Pq,dtype:"bool"}),Fq={kernelName:rl,backendName:"webgl",kernelFunc:Mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oq="return float(a < b);",Lq=`
  return vec4(lessThan(a, b));
`,zq=as({opSnippet:Oq,packedOpSnippet:Lq,cpuKernelImpl:SV,dtype:"bool"}),Wq={kernelName:qd,backendName:"webgl",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bq="return float(a <= b);",Vq=`
  return vec4(lessThanEqual(a, b));
`,Uq=as({opSnippet:Bq,packedOpSnippet:Vq,cpuKernelImpl:CV,dtype:"bool"}),Gq={kernelName:Kd,backendName:"webgl",kernelFunc:Uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hq(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=NV(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const qq={kernelName:dw,backendName:"webgl",kernelFunc:Hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=Qa+`
  return x < 0.0 ? 0./0. : log(x);
`,Xq=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Qq=Xt({opSnippet:Kq,packedOpSnippet:Xq,cpuKernelImpl:IV}),Yq={kernelName:ol,backendName:"webgl",kernelFunc:Qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jq=Qa+`
  return log(1.0 + x);
`,Zq=Xt({opSnippet:Jq}),e7={kernelName:il,backendName:"webgl",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t7="return float(a >= 1.0 && b >= 1.0);",n7=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,s7=as({opSnippet:t7,packedOpSnippet:n7,dtype:"bool"}),r7={kernelName:Xd,backendName:"webgl",kernelFunc:s7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7="return float(!(x >= 1.0));",i7=Xt({opSnippet:o7}),a7={kernelName:Qd,backendName:"webgl",kernelFunc:i7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7="return float(a >= 1.0 || b >= 1.0);",l7=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,u7=as({opSnippet:c7,packedOpSnippet:l7,dtype:"bool"}),d7={kernelName:Yd,backendName:"webgl",kernelFunc:u7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h7{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f7{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s,l=ce().getBool("WEBGL_PACK_NORMALIZATION")?new f7(r.shape,o,i,a,c):new h7(r.shape,o,i,a,c);return t.runWebGLProgram(l,[r],r.dtype)},m7={kernelName:Jd,backendName:"webgl",kernelFunc:p7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g7{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s,h=new g7(r.shape,a,c,l,d);return t.runWebGLProgram(h,[r,o,i],r.dtype)},y7={kernelName:$m,backendName:"webgl",kernelFunc:x7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n,e,t,s){const r=fe(e),i=fe(n.shape)/r,a=Ve({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=Ji(a,n.dtype,"max",s),l=Ve({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=An(l,a),h=d!=null,f=t.shouldExecuteOnCPU([r]);let p=r;if(h){if(f){const w=t.texData.get(p.dataId).values,v=new Array(a);for(let k=0;k<v.length;k++)v[k]=r.shape[d[k]];const S=F0(w,r.shape,r.dtype,d,v);p=t.makeTensorInfo(v,r.dtype);const C=t.texData.get(p.dataId);C.values=S}else p=ef(r,d,t);l=_n(l.length,a)}is("max",l,a);const[m,g]=Zn(p.shape,l);let x=m;i&&(x=zn(m,c));let y;if(f){const w=t.texData.get(p.dataId).values,v=kV(w,fe(g),x,r.dtype);y=t.makeTensorInfo(x,r.dtype);const S=t.texData.get(y.dataId);S.values=v}else y=b7(p,g,x,t);return h&&t.disposeIntermediateTensorInfo(p),y}const w7={kernelName:Zd,backendName:"webgl",kernelFunc:DI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7=O0+`
  return max(a, b);
`,S7=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yi+`
  return result;
`,C7=as({opSnippet:v7,packedOpSnippet:S7,cpuKernelImpl:$V}),N7={kernelName:al,backendName:"webgl",kernelFunc:C7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Kl(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(fs(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=pr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&tn(d.inShape,d.outShape))return Hs({inputs:{x:r},backend:t});const h=new Rc(d,"max",!1);return t.runWebGLProgram(h,[r],r.dtype)}const k7={kernelName:eh,backendName:"webgl",kernelFunc:I7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=s,d=[1,1,1],h=Io(r.shape,o,i,d,a,l,c),f=new z0(h,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const T7={kernelName:th,backendName:"webgl",kernelFunc:$7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A7{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,c=i-1-e.padInfo.left,l=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class R7{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=c-1-e.padInfo.front,f=l-1-e.padInfo.top,p=d-1-e.padInfo.left,m=c*l*d-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],f=Io(i.shape,a,c,h,l,d),p=new z0(f,"max",!0),m=t.runWebGLProgram(p,[i],i.dtype),g=new R7(f),x=t.runWebGLProgram(g,[r,m],i.dtype);return t.disposeIntermediateTensorInfo(m),x}const D7={kernelName:Am,backendName:"webgl",kernelFunc:E7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;Kl([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,f=pr(a.shape,c,l,1,d,h),p=!0,m=new Rc(f,"max",p),g=t.runWebGLProgram(m,[a],a.dtype),x=new A7(f),y=t.runWebGLProgram(x,[r,g],a.dtype);return t.disposeIntermediateTensorInfo(g),y}const _7={kernelName:Tm,backendName:"webgl",kernelFunc:j7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(n,e,t,s){let r=new Rc(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new Rc(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7={kernelName:hw,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;R(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];R(fs(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const d=pr(s.shape,r,o,l,i),[h,f]=P7(s,a,d,c);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7(n,e,t,s){const r=fe(e),i=fe(n.shape)/r,a=Ve({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=Ji(a,"float32","mean",s),l=Ve({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O7={kernelName:nh,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,a=s.shape.length,c=Lt(o,s.shape);let l=c;const d=An(l,a),h=d!=null,f=i.shouldExecuteOnCPU([s]),p=[];let m=s;if(h){if(f){const v=i.texData.get(m.dataId).values,S=new Array(a);for(let I=0;I<S.length;I++)S[I]=s.shape[d[I]];const C=F0(v,s.shape,s.dtype,d,S);m=i.makeTensorInfo(S,s.dtype);const k=i.texData.get(m.dataId);k.values=C}else m=ef(s,d,i);p.push(m),l=_n(l.length,a)}is("sum",l,a);const[g,x]=Zn(m.shape,l);let y=g;r&&(y=zn(g,c));const b=F7(m,x,y,i);for(const w of p)i.disposeIntermediateTensorInfo(w);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Lt(o,r.shape);let l=c;const d=An(l,a);let h=r;d!=null&&(h=Cs({inputs:{x:r},backend:t,attrs:{perm:d}}),l=_n(l.length,r.shape.length)),is("min",l,a);const[f,p]=Zn(h.shape,l),m=fe(p),g=Ve({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=Ji(g,g.dtype,"min",t);let y;if(i){const b=zn(f,c);y=Ve({inputs:{x},backend:t,attrs:{shape:b}})}else y=Ve({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const z7={kernelName:sh,backendName:"webgl",kernelFunc:L7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7=O0+`
  return min(a, b);
`,B7=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yi+`
  return result;
`,V7=as({opSnippet:W7,packedOpSnippet:B7,cpuKernelImpl:TV}),U7={kernelName:cl,backendName:"webgl",kernelFunc:V7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G7{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,h)=>d[0]+e[h]+d[1]);const r=e.length,o=ln(r),i=t.map(d=>d[0]).join(","),a=t.map((d,h)=>d[0]+e[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H7{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,o=ln(r),i=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),c=vs("rc",r),l=vs("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,f=s==="reflect"?0:1;let p="";if(r===1){const m=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const m=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new H7(s.shape,r,o):new G7(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},K7={kernelName:rh,backendName:"webgl",kernelFunc:q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7=`if (b == 0.0) return NAN;
  return mod(a, b);`,Q7=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Yi+`
  return result;
`,Y7=as({opSnippet:X7,packedOpSnippet:Q7}),J7={kernelName:ll,backendName:"webgl",kernelFunc:Y7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z7{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e8=`
if (a == b) {
  return 1.0;
};
return a / b;`,t8=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,jI=as({opSnippet:e8,packedOpSnippet:t8,checkOutOfBounds:!0}),n8={kernelName:qc,backendName:"webgl",kernelFunc:jI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ib="return a - b;",_I=as({opSnippet:ib,packedOpSnippet:ib,supportsComplex:!0,cpuKernelImpl:XV}),s8={kernelName:Il,backendName:"webgl",kernelFunc:_I};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PI(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=Lt([o],r.shape),a=DI({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),c=zn(a.shape,i),l=Ve({inputs:{x:a},backend:t,attrs:{shape:c}}),d=_I({inputs:{a:r,b:l},backend:t}),h=AI({inputs:{x:d},backend:t}),f=tf({inputs:{x:h},backend:t,attrs:{axis:i,keepDims:!1}}),p=Ve({inputs:{x:f},backend:t,attrs:{shape:c}}),m=jI({inputs:{a:h,b:p},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),m}const r8={kernelName:Sh,backendName:"webgl",kernelFunc:PI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,c=a?r:PI({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),l=c.shape[0],d=c.shape[1],h=new Z7(l,d,o),f=[[i]],p=t.runWebGLProgram(h,[c],"int32",f);return a||t.disposeIntermediateTensorInfo(c),p}const i8={kernelName:fw,backendName:"webgl",kernelFunc:o8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8=gr+`
  return -x;
`,c8=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function l8(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,a]=RV(o.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}let r;return ce().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new _o(s.shape,c8):r=new Qr(s.shape,a8),t.runWebGLProgram(r,[s],s.dtype)}const u8={kernelName:oh,backendName:"webgl",kernelFunc:l8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d8=Ig;function h8(n){Xs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:h}=d8(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const f8={kernelName:Rm,backendName:"webgl",kernelFunc:h8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8=kg;function m8(n){Xs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),{selectedIndices:f,validOutputs:p}=p8(d,h,i,a,c,l);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const g8={kernelName:Em,backendName:"webgl",kernelFunc:m8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x8=$g;function y8(n){Xs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),f=i,p=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=x8(d,h,f,p,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const b8={kernelName:Dm,backendName:"webgl",kernelFunc:y8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w8{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s,l=fe(r.shape),d=new w8(l,i,a,c),h=Ve({inputs:{x:r},backend:t,attrs:{shape:[l]}}),f=t.runWebGLProgram(d,[h],o);t.disposeIntermediateTensorInfo(h);const p=[...r.shape,i],m=Ve({inputs:{x:f},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(f),m},S8={kernelName:ch,backendName:"webgl",kernelFunc:v8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Ql({inputs:{input:s},backend:t}),o=id({inputs:{x:r},backend:t}),i=nf({inputs:{input:s},backend:t}),a=id({inputs:{x:i},backend:t}),c=ri({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Yl({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const C8={kernelName:Ih,backendName:"webgl",kernelFunc:id};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MI(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ql({inputs:{input:s},backend:t}),o=MI({inputs:{x:r},backend:t}),i=nf({inputs:{input:s},backend:t}),a=id({inputs:{x:i},backend:t}),c=ri({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Yl({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const N8={kernelName:ah,backendName:"webgl",kernelFunc:MI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Fp({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Zp(o,d.shape,"All tensors passed to stack must have matching shapes"),R(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=Fp({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=vI({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const k8={kernelName:lh,backendName:"webgl",kernelFunc:I8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $8{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,d)=>l[0]+e[d]+l[1]);const r=e.length,o=ln(r),i=t.map(l=>l[0]).join(","),a=t.map((l,d)=>l[0]+e[d]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T8{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,o=ln(r),i=t.map(g=>g[0]).join(","),a=t.map((g,x)=>g[0]+e[x]).join(","),c=vs("rc",r),l=vs("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${d}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let g=0,x=r===1?2:4;g<x;g++)m+=`
        ${f[g]}
        if (${p}) {
          result[${g}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${h});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FI=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(fe(r.shape)===0){const l=o.map((d,h)=>d[0]+r.shape[h]+d[1]);return Yl({backend:t,attrs:{shape:l,value:i,dtype:r.dtype}})}const a=ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new T8(r.shape,o,i):new $8(r.shape,o,i),c=[[i]];return t.runWebGLProgram(a,[r],r.dtype,c)},A8={kernelName:uh,backendName:"webgl",kernelFunc:FI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,E8=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Yi+`
  return result;
`,D8=as({opSnippet:R8,packedOpSnippet:E8}),j8={kernelName:dl,backendName:"webgl",kernelFunc:D8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=[],l=Lt(o,r.shape);let d=l;const h=An(d,a);let f=r;h!=null&&(f=Cs({inputs:{x:r},backend:t,attrs:{perm:h}}),d=_n(d.length,a),c.push(f)),is("prod",d,a);let p;if(t.shouldExecuteOnCPU([f])){const m=t.texData.get(f.dataId).values,{outVals:g,outShape:x,outDtype:y}=DV(f.shape,f.dtype,m,d);p=t.makeTensorInfo(x,y,g)}else{const[m,g]=Zn(f.shape,d),x=fe(g),y=Ve({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=Gm(r.dtype),w=Ji(y,b,"prod",t);p=Ve({inputs:{x:w},backend:t,attrs:{shape:m}}),c.push(y),c.push(w)}if(i){c.push(p);const m=zn(p.shape,l);p=Ve({inputs:{x:p},backend:t,attrs:{shape:m}})}return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const P8={kernelName:hh,backendName:"webgl",kernelFunc:_8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.readSync(y.dataId)),l=r.map(y=>y.shape),d=t.readSync(o.dataId),h=t.readSync(i.dataId),[f,p,m]=jV(c,l,d,o.shape,o.dtype,h,i.shape,a),g=f.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,p);return g.concat([x])}const F8={kernelName:pw,backendName:"webgl",kernelFunc:M8};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=_V(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),f=t.makeTensorInfo([d.length],s.dtype,d);return[h,f]}const L8={kernelName:mw,backendName:"webgl",kernelFunc:O8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),h=t.readSync(i.dataId),f=a.map(x=>t.readSync(x.dataId)),p=a.map(x=>x.shape),[m,g]=PV(l,r.shape,d,o.shape,o.dtype,h,i.shape,f,p,c);return t.makeTensorInfo(m,o.dtype,g)}const W8={kernelName:gw,backendName:"webgl",kernelFunc:z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OI=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,a=MV(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},B8={kernelName:jm,backendName:"webgl",kernelFunc:OI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V8="return 1.0 / x;",U8=Xt({opSnippet:V8}),G8={kernelName:hl,backendName:"webgl",kernelFunc:U8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8=gr+`
  return (x < 0.0) ? 0.0 : x;
`,q8=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,K8=Xt({opSnippet:H8,packedOpSnippet:q8}),X8={kernelName:fl,backendName:"webgl",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q8=gr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Y8=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,J8=Xt({opSnippet:Q8,packedOpSnippet:Y8}),Z8={kernelName:pl,backendName:"webgl",kernelFunc:J8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eK{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tK{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=ce().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tK(r.shape,c,l,o,i):new eK(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],"float32")}const sK={kernelName:mh,backendName:"webgl",kernelFunc:nK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rK{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],f=1/d,p=1/h,m=Math.ceil(f)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new rK(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const iK={kernelName:Mm,backendName:"webgl",kernelFunc:oK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aK{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],f=r?"0.5":"0.0";let p;o?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cK{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],f=r?"0.5":"0.0";let p;o?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=ce().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cK(r.shape,c,l,o,i):new aK(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const uK={kernelName:ph,backendName:"webgl",kernelFunc:lK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dK{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],f=1/d,p=1/h,m=Math.ceil(f)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new dK(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const fK={kernelName:Pm,backendName:"webgl",kernelFunc:hK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pK{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,c)=>r(c)).join(","),i=ln(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mK{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=vs("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=ln(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${o}){
            result.g = ${l(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(m){return f(m)}function l(m){return m[s-1]="("+m[s-1]+" + 1)",f(m)}function d(m){return m[s-2]="("+m[s-2]+" + 1)",f(m)}function h(m){return m[s-1]="("+m[s-1]+" + 1)",m[s-2]="("+m[s-2]+" + 1)",f(m)}function f(m){const g=e.map((b,w)=>p(w,m)),x=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${y}))`}function p(m,g){return t.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${g[m]} - 1`:`${g[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,a=Lt(o,r.shape);if(i===0)return Hs({inputs:{x:r},backend:t});const c=ce().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mK(r.shape,a):new pK(r.shape,a);return t.runWebGLProgram(c,[r],r.dtype)}const xK={kernelName:gh,backendName:"webgl",kernelFunc:gK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yK{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK={kernelName:Vm,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=new yK(s.shape,o),[l,d]=Lg(i,s.shape[1],s.shape[2]),h=[[l,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(c,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,vK=Xt({opSnippet:wK}),SK={kernelName:ml,backendName:"webgl",kernelFunc:vK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK="return inversesqrt(x);",NK=Xt({opSnippet:CK,cpuKernelImpl:FV}),IK={kernelName:gl,backendName:"webgl",kernelFunc:NK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W0{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=ln(o.length),d=ln(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const m=`getUpdates(${p})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kK{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=ln(o.length),d=ln(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const m=`getUpdates(${p})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides",b=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=Hi(o,r,i),f=[h/l,l];if(h===0)return t.makeTensorInfo(i,r.dtype);const p=Ve({inputs:{x:r},backend:t,attrs:{shape:[c,a]}}),m=Ve({inputs:{x:o},backend:t,attrs:{shape:[c,l]}}),g=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;ce().getBool("WEBGL_PACK")?x=new kK(c,a,p.shape.length,m.shape.length,d,f):x=new W0(c,a,p.shape.length,m.shape.length,d,f);const y=t.runWebGLProgram(x,[m,p,g],m.dtype),b=Ve({inputs:{x:y},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(g),b}const TK={kernelName:xw,backendName:"webgl",kernelFunc:$K};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AK{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=ce().getNumber("WEBGL_VERSION")===2?o:i,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=new AK(r.shape[0],r.shape[1],o.shape[1],i),c=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",c)}const EK={kernelName:bw,backendName:"webgl",kernelFunc:RK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DK{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let d=0;d<t.length;d++)l.push(`${a[d]}`),d<e&&c.push(`${a[d]}`);r=c.join(),o=l.join()}const i=ln(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new DK(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],Us(r.dtype,o.dtype))}const _K={kernelName:xh,backendName:"webgl",kernelFunc:jK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Fh};
  float scale = ${Oh};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,MK=Xt({opSnippet:PK}),FK={kernelName:xl,backendName:"webgl",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OK=Qa+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,LK=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zK=Xt({opSnippet:OK,packedOpSnippet:LK,cpuKernelImpl:LV}),WK={kernelName:vl,backendName:"webgl",kernelFunc:zK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BK=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,VK=Xt({opSnippet:BK}),UK={kernelName:wl,backendName:"webgl",kernelFunc:VK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GK=Qa+`
  return sin(x);
`,HK=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Yi}
  return result;
`,qK=Xt({opSnippet:GK,packedOpSnippet:HK}),KK={kernelName:yl,backendName:"webgl",kernelFunc:qK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XK=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,QK=Xt({opSnippet:XK}),YK={kernelName:bl,backendName:"webgl",kernelFunc:QK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JK=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ZK=Xt({opSnippet:JK}),eX={kernelName:Sl,backendName:"webgl",kernelFunc:ZK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tX=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;R(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,b)=>y*b),c=[[0,0]];c.push(...i);for(let y=1+o.length;y<r.shape.length;++y)c.push([0,0]);const l=[],d=FI({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),h=Pl(d.shape,o,a,!1),f=Ml(h.length,o.length,!1),p=Fl(d.shape,o,a,!1),m=Ve({inputs:{x:d},backend:t,attrs:{shape:h}}),g=Cs({inputs:{x:m},backend:t,attrs:{perm:f}}),x=Ve({inputs:{x:g},backend:t,attrs:{shape:p}});return l.push(d),l.push(m),l.push(g),l.forEach(y=>t.disposeIntermediateTensorInfo(y)),x},nX={kernelName:wh,backendName:"webgl",kernelFunc:tX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sX(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(s.dataId),c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[h,f,p,m,g]=WV(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(f,s.dtype,h),t.makeTensorInfo([f[0]],r.dtype,p),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const rX={kernelName:ww,backendName:"webgl",kernelFunc:sX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oX(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),c=Array.from(t.readSync(o.dataId)),[l,d,h]=BV(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const iX={kernelName:vw,backendName:"webgl",kernelFunc:oX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=cI(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const cX={kernelName:Sw,backendName:"webgl",kernelFunc:aX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=cI(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const uX={kernelName:Cw,backendName:"webgl",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:f}=Hi(o,r,a),p=!1;if(o.dtype==="string"){const y=t.bufferSync(r),b=t.bufferSync(o),w=Bo(t.readSync(i.dataId)[0]),v=OV(y,b,a,f,d,l,c,h,w,p);return t.makeTensorInfo(a,v.dtype,v.values)}const m=new W0(l,c,r.shape.length,o.shape.length,h,[f,1],p),g=t.runWebGLProgram(m,[o,r,i],o.dtype),x=Ve({inputs:{x:g},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(g),x}const hX={kernelName:Nw,backendName:"webgl",kernelFunc:dX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Lt(i,r.shape)[0],c=e0(r,o,a),l=r.shape.length,d=new Array(l).fill(0),h=r.shape.slice();return c.map(f=>{const p=[...h];p[a]=f;const m=Ya({inputs:{x:r},backend:t,attrs:{begin:d,size:p}});return d[a]+=f,m})}const pX={kernelName:vh,backendName:"webgl",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ab="return sqrt(x);",mX=Xt({opSnippet:ab,packedOpSnippet:ab,cpuKernelImpl:VV}),gX={kernelName:Cl,backendName:"webgl",kernelFunc:mX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX="return x * x;",yX=Xt({opSnippet:xX}),bX={kernelName:Fm,backendName:"webgl",kernelFunc:yX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cb="return (a - b) * (a - b);",wX=as({opSnippet:cb,packedOpSnippet:cb}),vX={kernelName:Nl,backendName:"webgl",kernelFunc:wX};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),i=So(o),a=UV(i,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const CX={kernelName:Om,backendName:"webgl",kernelFunc:SX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NX({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=gr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Qr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const IX={kernelName:Al,backendName:"webgl",kernelFunc:NX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kX{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=ln(s.length),i=ln(s.length);let a="";if(r===1)a="coords * strides + begin";else{let c=0;a=s.map((l,d)=>(c++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${c-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=s,{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:w,strides:v}=Mg(r.shape,o,i,a,c,l,d,h,f);let S;if(g)S=Ve({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){R(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const k=jg(b,w,v),I=Ya({inputs:{x:r},backend:t,attrs:{begin:b,size:k}});S=Ve({inputs:{x:I},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(I)}else if(t.shouldExecuteOnCPU([r])){const I=t.readSync(r.dataId),A=Ot(r.shape,r.dtype,I),T=GV(p,A,v,b);S=t.makeTensorInfo(m,r.dtype,T.values)}else{const I=new kX(b,v,p);S=t.runWebGLProgram(I,[r],r.dtype)}const C=Ve({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),C}const TX={kernelName:Lm,backendName:"webgl",kernelFunc:$X};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,f=t.readSync(d.dataId),p=t.readSync(h.dataId),[m,g]=HV(f,p,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const RX={kernelName:Iw,backendName:"webgl",kernelFunc:AX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),c=t.readSync(i.dataId)[0],[l,d,h]=qV(a,c,r),f=d.length;return[t.makeTensorInfo([f,2],"int32",l),t.makeTensorInfo([f],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const DX={kernelName:kw,backendName:"webgl",kernelFunc:EX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jX(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=KV(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const _X={kernelName:$w,backendName:"webgl",kernelFunc:jX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX="return tan(x);",MX=Xt({opSnippet:PX}),FX={kernelName:kl,backendName:"webgl",kernelFunc:MX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OX=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,LX=Xt({opSnippet:OX}),zX={kernelName:$l,backendName:"webgl",kernelFunc:LX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WX(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=Hi(i,o,r.shape),f=[h/l,l];if(h===0)return t.makeTensorInfo(r.shape,o.dtype);const p=Ve({inputs:{x:o},backend:t,attrs:{shape:[c,a]}}),m=Ve({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),g=Ve({inputs:{x:r},backend:t,attrs:{shape:f}}),x=new W0(c,a,p.shape.length,m.shape.length,d,f,!1,!0),y=t.runWebGLProgram(x,[m,p,g],g.dtype),b=Ve({inputs:{x:y},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const BX={kernelName:yw,backendName:"webgl",kernelFunc:WX};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VX{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=ln(this.rank),o=UX(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function UX(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const c=t.readSync(r.dataId),l=r.dtype==="string"?c.map(f=>Bo(f)):c,d=Ot(r.shape,r.dtype,l),h=QV(d,o);return t.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new VX(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const GX={kernelName:Tl,backendName:"webgl",kernelFunc:LI};class HX{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class qX{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function li(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function lb(n){let e=1;for(;e<n;)e*=2;return e}function KX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,a=ce().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=ce().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,d=l[l.length-1];if(t.shouldExecuteOnCPU([r])||d<a||o>c){const T=t.readSync(r.dataId),[E,$]=YV(T,l,r.dtype,o,i);return[t.makeTensorInfo(E.shape,E.dtype,E.values),t.makeTensorInfo($.shape,$.dtype,$.values)]}if(o===0)return l[l.length-1]=0,[t.makeTensorInfo(l,r.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(d===1)return[r,Yl({attrs:{shape:l,dtype:"int32",value:0},backend:t})];const h=t.texData.get(r.dataId),f=h!==null&&h.isPacked,p=f?t.unpackTensor(r):r,g=fe(l)/d,x=Ve({inputs:{x:p},attrs:{shape:[g,d]},backend:t});f&&li(t,p);const y=lb(o),b=lb(d);let w=null;const v=()=>w===null?[x,x]:[x,w],S=(T,E,$)=>{const D=v(),M=new HX($),L=[[d],[w===null?1:0],[Number.NEGATIVE_INFINITY],[T],[E]],O=w;w=t.runWebGLProgram(M,D,"int32",L),li(t,O)};for(let T=1;T<y;T*=2){const E=T*2;for(let $=T;$>=1;$/=2)S(E,$,[g,b])}for(let T=b;T>y;T/=2){const E=v(),$=new qX([g,T/2]),M=[[d],[w===null?1:0],[y]],P=w;w=t.runWebGLProgram($,E,"int32",M),li(t,P);const L=y/2,O=L*2;for(let F=L;F>=1;F/=2)S(O,F,w.shape)}let C=w;w=Ya({inputs:{x:w},backend:t,attrs:{begin:0,size:[g,o]}}),li(t,C);let k=EI({inputs:{x,indices:w},backend:t,attrs:{axis:1,batchDims:1}});li(t,x);const I=l.slice(0,-1);I.push(o),C=w,w=Ve({inputs:{x:w},attrs:{shape:I},backend:t}),li(t,C);const A=k;return k=Ve({inputs:{x:k},attrs:{shape:I},backend:t}),li(t,A),[k,w]}const XX={kernelName:zm,backendName:"webgl",kernelFunc:KX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QX{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=s,[d,h,f,p]=r.shape,[m,g]=l??[h,f],x=[d,m,g,p],y=new QX(h,f,i,a,c,x);return t.runWebGLProgram(y,[r,o],"float32")}const JX={kernelName:Wm,backendName:"webgl",kernelFunc:YX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Kl(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:c,indices:l}=JV(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const eQ={kernelName:Bm,backendName:"webgl",kernelFunc:ZX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tQ(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,c=r.shape[o],l=new Array(a-1);let d=0;for(let g=0;g<a;g++)g!==o&&(l[d++]=i.shape[g]);const h=[],f=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const m=new Array(c);for(let g=0;g<m.length;g++){f[o]=g;const x=Ya({inputs:{x:i},backend:t,attrs:{begin:f,size:p}}),y=Ve({inputs:{x},backend:t,attrs:{shape:l}});m[g]=y,h.push(x)}return h.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const nQ={kernelName:Ch,backendName:"webgl",kernelFunc:tQ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sQ{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const c="0.0",l="sumValue",d=Math.floor(s/4)*4,h=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,c=[];let l=0;const d=An([l],a);let h=r;d!=null&&(h=Cs({inputs:{x:r},backend:t,attrs:{perm:d}}),c.push(h),l=_n(1,a)[0]);const f=v1(h.shape,l,i),p=fe([h.shape[l]]),m=Ve({inputs:{x:h},backend:t,attrs:{shape:[-1,p]}});c.push(m);const g=Gm(r.dtype),x=(v,S,C,k,I)=>{const A=v.shape[0],T=v.shape[1],E=w1(T,I),$={windowSize:E,inSize:T,batchSize:A,numSegments:I},D=new sQ($,S),M=t.compileAndRun(D,[v,C],k);if(c.push(M),M.shape[1]===I)return M;const P=OI({backend:t,attrs:{start:0,stop:I,step:1,dtype:"float32"}}),L=LI({inputs:{x:P},backend:t,attrs:{reps:[T/E]}});return c.push(P),c.push(L),x(M,S,L,k,I)},y=x(m,"unsortedSegmentSum",o,g,i),b=Ve({inputs:{x:y},backend:t,attrs:{shape:f}});let w=b;if(d!=null){c.push(b);const v=Jo(d);w=Cs({inputs:{x:w},backend:t,attrs:{perm:v}})}return c.forEach(v=>t.disposeIntermediateTensorInfo(v)),w}const oQ={kernelName:Nh,backendName:"webgl",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ=[VU,GU,KU,YU,ZU,nG,rG,iG,uG,hG,mG,yG,vG,IG,TG,RG,DG,MG,OG,zG,UG,YG,ZG,s6,o6,d6,f6,x6,kU,w6,I6,A6,P6,O6,z6,B6,U6,K6,Y6,eH,nH,rH,iH,lH,dH,mH,xH,wH,CH,IH,AH,jH,FH,zH,VH,UH,HH,KH,QH,JH,eq,rq,aq,uq,hq,mq,yq,Sq,kq,IU,Tq,C6,Eq,_q,Fq,TU,Wq,Gq,qq,Yq,e7,r7,a7,d7,m7,y7,w7,N7,k7,T7,D7,_7,M7,O7,z7,U7,K7,J7,i8,EU,u8,f8,g8,b8,a6,S8,N8,k8,A8,j8,RU,P8,F8,L8,W8,B8,c6,n8,G8,X8,Z8,jU,sK,iK,uK,fK,xK,bK,SK,IK,TK,EK,_K,FK,WK,UK,KK,YK,XG,r8,eX,nX,rX,iX,cX,uX,hX,pX,gX,bX,vX,CX,IX,TX,RX,DX,_X,s8,zU,FX,zX,BX,GX,XX,JX,WU,eQ,nQ,oQ,C8];for(const n of iQ)Aw(n);const In=class In{constructor(){me(this,"mlModel",null);me(this,"mlEnabled",!1);me(this,"mlState",{initialized:!1,ready:!1,trainingCount:0,lastTrainedAt:null,accuracy:null})}async analyze(e){var o,i;const t=this.analyzeByRules(e);if(!((((o=e.progress)==null?void 0:o.memorizationAttempts)||((i=e.progress)==null?void 0:i.totalAttempts)||0)<50)&&this.canUseML(e))try{const a=await this.analyzeByML(e);return this.mergeSignals(t,a,e)}catch{}return t}async initializeML(e){if(this.mlState.initialized){j.info(`[${this.name}] ML already initialized`);return}try{const t=e||`/models/${this.id}/model.json`;if(In.unavailableModelPaths.has(t)){await this.createFallbackModel(),this.mlState.initialized=!0,this.mlState.ready=!0;return}const s=`${this.id}_${t}`,r=In.modelCache.get(s);if(r){this.mlModel=r,await this.loadPersonalWeights(),this.mlState.initialized=!0,this.mlState.ready=!0,j.info(`[${this.name}] ‚úÖ ML model loaded from cache (weights reloaded)`);return}j.info(`[${this.name}] Loading ML model from ${t}`),this.mlModel=await wF(t),await this.loadPersonalWeights(),In.modelCache.set(s,this.mlModel),this.updateMemoryUsage(),this.mlState.initialized=!0,this.mlState.ready=!0,j.info(`[${this.name}] ‚úÖ ML initialized successfully`)}catch(t){const s=e||`/models/${this.id}/model.json`;In.unavailableModelPaths.add(s),j.warn(`[${this.name}] ML model unavailable (${s}); using fallback`,t),await this.createFallbackModel(),this.mlState.initialized=!0,this.mlState.ready=!0}}async createFallbackModel(){try{const e=this.getFeatureDimension();this.mlModel=CF({layers:[Af({inputShape:[e],units:Math.ceil(e*.7),activation:"relu",kernelInitializer:"glorotUniform"}),WF({rate:.2}),Af({units:Math.ceil(e*.5),activation:"relu"}),Af({units:this.getOutputDimension(),activation:"sigmoid"})]}),this.mlModel.compile({optimizer:di.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.mlState.initialized=!0,this.mlState.ready=!0,j.info(`[${this.name}] ‚úÖ Fallback model created`)}catch(e){j.error(`[${this.name}] Failed to create fallback model`,e)}}async learn(e,t){if(!(!this.mlEnabled||!this.mlState.ready||!this.mlModel))try{const s=Date.now();if(this.mlState.lastTrainedAt&&s-this.mlState.lastTrainedAt<15e3)return;const r=this.extractFeatures(e),o=this.normalizeLabelToOutputDim(this.outcomeToLabel(t)),i=this.getOutputDimension();if(!Array.isArray(r)||r.length!==this.getFeatureDimension()||o.length!==i)return;const a=ma([r],[1,r.length]),c=ma([o],[1,i]),l=await this.mlModel.fit(a,c,{epochs:1,verbose:0,shuffle:!1});a.dispose(),c.dispose(),this.mlState.trainingCount++,this.mlState.lastTrainedAt=s,l.history.acc&&(this.mlState.accuracy=l.history.acc[0]),this.mlState.trainingCount%10===0&&(await this.savePersonalWeights(),j.debug(`[${this.name}] Weights saved (${this.mlState.trainingCount} trainings)`))}catch(s){const r=Date.now(),o=In.learningErrorLastLogAt.get(this.id)??0;r-o>1e4&&(In.learningErrorLastLogAt.set(this.id,r),j.error(`[${this.name}] Learning failed`,s))}}async predict(e){if(!this.mlModel)throw new Error("ML model not initialized");const t=performance.now(),s=ma([e]),r=this.mlModel.predict(s),o=await r.data();return s.dispose(),r.dispose(),performance.now()-t,{values:Array.from(o),confidence:this.calculatePredictionConfidence(Array.from(o)),timestamp:Date.now()}}canUseML(e){return this.mlEnabled&&this.mlState.ready&&this.mlModel!==null&&this.hasEnoughData(e)}hasEnoughData(e){const t=e.progress;return t?(t.memorizationAttempts??0)>=30:!1}outcomeToLabel(e){const t=e.wasCorrect?0:1;return Array(this.getOutputDimension()).fill(t)}normalizeLabelToOutputDim(e){const t=this.getOutputDimension();return Array.isArray(e)?e.length===t?e:e.length===1?Array(t).fill(e[0]??0):e.length<t?[...e,...Array(t-e.length).fill(0)]:e.slice(0,t):Array(t).fill(0)}calculatePredictionConfidence(e){return 1-Array.from(e).reduce((s,r)=>r>0&&r<1?s-(r*Math.log2(r)+(1-r)*Math.log2(1-r)):s,0)/e.length}async savePersonalWeights(){if(this.mlModel&&!In.disablePersonalWeightsPersistence)try{const e=this.mlModel.getWeights(),t=await this.serializeWeights(e),s={version:"1.0",timestamp:Date.now(),weights:t,metadata:{trainingCount:this.mlState.trainingCount,accuracy:this.mlState.accuracy}},r=`ml-weights-${this.id}`,o=JSON.stringify(s);if(o.length>2e5){try{localStorage.removeItem(r)}catch{}return}localStorage.setItem(r,o)}catch(e){In.disablePersonalWeightsPersistence=!0,j.error(`[${this.name}] Failed to save weights`,e)}}async loadPersonalWeights(){try{const e=localStorage.getItem(`ml-weights-${this.id}`);if(!e||!this.mlModel)return;if(e.length>2e5){try{localStorage.removeItem(`ml-weights-${this.id}`)}catch{}return}const t=JSON.parse(e),s=await this.deserializeWeights(t.weights);this.mlModel.setWeights(s),this.mlState.trainingCount=t.metadata.trainingCount,this.mlState.accuracy=t.metadata.accuracy,j.info(`[${this.name}] Personal weights loaded (${t.metadata.trainingCount} trainings)`)}catch(e){j.warn(`[${this.name}] Failed to load personal weights`,e)}}async serializeWeights(e){const t=await Promise.all(e.map(async s=>Array.from(await s.data())));return btoa(JSON.stringify(t))}async deserializeWeights(e){return JSON.parse(atob(e)).map(s=>fa(s))}enableML(){this.mlEnabled=!0,j.info(`[${this.name}] ML enabled`)}disableML(){this.mlEnabled=!1,j.info(`[${this.name}] ML disabled`)}getMLState(){return{...this.mlState}}updateMemoryUsage(){try{const t=fp().numBytes/(1024*1024);In.memoryUsage.current=t,In.memoryUsage.peak=Math.max(In.memoryUsage.peak,t),In.memoryUsage.lastCheck=Date.now(),t>100}catch(e){j.warn(`[${this.name}] Memory check failed`,e)}}static getMemoryUsage(){return{...In.memoryUsage}}static clearModelCache(){In.modelCache.forEach(e=>{try{e.dispose()}catch(t){j.warn("Failed to dispose model",t)}}),In.modelCache.clear(),j.info("ML model cache cleared")}};me(In,"modelCache",new Map),me(In,"memoryUsage",{current:0,peak:0,lastCheck:Date.now()}),me(In,"initWarningShown",new Set),me(In,"unavailableModelPaths",new Set),me(In,"slowInferenceLastLogAt",new Map),me(In,"learningErrorLastLogAt",new Map),me(In,"disablePersonalWeightsPersistence",!1);let Co=In;const sr=class sr{calculateNextReview(e,t=sr.DEFAULT_EASE_FACTOR,s=sr.FIRST_INTERVAL,r=0){const o=this.updateEaseFactor(t,e),i=this.updateRepetitions(r,e),a=this.calculateInterval(i,s,o,e),c=new Date(Date.now()+a*24*60*60*1e3);return{nextInterval:a,easeFactor:o,repetitions:i,nextReviewDate:c}}updateEaseFactor(e,t){const s=e+(.1-(5-t)*(.08+(5-t)*.02));return Math.max(sr.MIN_EASE_FACTOR,s)}updateRepetitions(e,t){return t<3?0:e+1}calculateInterval(e,t,s,r){if(r<3)return sr.FIRST_INTERVAL;switch(e){case 1:return sr.FIRST_INTERVAL;case 2:return sr.SECOND_INTERVAL;default:return Math.round(t*s)}}determineQuality(e,t,s=!1,r=1){return e?t<3e3&&!s?5:t<5e3&&!s?4:t<1e4?3:2:r>2?0:1}getQualityDescription(e){return{0:"ÂÆåÂÖ®Â§±Êïó - ÂÖ®„ÅèÊÄù„ÅÑÂá∫„Åõ„Å™„ÅÑ",1:"Â§±Êïó - ÊÄù„ÅÑÂá∫„Åõ„Å™„Åã„Å£„Åü„Åå„ÄÅÁ≠î„Åà„ÇíË¶ã„Å¶Á¥çÂæó",2:"Èï∑ËÄÉÊ≠£Ëß£ - „Åã„Å™„ÇäËÄÉ„Åà„Å¶Ê≠£Ëß£",3:"Ê≠£Ëß£ÔºàËø∑„ÅÑÊúâÔºâ - Â∞ë„ÅóËÄÉ„Åà„Å¶Ê≠£Ëß£",4:"Ê≠£Ëß£ÔºàËø∑„ÅÑÁÑ°Ôºâ - „Åô„Åê„Å´Ê≠£Ëß£",5:"ÂÆåÁíß - Áû¨ÊôÇ„Å´Ê≠£Ëß£"}[e]}logCalculation(e,t,s,r,o){}};me(sr,"MIN_EASE_FACTOR",1.3),me(sr,"DEFAULT_EASE_FACTOR",2.5),me(sr,"FIRST_INTERVAL",1),me(sr,"SECOND_INTERVAL",6);let Op=sr;const Ls=class Ls{calculateRetention(e,t){const r=1/Math.max(Ls.MIN_STRENGTH,Math.min(Ls.MAX_STRENGTH,t)),o=Math.exp(-e*r);return Math.max(0,Math.min(1,o))}calculateMemoryStrength(e){const t=Ls.MIN_STRENGTH,s=(e.consecutiveCorrect||0)*1.5,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0,a=(r>0?o/r:0)*3,c=Math.min(r*.2,2),d=(e.memorizationStillLearning||0)*.5,f=(e.consecutiveIncorrect||0)*1,p=t+s+a+c-d-f;return Math.max(Ls.MIN_STRENGTH,Math.min(Ls.MAX_STRENGTH,p))}suggestReviewTiming(e,t=Ls.TARGET_RETENTION){return e<t-.2?"now":e<t-.1?"soon":e<t+.1?"scheduled":"later"}analyzeRetention(e,t,s=Ls.TARGET_RETENTION){const r=this.calculateMemoryStrength(e),o=this.calculateRetention(t,r),i=this.suggestReviewTiming(o,s);return{retention:o,memoryStrength:r,daysSince:t,reviewUrgency:i}}predictDecayDays(e,t=Ls.TARGET_RETENTION){const s=-e*Math.log(t);return Math.max(0,s)}calculateNextReviewDate(e,t=Ls.TARGET_RETENTION){const s=this.calculateMemoryStrength(e),r=this.predictDecayDays(s,t),o=Date.now()+r*24*60*60*1e3;return new Date(o)}logAnalysis(e,t){}getReviewUrgencyLabel(e){return{now:"‰ªä„Åô„ÅêÂæ©Áøí",soon:"ËøëÊó•‰∏≠„Å´Âæ©Áøí",scheduled:"„Çπ„Ç±„Ç∏„É•„Éº„É´ÈÄö„Çä",later:"ÂæåÂõû„Åó„ÅßOK"}[e]}getStrengthDescription(e){return e>=9?"Ë∂ÖÂº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂ÂÆåÂÖ®ÂÆöÁùÄÔºâ":e>=7?"Âº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠Ôºâ":e>=5?"‰∏≠Á®ãÂ∫¶ÔºàÁü≠ÊúüË®òÊÜ∂„Åã„ÇâÁßªË°å‰∏≠Ôºâ":e>=3?"Âº±„ÅÑÔºà„Åæ„Å†Áü≠ÊúüË®òÊÜ∂Ôºâ":"ÈùûÂ∏∏„Å´Âº±„ÅÑÔºà‰ΩúÊ•≠Ë®òÊÜ∂„É¨„Éô„É´Ôºâ"}};me(Ls,"TARGET_RETENTION",.9),me(Ls,"MIN_STRENGTH",1),me(Ls,"MAX_STRENGTH",10);let Lp=Ls;var dc=(n=>(n.WORKING_MEMORY="working",n.SHORT_TERM="short",n.CONSOLIDATING="consolidating",n.LONG_TERM="long",n))(dc||{});const Gr=class Gr{determineMemoryStage(e){const t=this.getDaysSinceFirstAttempt(e),s=e.consecutiveCorrect||0,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0;if(t>=30&&s>=3&&r>=10)return"long";const i=r>0?o/r:0;return t>=7&&s>=2&&i>=.7?"consolidating":t>=1&&o>0?"short":"working"}getDaysSinceFirstAttempt(e){const t=e.firstAttempted||Date.now(),s=(Date.now()-t)/(1e3*60*60*24);return Math.max(0,s)}getReviewIntervals(e){return{working:Gr.WORKING_MEMORY_INTERVALS,short:Gr.SHORT_TERM_INTERVALS,consolidating:Gr.CONSOLIDATING_INTERVALS,long:Gr.LONG_TERM_INTERVALS}[e]}calculateNextReviewInterval(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s),o=t.repetitions,i=r[Math.min(o,r.length-1)],a=t.nextInterval,c=(i+a)/2;return Math.max(.01,c)}analyzeMemoryStage(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s);let o;t?o=this.calculateNextReviewInterval(e,t):o=r[0];const i=this.getStageDescription(s);return{stage:s,recommendedIntervals:r,nextInterval:o,description:i}}getStageDescription(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂ - ÂàùÂõûÂ≠¶ÁøíÁõ¥Âæå„ÄÅÁü≠ÊúüÈñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å",short:"Áü≠ÊúüË®òÊÜ∂ - 1-2ÈÄ±Èñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å„ÄÅÂÆöÁùÄ„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„Çã",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠ - Èï∑ÊúüË®òÊÜ∂„Å∏„ÅÆÁßªË°åÈÅéÁ®ã„ÄÅÊúàÂçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅåÊé®Â•®",long:"Èï∑ÊúüË®òÊÜ∂ - ÂÆåÂÖ®„Å´ÂÆöÁùÄ„ÄÅÂçäÂπ¥ÔΩûÂπ¥Âçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅßÂçÅÂàÜ"}[e]}suggestPriorityAdjustment(e,t){const r=this.getReviewIntervals(e)[0];return t>r*1.5?20:t>r?10:t<r*.5?-10:0}logAnalysis(e,t){}getStageLabel(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂",short:"Áü≠ÊúüË®òÊÜ∂",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠",long:"Èï∑ÊúüË®òÊÜ∂"}[e]}};me(Gr,"WORKING_MEMORY_INTERVALS",[1/1440,10/1440,1/24,.5]),me(Gr,"SHORT_TERM_INTERVALS",[1,3,7,14]),me(Gr,"CONSOLIDATING_INTERVALS",[14,30,60,90]),me(Gr,"LONG_TERM_INTERVALS",[180,365,730]);let zp=Gr;class zI extends Co{constructor(){super();me(this,"id","memory");me(this,"name","Memory AI");me(this,"icon","üß†");me(this,"sm2");me(this,"forgettingCurve");me(this,"longTermStrategy");this.sm2=new Op,this.forgettingCurve=new Lp,this.longTermStrategy=new zp}proposePosition(t,s,r,o,i){if(i===0)return 35;let a=50;const c=this.longTermStrategy.determineMemoryStage(t),l=this.longTermStrategy.suggestPriorityAdjustment(c,r);a+=l;const d=this.determineQuality(t),h=this.sm2.calculateNextReview(d,t.easeFactor||2.5,t.lastInterval||1,t.repetitions||0),f=new Date,p=Math.floor((h.nextReviewDate.getTime()-f.getTime())/(1e3*60*60*24));p<=0?a+=30:p<=2?a+=15:p>=7&&(a-=20);const m=this.forgettingCurve.analyzeRetention(t,r);m.retention<.5?a+=25:m.retention>.8&&(a-=15);const g=o*30;a-=g;const x=Math.min(r*5,40);return a+=x,Math.max(0,Math.min(100,a))}analyzeByRules(t){const{word:s,progress:r,currentTab:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"";if(!r||!r.memorizationAttempts)return this.createNewWordSignal(i);const a=this.determineCategory(r),c=this.calculateForgettingRisk(r),l=this.calculateTimeBoost(r,o),d=this.calculateRetentionStrength(r),h=this.getDaysSinceLastStudy(r),f=this.determineQuality(r),p=this.sm2.calculateNextReview(f,r.easeFactor||2.5,r.lastInterval||1,r.repetitions||0),m=this.forgettingCurve.analyzeRetention(r,h),g=this.forgettingCurve.analyzeRetention(r,h+1).retention,x=this.forgettingCurve.analyzeRetention(r,h+7).retention,b=1-Math.max(0,Math.min(1,(g+x)/2)),w=Math.max(0,Math.min(1,l*b)),v=this.longTermStrategy.analyzeMemoryStage(r,p),S={[dc.WORKING_MEMORY]:"WORKING_MEMORY",[dc.SHORT_TERM]:"SHORT_TERM",[dc.CONSOLIDATING]:"CONSOLIDATING",[dc.LONG_TERM]:"LONG_TERM"};return{aiId:"memory",confidence:this.calculateConfidence(r),timestamp:Date.now(),forgettingRisk:c,timeBoost:w,category:a,retentionStrength:d,sm2Data:{quality:f,easeFactor:p.easeFactor,interval:p.nextInterval,repetitions:p.repetitions,nextReviewDate:p.nextReviewDate},retention:m.retention,memoryStage:S[v.stage],recommendedNextReview:p.nextReviewDate}}determineCategory(t){return bc(Jt(t))}calculateForgettingRisk(t){const s=t.lastStudied||0,r=t.reviewInterval||1;if(s===0)return 0;const i=(Date.now()-s)/(1e3*60*60*24),a=t.memorizationAttempts||0,c=t.memorizationCorrect||0,l=t.memorizationStillLearning||0,d=c+l*.5,h=a>0?d/a*100:0;let f=i/r*100;return h<50?f*=1.5:h<70&&(f*=1.2),Math.min(f,200)}calculateTimeBoost(t,s){const r=t.lastStudied||0;if(r===0)return 0;const o=Date.now()-r,i=o/(1e3*60);if(s==="memorization")return i>=30?.6:i>=15?.5:i>=5?.3:i>=2?.15:0;const a=o/(1e3*60*60*24);return a>=7?.5:a>=3?.3:a>=1?.15:0}calculateRetentionStrength(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0,i=t.memorizationStreak||0;if(s===0)return 0;const c=(r+o*.5)/s,l=Math.min(i*.1,.3);return Math.min(c+l,1)}calculateConfidence(t){const s=t.memorizationAttempts||0;return s>=10?1:s>=5?.8:s>=3?.6:s>=1?.4:.2}createNewWordSignal(t){return{aiId:"memory",confidence:.1,timestamp:Date.now(),forgettingRisk:0,timeBoost:0,category:"new",retentionStrength:0}}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}determineQuality(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0;if(s===0)return 3;const a=(r+o*.5)/s,c=Jt(t,"memorization");switch(bc(c)){case"incorrect":return c>=90?0:c>=80?1:2;case"still_learning":return a>=.9?4:a>=.7?3:2;case"new":return a>=.9?5:a>=.7?4:3;case"mastered":return a>=.9?5:(a>=.7,4);default:return 3}}logEnhancedAnalysis(t,s,r,o,i){console.log("[MemoryAI Phase 4 ÂàÜÊûê]",{word:t.word,sm2:{quality:i,easeFactor:s.easeFactor,interval:s.nextInterval,nextReview:s.nextReviewDate},retention:{retention:r.retention,memoryStrength:r.memoryStrength,reviewUrgency:r.reviewUrgency},memoryStage:{stage:o.stage,nextReview:o.nextInterval,description:o.description}})}validateSignal(t){return!(!t.aiId||t.aiId!=="memory"||t.confidence<0||t.confidence>1||t.forgettingRisk<0||t.forgettingRisk>200||t.timeBoost<0||t.timeBoost>1||t.retentionStrength<0||t.retentionStrength>1||!["new","incorrect","still_learning","mastered"].includes(t.category))}calculateOptimalInterval(t,s=2.5){if(t===0)return 0;if(t===1)return 1;if(t===2)return 6;const r=this.calculateOptimalInterval(t-1,s);return Math.round(r*s)}updateEasinessFactor(t,s){const r=t+(.1-(5-s)*(.08+(5-s)*.02));return Math.max(r,1.3)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"memory",confidence:r.confidence,timestamp:Date.now(),forgettingRisk:r.values[0]*100,timeBoost:r.values[1],category:this.predictCategory(r.values[2]),retentionStrength:r.values[3]}}mergeSignals(t,s,r){var c;const o=((c=r.progress)==null?void 0:c.memorizationAttempts)||0,i=Math.min(Math.max((o-10)/20,0),.7),a=1-i;return{aiId:"memory",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),forgettingRisk:t.forgettingRisk*a+s.forgettingRisk*i,timeBoost:t.timeBoost*a+s.timeBoost*i,category:o>30?s.category:t.category,retentionStrength:t.retentionStrength*a+s.retentionStrength*i,sm2Data:t.sm2Data,retention:t.retention,memoryStage:t.memoryStage,recommendedNextReview:t.recommendedNextReview}}extractFeatures(t){const{word:s,progress:r}=t;if(!r)return Array(15).fill(0);const o=r.memorizationAttempts||0,i=r.memorizationCorrect||0,a=r.consecutiveCorrect||0,c=r.consecutiveIncorrect||0;return[s.word.length/15,s.meaning.split(",").length/5,o/20,o>0?i/o:0,a/10,c/5,this.getDaysSinceLastStudy(r)/30,new Date().getHours()/24,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,t.sessionStats.questionsAnswered||t.sessionStats.totalAttempts/50,t.sessionStats.currentAccuracy||(t.sessionStats.totalAttempts>0?t.sessionStats.correctAnswers/t.sessionStats.totalAttempts:0),r.easeFactor||r.easinessFactor||2.5,this.forgettingCurve.analyzeRetention(r,this.getDaysSinceLastStudy(r)).retention]}predictCategory(t){return t<.25?"new":t<.5?"incorrect":t<.75?"still_learning":"mastered"}getFeatureDimension(){return 15}getOutputDimension(){return 4}}class WI extends Co{constructor(){super(...arguments);me(this,"id","cognitiveLoad");me(this,"name","Cognitive Load AI");me(this,"icon","üí§")}proposePosition(t,s){const i=50+s*15;return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{sessionStats:s}=t,r=this.determineLoadLevel(s),o=this.calculateFatigueScore(s),i=this.shouldRecommendBreak(r,o,s),a=this.calculateDifficultyAdjustment(r,s);return{aiId:"cognitiveLoad",confidence:this.calculateConfidence(s),timestamp:Date.now(),loadLevel:r,fatigueScore:o,recommendedBreak:i,difficultyAdjustment:a}}determineLoadLevel(t){const s=t.totalAttempts,r=s>0?t.correctAnswers/s:1,o=t.consecutiveIncorrect;return o>=5||r<.3&&s>=10?"overload":o>=3||r<.5&&s>=5?"high":r<.7?"medium":"low"}calculateFatigueScore(t){const s=t.sessionDuration/6e4,r=t.totalAttempts,o=t.avgResponseTime||0;let i=0;return s>45?i+=.5:s>30?i+=.3:s>15&&(i+=.1),r>50?i+=.3:r>30&&(i+=.2),o>5e3?i+=.2:o>4e3&&(i+=.1),Math.min(i,1)}shouldRecommendBreak(t,s,r){return t==="overload"||s>=.7||r.consecutiveIncorrect>=4||r.sessionDuration/(1e3*60)>=45}calculateDifficultyAdjustment(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return t==="overload"?-.2:t==="high"?-.15:t==="low"&&o>=.85&&r>=10?.15:t==="low"&&o>=.75?.1:0}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.3;return s>=20?o+=.3:s>=10?o+=.2:s>=5&&(o+=.1),r>=15?o+=.3:r>=5?o+=.2:r>=2&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="cognitiveLoad"||t.confidence<0||t.confidence>1||t.fatigueScore<0||t.fatigueScore>1||t.difficultyAdjustment<-.2||t.difficultyAdjustment>.2||!["low","medium","high","overload"].includes(t.loadLevel))}logAnalysis(t,s){}getRecommendedActions(t){const s=[];return t.loadLevel==="overload"?(s.push("5-10ÂàÜ„ÅÆ‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Á∞°Âçò„Å™ÂïèÈ°å„Åã„ÇâÂÜçÈñã„Åó„Åæ„Åó„Çá„ÅÜ"),s.push("Ê∞¥ÂàÜË£úÁµ¶„Çí„Åó„Åæ„Åó„Çá„ÅÜ")):t.loadLevel==="high"?(s.push("2-3ÂàÜ„ÅÆÂ∞è‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Â∞ë„ÅóÁ∞°Âçò„Å™ÂïèÈ°å„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô")):t.recommendedBreak&&s.push("„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅÂ∞ë„Åó‰ºëÊÜ©„Åó„Åæ„Åó„Çá„ÅÜ"),t.fatigueScore>=.7&&s.push("ÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ"),s}isInFlowState(t,s){if(t.loadLevel!=="medium"&&t.loadLevel!=="low"||t.fatigueScore>.5)return!1;const r=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0;if(r<.6||r>.85)return!1;const o=s.sessionDuration/(1e3*60);return!(o<5||o>45)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="low":o<.5?i="medium":o<.75?i="high":i="overload";const a=r.values[1],c=r.values[2],l=(r.values[3]-.5)*.4;return{aiId:"cognitiveLoad",confidence:r.confidence,timestamp:Date.now(),loadLevel:i,fatigueScore:a,recommendedBreak:c>.5,difficultyAdjustment:l}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.floor(o/20),a=Math.min(Math.max((i-3)/10,0),.7),c=1-a;return{aiId:"cognitiveLoad",confidence:t.confidence*c+s.confidence*a,timestamp:Date.now(),loadLevel:i>10?s.loadLevel:t.loadLevel,fatigueScore:t.fatigueScore*c+s.fatigueScore*a,recommendedBreak:t.recommendedBreak||s.recommendedBreak,difficultyAdjustment:t.difficultyAdjustment*c+s.difficultyAdjustment*a}}extractFeatures(t){const{sessionStats:s,progress:r}=t,o=s.sessionDuration/(1e3*60),i=r&&r.memorizationAttempts||0,a=r&&r.memorizationCorrect||0,c=r&&r.consecutiveIncorrect||0;return[o/60,s.totalAttempts/50,s.questionsAnswered||s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveIncorrect/5,s.consecutiveCorrect||0,(s.averageResponseTime||s.avgResponseTime||0)/1e4,s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0,new Date().getHours()/24,new Date().getDay()/7,s.sessionStartTime?(Date.now()-s.sessionStartTime)/(1e3*60*60):0,i/20,i>0?a/i:.5,c/5,s.responseTimeVariance||0,s.slowResponseCount||0,s.fastResponseCount||0,s.timeoutCount||0]}getFeatureDimension(){return 18}getOutputDimension(){return 4}}class BI extends Co{constructor(){super(...arguments);me(this,"id","errorPrediction");me(this,"name","Error Prediction AI");me(this,"icon","üîÆ")}proposePosition(t,s,r){const o=(1-s)*40,i=r>5&&s<.5?20:0,c=50+o+i;return Math.max(0,Math.min(100,c))}analyzeByRules(t){const{word:s,progress:r,allProgress:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"",a=this.identifyWeaknessAreas(r,o),c=this.findConfusionPairs(i,o),l=this.recommendPreemptiveReview(i,o),d=this.calculatePatternConfidence(r);return{aiId:"errorPrediction",confidence:this.calculateConfidence(r),timestamp:Date.now(),weaknessAreas:a,confusionPairs:c,preemptiveReview:l,patternConfidence:d}}identifyWeaknessAreas(t,s){const r=[],o={};return Object.values(s).forEach(i=>{const a=i.errorHistory;a==null||a.forEach(c=>{c.grammarPoint&&(o[c.grammarPoint]=(o[c.grammarPoint]||0)+1)})}),Object.entries(o).forEach(([i,a])=>{a>=3&&r.push(i)}),r}findConfusionPairs(t,s){const r=[],o=s[t],i=o==null?void 0:o.errorHistory;if(!i)return[];const a={};return i.forEach(c=>{c.userAnswer&&(a[c.userAnswer]=(a[c.userAnswer]||0)+1)}),Object.entries(a).forEach(([c,l])=>{l>=2&&r.push([t,c])}),r}recommendPreemptiveReview(t,s){const r=[];return Object.keys(s).forEach(o=>{if(o!==t&&o.substring(0,3)===t.substring(0,3)){const i=s[o],a=i.memorizationAttempts||0,c=i.memorizationCorrect||0;(a>0?c/a:0)<.6&&a>=2&&r.push(o)}}),r.slice(0,5)}calculatePatternConfidence(t){const s=t==null?void 0:t.errorHistory;if(!s)return 0;const r=s.length;return r>=5?.9:r>=3?.7:r>=2?.5:r>=1?.3:.1}calculateConfidence(t){const s=t==null?void 0:t.errorHistory,r=(s==null?void 0:s.length)||0,o=(t==null?void 0:t.memorizationAttempts)||0,i=Math.min(o/10,.5),a=Math.min(r/5,.5);return i+a}validateSignal(t){return!(!t.aiId||t.aiId!=="errorPrediction"||t.confidence<0||t.confidence>1||t.patternConfidence<0||t.patternConfidence>1||!Array.isArray(t.weaknessAreas)||!Array.isArray(t.confusionPairs)||!Array.isArray(t.preemptiveReview))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0],i=r.values[1],a=r.values[2];return{aiId:"errorPrediction",confidence:r.confidence,timestamp:Date.now(),weaknessAreas:i>.7?["predicted_weakness"]:[],confusionPairs:a>.7?[["predicted","confusion"]]:[],preemptiveReview:o>.6?["predicted_review"]:[],patternConfidence:r.confidence,errorProbability:o,weaknessLevel:i,confusionScore:a}}mergeSignals(t,s,r){var h,f;const o=r.progress,i=((h=o==null?void 0:o.errorHistory)==null?void 0:h.length)||0,a=((f=r.progress)==null?void 0:f.memorizationAttempts)||0,c=i+a;let l=Math.min(Math.max((c-10)/15,0),.8);c>50&&(l=.9);const d=1-l;return{aiId:"errorPrediction",confidence:t.confidence*d+s.confidence*l,timestamp:Date.now(),weaknessAreas:t.weaknessAreas,confusionPairs:t.confusionPairs,preemptiveReview:t.preemptiveReview,patternConfidence:t.patternConfidence*d+s.patternConfidence*l,errorProbability:s.errorProbability,weaknessLevel:s.weaknessLevel,confusionScore:s.confusionScore}}extractFeatures(t){var f;const{word:s,progress:r,allProgress:o,sessionStats:i}=t;if(!r)return Array(20).fill(0);Object.keys(o).length;const a=r,c=((f=a.errorHistory)==null?void 0:f.length)||0,l=r.memorizationAttempts||0,d=r.memorizationCorrect||0,h=l>0?d/l:0;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?1:0,s.katakana?1:0,c/10,(r.consecutiveIncorrect||0)/5,l>0?1-h:.5,0,a.lastErrorType==="spelling"?1:0,a.lastErrorType==="meaning"?1:0,l/20,(r.consecutiveCorrect||0)/10,this.getDaysSinceLastStudy(r)/30,(r.memorizationStreak||0)/10,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,i.questionsAnswered||i.totalAttempts/50,i.currentAccuracy||(i.totalAttempts>0?i.correctAnswers/i.totalAttempts:0),(i.averageResponseTime||i.avgResponseTime||0)/1e4]}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}getFeatureDimension(){return 20}getOutputDimension(){return 3}}class VI extends Co{constructor(){super(...arguments);me(this,"id","learningStyle");me(this,"name","Learning Style AI");me(this,"icon","üéØ")}proposePosition(t,s,r){const a=50+(r>10&&s<.6?25:0);return Math.max(0,Math.min(100,a))}analyzeByRules(t){const{progress:s,allProgress:r,sessionStats:o}=t,i=this.determineStyleProfile(s,r),a=this.calculateOptimalSessionLength(r,o),c=this.inferDifficultyPreference(r,o),l=this.inferMotivationType(r);return{aiId:"learningStyle",confidence:this.calculateConfidence(r),timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:c,motivationType:l}}determineStyleProfile(t,s){var i;const r={};Object.values(s).forEach(a=>{var c;(c=a.preferredQuestionTypes)==null||c.forEach(l=>{r[l]=(r[l]||0)+1})});const o=(i=Object.entries(r).sort((a,c)=>c[1]-a[1])[0])==null?void 0:i[0];return o!=null&&o.includes("audio")||o!=null&&o.includes("pronunciation")?"auditory":o!=null&&o.includes("image")||o!=null&&o.includes("visual")?"visual":o!=null&&o.includes("writing")||o!=null&&o.includes("typing")?"kinesthetic":"reading"}calculateOptimalSessionLength(t,s){const r=[];if(Object.values(t).forEach(a=>{const c=a.studyTimePatterns;c&&r.push(...c)}),r.length===0)return 20;r.sort((a,c)=>a-c);const o=[];for(let a=1;a<r.length;a++){const l=(r[a]-r[a-1])/(1e3*60);l>=5&&l<=60&&o.push(l)}if(o.length===0)return 20;o.sort((a,c)=>a-c);const i=o[Math.floor(o.length/2)];return Math.round(i)}inferDifficultyPreference(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return o>=.8&&r>=20?"challenge":o<.6?"gradual":"mixed"}inferMotivationType(t){const s=Object.keys(t).length,r=Object.values(t).filter(i=>(i.memorizationStreak||0)>=3).length,o=s>0?r/s:0;return o>=.7?"mastery":o>=.4?"performance":"social"}calculateConfidence(t){const s=Object.keys(t).length,r=Object.values(t).reduce((i,a)=>i+(a.memorizationAttempts||0),0);let o=.3;return s>=50?o+=.3:s>=20?o+=.2:s>=10&&(o+=.1),r>=100?o+=.4:r>=50?o+=.2:r>=20&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="learningStyle"||t.confidence<0||t.confidence>1||t.optimalSessionLength<5||t.optimalSessionLength>120||!["visual","auditory","kinesthetic","reading"].includes(t.styleProfile)||!["gradual","challenge","mixed"].includes(t.preferredDifficulty)||!["mastery","performance","social"].includes(t.motivationType))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="visual":o<.5?i="auditory":o<.75?i="kinesthetic":i="reading";const a=Math.round(r.values[1]*60+10),c=r.values[2];let l;c<.33?l="gradual":c<.67?l="mixed":l="challenge";const d=r.values[3];let h;return d<.33?h="mastery":d<.67?h="performance":h="social",{aiId:"learningStyle",confidence:r.confidence,timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:l,motivationType:h}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"learningStyle",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),styleProfile:o>50?s.styleProfile:t.styleProfile,optimalSessionLength:Math.round(t.optimalSessionLength*a+s.optimalSessionLength*i),preferredDifficulty:o>50?s.preferredDifficulty:t.preferredDifficulty,motivationType:o>50?s.motivationType:t.motivationType}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=Object.values(r).reduce((a,c)=>a+(c.memorizationAttempts||0),0);return[s.sessionDuration/(1e3*60*60),s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,o/100,i/200,s.questionsAnswered||s.totalAttempts/50,(s.averageResponseTime||s.avgResponseTime||0)/1e4,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 4}}class UI extends Co{constructor(){super(...arguments);me(this,"id","linguistic");me(this,"name","Linguistic AI");me(this,"icon","üìö")}proposePosition(t,s){const r=t.word||"",o=Math.min(r.length*2,20),i=this.calculateIrregularity(r),a=(1-s)*30,l=40+o+i+a;return Math.max(0,Math.min(100,l))}calculateIrregularity(t){const s=/([bcdfghjklmnpqrstvwxyz])\1/.test(t),r=/([qx]|[^aeiou]{4})/.test(t);return(s?5:0)+(r?10:0)}analyzeByRules(t){const{word:s,allProgress:r}=t,o=typeof s=="string"?s:(s==null?void 0:s.word)||"",i=this.calculateInherentDifficulty(o),a=this.findPhoneticallySimilarWords(o,r),c=this.findSemanticCluster(o,r),l=this.assessGrammarComplexity(o);return{aiId:"linguistic",confidence:.8,timestamp:Date.now(),inherentDifficulty:i,phoneticSimilarity:a,semanticCluster:c,grammarComplexity:l}}calculateInherentDifficulty(t){let s=0;t.length>12?s+=.3:t.length>8?s+=.2:t.length>5&&(s+=.1);const r=t.match(/[aeiou]/gi),o=r?r.length:1;return o>4?s+=.2:o>3&&(s+=.1),/[bcdfghjklmnpqrstvwxyz]{3,}/i.test(t)&&(s+=.2),/gh|ph|th|ough|augh/i.test(t)&&(s+=.1),Math.min(s,1)}findPhoneticallySimilarWords(t,s){const r=[];return Object.keys(s).forEach(o=>{o!==t&&(o.substring(0,3)===t.substring(0,3)||o.substring(o.length-3)===t.substring(t.length-3))&&r.push(o)}),r.slice(0,5)}findSemanticCluster(t,s){const r=[],o=this.extractWordRoot(t);return Object.keys(s).forEach(i=>{if(i===t)return;const a=this.extractWordRoot(i);o&&a&&o===a&&r.push(i)}),r.slice(0,5)}extractWordRoot(t){const s=["ing","ed","er","est","ly","s","es","tion","ment"];for(const r of s)if(t.endsWith(r))return t.substring(0,t.length-r.length);return t}assessGrammarComplexity(t){let s=0;return["be","have","do","go","take","get","make","know","think","see","come","want","use","find","give"].some(o=>t.includes(o))&&(s+=.3),(t.includes("-")||t.includes(" "))&&(s+=.2),(t.endsWith("tion")||t.endsWith("ment")||t.endsWith("ness"))&&(s+=.2),Math.min(s,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="linguistic"||t.confidence<0||t.confidence>1||t.inherentDifficulty<0||t.inherentDifficulty>1||t.grammarComplexity<0||t.grammarComplexity>1||!Array.isArray(t.phoneticSimilarity)||!Array.isArray(t.semanticCluster))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"linguistic",confidence:r.confidence,timestamp:Date.now(),inherentDifficulty:r.values[0],phoneticSimilarity:[],semanticCluster:[],grammarComplexity:r.values[1]}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-30)/50,0),.5),a=1-i;return{aiId:"linguistic",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),inherentDifficulty:t.inherentDifficulty*a+s.inherentDifficulty*i,phoneticSimilarity:t.phoneticSimilarity,semanticCluster:t.semanticCluster,grammarComplexity:t.grammarComplexity*a+s.grammarComplexity*i}}extractFeatures(t){var r;const{word:s}=t;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?s.ipa.length/20:0,s.katakana?s.katakana.length/20:0,/[^aeiou]{3}/.test(s.word)?1:0,/([bcdfghjklmnpqrstvwxyz])\1/.test(s.word)?1:0,s.word.split("-").length/3,s.word.includes(" ")?1:0,((r=s.word.match(/[A-Z]/g))==null?void 0:r.length)||0,/(tion|ment|ness|ing|ed)$/.test(s.word)?1:0]}getFeatureDimension(){return 10}getOutputDimension(){return 2}}class GI extends Co{constructor(){super(...arguments);me(this,"id","contextual");me(this,"name","Contextual AI");me(this,"icon","üåç")}proposePosition(t,s){const i=50+Math.min(s*3,30);return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{word:s,currentTab:r,allProgress:o,sessionStats:i}=t,a=typeof s=="string"?s:(s==null?void 0:s.word)||"",c=this.calculateContextRelevance(a,r),l=this.evaluateTopicContinuity(a,o,i),d=this.assessEnvironmentFit(r,i),h=this.identifyCrossTabSynergy(a,r,o);return{aiId:"contextual",confidence:this.calculateConfidence(i),timestamp:Date.now(),contextRelevance:c,topicContinuity:l,environmentFit:d,crossTabSynergy:h}}calculateContextRelevance(t,s){let r=.5;return s==="memorization"&&(r+=.2),s==="grammar"&&(r+=.3),s==="comprehensive"&&(r+=.1),Math.min(r,1)}evaluateTopicContinuity(t,s,r){return r.totalAttempts>=5}assessEnvironmentFit(t,s){let r=.5;const o=s.sessionDuration/(1e3*60),i=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5,a=new Date().getHours();return a>=6&&a<12&&t==="memorization"&&(r+=.2),a>=12&&a<18&&t==="grammar"&&(r+=.2),a>=18&&t==="memorization"&&i>=.7&&(r+=.2),o<15&&t==="memorization"&&(r+=.1),Math.min(r,1)}identifyCrossTabSynergy(t,s,r){const o=[];if(s==="memorization"){const i=r[t];i!=null&&i.grammarAttempts&&i.grammarAttempts>0&&o.push("grammar-memorization-link")}if(s==="grammar"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&o.push("memorization-grammar-link")}if(s==="comprehensive"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&(i!=null&&i.grammarAttempts)&&i.grammarAttempts>0&&o.push("comprehensive-integration")}return o}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.4;return s>=10?o+=.3:s>=5&&(o+=.2),r>=10?o+=.3:r>=5&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="contextual"||t.confidence<0||t.confidence>1||t.contextRelevance<0||t.contextRelevance>1||t.environmentFit<0||t.environmentFit>1||typeof t.topicContinuity!="boolean"||!Array.isArray(t.crossTabSynergy))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"contextual",confidence:r.confidence,timestamp:Date.now(),contextRelevance:r.values[0],topicContinuity:r.values[1]>.5,environmentFit:r.values[2],crossTabSynergy:[]}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"contextual",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),contextRelevance:t.contextRelevance*a+s.contextRelevance*i,topicContinuity:t.topicContinuity||s.topicContinuity,environmentFit:t.environmentFit*a+s.environmentFit*i,crossTabSynergy:t.crossTabSynergy}}extractFeatures(t){const{currentTab:s,sessionStats:r,progress:o}=t;return[s==="memorization"?1:0,s==="grammar"?1:0,s==="comprehensive"?1:0,r.sessionDuration/(1e3*60*60),r.totalAttempts/50,r.currentAccuracy||(r.totalAttempts>0?r.correctAnswers/r.totalAttempts:0),o?(o.memorizationAttempts||0)/20:0,o?(o.grammarAttempts||0)/20:0,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class Po extends Co{constructor(){super(...arguments);me(this,"id","gamification");me(this,"name","Gamification AI");me(this,"icon","üéÆ")}static get isVerboseDebug(){return!1}proposePosition(t,s,r){const o=s>=3?-15:0,i=r>=.8?-10:0,c=50+o+i;return Math.max(0,Math.min(100,c))}adjustPositionForInterleaving(t){var c;const s=t.filter(l=>l.position>=40),r=t.filter(l=>l.position<40);if(t.filter(l=>l.position>=25&&l.position<40),s.length===0)return{result:t,changed:[]};if(r.length===0)return{result:t,changed:[]};let o=0,i=0;s.length>=50?(o=.17,i=10):s.length>=20?(o=.25,i=8):s.length>=5?(o=.33,i=8):s.length>=1&&(o=.5,i=15);const a=[];if(o>0&&r.length>0){const l=Math.floor(r.length*o),d=[...r].filter(p=>p.position>=20).sort((p,m)=>m.position-p.position),h=Math.min(l,d.length);for(let p=0;p<h;p++){const m=d[p].position;d[p].position=Math.min(d[p].position+i,59);const g=((c=d[p].question)==null?void 0:c.word)||"(unknown)";a.push({word:g,before:m,after:d[p].position})}t.filter(p=>{const m=(p.attempts??0)===0,g=p.position>=40;return m&&g&&p.position>=60}).length>0&&Po.isVerboseDebug}return{result:t,changed:a}}boostStillLearningQuestions(t){var d;const s=t.filter(h=>h.position>=40&&h.position<70&&(h.attempts??0)>0),o=t.filter(h=>h.position>=70&&(h.attempts??0)>0).length===0&&s.length>0;if(s.length===0)return{result:t,changed:[]};const i=[];for(const h of s){const f=h.position;let p;if(o){const g=f<50?25:f<60?15:8;p=Math.min(f+g,69),p=Math.max(p,68)}else{const g=f<50?20:f<60?10:5;p=Math.min(f+g,69),p=Math.max(p,60)}h.position=p;const m=((d=h.question)==null?void 0:d.word)||"(unknown)";i.push({word:m,before:f,after:h.position})}const a=o?68:60,c=69;return s.filter(h=>h.position<a||h.position>c).length>0&&Po.isVerboseDebug,{result:t,changed:i}}interleaveByCategory(t){const s=t.filter(d=>d.position>=40&&(d.attempts??0)>0),r=t.filter(d=>d.position>=40&&d.position<70&&(d.attempts??0)===0),o=t.filter(d=>(d.attempts??0)===0&&d.position<40),i=[...r,...o];if(s.length===0&&i.length===0)return t;if(i.length===0)return s;if(s.length===0)return i;const a=[];let c=0,l=0;for(;c<s.length||l<i.length;){for(let d=0;d<4&&c<s.length;d++)a.push(s[c++]);if(l<i.length&&a.push(i[l++]),c>=s.length&&l>=i.length)break;if(c>=s.length&&l<i.length)for(;l<i.length;)a.push(i[l++]);if(l>=i.length&&c<s.length)for(;c<s.length;)a.push(s[c++])}return a}analyzeByRules(t){const{allProgress:s,sessionStats:r}=t,o=this.calculateMotivationLevel(s,r),i=this.shouldTriggerReward(s,r),a=this.determineChallengeLevel(r),c=this.generateSocialFeedback(s,r);return{aiId:"gamification",confidence:this.calculateConfidence(s),timestamp:Date.now(),motivationLevel:o,rewardTiming:i,challengeLevel:a,socialFeedback:c}}calculateMotivationLevel(t,s){let r=.5;const o=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5;o>=.8?r+=.3:o>=.6?r+=.2:o>=.4?r+=.1:r-=.2,s.consecutiveIncorrect===0&&s.totalAttempts>=5&&(r+=.2);const i=s.masteredCount||0,a=Object.keys(t).length,c=a>0?i/a:0;c>=.7?r+=.2:c>=.5&&(r+=.1);const l=s.sessionDuration/(1e3*60);return l>45?r-=.2:l>30&&(r-=.1),Math.max(0,Math.min(r,1))}shouldTriggerReward(t,s){const r=s.masteredCount||0;if(r>0&&r%10===0||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0)>=.9&&s.totalAttempts>=10)return!0;const i=new Set;return Object.values(t).forEach(a=>{if(a.lastStudied){const c=new Date(a.lastStudied).toDateString();i.add(c)}}),i.size>=7}determineChallengeLevel(t){const s=t.totalAttempts>0?t.correctAnswers/t.totalAttempts:.5;return s>=.85?"hard":s>=.6?"medium":"easy"}generateSocialFeedback(t,s){const r=s.masteredCount||0,o=s.totalAttempts,i=o>0?s.correctAnswers/o:0;if(r>=100)return"üéâ 100Ë™û‰ª•‰∏ä„Éû„Çπ„Çø„ÉºÔºÅËã±Ë™ûÂ≠¶Áøí„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö„ÅØÂäõ„Å™„Çä";if(r>=50)return"üåü 50Ë™û„Éû„Çπ„Çø„ÉºÈÅîÊàêÔºÅÁùÄÂÆü„Å´ÊàêÈï∑‰∏≠ÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁõÆÊ®ôÈÅîÊàê";if(r>=10)return"üìö 10Ë™û„Éû„Çπ„Çø„ÉºÔºÅ„Ç≥„ÉÑ„Ç≥„ÉÑÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÂàùÂøÉËÄÖ";if(i>=.9&&o>=10)return"üíØ Ê≠£Á≠îÁéá90%‰ª•‰∏äÔºÅË™øÂ≠ê„Åå„ÅÑ„ÅÑ„Åß„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Â•ΩË™ø";const a=this.calculateStudyDays(t);return a>=30?"üî• 30Êó•ÈÄ£Á∂öÂ≠¶ÁøíÈÅîÊàêÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁøíÊÖ£Âåñ":a>=7?"‚ú® 1ÈÄ±ÈñìÈÄ£Á∂öÂ≠¶ÁøíÔºÅÁøíÊÖ£Âåñ„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö‰∏≠":""}calculateStudyDays(t){const s=new Set;return Object.values(t).forEach(r=>{if(r.lastStudied){const o=new Date(r.lastStudied).toDateString();s.add(o)}}),s.size}calculateConfidence(t){const s=Object.keys(t).length,r=this.calculateStudyDays(t);let o=.3;return s>=50?o+=.3:s>=20&&(o+=.2),r>=7?o+=.4:r>=3&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="gamification"||t.confidence<0||t.confidence>1||t.motivationLevel<0||t.motivationLevel>1||typeof t.rewardTiming!="boolean"||typeof t.socialFeedback!="string"||!["easy","medium","hard"].includes(t.challengeLevel))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[1];let i;return o<.33?i="easy":o<.67?i="medium":i="hard",{aiId:"gamification",confidence:r.confidence,timestamp:Date.now(),motivationLevel:r.values[0],rewardTiming:r.values[2]>.5,challengeLevel:i,socialFeedback:""}}mergeSignals(t,s,r){Object.keys(r.allProgress).length;const o=this.calculateStudyDays(r.allProgress),i=Math.min(Math.max((o-3)/10,0),.6),a=1-i;return{aiId:"gamification",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),motivationLevel:t.motivationLevel*a+s.motivationLevel*i,rewardTiming:t.rewardTiming||s.rewardTiming,challengeLevel:o>7?s.challengeLevel:t.challengeLevel,socialFeedback:t.socialFeedback}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=this.calculateStudyDays(r),a=s.masteredCount||0;return[s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,s.consecutiveIncorrect/5,s.sessionDuration/(1e3*60*60),s.totalAttempts/50,o/100,i/30,a/o||0,s.questionsAnswered||s.totalAttempts/50,new Date().getHours()/24]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class aQ{constructor(e={}){me(this,"memoryAI");me(this,"cognitiveLoadAI");me(this,"errorPredictionAI");me(this,"learningStyleAI");me(this,"linguisticAI");me(this,"contextualAI");me(this,"gamificationAI");me(this,"config");this.memoryAI=new zI,this.cognitiveLoadAI=new WI,this.errorPredictionAI=new BI,this.learningStyleAI=new VI,this.linguisticAI=new UI,this.contextualAI=new GI,this.gamificationAI=new Po,this.config={...xf,...e,weights:{...xf.weights,...e.weights||{}},emergencyThresholds:{...xf.emergencyThresholds,...e.emergencyThresholds||{}}},this.initializeMLModels().catch(t=>{console.warn("[AICoordinator] ML initialization failed, using rules only",t)}),this.checkAndEnableML()}checkAndEnableML(){try{this.enableML()}catch(e){console.warn("[AICoordinator] Failed to check ML setting",e)}}enableML(){var e,t,s,r,o,i,a,c,l,d,h,f,p,m;try{(t=(e=this.memoryAI).enableML)==null||t.call(e),(r=(s=this.cognitiveLoadAI).enableML)==null||r.call(s),(i=(o=this.errorPredictionAI).enableML)==null||i.call(o),(c=(a=this.learningStyleAI).enableML)==null||c.call(a),(d=(l=this.linguisticAI).enableML)==null||d.call(l),(f=(h=this.contextualAI).enableML)==null||f.call(h),(m=(p=this.gamificationAI).enableML)==null||m.call(p),console.log("‚úÖ [AICoordinator] ML enabled for all specialists")}catch(g){console.warn("[AICoordinator] Failed to enable ML",g)}}async initializeMLModels(){var e,t,s,r,o,i,a,c,l,d,h,f,p,m;try{await Promise.all([(t=(e=this.memoryAI).initializeML)==null?void 0:t.call(e),(r=(s=this.cognitiveLoadAI).initializeML)==null?void 0:r.call(s),(i=(o=this.errorPredictionAI).initializeML)==null?void 0:i.call(o),(c=(a=this.learningStyleAI).initializeML)==null?void 0:c.call(a),(d=(l=this.linguisticAI).initializeML)==null?void 0:d.call(l),(f=(h=this.contextualAI).initializeML)==null?void 0:f.call(h),(m=(p=this.gamificationAI).initializeML)==null?void 0:m.call(p)]),console.log("‚úÖ [AICoordinator] ML models initialized")}catch(g){console.warn("‚ö†Ô∏è [AICoordinator] ML initialization partial failure",g)}}async learn(e,t){var s,r,o,i,a,c,l,d,h,f,p,m,g,x;try{await Promise.all([(r=(s=this.memoryAI).learn)==null?void 0:r.call(s,e,t),(i=(o=this.cognitiveLoadAI).learn)==null?void 0:i.call(o,e,t),(c=(a=this.errorPredictionAI).learn)==null?void 0:c.call(a,e,t),(d=(l=this.learningStyleAI).learn)==null?void 0:d.call(l,e,t),(f=(h=this.linguisticAI).learn)==null?void 0:f.call(h,e,t),(m=(p=this.contextualAI).learn)==null?void 0:m.call(p,e,t),(x=(g=this.gamificationAI).learn)==null?void 0:x.call(g,e,t)]),this.config.debugMode&&console.log("‚úÖ [AICoordinator] learn() completed",{word:e.word,outcome:t})}catch(y){console.warn("‚ö†Ô∏è [AICoordinator] learn() partial failure",y)}}async analyzeAndCoordinate(e,t){const[s,r,o,i,a,c,l]=await Promise.all([Promise.resolve(this.memoryAI.analyze(e)),Promise.resolve(this.cognitiveLoadAI.analyze(e)),Promise.resolve(this.errorPredictionAI.analyze(e)),Promise.resolve(this.learningStyleAI.analyze(e)),Promise.resolve(this.linguisticAI.analyze(e)),Promise.resolve(this.contextualAI.analyze(e)),Promise.resolve(this.gamificationAI.analyze(e))]);this.memoryAI.validateSignal(s)||console.warn("‚ùå Invalid MemorySignal"),this.cognitiveLoadAI.validateSignal(r)||console.warn("‚ùå Invalid CognitiveLoadSignal");const d=this.checkEmergencyConditions(s,r,e.sessionStats),h=this.calculateFinalPriority(t,s,r,o,i,a,c,l),f=this.generateRecommendedAction(s,r,l),p=this.config.debugMode?this.generateDebugInfo(t,h,s,r,o):void 0;return{finalPriority:d?.1:h,signals:{memory:s,cognitiveLoad:r,errorPrediction:o,learningStyle:i,linguistic:a,contextual:c,gamification:l},urgentFlag:d,recommendedAction:f,debug:p}}checkEmergencyConditions(e,t,s){return!!(e.forgettingRisk>=this.config.emergencyThresholds.forgettingRisk||this.config.emergencyThresholds.cognitiveOverload&&t.loadLevel==="overload"||s.consecutiveIncorrect>=this.config.emergencyThresholds.consecutiveErrors)}calculateFinalPriority(e,t,s,r,o,i,a,c){let l=e;return l*=1-t.timeBoost*this.config.weights.memory,l*=1+s.difficultyAdjustment*this.config.weights.cognitiveLoad,r.weaknessAreas.length>0&&(l*=1-r.patternConfidence*.3*this.config.weights.errorPrediction),l*=1+i.inherentDifficulty*.2*this.config.weights.linguistic,l*=1-(a.contextRelevance-.5)*.3*this.config.weights.contextual,c.motivationLevel<.3&&(l*=1-.2*this.config.weights.gamification),Math.max(.1,Math.min(l,10))}generateRecommendedAction(e,t,s){if(t.recommendedBreak)return"‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ5-10ÂàÜ„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";if(s.rewardTiming)return`üéâ ${s.socialFeedback}`;if(e.forgettingRisk>=100)return"Âæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇË®òÊÜ∂„ÅåËñÑ„Çå„ÇãÂâç„Å´Á¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}generateDebugInfo(e,t,s,r,o){const i={timeBoost:-s.timeBoost*this.config.weights.memory,difficultyAdjustment:r.difficultyAdjustment*this.config.weights.cognitiveLoad,weaknessPenalty:o.weaknessAreas.length>0?-o.patternConfidence*.3*this.config.weights.errorPrediction:0},a=`
      Base Priority: ${e.toFixed(2)}
      Time Boost: ${(i.timeBoost*100).toFixed(1)}%
      Difficulty Adjustment: ${(i.difficultyAdjustment*100).toFixed(1)}%
      Weakness Penalty: ${(i.weaknessPenalty*100).toFixed(1)}%
      Final Priority: ${t.toFixed(2)}
    `.trim();return{basePriority:e,adjustments:i,reasoning:a}}logCoordinationResult(e){}updateConfig(e){this.config={...this.config,...e,weights:{...this.config.weights,...e.weights||{}},emergencyThresholds:{...this.config.emergencyThresholds,...e.emergencyThresholds||{}}}}getConfig(){return{...this.config}}}const cQ=[{prefix:"un-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["unhappy","unable","unfair"]},{prefix:"re-",meaning:"ÂÜç„Å≥„ÉªÂÖÉ„Å´",examples:["return","rebuild","review"]},{prefix:"dis-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["disagree","dislike","disappear"]},{prefix:"in-/im-",meaning:"Âê¶ÂÆö",examples:["impossible","inactive","impolite"]},{prefix:"pre-",meaning:"Ââç„Å´",examples:["preview","predict","prepare"]},{prefix:"post-",meaning:"Âæå„Å´",examples:["postwar","postpone","postgraduate"]},{prefix:"mis-",meaning:"Ë™§„Å£„Å¶",examples:["mistake","misunderstand","mislead"]},{prefix:"over-",meaning:"ÈÅéÂ∫¶„Å´",examples:["overwork","overlook","overcome"]},{prefix:"under-",meaning:"‰∏çË∂≥„Éª‰∏ã„Å´",examples:["understand","underground","underline"]},{prefix:"sub-",meaning:"‰∏ã„Å´„ÉªÂâØ„ÅÆ",examples:["subway","submarine","subtitle"]}],HI=[{suffix:"-tion/-sion",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁä∂ÊÖã",examples:["action","decision","confusion"]},{suffix:"-ment",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁµêÊûú",examples:["development","movement","agreement"]},{suffix:"-ness",pos:"noun",meaning:"ÊÄßË≥™„ÉªÁä∂ÊÖã",examples:["happiness","kindness","darkness"]},{suffix:"-ly",pos:"adverb",meaning:"ÊßòÊÖã",examples:["quickly","slowly","carefully"]},{suffix:"-ful",pos:"adjective",meaning:"ÔΩû„Å´Ê∫Ä„Å°„Åü",examples:["beautiful","careful","wonderful"]},{suffix:"-less",pos:"adjective",meaning:"ÔΩû„ÅÆ„Å™„ÅÑ",examples:["hopeless","careless","endless"]},{suffix:"-able/-ible",pos:"adjective",meaning:"ÔΩû„Åß„Åç„Çã",examples:["readable","possible","comfortable"]},{suffix:"-er/-or",pos:"noun",meaning:"‰∫∫„Éª„ÇÇ„ÅÆ",examples:["teacher","actor","writer"]},{suffix:"-ist",pos:"noun",meaning:"ÔΩû„Åô„Çã‰∫∫",examples:["artist","scientist","pianist"]},{suffix:"-ize",pos:"verb",meaning:"ÔΩûÂåñ„Åô„Çã",examples:["realize","organize","modernize"]},{suffix:"-ing",pos:"noun/adjective",meaning:"ÂãïÂêçË©û„ÉªÁèæÂú®ÂàÜË©û",examples:["running","interesting","learning"]},{suffix:"-ed",pos:"adjective",meaning:"ÈÅéÂéªÂàÜË©û„ÉªÂΩ¢ÂÆπË©û",examples:["tired","excited","surprised"]}],lQ=[{root:"act",meaning:"Ë°åÂãï",words:["action","react","actor","activity","actual"]},{root:"struct",meaning:"Âª∫„Å¶„Çã",words:["structure","construct","destruction","instruct"]},{root:"dict",meaning:"Ë®Ä„ÅÜ",words:["dictionary","predict","contradict","dictate"]},{root:"port",meaning:"ÈÅã„Å∂",words:["transport","import","export","portable","report"]},{root:"duct",meaning:"Â∞é„Åè",words:["conduct","produce","reduce","introduce"]},{root:"scrib/script",meaning:"Êõ∏„Åè",words:["describe","script","prescription","manuscript"]},{root:"spect",meaning:"Ë¶ã„Çã",words:["inspect","respect","expect","spectator"]},{root:"form",meaning:"ÂΩ¢",words:["reform","inform","transform","uniform"]},{root:"ject",meaning:"Êäï„Åí„Çã",words:["project","reject","subject","object"]},{root:"miss/mit",meaning:"ÈÄÅ„Çã",words:["mission","permit","submit","transmit"]}];function uQ(n){const e=n.toLowerCase();return["in the","at the","on the","to the","for the","with the","by the"].some(r=>e.startsWith(r))?"preposition_phrase":["take a","make a","have a","get a","give a","do a"].some(r=>e.startsWith(r))?"verb_phrase":n.includes(" ")?"idiom":"none"}function qI(n){const e=n.toLowerCase();for(const{prefix:t}of cQ){const s=t.replace(/-/g,""),r=[s];(s==="in"||s==="im")&&r.push("in","im","il","ir");for(const o of r)if(e.startsWith(o)&&n.length>o.length+2)return o}}function KI(n){const e=n.toLowerCase();for(const{suffix:t}of HI){const s=t.split("/")[0].replace(/-/g,"");if(e.endsWith(s)&&n.length>s.length+2)return s}}function dQ(n){const e=n.toLowerCase();for(const{root:o,words:i}of lQ)if(i.some(a=>a===e)||e.includes(o))return o;let t=e;const s=qI(n);s&&(t=t.substring(s.length));const r=KI(n);if(r&&(t=t.substring(0,t.length-r.length)),!(t.length<3))return t!==e?t:void 0}function hQ(n,e){const t=n.toLowerCase();if(n.includes(" "))return"phrase";for(const{suffix:s,pos:r}of HI){const o=s.split("/")[0].replace(/-/g,"");if(t.endsWith(o))return r.split("/")[0]}if(e){if(e.includes("„Åô„Çã")||e.includes("„Åï„Çå„Çã"))return"verb";if(e.includes("ÁöÑ„Å™")||e.includes("„ÅÑÔºàÂΩ¢ÂÆπË©ûË™ûÂ∞æÔºâ"))return"adjective";if(e.includes("„Å´")||e.includes("„ÅßÔºàÂâØË©ûÔºâ"))return"adverb"}return"other"}function fQ(n,e){const t=qI(n),s=KI(n),r=dQ(n),o=t||s||r?{prefix:t,suffix:s,root:r}:void 0,i=hQ(n,e),a=uQ(n);return{word:n,family:o,pos:i,phrasePattern:a!=="none"?a:void 0}}class pQ{constructor(){me(this,"cache",new Map);me(this,"ttl",24*60*60*1e3)}getMetadata(e,t){const s=this.getCacheKey(e,t),r=this.cache.get(s);if(r&&Date.now()-r.timestamp<this.ttl)return r.metadata;const o=fQ(e,t);return this.cache.set(s,{word:e,metadata:o,timestamp:Date.now()}),o}getMetadataFromQuestion(e){return this.getMetadata(e.word,e.meaning)}getBulkMetadata(e){const t=new Map;return e.forEach(s=>{t.set(s,this.getMetadata(s))}),t}getBulkMetadataFromQuestions(e){const t=new Map;return e.forEach(s=>{t.set(s.word,this.getMetadataFromQuestion(s))}),t}clear(){this.cache.clear()}purgeExpired(){const e=Date.now();let t=0;for(const[s,r]of this.cache.entries())e-r.timestamp>=this.ttl&&(this.cache.delete(s),t++);return t}getStats(){const e=Date.now();let t=0,s=1/0;for(const r of this.cache.values()){const o=e-r.timestamp;o>t&&(t=o),o<s&&(s=o)}return{size:this.cache.size,ttl:this.ttl,oldestEntryAge:t,newestEntryAge:s===1/0?0:s}}getCacheKey(e,t){return t?`${e}::${t}`:e}setTTL(e){this.ttl=e}}const XI=new pQ;function ub(n,e){return XI.getMetadata(n,e)}function db(n){return XI.getMetadataFromQuestion(n)}const QI={emotions:{name:"ÊÑüÊÉÖ",keywords:["happy","sad","angry","excited","worried","nervous","calm","joy","fear","love","hate","surprise"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},movement:{name:"Âãï‰Ωú„ÉªÁßªÂãï",keywords:["walk","run","jump","fly","swim","climb","move","go","come","enter","leave","return"],relatedCategories:["ÂãïË©û"]},time:{name:"ÊôÇÈñì",keywords:["day","night","morning","evening","week","month","year","today","tomorrow","yesterday","always","never","sometimes"],relatedCategories:["ÂêçË©û","ÂâØË©û"]},weather:{name:"Â§©Ê∞ó",keywords:["sunny","rainy","cloudy","windy","snowy","hot","cold","warm","cool","weather","temperature"],relatedCategories:["ÂΩ¢ÂÆπË©û","ÂêçË©û"]},food:{name:"È£ü„ÅπÁâ©",keywords:["food","eat","drink","cook","meal","breakfast","lunch","dinner","hungry","thirsty","delicious"],relatedCategories:["ÂêçË©û","ÂãïË©û","ÂΩ¢ÂÆπË©û"]},nature:{name:"Ëá™ÁÑ∂",keywords:["tree","flower","mountain","river","sea","sky","sun","moon","star","nature","plant","animal"],relatedCategories:["ÂêçË©û"]},family:{name:"ÂÆ∂Êóè„Éª‰∫∫ÈñìÈñ¢‰øÇ",keywords:["family","father","mother","brother","sister","parent","child","friend","teacher","student"],relatedCategories:["ÂêçË©û"]},size:{name:"Â§ß„Åç„Åï„ÉªÁ®ãÂ∫¶",keywords:["big","small","large","tiny","huge","long","short","tall","high","low","wide","narrow"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},communication:{name:"„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥",keywords:["say","speak","talk","tell","ask","answer","listen","hear","write","read","call","email"],relatedCategories:["ÂãïË©û"]},learning:{name:"Â≠¶Áøí",keywords:["learn","study","teach","understand","know","remember","forget","practice","improve","test","exam"],relatedCategories:["ÂãïË©û","ÂêçË©û"]}},YI=[["big","small"],["large","small"],["long","short"],["tall","short"],["high","low"],["wide","narrow"],["deep","shallow"],["heavy","light"],["strong","weak"],["hard","soft"],["hot","cold"],["warm","cool"],["fast","slow"],["quick","slow"],["early","late"],["young","old"],["new","old"],["happy","sad"],["good","bad"],["right","wrong"],["easy","difficult"],["simple","complex"],["start","end"],["begin","finish"],["open","close"],["love","hate"],["day","night"],["morning","evening"],["always","never"],["often","rarely"],["many","few"],["much","little"],["more","less"],["increase","decrease"],["rise","fall"],["up","down"],["front","back"],["before","after"],["first","last"],["enter","leave"],["come","go"],["push","pull"],["give","take"],["buy","sell"],["win","lose"],["remember","forget"],["find","lose"]],JI=[["big","large","huge","enormous"],["small","little","tiny"],["happy","glad","joyful","pleased"],["sad","unhappy","sorrowful"],["angry","mad","furious"],["beautiful","pretty","lovely"],["ugly","unattractive"],["important","significant","essential"],["difficult","hard","tough","challenging"],["easy","simple"],["fast","quick","rapid","swift"],["slow","sluggish"],["smart","intelligent","clever","bright"],["stupid","foolish","dumb"],["funny","amusing","humorous"],["boring","dull","tedious"],["interesting","fascinating","engaging"],["tired","exhausted","weary"],["afraid","scared","frightened","terrified"],["brave","courageous","bold"],["kind","nice","gentle","friendly"],["mean","cruel","unkind"],["rich","wealthy","affluent"],["poor","needy"],["famous","well-known","renowned"],["strange","odd","weird","unusual"],["normal","ordinary","common","typical"]];function mQ(n,e){const t=[],s=new Set;Object.entries(QI).forEach(([o,i])=>{const a=n.filter(c=>{const l=c.word.toLowerCase(),d=c.meaning.toLowerCase();return i.keywords.some(h=>l.includes(h)||d.includes(h))&&!s.has(c.word)}).map(c=>c.word);if(a.length>=2){a.forEach(d=>s.add(d));const l=50+a.filter(d=>{const h=e[d];return h&&h.incorrectCount>h.correctCount}).length/a.length*50;t.push({id:`theme_${o}`,name:i.name,theme:o,words:a,relationType:"theme",priority:l})}}),YI.forEach((o,i)=>{const[a,c]=o,l=n.filter(d=>{const h=d.word.toLowerCase();return(h===a||h===c)&&!s.has(d.word)}).map(d=>d.word);l.length===2&&(l.forEach(d=>s.add(d)),t.push({id:`antonym_${i}`,name:`ÂØæÁæ©Ë™û: ${a} ‚áî ${c}`,theme:"antonyms",words:l,relationType:"antonym",priority:70}))}),JI.forEach((o,i)=>{const a=n.filter(c=>{const l=c.word.toLowerCase();return o.includes(l)&&!s.has(c.word)}).map(c=>c.word);a.length>=2&&(a.forEach(c=>s.add(c)),t.push({id:`synonym_${i}`,name:`È°ûÁæ©Ë™û: ${o.join(", ")}`,theme:"synonyms",words:a,relationType:"synonym",priority:60}))});const r=new Map;return n.forEach(o=>{if(!s.has(o.word)&&o.category){const i=r.get(o.category)||[];i.push(o.word),r.set(o.category,i)}}),r.forEach((o,i)=>{o.length>=3&&(o.forEach(a=>s.add(a)),t.push({id:`category_${i}`,name:`„Ç´„ÉÜ„Ç¥„É™„Éº: ${i}`,theme:i,words:o,relationType:"category",priority:40}))}),t.sort((o,i)=>i.priority-o.priority)}function gQ(n,e,t,s){var c,l,d,h,f,p;const r=n.toLowerCase(),o=e.toLowerCase(),i=t?db(t):ub(n),a=s?db(s):ub(e);if((c=i.family)!=null&&c.root&&((l=a.family)!=null&&l.root)&&i.family.root===a.family.root)return{word1:n,word2:e,relationType:"word_family",strength:.95,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòË™ûÊ†πÔºà${i.family.root}Ôºâ`};if((d=i.family)!=null&&d.prefix&&((h=a.family)!=null&&h.prefix)&&i.family.prefix===a.family.prefix)return{word1:n,word2:e,relationType:"word_family",strength:.7,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•È†≠ËæûÔºà${i.family.prefix}-Ôºâ`};if((f=i.family)!=null&&f.suffix&&((p=a.family)!=null&&p.suffix)&&i.family.suffix===a.family.suffix&&i.pos===a.pos)return{word1:n,word2:e,relationType:"word_family",strength:.65,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•Â∞æËæûÔºà-${i.family.suffix}Ôºâ`};if(i.phrasePattern&&a.phrasePattern&&i.phrasePattern===a.phrasePattern&&i.phrasePattern!=="none")return{word1:n,word2:e,relationType:"collocation",strength:.75,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÁÜüË™û„Éë„Çø„Éº„É≥`};for(const m of YI)if(m[0]===r&&m[1]===o||m[0]===o&&m[1]===r)return{word1:n,word2:e,relationType:"antonym",strength:.9,description:`"${n}"„Å®"${e}"„ÅØÂØæÁæ©Ë™û`};for(const m of JI)if(m.includes(r)&&m.includes(o))return{word1:n,word2:e,relationType:"synonym",strength:.8,description:`"${n}"„Å®"${e}"„ÅØÈ°ûÁæ©Ë™û`};for(const[,m]of Object.entries(QI)){const g=m.keywords.some(y=>r.includes(y)||y.includes(r)),x=m.keywords.some(y=>o.includes(y)||y.includes(o));if(g&&x)return{word1:n,word2:e,relationType:"theme",strength:.6,description:`"${n}"„Å®"${e}"„ÅØÂêå„Åò„ÉÜ„Éº„ÉûÔºà${m.name}Ôºâ`}}return null}function xQ(n,e,t=[]){const s=mQ(n,e),r=[],o=[],i=new Set;return t.forEach(a=>i.add(a)),s.forEach(a=>{const c=a.words.filter(d=>!i.has(d));if(c.length===0)return;c.sort((d,h)=>{const f=e[d],p=e[h];if(!f&&!p)return 0;if(!f)return-1;if(!p)return 1;const m=f.incorrectCount/(f.correctCount+f.incorrectCount||1);return p.incorrectCount/(p.correctCount+p.incorrectCount||1)-m}).forEach(d=>{if(i.has(d))return;const h=r[r.length-1];if(h){const f=n.find(g=>g.word===h),p=n.find(g=>g.word===d),m=gQ(h,d,f,p);o.push({from:h,to:d,reason:m?m.description:`Âêå„Åò„ÇØ„É©„Çπ„Çø„ÉºÔºà${a.name}Ôºâ`})}r.push(d),i.add(d)})}),n.forEach(a=>{i.has(a.word)||(r.push(a.word),i.add(a.word))}),{clusters:s,sequence:r,transitions:o}}class ad{static startTrace(e="weak-words-flow"){return""}static startSpan(e,t,s){return""}static endSpan(e,t){}static addEvent(e,t,s){}static endTrace(){return""}static detectLostWords(e){if(e.length===0)return[];const t=[],s=new Map;for(const r of e){const o=r.attributes.weakWords||[];for(const i of o)s.set(i,{span:r.name,count:r.attributes.weakWordsCount})}if(e.length>=2){const r=new Set(e[0].attributes.weakWords||[]),o=new Set(e[e.length-1].attributes.weakWords||[]);for(const i of r)if(!o.has(i)){const a=s.get(i);a&&t.push({word:i,lastSeenSpan:a.span,lastSeenCount:a.count})}}return t}static generateSummary(e){if(!this.currentContext)return"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó";const t=Array.from(this.currentContext.spans.values()).sort((d,h)=>d.startTime-h.startTime);if(t.length===0)return"„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó";let s="";try{const d=localStorage.getItem("debug_ab_session_info");if(d){const h=JSON.parse(d);s+=`## üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±

`,s+=`**ÁèæÂú®„ÅÆVariant**: ${h.variant}
`,s+=`- **A**: ÈÄöÂ∏∏„É¢„Éº„ÉâÔºàcalculatePrioritiesÔºâ
`,s+=`- **B**: „Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„ÉâÔºàPosition‰∏ªËª∏+AIÂ∞èË£úÊ≠£Ôºâ
`,s+=`- **C**: AI‰∏ªËª∏„É¢„Éº„ÉâÔºàfinalPriorityMode„ÄÅGamificationAI„Éñ„Éº„Çπ„ÉàÔºâ

`,h.variant==="A"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant A„Åß„Åô„ÄÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„ÅØÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):h.variant==="B"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant B„Åß„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅØÈÉ®ÂàÜÁöÑ„Å´„Åó„ÅãÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):h.variant==="C"&&(s+=`‚úÖ **Ê≠£Â∏∏**: Variant C„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅåÊúâÂäπ„Åß„Åô„ÄÇ

`)}}catch{}const r=t.filter(d=>d.name==="QuestionScheduler.calculatePriorities");if(r.length>0){const d=r[0].startTime,p=((r[r.length-1].startTime||r[r.length-1].startTime)-d)/1e3,m=p>0?r.length/p:0;s+=`## üö® ÊåØÂãïÊ§úÂá∫ÔºàcalculatePrioritiesÂëº„Å≥Âá∫„ÅóÈ†ªÂ∫¶Ôºâ

`,s+=`- **Á∑èÂëº„Å≥Âá∫„ÅóÂõûÊï∞**: ${r.length}Âõû
`,s+=`- **ÊúüÈñì**: ${p.toFixed(2)}Áßí
`,s+=`- **Âëº„Å≥Âá∫„ÅóÈ†ªÂ∫¶**: ${m.toFixed(2)}Âõû/Áßí

`,m>5?(s+=`üî¥ **Áï∞Â∏∏Ê§úÂá∫**: calculatePriorities„Åå ${m.toFixed(1)}Âõû/Áßí „ÅßÂëº„Å∞„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`,s+=`**ÂéüÂõ†ÂÄôË£ú**: useEffect„ÅÆ‰æùÂ≠òÈÖçÂàó„ÄÅ„Åæ„Åü„ÅØstateÊõ¥Êñ∞„Å´„Çà„ÇãÁÑ°Èôê„É´„Éº„Éó„ÅÆÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

`):m>2?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: calculatePriorities„Åå ${m.toFixed(1)}Âõû/Áßí „ÅßÂëº„Å∞„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`,s+=`**Êé®Â•®**: Âëº„Å≥Âá∫„ÅóÂõûÊï∞„ÅåÂ§ö„Åô„Åé„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

`):s+=`‚úÖ **Ê≠£Â∏∏**: Âëº„Å≥Âá∫„ÅóÈ†ªÂ∫¶„ÅØÊ≠£Â∏∏ÁØÑÂõ≤ÂÜÖ„Åß„Åô„ÄÇ

`}s+=`## üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ

`,s+=`| „Çπ„Éë„É≥ | ÈñãÂßãÊôÇÂàª | ÊâÄË¶ÅÊôÇÈñì | „Åæ„Å†„Åæ„Å†Ë™û | Á∑èÂçòË™ûÊï∞ | Áä∂ÊÖã |
`,s+=`|---|---|---|---|---|---|
`;const o=30,i=t.length>o?t.slice(-o):t;t.length>o&&(s+=`> ‚ÑπÔ∏è „Çπ„Éë„É≥„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂÖ®${t.length}‰ª∂‰∏≠„ÄÅÊú´Â∞æ${o}‰ª∂„ÅÆ„ÅøË°®Á§∫„Åó„Åæ„Åô

`);let a=-1;for(const d of i){const h=d.endTime?`${(d.endTime-d.startTime).toFixed(2)}ms`:"ÂÆüË°å‰∏≠",f=new Date(Date.now()-performance.now()+d.startTime).toISOString().split("T")[1],p=d.attributes.weakWordsCount??d.attributes.weakWordsCountAfter??0,m=d.attributes.totalCount??d.attributes.totalCountAfter??0;let g="‚úÖ Ê≠£Â∏∏",x="";if(a!==-1){const y=p-a;p===0&&a>0?(g="‚ùå Ê∂àÂ§±",x=` (-${a}Ë™û)`):y<0?(g="‚ö†Ô∏è Ê∏õÂ∞ë",x=` (${y}Ë™û)`):y>0&&(g="üìà Â¢óÂä†",x=` (+${y}Ë™û)`)}a=p,s+=`| ${d.name} | ${f} | ${h} | ${p}Ë™û${x} | ${m}Ë™û | ${g} |
`}const c=t.find(d=>d.name==="MemorizationView.prepareScheduling");if(c){const d=c.attributes.weakWordsCount??0,h=c.attributes.weakWordsCountAfter??0,f=c.attributes.totalCount??0,p=c.attributes.totalCountAfter??0;if(s+=`
### üìä „Çπ„Ç±„Ç∏„É•„Éº„É´ÂâçÂæå„ÅÆÊØîËºÉ

`,s+=`**MemorizationView.prepareScheduling**:
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Ââç: ${d}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${f}Ë™û„ÅÆÂÄôË£ú
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Âæå: ${h}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${p}Ë™û„ÅÆÁµêÊûú
`,d>h){const b=d-h,w=(b/d*100).toFixed(1);s+=`- **Â§âÂåñ**: ${b}Ë™ûÊ∏õÂ∞ëÔºà${w}%Ê∂àÂ§±Ôºâ ‚ö†Ô∏è
`}else if(d<h){const b=h-d;s+=`- **Â§âÂåñ**: ${b}Ë™ûÂ¢óÂä† üìà
`}else s+=`- **Â§âÂåñ**: Â§âÂåñ„Å™„Åó ‚úÖ
`;const m=new Set(c.attributes.weakWords||[]),g=new Set(c.attributes.weakWordsAfter||[]),x=[...m].filter(b=>!g.has(b)),y=[...g].filter(b=>!m.has(b));x.length>0&&(s+=`
**Ê∂àÂ§±„Åó„ÅüÂçòË™ûÔºà${x.length}Ë™ûÔºâ**:
`,s+=`- ${x.slice(0,10).join(", ")}`,x.length>10&&(s+=` (+${x.length-10}Ë™û)`),s+=`
`),y.length>0&&(s+=`
**Êñ∞„Åü„Å´ËøΩÂä†„Åï„Çå„ÅüÂçòË™ûÔºà${y.length}Ë™ûÔºâ**:
`,s+=`- ${y.slice(0,10).join(", ")}`,y.length>10&&(s+=` (+${y.length-10}Ë™û)`),s+=`
`)}const l=this.detectLostWords(t);l.length>0?(s+=`
### ‚ùå Ê∂àÂ§±„Åó„ÅüÂçòË™û

`,l.slice(0,10).forEach(d=>{s+=`- **${d.word}**: ÊúÄÂæå„Å´Á¢∫Ë™ç ‚Üí ${d.lastSeenSpan}
`}),l.length>10&&(s+=`
_...‰ªñ${l.length-10}Ë™û_
`)):s+=`
### ‚úÖ Ê∂àÂ§±„Åó„ÅüÂçòË™û„Å™„Åó

`,s+=`
### üìä „Çπ„Éë„É≥„Åî„Å®„ÅÆÂçòË™û„É™„Çπ„ÉàÂ§âÂåñ

`;for(const d of t){const h=d.attributes.weakWords||[];if(h.length>0){const f=h.slice(0,5).join(", "),p=h.length>5?` (+${h.length-5}Ë™û)`:"";s+=`- **${d.name}**: ${h.length}Ë™û ‚Üí [${f}${p}]
`}else s+=`- **${d.name}**: 0Ë™û
`}if(l.length>0){s+=`
### üîç Ê∂àÂ§±„ÅÆË©≥Á¥∞ÂàÜÊûê

`,s+=`**Á∑èÊ∂àÂ§±Êï∞**: ${l.length}Ë™û

`;for(let d=0;d<t.length-1;d++){const h=new Set(t[d].attributes.weakWords||t[d].attributes.weakWordsAfter||[]),f=new Set(t[d+1].attributes.weakWords||[]),p=[...h].filter(g=>!f.has(g)),m=[...f].filter(g=>!h.has(g));if(p.length>0||m.length>0){const g=h.size,x=f.size,y=x-g,b=g>0?(Math.abs(y)/g*100).toFixed(1):"0.0";s+=`
**${t[d].name} ‚Üí ${t[d+1].name}**:
`,s+=`- ÂçòË™ûÊï∞Â§âÂåñ: ${g}Ë™û ‚Üí ${x}Ë™û`,y<0?s+=` (${y}Ë™û„ÄÅ-${b}%) ‚ö†Ô∏è`:y>0&&(s+=` (+${y}Ë™û„ÄÅ+${b}%) üìà`),s+=`
`,p.length>0&&(s+=`- Ê∂àÂ§±Ôºà${p.length}Ë™ûÔºâ: ${p.slice(0,5).join(", ")}`,p.length>5&&(s+=` (+${p.length-5}Ë™û)`),s+=`
`),m.length>0&&(s+=`- ËøΩÂä†Ôºà${m.length}Ë™ûÔºâ: ${m.slice(0,5).join(", ")}`,m.length>5&&(s+=` (+${m.length-5}Ë™û)`),s+=`
`)}}}try{const d=Nu("debug_finalPriority_output",{mode:e}).raw,h=Nu("debug_finalPriority_sessionStats",{mode:e}).raw;if(d&&h){const f=JSON.parse(d),p=JSON.parse(h);s+=`
### üß† finalPriority„É¢„Éº„ÉâÔºàAI‰∏ªËª∏Ôºâ„ÅÆË©≥Á¥∞

`,s+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊÉÖÂ†±**:
`,s+=`- „Çø„Éñ: ${p.currentTab}
`,s+=`- Á∑èÂïèÈ°åÊï∞: ${p.totalQuestions}Âïè
`,s+=`- ÈÄ≤Êçó„Éá„Éº„Çø: ${p.allProgressCount}Ë™û
`,s+=`- „Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${p.timestamp}

`,s+=`**TOP10„ÅÆÂïèÈ°åÔºàfinalPriorityÈôçÈ†ÜÔºâ**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | finalPriority | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|---|
`,f.slice(0,10).forEach(g=>{const x=g.position>=70?"üî¥":g.position>=40?"üü°":g.position>=20?"‚ö™":"‚úÖ";s+=`| ${g.rank} | **${g.word}** | ${g.position} ${x} | ${g.finalPriority.toFixed(3)} | ${g.category||"-"} | ${g.attempts}Âõû |
`});const m=f.filter(g=>g.position>=40&&g.attempts>0);s+=`
**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞**:
`,s+=`- TOP10„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${m.slice(0,10).length}Ë™û
`,s+=`- TOP30„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${m.length}Ë™û
`,m.length>0?(s+=`
**„Åæ„Å†„Åæ„Å†Ë™ûTOP5**:
`,m.slice(0,5).forEach(g=>{s+=`- **${g.word}** („É©„É≥„ÇØ${g.rank}, Position ${g.position}, finalPriority ${g.finalPriority.toFixed(3)})
`})):(s+=`
‚ö†Ô∏è **Ë≠¶Âëä**: TOP30„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,s+=`‚Üí GamificationAI„ÅÆ„Éñ„Éº„Çπ„ÉàÂá¶ÁêÜ„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`)}else s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì

`,s+=`finalPriorityMode„Åå‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÄÅ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`}catch(d){s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${d}
`}try{const d=Nu("debug_postProcess_output",{mode:e}).raw,h=localStorage.getItem("debug_sortAndBalance_output");if(d||h){if(s+=`
### üîç sortAndBalance ‚Üí postProcess „ÅÆÈ†ÜÂ∫èÊ§úË®º

`,h){const f=JSON.parse(h);s+=`**sortAndBalanceÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|
`,f.slice(0,10).forEach((m,g)=>{const x=m.position>=70?"üî¥":m.position>=60?"üü°":m.position>=40?"üîµ":m.position>=20?"‚ö™":"‚úÖ";s+=`| ${g+1} | **${m.word}** | ${m.position} ${x} | ${m.category||"-"} | ${m.attempts}Âõû |
`});const p={incorrect:f.filter(m=>m.position>=70).length,stillLearning:f.filter(m=>m.position>=60&&m.position<70&&m.attempts>0).length,newBoosted:f.filter(m=>m.position>=40&&m.position<60&&m.attempts===0).length,newNormal:f.filter(m=>m.position>=20&&m.position<40).length,mastered:f.filter(m=>m.position<20).length};s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${p.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å† (Position 60-69, attempts>0): ${p.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà (Position 40-59, attempts=0): ${p.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏ (Position 20-39): ${p.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à (Position <20): ${p.mastered}Ë™û

`}if(d){const f=JSON.parse(d),m=(Array.isArray(f)?f:Array.isArray(f==null?void 0:f.top30)?f.top30:[]).slice(0,30).map((x,y)=>({rank:Number(x==null?void 0:x.rank)||y+1,word:String((x==null?void 0:x.word)??""),position:Number((x==null?void 0:x.position)??0),attempts:Number((x==null?void 0:x.attempts)??0)})),g={incorrect:m.filter(x=>x.position>=70).length,stillLearning:m.filter(x=>x.position>=60&&x.position<70&&x.attempts>0).length,newBoosted:m.filter(x=>x.position>=40&&x.position<60&&x.attempts===0).length,newNormal:m.filter(x=>x.position>=20&&x.position<40).length,mastered:m.filter(x=>x.position<20).length};if(s+=`**postProcessÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | Áä∂ÊÖã |
`,s+=`|---|---|---|---|
`,m.slice(0,10).forEach(x=>{const y=x.position>=70?"üî¥":x.position>=60?"üü°":x.position>=40?"üîµ":x.position>=20?"‚ö™":"‚úÖ",b=x.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":x.position>=60?"„Åæ„Å†„Åæ„Å†":x.position>=40?"Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà":x.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";s+=`| ${x.rank} | **${x.word}** | ${x.position} ${y} | ${b} |
`}),s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${g.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å†: ${g.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà: ${g.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏: ${g.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à: ${g.mastered}Ë™û

`,h){const y=JSON.parse(h).slice(0,10).map(v=>v.word),b=m.slice(0,10).map(v=>v.word);y.some((v,S)=>v!==b[S])?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`,s+=`‚Üí postProcess()„ÅÆÈñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„ÅåPositionÈöéÂ±§„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

`):s+=`‚úÖ **È†ÜÂ∫è‰øùÊåÅ**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

`}}else s+=`‚ö†Ô∏è postProcessÂæå„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
`}}catch(d){s+=`
### ‚ö†Ô∏è postProcessÊÉÖÂ†±„ÅÆË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${d}
`}return s}static saveContext(){if(this.currentContext)try{const e={traceId:this.currentContext.traceId,spans:Array.from(this.currentContext.spans.entries()),activeSpanId:this.currentContext.activeSpanId};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch{}}static restoreContext(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return this.currentContext={traceId:t.traceId,spans:new Map(t.spans),activeSpanId:t.activeSpanId},this.currentContext}catch{return null}}static clearTrace(){this.currentContext=null;try{localStorage.removeItem(this.STORAGE_KEY)}catch{}}}me(ad,"STORAGE_KEY","debug_trace_context"),me(ad,"currentContext",null);const yQ="learning-efficiency-",ZI=`${yQ}word-relations`;function ek(n){try{localStorage.setItem(ZI,JSON.stringify(n)),j.info("[LearningEfficiency] Èñ¢ÈÄ£Ë™û„Éá„Éº„Çø‰øùÂ≠òÂÆå‰∫Ü",{count:n.length})}catch(e){j.error("[LearningEfficiency] Èñ¢ÈÄ£Ë™û„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº",e)}}function B0(){try{const n=localStorage.getItem(ZI);return n?JSON.parse(n):[]}catch(n){return j.error("[LearningEfficiency] Èñ¢ÈÄ£Ë™û„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº",n),[]}}const tk=30,bQ=12,wQ=45,vQ=18,SQ=40,hb=8,fb=.2,$u=7,CQ=1,NQ=2,IQ=-1,gu=.12;let Yn=null,zo=null,ls=null,Mf=!1,Ff=!1,Tu=!1,cd=0;const nk="debug_vocabulary_network_perf",kQ=50;function ld(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Of(){return{updatedAt:Date.now(),counters:{lookupBuildCount:0,lookupHitCount:0,answerUpdateCount:0,answerUpdateTotalMs:0,answerUpdateMaxMs:0,schedulerReorderCount:0,schedulerReorderTotalMs:0,schedulerReorderMaxMs:0},history:[]}}function $Q(){try{const n=localStorage.getItem(nk);if(!n)return Of();const e=JSON.parse(n);return!(e!=null&&e.counters)||!Array.isArray(e==null?void 0:e.history)?Of():e}catch{return Of()}}function TQ(n){try{for(n.updatedAt=Date.now();n.history.length>kQ;)n.history.shift();localStorage.setItem(nk,JSON.stringify(n))}catch{}}function sf(n,e,t){const s=$Q();n==="lookup_build"&&(s.counters.lookupBuildCount+=1),n==="lookup_hit"&&(s.counters.lookupHitCount+=1),n==="answer_update"&&(s.counters.answerUpdateCount+=1,typeof e=="number"&&Number.isFinite(e)&&(s.counters.answerUpdateTotalMs+=e,s.counters.answerUpdateMaxMs=Math.max(s.counters.answerUpdateMaxMs,e))),n==="scheduler_reorder"&&(s.counters.schedulerReorderCount+=1,typeof e=="number"&&Number.isFinite(e)&&(s.counters.schedulerReorderTotalMs+=e,s.counters.schedulerReorderMaxMs=Math.max(s.counters.schedulerReorderMaxMs,e))),s.history.push({at:Date.now(),event:n,ms:e,meta:t}),TQ(s)}function AQ(n){sf("scheduler_reorder",n.ms,n)}function RQ(n){if(typeof n.relatedFields!="string")return["„Åù„ÅÆ‰ªñ"];const e=n.relatedFields.split(",").map(t=>t.trim()).filter(Boolean);return e.length>0?e:["„Åù„ÅÆ‰ªñ"]}function xu(n,e,t,s){if(e===t)return;n.has(e)||n.set(e,new Map);const r=n.get(e),o=r.get(t);(!o||s.strength>o.strength)&&r.set(t,s)}function sk(n,e){const t=tk,s=bQ,r=new Map,o=new Map,i=new Map,a=new Map,c=n.map(p=>p.word);for(const p of n){const m=p.word;for(const b of RQ(p))r.has(b)||r.set(b,[]),r.get(b).push(m);const g=m.toLowerCase(),x=["un","re","dis","pre","post","anti","de"];for(const b of x)g.startsWith(b)&&g.length>b.length+2&&(o.has(b)||o.set(b,[]),o.get(b).push(m));const y=["ing","ed","er","tion","ness","ly","ful","less"];for(const b of y)g.endsWith(b)&&g.length>b.length+2&&(i.has(b)||i.set(b,[]),i.get(b).push(m));if(g.length>=4){const b=g.slice(0,4);a.has(b)||a.set(b,[]),a.get(b).push(m)}}const l=new Map;for(const[,p]of r)for(let m=0;m<p.length;m++){const g=p[m];for(let x=m+1;x<Math.min(p.length,m+1+s);x++){const y=p[x],b={relatedWord:y,relationType:"category",strength:70};xu(l,g,y,b),xu(l,y,g,{...b,relatedWord:g})}}const d=(p,m,g)=>{for(let x=0;x<p.length;x++){const y=p[x];for(let b=x+1;b<Math.min(p.length,x+1+s);b++){const w=p[b],v={relatedWord:w,relationType:g,strength:m};xu(l,y,w,v),xu(l,w,y,{...v,relatedWord:y})}}};for(const[,p]of o)d(p,60,"derivation");for(const[,p]of i)d(p,55,"derivation");for(const[,p]of a)p.length>=4&&d(p,65,"derivation");const h=Date.now();return c.map(p=>{var g;const m=Array.from(((g=l.get(p))==null?void 0:g.values())??[]);return m.sort((x,y)=>y.strength-x.strength),{word:p,relations:m.slice(0,t),updatedAt:h}})}function rk(n){const e=window.requestIdleCallback;typeof e=="function"?e(()=>n()):window.setTimeout(()=>n(),0)}function ud(n){return Math.max(0,Math.min(100,Math.round(n)))}function pb(n,e,t,s){const r=n.relations.find(i=>i.relatedWord===e);if(r)return r;const o={relatedWord:e,relationType:t,strength:ud(s),lastUpdatedAt:Date.now(),sampleCount:0};return n.relations.push(o),o}function Wp(n,e){n.relations.sort((t,s)=>s.strength-t.strength),n.relations.length>e&&(n.relations=n.relations.slice(0,e))}function ok(){if(zo)return zo;const n=new Map;for(const e of Yn??[])n.set(e.word,e);return zo=n,n}function EQ(){if(ls)return ls;const n=ld(),e=MQ(Yn??[]),t=ld();return ls=e,sf("lookup_build",t-n,{words:(Yn==null?void 0:Yn.length)??0}),e}function mb(n,e,t){ls&&(ls.has(n)||ls.set(n,new Map),ls.get(n).set(e,t))}function DQ(n,e){var a,c,l,d;if(ls){const h=((a=ls.get(n))==null?void 0:a.get(e))??0,f=((c=ls.get(e))==null?void 0:c.get(n))??0;return Math.max(h,f)}const t=ok(),s=t.get(n),r=t.get(e),o=((l=s==null?void 0:s.relations.find(h=>h.relatedWord===e))==null?void 0:l.strength)??0,i=((d=r==null?void 0:r.relations.find(h=>h.relatedWord===n))==null?void 0:d.strength)??0;return Math.max(o,i)}function gb(n,e,t){const r=(e-(cd===0?e:cd))/(1e3*60*60*24);if(r<$u)return;const o=Math.floor(r/$u);if(o<=0)return;const i=[];for(const a of n.relations){const c=a.successRate,l=a.sampleCount??0;if(a.lastUpdatedAt&&e-a.lastUpdatedAt>1e3*60*60*24*$u){let d=CQ*o;c!==void 0&&l>=hb&&c<=fb&&(d*=2),a.strength=ud(a.strength-d)}c!==void 0&&l>=hb&&c<=fb&&a.strength<SQ||a.strength<vQ||i.push(a)}n.relations=i,Wp(n,t)}function jQ(){Tu&&(Ff||(Ff=!0,rk(()=>{try{Yn&&Tu&&(ek(Yn),Tu=!1,j.debug("[VocabularyNetwork] ÂÄã‰∫∫Âà•Êõ¥Êñ∞„ÅÆ‰øùÂ≠òÂÆå‰∫Ü",{words:Yn.length}))}catch(n){j.warn("[VocabularyNetwork] ÂÄã‰∫∫Âà•Êõ¥Êñ∞„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó",n)}finally{Ff=!1}})))}function ik(n){if(Yn)return Yn;const e=B0();return e.length>0?(Yn=e,zo=null,ls=null,e):(Yn=sk(n),zo=null,ls=null,Yn)}function _Q(n){if(Mf)return;const e=B0();if(e.length>0){Yn=e,zo=null,ls=null;return}Mf=!0,rk(()=>{var t,s;try{const r=Yn??sk(n);ek(r),Yn=r,zo=null,ls=null,j.info("[VocabularyNetwork] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰øùÂ≠òÂÆå‰∫Ü",{words:r.length,topK:((s=(t=r[0])==null?void 0:t.relations)==null?void 0:s.length)??0})}catch(r){j.warn("[VocabularyNetwork] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰øùÂ≠ò„Å´Â§±Êïó",r)}finally{Mf=!1}})}function PQ(n){const e=ld(),{word:t,previousWord:s,isCorrect:r}=n;if(!s||t===s)return;if(!Yn){const x=B0();x.length>0&&(Yn=x,zo=null,ls=null)}if(!Yn)return;const o=tk,i=DQ(s,t);if(i<wQ)return;const a=r?IQ:NQ,c=ok(),l=c.get(s),d=c.get(t);if(!l||!d)return;const h=pb(l,t,"context",i),f=pb(d,s,"context",i);h.strength=ud(h.strength+a),f.strength=ud(f.strength+a);const p=Date.now();h.lastUpdatedAt=p,f.lastUpdatedAt=p;const m=r?1:0;h.successRate=h.successRate===void 0?m:h.successRate*(1-gu)+m*gu,f.successRate=f.successRate===void 0?m:f.successRate*(1-gu)+m*gu,h.sampleCount=(h.sampleCount??0)+1,f.sampleCount=(f.sampleCount??0)+1,l.updatedAt=p,d.updatedAt=p,Wp(l,o),Wp(d,o),mb(s,t,h.strength),mb(t,s,f.strength),gb(l,p,o),gb(d,p,o),p-cd>=1e3*60*60*24*$u&&(cd=p),Tu=!0,jQ();const g=ld();sf("answer_update",g-e,{isCorrect:r,baseStrength:i})}function Bp(n){return ik(n),ls?(sf("lookup_hit"),ls):EQ()}function MQ(n){const e=new Map;for(const t of n){e.has(t.word)||e.set(t.word,new Map);const s=e.get(t.word);for(const r of t.relations)s.set(r.relatedWord,r.strength)}return e}class ak{constructor(e,t){me(this,"tests",new Map);me(this,"storage");me(this,"userId");this.storage=e,this.userId=t||this.getOrCreateUserId()}getOrCreateUserId(){const e="ab_test_user_id";let t=localStorage.getItem(e);return t||(t=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(e,t)),t}registerTest(e){const t=e.variants.reduce((s,r)=>s+r.weight,0);if(Math.abs(t-100)>.01)throw new Error(`Test ${e.id}: Variant weights must sum to 100, got ${t}`);this.tests.set(e.id,e)}getTest(e){return this.tests.get(e)}getActiveTests(){const e=new Date;return Array.from(this.tests.values()).filter(t=>!(!t.active||t.startDate>e||t.endDate&&t.endDate<e))}getVariant(e){const t=this.tests.get(e);if(!t||!t.active)return null;const s=this.storage.getAssignment(e);if(s)return s.variantId;const r=this.assignVariant(t);return this.storage.setAssignment({testId:e,variantId:r,assignedAt:new Date}),r}assignVariant(e){const s=this.hashString(`${this.userId}_${e.id}`)%100;let r=0;for(const o of e.variants)if(r+=o.weight,s<r)return o.id;return e.variants[0].id}hashString(e){let t=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}isFeatureEnabled(e,t){const s=this.getVariant(e);if(!s)return!1;const r=this.tests.get(e);if(!r)return!1;const o=r.variants.find(i=>i.id===s);return o?o.features[t]===!0:!1}getAllAssignments(){return this.storage.getAllAssignments()}resetAssignment(e){const s=this.storage.getAllAssignments().filter(r=>r.testId!==e);for(const r of s)this.storage.setAssignment(r)}}let Lf=null;function ck(){if(!Lf){const n={getAssignment(e){const t=`ab_test_assignment_${e}`,s=localStorage.getItem(t);if(!s)return null;const r=JSON.parse(s);return{...r,assignedAt:new Date(r.assignedAt)}},setAssignment(e){const t=`ab_test_assignment_${e.testId}`;localStorage.setItem(t,JSON.stringify(e))},getAllAssignments(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);if(s!=null&&s.startsWith("ab_test_assignment_")){const r=localStorage.getItem(s);if(r){const o=JSON.parse(r);e.push({...o,assignedAt:new Date(o.assignedAt)})}}}return e}};Lf=new ak(n)}return Lf}const FQ=Object.freeze(Object.defineProperty({__proto__:null,ABTestManager:ak,getABTestManager:ck},Symbol.toStringTag,{value:"Module"}));class lk{constructor(e){me(this,"categoryCache");me(this,"cacheTimeout",1e4);this.categoryCache=new Map}determineCategory(e,t){const s=`${e.word}-${t}`,r=this.categoryCache.get(s),o=Jt(e,t),i=bc(o),a=`${o}`;return r&&Date.now()-r.timestamp<this.cacheTimeout&&r.signature===a?r.category:(this.cacheResult(s,i,a),i)}validateCategoryTransition(e,t,s){return e==="mastered"&&t==="incorrect"&&(s.consecutiveIncorrect||0)<2?{valid:!1,reason:"ÂÆöÁùÄÊ∏à‚ÜíÂàÜ„Åã„Çâ„Å™„ÅÑ „Å∏„ÅÆÁßªÂãï„ÅØÈÄ£Á∂ö‰∏çÊ≠£Ëß£2Âõû‰ª•‰∏ä„ÅåÂøÖË¶Å"}:e==="new"&&t==="mastered"&&(s.memorizationAttempts||s.translationAttempts||s.spellingAttempts||s.grammarAttempts||0)<3?{valid:!1,reason:"Êñ∞Ë¶è‚ÜíÂÆöÁùÄÊ∏à „Å∏„ÅÆÁßªÂãï„ÅØÊúÄ‰Ωé3Âõû„ÅÆË©¶Ë°å„ÅåÂøÖË¶Å"}:{valid:!0}}getCategoryStats(e,t,s){const r={new:0,incorrect:0,still_learning:0,mastered:0};for(const o of e){const i=t[o];if(!i){r.new++;continue}const a=this.determineCategory(i,s);r[a]++}return{counts:r}}clearCache(){this.categoryCache.clear()}pruneCache(){const e=Date.now(),t=[];for(const[s,r]of this.categoryCache.entries())e-r.timestamp>this.cacheTimeout&&t.push(s);for(const s of t)this.categoryCache.delete(s)}cacheResult(e,t,s){this.categoryCache.set(e,{category:t,timestamp:Date.now(),signature:s}),this.categoryCache.size>100&&this.pruneCache()}}const zf="batch-config";class dd{constructor(){me(this,"config",null);me(this,"classifier");this.classifier=new lk}static isVerboseDebug(){return!1}initialize(e,t={}){const s=t.mode||"memorization",r=`${zf}-${s}`;if(!t.reset){const l=localStorage.getItem(r);if(l)try{this.config=JSON.parse(l),dd.isVerboseDebug();return}catch(d){j.warn("[BatchManager] Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„ÄÅÊñ∞Ë¶è‰ΩúÊàê„Åó„Åæ„Åô",d)}}const o=t.batchSize||100,i=t.clearThreshold!==void 0?t.clearThreshold:.7,a=e.map(l=>l.word),c=a.slice(0,o);this.config={batchSize:o,clearThreshold:i,currentBatch:1,activeWords:c,allWords:a,mode:s},this.saveConfig()}getActiveWords(){return this.config?this.config.activeWords:(j.warn("[BatchManager] ÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"),[])}getStatus(e){if(!this.config)return{currentBatch:0,activeCount:0,clearedCount:0,clearRate:0,canAddNextBatch:!1,allBatchesCleared:!1};const t=new zs(this.config.mode),s=this.config.activeWords.filter(c=>{const l=e[c];return l?t.calculate(l)<20:!1}).length,r=this.config.activeWords.length>0?s/this.config.activeWords.length:0,o=this.config.clearThreshold===0?this.config.currentBatch*this.config.batchSize<this.config.allWords.length:r>=this.config.clearThreshold&&this.config.currentBatch*this.config.batchSize<this.config.allWords.length,i=this.config.clearThreshold===0?this.config.currentBatch*this.config.batchSize>=this.config.allWords.length&&this.config.activeWords.length===0:this.config.currentBatch*this.config.batchSize>=this.config.allWords.length&&r>=this.config.clearThreshold,a=this.classifier.getCategoryStats(this.config.activeWords,e,this.config.mode);return{currentBatch:this.config.currentBatch,activeCount:this.config.activeWords.length,clearedCount:s,clearRate:r,canAddNextBatch:o,allBatchesCleared:i,categoryStats:a}}checkAndAddNextBatch(e){if(!this.config)return j.warn("[BatchManager] ÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"),!1;if(!this.getStatus(e).canAddNextBatch)return!1;const s=this.config.currentBatch*this.config.batchSize,r=s+this.config.batchSize,o=this.config.allWords.slice(s,r);if(o.length===0)return!1;const i=new zs(this.config.mode),a=this.config.activeWords.filter(c=>{const l=e[c];return l?i.calculate(l)>=20:!0});return this.config.activeWords=[...a,...o],this.config.currentBatch+=1,this.saveConfig(),!0}reset(){if(!this.config)return;const e=`${zf}-${this.config.mode}`;localStorage.removeItem(e),this.config=null}saveConfig(){if(!this.config)return;const e=`${zf}-${this.config.mode}`;try{localStorage.setItem(e,JSON.stringify(this.config))}catch(t){j.error("[BatchManager] Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó",t)}}static isEnabled(){return localStorage.getItem("batch-mode-enabled")==="true"}static enable(){localStorage.setItem("batch-mode-enabled","true")}static disable(){localStorage.removeItem("batch-mode-enabled")}}class OQ{constructor(e){me(this,"calculatorCache");this.calculatorCache=new Map,e!=null&&e.baseCalculator&&this.calculatorCache.set("memorization",e.baseCalculator)}calculateCategoryPosition(e,t,s){const r=this.getBasePosition(e,s);let o=r,i="Âü∫Êú¨Position";switch(t){case"incorrect":o=this.calculateIncorrectPosition(e,r,s),i="ÈÄ£Á∂ö‰∏çÊ≠£Ëß£„ÉªÊ≠£Á≠îÁéáË£úÊ≠£";break;case"still_learning":o=this.calculateStillLearningPosition(e,r,s),i="Ê≠£Á≠îÁéá„ÉªÂæ©ÁøíÈñìÈöîË£úÊ≠£";break;case"new":o=this.calculateNewPosition(e,r),i="„Éê„ÉÉ„ÉÅÈ†Ü„ÉªÂü∫Êú¨Position";break;case"mastered":o=this.calculateMasteredPosition(e,r),i="ÂøòÂç¥ÂØæÁ≠ñ„ÉªÁµåÈÅéÊó•Êï∞Ë£úÊ≠£";break}const a=this.calculateMetadataBonus(e);return a!==0&&(o+=a,i+=` + „É°„ÇøÊÉÖÂ†±(${a})`),o=this.normalizePosition(o),{category:t,positionInCategory:o,reason:i}}sortByPriority(e,t,s,r){return e.map(i=>{const a=t[i]||this.createDefaultProgress(i),c=this.calculateCategoryPosition(a,s,r);return{word:i,position:c}}).sort((i,a)=>a.position.positionInCategory-i.position.positionInCategory)}calculateIncorrectPosition(e,t,s){const r=e.consecutiveIncorrect||0,{attempts:o,correct:i}=this.getModeStats(e,s);let a=t+r*5;if(o>0){const l=(100-i/o*100)*.2;a+=l}return a}calculateStillLearningPosition(e,t,s){const{attempts:r,correct:o}=this.getModeStats(e,s);if(r===0)return t;const a=(100-o/r*100)*.2,c=e.lastStudied?(Date.now()-e.lastStudied)/(1e3*60*60*24):0,l=Math.min(10,c*.5);return t+a+l}getBasePosition(e,t){let s=this.calculatorCache.get(t);return s||(s=new zs(t),this.calculatorCache.set(t,s)),s.calculate(e)}calculateMetadataBonus(e){const t=typeof e.difficultyScore=="number"?e.difficultyScore:0,s=Math.round(Math.max(0,Math.min(100,t))/100*10),o=e.userDifficultyRating===3?2:0;return Math.max(0,Math.min(12,s+o))}calculateNewPosition(e,t){const s=e.word.toLowerCase(),r=s.match(/[a-z]/)?s.charAt(0):"#",i=(r==="#"?26:r.charCodeAt(0)-97)*100/27,a=(Math.random()-.5)*30;return Math.max(0,Math.min(100,i+a))}calculateMasteredPosition(e,t){if(!e.lastStudied)return t;const s=(Date.now()-e.lastStudied)/(1e3*60*60*24),r=Math.min(40,s*2);return t+r}normalizePosition(e){return Math.max(0,Math.min(100,Math.round(e)))}getModeStats(e,t){switch(t){case"memorization":return{attempts:e.memorizationAttempts||0,correct:e.memorizationCorrect||0};case"translation":return{attempts:e.translationAttempts||0,correct:e.translationCorrect||0};case"spelling":return{attempts:e.spellingAttempts||0,correct:e.spellingCorrect||0};case"grammar":return{attempts:e.grammarAttempts||0,correct:e.grammarCorrect||0};default:return{attempts:0,correct:0}}}createDefaultProgress(e){return{word:e,correctCount:0,incorrectCount:0,lastStudied:0,consecutiveCorrect:0,consecutiveIncorrect:0,memorizationAttempts:0,memorizationCorrect:0,translationAttempts:0,translationCorrect:0,spellingAttempts:0,spellingCorrect:0,grammarAttempts:0,grammarCorrect:0,totalResponseTime:0,averageResponseTime:0,difficultyScore:0,masteryLevel:"new",responseTimes:[]}}}const Wf={memorization:{newRatio:.5,incorrectRatio:.2,stillLearningRatio:.2,masteredRatio:.1,chainLearningRatio:.3},translation:{newRatio:.6,incorrectRatio:.2,stillLearningRatio:.15,masteredRatio:.05,chainLearningRatio:.3},spelling:{newRatio:.65,incorrectRatio:.2,stillLearningRatio:.1,masteredRatio:.05,chainLearningRatio:.3},grammar:{newRatio:.6,incorrectRatio:.2,stillLearningRatio:.15,masteredRatio:.05,chainLearningRatio:.3}};class uk{constructor(e){me(this,"storageKey");me(this,"debugMode");me(this,"configCache");this.storageKey=(e==null?void 0:e.storageKey)||"slot-config",this.debugMode=(e==null?void 0:e.debugMode)||!1,this.configCache=new Map}getSlotConfig(e){if(this.configCache.has(e))return this.configCache.get(e);let t;const s=this.loadCustomConfig(e);return s?(t=s,this.debugMode&&j.info(`[SlotConfigManager] „Ç´„Çπ„Çø„É†Ë®≠ÂÆö„Çí‰ΩøÁî®: ${e}`,t)):(t=Wf[e]||Wf.memorization,this.debugMode&&j.info(`[SlotConfigManager] „Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„Çí‰ΩøÁî®: ${e}`,t)),t=this.validateAndNormalize(t),this.configCache.set(e,t),t}setSlotConfig(e,t){const s=this.validateAndNormalize(t);this.saveCustomConfig(e,s),this.configCache.set(e,s),this.debugMode&&j.info(`[SlotConfigManager] Ë®≠ÂÆö„Çí‰øùÂ≠ò: ${e}`,s)}resetSlotConfig(e){if(e)this.removeCustomConfig(e),this.configCache.delete(e),this.debugMode&&j.info(`[SlotConfigManager] Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà: ${e}`);else{if(typeof window<"u")for(const t of Object.keys(localStorage))t.startsWith(this.storageKey)&&localStorage.removeItem(t);this.configCache.clear(),this.debugMode&&j.info("[SlotConfigManager] ÂÖ®Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà")}}validateAndNormalize(e){const t={newRatio:Math.max(0,e.newRatio||0),incorrectRatio:Math.max(0,e.incorrectRatio||0),stillLearningRatio:Math.max(0,e.stillLearningRatio||0),masteredRatio:Math.max(0,e.masteredRatio||0),chainLearningRatio:Math.max(0,Math.min(1,e.chainLearningRatio||.3))},s=t.newRatio+t.incorrectRatio+t.stillLearningRatio+t.masteredRatio;return s===0?Wf.memorization:(Math.abs(s-1)>.001&&(t.newRatio/=s,t.incorrectRatio/=s,t.stillLearningRatio/=s,t.masteredRatio/=s,this.debugMode&&j.warn("[SlotConfigManager] ÊØîÁéá„ÅÆÂêàË®à„Åå1.0„Åß„Å™„ÅÑ„Åü„ÇÅÊ≠£Ë¶èÂåñ„Åó„Åæ„Åó„Åü",{before:s.toFixed(3),after:1})),t)}loadCustomConfig(e){if(typeof window>"u")return null;try{const t=`${this.storageKey}-${e}`,s=localStorage.getItem(t);return s?JSON.parse(s):null}catch(t){return j.error("[SlotConfigManager] „Ç´„Çπ„Çø„É†Ë®≠ÂÆö„ÅÆË™≠„ÅøÂèñ„Çä„Å´Â§±Êïó",t),null}}saveCustomConfig(e,t){if(!(typeof window>"u"))try{const s=`${this.storageKey}-${e}`;localStorage.setItem(s,JSON.stringify(t))}catch(s){j.error("[SlotConfigManager] „Ç´„Çπ„Çø„É†Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó",s)}}removeCustomConfig(e){if(!(typeof window>"u"))try{const t=`${this.storageKey}-${e}`;localStorage.removeItem(t)}catch(t){j.error("[SlotConfigManager] „Ç´„Çπ„Çø„É†Ë®≠ÂÆö„ÅÆÂâäÈô§„Å´Â§±Êïó",t)}}}const Sr=class Sr{constructor(){me(this,"classifier");me(this,"positionCalculator");me(this,"configManager");me(this,"debugMode");this.classifier=new lk,this.positionCalculator=new OQ,this.configManager=new uk({debugMode:!1}),this.debugMode=!1}allocateSlots(e){const t=performance.now();let s=e.slotConfig||this.configManager.getSlotConfig(e.mode);e.mode==="memorization"&&(s=this.applyDynamicLimits(s,e.progressMap,e.totalSlots));const r=this.categorizeWords(e.questions,e.progressMap,e.mode),o=this.sortWordsByCategory(r,e.progressMap,e.mode),i=this.calculateSlots(s,e.totalSlots,r),a=this.redistributeSurplus(i,r,e.totalSlots),c=e.useChainLearning?this.selectFromCategoriesWithChaining(o,a,s,e.recentWords||[],e.questions):this.selectFromCategories(o,a),l=this.arrangeQuestions(c,e.questions),d=this.generateStats(i,a,r),h=performance.now()-t;return this.debugMode&&j.info("[SlotAllocator] „Çπ„É≠„ÉÉ„ÉàÂâ≤ÂΩìÂÆå‰∫Ü",{totalSlots:e.totalSlots,allocated:l.length,useChainLearning:e.useChainLearning,processingTime:`${h.toFixed(2)}ms`,stats:d}),{allocatedQuestions:l,stats:d,categoryDetails:this.generateCategoryDetails(a,c)}}categorizeWords(e,t,s){const r={new:[],incorrect:[],still_learning:[],mastered:[]};for(const o of e){const i=o.word,a=t[i];if(!a){r.new.push(i);continue}const c=this.classifier.determineCategory(a,s);r[c].push(i)}return r}sortWordsByCategory(e,t,s){const r={new:[],incorrect:[],still_learning:[],mastered:[]};for(const o of Object.keys(e)){const i=e[o];r[o]=this.positionCalculator.sortByPriority(i,t,o,s)}return r}calculateSlots(e,t,s){return{new:Math.floor(t*e.newRatio),incorrect:Math.floor(t*e.incorrectRatio),still_learning:Math.floor(t*e.stillLearningRatio),mastered:Math.floor(t*e.masteredRatio)}}redistributeSurplus(e,t,s){const r={...e};let o=0;for(const a of Object.keys(r)){const c=r[a],l=t[a].length;l<c&&(o+=c-l,r[a]=l)}if(o===0)return r;const i=["incorrect","still_learning","new","mastered"];for(const a of i){if(o===0)break;const c=r[a],d=t[a].length-c;if(d>0){const h=Math.min(o,d);r[a]+=h,o-=h}}return this.debugMode&&o>0&&j.warn("[SlotAllocator] ‰ΩôÂâ∞„Çπ„É≠„ÉÉ„Éà„ÇíÂÆåÂÖ®„Å´ÂÜçÈÖçÂàÜ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü",{surplus:o,finalSlots:r}),r}selectFromCategories(e,t){const s={new:[],incorrect:[],still_learning:[],mastered:[]};for(const r of Object.keys(e)){const o=e[r],i=t[r];s[r]=o.slice(0,i).map(a=>a.word)}return s}selectFromCategoriesWithChaining(e,t,s,r,o){const i={new:[],incorrect:[],still_learning:[],mastered:[]},a=Bp(o);for(const c of Object.keys(e)){const l=e[c],d=t[c];if(d===0||l.length===0)continue;const h=s.chainLearningRatio||.3,f=Math.floor(d*h),p=d-f,m=[];if(f>0&&r.length>0){const y=this.findRelatedWords(l.map(b=>b.word),r,a,70);m.push(...y.slice(0,f)),this.debugMode&&y.length>0&&j.info(`[SlotAllocator] „ÅÑ„ÇÇ„Å•„ÇãÂÑ™ÂÖà: ${c}`,{chainSlots:f,selected:y.slice(0,f)})}const g=l.filter(y=>!m.includes(y.word)),x=this.selectRegularWithRelatedTieBreak({remainingItems:g,count:p,recentWords:r,strengthLookup:a,window:Sr.REGULAR_TIE_WINDOW,maxDelta:Sr.REGULAR_TIE_MAX_DELTA,minStrength:Sr.REGULAR_TIE_MIN_STRENGTH});m.push(...x.selected),this.debugMode&&x.tieBreakAppliedCount>0&&j.info(`[SlotAllocator] ÈÄöÂ∏∏Êû†„Çø„Ç§„Éñ„É¨„Éº„ÇØÁô∫Âãï: ${c}`,{applied:x.tieBreakAppliedCount,window:Sr.REGULAR_TIE_WINDOW,maxDelta:Sr.REGULAR_TIE_MAX_DELTA,minStrength:Sr.REGULAR_TIE_MIN_STRENGTH}),i[c]=m}return i}selectRegularWithRelatedTieBreak(e){const t=[],s=[...e.remainingItems];let r=0;if(e.count<=0||s.length===0)return{selected:t,tieBreakAppliedCount:r};const o=e.recentWords.length>0&&e.strengthLookup.size>0;for(;t.length<e.count&&s.length>0;){if(!o){t.push(s.shift().word);continue}const i=s[0],a=i.position.positionInCategory,c=s.slice(0,Math.min(e.window,s.length)).filter(p=>a-p.position.positionInCategory<=e.maxDelta);if(c.length<=1){t.push(s.shift().word);continue}const l=p=>{var g;let m=0;for(const x of e.recentWords){const y=((g=e.strengthLookup.get(x))==null?void 0:g.get(p))||0;y>m&&(m=y)}return m},d=l(i.word);let h=0,f=d;for(let p=1;p<c.length;p++){const m=l(c[p].word);m>f&&(f=m,h=p)}if(h>0&&f>=e.minStrength&&f>d){const p=c[h].word,m=s.findIndex(g=>g.word===p);if(m>=0){s.splice(m,1),t.push(p),r+=1;continue}}t.push(s.shift().word)}return{selected:t,tieBreakAppliedCount:r}}findRelatedWords(e,t,s,r){var i;const o=[];for(const a of e){let c=0;for(const l of t){const d=((i=s.get(l))==null?void 0:i.get(a))||0;d>c&&(c=d)}c>=r&&o.push({word:a,maxStrength:c})}return o.sort((a,c)=>c.maxStrength-a.maxStrength).map(a=>a.word)}arrangeQuestions(e,t){const s=new Map;for(const c of t)s.set(c.word,c);const r=[],o=["incorrect","still_learning","new","mastered"],i={incorrect:0,still_learning:0,new:0,mastered:0};let a=!0;for(;a;){a=!1;for(const c of o){const l=e[c],d=i[c];if(d<l.length){const h=l[d],f=s.get(h);f&&r.push(f),i[c]++,a=!0}}}return r}generateStats(e,t,s){const r={new:s.new.length,incorrect:s.incorrect.length,still_learning:s.still_learning.length,mastered:s.mastered.length},o=Object.values(t).reduce((l,d)=>l+d,0),a=Object.values(r).reduce((l,d)=>l+d,0)-o,c=Object.keys(t).some(l=>{const d=l;return r[d]<e[d]});return{counts:r,allocatedSlots:t,surplusSlots:a,hasShortage:c}}generateCategoryDetails(e,t){const s={};for(const r of Object.keys(e))s[r]={requested:e[r],allocated:t[r].length,words:t[r]};return s}applyDynamicLimits(e,t,s){const r=(()=>{try{const c=localStorage.getItem("memorization-review-ratio-limit");return c?parseInt(c)/100:.2}catch{return .2}})(),o=Object.values(t).filter(c=>{const l=this.classifier.determineCategory(c,"memorization");return l==="incorrect"||l==="still_learning"}).length,i=s>0?o/s:0;if(i<r)return this.debugMode&&j.info("[SlotAllocator] ÂãïÁöÑ‰∏äÈôê: Êú™Âà∞ÈÅî",{reviewWordCount:o,totalSlots:s,reviewRatio:`${(i*100).toFixed(1)}%`,reviewLimitRatio:`${(r*100).toFixed(1)}%`}),e;const a={...e,incorrectRatio:.2,stillLearningRatio:.2,newRatio:.3,masteredRatio:.1};return this.debugMode&&j.info("[SlotAllocator] ÂãïÁöÑ‰∏äÈôê: Âà∞ÈÅî ‚Üí ÈÖçÂàÜÂ§âÊõ¥",{reviewWordCount:o,totalSlots:s,reviewRatio:`${(i*100).toFixed(1)}%`,reviewLimitRatio:`${(r*100).toFixed(1)}%`,before:{incorrect:`${(e.incorrectRatio*100).toFixed(0)}%`,stillLearning:`${(e.stillLearningRatio*100).toFixed(0)}%`,new:`${(e.newRatio*100).toFixed(0)}%`},after:{incorrect:"20%",stillLearning:"20%",new:"30%"}}),a}};me(Sr,"REGULAR_TIE_WINDOW",8),me(Sr,"REGULAR_TIE_MAX_DELTA",3),me(Sr,"REGULAR_TIE_MIN_STRENGTH",40);let Vp=Sr;class $s{constructor(){me(this,"antiVibration");me(this,"recentAnswersCache",new Map);me(this,"aiCoordinator");me(this,"slotAllocator");me(this,"batchManager",null);me(this,"lastProgressDataFetch",0);me(this,"cachedProgressData",null);me(this,"incorrectSkipQueue",[]);me(this,"skipCounter",0);me(this,"skipTarget",0);this.antiVibration=new I$,this.aiCoordinator=new aQ({debugMode:!1}),this.slotAllocator=new Vp}static get isVerboseDebug(){return!1}static getProgressMapFromParams(e){return e.progressOverride?e.progressOverride:nt().wordProgress||{}}getDependencies(){return{antiVibration:this.antiVibration,aiCoordinator:this.aiCoordinator,slotAllocator:this.slotAllocator,batchManager:this.batchManager,scheduler:this}}getRandomSkipCount(){const e=Math.random();return e<.4?2:e<.7?3:e<.9?4:5}async schedule(e){var l;const t=performance.now();if(dd.isEnabled()){this.batchManager||(this.batchManager=new dd);const d=Date.now(),h=e.progressOverride?e.progressOverride:((!this.cachedProgressData||d-this.lastProgressDataFetch>5e3)&&(this.cachedProgressData=nt().wordProgress||{},this.lastProgressDataFetch=d),this.cachedProgressData);this.batchManager.initialize(e.questions,{batchSize:100,clearThreshold:.7,mode:e.mode,reset:!1});const f=this.batchManager.getActiveWords(),p=(l=e.sessionStats)!=null&&l.correct?e.sessionStats.correct%50===0:!1;p&&this.batchManager.checkAndAddNextBatch(h)&&localStorage.getItem("debug-batch-mode")==="true"&&j.info("[QuestionScheduler] Ê¨°„Éê„ÉÉ„ÉÅ„ÅåËøΩÂä†„Åï„Çå„Åæ„Åó„Åü");const m=new Set(f);if(e={...e,questions:e.questions.filter(g=>m.has(g.word))},p&&localStorage.getItem("debug-batch-mode")==="true"){const g=this.batchManager.getStatus(h);j.info("[QuestionScheduler] „Éê„ÉÉ„ÉÅ„Çπ„ÉÜ„Éº„Çø„Çπ",{currentBatch:g.currentBatch,activeCount:g.activeCount,clearedCount:g.clearedCount,clearRate:`${(g.clearRate*100).toFixed(1)}%`})}}typeof e.useChainLearning!="boolean"&&(e={...e,useChainLearning:ck().isFeatureEnabled("chain_learning_retention_2025_01","useChainLearning")});const s={timestamp:new Date().toISOString(),mode:e.mode,questionCount:e.questions.length,hybridMode:e.hybridMode||!1,useChainLearning:e.useChainLearning,firstQuestions:e.questions.slice(0,10).map(d=>d.word)};try{const d=JSON.parse(localStorage.getItem("debug_scheduler_calls")||"[]");d.push(s),d.length>10&&d.shift(),$s.isVerboseDebug}catch{}if(this.skipCounter>=this.skipTarget&&this.incorrectSkipQueue.length>0){const d=this.incorrectSkipQueue.shift();this.skipCounter=0,this.skipTarget=0;const h=e.questions.filter(f=>f.word!==d.question.word);return this.schedule({...e,questions:[d.question,...h]})}if(this.skipTarget>0&&this.skipCounter++,e.useCategorySlots){console.log("üéØ [QuestionScheduler] „Ç´„ÉÜ„Ç¥„É™„Éº„Çπ„É≠„ÉÉ„ÉàÊñπÂºè„ÇíÈñãÂßã„Åó„Åæ„Åô",{mode:e.mode,questionsCount:e.questions.length,timestamp:new Date().toISOString()});try{const d=await this.scheduleCategorySlots(e,t);return console.log("‚úÖ [QuestionScheduler] „Ç´„ÉÜ„Ç¥„É™„Éº„Çπ„É≠„ÉÉ„ÉàÊñπÂºè„ÅåÊ≠£Â∏∏„Å´ÂÆå‰∫Ü„Åó„Åæ„Åó„Åü",{mode:e.mode,resultSize:d.scheduledQuestions.length,processingTime:`${d.processingTime.toFixed(2)}ms`}),d}catch(d){console.error("‚ùå [QuestionScheduler] „Ç´„ÉÜ„Ç¥„É™„Éº„Çπ„É≠„ÉÉ„ÉàÊñπÂºè„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:",d),j.warn("[QuestionScheduler] „Ç´„ÉÜ„Ç¥„É™„Éº„Çπ„É≠„ÉÉ„ÉàÊñπÂºè„Å´Â§±Êïó„Åó„Åü„Åü„ÇÅ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Åó„Åæ„Åô",{mode:e.mode,error:String(d)})}}if(e.hybridMode){const d=await On(()=>import("./HybridScheduleStrategy-BK2kzOV8.js"),__vite__mapDeps([0,1,2,3])).then(f=>f.HybridScheduleStrategy);return new d(this.getDependencies()).schedule({params:e,startTime:t,dependencies:this.getDependencies(),progressData:$s.getProgressMapFromParams(e)})}if(e.finalPriorityMode){const d=await On(()=>import("./FinalPriorityScheduleStrategy-Dd7FKAyF.js"),__vite__mapDeps([4,1,2,3])).then(f=>f.FinalPriorityScheduleStrategy);return new d(this.getDependencies()).schedule({params:e,startTime:t,dependencies:this.getDependencies(),progressData:$s.getProgressMapFromParams(e)})}const{DefaultScheduleStrategy:r}=await On(async()=>{const{DefaultScheduleStrategy:d}=await import("./DefaultScheduleStrategy-CnBVq84Z.js");return{DefaultScheduleStrategy:d}},__vite__mapDeps([5,1,2,3])),i=await new r(this.getDependencies()).schedule({params:e,startTime:t,dependencies:this.getDependencies(),progressData:$s.getProgressMapFromParams(e)}),a=i.scheduledQuestions,c=this.buildContext(e);if(a.length>0&&c.recentAnswers.length>0){const d=a[0],h=c.recentAnswers.find(f=>f.word===d.word);if(h&&!h.correct&&!this.incorrectSkipQueue.some(p=>p.question.word===d.word)){this.incorrectSkipQueue.push({question:d,position:100,status:null}),this.skipTarget=this.getRandomSkipCount(),this.skipCounter=0;const p=a.slice(1);if(p.length>0){const m=i.debug??{dtaApplied:0,antiVibrationApplied:0,signalsDetected:[]};return{...i,scheduledQuestions:p,debug:{...m,randomSkipApplied:!0}}}}}return i}buildContext(e){return mo.buildContext(e,this)}detectSignals(e){return mo.detectSignals(e)}calculatePriorities(e,t,s,r=!1){this.recordFunctionCall("calculatePriorities",{questionsCount:e.length,hybridMode:r});const o=this.loadProgressCache(),i=this.calculateDifficultyAdaptation(o),a=e.map((l,d)=>{const h=this.getWordStatusFromCache(l.word,t.mode,o);if(r){const p=d/e.length*100;return{question:l,position:p,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}}let f=(h==null?void 0:h.position)||35;return f=this.applyDifficultyAdaptation(f,l,i),{question:l,position:f,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}});return this.applyInterleavingAdjustment(a,t.mode,e.length)}applyInterleavingAdjustment(e,t,s){this.recordFunctionCall("applyInterleavingAdjustment",{prioritizedCount:e.length,mode:t,questionsCount:s});const r=new Po;e.filter(h=>h.position>=40&&h.position<70&&(h.attempts??0)>0).length,e.filter(h=>h.position>=70).length,e.filter(h=>h.position<40).length,e.filter(h=>h.position>=25&&h.position<40&&(h.attempts??0)===0).length;const{result:o,changed:i}=r.boostStillLearningQuestions(e),{result:a,changed:c}=r.adjustPositionForInterleaving(o);a.filter(h=>h.position>=40&&h.position<70&&(h.attempts??0)>0).length,a.filter(h=>h.position>=70).length,a.filter(h=>h.position<40).length,a.filter(h=>h.position>=25&&h.position<40&&(h.attempts??0)===0).length,a.filter(h=>h.position>=40&&h.position<70&&(h.attempts??0)>0&&h.position>=60&&h.position<70).length,a.filter(h=>h.position>=40&&(h.attempts??0)===0&&h.position>=40&&h.position<60).length,a.filter(h=>{const f=(h.attempts??0)===0,p=(h.attempts??0)>0&&h.position>=40&&h.position<70;return f&&h.position>=60||p&&h.position<60});const{result:l,changed:d}=r.boostStillLearningQuestions(a);return l}recordFunctionCall(e,t){try{const s=localStorage.getItem("debug_function_calls"),r=s?JSON.parse(s):[];r.push({timestamp:new Date().toISOString(),function:e,params:t}),r.length>30&&r.shift(),$s.isVerboseDebug}catch{}}calculateForgettingRisk(e){if(e.lastStudied===0)return 0;const t=(Date.now()-e.lastStudied)/(1e3*60*60*24);let r=(e.reviewInterval>0?t/e.reviewInterval:0)*100;return e.accuracy<50?r*=1.5:e.accuracy>=80&&(r*=.7),Math.round(Math.min(r,200))}applySignals(e,t,s){if(t.length===0)return e;let r=e;for(const o of t)switch(o.type){case"fatigue":e>8&&(r*=1-o.confidence*.2);break;case"struggling":e<2&&(r*=1-o.confidence*.3);break;case"overlearning":e>=3&&e<=5&&(r*=1-o.confidence*.15);break}return r}loadProgressCache(){return mo.loadProgressCache()}getWordStatusFromCache(e,t,s){return mo.getWordStatusFromCache(e,t,s)}getWordStatus(e,t){var s;try{const o=(s=nt().wordProgress)==null?void 0:s[e];if(!o)return null;const a=new zs(t).calculate(o),c=zs.categoryOf(a);let l=0,d=0;switch(t){case"memorization":l=o.memorizationAttempts||0,d=o.memorizationCorrect||0;break;case"translation":l=o.translationAttempts||0,d=o.translationCorrect||0;break;case"spelling":l=o.spellingAttempts||0,d=o.spellingCorrect||0;break;case"grammar":l=o.grammarAttempts||0,d=o.grammarCorrect||0;break;default:l=(o.correctCount||0)+(o.incorrectCount||0),d=o.correctCount||0}const h={category:c,position:a,lastStudied:o.lastStudied||0,attempts:l,correct:d,streak:o.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1};return Zb(c)&&j.debug(`[WordStatus] ${e}: ${c} (position=${a}, attempts=${h.attempts}, consecutiveIncorrect=${o.consecutiveIncorrect||0})`),h}catch(r){return j.error("[QuestionScheduler] Â≠¶ÁøíÁä∂Ê≥Å„ÅÆÂèñÂæó„Å´Â§±Êïó",r),null}}applyAntiVibration(e,t){return mo.applyAntiVibration(e,t,this)}applyLearningLimits(e,t,s){return e}sortAndBalance(e,t,s){this.recordFunctionCall("sortAndBalance",{questionsCount:e.length});const r=e.filter(h=>h.position>=70),o=e.filter(h=>h.position>=40&&h.position<70),i=e.filter(h=>h.position<40);e.reduce((h,f)=>{var m;const p=((m=f.status)==null?void 0:m.category)||"null";return h[p]=(h[p]||0)+1,h},{}).null,e.length;const c=(h,f)=>h.position!==f.position?f.position-h.position:(h.originalIndex||0)-(f.originalIndex||0);r.sort(c),o.sort(c),i.sort(c);const l=[...e].sort((h,f)=>h.position!==f.position?f.position-h.position:(h.originalIndex||0)-(f.originalIndex||0)),d=new Po().interleaveByCategory(l);try{const h=d.slice(0,30).map(x=>{var y,b;return{word:x.question.word,position:x.position,category:(y=x.status)==null?void 0:y.category,attempts:x.attempts??((b=x.status)==null?void 0:b.attempts)??0}});$s.isVerboseDebug;const p=d.slice(0,100).map((x,y)=>{var b,w;return{rank:y+1,word:x.question.word,position:x.position,category:(b=x.status)==null?void 0:b.category,attempts:x.attempts??((w=x.status)==null?void 0:w.attempts)??0}}).filter(x=>x.position>=40&&x.position<70&&x.attempts>0),g=d.slice(0,600).map((x,y)=>{var b;return{rank:y+1,word:x.question.word,position:x.position,attempts:x.attempts??((b=x.status)==null?void 0:b.attempts)??0}}).filter(x=>x.position>=40&&x.position<70&&x.attempts>0);$s.isVerboseDebug}catch{}return t.useChainLearning?this.applyChainLearningWithinTopN(d,t):d}applyChainLearningWithinTopN(e,t){const s=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),o=Math.min(80,e.length);if(o<=2)return e;ik(t.questions),_Q(t.questions);const i=Bp(t.questions),a=e.slice(0,o),c=e.slice(o),l=y=>Math.floor(y.position/10),d=(y,b)=>{var S,C;const w=((S=i.get(y))==null?void 0:S.get(b))??0,v=((C=i.get(b))==null?void 0:C.get(y))??0;return Math.max(w,v)},h=[];let f=0;const p=new Set;let m=!1;for(;f<a.length;){const y=l(a[f]);p.add(y);let b=f+1;for(;b<a.length&&l(a[b])===y;)b++;const w=a.slice(f,b);if(w.length<=2){h.push(...w),f=b;continue}const v=w.slice(1),S=[w[0]];let C=0;for(;v.length>0;){const k=S[S.length-1].question.word;let I=0,A=-1;for(let T=0;T<v.length;T++){const E=v[T].question.word,$=d(k,E);$>A&&(A=$,I=T)}C+=Math.max(0,A),S.push(v.splice(I,1)[0])}C===0?h.push(...w):(m=!0,h.push(...S)),f=b}const g=[...h,...c],x=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();return AQ({ms:x-s,topCount:o,buckets:p.size,usedReorder:m}),g}postProcess(e,t){const s=e.map(o=>({...o.question,position:o.position,finalPriority:o.finalPriority})),r=!0;try{const o=e.slice(0,30).map(a=>{var c;return{word:a.question.word,position:a.position??0,attempts:((c=a.status)==null?void 0:c.attempts)??0}}),i={timestamp:new Date().toISOString(),mode:t.mode,isInterleavedAcrossBands:r,action:r?"skipped_contextual_reorder":"applied_contextual_reorder",top30:o};O$("debug_postProcess_meta",i,{mode:t.mode})}catch{}return s}splitByPositionBands(e,t){const s=[{range:"70-100 (incorrect)",min:70,max:100,questions:[]},{range:"60-69 (still_learning)",min:60,max:69,questions:[]},{range:"40-59 (new boosted)",min:40,max:59,questions:[]},{range:"20-39 (new normal)",min:20,max:39,questions:[]},{range:"0-19 (mastered)",min:0,max:19,questions:[]}];return e.forEach(r=>{const o=r.position;for(const i of s)if(o>=i.min&&o<=i.max){i.questions.push(r);break}}),s.filter(r=>r.questions.length>0)}getRecentlyStudiedWords(e){const t=[],s=Date.now(),r=5*60*1e3;for(const[o,i]of Object.entries(e.wordProgress)){const a=i==null?void 0:i.lastStudied;a&&s-new Date(a).getTime()<r&&t.push(o)}return t.slice(-20)}clearCache(){this.recentAnswersCache.clear(),j.info("[QuestionScheduler] „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü")}getWordProgress(e){var t;try{return((t=nt().wordProgress)==null?void 0:t[e])||null}catch{return null}}getAllProgress(){try{return nt().wordProgress||{}}catch{return{}}}convertToAISessionStats(e){return{totalAttempts:e.correct+e.incorrect+e.still_learning,correctAnswers:e.correct||0,incorrectAnswers:e.incorrect||0,stillLearningAnswers:e.still_learning||0,sessionStartTime:Date.now()-(e.duration||0),sessionDuration:e.duration||0,avgResponseTime:e.avgResponseTime,consecutiveIncorrect:e.consecutiveIncorrect||0,masteredCount:e.masteredCount||0,stillLearningCount:e.still_learningCount||0,incorrectCount:e.incorrectCount||0,newCount:e.newCount||0}}recalculatePriorityAfterAnswer(e,t,s="memorization"){const r=(()=>{switch(s){case"memorization":return t.memorizationPosition??50;case"translation":return t.translationPosition??50;case"spelling":return t.spellingPosition??50;case"grammar":return t.grammarPosition??50;default:return 50}})(),o=this.determinePositionAfterAnswer(t,s);zs.categoryOf(o);const i=t.correctCount+t.incorrectCount;t.accuracyRate=i>0?t.correctCount/i:0;let a=0,c=0,l=0;switch(s){case"memorization":a=t.memorizationAttempts||0,c=t.memorizationCorrect||0,l=t.memorizationStillLearning||0;break;case"translation":a=t.translationAttempts||0,c=t.translationCorrect||0;break;case"spelling":a=t.spellingAttempts||0,c=t.spellingCorrect||0;break;case"grammar":a=t.grammarAttempts||0,c=t.grammarCorrect||0;break}try{const d={timestamp:new Date().toISOString(),word:e,mode:s,positionBefore:r,positionAfter:o,progress:{correctCount:t.correctCount,incorrectCount:t.incorrectCount,consecutiveCorrect:t.consecutiveCorrect||0,consecutiveIncorrect:t.consecutiveIncorrect||0,accuracy:t.accuracyRate||0,modeAttempts:a,modeCorrect:c,modeStillLearning:l}},h=localStorage.getItem("debug_answer_logs"),f=h?JSON.parse(h):[];f.push(d),f.length>20&&f.shift(),$s.isVerboseDebug}catch{}return o}calculateAIEvaluations(e,t,s){const r=e.correctCount+e.incorrectCount,o=r>0?e.correctCount/r:0,i=e.consecutiveCorrect||0,a=e.consecutiveIncorrect||0,c=new zI,l=new WI,d=new BI,h=new UI,f=new GI,p=new VI,m=new Po;return{memory:c.proposePosition(e,"",s,o,r),cognitiveLoad:l.proposePosition(e,a),errorPrediction:d.proposePosition(e,o,r),linguistic:h.proposePosition(e,o),contextual:f.proposePosition(e,s),learningStyle:p.proposePosition(e,o,r),gamification:m.proposePosition(e,i,o)}}recordAIEvaluation(e,t){try{const s="debug_ai_evaluations",r=localStorage.getItem(s),o=r?JSON.parse(r):{};o[e]={...t,word:e};const i=Object.entries(o);if(i.length>100){const d=Object.fromEntries(i.slice(-100));localStorage.setItem(s,JSON.stringify(d))}else localStorage.setItem(s,JSON.stringify(o));const a=(t==null?void 0:t.aiEvaluations)??(t==null?void 0:t.aiProposals)??{},c=Object.values(a).map(d=>Number(d).toFixed(1)).join("/"),l=Number((t==null?void 0:t.finalPriority)??(t==null?void 0:t.position)??0);console.log(`ü§ñ [AIË©ï‰æ°] ${e}: ${l.toFixed(1)}[${c}] (${(t==null?void 0:t.category)??"n/a"})`)}catch{}}determinePosition(e,t="memorization"){return new zs(t).calculate(e)}determinePositionAfterAnswer(e,t="memorization"){return new zs(t).calculate(e,{ignoreSaved:!0})}enforceCompletionRequirement(e){return e>=70?100:e>=40?75:e<20?10:50}calculateDifficultyAdaptation(e){if(!e||!e.wordProgress)return{beginner:70,intermediate:60,advanced:50,shouldPrioritizeBeginner:!1,priorityBoost:0};const t=Object.values(e.wordProgress||{}),s={beginner:{correct:0,total:0},intermediate:{correct:0,total:0},advanced:{correct:0,total:0}};t.forEach(a=>{const l={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[a.difficulty];if(l&&s[l]){const d=(a.correctCount||0)+(a.incorrectCount||0);s[l].total+=d,s[l].correct+=a.correctCount||0}});const r={beginner:s.beginner.total>0?s.beginner.correct/s.beginner.total*100:70,intermediate:s.intermediate.total>0?s.intermediate.correct/s.intermediate.total*100:60,advanced:s.advanced.total>0?s.advanced.correct/s.advanced.total*100:50},o=r.intermediate<60||r.advanced<50;let i=0;if(o){const a=Math.max(0,60-r.intermediate),c=Math.max(0,50-r.advanced);i=Math.min(20,(a+c)/2)}return{...r,shouldPrioritizeBeginner:o,priorityBoost:i}}applyDifficultyAdaptation(e,t,s){if(!s.shouldPrioritizeBeginner)return e;const o={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[t.difficulty];return o?o==="beginner"?Math.max(0,e-s.priorityBoost):o==="intermediate"||o==="advanced"?Math.min(100,e+Math.min(10,s.priorityBoost/2)):e:e}sortByNewWordsFirst(e,t,s){const r=y=>{const b=[...y];for(let w=b.length-1;w>0;w--){const v=Math.floor(Math.random()*(w+1));[b[w],b[v]]=[b[v],b[w]]}return b},o=r(e.filter(y=>(y.attempts??0)===0&&y.position>=20)),i=r(e.filter(y=>y.position>=70)),a=r(e.filter(y=>y.position>=40&&y.position<70&&(y.attempts??0)>0)),c=r(e.filter(y=>y.position<20)),l=e.length,d=Math.random()*.15+.15,h=Math.floor(l*d),f=i.slice(0,h),p=i.slice(h),m=[],g=[...o],x=[...f];for(;g.length>0||x.length>0;){const y=Math.floor(Math.random()*3)+3;for(let b=0;b<y&&g.length>0;b++)m.push(g.shift());x.length>0&&m.push(x.shift())}return m.push(...p),m.push(...a),m.push(...c),m}async scheduleCategorySlots(e,t){const s=$s.getProgressMapFromParams(e),r=new zs(e.mode),o=this.getRecentWords(e,10),i=new Set(o),a=E=>{switch(E){case"incorrect":return 70;case"still_learning":return 40;case"new":return 20;case"mastered":return 0;default:return 0}},c=e.questions.map(E=>{const $=s[E.word],D=$?r.calculate($):35,M=zs.categoryOf(D);let P=D;return i.has(E.word)&&(P=Math.max(a(M),D-30)),{question:E,position:P,category:M}}),l={incorrect:c.filter(E=>E.category==="incorrect"),still_learning:c.filter(E=>E.category==="still_learning"),new:c.filter(E=>E.category==="new"),mastered:c.filter(E=>E.category==="mastered")};Object.keys(l).forEach(E=>{l[E].sort(($,D)=>D.position-$.position)});const d=e.batchSize?Math.min(e.questions.length,e.batchSize):Math.min(e.questions.length,100),h=l.incorrect.length,f=l.still_learning.length,p=l.new.length,m=l.mastered.length,g=new uk({debugMode:!1}).getSlotConfig(e.mode),x={incorrect:Math.min(h,Math.floor(d*g.incorrectRatio)),still_learning:Math.min(f,Math.floor(d*g.stillLearningRatio)),mastered:Math.min(m,Math.floor(d*g.masteredRatio)),new:0};let y=d-(x.incorrect+x.still_learning+x.mastered);if(y<0&&(y=0),x.new=Math.min(p,y),y-=x.new,y>0){const E=($,D)=>{if(y<=0)return;const M=Math.max(0,D-x[$]);if(M<=0)return;const P=Math.min(y,M);x[$]+=P,y-=P};E("incorrect",h),E("still_learning",f),E("mastered",m),E("new",p)}const b=E=>{if(!e.useChainLearning||E.length<=2)return E;const $=Bp(e.questions),D=(L,O)=>{var G,_;const F=((G=$.get(L))==null?void 0:G.get(O))??0,V=((_=$.get(O))==null?void 0:_.get(L))??0;return Math.max(F,V)},M=new Map;E.forEach(L=>{const O=Math.floor(L.position/10);M.has(O)||M.set(O,[]),M.get(O).push(L)});const P=[];return M.forEach(L=>{if(L.length<=1){P.push(...L);return}const O=[...L],F=[O.shift()];for(;O.length>0;){const V=F[F.length-1];let G=0,_=D(V.question.word,O[0].question.word);for(let Z=1;Z<O.length;Z++){const te=D(V.question.word,O[Z].question.word);te>_&&(_=te,G=Z)}F.push(O[G]),O.splice(G,1)}P.push(...F)}),P},w=E=>{const $=new Set;return E.filter(D=>$.has(D.question.word)?!1:($.add(D.question.word),!0))},v={incorrect:b(w(l.incorrect.slice(0,x.incorrect).sort((E,$)=>$.position-E.position))),still_learning:b(w(l.still_learning.slice(0,x.still_learning).sort((E,$)=>$.position-E.position))),new:b(w(l.new.slice(0,x.new).sort((E,$)=>$.position-E.position))),mastered:b(w(l.mastered.slice(0,x.mastered).sort((E,$)=>$.position-E.position)))},S=[...v.incorrect.map(E=>{var $;return{position:E.position,attempts:((($=s[E.question.word])==null?void 0:$.memorizationAttempts)??0)>0?1:0,question:E.question}}),...v.still_learning.map(E=>{var $;return{position:E.position,attempts:((($=s[E.question.word])==null?void 0:$.memorizationAttempts)??0)>0?1:0,question:E.question}}),...v.new.map(E=>({position:E.position,attempts:0,question:E.question})),...v.mastered.map(E=>{var $;return{position:E.position,attempts:((($=s[E.question.word])==null?void 0:$.memorizationAttempts)??0)>0?1:0,question:E.question}})],k=new Po().interleaveByCategory(S),I=new Set,A=k.map(E=>E.question).filter(E=>I.has(E.word)?!1:(I.add(E.word),!0));A.length,x.incorrect,x.still_learning,x.new,x.mastered,e.useChainLearning,k.length-A.length;const T=performance.now()-t;return{scheduledQuestions:A,vibrationScore:0,processingTime:T,signalCount:0}}getRecentWords(e,t=10){const s=mo.buildContext(e,this).recentAnswers,r=[],o=new Set;for(const i of s)if(!o.has(i.word)&&(o.add(i.word),r.push(i.word),r.length>=t))break;return r}}const Eo=2;function V0(n){return typeof n!="number"||!Number.isFinite(n)?null:n}function dk(n,e){const t=e??V0(n.schemaVersion)??0;if(t>Eo)return{status:"too_new",storedVersion:t,supportedVersion:Eo,notes:["Stored progress schema is newer than this app supports; skipping migration/save"],progress:n};let s=!1;const r=[];if(t<1&&r.push("Set schemaVersion (v0 -> v1)"),t<2){const o={},i=new Map;for(const a of n.results||[]){if(!a||typeof a!="object")continue;const c=a.mode,l=a.questionSetId,d=a.percentage,h=a.date,f=a.timeSpent;if(!c||!l)continue;const p=`${c}:${l}`;o[p]||(o[p]={attempts:0,bestScore:0,averageScore:0,lastAttempt:0,totalTimeSpent:0});const m=o[p];if(m.attempts++,typeof d=="number"&&Number.isFinite(d)){m.bestScore=Math.max(m.bestScore,d);const g=i.get(p)||{sum:0,count:0};g.sum+=d,g.count+=1,i.set(p,g)}typeof h=="number"&&Number.isFinite(h)&&(m.lastAttempt=Math.max(m.lastAttempt,h)),typeof f=="number"&&Number.isFinite(f)&&(m.totalTimeSpent+=f)}for(const[a,c]of i.entries())o[a]&&(o[a].averageScore=c.count>0?c.sum/c.count:0);n.questionSetStats=o,s=!0,r.push("Migrate questionSetStats keying to mode:questionSetId (v1 -> v2)")}return n.schemaVersion!==Eo&&(n.schemaVersion=Eo,s=!0),(!n.wordProgress||typeof n.wordProgress!="object")&&(n.wordProgress={},s=!0,r.push("Initialize missing wordProgress")),(!n.results||!Array.isArray(n.results))&&(n.results=[],s=!0,r.push("Initialize missing results")),(!n.questionSetStats||typeof n.questionSetStats!="object")&&(n.questionSetStats={},s=!0,r.push("Initialize missing questionSetStats")),{status:"ok",fromVersion:t,toVersion:Eo,didMigrate:s,notes:r,progress:n}}const xb={maxReviewCount:10};function U0(){try{const n=localStorage.getItem("study-settings");if(n)return{maxReviewCount:JSON.parse(n).maxReviewCount??xb.maxReviewCount}}catch(n){j.error("Â≠¶ÁøíË®≠ÂÆö„ÅÆÂèñÂæó„Ç®„É©„Éº:",n)}return{...xb}}const LQ="session-history",zQ=50;async function _a(n,e){const t=Cd()&&Nd();try{if(t)await $r($n.SESSION_HISTORY,{mode:e,status:n.status,word:n.word,timestamp:n.timestamp});else{const s=`${LQ}-${e}`,r=localStorage.getItem(s),o=r?JSON.parse(r):[];o.push(n),o.length>zQ&&o.shift(),localStorage.setItem(s,JSON.stringify(o))}}catch(s){j.error("„Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",s)}}function hd(){const n=nt(),e=new Date().toLocaleDateString("ja-JP"),t=new Set;return n.results.forEach(s=>{new Date(s.date).toLocaleDateString("ja-JP")===e&&s.incorrectWords.forEach(r=>t.add(r))}),Array.from(t)}function fd(n){const e=nt(),t=new Date().setHours(0,0,0,0),s=t+24*60*60*1e3;let r=e.results.filter(c=>c.date>=t&&c.date<s);n&&(r=r.filter(c=>c.mode===n));const o=r.reduce((c,l)=>c+l.score,0),i=r.reduce((c,l)=>c+l.total,0),a=i>0?Math.round(o/i*100):0;return{todayCorrectCount:o,todayTotalAnswered:i,todayAccuracy:a}}function G0(){const n=nt(),e=new Date,t=e.getDay(),s=t===0?-6:1-t,r=new Date(e);r.setDate(e.getDate()+s),r.setHours(0,0,0,0);const o=new Date(r);o.setDate(r.getDate()+7);const i=new Date(r);i.setDate(r.getDate()-7);const a=new Date(r),c=n.results.filter(b=>b.date>=r.getTime()&&b.date<o.getTime()),l=n.results.filter(b=>b.date>=i.getTime()&&b.date<a.getTime()),d=new Set;c.forEach(b=>{const w=new Date(b.date).toISOString().split("T")[0];d.add(w)});const h=c.reduce((b,w)=>b+w.total,0),f=c.reduce((b,w)=>b+w.score,0),p=h>0?f/h*100:0,m=l.reduce((b,w)=>b+w.total,0),g=l.reduce((b,w)=>b+w.score,0),x=m>0?g/m*100:0;let y=0;return Object.values(n.wordProgress).forEach(b=>{b.masteryLevel==="mastered"&&b.lastStudied>=r.getTime()&&y++}),{studyDays:d.size,totalDays:7,totalAnswered:h,accuracy:p,newMastered:y,previousWeekAccuracy:x}}function H0(){const n=nt(),e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const s=new Date(e.getFullYear(),e.getMonth()+1,0);s.setHours(23,59,59,999);const r=n.results.filter(h=>h.date>=t.getTime()&&h.date<=s.getTime()),o=new Set;r.forEach(h=>{const f=new Date(h.date).toISOString().split("T")[0];o.add(f)});const i=r.reduce((h,f)=>h+f.total,0),a=r.reduce((h,f)=>h+f.score,0),c=i>0?a/i*100:0;let l=0;Object.values(n.wordProgress).forEach(h=>{h.masteryLevel==="mastered"&&h.lastStudied>=t.getTime()&&l++});const d=s.getDate();return{studyDays:o.size,totalDays:d,totalAnswered:i,accuracy:c,newMastered:l}}function pd(){const n=nt(),e=Object.values(n.wordProgress),t=e.filter(d=>(d.totalAttempts||0)>0);let s=0,r=0,o=0;const i=t.slice(0,Math.min(500,t.length)),a=t.length/i.length;i.forEach(d=>{const h=Jt(d);h<40?s++:h>=40&&h<70?r++:h>=70&&o++}),s=Math.round(s*a),r=Math.round(r*a),o=Math.round(o*a);const c=t.length,l=s*1+r*.5;return{totalWords:e.length,appearedWords:c,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:c>0?Math.round(s/c*100):0,weightedRetentionRate:c>0?Math.round(l/c*100):0,masteredPercentage:c>0?Math.round(s/c*100):0,learningPercentage:c>0?Math.round(r/c*100):0,strugglingPercentage:c>0?Math.round(o/c*100):0,masteredWords:s,learningWords:r,newWords:e.length-c,retentionRate:c>0?Math.round(s/c*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function hk(){const n=nt();let e=0,t=0,s=0,r=0,o=0;return Object.values(n.wordProgress).forEach(i=>{const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=Jt(i);if(c<20){i.consecutiveCorrect>=7?o++:i.consecutiveCorrect>=5&&r++;return}if(c>=40){t++;const{consecutiveCorrect:l}=i,d=i.correctCount/a;l===2||d>=.9&&l===1&&a>=2||a>=4&&d>=.75?(e++,s+=1):s+=Math.max(1,3-l)}}),{nearMasteryCount:e,learningCount:t,averageRemainingAnswers:t>0?Math.round(s/t*10)/10:0,longTermMemoryCount:r,superMemoryCount:o}}function q0(n=7,e=10){const t=nt(),s=Date.now()-n*24*60*60*1e3;return Object.entries(t.wordProgress).filter(([o,i])=>i.masteryLevel==="mastered"&&i.lastStudied>=s).map(([o,i])=>({word:o,masteredDate:i.lastStudied,totalAttempts:i.correctCount+i.incorrectCount})).sort((o,i)=>i.masteredDate-o.masteredDate).slice(0,e)}function md(){const n=nt(),t=Object.values(n.wordProgress).filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.word.startsWith("grammar_")||l.word.includes("_g")),s=t.filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.correctCount+l.incorrectCount>0);let r=0,o=0,i=0;s.forEach(l=>{const d=l.grammarAttempts||l.correctCount+l.incorrectCount,h=l.grammarCorrect||l.correctCount,f=l.grammarStreak||l.consecutiveCorrect,p=d>0?h/d*100:0;d===1&&h===1||f>=3||f>=2&&p>=80?r++:p>=50?o++:i++});const a=s.length,c=r*1+o*.5;return{totalWords:t.length,appearedWords:a,masteredCount:r,learningCount:o,strugglingCount:i,basicRetentionRate:a>0?Math.round(r/a*100):0,weightedRetentionRate:a>0?Math.round(c/a*100):0,masteredPercentage:a>0?Math.round(r/a*100):0,learningPercentage:a>0?Math.round(o/a*100):0,strugglingPercentage:a>0?Math.round(i/a*100):0,masteredWords:r,learningWords:o,newWords:t.length-a,retentionRate:a>0?Math.round(r/a*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function K0(){const n=nt(),e=Object.values(n.wordProgress),t=e.filter(c=>c.memorizationAttempts&&c.memorizationAttempts>0);let s=0,r=0,o=0;t.forEach(c=>{c.category}),t.forEach(c=>{const l=Jt(c,"memorization");l<40?s++:l>=40&&l<70?r++:l>=70&&o++});const i=t.length,a=s*1+r*.5;return{totalWords:e.length,appearedWords:i,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:i>0?Math.round(s/i*100):0,weightedRetentionRate:i>0?Math.round(a/i*100):0,masteredPercentage:i>0?Math.round(s/i*100):0,learningPercentage:i>0?Math.round(r/i*100):0,strugglingPercentage:i>0?Math.round(o/i*100):0,masteredWords:s,learningWords:r,newWords:e.length-i,retentionRate:i>0?Math.round(s/i*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function X0(){const n=nt(),e=Object.entries(n.wordProgress).filter(([r,o])=>r.startsWith("grammar_")),t=new Map;e.forEach(([r,o])=>{const i=r.match(/grammar_(?:\w+-)?g(\d+)-u(\d+)/);if(!i){r.startsWith("grammar_")&&!r.includes("unknown")&&console.warn(`‚ö†Ô∏è ÊñáÊ≥ïÂïèÈ°åID„Åå„Éë„Çø„Éº„É≥„Å´„Éû„ÉÉ„ÉÅ„Åó„Åæ„Åõ„Çì: ${r}`);return}const a=i[1],c=i[2],l=`‰∏≠${a}_Unit${c}`;t.has(l)||t.set(l,{questions:[],answered:[],correct:0,incorrect:0,mastered:0,allHistory:[]});const d=t.get(l);d.questions.push([r,o]);const h=o.grammarAttempts||o.correctCount+o.incorrectCount;if(h>0){d.answered.push([r,o]);const f=o.grammarCorrect||o.correctCount||0,p=h-f;if(d.correct+=f,d.incorrect+=p,o.learningHistory&&o.learningHistory.length>0){const w=o.learningHistory.slice(-10);d.allHistory.push(...w)}const m=o.grammarStreak||o.consecutiveCorrect||0,g=h>0?f/h*100:0,x=o.masteryLevel==="mastered",y=h===1&&f===1,b=h>=3&&g>=85;(x||y||b||m>=3)&&d.mastered++}});const s=Array.from(t.entries()).map(([r,o])=>{const i=o.correct+o.incorrect,a=i>0?o.correct/i*100:0,c=o.questions.length>0?o.answered.length/o.questions.length*100:0,d=o.allHistory.sort((h,f)=>h.timestamp-f.timestamp).slice(-10).map(h=>h.wasCorrect?"üü©":"üü•").join("");return{unit:r,totalQuestions:o.questions.length,answeredQuestions:o.answered.length,correctCount:o.correct,incorrectCount:o.incorrect,masteredCount:o.mastered,accuracy:Math.round(a),progress:Math.round(c),historyIcons:d}});return s.sort((r,o)=>r.unit.localeCompare(o.unit)),s}function Bf(n){const e=nt(),s=Object.entries(e.wordProgress).map(([r,o])=>{let i=0;if(n){switch(n){case"memorization":i=o.memorizationAttempts||0;break;case"translation":i=o.translationAttempts||0;break;case"spelling":i=o.spellingAttempts||0;break;case"grammar":i=o.grammarAttempts||0;break}if(i===0)return null}else if(i=o.totalAttempts||0,i===0)return null;const a=n?Jt(o,n):Jt(o);if(a<40)return null;const c=a>=70?"incorrect":"still_learning";return{word:r,position:a,category:c,attempts:i,correctCount:o.correctCount||0,incorrectCount:o.incorrectCount||0,lastStudied:o.lastStudied||0}}).filter(r=>r!==null);return s.sort((r,o)=>o.position-r.position),s}const Up="english-progress",yb=9999,bb=3,WQ=3e4,wb=1200;let vb=0,Vf=null,Uf=null;function BQ(n){if(typeof localStorage>"u")return;const e=Object.keys(n.wordProgress??{}).length;Uf=(()=>{if(e<=wb)return n;const o=Object.entries(n.wordProgress??{}),i=o.filter(([,l])=>{const d=(l==null?void 0:l.lastStudied)??0,h=(l==null?void 0:l.totalAttempts)??0;return d>0||h>0}).sort((l,d)=>{var p,m;const h=((p=l[1])==null?void 0:p.lastStudied)??0;return(((m=d[1])==null?void 0:m.lastStudied)??0)-h}),c=(i.length>0?i:o).slice(0,wb);return{...n,wordProgress:Object.fromEntries(c)}})();const s=Date.now(),r=Math.max(0,WQ-(s-vb));Vf||(Vf=setTimeout(()=>{Vf=null;const o=Uf;if(Uf=null,!!o)try{localStorage.setItem(Up,JSON.stringify(o)),vb=Date.now()}catch(i){j.warn("LocalStorage‰øùÂ≠òÂ§±ÊïóÔºàÂÆπÈáè‰∏çË∂≥„ÅÆÂèØËÉΩÊÄßÔºâ:",i)}},r))}const VQ="backup_progress_before_migration";async function UQ(n){try{await Pa(VQ,{createdAt:new Date().toISOString(),fromVersion:n.fromVersion,toVersion:n.toVersion,storedData:n.storedData})}catch(e){j.warn("Failed to backup progress before migration:",e)}}function Ni(){return{schemaVersion:Eo,results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},categoryStats:{},difficultyStats:{},wordProgress:{}}}async function bs(){try{const n=await Jb();if(!n){const l=Ni();return Yr(l),l}const e=V0(n==null?void 0:n.schemaVersion),t=n,s={results:t.results||[],statistics:t.statistics||{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:t.questionSetStats||{},categoryStats:{},difficultyStats:{},wordProgress:t.wordProgress||{}};s.statistics||(s.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),s.questionSetStats||(s.questionSetStats={}),s.wordProgress||(s.wordProgress={}),s.results||(s.results=[]),Q0(s);const r=dk(s,e);if(r.status==="too_new"){try{localStorage.setItem("debug_progress_schema_too_new",JSON.stringify({timestamp:new Date().toISOString(),storedVersion:r.storedVersion,supportedVersion:r.supportedVersion,notes:r.notes}))}catch{}return Yr(s),s}let o=0,i=0,a=!1;Object.values(s.wordProgress).forEach(l=>{l.category||(l.category="Êú™ÂàÜÈ°û",o++,a=!0);const d=l.memorizationAttempts||0,h=l.memorizationStillLearning||0,f=l.consecutiveIncorrect||0,p=l.memorizationPosition;if(d>0&&(h>0||f>0)){const m=typeof p=="number"?p:-1;if(m<40){const g=Jt({...l,memorizationPosition:void 0},"memorization");typeof g=="number"&&g>=40&&g>m&&(l.memorizationPosition=g,i++,a=!0)}}}),a&&(o>0&&j.info(`[Category Repair] ${o}ÂÄã„ÅÆÂçòË™û„Å´category„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`),i>0&&j.info(`[Position Repair] memorizationPosition„ÇíÂÜçË®àÁÆó„Åó„Å¶Ë£úÊ≠£: ${i}Ë™û`));try{localStorage.setItem("debug_progress_repair_summary",JSON.stringify({timestamp:new Date().toISOString(),categoryAdded:o,memorizationPositionRepaired:i,saved:a}))}catch{}const c=a||r.didMigrate;if(r.didMigrate){await UQ({fromVersion:r.fromVersion,toVersion:r.toVersion,storedData:n});try{localStorage.setItem("debug_progress_migration_summary",JSON.stringify({timestamp:new Date().toISOString(),fromVersion:r.fromVersion,toVersion:r.toVersion,didMigrate:r.didMigrate,notes:r.notes}))}catch{}}return c&&await Or(s),Yr(s),s}catch(n){j.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=Ni();return Yr(e),e}}let Cr=null;function GQ(){return Cr||(Cr=Ni(),j.log("üì¶ Progress cache initialized with default data")),Cr}function nt(){if(Cr)return Cr.statistics||(j.warn("‚ö†Ô∏è Cache missing statistics, reinitializing"),Cr=Ni()),Cr;GQ();try{const n=localStorage.getItem(Up);if(!n){const s=Ni();return Cr=s,s}const e=JSON.parse(n),t=dk(e,V0(e==null?void 0:e.schemaVersion));if(t.status==="ok"&&t.didMigrate)try{localStorage.setItem(Up,JSON.stringify(e))}catch{}return e.statistics||(e.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),e.questionSetStats||(e.questionSetStats={}),e.wordProgress||(e.wordProgress={}),e.results||(e.results=[]),e.results||(e.results=[]),Q0(e),Cr=e,e}catch(n){j.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=Ni();return Cr=e,e}}function Yr(n){Cr=n,j.log("üîÑ progressCacheÊõ¥Êñ∞ - results‰ª∂Êï∞:",n.results.length)}async function Or(n){try{n.schemaVersion=Eo,Q0(n),Yr(n),BQ(n);const e={schemaVersion:Eo,quizzes:{},lastUpdated:Date.now(),totalAnswered:{},totalMastered:{},results:n.results,statistics:n.statistics,questionSetStats:n.questionSetStats,wordProgress:n.wordProgress};await Yb(e)||j.error("„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}catch(e){j.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:",e)}}function Q0(n){n.results.length>yb&&(n.results.sort((e,t)=>t.date-e.date),n.results=n.results.slice(0,yb)),Object.values(n.wordProgress).forEach(e=>{e.responseTimes&&e.responseTimes.length>bb&&(e.responseTimes=e.responseTimes.slice(-bb))})}async function Dc(n){const e=await bs();e.results.push(n),j.log("‚úÖ addQuizResultÂëº„Å≥Âá∫„Åó:",{mode:n.mode,score:n.score,total:n.total,date:new Date(n.date).toISOString(),resultsCount:e.results.length}),qQ(e,n),await Or(e),j.log("üíæ saveProgressÂÆå‰∫Ü - results‰ª∂Êï∞:",e.results.length);try{if(typeof window<"u"){const t=new CustomEvent(ya,{detail:{result:n}});window.dispatchEvent(t)}}catch{}}function HQ(n,e){return`${n}:${e}`}function qQ(n,e){const t=n.statistics;t.totalQuizzes++,t.totalQuestions+=e.total,t.totalCorrect+=e.score,t.averageScore=t.totalQuestions>0?t.totalCorrect/t.totalQuestions*100:0,t.bestScore=Math.max(t.bestScore,e.percentage),t.lastStudyDate=e.date;const s=new Date(e.date).setHours(0,0,0,0);t.studyDates.includes(s)||(t.studyDates.push(s),t.studyDates.sort((c,l)=>l-c)),t.streakDays=KQ(t.studyDates);const r=HQ(e.mode,e.questionSetId);n.questionSetStats[r]||(n.questionSetStats[r]={attempts:0,bestScore:0,averageScore:0,lastAttempt:0,totalTimeSpent:0});const o=n.questionSetStats[r];o.attempts++,o.bestScore=Math.max(o.bestScore,e.percentage),o.lastAttempt=e.date,o.totalTimeSpent+=e.timeSpent;const i=n.results.filter(c=>c.mode===e.mode&&c.questionSetId===e.questionSetId),a=i.reduce((c,l)=>c+l.percentage,0);o.averageScore=a/i.length}function KQ(n){if(n.length===0)return 0;const e=new Date().setHours(0,0,0,0),t=e-24*60*60*1e3,s=n[0];if(s!==e&&s!==t)return 0;let r=1;for(let o=1;o<n.length&&(n[o-1]-n[o])/(24*60*60*1e3)===1;o++)r++;return r}function Y0(n=10){const e=nt(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{if(r<5)return;const i=e.wordProgress[o];if(!i)return;const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=i.correctCount/a*100,l=c>=80,h=a===1&&i.correctCount===1||i.consecutiveCorrect>=3||c>=85;if(l&&h){const f=r*c;s.push({word:o,totalMistakes:r,recentAccuracy:Math.round(c),overcomeScore:f})}}),s.sort((r,o)=>o.overcomeScore-r.overcomeScore).slice(0,n)}function rf(n=10){const e=nt(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{const i=e.wordProgress[o];if(!i){s.push({word:o,mistakes:r,recentAccuracy:0,meaning:void 0,reading:void 0});return}const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=a===1&&i.correctCount===1;r>=5&&c>=80&&(l||i.consecutiveCorrect>=3||c>=85)||s.push({word:o,mistakes:r,recentAccuracy:Math.round(c),meaning:i.meaning,reading:i.reading})}),s.sort((r,o)=>o.mistakes-r.mistakes).slice(0,n)}function fk(n){return{word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,firstAttempted:Date.now(),lastStudied:0,totalResponseTime:0,averageResponseTime:0,difficultyScore:50,masteryLevel:"new",responseTimes:[],category:"new"}}function XQ(n){const e=n.correctCount+n.incorrectCount;if(e===0)return 50;const s=(1-n.correctCount/e)*100,r=Math.min(n.consecutiveIncorrect*5,20),o=n.averageResponseTime/1e3,i=Math.min(o>5?(o-5)*3:0,15),a=n.userDifficultyRating?(n.userDifficultyRating-5.5)*5:0,c=s+r+i+a;return Math.max(0,Math.min(100,c))}function To(n){const e=[1,1,3,7,14,30,90,180,365];return n>=e.length?365:e[n]||1}function J0(n,e){const t=n.correctCount+n.incorrectCount,s=t>0?n.correctCount/t:0,{consecutiveCorrect:r,lastStudied:o}=n,a=(Date.now()-o)/(1e3*60*60)/24;if(t===1&&e){const c=To(1);return{isMastered:!0,excludeDays:c,reason:`1Áô∫Ê≠£Ëß£Ôºà${c}Êó•Âæå„Å´ÂÜçÁ¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:1}}if(r>=2&&e){const c=To(r),l=Math.min(7,Math.floor(r/1));let d="";return r>=7?d=`Ë∂ÖÈï∑ÊúüË®òÊÜ∂ÈÅîÊàêÔºÅÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âπ¥Ê¨°Á¢∫Ë™çÔºâ`:r>=5?d=`Èï∑ÊúüË®òÊÜ∂ÂÆöÁùÄÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:r>=3?d=`Áü≠Êúü‚ÜíÈï∑ÊúüË®òÊÜ∂ÁßªË°åÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:d=`Â≠¶Áøí‰∏≠ÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âæ©ÁøíÔºâ`,{isMastered:!0,excludeDays:c,reason:d,confidence:Math.min(.99,.75+r*.05),masteryLevel:l}}if(t>=3&&s>=.9&&r>=2){const c=To(r);return{isMastered:!0,excludeDays:c,reason:`È´òÁ≤æÂ∫¶ÂÆâÂÆöÂûãÔºàÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.88,masteryLevel:2}}if(r>=2&&a>=7&&e){const c=To(r),l=Math.floor(c*1.5);return{isMastered:!0,excludeDays:l,reason:`Èï∑ÊúüË®òÊÜ∂ÂûãÔºà7Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.92,masteryLevel:3}}if(r>=2&&a>=3&&e){const c=To(r),l=Math.floor(c*1.2);return{isMastered:!0,excludeDays:l,reason:`‰∏≠ÊúüË®òÊÜ∂ÂûãÔºà3Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:2}}if(r>=2&&a<=1&&s>=.85&&t>=4){const c=To(r);return{isMastered:!0,excludeDays:c,reason:`Áü≠ÊúüÂÆåÁíßÂûãÔºà24ÊôÇÈñìÂÜÖ„Å´ÈÄ£Á∂öÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.8,masteryLevel:1}}if(t>=5&&s>=.8&&e){const c=Math.max(7,To(2));return{isMastered:!0,excludeDays:c,reason:`È´òÂõûÊï∞ÂÆâÂÆöÂûãÔºà${t}ÂõûÊåëÊà¶„ÉªÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.83,masteryLevel:2}}if(r>=2&&s>=.75&&t>=3&&e){const c=To(r);return{isMastered:!0,excludeDays:c,reason:`Ê¨°ÂõûÂÆöÁùÄÈÅîÊàêÔºà${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.78,masteryLevel:1}}return{isMastered:!1,excludeDays:0,reason:"Êú™ÂÆöÁùÄ",confidence:1,masteryLevel:0}}function QQ(n){const e=n.correctCount+n.incorrectCount;if(e===0)return"new";const t=n.correctCount/e,s=e===1&&n.correctCount===1,r=e===2&&t===1,o=e>=5&&t>=.85,i=e>=3&&t>=.9,a=n.consecutiveCorrect>=5,c=e>=10&&t>=.75&&n.consecutiveCorrect>=2;return s||r||o||i||a||c?"mastered":"learning"}async function Wo(n,e,t,s,r,o,i){const a=await bs();let c=a.wordProgress[n];if(c||(c=fk(n),a.wordProgress[n]=c),c.lastRetentionRate!==void 0){const b=c.lastRetentionRate,w=e?1:o?.5:0;On(async()=>{const{getPredictionLogger:v}=await Promise.resolve().then(()=>bZ);return{getPredictionLogger:v}},void 0).then(({getPredictionLogger:v})=>{v().logPrediction(n,b,w).catch(S=>{console.warn("Failed to log prediction:",S)})})}e?(c.correctCount++,c.consecutiveCorrect++,c.consecutiveIncorrect=0):o?(c.consecutiveCorrect=0,c.consecutiveIncorrect=0):(c.incorrectCount++,c.consecutiveIncorrect++,c.consecutiveCorrect=0);const l=r;l==="translation"?(c.translationAttempts=(c.translationAttempts||0)+1,e?(c.translationCorrect=(c.translationCorrect||0)+1,c.translationStreak=(c.translationStreak||0)+1):c.translationStreak=0):l==="spelling"?(c.spellingAttempts=(c.spellingAttempts||0)+1,e?(c.spellingCorrect=(c.spellingCorrect||0)+1,c.spellingStreak=(c.spellingStreak||0)+1):c.spellingStreak=0):l==="grammar"?(c.grammarAttempts=(c.grammarAttempts||0)+1,e?(c.grammarCorrect=(c.grammarCorrect||0)+1,c.grammarStreak=(c.grammarStreak||0)+1):c.grammarStreak=0):l==="memorization"&&(c.memorizationAttempts=(c.memorizationAttempts||0)+1,e?(c.memorizationCorrect=(c.memorizationCorrect||0)+1,c.memorizationStreak=(c.memorizationStreak||0)+1):o?c.memorizationStillLearning=(c.memorizationStillLearning||0)+1:c.memorizationStreak=0),c.totalAttempts=(c.translationAttempts||0)+(c.spellingAttempts||0)+(c.grammarAttempts||0)+(c.memorizationAttempts||0),c.totalResponseTime+=t;const d=c.correctCount+c.incorrectCount;if(d>0&&(c.averageResponseTime=c.totalResponseTime/d),s!==void 0&&(c.userDifficultyRating=s),c.lastStudied=Date.now(),l==="memorization"){c.easinessFactor===void 0&&(c.easinessFactor=2.5),e?c.easinessFactor=Math.min(2.5,c.easinessFactor+.1):o||(c.easinessFactor=Math.max(1.3,c.easinessFactor-.2));const b=c.memorizationStreak||0,w=c.easinessFactor;let v=0;if(b===0)v=0;else if(b===1)v=1;else if(b===2)v=3;else if(b===3)v=7;else{const S=c.reviewInterval||7;v=Math.round(S*w)}c.reviewInterval=v,c.lastReviewDate=Date.now(),c.totalReviews=(c.totalReviews||0)+1,c.avgResponseSpeed?c.avgResponseSpeed=c.avgResponseSpeed*.8+t*.2:c.avgResponseSpeed=t,t<2e3&&e&&(c.easinessFactor=Math.min(2.5,c.easinessFactor+.05))}c.learningHistory||(c.learningHistory=[]);let h=i,f,p;if(!h)try{const{estimateConfidence5:b}=await On(async()=>{const{estimateConfidence5:v}=await import("./answerConfidence5-Bnbu2Rea.js");return{estimateConfidence5:v}},__vite__mapDeps([6,2,3])),w=await b({progress:c,wasCorrect:e,responseTimeMs:t,timestamp:Date.now()});h=w.confidence5,f=w.score01,p=w.source}catch{}c.learningHistory.push({timestamp:Date.now(),wasCorrect:e,wasStillLearning:!!o,responseTime:t,sessionIndex:0,mode:l,confidence5:h,confidenceScore01:f,confidenceSource:p}),o||(c.responseTimes||(c.responseTimes=[]),c.responseTimes.push(t),c.responseTimes.length>10&&(c.responseTimes=c.responseTimes.slice(-10))),c.learningHistory.length>20&&(c.learningHistory=c.learningHistory.slice(-20)),c.difficultyScore=XQ(c);const m=c.masteryLevel;c.masteryLevel=QQ(c);try{const b=m!=="mastered"&&c.masteryLevel==="mastered";On(async()=>{const{getABTestManager:w}=await Promise.resolve().then(()=>FQ);return{getABTestManager:w}},void 0).then(({getABTestManager:w})=>{const v=w(),S="chain_learning_retention_2025_01",C=v.getVariant(S);C&&On(async()=>{const{getMetricsCollector:k}=await import("./MetricsCollector-GSSz_ROG.js");return{getMetricsCollector:k}},[]).then(({getMetricsCollector:k})=>{k().logLearningOutcome(S,C,{word:n,isCorrect:e,isStillLearning:!!o,retentionRate:b?1:0})})})}catch{}m!==c.masteryLevel&&j.log(`üîÑ ${n}: ${m} ‚Üí ${c.masteryLevel} (Ê≠£Ëß£: ${c.correctCount}, ‰∏çÊ≠£Ëß£: ${c.incorrectCount}, ÈÄ£Á∂ö: ${c.consecutiveCorrect})`);const g=J0(c,e);g.isMastered&&(c.skipExcludeUntil=Date.now()+g.excludeDays*24*60*60*1e3,YQ(n),g.reason!=="Êú™ÂÆöÁùÄ"&&j.log(`‚úÖ ${n} „ÅåÂÆöÁùÄ: ${g.reason} (Èô§Â§ñÊúüÈñì: ${g.excludeDays}Êó•)`));const y=new $s().recalculatePriorityAfterAnswer(n,c,l);if(l==="memorization"?c.memorizationPosition=y:l==="translation"?c.translationPosition=y:l==="spelling"?c.spellingPosition=y:l==="grammar"&&(c.grammarPosition=y),c.position=y,l){const b=l==="translation"?"ÂíåË®≥":l==="spelling"?"„Çπ„Éö„É´":l==="grammar"?"ÊñáÊ≥ï":l==="memorization"?"ÊöóË®ò":"Ë™≠Ëß£";a.results.push({id:`word-${n}-${Date.now()}`,questionSetId:"individual-word",questionSetName:b,score:e?1:0,total:1,percentage:e?100:0,date:Date.now(),timeSpent:t/1e3,incorrectWords:e?[]:[n],mode:l,difficulty:c.difficultyScore>.7?"advanced":c.difficultyScore>.4?"intermediate":"beginner"})}await Or(a);try{if(typeof window<"u"){const b=new CustomEvent(ya,{detail:{word:n,isCorrect:e,isStillLearning:!!o,responseTime:t,mode:l,confidence5:h,confidenceScore01:f,confidenceSource:p}});window.dispatchEvent(b)}}catch{}try{if(typeof window<"u"&&y>=60){const b=new CustomEvent("weak-word-detected",{detail:{word:n,position:y,mode:l,isIncorrect:!e,timestamp:Date.now()}});window.dispatchEvent(b)}}catch{}}function YQ(n){const e="reading-passages-data",t=localStorage.getItem(e);if(t)try{const s=JSON.parse(t);let r=!1;if(s.forEach(o=>{o.phrases&&o.phrases.forEach(i=>{i.segments&&i.segments.forEach(a=>{a.word.toLowerCase()===n.toLowerCase()&&a.isUnknown&&(a.isUnknown=!1,r=!0)})})}),r)try{localStorage.setItem(e,JSON.stringify(s))}catch(o){if(o instanceof DOMException&&o.name==="QuotaExceededError")j.warn("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±ÊïóÔºàÂÆπÈáèË∂ÖÈÅéÔºâ„ÄÇ„Éá„Éº„Çø„ÇíÂúßÁ∏Æ„Åó„Åæ„Åô„ÄÇ"),localStorage.removeItem(e),j.log("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇÊ¨°ÂõûË™≠„ÅøËæº„ÅøÊôÇ„Å´ÂÜçÂèñÂæó„Åï„Çå„Åæ„Åô„ÄÇ");else throw o}}catch(s){j.error("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞„Ç®„É©„Éº:",s)}}function of(n,e=30){const t=nt();t.wordProgress[n]||(t.wordProgress[n]=fk(n));const s=t.wordProgress[n];s.skippedCount=(s.skippedCount||0)+1,s.lastSkipped=Date.now(),s.skipExcludeUntil=Date.now()+e*24*60*60*1e3,Or(t)}function Z0(n){const t=nt().wordProgress[n];return t?!!(t.skipExcludeUntil&&Date.now()<t.skipExcludeUntil||t.masteryLevel==="mastered"&&t.nextReviewDate&&Date.now()<t.nextReviewDate):!1}function ex(n){return n.filter(e=>!Z0(e.word))}function gd(n){return nt().wordProgress[n]||null}function Zi(){const n=nt();return Object.values(n.wordProgress)}async function tx(n,e){const t=await bs();t.wordProgress[n]||(t.wordProgress[n]={word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,lastStudied:Date.now(),totalResponseTime:0,averageResponseTime:0,difficultyScore:0,masteryLevel:"new",responseTimes:[],confusedWith:[],confusionCount:0,lastConfused:Date.now()});const s=t.wordProgress[n];s.confusedWith||(s.confusedWith=[]),s.confusedWith.push({word:e,timestamp:Date.now()}),s.confusedWith.length>10&&(s.confusedWith=s.confusedWith.slice(-10)),s.confusionCount=(s.confusionCount||0)+1,s.lastConfused=Date.now(),s.difficultyScore=Math.min(100,(s.difficultyScore||0)+5),await Or(t),Yr(t)}function nx(n=20){return Zi().filter(t=>(t.confusionCount||0)>0).sort((t,s)=>{const r=(s.confusionCount||0)-(t.confusionCount||0);return r!==0?r:(s.lastConfused||0)-(t.lastConfused||0)}).slice(0,n)}function sx(n){let t=nt().results;return n&&(t=t.filter(s=>s.mode===n)),t.reduce((s,r)=>s+r.total,0)}function pk(n){const e=nt(),t=new Set;for(const[s,r]of Object.entries(e.wordProgress)){const o=r.correctCount>0||r.incorrectCount>0,i=r.skippedCount&&r.skippedCount>0;(o||i)&&t.add(s)}return t.size}function af(){const n=nt();let e=0;for(const t of Object.values(n.wordProgress)){const r=t.correctCount+t.incorrectCount===1&&t.correctCount===1,o=t.consecutiveCorrect>=3,i=t.skippedCount&&t.skippedCount>0;(r||o||i)&&e++}return e}function xd(){const n=nt(),t=Object.values(n.wordProgress).filter(i=>i.correctCount+i.incorrectCount>0);let s=0;t.forEach(i=>{const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=i.masteryLevel==="mastered",d=a===1&&i.correctCount===1,h=a>=5&&c>=85,f=a>=3&&c>=90,p=i.consecutiveCorrect>=5,m=a>=10&&c>=75;(l||d||h||f||p||m)&&s++});const r=t.length>0?s/t.length*100:0,o=Math.min(100,Math.max(0,r));return{retentionRate:Math.round(o),masteredCount:s,appearedCount:t.length}}async function rx(){try{await m$(),j.log("‚úÖ IndexedDBÂâäÈô§ÂÆå‰∫Ü")}catch(t){j.error("IndexedDBÂâäÈô§„Ç®„É©„Éº:",t)}const n=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&(s.startsWith("quiz-result-")||s==="nanashi8-user-progress"||s==="progress-data"||s.startsWith("session-history-")||s==="session-history"||s==="skipped-words"||s==="skip-groups"||s==="improvement-progress"||s==="study-settings"||s==="reading-passages-data"||s==="all-questions-cache")&&n.push(s)}n.forEach(t=>{try{localStorage.removeItem(t)}catch(s){j.error(`Failed to remove ${t}:`,s)}});const e=Ni();Or(e),j.log(`‚úÖ „É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü: LocalStorage ${n.length}ÂÄã„ÅÆ„Ç≠„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`),window.location.reload()}function ox(n=14){const e=nt(),t=new Date,s=[];j.log("üìä getStudyCalendarByModeÂëº„Å≥Âá∫„Åó - progress.results‰ª∂Êï∞:",e.results.length);for(let r=n-1;r>=0;r--){const o=new Date(t);o.setDate(o.getDate()-r);const i=mx(o),a=new Date(o).setHours(0,0,0,0),c=new Date(o).setHours(23,59,59,999),l=e.results.filter(g=>g.date>=a&&g.date<=c),d={count:0,correct:0},h={count:0,correct:0},f={count:0,correct:0},p={count:0,correct:0};l.forEach(g=>{var y;const x=((y=g.mode)==null?void 0:y.toLowerCase())||"";x.includes("memorization")||x.includes("ÊöóË®ò")?(d.count+=g.total,d.correct+=g.score):x.includes("translation")||x.includes("ÂíåË®≥")?(h.count+=g.total,h.correct+=g.score):x.includes("spelling")||x.includes("„Çπ„Éö„É´")?(f.count+=g.total,f.correct+=g.score):(x.includes("grammar")||x.includes("ÊñáÊ≥ï"))&&(p.count+=g.total,p.correct+=g.score)});const m=d.count+h.count+f.count+p.count;s.push({date:i,memorization:d,translation:h,spelling:f,grammar:p,total:m})}return s}function ix(n=12){const e=nt(),t=new Date,s=[];let r=0,o=0;for(let i=n-1;i>=0;i--){const a=new Date(t);a.setDate(t.getDate()-i*7),a.setHours(23,59,59,999);const c=new Date(a);c.setDate(a.getDate()-6),c.setHours(0,0,0,0);const d=e.results.filter(p=>p.date>=c.getTime()&&p.date<=a.getTime()).reduce((p,m)=>p+m.total,0);o+=d;let h=0;Object.values(e.wordProgress).forEach(p=>{p.masteryLevel==="mastered"&&p.lastStudied>=c.getTime()&&p.lastStudied<=a.getTime()&&h++}),r+=h;const f=`${c.getMonth()+1}/${c.getDate()}`;s.push({weekLabel:f,cumulativeMastered:r,weeklyMastered:h,cumulativeAnswered:o,weeklyAnswered:d})}return s}function ax(){const n=nt(),e=Date.now(),t=e-7*24*60*60*1e3,s=e-30*24*60*60*1e3,r=new Set,o=new Set,i=new Set,a=new Set,c=new Set,l=new Set;return n.results.forEach(d=>{d.incorrectWords.forEach(h=>{c.add(h),d.date>=s&&i.add(h),d.date>=t&&r.add(h)})}),Object.entries(n.wordProgress).forEach(([d,h])=>{h.masteryLevel==="mastered"&&(l.add(d),h.lastStudied>=s&&a.add(d),h.lastStudied>=t&&o.add(d))}),{last7Days:Math.min(100,Math.max(0,r.size>0?o.size/r.size*100:0)),last30Days:Math.min(100,Math.max(0,i.size>0?a.size/i.size*100:0)),allTime:Math.min(100,Math.max(0,c.size>0?l.size/c.size*100:0))}}function yd(n){const t=nt().wordProgress[n];if(!t)return null;const s=t.correctCount,r=t.correctCount+t.incorrectCount,a=(t.learningHistory||[]).slice(-10).map(f=>f.wasCorrect?"üü©":"üü•").join("");let c=0;if(r===0)c=0;else{const f=s/r*70,p=Math.min(20,(t.consecutiveCorrect||0)*5),m=(Date.now()-t.lastStudied)/(24*60*60*1e3),g=Math.min(10,Math.max(0,(m-1)*2));c=Math.min(100,Math.max(0,f+p-g)),t.masteryLevel==="mastered"&&(c=Math.max(90,c))}let l="new",d="Êú™Â≠¶Áøí",h="‚ö™";return r===0?(l="new",d="Êú™Â≠¶Áøí",h="‚ö™"):t.masteryLevel==="mastered"||c>=80?(l="mastered",d="ÂÆöÁùÄÊ∏à",h="üü¢"):c>=50?(l="learning",d="Â≠¶Áøí‰∏≠",h="üü°"):(l="struggling",d="Ë¶ÅÂæ©Áøí",h="üî¥"),{correctCount:s,totalCount:r,accuracyHistory:a,retentionRate:Math.round(c),status:l,statusLabel:d,statusIcon:h,position:t.position,memorizationPosition:t.memorizationPosition,translationPosition:t.translationPosition,spellingPosition:t.spellingPosition,grammarPosition:t.grammarPosition}}async function cx(n){try{await Pa("memorization-card-settings",n)}catch(e){j.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-card-settings",JSON.stringify(n))}}async function lx(){try{const n=await jc("memorization-card-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"showFurigana"in n?n:null:null}catch(n){j.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-card-settings");return e?JSON.parse(e):null}}async function ux(n){try{await Pa("memorization-settings",n)}catch(e){j.error("ÊöóË®òË®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-settings",JSON.stringify(n))}}async function dx(){try{const n=await jc("memorization-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"shuffleOrder"in n?n:null:null}catch(n){j.error("ÊöóË®òË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-settings");return e?JSON.parse(e):null}}async function hx(n){try{const e=await jc("memorization-behaviors"),s=[...e?typeof e=="string"?JSON.parse(e):e:[],n].slice(-1e3);await Pa("memorization-behaviors",s)}catch(e){j.error("ÊöóË®òË°åÂãïË®òÈå≤„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}const mk="custom-question-sets";async function cf(){try{const n=await jc(mk);return n?typeof n=="string"?JSON.parse(n):Array.isArray(n)?n:[]:[]}catch(n){return j.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÂèñÂæó„Ç®„É©„Éº:",n),[]}}async function bd(n){try{const e=await cf(),t=e.findIndex(s=>s.id===n.id);t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),await Pa(mk,e)}catch(e){throw j.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà‰øùÂ≠ò„Ç®„É©„Éº:",e),e}}async function wd(n,e=20,t=3,s=60,r){const a=rf(100).filter(l=>l.mistakes>=t&&l.recentAccuracy<=s).slice(0,e).map(l=>{const d=r.find(h=>h.word.toLowerCase()===l.word.toLowerCase());return d||{word:l.word,reading:l.reading||"",meaning:l.meaning||"",etymology:"",relatedWords:"",relatedFields:"",difficulty:"intermediate"}});return{id:`weak-words-${Date.now()}`,name:n,source:"weak-words",questions:a,createdAt:Date.now(),updatedAt:Date.now(),isAutoUpdate:!0,autoUpdateConfig:{limit:e,minMistakes:t,maxAccuracy:s},metadata:{description:`Ëã¶ÊâãË™ûÂè•„Åã„ÇâËá™ÂãïÁîüÊàêÔºàÈñìÈÅï„ÅÑ${t}Âõû‰ª•‰∏ä„ÄÅÊ≠£Á≠îÁéá${s}%‰ª•‰∏ãÔºâ`,totalWords:a.length}}}function vd(){const n=nt(),s=Object.values(n.wordProgress).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.word.startsWith("grammar_")||a.word.includes("_g")).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.correctCount+a.incorrectCount>0);let r=0;s.forEach(a=>{const c=a.grammarAttempts||a.correctCount+a.incorrectCount,l=a.grammarCorrect||a.correctCount,d=a.grammarStreak||a.consecutiveCorrect,h=c>0?l/c*100:0,f=a.masteryLevel==="mastered",p=c===1&&l===1,m=c>=5&&h>=85,g=c>=3&&h>=90,x=d>=5,y=c>=10&&h>=75;(f||p||m||g||x||y)&&r++});const o=s.length>0?r/s.length*100:0,i=Math.min(100,Math.max(0,o));return{retentionRate:Math.round(i),masteredCount:r,appearedCount:s.length}}async function fx(){const n=X0();return(await Promise.all(n.map(async t=>{const s=t.unit.match(/‰∏≠(\d+)_Unit(\d+)/);if(!s)return null;const r=s[1],o=s[2];try{const i=await fetch(`/data/grammar/grammar_grade${r}_unit${o}.json`);if(i.ok){const a=await i.json();return a.enabled===!1?null:{...t,title:a.title||""}}}catch{return null}return null}))).filter(t=>t!==null)}function px(n,e="memorization"){const t=nt(),s={incorrect:0,still_learning:0,mastered:0,new:0,total:n.length};return n.forEach(r=>{const o=t.wordProgress[r.word];if(!o){s.new++;return}const i=Jt(o,e);i>=70?s.incorrect++:i>=40?s.still_learning++:i>=20?s.new++:s.mastered++}),s}const Sb=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:Dc,addSessionHistory:_a,calculateSessionStats:px,checkFlexibleMastery:J0,createWeakWordsQuestionSet:wd,filterSkippedWords:ex,getAllWordProgress:Zi,getConfusedWords:nx,getCumulativeProgressData:ix,getCurrentWeakWords:rf,getCustomQuestionSets:cf,getDetailedRetentionStats:pd,getGrammarDetailedRetentionStats:md,getGrammarRetentionRateWithAI:vd,getGrammarUnitStats:X0,getGrammarUnitStatsWithTitles:fx,getMemorizationCardSettings:lx,getMemorizationDetailedRetentionStats:K0,getMemorizationSettings:dx,getMonthlyStats:H0,getNearMasteryStats:hk,getOvercomeWeakWords:Y0,getRecentlyMasteredWords:q0,getRetentionRateWithAI:xd,getRetentionTrend:ax,getStudyCalendarByMode:ox,getStudySettings:U0,getTodayIncorrectWords:hd,getTodayStats:fd,getTotalAnsweredCount:sx,getTotalMasteredWordsCount:af,getUniqueQuestionedWordsCount:pk,getWeeklyStats:G0,getWordDetailedData:yd,getWordProgress:gd,isWordSkipExcluded:Z0,loadProgress:bs,loadProgressSync:nt,recordConfusion:tx,recordMemorizationBehavior:hx,recordWordSkip:of,resetAllProgress:rx,saveCustomQuestionSet:bd,saveMemorizationCardSettings:cx,saveMemorizationSettings:ux,saveProgress:Or,updateProgressCache:Yr,updateWordProgress:Wo},Symbol.toStringTag,{value:"Module"}));function hc(n){const e=n.trim().split(`
`);if(e.length===0)return[];function t(i){const a=[];let c="",l=!1;for(let d=0;d<i.length;d++){const h=i[d],f=i[d+1];h==='"'?l&&f==='"'?(c+='"',d++):l=!l:h===","&&!l?(a.push(c.trim()),c=""):c+=h}return a.push(c.trim()),a}let s=0;const r=e[0].trim();(r.includes("Ë™ûÂè•")||r.includes("term")||r.includes("Ë™≠„Åø")||r.includes("reading")||r.includes("ÊÑèÂë≥")||r.includes("meaning"))&&(s=1);const o=[];for(let i=s;i<e.length;i++){const a=e[i].trim();if(!a||a.startsWith("//")||a.startsWith("#"))continue;const c=t(a);if(c.length>=3){const l=c[0]||"",d=c[1]||"",h=c[2]||"",f=c[3]||"";let p="",m="",g="";c.length>=8?(p=(c[4]||"")+(c[5]||""),m=c[6]||"",g=c[7]||""):(p=c[4]||"",m=c[5]||"",g=c[6]||"");let x="";g.includes("ÂàùÁ¥ö")||g==="beginner"?x="beginner":g.includes("‰∏≠Á¥ö")||g==="intermediate"?x="intermediate":(g.includes("‰∏äÁ¥ö")||g==="advanced")&&(x="advanced"),m&&!i$(m)&&j.warn(`[„Éá„Éº„ÇøÊï¥ÂêàÊÄßË≠¶Âëä] ‰∏çÊ≠£„Å™„Ç´„ÉÜ„Ç¥„É™: "${m}" (ÂçòË™û: "${l}")
ÊúâÂäπ„Å™„Ç´„ÉÜ„Ç¥„É™: ${Kb.join(", ")}
ÂèÇÁÖß: docs/specifications/19-junior-high-vocabulary.md`),l&&h&&o.push({word:l,reading:d,meaning:h,etymology:f,relatedWords:p,relatedFields:m,category:m,difficulty:x})}}return o}function or(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function Gf(n){return!n||typeof n!="string"?null:n.endsWith("Â±±")||n.includes("Â±±ËÑà")?"Â±±Âú∞":n.endsWith("Â∑ù")||n.includes("Â∑ù")?"Ê≤≥Â∑ù":n.endsWith("Êπñ")?"Êπñ":n.endsWith("Êµ∑")||n.includes("Ê¥ã")?"Êµ∑Ê¥ã":n.endsWith("ÂçäÂ≥∂")?"ÂçäÂ≥∂":n.endsWith("Â≥∂")?"Â≥∂":n.endsWith("Âπ≥Èáé")||n.endsWith("ÁõÜÂú∞")||n.endsWith("Âè∞Âú∞")?"Âπ≥Âú∞":n.endsWith("Áúå")||n.endsWith("ÈÅì")||n.endsWith("Â∫ú")?"ÈÉΩÈÅìÂ∫úÁúå":n.endsWith("Â∏Ç")||n.endsWith("Áî∫")||n.endsWith("Êùë")?"ÈÉΩÂ∏Ç":(n.length>=3&&n.length<=6&&/^[„ÅÅ-„Çì]+$/.test(n),null)}function gk(n,e,t){const s=[],r=e.filter((l,d)=>d!==t),o=!!n.termType,i=(()=>{if(!o||!n.word)return{primary:or(r),secondary:[]};const l=Gf(n.word);if(l){const d=r.filter(p=>p.termType===n.termType&&Gf(p.word)===l),h=r.filter(p=>p.termType===n.termType&&Gf(p.word)!==l),f=r.filter(p=>p.termType!==n.termType);return{primary:or(d),secondary:or([...h,...f])}}else{const d=r.filter(f=>f.termType===n.termType),h=r.filter(f=>f.termType!==n.termType);return{primary:or(d),secondary:or(h)}}})(),a=l=>{for(let d=0;d<l.length&&s.length<2;d++){const h=l[d];h.meaning!==n.meaning&&!s.some(f=>f.meaning===h.meaning)&&s.push(h)}};for(a(i.primary),s.length<2&&a(i.secondary);s.length<2;)s.push({word:`„ÉÄ„Éü„Éº${s.length+1}`,meaning:`ÈÅ∏ÊäûËÇ¢${s.length+1}`,reading:"",etymology:"",relatedWords:"",relatedFields:"",category:"",difficulty:""});return[...or([{text:n.meaning,question:n},...s.map(l=>({text:l.meaning,question:l}))]),{text:"ÂàÜ„Åã„Çâ„Å™„ÅÑ",question:null}]}function mx(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${s}`}const ya="quiz-result-added";function Sd(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function xk(n,e=10){const s=Zi().filter(o=>o.difficultyScore>=50).sort((o,i)=>i.difficultyScore-o.difficultyScore).map(o=>o.word.toLowerCase()),r=n.filter(o=>s.includes(o.word.toLowerCase()));return or(r).slice(0,Math.min(e,r.length))}function yk(n){if(!n.includes(" "))return"word";const e=n.toLowerCase(),t=e.split(" "),s=["get","go","come","take","make","put","look","turn","break","bring","call","carry","check","figure","fill","find","give","hand","hang","hold","keep","knock","lay","let","pass","pick","pull","push","run","set","show","shut","sit","stand","stay","stick","take","talk","think","throw","try","work","write"],r=["up","down","in","out","on","off","away","back","over","through","around","across","along","about","after","for","from","into","to","with"];return t.length>=2&&s.includes(t[0])&&t.slice(1).some(d=>r.includes(d))?"phrasal-verb":[/^a .+ of$/,/^the .+ (of|in)$/,/^(break|beat|hit|kick) (the|a)/,/^(catch|have|take|make) (a|an|the)/,/(eye|eyes|face|hand|tongue|ear|nose|heart|mind|bone)/i,/^once in a/,/^(cost|pay|worth) (an|a)/,/^at .+ (heart|first|last|once)/].some(l=>l.test(e))?"idiom":[/^(in|on|at|by|with|from|to) (the|a|an) /,/^(make|take|do|have|get) (a|an|the) /,/(strong|weak|heavy|light|high|low|good|bad|big|small) /i].some(l=>l.test(e))?"collocation":"other"}function JQ(n,e=90){const t=Math.floor(e/3),s=Math.floor(e*2/3);return n<=t?1:n<=s?2:3}function ZQ(n){const e=Zi(),t=new Map;return e.forEach(s=>{t.set(s.word.toLowerCase(),s)}),n.filter(s=>{const r=t.get(s.word.toLowerCase());return!r||r.masteryLevel==="new"})}function e9(n){const e=Date.now(),t=Zi(),s=new Map;return t.forEach(r=>{s.set(r.word.toLowerCase(),r)}),n.filter(r=>{const o=s.get(r.word.toLowerCase());if(!o)return!1;const i=(e-o.lastStudied)/(1e3*60*60*24);let a;switch(o.masteryLevel){case"new":a=1;break;case"learning":a=Math.min(7,o.consecutiveCorrect+1);break;case"mastered":a=Math.min(30,o.consecutiveCorrect*2);break;default:a=1}return i>=a})}function t9(n,e,t){let s;switch(e){case 1:s=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),s.length<t&&(s=[...s,...n.filter(c=>c.difficulty==="‰∏≠Á¥ö")]);break;case 2:const r=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),o=n.filter(c=>c.difficulty==="‰∏≠Á¥ö");s=[...r,...o];break;case 3:const i=n.filter(c=>c.difficulty==="‰∏≠Á¥ö"),a=n.filter(c=>c.difficulty==="‰∏äÁ¥ö");s=[...i,...a];break}return or(s).slice(0,t)}function bk(n,e){const t=n.currentDay,s=JQ(t,n.totalDays),r=ZQ(e),o=e9(e),i=Math.ceil(n.dailyGoals.newWords*.3),a=t9(r,s,i),c=Math.ceil(n.dailyGoals.reviewWords*.4),l=xk(o.length>0?o:e,c),d=Math.floor(i*.3),h=Math.ceil(n.dailyGoals.reviewWords*.3),f=[...or(a).slice(0,d),...or(o.length>0?o:e).slice(0,h)];return{date:n.startDate+(t-1)*24*60*60*1e3,dayNumber:t,phase:s,morning:{newWords:a,duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"discovery"},afternoon:{reviewWords:l,duration:Math.ceil(n.dailyGoals.timeMinutes*.3),mode:"weakness"},evening:{mixedWords:or(f),duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"mixed"},completed:!1,actualAccuracy:0}}function wk(n){const e=Zi(),t=e.filter(l=>l.masteryLevel!=="new").length,s=e.reduce((l,d)=>l+d.correctCount+d.incorrectCount,0),r=e.reduce((l,d)=>l+d.correctCount,0),o=s>0?r/s*100:0,i=t/n.currentDay,c=(4700-t)/(i||50);return{totalLearned:t,totalReviewed:s,averageAccuracy:o,estimatedCompletion:Math.ceil(c)}}function vk(n){const e=Math.ceil(n.currentDay/7),t=n.dailyGoals.newWords*7,s=n.weeklyProgress.find(r=>r.week===e);return s?s.wordsLearned/t*100:0}const n9=Object.freeze(Object.defineProperty({__proto__:null,QUIZ_RESULT_EVENT:ya,calculateProgress:wk,calculateWeeklyAchievement:vk,classifyPhraseType:yk,formatLocalYYYYMMDD:mx,generateChoicesWithQuestions:gk,generateDailyPlan:bk,generateId:Sd,parseCSV:hc,selectWeakQuestions:xk,shuffle:or},Symbol.toStringTag,{value:"Module"}));function s9(){const[n]=N.useState(()=>{const t=localStorage.getItem("autoAdvance");return t?JSON.parse(t):!1}),[e]=N.useState(()=>{const t=localStorage.getItem("autoAdvanceDelay");return t?parseInt(t,10):1500});return{autoAdvance:n,autoAdvanceDelay:e}}function r9(){const[n,e]=N.useState([]),[t,s]=N.useState("all"),[r,o]=N.useState("all"),[i,a]=N.useState("all"),[c,l]=N.useState("all");return{categoryList:n,setCategoryList:e,selectedCategory:t,setSelectedCategory:s,selectedDifficulty:r,setSelectedDifficulty:o,selectedWordPhraseFilter:i,setSelectedWordPhraseFilter:a,selectedPhraseTypeFilter:c,setSelectedPhraseTypeFilter:l}}function o9(){const[n,e]=N.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[t,s]=N.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),[r,o]=N.useState(!1),[i,a]=N.useState([]),[c,l]=N.useState(new Map);return{sessionStats:n,setSessionStats:e,quizState:t,setQuizState:s,reviewFocusMode:r,setReviewFocusMode:o,reviewQuestionPool:i,setReviewQuestionPool:a,reviewCorrectStreak:c,setReviewCorrectStreak:l}}const Sk="customQuestionSets";function i9(){try{const n=localStorage.getItem(Sk);if(n){const e=JSON.parse(n);return{sets:e.sets||[],activeSetId:e.activeSetId||null,recentSetIds:e.recentSetIds||[]}}}catch(n){console.error("Failed to load custom question state:",n)}return{sets:[],activeSetId:null,recentSetIds:[]}}function a9(n){try{localStorage.setItem(Sk,JSON.stringify(n))}catch(e){console.error("Failed to save custom question state:",e)}}function c9(n,e,t,s){const r=new Date().toISOString();return{id:`set_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:n,description:e,words:[],createdAt:r,updatedAt:r,icon:t,color:s}}function l9(n,e,t){const s=n.sets.map(r=>r.id!==e||r.words.some(o=>o.word===t.word)?r:{...r,words:[...r.words,{...t,addedAt:new Date().toISOString()}],updatedAt:new Date().toISOString()});return{...n,sets:s,recentSetIds:f9(n.recentSetIds,e)}}function u9(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,words:r.words.filter(o=>o.word!==t.word),updatedAt:new Date().toISOString()});return{...n,sets:s}}function d9(n,e){return{...n,sets:n.sets.filter(t=>t.id!==e),activeSetId:n.activeSetId===e?null:n.activeSetId,recentSetIds:n.recentSetIds.filter(t=>t!==e)}}function h9(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,...t,updatedAt:new Date().toISOString()});return{...n,sets:s}}function f9(n,e){const t=n.filter(r=>r!==e);return[e,...t].slice(0,5)}class p9{constructor(){me(this,"map",new Map);me(this,"seqIndex",0);me(this,"startedAt",Date.now())}reset(){this.map.clear(),this.seqIndex=0,this.startedAt=Date.now()}onShown(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.timesShown+=1,this.map.set(e,t),this.seqIndex+=1}onAnswer(e,t){const s=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};if(!t)s.timesWrong+=1,s.lastWrongIndex=this.seqIndex;else if(s.lastWrongIndex!==void 0){const r=Math.max(0,this.seqIndex-s.lastWrongIndex);s.lags.push(r),s.lastWrongIndex=void 0}this.map.set(e,s)}onReAdd(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.readds+=1,this.map.set(e,t)}summarize(){const e=Array.from(this.map.values()),t=e.length,s=e.filter(c=>c.timesShown>=2).length,r=t>0?s/t:0,o=e.flatMap(c=>c.lags),i=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length/2)]:0,a=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length*.9)]:0;return{totalItems:t,reappearanceRate:r,medianLag:i,p90Lag:a,durationSec:Math.round((Date.now()-this.startedAt)/1e3)}}}const oo=new p9;function Jl(){const n=N.useCallback((i,a,c,l,d)=>{if(!a||!Array.isArray(a))return console.warn("[useQuestionRequeue] questions is null or not an array"),[];const h=i.id??i.word??String(i.japanese??""),f=i.position,p=Number.isFinite(f)?Number(f):void 0,m=(()=>{var we;if(!l)return{position:void 0,wordProgress:void 0};try{const Re=nt(),et=String(i.word??h??""),je=(we=Re==null?void 0:Re.wordProgress)==null?void 0:we[et];return{position:je?Jt(je,l):35,wordProgress:je}}catch{return{position:void 0,wordProgress:void 0}}})(),g=m.position,x=m.wordProgress,y=g??p,b={...i,sessionPriority:Date.now(),reAddedCount:(i.reAddedCount||0)+1},w=i.reAddedCount||0,v=d==null?void 0:d.outcome,S=v==="incorrect"?{isIncorrectLike:!0,decidedBy:"outcome"}:v==="still_learning"?{isIncorrectLike:!1,decidedBy:"outcome"}:{isIncorrectLike:y!==void 0&&y>=70,decidedBy:"position"},C=S.isIncorrectLike,k=C?1+Math.floor(Math.random()*2):3+Math.floor(Math.random()*3),I=C?Math.min(w*3,18):Math.min(w*2,12),T=Math.min(c+1+12,a.length),$=a.slice(c+1,T).filter(we=>{const Re=!!(we!=null&&we.sessionPriority),et=Number((we==null?void 0:we.reAddedCount)??0),je=Number.isFinite(et)&&et>0;return Re||je}).length,D=C?Math.min($*2,12):Math.min($,8),M=k+I+D,P=(()=>{if(l!=="memorization")return 0;if(C){const we=x==null?void 0:x.consecutiveIncorrect,Re=Number.isFinite(Number(we))?Math.max(0,Number(we)):0;return Math.min(10+Re,60)}return 0})(),L=Math.max(M,P),O=d==null?void 0:d.insertAtIndex,F=typeof O=="number"&&Number.isFinite(O)?Math.max(c+1,Math.floor(O)):null,V=(()=>{if(F===null)return null;const we=c+P,Re=Math.min(F,a.length);return P>0?Math.max(Re,we):Re})(),G=V!==null?Math.max(1,V-c):L,_=we=>{try{return}catch{}},Z=Math.min(120,Math.max(10,G+5)),te=Math.min(c+Z+1,a.length),oe=a.slice(c+1,te).findIndex(we=>((we==null?void 0:we.id)??(we==null?void 0:we.word)??String((we==null?void 0:we.japanese)??""))===h);if(oe>=0){const we=c+1+oe;if(C){const Re=Math.min(c+G,a.length),et=c+P,je=P>0&&we<et,lt={existingAtIndex:we,existingOffset:we-c,desiredInsertPosition:Re,desiredOffset:G,minAllowedIndex:et,minGap:P,isTooSoonForMinGap:je,wouldSkip:!je&&we<=Re,skipReason:je?"too_soon_must_move":we<=Re?"already_at_good_position":"existing_too_far_will_move"};if(!je&&we<=Re)return _({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??h),qid:String(h),decision:"skipped_exists_nearby",reason:"incorrect_like",currentIndex:c,windowEnd:te,baseOffset:k,extraDelay:I,pressureDelay:D,plannedOffsetRaw:M,plannedOffset:L,plannedOffsetWithOverride:G,minGapForMode:P,skipDetails:lt,questionPosition:p??null,ssotPosition:g??null,effectivePosition:y??null,outcomeHint:v??null,incorrectLikeDecidedBy:S.decidedBy,consecutiveIncorrect:(x==null?void 0:x.consecutiveIncorrect)??0,reAddedCountBefore:w,note:"already_scheduled_soon"}),a;const ht=a[we],it=((ht==null?void 0:ht.reAddedCount)||0)+1,st={...ht,sessionPriority:Date.now(),reAddedCount:it},Ye=[...a.slice(0,we),...a.slice(we+1)],pt=Math.min(Re,Ye.length),Tt=[...Ye.slice(0,pt),st,...Ye.slice(pt)],se={existingAtIndex:we,existingOffset:we-c,desiredInsertPosition:Re,desiredOffset:G,minAllowedIndex:et,minGap:P,isTooSoonForMinGap:je,wasMoved:!0,moveReason:je?"moved_due_to_min_gap":"moved_existing_earlier"};return _({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??h),qid:String(h),decision:"inserted",reason:"incorrect_like",currentIndex:c,baseOffset:k,extraDelay:I,pressureDelay:D,plannedOffsetRaw:M,plannedOffset:L,plannedOffsetWithOverride:G,minGapForMode:P,moveDetails:se,insertAt:pt,originalInsertAt:we,movedExisting:!0,note:je?"moved_due_to_min_gap":"moved_existing_earlier",questionPosition:p??null,ssotPosition:g??null,effectivePosition:y??null,outcomeHint:v??null,incorrectLikeDecidedBy:S.decidedBy,consecutiveIncorrect:(x==null?void 0:x.consecutiveIncorrect)??0,reAddedCountBefore:(ht==null?void 0:ht.reAddedCount)??null,reAddedCountAfter:it}),Tt}return _({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??h),qid:String(h),decision:"skipped_exists_nearby",reason:C?"incorrect_like":"still_learning_like",currentIndex:c,windowEnd:te,baseOffset:k,extraDelay:I,pressureDelay:D,plannedOffsetRaw:M,plannedOffset:L,plannedOffsetWithOverride:G,minGapForMode:P,skipDetails:{existingAtIndex:we,existingOffset:we-c,desiredOffset:G,skipReason:"not_incorrect_like_already_nearby"},questionPosition:p??null,ssotPosition:g??null,effectivePosition:y??null,outcomeHint:v??null,incorrectLikeDecidedBy:S.decidedBy,consecutiveIncorrect:(x==null?void 0:x.consecutiveIncorrect)??0,reAddedCountBefore:w}),a}let $e=Math.min(c+G,a.length);const Ae=$e;let De=!1;if(V===null&&y!==void 0&&y>=40){const we=Math.max($e,c+1),et=Math.min(we+(C?10:30),a.length);let je=-1;for(let lt=we;lt<et;lt++){const ht=a[lt].position;ht!==void 0&&ht>=40&&(je=lt)}if(je>=0){const lt=$e;$e=je+1,De=$e!==lt}}try{oo.onReAdd(String(h))}catch{}return _({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??h),qid:String(h),decision:"inserted",reason:C?"incorrect_like":"still_learning_like",currentIndex:c,baseOffset:k,extraDelay:I,plannedOffsetRaw:M,plannedOffset:L,plannedOffsetWithOverride:G,minGapForMode:P,insertDetails:{desiredInsertPosition:$e,actualInsertAt:$e,insertOffset:$e-c,positionAwareAdjusted:De,originalInsertAt:Ae,requestedInsertAtIndex:(d==null?void 0:d.insertAtIndex)??null,enforcedAbsoluteInsert:V??null},insertAt:$e,originalInsertAt:Ae,positionAwareAdjusted:De,questionPosition:p??null,ssotPosition:g??null,effectivePosition:y??null,outcomeHint:v??null,incorrectLikeDecidedBy:S.decidedBy,consecutiveIncorrect:(x==null?void 0:x.consecutiveIncorrect)??0,reAddedCountBefore:w,reAddedCountAfter:w+1}),[...a.slice(0,$e),b,...a.slice($e)]},[]),e=N.useCallback((i,a)=>a>=i.length-1?i:i.map((c,l)=>{if(c.sessionPriority&&l>a&&l-a>5){const{sessionPriority:d,...h}=c;return h}return c}),[]),t=N.useCallback(i=>(i.reAddedCount||0)>0,[]),s=N.useCallback((i,a,c)=>{const l=(i.reAddedCount||0)>0;c(d=>({...d,newQuestions:l?d.newQuestions:(d.newQuestions||0)+1,reviewQuestions:l?(d.reviewQuestions||0)+1:d.reviewQuestions||0,consecutiveNew:l?0:(d.consecutiveNew||0)+1,consecutiveReview:l?(d.consecutiveReview||0)+1:0}))},[]),r=N.useCallback((i,a)=>{const c=[];return i.forEach((l,d)=>{if(d>a&&l.sessionPriority){const h=String(l.word||l.japanese||"(unknown)");c.push({word:h,reason:"still_learning",insertAt:d+1,timestamp:l.sessionPriority})}}),c},[]),o=N.useCallback((i,a)=>{try{const c=nt();if(!(c!=null&&c.wordProgress))return{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"LocalStorageÊú™ÂàùÊúüÂåñ"};let l=0,d=0;for(const f of i){const p=f.word;if(!p)continue;const m=f.position,g=Number.isFinite(m)?Number(m):null;if(g===null)continue;const x=c.wordProgress[p];if(!x)continue;const y=Jt(x,a),b=Math.abs(y-g);b>=5&&(l++,d+=b)}const h=l>=10&&d>=200;return{needsRescheduling:h,mismatchCount:l,totalDiff:d,reason:h?`‰∏çÊï¥Âêà${l}Ë™ûÔºàÂ∑ÆÂàÜÂêàË®à: ${d}Ôºâ`:"Ê≠£Â∏∏ÁØÑÂõ≤ÂÜÖ"}}catch(c){return console.error("[useQuestionRequeue] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",c),{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"„ÉÅ„Çß„ÉÉ„ÇØÂ§±Êïó"}}},[]);return{reAddQuestion:n,clearExpiredFlags:e,isReviewQuestion:t,updateRequeueStats:s,getRequeuedWords:r,checkPositionMismatch:o}}const Ck="learning-assistant-skip-groups",m9=5*60*1e3;function gx(){try{const n=localStorage.getItem(Ck);return n?JSON.parse(n):[]}catch(n){return j.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n),[]}}function xx(n){try{localStorage.setItem(Ck,JSON.stringify(n))}catch(e){j.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}function Nk(n){const e=gx(),t=Date.now(),s=e.find(r=>r.verificationStatus==="pending"&&t-r.timestamp<m9);s?s.words.includes(n)||s.words.push(n):e.push({timestamp:t,words:[n],verificationStatus:"pending",suspiciousWords:[]}),xx(e)}function Ik(n){const e=gx(),t=nt(),s=e.find(r=>r.words.includes(n));s&&s.verificationStatus==="pending"&&(s.verificationStatus="suspicious",s.suspiciousWords=s.words.filter(r=>r!==n),s.suspiciousWords.forEach(r=>{if(t.wordProgress[r]){const o=t.wordProgress[r];delete o.skipExcludeUntil,o.masteryLevel="learning",o.consecutiveCorrect=0,o.needsVerification=!0,o.verificationReason=`ÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü„Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Å†„Å£„Åü„Åü„ÇÅ`}}),Or(t),xx(e),j.log(`AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü${s.suspiciousWords.length}ÂÄã„ÅÆÂçòË™û„ÇíÂÜçÂá∫È°åÂØæË±°„Å´„Åó„Åæ„Åô„ÄÇ`))}function kk(n){const e=gx(),t=nt(),s=e.find(r=>r.words.includes(n));s&&(s.suspiciousWords=s.suspiciousWords.filter(o=>o!==n),s.words.every(o=>{const i=t.wordProgress[o];return i&&(i.correctCount>0||i.incorrectCount>0)})&&s.suspiciousWords.length===0&&(s.verificationStatus="verified"),t.wordProgress[n]&&(delete t.wordProgress[n].needsVerification,delete t.wordProgress[n].verificationReason),Or(t),xx(e))}function g9(n,e){const t=nt(),s=new Map;e.forEach(l=>{s.set(l,{correct:0,total:0,mastered:0,wordCount:0})}),t.results.forEach(l=>{if(l.category&&s.has(l.category)){const d=s.get(l.category);d.correct+=l.score,d.total+=l.total}}),n.forEach(l=>{const d=l.category;if(!d||!s.has(d))return;const h=s.get(d);h.wordCount++;const f=t.wordProgress[l.word];if(f){const p=f.correctCount+f.incorrectCount,m=p===1&&f.correctCount===1||f.consecutiveCorrect>=3||f.skippedCount&&f.skippedCount>0,g=p>=3&&f.correctCount/p>=.8&&f.consecutiveCorrect>=2;(m||g)&&h.mastered++}});const r=[],o=[];s.forEach((l,d)=>{if(l.total===0&&l.wordCount===0)return;const h=l.total>0?l.correct/l.total*100:0,f=l.wordCount>0?l.mastered/l.wordCount*100:0,p=h*.6+f*.4;if(p<60){let m,g,x;p<40?(m="critical",g=100,x=14):p<50?(m="moderate",g=70,x=10):(m="minor",g=40,x=7),l.total<10&&(g+=20),r.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,weaknessLevel:m,priorityScore:g,estimatedImprovementDays:x})}else if(p>=75){let m;p>=90?m="expert":p>=80?m="proficient":m="good",o.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,strengthLevel:m})}}),r.sort((l,d)=>d.priorityScore-l.priorityScore),o.sort((l,d)=>d.accuracy-l.accuracy);const i=x9(s),a=y9(r),c=b9(r,o,i);return{weakCategories:r,strongCategories:o,balanceScore:i,improvementPlan:a,aiRecommendations:c}}function x9(n){const e=[];if(n.forEach(i=>{if(i.total>0){const a=i.correct/i.total*100;e.push(a)}}),e.length===0)return 50;const t=e.reduce((i,a)=>i+a,0)/e.length,s=e.reduce((i,a)=>i+Math.pow(a-t,2),0)/e.length,r=Math.sqrt(s),o=Math.max(0,Math.min(100,100-r*2));return Math.round(o)}function y9(n){const e=[],t={},s=[],r=n.slice(0,3);r.forEach(i=>{e.push(i.category);let a;i.weaknessLevel==="critical"?a=15:i.weaknessLevel==="moderate"?a=10:a=5,t[i.category]=a;const c={day:Math.ceil(i.estimatedImprovementDays/2),category:i.category,targetAccuracy:Math.min(i.accuracy+20,80),description:`${i.category}„ÅÆÊ≠£Á≠îÁéá„Çí${Math.round(i.accuracy)}%„Åã„Çâ${Math.min(i.accuracy+20,80)}%„Å´ÊîπÂñÑ`};s.push(c)});const o=r.length>0?Math.max(...r.map(i=>i.estimatedImprovementDays)):0;return{targetCategories:e,dailyQuestions:t,estimatedCompletionDays:o,milestones:s}}function b9(n,e,t){const s=[];if(n.length>0){const o=n[0];s.push(`üéØ ÊúÄÂÑ™ÂÖà: „Äå${o.category}„Äç„ÇíÈáçÁÇπÂ≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºàÁèæÂú®${Math.round(o.accuracy)}% ‚Üí ÁõÆÊ®ô80%Ôºâ`),o.weaknessLevel==="critical"&&s.push(`‚ö†Ô∏è „Äå${o.category}„Äç„ÅØÈáçË¶Å„Å™Âº±ÁÇπ„Åß„Åô„ÄÇÊØéÊó•15Âïè‰ª•‰∏äÂèñ„ÇäÁµÑ„ÇÄ„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô`),n.length>=3&&s.push(`üìö ${n.length}ÂÄã„ÅÆÂº±ÁÇπÂàÜÈáé„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ1„Å§„Åö„Å§ÈõÜ‰∏≠„Åó„Å¶ÊîπÂñÑ„Åó„Åæ„Åó„Çá„ÅÜ`)}if(t<50?s.push(`‚öñÔ∏è Â≠¶Áøí„Éê„É©„É≥„Çπ„ÅåÂÅè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„ÄÇÂº±ÁÇπÂàÜÈáé„Å´ÊôÇÈñì„ÇíÈÖçÂàÜ„Åó„Åæ„Åó„Çá„ÅÜ`):t>=80&&s.push(`‚ú® Á¥†Êô¥„Çâ„Åó„ÅÑ„Éê„É©„É≥„Çπ„Åß„ÅôÔºÅÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ`),e.length>0&&n.length>0){const o=e[0];s.push(`üí™ „Äå${o.category}„Äç„ÅØÂæóÊÑèÂàÜÈáé„Åß„ÅôÔºà${Math.round(o.accuracy)}%Ôºâ„ÄÇ„Åì„ÅÆÂ≠¶ÁøíÊñπÊ≥ï„Çí‰ªñ„ÅÆÂàÜÈáé„Å´„ÇÇÂøúÁî®„Åó„Åæ„Åó„Çá„ÅÜ`)}return n.length>0&&s.push("üß† AIÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅåÂº±ÁÇπÂàÜÈáé„ÅÆÂïèÈ°å„ÇíËá™ÂãïÁöÑ„Å´ÂÑ™ÂÖàÂá∫È°å„Åó„Åæ„Åô"),[...n,...e].reduce((o,i)=>o+i.totalAttempts,0)<50&&s.push("üìà „Åæ„Å†Â≠¶Áøí„Éá„Éº„Çø„ÅåÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ50Âïè‰ª•‰∏äËß£„Åè„Å®„Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Åå„Åß„Åç„Åæ„Åô"),s}function w9(n,e,t=30){if(e.length===0)return n.slice(0,t);const s=[],r=new Map,o=e.slice(0,3).reduce((h,f)=>h+f.priorityScore,0);e.slice(0,3).forEach(h=>{const f=Math.ceil(h.priorityScore/o*t*.7);r.set(h.category,f)}),e.slice(0,3).forEach(h=>{const f=r.get(h.category)||0,p=n.filter(y=>y.category===h.category),m=nt(),g=p.filter(y=>{const b=m.wordProgress[y.word];return b?b.consecutiveCorrect<3:!0}),x=Hf(g).slice(0,f);s.push(...x)});const i=t-s.length,a=new Set(e.slice(0,3).map(h=>h.category)),c=n.filter(h=>!a.has(h.category||"")),l=new Set(s.map(h=>h.word)),d=c.filter(h=>!l.has(h.word));return s.push(...Hf(d).slice(0,i)),Hf(s)}function Hf(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function v9(n){const e={startDate:Date.now(),currentDay:1,targetCategories:n.improvementPlan.targetCategories,initialAccuracies:{},currentAccuracies:{},improvements:{},overallProgress:0,isCompleted:!1};n.weakCategories.forEach(t=>{n.improvementPlan.targetCategories.includes(t.category)&&(e.initialAccuracies[t.category]=t.accuracy,e.currentAccuracies[t.category]=t.accuracy,e.improvements[t.category]=0)}),localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function $k(){const n=localStorage.getItem("radar-improvement-progress");if(!n)return null;try{return JSON.parse(n)}catch{return null}}function S9(n){const e=$k();if(!e)return;const t=Math.floor((Date.now()-e.startDate)/(1e3*60*60*24));e.currentDay=t+1;let s=0;e.targetCategories.forEach(r=>{const o=n.weakCategories.find(c=>c.category===r),i=(o==null?void 0:o.accuracy)||80;e.currentAccuracies[r]=i;const a=i-e.initialAccuracies[r];e.improvements[r]=a,i>=80&&s++}),e.overallProgress=s/e.targetCategories.length*100,e.isCompleted=s===e.targetCategories.length,localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function C9(n,e,t){const s=N9(t),r=I9(t),o=k9(e,t,s);return{word:n,attempts:t,confusedWith:r,learningCurve:s,predictionModel:o}}function N9(n){if(n.length===0)return{accuracyHistory:[],stabilityScore:0,stage:"initial",forgettingPattern:{typicalDecayDays:7,forgettingCount:0},efficiency:{attemptsToMastery:10,currentProgress:0,estimatedDaysToMastery:30}};const e=[],t=5;for(let y=0;y<n.length;y++){const b=Math.max(0,y-t+1),w=n.slice(b,y+1),v=w.filter(S=>S.wasCorrect).length/w.length*100;e.push({timestamp:n[y].timestamp,accuracy:v})}const s=n.slice(-10),r=s.map((y,b)=>{const w=Math.max(0,s.length-5),v=s.slice(w,b+1);return v.filter(S=>S.wasCorrect).length/v.length*100}),o=r.reduce((y,b)=>y+b,0)/r.length,i=r.reduce((y,b)=>y+Math.pow(b-o,2),0)/r.length,a=Math.sqrt(i),c=Math.max(0,Math.min(100,100-a/30*100)),l=s.filter(y=>y.wasCorrect).length/s.length;let d;n.length<3?d="initial":l<.3?d="struggling":l<.7&&c<50?d="improving":l>=.7&&c>=50?d="consolidating":l>=.9&&c>=80?d="mastered":d="improving";const h=n.filter(y=>!y.wasCorrect),f=h.length;let p=7;if(h.length>=2){const y=[];for(let b=1;b<h.length;b++){const w=(h[b].timestamp-h[b-1].timestamp)/864e5;y.push(w)}p=y.reduce((b,w)=>b+w,0)/y.length}const m=Math.min(100,(l*100+c)/2),g=n.length<5?10:Math.ceil(10/(m/100)),x=Math.max(1,Math.ceil((100-m)/5));return{accuracyHistory:e,stabilityScore:c,stage:d,forgettingPattern:{typicalDecayDays:p,lastForgetDate:h.length>0?h[h.length-1].timestamp:void 0,forgettingCount:f},efficiency:{attemptsToMastery:g,currentProgress:m,estimatedDaysToMastery:x}}}function I9(n){const e=new Map;return n.forEach(t=>{if(!t.wasCorrect&&t.userAnswer){const s=t.userAnswer;if(e.has(s)){const r=e.get(s);r.frequency++,r.lastConfusion=t.timestamp}else e.set(s,{confusedWord:t.userAnswer,frequency:1,lastConfusion:t.timestamp,confusionType:"meaning",similarity:.7})}}),Array.from(e.values()).sort((t,s)=>s.frequency-t.frequency).slice(0,5)}function k9(n,e,t){const s=e.slice(-5),r=s.length>0?s.filter(f=>f.wasCorrect).length/s.length*100:50,o=t.stabilityScore/100,i=e.length>0?(Date.now()-e[e.length-1].timestamp)/(1e3*60*60*24):0,a=e.slice(-10).filter(f=>!f.wasCorrect&&f.userAnswer),c=Math.min(1,a.length/5);let l=r;l+=o*20;const d=Math.exp(-i/t.forgettingPattern.typicalDecayDays);l*=d,l-=c*30,l=Math.max(0,Math.min(100,l));const h=Math.min(1,e.length/10);return{nextCorrectProbability:l,predictors:{recentAccuracy:r,stabilityFactor:o,timeSinceLastStudy:i,confusionRisk:c},confidence:h}}function $9(n,e,t){const s=[];return n.forEach(r=>{const o=e[r.word],i=t.get(r.word),a=T9(r,o,i);s.push(a)}),s.sort((r,o)=>o.priority-r.priority)}function T9(n,e,t){if(!e||!t)return{word:n.word,priority:50,reason:"Êñ∞Ë¶èÂçòË™û",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60};const s=t.learningCurve,r=t.predictionModel;switch(s.stage){case"struggling":return{word:n.word,priority:90,reason:`Ëã¶Êà¶‰∏≠ÔºàÊ≠£Á≠îÁéá${r.predictors.recentAccuracy.toFixed(0)}%Ôºâ`,strategy:"immediate_review",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:80};case"improving":{const o=r.predictors.timeSinceLastStudy,i=o>=1&&o<=3;return{word:n.word,priority:i?85:70,reason:`ÊîπÂñÑ‰∏≠Ôºà${o.toFixed(1)}Êó•ÁµåÈÅé„ÄÅÊàêÂäüÁéá${r.nextCorrectProbability.toFixed(0)}%Ôºâ`,strategy:i?"consolidation":"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:75}}case"consolidating":{const o=s.forgettingPattern.typicalDecayDays*.7,i=r.predictors.timeSinceLastStudy,a=Math.abs(i-o)<2;return{word:n.word,priority:a?60:40,reason:`ÂÆöÁùÄÂåñ‰∏≠ÔºàÊ¨°ÂõûÂæ©Áøí„Åæ„Åß${Math.max(0,o-i).toFixed(1)}Êó•Ôºâ`,strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:50}}case"mastered":return{word:n.word,priority:20,reason:"ÁøíÂæóÊ∏à„ÅøÔºàÈï∑ÊúüË®òÊÜ∂Á¢∫Ë™çÔºâ",strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:20};default:return{word:n.word,priority:50,reason:"ÂàùÊúüÊÆµÈöé",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60}}}function A9(n,e){const t=n.filter(a=>a.strategy==="immediate_review");if(t.length===0)return n;const s=[],r=t.slice(0,3);s.push(...r);const o=n.filter(a=>a.strategy==="consolidation");o.length>0&&s.push(o[0]),r.length>0&&e>=10&&s.push(r[0]);const i=n.filter(a=>!s.includes(a));return s.push(...i),s.slice(0,e)}function Cb(n,e){const s=(Date.now()-e)/(1e3*60),r=n.slice(-5),o=n.slice(-10),i=r.length>0?r.filter(b=>b.wasCorrect).length/r.length*100:100,a=o.length>0?o.filter(b=>b.wasCorrect).length/o.length*100:100,c=a-i>10,l=n.length>0?n.reduce((b,w)=>b+w.responseTime,0)/n.length:3e3,d=n.slice(-5).map(b=>b.responseTime),h=R9(d);let f=0;f+=Math.min(40,s*2),c&&(f+=25),h>1.3&&(f+=20),n.slice(-3).filter(b=>!b.wasCorrect).length>=2&&(f+=15),f=Math.min(100,Math.max(0,f));const m=100-f,g=new Date().getHours();let x;g>=6&&g<12?x="morning":g>=12&&g<18?x="afternoon":g>=18&&g<22?x="evening":x="night";const y=E9(f,s,c);return{fatigueLevel:f,concentrationLevel:m,recentPerformance:{last5Accuracy:i,last10Accuracy:a,isDecreasing:c,averageResponseTime:l},sessionStats:{duration:s,questionsAnswered:n.length,correctCount:n.filter(b=>b.wasCorrect).length,startTime:e},breakRecommendation:y,timeOfDay:x}}function R9(n){if(n.length<2)return 1;const e=n.slice(-3),t=n.slice(0,Math.max(1,n.length-3)),s=e.reduce((o,i)=>o+i,0)/e.length,r=t.reduce((o,i)=>o+i,0)/t.length;return r>0?s/r:1}function E9(n,e,t){if(n>=70)return{shouldBreak:!0,reason:"Áñ≤Âä¥„ÅåËìÑÁ©ç„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ5ÂàÜ‰ºëÊÜ©„Åó„Å¶ÈõÜ‰∏≠Âäõ„ÇíÂõûÂæ©„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:5};if(e>=25&&n>=50)return{shouldBreak:!0,reason:"25ÂàÜÁµåÈÅé„Åó„Åæ„Åó„Åü„ÄÇÁü≠„ÅÑ‰ºëÊÜ©„ÅßÂäπÁéá„Åå„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÄÇ",suggestedDuration:5};if(t&&n>=40)return{shouldBreak:!0,reason:"Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ÄÂ∫¶„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:3}}function D9(n,e){const{fatigueLevel:t,concentrationLevel:s,timeOfDay:r,sessionStats:o}=e;return j.log(`üß† Ë™çÁü•Ë≤†Ëç∑AI: Áñ≤Âä¥Â∫¶${t}%, ÈõÜ‰∏≠Âäõ${s}%, ÊôÇÈñìÂ∏Ø: ${r}`),t>=70?(j.log("  üí§ Áñ≤Âä¥Â∫¶È´ò: Á∞°Âçò„Å™Âæ©ÁøíÂïèÈ°å„ÇíÂÑ™ÂÖà"),n.filter(i=>i.estimatedSuccessRate>=70||i.strategy==="spaced_repetition").map(i=>({...i,priority:i.priority+(i.estimatedSuccessRate>=80?20:0),reason:i.reason+" (Áñ≤Âä¥ÊôÇ„ÉªÊòìÂïèÂÑ™ÂÖà)"}))):t>=40?(j.log("  üòê Áñ≤Âä¥Â∫¶‰∏≠: „Éê„É©„É≥„ÇπÈáçË¶ñ"),n.map(i=>i.estimatedSuccessRate<40?{...i,priority:i.priority-20}:i)):s>=70&&o.duration<15?(j.log("  ‚ö° ÈõÜ‰∏≠ÂäõÈ´ò: Êñ∞Ë¶èÂçòË™û„ÉªÈõ£Âïè„ÇíÂÑ™ÂÖà"),n.map(i=>i.strategy==="new_learning"?{...i,priority:i.priority+30,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÊñ∞Ë¶èÂÑ™ÂÖà)"}:i.strategy==="immediate_review"&&i.estimatedSuccessRate<60?{...i,priority:i.priority+20,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÈõ£ÂïèÊåëÊà¶)"}:i)):j9(n,r)}function j9(n,e){switch(e){case"morning":return j.log("  üåÖ Êúù: Êñ∞Ë¶èÂ≠¶Áøí„ÇíÂÑ™ÂÖà"),n.map(t=>t.strategy==="new_learning"?{...t,priority:t.priority+15,reason:t.reason+" (Êúù„ÉªÊñ∞Ë¶èÊúÄÈÅ©)"}:t);case"afternoon":return j.log("  ‚òÄÔ∏è ÂçàÂæå: „Éê„É©„É≥„ÇπÂûã"),n;case"evening":return j.log("  üåÜ Â§ïÊñπ: Âæ©Áøí‰∏≠ÂøÉ"),n.map(t=>t.strategy==="spaced_repetition"||t.strategy==="consolidation"?{...t,priority:t.priority+10,reason:t.reason+" (Â§ïÊñπ„ÉªÂæ©ÁøíÊúÄÈÅ©)"}:t);case"night":return j.log("  üåô Â§ú: ËªΩ„ÅÑÂæ©Áøí„ÅÆ„Åø"),n.filter(t=>t.strategy!=="new_learning"||t.estimatedSuccessRate>=60).map(t=>t.estimatedSuccessRate>=70?{...t,priority:t.priority+15,reason:t.reason+" (Â§ú„ÉªÂæ©ÁøíÊé®Â•®)"}:t);default:return n}}function _9(n){const{fatigueLevel:e,breakRecommendation:t}=n;return t!=null&&t.shouldBreak?`üí° ${t.reason}`:e>=60?"üòå Â∞ë„ÅóÁñ≤„Çå„Å¶„Åç„Åü„Åã„ÇÇ„ÄÇÁÑ°ÁêÜ„Åõ„Åö„Éû„Ç§„Éö„Éº„Çπ„ÅßÔºÅ":e<=20?"‚ú® ÈõÜ‰∏≠Âäõ„Éê„ÉÉ„ÉÅ„É™ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ":""}function P9(n,e){const t=new Map,s=[],r=[];let o=0;const i=e.slice(-10),a=i.length>0?i.filter(h=>!h.wasCorrect).length/i.length*100:0;Object.entries(n).forEach(([h,f])=>{o+=f.incorrectCount,f.learningHistory&&f.learningHistory.filter(m=>!m.wasCorrect).forEach(m=>{if(m.userAnswer&&L9(h,m.userAnswer)&&t.set("similar_spelling",(t.get("similar_spelling")||0)+1),m.userAnswer){const g=s.find(x=>x.word1===h&&x.word2===m.userAnswer||x.word2===h&&x.word1===m.userAnswer);g?(g.confusionCount++,g.lastConfusion=m.timestamp):m.userAnswer!==h&&s.push({word1:h,word2:m.userAnswer,confusionCount:1,lastConfusion:m.timestamp,pattern:"confusion_pair"})}})});const c=e.slice(-5),l=c.length>0?c.filter(h=>!h.wasCorrect).length/c.length*100:0,d=l<a-10?"improving":l>a+10?"declining":"stable";return{totalErrors:o,errorsByPattern:t,confusionPairs:s.sort((h,f)=>f.confusionCount-h.confusionCount),weakCategories:r,recentErrorRate:a,errorTrend:d}}function M9(n,e,t,s,r){const o=[];let i=30;if(e){const f=e.correctCount+e.incorrectCount;if(f>0){const p=e.incorrectCount/f*100;p>50&&(i+=30,o.push({type:"category_weakness",weight:.3,description:"„Åì„ÅÆÂçòË™û„ÅÆÈÅéÂéª„ÅÆË™§Á≠îÁéá„ÅåÈ´ò„ÅÑ",evidence:[`Ë™§Á≠îÁéá: ${p.toFixed(0)}%`]}))}if(e.learningHistory&&e.learningHistory.length>0){const p=e.learningHistory.slice(-3),m=p.filter(g=>!g.wasCorrect).length/p.length*100;m>66&&(i+=25,o.push({type:"timing_based",weight:.25,description:"ÊúÄËøë3Âõû„ÅÆ„ÅÜ„Å°2Âõû‰ª•‰∏äÈñìÈÅï„Åà„Å¶„ÅÑ„Çã",evidence:[`Áõ¥Ëøë3Âõû„ÅÆË™§Á≠îÁéá: ${m.toFixed(0)}%`]}))}if(e.lastStudied){const p=(Date.now()-e.lastStudied)/864e5;if(p>7){const m=Math.min(20,p*2);i+=m,o.push({type:"timing_based",weight:m/100,description:"ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµåÈÅé„Åó„Å¶„ÅÑ„Çã",evidence:[`${p.toFixed(1)}Êó•Ââç„Å´Âæ©Áøí`]})}}}else i+=20,o.push({type:"category_weakness",weight:.2,description:"„Åæ„Å†Â≠¶Áøí„Åó„Åü„Åì„Å®„Åå„Å™„ÅÑÂçòË™û",evidence:["ÂàùË¶ã"]});const a=t.confusionPairs.find(f=>f.word1===n||f.word2===n);if(a&&a.confusionCount>=2){i+=15;const f=a.word1===n?a.word2:a.word1;o.push({type:"confusion_pair",weight:.15,description:`"${f}"„Å®Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ`,evidence:[`${a.confusionCount}ÂõûÊ∑∑Âêå`]})}if(s>60){const f=(s-60)/2;i+=f,o.push({type:"timing_based",weight:f/100,description:"Áñ≤Âä¥„Å´„Çà„ÇäÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Çã",evidence:[`Áñ≤Âä¥Â∫¶: ${s.toFixed(0)}%`]})}t.errorTrend==="declining"&&(i+=10,o.push({type:"category_weakness",weight:.1,description:"ÂÖ®‰ΩìÁöÑ„Å´Ë™§Á≠îÁéá„Åå‰∏äÊòáÂÇæÂêë",evidence:[`ÊúÄËøë10Âïè„ÅÆË™§Á≠îÁéá: ${t.recentErrorRate.toFixed(0)}%`]}));const c=Math.min(100,Math.max(0,i)),l=c>=80?"critical":c>=60?"high":c>=40?"medium":"low",d=F9(n,c,l,o,a),h=O9(e,o.length);return{word:n,errorRisk:c,confidence:h,primaryPattern:o.length>0?o[0].type:"category_weakness",riskFactors:o,warningLevel:l,suggestedSupport:d}}function F9(n,e,t,s,r){const o=[],i=[];let a="",c="";return t==="critical"?(a=`‚ö†Ô∏è Ê≥®ÊÑè: „Åì„ÅÆÂïèÈ°å„ÅØÈñìÈÅï„Åà„ÇÑ„Åô„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„ÅôÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÅ„Åó„Å£„Åã„ÇäËÄÉ„Åà„Å¶„Åã„ÇâÁ≠î„Åà„Åæ„Åó„Çá„ÅÜÔºÅ"):t==="high"?(a=`üîî „Åì„ÅÆÂïèÈ°å„ÅØÂ∞ë„ÅóÈõ£„Åó„ÅÑ„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„ÇìÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Çå„Å∞Â§ß‰∏àÂ§´„Åß„ÅôÔºÅ"):t==="medium"&&(a=`üí° ÊÖéÈáç„Å´Á≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶Âèñ„ÇäÁµÑ„Åø„Åæ„Åó„Çá„ÅÜÔºÅ"),s.forEach(l=>{switch(l.type){case"confusion_pair":if(r){const d=r.word1===n?r.word2:r.word1;o.push(`"${d}"„Å®Ê∑∑Âêå„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Ê≥®ÊÑè`),i.push(d)}break;case"similar_spelling":o.push("Á∂¥„Çä„Çí„Çà„ÅèÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ");break;case"timing_based":l.description.includes("ÊôÇÈñì„ÅåÁµåÈÅé")?o.push("ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÑèÂë≥„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"):l.description.includes("Áñ≤Âä¥")&&o.push("Áñ≤„Çå„Å¶„ÅÑ„Çã„Å®„Åç„ÅØÁÑ¶„Çâ„Åö„ÄÅ„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Åæ„Åó„Çá„ÅÜ");break;case"category_weakness":o.push("„Åì„ÅÆÂçòË™û„ÅØÈÅéÂéª„Å´ÈñìÈÅï„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÖéÈáç„Å´ÔºÅ");break}}),{showWarning:t!=="low",warningMessage:a,hints:o.slice(0,2),reviewWords:i,confidenceBooster:c}}function O9(n,e){let t=50;if(n){const s=n.correctCount+n.incorrectCount;t+=Math.min(30,s*5),n.learningHistory&&n.learningHistory.length>=3&&(t+=10)}return t+=Math.min(10,e*3),Math.min(100,t)}function L9(n,e){const t=z9(n.toLowerCase(),e.toLowerCase());return t>0&&t<=2}function z9(n,e){const t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=n.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let r=1;r<=n.length;r++)e.charAt(s-1)===n.charAt(r-1)?t[s][r]=t[s-1][r-1]:t[s][r]=Math.min(t[s-1][r-1]+1,t[s][r-1]+1,t[s-1][r]+1);return t[e.length][n.length]}function W9(n,e,t,s,r){const o=new Map;return n.forEach(i=>{const a=M9(i,e[i],t,s);o.set(i,a)}),o}function Tk(n=Date.now()){const e=new Date(n).getHours();return e>=5&&e<12?"morning":e>=12&&e<17?"afternoon":e>=17&&e<21?"evening":"night"}function B9(n,e,t,s,r,o,i,a){const c=(e-n)/6e4,l=t>0?s/t*100:0;return{sessionId:`session_${n}`,startTime:n,endTime:e,duration:c,timeOfDay:Tk(n),questionsAnswered:t,correctAnswers:s,accuracy:l,averageResponseTime:r,fatigueLevel:o,newWordsLearned:i,reviewedWords:a}}function V9(n){return["morning","afternoon","evening","night"].map(t=>{const s=n.filter(g=>g.timeOfDay===t);if(s.length===0)return{timeOfDay:t,sessionCount:0,totalQuestions:0,averageAccuracy:0,averageResponseTime:0,averageFatigue:0,efficiencyScore:0,bestForNewLearning:!1,bestForReview:!1};const r=s.reduce((g,x)=>g+x.questionsAnswered,0),i=s.reduce((g,x)=>g+x.correctAnswers,0)/r*100,a=s.reduce((g,x)=>g+x.averageResponseTime,0)/s.length,c=s.reduce((g,x)=>g+x.fatigueLevel,0)/s.length,l=s.reduce((g,x)=>g+x.newWordsLearned,0),d=s.reduce((g,x)=>g+x.reviewedWords,0),h=i,f=Math.max(0,100-a/50),p=100-c,m=h*.4+f*.3+p*.3;return{timeOfDay:t,sessionCount:s.length,totalQuestions:r,averageAccuracy:i,averageResponseTime:a,averageFatigue:c,efficiencyScore:m,bestForNewLearning:l>d,bestForReview:d>=l}}).sort((t,s)=>s.efficiencyScore-t.efficiencyScore)}function U9(n){if(n.length===0)return{optimalDuration:15,currentAverageDuration:0,performanceByDuration:[],recommendation:"Â≠¶Áøí„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åæ„Åö„ÅØ15ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ"};const e=n.reduce((a,c)=>a+c.duration,0)/n.length,s=[{min:0,max:5,label:"0-5ÂàÜ"},{min:5,max:10,label:"5-10ÂàÜ"},{min:10,max:15,label:"10-15ÂàÜ"},{min:15,max:20,label:"15-20ÂàÜ"},{min:20,max:30,label:"20-30ÂàÜ"},{min:30,max:999,label:"30ÂàÜ‰ª•‰∏ä"}].map(a=>{const c=n.filter(f=>f.duration>=a.min&&f.duration<a.max);if(c.length===0)return{durationRange:a.label,accuracy:0,efficiency:0};const l=c.reduce((f,p)=>f+p.accuracy,0)/c.length,d=c.reduce((f,p)=>f+p.fatigueLevel,0)/c.length,h=l-d*.5;return{durationRange:a.label,accuracy:l,efficiency:h}}).filter(a=>a.efficiency>0),r=s.reduce((a,c)=>c.efficiency>a.efficiency?c:a,s[0]||{durationRange:"10-15ÂàÜ",efficiency:0}),o=r?parseInt(r.durationRange.split("-")[0])+5:15;let i="";return o<10?i=`Áü≠ÊúüÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆÁü≠„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥„Çí1Êó•Ë§áÊï∞ÂõûË°å„ÅÜ„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:o<20?i=`${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Åì„ÅÆÈï∑„Åï„ÇíÁõÆÂÆâ„Å´Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`:i=`Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Å™„Çà„ÅÜ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅßÊ∑±„ÅÑÂ≠¶Áøí„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åü„Å†„Åó„ÄÅÁñ≤Âä¥„Å´Ê≥®ÊÑè„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,{optimalDuration:o,currentAverageDuration:e,performanceByDuration:s,recommendation:i}}function G9(n){if(n.length<5)return"moderate";const e=n.reduce((r,o)=>r+o.duration,0)/n.length,t=new Set(n.map(r=>new Date(r.startTime).toDateString())),s=n.length/t.size;return e<10&&s>=2?"distributed":e<10?"short_burst":e<20?"moderate":"extended"}function H9(n,e){var f,p,m;const t=G9(e),s=V9(e),r=U9(e),o=((f=s[0])==null?void 0:f.timeOfDay)||"morning",i=r.optimalDuration;let a=1;t==="distributed"||t==="short_burst"?a=3:t==="moderate"&&(a=2);const c=[],l=[];((p=s[0])==null?void 0:p.averageAccuracy)>80&&c.push(`${s[0].timeOfDay}„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑèÔºàÊ≠£Á≠îÁéá${s[0].averageAccuracy.toFixed(0)}%Ôºâ`),t==="distributed"?c.push("ÂàÜÊï£Â≠¶Áøí„Å´„Çà„ÇäË®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåËâØÂ•Ω"):t==="extended"&&c.push("Èï∑ÊôÇÈñì„ÅÆÈõÜ‰∏≠Â≠¶Áøí„ÅåÂèØËÉΩ"),e.reduce((g,x)=>g+x.fatigueLevel,0)/e.length>60&&l.push("Áñ≤Âä¥„É¨„Éô„É´„ÅåÈ´ò„ÇÅ„ÄÇ‰ºëÊÜ©„ÇíÂ¢ó„ÇÑ„Åô„Åã„ÄÅ„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÁü≠Á∏Æ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"),((m=s[s.length-1])==null?void 0:m.averageAccuracy)<60&&l.push(`${s[s.length-1].timeOfDay}„ÅÆÂ≠¶ÁøíÂäπÁéá„Åå‰Ωé„ÅÑ„Åü„ÇÅ„ÄÅÈÅø„Åë„Çã„Åì„Å®„ÇíÊé®Â•®`);const h=[];return h.push(`ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø: ${o==="morning"?"Êúù":o==="afternoon"?"ÂçàÂæå":o==="evening"?"Â§ïÊñπ":"Â§ú"}`),h.push(`Êé®Â•®„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑: ${i}ÂàÜ`),h.push(`1Êó•„ÅÆÊé®Â•®Â≠¶ÁøíÂõûÊï∞: ${a}Âõû`),t==="distributed"?h.push("Áü≠„ÅÑÂ≠¶Áøí„ÇíË§áÊï∞ÂõûË°å„ÅÜ„Çπ„Çø„Ç§„É´„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇÊúù„ÉªÊòº„ÉªÂ§ú„Å´ÂàÜ„Åë„Å¶Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ"):t==="extended"&&h.push("Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Åß„Åô„ÄÇÈÄ±Êú´„Å™„Å©„Å´„Åæ„Å®„ÇÅ„Å¶Â≠¶Áøí„Åô„ÇãÊñπÊ≥ï„ÇÇÊúâÂäπ„Åß„Åô"),{userId:n,primaryStyle:t,bestTimeOfDay:o,optimalSessionLength:i,optimalDailyFrequency:a,strengths:c,improvements:l,personalizedRecommendations:h}}function q9(n){try{const e="learning-style-sessions",t=localStorage.getItem(e),s=t?JSON.parse(t):[];s.push(n);const r=s.slice(-100);localStorage.setItem(e,JSON.stringify(r))}catch(e){j.error("Failed to save session history:",e)}}function K9(){try{const e=localStorage.getItem("learning-style-sessions");return e?JSON.parse(e):[]}catch(n){return j.error("Failed to load session history:",n),[]}}function X9(n,e){const t=e===n.bestTimeOfDay,s={morning:"Êúù",afternoon:"ÂçàÂæå",evening:"Â§ïÊñπ",night:"Â§ú"};return t?`‚ú® ‰ªä„ÅØ${s[e]}„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆÊúÄ„ÇÇÂ≠¶ÁøíÂäπÁéá„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„Åß„ÅôÔºÅ${n.optimalSessionLength}ÂàÜÁ®ãÂ∫¶„ÅÆÂ≠¶Áøí„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:`üí° ${s[n.bestTimeOfDay]}„ÅÆÂ≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÊûúÁöÑ„Åß„Åô„ÄÇÁèæÂú®„ÅØ${s[e]}„Å™„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ`}const Q9={first_session:{type:"first_session",name:"Â≠¶ÁøíÈñãÂßã",description:"Âàù„ÇÅ„Å¶„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÂÆå‰∫Ü",icon:"üéì",rarity:"common"},streak_3_days:{type:"streak_3_days",name:"‰∏âÊó•Âùä‰∏ªÂÖãÊúç",description:"3Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üî•",rarity:"common"},streak_7_days:{type:"streak_7_days",name:"‰∏ÄÈÄ±Èñì„ÅÆÁøíÊÖ£",description:"7Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"‚≠ê",rarity:"rare"},streak_30_days:{type:"streak_30_days",name:"ÁøíÊÖ£„ÅÆÈÅî‰∫∫",description:"30Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üèÜ",rarity:"epic"},total_100_words:{type:"total_100_words",name:"ÁôæÂçòË™û",description:"Á¥ØË®à100ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìö",rarity:"common"},total_500_words:{type:"total_500_words",name:"‰∫îÁôæÂçòË™û",description:"Á¥ØË®à500ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìñ",rarity:"rare"},total_1000_words:{type:"total_1000_words",name:"ÂçÉÂçòË™û„Éû„Çπ„Çø„Éº",description:"Á¥ØË®à1000ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üéñÔ∏è",rarity:"epic"},perfect_session:{type:"perfect_session",name:"„Éë„Éº„Éï„Çß„ÇØ„Éà",description:"1„Çª„ÉÉ„Ç∑„Éß„É≥ÂÖ®ÂïèÊ≠£Ëß£",icon:"üíØ",rarity:"rare"},accuracy_90:{type:"accuracy_90",name:"È´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá90%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üéØ",rarity:"rare"},accuracy_95:{type:"accuracy_95",name:"Ë∂ÖÈ´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá95%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üíé",rarity:"epic"},early_bird:{type:"early_bird",name:"Êó©Ëµ∑„ÅçÈ≥•",description:"ÊúùÔºà6-9ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåÖ",rarity:"common"},night_owl:{type:"night_owl",name:"Â§úÂûãÂ≠¶Áøí",description:"Â§úÔºà21-24ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåô",rarity:"common"},speed_master:{type:"speed_master",name:"„Çπ„Éî„Éº„Éâ„Éû„Çπ„Çø„Éº",description:"Âπ≥ÂùáÂøúÁ≠îÊôÇÈñì2Áßí‰ª•‰∏ã„Çí10ÂõûÈÅîÊàê",icon:"‚ö°",rarity:"rare"},review_champion:{type:"review_champion",name:"Âæ©Áøí„ÉÅ„É£„É≥„Éî„Ç™„É≥",description:"Ë¶ÅÂæ©ÁøíÂçòË™û50ÂÄã„Çí„Éû„Çπ„Çø„Éº",icon:"‚ôªÔ∏è",rarity:"rare"},master_100:{type:"master_100",name:"ÁôæÂçòË™û„Éû„Çπ„Çø„Éº",description:"100ÂçòË™û„ÇíÂÆåÂÖ®ÁøíÂæó",icon:"üëë",rarity:"epic"},comeback:{type:"comeback",name:"„Ç´„É†„Éê„ÉÉ„ÇØ",description:"1ÈÄ±Èñì‰ª•‰∏ä„ÅÆ‰∏≠Êñ≠Âæå„Å´ÂÜçÈñã",icon:"üí™",rarity:"common"},marathon:{type:"marathon",name:"„Éû„É©„ÇΩ„É≥„É©„É≥„Éä„Éº",description:"1ÊôÇÈñì‰ª•‰∏ä„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥",icon:"üèÉ",rarity:"rare"},focused:{type:"focused",name:"ÈõÜ‰∏≠Âäõ„ÅÆÊ•µ„Åø",description:"ÈõÜ‰∏≠Âäõ„ÅÆÈ´ò„ÅÑÂ≠¶Áøí„Çí10Âõû",icon:"üßò",rarity:"rare"}},Ak=n=>Math.floor(100*Math.pow(1.15,n-1)),sc={CORRECT_ANSWER:10,PERFECT_SESSION:100,STREAK_BONUS_PER_DAY:5,SESSION_COMPLETION:50,BADGE_EARNED:200},Rk=()=>{const n=localStorage.getItem("gamificationStats");if(n){const e=JSON.parse(n);return e.lastSessionDate&&(e.lastSessionDate=new Date(e.lastSessionDate)),e.badges=e.badges.map(t=>({...t,earnedAt:t.earnedAt?new Date(t.earnedAt):void 0})),e.milestones=e.milestones.map(t=>({...t,completedAt:t.completedAt?new Date(t.completedAt):void 0})),e.challenges=e.challenges.map(t=>({...t,startDate:new Date(t.startDate),endDate:new Date(t.endDate)})),e}return{level:{level:1,currentXP:0,requiredXP:Ak(1),totalXP:0},badges:[],streak:{current:0,longest:0,lastStudyDate:""},milestones:J9(),challenges:[],totalSessions:0,totalWordsLearned:0,totalCorrectAnswers:0,averageAccuracy:0}},Y9=n=>{localStorage.setItem("gamificationStats",JSON.stringify(n))},J9=()=>[{id:"first_10_words",title:"ÊúÄÂàù„ÅÆ10ÂçòË™û",description:"10ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:10,current:0,reward:{xp:100},completed:!1},{id:"first_50_words",title:"50ÂçòË™ûÈÅîÊàê",description:"50ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:50,current:0,reward:{xp:300,badge:"total_100_words"},completed:!1},{id:"accuracy_80",title:"Ê≠£Á≠îÁéá80%",description:"Ê≠£Á≠îÁéá80%‰ª•‰∏ä„ÇíÈÅîÊàê",target:80,current:0,reward:{xp:200},completed:!1}],Z9=(n,e)=>{const t={...n};t.level.currentXP+=e,t.level.totalXP+=e;let s=!1,r;for(;t.level.currentXP>=t.level.requiredXP;)t.level.currentXP-=t.level.requiredXP,t.level.level+=1,t.level.requiredXP=Ak(t.level.level),s=!0,r=t.level.level;return{stats:t,leveledUp:s,newLevel:r}},eY=n=>{const e=new Date().toISOString().split("T")[0],t=n.streak.lastStudyDate;if(!t)return{...n,streak:{current:1,longest:1,lastStudyDate:e}};if(t===e)return n;const s=new Date;s.setDate(s.getDate()-1);const r=s.toISOString().split("T")[0];if(t===r){const o=n.streak.current+1;return{...n,streak:{current:o,longest:Math.max(o,n.streak.longest),lastStudyDate:e}}}else return{...n,streak:{current:1,longest:n.streak.longest,lastStudyDate:e}}},tY=(n,e)=>{const t=[],s=new Set(n.badges.map(a=>a.type)),r=a=>{if(!s.has(a)){const c={...Q9[a],earnedAt:new Date};t.push(c),s.add(a)}};n.totalSessions===1&&!s.has("first_session")&&r("first_session"),n.streak.current>=3&&r("streak_3_days"),n.streak.current>=7&&r("streak_7_days"),n.streak.current>=30&&r("streak_30_days"),n.totalWordsLearned>=100&&r("total_100_words"),n.totalWordsLearned>=500&&r("total_500_words"),n.totalWordsLearned>=1e3&&r("total_1000_words"),e.perfectScore&&r("perfect_session");const o=n.totalSessions;return e.accuracy>=90&&o>=10&&r("accuracy_90"),e.accuracy>=95&&o>=10&&r("accuracy_95"),e.timeOfDay==="morning"&&n.totalSessions>=5&&r("early_bird"),e.timeOfDay==="night"&&n.totalSessions>=5&&r("night_owl"),e.avgResponseTime<=2e3&&n.totalSessions>=10&&r("speed_master"),e.sessionDuration>=60&&r("marathon"),e.focused&&n.totalSessions>=10&&r("focused"),n.lastSessionDate&&(new Date().getTime()-n.lastSessionDate.getTime())/864e5>=7&&r("comeback"),{stats:{...n,badges:[...n.badges,...t]},newBadges:t}},nY=n=>{const e=[],t=n.milestones.map(s=>{if(s.completed)return s;let r=s.current;if(s.id.includes("words")?r=n.totalWordsLearned:s.id.includes("accuracy")&&(r=n.averageAccuracy),r>=s.target&&!s.completed){const i={...s,current:r,completed:!0,completedAt:new Date};return e.push(i),i}return{...s,current:r}});return{stats:{...n,milestones:t},completedMilestones:e}},sY=(n,e,t,s,r,o)=>{let i=Rk();const a=[];let c=0;i.totalSessions+=1,i.totalWordsLearned+=r,i.totalCorrectAnswers+=n,i.averageAccuracy=(i.averageAccuracy*(i.totalSessions-1)+n/e*100)/i.totalSessions,i.lastSessionDate=new Date;const l=i.streak.current;i=eY(i),i.streak.current>l&&(a.push({type:"streak",message:`üî• ${i.streak.current}Êó•ÈÄ£Á∂öÂ≠¶ÁøíÔºÅ`,icon:"üî•",priority:4}),c+=sc.STREAK_BONUS_PER_DAY*i.streak.current);const d=n/e*100,h=n===e;c+=n*sc.CORRECT_ANSWER,c+=sc.SESSION_COMPLETION,h&&(c+=sc.PERFECT_SESSION,a.push({type:"praise",message:"üíØ „Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅÂÖ®ÂïèÊ≠£Ëß£„Åß„ÅôÔºÅ",icon:"üíØ",priority:5}));const f=new Date().getHours();let p;f>=6&&f<12?p="morning":f>=12&&f<18?p="afternoon":f>=18&&f<21?p="evening":p="night";const m=o<.3,g=tY(i,{accuracy:d,avgResponseTime:t,perfectScore:h,timeOfDay:p,sessionDuration:s,focused:m});i=g.stats,g.newBadges.length>0&&g.newBadges.forEach(b=>{a.push({type:"milestone",message:`üéñÔ∏è „Éê„ÉÉ„Ç∏Áç≤Âæó: ${b.name}`,icon:b.icon,priority:5}),c+=sc.BADGE_EARNED});const x=nY(i);i=x.stats,x.completedMilestones.length>0&&x.completedMilestones.forEach(b=>{a.push({type:"milestone",message:`üéØ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÈÅîÊàê: ${b.title}`,icon:"üéØ",priority:4}),c+=b.reward.xp});const y=Z9(i,c);return i=y.stats,y.leveledUp&&y.newLevel&&a.push({type:"level_up",message:`‚≠ê „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ Lv.${y.newLevel}`,icon:"‚≠ê",priority:5}),d<50?a.push({type:"encouragement",message:"üí™ ÁÑ¶„Çâ„ÅöÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºÅÁ∂ôÁ∂ö„ÅåÂ§ßÂàá„Åß„Åô",icon:"üí™",priority:2}):d>=50&&d<80?a.push({type:"encouragement",message:"üëç ËâØ„ÅÑ„Éö„Éº„Çπ„Åß„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÔºÅ",icon:"üëç",priority:2}):d>=80&&d<95&&a.push({type:"praise",message:"üåü Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÈ´ò„ÅÑÊ≠£Á≠îÁéá„Åß„Åô",icon:"üåü",priority:3}),Y9(i),{stats:i,feedback:a.sort((b,w)=>w.priority-b.priority),xpGained:c,leveledUp:y.leveledUp,newLevel:y.newLevel}},rY=()=>{const n=Rk(),e=[];return n.streak.current>0&&e.push(`üî• ${n.streak.current}Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ`),n.level.level>1&&e.push(`‚≠ê „É¨„Éô„É´ ${n.level.level}`),n.level.currentXP/n.level.requiredXP*100>80&&e.push("Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ"),e.length===0&&e.push("‰ªäÊó•„ÇÇÂ≠¶Áøí„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ"),e.join(" | ")},wi=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:Dc,addSessionHistory:_a,calculateSessionStats:px,checkFlexibleMastery:J0,createWeakWordsQuestionSet:wd,filterSkippedWords:ex,getAllWordProgress:Zi,getConfusedWords:nx,getCumulativeProgressData:ix,getCurrentWeakWords:rf,getCustomQuestionSets:cf,getDetailedRetentionStats:pd,getGrammarDetailedRetentionStats:md,getGrammarRetentionRateWithAI:vd,getGrammarUnitStats:X0,getGrammarUnitStatsWithTitles:fx,getMemorizationCardSettings:lx,getMemorizationDetailedRetentionStats:K0,getMemorizationSettings:dx,getMonthlyStats:H0,getNearMasteryStats:hk,getOvercomeWeakWords:Y0,getRecentlyMasteredWords:q0,getRetentionRateWithAI:xd,getRetentionTrend:ax,getStudyCalendarByMode:ox,getStudySettings:U0,getTodayIncorrectWords:hd,getTodayStats:fd,getTotalAnsweredCount:sx,getTotalMasteredWordsCount:af,getUniqueQuestionedWordsCount:pk,getWeeklyStats:G0,getWordDetailedData:yd,getWordProgress:gd,isWordSkipExcluded:Z0,loadProgress:bs,loadProgressSync:nt,recordConfusion:tx,recordMemorizationBehavior:hx,recordWordSkip:of,resetAllProgress:rx,saveCustomQuestionSet:bd,saveMemorizationCardSettings:cx,saveMemorizationSettings:ux,saveProgress:Or,updateProgressCache:Yr,updateWordProgress:Wo},Symbol.toStringTag,{value:"Module"}));function Ao(n){return n[Math.floor(Math.random()*n.length)]}function oY(){const n=localStorage.getItem("progress-data");if(!n)return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0};try{const t=JSON.parse(n).results||[],s=t.slice(-10),r=s.length>0?s.reduce((g,x)=>g+x.score/x.total*100,0)/s.length:0,o=new Map;t.forEach(g=>{if(g.category){const x=o.get(g.category)||{correct:0,total:0};x.correct+=g.score,x.total+=g.total,o.set(g.category,x)}});const i=[],a=[];o.forEach((g,x)=>{const y=g.total>0?g.correct/g.total*100:0;y>=80&&i.push(x),y<60&&a.push(x)});const c=s.slice(0,5),l=s.slice(-5),d=c.length>0?c.reduce((g,x)=>g+x.score/x.total*100,0)/c.length:0,f=(l.length>0?l.reduce((g,x)=>g+x.score/x.total*100,0)/l.length:0)>d+5,p=new Set(t.map(g=>new Date(g.date).toDateString())),m=Math.min(100,p.size*5);return{totalSessions:t.length,averageAccuracy:r,strongCategories:i,weakCategories:a,recentImprovement:f,consistencyScore:m}}catch{return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0}}}function yx(){const n=new Date().getHours();return n>=5&&n<12?"morning":n>=12&&n<17?"afternoon":n>=17&&n<21?"evening":"night"}class iY{generateCorrectComment(e){const t=[],s=oY();return e.attemptCount===1?(e.responseTime<3e3&&t.push(Ao(["ÈÄü„ÅÑÔºÅ","ÂèçÂøú„ÅåÈã≠„ÅÑ„ÅûÔºÅ","Âç≥Á≠î„Å†„Å™ÔºÅ"])),t.push(Ao(["„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","Ê≠£Ëß£„Å†ÔºÅ"]))):e.attemptCount===2?t.push(Ao(["2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ","„ÇÑ„Å£„Å®Ê≠£Ëß£„Åó„Åü„Å™„ÄÇ"])):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèÊ±∫„ÇÅ„ÇçÔºÅ")),e.difficulty==="advanced"&&e.attemptCount===1?t.push(Ao(["‰∏äÁ¥öÂçòË™û„Çí‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ","Èõ£„Åó„ÅÑÂçòË™û„ÇÇ„ÇØ„É™„Ç¢„Å†„Å™ÔºÅ"])):e.difficulty==="beginner"&&e.attemptCount>1&&t.push("ÂàùÁ¥ö„Åß„ÇÇ„Åü„Å§„Åè„Å™ÔºÅ"),e.correctStreak>=10?(t.push(`È©öÁï∞„ÅÆ${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(Ao(["ÂÆåÂÖ®„Å´Ê≥¢„Å´‰πó„Å£„Å¶„Çã„Å™ÔºÅ","„Åì„ÅÆ„Åæ„ÅæÁ™Å„Å£Ëµ∞„ÇåÔºÅ"]))):e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(Ao(["Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åü„Å™ÔºÅ","„ÅÑ„ÅÑÊµÅ„Çå„Å†ÔºÅ"]))):e.correctStreak>=3&&t.push("3ÈÄ£Á∂ö„Å†„ÄÇ"),s.recentImprovement&&s.totalSessions>=10&&t.push(Ao(["ÊúÄËøë„ÅÆÊàêÈï∑„ÅåËëó„Åó„ÅÑ„ÅûÔºÅ","Ââç„Çà„ÇäÁ¢∫ÂÆü„Å´Âº∑„Åè„Å™„Å£„Å¶„ÇãÔºÅ"])),e.isWeakCategory&&e.isCorrect&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push(Ao(["ÊàêÈï∑„ÇíÊÑü„Åò„Çã„ÅûÔºÅ","Âº±ÁÇπ„ÇíÊΩ∞„Åó„Åü„Å™ÔºÅ"]))),e.todayQuestions>=50&&e.todayAccuracy>=80&&t.push("‰ªäÊó•„ÅØÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ"),e.timeOfDay==="night"&&e.todayQuestions>=30&&t.push("Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÇãÔºÅ"),e.hasSeenBefore&&e.previousAttempts>2&&(t.push(`Ââç„ÅØ${e.previousAttempts}Âõû„ÇÇ„Åã„Åã„Å£„ÅüÂçòË™û„Å†„ÅûÔºÅ`),t.push("„Çà„ÅÜ„ÇÑ„ÅèË¶ö„Åà„Åü„Å™ÔºÅ")),e.learningPhase==="ENCODING"?t.push("Êñ∞Ë¶èË®òÊÜ∂„ÇíËÑ≥„Å´Âàª„ÅøËæº„Çì„Åß„Çã„ÅûÔºÅ"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„Çã„Å™ÔºÅ"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠„Å†ÔºÅ"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åü„Å™ÔºÅ"),t.push("„Åì„ÅÆË™øÂ≠ê„Å†ÔºÅüí™"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÈÅï„ÅÜÔºÅ"):t.push("„Åæ„ÅüÈñìÈÅï„Åà„ÅüÔºÅ"),e.difficulty==="beginner"&&(t.push("ÂàùÁ¥ö„ÅßÈñìÈÅï„Åà„Çã„Å®„ÅØ‚Ä¶"),t.push("Âü∫Á§é„Åã„Çâ„ÇÑ„ÇäÁõ¥„ÅõÔºÅ")),e.incorrectStreak>=3&&(t.push(`${e.incorrectStreak}ÈÄ£Á∂ö„Éü„ÇπÔºÅ`),t.push("„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ")),e.hasSeenBefore&&(t.push(`Ââç„Å´„ÇÇÈñìÈÅï„Åà„Åü${e.word}„Å†„ÅûÔºÅ`),t.push("‰ΩïÂ∫¶„ÇÑ„Çâ„Åõ„ÇãÊ∞ó„Å†ÔºÅ")),e.todayAccuracy<60&&(t.push("‰ªäÊó•„ÅÆÊ≠£Á≠îÁéá„Åå‰Ωé„ÅÑÔºÅ"),t.push("ÈõÜ‰∏≠„Åó„ÇçÔºÅ")),e.timeOfDay==="night"&&e.todayQuestions>=40?(t.push("Áñ≤„Çå„Å¶„Çã„Å™„Çâ‰ºë„ÇÅÔºÅ"),t.push("„Å†„ÅåÊòéÊó•„ÅØÂÄç„ÇÑ„Çã„Çì„Å†„ÅûÔºÅ")):t.push("Ê∞óÂêà„ÇíÂÖ•„Çå„ÇçÔºÅüî•"),t.join(" ")}}class aY{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„ÅôÔºÅ"),e.attemptCount===1?e.responseTime<3e3?t.push("Á¥†Êó©„ÅÑÂà§Êñ≠„Åß„Åó„Åü„Å≠ ‚ú®"):t.push("„Åó„Å£„Åã„ÇäËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠"):e.attemptCount===2?(t.push("2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü"),t.push("ËêΩ„Å°ÁùÄ„ÅÑ„Å¶ËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠")):e.attemptCount>=3&&(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü`),t.push("Á≤ò„ÇäÂº∑„ÅèÂèñ„ÇäÁµÑ„ÇÅ„Åæ„Åó„Åü„Å≠")),e.difficulty==="advanced"&&(t.push(`${e.word}„ÅØÈõ£„Åó„ÅÑÂçòË™û„Åß„Åó„Åü„Åå„ÄÅ`),t.push("Ë¶ã‰∫ã„Å´Ê≠£Ëß£„Åó„Åæ„Åó„ÅüÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„Åß„ÅôÔºÅ`),t.push("Á¥†Êô¥„Çâ„Åó„ÅÑÈõÜ‰∏≠Âäõ„Åß„Åô„Å≠ üå∏")):e.correctStreak>=3&&t.push("Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åæ„Åó„Åü„Å≠"),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push("Â∞ë„Åó„Åö„Å§ÂæóÊÑè„Å´„Å™„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Çà üòä")),e.hasSeenBefore&&e.previousAttempts>2&&(t.push("ÂâçÂõû„Çà„ÇäÊó©„ÅèÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠"),t.push("Á¢∫ÂÆü„Å´ÊàêÈï∑„Åó„Å¶„ÅÑ„Åæ„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ„ÇÇ„ÅÜ${e.todayQuestions}Âïè„ÇÇÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠`),t.push("ÁÑ°ÁêÜ„Åó„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„Å≠")),e.learningPhase==="ENCODING"?t.push("Ë®òÊÜ∂„ÅÆÁ¨¶Âè∑Âåñ„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô üìù"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Å≠ ‚ú®"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å„Åß„Åç„Å¶„ÅÑ„Åæ„Åô üåü"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Åü„Å≠ üéâ"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÊÉú„Åó„ÅÑ„Åß„Åô"):t.push("Èõ£„Åó„Åã„Å£„Åü„Åß„Åô„Å≠"),t.push("„Åß„ÇÇÂ§ß‰∏àÂ§´„Åß„Åô"),e.difficulty==="advanced"?(t.push(`${e.word}„ÅØ‰∏äÁ¥öÂçòË™û„Å™„ÅÆ„Åß`),t.push("‰ΩïÂ∫¶„ÅãÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ")):e.difficulty==="beginner"&&(t.push("Âü∫Á§éÁöÑ„Å™ÂçòË™û„Å™„ÅÆ„Åß"),t.push("„ÇÜ„Å£„Åè„ÇäË¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.incorrectStreak>=3&&(t.push("Â∞ë„ÅóÁñ≤„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü"),t.push("Ê∑±ÂëºÂê∏„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ üå±")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØË¶ÅÊ≥®ÊÑè„ÅÆÂçòË™û„Åß„Åô„Å≠`),t.push("‰∏ÄÁ∑í„Å´Ë¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.timeOfDay==="night"&&(t.push("Â§ú„ÅØÈõÜ‰∏≠„Åó„Å•„Çâ„ÅÑ„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô"),t.push("ÁÑ°ÁêÜ„Åõ„Åö‰ºëÊÜ©„ÇÇÂ§ßÂàá„Åß„Åô„Çà")),t.push("Ê¨°„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åô„Çà üòä"),t.join(" ")}}class cY{generateCorrectComment(e){const t=[];if(t.push("Ê≠£Ëß£„ÄÇ"),t.push(`ÂøúÁ≠îÊôÇÈñì: ${(e.responseTime/1e3).toFixed(1)}Áßí`),e.attemptCount>1&&t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.correctStreak>0){t.push(`ÈÄ£Á∂öÊ≠£Ëß£: ${e.correctStreak}`);const s=Math.min(100,e.userAccuracy+2);t.push(`Ê≠£Á≠îÁéá: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}if(e.difficulty==="advanced"&&(t.push("Èõ£ÊòìÂ∫¶: ‰∏äÁ¥ö"),t.push("ÊúüÂæÖÊ≠£Á≠îÁéá„Çí‰∏äÂõû„Çã„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ")),e.isWeakCategory){t.push(`Ëã¶Êâã„Ç´„ÉÜ„Ç¥„É™„Éº(${e.category})„ÅßÊ≠£Ëß£`);const s=Math.min(100,e.categoryAccuracy+3);t.push(`„Ç´„ÉÜ„Ç¥„É™„ÉºÊ≠£Á≠îÁéá: ${e.categoryAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return t.push("üìä"),t.join(" ")}generateIncorrectComment(e){const t=[];if(t.push("‰∏çÊ≠£Ëß£„ÄÇ"),t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.incorrectStreak>0){t.push(`ÈÄ£Á∂ö‰∏çÊ≠£Ëß£: ${e.incorrectStreak}`);const s=Math.max(0,e.userAccuracy-2);t.push(`Ê≠£Á≠îÁéáÂΩ±Èüø: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return e.difficulty==="beginner"&&(t.push("Âü∫Á§é„É¨„Éô„É´‰∏çÊ≠£Ëß£Ê§úÂá∫"),t.push("ÂÑ™ÂÖàÂæ©ÁøíÂØæË±°„Å´ËøΩÂä†")),e.hasSeenBefore&&(t.push(`Êó¢Âá∫ÂçòË™û: ${e.previousAttempts+1}ÂõûÁõÆ„ÅÆ‰∏çÊ≠£Ëß£`),t.push("ÁøíÂæóÈõ£ÊòìÂ∫¶„Çπ„Ç≥„Ç¢: È´ò")),t.push("Ê¨°ÂõûÂá∫È°åÁ¢∫Áéá: 80%"),t.join(" ")}}class lY{generateCorrectComment(e){const t=[],s=["„Éä„Ç§„ÇπÔºÅ","„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","„ÇÑ„Å£„ÅüÔºÅ"];return t.push(s[Math.floor(Math.random()*s.length)]),e.attemptCount===1?t.push("‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ"):e.attemptCount===2?t.push("Á´ã„Å¶Áõ¥„Åó„Åü„Å™ÔºÅ"):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ±∫„ÇÅ„ÅüÔºÅ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèË°å„Åì„ÅÜÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÔºÅ`),t.push("„ÅäÂâç„ÅØÁÑ°Êïµ„Å†ÔºÅüî•")):e.correctStreak>=3&&t.push("Ê≥¢„Å´‰πó„Å£„Å¶„Åç„Åü„ÅûÔºÅ"),e.difficulty==="advanced"&&(t.push(`${e.word}„ÇíÂÄí„Åó„ÅüÔºÅ`),t.push("„ÅäÂâç„ÅØÂº∑„ÅÑÔºÅüí™")),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÇíÂÖãÊúçÔºÅ`),t.push("„Åì„Çå„ÅåÊàêÈï∑„Å†ÔºÅ")),e.todayQuestions>=50&&e.todayAccuracy>=80&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÇØ„É™„Ç¢ÔºÅ`),t.push("Áµ∂Â•ΩË™ø„Å†ÔºÅüèÜ")),t.push("„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ"),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÊÉú„Åó„ÅÑÔºÅ"),e.incorrectStreak<3?(t.push("„Å†„Åå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑÔºÅ"),t.push("„ÇÇ„ÅÜ‰∏Ä‰∏ÅÔºÅ")):(t.push("ÈÄ£Á∂ö„Éü„ÇπÔºÅ"),t.push("„Å†„ÅåÂãùË≤†„ÅØ„Åì„Çå„Åã„Çâ„Å†ÔºÅ")),e.difficulty==="beginner"&&(t.push("ÁÑ¶„Å£„Åü„Å™ÔºÅ"),t.push("ËêΩ„Å°ÁùÄ„ÅëÔºÅ")),e.hasSeenBefore&&(t.push(`„Åæ„Åü${e.word}„ÅãÔºÅ`),t.push("‰ªäÂ∫¶„Åì„Åù„É™„Éô„É≥„Ç∏„Å†ÔºÅüí™")),e.todayAccuracy<60?(t.push("Ë™øÂ≠ê„ÅåÊÇ™„ÅÑ„Å™ÔºÅ"),t.push("„Å†„ÅåË≤†„Åë„Çã„Å™ÔºÅ"),t.push("„Åì„Åì„Åã„ÇâÈÄÜËª¢„Å†ÔºÅüî•")):t.push("„ÅäÂâç„Å™„Çâ„Åß„Åç„ÇãÔºÅ"),t.join(" ")}}class uY{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„Åô„ÄÇ"),t.push(`${e.word}„Å®„ÅÑ„ÅÜË®ÄËëâ„Åå„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏ÄÈÉ®„Å´„Å™„Çä„Åæ„Åó„Åü`),e.attemptCount>1&&t.push("Ëø∑„ÅÑ„ÅåÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô"),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„ÄÇ`),t.push("Ë®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåÁ¢∫ÂÆü„Å´„Å™„Çä„Åæ„Åó„Åü üåô")):e.correctStreak>=3&&t.push("Áü•Ë≠ò„ÅåÊ†π„ÇíÂºµ„ÇäÂßã„ÇÅ„Å¶„ÅÑ„Åæ„Åô üå±"),e.difficulty==="advanced"&&(t.push("Èõ£„Åó„ÅÑË®ÄËëâ„ÇíÁêÜËß£„Åó„Åæ„Åó„Åü„Å≠"),t.push("Áü•ÊÅµ„ÅåÊ∑±„Åæ„Çä„Åæ„Åô")),e.isWeakCategory&&(t.push("Ëã¶Êâã„ÇíÂÖãÊúç„Åó„Åæ„Åó„Åü"),t.push("ÊàêÈï∑„Å®„ÅØÂ§âÂåñ„ÇíÂèó„ÅëÂÖ•„Çå„Çã„Åì„Å®„Åß„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÅÆÁµåÈ®ì„ÇíÁ©ç„Åø„Åæ„Åó„Åü`),t.push("‰∏ÄÊó•‰∏ÄÊó•„ÅåÊú™Êù•„Å∏„ÅÆÊäïË≥á„Åß„Åô üìñ")),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÈñìÈÅï„ÅÑ„ÅØÂ≠¶„Å≥„ÅÆÂßã„Åæ„Çä„Åß„Åô„ÄÇ"),e.attemptCount===1?t.push("ÂÜçÂ∫¶ÊåëÊà¶„Åó„Åæ„Åó„Çá„ÅÜ"):(t.push("„Åæ„Å†ÁêÜËß£„ÅÆÈÄî‰∏≠„Åß„Åô"),t.push("ÁÑ¶„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì üå±")),e.difficulty==="beginner"&&t.push("Âü∫Á§é„Å´Êàª„Çã„Åì„Å®„ÅØÊÅ•„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"),e.incorrectStreak>=3&&(t.push("ÈÄ£Á∂ö„ÅßÈñìÈÅï„Åà„Åæ„Åó„Åü"),t.push("‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åß„Åô")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØ„ÅÇ„Å™„Åü„ÅÆË™≤È°å„Åß„Åô`),t.push("‰ΩïÂ∫¶„Åß„ÇÇÂêë„ÅçÂêà„ÅÑ„Åæ„Åó„Çá„ÅÜ")),e.todayAccuracy<60&&(t.push("Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô"),t.push("„Åó„Åã„ÅóÈÅì„ÅØÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô")),t.push("Ë®òÊÜ∂„Å®„ÅØÁπ∞„ÇäËøî„Åó„ÅÆËä∏Ë°ì„Åß„Åô üìñ"),t.join(" ")}}function Ek(n,e){let t;switch(n){case"drill-sergeant":t=new iY;break;case"kind-teacher":t=new aY;break;case"analyst":t=new cY;break;case"enthusiastic-coach":t=new lY;break;case"wise-sage":t=new uY;break}return e.isCorrect?t.generateCorrectComment(e):t.generateIncorrectComment(e)}const dY={"drill-sergeant":{avatar:"üëπ",name:"È¨ºËªçÊõπ",description:"Âé≥„Åó„ÅèÈçõ„Åà„Çã",tone:"Âé≥„Åó„Åè„ÄÅÂ¶•Âçî„Å™„Åó„ÄÅÁµêÊûúÈáçË¶ñ"},"kind-teacher":{avatar:"üòä",name:"ÂÑ™„Åó„ÅÑÂÖàÁîü",description:"‰∏ÅÂØß„Å´„Çµ„Éù„Éº„Éà",tone:"ÂÑ™„Åó„Åè„ÄÅ‰∏ÅÂØß„ÄÅ„Åß„ÇÇÊ≠£Á¢∫"},analyst:{avatar:"ü§ñ",name:"ÂÜ∑Èùô„Å™ÂàÜÊûêÂÆò",description:"„Éá„Éº„Çø„ÅßÂà§Êñ≠",tone:"ÊÑüÊÉÖ„Å™„Åó„ÄÅ‰∫ãÂÆü„ÅÆ„Åø„ÄÅÁµ±Ë®àÈáçË¶ñ"},"enthusiastic-coach":{avatar:"üòº",name:"ÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ",description:"ÁÜ±„ÅèÂøúÊè¥",tone:"ÁÜ±„Åè„ÄÅ„Éù„Ç∏„ÉÜ„Ç£„Éñ„ÄÅÊåëÊà¶ÁöÑ"},"wise-sage":{avatar:"üßô",name:"Ë≥¢ËÄÖ",description:"Èï∑ÊúüË¶ñÁÇπ„ÅßÂ∞é„Åè",tone:"ËêΩ„Å°ÁùÄ„Åç„ÄÅÈï∑ÊúüË¶ñÁÇπ„ÄÅÊú¨Ë≥™ÈáçË¶ñ"}};function Dk(){return localStorage.getItem("lastLoginDate")}function hY(){const n=localStorage.getItem("loginStreak");return n?parseInt(n,10):0}function fY(){const n=Dk();if(!n)return 0;const e=new Date().toISOString().split("T")[0],t=new Date(n),r=new Date(e).getTime()-t.getTime();return Math.floor(r/(1e3*60*60*24))}function pY(){const n=new Date().toISOString().split("T")[0],e=localStorage.getItem(`studyStats-${n}`);if(!e)return{count:0,accuracy:0};const t=JSON.parse(e);return{count:t.count||0,accuracy:t.correct&&t.count?t.correct/t.count*100:0}}function mY(n){const e=yx(),t=fY(),s=hY(),{count:r,accuracy:o}=pY(),i={lastLoginDate:Dk(),todayStudyCount:r,todayAccuracy:o};return t>=3?gY(n,t):s>=7&&r===0?xY(n,s):yY(n,e,i)}function gY(n,e){switch(n){case"drill-sergeant":return e>=7?`${e}Êó•„ÇÇÁ©∫„Åë„Çã„Å®„ÅØ‰Ωï‰∫ã„Å†ÔºÅ‰ªä„Åô„ÅêÂæ©Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ`:`${e}Êó•„Å∂„Çä„Åã„ÄÇÈÅÖ„Çå„ÇíÂèñ„ÇäÊàª„Åô„ÅûÔºÅ`;case"kind-teacher":return e>=7?`üòÉ „Åä‰πÖ„Åó„Å∂„Çä„Åß„ÅôÔºÅ${e}Êó•Áµå„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÁÑ¶„Çâ„ÅöÂ∞ë„Åó„Åö„Å§ÊÄù„ÅÑÂá∫„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`:`üòÉ ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ„ÇÜ„Å£„Åè„ÇäÂæ©Áøí„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`;case"analyst":return e>=7?`ü§ñ ÂâçÂõû„Åã„Çâ${e}Êó•ÁµåÈÅé„ÄÇË®òÊÜ∂ÂÆöÁùÄÁéá„ÅØÊé®ÂÆö40-60%„ÄÇ‰ΩìÁ≥ªÁöÑ„Å™Âæ©Áøí„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`:`ü§ñ ${e}Êó•„ÅÆÈñìÈöî„ÄÇÂøòÂç¥Êõ≤Á∑ö„ÇíËÄÉÊÖÆ„Åó„ÅüÂæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;case"enthusiastic-coach":return e>=7?`üòº ${e}Êó•„Å∂„Çä„ÅÆ„Ç´„É†„Éê„ÉÉ„ÇØÔºÅ‰ªäÊó•„Åã„ÇâÂÜç„Çπ„Çø„Éº„Éà„Å†ÔºÅÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ`:`üòº ÂæÖ„Å£„Å¶„Åü„ÅúÔºÅ${e}Êó•„ÅÆÈÅÖ„Çå„ÅØ‰ªäÊó•Âèñ„ÇäÊàª„Åù„ÅÜÔºÅ`;case"wise-sage":return e>=7?`üßô ${e}Êó•„ÅÆ‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ`:`üßô ${e}Êó•„ÅÆÁ©∫ÁôΩ„ÇÇ„ÄÅ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅÆÊôÇÈñì„Å†„Å£„Åü„ÅÆ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ„Åï„ÅÇ„ÄÅ„ÇÜ„Å£„Åè„ÇäÂÜçÈñã„Åò„ÇÉ„ÄÇ`;default:return`„ÅäÂ∏∞„Çä„Å™„Åï„ÅÑÔºÅ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ`}}function xY(n,e){switch(n){case"drill-sergeant":return`${e}Êó•ÈÄ£Á∂öÔºÅÁ¥†Êô¥„Çâ„Åó„ÅÑÁ∂ôÁ∂öÂäõ„Å†ÔºÅ‰ªäÊó•„ÇÇÊ≤πÊñ≠„Åô„Çã„Å™ÔºÅ`;case"kind-teacher":return`üòÉ ${e}Êó•ÈÄ£Á∂ö„É≠„Ç∞„Ç§„É≥„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„Çä„Åß„Åô„ÄÇ`;case"analyst":return`ü§ñ ${e}Êó•ÈÄ£Á∂ö„ÄÇÁ∂ôÁ∂öÁéá100%„ÄÇÁµ±Ë®àÁöÑ„Å´Â≠¶ÁøíÂäπÊûú„ÅØÊúÄÂ§ßÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;case"enthusiastic-coach":return`üòº ${e}Êó•ÈÄ£Á∂öÈÅîÊàêÔºÅ„Åì„ÅÆÂã¢„ÅÑ„ÅßÁ™Å„ÅçÈÄ≤„ÇÅÔºÅË®òÈå≤Êõ¥Êñ∞„Å†ÔºÅ`;case"wise-sage":return`üßô ${e}Êó•„ÅÆÁ∂ôÁ∂ö„ÄÅË¶ã‰∫ã„Åò„ÇÉ„ÄÇÂçÉÈáå„ÅÆÈÅì„ÇÇ‰∏ÄÊ≠©„Åã„Çâ„ÄÅ„Åò„ÇÉ„Å™„ÄÇ`;default:return""}}function yY(n,e,t){const{todayStudyCount:s,todayAccuracy:r}=t;switch(n){case"drill-sergeant":return bY(e,s);case"kind-teacher":return wY(e,s);case"analyst":return vY(e,s,r);case"enthusiastic-coach":return SY(e,s);case"wise-sage":return CY(e,s);default:return null}}function bY(n,e,t){switch(n){case"morning":return e===0?"Êúù„Å†„ÅûÔºÅËÑ≥„Åå‰∏ÄÁï™ÂÜ¥„Åà„Å¶„ÇãÊôÇÈñì„Å†ÔºÅ‰ªä„Åô„ÅêÂ≠¶Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ":e>=20?"Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÇíÁ∂≠ÊåÅ„Åó„ÇçÔºÅ":"Êúù„ÅÆÂ≠¶Áøí„ÅØÂäπÊûúÁöÑ„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÑ„Çå„Çã„ÅØ„Åö„Å†ÔºÅ";case"afternoon":return e===0?"ÂçàÂæå„Å´„Å™„Å£„Åü„ÅûÔºÅ‰ªäÊó•„ÅØ„Åæ„Å†‰Ωï„ÇÇ„ÇÑ„Å£„Å¶„Å™„ÅÑ„ÅÆ„ÅãÔºü„Åï„Å£„Åï„Å®Âßã„ÇÅ„ÇçÔºÅ":e>=20?"ÂçàÂæå„ÇÇÈ†ÜË™ø„Å†„Å™ÔºÅÂçàÂâç‰∏≠„ÅÆÂã¢„ÅÑ„ÇíËêΩ„Å®„Åô„Å™ÔºÅ":"ÂçàÂæå„ÅØÈõÜ‰∏≠Âäõ„ÅåËêΩ„Å°„ÇÑ„Åô„ÅÑ„ÄÇÊ∞óÂêà„ÇíÂÖ•„ÇåÁõ¥„ÅõÔºÅ";case"evening":return e===0?"„ÇÇ„ÅÜÂ§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÂàÜ„ÅØ‰ªäÊó•‰∏≠„Å´ÁµÇ„Çè„Çâ„Åõ„ÇçÔºÅ":e>=30?"‰ªäÊó•„ÅØ„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅ„ÅÇ„Å®Â∞ë„Åó„ÅßÂÆåÁíß„Å†ÔºÅ":"Â§ïÊñπ„ÅØÂæ©Áøí„ÅÆ„Ç¥„Éº„É´„Éá„É≥„Çø„Ç§„É†„Å†ÔºÅËøΩ„ÅÑËæº„Åø„Çí„Åã„Åë„ÇçÔºÅ";case"night":return e===0?"Â§ú„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„Åü„ÅûÔºÅÂ∞ë„Åó„Åß„ÇÇ„ÅÑ„ÅÑ„Åã„ÇâÂ≠¶Áøí„Åó„ÇçÔºÅ0„Çà„Çä1„Å†ÔºÅ":e>=30?"Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅÊó©„Åè‰ºë„Çì„ÅßÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ":"Â§ú„ÅØËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåÂäπÊûúÁöÑ„Å†ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™ÔºÅ";default:return"„Åï„ÅÇ„ÄÅÂ≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„ÅûÔºÅ"}}function wY(n,e,t){switch(n){case"morning":return e===0?"üòÉ „Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅÊúù„ÅØË®òÊÜ∂Âäõ„ÅåÈ´ò„Åæ„ÇãÊôÇÈñì„Åß„Åô„Çà„ÄÇ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ":e>=20?"üòÉ Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Åß„ÇÇÁÑ°ÁêÜ„ÅØ„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åß„Åô„Å≠ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"afternoon":return e===0?"üòÉ „Åì„Çì„Å´„Å°„ÅØÔºÅÂçàÂæå„ÅØÂ∞ë„ÅóÁú†„Åè„Å™„Çä„ÇÑ„Åô„ÅÑ„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„Çà„ÄÇ":e>=20?"üòÉ ÂçàÂæå„ÇÇ„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅ‰ºëÊÜ©„ÇÇÂøò„Çå„Åö„Å´Âèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ ÂçàÂæå„ÇÇÈ†ÜË™ø„Åß„Åô„Å≠„ÄÇ„Éû„Ç§„Éö„Éº„Çπ„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ";case"evening":return e===0?"üòÉ „Åì„Çì„Å∞„Çì„ÅØ„ÄÇÂ§ïÊñπ„ÅØÂæ©Áøí„Å´ÊúÄÈÅ©„Å™ÊôÇÈñì„Åß„Åô„ÄÇ‰ªäÊó•Â≠¶„Çì„Å†„Åì„Å®„ÇíËªΩ„ÅèË¶ãÁõ¥„Åó„Å¶„Åø„Åæ„Åõ„Çì„ÅãÔºü":e>=30?"üòÉ ‰ªäÊó•„ÅØÊú¨ÂΩì„Å´„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠ÔºÅ„ÇÇ„ÅÜÂçÅÂàÜ„Åß„Åô„Çà„ÄÇ":"üòÉ Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑ„Åß„Åô„Å≠ÔºÅÁÑ¶„Çâ„Åö„ÇÜ„Å£„Åè„ÇäÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"night":return e===0?"üòÉ Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßò„Åß„Åô„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅ„Åß„Åç„ÇãÁØÑÂõ≤„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ":e>=30?"üòÉ ‰ªäÊó•„ÅØÂçÅÂàÜÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅ„Åù„Çç„Åù„Çç‰ºë„Çì„Åß„ÄÅÊòéÊó•„Å´ÂÇô„Åà„Åæ„Åó„Çá„ÅÜ„Å≠„ÄÇ":"üòÉ Â§ú„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åß„Åô„Åå„ÄÅÁù°Áú†„ÇÇÂêå„Åò„Åè„Çâ„ÅÑÂ§ßÂàá„Åß„Åô„Çà„ÄÇ";default:return"üòÉ ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Å≠ÔºÅ"}}function vY(n,e,t){switch(n){case"morning":return e===0?"ü§ñ ÁèæÂú®ÊôÇÂàªÔºöÊúù„ÄÇËÑ≥„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÔºöÊúÄÈÅ©„ÄÇÊñ∞Ë¶èÂ≠¶ÁøíÂäπÁéáÔºö+30%„ÄÇÂ≠¶ÁøíÈñãÂßã„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êúù„ÅÆÂ≠¶Áøí${e}ÂïèÂÆå‰∫Ü„ÄÇÊ≠£Á≠îÁéá${t.toFixed(1)}%„ÄÇËâØÂ•Ω„Å™„Éö„Éº„Çπ„ÄÇ`:"ü§ñ Êúù„ÅÆÂ≠¶ÁøíÈÄ≤Ë°å‰∏≠„ÄÇË™çÁü•Ê©üËÉΩ„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÇíÊ¥ªÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";case"afternoon":return e===0?"ü§ñ ÂçàÂæå„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÈõÜ‰∏≠ÂäõÔºö„ÇÑ„ÇÑ‰Ωé‰∏ãÂÇæÂêë„ÄÇÁü≠ÊôÇÈñìÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êú¨Êó•${e}ÂïèÂ≠¶ÁøíÊ∏à„Åø„ÄÇÂçàÂæå„ÅÆÁîüÁî£ÊÄßÔºöÁ∂≠ÊåÅ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`:"ü§ñ ÂçàÂæå„ÅÆÂ≠¶ÁøíÁ∂ôÁ∂ö‰∏≠„ÄÇ15ÂàÜ√ó3„Çª„ÉÉ„Éà„ÅÆÂàÜÂâ≤Â≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";case"evening":return e===0?"ü§ñ Â§ïÊñπ„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÂæ©ÁøíÂäπÁéáÔºöÊúÄÈ´ò„É¨„Éô„É´„ÄÇ‰ªäÊó•„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÆöÁùÄ„Å´ÊúÄÈÅ©„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÈÅîÊàê„ÄÇÂçÅÂàÜ„Å™Â≠¶ÁøíÈáè„Åß„Åô„ÄÇ‰ºëÊÅØ„ÇíÊé®Â•®„ÄÇ`:"ü§ñ Â§ïÊñπ„ÅÆÂæ©Áøí„Çø„Ç§„É†„ÄÇÊúù„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÜçÁ¢∫Ë™ç„ÅåË®òÊÜ∂ÂÆöÁùÄÁéá„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ";case"night":return e===0?"ü§ñ Â§úÈñì„ÄÇÊñ∞Ë¶èÂ≠¶Áøí„Çà„ÇäÂæ©Áøí„ÇíÊé®Â•®„ÄÇÁù°Áú†Ââç„ÅÆËªΩ„ÅÑÂæ©Áøí„ÅØË®òÊÜ∂„ÅÆÂõ∫ÂÆöÂåñ„Å´ÊúâÂäπ„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÂÆå‰∫Ü„ÄÇÂ≠¶ÁøíÁõÆÊ®ôÈÅîÊàê„ÄÇ22-23ÊôÇ„ÅÆÂ∞±ÂØù„ÅßË®òÊÜ∂ÂÆöÁùÄÁéá„ÅåÂêë‰∏ä„Åó„Åæ„Åô„ÄÇ`:"ü§ñ Â§úÈñìÂ≠¶Áøí‰∏≠„ÄÇÈÅéÂ∫¶„Å™Â≠¶Áøí„ÅØÁù°Áú†„ÅÆË≥™„Çí‰Ωé‰∏ã„Åï„Åõ„Åæ„Åô„ÄÇÈÅ©Â∫¶„Å™Â≠¶Áøí„ÇíÊé®Â•®„ÄÇ";default:return"ü§ñ Â≠¶Áøí„Éá„Éº„Çø„ÇíË®òÈå≤‰∏≠„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Â≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ"}}function SY(n,e,t){switch(n){case"morning":return e===0?"üòº Êúù„Å†ÔºÅÊñ∞„Åó„ÅÑ‰∏ÄÊó•„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ‰ªäÊó•„ÇÇÊúÄÈ´ò„ÅÆÂ≠¶Áøí„Çí„Åó„Çà„ÅÜÔºÅ":e>=20?"üòº Êúù„Åã„ÇâÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ„Åì„ÅÆÂã¢„ÅÑ„Åß‰ªäÊó•„ÇÇÂÆåÁíß„Å´„ÇÑ„ÇäÈÅÇ„Åí„Çà„ÅÜÔºÅ":"üòº Êúù„ÅÆÂ≠¶Áøí„ÄÅÊúÄÈ´ò„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ";case"afternoon":return e===0?"üòº ÂçàÂæå„ÇÇÂÖÉÊ∞óÂá∫„Åó„Å¶„ÅÑ„Åì„ÅÜÔºÅ‰ªä„Åã„Çâ„Åß„ÇÇÈÅÖ„Åè„Å™„ÅÑ„ÅûÔºÅÂÖ®Âäõ„ÅßË°å„ÅëÔºÅ":e>=20?"üòº ÂçàÂæå„ÇÇÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ":"üòº ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÊ∞óÂêàÂçÅÂàÜ„Å†„Å™ÔºÅ„Åì„ÅÆË™øÂ≠ê„Åì„ÅÆË™øÂ≠êÔºÅ";case"evening":return e===0?"üòº Â§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÁõÆÊ®ô„ÅØ„Åæ„Å†ÈÅîÊàê„Åó„Å¶„Å™„ÅÑ„Å†„ÇçÔºü„Åï„ÅÇ„ÄÅ„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº ‰ªäÊó•„ÅØÂÆåÁíß„Å†ÔºÅ„ÅäÂâç„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅË™á„Çä„Å´ÊÄù„ÅàÔºÅ":"üòº Â§ïÊñπ„ÅÆËøΩ„ÅÑËæº„Åø„ÄÅËâØ„ÅÑ„ÅûÔºÅ„É©„Çπ„Éà„Çπ„Éë„Éº„Éà„Å†ÔºÅ";case"night":return e===0?"üòº Â§ú„Å†„Åë„Å©Ë´¶„ÇÅ„Çã„Å™ÔºÅ„Åü„Å£„Åü10ÂàÜ„Åß„ÇÇ„ÅÑ„ÅÑ„ÄÅ‰ªäÊó•„ÅÆÂàÜ„Çí„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßòÔºÅ‰ªäÊó•„ÅÆ„ÅäÂâç„ÅØÊúÄÈ´ò„Å†„Å£„ÅüÔºÅ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÅÔºÅ":"üòº Â§ú„ÅÆÂ≠¶Áøí„ÇÇÈ†ëÂºµ„Å£„Å¶„Çã„Å™ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™„Çà„ÄÅ„Åß„ÇÇÈ†ëÂºµ„ÇåÔºÅ";default:return"üòº „Åï„ÅÇ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ"}}function CY(n,e,t){switch(n){case"morning":return e===0?"üßô Êúù„ÅÆÈùô„Åë„Åï„ÅØÂ≠¶„Å≥„Å´ÊúÄÈÅ©„Åò„ÇÉ„ÄÇÂøÉ„ÇíËêΩ„Å°ÁùÄ„Åë„Å¶„ÄÅ„ÇÜ„Å£„Åè„ÇäÂßã„ÇÅ„Çã„Åå„Çà„ÅÑ„ÄÇ":e>=20?"üßô Êúù„Åã„ÇâËâØ„ÅÑ„Éö„Éº„Çπ„Åò„ÇÉ„ÅÆ„ÅÜ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ":"üßô Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åò„ÇÉ„Å™„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅËá™ÂàÜ„ÅÆ„Éö„Éº„Çπ„ÅßÈÄ≤„ÇÄ„ÅÆ„Åò„ÇÉ„ÄÇ";case"afternoon":return e===0?"üßô ÂçàÂæå„ÅØÂ∞ë„Åó‰ºë„Çì„Åß„Åã„ÇâÂßã„ÇÅ„Çã„ÅÆ„ÇÇËâØ„ÅÑ„Åû„ÄÇÁÑ¶„ÇãÂøÖË¶Å„ÅØ„Å™„ÅÑ„ÄÇ":e>=20?"üßô ÂçàÂæå„ÇÇÁùÄÂÆü„Å´ÈÄ≤„Çì„Åß„Åä„Çã„ÅÆ„ÅÜ„ÄÇÁ∂ôÁ∂ö„Åì„Åù„ÅåÂäõ„Åò„ÇÉ„ÄÇ":"üßô ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åå„ÄÅ‰ºëÊÅØ„ÇÇÂøò„Çå„Å¨„Çà„ÅÜ„Å´„Å™„ÄÇ";case"evening":return e===0?"üßô Â§ïÊöÆ„ÇåÊôÇ„ÅØ‰∏ÄÊó•„ÇíÊåØ„ÇäËøî„ÇãÊôÇÈñì„Åò„ÇÉ„ÄÇÂ≠¶„Å≥„ÇÇÂêå„Åò„Åè„ÄÅÂæ©Áøí„ÅåÂ§ßÂàá„Åò„ÇÉ„Åû„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅØ„Çà„ÅèÂä±„Çì„Å†„ÅÆ„ÅÜ„ÄÇÂ≠¶„Å≥„ÅØÈáè„Çà„ÇäË≥™„Åò„ÇÉ„ÄÇÂçÅÂàÜ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ":"üßô Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑÁøíÊÖ£„Åò„ÇÉ„ÄÇÊÄ•„Åå„Åö„ÄÅÁ¢∫ÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ";case"night":return e===0?"üßô Â§ú„ÅØÂøÉÁ©è„ÇÑ„Åã„Å´ÈÅé„Åî„Åô„ÅåËâØ„ÅÑ„ÄÇËªΩ„ÅÑÂæ©Áøí„Å†„Åë„Åß„ÇÇÂçÅÂàÜ„Åò„ÇÉ„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅÆÂ≠¶„Å≥„ÅØÂçÅÂàÜ„Åò„ÇÉ„ÄÇËâØ„ÅçÁù°Áú†„ÅåÊòéÊó•„Å∏„ÅÆÂäõ„Å®„Å™„Çã„ÄÇ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÄ„Åå„Çà„ÅÑ„ÄÇ":"üßô Â§úÊõ¥„Åã„Åó„ÅØ„Åª„Å©„Åª„Å©„Å´„Å™„ÄÇÁù°Áú†„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„Åû„ÄÇ";default:return"üßô Â≠¶„Å≥„Å®„ÅØÈï∑„ÅÑÊóÖ„Åò„ÇÉ„ÄÇ‰∏ÄÊ≠©„Åö„Å§„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ"}}function NY(n,e,t){if(Math.random()>.1)return null;const s=IY(n,e,t);return s.length===0?null:s[Math.floor(Math.random()*s.length)]}function IY(n,e,t){const s=[];n==="drill-sergeant"&&(e&&t>=5&&(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå„Çà„ÅóÔºÅ„Åù„ÅÆË™øÂ≠ê„Å†ÔºÅ„Äç üòÉ„Äå„Å°„Çá„ÄÅ„Å°„Çá„Å£„Å®Ë§í„ÇÅ„Åô„Åé„Åß„ÅØ...„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅËâØ„ÅÑ„ÇÇ„ÅÆ„ÅØËâØ„ÅÑ„Çì„Å†ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"wise-sage",message:"üòà„ÄåÂÆåÁíß„Å†ÔºÅ„Äç üßô„Äå„Åµ„ÇÄ„ÄÅÈ¨ºËªçÊõπÊÆø„ÇÇÂ¨â„Åó„Åù„ÅÜ„Åò„ÇÉ„ÅÆ„ÅÜ„Äç üòà„Äå„Åπ„ÄÅÂà•„Å´...„Äç",type:"banter"})),e||(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå‰ΩïÂ∫¶Âêå„ÅòÈñìÈÅï„ÅÑ„Çí...ÔºÅ„Äç üòÉ„Äå„Åæ„ÅÇ„Åæ„ÅÇ„ÄÅËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÇË™∞„Å´„Åß„ÇÇËã¶Êâã„ÅØ„ÅÇ„Çä„Åæ„Åô„Åã„Çâ„Äç üòà„ÄåÁîò„ÇÑ„Åã„Åô„Å™ÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"analyst",message:"üòà„Äå„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´„ÅØË®±ÂÆπÁØÑÂõ≤ÂÜÖ„ÅÆ„Éü„Çπ„Åß„Åô„Äç üòà„Äå„Éá„Éº„Çø„Åò„ÇÉ„Å™„ÅÑ„ÄÅÊ∞óÊåÅ„Å°„ÅÆÂïèÈ°å„Å†ÔºÅ„Äç",type:"argument"})),s.push({mainTeacher:"drill-sergeant",otherTeacher:"enthusiastic-coach",message:"üòºÔºàÈÄö„Çä„Åô„Åå„ÇäÔºâ„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„ÅÆÁâπË®ì„ÅãÔºÅÈ†ëÂºµ„Çå„ÇàÔºÅ„Äç üòà„Äå...‰ΩôË®à„Å™Âè£Âá∫„Åó„Åô„Çã„Å™„Äç",type:"passerby"})),n==="kind-teacher"&&(e&&(s.push({mainTeacher:"kind-teacher",otherTeacher:"drill-sergeant",message:"üòÉ„ÄåÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå„Åæ„Å†„Åæ„Å†Ê≤πÊñ≠„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå...ËÅû„Åì„Åà„Å¶„Åæ„ÅôÔºü„Äç",type:"passerby"}),s.push({mainTeacher:"kind-teacher",otherTeacher:"wise-sage",message:"üòÉ„Äå„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ„Äç üßô„Äå„ÅÜ„ÇÄ„ÄÅÁùÄÂÆü„Å™ÊàêÈï∑„Åò„ÇÉ„Äç üòÉ„ÄåË≥¢ËÄÖÂÖàÁîü„ÇÇ„Åù„ÅÜÊÄù„Çè„Çå„Åæ„Åô„Çà„Å≠„Äç",type:"support"})),e||s.push({mainTeacher:"kind-teacher",otherTeacher:"enthusiastic-coach",message:"üòÉ„ÄåÂ§ß‰∏àÂ§´„ÄÅÊ¨°„ÅØÂøÖ„Åö„Åß„Åç„Åæ„Åô„Çà„Äç üòº„Äå„Åù„ÅÜ„Åù„ÅÜÔºÅÂ§±Êïó„ÅØÊàêÂäü„ÅÆÊØç„Å†ÔºÅ„Äç üòÉ„ÄåÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ„ÇÇÂøúÊè¥„Åó„Å¶„Åæ„Åô„Çà„Äç",type:"support"}),s.push({mainTeacher:"kind-teacher",message:"üòÉ„Äå„ÅÇ„ÄÅ„ÅäËå∂„ÇíÂÖ•„ÇåÂøò„Çå„Å¶...„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå‰ªï‰∫ã‰∏≠„Å´‰Ωï„Åó„Å¶„ÇãÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„ÇìÔºÅ„Äç",type:"joke"})),n==="analyst"&&(t>=10&&s.push({mainTeacher:"analyst",otherTeacher:"enthusiastic-coach",message:"ü§ñ„Äå10ÈÄ£Á∂öÊ≠£Ëß£„ÄÇÁµ±Ë®àÁöÑ„Å´ÊúâÊÑè„Åß„Åô„Äç üòº„Äå„Åô„Åí„ÉºÔºÅÊúÄÈ´ò„Å†ÔºÅ„Äç ü§ñ„Äå...ÊÑüÊÉÖË°®Áèæ„ÅØ‰∏çË¶Å„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",otherTeacher:"drill-sergeant",message:"ü§ñ„Äå„Éá„Éº„Çø„Å´Âü∫„Å•„Åè„Å®...„Äç üòà„ÄåÁêÜÂ±à„ÅØ„ÅÑ„ÅÑÔºÅÊ∞óÂêà„Å†ÔºÅ„Äç ü§ñ„ÄåÈùûÁßëÂ≠¶ÁöÑ„Åß„Åô„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"analyst",otherTeacher:"kind-teacher",message:"ü§ñ„ÄåÊ≠£Á≠îÁéá73.4%„Äç üòÉ„Äå„ÅÇ„ÅÆ...„ÇÇ„ÅÜÂ∞ë„ÅóÂÑ™„Åó„Åè‰ºù„Åà„Çâ„Çå„Åæ„Åõ„Çì„ÅãÔºü„Äç ü§ñ„Äå‰∫ãÂÆü„ÇíËø∞„Åπ„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",message:"ü§ñ„Äå...„Ç≥„Éº„Éí„Éº„ÅÆ„Ç´„Éï„Çß„Ç§„É≥Âê´ÊúâÈáè„ÅØ...„Äç üòÉ„ÄåÂàÜÊûêÂÆòÂÖàÁîü„ÄÅ‰ªä„ÅØÊéàÊ•≠‰∏≠„Åß„Åô„Çà„Äç ü§ñ„ÄåÂ§±Á§º„Åó„Åæ„Åó„Åü„Äç",type:"joke"})),n==="enthusiastic-coach"&&(e&&t>=5&&(s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"wise-sage",message:"üòº„ÄåÊúÄ„Å£È´ò„Å†„ÅÅ„ÅÅÔºÅÔºÅ„Äç üßô„Äå...Â∞ë„ÅóÂ£∞„ÅåÂ§ß„Åç„ÅÑ„Åã„ÅÆ„ÅÜ„Äç üòº„Äå„ÅÜ„Çã„Åï„Åè„Å¶ÊÇ™„Åã„Å£„Åü„Å™ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"drill-sergeant",message:"üòº„Äå„Çà„Å£„Åó„ÇÉ„ÉºÔºÅ„Äç üòà„ÄåÈ®í„Åå„Åó„ÅÑ...„Å†„Åå„ÄÅÊÇ™„Åè„Å™„ÅÑ„Å™„Äç üòº„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„Å´Ë§í„ÇÅ„Çâ„Çå„ÅüÔºÅ„Äç",type:"support"})),e||s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"kind-teacher",message:"üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅÊ¨°„Å†Ê¨°ÔºÅ„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÁÑ¶„Çâ„Åö„Å´„Äç üòº„Äå‰∫å‰∫∫„ÅßÂøúÊè¥„Åó„Å¶„Çã„ÅûÔºÅ„Äç",type:"support"}),s.push({mainTeacher:"enthusiastic-coach",message:"üòº„Äå‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨„ÅØ...„Äç ü§ñ„Äå„Åù„Çå„ÅØËã±Ë™ûÂ≠¶Áøí„Å®ÁÑ°Èñ¢‰øÇ„Åß„Åô„Äç üòº„Äå‰Ωì„ÅåË≥áÊú¨„Å†„ÇçÔºÅÔºü„Äç",type:"joke"})),n==="wise-sage"&&(e&&s.push({mainTeacher:"wise-sage",otherTeacher:"drill-sergeant",message:"üßô„ÄåËâØ„ÅçÊàêÈï∑„Åò„ÇÉ„Äç üòà„ÄåÂΩì„Åü„ÇäÂâç„Å†„ÄÅ‰ø∫„ÅÆÊïô„ÅàÂ≠ê„Å†„Åã„Çâ„Å™„Äç üßô„Äå...„Åä‰∏ª„ÇÇÊïô„Åà„Å¶„Åä„Å£„Åü„ÅÆ„ÅãÔºü„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",otherTeacher:"analyst",message:"üßô„ÄåÊôÇ„Å´„ÅØÊÑüË¶ö„ÇÇÂ§ß‰∫ã„Åò„ÇÉ„Åû„Äç ü§ñ„ÄåÊÑüË¶ö„ÅØÊ∏¨ÂÆö‰∏çÂèØËÉΩ„Åß„Åô„Äç üßô„Äå...Ëã•„ÅÑ„ÅÆ„ÅÜ„Äç",type:"argument"}),s.push({mainTeacher:"wise-sage",otherTeacher:"enthusiastic-coach",message:"üßô„ÄåÁÑ¶„Çâ„Åö„ÄÅ„Åò„Å£„Åè„Çä„Å®...„Äç üòº„Äå„Åü„Åæ„Å´„ÅØÂÖ®ÂäõÁñæËµ∞„ÇÇÂ§ß‰∫ã„Å£„Åô„ÇàÔºÅ„Äç üßô„Äå...„Åù„Çå„ÇÇ‰∏ÄÁêÜ„ÅÇ„Çã„Åã„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",message:"üßô„ÄåÊòî„ÅØ„ÅÆ„ÅÜ...„Äç üòÉüòàüòºü§ñ„Äå„Äå„Äå„Äå„Åæ„ÅüÊòîË©±ÔºÅÔºü„Äç„Äç„Äç„Äç üßô„Äå...ÊúÄËøë„ÅÆËã•ËÄÖ„ÅØ„Äç",type:"joke"}));const r=[{mainTeacher:n,message:"üòÉ„Äå„ÅäÊòº„ÅØ‰ΩïÈ£ü„Åπ„Åæ„ÅôÔºü„Äç üòà„ÄåÊôÇÈñì„ÅÆÁÑ°ÈßÑ„Å†„Äç üòº„Äå‰ø∫„ÅØ„Ç´„ÉÑ‰∏ºÔºÅ„Äç ü§ñ„ÄåÊ†ÑÈ§ä„Éê„É©„É≥„Çπ„ÇíËÄÉÊÖÆ„Åô„Åπ„Åç„Åß„Åô„Äç üßô„Äå...„Çè„Åó„ÅØËïéÈ∫¶„Åå„ÅÑ„ÅÑ„ÅÆ„ÅÜ„Äç",type:"joke"},{mainTeacher:n,message:"üòà„Äå...Ë™∞„Å†„ÄÅËÅ∑Âì°ÂÆ§„Åß„Ç≥„Éº„Éí„Éº„Åì„Åº„Åó„Åü„ÅÆ„ÅØÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„Çì...„Äç üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅ„Äç ü§ñ„ÄåÊ∏ÖÊéÉÊñπÊ≥ï„ÇíÊèêÁ§∫„Åó„Åæ„Åô„Äç",type:"joke"},{mainTeacher:n,message:"üßô„Äå...Âç∞Âà∑Ê©ü„ÅåÂãï„Åã„Çì„ÅÆ„Åò„ÇÉ„Åå„Äç ü§ñ„ÄåITÊãÖÂΩì„ÇíÂëº„Å≥„Åæ„Åô„Äç üòÉ„ÄåÁßÅ„ÅåË¶ã„Å¶„Åø„Åæ„Åô„Å≠„Äç üòà„Äå„Åï„Å£„Åï„Å®Áõ¥„ÅõÔºÅ„Äç üòº„Äå„Åø„Çì„Å™„ÅßÂçîÂäõ„Å†ÔºÅ„Äç",type:"joke"},{mainTeacher:n,message:"üòº„Äå‰ªäÊó•„ÅÆÊéàÊ•≠„Å©„ÅÜ„Å†„Å£„ÅüÔºü„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Å£„Å¶„Åæ„Åó„Åü„Çà„Äç üòà„Äå„Åæ„Å†„Åæ„Å†„Å†„Äç ü§ñ„Äå„Éá„Éº„Çø„ÅßË¶ã„Çã„Å®ÊîπÂñÑÂÇæÂêë„Åß„Åô„Äç üßô„Äå„Åù„Çå„Åû„Çå„ÅÆÊàêÈï∑„Åå„ÅÇ„Çã„ÅÆ„ÅÜ„Äç",type:"banter"}];return Math.random()<.05&&s.push(...r),s}function kY(){const n=new Date().getHours();if(Math.random()>.05)return null;if(n>=6&&n<9){const e=["üòÉ„Äå„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç üòà„ÄåÊúù„Åã„ÇâÂÖÉÊ∞ó„Å†„Å™„Äç üòº„Äå„Çà„Å£„Åó„ÇÉ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„Å†ÔºÅ„Äç","üßô„Äå„ÅÜ„ÇÄ„ÄÅËâØ„ÅÑÊúù„Åò„ÇÉ„ÅÆ„ÅÜ„Äç ü§ñ„ÄåÊ∞óÊ∏©18Â∫¶„ÄÅÂ≠¶Áøí„Å´ÊúÄÈÅ©„Åß„Åô„Äç üòÉ„ÄåÂ§©Ê∞ó„ÇÇËâØ„ÅÑ„Åß„Åô„Å≠„Äç","üòà„ÄåÈÅÖÂàª„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå„Åæ„ÄÅ„Åæ„Å†ÈñãÂßã10ÂàÜÂâç„Åß„Åô„Çà...„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=12&&n<13){const e=["üòº„ÄåËÖπÊ∏õ„Å£„Åü„ÄúÔºÅ„Äç üòÉ„Äå„ÅäÂºÅÂΩìË≤∑„Å£„Å¶„Åç„Åæ„Åó„Åü„Çà„Äç üòà„ÄåÊòº‰ºë„Åø„ÅØ30ÂàÜ„Å†„Åû„Äç","üßô„Äå‰ªäÊó•„ÅÆÂÆöÈ£ü„ÅØ‰Ωï„Åã„ÅÆ„ÅÜ„Äç ü§ñ„Äå„Ç´„É≠„É™„ÉºË®àÁÆó„ÅåÂøÖË¶Å„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™„ÅßÈ£ü„Åπ„Åæ„Åó„Çá„ÅÜ„Äç","üòà„ÄåÈ£üÂæå„ÅØ‰ºë„ÇÄ„Å™ÔºÅ„Äç üòÉ„ÄåÊ∂àÂåñ„Å´ÊÇ™„ÅÑ„Åß„Åô„Çà...„Äç üòº„ÄåÂ∞ë„Åó„ÅØ‰ºë„ÇÇ„ÅÜ„ÅúÔºÅ„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=17&&n<19){const e=["üòÉ„Äå‰ªäÊó•„ÇÇ„ÅäÁñ≤„ÇåÊßò„Åß„Åó„Åü„Äç üòà„Äå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑ„Äç üòº„Äå„ÅÑ„ÇÑ„ÄÅÂçÅÂàÜÈ†ëÂºµ„Å£„Åü„Å£„Å¶ÔºÅ„Äç","üßô„ÄåÊó•„ÅåÊöÆ„Çå„Å¶„Åç„Åü„ÅÆ„ÅÜ„Äç ü§ñ„Äå17ÊôÇ32ÂàÜ„ÄÅÂÆöÂàª„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠„Äç","üòº„Äå‰ªäÊó•„ÅÆÂèçÁúÅ‰ºö„Åô„ÇãÔºü„Äç üòÉ„Äå„ÅÑ„ÅÑ„Åß„Åô„Å≠„Äç üòà„ÄåÁÑ°ÈßÑË©±„ÅØ„Åô„Çã„Å™„Äç üßô„Äå„Åù„Çå„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åû„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=22){const e=["üòÉ„Äå„ÇÇ„ÅÜÈÅÖ„ÅÑ„Åß„Åô„Å≠...„Äç üòà„ÄåÂ∏∞„ÇåÔºÅÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ„Äç üßô„ÄåÁÑ°ÁêÜ„ÅØ„ÅÑ„Åã„Çì„Åû„Äç","ü§ñ„Äå22ÊôÇ„ÇíË∂ÖÈÅé„ÄÇÁù°Áú†ÊôÇÈñìÁ¢∫‰øù„ÇíÊé®Â•®„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÂ∏∞„Çä„Åæ„Åó„Çá„ÅÜ„Äç","üòº„ÄåÂ§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÔºÅ„Äç üòÉ„ÄåÊòéÊó•„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„Äå...Êó©„ÅèÂØù„Çç„Äç"];return e[Math.floor(Math.random()*e.length)]}return null}function $Y(n){return n===10?"üòº„Äå10ÈÄ£Á∂öÔºÅÔºÅ„Äç üòà„Äå„Çà„ÅóÔºÅ„Äç üòÉ„Äå„Åô„Åî„ÅÑÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´ÂÑ™ÁßÄ„Äç üßô„ÄåË¶ã‰∫ã„Åò„ÇÉ„Äç":n===20?"üòà„Äå20ÈÄ£Á∂ö„Å†„Å®...ÔºÅÔºü„Äç üòÉ„Äå‰ø°„Åò„Çâ„Çå„Åæ„Åõ„ÇìÔºÅ„Äç üòº„ÄåÊúÄ„Å£È´ò„Å†ÔºÅ„Äç ü§ñ„ÄåÁï∞Â∏∏ÂÄ§„Åß„ÅôÔºàË§í„ÇÅË®ÄËëâÔºâ„Äç üßô„ÄåÂ§©Êâç„Åã...„Äç":n===50?"üòàüòÉüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå50ÈÄ£Á∂öÔºÅÔºÅÔºÅÔºÅÔºÅ„Äç„Äç„Äç„Äç„ÄçÔºàÂÖ®Âì°„Çπ„Çø„É≥„Éá„Ç£„É≥„Ç∞„Ç™„Éô„Éº„Ç∑„Éß„É≥Ôºâ":null}function TY(){const n=new Date,e=n.getMonth()+1,t=n.getDate(),s=n.getDay();return s===1?"üòÉ„Äå‰ªäÈÄ±„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„ÄåÊúàÊõú„Åã„ÇâÈ£õ„Å∞„ÅõÔºÅ„Äç üòº„ÄåÈÄ±„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ„Äç":s===5?"üòº„ÄåÈáëÊõú„Å†ÔºÅ„ÅÇ„Å®Â∞ë„ÅóÔºÅ„Äç üòÉ„Äå„Åß„ÇÇÊ∞ó„ÇíÊäú„Åã„Åö„Å´„Äç üòà„ÄåÊúÄÂæå„Åæ„ÅßÊ∞óÂêà„Å†ÔºÅ„Äç":e===12&&t===25?"üòÉ„Äå„É°„É™„Éº„ÇØ„É™„Çπ„Éû„ÇπÔºÅ„Äç üòà„ÄåÊµÆ„Åã„Çå„Çã„Å™„Äç üòº„Äå„Åü„Åæ„Å´„ÅØ„ÅÑ„ÅÑ„Å†„ÇçÔºÅ„Äç üßô„Äå„Åª„Å£„Åª„Å£„Åª„Äç":e===1&&t===1?"üòÉüòàüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå„ÅÇ„Åë„Åæ„Åó„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç„Äç„Äç„Äç„Äç":null}const AY=[{type:"common-mistake",message:`üòÉ„Äå"I'm exciting"„Å£„Å¶Ë®Ä„Å£„Å¶„Åæ„Åõ„Çì„ÅãÔºüÊ≠£„Åó„Åè„ÅØ"I'm excited"„Åß„Åô„Çà„ÄÇËá™ÂàÜ„Åå„ÉØ„ÇØ„ÉØ„ÇØ„Åó„Å¶„ÇãÊôÇ„ÅØedÂΩ¢„Åß„ÅôÔºÅ„Äç`,teacher:"kind-teacher"},{type:"common-mistake",message:`„Äå"I'm boring"„ÅØ„ÄåÁßÅ„ÅØÈÄÄÂ±à„Å™‰∫∫Èñì„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†„ÅûÔºÅ"I'm bored"„ÅåÊ≠£Ëß£„Å†ÔºÅÈñìÈÅï„Åà„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"},{type:"common-mistake",message:'ü§ñ„Äå"funny"„Å®"fun"„ÅØÁï∞„Å™„Çä„Åæ„Åô„ÄÇ"funny"„ÅØ„ÄåÈù¢ÁôΩ„ÅÑÔºàÁ¨ë„Åà„ÇãÔºâ„Äç„ÄÅ"fun"„ÅØ„ÄåÊ•Ω„Åó„ÅÑ„Äç„ÄÇ‰Ωø„ÅÑÂàÜ„Åë„ÅåÈáçË¶Å„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:'üòÉ„Äå"advice"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å™„ÅÆ„Åß„ÄÅ"an advice"„Å®„ÅØË®Ä„Åà„Åæ„Åõ„Çì„ÄÇ"a piece of advice"„Å®Ë®Ä„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'„Äå"How do you think?"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"What do you think?"„ÅåÊ≠£Ëß£ÔºÅ‰ΩïÂ∫¶Ë®Ä„Çè„Åõ„ÇãÔºÅ„Äç',teacher:"drill-sergeant"},{type:"common-mistake",message:'üòº„Äå"see a dream"„Åò„ÇÉ„Å™„ÅÑ„ÅûÔºÅ"have a dream"„Å†ÔºÅÂ§¢„ÅØË¶ã„Çã„Çì„Åò„ÇÉ„Å™„Åè„Å¶ÊåÅ„Å§„Çì„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"common-mistake",message:'üßô„Äå"say"„Å®"tell"„ÅÆÈÅï„ÅÑ„Åò„ÇÉ„Åå..."say"„ÅØÂÜÖÂÆπ„Çí„ÄÅ"tell"„ÅØÁõ∏Êâã„ÇíÂº∑Ë™ø„Åô„Çã„ÅÆ„Åò„ÇÉ„ÄÇ"tell me"„Å®„ÅØË®Ä„Åà„Çã„Åå"say me"„Å®„ÅØË®Ä„Åà„Å¨„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"common-mistake",message:'üòÉ„Äå"enjoy"„ÅÆÂæå„ÅØÂøÖ„Åö-ingÂΩ¢„Åß„Åô„ÇàÔºÅ"enjoy to study"„Åß„ÅØ„Å™„Åè"enjoy studying"„Åß„Åô„ÄÇ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'ü§ñ„Äå"remember to do"Ôºà„Åì„Çå„Åã„Çâ„Åô„Çã„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„Å®"remember doing"Ôºà„Åó„Åü„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:`„Äå"I'm agree"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"agree"„ÅØÂãïË©û„Å†„Åã„Çâ"I agree"„Å†ÔºÅÂü∫Êú¨„ÇíÂøò„Çå„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"}],RY=[{type:"fun-fact",message:'üßô„ÄåÊé•È†≠Ëæû"re-"„ÅØ„ÄåÂÜç„Å≥„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇreturnÔºàÊàª„ÇãÔºâ„ÄÅreviewÔºàÂæ©ÁøíÔºâ„ÄÅrepeatÔºàÁπ∞„ÇäËøî„ÅôÔºâ„Å™„Å©„ÄÅË¶ö„Åà„ÇÑ„Åô„ÅÑ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÈï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑÔºöÊúÄÂàù„Å®ÊúÄÂæå„ÅÆÊÆµËêΩ„ÄÅÂêÑÊÆµËêΩ„ÅÆÊúÄÂàù„ÅÆÊñá„ÇíË™≠„ÇÅ„Å∞ÂÖ®‰Ωì„ÅÆÊµÅ„Çå„Åå„Å§„Åã„ÇÅ„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„Äå"however"Ôºà„Åó„Åã„ÅóÔºâ„ÄÅ"therefore"Ôºà„Åó„Åü„Åå„Å£„Å¶Ôºâ„ÄÅ"moreover"Ôºà„Åï„Çâ„Å´Ôºâ„Å™„Å©„ÅÆÊé•Á∂öË©û„ÇíË¶ö„Åà„Çã„Å®„ÄÅË´ñÁêÜÂ±ïÈñã„ÅåË¶ã„Åà„ÇÑ„Åô„Åè„Å™„Çä„Åæ„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-tion"„Çí„Å§„Åë„Çã„Å®ÂãïË©û„ÅåÂêçË©û„Å´„Å™„Çã„ÅûÔºÅeducate‚Üíeducation„ÄÅcommunicate‚Üícommunication„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"fun-fact",message:'üßô„Äå"compare A with B"ÔºàA„Å®B„ÇíÊØîËºÉ„Åô„ÇãÔºâ„Å®"compare A to B"ÔºàA„ÇíB„Å´‰æã„Åà„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÈÅï„ÅÜ„Åû„ÄÇË©¶È®ì„Åß„Çà„ÅèÂá∫„Çã„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÂêåÁæ©Ë™û„ÇíÂ¢ó„ÇÑ„Åô„Å®Ë°®ÁèæÂäõ„Åå‰∏ä„Åå„Çä„Åæ„Åô„ÄÇimportant=significant=crucial„ÄÅshow=demonstrate=illustrate „Å™„Å©„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„ÄåÊé•È†≠Ëæû"un-"„ÄÅ"in-"„ÄÅ"dis-"„ÅØÂê¶ÂÆö„ÅÆÊÑèÂë≥„ÄÇunhappy„ÄÅimpossible„ÄÅdisagree„Å™„Å©„ÄÅ„Éë„Çø„Éº„É≥„ÅßË¶ö„Åà„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'„Äå"not only A but also B"ÔºàA„Å†„Åë„Åß„Å™„ÅèB„ÇÇÔºâ„ÅØÈ†ªÂá∫ÊßãÊñá„Å†ÔºÅ„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„ÇçÔºÅ„Äç',teacher:"drill-sergeant"},{type:"fun-fact",message:'üßô„Äå"although"„Å®"though"„ÅØ„Åª„ÅºÂêå„ÅòÊÑèÂë≥Ôºà„Äú„Å†„Åë„Çå„Å©„ÇÇÔºâ„Åò„ÇÉ„Åå„ÄÅthough„ÅÆÊñπ„Åå„Ç´„Ç∏„É•„Ç¢„É´„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-able"„ÅØ„Äå„Äú„Åß„Åç„Çã„Äç„ÅÆÊÑèÂë≥„Å†ÔºÅreadableÔºàË™≠„ÇÅ„ÇãÔºâ„ÄÅcomfortableÔºàÂø´ÈÅ©„Å™Ôºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"}],EY=[{type:"cultural",message:"üòÉ„ÄåËã±Êñá„Ç®„ÉÉ„Çª„Ç§„ÅØÁµêË´ñ„ÇíÊúÄÂàù„Å´Êõ∏„Åè„ÅÆ„ÅåÂü∫Êú¨„ÄÇIntroduction‚ÜíBody‚ÜíConclusion„ÅÆ3ÈÉ®ÊßãÊàê„Åß„Åô„Çà„ÄÇ„Äç",teacher:"kind-teacher"},{type:"cultural",message:'üßô„ÄåËã±Ë™û„ÅÆË´ñÁêÜÂ±ïÈñã„ÅØ"‰∏ªÂºµ‚ÜíÁêÜÁî±‚ÜíÂÖ∑‰Ωì‰æã"„ÅåÂü∫Êú¨„Åò„ÇÉ„ÄÇFor example, For instance „Çí‰Ωø„ÅÑ„Åì„Å™„Åù„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"cultural",message:"ü§ñ„ÄåÂ≠¶Ë°ìÁöÑ„Å™ÊñáÁ´†„Åß„ÅØ„ÄÅcontractionsÔºàÁü≠Á∏ÆÂΩ¢Ôºâ„ÅØ‰Ωø„ÅÑ„Åæ„Åõ„Çì„ÄÇdon't‚Üído not„ÄÅit's‚Üíit is „Å®Êõ∏„Åç„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"cultural",message:"üòº„ÄåÊÑèË¶ã„ÇíËø∞„Åπ„ÇãË°®ÁèæÔºÅI think, In my opinion, From my perspective „Å™„Å©„ÄÅ„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥„ÇíÂ¢ó„ÇÑ„Åù„ÅÜÔºÅ„Äç",teacher:"enthusiastic-coach"},{type:"cultural",message:'üòÉ„ÄåÁêÜÁî±„ÇíËø∞„Åπ„ÇãÊôÇ„ÅØ"because"„Å†„Åë„Åò„ÇÉ„Å™„Åè„ÄÅ"since"„ÄÅ"as"„ÄÅ"due to"„Å™„Å©„ÇÇ‰Ωø„Åà„Åæ„Åô„Çà„ÄÇ„Äç',teacher:"kind-teacher"},{type:"cultural",message:'„ÄåÂèóÂãïÊÖã„Çí‰Ωø„ÅÑ„Åì„Å™„ÅõÔºÅ"The experiment was conducted"„Å™„Å©„ÄÅÂÆ¢Ë¶≥ÁöÑ„Å™Ë°®Áèæ„Å´ÂøÖË¶Å„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"cultural",message:'üßô„ÄåÂØæÊØî„ÅÆË°®ÁèæÔºö"on the other hand"Ôºà‰∏ÄÊñπ„ÅßÔºâ„ÄÅ"in contrast"ÔºàÂØæÁÖßÁöÑ„Å´Ôºâ„ÅØË´ñËø∞ÂïèÈ°å„ÅßÈáçÂÆù„Åô„Çã„Åû„ÄÇ„Äç',teacher:"wise-sage"}],DY=[{type:"etymology",message:'üßô„Äå"pre-"„ÅØ„ÄåÂâç„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇpreviewÔºà‰∫àÁøí„ÉªË©¶ÂÜôÔºâ„ÄÅpredictÔºà‰∫àÊ∏¨„Åô„ÇãÔºâ„ÄÅprepareÔºàÊ∫ñÂÇô„Åô„ÇãÔºâ„Å®Ë¶ö„Åà„Çà„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'ü§ñ„Äå"post-"„ÅØ„ÄåÂæå„Äç„ÄÇpostponeÔºàÂª∂Êúü„Åô„ÇãÔºâ„ÄÅpostwarÔºàÊà¶Âæå„ÅÆÔºâ„Å™„Å©„ÄÇpre-„Å®„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Çã„Å®ÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"tele-"„ÅØ„ÇÆ„É™„Ç∑„É£Ë™û„Åß„ÄåÈÅ†„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„ÄÇtelephoneÔºàÈõªË©±Ôºâ„ÄÅtelevisionÔºà„ÉÜ„É¨„ÉìÔºâ„ÄÅtelescopeÔºàÊúõÈÅ†Èè°Ôºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"bi-"„ÅØ„Äå2„Å§„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇbicycleÔºà‰∫åËº™ËªäÔºâ„ÄÅbilingualÔºà2Ë®ÄË™ûË©±„Åõ„ÇãÔºâ„ÄÅbiweeklyÔºàÈöîÈÄ±„ÅÆÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'üòº„Äå"auto-"„ÅØ„ÄåËá™Âãï„ÉªËá™Â∑±„Äç„Å†ÔºÅautomaticÔºàËá™Âãï„ÅÆÔºâ„ÄÅautobiographyÔºàËá™‰ºùÔºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"etymology",message:'ü§ñ„Äå"micro-"„ÅØ„ÄåÂ∞è„Åï„ÅÑ„Äç„ÄÅ"macro-"„ÅØ„ÄåÂ§ß„Åç„ÅÑ„Äç„ÄÇmicroscopeÔºàÈ°ïÂæÆÈè°Ôºâ„ÄÅmacroeconomicsÔºà„Éû„ÇØ„É≠ÁµåÊ∏àÂ≠¶Ôºâ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"sub-"„ÅØ„Äå‰∏ã„Äç„ÅÆÊÑèÂë≥„ÄÇsubwayÔºàÂú∞‰∏ãÈâÑÔºâ„ÄÅsubmarineÔºàÊΩúÊ∞¥Ëâ¶Ôºâ„ÄÅsubtitleÔºàÂ≠óÂπïÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"super-"„ÅØ„Äå‰∏ä„ÉªË∂Ö„Äç„Åò„ÇÉ„ÄÇsuperiorÔºàÂÑ™„Çå„ÅüÔºâ„ÄÅsupernaturalÔºàË∂ÖËá™ÁÑ∂ÁöÑ„Å™Ôºâ„ÄÅsuperviseÔºàÁõ£Áù£„Åô„ÇãÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"}],jY=[{type:"grammar-tip",message:'üòÉ„Äå"a"„Å®"an"„ÅÆ‰Ωø„ÅÑÂàÜ„Åë„ÅØ„ÄÅÊ¨°„ÅÆÂçòË™û„ÅÆ„ÄåÈü≥„Äç„ÅßÊ±∫„Åæ„Çä„Åæ„Åô„ÄÇ"an hour"Ôºàhour„ÅÆh„ÅØÁô∫Èü≥„Åó„Å™„ÅÑÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„ÄåÁèæÂú®ÂÆå‰∫Ü„ÅØ„Äå‰ªä„Å´Èñ¢‰øÇ„Åå„ÅÇ„ÇãÈÅéÂéª„Äç„Å†ÔºÅ"I have lost my key"„ÅØ‰ªä„ÇÇË¶ã„Å§„Åã„Å£„Å¶„Å™„ÅÑ„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"grammar-tip",message:'ü§ñ„Äå"fewer"„ÅØÊï∞„Åà„Çâ„Çå„ÇãÂêçË©û„ÄÅ"less"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å´‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"fewer people"„ÄÅ"less water"„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"grammar-tip",message:'üßô„Äå"used to"„ÅØÈÅéÂéª„ÅÆÁøíÊÖ£„ÄÅ"be used to"„ÅØÊÖ£„Çå„Å¶„ÅÑ„Çã„ÄÅ"get used to"„ÅØÊÖ£„Çå„Çã„Åò„ÇÉ„ÄÇÂÖ®„Å¶ÈÅï„ÅÜ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"grammar-tip",message:'üòº„Äå"will"„ÅØÊÑèÂøó„ÄÅ"be going to"„ÅØ‰∫àÂÆö„ÇÑ‰∫àÊ∏¨„Å†ÔºÅ‰Ωø„ÅÑÂàÜ„Åë„Çâ„Çå„Çã„Å®Ëã±Ë™û„Å£„ÅΩ„Åè„Å™„Çã„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"grammar-tip",message:'üòÉ„Äå"some"„Å®"any"„ÄÅËÇØÂÆöÊñá„ÅØsome„ÄÅÁñëÂïèÊñá„ÉªÂê¶ÂÆöÊñá„ÅØany„ÅåÂü∫Êú¨„Åß„Åô„Åå„ÄÅ"Would you like some tea?"„ÅÆ„Çà„ÅÜ„Å´Âãß„ÇÅ„ÇãÊôÇ„ÅØsome„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„Äå‰∏âÂçòÁèæ„ÅÆsÔºÅÂøò„Çå„Çã„Å™ÔºÅ"He go"„Åß„ÅØ„Å™„Åè"He goes"„Å†ÔºÅÂü∫Êú¨‰∏≠„ÅÆÂü∫Êú¨„Å†„ÅûÔºÅ„Äç',teacher:"drill-sergeant"}];function _Y(n){if(Math.random()>.08)return null;if(n){const e=[...RY,...DY,...EY];return e[Math.floor(Math.random()*e.length)].message}else{const e=[...AY,...jY];return e[Math.floor(Math.random()*e.length)].message}}function PY(n,e){const t=e&&(e.includes(" ")||e.includes("-")),s=["üòÉüí° ÂèóÈ®ì„ÉÜ„ÇØÔºÅÂêå„ÅòÂçòË™û„ÅÆÁπ∞„ÇäËøî„Åó„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÄÅ‰ª£ÂêçË©ûÔºàit, they, thisÔºâ„ÇÑÂêåÁæ©Ë™û„Å´Ê≥®ÁõÆ„Åô„Çã„Å®Ë™≠Ëß£„ÅåÊ•Ω„Å´„Å™„Çä„Åæ„Åô„Çà„ÄÇ","üßôüí° Èï∑Êñá„ÅÆ„Ç≥„ÉÑÔºöË®≠Âïè„ÇíÂÖà„Å´Ë™≠„Çì„Åß„Åã„ÇâÊú¨Êñá„ÇíË™≠„ÇÄ„Å®„ÄÅ‰Ωï„ÇíÊé¢„Åõ„Å∞„ÅÑ„ÅÑ„ÅãÂàÜ„Åã„Å£„Å¶ÂäπÁéáÁöÑ„Åò„ÇÉ„ÄÇ","ü§ñüí° Áµ±Ë®à„Éá„Éº„ÇøÔºöÂàùÁ¥ö„ÅØÁ¥Ñ1,077Ë™û„ÄÅ‰∏≠Á¥ö„ÅØÁ¥Ñ1,616Ë™û„ÄÅ‰∏äÁ¥ö„ÅØÁ¥Ñ885Ë™û„Åß„Åô„ÄÇË®àÁîªÁöÑ„Å´Ë™ûÂΩô„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üí° ÊôÇÂà∂„ÅÆ‰∏ÄËá¥ÔºÅ‰∏ªÁØÄ„ÅåÈÅéÂéªÂΩ¢„Å™„ÇâÂæìÂ±ûÁØÄ„ÇÇÈÅéÂéªÂΩ¢„Å†ÔºÅ"He said that he was tired"„Å†„ÅûÔºÅ',"üòÉüí° Êï¥Â∫èÂïèÈ°å„ÅÆ„Ç≥„ÉÑÔºÅ„Åæ„Åö‰∏ªË™û„Å®ÂãïË©û„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ‰øÆÈ£æË™û„ÇíÂæå„Åã„Çâ‰ªò„ÅëË∂≥„Åô„Å®Ëß£„Åç„ÇÑ„Åô„ÅÑ„Åß„Åô„Çà„ÄÇ",'üßôüí° ÂÜ†Ë©û„ÅÆ‰Ωø„ÅÑÂàÜ„ÅëÔºö"a/an"„ÅØÂàù„ÇÅ„Å¶Âá∫„Çã„ÉªÁâπÂÆö„Åß„Åç„Å™„ÅÑ„ÇÇ„ÅÆ„ÄÅ"the"„ÅØÊó¢Âá∫„ÉªÁâπÂÆö„Åß„Åç„Çã„ÇÇ„ÅÆ„Åò„ÇÉ„ÄÇ',"üòºüí° „É™„Çπ„Éã„É≥„Ç∞ÂØæÁ≠ñÔºÅÊ∂àÂéªÊ≥ï„ÅåÊúâÂäπ„Å†ÔºÅÊòé„Çâ„Åã„Å´ÈÅï„ÅÜÈÅ∏ÊäûËÇ¢„ÇíÊ∂à„Åó„Å¶„ÅÑ„Åè„Å®Ê≠£Ëß£Áéá„Åå‰∏ä„Åå„Çã„ÅûÔºÅ","ü§ñüí° ÂäπÁéáÁöÑÂ≠¶ÁøíÊ≥ïÔºöÂçòË™û„ÅØÊñáËÑà„ÅÆ‰∏≠„ÅßË¶ö„Åà„Çã„Å®ÂÆöÁùÄÁéá„Åå3ÂÄç‰ª•‰∏äÈ´ò„Åæ„Çä„Åæ„Åô„ÄÇ‰æãÊñá„Åî„Å®Ë¶ö„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üòÉüí° ÊØîËºÉË°®ÁèæÔºö"as...as"ÔºàÂêåÁ≠âÔºâ„ÄÅ"-er than"ÔºàÊØîËºÉÁ¥öÔºâ„ÄÅ"the -est"ÔºàÊúÄ‰∏äÁ¥öÔºâ„ÅÆ3„Éë„Çø„Éº„É≥„Çí„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Çá„ÅÜÔºÅ'];return t&&s.push("üòºüí° Ë¶ö„ÅàÊñπÔºÅÁÜüË™û„ÅØÂãïË©û„Å®ÂâçÁΩÆË©û„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶Ë¶ö„Åà„Çã„Å®„ÅÑ„ÅÑ„ÅûÔºÅË¶ñË¶öÁöÑ„Å´„Ç§„É°„Éº„Ç∏„Åô„Çã„Å®Âøò„Çå„Å´„Åè„ÅÑ„ÅûÔºÅ"),s[Math.floor(Math.random()*s.length)]}function MY(n){const{mode:e="translation",currentWord:t,wordProgress:s}=n,r={once:0,twice:0,three:0,four:0,five:0,sixOrMore:0};let o=!1;return Object.entries(s).forEach(([i,a])=>{if(!a)return;let c=0;e==="memorization"?c=a.memorizationAttempts||0:e==="translation"?c=a.translationAttempts??a.quizAttempts??0:e==="spelling"?c=a.spellingAttempts||0:e==="grammar"?c=a.grammarAttempts||0:c=a.totalAttempts||0,t&&i===t&&(o=!0),c===1?r.once++:c===2?r.twice++:c===3?r.three++:c===4?r.four++:c===5?r.five++:c>=6&&r.sixOrMore++}),t&&!o&&r.once++,r}function Zl({mode:n="translation",storageKeyPrefix:e,currentScore:t=0,totalAnswered:s=0,sessionCorrect:r=0,_sessionIncorrect:o=0,_sessionReview:i=0,isReviewFocusMode:a=!1,onReviewFocus:c,onShowSettings:l,currentWord:d,onAnswerTime:h,lastAnswerCorrect:f,lastAnswerWord:p,lastAnswerDifficulty:m,correctStreak:g=0,incorrectStreak:x=0,learningPhase:y,estimatedSpeed:b,forgettingRate:w,dataSource:v="",category:S="",difficulty:C="",wordPhraseFilter:k="",grammarUnit:I,_currentQuestionTimesShown:A,onResetProgress:T,onDebugRequeue:E,learningStatusTabPulseKey:$}){const D=ge=>e?`${e}-${ge}`:ge,[M,P]=N.useState(()=>{const ge=localStorage.getItem("scoreboard-active-tab");return["ai","breakdown","history","settings"].includes(ge)?ge:"ai"});N.useEffect(()=>{localStorage.setItem("scoreboard-active-tab",M)},[M]);const[L,O]=N.useState(!1),F=N.useRef(null);N.useEffect(()=>{if($)return O(!0),F.current&&window.clearTimeout(F.current),F.current=window.setTimeout(()=>{O(!1),F.current=null},1600),()=>{F.current&&(window.clearTimeout(F.current),F.current=null)}},[$]);const[V,G]=N.useState(()=>{const ge=localStorage.getItem("aiPersonality")||"kind-teacher";return mY(ge)||"„Åì„Çì„Å´„Å°„ÅØÔºÅ‰∏ÄÁ∑í„Å´Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),[_,Z]=N.useState("");N.useEffect(()=>{if(d){const ge=localStorage.getItem("aiPersonality")||"kind-teacher";if(n==="memorization"){G(""),Z("");return}const Pe=yd(d);let tt="";if(Pe){const{totalCount:vt,correctCount:Yt}=Pe,gn=vt-Yt,jt=vt>0?Math.round(Yt/vt*100):0;if(vt===0)switch(ge){case"drill-sergeant":tt="Êñ∞„Åó„ÅÑÂçòË™û„Å†ÔºÅÊ∞óÂêà„ÇíÂÖ•„Çå„Å¶Ë¶ö„Åà„ÇçÔºÅ";break;case"kind-teacher":tt="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô„Å≠„ÄÇ„Åò„Å£„Åè„ÇäËÄÉ„Åà„Å¶„Åø„Åæ„Åó„Çá„ÅÜ";break;case"analyst":tt="Êñ∞Ë¶èÂçòË™û„ÄÇ„Éá„Éº„Çø„Å™„Åó„ÄÇÂàùÂõûÊ∏¨ÂÆö„ÇíÈñãÂßã„Åó„Åæ„Åô";break;case"enthusiastic-coach":tt="Êñ∞„Åó„ÅÑ„ÉÅ„É£„É¨„É≥„Ç∏„Å†ÔºÅÊÄù„ÅÑÂàá„Å£„Å¶Ë°å„Åì„ÅÜÔºÅ";break;case"wise-sage":tt="Âàù„ÇÅ„Å¶Âá∫‰ºö„ÅÜÂçòË™û„Åò„ÇÉ„Å™„ÄÇÁÑ¶„Çâ„ÅöÂêë„ÅçÂêà„Åä„ÅÜ";break;default:tt="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô"}else if(vt===1){const hn=Yt===1;switch(ge){case"drill-sergeant":tt=hn?"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÊ≠£Ëß£„Åó„Åü„Åû„ÄÇ„Åæ„Åü„ÇÑ„ÇåÔºÅ":"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÈñìÈÅï„Åà„Åü„ÄÇ‰ªäÂ∫¶„Åì„ÅùÊ±∫„ÇÅ„ÇçÔºÅ";break;case"kind-teacher":tt=hn?"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠":"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÈñìÈÅï„Åà„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅÂ§ß‰∏àÂ§´„Åß„Åô";break;case"analyst":tt=`2ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÂâçÂõû: ${hn?"Ê≠£Ëß£":"‰∏çÊ≠£Ëß£"}`;break;case"enthusiastic-coach":tt=hn?"2ÂõûÁõÆÔºÅÂâçÂõû„ÅØÂÆåÁíß„Å†„Å£„Åü„Å™ÔºÅ":"2ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É≥„ÇπÔºÅÂâçÂõû„ÅÆ„É™„Éô„É≥„Ç∏„Å†ÔºÅ";break;case"wise-sage":tt=hn?"2Â∫¶ÁõÆ„ÅÆÂá∫‰ºö„ÅÑ„Åò„ÇÉ„ÄÇÂâçÂõû„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Å£„Åü„ÅÆ„ÅÜ":"2Â∫¶ÁõÆ„Åò„ÇÉ„Å™„ÄÇÂâçÂõû„ÅÆÁµåÈ®ì„ÇíÊ¥ª„Åã„Åù„ÅÜ";break;default:tt="2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô"}}else switch(ge){case"drill-sergeant":jt>=80?tt=`${vt}ÂõûÁõÆ„Å†„ÄÇÊ≠£Á≠îÁéá${jt}%ÔºÅ„ÅÑ„ÅÑË™øÂ≠ê„Å†ÔºÅ`:jt>=50?tt=`${vt}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${jt}%„ÄÇ„ÇÇ„Å£„Å®‰∏ä„Åí„ÇçÔºÅ`:tt=`${vt}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${jt}%ÔºÅË¶ö„Åà„ÅåÊÇ™„ÅÑ„ÅûÔºÅ`;break;case"kind-teacher":jt>=80?tt=`${vt}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${jt}%„ÄÅ„Çà„ÅèË¶ö„Åà„Å¶„ÅÑ„Åæ„Åô„Å≠`:jt>=50?tt=`${vt}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${jt}%„ÄÅÂ∞ë„Åó„Åö„Å§Ë¶ö„Åà„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô`:tt=`${vt}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${jt}%„ÄÅÁπ∞„ÇäËøî„ÅóÁ∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ`;break;case"analyst":tt=`${vt}ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÊ≠£Á≠îÁéá: ${jt}% (Ê≠£Ëß£${Yt}/‰∏çÊ≠£Ëß£${gn})`;break;case"enthusiastic-coach":jt>=80?tt=`${vt}ÂõûÁõÆÔºÅÊ≠£Á≠îÁéá${jt}%ÔºÅÂÆåÁíß„Å´Ëøë„ÅÑ„ÅûÔºÅ`:tt=`${vt}ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏ÔºÅÊ≠£Á≠îÁéá${jt}%„ÄÅ„Åæ„Å†‰º∏„Å≥„Çã„ÅûÔºÅ`;break;case"wise-sage":jt>=80?tt=`${vt}ÂõûÁõÆ„Åò„ÇÉ„Å™„ÄÇÊ≠£Á≠îÁéá${jt}%„ÄÅ„Çà„ÅèÂÆöÁùÄ„Åó„Å¶„Åä„Çã`:tt=`${vt}ÂõûÁõÆ„Åò„ÇÉ„ÄÇÊ≠£Á≠îÁéá${jt}%„ÄÅÁÑ¶„Çâ„ÅöÁùÄÂÆü„Å´„Å™`;break;default:tt=`${vt}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${jt}%`}}else tt="Êñ∞„Åó„ÅÑÂïèÈ°å„Åß„Åô";G(tt),Z("")}},[d]),N.useEffect(()=>{if(n==="memorization"){Z("");return}if(f===void 0||!p||!d||p!==d)return;const ge=localStorage.getItem("aiPersonality")||"kind-teacher",Pe=fd(n||"translation"),tt=Pe.todayTotalAnswered,vt=Pe.todayAccuracy,Yt=s>0?(r||0)/s*100:0,jt={isCorrect:f,word:p,difficulty:m||C||"intermediate",category:S||"ÂÖ®ÂàÜÈáé",attemptCount:1,responseTime:0,correctStreak:g,incorrectStreak:x,userAccuracy:Yt,categoryAccuracy:Yt,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:tt,todayAccuracy:vt,planProgress:0,timeOfDay:yx(),learningPhase:y,estimatedSpeed:b,forgettingRate:w};let hn=Ek(ge,jt);if(Math.random()<.15){const un=[];if(Math.random()<.33){const Et=PY(ge,d);Et&&un.push(Et)}else if(Math.random()<.5){const Et=TY();Et&&un.push(Et)}else{const Et=kY();Et&&un.push(Et)}un.length>0&&(hn=`${hn}

${un[0]}`)}Z(hn)},[h,f,p,m,g,x,n,s,r,S,C]);const te=N.useRef(null),he=N.useRef(null),oe=N.useRef(null),[ve,$e]=N.useState(()=>{const ge=localStorage.getItem(D("memorization-batch-size"));return ge?parseInt(ge):null}),[Ae,De]=N.useState(()=>{const ge=localStorage.getItem(D("memorization-review-ratio-limit"));return ge?parseInt(ge):20}),[we,Re]=N.useState(()=>{const ge=localStorage.getItem("autoShowDetailsOnIncorrect");return ge!==null?ge==="true":!0}),[et,je]=N.useState(()=>{const ge=localStorage.getItem("autoShowDetailsOnCorrect");return ge!==null?ge==="true":!1}),[lt,ht]=N.useState(()=>{if(n==="grammar"){const{retentionRate:ge,appearedCount:Pe}=vd();return{retentionRate:ge,appearedCount:Pe}}else{if(n==="memorization")return{retentionRate:0,appearedCount:0};{const{retentionRate:ge,appearedCount:Pe}=xd();return{retentionRate:ge,appearedCount:Pe}}}}),[it,st]=N.useState(()=>n==="grammar"?md():n==="memorization"?{totalWords:0,appearedWords:0,masteredCount:0,learningCount:0,strugglingCount:0,basicRetentionRate:0,weightedRetentionRate:0,masteredPercentage:0,learningPercentage:0,strugglingPercentage:0,masteredWords:0,learningWords:0,newWords:0,retentionRate:0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}:pd()),[Ye,pt]=N.useState(null),Tt=N.useMemo(()=>{if(M!=="breakdown")return{once:0,twice:0,three:0,four:0,five:0,sixOrMore:0};const Pe=nt().wordProgress||{};return MY({mode:n,currentWord:d,wordProgress:Pe})},[M,n,d,h]),[se,Ge]=N.useState([]);N.useEffect(()=>{n==="grammar"&&fx().then(ge=>{if(I){const Pe=I.match(/g(\d+)-(?:unit|u)(\d+)/);if(Pe){const tt=`‰∏≠${Pe[1]}_Unit${Pe[2]}`,vt=ge.filter(Yt=>Yt.unit===tt);Ge(vt)}else Ge(ge)}else Ge(ge)})},[n,h,I]),N.useEffect(()=>{if(!(n==="memorization"&&M!=="breakdown"))if(n==="grammar"){const{retentionRate:ge,appearedCount:Pe}=vd();ht({retentionRate:ge,appearedCount:Pe}),st(md())}else if(n==="memorization"){const ge=K0();st(ge),ht({retentionRate:ge.basicRetentionRate,appearedCount:ge.appearedWords})}else{const{retentionRate:ge,appearedCount:Pe}=xd();ht({retentionRate:ge,appearedCount:Pe}),st(pd())}},[h,n,M]),N.useEffect(()=>{pt(d?yd(d):null)},[d,h]),N.useEffect(()=>{if(M==="breakdown"){if(te.current){const ge=Math.round(it.masteredPercentage);te.current.style.setProperty("--segment-width",String(ge)),te.current.setAttribute("data-width",String(ge))}if(he.current){const ge=Math.round(it.learningPercentage);he.current.style.setProperty("--segment-width",String(ge)),he.current.setAttribute("data-width",String(ge))}if(oe.current){const ge=Math.round(it.strugglingPercentage);oe.current.style.setProperty("--segment-width",String(ge)),oe.current.setAttribute("data-width",String(ge))}}},[it,M,n]);const{todayAccuracy:ze,todayTotalAnswered:Nt}=N.useMemo(()=>fd(n),[n,h]),sn=n==="memorization"&&!a&&((it==null?void 0:it.learningCount)??0)>0&&((it==null?void 0:it.strugglingCount)??0)===0;N.useMemo(()=>sx(n),[n,h]),N.useMemo(()=>af(),[h]);const{retentionRate:Ht}=lt;lt.retentionRate;const Fe=it;return N.useMemo(()=>s>0?Math.round(t/s*100):0,[t,s]),u.jsxs("div",{className:"score-board-compact",children:[u.jsxs("div",{className:"score-board-tabs grid grid-cols-4 gap-0 sm:gap-2",children:[u.jsxs("button",{className:`px-0.5 sm:px-4 py-0.5 sm:py-2 text-[9px] sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${M==="ai"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("ai"),title:"AI„Ç≥„É°„É≥„Éà",children:[u.jsx("span",{className:"hidden sm:inline",children:"ü§ñ AI"}),u.jsx("span",{className:"sm:hidden",children:"AI"})]}),u.jsxs("button",{className:`px-0.5 sm:px-4 py-0.5 sm:py-2 text-[9px] sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${M==="history"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("history"),title:"Â±•Ê≠¥",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìú Â±•Ê≠¥"}),u.jsx("span",{className:"sm:hidden",children:"Â±•Ê≠¥"})]}),u.jsxs("button",{className:`px-0.5 sm:px-4 py-0.5 sm:py-2 text-[9px] sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${M==="breakdown"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("breakdown"),title:"ÂäπÁéá",children:[u.jsx("span",{className:`hidden sm:inline ${L?"animate-pulse drop-shadow-sm "+(M==="breakdown"?"":"text-primary"):""}`,children:"ÂäπÁéá"}),u.jsx("span",{className:`sm:hidden ${L?"animate-pulse drop-shadow-sm "+(M==="breakdown"?"":"text-primary"):""}`,children:"ÂäπÁéá"})]}),u.jsxs("button",{className:`px-0.5 sm:px-4 py-0.5 sm:py-2 text-[9px] sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${M==="settings"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>{l?l():P("settings")},title:"Ë®≠ÂÆö",children:[u.jsx("span",{className:"hidden sm:inline",children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsx("span",{className:"sm:hidden",children:"Ë®≠ÂÆö"})]})]}),M==="ai"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"ai-comment-container",children:u.jsxs("div",{className:"flex items-center gap-2 w-full",children:[u.jsx("div",{className:"text-2xl flex-shrink-0",children:(()=>{const ge=localStorage.getItem("aiPersonality")||"kind-teacher";return{"kind-teacher":"üòÉ","drill-sergeant":"üëπ","enthusiastic-coach":"üòº",analyst:"ü§ñ","wise-sage":"üßô"}[ge]||"üòÉ"})()}),u.jsx("div",{className:"flex-1 min-w-0",children:u.jsx("div",{className:"text-sm text-gray-700 leading-snug break-words",children:(_||V).replace(/^[üòÉüëπüòºü§ñüßô]+„Äå?/gu,"").replace(/„Äç$/gu,"").replace(/[‚ú®üå∏üòäüå±üí™üî•üìäüèÜ]/gu,"").trim()})})]})})})}),M==="breakdown"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsxs("div",{className:"retention-breakdown-container",children:[u.jsxs("div",{className:"retention-breakdown-header",children:[u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsxs("div",{className:"attempt-counts-summary flex-1",children:["Âá∫È°åÊï∞Ôºö1Âõû ",Tt.once,"Âïè 2Âõû ",Tt.twice,"Âïè 3Âõû"," ",Tt.three,"Âïè 4Âõû ",Tt.four,"Âïè 5Âõû ",Tt.five,"Âïè 6Âõû‰ª•‰∏ä ",Tt.sixOrMore,"Âïè"]}),!1]}),Fe.appearedWords>0?u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?u.jsxs(u.Fragment,{children:[Fe.appearedWords,"Ë™ûÁ¢∫Ë™çÔºö üü¢Ë¶ö„Åà„Å¶„Çã"," ",Fe.masteredCount,"Ë™û"," ",u.jsxs("span",{className:"retention-label",title:a?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":sn?"üî• „Åæ„Å†„Åæ„Å†„Éñ„Éº„Çπ„Éà‰∏≠":void 0,children:["üü°„Åæ„Å†„Åæ„Å† ",Fe.learningCount,"Ë™û"]})," ",u.jsxs("span",{className:"retention-label",title:a?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":void 0,children:["üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ",Fe.strugglingCount,"Ë™û"]}),c&&u.jsx("span",{className:`review-mode-icon ${a?"active animate-pulse":""}`,onClick:c,title:a?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):n==="grammar"?u.jsxs(u.Fragment,{children:[Fe.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",Fe.masteredCount,"Âïè üü°Â≠¶Áøí‰∏≠ ",Fe.learningCount,"Âïè üî¥Ë¶ÅÂæ©Áøí"," ",Fe.strugglingCount,"Âïè",c&&u.jsx("span",{className:`review-mode-icon ${a?"active animate-pulse":""}`,onClick:c,title:a?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):u.jsxs(u.Fragment,{children:[Fe.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",Fe.masteredCount,"Ë™û üü°Â≠¶Áøí‰∏≠ ",Fe.learningCount,"Ë™û üî¥Ë¶ÅÂæ©Áøí"," ",Fe.strugglingCount,"Ë™û",(n==="translation"||n==="spelling")&&c&&u.jsx("span",{className:`review-mode-icon ${a?"active animate-pulse":""}`,onClick:c,title:a?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]})}):u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?"„Åæ„Å†Ë™ûÂè•„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì":"„Åæ„Å†ÂïèÈ°å„Å´Âèñ„ÇäÁµÑ„Çì„Åß„ÅÑ„Åæ„Åõ„Çì"})]}),Fe.appearedWords>0&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"retention-progress-bar",children:n==="memorization"?u.jsxs(u.Fragment,{children:[Fe.masteredPercentage>0&&u.jsx("div",{ref:te,className:"retention-segment retention-mastered","data-width":Math.round(Fe.masteredPercentage),title:`üü¢ Ë¶ö„Åà„Å¶„Çã: ${Fe.masteredCount}Ë™û (${Math.round(Fe.masteredPercentage)}%)`,children:Fe.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(Fe.masteredPercentage),"%"]})}),Fe.learningCount>0&&u.jsx("div",{ref:he,className:`retention-segment retention-learning ${a||sn?"pulsing":""}`,"data-width":Math.round(Fe.learningPercentage),title:`üü° „Åæ„Å†„Åæ„Å†: ${Fe.learningCount}Ë™û (${Math.round(Fe.learningPercentage)}%) ${a?"üìö Âæ©Áøí‰∏≠":sn?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":""}`,children:Fe.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(Fe.learningPercentage),"%"]})}),Fe.strugglingCount>0&&u.jsx("div",{ref:oe,className:`retention-segment retention-struggling ${a?"pulsing":""}`,"data-width":Math.round(Fe.strugglingPercentage),title:`üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${Fe.strugglingCount}Ë™û (${Math.round(Fe.strugglingPercentage)}%) ${a?"üìö Âæ©Áøí‰∏≠":""}`,children:Fe.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(Fe.strugglingPercentage),"%"]})})]}):u.jsxs(u.Fragment,{children:[Fe.masteredPercentage>0&&u.jsx("div",{ref:te,className:"retention-segment retention-mastered","data-width":Math.round(Fe.masteredPercentage),title:`üü¢ ÂÆöÁùÄ: ${Fe.masteredCount}Ë™û (${Math.round(Fe.masteredPercentage)}%)`,children:Fe.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(Fe.masteredPercentage),"%"]})}),Fe.learningPercentage>0&&u.jsx("div",{ref:he,className:`retention-segment retention-learning ${sn||a?"pulsing":""}`,"data-width":Math.round(Fe.learningPercentage),title:`üü° Â≠¶Áøí‰∏≠: ${Fe.learningCount}Ë™û (${Math.round(Fe.learningPercentage)}%) ${sn?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":a?"üìö Âæ©Áøí‰∏≠":""}`,children:Fe.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(Fe.learningPercentage),"%"]})}),Fe.strugglingPercentage>0&&u.jsx("div",{ref:oe,className:`retention-segment retention-struggling ${a?"pulsing":""}`,"data-width":Math.round(Fe.strugglingPercentage),title:`üî¥ Ë¶ÅÂæ©Áøí: ${Fe.strugglingCount}Ë™û (${Math.round(Fe.strugglingPercentage)}%) ${a?"üìö Âæ©Áøí‰∏≠":""}`,children:Fe.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(Fe.strugglingPercentage),"%"]})})]})})})]})})}),M==="history"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"history-compact",children:n==="grammar"?u.jsx("div",{className:"word-detail-container",children:se.length>0?u.jsx("div",{className:"grammar-units-list",children:se.map(ge=>{const Pe=(ge.correctCount||0)+(ge.incorrectCount||0),tt=ge.masteredCount||0,vt=ge.answeredQuestions||0,Yt=vt>0?Math.round(tt/vt*100):0,gn=ge.historyIcons||"";let jt="üü¢",hn="ÂÆöÁùÄÊ∏à";tt===0&&vt>0?(jt="üî¥",hn="Ë¶ÅÂæ©Áøí"):Yt<80&&vt>0&&(jt="üü°",hn="Â≠¶Áøí‰∏≠");const un=ge.unit.match(/‰∏≠(\d+)/),Et=un?`${un[1]}Âπ¥`:ge.unit,q=ge.unit.match(/Unit(\d+)/),re=q?`Unit${q[1]}`:"",ne=re?`${Et} ${re}Ôºö${ge.title}`:`${Et}Ôºö${ge.title}`;return u.jsxs("div",{className:"grammar-unit-card",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",ne," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[jt," ",hn]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[ge.correctCount,"/",Pe,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),gn&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:gn}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[Yt,"%"]})]})]},ge.unit)})}):u.jsxs("div",{className:"word-detail-empty",children:[u.jsx("p",{children:"„Åæ„Å†ÊñáÊ≥ïÂïèÈ°å„ÅÆËß£Á≠î„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"stat-text-sub",children:"ÂïèÈ°å„ÇíËß£„Åè„Å®ÂçòÂÖÉ„Åî„Å®„ÅÆÊàêÁ∏æ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})}):d&&Ye?u.jsxs("div",{className:"word-detail-container",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",d," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[Ye.statusIcon," ",Ye.statusLabel]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[Ye.correctCount,"/",Ye.totalCount,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),Ye.accuracyHistory&&Ye.accuracyHistory.length>0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:Ye.accuracyHistory}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[Ye.retentionRate,"%"]}),Ye.position!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),u.jsx("span",{className:"word-stat-label",children:"Position:"}),u.jsx("strong",{className:"word-stat-value",children:Ye.position.toFixed(0)})]})]}),(Ye.memorizationPosition!==void 0||Ye.translationPosition!==void 0||Ye.spellingPosition!==void 0||Ye.grammarPosition!==void 0)&&u.jsxs("div",{className:"word-detail-stats",children:[Ye.memorizationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊöóË®ò:"}),u.jsx("strong",{className:"word-stat-value",children:Ye.memorizationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),Ye.translationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÂíåË®≥:"}),u.jsx("strong",{className:"word-stat-value",children:Ye.translationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),Ye.spellingPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"„Çπ„Éö„É´:"}),u.jsx("strong",{className:"word-stat-value",children:Ye.spellingPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),Ye.grammarPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊñáÊ≥ï:"}),u.jsx("strong",{className:"word-stat-value",children:Ye.grammarPosition.toFixed(0)})]})]})]}):d&&!Ye?u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì"})}):u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"ÂïèÈ°å„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅÁèæÂú®„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})})})})}),M==="settings"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsxs("div",{className:"settings-tab-container",children:[u.jsx("h3",{className:"text-lg font-bold mb-4",children:"‚öôÔ∏è Âá∫È°åË®≠ÂÆö"}),(n==="translation"||n==="spelling"||n==="grammar")&&u.jsxs("div",{className:"settings-section",children:[u.jsxs("h4",{className:"font-bold mb-2",children:["üéØ ",n==="translation"?"ÂíåË®≥":n==="spelling"?"„Çπ„Éö„É´":"ÊñáÊ≥ï","„É¢„Éº„Éâ - „Éê„ÉÉ„ÉÅÊï∞Ë®≠ÂÆö"]}),u.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"1Âõû„ÅÆÂ≠¶Áøí„ÅßÂá∫È°å„Åï„Çå„ÇãË™ûÊï∞„ÇíË®≠ÂÆö„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item mb-4",children:[u.jsx("label",{children:"„Éê„ÉÉ„ÉÅÊï∞:"}),u.jsxs("select",{"aria-label":"„Éê„ÉÉ„ÉÅÊï∞",value:ve||0,onChange:ge=>{const Pe=parseInt(ge.target.value),tt=Pe===0?null:Pe;$e(tt),tt===null?localStorage.removeItem(D(`${n}-batch-size`)):localStorage.setItem(D(`${n}-batch-size`),tt.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:75,children:"75"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"}),u.jsx("option",{value:300,children:"300"}),u.jsx("option",{value:500,children:"500"})]}),u.jsx("p",{className:"setting-help",children:"1Âõû„ÅÆÂ≠¶Áøí„ÅßÂá∫È°å„Åï„Çå„ÇãË™ûÊï∞ÔºàË®≠ÂÆöÁÑ°„Åó„ÅÆÂ†¥Âêà„ÅØÂÖ®Ë™ûÂá∫È°åÔºâ"})]}),u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-sm",children:[u.jsx("p",{className:"font-bold mb-2",children:"üí° „Éí„É≥„Éà:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[u.jsx("li",{children:"Â∞ë„Å™„ÅÑÊï∞Ôºà10-30Ôºâ: ÈõÜ‰∏≠„Åó„Å¶Áü≠ÊôÇÈñì„ÅßÂ≠¶Áøí"}),u.jsx("li",{children:"‰∏≠Á®ãÂ∫¶Ôºà50-100Ôºâ: „Éê„É©„É≥„Çπ„ÅÆËâØ„ÅÑÂ≠¶Áøí"}),u.jsx("li",{children:"Â§ö„ÅÑÊï∞Ôºà150-500Ôºâ: „Åò„Å£„Åè„ÇäÈï∑ÊôÇÈñìÂ≠¶Áøí"}),u.jsx("li",{children:"Ë®≠ÂÆöÁÑ°„Åó: „Åô„Åπ„Å¶„ÅÆË™û„ÇíÂá∫È°å"})]})]})]}),(n==="translation"||n==="spelling")&&u.jsxs("div",{className:"settings-section mt-6",children:[u.jsx("h4",{className:"font-bold mb-2",children:"üìñ ÂõûÁ≠îÊôÇ„ÅÆÈÅ∏ÊäûËÇ¢Ë©≥Á¥∞Ë°®Á§∫"}),u.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"ÈÅ∏ÊäûËÇ¢„ÅÆË©≥Á¥∞„ÇíËá™ÂãïÁöÑ„Å´Èñã„Åè„Çø„Ç§„Éü„É≥„Ç∞„ÇíË®≠ÂÆö„Åó„Åæ„Åô"}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[u.jsx("input",{type:"checkbox",checked:we,onChange:ge=>{const Pe=ge.target.checked;Re(Pe),localStorage.setItem("autoShowDetailsOnIncorrect",Pe.toString())},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),u.jsx("span",{className:"text-sm",children:"‰∏çÊ≠£Ëß£ÊôÇ„Å´Ë©≥Á¥∞„ÇíÈñã„Åè"})]}),u.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[u.jsx("input",{type:"checkbox",checked:et,onChange:ge=>{const Pe=ge.target.checked;je(Pe),localStorage.setItem("autoShowDetailsOnCorrect",Pe.toString())},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),u.jsx("span",{className:"text-sm",children:"Ê≠£Ëß£ÊôÇ„Å´Ë©≥Á¥∞„ÇíÈñã„Åè"})]})]}),u.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-sm mt-3",children:[u.jsx("p",{className:"font-bold mb-2",children:"üí° „Éí„É≥„Éà:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[u.jsx("li",{children:"Ê¨°„Å´ÈÄ≤„Åæ„Å™„Åë„Çå„Å∞„ÄÅÈÅ∏ÊäûËÇ¢„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë©≥Á¥∞„ÇíË°®Á§∫„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"Ë©≥Á¥∞„Å´„ÅØ„ÄÅÂêÑÈÅ∏ÊäûËÇ¢„ÅÆË™≠„Åø„ÉªÊÑèÂë≥„Éª‰æãÊñá„Å™„Å©„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"}),u.jsx("li",{children:"‰∏çÊ≠£Ëß£ÊôÇ„ÅÆËá™ÂãïË°®Á§∫„ÅßÂäπÁéáÁöÑ„Å´Âæ©Áøí„Åß„Åç„Åæ„Åô"})]})]})]})]})})})]})}const qf=[{id:"beginner-basic",name:"ÂàùÁ¥öÂü∫Á§é",requiredWords:600,requiredAccuracy:70,description:"Âü∫Êú¨ÁöÑ„Å™ÂçòË™û",icon:"üå±"},{id:"beginner-complete",name:"ÂàùÁ¥öÂÆå‰∫Ü",requiredWords:1077,requiredAccuracy:70,description:"ÂàùÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üåø"},{id:"intermediate-half",name:"‰∏≠Á¥öÂçäÂàÜ",requiredWords:1900,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´50%",icon:"üå≥"},{id:"intermediate-complete",name:"‰∏≠Á¥öÂÆå‰∫Ü",requiredWords:2693,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üéì"},{id:"advanced-half",name:"‰∏äÁ¥öÂçäÂàÜ",requiredWords:3150,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´50%",icon:"üìö"},{id:"advanced-complete",name:"‰∏äÁ¥öÂÆå‰∫Ü",requiredWords:3578,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üöÄ"},{id:"master",name:"„Éû„Çπ„Çø„Éº",requiredWords:4e3,requiredAccuracy:85,description:"ÂÖ®„É¨„Éô„É´Âà∂Ë¶á",icon:"‚≠ê"}];function FY(){const n=localStorage.getItem("user-goal-level");if(n){const e=JSON.parse(n),t=qf.find(s=>s.id===e);if(t)return t}return qf.find(e=>e.id==="intermediate-complete")||qf[0]}function jk(n){const e=n||FY(),t=nt(),s=af();let r=0,o=0;Object.values(t.wordProgress).forEach(m=>{r+=m.correctCount,o+=m.correctCount+m.incorrectCount});const i=o>0?r/o*100:0,a=Math.min(100,s/e.requiredWords*100),c=Math.min(100,i/e.requiredAccuracy*100),l=(a+c)/2,d=s>=e.requiredWords&&i>=e.requiredAccuracy,h=OY(s,e.requiredWords,i,e.requiredAccuracy),f=Math.max(0,e.requiredWords-s),p=h>0?Math.ceil(f/h):0;return{goal:e,currentWords:s,currentAccuracy:Math.round(i),wordsProgress:Math.round(a),accuracyProgress:Math.round(c),overallProgress:Math.round(l),isAchieved:d,estimatedDaysToAchieve:h,recommendedDailyWords:Math.min(50,p)}}function OY(n,e,t,s){if(n>=e&&t>=s)return 0;const r=nt(),i=Date.now()-7*24*60*60*1e3;let a=0;Object.values(r.wordProgress).forEach(g=>{g.lastStudied>=i&&g.masteryLevel==="mastered"&&a++});const c=a/7,l=Math.max(5,c),h=Math.max(0,e-n)/l,p=Math.max(0,s-t)*2,m=Math.ceil(h+p);return Math.max(1,m)}function ZZ(n=!0){const e=jk();if(e.isAchieved)return`üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ${e.goal.name}„É¨„Éô„É´„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅ`;const t=[];if(t.push(`${e.goal.icon} ${e.goal.name}„Åæ„Åß ${e.overallProgress}%`),e.currentWords<e.goal.requiredWords){const s=e.goal.requiredWords-e.currentWords;t.push(`„ÅÇ„Å®${s}Ë™û`)}return e.estimatedDaysToAchieve>0&&(e.estimatedDaysToAchieve<=7?t.push(`„ÅÇ„Å®${e.estimatedDaysToAchieve}Êó•„ÅßÈÅîÊàêÔºÅ`):e.estimatedDaysToAchieve<=30?t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/7)}ÈÄ±Èñì„ÅßÈÅîÊàêË¶ãËæº„Åø`):t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/30)}„É∂Êúà„ÅßÈÅîÊàêË¶ãËæº„Åø`)),n&&(e.overallProgress>=80?t.push("„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÈÅîÊàê„Åß„ÅôÔºÅÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=50?t.push("È†ÜË™ø„Å´ÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=25&&t.push("ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ")),t.join(" ")}const LY={accept:["except"],except:["accept"],affect:["effect"],effect:["affect"],dessert:["desert"],desert:["dessert"],quiet:["quite"],quite:["quiet"],lose:["loose"],loose:["lose"],advice:["advise"],advise:["advice"],breath:["breathe"],breathe:["breath"],cloth:["clothe","clothes"],clothe:["cloth","clothes"],clothes:["cloth","clothe"],borrow:["lend"],lend:["borrow"],teach:["learn"],learn:["teach"],speak:["talk","say","tell"],talk:["speak","say","tell"],say:["speak","talk","tell"],tell:["speak","talk","say"],see:["look","watch"],look:["see","watch"],watch:["see","look"],hear:["listen"],listen:["hear"],bring:["take"],take:["bring"],come:["go"],go:["come"],in:["on","at"],on:["in","at"],at:["in","on"],for:["to","of"],to:["for","of"],of:["for","to"],already:["all ready"],"all ready":["already"],altogether:["all together"],"all together":["altogether"],everyday:["every day"],"every day":["everyday"]};function _k(n){const e=n.toLowerCase();return LY[e]||[]}function zY(){const n=nt(),e=[],t=new Set;return Object.entries(n.wordProgress).forEach(([s])=>{if(t.has(s.toLowerCase()))return;const r=_k(s);if(r.length===0)return;const o=[s,...r].map(f=>f.toLowerCase()),i=Array.from(new Set(o));let a=0,c=0;i.forEach(f=>{const p=n.wordProgress[f];p&&(a+=p.incorrectCount,c+=p.correctCount+p.incorrectCount)});const l=c>0?a/c:0,d=Math.min(100,l*100*Math.log1p(c));let h="spelling";["speak","talk","say","tell","see","look","watch"].includes(s.toLowerCase())?h="meaning":["in","on","at","for","to","of"].includes(s.toLowerCase())&&(h="grammar"),e.push({words:i,type:h,description:WY(i,h),confusionScore:Math.round(d),totalErrors:a,needsReview:d>30||l>.3}),i.forEach(f=>t.add(f))}),e.filter(s=>s.totalErrors>0).sort((s,r)=>r.confusionScore-s.confusionScore)}function WY(n,e){return e==="spelling"?`„Çπ„Éö„É´„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:e==="meaning"?`ÊÑèÂë≥„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:`ÊñáÊ≥ïÁöÑ„Å´Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ: ${n.join(", ")}`}function BY(n){const e=nt(),t={},s=[];n.words.forEach(i=>{const a=e.wordProgress[i];if(a){const c=a.correctCount+a.incorrectCount,l=c>0?a.correctCount/c*100:0;t[i]=l,s.push(l)}});const r=s.length>0?s.reduce((i,a)=>i+a,0)/s.length:0,o=s.length>0?s.reduce((i,a)=>i+Math.pow(a-r,2),0)/s.length:0;return{groupRetention:Math.round(r),individualRetentions:t,variance:Math.round(o)}}function VY(n){const e=BY(n);return e.groupRetention<50?`‚ö†Ô∏è ${n.words.join(", ")} „ÅÆÂå∫Âà•„ÅåÊõñÊòß„Åß„Åô„ÄÇÈõÜ‰∏≠ÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`:e.variance>500?`üìä ${n.words.join(", ")} „ÅßÂÆöÁùÄÂ∫¶„Å´„Å∞„Çâ„Å§„Åç„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂº±„ÅÑÂçòË™û„ÇíÈáçÁÇπÁöÑ„Å´„ÄÇ`:e.groupRetention<70?`üí™ ${n.words.join(", ")} „Çí„ÇÇ„ÅÜÂ∞ë„ÅóÁ∑¥Áøí„Åô„Çã„Å®ÂÆåÁíß„Åß„ÅôÔºÅ`:`‚úÖ ${n.words.join(", ")} „ÅÆÂå∫Âà•„Åå„Åó„Å£„Åã„Çä„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ`}function UY(n){const e=/^[^:]+:\s*[""](.+?)[""]$/,t=n.match(e);if(t)return t[1].trim();const s=/^[^:]+:\s*(.+)$/,r=n.match(s);return r?r[1].trim():n}function kr(n,e={}){if(!("speechSynthesis"in window)){j.warn("„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØWeb Speech API„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì");return}const t=UY(n);if(window.speechSynthesis.speaking||window.speechSynthesis.pending){window.speechSynthesis.cancel(),setTimeout(()=>{Nb(t,e)},50);return}Nb(t,e)}function Nb(n,e){const t=new SpeechSynthesisUtterance(n),s=localStorage.getItem("speechRate"),r=localStorage.getItem("voiceGender");t.lang=e.lang||"en-US",t.rate=e.rate||(s?parseFloat(s):.85),t.pitch=e.pitch||1,t.volume=e.volume||1;const i=window.speechSynthesis.getVoices().filter(c=>c.lang.startsWith("en-")),a=["Google US English","Google UK English Female","Google UK English Male","Samantha","Alex","Microsoft Aria Online","Microsoft Guy Online","Karen","Daniel"];if(r==="female"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("female")||l.name.toLowerCase().includes("woman")||l.name.toLowerCase().includes("samantha")||l.name.toLowerCase().includes("karen")||l.name.toLowerCase().includes("aria"));c&&(t.voice=c)}else if(r==="male"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("male")||l.name.toLowerCase().includes("man")||l.name.toLowerCase().includes("alex")||l.name.toLowerCase().includes("daniel")||l.name.toLowerCase().includes("guy"));c&&(t.voice=c)}else{const c=i.find(l=>a.some(d=>l.name.includes(d)));c&&(t.voice=c)}t.onerror=c=>{j.error("Èü≥Â£∞ÂêàÊàê„Ç®„É©„Éº:",c)},window.speechSynthesis.speak(t)}function kn(){return"speechSynthesis"in window}function eee(){"speechSynthesis"in window&&window.speechSynthesis.cancel()}function tee(){"speechSynthesis"in window&&window.speechSynthesis.speaking&&window.speechSynthesis.pause()}function nee(){"speechSynthesis"in window&&window.speechSynthesis.paused&&window.speechSynthesis.resume()}function see(){return"speechSynthesis"in window&&window.speechSynthesis.speaking}function ree(){return"speechSynthesis"in window&&window.speechSynthesis.paused}const xc=({word:n,sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:o="medium",variant:i="icon"})=>{const[a,c]=N.useState(!1),l=e.filter(g=>g.words.some(x=>x.word===n.word)),d=l.length>0,h={small:"text-sm px-2 py-1",medium:"text-base px-3 py-1.5",large:"text-lg px-4 py-2"},f={small:"text-base",medium:"text-lg",large:"text-xl"},p=g=>{if(g.stopPropagation(),e.length===0){r();return}if(e.length===1){const x=e[0];d?s(x.id,n):t(x.id,n)}else c(!a)},m=(g,x)=>{x?s(g,n):t(g,n)};return u.jsxs("div",{className:"relative inline-block",children:[u.jsxs("button",{onClick:p,className:`
          ${h[o]}
          ${d?"bg-green-500 hover:bg-green-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}
          rounded-md font-medium transition-colors duration-200
          flex items-center gap-1
        `,title:d?`${l.length}ÂÄã„ÅÆ„Çª„ÉÉ„Éà„Å´ËøΩÂä†Ê∏à„Åø`:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Å´ËøΩÂä†",children:[u.jsx("span",{className:f[o],children:d?"‚úì":"+"}),i!=="icon"&&u.jsx("span",{children:d?"ËøΩÂä†Ê∏à„Åø":"ËøΩÂä†"})]}),a&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),u.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-80 overflow-y-auto",children:[u.jsx("div",{className:"p-2 border-b border-gray-200",children:u.jsx("p",{className:"text-sm font-medium text-gray-700",children:"„Çª„ÉÉ„Éà„ÇíÈÅ∏Êäû"})}),u.jsx("div",{className:"p-2",children:e.map(g=>{const x=g.words.some(y=>y.word===n.word);return u.jsxs("button",{onClick:()=>{m(g.id,x),c(!1)},className:`
                      w-full text-left px-3 py-2 rounded-md mb-1
                      flex items-center justify-between
                      ${x?"bg-green-50 text-green-700":"hover:bg-gray-100:bg-gray-700 text-gray-700"}
                    `,children:[u.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[u.jsx("span",{children:g.icon||"üìñ"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("p",{className:"text-sm font-medium truncate",children:g.name}),u.jsxs("p",{className:"text-xs text-gray-500",children:[g.words.length,"Ë™û"]})]})]}),u.jsx("span",{className:"text-lg ml-2",children:x?"‚úì":"+"})]},g.id)})}),u.jsx("div",{className:"p-2 border-t border-gray-200",children:u.jsx("button",{onClick:()=>{c(!1),r()},className:"w-full text-left px-3 py-2 rounded-md hover:bg-gray-100:bg-gray-700 text-blue-600 text-sm font-medium",children:"‚ûï Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})})]})]})]})};var ks=(n=>(n.MEMORY_ACQUISITION="memory_acquisition",n.COGNITIVE_LOAD="cognitive_load",n.ERROR_PREDICTION="error_prediction",n.LEARNING_STYLE="learning_style",n.LINGUISTIC_RELATIONS="linguistic_relations",n.CONTEXTUAL_LEARNING="contextual_learning",n))(ks||{}),Rt=(n=>(n.IMMEDIATE_REPETITION="immediate_repetition",n.TAKE_BREAK="take_break",n.USE_CONFUSION_PAIRS="use_confusion_pairs",n.REDUCE_DIFFICULTY="reduce_difficulty",n.SPACED_REPETITION="spaced_repetition",n.CONTEXTUAL_LEARNING="contextual_learning",n.GROUP_BY_THEME="group_by_theme",n.ADJUST_SESSION_LENGTH="adjust_session_length",n.USE_ETYMOLOGY="use_etymology",n.TIME_OF_DAY_OPTIMIZATION="time_of_day_optimization",n.INCREASE_EXPOSURE="increase_exposure",n.CONTINUE_NORMAL="continue_normal",n))(Rt||{});const GY={enabled:!1,minSignalStrength:.3,minConfidence:.5,maxActiveSignals:10,effectivenessWindowSize:50},Os={debug:(n,e)=>{},info:(n,e)=>console.info(`[SignalDetector] ${n}`,e),warn:(n,e)=>console.warn(`[SignalDetector] ${n}`,e),error:(n,e)=>console.error(`[SignalDetector] ${n}`,e)};class HY{constructor(e){me(this,"config");me(this,"signalCache",new Map);me(this,"cacheTimeout",5e3);this.config=e}async initialize(){Os.info("SignalDetector initializing..."),Os.info("SignalDetector initialized")}async detectSignals(e,t,s){const r=Date.now(),o=[],i=[],a=`${e}-${t}-${s.attemptNumber}`,c=this.getCachedSignals(a);if(c)return c;const l=[this.detectMemoryAcquisitionSignals(e,t,s),this.detectCognitiveLoadSignals(s),this.detectErrorPredictionSignals(e,t),this.detectLearningStyleSignals(s),this.detectLinguisticRelationsSignals(e),this.detectContextualLearningSignals(e,t)];if((await Promise.allSettled(l)).forEach((p,m)=>{const g=this.getModuleName(m);p.status==="fulfilled"?(o.push(...p.value),Os.debug(`${g} signals detected`,{count:p.value.length})):(i.push({module:g,error:p.reason}),Os.warn(`${g} failed`,p.reason))}),o.length===0&&i.length>0)return Os.error("All AI modules failed",{errors:i}),[];i.length>0&&o.length>0&&Os.warn("Some AI modules failed",{failed:i.length,succeeded:o.length});const h=this.filterAndSortSignals(o);this.cacheSignals(a,h);const f=Date.now()-r;return Os.debug("Signal detection completed",{duration:f,signalCount:h.length}),h}async detectMemoryAcquisitionSignals(e,t,s){const r=[];try{const o=this.getAcquisitionProgress(e);if(!o)return r;t==="incorrect"&&this.shouldImmediateRepeat(o)&&r.push({source:ks.MEMORY_ACQUISITION,type:Rt.IMMEDIATE_REPETITION,strength:this.calculateImmediateRepeatStrength(o),confidence:.9,priority:9,timestamp:Date.now(),metadata:{currentExposure:o.totalAttempts,targetExposure:o.dynamicThreshold,consecutiveErrors:this.getConsecutiveErrors(o),acquisitionProgress:this.calculateAcquisitionProgress(o)}}),t==="correct"&&o.correctRate>=.5&&r.push({source:ks.MEMORY_ACQUISITION,type:Rt.SPACED_REPETITION,strength:Math.min(o.correctRate,.8),confidence:.85,priority:7,timestamp:Date.now(),metadata:{correctRate:o.correctRate,consecutiveCorrect:o.consecutiveCorrectStreak}}),t==="incorrect"&&o.totalAttempts<o.dynamicThreshold&&r.push({source:ks.MEMORY_ACQUISITION,type:Rt.INCREASE_EXPOSURE,strength:1-o.totalAttempts/o.dynamicThreshold,confidence:.8,priority:8,timestamp:Date.now(),metadata:{currentAttempts:o.totalAttempts,targetAttempts:o.dynamicThreshold}})}catch(o){Os.error("Memory Acquisition signal detection failed",o)}return r}async detectCognitiveLoadSignals(e){const t=[];try{const s=e.cognitiveLoad??this.estimateCognitiveLoad(e);s>.8&&t.push({source:ks.COGNITIVE_LOAD,type:Rt.TAKE_BREAK,strength:Math.min(s,1),confidence:.95,priority:10,timestamp:Date.now(),metadata:{cognitiveLoad:s,sessionDuration:e.sessionDuration,recommendedBreakDuration:this.calculateBreakDuration(s),fatigueLevel:this.getFatigueLevel(s)}}),s>.6&&e.recentErrors>=2&&t.push({source:ks.COGNITIVE_LOAD,type:Rt.REDUCE_DIFFICULTY,strength:(s+e.recentErrors/5)/2,confidence:.8,priority:8,timestamp:Date.now(),metadata:{cognitiveLoad:s,recentErrors:e.recentErrors}});const r=e.sessionDuration?e.sessionDuration/6e4:0;r>30&&t.push({source:ks.COGNITIVE_LOAD,type:Rt.ADJUST_SESSION_LENGTH,strength:Math.min(r/60,.6),confidence:.7,priority:6,timestamp:Date.now(),metadata:{sessionDuration:e.sessionDuration,sessionMinutes:r}})}catch(s){Os.error("Cognitive Load signal detection failed",s)}return t}async detectErrorPredictionSignals(e,t){const s=[];try{if(t==="incorrect"){const r=this.getConfusionPairs(e);r.length>0&&s.push({source:ks.ERROR_PREDICTION,type:Rt.USE_CONFUSION_PAIRS,strength:Math.min(.7+r.length*.1,.9),confidence:.85,priority:8,timestamp:Date.now(),metadata:{confusionPairs:r,errorType:this.detectErrorType(e)}}),this.needsContextualLearning(e)&&s.push({source:ks.ERROR_PREDICTION,type:Rt.CONTEXTUAL_LEARNING,strength:.6,confidence:.75,priority:7,timestamp:Date.now(),metadata:{reason:"context_insufficient"}})}}catch(r){Os.error("Error Prediction signal detection failed",r)}return s}async detectLearningStyleSignals(e){const t=[];try{const s=new Date().getHours(),r=this.getOptimalLearningHour(),o=Math.abs(s-r);o>3&&t.push({source:ks.LEARNING_STYLE,type:Rt.TIME_OF_DAY_OPTIMIZATION,strength:Math.min(o/12,.5),confidence:.6,priority:4,timestamp:Date.now(),metadata:{currentHour:s,optimalHour:r}});const i=25*60*1e3,a=Math.abs((e.sessionDuration??0)-i);a>10*60*1e3&&t.push({source:ks.LEARNING_STYLE,type:Rt.ADJUST_SESSION_LENGTH,strength:Math.min(a/(30*60*1e3),.6),confidence:.65,priority:5,timestamp:Date.now(),metadata:{currentSessionLength:e.sessionDuration,optimalSessionLength:i}})}catch(s){Os.error("Learning Style signal detection failed",s)}return t}async detectLinguisticRelationsSignals(e){const t=[];try{e.length>3&&t.push({source:ks.LINGUISTIC_RELATIONS,type:Rt.GROUP_BY_THEME,strength:.6,confidence:.5,priority:6,timestamp:Date.now(),metadata:{simplified:!0,reason:"Èñ¢ÈÄ£Ë™ûÂΩô„Å´„Çà„Çã„Ç∞„É´„Éº„ÉóÂ≠¶Áøí„ÇíÊé®Â•®"}}),e.length>=4&&t.push({source:ks.LINGUISTIC_RELATIONS,type:Rt.USE_ETYMOLOGY,strength:.4,confidence:.5,priority:5,timestamp:Date.now(),metadata:{simplified:!0,reason:"Ë™ûÊ∫êÊÉÖÂ†±„ÇíÊ¥ªÁî®„Åó„ÅüÂ≠¶Áøí„ÇíÊé®Â•®"}})}catch(s){Os.error("Linguistic Relations signal detection failed",s)}return t}async detectContextualLearningSignals(e,t){const s=[];try{if(t==="incorrect"){this.hasAvailableContexts(e)&&s.push({source:ks.CONTEXTUAL_LEARNING,type:Rt.CONTEXTUAL_LEARNING,strength:.75,confidence:.85,priority:7,timestamp:Date.now(),metadata:{availableContexts:this.getAvailableContextCount(e)}});const o=this.getThemeCategory(e);o&&s.push({source:ks.CONTEXTUAL_LEARNING,type:Rt.GROUP_BY_THEME,strength:.6,confidence:.75,priority:6,timestamp:Date.now(),metadata:{themeCategory:o}})}}catch(r){Os.error("Contextual Learning signal detection failed",r)}return s}filterAndSortSignals(e){const t=this.config.minSignalStrength??.3,s=e.filter(r=>r.strength>=t);return s.sort((r,o)=>o.priority-r.priority),s.slice(0,this.config.maxActiveSignals)}cacheSignals(e,t){this.signalCache.set(e,t),setTimeout(()=>{this.signalCache.delete(e)},this.cacheTimeout)}getCachedSignals(e){return this.signalCache.get(e)||null}getModuleName(e){return["MemoryAcquisition","CognitiveLoad","ErrorPrediction","LearningStyle","LinguisticRelations","ContextualLearning"][e]||"Unknown"}getAcquisitionProgress(e){try{const t=`acquisition_${e}`,s=localStorage.getItem(t);if(s)return JSON.parse(s)}catch(t){Os.warn("Failed to load acquisition progress",t)}return null}shouldImmediateRepeat(e){return this.getConsecutiveErrors(e)>=3}getConsecutiveErrors(e){let t=0;for(let s=e.todayReviews.length-1;s>=0&&!e.todayReviews[s].isCorrect;s--)t++;return t}calculateImmediateRepeatStrength(e){const t=this.getConsecutiveErrors(e);return Math.min(.8+t*.05,1)}calculateAcquisitionProgress(e){return Math.min(e.totalAttempts/e.dynamicThreshold*100,100)}estimateCognitiveLoad(e){const t=Math.min((e.sessionDuration??0)/36e5,1),s=Math.min(e.recentErrors/5,1);return(t+s)/2}calculateBreakDuration(e){return e>=.9?10*60*1e3:e>=.8?5*60*1e3:3*60*1e3}getFatigueLevel(e){return e>=.8?"high":e>=.5?"medium":"low"}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}detectErrorType(e){return"meaning"}needsContextualLearning(e){return["abstract","concept","theory","principle"].includes(e)}getOptimalLearningHour(){return 10}hasAvailableContexts(e){return!0}getAvailableContextCount(e){return 3}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const wr={debug:(n,e)=>{},info:(n,e)=>console.info(`[StrategyExecutor] ${n}`,e),warn:(n,e)=>console.warn(`[StrategyExecutor] ${n}`,e),error:(n,e)=>console.error(`[StrategyExecutor] ${n}`,e)};class qY{constructor(e){me(this,"config");me(this,"strategyHistory",[]);me(this,"MAX_HISTORY",20);this.config=e}async initialize(){wr.info("StrategyExecutor initializing..."),this.loadHistory(),wr.info("StrategyExecutor initialized")}selectBestStrategy(e,t){try{if(!Array.isArray(e))throw new Error("Signals must be an array");if(e.length===0)return wr.info("No signals provided, using default strategy"),this.getDefaultRecommendation();const s=this.config.minConfidence??.5,r=e.filter(c=>c.confidence>=s);if(r.length===0)return wr.warn("No signals meet confidence threshold",{totalSignals:e.length,minConfidence:this.config.minConfidence}),this.getDefaultRecommendation();const o=r.find(c=>c.priority===10);if(o)return wr.info("Critical priority signal detected",{type:o.type}),this.createRecommendation(o,r,"critical_priority");const i=r.map(c=>({signal:c,score:this.calculateScore(c,t)}));i.forEach(c=>{const l=this.calculateDiversityPenalty(c.signal.type);c.score-=l}),i.sort((c,l)=>l.score-c.score);const a=i[0];return wr.debug("Strategy selected",{strategy:a.signal.type,score:a.score,totalSignals:r.length}),this.createRecommendation(a.signal,r,"score_based",a.score)}catch(s){return wr.error("Strategy selection failed",{signals:e,error:s}),this.getFallbackRecommendation(s)}}async executeStrategy(e,t,s){const r=Date.now();try{if(!Object.values(Rt).includes(e))throw new Error(`Invalid strategy type: ${e}`);const o=[];switch(e){case Rt.IMMEDIATE_REPETITION:o.push(await this.executeImmediateRepetition(t));break;case Rt.TAKE_BREAK:o.push(...await this.executeTakeBreak(s));break;case Rt.USE_CONFUSION_PAIRS:o.push(await this.executeConfusionPairs(t));break;case Rt.REDUCE_DIFFICULTY:o.push(await this.executeReduceDifficulty(t));break;case Rt.SPACED_REPETITION:o.push(await this.executeSpacedRepetition(t));break;case Rt.CONTEXTUAL_LEARNING:o.push(await this.executeContextualLearning(t));break;case Rt.GROUP_BY_THEME:o.push(await this.executeGroupByTheme(t));break;case Rt.ADJUST_SESSION_LENGTH:o.push(await this.executeAdjustSessionLength(s));break;case Rt.USE_ETYMOLOGY:o.push(await this.executeUseEtymology(t));break;case Rt.TIME_OF_DAY_OPTIMIZATION:o.push(await this.executeTimeOfDayOptimization());break;case Rt.INCREASE_EXPOSURE:o.push(await this.executeIncreaseExposure(t));break;case Rt.CONTINUE_NORMAL:break;default:wr.warn(`No execution logic for strategy: ${e}`)}return this.recordUsage(e),{success:!0,strategy:e,actions:o,duration:Date.now()-r}}catch(o){return wr.error("Strategy execution failed",{strategy:e,word:t,error:o}),{success:!1,strategy:e,actions:[],duration:Date.now()-r,error:o instanceof Error?o.message:String(o)}}}async executeImmediateRepetition(e){return{type:"QUEUE_FRONT",timestamp:Date.now(),metadata:{word:e,position:0,queueType:"immediate"}}}async executeTakeBreak(e){const t=this.calculateBreakDuration(e);return[{type:"PAUSE_SESSION",timestamp:Date.now(),metadata:{duration:t,reason:"cognitive_load"}},{type:"SHOW_BREAK_NOTIFICATION",timestamp:Date.now(),metadata:{message:`${t/6e4}ÂàÜÈñì„ÅÆ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô`}}]}async executeConfusionPairs(e){const t=this.getConfusionPairs(e);return{type:"LOAD_CONFUSION_PAIRS",timestamp:Date.now(),metadata:{word:e,pairs:t}}}async executeReduceDifficulty(e){return{type:"ADJUST_DIFFICULTY",timestamp:Date.now(),metadata:{word:e,direction:"decrease",amount:1}}}async executeSpacedRepetition(e){return{type:"SCHEDULE_SPACED_REVIEW",timestamp:Date.now(),metadata:{word:e,nextReviewTime:Date.now()+24*60*60*1e3}}}async executeContextualLearning(e){return{type:"SHOW_CONTEXT_EXAMPLES",timestamp:Date.now(),metadata:{word:e,exampleCount:3}}}async executeGroupByTheme(e){const t=this.getThemeCategory(e);return{type:"GROUP_WORDS_BY_THEME",timestamp:Date.now(),metadata:{word:e,theme:t}}}async executeAdjustSessionLength(e){return{type:"ADJUST_SESSION_LENGTH",timestamp:Date.now(),metadata:{currentLength:e.sessionDuration,recommendedLength:15e5}}}async executeUseEtymology(e){return{type:"SHOW_ETYMOLOGY",timestamp:Date.now(),metadata:{word:e}}}async executeTimeOfDayOptimization(){return{type:"SUGGEST_OPTIMAL_TIME",timestamp:Date.now(),metadata:{optimalHour:10,message:"Â≠¶ÁøíÂäπÊûú„ÅåÊúÄ„ÇÇÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÅØ10ÊôÇÈ†É„Åß„Åô"}}}async executeIncreaseExposure(e){return{type:"INCREASE_EXPOSURE_FREQUENCY",timestamp:Date.now(),metadata:{word:e,multiplier:1.5}}}calculateScore(e,t){const s=e.strength*e.priority,r=e.confidence*2;let o=0;const i=t.get(e.type);if(i){o=i.successRate*3;const a=Date.now()-i.lastUsed,c=Math.max(0,2-a/1e6);o-=c}return s+r+o}calculateDiversityPenalty(e){return this.strategyHistory.slice(-5).filter(s=>s.strategy===e).length*.5}createRecommendation(e,t,s,r){return{strategy:e.type,confidence:e.confidence,reason:this.generateReason(e),signals:t,metadata:{selectionMethod:s,score:r,signalSource:e.source}}}generateReason(e){return{[Rt.IMMEDIATE_REPETITION]:"ÈÄ£Á∂ö„Ç®„É©„Éº„ÅåÊ§úÂá∫„Åï„Çå„Åü„Åü„ÇÅ„ÄÅÂç≥Â∫ß„Å´Âæ©Áøí„Åó„Åæ„Åô",[Rt.TAKE_BREAK]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô",[Rt.USE_CONFUSION_PAIRS]:"Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑÂçòË™û„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü",[Rt.REDUCE_DIFFICULTY]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅÈõ£ÊòìÂ∫¶„Çí‰∏ã„Åí„Åæ„Åô",[Rt.SPACED_REPETITION]:"ÁøíÂæó„ÅåÈÄ≤„Çì„Åß„ÅÑ„Çã„Åü„ÇÅ„ÄÅÈñìÈöî„ÇíÁ©∫„Åë„Å¶Âæ©Áøí„Åó„Åæ„Åô",[Rt.CONTEXTUAL_LEARNING]:"ÊñáËÑà‰æãÊñá„ÅßÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô",[Rt.GROUP_BY_THEME]:"Èñ¢ÈÄ£Ë™ûÂΩô„Å®„Çª„ÉÉ„Éà„ÅßÂ≠¶Áøí„Åó„Åæ„Åô",[Rt.ADJUST_SESSION_LENGTH]:"„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑„ÇíÊúÄÈÅ©Âåñ„Åó„Åæ„Åô",[Rt.USE_ETYMOLOGY]:"Ë™ûÊ∫êÊÉÖÂ†±„ÅßË®òÊÜ∂„ÇíÂº∑Âåñ„Åó„Åæ„Åô",[Rt.TIME_OF_DAY_OPTIMIZATION]:"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø„ÇíÊèêÊ°à„Åó„Åæ„Åô",[Rt.INCREASE_EXPOSURE]:"Èú≤Âá∫ÂõûÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Å¶ÂÆöÁùÄ„Çí‰øÉÈÄ≤„Åó„Åæ„Åô",[Rt.CONTINUE_NORMAL]:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô"}[e.type]||"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊà¶Áï•„ÇíÈÅ©Áî®„Åó„Åæ„Åô"}getDefaultRecommendation(){return{strategy:Rt.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!1,default:!0}}}getFallbackRecommendation(e){return{strategy:Rt.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:e==null?void 0:e.message}}}recordUsage(e){this.strategyHistory.push({strategy:e,timestamp:Date.now()}),this.strategyHistory.length>this.MAX_HISTORY&&this.strategyHistory.shift(),this.saveHistory()}saveHistory(){try{localStorage.setItem("adaptive_strategy_history",JSON.stringify(this.strategyHistory))}catch(e){wr.warn("Failed to save strategy history",e)}}loadHistory(){try{const e=localStorage.getItem("adaptive_strategy_history");e&&(this.strategyHistory=JSON.parse(e))}catch(e){wr.warn("Failed to load strategy history",e)}}calculateBreakDuration(e){const t=e.cognitiveLoad??.5;return t>=.9?10*60*1e3:t>=.8?5*60*1e3:3*60*1e3}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const Br={debug:(n,e)=>{},info:(n,e)=>console.info(`[EffectivenessTracker] ${n}`,e),warn:(n,e)=>console.warn(`[EffectivenessTracker] ${n}`,e),error:(n,e)=>console.error(`[EffectivenessTracker] ${n}`,e)},Ib="adaptive_network_effectiveness";class KY{constructor(e){me(this,"effectiveness",new Map);me(this,"measurements",[]);me(this,"config");me(this,"saveTimer",null);this.config=e}async initialize(){Br.info("EffectivenessTracker initializing..."),await this.loadHistory(),Br.info("EffectivenessTracker initialized",{strategies:this.effectiveness.size,measurements:this.measurements.length})}recordOutcome(e,t){try{if(!Object.values(Rt).includes(e))throw new Error(`Invalid strategy: ${e}`);if(typeof t.success!="boolean")throw new Error("Outcome.success must be boolean");let s=this.effectiveness.get(e);s||(s=this.createDefaultEffectiveness(e),this.effectiveness.set(e,s)),s.totalUses++,t.success?s.successCount++:s.failureCount++,s.successRate=s.successCount/s.totalUses,s.lastUsed=t.timestamp,t.timeToMastery!==void 0&&this.updateAverage(s,"averageTimeToMastery",t.timeToMastery),t.retentionRate!==void 0&&this.updateAverage(s,"averageRetentionRate",t.retentionRate),s.confidence=this.calculateConfidence(s.totalUses),this.measurements.push({strategy:e,outcome:t,timestamp:Date.now()});const r=this.config.effectivenessWindowSize??50;this.measurements.length>r*2&&(this.measurements=this.measurements.slice(-r)),Br.debug("Outcome recorded",{strategy:e,success:t.success,totalUses:s.totalUses,successRate:s.successRate}),this.debounceSave()}catch(s){Br.error("Failed to record outcome",{strategy:e,outcome:t,error:s})}}getEffectiveness(e){return this.effectiveness.get(e)}getAllEffectiveness(){return new Map(this.effectiveness)}compareStrategies(e,t){const s=this.effectiveness.get(e),r=this.effectiveness.get(t);if(!s||!r)return{strategy1:e,strategy2:t,betterStrategy:null,successRateDiff:0,confidenceLevel:0,recommendation:"„Éá„Éº„Çø‰∏çË∂≥„ÅÆ„Åü„ÇÅÊØîËºÉ„Åß„Åç„Åæ„Åõ„Çì"};const o=s.successRate-r.successRate,i=this.calculateStatisticalSignificance(s,r);let a=null;Math.abs(o)>.05&&i>.8&&(a=o>0?e:t);let c="";return a?c=`${a}„ÅÆÊñπ„ÅåÂäπÊûúÁöÑ„Åß„ÅôÔºàÂ∑Æ: ${(Math.abs(o)*100).toFixed(1)}%Ôºâ`:i<.8?c="„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô":c="‰∏°Êà¶Áï•„ÅÆÂäπÊûú„ÅØÂêåÁ®ãÂ∫¶„Åß„Åô",{strategy1:e,strategy2:t,betterStrategy:a,successRateDiff:o,confidenceLevel:i,recommendation:c}}exportMetrics(){const e=Array.from(this.effectiveness.values()),t=e.filter(i=>i.totalUses>=10).sort((i,a)=>a.successRate-i.successRate).slice(0,3).map(i=>({strategy:i.strategyType,successRate:i.successRate,uses:i.totalUses})),s=[];t.length>0&&s.push(`ÊúÄ„ÇÇÂäπÊûúÁöÑ„Å™Êà¶Áï•: ${t[0].strategy}ÔºàÊàêÂäüÁéá: ${(t[0].successRate*100).toFixed(1)}%Ôºâ`);const r=e.filter(i=>i.totalUses>=10&&i.successRate<.5).map(i=>i.strategyType);r.length>0&&s.push(`ÊîπÂñÑ„ÅåÂøÖË¶Å„Å™Êà¶Áï•: ${r.join(", ")}`);const o=e.filter(i=>i.totalUses<10);return o.length>0&&s.push(`„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å: ${o.length}ÂÄã„ÅÆÊà¶Áï•`),{topPerformers:t,recommendations:s,timestamp:Date.now()}}reset(){Br.info("Resetting effectiveness data"),this.effectiveness.clear(),this.measurements=[],this.saveToStorage()}createDefaultEffectiveness(e){return{strategyType:e,totalUses:0,successCount:0,failureCount:0,successRate:0,averageTimeToMastery:0,averageRetentionRate:0,lastUsed:0,confidence:0}}updateAverage(e,t,s){const r=e[t],o=e.totalUses;e[t]=(r*(o-1)+s)/o}calculateConfidence(e){return Math.min(1,e/(e+2+2))}calculateStatisticalSignificance(e,t){const s=e.totalUses,r=t.totalUses,o=Math.abs(e.successRate-t.successRate);return(Math.min(1,(s+r)/100)+o)/2}async loadHistory(){try{const e=localStorage.getItem(Ib);if(!e){Br.info("No stored effectiveness data found");return}const t=JSON.parse(e);t.strategies&&t.strategies.forEach(s=>{this.effectiveness.set(s.strategyType,s)}),Array.isArray(t.measurements)&&(this.measurements=t.measurements),Br.info("Effectiveness data loaded",{strategies:this.effectiveness.size,measurements:this.measurements.length})}catch(e){Br.error("Failed to load effectiveness data",e)}}saveToStorage(){try{const e={version:"1.0.0",strategies:Array.from(this.effectiveness.values()),measurements:this.measurements,lastUpdated:Date.now()};localStorage.setItem(Ib,JSON.stringify(e)),Br.debug("Effectiveness data saved")}catch(e){Br.warn("Failed to save effectiveness data",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveToStorage(),this.saveTimer=null},500)}}const on={debug:(n,e)=>{},info:(n,e)=>console.info(`[AdaptiveNetwork] ${n}`,e),warn:(n,e)=>console.warn(`[AdaptiveNetwork] ${n}`,e),error:(n,e)=>console.error(`[AdaptiveNetwork] ${n}`,e)},yu="adaptive_network_state",XY="adaptive_network_config";class QY{constructor(e){me(this,"signalDetector");me(this,"strategyExecutor");me(this,"effectivenessTracker");me(this,"state");me(this,"config");me(this,"saveTimer",null);this.config={...GY,...e},this.state=this.createInitialState(),this.signalDetector=new HY(this.config),this.strategyExecutor=new qY(this.config),this.effectivenessTracker=new KY(this.config),this.loadState(),on.info("AdaptiveEducationalAINetwork created",{enabled:this.config.enabled})}async initialize(){on.info("Initializing AdaptiveEducationalAINetwork...");try{await Promise.all([this.signalDetector.initialize(),this.strategyExecutor.initialize(),this.effectivenessTracker.initialize()]),this.validateAndRepairState(),on.info("AdaptiveEducationalAINetwork initialized successfully")}catch(e){on.error("Initialization failed",e);try{this.initializeWithDefaults(),on.info("Initialized with default configuration")}catch{throw new Error(`Failed to initialize Adaptive Network: ${e instanceof Error?e.message:String(e)}`)}}}async processQuestion(e,t,s){try{this.validateInput(e,t,s)}catch(r){return on.error("Invalid input",{word:e,result:t,context:s,error:r}),this.getDefaultRecommendation()}if(!this.state.enabled)return this.getDefaultRecommendation();try{const r=await this.signalDetector.detectSignals(e,t,s);on.debug("Signals detected",{word:e,result:t,signalCount:r.length});const o=this.strategyExecutor.selectBestStrategy(r,this.state.effectiveness);return on.info("Strategy selected",{word:e,result:t,strategy:o.strategy,confidence:o.confidence}),this.executeStrategyAsync(o.strategy,e,s),this.updateState(o,r),this.updateSessionStats(t),this.debounceSave(),o}catch(r){return on.error("Question processing failed",{word:e,result:t,context:s,error:r}),{strategy:Rt.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{error:!0,fallback:!0,errorMessage:r instanceof Error?r.message:String(r)}}}}getState(){return{...this.state}}updateConfig(e){this.config={...this.config,...e},e.enabled!==void 0&&(this.state.enabled=e.enabled),this.saveConfig(),on.info("Configuration updated",e)}resetState(){on.info("Resetting network state"),this.state=this.createInitialState(),this.effectivenessTracker.reset();try{localStorage.removeItem(yu)}catch(e){on.warn("Failed to remove state from storage",e)}on.info("Network state reset complete")}exportState(){const e={version:"1.0.0",state:this.state,config:this.config,effectiveness:Array.from(this.state.effectiveness.entries()),exportedAt:Date.now()};return JSON.stringify(e,null,2)}importState(e){try{const t=JSON.parse(e);t.version!=="1.0.0"&&on.warn("Version mismatch, attempting migration",{expected:"1.0.0",actual:t.version}),t.state&&(this.state={...t.state,effectiveness:new Map(t.effectiveness||[])}),t.config&&(this.config=t.config),this.saveState(),this.saveConfig(),on.info("State imported successfully")}catch(t){throw on.error("Failed to import state",t),new Error(`Invalid state data: ${t instanceof Error?t.message:String(t)}`)}}createInitialState(){return{enabled:this.config.enabled,currentStrategy:null,activeSignals:[],effectiveness:new Map,sessionStats:{questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0},lastUpdated:Date.now()}}initializeWithDefaults(){this.state=this.createInitialState(),on.info("Initialized with defaults")}validateInput(e,t,s){if(!e||typeof e!="string")throw new Error("Invalid word parameter");if(t!=="correct"&&t!=="incorrect")throw new Error('Result must be "correct" or "incorrect"');if(!s||typeof s!="object")throw new Error("Invalid context parameter")}getDefaultRecommendation(){return{strategy:Rt.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}async executeStrategyAsync(e,t,s){try{const r=await this.strategyExecutor.executeStrategy(e,t,s);r.success?on.debug("Strategy executed",{strategy:e,actionCount:r.actions.length,duration:r.duration}):on.warn("Strategy execution failed",{strategy:e,error:r.error})}catch(r){on.error("Strategy execution error",{strategy:e,error:r})}}updateState(e,t){this.state.currentStrategy=e.strategy,this.state.activeSignals=t,this.state.lastUpdated=Date.now()}updateSessionStats(e){this.state.sessionStats.questionsAnswered++,e==="correct"?this.state.sessionStats.correctAnswers++:this.state.sessionStats.incorrectAnswers++,this.state.sessionStats.totalSessionTime=Date.now()-this.state.sessionStats.sessionStartTime}validateAndRepairState(){typeof this.state.enabled!="boolean"&&(on.warn("Invalid enabled state, repairing"),this.state.enabled=!1),Array.isArray(this.state.activeSignals)||(on.warn("Invalid activeSignals, repairing"),this.state.activeSignals=[]),this.state.effectiveness instanceof Map||(on.warn("Invalid effectiveness map, repairing"),this.state.effectiveness=new Map),(!this.state.sessionStats||typeof this.state.sessionStats!="object")&&(on.warn("Invalid sessionStats, repairing"),this.state.sessionStats={questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0})}loadState(){try{const e=localStorage.getItem(yu);if(!e){on.info("No stored state found");return}const t=JSON.parse(e);t.effectiveness&&Array.isArray(t.effectiveness)&&(t.effectiveness=new Map(t.effectiveness)),this.state={...this.state,...t},on.info("State loaded from storage")}catch(e){on.error("Failed to load state",e)}}saveState(){try{const e=this.config.maxActiveSignals??10,t={...this.state,activeSignals:Array.isArray(this.state.activeSignals)?this.state.activeSignals.slice(-e):[],effectiveness:Array.from(this.state.effectiveness.entries())},s=JSON.stringify(t);if(s.length>2e5){const r={enabled:this.state.enabled,currentStrategy:this.state.currentStrategy,sessionStats:this.state.sessionStats,lastUpdated:this.state.lastUpdated,activeSignals:[],effectiveness:Array.from(this.state.effectiveness.entries())};localStorage.setItem(yu,JSON.stringify(r));return}localStorage.setItem(yu,s),on.debug("State saved to storage")}catch(e){on.warn("Failed to save state",e)}}saveConfig(){try{localStorage.setItem(XY,JSON.stringify(this.config))}catch(e){on.warn("Failed to save config",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveState(),this.saveTimer=null},500)}}function lf(){const n=N.useRef(null),[e,t]=N.useState(!0),[s,r]=N.useState(null),[o,i]=N.useState(new Map),[a,c]=N.useState(!1),[l,d]=N.useState(null),[h,f]=N.useState(!1);N.useEffect(()=>{(async()=>{try{if(!n.current){n.current=new QY({enabled:!0}),await n.current.initialize();const b=n.current.getState();t(b.enabled),r(b.currentStrategy),i(b.effectiveness),f(!0),console.log("[useAdaptiveNetwork] Network initialized")}}catch(b){d(b instanceof Error?b:new Error(String(b))),console.error("[useAdaptiveNetwork] Initialization failed",b)}})()},[]);const p=N.useCallback(async(y,b,w)=>{if(!n.current)return console.warn("[useAdaptiveNetwork] Network not initialized"),YY();c(!0),d(null);try{const v=await n.current.processQuestion(y,b,w);r(v.strategy);const S=n.current.getState();return i(S.effectiveness),v}catch(v){const S=v instanceof Error?v:new Error(String(v));return d(S),console.error("[useAdaptiveNetwork] Question processing failed",v),JY(S)}finally{c(!1)}},[e]),m=N.useCallback(()=>{if(!n.current)return;const y=!e;n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`)},[e]),g=N.useCallback(y=>{n.current&&(n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`))},[]),x=N.useCallback(()=>{n.current&&(n.current.resetState(),r(null),i(new Map),d(null),console.log("[useAdaptiveNetwork] State reset"))},[]);return{enabled:e,currentStrategy:s,processQuestion:p,toggleEnabled:m,setEnabled:g,resetState:x,effectiveness:o,isLoading:a,error:l,isInitialized:h}}function YY(){return{strategy:Rt.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}function JY(n){return{strategy:Rt.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:n.message}}}function Gp({question:n,allQuestions:e,currentIndex:t,answered:s,selectedAnswer:r,onAnswer:o,onNext:i,onPrevious:a,onDifficultyRate:c,customQuestionSets:l=[],onAddWordToCustomSet:d,onRemoveWordFromCustomSet:h,onOpenCustomSetManagement:f,onFullscreen:p}){const m=N.useMemo(()=>gk(n,e,t),[n.word,e,t]),[g,x]=N.useState(null),[y,b]=N.useState(new Set),[w,v]=N.useState(""),[S,C]=N.useState(0),[,k]=N.useState(()=>{const O=sessionStorage.getItem("currentCorrectStreak");return O?parseInt(O,10):0}),{processQuestion:I}=lf(),A=async(O,F)=>{try{const V=oe=>{const ve=(oe.grade||1)/9;return Math.min(Math.max(ve,0),1)},G=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(ve=>!ve.correct).length,_=()=>{const oe=sessionStorage.getItem("sessionStartTime");return oe?Math.floor((Date.now()-parseInt(oe))/6e4):0},Z=()=>parseInt(sessionStorage.getItem("currentCorrectStreak")||"0"),te=()=>{const oe=new Date().getHours();return oe<12?"morning":oe<18?"afternoon":oe<22?"evening":"night"},he=await I(O,F?"correct":"incorrect",{currentDifficulty:V(n),timeOfDay:te(),recentErrors:G(),sessionLength:_(),consecutiveCorrect:Z()});console.log("[AdaptiveAI]",he.reason,{strategy:he.strategy,confidence:he.confidence})}catch(V){console.error("[QuestionCard] Adaptive AI error:",V)}},T=N.useRef(0),E=N.useRef(0),$=N.useRef(null),D=N.useRef(!1);N.useEffect(()=>{x(null),b(new Set),v(""),C(0)},[t]);const M=O=>{b(F=>{const V=new Set(F);return s?V.size>0?new Set:new Set(m.map((G,_)=>_)):(V.has(O)?V.delete(O):V.add(O),V)})};N.useEffect(()=>{if(!s||!r)return;const O=localStorage.getItem("autoShowDetailsOnIncorrect"),F=localStorage.getItem("autoShowDetailsOnCorrect"),V=localStorage.getItem("autoShowDetails"),G=O!==null?O==="true":V!==null?V!=="false":!0,_=F!==null?F==="true":!1,Z=r===n.meaning;(!Z&&G||Z&&_)&&b(new Set(m.map((he,oe)=>oe)))},[s,r,n.meaning,m]),N.useEffect(()=>{if(s&&r){const O=localStorage.getItem("aiPersonality")||"kind-teacher",F=r===n.meaning,V=parseInt(sessionStorage.getItem("currentCorrectStreak")||"0",10);let G=Ek(O,{isCorrect:F,word:n.word,difficulty:"intermediate",category:"",attemptCount:S+1,responseTime:0,correctStreak:0,incorrectStreak:0,userAccuracy:0,categoryAccuracy:0,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:0,todayAccuracy:0,planProgress:0,timeOfDay:yx()});const _=[];if(F&&Math.random()<.1){const he=jk();he.estimatedDaysToAchieve>0&&he.estimatedDaysToAchieve<=30&&(he.overallProgress>=90?_.push(`üéØ ${he.goal.name}„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ`):he.overallProgress>=75&&_.push(`üìà „Åì„ÅÆ„Éö„Éº„Çπ„Å™„Çâ${he.estimatedDaysToAchieve}Êó•„Åß${he.goal.name}ÈÅîÊàê„Åß„ÅôÔºÅ`))}if(!F){const he=_k(n.word);he.length>0&&_.push(`üí° „Äå${n.word}„Äç„Å®„Äå${he.join(", ")}„Äç„ÇíÊ∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßÊ≥®ÊÑèÔºÅ`)}if(!F&&Math.random()<.05){const oe=zY().find(ve=>ve.words.includes(n.word.toLowerCase())&&ve.needsReview);oe&&_.push(VY(oe))}const Z=NY(O,F,V);if(Z&&_.push(Z.message),F){const he=$Y(V+1);he&&_.push(he)}const te=_Y(F);if(te&&_.push(te),F){const he=V+1;k(he),sessionStorage.setItem("currentCorrectStreak",String(he))}else k(0),sessionStorage.setItem("currentCorrectStreak","0");_.length>0&&(G=`${G} ${_[0]}`),v(G)}else v("")},[s,r,n,S]);const P=()=>{b(new Set),C(0),i()};N.useEffect(()=>{const O=_=>{const Z=_.target;Z.closest(".choice-btn")||Z.closest(".choice-wrapper")||Z.closest(".toggle-details-btn")||Z.closest(".rating-btn")||Z.closest(".inline-nav-btn")||Z.closest(".question-text")||(T.current=_.touches[0].clientX,E.current=T.current,D.current=!0)},F=_=>{T.current!==0&&(E.current=_.touches[0].clientX)},V=()=>{if(T.current===0){D.current=!1;return}E.current===0&&(E.current=T.current);const _=T.current-E.current;Math.abs(_)>80&&(_>0?s?P():i():t>0&&a()),T.current=0,E.current=0,setTimeout(()=>{D.current=!1},300)},G=$.current;if(G)return G.addEventListener("touchstart",O,{passive:!0}),G.addEventListener("touchmove",F,{passive:!0}),G.addEventListener("touchend",V),()=>{G.removeEventListener("touchstart",O),G.removeEventListener("touchmove",F),G.removeEventListener("touchend",V)}},[s,t,i,a]),N.useEffect(()=>{const O=F=>{if(!s&&["1","2","3","4"].includes(F.key)){const V=parseInt(F.key)-1;if(V<m.length){F.preventDefault();const G=m[V].text,_=m[V].question,Z=G===n.meaning;Z||C(te=>te+1),o(G,n.meaning,_),A(n.word,Z)}}else!s&&F.key===" "?(F.preventDefault(),i()):F.key==="Enter"&&(F.preventDefault(),s?P():i())};return window.addEventListener("keydown",O),()=>{window.removeEventListener("keydown",O)}},[s,m,n,o,S]);const L=O=>{const F="w-full min-h-11 sm:min-h-14 p-2 sm:p-4 text-sm sm:text-base rounded-xl border-2 cursor-pointer transition-all duration-300 flex flex-col items-center text-center touch-manipulation select-none shadow-sm",V="hover:border-blue-600 hover:bg-gray-100:bg-gray-800 hover:-translate-y-1 hover:shadow-lg",G="active:bg-gray-200:bg-gray-700 active:translate-y-0";return O==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?s?O===r?`${F} bg-red-600 border-red-600 text-white`:`${F} bg-gray-100 text-gray-600 border-gray-400`:`${F} bg-gray-100 text-gray-600 border-gray-400 ${V} ${G}`:s?O===n.meaning?`${F} bg-green-600 border-green-600 text-white`:O===r&&O!==n.meaning?`${F} bg-red-600 border-red-600 text-white`:`${F} bg-gray-50 text-gray-900 border-gray-300`:`${F} bg-gray-50 text-gray-900 border-gray-300 ${V} ${G}`};return u.jsxs("div",{className:"question-card",ref:$,children:[p&&u.jsx("button",{onClick:p,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:a,disabled:t===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:`question-content-inline ${kn()?"clickable-pronunciation":""}`,onClick:O=>{kn()&&(O.preventDefault(),O.stopPropagation(),kr(n.word,{rate:.85}))},onTouchEnd:O=>{kn()&&(O.preventDefault(),O.stopPropagation(),kr(n.word,{rate:.85}))},title:kn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 break-words ${n.word.includes(" ")?"phrase-text":""} ${kn()?"clickable-word":""}`,children:[n.word,kn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),n.reading&&u.jsxs("div",{className:"question-reading text-sm sm:text-base text-gray-600 mt-1",children:["„Äê",n.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[n.difficulty&&u.jsx("div",{className:`difficulty-badge ${n.difficulty}`,children:n.difficulty==="beginner"?"ÂàùÁ¥ö":n.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),d&&h&&f&&l&&u.jsx(xc,{word:{word:n.word,meaning:n.meaning,katakana:n.reading,source:"translation"},sets:l,onAddWord:d,onRemoveWord:h,onOpenManagement:f,size:"medium",variant:"both"})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:P,title:"Ê¨°„Å∏",children:"‚Üí"})]}),u.jsx("div",{className:"choices",children:m.map((O,F)=>{const V=y.has(F),G=O.question;return u.jsxs("div",{className:"choice-wrapper",children:[u.jsx("button",{className:L(O.text),onClick:_=>{if(s){_.preventDefault(),_.stopPropagation(),G&&M(F);return}const Z=O.text===n.meaning;Z||C(te=>te+1),o(O.text,n.meaning,G),A(n.word,Z)},disabled:!1,children:u.jsx("div",{className:"choice-content",children:u.jsx("div",{className:"choice-text",children:O.text})})}),s&&G&&V&&u.jsxs("div",{className:"choice-details",children:[u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™ûÂè•:"}),u.jsx("span",{className:"detail-text",children:G.word})]}),G.reading&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-text",children:G.reading})]}),G.meaning&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-text",children:G.meaning})]}),G.etymology&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠â:"}),u.jsx("span",{className:"detail-text",children:G.etymology})]}),G.relatedWords&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-text",children:G.relatedWords})]}),G.relatedFields&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è ÂàÜÈáé:"}),u.jsx("span",{className:"detail-text",children:G.relatedFields})]}),G.difficulty&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("span",{className:"detail-text",children:G.difficulty})]})]})]},F)})})]})}const Pk="ab_session_logs_v1";function Mk(){try{const n=localStorage.getItem(Pk);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch(n){return console.error("[AB Storage] Failed to load session logs:",n),[]}}function ZY(){const n=Mk();return JSON.stringify(n,null,2)}function eJ(){try{localStorage.removeItem(Pk)}catch(n){console.error("[AB Storage] Failed to clear session logs:",n)}}function Kf(n){if(n.length===0)return 0;const e=[...n].sort((s,r)=>s-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}function bu(n){return n.length===0?0:n.reduce((e,t)=>e+t,0)/n.length}function Xf(n,e){const t=n.filter(a=>a.variant===e);if(t.length===0)return null;const s=t.map(a=>a.acquiredWordCount),r=t.map(a=>a.acquisitionRate),o=t.map(a=>a.vibrationScore),i=t.map(a=>a.durationSec);return{variant:e,sessionCount:t.length,avgAcquiredWords:bu(s),medianAcquiredWords:Kf(s),avgAcquisitionRate:bu(r),medianAcquisitionRate:Kf(r),avgVibrationScore:bu(o),medianVibrationScore:Kf(o),avgDurationSec:bu(i)}}function kb(){const n=Mk();return{totalSessions:n.length,byVariant:{A:Xf(n,"A"),B:Xf(n,"B"),C:Xf(n,"C")},lastUpdated:Date.now()}}function Ar(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function tJ(n,e){if(!n)return null;switch(e){case"memorization":return n.memorizationPosition??null;case"translation":return n.translationPosition??null;case"spelling":return n.spellingPosition??null;case"grammar":return n.grammarPosition??null}}function Qf(n,e){if(!n)return 0;switch(e){case"memorization":return Ar(n.memorizationAttempts,0);case"translation":return Ar(n.translationAttempts,0);case"spelling":return Ar(n.spellingAttempts,0);case"grammar":return Ar(n.grammarAttempts,0)}}function $b(n,e){if(!n)return 0;switch(e){case"memorization":return Ar(n.memorizationCorrect,0);case"translation":return Ar(n.translationCorrect,0);case"spelling":return Ar(n.spellingCorrect,0);case"grammar":return Ar(n.grammarCorrect,0)}}function Tb(n,e){return!n||e!=="memorization"?0:Ar(n.memorizationStillLearning,0)}function ra(n){const{value:e}=Qp("debug_postProcess_output",{mode:n});return e?Array.isArray(e)?e:Array.isArray(e==null?void 0:e.top30)?e.top30:[]:[]}function nJ(n){return Qp("debug_postProcess_meta",{mode:n}).value}function sJ(n){const e="social-studies-progress",t={storageKey:e,storedTerms:0,deckStats:{new:n.deckWords.length,incorrect:0,stillLearning:0,learning:0,mastered:0}};try{const s=localStorage.getItem(e);if(!s)return t;const r=JSON.parse(s),o=(r==null?void 0:r.termProgress)??{},i=Object.keys(o).length,a={new:0,incorrect:0,stillLearning:0,learning:0,mastered:0};for(const h of n.deckWords){const f=o[h];if(!f||typeof f.position!="number"){a.new++;continue}const p=f.position;p>=71?a.incorrect++:p>=41?a.stillLearning++:p>=21?a.learning++:a.mastered++}const c=n.currentWord,l=c?o[c]:null,d=l&&typeof l.position=="number"?{position:Number(l.position),correctCount:Ar(l.correctCount,0),incorrectCount:Ar(l.incorrectCount,0),field:typeof l.field=="string"?l.field:void 0,nextReviewDate:l.nextReviewDate?String(l.nextReviewDate):void 0,lastAnswered:l.lastAnswered?String(l.lastAnswered):void 0}:void 0;return{storageKey:e,storedTerms:i,lastUpdated:typeof(r==null?void 0:r.lastUpdated)=="number"?r.lastUpdated:void 0,version:typeof(r==null?void 0:r.version)=="number"?r.version:void 0,deckStats:a,current:d}}catch{return t}}function bx({subject:n="english",allDataSourceLabel:e,mode:t,currentIndex:s,totalQuestions:r,questions:o,requeuedWords:i=[],initialExpanded:a=!0,answerHistory:c=[],onClose:l,onClearHistory:d}){const[h,f]=N.useState(a),[p,m]=N.useState([]),[g,x]=N.useState(!1),[y,b]=N.useState([]),[w,v]=N.useState(null),[S,C]=N.useState([]),[k,I]=N.useState([]),[A,T]=N.useState(null);N.useEffect(()=>{const $=Bf(t);b($)},[s,t]),N.useEffect(()=>{if(h){const $=kb();T($)}},[h,s]);const E=()=>{var ge,Pe,tt,vt,Yt,gn,jt,hn,un,Et;const $=new Date().toISOString(),{value:D,key:M}=Qp("debug_categorySlots_output",{mode:t}),P=(()=>{const q=`## üéØ „Ç´„ÉÜ„Ç¥„É™„Éº„Çπ„É≠„ÉÉ„ÉàÊñπÂºèÔºö5ÊÆµÈöé„Éë„Ç§„Éó„É©„Ç§„É≥

`;if(!D)return q+`‚ö†Ô∏è debug_categorySlots_output_${t} „Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†„Çπ„Ç±„Ç∏„É•„Éº„É´„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ / „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Åó„ÅüÂèØËÉΩÊÄßÔºâ
`;const re=(D==null?void 0:D.stats)||{},ne=(D==null?void 0:D.top30)||[],B=["### ‚ë† „Ç´„ÉÜ„Ç¥„É™ÂàÜÈ°ûÔºàPositionË®àÁÆóÔºâ","","**ÂÖ®ÂçòË™û„Çí4„Ç´„ÉÜ„Ç¥„É™„Å´ÂàÜÈ°û**:",`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${re.incorrect||0}Ë™û`,`- üü° „Åæ„Å†„Åæ„Å† (Position 40-69, attempts>0): ${re.still_learning||0}Ë™û`,`- üîµ Êñ∞Ë¶è (Position 20-39): ${re.new||0}Ë™û`,`- ‚úÖ ÂÆöÁùÄÊ∏à (Position <20): ${re.mastered||0}Ë™û`,"","---","","### ‚ë° ÊåØÂãïÈò≤Ê≠¢ÔºàDTA: Direct Time AdjustmentÔºâ","","**Áõ¥Ëøë10Ë™û„Å´Position -30„Éö„Éä„É´„ÉÜ„Ç£**:",...ne.filter(z=>z.wasRecent).slice(0,10).map((z,le)=>`${le+1}. **${z.word}** - Position ${z.position.toFixed(0)} („Éö„Éä„É´„ÉÜ„Ç£Âæå) ‚Üí „Ç´„ÉÜ„Ç¥„É™: ${z.category}`).concat(ne.filter(z=>z.wasRecent).length===0?["_(Áõ¥ËøëË™û„Å™„Åó)_"]:[]),"","‚ö†Ô∏è **ÈáçË¶Å**: „Éö„Éä„É´„ÉÜ„Ç£Âæå„ÇÇ„Ç´„ÉÜ„Ç¥„É™Â∏Ø„ÅÆÊúÄ‰ΩéÂÄ§Ôºàincorrect=70, still_learning=40, new=20Ôºâ„Åß„ÇØ„É©„É≥„Éó„Åï„Çå„ÄÅ„Ç´„ÉÜ„Ç¥„É™„ÅØÁ∂≠ÊåÅ„Åï„Çå„Åæ„Åô„ÄÇ","","---","","### ‚ë¢ „Çπ„É≠„ÉÉ„ÉàÂâ≤ÂΩìÔºà„Ç´„ÉÜ„Ç¥„É™ÊØîÁéáÔºâ","","**„Éê„ÉÉ„ÉÅÊúÄÂ§ß100Ë™û„ÇíÂêÑ„Ç´„ÉÜ„Ç¥„É™„Å´ÈÖçÂàÜ**:",`- üî¥ incorrect: ${re.incorrect||0}Ë™û / ‰∏äÈôê40%`,`- üü° still_learning: ${re.still_learning||0}Ë™û / ÊÆã„Çä„ÅÆ50%`,`- üîµ new: ${re.new||0}Ë™û / ÊÆã„Çä`,`- ‚úÖ mastered: ${re.mastered||0}Ë™û / ‰Ωô„Çä`,"","ÂêÑ„Çπ„É≠„ÉÉ„ÉàÂÜÖ„Åß **PositionÈôçÈ†Ü** „ÇΩ„Éº„ÉàÂæå„ÄÅ**„ÅÑ„ÇÇ„Å•„ÇãÂºèÂ≠¶Áøí**ÔºàÈñ¢ÈÄ£Ë™ûËøëÊé•ÈÖçÁΩÆÔºâ„ÇíÈÅ©Áî®„ÄÇ","","---","","### ‚ë£ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥Ôºà„Çπ„É≠„ÉÉ„ÉàÈñì‰∏¶„Å≥Êõø„ÅàÔºâ","","**GamificationAI.interleaveByCategory() „Åß‰∫§‰∫íÈÖçÁΩÆ**:","- incorrectÈÄ£Á∂ö„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÄÅ[incorrect 3-5Âïè ‚Üí new 1Âïè] „Éë„Çø„Éº„É≥„Åß‰∫§‰∫íÈÖçÁΩÆ",`- ÂÆüË°å: ${re.interleavedByCategory?"‚úÖ ÂÆüÊñΩÊ∏à„Åø":"‚ùå Êú™ÂÆüÊñΩ"}`,"","---","","### ‚ë§ Á¢∫ÂÆö„Éê„ÉÉ„ÉÅÔºàÂá∫È°å‰∫àÂÆöTOP30Ôºâ","","| # | ÂçòË™û | Position | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ | Áõ¥ËøëË™û |","|---|------|----------|----------|----------|--------|",...ne.map((z,le)=>{var Qe;const ee=z.category,be=ee==="incorrect"?"üî¥":ee==="still_learning"?"üü°":ee==="new"?"üîµ":"‚úÖ",He=z.wasRecent?"‚ö†Ô∏è":"";return`| ${le+1} | **${z.word}** | ${z.position.toFixed(0)} | ${be} ${ee} | ${((Qe=D==null?void 0:D.top30AttemptsMap)==null?void 0:Qe[z.word])??"?"}Âõû | ${He} |`}),"","**Áµ±Ë®à**:",`- Á∑èÊï∞: ${re.total||0}Ë™û`,`- ÈáçË§áÈô§Â§ñ: ${re.duplicatesRemoved||0}Ë™û`,`- „ÅÑ„ÇÇ„Å•„ÇãÂºèÂ≠¶Áøí: ${re.chainLearning?"ÊúâÂäπ":"ÁÑ°Âäπ"}`,"","---","","### üìã JSONË©≥Á¥∞Ôºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ","",`- storageKey: ${M??`debug_categorySlots_output_${t}`}`,"","<details>","<summary>JSON„ÇíÂ±ïÈñã</summary>","","```json",JSON.stringify(D,null,2),"```","","</details>"].join(`
`);return q+B})(),L=(()=>{try{const q=localStorage.getItem("debug_useCategorySlots");if(q)return JSON.parse(q)}catch{}return{enabled:!0,source:"hardcoded"}})(),O=(()=>{try{const re=JSON.parse(localStorage.getItem(`debug_requeue_log_${t}`)||"[]").slice(-50),ne=re.filter(z=>z.action==="inserted").length,B=re.filter(z=>{var le;return(le=z.action)==null?void 0:le.startsWith("skipped")}).length;return{inserted:ne,skipped:B,total:re.length}}catch{return{inserted:0,skipped:0,total:0}}})(),F=nt(),V=Object.keys(F.wordProgress||{}).length,G=Object.values(F.wordProgress||{}),_=G.filter(q=>tJ(q,t)==null).length,Z=G.filter(q=>(q==null?void 0:q.category)==null).length,te=G.filter(q=>(q==null?void 0:q.lastStudied)==null).length,he=G.filter(q=>(q==null?void 0:q.correctCount)==null||(q==null?void 0:q.incorrectCount)==null||(q==null?void 0:q.consecutiveCorrect)==null).length;let oe=0,ve=0,$e=0,Ae=0,De=0,we=0,Re=0;for(const q of G){const re=Qf(q,t),ne=$b(q,t),B=Tb(q,t),z=Jt(q,t);De+=re,we+=ne,Re+=B,re!==0&&(z>=70?($e++,Ae++):z>=40?(ve++,Ae++):z<20&&oe++)}const et=Math.max(0,De-we-Re),je=De>0?(we/De*100).toFixed(1):"0.0",lt=F.wordProgress||{},ht=q=>String(q??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),it=q=>ht(q).toLowerCase(),st=new Map;for(const q of Object.keys(lt)){const re=it(q);st.has(re)||st.set(re,q)}const Ye=q=>{const re=ht(q);if(!re)return null;const ne=lt[re];if(ne)return ne;const B=lt[re.toLowerCase()];if(B)return B;const z=st.get(it(re));return z?lt[z]??null:null},Tt=ra(t).slice(0,10).map(q=>String((q==null?void 0:q.word)??"")).filter(Boolean),se=o.slice(s+1,s+11).map(q=>String(q.word??"")).filter(Boolean),Ge=Tt.length>0?Tt:se,ze=Tt.length>0?"postProcess() TOP10":"propsÔºàÁèæÂú®‰ΩçÁΩÆ„ÅÆÊ¨°10ÂïèÔºâ",Nt=q=>{const re=Ye(q),ne=Jt(re,t),B=Qf(re,t),z=B===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":ne>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ne>=40?"üü° „Åæ„Å†„Åæ„Å†":ne>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return{position:ne,attempts:B,status:z}},sn=Ge.length>0&&Ge.every(q=>Nt(q).position<40),Ht=p.length===0?"_Ôºà„Éá„Éº„Çø„Å™„ÅóÔºâ_":`| ÂçòË™û | Position | Category | üß† Memory | üí§ CogLoad | üîÆ Error | üìö Linguistic | üåç Context | üéØ Style | üéÆ Gamify |
|------|----------|----------|-----------|-----------|----------|--------------|-----------|----------|----------|
`+p.map(q=>{const re=(()=>{switch(q.category){case"incorrect":return"‚ùå ÂàÜ„Åã„Çâ„Å™„ÅÑ";case"still_learning":return"üü° „Åæ„Å†„Åæ„Å†";case"mastered":return"‚úÖ ÂÆöÁùÄÊ∏à";case"new":return"‚ö™ Êñ∞Ë¶è";default:return"‚ö™ Êñ∞Ë¶è"}})(),ne=(q.position??0).toFixed(0),B=q.aiProposals||{};return`| **${q.word}** | ${ne} | ${re} | ${(B.memory??0).toFixed(0)} | ${(B.cognitiveLoad??0).toFixed(0)} | ${(B.errorPrediction??0).toFixed(0)} | ${(B.linguistic??0).toFixed(0)} | ${(B.contextual??0).toFixed(0)} | ${(B.learningStyle??0).toFixed(0)} | ${(B.gamification??0).toFixed(0)} |`}).join(`
`),Fe=`# üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„É¨„Éù„Éº„ÉàÔºàË©≥Á¥∞ÁâàÔºâ

**ÁîüÊàêÊó•ÊôÇ**: ${$}
    **mode**: ${t}
**ÁèæÂú®‰ΩçÁΩÆ**: ${s+1} / ${r} ÂïèÁõÆ

---

## ‚öôÔ∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Ë®≠ÂÆö

**Âá∫È°åÊñπÂºè**: ${L.enabled?"‚úÖ „Ç´„ÉÜ„Ç¥„É™„Éº„Çπ„É≠„ÉÉ„ÉàÊñπÂºè":"‚ùå ÂæìÊù•ÊñπÂºè"}
- useCategorySlots: **${L.enabled?"true":"false"}** ${L.source==="hardcoded"?"(„Éè„Éº„Éâ„Ç≥„Éº„Éâ)":""}
- ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø: ${L.enabled?"**ÁÑ°Âäπ**Ôºà„Éê„ÉÉ„ÉÅÂÜÖÂêÑË™û1Âõû‰øùË®ºÔºâ":"**ÊúâÂäπ**ÔºàË™§Á≠î/„Åæ„Å†„Åæ„Å†„ÇíÂÜçÊåøÂÖ•Ôºâ"}

**Áõ¥Ëøë50‰ª∂„ÅÆÂÜçÂá∫È°å„É≠„Ç∞**:
- ÊåøÂÖ•ÔºàinsertedÔºâ: ${O.inserted}Âõû ${L.enabled&&O.inserted>0?"‚ö†Ô∏è **Ë≠¶Âëä: Êú¨Êù•0„Åß„ÅÇ„Çã„Åπ„Åç**":""}
- „Çπ„Ç≠„ÉÉ„ÉóÔºàskippedÔºâ: ${O.skipped}Âõû
- Á∑è„É≠„Ç∞Êï∞: ${O.total}Âõû

${L.enabled&&O.inserted>0?`üö® **ÈáçÂ§ß„Å™ÂïèÈ°å**: useCategorySlots=true „Å´„ÇÇ„Åã„Åã„Çè„Çâ„ÅöÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ
‚Üí ‰øÆÊ≠£„ÅåÂèçÊò†„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÄÅÂà•ÁµåË∑Ø„ÅßÂ∑Æ„ÅóËæº„Åø„ÅåËµ∑„Åç„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`:""}
${!L.enabled&&O.inserted>0?`‚úÖ ÂæìÊù•ÊñπÂºè„Åß„ÅØÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`:""}
${L.enabled&&O.inserted===0&&O.skipped>0?`‚úÖ ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÊ≠£Â∏∏„Å´ÁÑ°ÂäπÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºàÂÖ®„Å¶„Çπ„Ç≠„ÉÉ„ÉóÔºâ„ÄÇ
`:""}

---

${ad.generateSummary(t)}

---

${(()=>{var q,re;try{const ne=localStorage.getItem("debug_weak_words_detection");if(ne){const B=JSON.parse(ne),z=(B.allWeakWordsInLS||0)-(((q=B.missingFromBase)==null?void 0:q.length)||0),le=((re=B.missingFromBase)==null?void 0:re.length)||0;let ee=`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

`;return ee+=`**timestamp**: ${B.timestamp||"N/A"}

`,ee+=`- üìä LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û: **${B.allWeakWordsInLS||0}Ë™û**
`,ee+=`- ‚úÖ Ê§úÂá∫ÊàêÂäüÔºàbaseQuestions„Å´Â≠òÂú®Ôºâ: **${z}Ë™û**
`,ee+=`- ‚ùå „Éá„Éº„ÇøÊ¨†ÊêçÔºàbaseQuestions„Å´‰∏çÂú®Ôºâ: **${le}Ë™û**
`,ee+=`- üìÅ baseQuestionsÁ∑èÊï∞: ${B.baseQuestionsCount||0}Ë™û
`,ee+=`- üîç filteredÁ∑èÊï∞: ${B.filteredCount||0}Ë™û

`,le>0&&(ee+=`### ‚ùå Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº: baseQuestions„Å´Â≠òÂú®„Åó„Å™„ÅÑ„Åæ„Å†„Åæ„Å†Ë™û

`,B.missingFromBase&&B.missingFromBase.length>0&&(ee+="```\n",B.missingFromBase.forEach((be,He)=>{ee+=`${He+1}. ${be}
`}),ee+="```\n\n",ee+=`**ÂéüÂõ†**: „Åì„Çå„Çâ„ÅÆÂçòË™û„ÅåÂÖÉ„ÅÆJSON„Éá„Éº„ÇøÔºàjuniorWords.jsonÁ≠âÔºâ„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
`,ee+=`**ÂØæÁ≠ñ**: „Éá„Éº„Çø„ÇΩ„Éº„Çπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅ„Åì„Çå„Çâ„ÅÆÂçòË™û„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

`)),B.weakWordsList&&B.weakWordsList.length>0&&(ee+=`### üìã LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û„É™„Çπ„Éà

`,ee+=`| # | ÂçòË™û | Position | memPos | attempts |
`,ee+=`|---|------|----------|--------|----------|
`,B.weakWordsList.slice(0,20).forEach((be,He)=>{ee+=`| ${He+1} | **${be.word}** | ${be.position} | ${be.memPos??"-"} | ${be.attempts}Âõû |
`}),B.weakWordsList.length>20&&(ee+=`
_‚Ä¶‰ªñ${B.weakWordsList.length-20}Ë™ûÁúÅÁï•_
`),ee+=`
`),B.weakQuestionsWords&&B.weakQuestionsWords.length>0&&(ee+=`### ‚úÖ Ê§úÂá∫„Åï„Çå„ÅüweakQuestions

`,ee+="```\n",B.weakQuestionsWords.slice(0,10).forEach((be,He)=>{ee+=`${He+1}. ${be}
`}),B.weakQuestionsWords.length>10&&(ee+=`...‰ªñ${B.weakQuestionsWords.length-10}Ë™û
`),ee+="```\n\n"),ee+=`---

`,ee}}catch(ne){return`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

‚ö†Ô∏è Ê§úÂá∫„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${ne}

---

`}return""})()}

## üìä „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ

**Á∑èÂêàÁµ±Ë®à**:
- üìö Á∑èÂçòË™ûÊï∞: ${V}Ë™û
- ‚úÖ ÁøíÂæóÊ∏à„Åø (Position < 20): ${oe}Ë™û (${V>0?(oe/V*100).toFixed(1):"0.0"}%)
- üü° „Åæ„Å†„Åæ„Å† (Position 40-70, attempts>0): ${ve}Ë™û
- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${$e}Ë™û
- ‚ö†Ô∏è Ëã¶ÊâãË™ûÂêàË®à (Position‚â•40): ${Ae}Ë™û

**Ëß£Á≠îÁµ±Ë®à**:
- Á∑èË©¶Ë°åÂõûÊï∞: ${De}Âõû
- Ê≠£Á≠î: ${we}Âõû
- Ë™§Á≠î: ${et}Âõû
- ÂÖ®‰ΩìÊ≠£Á≠îÁéá: ${je}%

**ÈÄ≤ÊçóÁéá**: ${(s/r*100).toFixed(1)}% (${s} / ${r}Âïè)

**progressCacheÂÅ•ÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ**:
- tabPosition Êú™Ë®≠ÂÆö: ${_} / ${V}
- category Êú™Ë®≠ÂÆö: ${Z} / ${V}
- lastStudied Êú™Ë®≠ÂÆö: ${te} / ${V}
- ‰∏ªË¶Å„Ç´„Ç¶„É≥„ÉàÊ¨†ÊêçÔºàcorrect/incorrect/streakÔºâ: ${he} / ${V}

---

## üõ†Ô∏è Ëµ∑ÂãïÊôÇ‰øÆÂæ©„É≠„Ç∞Ôºà„Çµ„Éû„É™„ÉºÔºâ

${(()=>{const q=localStorage.getItem("debug_progress_repair_summary");if(!q)return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†loadProgress()„ÅåËµ∞„Å£„Å¶„ÅÑ„Å™„ÅÑ/‰øùÂ≠ò„Åß„Åç„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const re=JSON.parse(q),ne=re.timestamp?String(re.timestamp):"-",B=Number(re.categoryAdded??0),z=Number(re.memorizationPositionRepaired??0),le=!!re.saved;return`**timestamp**: ${ne}
**categoryAdded**: ${B}
**memorizationPositionRepaired**: ${z}
**saved**: ${le?"trueÔºà‰øÆÂæ©„Çí‰øùÂ≠òÔºâ":"falseÔºà‰øÆÂæ©„Å™„Åó or ‰øùÂ≠ò‰∏çË¶ÅÔºâ"}`}catch{return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"}})()}

---

## üéØ „Ç§„É≥„Çø„Éº„É™„Éº„ÉñË®∫Êñ≠

### PositionÂàÜÂ∏ÉÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ${y.length}Ë™ûÔºâ
${y.length===0?"_Ôºà„Å™„ÅóÔºâ_":`
- **Position 85-100**: ${y.filter(q=>q.position>=85).length}Ë™û
- **Position 70-84**: ${y.filter(q=>q.position>=70&&q.position<85).length}Ë™û
- **Position 40-69**: ${y.filter(q=>q.position>=40&&q.position<70).length}Ë™û

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÇíPosition +15
- ÁµêÊûú: Position 40-55„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰Ωç10Âïè‰∏≠„Å´Ê∑∑ÂÖ•„Åô„Çã„ÅØ„Åö
`}

### Ê¨°10Âïè„ÅÆPositionÂàÜÊûê
**ÂèÇÁÖß**: ${ze}

${Ge.map((q,re)=>{const{position:ne,attempts:B,status:z}=Nt(q);return`${re+1}. **${q}** - Position ${ne.toFixed(0)} (${B}Âõû) ${z}`}).join(`
`)}

**ÂïèÈ°åÊ§úÂá∫**:
${sn?"‚ùå **ÂÖ®„Å¶Êñ∞Ë¶èÔºàPosition < 40Ôºâ** ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß":"‚úÖ Êñ∞Ë¶è„Å®„Åæ„Å†„Åæ„Å†„ÅåÊ∑∑Âú® ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ‰∏≠"}

---

## üéÆ PositionÂàÜÊï£Ë®∫Êñ≠

${w?`**ÂàÜÊï£Ââç**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((ge=w.before)==null?void 0:ge.stillLearning)||0)+(((Pe=w.before)==null?void 0:Pe.incorrect)||0)}Ë™û
- Êñ∞Ë¶è: ${((tt=w.before)==null?void 0:tt.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((vt=w.before)==null?void 0:vt.boostable)||0}Ë™û

**ÂàÜÊï£Âæå**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((Yt=w.after)==null?void 0:Yt.stillLearning)||0)+(((gn=w.after)==null?void 0:gn.incorrect)||0)}Ë™û
- Êñ∞Ë¶è (PositionÂºï„Åç‰∏ä„ÅíÂæå): ${((jt=w.after)==null?void 0:jt.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((hn=w.after)==null?void 0:hn.boostable)||0}Ë™û

**PositionÂºï„Åç‰∏ä„Åí**: ${((un=w.summary)==null?void 0:un.newBoosted)||0}Ë™û ${((Et=w.summary)==null?void 0:Et.working)??!1?"‚úÖ":"‚ùå"}

<details>
<summary>Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${w.changed.slice(0,10).map(q=>"- **"+q.word+"**: "+q.before.toFixed(0)+" ‚Üí "+q.after.toFixed(0)+" (+"+(q.after-q.before).toFixed(0)+")").join(`
`)}

${w.changed.length>10?`
_‚Ä¶‰ªñ`+(w.changed.length-10)+"Ë™û_":""}
</details>`:"‚ö†Ô∏è PositionÂàÜÊï£Ë®∫Êñ≠ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàcalculatePriorities()„ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

### üéØ „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà

${(()=>{try{const q=localStorage.getItem("debug_still_learning_boost");if(!q)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const re=JSON.parse(q);return!re.working||re.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û (Position 40-70, attempts>0) „ÇíÂºï„Åç‰∏ä„Åí**: ${re.boosted}Ë™û ‚úÖ

<details>
<summary>„Éñ„Éº„Çπ„Éà„Åï„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${re.changes.slice(0,10).map(ne=>{const B=Number(ne.after)-Number(ne.before);return"- **"+ne.word+"**: "+ne.before.toFixed(0)+" ‚Üí "+ne.after.toFixed(0)+" (+"+(Number.isFinite(B)?B.toFixed(0):"0")+")"}).join(`
`)}

${re.boosted>10?`
_‚Ä¶‰ªñ`+(re.boosted-10)+"Ë™û_":""}
</details>`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

### üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ

${(()=>{const q=ra(t).slice(0,30);if(q.length===0)return"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const re=q.map(ee=>ee.attempts>0&&ee.position>=40&&ee.position<70?"„Åæ„Å†„Åæ„Å†":ee.attempts===0&&ee.position>=40&&ee.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":ee.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":ee.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),ne={„Åæ„Å†„Åæ„Å†:re.filter(ee=>ee==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:re.filter(ee=>ee==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:re.filter(ee=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(ee)).length},B=re.slice(0,20).map(ee=>{switch(ee){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join(""),z=q.slice(0,15).map((ee,be)=>{const He=re[be],Qe=He==="„Åæ„Å†„Åæ„Å†"?"üü°":He==="Êñ∞Ë¶è(Âºï‰∏ä)"?"üîµ":He==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"üî¥":He==="ÂÆöÁùÄÊ∏à"?"‚úÖ":"‚ö™";return`${be+1}. ${Qe} **${ee.word}** (Pos ${ee.position.toFixed(0)}, ${ee.attempts}Âõû) - ${He}`}).join(`
`);let le=`**TOP30„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÂ∏É**:
- üü° „Åæ„Å†„Åæ„Å†: ${ne.„Åæ„Å†„Åæ„Å†}Ë™û
- üîµ Êñ∞Ë¶è(PositionÂºï‰∏ä): ${ne.Êñ∞Ë¶èÂºï‰∏ä}Ë™û
- „Åù„ÅÆ‰ªñ: ${ne.„Åù„ÅÆ‰ªñ}Ë™û

**„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ** (TOP20):
${B}

**Âá°‰æã**: üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à

<details>
<summary>Ë©≥Á¥∞„É™„Çπ„Éà (TOP15)</summary>

${z}
</details>

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆ„Çµ„Ç§„ÇØ„É´„Åß‰∫§‰∫íÈÖçÁΩÆ
- ‰æã: üü°üü°üîµüü°üü°üü°üîµüü°üü°üîµ...`;if(ne.„Åæ„Å†„Åæ„Å†===0&&ne.Êñ∞Ë¶èÂºï‰∏ä===0)le+=`

‚ö†Ô∏è **„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„Åó**Ôºà„Åæ„Å†„Åæ„Å†Ë™û„ÉªPositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å®„ÇÇ„Å´0Ôºâ`;else if(ne.„Åæ„Å†„Åæ„Å†>0&&ne.Êñ∞Ë¶èÂºï‰∏ä===0)le+=`

‚ö†Ô∏è **PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å™„Åó** ‚Üí „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else if(ne.„Åæ„Å†„Åæ„Å†===0&&ne.Êñ∞Ë¶èÂºï‰∏ä>0)le+=`

‚ö†Ô∏è **„Åæ„Å†„Åæ„Å†Ë™û„Å™„Åó** ‚Üí PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else{let ee=0;for(let be=0;be<re.length-1;be++){const He=re[be],Qe=re[be+1];He==="„Åæ„Å†„Åæ„Å†"&&Qe==="Êñ∞Ë¶è(Âºï‰∏ä)"&&ee++,He==="Êñ∞Ë¶è(Âºï‰∏ä)"&&Qe==="„Åæ„Å†„Åæ„Å†"&&ee++}ee>=3?le+=`

‚úÖ **‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+ee+"ÂõûÔºâ":le+=`

‚ö†Ô∏è **‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑÂèØËÉΩÊÄß**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+ee+"ÂõûÔºâ"}return le}catch(re){return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº: "+re.message}})()}

---

## ÔøΩÔ∏è PositionÈöéÂ±§Ê§úË®ºÔºà„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÈò≤Ê≠¢Ôºâ

${(()=>{try{const q=localStorage.getItem("debug_position_hierarchy_validation"),re=localStorage.getItem("debug_position_hierarchy_still"),ne=localStorage.getItem("debug_position_hierarchy_new");if(!q&&!re&&!ne)return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";let B=`**PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂**:
`;B+="```\n",B+=`70-100: ÂàÜ„Åã„Çâ„Å™„ÅÑÔºàÁ¨¨1ÂÑ™ÂÖàÔºâ
`,B+=`60-69:  „Åæ„Å†„Åæ„Å†ÔºàÁ¨¨2ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ‚Üê üîí Âõ∫ÂÆö
`,B+=`40-59:  Êñ∞Ë¶èÔºàÁ¨¨3ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ    ‚Üê üîí Âõ∫ÂÆö
`,B+=`20-39:  Êñ∞Ë¶èÔºàÁ¨¨4ÂÑ™ÂÖà„ÉªÈÄöÂ∏∏Ôºâ
`,B+=`0-19:   ÂÆöÁùÄÊ∏àÔºàÁ¨¨5ÂÑ™ÂÖàÔºâ
`,B+="```\n\n";let z=!1;const le=[];if(q){const ee=JSON.parse(q);ee.isValid?(B+=`‚úÖ **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§„ÅåÊ≠£Â∏∏„Åß„Åô
`,B+="  - „Åæ„Å†„Åæ„Å†Ë™ûÔºà60-69ÁØÑÂõ≤ÂÜÖÔºâ: "+ee.stillInBoostedZone+`Ë™û
`,B+="  - Êñ∞Ë¶èË™ûÔºà40-59ÁØÑÂõ≤ÂÜÖÔºâ: "+ee.newInBoostedZone+`Ë™û

`):(z=!0,B+=`‚ùå **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§ÈÅïÂèç„ÇíÊ§úÂá∫
`,B+="  - ÈÅïÂèç‰ª∂Êï∞: "+ee.violationCount+`Ë™û
`,le.push(...ee.violations))}if(re){const ee=JSON.parse(re);ee.violationCount===0?B+="‚úÖ **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: ÂÖ®"+ee.totalStill+`Ë™û„ÅåPosition 60-69ÁØÑÂõ≤ÂÜÖ

`:(z=!0,B+=`‚ùå **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: Position 60-69ÁØÑÂõ≤Â§ñ„ÅÆË™û„ÇíÊ§úÂá∫
`,B+="  - ÈÅïÂèç‰ª∂Êï∞: "+ee.violationCount+"Ë™ûÔºàÂÖ®"+ee.totalStill+`Ë™û‰∏≠Ôºâ
`,le.push(...ee.violations))}if(ne){const ee=JSON.parse(ne);ee.violationCount===0?B+="‚úÖ **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: ÂÖ®"+ee.totalNew+`Ë™û„ÅåPosition 60Êú™Ê∫Ä

`:(z=!0,B+=`‚ùå **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: Position 60‰ª•‰∏ä„ÅÆË™û„ÇíÊ§úÂá∫
`,B+="  - ÈÅïÂèç‰ª∂Êï∞: "+ee.violationCount+"Ë™ûÔºàÂÖ®"+ee.totalNew+`Ë™û‰∏≠Ôºâ
`,le.push(...ee.violations))}return z&&le.length>0?(B+=`
**üö® ÈÅïÂèç„ÅÆË©≥Á¥∞**:
`,le.slice(0,10).forEach((ee,be)=>{const He=ee.type==="new_exceeds_60"?"Êñ∞Ë¶èË™û„ÅåPosition 60‰ª•‰∏ä":ee.type==="still_below_60"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 60Êú™Ê∫Ä":ee.type==="still_above_70"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 70‰ª•‰∏ä":"‰∏çÊòé";B+=be+1+". **"+ee.word+"**: Position "+ee.position.toFixed(0)+" ‚Üê "+He+`
`}),le.length>10&&(B+=`
_‚Ä¶‰ªñ`+(le.length-10)+`‰ª∂_
`),B+=`
**üìñ ÂéüÂõ†„Å®ÂØæÁ≠ñ**:
`,B+=`- „Åì„Çå„ÅØ„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÂïèÈ°å„Åß„Åô
`,B+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÇíÂÑ™ÂÖà„Åï„Åõ„Çã„Åü„ÇÅ„Å´Êñ∞Ë¶èË™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,B+=`- Êñ∞Ë¶èË™û„ÇíÊ∑∑„Åú„Çã„Åü„ÇÅ„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,B+=`- PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂Ôºà60-69: „Åæ„Å†„Åæ„Å†„ÄÅ40-59: Êñ∞Ë¶èÔºâ„ÇíÂÆà„Å£„Å¶„Åè„Å†„Åï„ÅÑ
`):z||(B+=`üéâ **PositionÈöéÂ±§„ÅØÂÆåÁíß„Å´ÂÆà„Çâ„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ**
`,B+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÅØÁ¢∫ÂÆü„Å´Êñ∞Ë¶èË™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Åæ„Åô
`,B+=`- Êñ∞Ë¶èË™û„ÅØ„Åæ„Å†„Åæ„Å†Ë™û„ÇíÈÇ™È≠î„Åó„Åæ„Åõ„Çì
`),B}catch(q){return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„ÅÆËß£Êûê„Ç®„É©„Éº: "+q.message}})()}

---

## ÔøΩüìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞30‰ª∂)

${k.length>0?k.slice(-10).reverse().map((q,re)=>re+1+". **"+q.function+"** "+JSON.stringify(q.params)+" - "+new Date(q.timestamp).toLocaleTimeString()).join(`
`):"‚ö†Ô∏è Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}

---

## üîç sortAndBalance() Âá∫ÂäõÊ§úË®º

**sortAndBalance()Âæå„ÅÆTOP30ÔºàPositionÈôçÈ†Ü„ÇΩ„Éº„ÉàÂæåÔºâ**:
${(()=>{const q=localStorage.getItem("debug_sortAndBalance_output");if(!q)return"‚ö†Ô∏è sortAndBalance()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{return JSON.parse(q).slice(0,30).map((ne,B)=>{const z=ne.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":ne.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ne.position>=40?"üü° „Åæ„Å†„Åæ„Å†":ne.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return B+1+". **"+ne.word+"** - Position "+(ne.position??0).toFixed(0)+" ("+ne.attempts+"Âõû) "+z}).join(`
`)}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

**postProcess()Âæå„ÅÆTOP30ÔºàÂÆüÈöõ„ÅÆÂá∫È°å„Ç≠„É•„ÉºÔºâ**:
${(()=>{const q=nJ(t),re=ra(t);return!re||re.length===0?"‚ö†Ô∏è postProcess()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì":(q?`
(„É°„Çø) action=${q.action}, interleavedAcrossBands=${!!q.isInterleavedAcrossBands}
`:"")+re.slice(0,30).map((B,z)=>{const le=B.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":B.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":B.position>=40?"üü° „Åæ„Å†„Åæ„Å†":B.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return z+1+". **"+B.word+"** - Position "+(B.position??0).toFixed(0)+" ("+B.attempts+"Âõû) "+le}).join(`
`)})()}

**üö® ÈáçË¶Å**: sortAndBalance()„Å®postProcess()„ÅÆÂá∫Âäõ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÄÅpostProcess()„ÅåÈ†ÜÂ∫è„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ

**üîç „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞ÂàÜÊûê**:
${(()=>{const q=t,re=r,ne=Ne=>{if(!Ne)return null;try{return JSON.parse(Ne)}catch{return null}},B=(Ne,Xe=!1)=>{const dt=Ne.filter(Boolean);if(dt.length===0)return null;const rt=Be=>{const ae=typeof Be=="number"?Be:Number(Be);return Number.isFinite(ae)?ae:null},at=Be=>{const ae=Date.parse(String(Be??""));return Number.isFinite(ae)?ae:0};if(Xe){const Be=dt.filter(U=>String((U==null?void 0:U.mode)??"")===q);if(Be.length===0)return null;const ae=Be.filter(U=>rt(U==null?void 0:U.questionsCount)===re);return ae.length>0?(ae.sort((U,ue)=>at(ue==null?void 0:ue.timestamp)-at(U==null?void 0:U.timestamp)),ae[0]):[...Be].sort((U,ue)=>{const Me=rt(U==null?void 0:U.questionsCount)??-1,qe=rt(ue==null?void 0:ue.questionsCount)??-1;return qe!==Me?qe-Me:at(ue==null?void 0:ue.timestamp)-at(U==null?void 0:U.timestamp)})[0]}const Bt=dt.filter(Be=>rt(Be==null?void 0:Be.questionsCount)===re);return Bt.length>0?(Bt.sort((Be,ae)=>at(ae==null?void 0:ae.timestamp)-at(Be==null?void 0:Be.timestamp)),Bt[0]):[...dt].sort((Be,ae)=>{const Ce=rt(Be==null?void 0:Be.questionsCount)??-1,U=rt(ae==null?void 0:ae.questionsCount)??-1;return U!==Ce?U-Ce:at(ae==null?void 0:ae.timestamp)-at(Be==null?void 0:Be.timestamp)})[0]},z=`debug_sortAndBalance_top100_history_${q}`,le=ne(localStorage.getItem(z)),ee=Array.isArray(le)?le:[],be=B(ee,!0),He=`debug_sortAndBalance_top100_${q}`,Qe=ne(localStorage.getItem(He)),ke=Qe&&String((Qe==null?void 0:Qe.mode)??"")===q?Qe:null,xe=ne(localStorage.getItem("debug_sortAndBalance_top100")),K=xe&&String((xe==null?void 0:xe.mode)??"")===q?xe:null,pe=be??ke??K??xe;if(!pe)return"‚ö†Ô∏è TOP100„Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{const Ne=be?`history:${z}`:ke?`byMode:${He}`:"legacy:debug_sortAndBalance_top100",Xe=Array.isArray(pe==null?void 0:pe.top100)?pe.top100:[],dt=Array.isArray(pe==null?void 0:pe.top600)?pe.top600:[],rt=typeof(pe==null?void 0:pe.timestamp)=="string"?pe.timestamp:null,at=typeof(pe==null?void 0:pe.mode)=="string"?pe.mode:null,Bt=Number.isFinite(Number(pe==null?void 0:pe.questionsCount))?Number(pe.questionsCount):null,Vt=Number.isFinite(Number(pe==null?void 0:pe.interleavedCount))?Number(pe.interleavedCount):null,Be=Number.isFinite(Number(pe==null?void 0:pe.stillLearningInTop100))?Number(pe.stillLearningInTop100):null,ae=Number.isFinite(Number(pe==null?void 0:pe.stillLearningInTop600))?Number(pe.stillLearningInTop600):null,U=nt().wordProgress||{},ue=Le=>String(Le??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),Me=Le=>ue(Le).toLowerCase(),qe=new Map;for(const Le of Object.keys(U)){const yt=Me(Le);qe.has(yt)||qe.set(yt,Le)}const Oe=Le=>{const yt=ue(Le);if(!yt)return{key:null,wp:null,hit:"empty"};const Wt=U[yt];if(Wt)return{key:yt,wp:Wt,hit:"direct"};const yn=yt.toLowerCase(),fo=U[yn];if(fo)return{key:yn,wp:fo,hit:"lower"};const Ps=Me(yt),Lr=qe.get(Ps)??null;return Lr?{key:Lr,wp:U[Lr]??null,hit:"normalized"}:{key:null,wp:null,hit:"miss"}},_e=Le=>Oe(Le).wp,Se=(Le,yt=0)=>{const Wt=typeof Le=="number"?Le:Number(Le);return Number.isFinite(Wt)?Wt:yt},ft=(Le,yt)=>{const Wt=_e(Le);if(Wt){const yn=Se(Wt==null?void 0:Wt.memorizationAttempts,NaN);if(Number.isFinite(yn))return yn}return Se(yt,0)},It=(Le,yt)=>{const Wt=_e(Le);if(Wt){const yn=Se(Jt(Wt,t),NaN);if(Number.isFinite(yn))return yn}return Se(yt,0)},rn=Xe.filter(Le=>{const yt=String(Le.word??""),Wt=It(yt,Le.position),yn=ft(yt,Le.attempts);return Wt>=40&&Wt<70&&yn>0}),nn=dt.filter(Le=>{const yt=String(Le.word??""),Wt=It(yt,Le.position),yn=ft(yt,Le.attempts);return Wt>=40&&Wt<70&&yn>0}),St=dt.filter(Le=>{const yt=String(Le.word??""),Wt=It(yt,Le.position),yn=ft(yt,Le.attempts);return Wt===50&&yn===0}).length;let Ke="";rt&&(Ke+=`üïí **snapshot timestamp**: ${rt}

`),Ke+=`üß≠ **snapshot selectedFrom**: ${Ne}

`,Ke+=`**üì¶ snapshot meta**
`,Ke+=`- mode: ${at??"-"}
`,Ke+=`- questionsCount: ${Bt??"-"}
`,Ke+=`- interleavedCount: ${Vt??"-"}
`,Ke+=`- top100Count: ${Xe.length}
`,Ke+=`- top600Count: ${dt.length}
`,Ke+=`- stillLearningInTop100 (snapshot): ${Be??"-"}
`,Ke+=`- stillLearningInTop600 (snapshot): ${ae??"-"}

`,at&&at!==q&&(Ke+=`‚ö†Ô∏è **„É¢„Éº„Éâ‰∏ç‰∏ÄËá¥**: „Åì„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅØ \`${at}\` „Åß„Åô„ÄÇÊöóË®ò„Çø„Éñ„ÅÆÂàÜÊûê„Å´„ÅØ \`${q}\` „ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
‚Üí translation/spellingÁ≠â„ÅÆ„Äå30Âïè„ÉÜ„Çπ„ÉàÂÆüË°å„Äç„Åå‰∏äÊõ∏„Åç„Åó„Å¶„ÇÇÂ£ä„Çå„Å™„ÅÑ„Çà„ÅÜ„ÄÅmodeÂà•„Ç≠„Éº„ÇíË™≠„ÅøÂèñ„Çã„Çà„ÅÜ„Å´‰øÆÊ≠£Ê∏à„Åø„Åß„Åô„ÄÇ

`);const Ct={direct:0,lower:0,normalized:0,miss:0,empty:0};for(const Le of Xe){const yt=String((Le==null?void 0:Le.word)??""),Wt=Oe(yt);Ct[Wt.hit]=(Ct[Wt.hit]||0)+1}Ke+=`**üîë progressCacheÁÖßÂêàÔºàTOP100Ôºâ**
`,Ke+=`- direct: ${Ct.direct}
`,Ke+=`- lower: ${Ct.lower}
`,Ke+=`- normalized: ${Ct.normalized}
`,Ke+=`- miss: ${Ct.miss}

`;const Ut=Bf(t),xn=new Set(Ut.map(Le=>Me(Le.word))),es=new Set(Xe.map(Le=>Me(String((Le==null?void 0:Le.word)??"")))),mt=[];for(const Le of xn)es.has(Le)&&mt.push(Le);if(Ke+=`**üü° Ëã¶ÊâãË™û√óTOP100ÔºàÊöóË®òSSOTÔºâ**
`,Ke+=`- strugglingWords: ${Ut.length}
`,Ke+=`- inTop100: ${mt.length}

`,Xe.length===0&&(Ke+=`‚ö†Ô∏è TOP100ÈÖçÂàó„ÅåÁ©∫„Åß„ÅôÔºàÂè§„ÅÑ/Â£ä„Çå„Åü„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆÂèØËÉΩÊÄßÔºâ

`),St>0?Ke+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: ${St}Ë™ûÔºà„Åì„Çå„Åå„Åæ„Å†„Åæ„Å†Ë™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄßÔºâ

`:Ke+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: 0Ë™ûÔºàË©≤ÂΩì„Å™„ÅóÔºâ

`,rn.length===0){if(Ke+=`‚ùå **„Åæ„Å†„Åæ„Å†Ë™ûÔºàPosition 40-70, attempts>0Ôºâ„ÅåTOP100„Å´1„Å§„ÇÇÂÖ•„Å£„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ**
`,Xe.length>0){const Le=Xe.slice(0,10).map(yt=>{const Wt=String(yt.word??""),yn=Oe(Wt),fo=!!yn.wp,Ps=ft(Wt,yt.attempts),Lr=It(Wt,yt.position),Ms=Se(yt.attempts,0),tu=Se(yt.position,0);return{word:Wt,matchedKey:yn.key,hitType:yn.hit,cacheHit:fo,usedPos:Lr,usedAttempts:Ps,snapshotPos:tu,snapshotAttempts:Ms}});Ke+=`
**üß™ Âà§ÂÆö„Éá„Éê„ÉÉ„Ç∞ÔºàTOP10„Çµ„É≥„Éó„É´Ôºâ**
`+Le.map((yt,Wt)=>{const yn=yt.cacheHit?yt.hitType:"miss",fo=yt.matchedKey?` key:${yt.matchedKey}`:"";return`${Wt+1}. ${yt.word} | cache:${yn}${fo} | pos used:${yt.usedPos} (snap:${yt.snapshotPos}) | attempts used:${yt.usedAttempts} (snap:${yt.snapshotAttempts})`}).join(`
`)+`
`}}else Ke+="‚úÖ „Åæ„Å†„Åæ„Å†Ë™û„Åå**"+rn.length+`Ë™û**„ÄÅTOP100ÂÜÖ„Å´„ÅÇ„Çä„Åæ„Åô:
`+rn.slice(0,10).map(Le=>{const yt=String(Le.word??""),Wt=ft(yt,Le.attempts),yn=It(yt,Le.position);return`${Le.rank??""}‰Ωç: ${yt} (Position ${yn}, ${Wt}Âõû)`}).join(`
`)+(rn.length>10?`
_‚Ä¶‰ªñ`+(rn.length-10)+"Ë™û_":"")+`

`;return dt.length===0?Ke+="‚ö†Ô∏è TOP600ÈÖçÂàó„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàÊúÄÊñ∞„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É©Âá∫ÂäõÂæÖ„Å°Ôºâ":nn.length>0?(Ke+="üìç **TOP600ÂÜÖ„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û**: "+nn.length+`Ë™û
`,Ke+=nn.slice(0,5).map(Le=>{const yt=String(Le.word??""),Wt=ft(yt,Le.attempts),yn=It(yt,Le.position);return`${Le.rank??""}‰Ωç: ${yt} (Position ${yn}, ${Wt}Âõû)`}).join(`
`),nn.length>5&&(Ke+=`
_‚Ä¶‰ªñ`+(nn.length-5)+"Ë™û_")):Ke+="‚ùå **TOP600ÂÜÖ„Å´„ÇÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì**",St>0&&rn.length===0&&(Ke+=`

**üö® ÁµêË´ñ**: Position 50„ÅÆÊñ∞Ë¶è`+St+`Ë™û„ÅåÂÖàË°å„Åó„ÄÅ„Åæ„Å†„Åæ„Å†Ë™û„ÅåÊäº„ÅóÂá∫„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô
`,Ke+="‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅßÊñ∞Ë¶è„ÅåÂÑ™ÂÖà„Åï„Çå„ÄÅ„Åæ„Å†„Åæ„Å†„Åå"+(St+1)+"‰Ωç‰ª•Èôç„Å´ËøΩ„ÅÑ„ÇÑ„Çâ„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß"),Ke}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

---

### üéØ ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÂÜÖPositionÂàÜÂ∏ÉÔºà„É™„Ç¢„É´„Çø„Ç§„É†Ôºâ

${(()=>{if(!o||o.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const q=o.slice(s);if(q.length===0)return"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ";const re=nt(),ne=ke=>{if(!ke)return 0;switch(t){case"memorization":return ke.memorizationAttempts??0;case"translation":return ke.translationAttempts??0;case"spelling":return ke.spellingAttempts??0;case"grammar":return ke.grammarAttempts??0;default:return ke.totalAttempts??0}},B=q.map(ke=>{const xe=String(ke.word??""),K=re.wordProgress[xe],pe=Number.isFinite(ke.position)?ke.position:null;if(K){const Ne=Jt(K,t);return{...ke,position:Ne,_originalPosition:pe,_wpMissing:!1,_attempts:ne(K)}}return{...ke,position:35,_originalPosition:pe,_wpMissing:!0,_attempts:0}}),z=B.filter(ke=>{if(!Number.isFinite(ke._originalPosition))return!1;const xe=ke._originalPosition,K=ke.position??0;return Math.abs(xe-K)>5}).slice(0,20);let le="**üìä Êú™Âá∫È°å„Ç≠„É•„ÉºÂàÜÊûêÔºàÊÆã„Çä"+q.length+`ÂïèÔºâ**:

`;z.length>0&&(le+="üö® **Position‰∏çÊï¥ÂêàÊ§úÂá∫**: "+z.length+`Ë™û
`,le+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåLocalStorage„Å®‰∏ÄËá¥„Åó„Åæ„Åõ„ÇìÔºÅ

`,le+=`**‰∏çÊï¥Âêà„É™„Çπ„ÉàÔºàÂ∑ÆÂàÜ‚â•5Ôºâ**:
`,le+=z.map(ke=>{const xe=ke._originalPosition??0,K=ke.position??0,pe=K-xe,Ne=K>=70?"üî¥":K>=40?"üü°":"‚ö™",Xe=pe>0?"üî∫":pe<0?"üîª":"‚Üí";return"  "+Ne+" **"+ke.word+"**: "+xe+" "+Xe+" "+K+" (Â∑ÆÂàÜ: "+(pe>0?"+":"")+pe+")"}).join(`
`),le+=`

**ÂéüÂõ†ÂÄôË£ú**:
`,le+=`- questionsÈÖçÂàó„ÅåÂè§„ÅÑ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åã„Çâ‰ΩúÊàê„Åï„Çå„Åü
`,le+=`- Ëß£Á≠îÂæå„Å´Position„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„Åå„ÄÅ„Ç≠„É•„Éº„Å´ÂèçÊò†„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ
`,le+=`- QuestionScheduler„ÅÆÂëº„Å≥Âá∫„Åó„Çø„Ç§„Éü„É≥„Ç∞„Åå‰∏çÈÅ©Âàá

`);const ee={incorrect:B.filter(ke=>(ke.position??0)>=70),stillLearning:B.filter(ke=>{const xe=ke.position??0,K=ke._attempts??0;return xe>=40&&xe<70&&K>0}),newBoosted:B.filter(ke=>{const xe=ke.position??0,K=ke._attempts??0;return xe>=40&&xe<60&&K===0}),newNormal:B.filter(ke=>{const xe=ke.position??0;return xe>=20&&xe<40}),mastered:B.filter(ke=>(ke.position??0)<20)};le+=`**PositionÂà•ÂÜÖË®≥**:
`,le+="- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑÔºà70-100Ôºâ: "+ee.incorrect.length+`Ë™û
`,le+="- üü° „Åæ„Å†„Åæ„Å†Ôºà40-69, attempts>0Ôºâ: "+ee.stillLearning.length+`Ë™û
`,le+="- üîµ Êñ∞Ë¶èÂºï‰∏äÔºà40-59, attempts=0Ôºâ: "+ee.newBoosted.length+`Ë™û
`,le+="- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏Ôºà20-39Ôºâ: "+ee.newNormal.length+`Ë™û
`,le+="- ‚úÖ ÂÆöÁùÄÊ∏àÔºà0-19Ôºâ: "+ee.mastered.length+`Ë™û

`;const be=B.slice(0,30),He=be.filter(ke=>(ke.position??0)>=40);le+=`**Ê¨°„ÅÆ30Âïè„ÅÆÊßãÊàê**:
`,le+="- È´òPositionË™ûÔºà‚â•40Ôºâ: "+He.length+"Ë™û / "+be.length+`Âïè
`,le+="- Ââ≤Âêà: "+(He.length/be.length*100).toFixed(1)+`%

`,He.length>0?(le+=`**Ê¨°„ÅÆ30ÂïèÂÜÖ„ÅÆÈ´òPositionË™û**ÔºàLocalStorageÂÜçË®àÁÆóÊ∏à„ÅøÔºâ:
`,le+=He.slice(0,10).map((ke,xe)=>{const K=ke.position??0,pe=ke._originalPosition,Ne=K>=70?"üî¥":"üü°",Xe=K>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":"„Åæ„Å†„Åæ„Å†",dt=ke.reAddedCount>0?" üîÑ√ó"+ke.reAddedCount:"",rt=pe!==void 0&&pe!==K?" (ÂÖÉ:"+pe+")":"";return"  "+Ne+" "+ke.word+" (Pos "+K+rt+", "+Xe+")"+dt}).join(`
`),He.length>10&&(le+=`
  _...‰ªñ`+(He.length-10)+"Ë™û_")):le+="‚ö†Ô∏è Ê¨°„ÅÆ30Âïè„Å´È´òPositionË™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàLocalStorageÂÜçË®àÁÆóÂæåÔºâ„ÄÇ";const Qe=ee.incorrect.length+ee.stillLearning.length;return Qe>10&&He.length<5?(le+=`

‚ùå **Ë≠¶Âëä**: È´òPositionË™û„Åå`+Qe+"Ë™ûÂ≠òÂú®„Åó„Åæ„Åô„Åå„ÄÅÊ¨°„ÅÆ30Âïè„Å´„ÅØ"+He.length+"Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ",le+=`
‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØ„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„Åå‰∏çÂçÅÂàÜ„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`):Qe>0&&He.length>=Math.min(Qe,15)&&(le+=`

‚úÖ **ËâØÂ•Ω**: È´òPositionË™û„ÅåÈÅ©Âàá„Å´ÂâçÊñπ„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`),le})()}

---

## üîÑ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Áä∂ÊÖãË®∫Êñ≠

${(()=>{var xe;nt();const q=JSON.parse(localStorage.getItem("debug_function_calls")||"[]"),re=JSON.parse(localStorage.getItem("debug_answer_logs")||"[]"),ne=JSON.parse(localStorage.getItem("debug_reschedule_events")||"[]"),B=K=>{const pe=(K==null?void 0:K.function)??(K==null?void 0:K.name)??(K==null?void 0:K.functionName)??"unknown",Ne=(K==null?void 0:K.params)??(K==null?void 0:K.args)??(K==null?void 0:K.parameters)??null,Xe=(K==null?void 0:K.timestamp)??null;return{name:pe,params:Ne,ts:Xe}},z=Array.isArray(q)?q.map(B):[],le=Array.isArray(ne)?ne:[],ee=z.filter(K=>K.name==="sortAndBalance").slice(-1)[0],be=le.filter(K=>(K==null?void 0:K.mode)===t&&(K==null?void 0:K.phase)==="triggered").slice(-1)[0],He=le.filter(K=>(K==null?void 0:K.mode)===t&&(K==null?void 0:K.phase)==="applied").slice(-1)[0],Qe=re.slice(-1)[0];let ke=`**üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÁîüÊàêÊÉÖÂ†±**:
`;if(ke+=`
**üîÑ ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºàdebug_reschedule_eventsÔºâ**:
`,He){const K=new Date(He.timestamp).toLocaleTimeString("ja-JP");if(ke+=`- ÊúÄÂæå„ÅÆÈÅ©Áî®: ${K} (${He.reason||"ÁêÜÁî±„Å™„Åó"})
`,He.details){const pe=He.details.remainingBefore,Ne=He.details.remainingAfter;(pe!=null||Ne!=null)&&(ke+=`- ÊÆã„Çä„Ç≠„É•„Éº: ${pe??"‰∏çÊòé"} ‚Üí ${Ne??"‰∏çÊòé"}
`)}}else ke+=`- „Åæ„Å†ÈÅ©Áî®„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
`;if(be){const K=new Date(be.timestamp).toLocaleTimeString("ja-JP");ke+=`- ÊúÄÂæå„ÅÆ„Éà„É™„Ç¨„Éº: ${K} (${be.reason||"ÁêÜÁî±„Å™„Åó"})
`}if(ke+=`
`,ee){const K=new Date(ee.ts).toLocaleTimeString("ja-JP");ke+="- ÊúÄÂæå„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞: "+K+`
`,ke+="- ÂïèÈ°åÊï∞: "+(((xe=ee.params)==null?void 0:xe.questionsCount)||"‰∏çÊòé")+`Âïè
`}else ke+=`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Â±•Ê≠¥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
`;if(Qe){const K=new Date(Qe.timestamp).toLocaleTimeString("ja-JP");ke+="- ÊúÄÂæå„ÅÆËß£Á≠î: "+K+" ("+Qe.word+`)
`,ke+="- PositionÂ§âÂåñ: "+Qe.positionBefore+" ‚Üí "+Qe.positionAfter+`
`}if(ke+=`
`,ee&&Qe){const K=new Date(ee.ts).getTime();if(new Date(Qe.timestamp).getTime()>K){const Ne=re.filter(dt=>new Date(dt.timestamp).getTime()>K).length;ke+="üö® **Ë≠¶Âëä**: „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´"+Ne+`ÂõûËß£Á≠î„Åï„Çå„Åæ„Åó„Åü
`,ke+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåÂè§„Åè„Å™„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„ÅåÈ´ò„ÅÑ„Åß„ÅôÔºÅ

`;const Xe=re.filter(dt=>new Date(dt.timestamp).getTime()>K&&Math.abs(dt.positionAfter-dt.positionBefore)>=10).slice(-10);Xe.length>0&&(ke+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÂ§ßÂπÖÂ§âÂåñÔºà¬±10‰ª•‰∏äÔºâ**:
`,ke+=Xe.map(dt=>{const rt=dt.positionAfter-dt.positionBefore;return"  "+(rt>0?"üî∫":"üîª")+" "+dt.word+": "+dt.positionBefore+" ‚Üí "+dt.positionAfter+" ("+(rt>0?"+":"")+rt+")"}).join(`
`),ke+=`

`),ke+=`**Êé®Â•®ÂØæÂøú**:
`,ke+=`- ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÇíÂÆüË°åÔºà„Éá„Éº„Çø„ÇΩ„Éº„ÇπÈÅ∏Êäû„Çí„ÇÑ„ÇäÁõ¥„ÅôÔºâ
`,ke+=`- „Åæ„Åü„ÅØ„ÄÅuseQuestionRequeu„ÅÆPosition-awareÊ©üËÉΩ„ÅåËá™ÂãïË™øÊï¥„Åó„Åæ„Åô
`}else ke+=`‚úÖ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÅØÊúÄÊñ∞„Åß„ÅôÔºàËß£Á≠îÂæå„Å´ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Ê∏à„ÅøÔºâ
`}return ke})()}

---

## üß† finalPriority„É¢„Éº„ÉâÔºàvariant CÔºâ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà

${(()=>{const q=localStorage.getItem(`debug_finalPriority_output_${t}`)||localStorage.getItem("debug_finalPriority_output"),re=localStorage.getItem(`debug_finalPriority_sessionStats_${t}`)||localStorage.getItem("debug_finalPriority_sessionStats");if(!q&&!re)return"‚ö†Ô∏è finalPriority„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàfinalPriorityMode„ÅåÊú™‰ΩøÁî® or „Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÔºâ";let ne="";if(re)try{const B=JSON.parse(re);ne+=`**currentTab**: ${B.currentTab}
`,ne+=`**allProgressCount**: ${B.allProgressCount}
`,ne+=`**totalQuestions**: ${B.totalQuestions}
`,ne+=`**timestamp**: ${B.timestamp}

`,ne+=`**aiSessionStats**: ${JSON.stringify(B.aiSessionStats)}

`}catch{ne+=`‚ö†Ô∏è sessionStatsËß£Êûê„Å´Â§±Êïó

`}if(!q)return ne+"‚ö†Ô∏è debug_finalPriority_output „Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const B=JSON.parse(q);if(!Array.isArray(B)||B.length===0)return ne+"‚ö†Ô∏è finalPriority TOP„ÅåÁ©∫„Åß„Åô";const z=`| # | ÂçòË™û | finalPriority | position | attempts | category |
|---|------|--------------|----------|----------|----------|
`+B.slice(0,30).map(le=>{const ee=Number(le.finalPriority??0),be=Number(le.position??0),He=Number(le.attempts??0),Qe=le.category??"";return`| ${le.rank??""} | **${le.word}** | ${ee.toFixed(3)} | ${be.toFixed(0)} | ${He} | ${Qe} |`}).join(`
`);return ne+z}catch{return ne+"‚ö†Ô∏è finalPriorityËß£Êûê„Å´Â§±Êïó"}})()}

---

## üìù Ëß£Á≠îÂá¶ÁêÜ„É≠„Ç∞ (ÊúÄÊñ∞10‰ª∂)
${S.length>0?S.map((q,re)=>{var dt;const B=Math.abs(q.positionAfter-q.positionBefore)>1?q.positionAfter>q.positionBefore?"üî∫":"üîª":"‚Üí",le=(dt=nt().wordProgress)==null?void 0:dt[q.word],ee=(()=>{if(!le)return{attempts:0,correct:0,stillLearning:0,incorrect:0};const rt=(()=>{switch(q.mode){case"memorization":return le.memorizationAttempts??0;case"translation":return le.translationAttempts??0;case"spelling":return le.spellingAttempts??0;case"grammar":return le.grammarAttempts??0;default:return le.totalAttempts??0}})(),at=(()=>{switch(q.mode){case"memorization":return le.memorizationCorrect??0;case"translation":return le.translationCorrect??0;case"spelling":return le.spellingCorrect??0;case"grammar":return le.grammarCorrect??0;default:return le.correctCount??0}})(),Bt=q.mode==="memorization"?le.memorizationStillLearning??0:0,Vt=rt-at-Bt;return{attempts:rt,correct:at,stillLearning:Bt,incorrect:Vt}})(),be=(()=>{var Be,ae,Ce;const rt=Number(((Be=q.progress)==null?void 0:Be.modeAttempts)??0),at=Number(((ae=q.progress)==null?void 0:ae.modeCorrect)??0),Bt=Number(((Ce=q.progress)==null?void 0:Ce.modeStillLearning)??0),Vt=rt-at-Bt;return{attempts:rt,correct:at,stillLearning:Bt,incorrect:Vt}})(),He=ee.correct!==be.correct||ee.stillLearning!==be.stillLearning||ee.incorrect!==be.incorrect,Qe=" | **ÂÆüÈöõ„ÅÆLS**: Ê≠£Ëß£"+ee.correct+"/„Åæ„Å†„Åæ„Å†"+ee.stillLearning+"/Ë™§Á≠î"+ee.incorrect+" (Ë®à"+ee.attempts+"Âõû)"+(He?" ‚ö†Ô∏è**‰∏ç‰∏ÄËá¥**":""),ke=q.savedPositionDebug,xe=ke==null?void 0:ke.savedPosition,K=ke==null?void 0:ke.decision,pe=ke==null?void 0:ke.reason,Ne=q.positionWithSavedPosition,Xe=xe!==void 0||Ne!==void 0?" | **savedPosition**: "+(xe??"-")+" | **calc(savedÊúâ„Çä)**: "+(Ne??"-")+" | **calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå)**: "+(q.positionAfter??"-")+(K?" | **savedÂà§ÂÆö**: "+K+(pe?" ("+pe+")":""):""):"";return re+1+". **"+q.word+"**: Position "+q.positionBefore.toFixed(0)+" "+B+" "+q.positionAfter.toFixed(0)+" ("+q.category+") [„É≠„Ç∞(mode): Ê≠£Ëß£"+be.correct+"/„Åæ„Å†„Åæ„Å†"+be.stillLearning+"/Ë™§Á≠î"+be.incorrect+"]"+Qe+Xe}).join(`
`):"‚ö†Ô∏è Ëß£Á≠î„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†Ëß£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

---

## üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (${y.length}Ë™û)

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„ÅÆË°®„ÅØ**LocalStorage„ÅÆÁîüPosition„Éá„Éº„Çø**„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
GamificationAI„Å´„Çà„Çã„Éñ„Éº„Çπ„ÉàÂæå„ÅÆPositionÔºà„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊôÇÔºâ„ÅØ„ÄÅÊ¨°„ÅÆ„Äå„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„Äç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

| # | ÂçòË™û | Position (LS) | Áä∂ÊÖã | Ë©¶Ë°åÂõûÊï∞ | ÊúÄÁµÇÂ≠¶Áøí | ÈÄ£Á∂öË™§Á≠î |
|---|------|---------------|------|----------|----------|----------|
${y.slice(0,30).map((q,re)=>{var be;const ne=q.lastStudied?new Date(q.lastStudied).toLocaleDateString():"-",B=q.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†",le=(be=nt().wordProgress)==null?void 0:be[q.word],ee=(le==null?void 0:le.consecutiveIncorrect)??0;return`| ${re+1} | **${q.word}** | ${q.position.toFixed(0)} | ${B} | ${q.attempts}Âõû | ${ne} | ${ee}Âõû |`}).join(`
`)}

_‚Ä¶‰ªñ${Math.max(0,y.length-30)}Ë™ûÁúÅÁï•_

### üìä „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÔºà„Éñ„Éº„Çπ„ÉàÂæåÔºâ

${(()=>{try{const q=localStorage.getItem("debug_still_learning_boost");if(!q)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const re=JSON.parse(q);return!re.working||re.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÁµêÊûú**: ${re.boosted}Ë™û„Åå Position 60-69 „Å´Âºï„Åç‰∏ä„Åí ‚úÖ

| # | ÂçòË™û | Before | After | Â¢óÂä†Èáè |
|---|------|--------|-------|--------|
${re.changes.slice(0,20).map((ne,B)=>`| ${B+1} | **${ne.word}** | ${ne.before.toFixed(0)} | ${ne.after.toFixed(0)} | +${(ne.after-ne.before).toFixed(0)} |`).join(`
`)}

${re.changes.length>20?"_‚Ä¶‰ªñ"+(re.changes.length-20)+"Ë™û_":""}

**üéØ ÈáçË¶Å**: „Åì„ÅÆË°®„ÅÆ„ÄåAfter„Äç„Ç´„É©„É†„Åå„ÄÅÂÆüÈöõ„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Åß‰Ωø„Çè„Çå„ÇãPositionÂÄ§„Åß„Åô„ÄÇ`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

---

## üìã postProcess()Âæå„ÅÆTOP30Ôºà„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: **debug_postProcess_output** „ÅØ **postProcess()Âæå„ÅÆTOP30„ÅÆ„Åø**„Çí‰øùÂ≠ò„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÁèæÂú®‰ΩçÁΩÆÔºàcurrentIndexÔºâ„Å´ËøΩÂæì„Åô„Çã„ÄåÊ¨°„ÅÆ30Âïè„Äç„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ

${(()=>{const q=ra(t);return!q||q.length===0?`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÁµêÊûú„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

**ÂÖÉ„ÅÆJSONÈ†ÜÂ∫èÔºàÂèÇËÄÉÊÉÖÂ†±„ÅÆ„ÅøÔºâ**:
`+o.slice(s+1,s+31).map((re,ne)=>{var He;const z=(He=nt().wordProgress)==null?void 0:He[re.word],le=z?Jt(z,t):35,ee=(()=>{if(!z)return 0;switch(t){case"memorization":return z.memorizationAttempts??0;case"translation":return z.translationAttempts??0;case"spelling":return z.spellingAttempts??0;case"grammar":return z.grammarAttempts??0;default:return z.totalAttempts??0}})(),be=ee===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":le>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":le>=40?"üü° „Åæ„Å†„Åæ„Å†":le>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(ne+1)+" | "+(s+ne+2)+"ÂïèÁõÆ | **"+re.word+"** | "+le.toFixed(0)+" | "+ee+"Âõû | "+(re.difficulty||"unknown")+" | "+be+" |"}).join(`
`):`| # | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Áä∂ÊÖã |
|---|------|----------|----------|------|
`+q.map((re,ne)=>{const B=re.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":re.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":re.position>=40?"üü° „Åæ„Å†„Åæ„Å†":re.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(ne+1)+" | **"+re.word+"** | "+(re.position??0).toFixed(0)+" | "+re.attempts+"Âõû | "+B+" |"}).join(`
`)})()}

---

## üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÔºöÊ¨°„ÅÆÂá∫È°å‰∫àÂÆö (30ÂïèÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„Çå„ÅØ„Äå„ÅÑ„Åæ‰øùÊåÅ„Åó„Å¶„ÅÑ„Çã„Ç≠„É•„ÉºÔºàquestionsÔºâ„Äç„ÅÆ„ÄåcurrentIndex+1..+30„Äç„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ
Position„ÅØ LocalStorage „Åã„ÇâÂÜçË®àÁÆó„Åó„ÅüÂÄ§„Åß„ÅôÔºàdetermineWordPosition()Ôºâ„ÄÇ

${(()=>{if(!o||o.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const q=nt(),re=o.slice(s+1,s+31);return re.length===0?"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ":`| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
`+re.map((ne,B)=>{var ke;const z=String((ne==null?void 0:ne.word)??""),le=(ke=q.wordProgress)==null?void 0:ke[z],ee=le?Jt(le,t):35,be=(()=>{if(!le)return 0;switch(t){case"memorization":return le.memorizationAttempts??0;case"translation":return le.translationAttempts??0;case"spelling":return le.spellingAttempts??0;case"grammar":return le.grammarAttempts??0;default:return le.totalAttempts??0}})(),He=(ne==null?void 0:ne.difficulty)??"‰∏çÊòé",Qe=be===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":ee>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ee>=40?"üü° „Åæ„Å†„Åæ„Å†":ee>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return`| ${B+1} | ${s+B+2}ÂïèÁõÆ | **${z}** | ${ee.toFixed(0)} | ${be}Âõû | ${He} | ${Qe} |`}).join(`
`)})()}

**üîç ÂàÜÊûê**:
- „Åæ„Å†„Åæ„Å†(Position 45)„Åå‰∏ä‰Ωç„Å´Êù•„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 50„ÅÆÂºï„Åç‰∏ä„ÅíÂçòË™û„ÅåÊ∑∑ÂÖ•„Åó„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 0„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰ΩçÁã¨Âç†„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÔºü ‚Üí ‚ùå ÂïèÈ°å„ÅÇ„Çä

---

## üìã ÊÆã„Çä„Ç≠„É•„ÉºÔºàLocalStorage PositionÈôçÈ†Ü TOP30Ôºâ

„Åì„ÅÆË°®Á§∫„ÅØ„ÄÅÊÆã„ÇäÂïèÈ°å„Çí LocalStorage „ÅÆÁîüPosition„Åß **ÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„ÅüTOP30** „Åß„ÅôÔºàÂèÇËÄÉÔºâ„ÄÇ

| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
${(()=>{const q=nt();return o.slice(s+1).map(ne=>{var Qe;const B=ne==null?void 0:ne.word,z=(Qe=q.wordProgress)==null?void 0:Qe[B],le=z?Jt(z,t):35,ee=(()=>{if(!z)return 0;switch(t){case"memorization":return z.memorizationAttempts??0;case"translation":return z.translationAttempts??0;case"spelling":return z.spellingAttempts??0;case"grammar":return z.grammarAttempts??0;default:return z.totalAttempts??0}})(),be=(ne==null?void 0:ne.difficulty)??"‰∏çÊòé",He=ee===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":le>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":le>=40?"üü° „Åæ„Å†„Åæ„Å†":le>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return{word:B,position:le,attempts:ee,difficulty:be,status:He,originalQuestion:ne}}).sort((ne,B)=>B.position-ne.position).slice(0,30).map((ne,B)=>`| ${B+1} | - | **${ne.word}** | ${ne.position.toFixed(0)} | ${ne.attempts}Âõû | ${ne.difficulty} | ${ne.status} |`).join(`
`)})()}

---

## ü§ñ AIË©ï‰æ°Â±•Ê≠¥ (ÊúÄÊñ∞${Math.max(p.length,20)}‰ª∂)

${Ht}

---

## üìä Áµ±Ë®à„Çµ„Éû„É™„Éº

- **Á∑èÂïèÈ°åÊï∞**: ${r}Âïè
- **ÁèæÂú®ÈÄ≤Êçó**: ${((s+1)/r*100).toFixed(1)}%
- **LocalStorage‰øùÂ≠ò‰∏≠Ôºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÔºâ**: ${y.length}Ë™û
  - ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${y.filter(q=>q.position>=70).length}Ë™û
  - „Åæ„Å†„Åæ„Å† (Position‚â•40): ${y.filter(q=>q.position>=40&&q.position<70).length}Ë™û
- **Ê¨°30Âïè‰∏≠„ÅÆÁä∂ÊÖãÂà•**Ôºà„Ç≠„É•„ÉºÈ†ÜÔºèPosition„ÅØLocalStorage„Åã„ÇâÂÜçË®àÁÆóÔºâ:
  - üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(()=>{const q=nt();return o.slice(s+1,s+31).filter(ne=>{var ee;const B=String((ne==null?void 0:ne.word)??""),z=(ee=q.wordProgress)==null?void 0:ee[B];return(z?Jt(z,t):35)>=70}).length})()}Âïè
  - üü° „Åæ„Å†„Åæ„Å†: ${(()=>{const q=nt();return o.slice(s+1,s+31).filter(ne=>{var ee;const B=String((ne==null?void 0:ne.word)??""),z=(ee=q.wordProgress)==null?void 0:ee[B],le=z?Jt(z,t):35;return le>=40&&le<70}).length})()}Âïè
  - ‚ö™ Êñ∞Ë¶è: ${(()=>{const q=nt();return o.slice(s+1,s+31).filter(ne=>{var be;const B=String((ne==null?void 0:ne.word)??""),z=(be=q.wordProgress)==null?void 0:be[B],le=(()=>{if(!z)return 0;switch(t){case"memorization":return z.memorizationAttempts??0;case"translation":return z.translationAttempts??0;case"spelling":return z.spellingAttempts??0;case"grammar":return z.grammarAttempts??0;default:return z.totalAttempts??0}})(),ee=z?Jt(z,t):35;return le===0||ee>=20&&ee<40}).length})()}Âïè
  - ‚úÖ ÂÆöÁùÄÊ∏à: ${(()=>{const q=nt();return o.slice(s+1,s+31).filter(ne=>{var be;const B=String((ne==null?void 0:ne.word)??""),z=(be=q.wordProgress)==null?void 0:be[B],le=(()=>{if(!z)return 0;switch(t){case"memorization":return z.memorizationAttempts??0;case"translation":return z.translationAttempts??0;case"spelling":return z.spellingAttempts??0;case"grammar":return z.grammarAttempts??0;default:return z.totalAttempts??0}})(),ee=z?Jt(z,t):35;return le>0&&ee<20}).length})()}Âïè

## üîç „Éá„Éê„ÉÉ„Ç∞„Éí„É≥„Éà

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
1. „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÇíPositionÂºï„Åç‰∏ä„Åí
2. Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „Åå Position +15 ‚Üí 40-55„Çæ„Éº„É≥„Å´Ê∑∑ÂÖ•
3. PositionÈôçÈ†Ü„ÇΩ„Éº„Éà ‚Üí „Åæ„Å†„Åæ„Å†5Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆÊØîÁéá„ÅßÂá∫È°å

**Á¢∫Ë™ç„Éù„Ç§„É≥„Éà**:
- [ ] calculatePriorities() „ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] applyInterleavingAdjustment() „ÅåÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] Êñ∞Ë¶è„ÅÆPosition„Åå +15 „Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºüÔºà„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞Á¢∫Ë™çÔºâ
- [ ] sortAndBalance() „ÅåPositionÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„Å¶„ÅÑ„Çã„ÅãÔºü

---

## üéØ ÂÆü„Éá„Éº„ÇøÊ§úË®ºÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÂê∏ÂºïÁ¢∫Ë™çÔºâ

${(()=>{const q=ra(t);if(!q||q.length===0)return"‚ö†Ô∏è postProcessÂá∫Âäõ„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´ÂÜçÂ∫¶Á¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";const re=Bf(t),ne=new Set(re.map(Qe=>it(Qe.word))),B=q.slice(0,30).map((Qe,ke)=>{const xe=String((Qe==null?void 0:Qe.word)??""),K=it(xe),pe=ne.has(K),Ne=Number((Qe==null?void 0:Qe.position)??0),Xe=Number((Qe==null?void 0:Qe.attempts)??0);return{rank:ke+1,word:xe,position:Ne,attempts:Xe,isStruggling:pe}}),z=B.filter(Qe=>Qe.isStruggling).length,le=B.slice(0,10).filter(Qe=>Qe.isStruggling).length,ee=Math.min(re.length,30),be=re.length>0?(z/re.length*100).toFixed(1):"0.0";let He=`**üìä ÂÆü„Éá„Éº„ÇøÂàÜÊûêÁµêÊûúÔºàpostProcessÂá∫ÂäõÔºâ**:
`;return He+="- ÂÖ®„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: "+re.length+`Ë™û
`,He+="- TOP30ÂÜÖ„Å´Â≠òÂú®: "+z+"Ë™û / "+ee+`Ë™ûÔºàÊúüÂæÖÂÄ§Ôºâ
`,He+="- TOP10ÂÜÖ„Å´Â≠òÂú®: "+le+`Ë™û
`,He+="- „Ç´„Éê„ÉºÁéá: "+be+`%

`,re.length===0?He+=`‚úÖ **„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì** ‚Üí Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ
`:z>=Math.min(re.length,20)?He+="‚úÖ **Âê∏ÂºïÊàêÂäü**: TOP30„Å´"+z+`Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ¢∫ÂÆü„Å´ÂÑ™ÂÖàÂá∫È°å„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`:z>=Math.ceil(re.length*.5)?He+="‚ö†Ô∏è **ÈÉ®ÂàÜÁöÑÂê∏Âºï**: TOP30„Å´"+z+"Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÊúüÂæÖÂÄ§Ôºà"+ee+`Ë™ûÔºâ„Çà„ÇäÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ
`:(He+="‚ùå **Âê∏ÂºïÂ§±Êïó**: TOP30„Å´"+z+`Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,He+=`‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØPositionÂÄ§„Åå‰∏çÊ≠£Á¢∫„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),He+=`
**TOP10„ÅÆÂÜÖË®≥**:
`,He+=B.slice(0,10).map(Qe=>{const ke=Qe.isStruggling?"üî¥":Qe.position>=40?"üîµ":Qe.position>=20?"‚ö™":"‚úÖ",xe=Qe.isStruggling?"„Åæ„Å†„Åæ„Å†/ÂàÜ„Åã„Çâ„Å™„ÅÑ":Qe.position>=40?"Êñ∞Ë¶è(Âºï‰∏ä)":Qe.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";return Qe.rank+". "+ke+" **"+Qe.word+"** (Pos "+Qe.position+", "+Qe.attempts+"Âõû) - "+xe}).join(`
`),He})()}

---

### üéØ Position-aware InsertionÔºà„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥ÔºâÊ§úË®º

${(()=>{const q=localStorage.getItem("debug_position_aware_insertions");if(!q)return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÂÜçÂá∫È°å„Åï„Çå„Çã„Å®Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ`;try{const re=JSON.parse(q);if(!Array.isArray(re)||re.length===0)return"‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåÁ©∫„Åß„Åô„ÄÇ";let ne=`**üìä ÊåøÂÖ•Ë™øÊï¥„ÅÆÂÆüË°åÂ±•Ê≠¥ÔºàÊúÄÊñ∞${re.length}‰ª∂Ôºâ**:

`;re.slice(-10).forEach((ee,be)=>{const He=new Date(ee.timestamp).toLocaleTimeString("ja-JP"),Qe=ee.adjustedInsert!==ee.originalInsert;if(ne+=`${Qe?"üéØ":"‚ö™"} **${ee.word}** (Position ${ee.position})
`,ne+=`  - ÊôÇÂàª: ${He}
`,ne+=`  - ÂÖÉ„ÅÆÊåøÂÖ•‰ΩçÁΩÆ: index ${ee.originalInsert} (ÁèæÂú®‰ΩçÁΩÆ+${ee.originalInsert-ee.currentIndex})
`,Qe){if(ne+=`  - üéØ Ë™øÊï¥Âæå: index ${ee.adjustedInsert} (ÁèæÂú®‰ΩçÁΩÆ+${ee.adjustedInsert-ee.currentIndex})
`,ne+=`  - ÁêÜÁî±: È´òPositionÂçòË™ûÁæ§„Å´Ââ≤„ÇäËæº„Åø
`,ee.nearbyHighPositions&&ee.nearbyHighPositions.length>0){const xe=ee.nearbyHighPositions.slice(0,3).map(K=>`${K.word}(${K.position})`).join(", ");ne+=`  - ËøëÈö£„ÅÆÈ´òPositionË™û: ${xe}${ee.nearbyHighPositions.length>3?"...":""}
`}}else ne+=`  - Ë™øÊï¥„Å™„ÅóÔºàËøë„Åè„Å´È´òPositionË™û„ÅåË¶ã„Å§„Åã„Çâ„Å™„Åã„Å£„ÅüÔºâ
`;ne+=`
`});const z=re.filter(ee=>ee.adjustedInsert!==ee.originalInsert).length,le=(z/re.length*100).toFixed(1);return ne+=`**üìà Áµ±Ë®à„Çµ„Éû„É™**:
`,ne+=`- Á∑èÊåøÂÖ•ÂõûÊï∞: ${re.length}Âõû
`,ne+=`- Position-awareË™øÊï¥: ${z}Âõû (${le}%)
`,ne+=`- ÈÄöÂ∏∏ÊåøÂÖ•: ${re.length-z}Âõû

`,z>0?(ne+=`‚úÖ **„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**
`,ne+=`‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÊó¢Â≠ò„ÅÆÈ´òPositionË™û„ÅÆËøë„Åè„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`):(ne+=`‚ö†Ô∏è **Ë™øÊï¥„Åå1Â∫¶„ÇÇÁô∫Áîü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì**
`,ne+=`‚Üí „Ç≠„É•„ÉºÂÜÖ„Å´È´òPositionË™û„ÅåÂ∞ë„Å™„ÅÑ„Åã„ÄÅÂÜçÂá∫È°å„Åå„Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),ne}catch(re){return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅÆËß£Êûê„Å´Â§±Êïó: ${re}`}})()}

---

### üîÑ ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„É≠„Ç∞ÔºàuseQuestionRequeueÔºâ

${(()=>{const q=localStorage.getItem("debug_requeue_events");if(!q)return"‚ö†Ô∏è debug_requeue_events „Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const re=JSON.parse(q);if(!Array.isArray(re)||re.length===0)return"‚ö†Ô∏è debug_requeue_events „ÅåÁ©∫„Åß„Åô";const ne=re.filter(be=>String((be==null?void 0:be.mode)??"")===t),B=(ne.length>0?ne:re).slice(-30),z=B.filter(be=>(be==null?void 0:be.decision)==="inserted").length,le=B.filter(be=>String((be==null?void 0:be.decision)??"").startsWith("skipped")).length;let ee=`**üìä „Çµ„Éû„É™**: inserted=${z}, skipped=${le}ÔºàË°®Á§∫: ${ne.length>0?t:"ÂÖ®„É¢„Éº„Éâ"} / ÊúÄÊñ∞${B.length}‰ª∂Ôºâ

`;return ee+=B.map((be,He)=>{const Qe=be!=null&&be.timestamp?new Date(be.timestamp).toLocaleTimeString("ja-JP"):"-",ke=String((be==null?void 0:be.word)??(be==null?void 0:be.qid)??"(unknown)"),xe=String((be==null?void 0:be.decision)??"unknown"),K=String((be==null?void 0:be.reason)??""),pe=Number.isFinite(Number(be==null?void 0:be.plannedOffset))?Number(be.plannedOffset):null,Ne=Number.isFinite(Number(be==null?void 0:be.insertAt))?Number(be.insertAt):null,Xe=Number.isFinite(Number(be==null?void 0:be.currentIndex))?Number(be.currentIndex):null,dt=(be==null?void 0:be.questionPosition)??null,rt=(be==null?void 0:be.ssotPosition)??null,at=(be==null?void 0:be.effectivePosition)??null,Bt=`pos(q)=${dt??"-"}, pos(ssot)=${rt??"-"}, pos(used)=${at??"-"}`,Vt=xe==="inserted"&&Ne!=null&&Xe!=null?`insert@index ${Ne} (ÁèæÂú®‰ΩçÁΩÆ+${Ne-Xe})`:xe.startsWith("skipped")?`skip (windowEnd=${(be==null?void 0:be.windowEnd)??"-"})`:"",Be=pe!=null?`offset=${pe}`:"";return`${He+1}. ${Qe} [${xe}] **${ke}** (${K}) ${Be} ${Vt} | ${Bt}`}).join(`
`),ee}catch(re){return`‚ö†Ô∏è debug_requeue_events „ÅÆËß£Êûê„Å´Â§±Êïó: ${String(re)}`}})()}

---

${P}

---

_„Åì„ÅÆ„É¨„Éù„Éº„Éà„Çí„Ç≥„Éî„Éº„Åó„Å¶GitHub Copilot Chat„ÅßÂàÜÊûê„Åß„Åç„Åæ„Åô_
`.trim();navigator.clipboard.writeText(Fe).then(()=>{x(!0),setTimeout(()=>x(!1),2e3)})};return N.useEffect(()=>{const $=localStorage.getItem("debug_ai_evaluations");if($)try{const P=JSON.parse($);m(Object.values(P).slice(-10))}catch{}{const P="memorization",L=r,O=De=>{if(!De)return null;try{return JSON.parse(De)}catch{return null}},F=De=>{const we=typeof De=="number"?De:Number(De);return Number.isFinite(we)?we:null},V=De=>{const we=Date.parse(String(De??""));return Number.isFinite(we)?we:0},G=De=>{const we=De.filter(Boolean);if(we.length===0)return null;const Re=we.filter(je=>F(je==null?void 0:je.questionsCount)===L);return Re.length>0?(Re.sort((je,lt)=>V(lt==null?void 0:lt.timestamp)-V(je==null?void 0:je.timestamp)),Re[0]):[...we].sort((je,lt)=>{const ht=F(je==null?void 0:je.questionsCount)??-1,it=F(lt==null?void 0:lt.questionsCount)??-1;return it!==ht?it-ht:V(lt==null?void 0:lt.timestamp)-V(je==null?void 0:je.timestamp)})[0]},_=`debug_position_interleaving_history_${P}`,Z=O(localStorage.getItem(_)),te=Array.isArray(Z)?Z:[],he=G(te),oe=`debug_position_interleaving_${P}`,ve=O(localStorage.getItem(oe)),$e=O(localStorage.getItem("debug_position_interleaving")),Ae=he??ve??$e;Ae&&v(Ae)}const D=localStorage.getItem("debug_answer_logs");if(D)try{C(JSON.parse(D))}catch{}const M=localStorage.getItem("debug_function_calls");if(M)try{I(JSON.parse(M))}catch{}localStorage.getItem("debug_position_hierarchy_validation"),localStorage.getItem("debug_position_hierarchy_still"),localStorage.getItem("debug_position_hierarchy_new")},[s]),h?u.jsxs("div",{className:"fixed bottom-4 right-4 w-96 max-h-96 bg-white rounded-lg shadow-2xl overflow-auto z-50 border-2 border-blue-500",children:[u.jsxs("div",{className:"sticky top-0 bg-blue-600 text-white p-3 flex justify-between items-center",children:[u.jsx("h3",{className:"font-bold",children:"üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„Éë„Éç„É´"}),u.jsxs("div",{className:"flex gap-2",children:[d&&c.length>0&&u.jsx("button",{onClick:d,className:"px-2 py-1 rounded bg-orange-500 hover:bg-orange-700 text-xs",title:"ÂõûÁ≠îÂ±•Ê≠¥„Çí„ÇØ„É™„Ç¢",children:"üóëÔ∏è"}),u.jsx("button",{onClick:()=>{confirm(`LocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Åæ„Åô„ÅãÔºü
Âè§„ÅÑ„Ç≠„É£„ÉÉ„Ç∑„É•„Éá„Éº„Çø„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÄÇ`)&&(localStorage.clear(),window.location.reload())},className:"px-2 py-1 rounded bg-purple-500 hover:bg-purple-700 text-xs font-bold",title:"LocalStorage„ÇØ„É™„Ç¢ÔºÜ„É™„É≠„Éº„ÉâÔºàÂè§„ÅÑ„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÂâäÈô§Ôºâ",children:"üîÑ"}),u.jsx("button",{onClick:E,className:`px-3 py-1 rounded ${g?"bg-green-500":"bg-blue-500 hover:bg-blue-700"}`,title:"„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„Åß„Ç≥„Éî„Éº",children:g?"‚úì „Ç≥„Éî„ÉºÂÆå‰∫Ü":"üìã „Ç≥„Éî„Éº"}),u.jsx("button",{onClick:l||(()=>f(!1)),className:"text-white hover:bg-blue-700 px-2 py-1 rounded",title:"Èñâ„Åò„Çã (Cmd/Ctrl + D)",children:"‚úï"})]})]}),u.jsxs("div",{className:"p-4 space-y-4 text-sm",children:[u.jsxs("div",{className:"bg-blue-50 p-2 rounded border border-blue-200 text-xs",children:[u.jsx("strong",{children:"üí° „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà:"})," Cmd/Ctrl + D „Åß„Éë„Éç„É´ÈñãÈñâ"]}),n==="social"&&t==="memorization"&&(()=>{var P;const $=o.map(L=>L.word).filter(Boolean),D=(P=o[s])==null?void 0:P.word,M=sJ({currentWord:D,deckWords:$});return u.jsxs("div",{className:"bg-emerald-50 p-3 rounded border border-emerald-200 text-xs",children:[u.jsx("p",{className:"font-semibold text-emerald-800 mb-1",children:"üß≠ Á§æ‰ºöÔºàÊöóË®òÔºâ„Éá„Éê„ÉÉ„Ç∞"}),u.jsxs("div",{className:"font-mono text-[11px] text-emerald-900",children:["storageKey: ",M.storageKey]}),e&&u.jsxs("div",{className:"text-emerald-900",children:["„Éá„Éº„Çø: ",e]}),u.jsxs("div",{className:"text-emerald-900",children:["„Éá„ÉÉ„Ç≠: ",r," / ‰øùÂ≠òÊ∏à„Åø: ",M.storedTerms,M.version!=null?` / v${M.version}`:""]}),u.jsxs("div",{className:"text-emerald-900",children:["ÂàÜÂ∏É(„Éá„ÉÉ„Ç≠ÂÜÖ): new ",M.deckStats.new,", incorrect"," ",M.deckStats.incorrect,", still ",M.deckStats.stillLearning,", learning"," ",M.deckStats.learning,", mastered ",M.deckStats.mastered]}),M.current&&D&&u.jsxs("div",{className:"mt-1 text-emerald-900",children:["ÁèæÂú®: ",D," / Pos ",M.current.position.toFixed(0)," / ‚óã",M.current.correctCount," √ó",M.current.incorrectCount,M.current.field?` / ${M.current.field}`:""]})]})})(),(()=>{try{const $=JSON.parse(localStorage.getItem("debug_answer_snapshots")||"[]");return $.length===0?null:u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üì∏ Ëß£Á≠îÁõ¥Âæå„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàÔºàÊúÄÊñ∞10‰ª∂Ôºâ"}),u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_answer_snapshots"),window.location.reload()},className:"px-2 py-1 text-xs bg-purple-500 hover:bg-purple-700 text-white rounded",children:"„ÇØ„É™„Ç¢"})]}),u.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:$.map((D,M)=>{const P=D.categoryAfter,F=P==="incorrect"?"bg-red-100 border-red-300":P==="still_learning"?"bg-yellow-100 border-yellow-300":"bg-green-100 border-green-300";return u.jsxs("div",{className:`p-2 rounded border ${F} text-xs`,children:[u.jsxs("div",{className:"font-mono font-bold",children:[D.word,u.jsxs("span",{className:"ml-2 text-gray-600",children:["(",new Date(D.timestamp).toLocaleTimeString("ja-JP"),")"]})]}),u.jsxs("div",{className:"mt-1 space-y-1",children:[u.jsxs("div",{children:["ÂõûÁ≠î: ",u.jsx("strong",{children:D.answerType})]}),u.jsxs("div",{children:["Position: ",D.positionBefore," ‚Üí ",u.jsx("strong",{children:D.positionAfter})]}),u.jsxs("div",{children:["„Ç´„ÉÜ„Ç¥„É™: ",D.categoryBefore," ‚Üí ",u.jsx("strong",{children:D.categoryAfter})]}),u.jsxs("div",{className:"text-gray-600",children:["ÈÄ≤Êçó: ",D.currentIndex,"/",D.totalQuestions,"Âïè"]})]})]},M)})})]})}catch{return null}})(),(()=>{try{const $=localStorage.getItem("debug_ab_session_info");if(!$)return null;const D=JSON.parse($),M=JSON.stringify(D,null,2);return u.jsxs("div",{className:"bg-orange-50 p-3 rounded border-2 border-orange-300",children:[u.jsx("p",{className:"font-semibold text-orange-800",children:"üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±Ôºà„Ç≥„Éî„ÉöÁî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„ÇØ„É™„ÉÉ„ÇØ„ÅßJSON„Çí„Ç≥„Éî„Éº"}),u.jsx("pre",{className:"mt-2 bg-white p-2 rounded text-xs cursor-pointer whitespace-pre-wrap break-words",onClick:()=>{navigator.clipboard.writeText(M),x(!0),setTimeout(()=>x(!1),1500)},title:"„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Ç≥„Éî„Éº",children:M})]})}catch{return null}})(),(()=>{const $=ad.generateSummary(t);if($==="„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó"||$==="„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó")return u.jsxs("div",{className:"bg-gray-50 p-3 rounded border-2 border-gray-300",children:[u.jsx("p",{className:"font-semibold text-gray-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°"}),u.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„ÅóÔºàÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ"})]});const M=$.split(`
`).filter(G=>G.trim()).filter(G=>G.startsWith("|"));if(M.length===0)return null;const[P,L,...O]=M,F=P.split("|").filter(G=>G.trim()).map(G=>G.trim()),V=O.map(G=>G.split("|").filter(_=>_.trim()).map(_=>_.trim()));return u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ"}),u.jsx("div",{className:"mt-2 overflow-x-auto",children:u.jsxs("table",{className:"min-w-full text-xs",children:[u.jsx("thead",{children:u.jsx("tr",{className:"bg-purple-100",children:F.map((G,_)=>u.jsx("th",{className:"px-2 py-1 text-left font-semibold",children:G},_))})}),u.jsx("tbody",{children:V.map((G,_)=>u.jsx("tr",{className:_%2===0?"bg-white":"bg-purple-50",children:G.map((Z,te)=>u.jsx("td",{className:"px-2 py-1",children:Z},te))},_))})]})})]})})(),c.length>0&&u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsx("p",{className:"font-semibold text-green-800",children:"üìä ÂõûÁ≠îÂ±•Ê≠¥ÔºàÊúÄÊñ∞20‰ª∂Ôºâ"}),(()=>{const $=c.slice(-20),D=[],M=new Map;return $.forEach((P,L)=>{if(M.has(P.word)){const O=M.get(P.word),F=L-O;if(F<=10){const V=D.find(G=>G.word===P.word);V?(V.positions.push(L),V.gap=Math.min(V.gap,F)):D.push({word:P.word,positions:[O,L],gap:F})}}M.set(P.word,L)}),D.length>0?u.jsxs("div",{className:"mt-2 mb-3 bg-red-100 border-2 border-red-500 p-2 rounded",children:[u.jsx("p",{className:"font-bold text-red-800",children:"üö® ÊåØÂãïÊ§úÂá∫!"}),u.jsx("div",{className:"mt-1 space-y-1 text-xs",children:D.map((P,L)=>u.jsxs("div",{className:"text-red-700",children:[u.jsx("span",{className:"font-semibold",children:P.word}),": ",P.gap,"ÂïèÂæå„Å´ÂÜçÂá∫È°å (‰ΩçÁΩÆ: ",P.positions.join(", "),")"]},L))})]}):u.jsx("div",{className:"mt-2 mb-3 bg-green-100 border border-green-500 p-2 rounded text-xs text-green-700",children:"‚úÖ ÊåØÂãï„Å™„ÅóÔºàÁõ¥Ëøë20Âïè„ÅßÂêå„ÅòË™û„Åå10Âïè‰ª•ÂÜÖ„Å´ÂÜçÂá∫È°å„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºâ"})})(),u.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:c.slice(-20).reverse().map(($,D)=>{const M=c.length-D,P=$.answer==="correct"?"‚úÖ Áü•„Å£„Å¶„Çã":$.answer==="still_learning"?"üü° „Åæ„Å†„Åæ„Å†":"‚ùå ÂàÜ„Åã„Çâ„Å™„ÅÑ",L=$.countedAs==="mastered"?"‚úÖ ÂÆöÁùÄÊ∏à":$.countedAs==="still_learning"?"üü° „Åæ„Å†„Åæ„Å†":"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ",O=$.answer==="correct"?"bg-green-100 text-green-800":$.answer==="still_learning"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",F=$.countedAs==="mastered"?"bg-green-100 text-green-800":$.countedAs==="still_learning"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";return u.jsxs("div",{className:"bg-white p-2 rounded shadow-sm text-xs",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"bg-gray-700 text-white px-2 py-0.5 rounded text-xs font-bold",children:["#",M]}),u.jsx("span",{className:"font-semibold",children:$.word})]}),u.jsxs("span",{className:"text-gray-500",children:["Pos: ",$.position.toFixed(0)]})]}),u.jsxs("div",{className:"mt-1 flex gap-2",children:[u.jsx("span",{className:`px-2 py-0.5 rounded ${O}`,children:P}),u.jsx("span",{children:"‚Üí"}),u.jsxs("span",{className:`px-2 py-0.5 rounded ${F}`,children:[L,"„Å´„Ç´„Ç¶„É≥„Éà"]})]}),u.jsx("div",{className:"text-gray-500 text-xs mt-1",children:new Date($.timestamp).toLocaleTimeString("ja-JP")})]},D)})})]}),(()=>{const $=nt(),D=Object.keys($.wordProgress||{}).length,M=Object.values($.wordProgress||{});let P=0,L=0,O=0,F=0,V=0,G=0;for(const he of M){const oe=Qf(he,t),ve=$b(he,t),$e=Tb(he,t),Ae=Jt(he,t);F+=oe,V+=ve,G+=$e,oe!==0&&(Ae>=70?O++:Ae>=40?L++:Ae<20&&P++)}const _=Math.max(0,F-V-G),Z=F>0?(V/F*100).toFixed(1):"0.0",te=D>0?(P/D*100).toFixed(1):"0.0";return u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsx("p",{className:"font-semibold text-green-800",children:"„Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"Á∑èÂçòË™ûÊï∞"}),u.jsxs("p",{className:"text-lg font-bold",children:[D,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÁøíÂæóÊ∏à„Åø"}),u.jsxs("p",{className:"text-lg font-bold text-green-600",children:[P,"Ë™û"]}),u.jsxs("p",{className:"text-xs text-gray-500",children:["(",te,"%)"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"„Åæ„Å†„Åæ„Å†"}),u.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:[L,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"}),u.jsxs("p",{className:"text-lg font-bold text-red-600",children:[O,"Ë™û"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÂÖ®‰ΩìÊ≠£Á≠îÁéá:"}),u.jsxs("span",{className:"font-bold",children:[Z,"%"]})]}),u.jsxs("div",{className:"flex justify-between mt-1",children:[u.jsx("span",{className:"text-gray-600",children:"Á∑èË©¶Ë°åÂõûÊï∞:"}),u.jsxs("span",{children:[F,"Âõû"]})]}),u.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[u.jsxs("span",{className:"text-green-600",children:["Ê≠£Á≠î: ",V,"Âõû"]}),u.jsxs("span",{className:"text-red-600",children:["Ë™§Á≠î: ",_,"Âõû"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÈÄ≤ÊçóÁéá:"}),u.jsxs("span",{className:"font-bold",children:[(s/r*100).toFixed(1),"%"]})]}),u.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s," / ",r," ÂïèÁõÆ"]}),u.jsx("progress",{className:"w-full h-2 rounded-full mt-2 [&::-webkit-progress-bar]:bg-gray-200 [&::-webkit-progress-value]:bg-blue-600 [&::-moz-progress-bar]:bg-blue-600",value:s,max:Math.max(1,r)})]})]})]})})(),k.length>0&&u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsxs("p",{className:"font-semibold text-blue-800",children:["üìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞",k.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:k.slice().reverse().map(($,D)=>u.jsxs("div",{className:"text-xs bg-white p-2 rounded flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-mono font-bold text-blue-600",children:$.function}),u.jsx("span",{className:"ml-2 text-gray-600",children:JSON.stringify($.params)})]}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date($.timestamp).toLocaleTimeString()})]},D))})]}),S.length>0&&u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsxs("p",{className:"font-semibold text-green-800",children:["üìù Ëß£Á≠îÁõ¥Âæå„ÅÆPositionË®àÁÆó (ÊúÄÊñ∞",S.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:S.slice().reverse().map(($,D)=>{const M=Math.abs($.positionAfter-$.positionBefore)>1,P=$.positionAfter>$.positionBefore;return u.jsxs("div",{className:"text-xs bg-white p-2 rounded border",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:$.word}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date($.timestamp).toLocaleTimeString()})]}),u.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-600",children:"Position: "}),u.jsxs("span",{className:M?P?"text-red-600 font-bold":"text-green-600 font-bold":"",children:[$.positionBefore.toFixed(0)," ‚Üí ",$.positionAfter.toFixed(0)]}),M&&u.jsxs("span",{className:"ml-2",children:[P?"üî∫":"üîª",Math.abs($.positionAfter-$.positionBefore).toFixed(0)]})]}),(()=>{const L=(()=>{switch($.category){case"incorrect":return{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded text-xs",label:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs",label:"üü° „Åæ„Å†„Åæ„Å†"};case"new":return{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs",label:"‚ö™ Êñ∞Ë¶è"};case"mastered":return{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs",label:"‚úÖ ÂÆöÁùÄÊ∏à"};default:return{className:"bg-gray-100 text-gray-800 px-2 py-0.5 rounded text-xs",label:String($.category??"")}}})();return u.jsx("span",{className:L.className,children:L.label})})()]}),u.jsxs("div",{className:"mt-1 flex gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["Ê≠£Á≠î: ",$.progress.correctCount]}),u.jsxs("span",{children:["Ë™§Á≠î: ",$.progress.incorrectCount]}),u.jsxs("span",{children:["ÈÄ£Á∂öÊ≠£Á≠î: ",$.progress.consecutiveCorrect]}),u.jsxs("span",{children:["ÈÄ£Á∂öË™§Á≠î: ",$.progress.consecutiveIncorrect]}),u.jsxs("span",{children:["Ê≠£Á≠îÁéá: ",($.progress.accuracy*100).toFixed(0),"%"]})]}),(()=>{var _,Z;const L=$.savedPositionDebug,O=L==null?void 0:L.savedPosition,F=L==null?void 0:L.decision,V=L==null?void 0:L.reason,G=$.positionWithSavedPosition;return O===void 0&&G===void 0&&!F?null:u.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["savedPosition: ",O??"-"]}),u.jsxs("span",{children:["calc(savedÊúâ„Çä): ",G??"-"]}),u.jsxs("span",{children:["calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå): ",((Z=(_=$.positionAfter)==null?void 0:_.toFixed)==null?void 0:Z.call(_,0))??"-"]}),F&&u.jsxs("span",{children:["savedÂà§ÂÆö: ",String(F),V?` (${String(V)})`:""]})]})})()]},D)})})]}),w&&u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üéÆ PositionÂàÜÊï£Ë®∫Êñ≠"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Ââç:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",w.before.struggling,"Ë™û / Êñ∞Ë¶è",w.before.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Âæå:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",w.after.struggling,"Ë™û / Êñ∞Ë¶è",w.after.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between font-bold",children:[u.jsx("span",{children:"PositionÂºï„Åç‰∏ä„Åí:"}),u.jsxs("span",{className:w.summary.working?"text-green-600":"text-red-600",children:[w.summary.boosted,"Ë™û",w.summary.working?" ‚úÖ":" ‚ùå"]})]}),w.changed.length>0&&u.jsxs("details",{className:"mt-2",children:[u.jsxs("summary",{className:"cursor-pointer text-purple-700",children:["Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û (",w.changed.length,"Ë™û)"]}),u.jsx("ul",{className:"mt-1 space-y-1 max-h-40 overflow-y-auto",children:w.changed.slice(0,10).map(($,D)=>u.jsxs("li",{className:"text-xs bg-white p-1 rounded",children:[u.jsx("span",{className:"font-mono",children:$.word}),":"," ",u.jsxs("span",{className:"text-gray-500",children:[$.before.toFixed(0)," ‚Üí ",$.after.toFixed(0)]})]},D))})]}),!w.summary.working&&u.jsx("div",{className:"text-red-600 font-bold mt-2",children:"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„Éñ„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ"})]})]}),(()=>{const $=ra(t).slice(0,30);if($.length===0)return null;try{const D=$.map(F=>F.attempts>0&&F.position>=40&&F.position<70?"„Åæ„Å†„Åæ„Å†":F.attempts===0&&F.position>=40&&F.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":F.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":F.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),M={„Åæ„Å†„Åæ„Å†:D.filter(F=>F==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:D.filter(F=>F==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:D.filter(F=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(F)).length},P=D.slice(0,20).map(F=>{switch(F){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join("");let L=0;for(let F=0;F<D.length-1;F++){const V=D[F],G=D[F+1];V==="„Åæ„Å†„Åæ„Å†"&&G==="Êñ∞Ë¶è(Âºï‰∏ä)"&&L++,V==="Êñ∞Ë¶è(Âºï‰∏ä)"&&G==="„Åæ„Å†„Åæ„Å†"&&L++}const O=L>=3;return u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üü° „Åæ„Å†„Åæ„Å†:"}),u.jsxs("span",{className:"font-bold",children:[M.„Åæ„Å†„Åæ„Å†,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üîµ Êñ∞Ë¶è(Âºï‰∏ä):"}),u.jsxs("span",{className:"font-bold",children:[M.Êñ∞Ë¶èÂºï‰∏ä,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"„Åù„ÅÆ‰ªñ:"}),u.jsxs("span",{children:[M.„Åù„ÅÆ‰ªñ,"Ë™û"]})]}),u.jsxs("div",{className:"mt-3 p-2 bg-white rounded",children:[u.jsx("p",{className:"text-xs font-semibold mb-1",children:"„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ (TOP20):"}),u.jsx("div",{className:"text-lg leading-relaxed break-all",children:P}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à"})]}),u.jsxs("div",{className:`mt-2 p-2 rounded ${O?"bg-green-100":"bg-yellow-100"}`,children:[u.jsx("p",{className:"font-semibold",children:O?"‚úÖ ‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ":"‚ö†Ô∏è ‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑ"}),u.jsxs("p",{className:"text-xs mt-1",children:["Âàá„ÇäÊõø„ÅàÂõûÊï∞: ",L,"Âõû",O?" (ÊúüÂæÖ: „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè)":""]})]}),M.„Åæ„Å†„Åæ„Å†===0&&M.Êñ∞Ë¶èÂºï‰∏ä===0&&u.jsx("div",{className:"text-gray-600 mt-2",children:"‚ÑπÔ∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„ÅóÔºàÊ≠£Â∏∏Âãï‰ΩúÔºâ"})]})]})}catch{return null}})(),u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsx("p",{className:"font-semibold",children:"üìç ÁèæÂú®‰ΩçÁΩÆ"}),u.jsxs("p",{className:"text-lg",children:[s+1," / ",r," ÂïèÁõÆ"]})]}),u.jsxs("div",{className:"bg-yellow-50 p-3 rounded",children:[u.jsxs("p",{className:"font-semibold text-yellow-800",children:["üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (",y.length,"Ë™û)"]}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"LocalStorage„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãËã¶ÊâãÂçòË™ûÔºàPosition ‚â• 40Ôºâ"}),y.length===0?u.jsx("p",{className:"text-gray-600 mt-2",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-1 max-h-60 overflow-y-auto",children:y.slice(0,20).map(($,D)=>u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:$.word}),u.jsx("span",{className:$.position>=70?"bg-red-100 text-red-800 px-2 py-0.5 rounded":"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:$.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-500",children:[u.jsxs("span",{children:["Position: ",$.position.toFixed(0)]}),u.jsxs("span",{children:["Ë©¶Ë°å: ",$.attempts,"Âõû"]}),u.jsxs("span",{children:["ÊúÄÁµÇ: ",new Date($.lastStudied).toLocaleDateString()]})]})]},D))}),y.length>20&&u.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["‚Äª ÊúÄÂàù„ÅÆ20Ë™û„ÅÆ„ÅøË°®Á§∫ÔºàÂÖ®",y.length,"Ë™ûÔºâ"]})]}),u.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üìã Ê¨°„ÅÆ30ÂïèÔºàPositionÂàÜÊï£Ë®∫Êñ≠Áî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„Åæ„Å†„Åæ„Å†58Ë™û ‚Üí Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÅåPosition +15„Åï„Çå„Å¶„ÅÑ„Çã„ÅØ„Åö"}),u.jsx("ul",{className:"mt-2 space-y-1 max-h-80 overflow-y-auto",children:o.slice(s+1,s+31).map(($,D)=>{var Z;const M=$==null?void 0:$.word,L=(Z=nt().wordProgress)==null?void 0:Z[M],O=(L==null?void 0:L.memorizationPosition)??0,F=(L==null?void 0:L.totalAttempts)??0,V=($==null?void 0:$.difficulty)??"‰∏çÊòé",G=O>=40,_=O>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":O>=40?"üü° „Åæ„Å†„Åæ„Å†":O>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return u.jsxs("li",{className:`text-xs p-2 rounded ${G?"bg-yellow-200 font-bold":"bg-white"}`,children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"text-gray-500",children:[s+D+2,"ÂïèÁõÆ"]})," ",u.jsx("span",{className:"font-mono font-bold",children:M})]}),u.jsx("div",{className:"text-xs",children:_})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-600",children:[u.jsxs("span",{children:["Position: ",O.toFixed(0)]}),u.jsxs("span",{children:["Âá∫È°å: ",F,"Âõû"]}),u.jsx("span",{children:V}),G&&u.jsx("span",{className:"text-yellow-800 font-bold",children:O>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]})]},D)})})]}),u.jsxs("div",{className:"bg-purple-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"ü§ñ AIË©ï‰æ°ÔºàÊúÄÊñ∞10‰ª∂Ôºâ"}),p.length===0?u.jsx("p",{className:"text-gray-600",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-2",children:p.slice(-10).map(($,D)=>{const M=$.word||"(ÂçòË™ûÂêç„Å™„Åó)",P=(()=>{switch($.category){case"incorrect":return{className:"bg-red-100 text-red-800",label:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800",label:"„Åæ„Å†„Åæ„Å†"};case"mastered":return{className:"bg-green-100 text-green-800",label:"ÂÆöÁùÄÊ∏à"};case"new":return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"};default:return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"}}})();return u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"text-gray-500",children:["#",D+1]}),u.jsx("span",{className:"font-mono font-bold text-base text-blue-600",children:M})]}),u.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${P.className}`,children:P.label})]}),u.jsxs("div",{className:"flex flex-col gap-1 text-gray-600",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"font-semibold",children:["Position: ",($.position??0).toFixed(0)]}),u.jsxs("span",{className:"ml-2 text-xs",children:["(ÈÄ£Á∂öÊ≠£Ëß£: ",$.consecutiveCorrect??0,", ÈÄ£Á∂ö‰∏çÊ≠£Ëß£:"," ",$.consecutiveIncorrect??0,")"]})]}),u.jsxs("div",{className:"text-xs",children:[u.jsxs("span",{children:["Ê≠£Ëß£Áéá: ",(($.accuracy??0)*100).toFixed(0),"%"]}),u.jsxs("span",{className:"ml-2",children:["Ë©¶Ë°å: ",$.attempts??0,"Âõû"]}),u.jsxs("span",{className:"ml-2",children:["ÁµåÈÅé: ",$.daysSince??0,"Êó•"]})]}),$.aiProposals&&u.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[u.jsx("div",{className:"text-xs font-semibold mb-1",children:"ü§ñ 7„Å§„ÅÆAIÊèêÊ°à:"}),u.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[u.jsxs("span",{children:["üß† Memory: ",($.aiProposals.memory??0).toFixed(0)]}),u.jsxs("span",{children:["üí§ CogLoad: ",($.aiProposals.cognitiveLoad??0).toFixed(0)]}),u.jsxs("span",{children:["üîÆ Error: ",($.aiProposals.errorPrediction??0).toFixed(0)]}),u.jsxs("span",{children:["üìö Linguistic: ",($.aiProposals.linguistic??0).toFixed(0)]}),u.jsxs("span",{children:["üåç Context: ",($.aiProposals.contextual??0).toFixed(0)]}),u.jsxs("span",{children:["üéØ Style: ",($.aiProposals.learningStyle??0).toFixed(0)]}),u.jsxs("span",{className:"col-span-2",children:["üéÆ Gamify: ",($.aiProposals.gamification??0).toFixed(0)]})]})]})]})]},D)})})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_ai_evaluations"),m([])},className:"flex-1 bg-red-100 text-red-800 px-3 py-2 rounded hover:bg-red-200",children:"üóëÔ∏è AIË©ï‰æ°„ÇØ„É™„Ç¢"}),u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_memorization_latest")},className:"flex-1 bg-gray-100 text-gray-800 px-3 py-2 rounded hover:bg-gray-200",children:"üóëÔ∏è „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞„ÇØ„É™„Ç¢"})]}),u.jsxs("div",{className:"mt-6 border-t-2 border-blue-300 pt-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"font-bold text-lg",children:"üìä A/B„ÉÜ„Çπ„ÉàÈõÜË®à"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{const $=kb();T($)},className:"bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200",children:"üîÑ Êõ¥Êñ∞"}),u.jsx("button",{onClick:()=>{const $=ZY(),D=new Blob([$],{type:"application/json"}),M=URL.createObjectURL(D),P=document.createElement("a");P.href=M,P.download=`ab-session-logs-${Date.now()}.json`,P.click(),URL.revokeObjectURL(M)},className:"bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200",children:"üíæ JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà"}),u.jsx("button",{onClick:()=>{window.confirm("„Åô„Åπ„Å¶„ÅÆA/B„Çª„ÉÉ„Ç∑„Éß„É≥„É≠„Ç∞„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")&&(eJ(),T(null))},className:"bg-red-100 text-red-800 px-3 py-1 rounded text-sm hover:bg-red-200",children:"üóëÔ∏è „ÇØ„É™„Ç¢"})]})]}),A&&A.totalSessions>0?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsxs("div",{className:"text-sm",children:[u.jsx("strong",{children:"Á∑è„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞:"})," ",A.totalSessions]}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["ÊúÄÁµÇÊõ¥Êñ∞: ",new Date(A.lastUpdated).toLocaleString("ja-JP")]})]}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm border-collapse",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-gray-200",children:[u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"Variant"}),u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"N"}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(‰∏≠Â§ÆÂÄ§)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóÁéá",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊåØÂãï„Çπ„Ç≥„Ç¢",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊâÄË¶ÅÊôÇÈñì",u.jsx("br",{}),"(Âπ≥Âùá)"]})]})}),u.jsx("tbody",{children:["A","B","C"].map($=>{const D=A.byVariant[$];return D?u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:$}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:D.sessionCount}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:D.avgAcquiredWords.toFixed(2)}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:D.medianAcquiredWords.toFixed(0)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[(D.avgAcquisitionRate*100).toFixed(1),"%"]}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:D.avgVibrationScore.toFixed(1)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[Math.round(D.avgDurationSec),"Áßí"]})]},$):u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:$}),u.jsx("td",{colSpan:6,className:"border border-gray-300 px-2 py-1 text-center text-gray-500",children:"„Éá„Éº„Çø„Å™„Åó"})]},$)})})]})}),(()=>{try{const D=JSON.parse(localStorage.getItem("ab_session_logs")||"[]").filter(M=>M.mlEnabled===!0).length;if(D>0)return u.jsxs("div",{className:"bg-blue-50/20 p-3 rounded border border-blue-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"ü§ñ MLÁµ±Ë®à"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["ML ON„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞: ",D]}),u.jsx("div",{className:"text-gray-600",children:"‚Äª MLÊúâÂäπÂåñÂæå„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø„ÅØÂêÑvariant„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô"})]})]})}catch{}return null})(),A.byVariant.A&&u.jsxs("div",{className:"bg-yellow-50/20 p-3 rounded border border-yellow-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"üìà Âà§ÂÆöÂü∫Ê∫ñÔºàÊö´ÂÆöÔºâ"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["‚úÖ ",u.jsx("strong",{children:"ÂêàÊ†º:"})," B or C „Åå A „Å´ÂØæ„Åó„Å¶„ÄåÂèñÂæóË™ûÊï∞/„Çª„ÉÉ„Ç∑„Éß„É≥ +10%„Äç„Åã„Å§ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ„Å™„Åó"]}),u.jsxs("div",{children:["‚ùå ",u.jsx("strong",{children:"‰∏çÂêàÊ†º:"})," ÊîπÂñÑ„Å™„Åó or ÊåØÂãï„Çπ„Ç≥„Ç¢ > 50"]})]}),A.byVariant.B&&A.byVariant.A&&u.jsxs("div",{className:"mt-2 text-xs",children:[u.jsx("strong",{children:"B vs A:"})," ",A.byVariant.B.avgAcquiredWords>=A.byVariant.A.avgAcquiredWords*1.1&&A.byVariant.B.avgVibrationScore<=A.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]}),A.byVariant.C&&A.byVariant.A&&u.jsxs("div",{className:"mt-1 text-xs",children:[u.jsx("strong",{children:"C vs A:"})," ",A.byVariant.C.avgAcquiredWords>=A.byVariant.A.avgAcquiredWords*1.1&&A.byVariant.C.avgVibrationScore<=A.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]})]})]}):u.jsx("div",{className:"text-center text-gray-500 py-8",children:"„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})]})]}):null}var la=(n=>(n.ENCODING="encoding",n.INITIAL_CONSOLIDATION="initial",n.INTRADAY_REVIEW="intraday",n.SHORT_TERM="short_term",n.LONG_TERM="long_term",n))(la||{});const Ab={encodingTime:3e4,initialConsolidation:36e5,intradayWindow:864e5,shortTermWindow:6048e5,longTermThreshold:6048e5,correctRateThreshold:.8,responseTimeThreshold:1500},rJ=1e3,oJ=100,iJ=100,aJ=0,cJ=6e4,lJ=1e3;class uJ{constructor(e,t){me(this,"thresholds");me(this,"cache");me(this,"CACHE_DURATION",5e3);const s={...Ab,...t};e?this.thresholds=this.adjustThresholds(s,e):this.thresholds=s,this.cache=new Map}adjustThresholds(e,t){return{encodingTime:e.encodingTime,initialConsolidation:e.initialConsolidation/t.learningSpeed,intradayWindow:e.intradayWindow,shortTermWindow:e.shortTermWindow/t.learningSpeed,longTermThreshold:e.longTermThreshold/t.learningSpeed,correctRateThreshold:e.correctRateThreshold,responseTimeThreshold:e.responseTimeThreshold*t.learningSpeed}}detectPhase(e,t){const s=Date.now(),r=this.cache.get(e);if(r&&s-r.timestamp<this.CACHE_DURATION)return r.phase;const o=this.detectPhaseWithReason(e,t);return this.cache.set(e,{phase:o.phase,timestamp:s}),o.phase}detectPhaseWithReason(e,t){const s=Date.now(),r=this.sanitizeTimestamp(t.lastReviewTime,s),o=this.sanitizeTimestamp(t.lastCorrectTime,s),i=this.sanitizeResponseTime(t.averageResponseTime),a=s-r,c=a/864e5,l=t.reviewCount>0?t.correctCount/t.reviewCount:0,d={reviewCount:t.reviewCount,correctCount:t.correctCount,correctRate:l,daysSinceLastReview:c,timeSinceLastReview:a,averageResponseTime:i};if(t.reviewCount===0)return{phase:"encoding",reason:"ÂàùË¶ãÂçòË™ûÔºàreviewCount=0Ôºâ",matchedCondition:1,metrics:d};if(a<this.thresholds.encodingTime)return{phase:"encoding",reason:`‰ΩúÊ•≠Ë®òÊÜ∂ÊÆµÈöéÔºà${Math.round(a/1e3)}ÁßíÂâçÔºâ`,matchedCondition:2,metrics:d};if(t.correctCount===0)return{phase:"encoding",reason:"‰∏ÄÂ∫¶„ÇÇÊ≠£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑ",matchedCondition:3,metrics:d};if(c>rJ)return{phase:"encoding",reason:`Ë∂ÖÈï∑ÊúüÊîæÁΩÆÔºà${Math.round(c)}Êó•ÂâçÔºâ`,matchedCondition:101,metrics:d};if(t.consecutiveCorrect>=oJ)return{phase:"long_term",reason:`ÂÆåÂÖ®ÁøíÂæóÔºà${t.consecutiveCorrect}ÂõûÈÄ£Á∂öÊ≠£Á≠îÔºâ`,matchedCondition:102,metrics:d};if(t.consecutiveWrong>=iJ)return{phase:"encoding",reason:`Â≠¶ÁøíÊñπÊ≥ïË¶ÅË¶ãÁõ¥„ÅóÔºà${t.consecutiveWrong}ÂõûÈÄ£Á∂öË™§Á≠îÔºâ`,matchedCondition:103,metrics:d};const h=(s-o)/36e5;if(t.correctCount===1&&s-o<this.thresholds.initialConsolidation)return{phase:"initial",reason:`ÂàùÊúüÁµ±ÂêàÊÆµÈöéÔºàÂàùÂõûÊ≠£Á≠îÂæå${Math.round(h*60)}ÂàÜÔºâ`,matchedCondition:4,metrics:d};if(this.isSameDay(s,o)&&t.correctCount>=2)return{phase:"intraday",reason:`ÂêåÊó•Âæ©ÁøíÊÆµÈöéÔºà‰ªäÊó•${t.correctCount}ÂõûÊ≠£Á≠îÔºâ`,matchedCondition:5,metrics:d};if(c>=1&&c<=7){if(l>=.5&&l<this.thresholds.correctRateThreshold)return{phase:"short_term",reason:`Áü≠ÊúüË®òÊÜ∂ÊÆµÈöéÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d};if(l<.5)return{phase:"encoding",reason:`ÂøòÂç¥„Å´„Çà„Çä„É™„Çª„ÉÉ„ÉàÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d}}return c>7?l>=this.thresholds.correctRateThreshold&&i<this.thresholds.responseTimeThreshold?{phase:"long_term",reason:`Èï∑ÊúüË®òÊÜ∂Á¢∫Á´ãÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%„ÄÅÂøúÁ≠î${Math.round(i)}msÔºâ`,matchedCondition:7,metrics:d}:l>=.5&&l<this.thresholds.correctRateThreshold?{phase:"short_term",reason:`„Åæ„Å†‰∏çÂÆâÂÆöÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"encoding",reason:`ÂÆåÂÖ®ÂøòÂç¥ÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"short_term",reason:"„Éá„Éï„Ç©„É´„ÉàÂà§ÂÆö",matchedCondition:0,metrics:d}}canTransition(e,t,s){const r=this.detectPhase(e,t);if(r===s)return!0;const o=["encoding","initial","intraday","short_term","long_term"],i=o.indexOf(r),a=o.indexOf(s);return a>i?a-i===1:!0}isSameDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}sanitizeResponseTime(e){return e<=aJ||e>cJ||isNaN(e)?lJ:e}sanitizeTimestamp(e,t){return e>t?(console.warn(`Êú™Êù•„ÅÆ„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„ÇíÊ§úÂá∫: ${e}`),t):e<0||isNaN(e)?t:e}clearCache(){this.cache.clear()}updateThresholds(e){this.thresholds=this.adjustThresholds(Ab,e),this.clearCache()}}var fc=(n=>(n.IMMEDIATE="immediate",n.EARLY="early",n.MID="mid",n.END="end",n))(fc||{}),Ja=(n=>(n.MEMORIZATION="memorization",n.TRANSLATION="translation",n.SPELLING="spelling",n.GRAMMAR="grammar",n))(Ja||{});const dJ={memorization:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5},translation:{consolidationThreshold:4,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.6},spelling:{consolidationThreshold:6,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.4},grammar:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5}},wu={immediate:50,early:100,mid:150,end:200},hJ=72e5,Rb=3,fJ=1/0,pJ=2,mJ=1,Eb=.85,rc=4;class gJ{constructor(e){me(this,"queues");me(this,"currentQuestionNumber",0);me(this,"sessionStartTime",Date.now());me(this,"wordAttempts",new Map);me(this,"acquisitionProgress",new Map);me(this,"tabConfigs");if(this.queues={immediate:[],early:[],mid:[],end:[]},this.tabConfigs={...dJ},e)for(const[t,s]of Object.entries(e))this.tabConfigs[t]={...this.tabConfigs[t],...s}}enqueueNewWord(e,t,s){const r=Date.now();this.currentQuestionNumber++;const o=this.tabConfigs[s];if(this.acquisitionProgress.has(e)||this.acquisitionProgress.set(e,{todayFirstSeen:r,todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:o.consolidationThreshold,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:r}),o.enableImmediateReview&&this.shouldEnqueueImmediate(t)){const i=this.calculateImmediateGap(t);this.enqueueToImmediate(e,t,s,i)}}enqueueToImmediate(e,t,s,r){const o=Date.now();if(this.isDuplicateInQueue(e,"immediate"))return;const i={word:e,queueType:"immediate",enqueuedAt:o,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+r,targetTime:o+6e4,priority:100,difficulty:t,category:s};this.enqueueWithLimit(this.queues.immediate,i,wu.immediate);const a=this.acquisitionProgress.get(e);a.currentQueue="immediate",a.queuedAt=o}enqueueToEarly(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEarlyReview||this.isDuplicateInQueue(e,"early"))return;const i=this.calculateEarlyGap(t),a={word:e,queueType:"early",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+6e5,priority:80,difficulty:t,category:s};this.enqueueWithLimit(this.queues.early,a,wu.early);const c=this.acquisitionProgress.get(e);c.currentQueue="early",c.queuedAt=r}enqueueToMid(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableMidReview||this.isDuplicateInQueue(e,"mid"))return;const i=this.calculateMidGap(t),a={word:e,queueType:"mid",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+36e5,priority:60,difficulty:t,category:s};this.enqueueWithLimit(this.queues.mid,a,wu.mid);const c=this.acquisitionProgress.get(e);c.currentQueue="mid",c.queuedAt=r}enqueueToEnd(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEndReview||this.isDuplicateInQueue(e,"end"))return;const i={word:e,queueType:"end",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:1/0,targetTime:1/0,priority:40,difficulty:t,category:s};this.enqueueWithLimit(this.queues.end,i,wu.end);const a=this.acquisitionProgress.get(e);a.currentQueue="end",a.queuedAt=r}getNextReviewQuestion(){this.cleanupExpiredEntries();const e=Date.now(),t=this.currentQuestionNumber,s=[];for(const r of this.queues.immediate)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.early)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.mid)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);if(s.sort((r,o)=>o.priority-r.priority),s.length>0){const r=s[0];return this.removeFromQueue(r),r}return null}handleCorrectAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayCorrectCount++,i.consecutiveCorrectStreak++,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!0,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.consecutiveCorrectStreak>=5&&i.dynamicThreshold>Rb&&(i.dynamicThreshold=Math.max(Rb,i.dynamicThreshold-mJ),i.lastThresholdAdjustment=Date.now(),console.log(`üìâ ÂãïÁöÑÈñæÂÄ§„Çí‰∏ã„Åí„Åæ„Åó„Åü: ${e} ‚Üí ${i.dynamicThreshold}Âõû`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),t==="immediate"&&this.shouldEnqueueEarly(e,i)?this.enqueueToEarly(e,a,c):t==="early"&&this.shouldEnqueueMid(e,i)?this.enqueueToMid(e,a,c):t==="mid"&&this.shouldEnqueueEnd(e,i)?this.enqueueToEnd(e,a,c):i.todayCorrectCount===1&&t==="immediate"&&this.enqueueToImmediate(e,a,c,1),this.isAcquisitionComplete(e,i)&&(i.isAcquisitionComplete=!0,console.log(`‚úÖ Ë®òÊÜ∂Áç≤ÂæóÂÆå‰∫Ü: ${e}`))}handleWrongAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayWrongCount++,i.consecutiveCorrectStreak=0,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!1,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.dynamicThreshold,i.dynamicThreshold=Math.min(fJ,i.dynamicThreshold+pJ),i.lastThresholdAdjustment=Date.now(),i.isAcquisitionComplete&&(i.isAcquisitionComplete=!1,console.log(`üîÑ Ë™§Á≠î„Å´„Çà„ÇäÂÆöÁùÄÂÆå‰∫Ü„Çí„É™„Çª„ÉÉ„Éà: ${e}`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),this.removeFromAllQueues(e),t!=="immediate"&&console.log(`‚ùå Ë™§Á≠î„Å´„Çà„ÇäÂç≥ÊôÇÂæ©Áøí„Ç≠„É•„Éº„Å´Êàª„Åó„Åæ„Åô: ${e}`),this.enqueueToImmediate(e,Math.min(a+1,5),c,1)}startSessionEndReview(){const e=[...this.queues.end];return e.length===0?(console.log("ÁµÇ‰∫ÜÊôÇÂæ©Áøí„Å™„Åó"),[]):(console.log(`ÁµÇ‰∫ÜÊôÇÂæ©Áøí„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºà${e.length}Ë™ûÔºâ`),e)}generateAcquisitionReport(){const e=Array.from(this.acquisitionProgress.keys()),t=[],s=[];for(const r of e)this.acquisitionProgress.get(r).isAcquisitionComplete?t.push(r):s.push(r);return{totalWords:e.length,completed:t.length,incomplete:s.length,completionRate:e.length>0?t.length/e.length:0,incompleteWords:s}}getQueueStatistics(){var e,t,s,r;return{immediate:{size:this.queues.immediate.length,oldestEntry:(e=this.queues.immediate[0])==null?void 0:e.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.immediate)},early:{size:this.queues.early.length,oldestEntry:(t=this.queues.early[0])==null?void 0:t.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.early)},mid:{size:this.queues.mid.length,oldestEntry:(s=this.queues.mid[0])==null?void 0:s.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.mid)},end:{size:this.queues.end.length,oldestEntry:(r=this.queues.end[0])==null?void 0:r.enqueuedAt,averageWaitTime:0}}}getAcquisitionProgress(e){if(!this.acquisitionProgress.has(e)){const t=this.findWordInQueues(e),s=(t==null?void 0:t.category)||"memorization",r=this.tabConfigs[s].consolidationThreshold;this.acquisitionProgress.set(e,{todayFirstSeen:Date.now(),todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:r,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:Date.now()})}return this.acquisitionProgress.get(e)}incrementQuestionNumber(){this.currentQuestionNumber++}reset(){this.queues={immediate:[],early:[],mid:[],end:[]},this.currentQuestionNumber=0,this.sessionStartTime=Date.now(),this.wordAttempts.clear(),this.acquisitionProgress.clear()}getQueueInfo(e){const t=this.findWordInQueues(e);return t?{queueType:t.queueType,questionNumber:t.targetQuestionNumber}:null}getQueueSizes(){return{immediate:this.queues.immediate.length,early:this.queues.early.length,mid:this.queues.mid.length,end:this.queues.end.length}}exportQueues(){return{immediate:[...this.queues.immediate],early:[...this.queues.early],mid:[...this.queues.mid],end:[...this.queues.end]}}clearQueues(){this.queues.immediate=[],this.queues.early=[],this.queues.mid=[],this.queues.end=[]}recordAnswer(e,t,s){const o=this.getAcquisitionProgress(e).currentQueue||"immediate";t?this.handleCorrectAnswer(e,o,s):this.handleWrongAnswer(e,o,s)}shouldEnqueueImmediate(e){return e>=3}shouldEnqueueEarly(e,t){return t.todayCorrectCount>=1}shouldEnqueueMid(e,t){return t.todayCorrectCount>=2}shouldEnqueueEnd(e,t){return t.todayCorrectCount>=3}calculateImmediateGap(e){return e>=4?1:e===3?2:3}calculateEarlyGap(e){return e>=4?5:e===3?7:10}calculateMidGap(e){return e>=4?20:e===3?25:30}isAcquisitionComplete(e,t){if(t.todayCorrectCount<t.dynamicThreshold)return!1;if(t.correctRate<Eb)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}% < ${(Eb*100).toFixed(0)}%`),!1;if(t.consecutiveCorrectStreak<rc)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): ÈÄ£Á∂öÊ≠£Á≠îÊï∞ ${t.consecutiveCorrectStreak} < ${rc}`),!1;const s=new Set(t.todayReviews.filter(i=>i.isCorrect).map(i=>i.queueType));if(s.size<3)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): „Ç≠„É•„ÉºÈÄöÈÅéÊï∞ ${s.size} < 3ÔºàÈñìÈöîÂèçÂæ©„Åå‰∏çË∂≥Ôºâ`),!1;if(t.totalAttempts<6)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Á∑èÂá∫È°åÂõûÊï∞ ${t.totalAttempts} < 6`),!1;const r=t.todayReviews.slice(-rc);return r.length>=rc&&r.every(i=>i.isCorrect)?(console.log(`‚úÖ ÂÆöÁùÄÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}%, ÈÄ£Á∂öÊ≠£Á≠î ${t.consecutiveCorrectStreak}, ÈñæÂÄ§ ${t.dynamicThreshold}, Á∑èÂá∫È°å ${t.totalAttempts}Âõû`),!0):(console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Áõ¥Ëøë${rc}Âõû„ÅåÂÖ®„Å¶Ê≠£Á≠î„Åß„ÅØ„Å™„ÅÑ`),!1)}isDuplicateInQueue(e,t){return this.queues[t].some(s=>s.word===e)}enqueueWithLimit(e,t,s){e.length>=s&&e.shift(),e.push(t)}removeFromQueue(e){const t=e.queueType,s=this.queues[t],r=s.findIndex(o=>o.word===e.word);r!==-1&&s.splice(r,1)}removeFromAllQueues(e){for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>s.word!==e)}findWordInQueues(e){for(const t of Object.keys(this.queues)){const s=this.queues[t].find(r=>r.word===e);if(s)return s}return null}cleanupExpiredEntries(){const e=Date.now();for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>e-s.enqueuedAt>hJ?(console.warn(`ÊúüÈôêÂàá„Çå„Ç®„É≥„Éà„É™„ÇíÂâäÈô§: ${s.word}`),!1):!0)}trackWordAttempts(e){this.wordAttempts.has(e)||this.wordAttempts.set(e,0);const t=this.wordAttempts.get(e)+1;this.wordAttempts.set(e,t);const s=this.getAcquisitionProgress(e);return t%50===0&&s.todayCorrectCount<s.dynamicThreshold&&(console.log(`üîÑ ÂçòË™û "${e}" „Çí${t}ÂõûÂá∫È°å„Åó„Åæ„Åó„ÅüÔºàÊ≠£Á≠îÁéá: ${(s.correctRate*100).toFixed(1)}%, ÈñæÂÄ§: ${s.dynamicThreshold}ÂõûÔºâ`),console.log("   ‚úÖ ÂÆöÁùÄ„Åæ„ÅßÁ∂ôÁ∂öÂá∫È°å„Åó„Åæ„ÅôÔºà‰∏çÊ≠£Ëß£„ÅåÁ∂ö„ÅèÈôê„ÇäÊ∞∏ÈÅ†„Å´Âá∫È°åÔºâ")),!0}calculateAverageWaitTime(e){if(e.length===0)return 0;const t=Date.now();return e.reduce((r,o)=>r+(t-o.enqueuedAt),0)/e.length}}const xJ={minEaseFactor:1.3,maxEaseFactor:2.5,easeFactorIncrement:.1,easeFactorDecrement:.2,initialInterval:1,forgettingCurveDecay:.5,confidenceWeight:.15};class yJ{constructor(e){me(this,"retentionData",new Map);me(this,"config");this.config={...xJ,...e}}getRetentionStatus(e){return this.retentionData.has(e)||this.retentionData.set(e,this.createInitialStatus()),this.retentionData.get(e)}recordReview(e,t){const s=this.getRetentionStatus(e);s.totalReviews++,s.lastReviewDate=t.timestamp,s.lastResponseTime=t.responseTime;const r=.3;return s.averageResponseTime=s.averageResponseTime*(1-r)+t.responseTime*r,t.isCorrect?(s.totalCorrect++,s.consecutiveCorrect++,s.consecutiveWrong=0,this.updateSM2OnCorrect(s,t.confidence)):(s.consecutiveCorrect=0,s.consecutiveWrong++,this.updateSM2OnWrong(s)),s.retentionRate=this.estimateRetentionRate(s),s.forgettingIndex=this.calculateForgettingIndex(s),s}getDueWords(e,t=Date.now()){const s=[];for(const r of e){const o=this.getRetentionStatus(r);if(t>=o.nextReviewDate){const a=(t-o.nextReviewDate)/864e5*o.forgettingIndex;s.push({word:r,priority:a})}}return s.sort((r,o)=>o.priority-r.priority),s.map(r=>r.word)}getReviewSchedule(e,t=7){const s=new Map,r=Date.now();for(const o of e){const i=this.getRetentionStatus(o),a=[];let c=i.nextReviewDate;const l=r+t*864e5;for(;c<=l;)a.push(new Date(c)),c+=i.sm2.interval*864e5;a.length>0&&s.set(o,a)}return s}getRetentionStatistics(e){const t=Date.now();let s=0,r=0,o=0,i=0,a=0,c=0;for(const d of e){const h=this.getRetentionStatus(d);s+=h.retentionRate,r+=h.sm2.easeFactor,o+=h.sm2.interval,t>=h.nextReviewDate&&(i++,(t-h.nextReviewDate)/864e5>1&&a++),h.consecutiveCorrect>=5&&h.sm2.interval>=30&&c++}const l=e.length||1;return{averageRetentionRate:s/l,averageEaseFactor:r/l,averageInterval:o/l,dueCount:i,overdueCount:a,wellLearnedCount:c}}estimateRetentionRate(e){const t=Date.now(),s=(t-e.lastReviewDate)/864e5,r=(e.nextReviewDate-t)/864e5;if(r>=0){const o=Math.exp(-this.config.forgettingCurveDecay*s/e.sm2.interval);return Math.max(.1,Math.min(1,o))}else{const o=-r,i=Math.exp(-this.config.forgettingCurveDecay*(s+o)/e.sm2.interval);return Math.max(.05,Math.min(.9,i))}}estimateRetentionRateAtTime(e,t){const s=(t-e.lastReviewDate)/864e5,r=(e.nextReviewDate-t)/864e5;if(r>=0){const a=Math.exp(-this.config.forgettingCurveDecay*Math.max(0,s)/e.sm2.interval);return Math.max(.1,Math.min(1,a))}const o=-r,i=Math.exp(-this.config.forgettingCurveDecay*(Math.max(0,s)+o)/e.sm2.interval);return Math.max(.05,Math.min(.9,i))}evaluateConsolidation(e,t=Date.now(),s=[1,7],r=[.5,.5]){const[o,i]=s,[a,c]=r,l=a+c||1,d=t+o*864e5,h=t+i*864e5,f=this.estimateRetentionRateAtTime(e,d),p=this.estimateRetentionRateAtTime(e,h),m=(f*a+p*c)/l;return{horizonsDays:s,retentionAtHorizon:{[o]:f,[i]:p},compositeRetention:m}}reset(){this.retentionData.clear()}importRetentionData(e){this.retentionData=new Map(e)}exportRetentionData(){return new Map(this.retentionData)}createInitialStatus(){return{lastReviewDate:Date.now(),nextReviewDate:Date.now()+this.config.initialInterval*864e5,sm2:{interval:this.config.initialInterval,repetition:0,easeFactor:2.5},retentionRate:1,forgettingIndex:1,totalReviews:0,totalCorrect:0,consecutiveCorrect:0,consecutiveWrong:0,averageResponseTime:0,lastResponseTime:0}}updateSM2OnCorrect(e,t){const s=e.sm2;s.repetition++;const r=this.mapConfidenceToQuality(t),o=s.easeFactor+(.1-(5-r)*(.08+(5-r)*.02));s.easeFactor=Math.max(this.config.minEaseFactor,Math.min(this.config.maxEaseFactor,o)),s.repetition===1?s.interval=1:s.repetition===2?s.interval=6:s.interval=Math.round(s.interval*s.easeFactor),e.lastResponseTime>3e3&&e.lastResponseTime>e.averageResponseTime*1.5&&(s.interval=Math.max(1,Math.round(s.interval*.8))),e.nextReviewDate=e.lastReviewDate+s.interval*864e5}updateSM2OnWrong(e){const t=e.sm2;t.repetition=0,t.easeFactor=Math.max(this.config.minEaseFactor,t.easeFactor-this.config.easeFactorDecrement),t.interval=1,e.nextReviewDate=e.lastReviewDate+t.interval*864e5}mapConfidenceToQuality(e){return Math.max(0,Math.min(5,e))}calculateForgettingIndex(e){const r=(e.totalReviews>0?1-e.totalCorrect/e.totalReviews:0)*2,o=e.averageResponseTime>2e3?(e.averageResponseTime-2e3)/5e3:0,i=Math.min(e.consecutiveWrong*.3,1.5),a=1+r+o+i;return Math.max(.5,Math.min(5,a))}}const bJ={minSampleSize:20,confidenceThreshold:.7,learningSpeedWindow:7,forgettingSpeedWindow:30},Db={learningSpeed:1,forgettingSpeed:1,consolidationThreshold:3,responseTimeProfile:{averageResponseTime:2e3,fastThreshold:1e3,slowThreshold:3e3,consistencyScore:.5},confidenceLevel:0,sampleSize:0,lastUpdated:Date.now()};class wJ{constructor(e){me(this,"config");me(this,"parameters");me(this,"historyCache",[]);this.config={...bJ,...e},this.parameters={...Db}}addHistory(e){this.historyCache.push(e),this.historyCache.length>100&&this.historyCache.shift()}estimateParameters(e){const t=e||this.historyCache;return t.length<this.config.minSampleSize?(this.parameters.sampleSize=t.length,this.parameters.confidenceLevel=0,{...this.parameters}):(this.parameters.learningSpeed=this.estimateLearningSpeed(t),this.parameters.forgettingSpeed=this.estimateForgettingSpeed(t),this.parameters.consolidationThreshold=this.estimateConsolidationThreshold(t),this.parameters.responseTimeProfile=this.estimateResponseTimeProfile(t),this.parameters.confidenceLevel=this.calculateConfidenceLevel(t.length),this.parameters.sampleSize=t.length,this.parameters.lastUpdated=Date.now(),{...this.parameters})}getParameters(){return{...this.parameters}}importParameters(e){this.parameters={...e}}clearHistory(){this.historyCache=[]}estimateLearningSpeed(e){const t=new Map,s=new Map;for(const i of e){const a=i.word;t.has(a)||t.set(a,0),t.set(a,t.get(a)+1),i.isCorrect&&!s.has(a)&&s.set(a,t.get(a))}const r=Array.from(s.values());if(r.length===0)return 1;const o=r.reduce((i,a)=>i+a,0)/r.length;return o<=2?1.8:o<=2.5?1.5:o<=3.5?1:o<=5?.7:.5}estimateForgettingSpeed(e){const t=new Map,s=[];for(const o of e){const i=o.word;if(o.isCorrect)t.set(i,o.timestamp);else if(t.has(i)){const a=t.get(i),c=(o.timestamp-a)/864e5;s.push(c),t.delete(i)}}if(s.length===0)return 1;const r=s.reduce((o,i)=>o+i,0)/s.length;return r>=7?.6:r>=5?.8:r>=3?1:r>=1?1.5:2}estimateConsolidationThreshold(e){const t=new Map,s=new Map,r=[];for(const i of e){const a=i.word;if(t.has(a)||(t.set(a,0),s.set(a,0)),i.isCorrect){const c=t.get(a)+1;t.set(a,c);const l=Math.max(s.get(a),c);s.set(a,l),c===5&&r.push(this.getWordTotalReviews(a,e))}else t.set(a,0)}if(r.length===0)return 3;const o=r.reduce((i,a)=>i+a,0)/r.length;return Math.max(2,Math.min(5,Math.round(o*.6)))}estimateResponseTimeProfile(e){const t=e.map(d=>d.responseTime);if(t.length===0)return Db.responseTimeProfile;const s=t.reduce((d,h)=>d+h,0)/t.length,r=t.reduce((d,h)=>d+Math.pow(h-s,2),0)/t.length,o=Math.sqrt(r),i=Math.max(500,s-o),a=Math.min(5e3,s+o),c=o/s,l=Math.max(0,Math.min(1,1-c));return{averageResponseTime:Math.round(s),fastThreshold:Math.round(i),slowThreshold:Math.round(a),consistencyScore:Math.round(l*100)/100}}calculateConfidenceLevel(e){return e<this.config.minSampleSize?0:e<50?(e-this.config.minSampleSize)/(50-this.config.minSampleSize)*.7:e<100?.7+(e-50)/50*.2:.9+Math.min((e-100)/200*.1,.1)}getWordTotalReviews(e,t){return t.filter(s=>s.word===e).length}}const Fk={acquisitionRatio:.6,retentionRatio:.4,adaptiveAdjustment:!0,sessionQuestionNumber:0};class vJ{constructor(e=Fk){me(this,"strategy");me(this,"personalParams",null);this.strategy={...e}}setPersonalParameters(e){this.personalParams=e}updateStrategy(e){this.strategy={...this.strategy,...e}}selectNextQuestion(e){if(e.length===0)return null;const t=e.map(r=>this.calculatePriority(r));t.sort((r,o)=>o.priority-r.priority);const s=t.find(r=>r.candidate.queueType!==void 0);return s?s.candidate:this.selectByStrategy(t)}calculatePriority(e){const t={queuePriority:this.calculateQueuePriority(e),phasePriority:this.calculatePhasePriority(e),timingPriority:this.calculateTimingPriority(e),personalPriority:this.calculatePersonalPriority(e)},s=Object.values(t).reduce((o,i)=>o+i,0),r=this.generatePriorityReason(e,t);return{candidate:e,priority:s,breakdown:t,reason:r}}calculateQueuePriority(e){if(!e.queueType)return 0;let s={[fc.IMMEDIATE]:40,[fc.EARLY]:30,[fc.MID]:20,[fc.END]:10}[e.queueType]||0;if(e.questionNumber!==void 0){const r=Math.max(0,5-e.questionNumber*.5);s+=r}return Math.min(40,s)}calculatePhasePriority(e){return{[la.ENCODING]:25,[la.INITIAL_CONSOLIDATION]:30,[la.INTRADAY_REVIEW]:20,[la.SHORT_TERM]:15,[la.LONG_TERM]:10}[e.phase]||0}calculateTimingPriority(e){const t=Date.now();if(e.reviewCount===0&&e.firstSeenTime){const o=(t-e.firstSeenTime)/1e3;return o>=600?15:o>=300?10:o>=120?7:o>=60?5:0}if(!e.nextReviewTime)return 15;const s=t-e.nextReviewTime;if(s>=0){const o=s/36e5;return Math.min(20,10+o*2)}const r=Math.abs(s)/(1e3*60*60);return r<=1?10-r*5:0}calculatePersonalPriority(e){if(!this.personalParams)return 5;let t=5;return e.reviewCount===0&&this.personalParams.learningSpeed<.8&&(t-=2),e.reviewCount===0&&this.personalParams.learningSpeed>1.2&&(t+=2),e.reviewCount>0&&this.personalParams.forgettingSpeed>1.2&&(t+=3),e.reviewCount>0&&this.personalParams.forgettingSpeed<.8&&(t-=2),Math.max(0,Math.min(10,t))}selectByStrategy(e){if(e.length===0)return null;const t=this.calculateAdaptiveBias(),s=e.map(c=>({...c,adjustedPriority:c.candidate.reviewCount===0?c.priority+t:c.priority})),r=s.filter(c=>c.adjustedPriority>=60),o=s.filter(c=>c.adjustedPriority>=30&&c.adjustedPriority<60),i=s.filter(c=>c.adjustedPriority<30),a=r.length>0?r:o.length>0?o:i;return a.length===0?null:(a.sort((c,l)=>{const d=l.adjustedPriority-c.adjustedPriority;if(Math.abs(d)>=5)return d;const h=c.candidate.lastReviewTime||c.candidate.firstSeenTime||0,f=l.candidate.lastReviewTime||l.candidate.firstSeenTime||0;return h===0&&f===0?c.candidate.word.localeCompare(l.candidate.word):h-f}),a[0].candidate)}hashString(e){let t=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}calculateAdaptiveBias(){if(!this.strategy.adaptiveAdjustment||this.strategy.sessionQuestionNumber===void 0)return 0;const e=this.strategy.sessionQuestionNumber;return e<=10?15:e<=20?10:e<=30?5:0}generatePriorityReason(e,t){const s=[];if(e.queueType&&s.push(`„Ç≠„É•„Éº: ${e.queueType}`),s.push(`„Éï„Çß„Éº„Ç∫: ${e.phase}`),e.nextReviewTime){const o=Date.now()-e.nextReviewTime,i=Math.abs(o/(1e3*60*60));o>=0?s.push(`ÈÅÖÂª∂: ${i.toFixed(1)}ÊôÇÈñì`):s.push(`‰∫àÂÆö„Åæ„Åß: ${i.toFixed(1)}ÊôÇÈñì`)}return e.reviewCount===0?s.push("Êñ∞Ë¶èÂçòË™û"):s.push(`Âæ©Áøí${e.reviewCount}ÂõûÁõÆ`),s.join(", ")}getAllPriorities(e){return e.map(t=>this.calculatePriority(t)).sort((t,s)=>s.priority-t.priority)}}function jb(n,e){return e?{word:n,reviewCount:e.correctCount+e.incorrectCount,correctCount:e.correctCount,wrongCount:e.incorrectCount,lastReviewTime:e.lastStudied||0,lastCorrectTime:e.consecutiveCorrect>0?e.lastStudied:0,averageResponseTime:e.averageResponseTime||0,consecutiveCorrect:e.consecutiveCorrect,consecutiveWrong:e.consecutiveIncorrect}:{word:n,reviewCount:0,correctCount:0,wrongCount:0,lastReviewTime:0,lastCorrectTime:0,averageResponseTime:0,consecutiveCorrect:0,consecutiveWrong:0}}function uf(n=Ja.MEMORIZATION,e){const t=N.useRef(null),s=N.useRef(null),r=N.useRef(null),o=N.useRef(null),i=N.useRef(null),a=N.useRef(null),[c,l]=N.useState(0),[d,h]=N.useState({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}});N.useEffect(()=>{j.info("[useAdaptiveLearning] Initializing adaptive learning algorithms",{category:n,sessionId:e}),t.current=new uJ,s.current=new gJ,r.current=new yJ,o.current=new wJ,i.current=new vJ({...Fk,sessionQuestionNumber:0});try{localStorage.getItem(`adaptive-learning-queues-${n}`)&&s.current&&j.debug("[useAdaptiveLearning] Restored queues from localStorage")}catch(x){j.error("[useAdaptiveLearning] Failed to restore queues:",x)}try{if(o.current){const x=o.current.estimateParameters();h(y=>({...y,personalParams:x})),i.current&&i.current.setPersonalParameters(x),j.info("[useAdaptiveLearning] Personal parameters estimated:",x)}}catch(x){j.error("[useAdaptiveLearning] Failed to estimate personal parameters:",x)}return()=>{try{if(s.current){const x=s.current.exportQueues();localStorage.setItem(`adaptive-learning-queues-${n}`,JSON.stringify(x)),j.debug("[useAdaptiveLearning] Saved queues to localStorage")}}catch(x){j.error("[useAdaptiveLearning] Failed to save queues:",x)}}},[n,e]);const f=N.useCallback(x=>{if(!i.current||!t.current||!s.current)return j.warn("[useAdaptiveLearning] Algorithms not initialized"),x.length>0?x[0]:null;try{const y=x.map(w=>{const v=gd(w.word),S=jb(w.word,v),C=t.current.detectPhase(w.word,S),k=s.current.getQueueInfo(w.word);return{id:w.word,word:w.word,category:n,phase:C,reviewCount:S.reviewCount,correctCount:S.correctCount,lastReviewTime:S.lastReviewTime||Date.now(),queueType:k==null?void 0:k.queueType,questionNumber:k==null?void 0:k.questionNumber,difficulty:parseInt(w.difficulty)||3}});i.current.updateStrategy({sessionQuestionNumber:c});const b=i.current.selectNextQuestion(y);if(b){const w=x.find(v=>v.word===b.word);return l(v=>v+1),h(v=>({...v,currentPhase:b.phase,sessionProgress:{totalQuestions:v.sessionProgress.totalQuestions+1,newWords:v.sessionProgress.newWords+(b.reviewCount===0?1:0),reviews:v.sessionProgress.reviews+(b.reviewCount>0?1:0)}})),j.debug("[useAdaptiveLearning] Selected question:",{word:b.word,phase:b.phase,queueType:b.queueType}),w||null}return null}catch(y){return j.error("[useAdaptiveLearning] Error selecting question:",y),x.length>0?x[0]:null}},[n,c]),p=N.useCallback((x,y,b)=>{try{const w=a.current??void 0;if(PQ({word:x,previousWord:w,isCorrect:y}),a.current=x,t.current){const v=gd(x),S=jb(x,v),C=t.current.detectPhase(x,S);h(k=>({...k,currentPhase:C}))}if(s.current){s.current.recordAnswer(x,y,b);const v=s.current.getQueueSizes();h(S=>({...S,queueSizes:v}))}if(r.current&&r.current.recordReview(x,{isCorrect:y,confidence:y?3:1,responseTime:b,timestamp:Date.now()}),o.current&&(o.current.addHistory({word:x,timestamp:Date.now(),isCorrect:y,responseTime:b,reviewNumber:1,daysSinceFirstSeen:0}),c>0&&c%20===0)){const v=o.current.estimateParameters();h(S=>({...S,personalParams:v})),i.current&&i.current.setPersonalParameters(v),j.info("[useAdaptiveLearning] Personal parameters updated:",v)}j.debug("[useAdaptiveLearning] Recorded answer:",{word:x,isCorrect:y,responseTime:b})}catch(w){j.error("[useAdaptiveLearning] Error recording answer:",w)}},[c]),m=N.useCallback(()=>{j.info("[useAdaptiveLearning] Resetting adaptive learning algorithms"),l(0),a.current=null,h({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}}),s.current&&s.current.clearQueues(),o.current&&o.current.clearHistory()},[]),g=N.useCallback(()=>{var x;return{sessionQuestionCount:c,state:d,queues:((x=s.current)==null?void 0:x.exportQueues())||null,personalParams:d.personalParams}},[c,d]);return{selectNextQuestion:f,recordAnswer:p,state:d,reset:m,getDebugInfo:g}}const Ok={correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0,still_learning:0,total:0};function SJ(n){try{const e=`session-stats-${n}`,t=localStorage.getItem(e);if(t)return JSON.parse(t)}catch(e){console.error(`[useSessionStats] ${n} „ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:`,e)}return{...Ok}}function _b(n,e){try{const t=`session-stats-${n}`;localStorage.setItem(t,JSON.stringify(e))}catch(t){console.error(`[useSessionStats] ${n} „ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:`,t)}}function eu(n="translation"){const[e,t]=N.useState(()=>SJ(n));return N.useEffect(()=>{_b(n,e)},[n,e]),{sessionStats:e,setSessionStats:t,resetStats:()=>{const o={...Ok};t(o),_b(n,o)},updateStats:o=>{t(i=>({...i,correct:i.correct+(o==="correct"?1:0),incorrect:i.incorrect+(o==="incorrect"?1:0),review:i.review+(o==="review"?1:0),mastered:i.mastered+(o==="mastered"?1:0)}))}}}function CJ({quizState:n,_categoryList:e,selectedCategory:t,onCategoryChange:s,selectedDifficulty:r,onDifficultyChange:o,selectedWordPhraseFilter:i="all",onWordPhraseFilterChange:a,selectedPhraseTypeFilter:c="all",onPhraseTypeFilterChange:l,selectedDataSource:d="all",onDataSourceChange:h,questionSets:f=[],onStartQuiz:p,onAnswer:m,onNext:g,onPrevious:x,onSkip:y,onDifficultyRate:b,onReviewFocus:w,isReviewFocusMode:v=!1,errorPrediction:S,customQuestionSets:C=[],onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:A}){var re,ne;const{questions:T,currentIndex:E,answered:$,selectedAnswer:D}=n,M=T.length>0,P=M?T[E]:null,[L,O]=N.useState(!1),[F,V]=N.useState(!1),[G,_]=N.useState(!1),{sessionStats:Z,resetStats:te}=eu("translation"),[he,oe]=N.useState(Date.now()),[ve,$e]=N.useState(void 0),[Ae,De]=N.useState(void 0),[we,Re]=N.useState(0),[et,je]=N.useState(0),lt=uf(Ja.TRANSLATION),[ht,it]=N.useState(()=>{const B=localStorage.getItem("translation-batch-size");return B?parseInt(B):null}),[st,Ye]=N.useState(()=>{const B=localStorage.getItem("translation-incorrect-limit");return B?parseInt(B):20}),[pt,Tt]=N.useState(()=>localStorage.getItem("autoNext")==="true"),[se,Ge]=N.useState(()=>{const B=localStorage.getItem("autoNextDelay");return B?parseInt(B,10):1500}),[ze,Nt]=N.useState(()=>localStorage.getItem("autoShowDetails")!=="false"),[sn,Ht]=N.useState(()=>localStorage.getItem("autoShowDetailsOnCorrect")==="true"),[Fe,ge]=N.useState(()=>localStorage.getItem("autoPlayAudio")==="true");N.useEffect(()=>{if(Fe&&P&&!$){const B=setTimeout(()=>{try{kr(P.word,{rate:.85})}catch(z){j.error("[TranslationView] Ëá™ÂãïÁô∫Èü≥Â§±Êïó",z)}},300);return()=>clearTimeout(B)}},[P,Fe,$]);const Pe=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:B}=await On(async()=>{const{resetAllProgress:z}=await Promise.resolve().then(()=>wi);return{resetAllProgress:z}},void 0);await B(),te(),j.info("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(B){j.error("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",B),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},{getRequeuedWords:tt}=Jl(),vt=()=>{_(!0)},Yt=async(B,z)=>{const le=B===z;$e(le),De(P==null?void 0:P.word),le?(Re(ee=>ee+1),je(0)):(je(ee=>ee+1),Re(0)),await m(B,z),oe(Date.now()),P!=null&&P.word&&lt.recordAnswer(P.word,le,3e3),pt&&le&&setTimeout(()=>{De(void 0),g()},se)},gn=()=>{De(void 0),g()},jt=async()=>{y&&(await y(),oe(Date.now()))},hn=localStorage.getItem("learning-schedule-90days"),un=!!hn;let Et=null;if(un)try{const B=JSON.parse(hn),z=Math.floor((Date.now()-B.startDate)/(1e3*60*60*24)),le=Math.min(z+1,B.totalDays),ee=Math.round(le/B.totalDays*100);Et={currentDay:le,totalDays:B.totalDays,progressPercent:ee,phase:B.phase}}catch(B){j.error("Failed to parse learning plan:",B)}const q=()=>{V(!F)};return F&&M&&P?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:q,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4",children:u.jsx(Gp,{question:P,questionNumber:E+1,allQuestions:T,currentIndex:E,answered:$,selectedAnswer:D,onAnswer:Yt,onNext:y?$?gn:jt:gn,onPrevious:x,onDifficultyRate:b,errorPrediction:S,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:A,onFullscreen:q})})]})}):u.jsxs("div",{className:"quiz-view",children:[un&&Et&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[Et.currentDay,"Êó•ÁõÆ / ",Et.totalDays,"Êó• (Phase ",Et.phase,") -"," ",Et.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),M&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Zl,{mode:"translation",currentScore:n.score,totalAnswered:n.totalAnswered,sessionCorrect:Z==null?void 0:Z.correct,sessionIncorrect:Z==null?void 0:Z.incorrect,sessionReview:Z==null?void 0:Z.review,sessionMastered:Z==null?void 0:Z.mastered,onReviewFocus:w,isReviewFocusMode:v,onShowSettings:()=>O(!0),currentWord:P==null?void 0:P.word,onAnswerTime:he,lastAnswerCorrect:ve,lastAnswerWord:Ae,lastAnswerDifficulty:P==null?void 0:P.difficulty,correctStreak:we,incorrectStreak:et,learningPhase:lt.state.currentPhase??void 0,estimatedSpeed:(re=lt.state.personalParams)==null?void 0:re.learningSpeed,dataSource:((ne=f==null?void 0:f.find(B=>B.id===d))==null?void 0:ne.name)||"ÂÖ®ÂïèÈ°åÈõÜ",onResetProgress:Pe,onDebugRequeue:vt,category:t==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":t,difficulty:r,wordPhraseFilter:i})})}),L&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),h&&f&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-quiz",children:"üìö Âá∫È°åÂÖÉ:"}),u.jsx("select",{id:"data-source-select-quiz",value:d,onChange:B=>h(B.target.value),className:"select-input",children:f.map(B=>u.jsx("option",{value:B.id,children:B.name},B.id))})]}),a&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-quiz",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-quiz",value:i,onChange:B=>a(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-quiz",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-quiz",value:t,onChange:B=>s(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),Kk.map(B=>u.jsx("option",{value:B,children:B},B))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-quiz",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-quiz",value:r,onChange:B=>o(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),l&&i==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-quiz",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-quiz",value:c,onChange:B=>l(B.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"batch-size-select-quiz",children:"üìä „Éê„ÉÉ„ÉÅÊï∞:"}),u.jsxs("select",{id:"batch-size-select-quiz",value:ht||0,onChange:B=>{const z=parseInt(B.target.value),le=z===0?null:z;it(le),le===null?localStorage.removeItem("translation-batch-size"):localStorage.setItem("translation-batch-size",le.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:200,children:"200"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"incorrect-limit-select-quiz",children:"‚ö†Ô∏è ‰∏çÊ≠£Ëß£„ÅÆ‰∏äÈôê:"}),u.jsxs("select",{id:"incorrect-limit-select-quiz",value:st,onChange:B=>{const z=parseInt(B.target.value);Ye(z),localStorage.setItem("translation-incorrect-limit",z.toString())},className:"select-input",children:[u.jsx("option",{value:10,children:"10%"}),u.jsx("option",{value:20,children:"20%"}),u.jsx("option",{value:30,children:"30%"}),u.jsx("option",{value:40,children:"40%"}),u.jsx("option",{value:50,children:"50%"})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle",checked:pt,onChange:B=>{Tt(B.target.checked),localStorage.setItem("autoNext",B.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",pt?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),pt&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay",min:"500",max:"3000",step:"100",value:se,onChange:B=>{const z=parseInt(B.target.value,10);Ge(z),localStorage.setItem("autoNextDelay",z.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(se/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-toggle",checked:ze,onChange:B=>{Nt(B.target.checked),localStorage.setItem("autoShowDetails",B.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-show-details-toggle",className:"checkbox-label",children:["‰∏çÊ≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",ze?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-correct-toggle",checked:sn,onChange:B=>{Ht(B.target.checked),localStorage.setItem("autoShowDetailsOnCorrect",B.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-show-details-correct-toggle",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",sn?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-play-audio-toggle",checked:Fe,onChange:B=>{ge(B.target.checked),localStorage.setItem("autoPlayAudio",B.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-play-audio-toggle",className:"checkbox-label",children:["Ëá™Âãï„ÅßÁô∫Èü≥„Åô„ÇãÔºö",Fe?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:q,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),P&&u.jsx(u.Fragment,{children:u.jsx(Gp,{question:P,questionNumber:E+1,allQuestions:T,currentIndex:E,answered:$,selectedAnswer:D,onAnswer:Yt,onNext:y?$?gn:jt:gn,onPrevious:x,onDifficultyRate:b,errorPrediction:S,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:A})})]})})})]}),G&&u.jsx(bx,{mode:"translation",currentIndex:E,totalQuestions:T.length,questions:T,requeuedWords:tt(T,E)})]})}function NJ(n){const[e,t]=N.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""}),[s,r]=N.useState([]),[o,i]=N.useState([]),[a,c]=N.useState([]),[l,d]=N.useState(0),[h,f]=N.useState([]),p=N.useRef(0);return N.useEffect(()=>{n.length>0&&t({questions:n,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""})},[n]),N.useEffect(()=>{if(e.questions.length>0){const v=e.questions[e.currentIndex].word.toLowerCase();if(v.includes(" ")){const S=v.split(/\s+/);c(S),d(0),f([]);const k=[...S[0].split("")].sort(()=>Math.random()-.5);r(k),t(I=>({...I,correctWord:v.replace(/\s+/g,""),answered:!1}))}else{c([]),d(0),f([]);const C=[...v.split("")].sort(()=>Math.random()-.5);r(C),t(k=>({...k,correctWord:v,answered:!1}))}i([]),p.current=Date.now()}},[e.currentIndex,e.questions]),{spellingState:e,setSpellingState:t,shuffledLetters:s,selectedSequence:o,setSelectedSequence:i,phraseWords:a,currentWordIndex:l,completedWords:h,handleLetterClick:w=>{if(e.answered){if(o.includes(`${w}`))i(o.filter(S=>S!==`${w}`));else{const S=[...o,`${w}`];i(S)}return}if(o.includes(`${w}`))return;const v=[...o,`${w}`];return i(v),v.length===s.length?v:null},checkAnswer:w=>{const v=w.map(C=>s[parseInt(C)]).join(""),S=Date.now()-p.current;if(a.length>0){const C=a[l];if(v===C){const I=[...h,v];if(f(I),l<a.length-1){const A=l+1;d(A);const E=[...a[A].split("")].sort(()=>Math.random()-.5);return r(E),i([]),{isPartialCorrect:!0,isComplete:!1,userWord:v,responseTime:S}}else{const A=I.join("");return{isPartialCorrect:!0,isComplete:!0,isCorrect:A===e.correctWord,userWord:A,responseTime:S}}}else return{isPartialCorrect:!1,isComplete:!0,isCorrect:!1,userWord:[...h,v].join(""),responseTime:S}}else return{isComplete:!0,isCorrect:v===e.correctWord,userWord:v,responseTime:S}},moveToNextQuestion:()=>{t(w=>({...w,currentIndex:w.currentIndex+1,answered:!1}))},updateScore:w=>{t(v=>({...v,score:w?v.score+1:v.score,totalAnswered:v.totalAnswered+1,answered:!0}))},resetAnswer:()=>{if(i([]),t(w=>({...w,answered:!1})),a.length>0){const v=[...a[l].split("")].sort(()=>Math.random()-.5);r(v)}else{const S=[...e.questions[e.currentIndex].word.toLowerCase().split("")].sort(()=>Math.random()-.5);r(S)}p.current=Date.now()}}}function IJ({questions:n,questionSets:e,_categoryList:t,selectedCategory:s,onCategoryChange:r,selectedDifficulty:o,onDifficultyChange:i,selectedWordPhraseFilter:a="all",onWordPhraseFilterChange:c,selectedPhraseTypeFilter:l="all",onPhraseTypeFilterChange:d,selectedDataSource:h="all",onDataSourceChange:f,onStartQuiz:p,onReviewFocus:m,isReviewFocusMode:g=!1,customQuestionSets:x=[],onAddWordToCustomSet:y,onRemoveWordFromCustomSet:b,onOpenCustomSetManagement:w}){var at,Bt,Vt,Be;const v=(()=>{try{const ae=localStorage.getItem("spelling-batch-size");return ae?parseInt(ae):null}catch{return null}})(),S=(()=>{try{const ae=localStorage.getItem("spelling-review-ratio-limit");return ae?parseInt(ae):20}catch{return 20}})(),[C,k]=N.useState([]),{spellingState:I,setSpellingState:A,shuffledLetters:T,selectedSequence:E,setSelectedSequence:$,phraseWords:D,completedWords:M,handleLetterClick:P,checkAnswer:L,moveToNextQuestion:O,updateScore:F}=NJ(C),{sessionStats:V,setSessionStats:G,resetStats:_,updateStats:Z}=eu("spelling"),te=uf(Ja.SPELLING),{processQuestion:he}=lf(),oe=async(ae,Ce)=>{try{const U=()=>{const Se=new Date().getHours();return Se<12?"morning":Se<18?"afternoon":Se<22?"evening":"night"},ue=()=>{const Se=I.questions[I.currentIndex];if(!Se)return .5;const ft=(Se.grade||1)/9;return Math.min(Math.max(ft,0),1)},Me=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(ft=>!ft.correct).length,qe=()=>{const Se=sessionStorage.getItem("sessionStartTime");return Se?Math.floor((Date.now()-parseInt(Se))/6e4):0},Oe=()=>ge,_e=await he(ae,Ce?"correct":"incorrect",{currentDifficulty:ue(),timeOfDay:U(),recentErrors:Me(),sessionLength:qe(),consecutiveCorrect:Oe()});console.log("[AdaptiveAI]",_e.reason,{strategy:_e.strategy,confidence:_e.confidence})}catch(U){console.error("[SpellingView] Adaptive AI error:",U)}},[ve]=N.useState(()=>{const ae=new $s;return localStorage.getItem("enable-ai-coordination")==="true"&&j.info("ü§ñ [SpellingView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü"),ae}),{reAddQuestion:$e,clearExpiredFlags:Ae,updateRequeueStats:De,getRequeuedWords:we,checkPositionMismatch:Re}=Jl(),[et,je]=N.useState(!1),[lt,ht]=N.useState(!1),[it,st]=N.useState(!1),[Ye,pt]=N.useState(Date.now()),[Tt,se]=N.useState(0),[Ge,ze]=N.useState(!1),[Nt,sn]=N.useState(void 0),[Ht,Fe]=N.useState(void 0),[ge,Pe]=N.useState(0),[tt,vt]=N.useState(0),[Yt,gn]=N.useState(()=>localStorage.getItem("autoNext")==="true"),[jt,hn]=N.useState(()=>{const ae=localStorage.getItem("autoNextDelay");return ae?parseInt(ae,10):1500}),un=N.useRef(null),Et=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:ae}=await On(async()=>{const{resetAllProgress:Ce}=await Promise.resolve().then(()=>wi);return{resetAllProgress:Ce}},void 0);await ae(),_(),Pe(0),vt(0),console.log("‚úÖ [„Çπ„Éö„É´„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(ae){console.error("‚ùå [„Çπ„Éö„É´„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",ae),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},q=()=>{st(!0)},re=N.useRef(0),ne=N.useRef(0),B=N.useRef([]);N.useEffect(()=>{(async()=>{if(n.length===0){k([]);return}re.current=Date.now(),B.current=[],_();const Ce=await ve.schedule({questions:n,mode:"spelling",useCategorySlots:!0,sessionStats:{correct:V.correct,incorrect:V.incorrect,still_learning:0,mastered:V.mastered||0,duration:Date.now()-re.current},isReviewFocusMode:g||!1}),U=Ce.scheduledQuestions;Ce.vibrationScore>50&&j.warn("[SpellingView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:Ce.vibrationScore,processingTime:Ce.processingTime}),k(U),se(0),ze(!1),j.log("[SpellingView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:U.length,vibrationScore:Ce.vibrationScore})})()},[n,g,ve]),N.useEffect(()=>{if(!Ge||I.questions.length===0)return;const ae=I.currentIndex;(async()=>{try{const U=I.questions.slice(ae);if(U.length===0){ze(!1);return}j.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:Tt,currentIndex:ae,remaining:U.length});const ue=await ve.schedule({questions:U,mode:"spelling",useCategorySlots:!0,sessionStats:{correct:V.correct,incorrect:V.incorrect,still_learning:0,mastered:V.mastered||0,duration:Date.now()-re.current},isReviewFocusMode:g||!1});A(Me=>Me.currentIndex!==ae?Me:{...Me,questions:[...Me.questions.slice(0,ae),...ue.scheduledQuestions]}),se(0),ze(!1),j.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:ue.scheduledQuestions.length})}catch(U){j.error("[SpellingView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",U),ze(!1)}})()},[Ge,I.currentIndex,I.questions,ve,V,g,Tt]),N.useEffect(()=>{if(!I.answered&&un.current){const ae=setTimeout(()=>{var Ce;(Ce=un.current)==null||Ce.focus()},100);return()=>clearTimeout(ae)}},[I.answered,I.currentIndex,I.questions.length]);const z=(ae,Ce)=>{const U=P(Ce);U&&U.length===T.length&&setTimeout(()=>le(U),300)},le=async ae=>{const Ce=L(ae);Ce&&(Ce.isPartialCorrect&&!Ce.isComplete||Ce.isComplete&&await ee(Ce.userWord,Ce.isCorrect||!1,Ce.responseTime))},ee=async(ae,Ce,U)=>{var Oe;const ue=I.questions[I.currentIndex];sn(Ce),Fe(ue.word),Ce?(Pe(_e=>_e+1),vt(0)):(vt(_e=>_e+1),Pe(0));const Me=Ce?0:tt+1;if(!Ge&&Me>=5&&ze(!0),ue){await Wo(ue.word,Ce,U,void 0,"spelling"),pt(Date.now()),te.recordAnswer(ue.word,Ce,U),await oe(ue.word,Ce);const Se=(Oe=(await bs()).wordProgress)==null?void 0:Oe[ue.word];let ft=Ce?"correct":"incorrect";Se&&Se.masteryLevel==="mastered"?ft="mastered":!Ce&&Se&&Se.incorrectCount>=2&&(ft="review"),Z(ft),_a({status:ft,word:ue.word,timestamp:Date.now()},"spelling"),Se&&Se.skippedCount&&Se.skippedCount>0&&(Ce?kk(ue.word):Ik(ue.word))}!Ce&&ue&&B.current.push(ue.word);let qe=I.questions;if(!Ce&&ue){const _e=$e(ue,I.questions,I.currentIndex,"spelling",{outcome:"incorrect"});qe=_e,_e!==I.questions&&A(Se=>({...Se,questions:_e}))}if(se(_e=>{const Se=_e+1;return Se>=50?(ze(!0),0):(Se%10===0&&Re(qe,"spelling").needsRescheduling&&ze(!0),Se)}),ue){const _e=String(ue.word);oo.onShown(_e),oo.onAnswer(_e,Ce),De(ue,V,G)}F(Ce),ue&&Dc({id:Sd(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:Ce?1:0,total:1,percentage:Ce?100:0,date:Date.now(),timeSpent:Math.floor(U/1e3),incorrectWords:Ce?[]:[ue.word],mode:"spelling"})},be=()=>{const ae=I.currentIndex+1;if(ae<I.questions.length){const Ce=Ae(I.questions,ae-1);Ce!==I.questions&&A(U=>({...U,questions:Ce}))}if(ae>=I.questions.length&&!window.location.hostname.includes("github.io"))try{const Ce=oo.summarize();j.log("üß™ KPI Summary (spelling):",Ce)}catch{}Fe(void 0),ae<I.questions.length?O():A(Ce=>({...Ce,answered:!1}))},He=async()=>{const ae=I.questions[I.currentIndex];if(!ae)return;if(I.answered){be();return}const Ce=Date.now()-ne.current;console.log("[SpellingView] SkipÂá¶ÁêÜÈñãÂßã:",{word:ae.word,responseTime:Ce,currentScore:I.score,totalAnswered:I.totalAnswered}),sn(!0),Fe(ae.word),Pe(U=>U+1),vt(0),of(ae.word,30),Nk(ae.word),await Wo(ae.word,!0,Ce,void 0,"spelling"),pt(Date.now()),$([]),A(U=>({...U,totalAnswered:U.totalAnswered+1,score:U.score+1,answered:!1})),Z("correct"),Z("mastered"),_a({status:"correct",word:ae.word,timestamp:Date.now()},"spelling"),console.log("[SpellingView] SkipÂá¶ÁêÜÂÆå‰∫Ü:",{word:ae.word,newScore:I.score+1,newTotalAnswered:I.totalAnswered+1}),Dc({id:Sd(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:1,total:1,percentage:100,date:Date.now(),timeSpent:Math.floor(Ce/1e3),incorrectWords:[],mode:"spelling",difficulty:ae.difficulty}),be(),se(U=>{const ue=U+1;return ue>=50?(ze(!0),0):(ue%10===0&&Re(I.questions,"spelling").needsRescheduling&&ze(!0),ue)})},Qe=()=>{$([]),A(ae=>({...ae,currentIndex:ae.currentIndex>0?ae.currentIndex-1:0,answered:!1})),ne.current=Date.now()},ke=()=>{if(E.length>0){const ae=E.slice(0,-1);$(ae)}},xe=I.questions.length>0,K=xe?I.questions[I.currentIndex]:null,pe=E.map(ae=>T[parseInt(ae)]).join(""),Ne=K?{word:K.word,meaning:K.meaning,katakana:K.reading,source:"spelling"}:null,Xe=localStorage.getItem("learning-schedule-90days"),dt=!!Xe;let rt=null;if(dt)try{const ae=JSON.parse(Xe),Ce=Math.floor((Date.now()-ae.startDate)/(1e3*60*60*24)),U=Math.min(Ce+1,ae.totalDays),ue=Math.round(U/ae.totalDays*100);rt={currentDay:U,totalDays:ae.totalDays,progressPercent:ue,phase:ae.phase}}catch(ae){j.error("Failed to parse learning plan:",ae)}return u.jsxs("div",{className:"spelling-view",children:[dt&&rt&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[rt.currentDay,"Êó•ÁõÆ / ",rt.totalDays,"Êó• (Phase ",rt.phase,") -"," ",rt.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),!xe&&u.jsx("div",{className:"quiz-controls",children:u.jsx("button",{onClick:p,className:"w-64 px-8 py-4 text-lg font-bold bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-xl:bg-primary-hover",children:"üéØ „ÇØ„Ç§„Ç∫ÈñãÂßã"})}),xe?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Zl,{mode:"spelling",currentScore:I.score,totalAnswered:I.totalAnswered,sessionCorrect:V.correct,sessionIncorrect:V.incorrect,sessionReview:V.review,sessionMastered:V.mastered,onReviewFocus:m,isReviewFocusMode:g,onShowSettings:()=>je(!0),onResetProgress:Et,onDebugRequeue:q,currentWord:(at=I.questions[I.currentIndex])==null?void 0:at.word,onAnswerTime:Ye,lastAnswerCorrect:Nt,lastAnswerWord:Ht,lastAnswerDifficulty:(Bt=I.questions[I.currentIndex])==null?void 0:Bt.difficulty,correctStreak:ge,incorrectStreak:tt,learningPhase:te.state.currentPhase??void 0,estimatedSpeed:(Vt=te.state.personalParams)==null?void 0:Vt.learningSpeed,dataSource:((Be=e==null?void 0:e.find(ae=>ae.id===h))==null?void 0:Be.name)||"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà",category:s==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":s,difficulty:o,wordPhraseFilter:a})})}),et&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>je(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 text-sm shadow-sm:bg-gray-600:border-gray-500",children:"‚úï Èñâ„Åò„Çã"})]}),f&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-spelling",children:"üìö ÂïèÈ°åÈõÜ:"}),u.jsx("select",{id:"data-source-select-spelling",value:h,onChange:ae=>f(ae.target.value),className:"select-input",children:e&&e.length>0?e.map(ae=>u.jsx("option",{value:ae.id,children:ae.name},ae.id)):u.jsxs(u.Fragment,{children:[u.jsx("option",{value:"all",children:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà"}),u.jsx("option",{value:"intermediate",children:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ"}),u.jsx("option",{value:"junior",children:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö"})]})})]}),c&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-spelling",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-spelling",value:a,onChange:ae=>c(ae.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-spelling",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-spelling",value:s,onChange:ae=>r(ae.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),Kk.map(ae=>u.jsx("option",{value:ae,children:ae},ae))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-spelling",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-spelling",value:o,onChange:ae=>i(ae.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),d&&a==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-spelling",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-spelling",value:l,onChange:ae=>{d&&d(ae.target.value)},className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsxs("div",{className:"filter-group filter-group--section",children:[u.jsx("label",{htmlFor:"spelling-batch-size",children:"üì¶ „Éê„ÉÉ„ÉÅÊï∞:"}),u.jsxs("select",{id:"spelling-batch-size",value:v??"",onChange:ae=>{const Ce=ae.target.value===""?null:parseInt(ae.target.value);try{Ce===null?localStorage.removeItem("spelling-batch-size"):localStorage.setItem("spelling-batch-size",String(Ce)),window.location.reload()}catch{}},className:"select-input",children:[u.jsx("option",{value:"",children:"Âà∂Èôê„Å™„Åó"}),u.jsx("option",{value:"10",children:"10Âïè"}),u.jsx("option",{value:"20",children:"20Âïè"}),u.jsx("option",{value:"30",children:"30Âïè"}),u.jsx("option",{value:"50",children:"50Âïè"}),u.jsx("option",{value:"100",children:"100Âïè"}),u.jsx("option",{value:"200",children:"200Âïè"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"spelling-review-ratio-limit",children:"‚ùå ‰∏çÊ≠£Ëß£„ÅÆ‰∏äÈôê:"}),u.jsxs("select",{id:"spelling-review-ratio-limit",value:S,onChange:ae=>{const Ce=parseInt(ae.target.value);try{localStorage.setItem("spelling-review-ratio-limit",String(Ce)),window.location.reload()}catch{}},className:"select-input",children:[u.jsx("option",{value:"10",children:"10%"}),u.jsx("option",{value:"20",children:"20%"}),u.jsx("option",{value:"30",children:"30%"}),u.jsx("option",{value:"40",children:"40%"}),u.jsx("option",{value:"50",children:"50%"})]})]})]}),K&&u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>ht(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row meaning-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:Qe,disabled:I.currentIndex===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"meaning-display",children:[u.jsxs("div",{className:"meaning-line",children:[u.jsx("span",{className:"text-xl text-gray-600",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"text-4xl font-bold text-gray-900 ml-2",children:K.meaning})]}),u.jsxs("div",{className:"meaning-meta",children:[K.difficulty&&u.jsx("div",{className:`difficulty-badge ${K.difficulty}`,children:K.difficulty==="beginner"?"ÂàùÁ¥ö":K.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),Ne&&y&&b&&w&&x&&u.jsx("div",{className:"mt-3 flex justify-center",children:u.jsx(xc,{word:Ne,sets:x,onAddWord:y,onRemoveWord:b,onOpenManagement:w,size:"medium",variant:"both"})}),K.word.includes(" ")&&u.jsxs("div",{className:"phrase-hint",children:["üí° ÁÜüË™û(",D.length,"Ë™û): ÂçòË™û„Åî„Å®„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",M.length>0&&u.jsxs("span",{className:"phrase-progress",children:[" ","(ÂÆåÊàê: ",M.join(" "),")"]})]})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:I.answered?be:He,disabled:I.currentIndex>=I.questions.length-1,title:I.answered?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó",children:"‚Üí"})]}),u.jsx("div",{className:"question-content-inline",children:u.jsxs("div",{className:"user-word-display",children:[u.jsx("div",{className:"user-word-label",children:"„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà:"}),u.jsx("div",{className:"user-word-text",children:D.length>0?u.jsxs(u.Fragment,{children:[M.join(" "),M.length>0&&" ",pe||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"]}):pe||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"})]})}),u.jsx("div",{className:"letter-cards",ref:un,tabIndex:0,onKeyDown:ae=>{if(I.answered)ae.key==="Enter"&&(ae.preventDefault(),be());else{const Ce=ae.key.toLowerCase();if(Ce.length===1&&Ce>="a"&&Ce<="z"){ae.preventDefault();const U=T.findIndex((ue,Me)=>ue===Ce&&!E.includes(`${Me}`));U!==-1&&z(Ce,U)}else ae.key==="Backspace"?(ae.preventDefault(),ke()):(ae.key===" "||ae.key==="Enter")&&(ae.preventDefault(),He())}},children:T.map((ae,Ce)=>{const U=E.includes(`${Ce}`),ue=E.indexOf(`${Ce}`)+1;let Me="";return I.answered&&U&&(Me=E.map(_e=>T[parseInt(_e)]).join("")===I.correctWord?"correct":"incorrect"),u.jsxs("button",{className:`letter-card ${U?"selected":""} ${I.answered?"practice-mode":""} ${Me}`,onClick:()=>z(ae,Ce),children:[ae,U&&u.jsx("span",{className:"selection-number",children:ue})]},Ce)})}),!I.answered&&u.jsxs("div",{className:"spelling-reset-button-container",children:[E.length>0&&u.jsx("button",{className:"btn-reset-selection",onClick:ke,children:"‚å´ 1ÊñáÂ≠óÊàª„Åô"}),u.jsx("button",{className:"btn-skip-word",onClick:He,children:"‚è≠Ô∏è ÂàÜ„Åã„Çâ„Å™„ÅÑ („Çπ„Éö„Éº„Çπ„Ç≠„Éº)"})]}),I.answered&&u.jsxs("div",{className:"result-display",children:[u.jsxs("div",{className:"correct-answer",children:[pe===I.correctWord?"‚úÖ Ê≠£Ëß£: ":pe===""?"‚è≠Ô∏è „Çπ„Ç≠„ÉÉ„Éó - Ê≠£Ëß£: ":"‚ùå ‰∏çÊ≠£Ëß£ - Ê≠£Ëß£: ",u.jsxs("strong",{className:kn()?"clickable-word":"",onClick:ae=>{ae.stopPropagation(),kn()&&K&&kr(K.word,{rate:.85})},title:kn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":void 0,children:[(K==null?void 0:K.word)||I.correctWord,kn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"}),(K==null?void 0:K.reading)&&u.jsxs("span",{className:"pronunciation-hint",children:["(",K.reading,")"]})]})]}),u.jsxs("div",{className:"question-details-spelling",children:[K.reading&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>kn()&&kr(K.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-content",children:K.reading})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-content",children:K.meaning})]}),K.etymology&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠âËß£Ë™¨:"}),u.jsx("span",{className:"detail-content",children:K.etymology})]}),K.relatedWords&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-content",children:K.relatedWords})]}),K.relatedFields&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsx("span",{className:"detail-content",children:K.relatedFields})]}),K.difficulty&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>kn()&&kr(K.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("div",{className:`difficulty-badge ${K.difficulty}`,children:K.difficulty==="beginner"?"ÂàùÁ¥ö":K.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]})]})]})]})]}):u.jsx("div",{className:"empty-state",children:u.jsx("p",{children:"üìñ Êù°‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Äå„ÇØ„Ç§„Ç∫ÈñãÂßã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})}),it&&u.jsx(bx,{mode:"spelling",currentIndex:I.currentIndex,totalQuestions:I.questions.length,questions:I.questions,requeuedWords:we(I.questions,I.currentIndex)})]})}function Pb(n){return n.toLowerCase().replace(/[\s.,?!]+/g," ").trim()}async function Lk(n){try{const e=await fetch(`/data/passage-parses/${n}.json`);return e.ok?await e.json():null}catch(e){return j.warn(`[UD] Failed to load dependency parse for ${n}:`,e),null}}function oee(n,e){const t=Pb(e),s=n.sentences.find(i=>Pb(i.text)===t);if(s)return s;const r=e.toLowerCase().replace(/\s+/g," ").trim();return n.sentences.find(i=>i.text.toLowerCase().replace(/\s+/g," ").trim()===r)??null}const wx="< < < ASTERISK > > >";function kJ(n){return n.split(/\r?\n\s*\r?\n/g).map(e=>e.replace(/\r?\n/g," ").trim()).filter(Boolean)}function $J(n,e){const t=new Set,s=n.split(/\r?\n\s*\r?\n/).map(o=>o.replace(/\r?\n/g," ").trim()).filter(Boolean);if(s.length<=1)return t;let r=0;for(const o of s){if(r>=e.length)break;const i=o.substring(0,100).toLowerCase().replace(/[^a-z0-9\s]/g," ");for(let a=r;a<e.length;a++){const c=e[a].english.substring(0,100).toLowerCase().replace(/[^a-z0-9\s]/g," ");if(i.includes(c.substring(0,30))||c.includes(i.substring(0,30))){t.add(a+1),r=a+1;break}}}return t}function zk(n){return n.join(" ").replace(/\*+/g,"").replace(/[‚Äú‚Äù"']/g," ").replace(/[^A-Za-z0-9\s-]/g," ").split(/\s+/).map(r=>r.trim()).filter(Boolean).length}function ba(n){return n.replace(/\s+/g," ").replace(/\b(\w+)\s+'\s+(\w+)\b/g,"$1'$2").replace(/\s+([.,!?;:])/g,"$1").replace(/\s+"/g,'"').replace(/"\s+/g,'"').trim()}function hi(n){const e=n.trim();return/[.!?](?:"|')?$/.test(e)}function Yf(n){const t=ba(n).trim().match(/[.!?](?:"|')?$/);if(!t)return null;const s=t[0].match(/[.!?]/);return s?s[0]:null}function TJ(n){const e=n.replace(/\r?\n/g,"").trim();if(!e)return[];const t=[];let s="";for(const o of e)if(s+=o,o==="„ÄÇ"||o==="ÔºÅ"||o==="Ôºü"){const i=s.trim();i&&t.push(i),s=""}const r=s.trim();return r&&t.push(r),t}function AJ(n){const e=n.toLowerCase();return{one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10",eleven:"11",twelve:"12"}[e]??null}function RJ(n){const e=ba(n),s=e.toLowerCase().match(/^at\s+([a-z]+)\s+every\s+morning\.?$/);if(s){const r=AJ(s[1])??s[1];return[{english:`at ${s[1]}`,japanese:`${r}ÊôÇ„Å´`},{english:"every morning",japanese:"ÊØéÊúù„Å´"}]}return[{english:e,japanese:""}]}async function EJ(n){const[e,t]=await Promise.all([fetch(`/data/passages-phrase-learning/${n}.json`),fetch(`/data/passages-translations/${n}-ja.txt`)]);if(!e.ok)throw new Error(`„Éï„É¨„Éº„Ç∫Â≠¶Áøí„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${n}`);const s=await e.json(),r=Array.isArray(s.phrases)?s.phrases:[];if(r.length===0)throw new Error(`„Éï„É¨„Éº„Ç∫Â≠¶Áøí„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô: ${n}`);const o=t.ok?await t.text():"",i=TJ(o),a=[],c=new Map,l=new Map;let d=0;for(const y of r){const b=RJ(y.english),w=hi(y.english),v=Yf(y.english);if(b.length===1){d++;const S=`${n}-p${d}`;if(a.push({id:S,english:b[0].english,japanese:(y.japanese??"").trim()}),c.set(S,hi(b[0].english)),hi(b[0].english)){const C=Yf(b[0].english);C&&l.set(S,C)}continue}for(let S=0;S<b.length;S++){const C=b[S];d++;const k=`${n}-p${d}`;if(a.push({id:k,english:ba(C.english),japanese:(C.japanese??"").trim()}),w&&S===b.length-1)c.set(k,!0),v&&l.set(k,v);else{c.set(k,hi(C.english));const I=Yf(C.english);I&&l.set(k,I)}}}const h=[];let f=[],p=[],m=0;for(const y of a)if(f.push(y.id),p.push(y.english),c.get(y.id)??hi(y.english)){m++;const w=p.join(" "),v=l.get(y.id)??"",S=ba(v&&!hi(w)?`${w}${v}`:w),C=i[m-1]??"";h.push({id:m,english:S,japanese:C,phraseIds:f}),f=[],p=[]}p.length>0&&(m++,h.push({id:m,english:ba(p.join(" ")),japanese:i[m-1]??"",phraseIds:f}));const g=zk(h.map(y=>y.english)),x=h.length;return{passageId:n,sentences:h,phrases:a,keyPhrases:[],annotatedWords:[],metadata:{wordCount:g,sentenceCount:x}}}function DJ(n){const e=n.lastIndexOf(wx);if(e===-1)return{body:n,glossary:""};const t=n.slice(e);return/[„ÅÅ-„Çì„Ç°-„É≥‰∏Ä-ÈæØ]/.test(t)?{body:n.slice(0,e),glossary:t}:{body:n,glossary:""}}function jJ(n){if(!n)return[];const e=n.split(wx).map(r=>r.trim()).filter(Boolean),t=[];for(const r of e){const o=r.replace(/\s+/g," ").trim();if(!o)continue;const i=o.match(/^([A-Za-z][A-Za-z\s-]*[A-Za-z])\s+(.*)$/);if(!i)continue;const a=i[1].trim(),c=i[2].trim();!a||!c||t.push({word:a,inText:a,meaning:c})}const s=new Set;return t.filter(r=>{const o=r.word.toLowerCase();return s.has(o)?!1:(s.add(o),!0)})}async function _J(n,e){var f;if(j.log(`[passageDataLoader] Loading passage: ${n}`),n==="beginner-morning-routine")return EJ(n);const t=e??await Lk(n);if(!t||!t.sentences||t.sentences.length===0)return j.warn(`[passageDataLoader] No dependency parse found for ${n}`),{passageId:n,sentences:[],phrases:[],keyPhrases:[],annotatedWords:[],metadata:{wordCount:0,sentenceCount:0}};let s=[];try{const p=await fetch(`/data/passages-translations/${n}_sentences.txt`);p.ok&&(s=kJ(await p.text()))}catch{}const r=t.sentences.map((p,m)=>{const g=typeof p.id=="number"?p.id:m+1,x=s[m]??"";return{id:g,english:p.text,japanese:x,phraseIds:[],isParagraphStart:!1}});let o=new Set;try{const p=await fetch(`/data/passages-original/${n}.txt`);if(p.ok){const g=(await p.text()).replace(/^[^\n]*\n/,"").trim();o=$J(g,r)}}catch{}r.forEach(p=>{p.isParagraphStart=o.has(p.id)});let i=[],a=[],c=[];try{const[p,m]=await Promise.all([fetch(`/data/passages-for-phrase-work/${n}.txt`),fetch(`/data/passages-translations/${n}_phrases.txt`)]);if(p.ok){const g=await p.text(),{body:x,glossary:y}=DJ(g);c=jJ(y),i=x.split(/\r?\n/).map(b=>b.trim()).filter(Boolean).map(b=>b.split(wx).join("").trim()).filter(Boolean)}m.ok&&(a=(await m.text()).split(/\r?\n/).map(g=>g.trim()).filter(Boolean))}catch{}const l=[];if(i.length>0&&a.length>0){const p=Math.min(i.length,a.length);for(let g=0;g<p;g++)l.push({id:`${n}-p${g+1}`,english:ba(i[g]),japanese:a[g]});let m=0;for(let g=0;g<l.length&&!(m>=r.length);g++){const x=l[g].id;(f=r[m].phraseIds)==null||f.push(x),hi(l[g].english)&&m++}}const d=zk(r.map(p=>p.english)),h=r.length;return{passageId:n,sentences:r,phrases:l,keyPhrases:[],annotatedWords:c,metadata:{wordCount:d,sentenceCount:h}}}function PJ(n){const e=[],t=[{pattern:/\bwake up\b/gi,phrase:"wake up",meaning:"Ëµ∑„Åç„ÇãÔºàÂè•ÂãïË©ûÔºâ"},{pattern:/\bget (.*?) ready\b/gi,phrase:"get ready",meaning:"Ê∫ñÂÇô„Åô„Çã"},{pattern:/\bbrush (one's|my|your|his|her|their) teeth\b/gi,phrase:"brush teeth",meaning:"Ê≠Ø„ÇíÁ£®„Åè"},{pattern:/\bwash (one's|my|your|his|her|their) face\b/gi,phrase:"wash face",meaning:"È°î„ÇíÊ¥ó„ÅÜ"},{pattern:/\bput (.*?) inside\b/gi,phrase:"put inside",meaning:"‰∏≠„Å´ÂÖ•„Çå„Çã"},{pattern:/\bwalk to\b/gi,phrase:"walk to",meaning:"ÔΩû„Åæ„ÅßÊ≠©„Åè"}];return n.forEach(s=>{t.forEach(({pattern:r,phrase:o,meaning:i})=>{if(r.test(s.english)){const a=e.find(c=>c.phrase===o);a?a.positions.includes(s.id)||a.positions.push(s.id):e.push({phrase:o,meaning:i,type:"phrasal-verb",positions:[s.id]})}})}),e}function MJ(n){let e=n;const t=["a lot of","a number of","a kind of","a sort of","a type of","a couple of","a bit of","a piece of","a pair of","a group of","plenty of","lots of","most of","some of","all of","many of","each of","both of","none of","several of","few of","a few of"],s=[];t.forEach((i,a)=>{const c=`__IDIOM_${a}__`,l=new RegExp(i.replace(/\s+/g,"\\s+"),"gi");e=e.replace(l,d=>(s.push(d),c))}),e=e.replace(/^([A-Z][a-z]+(?:\s+[A-Z]?[a-z]+)*),\s+/,"$1, / "),e=e.replace(/,\s+([a-z])/g,", / $1"),e=e.replace(/,\s*$/gm,", /");const r="know|knows|knew|learn|learned|learnt|think|thinks|thought|hope|hopes|hoped|say|says|said|tell|tells|told|believe|believes|believed|feel|feels|felt|find|finds|found|see|sees|saw|hear|hears|heard|understand|understands|understood|realize|realizes|realized|imagine|imagines|imagined|suppose|supposes|supposed|expect|expects|expected|remember|remembers|remembered|forget|forgets|forgot|wonder|wonders|wondered|guess|guesses|guessed|assume|assumes|assumed";e=e.replace(new RegExp(`\\b(${r})\\s+that\\s+`,"gi"),"$1 / that "),e=e.replace(new RegExp(`\\b(${r})\\s+([a-z]+|there|[A-Z][a-z]+|his|her|their|my|your)\\s+(is|are|was|were|can|will|would|should|could|may|might|must|has|have|had|am)\\b`,"gi"),"$1 / $2 $3"),e=e.replace(new RegExp(`\\b(${r})\\s+(his|her|their|my|your|our)\\s+([a-z]+)\\s+(is|are|was|were|can|will|would|should|could)\\b`,"gi"),"$1 / $2 $3 $4"),e=e.replace(/\b([A-Z][a-z]+(?:\s+[a-z]+)*)\s+(who|which|that)\s+/g,"$1 / $2 "),e=e.replace(/\b(who|which)\s+([a-z]+)\s+(in|at|on|from|to|with|for|by|about|of|during|after|before|around|near)\s+/gi,"$1 $2 / $3 "),e=e.replace(/\s+(in|at|on|from|to|with|for|by|about|of|during|after|before|around|near|under|over)\s+([a-z]+(?:\s+[a-z]+)*)\s+(am|is|are|was|were|be|been|being)\b/gi," $1 $2 / $3"),e=e.replace(/\b(am|is|are|was|were|be|been|being)\s*\/\s+(so|very|too|quite|really|extremely)\s+([a-z]+)\b/gi,"$1 $2 $3"),e=e.replace(/\s+and(\s+|$)/gi," / and$1"),e=e.replace(/\s+(but|or)(\s+|$)/gi," / $1$2"),e=e.replace(/\s+so\s+([A-Z]|that\s|I\s|he\s|she\s|we\s|they\s|it\s|you\s|there\s)/g," / so $1");const o="at|in|on|by|from|for|with|about|of|during|after|before|around|per|near|under|over|through|into|onto|upon|without|within|among|between|behind|beside|below|above|across|along|against|beyond|past|since|until|towards?|throughout|underneath";return e=e.replace(new RegExp(`(?<!/)\\s+(${o})\\s+`,"gi")," / $1 "),e=e.replace(new RegExp("(?<!have|want|need|try|going|used|able|ought)(?<!/)\\s+to\\s+([a-z]+)","gi")," / to $1"),s.forEach((i,a)=>{e=e.replace(`__IDIOM_${a}__`,i)}),e=e.replace(/\s*\/\s*\/+\s*/g," / "),e=e.replace(/^\s*\/\s*/,""),e=e.replace(/\s*\/\s*([.!?;:])/,"$1"),e=e.replace(/\s*\/\s*,/,","),e=e.replace(/\s+/g," ").trim(),e}function FJ({passageData:n,activeTab:e,onTabChange:t}){return u.jsx("div",{className:"score-board-compact",children:u.jsxs("div",{className:"score-board-tabs flex flex-wrap gap-1 sm:gap-2 px-2 sm:px-3 py-2 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg",children:[u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="full-text"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("full-text"),title:"ÂÖ®Êñá",children:"üìñ ÂÖ®Êñá"}),u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="slash-split"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("slash-split"),title:"/ÂàÜÂâ≤",children:"üìê /ÂàÜÂâ≤"}),u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="paren-split"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("paren-split"),title:"()ÂàÜÂâ≤",children:"üîÄ ()ÂàÜÂâ≤"}),u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="literal-translation"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("literal-translation"),title:"Áõ¥Ë®≥",children:"üî§ Áõ¥Ë®≥"}),u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="sentence-translation"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("sentence-translation"),title:"‰∏ÄÊñáË®≥",children:"üáØüáµ ‰∏ÄÊñáË®≥"}),u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="vocabulary"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("vocabulary"),title:"Ë™ûÂè•Á¢∫Ë™ç",children:"üìö Ë™ûÂè•"}),u.jsx("button",{className:`flex-1 min-w-[60px] truncate py-1.5 sm:py-2 px-1 sm:px-2 text-xs font-bold rounded-md transition-all duration-200 ${e==="settings"?"bg-blue-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700 shadow-sm"}`,onClick:()=>t("settings"),title:"Ë®≠ÂÆö",children:"‚öôÔ∏è Ë®≠ÂÆö"})]})})}function OJ({passageData:n}){const e=[];let t=[];return n.sentences.forEach((s,r)=>{s.isParagraphStart&&t.length>0&&(e.push({sentences:t}),t=[]),t.push(s),r===n.sentences.length-1&&e.push({sentences:t})}),u.jsx("div",{className:"bg-white p-4 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:u.jsx("div",{className:"text-base leading-relaxed space-y-4",children:e.map((s,r)=>u.jsx("div",{className:"indent-8",children:s.sentences.map(o=>o.english).join(" ")},r))})})}function LJ({passageData:n}){const e=[];let t=[];return n.sentences.forEach((s,r)=>{s.isParagraphStart&&t.length>0&&(e.push({sentences:t}),t=[]),t.push(s),r===n.sentences.length-1&&e.push({sentences:t})}),u.jsx("div",{className:"bg-white p-4 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:u.jsx("div",{className:"text-base leading-relaxed space-y-4",children:e.map((s,r)=>u.jsx("div",{className:"indent-8",children:s.sentences.map(o=>MJ(o.english)).join(" ")},r))})})}function zJ({passageData:n}){const e=r=>{let o=r;o=o.replace(/\b(that\s+[^,.!?()]+?)([,.!?]|\s+and\s+|\s+but\s+|$)/gi,"($1)$2"),o=o.replace(/\b(if\s+[^,()]+?),/gi,"($1),"),o=o.replace(/\b(because\s+[^,.!?()]+?)([,.!?]|\s+and\s+|\s+but\s+|$)/gi,"($1)$2"),o=o.replace(/\b(when\s+[^,()]+?),/gi,"($1),");const i="at|in|on|by|to|from|for|with|about|of|during|after|before|around|per",a="the|a|an|my|your|his|her|their|our|its|this|that|these|those";return o=o.replace(new RegExp(`\\b(${i})\\s+(${a})\\s+([a-z]+\\s+){0,2}[a-z]+\\b`,"gi"),"<$&>"),o=o.replace(new RegExp(`\\b(${i})\\s+([A-Z][a-z]+|\\d+)\\b`,"g"),"<$&>"),o=o.replace(new RegExp(`\\b(${i})\\s+(breakfast|lunch|dinner|school|home|work|bed|friends|them|seven|eight|nine|ten|eleven|twelve)\\b`,"gi"),"<$&>"),o=o.replace(/\b(for|in|after|before|during)\s+([a-z]+\s+[a-z]+)\b/gi,"<$&>"),o=o.replace(/<+([^<>]+?)>+/g,"<$1>"),o=o.replace(/\(+([^()]+?)\)+/g,"($1)"),o=o.replace(/\s+([,.!?])/g,"$1"),o},t=[];let s=[];return n.sentences.forEach((r,o)=>{r.isParagraphStart&&s.length>0&&(t.push({sentences:s}),s=[]),s.push(r),o===n.sentences.length-1&&t.push({sentences:s})}),u.jsx("div",{className:"bg-white p-4 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:u.jsx("div",{className:"text-base leading-relaxed space-y-4",children:t.map((r,o)=>u.jsx("div",{className:"indent-8",children:r.sentences.map(i=>e(i.english)).join(" ")},o))})})}function WJ({passageData:n}){return u.jsx("div",{className:"bg-white p-4 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:u.jsx("div",{className:"space-y-4",children:n.sentences.map(e=>{const t=n.phrases.filter(o=>{var i;return(i=e.phraseIds)==null?void 0:i.includes(o.id)});if(t.length===0)return u.jsx("div",{className:"mb-4",children:u.jsx("div",{className:"text-gray-500 text-sm",children:"„Éï„É¨„Éº„Ç∫„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})},e.id);const s=t.map(o=>o.english).join(" / "),r=t.map(o=>o.japanese).join(" / ");return u.jsx("div",{className:"mb-4",children:u.jsx("div",{className:"phrase-translation-grid",children:u.jsxs("div",{className:"phrase-translation-row",children:[u.jsx("div",{className:"phrase-english",children:s}),u.jsx("div",{className:"phrase-japanese",children:r})]})})},e.id)})})})}function BJ({passageData:n}){return u.jsx("div",{className:"bg-white p-4 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:u.jsx("div",{className:"space-y-4",children:n.sentences.map((e,t)=>u.jsxs("div",{className:"sentence-translation-pair",children:[e.isParagraphStart&&t>0&&u.jsx("div",{className:"h-4"}),u.jsx("div",{className:`phrase-english mb-2 ${e.isParagraphStart?"indent-8":""}`,children:e.english}),u.jsx("div",{className:`japanese-translation-display ${e.isParagraphStart?"indent-8":""}`,children:e.japanese})]},e.id))})})}function VJ({currentPassageId:n,availablePassages:e,onPassageChange:t,metadata:s}){return u.jsxs("div",{className:"bg-white p-3 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:[u.jsx("h4",{className:"text-lg font-bold mb-3",children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"passage-select",className:"block text-sm font-semibold text-gray-700 mb-2",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏ÈÅ∏Êäû"}),u.jsx("select",{id:"passage-select",value:n,onChange:r=>t(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:e.map(r=>u.jsx("option",{value:r,children:r},r))})]}),s&&u.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-3",children:[u.jsx("h5",{className:"text-sm font-semibold text-gray-700 mb-2",children:"üìä „Éë„ÉÉ„Çª„Éº„Ç∏ÊÉÖÂ†±"}),u.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Á∑èË™ûÊï∞:"}),u.jsxs("span",{className:"font-bold",children:[s.wordCount,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÊñáÊï∞:"}),u.jsxs("span",{className:"font-bold",children:[s.sentenceCount,"Êñá"]})]})]})]}),u.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[u.jsx("h5",{className:"text-sm font-semibold text-blue-800 mb-2",children:"üí° ‰Ωø„ÅÑÊñπ"}),u.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[u.jsx("li",{children:"‚Ä¢ ÂêÑ„Çø„Éñ„ÅßÂÖ®Êñá„ÅÆÊßò„ÄÖ„Å™Ë°®Á§∫ÂΩ¢Âºè„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ /ÂàÜÂâ≤„Çø„Éñ„Åß„ÅØ„ÄÅÊñá„ÇíÊñáÁØÄ„Åî„Å®„Å´Âå∫Âàá„Å£„Å¶Ë°®Á§∫„Åó„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ ()ÂàÜÂâ≤„Çø„Éñ„Åß„ÅØ„ÄÅÂæìÂ±ûÁØÄ„ÇíÊã¨Âºß„ÅßÂõ≤„Çì„ÅßË°®Á§∫„Åó„Åæ„Åô"})]})]})]})}function UJ({passageData:n,onAddToCustom:e}){const t=n.annotatedWords||[];return u.jsxs("div",{className:"bg-white p-4 sm:rounded-lg sm:shadow-md sm:border sm:border-gray-200",children:[t.length>0&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"üìö ÈáçË¶ÅË™ûÂè•"}),u.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:t.map((s,r)=>u.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"font-semibold text-gray-900",children:s.word}),u.jsx("div",{className:"text-sm text-gray-600",children:s.meaning})]}),e&&u.jsx("button",{className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition whitespace-nowrap",onClick:()=>e({phrase:s.word,meaning:s.meaning,type:"annotated",positions:[]}),children:"+ ËøΩÂä†"})]},r))})]}),t.length===0&&u.jsx("div",{className:"text-center py-8",children:u.jsx("p",{className:"text-gray-500",children:"„Åì„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„Å´Ê≥®ÈáàË™ûÂè•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"})})]})}function GJ({onAddWordToCustomSet:n}){const[e,t]=N.useState(null),[s,r]=N.useState(null),[o,i]=N.useState(!0),[a,c]=N.useState(null),[l,d]=N.useState(()=>{const x=localStorage.getItem("explanation-board-active-tab");return["full-text","slash-split","paren-split","literal-translation","sentence-translation","vocabulary","settings"].includes(x)?x:"full-text"});N.useEffect(()=>{localStorage.setItem("explanation-board-active-tab",l)},[l]);const h=["beginner-morning-routine","J_2022_5"],[f,p]=N.useState(h[0]);N.useEffect(()=>{async function x(){i(!0),c(null);try{j.log(`[ReadingPassageView] „Éë„ÉÉ„Çª„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÈñãÂßã: ${f}`);const y=Lk(f),b=y.then(C=>_J(f,C)),[w,v]=await Promise.all([y,b]),S=PJ(v.sentences);v.keyPhrases=S,t(v),r(w),j.log("[ReadingPassageView] „Éë„ÉÉ„Çª„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}catch(y){j.error(`[ReadingPassageView] Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${y}`),c(`„Éë„ÉÉ„Çª„Éº„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${y}`)}finally{i(!1)}}x()},[f]);const m=N.useCallback(x=>{n&&n({word:x.phrase,meaning:x.meaning,category:"reading"})},[n]),g=N.useMemo(()=>e?{wordCount:e.metadata.wordCount,sentenceCount:e.metadata.sentenceCount}:null,[e]);return o?u.jsx("div",{className:"reading-passage-view",children:u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"üìñ Èï∑Êñá„ÇíË™≠„ÅøËæº„Åø‰∏≠..."})]})})}):a?u.jsx("div",{className:"reading-passage-view",children:u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[u.jsx("p",{className:"text-red-800 font-bold mb-2",children:"‚ùå „Ç®„É©„Éº"}),u.jsx("p",{className:"text-red-600",children:a})]})})}):e?u.jsxs("div",{className:"reading-passage-view",children:[u.jsx("div",{className:"mb-3 sm:mb-6",children:u.jsx(FJ,{passageData:e,activeTab:l,onTabChange:d})}),u.jsxs("div",{className:"passage-full-text-area",children:[l==="settings"&&u.jsx(VJ,{currentPassageId:f,availablePassages:h,onPassageChange:p,metadata:g||void 0}),l==="full-text"&&e&&u.jsx(OJ,{passageData:e}),l==="slash-split"&&e&&s&&u.jsx(LJ,{passageData:e,dependencyParse:s}),l==="slash-split"&&e&&!s&&u.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 shadow-sm",children:[u.jsx("p",{className:"text-yellow-800 font-bold mb-2",children:"‚ö†Ô∏è Ëß£Êûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-yellow-700",children:"„Åì„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÅØ‰æùÂ≠òÈñ¢‰øÇËß£ÊûêÔºàUD„Éë„Éº„ÇπÔºâ„ÅåÊú™Êèê‰æõ„ÅÆ„Åü„ÇÅ„ÄÅ/ÂàÜÂâ≤Ë°®Á§∫„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ"})]}),l==="paren-split"&&e&&s&&u.jsx(zJ,{passageData:e,dependencyParse:s}),l==="paren-split"&&e&&!s&&u.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 shadow-sm",children:[u.jsx("p",{className:"text-yellow-800 font-bold mb-2",children:"‚ö†Ô∏è Ëß£Êûê„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-yellow-700",children:"„Åì„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÅØ‰æùÂ≠òÈñ¢‰øÇËß£ÊûêÔºàUD„Éë„Éº„ÇπÔºâ„ÅåÊú™Êèê‰æõ„ÅÆ„Åü„ÇÅ„ÄÅ()ÂàÜÂâ≤Ë°®Á§∫„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ"})]}),l==="literal-translation"&&e&&u.jsx(WJ,{passageData:e}),l==="sentence-translation"&&e&&u.jsx(BJ,{passageData:e}),l==="vocabulary"&&e&&u.jsx(UJ,{passageData:e,onAddToCustom:m})]})]}):u.jsx("div",{className:"reading-passage-view",children:u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsx("p",{className:"text-gray-600",children:"„Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})})})}function HJ(n){if(!n)return null;const e=n.match(/[A-Za-z0-9]+(?:[‚Äô'][A-Za-z0-9]+)*(?:-[A-Za-z0-9]+(?:[‚Äô'][A-Za-z0-9]+)*)*|[.,!?;:()]/g);if(!e||e.length===0)return null;const t=[];for(const s of e){if(/[A-Za-z0-9]/.test(s)){t.push("____");continue}if(/^[.,!?;:]$/.test(s)){t.length===0?t.push(`____${s}`):t[t.length-1]=`${t[t.length-1]}${s}`;continue}if(s==="("){t.push("(");continue}if(s===")"){t.length===0?t.push(")"):t[t.length-1]=`${t[t.length-1]})`;continue}}return t.join(" ").replace(/\(\s+/g,"(").replace(/\s+\)/g,")").replace(/\s+([.,!?;:])/g,"$1").trim()}function qJ(n,e){const t=e.trim();return t?n.replace(/____+/g,t).replace(/\s+/g," ").trim():n}function Wk(n){var Vt,Be,ae,Ce;const[e,t]=N.useState(()=>localStorage.getItem("grammar-quiz-type")||"verb-form"),[s,r]=N.useState(()=>localStorage.getItem("grammar-grade")||"all"),[o,i]=N.useState([]),[a,c]=N.useState(!1),[l,d]=N.useState(!1),[h,f]=N.useState(!1),p=uf(Ja.GRAMMAR),{processQuestion:m}=lf(),[g]=N.useState(()=>{const U=new $s;return localStorage.getItem("enable-ai-coordination")==="true"&&j.info("ü§ñ [GrammarQuizView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü"),U}),{reAddQuestion:x,clearExpiredFlags:y,updateRequeueStats:b,getRequeuedWords:w,checkPositionMismatch:v}=Jl(),[S,C]=N.useState(Date.now()),[k,I]=N.useState(void 0),[A,T]=N.useState(void 0),[E,$]=N.useState(0),[D,M]=N.useState(0),P=(()=>{try{const U=localStorage.getItem("grammar-batch-size");return U?parseInt(U):null}catch{return null}})(),L=(()=>{try{const U=localStorage.getItem("grammar-review-ratio-limit");return U?parseInt(U):20}catch{return 20}})(),[O,F]=N.useState(!1),[V,G]=N.useState(0),[_,Z]=N.useState(!1),te=()=>{F(!O)},he=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:U}=await On(async()=>{const{resetAllProgress:ue}=await Promise.resolve().then(()=>wi);return{resetAllProgress:ue}},void 0);await U(),lt(!1),Ye([]),Tt(0),Ge(null),Nt([]),Ht([]),ge(""),tt(!1),Yt(!1),jt(0),un(0),re(),$(0),M(0),console.log("‚úÖ [ÊñáÊ≥ï„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(U){console.error("‚ùå [ÊñáÊ≥ï„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",U),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},oe=()=>{f(!0)},ve=async(U,ue)=>{try{const Me=Oe=>Oe.difficulty==="beginner"?.3:Oe.difficulty==="intermediate"?.6:Oe.difficulty==="advanced"?.9:.5,qe=()=>{const Oe=new Date().getHours();return Oe<12?"morning":Oe<18?"afternoon":Oe<22?"evening":"night"};await m(U,ue?"correct":"incorrect",{currentDifficulty:Me(z),timeOfDay:qe(),recentErrors:Et.incorrect,sessionLength:Math.floor((Date.now()-xe.current)/6e4),consecutiveCorrect:E})}catch(Me){console.error("[GrammarQuizView] Adaptive AI error:",Me)}},[$e,Ae]=N.useState(()=>localStorage.getItem("autoNext-grammar")==="true"),[De,we]=N.useState(()=>{const U=localStorage.getItem("autoNextDelay-grammar");return U?parseInt(U,10):1500}),[Re,et]=N.useState(()=>localStorage.getItem("autoReadAloud-grammar")==="true"),[je,lt]=N.useState(!1),[ht,it]=N.useState(!1),[st,Ye]=N.useState([]),[pt,Tt]=N.useState(0),[se,Ge]=N.useState(null),[ze,Nt]=N.useState([]),[sn,Ht]=N.useState([]),[Fe,ge]=N.useState(""),[Pe,tt]=N.useState(!1),[vt,Yt]=N.useState(!1),[gn,jt]=N.useState(0),[hn,un]=N.useState(0),{sessionStats:Et,setSessionStats:q,resetStats:re}=eu("grammar"),[ne,B]=N.useState(null),z=st[pt],le=(z==null?void 0:z.type)==="sentenceOrdering"||e==="sentence-ordering",ee=le?(z==null?void 0:z.correctAnswer)||(z==null?void 0:z.correctOrder):void 0,be=le?HJ(ee):null,He=le&&typeof ee=="string"&&/[.,!?;:]/.test(ee)&&!!be,Qe=z!=null&&z.id?(()=>{const U=z.id.match(/^g(\d+)-u(\d+)/);if(U)return`g${U[1]}-unit${U[2]}`})():void 0,ke=N.useRef({quizType:e,grade:s}),xe=N.useRef(Date.now()),K=N.useCallback(()=>{if(pt<st.length-1){const U=pt+1,ue=y(st,U-1);ue!==st&&Ye(ue),Tt(U),Ge(null),Nt([]),tt(!1),Yt(!1),xe.current=Date.now(),T(void 0)}},[pt,st]),pe=N.useCallback(async()=>{var U,ue;if(!ht){it(!0),B(null);try{let Me=[],qe=null;if(s==="all")Me=["1","2","3"];else if(s.match(/^[123]$/))Me=[s];else if(s.endsWith("-all"))Me=[s.charAt(0)];else if(s.match(/^g\d+-unit\d+$/)){const St=(U=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:U[1],Ke=(ue=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:ue[2];St&&Ke!==void 0&&(Me=[St],qe=parseInt(Ke))}const Oe=[];for(const St of Me)for(let Ke=0;Ke<10;Ke++)if(!(qe!==null&&Ke!==qe))try{const Ct=await fetch(`/data/grammar/grammar_grade${St}_unit${Ke}.json`);if(Ct.ok){const Ut=await Ct.json();if(Ut.enabled===!1){j.log(`grammar_grade${St}_unit${Ke}.json is disabled: ${Ut.disabledReason||"No reason provided"}`);continue}Oe.push(Ut)}else j.log(`grammar_grade${St}_unit${Ke}.json returned status ${Ct.status}, skipping...`)}catch(Ct){j.log(`Failed to fetch grammar_grade${St}_unit${Ke}.json:`,Ct)}if(Oe.length===0)throw new Error(`ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºàÂ≠¶Âπ¥: ${s}, ÂΩ¢Âºè: ${e}Ôºâ`);const _e=[];if(Oe.forEach(St=>{const Ke=St.questions||[],Ct={"verb-form":"verbForm","fill-in-blank":"fillInBlank","sentence-ordering":"sentenceOrdering"};if(e==="all"||e==="random")_e.push(...Ke);else{const Ut=Ct[e]||e,xn=Ke.filter(es=>es.type===Ut);_e.push(...xn)}}),_e.length===0)throw new Error("ÈÅ∏Êäû„Åï„Çå„ÅüÊù°‰ª∂„Å´Ë©≤ÂΩì„Åô„ÇãÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");if(j.log(`Total questions: ${_e.length}`),_e.length===0)throw new Error("ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");const Se=St=>{if(St.word)return St.word;if(St.id)return`grammar_${St.id}`;if(St.question)return`grammar_${St.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const Ke=St.japanese||St.sentence||"unknown";return`grammar_${String(Ke).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`},ft=_e.map(St=>({word:Se(St),meaning:St.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:St.difficulty||"beginner"})),It=await g.schedule({questions:ft,mode:"grammar",useCategorySlots:!0,sessionStats:{correct:Et.correct,incorrect:Et.incorrect,still_learning:Et.review||0,mastered:Et.mastered||0,duration:0},isReviewFocusMode:O}),rn=new Map(_e.map(St=>[Se(St),St])),nn=It.scheduledQuestions.map(St=>{const Ke=rn.get(St.word);if(Ke)return{...Ke,word:St.word,position:St.position,finalPriority:St.finalPriority}}).filter(St=>St!==void 0);It.vibrationScore>50&&j.warn("[GrammarQuizView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:It.vibrationScore,processingTime:It.processingTime}),j.log("[GrammarQuizView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:nn.length,vibrationScore:It.vibrationScore}),Ye(nn),Tt(0),Ge(null),Nt([]),Ht([]),tt(!1),Yt(!1),jt(0),un(0),q({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),G(0),Z(!1),lt(!0),it(!1)}catch(Me){j.error("„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Me),B(Me instanceof Error?Me.message:String(Me)),it(!1)}}},[e,s]);N.useEffect(()=>{if(!_||st.length===0)return;const U=pt,ue=qe=>{if(qe.word)return qe.word;if(qe.id)return`grammar_${qe.id}`;if(qe.question)return`grammar_${qe.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const Oe=qe.japanese||qe.sentence||"unknown";return`grammar_${String(Oe).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`};(async()=>{try{const qe=st.slice(U);if(qe.length===0){Z(!1);return}const Oe=qe.map(It=>({word:ue(It),meaning:It.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:It.difficulty||"beginner"})),_e=new Map(qe.map(It=>[ue(It),It]));j.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:V,currentIndex:U,remaining:qe.length});const ft=(await g.schedule({questions:Oe,mode:"grammar",useCategorySlots:!0,sessionStats:{correct:Et.correct,incorrect:Et.incorrect,still_learning:Et.review||0,mastered:Et.mastered||0,duration:0},isReviewFocusMode:O})).scheduledQuestions.map(It=>{const rn=_e.get(It.word);if(rn)return{...rn,word:It.word,position:It.position,finalPriority:It.finalPriority}}).filter(It=>It!==void 0);Ye(It=>It.length===0||pt!==U?It:[...It.slice(0,U),...ft]),G(0),Z(!1),j.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:ft.length})}catch(qe){j.error("[GrammarQuizView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",qe),Z(!1)}})()},[_,st,pt,g,Et,O,V]);const Ne=N.useCallback(async()=>{if(Pe)K();else{jt(_e=>_e+1),un(_e=>_e+1),q(_e=>({..._e,correct:_e.correct+1,mastered:_e.mastered+1}));const U=Date.now()-xe.current,{updateWordProgress:ue,addSessionHistory:Me}=await On(async()=>{const{updateWordProgress:_e,addSessionHistory:Se}=await Promise.resolve().then(()=>wi);return{updateWordProgress:_e,addSessionHistory:Se}},void 0),qe=z.id?`grammar_${z.id}`:z.question?`grammar_${z.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;if(await ue(qe,!0,U,void 0,"grammar"),Me({status:"correct",word:qe,timestamp:Date.now()},"grammar"),C(Date.now()),pt<st.length-1)Tt(_e=>_e+1),Ge(null),Nt([]),tt(!1),Yt(!1),xe.current=Date.now();else{if(!window.location.hostname.includes("github.io"))try{const _e=oo.summarize();j.log("üß™ KPI Summary (grammar):",_e)}catch{}tt(!1)}G(_e=>{const Se=_e+1;return Se>=50?(Z(!0),0):(Se%10===0&&v(st,"grammar").needsRescheduling&&Z(!0),Se)})}},[Pe,pt,st,z,K,v]);N.useEffect(()=>{localStorage.setItem("grammar-quiz-type",e)},[e]),N.useEffect(()=>{localStorage.setItem("grammar-grade",s)},[s]),N.useEffect(()=>{(async()=>{const ue=[],Me=s.match(/^g?(\d+)/),qe=Me?Me[1]:null;if(!qe||s==="all"){i([]);return}for(let Oe=0;Oe<10;Oe++)try{const _e=await fetch(`/data/grammar/grammar_grade${qe}_unit${Oe}.json`);if(_e.ok){const Se=await _e.json();if(Se.enabled===!1)continue;ue.push({value:`g${qe}-unit${Oe}`,label:`‰∏≠${qe}_Unit${Oe}_${Se.title}`})}}catch{}i(ue)})()},[s,e]),N.useEffect(()=>{const U=ke.current,ue=U.quizType!==e||U.grade!==s;je&&ue&&pe(),ke.current={quizType:e,grade:s}},[e,s,je,pe]),N.useEffect(()=>{if(le&&z&&z.words){const U=[...z.words].sort(()=>Math.random()-.5);Ht(U),Nt([]),tt(!1),Yt(!1)}},[pt,st,le,z]),N.useEffect(()=>{Ge(null),ge(""),tt(!1),Yt(!1)},[pt]),N.useEffect(()=>{const U=ue=>{je&&!Pe&&ue.key==="Enter"&&(ue.preventDefault(),Ne())};return window.addEventListener("keydown",U),()=>{window.removeEventListener("keydown",U)}},[je,Pe,Ne]);const Xe=async U=>{var es;if(Pe||le)return;Ge(U),tt(!0);const ue=U===z.correctAnswer,Me=U==="ÂàÜ„Åã„Çâ„Å™„ÅÑ";I(ue),T(z.question||z.sentence),ue?($(mt=>mt+1),M(0)):(M(mt=>mt+1),$(0));const qe=ue?0:D+1;!_&&qe>=5&&Z(!0);const Oe=z.question||z.targetSentence||z.sentence;Re&&Oe&&setTimeout(()=>{const mt=ue?qJ(String(Oe),U):String(Oe),Le=new SpeechSynthesisUtterance(mt);Le.lang="en-US",Le.rate=.9,window.speechSynthesis.speak(Le)},300),un(mt=>mt+1);const _e=Date.now()-xe.current;if(ue){jt(Le=>Le+1);const mt=z&&gn>=2;q(Le=>({...Le,correct:Le.correct+1,mastered:mt?Le.mastered+1:Le.mastered}))}else q(Me?mt=>({...mt,incorrect:mt.incorrect+1,review:mt.review+1}):mt=>({...mt,incorrect:mt.incorrect+1}));const{updateWordProgress:Se,loadProgress:ft,addSessionHistory:It,addQuizResult:rn}=await On(async()=>{const{updateWordProgress:mt,loadProgress:Le,addSessionHistory:yt,addQuizResult:Wt}=await Promise.resolve().then(()=>wi);return{updateWordProgress:mt,loadProgress:Le,addSessionHistory:yt,addQuizResult:Wt}},void 0),nn=z.id?`grammar_${z.id}`:z.question?`grammar_${z.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`,{generateId:St}=await On(async()=>{const{generateId:mt}=await Promise.resolve().then(()=>n9);return{generateId:mt}},void 0);await rn({id:St(),questionSetId:"grammar-set",questionSetName:"ÊñáÊ≥ïÂïèÈ°å",score:ue?1:0,total:1,percentage:ue?100:0,date:Date.now(),timeSpent:Math.floor(_e/1e3),incorrectWords:ue?[]:[nn],mode:"grammar",category:void 0,difficulty:z.difficulty}),await Se(nn,ue,_e,void 0,"grammar"),p.recordAnswer(nn,ue,_e),await ve(nn,ue);const Ct=(es=(await ft()).wordProgress)==null?void 0:es[nn];let Ut=ue?"correct":"incorrect";Ct&&Ct.masteryLevel==="mastered"?Ut="mastered":!ue&&Ct&&Ct.incorrectCount>=2&&(Ut="review"),It({status:Ut,word:nn,timestamp:Date.now()},"grammar"),C(Date.now());let xn=st;if(!ue&&z){const mt=x(z,st,pt,"grammar",{outcome:"incorrect"});xn=mt,mt!==st&&Ye(mt)}G(mt=>{const Le=mt+1;return Le>=50?(Z(!0),0):(Le%10===0&&v(xn,"grammar").needsRescheduling&&Z(!0),Le)});{const mt=String(z.word);oo.onShown(mt),oo.onAnswer(mt,ue)}b(z,Et,q)},dt=(U,ue)=>{Pe||!le||(ue?(Ht(Me=>Me.filter(qe=>qe!==U)),Nt(Me=>{var Oe;const qe=[...Me,U];return qe.length===((Oe=z.words)==null?void 0:Oe.length)&&!Pe&&setTimeout(async()=>{var es;tt(!0);const _e=qe.join(" "),Se=(z.correctAnswer||z.correctOrder||z.sentence||"").replace(/[.!?]/g,"").trim(),ft=_e.toLowerCase()===Se.toLowerCase();un(mt=>mt+1);const It=Date.now()-xe.current;if(Re&&setTimeout(()=>{const mt=new SpeechSynthesisUtterance(Se);mt.lang="en-US",mt.rate=.9,window.speechSynthesis.speak(mt)},300),ft){jt(Le=>Le+1);const mt=gn>=2;q(Le=>({...Le,correct:Le.correct+1,mastered:mt?Le.mastered+1:Le.mastered}))}else q(mt=>({...mt,incorrect:mt.incorrect+1}));const{updateWordProgress:rn,loadProgress:nn,addSessionHistory:St}=await On(async()=>{const{updateWordProgress:mt,loadProgress:Le,addSessionHistory:yt}=await Promise.resolve().then(()=>wi);return{updateWordProgress:mt,loadProgress:Le,addSessionHistory:yt}},void 0),Ke=z.id?`grammar_${z.id}`:z.question?`grammar_${z.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;await rn(Ke,ft,It,void 0,"grammar");const Ut=(es=(await nn()).wordProgress)==null?void 0:es[Ke];let xn=ft?"correct":"incorrect";Ut&&Ut.masteryLevel==="mastered"?xn="mastered":!ft&&Ut&&Ut.incorrectCount>=2&&(xn="review"),St({status:xn,word:Ke,timestamp:Date.now()},"grammar"),await ve(Ke,ft),C(Date.now())},100),qe})):(Nt(Me=>Me.filter(qe=>qe!==U)),Ht(Me=>[...Me,U])))},rt=()=>{Yt(!vt)},at=()=>{pt>0&&(Tt(U=>U-1),Ge(null),Nt([]),tt(!1),Yt(!1),xe.current=Date.now())},Bt=()=>{var U;return!z||!Pe?!1:le?ze.join(" ")===((U=z.words)==null?void 0:U.join(" ")):se===z.correctAnswer};return N.useEffect(()=>{je||pe()},[je,pe]),u.jsxs("div",{className:"quiz-view",children:[ne&&u.jsxs("div",{className:"error-message",children:[u.jsxs("p",{children:["‚ùå ",ne]}),u.jsx("button",{onClick:pe,className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"ÂÜçË©¶Ë°å"})]}),!ne&&je&&z&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Zl,{mode:"grammar",currentScore:gn,totalAnswered:hn,sessionCorrect:Et.correct,sessionIncorrect:Et.incorrect,sessionReview:Et.review,sessionMastered:Et.mastered,onReviewFocus:te,isReviewFocusMode:O,onShowSettings:()=>c(!0),onResetProgress:he,onDebugRequeue:oe,currentWord:z!=null&&z.id?`grammar_${z.id}`:z!=null&&z.question?`grammar_${z.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:void 0,onAnswerTime:S,lastAnswerCorrect:k,lastAnswerWord:A,lastAnswerDifficulty:z==null?void 0:z.difficulty,correctStreak:E,incorrectStreak:D,learningPhase:p.state.currentPhase??void 0,estimatedSpeed:(Vt=p.state.personalParams)==null?void 0:Vt.learningSpeed,dataSource:s.startsWith("g")&&s.includes("-unit")?`ÊñáÊ≥ïÂïèÈ°åÈõÜÔΩú${s.replace("g","").replace("-unit","-unit")}`:s==="all"?"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ":`${s}Âπ¥„ÅÆÂÜÖÂÆπ`,category:e==="all"?"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û":e==="verb-form"?"ÂãïË©ûÂ§âÂåñ":e==="fill-in-blank"?"Á©¥Âüã„ÇÅ":e==="sentence-ordering"?"‰∏¶„Å≥Êõø„Åà":"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û",difficulty:"",wordPhraseFilter:"all",grammarUnit:Qe})})}),a&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"grade-select-active",children:"üìö Â≠¶Âπ¥„ÉªÂçòÂÖÉ:"}),u.jsxs("select",{id:"grade-select-active",value:s,onChange:U=>r(U.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ"}),u.jsx("option",{value:"1",children:"1Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(U=>U.value.startsWith("g1-")).map(U=>u.jsxs("option",{value:U.value,children:["1Âπ¥_",U.label.replace(/^‰∏≠\d+_/,"")]},U.value)),u.jsx("option",{value:"2",children:"2Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(U=>U.value.startsWith("g2-")).map(U=>u.jsxs("option",{value:U.value,children:["2Âπ¥_",U.label.replace(/^‰∏≠\d+_/,"")]},U.value)),u.jsx("option",{value:"3",children:"3Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(U=>U.value.startsWith("g3-")).map(U=>u.jsxs("option",{value:U.value,children:["3Âπ¥_",U.label.replace(/^‰∏≠\d+_/,"")]},U.value))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"quiz-type-select-active",children:"üìù ÂïèÈ°å„ÅÆÁ®ÆÈ°û:"}),u.jsxs("select",{id:"quiz-type-select-active",value:e,onChange:U=>t(U.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û"}),u.jsx("option",{value:"verb-form",children:"ÂãïË©ûÂ§âÂåñ"}),u.jsx("option",{value:"fill-in-blank",children:"Á©¥Âüã„ÇÅ"}),u.jsx("option",{value:"sentence-ordering",children:"‰∏¶„Å≥Êõø„Åà"})]})]}),u.jsxs("div",{className:"filter-group filter-group--section",children:[u.jsx("label",{htmlFor:"grammar-batch-size",children:"üì¶ „Éê„ÉÉ„ÉÅÊï∞:"}),u.jsxs("select",{id:"grammar-batch-size",value:P??"",onChange:U=>{const ue=U.target.value===""?null:parseInt(U.target.value);try{ue===null?localStorage.removeItem("grammar-batch-size"):localStorage.setItem("grammar-batch-size",String(ue)),window.location.reload()}catch{}},className:"select-input",children:[u.jsx("option",{value:"",children:"Âà∂Èôê„Å™„Åó"}),u.jsx("option",{value:"10",children:"10Âïè"}),u.jsx("option",{value:"20",children:"20Âïè"}),u.jsx("option",{value:"30",children:"30Âïè"}),u.jsx("option",{value:"50",children:"50Âïè"}),u.jsx("option",{value:"100",children:"100Âïè"}),u.jsx("option",{value:"200",children:"200Âïè"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"grammar-review-ratio-limit",children:"‚ùå ‰∏çÊ≠£Ëß£„ÅÆ‰∏äÈôê:"}),u.jsxs("select",{id:"grammar-review-ratio-limit",value:L,onChange:U=>{const ue=parseInt(U.target.value);try{localStorage.setItem("grammar-review-ratio-limit",String(ue)),window.location.reload()}catch{}},className:"select-input",children:[u.jsx("option",{value:"10",children:"10%"}),u.jsx("option",{value:"20",children:"20%"}),u.jsx("option",{value:"30",children:"30%"}),u.jsx("option",{value:"40",children:"40%"}),u.jsx("option",{value:"50",children:"50%"})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle-grammar-quiz",checked:$e,onChange:U=>{Ae(U.target.checked),localStorage.setItem("autoNext-grammar",U.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle-grammar-quiz",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",$e?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),$e&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay-grammar-quiz",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay-grammar-quiz",min:"500",max:"3000",step:"100",value:De,onChange:U=>{const ue=parseInt(U.target.value,10);we(ue),localStorage.setItem("autoNextDelay-grammar",ue.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(De/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-read-aloud-toggle-grammar-quiz",checked:Re,onChange:U=>{et(U.target.checked),localStorage.setItem("autoReadAloud-grammar",U.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-read-aloud-toggle-grammar-quiz",className:"checkbox-label",children:["ÂõûÁ≠îÊôÇËá™Âãï„ÅßË™≠„Åø‰∏ä„ÅíÔºö",Re?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>d(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:at,disabled:pt===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"question-content-inline",children:[u.jsxs("div",{className:`question-text ${vt?"hint-active":""} ${Pe?"":"clickable"}`,onClick:Pe?void 0:rt,title:Pe?"":"„Çø„ÉÉ„Éó„Åó„Å¶„Éí„É≥„Éà„ÇíË°®Á§∫ üí°",children:[z.japanese,!Pe&&u.jsx("span",{className:"hint-icon",children:"üí°"})]}),z.difficulty&&u.jsx("div",{className:`difficulty-badge ${z.difficulty}`,children:z.difficulty==="beginner"?"ÂàùÁ¥ö":z.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:Ne,disabled:pt>=st.length-1,title:Pe?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó (Enter)",children:"‚Üí"})]}),vt&&!Pe&&u.jsx("div",{className:"hint-box",children:z.hint}),z.passage&&u.jsxs("div",{className:"passage-context",children:[u.jsx("div",{className:"passage-label",children:"üìñ ÊñáËÑà"}),u.jsxs("div",{className:"passage-content",children:[u.jsx("div",{className:"passage-english",children:z.passage}),z.passageJapanese&&u.jsx("div",{className:"passage-japanese",children:z.passageJapanese})]})]}),le?u.jsxs("div",{className:"word-area",children:[He&&u.jsxs("div",{className:"selected-words-area",children:[u.jsx("div",{className:"area-label",children:"Êñá„ÅÆÂΩ¢ÔºàÂè•Ë™≠ÁÇπ„Å§„ÅçÔºâ"}),u.jsx("div",{className:"sentence-display",children:be})]}),u.jsxs("div",{className:"selected-words-area",children:[u.jsxs("div",{className:"area-label-with-reset",children:[u.jsxs("span",{className:"area-label",children:["ÈÅ∏Êäû„Åó„ÅüÂçòË™û (",ze.length,"Ë™û)"]}),!Pe&&u.jsx("button",{className:`reset-ordering-button ${ze.length===0?"disabled":""}`,onClick:()=>{if(ze.length>0){const U=ze[ze.length-1];Nt(ue=>ue.slice(0,-1)),Ht(ue=>[...ue,U])}},disabled:ze.length===0,title:ze.length===0?"ÂçòË™û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ":"ÊúÄÂæå„ÅÆÂçòË™û„ÇíÊàª„Åô",children:"‚Ü∂ 1„Å§Êàª„Çã"})]}),u.jsxs("div",{className:"word-container",children:[ze.map((U,ue)=>u.jsx("button",{className:"word-button selected",onClick:()=>dt(U,!1),disabled:Pe,children:U},`selected-${ue}`)),ze.length===0&&u.jsx("div",{className:"placeholder",children:"„Åì„Åì„Å´ÂçòË™û„Çí‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑ"})]})]}),u.jsxs("div",{className:"remaining-words-area",children:[u.jsxs("div",{className:"area-label",children:["‰Ωø„Åà„ÇãÂçòË™û (",sn.length,"Ë™û)"]}),u.jsx("div",{className:"word-container",children:sn.map((U,ue)=>u.jsx("button",{className:"word-button remaining",onClick:()=>dt(U,!0),disabled:Pe,children:U},`remaining-${ue}`))})]})]}):u.jsxs("div",{className:"choices-area",children:[z.conversation?u.jsxs(u.Fragment,{children:[z.japanese&&z.japanese.includes("A:")&&z.japanese.includes("B:")&&u.jsx("div",{className:"japanese-conversation",children:z.japanese.split(/([AB]:)/).map((U,ue)=>U==="A:"||U==="B:"?u.jsx("span",{className:"conversation-speaker",children:U},ue):U.trim()?u.jsx("span",{className:"conversation-text",children:U.trim()},ue):null)}),u.jsx("div",{className:"conversation-display",children:(z.conversation||((Be=z.dialogue)==null?void 0:Be.map(U=>`${U.speaker}: ${U.text}`))||[]).map((U,ue)=>u.jsx("div",{className:"conversation-line",children:U.split("____").map((Me,qe,Oe)=>u.jsxs("span",{children:[Me,qe<Oe.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},qe))},ue))})]}):z.originalSentence||z.targetSentence?u.jsxs("div",{className:"paraphrase-display",children:[u.jsx("div",{className:"paraphrase-label",children:"üìù ÂÖÉ„ÅÆÊñá:"}),u.jsx("div",{className:"sentence-display original",children:z.originalSentence||z.sentence}),u.jsx("div",{className:"paraphrase-arrow",children:"‚Üì Ë®Ä„ÅÑÊèõ„Åà"}),u.jsx("div",{className:"paraphrase-label",children:"‚úèÔ∏è Êõ∏„ÅçÊèõ„ÅàÂæå:"}),u.jsx("div",{className:"sentence-display target",children:(ae=z.question||z.targetSentence)==null?void 0:ae.split("____").map((U,ue,Me)=>u.jsxs("span",{children:[U,ue<Me.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},ue))})]}):u.jsx("div",{className:"sentence-display",children:(Ce=z.sentence)==null?void 0:Ce.split("____").map((U,ue,Me)=>u.jsxs("span",{children:[U,ue<Me.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},ue))}),z.choices&&z.choices.length>0?u.jsxs("div",{className:"choices-grid",children:[z.choices.map((U,ue)=>{const Me=se===U,qe=U===z.correctAnswer,Oe=Pe&&qe,_e=Pe&&Me&&!qe;return u.jsxs("button",{className:`choice-button ${Me?"selected":""} ${Oe?"correct":""} ${_e?"incorrect":""}`,onClick:()=>Xe(U),disabled:Pe,children:[U,Oe&&" ‚úì",_e&&" ‚úó"]},ue)}),u.jsxs("button",{className:`choice-button dont-know ${se==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""} ${Pe&&se==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"incorrect":""}`,onClick:()=>Xe("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:Pe,children:["ÂàÜ„Åã„Çâ„Å™„ÅÑ",Pe&&se==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"&&" ‚úó"]})]}):u.jsxs("div",{className:"text-input-container",children:[u.jsx("input",{type:"text",className:"text-answer-input",value:Fe,onChange:U=>ge(U.target.value),onKeyPress:U=>{U.key==="Enter"&&Fe.trim()&&Xe(Fe.trim())},placeholder:"Á≠î„Åà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",disabled:Pe,autoFocus:!0}),u.jsx("button",{className:"submit-answer-button",onClick:()=>Xe(Fe.trim()),disabled:Pe||!Fe.trim(),children:"ÂõûÁ≠î„Åô„Çã"}),u.jsx("button",{className:`choice-button dont-know ${se==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""}`,onClick:()=>Xe("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:Pe,children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]})]}),Pe&&u.jsx(u.Fragment,{children:le?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:`result-box ${Bt()?"correct":"incorrect"}`,children:[u.jsx("div",{className:"result-header",children:Bt()?"‚úÖ Ê≠£Ëß£ÔºÅ":"‚ùå ‰∏çÊ≠£Ëß£"}),u.jsx("div",{className:"result-content",children:u.jsxs("div",{className:"answer-comparison",children:[u.jsxs("div",{className:"user-answer",children:[u.jsx("strong",{children:"„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î:"}),u.jsx("br",{}),ze.join(" ")]}),!Bt()&&u.jsxs("div",{className:"correct-answer",children:[u.jsx("strong",{children:"Ê≠£Ëß£:"}),u.jsx("br",{}),z.correctAnswer||z.correctOrder||z.sentence||""]})]})})]}),z.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),z.explanation]})})]}):u.jsx(u.Fragment,{children:z.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),z.explanation]})})})})]})})]}),h&&u.jsx(bx,{mode:"grammar",currentIndex:pt,totalQuestions:st.length,questions:st.map(U=>({word:U.id,difficulty:U.difficulty})),requeuedWords:w(st,pt)})]})}const KJ=Object.freeze(Object.defineProperty({__proto__:null,default:Wk},Symbol.toStringTag,{value:"Module"})),Bk="social-studies-progress";function Mb(){return{termProgress:{},lastUpdated:Date.now(),version:1}}function XJ(n,e){return{term:n,position:35,correctCount:0,incorrectCount:0,lastAnswered:new Date,nextReviewDate:new Date(Date.now()+24*60*60*1e3),field:e}}function Au(){try{const n=localStorage.getItem(Bk);if(!n)return Mb();const e=JSON.parse(n);return Object.values(e.termProgress).forEach(t=>{t.lastAnswered=new Date(t.lastAnswered),t.nextReviewDate=new Date(t.nextReviewDate)}),e}catch(n){return j.error("Á§æ‰ºöÁßëÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n),Mb()}}function QJ(n){try{n.lastUpdated=Date.now(),localStorage.setItem(Bk,JSON.stringify(n))}catch(e){j.error("Á§æ‰ºöÁßëÈÄ≤Êçó„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}function YJ(n,e,t,s=!1){const r=Au();let o=r.termProgress[n];o||(o=XJ(n,e),r.termProgress[n]=o),t?o.correctCount++:o.incorrectCount++;const i=o.position;let a=i;if(t){const l=Math.min(o.correctCount*2,10);a=Math.max(0,i-(5+l))}else{const l=Math.min(o.incorrectCount*2,10);a=Math.min(100,i+((s?15:10)+l))}o.position=a,o.lastAnswered=new Date;const c=JJ(o.position,o.correctCount);o.nextReviewDate=new Date(Date.now()+c),QJ(r),j.log(`Á§æ‰ºöÁßëÈÄ≤ÊçóÊõ¥Êñ∞: ${n}`,{field:e,isCorrect:t,isDontKnow:s,oldPosition:i,newPosition:a,correctCount:o.correctCount,incorrectCount:o.incorrectCount})}function JJ(n,e){const t={mastered:6048e5,learning:2592e5,stillLearning:864e5,incorrect:216e5};let s;n<=20?s=t.mastered:n<=40?s=t.learning:n<=70?s=t.stillLearning:s=t.incorrect;const r=Math.min(2,1+e*.1);return s*r}class Jr{static recordDataSave(e,t,s){this.enabled&&this.addEvent({type:"data-save",success:e,duration:t,errorMessage:s,timestamp:Date.now()})}static recordAIAnalysis(e,t,s,r){this.enabled&&this.addEvent({type:"ai-analysis",category:e,confidence:t,actualResult:s,errorMessage:r,timestamp:Date.now()})}static recordCategoryDetermination(e,t,s,r){this.enabled&&this.addEvent({type:"category-determination",category:e,confidence:t,duration:s,actualResult:r,timestamp:Date.now()})}static recordPriorityCalculation(e,t=!0){this.enabled&&this.addEvent({type:"priority-calculation",duration:e,success:t,timestamp:Date.now()})}static addEvent(e){this.events.push(e),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}static getMetrics(){const e=this.events.filter(o=>o.type==="data-save"),t=this.events.filter(o=>o.type==="ai-analysis"),s=this.events.filter(o=>o.type==="category-determination"),r=this.events.filter(o=>o.type==="priority-calculation");return{dataSave:{totalAttempts:e.length,successRate:e.length>0?e.filter(o=>o.success).length/e.length:0,avgDuration:e.length>0?e.reduce((o,i)=>o+(i.duration||0),0)/e.length:0,errorRate:e.length>0?e.filter(o=>!o.success).length/e.length:0},aiAnalysis:{totalAnalyses:t.length,avgConfidence:t.length>0?t.reduce((o,i)=>o+(i.confidence||0),0)/t.length:0,accuracy:t.filter(o=>o.actualResult).length>0?t.filter(o=>o.actualResult&&o.category===o.actualResult).length/t.filter(o=>o.actualResult).length:0,lowConfidenceRate:t.length>0?t.filter(o=>(o.confidence||0)<.7).length/t.length:0},categoryDetermination:{total:s.length,avgConfidence:s.length>0?s.reduce((o,i)=>o+(i.confidence||0),0)/s.length:0,accuracy:s.filter(o=>o.actualResult).length>0?s.filter(o=>o.actualResult&&o.category===o.actualResult).length/s.filter(o=>o.actualResult).length:0},priorityCalculation:{total:r.length,avgDuration:r.length>0?r.reduce((o,i)=>o+(i.duration||0),0)/r.length:0}}}static report(){if(!this.enabled)return;const e=this.getMetrics();console.group("üìà Quality Report"),console.group("üíæ Data Save"),console.log(`Total Attempts: ${e.dataSave.totalAttempts}`),console.log(`Success Rate: ${(e.dataSave.successRate*100).toFixed(2)}%`),console.log(`Avg Duration: ${e.dataSave.avgDuration.toFixed(2)}ms`),console.log(`Error Rate: ${(e.dataSave.errorRate*100).toFixed(2)}%`),console.groupEnd(),console.group("ü§ñ AI Analysis"),console.log(`Total Analyses: ${e.aiAnalysis.totalAnalyses}`),console.log(`Avg Confidence: ${(e.aiAnalysis.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),console.log(`Low Confidence Rate: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`),console.groupEnd(),console.group("üè∑Ô∏è Category Determination"),console.log(`Total: ${e.categoryDetermination.total}`),console.log(`Avg Confidence: ${(e.categoryDetermination.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.categoryDetermination.accuracy*100).toFixed(2)}%`),console.groupEnd(),console.group("‚öñÔ∏è Priority Calculation"),console.log(`Total: ${e.priorityCalculation.total}`),console.log(`Avg Duration: ${e.priorityCalculation.avgDuration.toFixed(2)}ms`),console.groupEnd(),console.groupEnd()}static export(){return JSON.stringify({timestamp:new Date().toISOString(),events:this.events,metrics:this.getMetrics()},null,2)}static saveToStorage(){try{localStorage.setItem("quality-monitor-data",this.export()),console.log("‚úÖ Quality data saved to localStorage")}catch(e){console.error("‚ùå Failed to save quality data:",e)}}static loadFromStorage(){try{const e=localStorage.getItem("quality-monitor-data");if(e){const t=JSON.parse(e);this.events=t.events||[],console.log(`‚úÖ Loaded ${this.events.length} quality events from localStorage`)}}catch(e){console.error("‚ùå Failed to load quality data:",e)}}static clear(){this.events=[],localStorage.removeItem("quality-monitor-data")}static checkThresholds(){if(!this.enabled)return;const e=this.getMetrics();e.dataSave.successRate<.99&&e.dataSave.totalAttempts>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] Data save success rate is low: ${(e.dataSave.successRate*100).toFixed(2)}%`),e.aiAnalysis.accuracy<.9&&e.aiAnalysis.totalAnalyses>=20&&console.warn(`‚ö†Ô∏è [QualityMonitor] AI analysis accuracy is low: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),e.aiAnalysis.lowConfidenceRate>.3&&e.aiAnalysis.totalAnalyses>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] High rate of low-confidence analyses: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`)}static startPeriodicCheck(e=6e4){return setInterval(()=>{this.checkThresholds()},e)}}me(Jr,"events",[]),me(Jr,"maxEvents",1e3),me(Jr,"enabled",!1);Jr.enabled&&(Jr.loadFromStorage(),window.addEventListener("beforeunload",()=>{Jr.saveToStorage()}),Jr.startPeriodicCheck(6e4));const Fb="ab_anonymous_user_id_v1";function Vk(){try{const n=localStorage.getItem(Fb);if(n)return n;const e=`anon_${Date.now()}_${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem(Fb,e),e}catch{return console.warn("[AB Identity] localStorage not available, using session-only ID"),`temp_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}}function ZJ(){const n=Vk(),e=Date.now(),t=Math.random().toString(36).substring(2,11);return`${n}-${e}-${t}`}function eZ(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}function tZ(n){switch(eZ(n)%3){case 0:return"A";case 1:return"B";case 2:return"C";default:return"A"}}function nZ(n){var e;try{const s=(e=nt().wordProgress)==null?void 0:e[n];if(!s)return!1;const r=s.memorizationPosition??50;return r>=0&&r<20}catch(t){return console.warn(`[AB Snapshot] Failed to check mastered status for "${n}":`,t),!1}}function sZ(n){const e=[];for(const t of n)nZ(t)&&e.push(t);return e}function rZ(n){return n.map(e=>e.word)}const oZ={targetScore:30,warningScore:40,criticalScore:50,fallbackQuestionCount:20};function iZ(n,e=0,t=oZ){let s="good",r=!1,o=!1,i="";return n<=t.targetScore?(s="good",i="ÊåØÂãï„Çπ„Ç≥„Ç¢ËâØÂ•Ω"):n<=t.warningScore?(s="warning",i="ÊåØÂãï„Çπ„Ç≥„Ç¢Ê≥®ÊÑè„É¨„Éô„É´"):n<=t.criticalScore?(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®"):(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®",e>=2&&(o=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™ÂåñÁ∂ôÁ∂ö: variant=A„Å∏ÂàáÊàª„ÅóÊé®Â•®")),{level:s,shouldFallback:r,shouldSwitchToA:o,score:n,message:i}}function aZ(n,e,t){try{const s=`ab_consecutive_critical_${n}_${e}`,r=parseInt(localStorage.getItem(s)||"0",10),o=t?r+1:0;return localStorage.setItem(s,String(o)),o}catch{return 0}}function cZ(n,e,t,s,r){try{const o={sessionId:n,variant:e,timestamp:Date.now(),score:t,level:s,fallbackApplied:r},i=JSON.parse(localStorage.getItem("ab_vibration_history")||"[]");i.push(o),i.length>300&&i.splice(0,i.length-300),localStorage.setItem("ab_vibration_history",JSON.stringify(i))}catch{}}const lZ=[{id:"all",name:"Âè§ÊñáÁ∑èÂêà"},{id:"vocabulary",name:"Âè§ÊñáÂçòË™û"},{id:"knowledge",name:"Âè§ÊñáÁü•Ë≠ò"},{id:"grammar",name:"Âè§ÊñáÊñáÊ≥ï"},{id:"kanbun",name:"Êº¢ÊñáÁ∑èÂêà"},{id:"kanbun-practice",name:"Êº¢ÊñáÂÆüË∑µ"}];function pc(n){if(Array.isArray(n))return n.map(e=>String(e).trim()).filter(Boolean);if(typeof n=="string"){const e=n.trim();return e?e.split("|").map(t=>t.trim()).filter(Boolean):[]}return[]}function uZ(n){const e=pc(n.relatedFields);if(e.length>0)return e[0];const t=String(n.source||"");return t==="history"?"Ê≠¥Âè≤-Áèæ‰ª£":t==="geography"?"Âú∞ÁêÜ-Êó•Êú¨":t==="civics"?"ÂÖ¨Ê∞ë-ÊîøÊ≤ª":"Ê≠¥Âè≤-Áèæ‰ª£"}function Uk({subject:n="english",allDataSourceLabel:e,allQuestions:t,questionSets:s,customQuestionSets:r=[],onAddWordToCustomSet:o,onRemoveWordFromCustomSet:i,onOpenCustomSetManagement:a,initialBatchSize:c,initialIncorrectLimit:l}){var tu;const d=n==="social"||n==="japanese",h="japanese-classical-source",[f,p]=N.useState(()=>{if(n!=="japanese")return"all";try{return localStorage.getItem(h)||"all"}catch{return"all"}}),m=!0;N.useEffect(()=>{try{localStorage.setItem("debug_useCategorySlots",JSON.stringify({enabled:m,source:"hardcoded",timestamp:Date.now()}))}catch{}},[m]);const[g,x]=N.useState(!1),[y,b]=N.useState("all"),[w,v]=N.useState("all"),[S,C]=N.useState("all"),[k,I]=N.useState("all"),A=(()=>{try{const ye=n==="japanese"?"japanese-memorization-batch-size":"memorization-batch-size",Ee=localStorage.getItem(ye);return Ee?parseInt(Ee):null}catch{return null}})(),T=(()=>{try{const ye=n==="japanese"?"japanese-memorization-review-ratio-limit":"memorization-review-ratio-limit",Ee=localStorage.getItem(ye);return Ee?parseInt(Ee):20}catch{return 20}})(),[E,$]=N.useState({showWord:!0,showMeaning:!0,showPronunciation:!1,showExample:!1,showEtymology:!1,showRelated:!1}),[D,M]=N.useState(!1),[P,L]=N.useState(!0),[O,F]=N.useState(!1),[V,G]=N.useState(1.5),[_,Z]=N.useState(null),[te,he]=N.useState(0),[oe,ve]=N.useState([]),$e=N.useCallback(ye=>{const Ee=typeof ye=="function"?ye(oe):ye;ve(Ee)},[oe,m]),[Ae]=N.useState(()=>`session-${Date.now()}`),[De,we]=N.useState(0),[Re]=N.useState(()=>ZJ()),[et]=N.useState(()=>tZ(Re)),[je]=N.useState(()=>Date.now()),[lt,ht]=N.useState([]),[it,st]=N.useState([]),[Ye,pt]=N.useState(0),[Tt,se]=N.useState(0),[Ge,ze]=N.useState(!1),[Nt,sn]=N.useState(0),[Ht,Fe]=N.useState(!1),{sessionStats:ge,setSessionStats:Pe}=eu("memorization"),[tt,vt]=N.useState(0),[Yt,gn]=N.useState(0),[jt,hn]=N.useState(0),[un,Et]=N.useState(!1),[q,re]=N.useState(null),[ne,B]=N.useState(0),z=(ye,Ee,We)=>{try{const Mt=localStorage.getItem("debug_reschedule_events"),ot=Mt?JSON.parse(Mt):[];ot.push({timestamp:new Date().toISOString(),mode:"memorization",phase:ye,reason:Ee,details:We??{}}),ot.length>30&&ot.shift(),localStorage.setItem("debug_reschedule_events",JSON.stringify(ot))}catch{}},[le,ee]=N.useState(void 0),[be,He]=N.useState(void 0),[Qe,ke]=N.useState(0),[xe,K]=N.useState(0),[pe,Ne]=N.useState(null),Xe=N.useRef(0),[dt,rt]=N.useState(!0),[at,Bt]=N.useState(!1),Vt=N.useRef(0),Be=N.useRef(null),ae=N.useRef(null),[Ce,U]=N.useState(!1),[ue,Me]=N.useState(()=>!1),[qe,Oe]=N.useState([]);N.useEffect(()=>{},[ue]),N.useEffect(()=>{},[]),N.useCallback(()=>{Oe([])},[]),N.useEffect(()=>{qe.length>100&&Oe(ye=>ye.slice(-100))},[qe]);const _e=uf(Ja.MEMORIZATION),{processQuestion:Se}=lf(),[ft]=N.useState(()=>new $s),It=N.useRef(0),rn=N.useRef(null),nn=N.useRef(ge);N.useEffect(()=>{It.current=te,rn.current=(_==null?void 0:_.word)??null,nn.current=ge},[te,_==null?void 0:_.word,ge]),N.useEffect(()=>{const ye=Ee=>{const We=Ee,{word:Mt,position:ot,mode:Nn}=We.detail;Nn==="memorization"&&(Et(!0),re(`Âº±ÁÇπË™ûÊ§úÂá∫: ${Mt} (Position=${ot})`))};return window.addEventListener("weak-word-detected",ye),()=>{window.removeEventListener("weak-word-detected",ye)}},[]);const{updateRequeueStats:St}=Jl(),Ke=N.useRef(null),Ct=N.useRef(null),Ut=N.useCallback((ye,Ee)=>{var Ks;const ot=((Ks=Ct.current)==null?void 0:Ks.ratio)??.15+Math.random()*.15,Nn=Math.min(ye+30,Ee),zr=Math.min(ye+3,Nn),xr=[];for(let gs=zr;gs<=Nn;gs++)xr.push(gs);if(xr.length===0){Ke.current=[],Ct.current={ratio:ot,lookahead:30,minOffset:3};return}const oi=Math.max(1,Math.round(xr.length*ot)),ea=Math.min(oi,xr.length),Is=new Set;for(;Is.size<ea;){const gs=xr[Math.floor(Math.random()*xr.length)];Is.add(gs)}Ke.current=Array.from(Is).sort((gs,cs)=>gs-cs),Ct.current={ratio:ot,lookahead:30,minOffset:3}},[]);N.useCallback((ye,Ee)=>{const Mt=(Ke.current??[]).filter(zr=>zr>ye);Ke.current=Mt,Mt.length===0&&Ut(ye,Ee);const ot=Ke.current??[],Nn=ot.shift();return Ke.current=ot,typeof Nn=="number"?Nn:null},[Ut]),N.useCallback(ye=>{const Ee=Ke.current??[];Ee.includes(ye)||(Ee.push(ye),Ee.sort((We,Mt)=>We-Mt),Ke.current=Ee)},[]),N.useCallback(ye=>{const Ee=Ke.current;!Ee||Ee.length===0||(Ke.current=Ee.map(We=>We>=ye?We+1:We))},[]),N.useMemo(()=>{Ft.start("calculate-category-stats");const ye=ge.total??0,Ee={incorrect:ge.incorrect,still_learning:ge.still_learning??0,correct:ge.correct,mastered:ge.mastered,total:ye,incorrectRate:ye>0?ge.incorrect/ye:0,correctRate:ye>0?ge.correct/ye:0};return Ft.end("calculate-category-stats"),Ee},[ge.incorrect,ge.still_learning,ge.correct,ge.mastered,ge.total]);const xn=N.useRef(null);N.useEffect(()=>{if(tt===0||d)return;const Ee=setTimeout(()=>{const We=Date.now();if(xn.current&&We-xn.current.timestamp<5e3){const ot=xn.current.data;Pe(Nn=>({...Nn,incorrect:ot.incorrect,still_learning:ot.still_learning,mastered:ot.mastered,correct:Nn.correct}));return}const Mt=px(oe,"memorization");xn.current={data:Mt,timestamp:We},Pe(ot=>({...ot,incorrect:Mt.incorrect,still_learning:Mt.still_learning,mastered:Mt.mastered,correct:ot.correct}))},100);return()=>clearTimeout(Ee)},[tt]),N.useMemo(()=>{Ft.start("get-available-categories");const ye=new Set;t.forEach(We=>{pc(We.relatedFields).forEach(Mt=>ye.add(Mt))});const Ee=Array.from(ye).sort();return Ft.end("get-available-categories"),Ee},[t]),N.useMemo(()=>{Ft.start("filter-questions");let ye=t;if(ye=ye.filter(Ee=>typeof(Ee==null?void 0:Ee.word)=="string"),y!=="all"){const Ee=s.find(We=>We.id===y);Ee?ye=Ee.questions.filter(We=>typeof(We==null?void 0:We.word)=="string"):ye=ye.filter(We=>We.source===y)}return S!=="all"&&(ye=ye.filter(Ee=>Ee.difficulty===S)),w!=="all"&&(ye=ye.filter(Ee=>pc(Ee.relatedFields).includes(w))),k==="words"?ye=ye.filter(Ee=>!Ee.word.includes(" ")||Ee.word.split(" ").length<=2):k==="phrases"&&(ye=ye.filter(Ee=>Ee.word.includes(" ")&&Ee.word.split(" ").length>2)),Ft.end("filter-questions"),ye},[t,s,y,S,w,k]),N.useEffect(()=>{(async()=>{try{const Ee=await lx();Ee&&$(Ee);const We=await dx();We&&(M(We.autoVoice||!1),L(We.voiceWord!==void 0?We.voiceWord:!0),F(We.voiceMeaning||!1),G(We.voiceDelay!==void 0?We.voiceDelay:1.5)),rt(!1)}catch(Ee){j.error("Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Ee),rt(!1)}})()},[]);const es=()=>{const ye=new Set;return t.forEach(Ee=>{pc(Ee.relatedFields).forEach(We=>ye.add(We))}),Array.from(ye).sort()};N.useRef({});const mt=N.useRef(0);N.useEffect(()=>{if(dt&&!at)return;mt.current+=1,mt.current,(async()=>{try{at&&Bt(!1);let Ee=t;if(y!=="all"){const kt=s.find(Gt=>Gt.id===y);kt?Ee=kt.questions:Ee=t.filter(Gt=>Gt.source===y)}if(Ee.length===0){j.warn("[MemorizationView] ÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}let We=Ee;if(We=We.filter(kt=>typeof(kt==null?void 0:kt.word)=="string"),S!=="all"&&(We=We.filter(kt=>kt.difficulty===S)),w!=="all"&&(We=We.filter(kt=>pc(kt.relatedFields).includes(w))),k==="words"?We=We.filter(kt=>!kt.word.includes(" ")||kt.word.split(" ").length<=2):k==="phrases"&&(We=We.filter(kt=>kt.word.includes(" ")&&kt.word.split(" ").length>2)),We.length===0){j.warn("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂïèÈ°å„Åå0‰ª∂„Åß„Åô");return}j.info("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂçòË™ûÊï∞",{totalFiltered:We.length,sessionStats:{correct:ge.correct,incorrect:ge.incorrect,still_learning:ge.still_learning||0}});let Mt={};if(d){const Gt=Au().termProgress||{};for(const[ii,gt]of Object.entries(Gt)){const Fn=gt.correctCount??0,ts=gt.incorrectCount??0,Rn=Fn+ts;Mt[ii]={word:ii,correctCount:Fn,incorrectCount:ts,totalAttempts:Rn,memorizationAttempts:Rn,memorizationCorrect:Fn,memorizationPosition:gt.position??35,lastStudied:gt.lastAnswered?new Date(gt.lastAnswered).getTime():0,nextReviewDate:gt.nextReviewDate?new Date(gt.nextReviewDate).getTime():void 0,streak:0}}}else await bs(),Mt=nt().wordProgress||{};const ot=[],Nn=Object.entries(Mt).filter(([kt,Gt])=>(Gt.memorizationAttempts??Gt.totalAttempts??0)<=0?!1:(d?Gt.memorizationPosition??35:Jt(Gt,"memorization"))>=40).map(([kt,Gt])=>({word:kt,position:d?Gt.memorizationPosition??35:Jt(Gt,"memorization"),memPos:Gt.memorizationPosition,attempts:Gt.memorizationAttempts??Gt.totalAttempts??0})),zr=new Set(Ee.map(kt=>kt.word)),xr=Nn.filter(kt=>!zr.has(kt.word));try{localStorage.setItem("debug_weak_words_detection",JSON.stringify({timestamp:new Date().toISOString(),allWeakWordsInLS:Nn.length,weakWordsList:Nn,missingFromBase:xr.map(kt=>kt.word),baseQuestionsCount:Ee.length,filteredCount:We.length}))}catch{}for(const kt of Ee){const Gt=Mt[kt.word];if(!Gt||(Gt.memorizationAttempts??Gt.totalAttempts??0)<=0)continue;(d?Gt.memorizationPosition??35:Jt(Gt,"memorization"))>=40&&ot.push(kt)}try{const kt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");localStorage.setItem("debug_weak_words_detection",JSON.stringify({...kt,weakQuestionsCount:ot.length,weakQuestionsWords:ot.map(Gt=>Gt.word)}))}catch{}try{const kt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");kt.weakQuestionsDetected=ot.length,kt.weakQuestionsWords=ot.map(Gt=>Gt.word),kt.dataMissing=Nn.length-ot.length,localStorage.setItem("debug_weak_words_detection",JSON.stringify(kt))}catch{}let oi=We;if(ot.length>0){const kt=new Map;for(const Gt of We)kt.set(Gt.word,Gt);for(const Gt of ot)kt.set(Gt.word,Gt);oi=Array.from(kt.values())}let ea;const Is=await ft.schedule({questions:oi,mode:"memorization",useCategorySlots:m,batchSize:A||void 0,sessionStats:{correct:nn.current.correct,incorrect:nn.current.incorrect,still_learning:nn.current.still_learning||0,mastered:nn.current.mastered||0,duration:Date.now()-Xe.current},isReviewFocusMode:Ht,hybridMode:et==="B",finalPriorityMode:et==="C",progressOverride:d?Mt:void 0});if(!Is||!Is.scheduledQuestions){j.error("[MemorizationView] „Çπ„Ç±„Ç∏„É•„Éº„É´ÁµêÊûú„ÅåÁÑ°Âäπ„Åß„Åô",{scheduleResult:Is});return}const Ks=Is.scheduledQuestions,gs={totalScheduled:Ks.length,top10Words:Ks.slice(0,10).map(kt=>kt.word),timestamp:new Date().toISOString()};try{localStorage.setItem("debug_memorization_latest",JSON.stringify(gs))}catch{}const cs=Is.vibrationScore,df=Vk(),po=iZ(cs,Tt),ta=aZ(df,et,po.level==="critical");if(se(ta),cZ(Re,et,cs,po.level,po.shouldFallback),po.shouldFallback&&!Ge&&(et==="B"||et==="C")&&(j.warn("[MemorizationView] ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈÅ©Áî®",{score:cs,variant:et,consecutiveCritical:ta}),ze(!0),Ks.splice(20)),po.shouldSwitchToA&&j.error("[MemorizationView] variant=AÂàáÊàª„ÅóÊé®Â•®",{score:cs,variant:et,consecutiveCritical:ta,message:po.message}),Is.vibrationScore>50&&j.warn("[MemorizationView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:Is.vibrationScore,processingTime:Is.processingTime}),$e(Ks),Ks.length>0&&te===0&&!_){const kt=rZ(Ks);st(kt),pt(Is.vibrationScore);const Gt=sZ(kt);ht(Gt)}if(Ks.length>0&&te===0&&!_){const kt=Ks[0];Z(kt),he(0),Xe.current=Date.now()}}catch(Ee){j.error("[MemorizationView] ÂïèÈ°åÈÅ∏Êäû„Ç®„É©„Éº:",Ee),rt(!1)}})()},[y,S,w,k,t,dt,Ht,at]);const Le=()=>{Fe(!Ht)},yt=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:ye}=await On(async()=>{const{resetAllProgress:Ee}=await Promise.resolve().then(()=>wi);return{resetAllProgress:Ee}},void 0);await ye(),Pe({correct:0,still_learning:0,incorrect:0,review:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),ke(0),K(0),he(0),pt(0),se(0),sn(0),j.info("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(ye){j.error("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",ye),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Wt=()=>{},yn=async(ye,Ee)=>{try{const We=ot=>{const Nn=(ot.grade||1)/9;return Math.min(Math.max(Nn,0),1)},Mt=()=>{const ot=new Date().getHours();return ot<12?"morning":ot<18?"afternoon":ot<22?"evening":"night"};_&&await Se(ye,Ee?"correct":"incorrect",{currentDifficulty:We(_),timeOfDay:Mt(),recentErrors:ge.incorrect,sessionLength:Math.floor((Date.now()-Xe.current)/6e4),consecutiveCorrect:Qe})}catch(We){console.error("[MemorizationView] Adaptive AI error:",We)}};N.useRef(0),N.useEffect(()=>{},[un,dt,oe,A,T,ge,et,ft,jt,q]),N.useEffect(()=>{if(!_||!D||ae.current===_.word)return;ae.current=_.word,(async()=>{if(P&&kr(_.word,{rate:.85}),O&&_.meaning){await new Promise(We=>setTimeout(We,V*1e3));const Ee=new SpeechSynthesisUtterance(_.meaning);Ee.lang="ja-JP",Ee.rate=.85,window.speechSynthesis.speak(Ee)}})()},[_,D,P,O,V]);const fo=()=>{U(!Ce)},Ps=async ye=>{if(ye==="showWord")return;const Ee={...E,[ye]:!E[ye]};$(Ee),await cx(Ee)},Lr=async(ye,Ee,We,Mt)=>{M(ye),L(Ee),F(We),Mt!==void 0&&G(Mt),await ux({autoVoice:ye,voiceWord:Ee,voiceMeaning:We,voiceDelay:Mt!==void 0?Mt:V,interleavingMode:"off",cardDisplaySettings:E})},Ms=N.useCallback(async ye=>{var ta,kt,Gt,ii;if(!_)return;const Ee=(Date.now()-Xe.current)/1e3,We=ye==="right",Mt=ye==="center",ot=_,Nn=Ee,zr=te;ee(We),He(_.word),We?(ke(gt=>gt+1),K(0)):Mt?(ke(0),K(0)):(K(gt=>gt+1),ke(0)),Pe(gt=>{const Fn=_.reAddedCount&&_.reAddedCount>0;let ts=gt.incorrect,Rn=gt.still_learning??0;return We&&Fn&&(ts>0?ts=Math.max(0,ts-1):Rn>0&&(Rn=Math.max(0,Rn-1))),{correct:We?gt.correct+1:gt.correct,still_learning:Mt?(Rn??0)+1:Rn??0,incorrect:!We&&!Mt?ts+1:ts,review:gt.review,mastered:We?gt.mastered+1:gt.mastered,total:gt.total??0,newQuestions:gt.newQuestions,reviewQuestions:gt.reviewQuestions,consecutiveNew:gt.consecutiveNew,consecutiveReview:gt.consecutiveReview}}),Ft.start("quick-category-determination");const xr=(()=>{var ts,Rn;if(d){const xs=(ts=Au().termProgress)==null?void 0:ts[ot.word];return(xs==null?void 0:xs.position)??35}const Fn=(Rn=nt().wordProgress)==null?void 0:Rn[ot.word];return Jt(Fn,"memorization")})(),oi=bc(xr),ea=Ft.end("quick-category-determination");ea>50&&Ft.warnIfSlow("quick-category-determination",ea,50),Jr.recordCategoryDetermination(oi,1,ea);const Is=We?"correct":Mt?"still_learning":"incorrect",Ks=We?"mastered":Mt?"still_learning":"incorrect";if(Oe(gt=>[...gt,{word:ot.word,answer:Is,countedAs:Ks,position:xr,timestamp:Date.now()}]),Nn<16){Ft.start("data-save");try{if(d){const Fn=uZ(ot);YJ(ot.word,Fn,We);try{const Rn=(ta=Au().termProgress)==null?void 0:ta[ot.word],yr=(Rn==null?void 0:Rn.position)??35;yr!==ot.position&&$e(xs=>xs.map(Wr=>Wr.word===ot.word?{...Wr,position:yr}:Wr))}catch{}}else{await Wo(ot.word,We,Nn*1e3,void 0,"memorization",Mt);try{const ts=(kt=nt().wordProgress)==null?void 0:kt[ot.word],Rn=Jt(ts,"memorization"),yr=bc(Rn),xs=Zb(yr)&&yr!==oi;Rn!==ot.position&&$e(Wr=>Wr.map(ai=>ai.word===ot.word?{...ai,position:Rn}:ai))}catch(Fn){j.error("[MemorizationView] „Ç´„ÉÜ„Ç¥„É™Â§âÂåñÊ§úÁü•„Ç®„É©„Éº:",Fn)}if(We)try{const ts=(Gt=nt().wordProgress)==null?void 0:Gt[ot.word];Jt(ts,"memorization")<40&&$e(xs=>{if(!Array.isArray(xs)||xs.length===0)return xs;const Wr=Math.min(zr,xs.length-1);return xs.filter((ai,hf)=>hf<=Wr||ai.word!==ot.word?!0:!((ai.reAddedCount||0)>0))})}catch{}}const gt=Ft.end("data-save");Jr.recordDataSave(!0,gt)}catch(gt){const Fn=Ft.end("data-save");Jr.recordDataSave(!1,Fn,String(gt)),j.error("[MemorizationView] Â≠¶Áøí„Éá„Éº„ÇøË®òÈå≤„Ç®„É©„Éº:",gt)}finally{vt(Date.now())}Promise.all([(async()=>{try{const gt={word:ot.word,timestamp:Date.now(),viewDuration:Nn,swipeDirection:ye==="center"?"left":ye,sessionId:Ae,consecutiveViews:De+1};await hx(gt),we(Fn=>Fn+1)}catch(gt){j.error("[MemorizationView] Ë°åÂãïË®òÈå≤„Ç®„É©„Éº:",gt)}})(),(async()=>{try{_e.recordAnswer(ot.word,We,Nn*1e3)}catch(gt){j.error("[MemorizationView] Áµ±Ë®àË®òÈå≤„Ç®„É©„Éº:",gt)}})(),(async()=>{await new Promise(gt=>setTimeout(gt,1e3)),Ft.start("ai-detailed-analysis");try{await yn(ot.word,We);const gt=Ft.end("ai-detailed-analysis")}catch(gt){Ft.end("ai-detailed-analysis"),j.error("[MemorizationView] AIÂàÜÊûê„Ç®„É©„Éº:",gt)}})()]).catch(gt=>{j.error("[MemorizationView] „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂá¶ÁêÜ„Ç®„É©„Éº:",gt)})}if(St(_,ge,Pe),Ne(_.word),ft.aiCoordinator)try{const gt=nt(),Fn=(gt==null?void 0:gt.wordProgress)??{},ts=Fn[_.word]??((ii=gt==null?void 0:gt.wordProgress)==null?void 0:ii[_.word])??null;let Rn=0,yr=0,xs=0,Wr=0;for(const ff of Object.values(Fn)){const pf=Jt(ff,"memorization");pf>=70?xs++:pf>=40?yr++:pf>=20?Wr++:Rn++}const hf={totalAttempts:(ge.correct||0)+(ge.incorrect||0)+(ge.still_learning||0)+(ge.mastered||0),correctAnswers:ge.correct||0,incorrectAnswers:ge.incorrect||0,stillLearningAnswers:ge.still_learning||0,sessionStartTime:je,sessionDuration:Date.now()-je,consecutiveIncorrect:0,masteredCount:Rn,stillLearningCount:yr,incorrectCount:xs,newCount:Wr,consecutiveCorrect:ge.consecutiveCorrect||0},Xk={word:{word:_.word,meaning:_.meaning,reading:_.reading,difficulty:_.difficulty,category:_.category,source:_.source,type:_.type,isPhraseOnly:_.isPhraseOnly},progress:ts,sessionStats:hf,currentTab:"memorization",allProgress:Fn},Qk={wasCorrect:We,responseTime:Math.round(Nn*1e3),timestamp:Date.now(),features:[]};ft.aiCoordinator.learn(Xk,Qk).catch(ff=>{console.warn("[ML] learn() failed",ff)})}catch(gt){console.warn("[ML] learn() error",gt)}let gs=oe,cs=te+1;const df=Math.min(cs+20,gs.length);let po=0;for(;cs<df&&gs[cs].word===_.word;)po++,j.warn("[MemorizationView] ÈÄ£Á∂öÂá∫È°å„ÇíÊ§úÂá∫„ÄÅ„Çπ„Ç≠„ÉÉ„Éó",{word:gs[cs].word,nextIndex:cs,skippedCount:po}),cs++;if(cs<gs.length){gs[cs];const gt=gs[cs];Z(gt),he(cs),Xe.current=Date.now(),He(void 0)}else{console.log("üîÑ [„Éê„ÉÉ„ÉÅÊñπÂºè] „Éê„ÉÉ„ÉÅÂÆåÂÖ®Ê∂àÂåñ ‚Üí Ê¨°„ÅÆ„Éê„ÉÉ„ÉÅ„ÇíÁîüÊàê„Åó„Åæ„Åô"),$e([]),Z(null),he(0),Bt(!0);return}},[_,te,oe,Ae,De,ge,A,T]);return N.useEffect(()=>{const ye=Be.current;if(!ye)return;const Ee=ot=>{Vt.current=ot.touches[0].clientX},We=ot=>{const zr=ot.changedTouches[0].clientX-Vt.current;Math.abs(zr)>100&&(zr>0?Ms("right"):Ms("left"))},Mt=ot=>{ot.key==="ArrowLeft"||ot.key==="1"?(ot.preventDefault(),Ms("left")):ot.key==="ArrowDown"||ot.key==="2"?(ot.preventDefault(),Ms("center")):(ot.key==="ArrowRight"||ot.key==="3")&&(ot.preventDefault(),Ms("right"))};return ye.addEventListener("touchstart",Ee),ye.addEventListener("touchend",We),document.addEventListener("keydown",Mt),()=>{ye.removeEventListener("touchstart",Ee),ye.removeEventListener("touchend",We),document.removeEventListener("keydown",Mt)}},[Ms]),dt?u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})}):_?u.jsxs("div",{className:"quiz-view",children:[Ce?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:fo,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4 h-[90vh] flex items-center",children:u.jsxs("div",{ref:Be,className:"question-card h-[600px] sm:h-[650px] md:h-[700px] flex flex-col w-full",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${kn()?"clickable-pronunciation":""}`,onClick:ye=>{kn()&&(ye.preventDefault(),ye.stopPropagation(),kr(_.word,{rate:.85}))},onTouchEnd:ye=>{kn()&&(ye.preventDefault(),ye.stopPropagation(),kr(_.word,{rate:.85}))},title:kn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${_.word.includes(" ")?"phrase-text":""} ${kn()?"clickable-word":""}`,children:[_.word,kn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),_.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",_.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[_.difficulty&&u.jsx("div",{className:`difficulty-badge ${_.difficulty}`,children:_.difficulty==="beginner"?"ÂàùÁ¥ö":_.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),o&&i&&a&&u.jsx(xc,{word:{word:_.word,meaning:_.meaning,ipa:_.reading,source:"memorization"},sets:r,onAddWord:o,onRemoveWord:i,onOpenManagement:a,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4 flex-shrink-0",children:[u.jsxs("button",{onClick:()=>Ms("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>Ms("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>Ms("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),o&&i&&a&&u.jsx("div",{className:"mb-2 flex justify-center flex-shrink-0",children:u.jsx(xc,{word:{word:_.word,meaning:_.meaning,ipa:_.reading,source:"memorization"},sets:r,onAddWord:o,onRemoveWord:i,onOpenManagement:a,size:"medium",variant:"both"})}),u.jsxs("div",{className:"space-y-3 overflow-y-auto flex-1 min-h-0",children:[u.jsx("button",{onClick:()=>Ps("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showMeaning?"‚ñº":"‚ñ∂"})]}),E.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words text-overflow-safe",children:_.meaning})]})}),_.etymology&&_.etymology.trim()!==""&&_.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>Ps("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showEtymology?"‚ñº":"‚ñ∂"})]}),E.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.etymology})]})}),_.relatedWords&&_.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>Ps("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showRelated?"‚ñº":"‚ñ∂"})]}),E.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.relatedWords})]})}),_.example1&&_.example1.trim()!==""&&u.jsx("button",{onClick:()=>Ps("showExample"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"‰æãÊñá1"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showExample?"‚ñº":"‚ñ∂"})]}),E.showExample&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.example1})]})}),_.example2&&_.example2.trim()!==""&&u.jsx("button",{onClick:()=>Ps("showExample"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"‰æãÊñá2"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showExample?"‚ñº":"‚ñ∂"})]}),E.showExample&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.example2})]})})]})]})})]})}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Zl,{mode:"memorization",storageKeyPrefix:n==="japanese"?"japanese":void 0,sessionCorrect:ge.correct,sessionReview:ge.still_learning,sessionIncorrect:ge.incorrect,totalAnswered:ge.total,currentWord:_==null?void 0:_.word,onAnswerTime:tt,learningStatusTabPulseKey:ne,lastAnswerCorrect:le,lastAnswerWord:be,lastAnswerDifficulty:_==null?void 0:_.difficulty,correctStreak:Qe,incorrectStreak:xe,learningPhase:_e.state.currentPhase??void 0,estimatedSpeed:(tu=_e.state.personalParams)==null?void 0:tu.learningSpeed,onShowSettings:()=>x(!0),dataSource:y,category:w==="all"?"ÂÖ®ÂàÜÈáé":w,difficulty:S,wordPhraseFilter:k,onReviewFocus:Le,isReviewFocusMode:Ht,onResetProgress:yt,onDebugRequeue:Wt})})}),g&&u.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-lg p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold",children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"space-y-4",children:[n==="japanese"&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"japanese-classical-datasource",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsx("select",{id:"japanese-classical-datasource",value:f,onChange:ye=>{const Ee=ye.target.value;p(Ee);try{localStorage.setItem(h,Ee)}catch{}window.dispatchEvent(new Event("japanese-classical-source-changed"))},className:"w-full px-3 py-2 border rounded-lg",children:lZ.map(ye=>u.jsx("option",{value:ye.id,children:ye.name},ye.id))})]}),n!=="japanese"&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-datasource",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsxs("select",{id:"memorization-datasource",value:y,onChange:ye=>b(ye.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:e||"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà"}),s.filter(ye=>ye.id!=="all").map(ye=>u.jsx("option",{value:ye.id,children:ye.name},ye.id))]})]}),n==="english"&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-filter",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìù ÂçòË™û„ÉªÁÜüË™û:"}),u.jsxs("select",{id:"memorization-filter",value:k,onChange:ye=>I(ye.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂçòË™ûÔºãÁÜüË™û"}),u.jsx("option",{value:"words",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),n!=="japanese"&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-category",className:"block text-sm font-medium mb-2 text-gray-700",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"memorization-category",value:w,onChange:ye=>v(ye.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂàÜÈáé"}),es().map(ye=>u.jsx("option",{value:ye,children:ye},ye))]})]}),n==="english"&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-difficulty",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìä Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"memorization-difficulty",value:S,onChange:ye=>C(ye.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®Èõ£ÊòìÂ∫¶"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{htmlFor:"memorization-batch-size",className:"block text-sm font-medium mb-2 text-gray-700",children:"üì¶ „Éê„ÉÉ„ÉÅÊï∞:"}),u.jsxs("select",{id:"memorization-batch-size",value:A??"",onChange:ye=>{const Ee=ye.target.value===""?null:parseInt(ye.target.value);try{const We=n==="japanese"?"japanese-memorization-batch-size":"memorization-batch-size";Ee===null?localStorage.removeItem(We):localStorage.setItem(We,String(Ee)),window.location.reload()}catch{}},className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"",children:"Âà∂Èôê„Å™„Åó"}),u.jsx("option",{value:"10",children:"10Âïè"}),u.jsx("option",{value:"20",children:"20Âïè"}),u.jsx("option",{value:"30",children:"30Âïè"}),u.jsx("option",{value:"50",children:"50Âïè"}),u.jsx("option",{value:"100",children:"100Âïè"}),u.jsx("option",{value:"200",children:"200Âïè"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-review-ratio-limit",className:"block text-sm font-medium mb-2 text-gray-700",children:"‚ùå ‰∏çÊ≠£Ëß£„ÅÆ‰∏äÈôê:"}),u.jsxs("select",{id:"memorization-review-ratio-limit",value:T,onChange:ye=>{const Ee=parseInt(ye.target.value);try{const We=n==="japanese"?"japanese-memorization-review-ratio-limit":"memorization-review-ratio-limit";localStorage.setItem(We,String(Ee)),window.location.reload()}catch{}},className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"10",children:"10%"}),u.jsx("option",{value:"20",children:"20%"}),u.jsx("option",{value:"30",children:"30%"}),u.jsx("option",{value:"40",children:"40%"}),u.jsx("option",{value:"50",children:"50%"})]})]}),n==="english"&&u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üîä Ëá™ÂãïÁô∫Èü≥Ë®≠ÂÆö:"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:D,onChange:ye=>Lr(ye.target.checked,P,O),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ëá™Âãï„ÅßÁô∫Èü≥„Åô„Çã"})]}),D&&u.jsxs("div",{className:"ml-6 space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:P,onChange:ye=>Lr(D,ye.target.checked,O),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ë™ûÂè•„ÇíË™≠„Åø‰∏ä„Åí"})]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:O,onChange:ye=>Lr(D,P,ye.target.checked),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"ÊÑèÂë≥„ÇíË™≠„Åø‰∏ä„Åí"})]}),O&&u.jsxs("div",{className:"ml-6 mt-2",children:[u.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["‚è±Ô∏è Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî: ",V.toFixed(1),"Áßí"]}),u.jsx("input",{type:"range",min:"0.5",max:"5.0",step:"0.5",value:V,onChange:ye=>{const Ee=parseFloat(ye.target.value);G(Ee),Lr(D,P,O,Ee)},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer","aria-label":"Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî"}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0.5Áßí"}),u.jsx("span",{children:"5.0Áßí"})]})]})]})]})]})]})]}),u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:fo,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{ref:Be,className:"question-card w-full h-[600px] sm:h-[650px] md:h-[700px] flex flex-col",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${kn()?"clickable-pronunciation":""}`,onClick:ye=>{kn()&&(ye.preventDefault(),ye.stopPropagation(),kr(_.word,{rate:.85}))},onTouchEnd:ye=>{kn()&&(ye.preventDefault(),ye.stopPropagation(),kr(_.word,{rate:.85}))},title:kn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${_.word.includes(" ")?"phrase-text":""} ${kn()?"clickable-word":""}`,children:[_.word,kn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),_.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",_.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[_.difficulty&&u.jsx("div",{className:`difficulty-badge ${_.difficulty}`,children:_.difficulty==="beginner"?"ÂàùÁ¥ö":_.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),o&&i&&a&&u.jsx(xc,{word:{word:_.word,meaning:_.meaning,ipa:_.reading,source:"memorization"},sets:r,onAddWord:o,onRemoveWord:i,onOpenManagement:a,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[u.jsxs("button",{onClick:()=>Ms("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>Ms("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>Ms("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("button",{onClick:()=>Ps("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showMeaning?"‚ñº":"‚ñ∂"})]}),E.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words text-overflow-safe",children:_.meaning})]})}),_.etymology&&_.etymology.trim()!==""&&_.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>Ps("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showEtymology?"‚ñº":"‚ñ∂"})]}),E.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.etymology})]})}),_.relatedWords&&_.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>Ps("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showRelated?"‚ñº":"‚ñ∂"})]}),E.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.relatedWords})]})}),_.example1&&_.example1.trim()!==""&&u.jsx("button",{onClick:()=>Ps("showExample"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"‰æãÊñá1"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showExample?"‚ñº":"‚ñ∂"})]}),E.showExample&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.example1})]})}),_.example2&&_.example2.trim()!==""&&u.jsx("button",{onClick:()=>Ps("showExample"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"‰æãÊñá2"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:E.showExample?"‚ñº":"‚ñ∂"})]}),E.showExample&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words text-overflow-safe",children:_.example2})]})})]})]})]})})]}),!1]}):u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})})}const dZ=({isOpen:n,onClose:e,sets:t,onCreateSet:s,onDeleteSet:r,onEditSet:o,onRemoveWord:i})=>{const[a,c]=N.useState("manage"),[l,d]=N.useState(""),[h,f]=N.useState(""),[p,m]=N.useState(null),[g,x]=N.useState(null),[y,b]=N.useState(""),[w,v]=N.useState("");if(!n)return null;const S=()=>{l.trim()&&(s(l.trim(),h.trim()||void 0),d(""),f(""),c("manage"))},C=A=>{x(A.id),b(A.name),v(A.description||"")},k=()=>{g&&y.trim()&&(o(g,y.trim(),w.trim()||void 0),x(null))},I=()=>{x(null),b(""),v("")};return u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl sm:max-w-4xl w-full mx-auto max-h-[90vh] flex flex-col",children:[u.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"üìö „Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÁÆ°ÁêÜ"}),u.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700:text-gray-200 text-2xl","aria-label":"Èñâ„Åò„Çã",children:"‚úï"})]}),u.jsxs("div",{className:"flex border-b border-gray-200",children:[u.jsxs("button",{onClick:()=>c("manage"),className:`flex-1 px-6 py-3 font-medium ${a==="manage"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:["üìã „Çª„ÉÉ„ÉàÁÆ°ÁêÜ (",t.length,")"]}),u.jsx("button",{onClick:()=>c("create"),className:`flex-1 px-6 py-3 font-medium ${a==="create"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:"‚ûï Êñ∞Ë¶è‰ΩúÊàê"})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a==="manage"?u.jsx("div",{className:"space-y-4",children:t.length===0?u.jsxs("div",{className:"text-center py-12 text-gray-500",children:[u.jsx("p",{className:"text-lg mb-2",children:"üìù „Åæ„Å†„Çª„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-sm",children:"„ÄåÊñ∞Ë¶è‰ΩúÊàê„Äç„Çø„Éñ„Åã„ÇâÊúÄÂàù„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Çä„Åæ„Åó„Çá„ÅÜ"})]}):t.map(A=>u.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[u.jsx("div",{className:"bg-gray-50 p-4",children:g===A.id?u.jsxs("div",{className:"space-y-2",children:[u.jsx("input",{type:"text",value:y,onChange:T=>b(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"„Çª„ÉÉ„ÉàÂêç"}),u.jsx("textarea",{value:w,onChange:T=>v(T.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ",rows:2}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"‰øùÂ≠ò"}),u.jsx("button",{onClick:I,className:"px-4 py-2 bg-gray-300 text-gray-900 rounded-md hover:bg-gray-400:bg-gray-500",children:"„Ç≠„É£„É≥„Çª„É´"})]})]}):u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-2xl",children:A.icon||"üìñ"}),u.jsx("h3",{className:"text-lg font-bold text-gray-900",children:A.name}),u.jsxs("span",{className:"text-sm text-gray-500",children:["(",A.words.length,"Ë™û)"]})]}),A.description&&u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:A.description}),u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["‰ΩúÊàê: ",new Date(A.createdAt).toLocaleDateString("ja-JP")]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>C(A),className:"text-blue-600 hover:text-blue-700:text-blue-300 text-sm","aria-label":"Á∑®ÈõÜ",children:"‚úèÔ∏è"}),u.jsx("button",{onClick:()=>m(p===A.id?null:A.id),className:"text-gray-600 hover:text-gray-700:text-gray-300 text-sm","aria-label":p===A.id?"Êäò„Çä„Åü„Åü„ÇÄ":"Â±ïÈñã",children:p===A.id?"‚ñ≤":"‚ñº"}),u.jsx("button",{onClick:()=>{confirm(`„Äå${A.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)&&r(A.id)},className:"text-red-600 hover:text-red-700:text-red-300 text-sm","aria-label":"ÂâäÈô§",children:"üóëÔ∏è"})]})]})}),p===A.id&&u.jsx("div",{className:"p-4 bg-white",children:A.words.length===0?u.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"„Åæ„Å†ÂçòË™û„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):u.jsx("div",{className:"space-y-2",children:A.words.map((T,E)=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-semibold text-gray-900",children:T.word}),T.ipa&&u.jsxs("span",{className:"text-sm text-blue-600",children:["/",T.ipa,"/"]})]}),u.jsx("p",{className:"text-sm text-gray-700 mt-1",children:T.meaning}),T.source&&u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Âá∫ÂÖ∏: ",T.source,T.sourceDetail&&` (${T.sourceDetail})`]})]}),u.jsx("button",{onClick:()=>i(A.id,T),className:"ml-4 text-red-600 hover:text-red-700:text-red-300","aria-label":"ÂâäÈô§",children:"‚ûñ"})]},`${T.word}-${E}`))})})]},A.id))}):u.jsxs("div",{className:"max-w-2xl mx-auto",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["„Çª„ÉÉ„ÉàÂêç ",u.jsx("span",{className:"text-red-500",children:"*"})]}),u.jsx("input",{type:"text",value:l,onChange:A=>d(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: Ëã¶Êâã„Å™ÂâçÁΩÆË©û"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ"}),u.jsx("textarea",{value:h,onChange:A=>f(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: È´òÊ†°ÂÖ•Ë©¶„Åß„Çà„ÅèÂá∫„ÇãÂâçÁΩÆË©û„Çí„Åæ„Å®„ÇÅ„Åü„Çª„ÉÉ„Éà",rows:3})]}),u.jsx("button",{onClick:S,disabled:!l.trim(),className:"w-full px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300:bg-gray-600 disabled:cursor-not-allowed font-medium",children:"‚ûï „Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})]}),u.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[u.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"üí° „Éí„É≥„Éà"}),u.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„Éà„Çí‰ΩúÊàêÂæå„ÄÅÂêÑ„Çø„Éñ„ÅÆ+„Éú„Çø„É≥„ÅßÂçòË™û„ÇíËøΩÂä†„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„ÉàÂêç„ÅØÂæå„Åã„ÇâÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ Ë§áÊï∞„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Å£„Å¶„ÄÅ„ÉÜ„Éº„Éû„Åî„Å®„Å´Êï¥ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ"})]})]})]})})]})})};function hZ({allQuestions:n,onStartSession:e}){const[t,s]=N.useState(null),[r,o]=N.useState(null),[i]=N.useState(3),[a,c]=N.useState({totalLearned:0,totalReviewed:0,averageAccuracy:0,estimatedCompletion:90});if(N.useEffect(()=>{const g=localStorage.getItem("learning-schedule-90days");if(g)try{const x=JSON.parse(g),y=Math.floor((Date.now()-x.startDate)/(1e3*60*60*24)),b=x.totalDays;x.currentDay=Math.min(y+1,b);const w=Math.floor(b/3),v=Math.floor(b*2/3);x.phase=x.currentDay<=w?1:x.currentDay<=v?2:3,s(x),o(bk(x,n))}catch(x){j.error("Failed to load schedule:",x)}},[n]),N.useEffect(()=>{if(t){c(wk(t));const g=document.querySelector(".progress-bar");if(g){const x=t.currentDay,y=t.totalDays,b=x/y*100;g.style.width=`${b}%`}}},[t]),!t)return null;const l=["Âü∫Á§éÂõ∫„ÇÅÊúü","ÂøúÁî®Êã°Â§ßÊúü","ÂÆåÊàê„ÉªÂÆöÁùÄÊúü"],d=t.phase,h=t.currentDay,f=t.totalDays,p=h/f*100,m=vk(t);return u.jsxs("div",{className:"learning-plan-dashboard",children:[u.jsxs("div",{className:"dashboard-header",children:[u.jsxs("div",{className:"day-counter",children:[u.jsx("span",{className:"day-number",children:h}),u.jsxs("span",{className:"day-label",children:["/ ",f,"Êó•ÁõÆ"]})]}),u.jsxs("div",{className:"phase-indicator",children:[u.jsxs("span",{className:`phase-badge phase-${d}`,children:["Phase ",d]}),u.jsx("span",{className:"phase-name",children:l[d-1]})]}),u.jsxs("div",{className:"progress-bar-container",children:[u.jsx("div",{className:`progress-bar phase-${d}`}),u.jsxs("span",{className:"progress-label",children:[p.toFixed(1),"%"]})]})]}),u.jsxs("div",{className:"stats-summary",children:[u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üìö"}),u.jsx("div",{className:"stat-value",children:a.totalLearned}),u.jsx("div",{className:"stat-label",children:"Â≠¶ÁøíÊ∏à„ÅøÂçòË™û"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚úÖ"}),u.jsxs("div",{className:"stat-value",children:[a.averageAccuracy.toFixed(1),"%"]}),u.jsx("div",{className:"stat-label",children:"Âπ≥ÂùáÊ≠£Á≠îÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üéØ"}),u.jsxs("div",{className:"stat-value",children:[m>0?m.toFixed(0):0,"%"]}),u.jsx("div",{className:"stat-label",children:"‰ªäÈÄ±„ÅÆÈÅîÊàêÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚è±Ô∏è"}),u.jsx("div",{className:"stat-value",children:a.estimatedCompletion}),u.jsx("div",{className:"stat-label",children:"ÂÆå‰∫Ü„Åæ„ÅßÔºàÊó•Ôºâ"})]})]}),r&&u.jsxs("div",{className:"today-plan",children:[u.jsxs("h2",{children:["üìñ ‰ªäÊó•„ÅÆÂ≠¶Áøí„Éó„É©„É≥ÔºàDay ",h,"Ôºâ"]}),u.jsxs("div",{className:"session-cards",children:[u.jsxs("div",{className:"session-card morning",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåÖ"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊúùÔºöÊñ∞Ë¶èÂ≠¶Áøí"}),u.jsxs("p",{children:[r.morning.newWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("morning",r.morning.newWords),className:"btn-start-session",disabled:r.morning.newWords.length===0,children:r.morning.newWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card afternoon",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"‚òÄÔ∏è"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊòºÔºöÂº±ÁÇπÂæ©Áøí"}),u.jsxs("p",{children:[r.afternoon.reviewWords.length,"Ë™û ¬∑ 15ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("afternoon",r.afternoon.reviewWords),className:"btn-start-session",disabled:r.afternoon.reviewWords.length===0,children:r.afternoon.reviewWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card evening",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåô"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"Â§úÔºöÁ∑èÂêàÊºîÁøí"}),u.jsxs("p",{children:[r.evening.mixedWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("evening",r.evening.mixedWords),className:"btn-start-session",disabled:r.evening.mixedWords.length===0,children:r.evening.mixedWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]})]})]}),u.jsxs("div",{className:"milestones",children:[u.jsx("h2",{children:"üèÜ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥"}),u.jsx("div",{className:"milestone-list",children:t.milestones.map((g,x)=>{const y=h>g.day,b=h===g.day,w=a.totalLearned>=g.wordsTarget;return u.jsxs("div",{className:`milestone-item ${w?"achieved":""} ${b?"current":""} ${y?"passed":""}`,children:[u.jsxs("div",{className:"milestone-day",children:["Day ",g.day]}),u.jsx("div",{className:"milestone-title",children:g.title}),u.jsxs("div",{className:"milestone-target",children:[g.wordsTarget,"Ë™û"]}),w&&u.jsx("span",{className:"check-mark",children:"‚úì"})]},x)})})]})]})}const fZ=()=>{const[n,e]=N.useState("prepositions");return u.jsxs("div",{className:"grammar-guide-view p-4 max-w-app mx-auto",children:[u.jsxs("div",{className:"grammar-guide-tabs grid grid-cols-3 gap-1 sm:gap-2 mb-4",children:[u.jsxs("button",{onClick:()=>e("prepositions"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="prepositions"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üìç ÂâçÁΩÆË©û"}),u.jsx("span",{className:"sm:hidden",children:"ÂâçÁΩÆË©û"})]}),u.jsxs("button",{onClick:()=>e("punctuation"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="punctuation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"‚úèÔ∏è Ë®òÂè∑"}),u.jsx("span",{className:"sm:hidden",children:"Ë®òÂè∑"})]}),u.jsxs("button",{onClick:()=>e("tips"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="tips"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° Ë™≠Ëß£„Ç≥„ÉÑ"}),u.jsx("span",{className:"sm:hidden",children:"Ë™≠Ëß£„Ç≥„ÉÑ"})]})]}),u.jsxs("div",{className:"content-area bg-white rounded-lg p-4 shadow-md border border-gray-200",children:[n==="prepositions"&&u.jsx(pZ,{}),n==="punctuation"&&u.jsx(mZ,{}),n==="tips"&&u.jsx(gZ,{})]})]})},pZ=()=>u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"ÂâçÁΩÆË©û„ÅÆ„Éã„É•„Ç¢„É≥„Çπ„Å®‰Ωø„ÅÑÂàÜ„Åë"}),u.jsx("p",{className:"text-text-secondary mb-6",children:"Ëã±Ë™û„ÅßÊúÄ„ÇÇÈ†ªÁπÅ„Å´‰Ωø„ÅÜÂâçÁΩÆË©û„ÇíÈáçË¶ÅÂ∫¶È†Ü„Å´Á¥π‰ªã„Åó„Åæ„Åô„ÄÇ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Ç¢„Ç§„É°„Éº„Ç∏„ÇíÁêÜËß£„Åô„Çã„Åì„Å®„Åß„ÄÅËá™ÁÑ∂„Å™Ëã±Ë™ûË°®Áèæ„ÅåË∫´„Å´„Å§„Åç„Åæ„Åô„ÄÇ"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üåü ÊúÄÈáçË¶ÅÔºöÊôÇÈñì„ÉªÂ†¥ÊâÄ„ÅÆÂü∫Êú¨3„Å§"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚û°Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"TO"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„ÄåÊñπÂêë„ÉªÂà∞ÈÅîÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß≠"})," ÊñπÂêë„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üè´ ",u.jsx("strong",{children:"to school"})," ‚Üí Â≠¶Ê†°„Å∏ÔºàÊñπÂêëÔºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üóº ",u.jsx("strong",{children:"to Tokyo"})," ‚Üí Êù±‰∫¨„Å∏ÔºàÁõÆÁöÑÂú∞Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üîÑ"})," ÁØÑÂõ≤„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üìä ",u.jsx("strong",{children:"from A to B"})," ‚Üí A„Åã„ÇâB„Åæ„ÅßÔºàÁØÑÂõ≤Ôºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üïê ",u.jsx("strong",{children:"from 9 to 5"})," ‚Üí 9ÊôÇ„Åã„Çâ5ÊôÇ„Åæ„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üéØ"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"FOR"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„ÄåÁõÆÁöÑ„ÉªÂØæË±°„ÉªÊúüÈñì„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üíù"})," ÁõÆÁöÑ„ÉªÂØæË±°„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üë§ ",u.jsx("strong",{children:"for you"})," ‚Üí „ÅÇ„Å™„Åü„ÅÆ„Åü„ÇÅ„Å´ÔºàÂØæË±°Ôºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üç≥ ",u.jsx("strong",{children:"for breakfast"})," ‚Üí ÊúùÈ£ü„Å®„Åó„Å¶ÔºàÁõÆÁöÑÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"})," ÊúüÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["‚è∞ ",u.jsx("strong",{children:"for 3 hours"})," ‚Üí 3ÊôÇÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üìÖ ",u.jsx("strong",{children:"for a week"})," ‚Üí 1ÈÄ±ÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]})]})]})]})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üé¨"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"FROM"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„ÄåËµ∑ÁÇπ„ÉªÂá∫Áô∫ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," Ëµ∑ÁÇπ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üè† ",u.jsx("strong",{children:"from home"})," ‚Üí ÂÆ∂„Åã„ÇâÔºàÂá∫Áô∫ÁÇπÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üáØüáµ ",u.jsx("strong",{children:"from Japan"})," ‚Üí Êó•Êú¨„Åã„ÇâÔºàÂá∫Ë∫´Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," ÊôÇÈñì„ÅÆËµ∑ÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["‚è∞ ",u.jsx("strong",{children:"from 9 am"})," ‚Üí 9ÊôÇ„Åã„ÇâÔºàÈñãÂßãÊôÇÂàªÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"from Monday"})," ‚Üí ÊúàÊõúÊó•„Åã„Çâ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üìå „Çà„Åè‰Ωø„ÅÜÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"ü§ù"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"WITH"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå‰∏ÄÁ∑í„Å´„Éª‰Ωø„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë•"})," ‰º¥„ÅÜÁõ∏ÊâãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üë®‚Äçüë©‚Äçüëß ",u.jsx("strong",{children:"with my family"})," ‚Üí ÂÆ∂Êóè„Å®‰∏ÄÁ∑í„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üßë‚Äçü§ù‚Äçüßë ",u.jsx("strong",{children:"with friends"})," ‚Üí ÂèãÈÅî„Å®"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üõ†Ô∏è"})," ‰Ωø„ÅÜÈÅìÂÖ∑Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["‚úèÔ∏è ",u.jsx("strong",{children:"with a pen"})," ‚Üí „Éö„É≥„ÅßÔºàÈÅìÂÖ∑Ôºâ"]}),u.jsxs("div",{className:"text-indigo-600",children:["üç¥ ",u.jsx("strong",{children:"with chopsticks"})," ‚Üí ÁÆ∏„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-amber-50/20 rounded-lg p-5 border-2 border-amber-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöó"}),u.jsx("div",{className:"text-2xl font-bold text-amber-600 mt-2",children:"BY"}),u.jsx("div",{className:"text-sm text-amber-700 mt-1",children:"„Äå„Äú„ÅÆ„Åù„Å∞„Å´„ÉªÊâãÊÆµ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üöå"})," ÊâãÊÆµ„ÉªÊñπÊ≥ïÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üöÜ ",u.jsx("strong",{children:"by train"})," ‚Üí ÈõªËªä„ÅßÔºà‰∫§ÈÄöÊâãÊÆµÔºâ"]}),u.jsxs("div",{className:"text-amber-600",children:["‚úâÔ∏è ",u.jsx("strong",{children:"by email"})," ‚Üí „É°„Éº„É´„ÅßÔºàÈÄö‰ø°ÊâãÊÆµÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," „Åù„Å∞„Å´Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üåä ",u.jsx("strong",{children:"by the sea"})," ‚Üí Êµ∑„ÅÆ„Åù„Å∞„Å´"]}),u.jsxs("div",{className:"text-amber-600",children:["ü™ü ",u.jsx("strong",{children:"by the window"})," ‚Üí Á™ì„ÅÆ„Åù„Å∞„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-rose-50/20 rounded-lg p-5 border-2 border-rose-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üîó"}),u.jsx("div",{className:"text-2xl font-bold text-rose-600 mt-2",children:"OF"}),u.jsx("div",{className:"text-sm text-rose-700 mt-1",children:"„Äå„Äú„ÅÆÔºàÊâÄÂ±û„ÉªÈÉ®ÂàÜÔºâ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üëë"})," ÊâÄÂ±û„ÉªÊâÄÊúâÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üìö ",u.jsx("strong",{children:"the book of mine"})," ‚Üí ÁßÅ„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-rose-600",children:["üèõÔ∏è ",u.jsx("strong",{children:"the capital of Japan"})," ‚Üí Êó•Êú¨„ÅÆÈ¶ñÈÉΩ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß©"})," ÈÉ®ÂàÜÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üç∞ ",u.jsx("strong",{children:"a piece of cake"})," ‚Üí „Ç±„Éº„Ç≠‰∏ÄÂàá„Çå"]}),u.jsxs("div",{className:"text-rose-600",children:["üíß ",u.jsx("strong",{children:"a glass of water"})," ‚Üí „Ç≥„ÉÉ„Éó‰∏ÄÊùØ„ÅÆÊ∞¥"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üí´ ‰∏≠È†ªÂ∫¶„ÅÆÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üí≠"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"ABOUT"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„Å´„Å§„ÅÑ„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"})," Ë©±È°å„ÉªÂÜÖÂÆπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üìö ",u.jsx("strong",{children:"a book about history"})," ‚Üí Ê≠¥Âè≤„Å´„Å§„ÅÑ„Å¶„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-cyan-600",children:["üí¨ ",u.jsx("strong",{children:"talk about sports"})," ‚Üí „Çπ„Éù„Éº„ÉÑ„Å´„Å§„ÅÑ„Å¶Ë©±„Åô"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," „Åä„Åä„Çà„Åù„ÅÆÊï∞Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["‚è∞ ",u.jsx("strong",{children:"about 10 minutes"})," ‚Üí Á¥Ñ10ÂàÜ"]}),u.jsxs("div",{className:"text-cyan-600",children:["üë• ",u.jsx("strong",{children:"about 50 people"})," ‚Üí Á¥Ñ50‰∫∫"]})]})]})]})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≠Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"AFTER"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂæåÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"after dinner"})," ‚Üí Â§ïÈ£ü„ÅÆÂæå"]}),u.jsxs("div",{className:"text-lime-600",children:["üè´ ",u.jsx("strong",{children:"after school"})," ‚Üí ÊîæË™≤Âæå"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫èÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üî§ ",u.jsx("strong",{children:"after you"})," ‚Üí „ÅäÂÖà„Å´„Å©„ÅÜ„Åû"]}),u.jsxs("div",{className:"text-lime-600",children:["üìù ",u.jsx("strong",{children:"one after another"})," ‚Üí Ê¨°„ÄÖ„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-sky-50/20 rounded-lg p-5 border-2 border-sky-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚èÆÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-sky-600 mt-2",children:"BEFORE"}),u.jsx("div",{className:"text-sm text-sky-700 mt-1",children:"„Äå„Äú„ÅÆÂâç„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂâçÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"before breakfast"})," ‚Üí ÊúùÈ£üÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üéÑ ",u.jsx("strong",{children:"before Christmas"})," ‚Üí „ÇØ„É™„Çπ„Éû„Çπ„ÅÆÂâç"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫è„Éª‰ΩçÁΩÆÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üö™ ",u.jsx("strong",{children:"before the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üë• ",u.jsx("strong",{children:"before everyone"})," ‚Üí „Åø„Çì„Å™„ÅÆÂâç„Åß"]})]})]})]})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-violet-50/20 rounded-lg p-5 border-2 border-violet-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-violet-600 mt-2",children:"OVER"}),u.jsx("div",{className:"text-sm text-violet-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ä„ÇíË∂ä„Åà„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"ü¶Ö"})," ‰∏äÊñπ„ÉªË∂ä„Åà„ÇãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üåâ ",u.jsx("strong",{children:"over the bridge"})," ‚Üí Ê©ã„ÇíË∂ä„Åà„Å¶"]}),u.jsxs("div",{className:"text-violet-600",children:["üèîÔ∏è ",u.jsx("strong",{children:"over the mountain"})," ‚Üí Â±±„ÇíË∂ä„Åà„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," ‰ª•‰∏ä„ÉªË∂ÖÈÅéÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üë• ",u.jsx("strong",{children:"over 100 people"})," ‚Üí 100‰∫∫‰ª•‰∏ä"]}),u.jsxs("div",{className:"text-violet-600",children:["üí∞ ",u.jsx("strong",{children:"over $50"})," ‚Üí 50„Éâ„É´‰ª•‰∏ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-slate-50/20 rounded-lg p-5 border-2 border-slate-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚¨áÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-slate-600 mt-2",children:"UNDER"}),u.jsx("div",{className:"text-sm text-slate-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ã„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨áÔ∏è"})," ‰∏ãÊñπ„Éª‰∏ãÂÅ¥Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üå≥ ",u.jsx("strong",{children:"under the tree"})," ‚Üí Êú®„ÅÆ‰∏ã„Å´"]}),u.jsxs("div",{className:"text-slate-600",children:["üåâ ",u.jsx("strong",{children:"under the bridge"})," ‚Üí Ê©ã„ÅÆ‰∏ã„Å´"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," Êú™Ê∫ÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üë∂ ",u.jsx("strong",{children:"under 18"})," ‚Üí 18Ê≠≥Êú™Ê∫Ä"]}),u.jsxs("div",{className:"text-slate-600",children:["üí∞ ",u.jsx("strong",{children:"under $10"})," ‚Üí 10„Éâ„É´Êú™Ê∫Ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-fuchsia-50/20 rounded-lg p-5 border-2 border-fuchsia-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöá"}),u.jsx("div",{className:"text-2xl font-bold text-fuchsia-600 mt-2",children:"THROUGH"}),u.jsx("div",{className:"text-sm text-fuchsia-700 mt-1",children:"„Äå„Äú„ÇíÈÄö„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üö™"})," ÈÄöÈÅé„ÉªË≤´ÈÄöÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["ü™ü ",u.jsx("strong",{children:"through the window"})," ‚Üí Á™ì„ÇíÈÄö„Å£„Å¶"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üå≤ ",u.jsx("strong",{children:"through the forest"})," ‚Üí Ê£Æ„ÇíÊäú„Åë„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊúüÈñìÂÖ®‰ΩìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["üåô ",u.jsx("strong",{children:"through the night"})," ‚Üí ‰∏ÄÊô©‰∏≠"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üåßÔ∏è ",u.jsx("strong",{children:"through the winter"})," ‚Üí ÂÜ¨„ÅÆÈñì„Åö„Å£„Å®"]})]})]})]})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚ú® Áü•„Å£„Å¶„Åä„Åè„Å®‰æøÂà©„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-emerald-50/20 rounded-lg p-5 border-2 border-emerald-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚ÜîÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-emerald-600 mt-2",children:"BETWEEN"}),u.jsx("div",{className:"text-sm text-emerald-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà2„Å§Ôºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-emerald-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," 2„Å§„ÅÆÈñìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-emerald-600",children:["üè´üè• ",u.jsx("strong",{children:"between the school and hospital"})," ‚Üí Â≠¶Ê†°„Å®ÁóÖÈô¢„ÅÆÈñì"]}),u.jsxs("div",{className:"text-emerald-600",children:["üë• ",u.jsx("strong",{children:"between you and me"})," ‚Üí „ÅÇ„Å™„Åü„Å®ÁßÅ„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë•"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AMONG"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà3„Å§‰ª•‰∏äÔºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶"})," Ë§áÊï∞„ÅÆ‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üå∏ ",u.jsx("strong",{children:"among the flowers"})," ‚Üí Ëä±„ÄÖ„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-orange-600",children:["üë• ",u.jsx("strong",{children:"among friends"})," ‚Üí Âèã‰∫∫„Åü„Å°„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-red-50/20 rounded-lg p-5 border-2 border-red-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üö´"}),u.jsx("div",{className:"text-2xl font-bold text-red-600 mt-2",children:"WITHOUT"}),u.jsx("div",{className:"text-sm text-red-700 mt-1",children:"„Äå„Äú„Å™„Åó„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-red-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ùå"})," Ê¨†Â¶Ç„Éª‰∏çÂú®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-red-600",children:["üíß ",u.jsx("strong",{children:"without water"})," ‚Üí Ê∞¥„Å™„Åó„Åß"]}),u.jsxs("div",{className:"text-red-600",children:["üë§ ",u.jsx("strong",{children:"without you"})," ‚Üí „ÅÇ„Å™„Åü„Å™„Åó„Åß"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-yellow-50/20 rounded-lg p-5 border-2 border-yellow-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≥"}),u.jsx("div",{className:"text-2xl font-bold text-yellow-600 mt-2",children:"DURING"}),u.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-yellow-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," ÊúüÈñì‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-yellow-600",children:["üå¥ ",u.jsx("strong",{children:"during summer vacation"})," ‚Üí Â§è‰ºë„Åø„ÅÆÈñì"]}),u.jsxs("div",{className:"text-yellow-600",children:["üé• ",u.jsx("strong",{children:"during the movie"})," ‚Üí Êò†Áîª„ÅÆÈñì"]})]})]})})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è∞"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"UNTIL/TILL"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„Äå„Äú„Åæ„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," Á∂ôÁ∂ö„ÅÆÁµÇÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üåô ",u.jsx("strong",{children:"until midnight"})," ‚Üí ÁúüÂ§ú‰∏≠„Åæ„Åß"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"until next week"})," ‚Üí Êù•ÈÄ±„Åæ„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÜ"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"SINCE"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„Äå„Äú‰ª•Êù•„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," Ëµ∑ÁÇπ„Åã„ÇâÁ∂ôÁ∂öÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üéÇ ",u.jsx("strong",{children:"since last year"})," ‚Üí ÂéªÂπ¥„Åã„ÇâÔºà„Åö„Å£„Å®Ôºâ"]}),u.jsxs("div",{className:"text-blue-600",children:["üë∂ ",u.jsx("strong",{children:"since childhood"})," ‚Üí Â≠ê‰æõ„ÅÆÈ†É„Åã„Çâ"]})]})]})})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üè† Â†¥ÊâÄ„ÇíË°®„ÅôÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üè¢"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"INSIDE"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„Äå„Äú„ÅÆÂÜÖÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üì¶"})," ÂÜÖÂÅ¥„ÉªÂÜÖÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üè† ",u.jsx("strong",{children:"inside the house"})," ‚Üí ÂÆ∂„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-purple-600",children:["üì¶ ",u.jsx("strong",{children:"inside the box"})," ‚Üí ÁÆ±„ÅÆ‰∏≠„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üå≥"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"OUTSIDE"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„Äå„Äú„ÅÆÂ§ñÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üå≤"})," Â§ñÂÅ¥„ÉªÂ§ñÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üè° ",u.jsx("strong",{children:"outside the house"})," ‚Üí ÂÆ∂„ÅÆÂ§ñ„Å´"]}),u.jsxs("div",{className:"text-green-600",children:["üè´ ",u.jsx("strong",{children:"outside the school"})," ‚Üí Â≠¶Ê†°„ÅÆÂ§ñ„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"NEAR"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„ÅÆËøë„Åè„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üéØ"})," ËøëÊé•Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üöâ ",u.jsx("strong",{children:"near the station"})," ‚Üí ÈßÖ„ÅÆËøë„Åè„Å´"]}),u.jsxs("div",{className:"text-cyan-600",children:["üåä ",u.jsx("strong",{children:"near the sea"})," ‚Üí Êµ∑„ÅÆËøë„Åè„Å´"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë§"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"BEHIND"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Çç„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨ÖÔ∏è"})," ÂæåÊñπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üö™ ",u.jsx("strong",{children:"behind the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂæå„Çç„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üè† ",u.jsx("strong",{children:"behind the house"})," ‚Üí ÂÆ∂„ÅÆË£è„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"ACROSS"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„Äå„Äú„ÇíÊ®™Âàá„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ÜîÔ∏è"})," Ê®™Êñ≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"across the street"})," ‚Üí ÈÄö„Çä„ÇíÊ®™Âàá„Å£„Å¶"]}),u.jsxs("div",{className:"text-pink-600",children:["üåä ",u.jsx("strong",{children:"across the river"})," ‚Üí Â∑ù„ÇíÊ∏°„Å£„Å¶"]})]})]})})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üõ§Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"ALONG"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„Å´Ê≤ø„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚û°Ô∏è"})," Ê≤ø„Å£„Å¶ÈÄ≤„ÇÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"along the street"})," ‚Üí ÈÄö„Çä„Å´Ê≤ø„Å£„Å¶"]}),u.jsxs("div",{className:"text-lime-600",children:["üåä ",u.jsx("strong",{children:"along the river"})," ‚Üí Â∑ùÊ≤ø„ÅÑ„Å´"]})]})]})})]})]})})]}),mZ=()=>{const n=[{symbol:".",name:"Period („Éî„É™„Ç™„Éâ)",usage:"Êñá„ÅÆÁµÇ„Çè„Çä",example:"I like cats.",explanation:"Âπ≥ÂèôÊñá„ÉªÂëΩ‰ª§Êñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:",",name:"Comma („Ç≥„É≥„Éû)",usage:"Âå∫Âàá„Çä„ÉªÂàóÊåô",example:"I bought apples, oranges, and bananas.",explanation:"ÂçòË™û„ÇÑÂè•„ÇíÂå∫Âàá„Çã„ÄÇÊé•Á∂öË©û„ÅÆÂâç„Å´„ÇÇ‰ΩøÁî®"},{symbol:"!",name:"Exclamation Mark (ÊÑüÂòÜÁ¨¶)",usage:"ÊÑüÂòÜ„ÉªÂº∑Ë™ø",example:"What a beautiful day!",explanation:"È©ö„Åç„ÉªÂñú„Å≥„ÉªÂº∑„ÅÑÊÑüÊÉÖ„ÇíË°®„Åô"},{symbol:"?",name:"Question Mark (ÁñëÂïèÁ¨¶)",usage:"ÁñëÂïè",example:"Do you like music?",explanation:"ÁñëÂïèÊñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:":",name:"Colon („Ç≥„É≠„É≥)",usage:"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•",example:"I have three pets: a dog, a cat, and a bird.",explanation:"Âæå„Çç„Å´Ë™¨Êòé„ÇÑÂàóÊåô„ÅåÁ∂ö„Åè„Åì„Å®„ÇíÁ§∫„Åô"},{symbol:";",name:"Semicolon („Çª„Éü„Ç≥„É≠„É≥)",usage:"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",example:"I love reading; my sister prefers sports.",explanation:"„Éî„É™„Ç™„Éâ„Çà„ÇäÂº±„Åè„ÄÅ„Ç≥„É≥„Éû„Çà„ÇäÂº∑„ÅÑÂå∫Âàá„Çä"},{symbol:"-",name:"Hyphen („Éè„Ç§„Éï„É≥)",usage:"Ë§áÂêàË™û„ÉªË£úË∂≥",example:"a well-known writer",explanation:"2„Å§‰ª•‰∏ä„ÅÆÂçòË™û„ÇíÁπã„Åí„Çã"},{symbol:"‚Äî",name:"Em Dash („ÉÄ„ÉÉ„Ç∑„É•)",usage:"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•",example:"My friends‚ÄîJohn and Mary‚Äîare coming.",explanation:"Ë£úË∂≥ÊÉÖÂ†±„ÇíÊåøÂÖ•„Åô„Çã"}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Ëã±ÊñáË®òÂè∑„ÅÆÊÑèÂë≥„Å®‰Ωø„ÅÑÊñπ"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-5 hover:shadow-lg transition-shadow border border-border-color",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[u.jsx("div",{className:"text-5xl font-bold text-primary flex-shrink-0",children:e.symbol}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-lg font-bold text-text-color",children:e.name}),u.jsx("p",{className:"text-sm text-primary font-semibold",children:e.usage})]})]}),u.jsx("div",{className:"bg-blue-50/20 rounded p-3 mb-3",children:u.jsx("div",{className:"font-mono text-sm text-blue-600",children:e.example})}),u.jsx("p",{className:"text-sm text-text-secondary",children:e.explanation})]},t))})]})},gZ=()=>{const n=[{icon:"üìù",title:"ÊúÄÂàù„Å´Ê≥®Èáà„Å®Ë®≠Âïè„ÇíÁ¢∫Ë™ç",description:"Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´„ÄÅÊ≥®Èáà„Å®ÂïèÈ°å„Åã„ÇâÈáçË¶Å„Å™Êâã„Åå„Åã„Çä„ÇíÂæó„Çã",details:["Ê≥®Èáà„ÅØÂçò„Å´Èõ£„Åó„ÅÑÂçòË™û„ÅÆÊÑèÂë≥„Åß„ÅØ„Å™„Åè„ÄÅÂÜÖÂÆπÁêÜËß£„ÅÆ„Ç´„ÇÆ","Ê≥®Èáà„ÅÆÂçòË™û„ÇíÈÄ£ÊÉ≥„Åô„Çã„Å®Èï∑Êñá„ÅÆ„ÅÇ„Çâ„Åô„Åò„ÅåË¶ã„Åà„Å¶„Åè„Çã","Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ„ÇÑÂ§ßÊÑè„ÇíÂïè„ÅÜË®≠Âïè„Åã„Çâ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÊãæ„ÅÜ","ÈÉ®ÂàÜÁöÑ„Å™ÈÅ∏ÊäûÂïèÈ°å„ÅÆÈÅ∏ÊäûËÇ¢„Å´„ÇÇÂÖ±ÈÄö„Ç≠„Éº„ÉØ„Éº„Éâ„ÅåÈö†„Çå„Å¶„ÅÑ„Çã"]},{icon:"üéØ",title:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÅßÂÖ®‰ΩìÂÉè„ÇíÊé¥„ÇÄ",description:"Ëã±Ë™û„ÅÆÊñáÁ´†„ÅØ„ÄåÁµêË´ñÂÖàÂá∫„Åó„Äç„ÅåÂü∫Êú¨„ÄÇÊúÄÂàù„Å´ÂÖ®‰Ωì„ÅÆÊñπÂêëÊÄß„ÅåÁ§∫„Åï„Çå„Çã",example:{title:"The Importance of Reading Books",para1:"Reading books is one of the best ways to improve your knowledge and imagination. Many people think that reading is boring, but it actually helps you learn new things and understand the world better.",explanation:`„Çø„Ç§„Éà„É´: „ÄåÊú¨„ÇíË™≠„ÇÄÈáçË¶ÅÊÄß„Äç‚Üí „ÉÜ„Éº„ÉûÁ¢∫ÂÆö
Á¨¨1ÊÆµËêΩ: „ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅØÁü•Ë≠ò„Å®ÊÉ≥ÂÉèÂäõ„ÇíÈ´ò„ÇÅ„ÇãÊúÄËâØ„ÅÆÊñπÊ≥ï„ÅÆ1„Å§„Äç‚Üí Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ
‚Üí „Åì„ÅÆÊôÇÁÇπ„Åß„ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅÆËâØ„ÅÑÁÇπ„Å´„Å§„ÅÑ„Å¶Ëø∞„Åπ„ÇãÊñáÁ´†„Äç„Å†„Å®ÂàÜ„Åã„Çã`},details:["„Çø„Ç§„Éà„É´ ‚Üí Ë©±È°åÔºà„Éà„Éî„ÉÉ„ÇØÔºâ„ÇíÁ§∫„Åô","Á¨¨1ÊÆµËêΩ ‚Üí Á≠ÜËÄÖ„ÅÆÁ´ãÂ†¥„Éª‰∏ªÂºµ„ÇíÊòéÁ¢∫„Å´„Åô„Çã","„Äå‰Ωï„Å´„Å§„ÅÑ„Å¶„Äç„Äå„Å©„ÅÜËÄÉ„Åà„Å¶„ÅÑ„Çã„Åã„Äç„Çí„É°„É¢„Åô„Çã„Å®Êï¥ÁêÜ„Åó„ÇÑ„Åô„ÅÑ","ÂïèÈ°åÊèêËµ∑ÔºàÁñëÂïèÔºâ‚Üí Êú¨Êñá„ÅßÁ≠î„Åà„ÇíÊé¢„Åô„Éë„Çø„Éº„É≥„ÇÇÂ§ö„ÅÑ"]},{icon:"üìç",title:"ÊÆµËêΩ„ÅÆÊúÄÂàù„Å®ÊúÄÂæå„Å´Ê≥®ÁõÆ",description:"Ëã±Ë™û„ÅØ„Äå„Éë„É©„Ç∞„É©„Éï„Éª„É™„Éº„Éá„Ç£„É≥„Ç∞„Äç„ÄÇ1ÊÆµËêΩ = 1„Å§„ÅÆ‰∏ªÂºµ",example:{structure:`„ÄêÂÖ∏ÂûãÁöÑ„Å™ÊÆµËêΩÊßãÈÄ†„Äë
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ
„ÄåÈÅãÂãï„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Äç‚Üê ÊÆµËêΩ„ÅÆ‰∏ªÂºµ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‰∏≠ÈñìÈÉ®Ôºà„Çµ„Éù„Éº„ÉàÔºâ
ÁêÜÁî±1: ‰Ωì„ÅåÂº∑„Åè„Å™„Çã
ÁêÜÁî±2: „Çπ„Éà„É¨„ÇπËß£Ê∂à„Å´„Å™„Çã
ÂÖ∑‰Ωì‰æã: ÊØéÊó•30ÂàÜÊ≠©„Åè„Å†„Åë„ÅßÂäπÊûú
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ÊúÄÁµÇÊñáÔºà„Åæ„Å®„ÇÅÔºâ
„Äå„Å†„Åã„ÇâÈÅãÂãï„ÇíÁøíÊÖ£„Å´„Åô„Åπ„Åç„Äç‚Üê ÁµêË´ñ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`,tips:"Á¨¨1Êñá„Å®ÊúÄÁµÇÊñá„Å†„ÅëË™≠„ÇÅ„Å∞„ÄÅ„Åù„ÅÆÊÆµËêΩ„Åß‰Ωï„ÇíË®Ä„ÅÑ„Åü„ÅÑ„Åã„ÅåÂàÜ„Åã„ÇãÔºÅ"},details:["Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ: „Åù„ÅÆÊÆµËêΩ„ÅßÊúÄ„ÇÇË®Ä„ÅÑ„Åü„ÅÑ„Åì„Å®","‰∏≠ÈñìÈÉ®: ÁêÜÁî±„ÉªÂÖ∑‰Ωì‰æã„Éª„Éá„Éº„ÇøÔºàÈ£õ„Å∞„ÅóË™≠„ÅøOKÔºâ","ÊúÄÁµÇÊñá: „Åæ„Å®„ÇÅ„ÉªÁµêË´ñ„ÉªÊ¨°„ÅÆÊÆµËêΩ„Å∏„ÅÆÊ©ãÊ∏°„Åó","ÊÄ•„ÅÑ„Åß„ÅÑ„ÇãÊôÇ„ÅØÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å†„ÅëË™≠„ÇÄ„ÅÆ„ÇÇÊúâÂäπ"]},{icon:"üîó",title:"„Éá„Ç£„Çπ„Ç≥„Éº„Çπ„Éû„Éº„Ç´„Éº„ÇíË¶ãÈÄÉ„Åï„Å™„ÅÑ",description:"ÊñáÁ´†„ÅÆÊµÅ„Çå„ÇíÁ§∫„Åô„Å§„Å™„ÅéË®ÄËëâ„ÅåË´ñÁêÜÂ±ïÈñã„ÅÆ„Ç´„ÇÆ",details:["ÈÄÜÊé•: However, But, Yet, On the other hand","Âõ†Êûú: Therefore, So, Thus, As a result","‰æãÁ§∫: For example, For instance, Such as","ËøΩÂä†: In addition, Moreover, Furthermore","Ë®Ä„ÅÑÊèõ„Åà: In other words, That is, Namely"]},{icon:"üîç",title:"Ë®≠Âïè„ÅÆÁ®ÆÈ°ûÂà•„ÅÆÊîªÁï•Ê≥ï",description:"ÂïèÈ°å„ÅÆ„Çø„Ç§„Éó„Å´Âøú„Åò„ÅüË™≠„ÅøÊñπ„Çí‰Ωø„ÅÑÂàÜ„Åë„Çã",details:["‰∏ªÊó®ÂïèÈ°å: ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å®ÊúÄÁµÇÊÆµËêΩ„ÇíÈáçÁÇπÁöÑ„Å´","Ë©≥Á¥∞ÂïèÈ°å: „Ç≠„Éº„ÉØ„Éº„Éâ„ÅßË©≤ÂΩìÁÆáÊâÄ„ÇíÁâπÂÆö„Åó„Å¶Á≤æË™≠","Ë™ûÂΩôÂïèÈ°å: ÂâçÂæå„ÅÆÊñáËÑà„Åã„ÇâÊÑèÂë≥„ÇíÊé®Ê∏¨","ÊåáÁ§∫Ë™ûÂïèÈ°å: Áõ¥Ââç„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç","NOTÂïèÈ°å: Êú¨Êñá„Å´Êõ∏„Åã„Çå„Å¶„ÅÑ„Å™„ÅÑÈÅ∏ÊäûËÇ¢„ÇíÊé¢„Åô"]},{icon:"‚è±Ô∏è",title:"ÊôÇÈñìÈÖçÂàÜ„Å®ÂÑ™ÂÖàÈ†Ü‰Ωç",description:"ÂÖ®ÂïèËß£„Åè„Åü„ÇÅ„ÅÆÊà¶Áï•ÁöÑ„Å™ÊôÇÈñìÁÆ°ÁêÜ",details:["1Âïè„ÅÇ„Åü„Çä„ÅÆÁõÆÂÆâÊôÇÈñì„ÇíÊ±∫„ÇÅ„ÇãÔºà‰æã: 3ÂàÜ/ÂïèÔºâ","Êòì„Åó„ÅÑÂïèÈ°å„Åã„ÇâËß£„ÅÑ„Å¶ÂæóÁÇπ„ÇíÁ¢∫‰øù","Èõ£Âïè„ÅØÂæåÂõû„Åó„ÄÅÊúÄÂæå„Å´Êàª„Çã","ÊúÄ‰Ωé5ÂàÜ„ÅØË¶ãÁõ¥„ÅóÊôÇÈñì„ÇíÁ¢∫‰øù"]},{icon:"‚ùì",title:"ÂàÜ„Åã„Çâ„Å™„ÅÑÈÉ®ÂàÜ„ÅÆÂØæÂá¶Ê≥ï",description:"ÂÆåÁíß„ÇíÁõÆÊåá„Åï„Åö„ÄÅÂäπÁéáÁöÑ„Å´ÂæóÁÇπ„Åô„Çã",details:["Áü•„Çâ„Å™„ÅÑÂçòË™û„ÅØÂâçÂæå„Åã„ÇâÊé®Ê∏¨ÔºàÂìÅË©û„ÉªËÇØÂÆöÂê¶ÂÆö„ÇíÂà§Êñ≠Ôºâ","‰∏ÄÊñá„ÅåÂàÜ„Åã„Çâ„Å™„Åè„Å¶„ÇÇÊÆµËêΩÂÖ®‰Ωì„Åã„ÇâÊÑèÂë≥„ÇíÊé¥„ÇÄ","Á¥∞ÈÉ®„Çà„ÇäÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÂÑ™ÂÖà","Ê∂àÂéªÊ≥ï„ÅßÈÅ∏ÊäûËÇ¢„ÇíÁµû„ÇãÔºàÊòé„Çâ„Åã„Å´ÈÅï„ÅÜ„ÇÇ„ÅÆ„ÇíÈô§Â§ñÔºâ"]}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Èï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑ"}),u.jsx("div",{className:"bg-yellow-50/20 rounded-lg p-6 border-l-4 border-yellow-500 mb-6",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl",children:"üí°"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-lg text-yellow-800 mb-2",children:"Âü∫Êú¨Êà¶Áï•"}),u.jsx("p",{className:"text-yellow-700 mb-3",children:"Èï∑ÊñáË™≠Ëß£„ÅØ„ÄåÂÆåÁíß„Å´ÁêÜËß£„Åô„Çã„Äç„ÅÆ„Åß„ÅØ„Å™„Åè„ÄåÂøÖË¶Å„Å™ÊÉÖÂ†±„ÇíÂäπÁéáÁöÑ„Å´Ë¶ã„Å§„Åë„Çã„Äç‰ΩúÊ•≠„Åß„Åô„ÄÇ Ê≥®Èáà„Å®Ë®≠Âïè„Åã„ÇâÊâã„Åå„Åã„Çä„ÇíÂæó„Å¶„ÄÅÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÊé¥„Åø„Å™„Åå„Çâ„ÄÅËß£Á≠î„Å´ÂøÖË¶Å„Å™ÈÉ®ÂàÜ„ÇíÊé¢„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),u.jsxs("div",{className:"bg-yellow-100/30 rounded p-3 text-sm",children:[u.jsx("p",{className:"font-semibold text-yellow-900 mb-1",children:"‚ö° ÊúÄÈáçË¶Å„Éù„Ç§„É≥„Éà"}),u.jsx("p",{className:"text-yellow-800",children:"Ë™≠„ÇÄÈ†ÜÁï™: ‚ë† Ê≥®Èáà ‚Üí ‚ë° Ë®≠Âïè„ÉªÈÅ∏ÊäûËÇ¢ ‚Üí ‚ë¢ „Çø„Ç§„Éà„É´„ÉªÁ¨¨1ÊÆµËêΩ ‚Üí ‚ë£ ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá ‚Üí ‚ë§ ÂøÖË¶ÅÁÆáÊâÄ„ÇíÁ≤æË™≠"})]})]})]})}),u.jsx("div",{className:"space-y-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6 hover:shadow-lg transition-shadow border-l-4 border-primary/30",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[u.jsx("span",{className:"text-4xl",children:e.icon}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-text-color mb-2",children:e.title}),u.jsx("p",{className:"text-text-secondary",children:e.description})]})]}),e.example&&u.jsx("div",{className:"ml-14 mb-4 bg-blue-50/20 rounded-lg p-4 border border-blue-200",children:u.jsxs("div",{className:"space-y-3",children:[e.example.title&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìå „Çø„Ç§„Éà„É´‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 font-mono text-sm text-blue-700",children:e.example.title})]}),e.example.para1&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìÑ Á¨¨1ÊÆµËêΩ‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 text-sm text-gray-700 leading-relaxed",children:e.example.para1})]}),e.example.structure&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìä ÊÆµËêΩ„ÅÆÊßãÈÄ†"}),u.jsx("div",{className:"bg-white rounded p-3 text-sm font-mono whitespace-pre-line text-gray-700",children:e.example.structure})]}),e.example.explanation&&u.jsxs("div",{className:"bg-yellow-50/30 rounded p-3 border-l-2 border-yellow-500",children:[u.jsx("div",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"üí° Ë™≠„ÅøÂèñ„Çå„Çã„Åì„Å®"}),u.jsx("div",{className:"text-sm text-yellow-700 whitespace-pre-line",children:e.example.explanation})]}),e.example.tips&&u.jsx("div",{className:"bg-green-50/30 rounded p-3 border-l-2 border-green-500",children:u.jsxs("div",{className:"text-sm font-semibold text-green-700",children:["‚ú® ",e.example.tips]})})]})}),u.jsx("ul",{className:"space-y-2 ml-14",children:e.details.map((s,r)=>u.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[u.jsx("span",{className:"text-primary mt-1",children:"‚úì"}),u.jsx("span",{className:"text-text-color",children:s})]},r))})]},t))}),u.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50/20/20 rounded-lg p-6 mt-8 border-2 border-blue-300",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"}),u.jsx("span",{children:"ÂÆüË∑µÔºÅÂäπÁéáÁöÑ„Å™Ë™≠Ëß£ÊâãÈ†Ü"})]}),u.jsx("ol",{className:"space-y-3",children:[{step:"Ê≥®Èáà„ÇíË™≠„ÇÄ",detail:"‚Üí ÈáçË¶ÅÂçòË™û„Åã„ÇâÂÜÖÂÆπ„Çí‰∫àÊÉ≥"},{step:"Ë®≠Âïè„Å®ÈÅ∏ÊäûËÇ¢„ÇíË™≠„ÇÄ",detail:"‚Üí ‰Ωï„ÇíËÅû„Åã„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ"},{step:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÇíË™≠„ÇÄ",detail:"‚Üí „ÉÜ„Éº„Éû„Å®Ë´ñÁÇπ„ÇíÊääÊè°"},{step:"ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„ÇíÊµÅ„ÅóË™≠„Åø",detail:"‚Üí ÂÖ®‰ΩìÊßãÊàê„ÇíÁêÜËß£"},{step:"Ë®≠Âïè„Å´Èñ¢ÈÄ£„Åô„ÇãÊÆµËêΩ„ÇíÁ≤æË™≠",detail:"‚Üí Á≠î„Åà„ÅÆÊ†πÊã†„ÇíÊé¢„Åô"},{step:"ÈÅ∏ÊäûËÇ¢„ÇíÊú¨Êñá„Å®ÁÖß„Çâ„ÅóÂêà„Çè„Åõ„Çã",detail:"‚Üí Ê†πÊã†„Åå„ÅÇ„ÇãÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏„Å∂"},{step:"Ë¶ãÁõ¥„Åó",detail:"‚Üí ÈÅ∏„Çì„Å†Á≠î„Åà„ÅåÊú¨Êñá„ÅÆÂÜÖÂÆπ„Å®ÁüõÁõæ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç"}].map((e,t)=>u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:t+1}),u.jsxs("div",{children:[u.jsx("span",{className:"text-text-color font-semibold",children:e.step}),u.jsx("span",{className:"text-text-secondary text-sm ml-2",children:e.detail})]})]},t))})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-6 border-l-4 border-green-500",children:[u.jsxs("h3",{className:"text-lg font-bold text-green-800 mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üìå"}),u.jsx("span",{children:"Ê≥®Èáà„ÅÆÂäπÊûúÁöÑ„Å™Ê¥ªÁî®Ê≥ï"})]}),u.jsxs("div",{className:"space-y-2 text-sm text-green-700",children:[u.jsxs("p",{children:["‚úì ",u.jsx("strong",{children:"Ê≥®Èáà„Åå„ÅÇ„Çã = „Åù„ÅÆÂçòË™û„ÅåÂÜÖÂÆπÁêÜËß£„Å´ÂøÖÈ†à"}),"„Å®„ÅÑ„ÅÜÂá∫È°åËÄÖ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏"]}),u.jsx("p",{children:"‚úì Ê≥®Èáà„ÅÆÂçòË™û„Çí‰∏¶„Åπ„Çã„Å®„ÄÅÈï∑Êñá„ÅÆ„ÉÜ„Éº„Éû„ÇÑ„Çπ„Éà„Éº„É™„Éº„ÅåÊµÆ„Åã„Å≥‰∏ä„Åå„Çã"}),u.jsx("p",{children:"‚úì ‰æã: „ÄåÁí∞Â¢É„Äç„ÄåÊ±öÊüì„Äç„ÄåÂØæÁ≠ñ„Äç‚Üí Áí∞Â¢ÉÂïèÈ°å„Å´„Å§„ÅÑ„Å¶„ÅÆÊñáÁ´†„Å†„Å®‰∫àÊ∏¨„Åß„Åç„Çã"}),u.jsx("p",{className:"pt-2 italic",children:"üí° Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´Ê≥®Èáà„Å†„Åë„ÅßÂÜÖÂÆπ„Çí‰∫àÊÉ≥„Åô„ÇãÁ∑¥Áøí„Çí„Åô„Çã„Å®ÂäπÊûúÁöÑÔºÅ"})]})]})]})},xZ=()=>u.jsx("div",{className:"dictionary-view",children:u.jsxs("div",{className:"dictionary-container",children:[u.jsx("h2",{children:"üìö Ëã±ÂçòË™ûËæûÊõ∏"}),u.jsx("p",{className:"coming-soon",children:"ËæûÊõ∏Ê©üËÉΩ„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô"})]})}),Ob="ai_predictions_log",Lb=1e4;class Hp{constructor(e){me(this,"cache",null);me(this,"storage");this.storage=e||yZ()}async logPrediction(e,t,s){const r={predicted:t,actual:s,word:e,timestamp:Date.now()};if(this.cache===null&&await this.loadCache(),this.cache.push(r),this.cache.length>Lb){const o=this.cache.length-Lb;this.cache.splice(0,o)}await this.saveCache()}async getRecentPredictions(e=1e3){this.cache===null&&await this.loadCache();const t=Math.max(0,this.cache.length-e);return this.cache.slice(t).reverse()}async getAllPredictions(){return this.cache===null&&await this.loadCache(),[...this.cache]}async getPredictionsByTimeRange(e,t=Date.now()){return this.cache===null&&await this.loadCache(),this.cache.filter(s=>s.timestamp&&s.timestamp>=e&&s.timestamp<=t)}async getPredictionsByWord(e){return this.cache===null&&await this.loadCache(),this.cache.filter(t=>t.word===e)}async getStats(){this.cache===null&&await this.loadCache();const e=this.cache.map(s=>s.timestamp).filter(s=>s!==void 0),t=new Set(this.cache.map(s=>s.word)).size;return{total:this.cache.length,oldest:e.length>0?Math.min(...e):null,newest:e.length>0?Math.max(...e):null,uniqueWords:t}}async clearLogs(){this.cache=[],await this.saveCache()}async loadCache(){try{const e=await this.storage.getItem(Ob);e&&Array.isArray(e)?this.cache=e:this.cache=[]}catch(e){console.error("Failed to load prediction logs:",e),this.cache=[]}}async saveCache(){try{await this.storage.setItem(Ob,this.cache)}catch(e){console.error("Failed to save prediction logs:",e)}}}function yZ(){const n=new Map;return{async getItem(e){return n.get(e)},async setItem(e,t){n.set(e,t)}}}let vu=null;function Gk(){return vu||(typeof window<"u"&&On(async()=>{const{loadSetting:n,saveSetting:e}=await Promise.resolve().then(()=>N$);return{loadSetting:n,saveSetting:e}},void 0).then(({loadSetting:n,saveSetting:e})=>{const t={async getItem(s){return n(s)},async setItem(s,r){await e(s,r)}};vu=new Hp(t)}),vu=new Hp),vu}const bZ=Object.freeze(Object.defineProperty({__proto__:null,PredictionLogger:Hp,getPredictionLogger:Gk},Symbol.toStringTag,{value:"Module"}));function wZ(n){return n.length===0?0:n.reduce((t,s)=>t+Math.abs(s.predicted-s.actual),0)/n.length*100}function vZ(n,e=10){if(n.length===0)return{ece:0,mae:0,count:0,bins:[],overallAccuracy:0,averagePrediction:0};const t=SZ(n,e),s=t.reduce((l,d)=>l+d.weight*d.error,0),r=wZ(n),i=n.filter(l=>l.actual===1).length/n.length,c=n.reduce((l,d)=>l+d.predicted,0)/n.length;return{ece:s,mae:r,count:n.length,bins:t,overallAccuracy:i,averagePrediction:c}}function SZ(n,e){const t=1/e,s=[];for(let r=0;r<e;r++){const o=r*t,i=(r+1)*t,a=n.filter(g=>r===e-1?g.predicted>=o&&g.predicted<=i:g.predicted>=o&&g.predicted<i);if(a.length===0){s.push({range:[o,i],midpoint:(o+i)/2,count:0,averagePrediction:0,actualAccuracy:0,weight:0,error:0});continue}const c=a.length,l=c/n.length,h=a.reduce((g,x)=>g+x.predicted,0)/c,p=a.filter(g=>g.actual===1).length/c,m=Math.abs(h-p);s.push({range:[o,i],midpoint:(o+i)/2,count:c,averagePrediction:h,actualAccuracy:p,weight:l,error:m})}return s}function CZ(n){return n<=.05?"excellent":n<=.1?"good":n<=.15?"fair":"poor"}function NZ(n){return n<=10?"excellent":n<=20?"good":n<=30?"fair":"poor"}const IZ=({minPredictions:n=100})=>{const[e,t]=N.useState(null),[s,r]=N.useState(!0),[o,i]=N.useState(null),a=async()=>{r(!0),i(null);try{const m=await Gk().getAllPredictions();if(m.length===0){i("‰∫àÊ∏¨„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),t(null);return}const g=vZ(m,10);t(g)}catch(p){console.error("Failed to load calibration data:",p),i("„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}finally{r(!1)}};if(N.useEffect(()=>{a()},[]),s)return u.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:u.jsxs("div",{className:"animate-pulse",children:[u.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})});if(o||!e)return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",children:[u.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsx("p",{className:"text-yellow-800",children:o||"‰∫àÊ∏¨„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})})]});const c=CZ(e.ece),l=NZ(e.mae),d={excellent:"text-green-600",good:"text-blue-600",fair:"text-yellow-600",poor:"text-red-600"},h={excellent:"üåü",good:"üëç",fair:"‚ö†Ô∏è",poor:"‚ùå"},f=e.count<n;return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"üîÑ Êõ¥Êñ∞"})]}),f&&u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsxs("p",{className:"text-yellow-800",children:["‚ö†Ô∏è ‰∫àÊ∏¨Êï∞„Åå",n,"‰ª∂Êú™Ê∫Ä„Åß„ÅôÔºàÁèæÂú®",e.count,"‰ª∂Ôºâ„ÄÇ „Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Å´„ÅØ",n,"‰ª∂‰ª•‰∏ä„ÅÆ‰∫àÊ∏¨„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô„ÄÇ"]})}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ECEÔºàExpected Calibration ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.ece*100).toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[c]}`,children:[h[c]," ",c]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"‰∫àÊ∏¨Á¢∫Áéá„Å®ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá„ÅÆÂ∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"MAEÔºàMean Absolute ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[e.mae.toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[l]}`,children:[h[l]," ",l]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Âπ≥ÂùáÁµ∂ÂØæË™§Â∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ÂÖ®‰ΩìÊ≠£Ëß£Áéá"}),u.jsx("div",{className:"flex items-baseline gap-2",children:u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})}),u.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["‰∫àÊ∏¨Êï∞: ",e.count,"‰ª∂"]})]})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:"„Éì„É≥Âà•„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥"}),u.jsx("div",{className:"space-y-2",children:e.bins.filter(p=>p.count>0).map((p,m)=>u.jsx(kZ,{bin:p},m))}),u.jsx("div",{className:"mt-4 text-xs text-gray-500",children:"ÁêÜÊÉ≥ÁöÑ„Å™‰∫àÊ∏¨„Åß„ÅØ„ÄÅÂêÑ„Éì„É≥„ÅÆ„Äå‰∫àÊ∏¨„Äç„Å®„ÄåÂÆüÈöõ„Äç„Åå‰∏ÄËá¥„Åó„Åæ„Åô„ÄÇ „Éì„É≥„ÅØ‰∫àÊ∏¨Á¢∫Áéá„Çí10ÂàÜÂâ≤„Åó„Åü„Ç∞„É´„Éº„Éó„Åß„Åô„ÄÇ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-800",children:"‰∫àÊ∏¨„ÅÆÂÇæÂêë"}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"Âπ≥Âùá‰∫àÊ∏¨Á¢∫Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.averagePrediction*100).toFixed(1),"%"]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})]}),u.jsx("div",{className:"ml-auto",children:e.averagePrediction>e.overallAccuracy+.05?u.jsx("span",{className:"px-3 py-1 bg-red-100/30 text-red-700 rounded-full text-sm",children:"ÈÅé‰ø°ÂÇæÂêë"}):e.averagePrediction<e.overallAccuracy-.05?u.jsx("span",{className:"px-3 py-1 bg-blue-100/30 text-blue-700 rounded-full text-sm",children:"ÈÅéÂ∞èË©ï‰æ°ÂÇæÂêë"}):u.jsx("span",{className:"px-3 py-1 bg-green-100/30 text-green-700 rounded-full text-sm",children:"„Éê„É©„É≥„ÇπËâØÂ•Ω"})})]})]})]})},kZ=({bin:n})=>{const[e,t]=n.range,s=n.averagePrediction*100,r=n.actualAccuracy*100,o=Math.abs(s-r),i=o<5?"bg-green-500":o<10?"bg-blue-500":o<15?"bg-yellow-500":"bg-red-500";return u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[u.jsxs("span",{children:[(e*100).toFixed(0),"%-",(t*100).toFixed(0),"% Ôºà",n.count,"‰ª∂Ôºâ"]}),u.jsxs("span",{children:["Ë™§Â∑Æ: ",o.toFixed(1),"%"]})]}),u.jsxs("div",{className:"relative h-6 bg-gray-200 rounded",children:[u.jsx("div",{className:"absolute h-full bg-blue-300 rounded opacity-50",style:{width:`${s}%`}}),u.jsx("div",{className:`absolute h-full ${i} rounded`,style:{width:`${r}%`}}),u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800",children:["‰∫àÊ∏¨ ",s.toFixed(0),"% / ÂÆüÈöõ ",r.toFixed(0),"%"]})]})]})};async function $Z(){try{const n=C$(),e=await bs(),t={version:"1.0",exportDate:Date.now(),progress:e,sessionHistory:[],dailyStats:[],settings:{}};if(n.completed&&n.indexedDBSupported)try{t.sessionHistory=await Cx($n.SESSION_HISTORY),t.dailyStats=await Cx($n.DAILY_STATS);const s=["user-goal-level","lastLoginDate","loginStreak","radar-improvement-progress","skip-exclude-groups"];for(const r of s){const o=localStorage.getItem(r);o&&(t.settings[r]=o)}}catch{j.warn("IndexedDB„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„ÄÅLocalStorage„Åã„ÇâÂèñÂæó„Åó„Åæ„Åô:")}if(Object.keys(t.settings).length===0){const s=["user-goal-level","lastLoginDate","loginStreak","radar-improvement-progress","skip-exclude-groups","daily-plan-target-translation","daily-plan-target-spelling","daily-plan-target-reading"];for(const r of s){const o=localStorage.getItem(r);o&&(t.settings[r]=o)}}return JSON.stringify(t,null,2)}catch(n){throw j.error("„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:",n),new Error("„Éá„Éº„Çø„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}async function TZ(){try{const n=await $Z(),e=new Blob([n],{type:"application/json"}),t=URL.createObjectURL(e),s=new Date,r=`nanashi8-backup-${s.getFullYear()}${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}.json`,o=document.createElement("a");o.href=t,o.download=r,o.click(),URL.revokeObjectURL(t),j.log(`‚úÖ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü: ${r}`)}catch(n){j.error("„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç®„É©„Éº:",n),alert("„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}async function AZ(n){try{const e=JSON.parse(n);if(!e.version||!e.progress)throw new Error("ÁÑ°Âäπ„Å™„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„Åß„Åô");if(!confirm(`„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô„ÅãÔºü

„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊó•ÊôÇ: ${new Date(e.exportDate).toLocaleString()}
ÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ

Âæ©ÂÖÉÂâç„Å´ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`))return!1;if(await Or(e.progress),e.settings)for(const[s,r]of Object.entries(e.settings))localStorage.setItem(s,r);return j.log("‚úÖ „Éá„Éº„ÇøÂæ©ÂÖÉÂÆå‰∫Ü"),alert("„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),!0}catch(e){return j.error("„Éá„Éº„Çø„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:",e),alert("„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éï„Ç°„Ç§„É´„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ"),!1}}async function RZ(n){return new Promise((e,t)=>{const s=new FileReader;s.onload=async r=>{var o;try{const i=(o=r.target)==null?void 0:o.result,a=await AZ(i);e(a)}catch(i){t(i)}},s.onerror=()=>t(new Error("„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")),s.readAsText(n)})}function EZ({onResetComplete:n,allQuestions:e,onQuestionSetsUpdated:t}){const[s,r]=N.useState(!1),[o,i]=N.useState(null),[a,c]=N.useState(!1),[l,d]=N.useState(null),[h,f]=N.useState(null),[p,m]=N.useState([]),[g,x]=N.useState(null),[y,b]=N.useState([]),[w,v]=N.useState([]),[S,C]=N.useState([]),[k,I]=N.useState(0),A=()=>{try{let $=0;const D=[];for(let M=0;M<localStorage.length;M++){const P=localStorage.key(M);if(P){const L=localStorage.getItem(P);if(L){const O=new Blob([L]).size;$+=O,D.push({key:P,sizeMB:O/(1024*1024)})}}}D.sort((M,P)=>P.sizeMB-M.sizeMB),i({totalMB:$/(1024*1024),details:D.slice(0,5)})}catch($){j.error("„Çπ„Éà„É¨„Éº„Ç∏„Çµ„Ç§„Ç∫„ÅÆÂèñÂæó„Ç®„É©„Éº:",$)}},T=N.useCallback(()=>{d(G0()),f(H0()),m(ix(12)),x(ax());const D=rf(10).map(P=>{const L=e.find(O=>O.word&&P.word&&O.word.toLowerCase()===P.word.toLowerCase());return{...P,etymology:L==null?void 0:L.etymology,relatedWords:L==null?void 0:L.relatedWords,difficulty:L==null?void 0:L.difficulty}});b(D),v(Y0(10)),C(q0(7,5));const M=nt();I(M.statistics.streakDays),A()},[e]);N.useEffect(()=>{T();const $=async()=>{const P=(await cf()).some(L=>L.source==="weak-words");c(P)};$();const D=()=>{T(),$()};if(typeof window<"u"&&window.addEventListener(ya,D),s){const M=setInterval(()=>{T(),$()},1e3);return()=>{clearInterval(M),typeof window<"u"&&window.removeEventListener(ya,D)}}return()=>{typeof window<"u"&&window.removeEventListener(ya,D)}},[s,T]);const E=()=>{confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ")&&(rx(),d(null),f(null),m([]),x(null),b([]),v([]),C([]),I(0),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),T(),n&&n())};return u.jsxs("div",{className:"stats-view",children:[u.jsx("div",{className:"w-full mb-4 px-2",children:u.jsx(IZ,{minPredictions:50})}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üìÜ Â≠¶Áøí„Ç´„É¨„É≥„ÉÄ„Éº",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàÈÅéÂéª7Êó•ÈñìÔºâ"})]}),u.jsx(DZ,{streakDays:k})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üò∞ Ëã¶ÊâãÂçòË™û„Éà„ÉÉ„Éó10",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàË¶ÅÂæ©ÁøíÔºâ"})]}),y.length>0?u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-orange-200 p-6",children:[u.jsx("ul",{className:"space-y-3",children:y.map(($,D)=>u.jsx("li",{className:"p-4 bg-gradient-to-r from-orange-50 to-red-50/30/30 rounded-lg border border-orange-200 hover:shadow-md hover:scale-[1.02] transition-all duration-200",children:u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[u.jsx("span",{className:"flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full text-sm",children:D+1}),u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:$.word}),$.meaning&&u.jsx("span",{className:"text-sm text-gray-600 mt-1",children:$.meaning}),$.reading&&u.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:$.reading}),$.etymology&&u.jsxs("span",{className:"text-xs text-blue-600 mt-1",children:["üìñ ",$.etymology]}),$.relatedWords&&u.jsxs("span",{className:"text-xs text-purple-600 mt-0.5",children:["üîó ",$.relatedWords]})]})]}),u.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[u.jsxs("span",{className:"px-3 py-1 bg-red-100/50 text-red-700 rounded-full font-medium",children:["‚ùå ",$.mistakes,"Âõû"]}),$.recentAccuracy>0&&u.jsxs("span",{className:"px-3 py-1 bg-blue-100/50 text-blue-700 rounded-full font-medium",children:["Ê≠£Ëß£Áéá ",$.recentAccuracy,"%"]})]})]})},D))}),u.jsxs("div",{className:"mt-6 flex gap-3",children:[u.jsxs("button",{onClick:async()=>{try{const $=await wd(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")}`,20,3,60,e);await bd($),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${$.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch($){j.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",$),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2",children:["üìö ÂïèÈ°å„Çª„ÉÉ„Éà„Çí",a?"Êõ¥Êñ∞":"‰ΩúÊàê",u.jsx("span",{className:"text-xs opacity-90",children:"(‰∏ä‰Ωç20Ë™û)"})]}),u.jsx("button",{onClick:async()=>{const $=prompt("ÂèñÂæó„Åô„ÇãËã¶ÊâãË™ûÂè•„ÅÆÊï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1-100Ôºâ","30");if(!$)return;const D=parseInt($);if(isNaN(D)||D<1||D>100){alert("1„Åã„Çâ100„Åæ„Åß„ÅÆÊï∞ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}try{const M=await wd(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")} (${D}Ë™û)`,D,3,60,e);await bd(M),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${M.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(M){j.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",M),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚öôÔ∏è „Ç´„Çπ„Çø„É†"})]})]}):u.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50/20/20 rounded-xl border-2 border-dashed border-green-300 p-8 text-center",children:[u.jsx("p",{className:"text-xl font-semibold text-green-700",children:"Ëã¶Êâã„Å™ÂçòË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅüéâ"}),u.jsx("p",{className:"text-sm text-green-600 mt-2",children:"È†ÜË™ø„Å´Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô"})]})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-blue-200 p-6 mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó"}),u.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Â≠¶Áøí„Éá„Éº„Çø„ÇíJSON„Åß‰øùÂ≠ò/Âæ©ÂÖÉ„Åß„Åç„Åæ„Åô„ÄÇ„Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„ÉàÂâç„Å´„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÊé®Â•®„ÄÇ"}),u.jsx("button",{onClick:()=>{TZ()},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚¨áÔ∏è „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ"}),u.jsx("span",{className:"mx-2"}),u.jsx("input",{type:"file",accept:"application/json","aria-label":"„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû",onChange:async $=>{var P;const D=(P=$.target.files)==null?void 0:P[0];if($.target.value="",!D)return;await RZ(D)&&window.location.reload()}})]}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg border-2 border-red-200 p-6",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"‚ö†Ô∏è „Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„Éà"}),u.jsx("p",{className:"text-sm text-gray-600",children:"„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"})]}),u.jsx("button",{onClick:E,className:"px-8 py-3 bg-red-600 hover:bg-red-700:bg-red-800 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2",children:"üóëÔ∏è „É™„Çª„ÉÉ„ÉàÂÆüË°å"})]})})]}),o&&u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"üíæ „Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè"}),u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-purple-200 p-6",children:[u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"ÂêàË®à‰ΩøÁî®Èáè"}),u.jsxs("span",{className:`text-xl font-bold ${o.totalMB>4?"text-red-600":"text-green-600"}`,children:[o.totalMB.toFixed(2)," MB"," ",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/ Á¥Ñ 5-10 MB"})]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden relative",children:u.jsx("div",{className:`h-full rounded-full transition-all duration-500 absolute left-0 top-0 ${o.totalMB>8?"bg-red-600 w-full":o.totalMB>4?"bg-yellow-500":"bg-green-500"}`,"data-progress":Math.min(o.totalMB/10*100,100)})}),o.totalMB>4&&u.jsx("p",{className:"mt-2 text-sm font-medium text-red-600 flex items-center gap-1",children:"‚ö†Ô∏è ÂÆπÈáè„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})]}),u.jsxs("details",{className:"mt-4",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-700:text-blue-300 font-medium flex items-center gap-2",children:"üìä Ë©≥Á¥∞„ÇíË°®Á§∫"}),u.jsx("ul",{className:"mt-4 space-y-2",children:o.details.map(($,D)=>u.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[u.jsx("code",{className:"text-sm text-gray-700 font-mono",children:$.key}),u.jsxs("span",{className:"text-sm font-semibold text-gray-800",children:[$.sizeMB.toFixed(2)," MB"]})]},D))}),u.jsx("div",{className:"mt-4 p-4 bg-blue-50/20 rounded-lg border border-blue-200",children:u.jsxs("p",{className:"text-sm text-blue-700 flex items-start gap-2",children:[u.jsx("span",{className:"text-lg",children:"üí°"}),u.jsx("span",{children:"„Éí„É≥„Éà: „Éá„Éº„Çø„ÅåÂ§ß„Åç„Åè„Å™„Çä„Åô„Åé„ÅüÂ†¥Âêà„ÅØ„ÄÅÂè§„ÅÑÊàêÁ∏æ„ÇíÂâäÈô§„Åô„Çã„Å®ÂÆπÈáè„ÇíÁØÄÁ¥Ñ„Åß„Åç„Åæ„Åô„ÄÇ"})]})})]})]})]})]})}function DZ({streakDays:n}){const[e,t]=N.useState([]);if(N.useEffect(()=>{const o=ox(14);t(o)},[]),e.length===0)return u.jsxs("div",{className:"w-full p-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center",children:[u.jsx("p",{className:"text-gray-500 text-lg",children:"üìä „Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Â≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„Å®ÈÄ≤Êçó„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]});const s=e.slice(-7),r={memorization:{bg:"bg-green-500",text:"üü¢ ÊöóË®ò"},translation:{bg:"bg-blue-500",text:"üîµ ÂíåË®≥"},spelling:{bg:"bg-yellow-500",text:"üü° „Çπ„Éö„É´"},grammar:{bg:"bg-red-500",text:"üî¥ ÊñáÊ≥ï"}};return u.jsxs("div",{className:"w-full p-3 sm:p-6 bg-white rounded-xl shadow-lg border-2 border-blue-200",children:[u.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-gradient-to-r from-orange-100 to-yellow-100 rounded-lg border-2 border-orange-300 text-center",children:[u.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u.jsx("span",{className:"text-2xl sm:text-3xl",children:"üî•"}),u.jsxs("span",{className:"text-lg sm:text-2xl font-bold text-orange-600",children:[n,"Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ"]})]}),n>0&&u.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1 sm:mt-2",children:"„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ"})]}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2",children:s.map((o,i)=>{const c=new Date(o.date).getDay(),d=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"][c];return u.jsx("div",{className:"text-center",children:u.jsx("div",{className:"text-xs sm:text-sm font-bold text-gray-700 mb-1",children:d})},i)})}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:s.map((o,i)=>{const a=[{key:"memorization",data:o.memorization},{key:"translation",data:o.translation},{key:"spelling",data:o.spelling},{key:"grammar",data:o.grammar}],c=a.reduce((m,g)=>m+g.data.correct,0),l=a.reduce((m,g)=>m+g.data.count,0),d=new Date(o.date),h=`${d.getMonth()+1}/${d.getDate()}`,f=o.date===mx(new Date),p=a.filter(m=>m.data.count>0).map(m=>{const g=m.data.count>0?Math.round(m.data.correct/m.data.count*100):0;return`${r[m.key].text}: ${m.data.correct}/${m.data.count}Âïè (${g}%)`}).join(`
`);return u.jsxs("div",{className:"flex flex-col items-center group",children:[u.jsx("div",{className:`relative w-full h-24 sm:h-32 bg-gray-200 rounded-lg overflow-hidden flex flex-col-reverse border-2 shadow-sm hover:shadow-xl hover:scale-105 transition-all duration-300 ${f?"border-orange-400 ring-2 ring-orange-300 ring-offset-1":"border-gray-300"}`,title:l>0?`${o.date}${f?" [‰ªäÊó•]":""}
${p}`:`${o.date}: Êú™Â≠¶Áøí`,children:c===0?u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Êú™Â≠¶Áøí"}):u.jsxs(u.Fragment,{children:[a.map(m=>m.data.correct>0&&u.jsx("div",{className:`mode-progress-bar w-full ${r[m.key].bg} flex items-center justify-center text-white text-xs font-bold transition-all duration-500 ease-out hover:brightness-110`,style:{"--height-percent":m.data.correct/c*100,"--animation-delay":i*.1},children:u.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:m.data.correct})},m.key)),u.jsx("div",{className:"hidden sm:flex absolute inset-0 bg-black/80 text-white p-2 text-[10px] leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none flex-col justify-center",children:a.filter(m=>m.data.count>0).map(m=>{const g=Math.round(m.data.correct/m.data.count*100);return u.jsxs("div",{className:"mb-1",children:[u.jsx("div",{className:"font-bold",children:r[m.key].text}),u.jsxs("div",{children:[m.data.correct,"/",m.data.count,"Âïè (",g,"%)"]})]},m.key)})})]})}),u.jsxs("div",{className:"mt-1 sm:mt-2 text-center",children:[u.jsxs("div",{className:`text-[10px] sm:text-xs ${f?"text-orange-600 font-bold":"text-gray-500"}`,children:[h,f&&" üéØ"]}),u.jsxs("div",{className:"text-xs sm:text-sm font-bold text-gray-800",children:[c,"Âïè"]})]})]},i)})}),u.jsx("style",{children:`
        @keyframes slideUp {
          from {
            height: 0%;
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        .mode-progress-bar {
          height: calc(var(--height-percent, 0) * 1%);
          animation: slideUp 0.6s ease-out calc(var(--animation-delay, 0) * 1s) both;
        }
      `}),u.jsx("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t-2 border-gray-200",children:u.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-4 text-xs sm:text-sm",children:Object.entries(r).map(([o,i])=>u.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[u.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 ${i.bg} rounded`}),u.jsx("span",{className:"text-gray-700",children:i.text})]},o))})})]})}function jZ({allQuestions:n,onStartSession:e,_selectedDataSource:t="all",_onDataSourceChange:s,customQuestionSets:r,onOpenCustomSetManagement:o,questionSets:i=[],categoryList:a=[],onResetComplete:c,onQuestionSetsUpdated:l}){const[d,h]=N.useState("settings"),[f,p]=N.useState(()=>{const T=localStorage.getItem("batchSize");return T?parseInt(T,10):20}),[m,g]=N.useState(()=>localStorage.getItem("aiPersonality")||"kind-teacher"),x=T=>{g(T),localStorage.setItem("aiPersonality",T)},[y,b]=N.useState(()=>{const T=localStorage.getItem("voiceGender");return T==="female"||T==="male"?T:"female"}),[w,v]=N.useState(()=>{const T=localStorage.getItem("speechRate");return T?parseFloat(T):.9}),S=T=>{b(T),localStorage.setItem("voiceGender",T)},C=T=>{v(T),localStorage.setItem("speechRate",T.toString())},[k,I]=N.useState(()=>{const T=localStorage.getItem("darkMode");return T==="system"||T==="light"||T==="dark"?T:T==="true"?"dark":T==="false"?"light":"system"}),A=T=>{let E=!1;T==="system"?E=window.matchMedia("(prefers-color-scheme: dark)").matches:E=T==="dark",document.documentElement.classList.toggle("dark",E)};return N.useEffect(()=>{if(A(k),k==="system"){const T=window.matchMedia("(prefers-color-scheme: dark)"),E=()=>{A("system")};return T.addEventListener("change",E),()=>T.removeEventListener("change",E)}},[k]),n.length,u.jsxs("div",{className:"w-full",children:[u.jsxs("div",{className:"flex gap-2 mb-6 border-b-2 border-gray-200",children:[u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="settings"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("settings"),children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="grammar"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("grammar"),children:"üìù ÊñáÊ≥ï"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="dictionary"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("dictionary"),children:"üìï ËæûÊõ∏"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="stats"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("stats"),children:"üìä ÊàêÁ∏æ"})]}),d==="grammar"?u.jsx(fZ,{}):d==="dictionary"?u.jsx(xZ,{}):d==="stats"?u.jsx(EZ,{questionSets:i,allQuestions:n,categoryList:a,onResetComplete:c||(()=>h("stats")),onQuestionSetsUpdated:l||(async()=>{})}):u.jsxs("div",{className:"px-4 py-6 space-y-6",children:[u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà"}),u.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:["(",r.length,"ÂÄã)"]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("button",{onClick:o,className:"w-full px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all shadow-md flex items-center justify-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÁÆ°ÁêÜ"})]}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg",children:"üí° Ëá™ÂàÜ„Å†„Åë„ÅÆ„Ç™„É™„Ç∏„Éä„É´ÂïèÈ°å„Çª„ÉÉ„Éà„Çí‰ΩúÊàê„ÉªÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇÂ≠¶Áøí„Åó„Åü„ÅÑÂçòË™û„ÇíËá™Áî±„Å´ËøΩÂä†„Åó„Å¶„ÄÅÂäπÁéáÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]})]}),u.jsx(hZ,{allQuestions:n,onStartSession:e}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üé≠"}),u.jsx("span",{children:"AI„ÅÆ‰∫∫Ê†º"})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(dY).map(([T,E])=>u.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all duration-200 ${m===T?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md hover:scale-102"}`,onClick:()=>x(T),children:[u.jsx("div",{className:"text-3xl",children:E.avatar}),u.jsx("div",{className:"font-semibold text-sm",children:E.name}),u.jsx("div",{className:"text-xs opacity-80 text-center",children:E.description})]},T))})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üîä"}),u.jsx("span",{children:"Èü≥Â£∞Ë®≠ÂÆö"})]}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üé§"}),u.jsx("span",{children:"Â£∞„ÅÆÁ®ÆÈ°û"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${y==="female"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>S("female"),children:[u.jsx("div",{className:"text-3xl",children:"üë©"}),u.jsx("div",{className:"text-sm font-semibold",children:"Â•≥ÊÄß"})]}),u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${y==="male"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>S("male"),children:[u.jsx("div",{className:"text-3xl",children:"üë®"}),u.jsx("div",{className:"text-sm font-semibold",children:"Áî∑ÊÄß"})]})]})]}),u.jsxs("div",{children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"}),u.jsx("span",{children:"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsx("span",{className:"text-xs font-normal text-text-secondary",children:"(WPM: Words Per Minute)"})]}),u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6",children:[u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("div",{className:"font-bold text-primary text-4xl mb-1",children:Math.round(w*150)}),u.jsx("div",{className:"text-sm text-text-secondary",children:"WPM"}),u.jsx("div",{className:"text-xs text-text-secondary mt-2",children:w<.75?"üê¢ „ÇÜ„Å£„Åè„Çä„Å®Áô∫Èü≥":w>=.95?"üöÄ „Éç„Ç§„ÉÜ„Ç£„Éñ‰∏¶„ÅÆÈÄüÂ∫¶":"üéØ È´òÊ†°ÂÖ•Ë©¶„É™„Çπ„Éã„É≥„Ç∞Áõ∏ÂΩì"})]}),u.jsxs("div",{className:"relative mb-8",children:[u.jsx("input",{type:"range",min:"0.6",max:"1.0",step:"0.05",value:w,onChange:T=>C(parseFloat(T.target.value)),className:"w-full h-3 bg-border-color rounded-lg appearance-none cursor-pointer accent-primary","aria-label":"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsxs("div",{className:"absolute top-0 left-0 w-full h-3 pointer-events-none",children:[u.jsx("div",{className:"absolute top-1/2 left-0 -translate-y-1/2 w-0.5 h-5 bg-gray-400"}),u.jsx("div",{className:"absolute top-1/2 left-[37.5%] -translate-y-1/2 w-0.5 h-5 bg-blue-500"}),u.jsx("div",{className:"absolute top-1/2 left-[75%] -translate-y-1/2 w-0.5 h-5 bg-green-500"}),u.jsx("div",{className:"absolute top-1/2 left-full -translate-y-1/2 -translate-x-0.5 w-0.5 h-5 bg-orange-500"})]})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs",children:[u.jsxs("button",{onClick:()=>C(.6),className:"bg-gray-50/50 rounded-lg p-3 border border-gray-200 hover:bg-gray-100:bg-gray-700/50 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-gray-600",children:"90 WPM"}),u.jsx("div",{className:"text-gray-500 mt-1",children:"ÊúÄ‰ΩéÈÄüÂ∫¶"})]}),u.jsxs("button",{onClick:()=>C(.75),className:"bg-blue-50/20 rounded-lg p-3 border border-blue-200 hover:bg-blue-100:bg-blue-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-blue-600",children:"113 WPM"}),u.jsx("div",{className:"text-blue-500 mt-1",children:"ÂàùÂ≠¶ËÄÖÂêë„Åë"})]}),u.jsxs("button",{onClick:()=>C(.9),className:"bg-green-50/20 rounded-lg p-3 border border-green-200 hover:bg-green-100:bg-green-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-green-600",children:"135 WPM"}),u.jsx("div",{className:"text-green-500 mt-1",children:"È´òÊ†°ÂÖ•Ë©¶"})]}),u.jsxs("button",{onClick:()=>C(1),className:"bg-orange-50/20 rounded-lg p-3 border border-orange-200 hover:bg-orange-100:bg-orange-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-orange-600",children:"150 WPM"}),u.jsx("div",{className:"text-orange-500 mt-1",children:"„Éç„Ç§„ÉÜ„Ç£„Éñ"})]})]})]})]})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìã"}),u.jsx("span",{children:"„Éó„É©„Ç§„Éê„Ç∑„Éº"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("a",{href:"/privacy.html",target:"_blank",rel:"noopener noreferrer",className:"block w-full px-4 py-3 bg-primary text-white text-center rounded-lg font-semibold hover:bg-btn-primary-hover transition-colors shadow-md",children:"üìÑ „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg text-center",children:"Êú¨„Ç¢„Éó„É™„ÅØÂÄã‰∫∫ÊÉÖÂ†±„ÇíÂèéÈõÜ„Åõ„Åö„ÄÅÂ≠¶Áøí„Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂ÂÜÖ„Å´„ÅÆ„Åø‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ"})]})]})]})]})}function _Z(n){const e=(n||"").trim();if(e&&(e==="junior"||e==="intermediate"||e==="history"||e==="geography"||e==="civics"))return e}function PZ(n){const e=(n||"").trim();return e==="‰∫∫Áâ©Âêç"||e==="Âá∫Êù•‰∫ã"||e==="Âú∞Âêç"||e==="Âà∂Â∫¶Ê¶ÇÂøµ"?e:"„Åù„ÅÆ‰ªñ"}const MZ=new Set(["Âú∞ÁêÜ","Ê≠¥Âè≤","ÊîøÊ≤ª","ÁµåÊ∏à","ÂõΩÈöõ"]);function FZ(n){const e=(n||"").trim();if(!e)return null;const t=e.indexOf("„ÄÇ");if(t!==-1)return e.slice(0,t).trim()||null;const s=e.indexOf(".");if(s!==-1)return e.slice(0,s+1).trim().replace(/\.$/,"")||null;const r=80;return e.length>r?e.slice(0,r).trim():e}function OZ(n,e){const t=(n||"").trim();if(MZ.has(t)){const s=FZ(e);if(s)return s}return t}function LZ(n){const e=[];let t="",s=!1;for(let i=0;i<n.length;i++){const a=n[i],c=n[i+1];a==='"'?s&&c==='"'?(t+='"',i++):s=!s:a===`
`&&!s?(t.trim()&&e.push(t),t=""):t+=a}if(t.trim()&&e.push(t),e.length<2)return[];const r=zb(e[0]),o=[];for(let i=1;i<e.length;i++){const a=zb(e[i]),c={};r.forEach((l,d)=>{c[l]=a[d]||""}),o.push(c)}return o}function zb(n){const e=[];let t="",s=!1;for(let r=0;r<n.length;r++){const o=n[r],i=n[r+1];o==='"'?s&&i==='"'?(t+='"',r++):s=!s:o===","&&!s?(e.push(t.trim()),t=""):t+=o}return e.push(t.trim()),e}async function Hk(n){var e;try{const t=n.includes("classical")||n.includes("kanbun")?"classical-japanese":"social-studies",s=`/data/${t}/${n}`;console.log("[loadSocialStudiesCSV] „Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÈñãÂßã:",{filename:n,directory:t,url:s});const r=await fetch(s);if(!r.ok)throw new Error(`„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó: ${r.status} ${r.statusText} (URL: ${s})`);const o=await r.text();console.log("[loadSocialStudiesCSV] CSVË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:",{filename:n,length:o.length,firstLine:(e=o.split(`
`)[0])==null?void 0:e.slice(0,100)});const i=LZ(o);console.log("[loadSocialStudiesCSV] CSVËß£ÊûêÂÆå‰∫Ü:",{filename:n,rowCount:i.length});const a=i.map(c=>({word:c.Ë™ûÂè•,reading:c.Ë™≠„Åø,meaning:OZ(c.ÊÑèÂë≥,c.Ë©≥Á¥∞Ëß£Ë™¨||c.Ëß£Ë™¨||""),etymology:c.Ë©≥Á¥∞Ëß£Ë™¨||c.Ëß£Ë™¨||"",relatedWords:c.Èñ¢ÈÄ£‰∫ãÈ†Ö,relatedFields:c.Èñ¢ÈÄ£ÂàÜÈáé||c.ÊôÇ‰ª£ËÉåÊôØ||"",difficulty:"intermediate",source:_Z(c.source||""),termType:PZ(c.Á®ÆÂà•),example1:c.‰æãÊñá1||"",example2:c.‰æãÊñá2||""}));return console.log("[loadSocialStudiesCSV] QuestionÂ§âÊèõÂÆå‰∫Ü:",{filename:n,questionCount:a.length}),a}catch(t){throw console.error("[loadSocialStudiesCSV] „Ç®„É©„ÉºÁô∫Áîü:",{filename:n,error:t}),t}}const Wb=[{id:"all-social-studies",name:"ÂÖ®ÂàÜÈáé",filename:"all-social-studies.csv"},{id:"social-studies-sample",name:"„Çµ„É≥„Éó„É´",filename:"social-studies-sample.csv"},{id:"social-studies-history",name:"Ê≠¥Âè≤",filename:"social-studies-history-40.csv"},{id:"social-studies-geography",name:"Âú∞ÁêÜ",filename:"social-studies-geography-30.csv"},{id:"social-studies-civics",name:"ÂÖ¨Ê∞ë",filename:"social-studies-civics-30.csv"}];function Bb(n){if(Array.isArray(n))return n.map(e=>String(e).trim()).filter(Boolean);if(typeof n=="string"){const e=n.trim();return e?e.split("|").map(t=>t.trim()).filter(Boolean):[]}return[]}function Vb({dataSource:n="all-social-studies.csv"}){var pt,Tt;const[e,t]=N.useState([]),[s,r]=N.useState(0),[o,i]=N.useState(!1),[a,c]=N.useState(null),[l,d]=N.useState(0),[h,f]=N.useState(0),[p,m]=N.useState(!0),[g,x]=N.useState(null),[y,b]=N.useState(!1),w=n.includes("classical"),v=[10,20,30,50,75,100,150,200,300,500],[S,C]=N.useState("all"),[k,I]=N.useState("all"),A=[{id:"all",name:"Âè§ÊñáÁ∑èÂêà"},{id:"vocabulary",name:"Âè§ÊñáÂçòË™û"},{id:"knowledge",name:"Âè§ÊñáÁü•Ë≠ò"},{id:"grammar",name:"Âè§ÊñáÊñáÊ≥ï"},{id:"kanbun",name:"Êº¢ÊñáÁ∑èÂêà"},{id:"kanbun-practice",name:"Êº¢ÊñáÂÆüË∑µ"}],T="japanese-classical-source",[E,$]=N.useState(()=>{if(!w)return"all";try{return localStorage.getItem(T)||"all"}catch{return"all"}}),[D,M]=N.useState(()=>{try{return localStorage.getItem("translation-autoNext")==="true"}catch{return!1}}),[P,L]=N.useState(()=>{try{const se=localStorage.getItem("translation-autoNextDelay");return se?parseInt(se):1500}catch{return 1500}}),[O,F]=N.useState(()=>{try{return localStorage.getItem("translation-autoShowDetails")==="true"}catch{return!1}}),[V,G]=N.useState(()=>{try{return localStorage.getItem("translation-autoShowDetailsOnCorrect")==="true"}catch{return!1}}),[_,Z]=N.useState(()=>{try{return localStorage.getItem("translation-autoPlayAudio")==="true"}catch{return!1}}),te=N.useMemo(()=>{const se=new Map;for(const ze of e){const Nt=ze.source?String(ze.source):"junior";se.set(Nt,(se.get(Nt)??0)+1)}const Ge=ze=>{switch(ze){case"history":return"Ê≠¥Âè≤";case"geography":return"Âú∞ÁêÜ";case"civics":return"ÂÖ¨Ê∞ë";case"junior":return"‰∏≠Â≠¶ÔºàÁ∑èÂêàÔºâ";default:return`Á§æ‰ºöÔºà${ze}Ôºâ`}};return Array.from(se.entries()).sort(([ze],[Nt])=>ze.localeCompare(Nt)).map(([ze,Nt])=>({id:ze,name:Ge(ze),count:Nt}))},[e]),he=N.useMemo(()=>{const se=new Set;return e.forEach(Ge=>{Bb(Ge.relatedFields).forEach(ze=>se.add(ze))}),Array.from(se).sort()},[e]),oe=N.useMemo(()=>{if(w)return e;let se=e;return S!=="all"&&(se=se.filter(Ge=>String(Ge.source||"")===S)),k!=="all"&&(se=se.filter(Ge=>Bb(Ge.relatedFields).includes(k))),se},[e,w,k,S]),ve=(()=>{try{const se=w?"japanese-translation-batch-size":"memorization-batch-size",Ge=localStorage.getItem(se);return Ge?parseInt(Ge):null}catch{return null}})(),$e=(()=>{try{const se=w?"japanese-translation-review-ratio-limit":"memorization-review-ratio-limit",Ge=localStorage.getItem(se);return Ge?parseInt(Ge):20}catch{return 20}})(),{sessionStats:Ae,setSessionStats:De,resetStats:we}=eu("translation"),Re=N.useMemo(()=>{if(!w)return n;const se=A.find(ze=>ze.id===E);return(se==null?void 0:se.id)==="all"?"classical-words.csv":(se==null?void 0:se.id)==="vocabulary"?"classical-vocabulary.csv":(se==null?void 0:se.id)==="knowledge"?"classical-knowledge.csv":(se==null?void 0:se.id)==="grammar"?"classical-grammar.csv":(se==null?void 0:se.id)==="kanbun"?"kanbun-words.csv":(se==null?void 0:se.id)==="kanbun-practice"?"kanbun-practice.csv":n},[w,E,n]);N.useEffect(()=>{if(!w)return;const se=()=>{try{const Ge=localStorage.getItem(T)||"all";$(Ge)}catch{$("all")}};return window.addEventListener("japanese-classical-source-changed",se),()=>window.removeEventListener("japanese-classical-source-changed",se)},[w]),N.useEffect(()=>{et()},[Re]);const et=async()=>{try{m(!0),x(null);const se=await Hk(Re),Ge=w?se.map(ze=>({...ze,etymology:`${ze.etymology}

„ÄêË™ûÂè•„Äë${ze.word} (${ze.reading})
„ÄêÊÑèÂë≥„Äë${ze.meaning}`})):se.map(ze=>({...ze,word:ze.meaning,meaning:ze.word,etymology:`${ze.etymology}

Ê≠£Ëß£: ${ze.word} (${ze.reading})`}));t(Ge),r(0),i(!1),c(null),d(0),f(0),m(!1)}catch(se){console.error("Á§æ‰ºöÁßë„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",se),x(se instanceof Error?se.message:"‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü"),m(!1)}},je=(se,Ge)=>{if(o)return;c(se),i(!0);const ze=se===Ge;f(Nt=>Nt+1),d(Nt=>ze?Nt+1:Nt),De(Nt=>({...Nt,correct:Nt.correct+(ze?1:0),incorrect:Nt.incorrect+(ze?0:1),newQuestions:Nt.newQuestions+1}))},lt=()=>{oe.length!==0&&(r(se=>(se+1)%oe.length),c(null),i(!1))},ht=()=>{r(se=>Math.max(se-1,0)),c(null),i(!1)},it=()=>{oe.length!==0&&(d(se=>se+1),f(se=>se+1),De(se=>({...se,correct:se.correct+1,mastered:se.mastered+1})),r(se=>(se+1)%oe.length),c(null),i(!1))},st=()=>{o?lt():it()};if(N.useEffect(()=>{w||(r(0),c(null),i(!1),d(0),f(0),we())},[w,we,k,S]),N.useEffect(()=>{s<oe.length||(r(0),c(null),i(!1))},[s,oe.length]),p)return u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})]})});if(g)return u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsxs("div",{className:"text-center text-red-600",children:[u.jsx("p",{className:"text-lg font-semibold mb-2",children:"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü"}),u.jsx("p",{children:g})]})});if(oe.length===0)return u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsx("p",{className:"text-gray-600",children:"ÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü"})});const Ye=oe[s];return u.jsxs("div",{className:"quiz-view",children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Zl,{mode:"translation",storageKeyPrefix:w?"japanese":void 0,currentScore:l,totalAnswered:h,sessionCorrect:Ae==null?void 0:Ae.correct,sessionIncorrect:Ae==null?void 0:Ae.incorrect,sessionReview:Ae==null?void 0:Ae.review,sessionMastered:Ae==null?void 0:Ae.mastered,currentWord:Ye==null?void 0:Ye.word,dataSource:((pt=Wb.find(se=>se.filename===n))==null?void 0:pt.name)||"Á§æ‰ºö",onShowSettings:()=>b(!0)})})}),y&&u.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-lg p-6 max-w-4xl mx-auto",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold",children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"space-y-4",children:[w&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"japanese-classical-datasource-quiz",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsx("select",{id:"japanese-classical-datasource-quiz",value:E,onChange:se=>{const Ge=se.target.value;$(Ge);try{localStorage.setItem(T,Ge)}catch{}window.dispatchEvent(new Event("japanese-classical-source-changed"))},className:"w-full px-3 py-2 border rounded-lg",children:A.map(se=>u.jsx("option",{value:se.id,children:se.name},se.id))})]}),!w&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-datasource",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsxs("select",{id:"memorization-datasource",value:S,onChange:se=>C(se.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:((Tt=Wb.find(se=>se.filename===n))==null?void 0:Tt.name)||"Á§æ‰ºöÔºàÁ∑èÂêàÔºâ"}),te.map(se=>u.jsx("option",{value:se.id,children:se.name},se.id))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-category",className:"block text-sm font-medium mb-2 text-gray-700",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"memorization-category",value:k,onChange:se=>I(se.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂàÜÈáé"}),he.map(se=>u.jsx("option",{value:se,children:se},se))]})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{htmlFor:"translation-batch-size",className:"block text-sm font-medium mb-2 text-gray-700",children:"üì¶ „Éê„ÉÉ„ÉÅÊï∞:"}),u.jsxs("select",{id:"translation-batch-size",value:ve??"",onChange:se=>{const Ge=se.target.value===""?null:parseInt(se.target.value),ze=w?"japanese-translation-batch-size":"memorization-batch-size";try{Ge===null?localStorage.removeItem(ze):localStorage.setItem(ze,String(Ge)),window.location.reload()}catch{}},className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"",children:"Âà∂Èôê„Å™„Åó"}),u.jsx("option",{value:"10",children:"10Âïè"}),u.jsx("option",{value:"20",children:"20Âïè"}),u.jsx("option",{value:"30",children:"30Âïè"}),u.jsx("option",{value:"50",children:"50Âïè"}),!w&&u.jsxs(u.Fragment,{children:[u.jsx("option",{value:"100",children:"100Âïè"}),u.jsx("option",{value:"200",children:"200Âïè"})]}),w&&v.filter(se=>se>50).filter(se=>se<=oe.length).map(se=>u.jsxs("option",{value:se,children:[se,"Âïè"]},se))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"translation-review-ratio-limit",className:"block text-sm font-medium mb-2 text-gray-700",children:"‚ùå ‰∏çÊ≠£Ëß£„ÅÆ‰∏äÈôê:"}),u.jsxs("select",{id:"translation-review-ratio-limit",value:$e,onChange:se=>{const Ge=parseInt(se.target.value),ze=w?"japanese-translation-review-ratio-limit":"memorization-review-ratio-limit";try{localStorage.setItem(ze,String(Ge)),window.location.reload()}catch{}},className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"10",children:"10%"}),u.jsx("option",{value:"20",children:"20%"}),u.jsx("option",{value:"30",children:"30%"}),u.jsx("option",{value:"40",children:"40%"}),u.jsx("option",{value:"50",children:"50%"})]})]}),u.jsx("div",{className:"border-t pt-4",children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle",checked:D,onChange:se=>{M(se.target.checked),localStorage.setItem("translation-autoNext",se.target.checked.toString())},className:"w-4 h-4"}),u.jsxs("label",{htmlFor:"auto-next-toggle",className:"text-sm font-medium text-gray-700",children:["‚úÖ Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",D?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),D&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"auto-next-delay",className:"block text-sm font-medium mb-2 text-gray-700",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("input",{type:"range",id:"auto-next-delay",min:"500",max:"3000",step:"100",value:P,onChange:se=>{const Ge=parseInt(se.target.value,10);L(Ge),localStorage.setItem("translation-autoNextDelay",Ge.toString())},className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),u.jsxs("span",{className:"text-sm font-medium text-gray-700 min-w-[3rem] text-right",children:[(P/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"border-t pt-4",children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-toggle",checked:O,onChange:se=>{F(se.target.checked),localStorage.setItem("translation-autoShowDetails",se.target.checked.toString())},className:"w-4 h-4"}),u.jsxs("label",{htmlFor:"auto-show-details-toggle",className:"text-sm font-medium text-gray-700",children:["‚ùå ‰∏çÊ≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",O?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),u.jsx("div",{children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-correct-toggle",checked:V,onChange:se=>{G(se.target.checked),localStorage.setItem("translation-autoShowDetailsOnCorrect",se.target.checked.toString())},className:"w-4 h-4"}),u.jsxs("label",{htmlFor:"auto-show-details-correct-toggle",className:"text-sm font-medium text-gray-700",children:["‚úÖ Ê≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",V?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),u.jsx("div",{children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("input",{type:"checkbox",id:"auto-play-audio-toggle",checked:_,onChange:se=>{Z(se.target.checked),localStorage.setItem("translation-autoPlayAudio",se.target.checked.toString())},className:"w-4 h-4"}),u.jsxs("label",{htmlFor:"auto-play-audio-toggle",className:"text-sm font-medium text-gray-700",children:["üîä Ëá™Âãï„ÅßÁô∫Èü≥„Åô„ÇãÔºö",_?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]})]}),u.jsx("div",{className:"flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl px-4",children:u.jsx(Gp,{question:Ye,questionNumber:s+1,allQuestions:oe,currentIndex:s,answered:o,selectedAnswer:a,onAnswer:(se,Ge)=>je(se,Ge),onNext:st,onPrevious:ht})})})]})}const qk=({isVisible:n,message:e="Ë™≠„ÅøËæº„Åø‰∏≠..."})=>n?u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 pointer-events-auto",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-6 animate-in fade-in duration-300",children:[u.jsxs("div",{className:"relative w-16 h-16",children:[u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-gray-200"}),u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-600 animate-spin"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:e}),u.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Ê∫ñÂÇô‰∏≠„Åß„Åô..."})]})]})}):null;function zZ(n){const e=new Map;for(const r of n){const o=r.source?String(r.source):"junior",i=e.get(o);i?i.push(r):e.set(o,[r])}const t=Date.now(),s=r=>{switch(r){case"history":return"Ê≠¥Âè≤";case"geography":return"Âú∞ÁêÜ";case"civics":return"ÂÖ¨Ê∞ë";case"junior":return"‰∏≠Â≠¶ÔºàÁ∑èÂêàÔºâ";default:return`Á§æ‰ºöÔºà${r}Ôºâ`}};return Array.from(e.entries()).sort(([r],[o])=>r.localeCompare(o)).map(([r,o])=>({id:r,name:s(r),questions:o,createdAt:t,isBuiltIn:!0,source:"Á§æ‰ºö"}))}const WZ=[{id:"all",name:"Âè§ÊñáÁ∑èÂêà",filename:"classical-words.csv"},{id:"vocabulary",name:"Âè§ÊñáÂçòË™û",filename:"classical-vocabulary.csv"},{id:"knowledge",name:"Âè§ÊñáÁü•Ë≠ò",filename:"classical-knowledge.csv"},{id:"grammar",name:"Âè§ÊñáÊñáÊ≥ï",filename:"classical-grammar.csv"},{id:"kanbun",name:"Êº¢ÊñáÁ∑èÂêà",filename:"kanbun-words.csv"},{id:"kanbun-practice",name:"Êº¢ÊñáÂÆüË∑µ",filename:"kanbun-practice.csv"}];function Ub({dataSource:n="all-social-studies.csv"}){const[e,t]=N.useState({status:"loading"}),s=n.includes("classical"),r="japanese-classical-source",[o,i]=N.useState(()=>{if(!s)return"all";try{return localStorage.getItem(r)||"all"}catch{return"all"}}),a=(()=>{if(!s)return n;const h=WZ.find(f=>f.id===o);return(h==null?void 0:h.filename)||n})();N.useEffect(()=>{if(!s)return;const h=()=>{try{i(localStorage.getItem(r)||"all")}catch{i("all")}};return window.addEventListener("japanese-classical-source-changed",h),()=>window.removeEventListener("japanese-classical-source-changed",h)},[s]),N.useEffect(()=>{let h=!1;return(async()=>{try{const p=await Hk(a);if(h)return;t({status:"ready",questions:p})}catch(p){if(h)return;console.error("[SocialMemorizationView] „Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",{filename:a,error:p,stack:p instanceof Error?p.stack:void 0});const m=p instanceof Error?p.message:"‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü";t({status:"error",message:m})}})(),()=>{h=!0}},[a]);const c=N.useMemo(()=>e.status!=="ready"?[]:zZ(e.questions),[e]),l=s?"japanese":"social",d=s?"ÂõΩË™ûÔºàÂè§ÊñáÔºâ":"Á§æ‰ºöÔºàÁ∑èÂêàÔºâ";return e.status==="loading"?u.jsx(qk,{isVisible:!0}):e.status==="error"?u.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:u.jsxs("div",{className:"text-center text-red-600 max-w-2xl px-4",children:[u.jsx("p",{className:"text-lg font-semibold mb-2",children:"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü"}),u.jsx("p",{className:"mb-4 break-words",children:e.message}),u.jsxs("details",{className:"text-left text-sm bg-gray-50 p-4 rounded-lg text-gray-700",children:[u.jsx("summary",{className:"cursor-pointer font-semibold mb-2",children:"Ë©≥Á¥∞ÊÉÖÂ†±"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"„Éï„Ç°„Ç§„É´Âêç:"})," ",a]}),u.jsxs("p",{children:[u.jsx("strong",{children:"„Éë„Çπ:"})," /data/classical-japanese/",a]}),u.jsx("p",{className:"text-xs text-gray-500",children:"üí° „Éñ„É©„Ç¶„Ç∂„ÅÆÈñãÁô∫ËÄÖ„ÉÑ„Éº„É´ÔºàF12„Ç≠„ÉºÔºâ„ÅÆ„ÄåConsole„Äç„Çø„Éñ„ÅßË©≥Á¥∞„Å™„Ç®„É©„Éº„É≠„Ç∞„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô"})]})]})]})}):u.jsx(u.Fragment,{children:u.jsx(Uk,{subject:l,allDataSourceLabel:d,allQuestions:e.questions,questionSets:c})})}let Su=null,Cu=null;async function Gb(){return Su||(Su=(await On(()=>Promise.resolve().then(()=>KJ),void 0)).default,Su)}async function Hb(){return Cu||(Cu=(await On(()=>import("./ComprehensiveReadingView-DL2win2t.js"),__vite__mapDeps([7,2,3]))).default,Cu)}function qb(){typeof requestIdleCallback<"u"?requestIdleCallback(()=>{Gb(),Hb()}):setTimeout(()=>{Gb(),Hb()},2e3)}const Kk=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function BZ(){try{let n=0;const e=[];for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r){const o=localStorage.getItem(r);if(o){const i=new Blob([o]).size;n+=i,e.push({key:r,size:i})}}}const t=n/(1024*1024);j.log(`üìä LocalStorage‰ΩøÁî®Èáè: ${t.toFixed(2)}MB`),e.sort((s,r)=>r.size-s.size),e.slice(0,5).forEach(s=>{const r=s.size/1048576;j.log(`  - ${s.key}: ${r.toFixed(2)}MB`)}),t>4&&(j.warn("‚ö†Ô∏è LocalStorage„ÅÆ‰ΩøÁî®Èáè„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂè§„ÅÑ„Éá„Éº„Çø„ÇíËá™ÂãïÂâäÈô§„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"),bs(),j.log("Ëá™ÂãïÂúßÁ∏Æ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ"))}catch(n){j.error("LocalStorage„Çµ„Ç§„Ç∫„ÅÆÁ¢∫Ë™ç„Ç®„É©„Éº:",n)}}function VZ(){const[n,e]=N.useState("english"),[t,s]=N.useState("multiple-choice"),[r,o]=N.useState("multiple-choice"),[i,a]=N.useState("multiple-choice"),c=n==="english"?r==="multiple-choice"?"translation":r:n==="social"?"social-studies":n==="settings"?"settings":"translation",[l,d]=N.useState(!1),[h,f]=N.useState([]),[p,m]=N.useState(()=>i9()),[g,x]=N.useState(!1);N.useEffect(()=>{a9(p)},[p]),N.useEffect(()=>{!window.location.hostname.includes("github.io")&&On(()=>import("./scoreBoardTests-DzaGoxnK.js"),__vite__mapDeps([8,2,3])).then(()=>{j.log("‚úÖ „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü"),j.log("   ‰Ωø„ÅÑÊñπ: window.runScoreBoardTests()"),j.log('   „Åæ„Åü„ÅØ: window.checkCurrentScoreBoardDisplay("translation")')}).catch(K=>{j.error("„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",K)})},[]);const{categoryList:y,setCategoryList:b,selectedCategory:w,setSelectedCategory:v,selectedDifficulty:S,setSelectedDifficulty:C,selectedWordPhraseFilter:k,setSelectedWordPhraseFilter:I,selectedPhraseTypeFilter:A,setSelectedPhraseTypeFilter:T}=r9(),[E,$]=N.useState(()=>{const xe=localStorage.getItem("selectedDataSource-translation");if(xe)try{return JSON.parse(xe)}catch{return"all"}return"all"}),[D,M]=N.useState(()=>{const xe=localStorage.getItem("selectedDataSource-spelling");if(xe)try{return JSON.parse(xe)}catch{return"all"}return"all"}),[P,L]=N.useState([]),[O,F]=N.useState(!1),V=N.useRef(!1);N.useEffect(()=>{V.current=!1},[c]),N.useEffect(()=>{O&&(c==="translation"||c==="spelling")&&!V.current&&te.questions.length===0&&(V.current=!0,re())},[O,c]);const[G]=N.useState(()=>{const xe=localStorage.getItem("quiz-adaptive-mode");return xe?JSON.parse(xe):!1}),{sessionStats:_,setSessionStats:Z,quizState:te,setQuizState:he,reviewFocusMode:oe,setReviewFocusMode:ve,reviewQuestionPool:$e,setReviewQuestionPool:Ae,reviewCorrectStreak:De,setReviewCorrectStreak:we}=o9(),[Re]=N.useState(()=>new $s),{reAddQuestion:et,clearExpiredFlags:je,updateRequeueStats:lt,checkPositionMismatch:ht}=Jl(),[it,st]=N.useState(0),[Ye,pt]=N.useState(!1),[Tt,se]=N.useState(null),Ge=N.useRef(0),ze=N.useRef(0),Nt=N.useRef([]),sn=N.useRef(0),Ht=N.useRef([]),Fe=N.useRef(null),ge=N.useRef(null),Pe=N.useRef(new Map),tt=N.useRef([]),vt=N.useRef([]);N.useEffect(()=>{if(c!=="translation"||!Ye||te.questions.length===0)return;const xe=te.currentIndex,K=te.answered?xe+1:xe;(async()=>{try{const Ne=te.questions.slice(K);if(Ne.length===0){pt(!1),se(null),st(0);return}j.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:it,reason:Tt,currentIndex:xe,startIndex:K,remaining:Ne.length});const Xe=await Re.schedule({questions:Ne,mode:"translation",useCategorySlots:!0,limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:_.correct,incorrect:_.incorrect,still_learning:_.review||0,mastered:_.mastered||0,duration:Date.now()-Ge.current},isReviewFocusMode:oe,hybridMode:!0});he(dt=>{if(dt.currentIndex!==xe)return dt;const rt=dt.questions.slice(0,K);return{...dt,questions:[...rt,...Xe.scheduledQuestions]}}),st(0),pt(!1),se(null),j.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:Xe.scheduledQuestions.length})}catch(Ne){j.error("[Translation] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",Ne),pt(!1),se(null)}})()},[c,Ye,it,Tt,te.questions,te.currentIndex,te.answered,Re,_,oe]),s9(),N.useEffect(()=>{const xe=dt=>{const rt=dt==="dark"||dt==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark-mode",rt)},pe=localStorage.getItem("darkMode")||"system";xe(pe);const Ne=window.matchMedia("(prefers-color-scheme: dark)"),Xe=()=>{const dt=localStorage.getItem("darkMode");(!dt||dt==="system")&&xe("system")};return Ne.addEventListener("change",Xe),()=>Ne.removeEventListener("change",Xe)},[]),N.useEffect(()=>{(async()=>{try{j.log("üîÑ „Éá„Éº„ÇøÁßªË°å„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...");try{await S$()}catch(Be){j.error("Migration error (continuing):",Be)}Qb();let K=!1;try{const Be=await bs();Be&&Be.wordProgress&&Be.statistics&&Be.questionSetStats?(Yr(Be),j.log("‚úÖ Progress data loaded successfully"),K=!0):j.warn("‚ö†Ô∏è Progress data incomplete, reinitializing")}catch(Be){j.error("Progress load error:",Be)}if(!K){j.log("üîß Initializing fresh progress data");const Be={results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},wordProgress:{},categoryStats:{},difficultyStats:{}};Yr(Be);try{localStorage.setItem("progress-data",JSON.stringify(Be))}catch(ae){j.warn("Failed to save initial progress:",ae)}}BZ();const Ne=await(await fetch("/data/vocabulary/high-school-entrance-words.csv")).text(),Xe=hc(Ne).map(Be=>({...Be,source:"junior"}));let dt=[];try{const ae=await(await fetch("/data/vocabulary/high-school-entrance-phrases.csv")).text();dt=hc(ae).map(Ce=>({...Ce,source:"junior"})),j.log(`üìö È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${dt.length}ÂÄã`)}catch(Be){j.warn("È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Be)}let rt=[];try{const ae=await(await fetch("/data/vocabulary/junior-high-intermediate-words.csv")).text();rt=hc(ae).map(Ce=>({...Ce,source:"intermediate"})),j.log(`üìö ‰∏≠Â≠¶Â±•‰øÆÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${rt.length}ÂÄã`)}catch(Be){j.warn("‰∏≠Â≠¶Â±•‰øÆÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Be)}let at=[];try{const ae=await(await fetch("/data/vocabulary/junior-high-intermediate-phrases.csv")).text();at=hc(ae).map(Ce=>({...Ce,source:"intermediate"})),j.log(`üìö ‰∏≠Â≠¶Â±•‰øÆÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${at.length}ÂÄã`)}catch(Be){j.warn("‰∏≠Â≠¶Â±•‰øÆÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Be)}const Bt=new Map;try{for(const Be of[1,2,3])try{const Ce=await(await fetch(`/data/sentence-ordering-grade${Be}.json`)).json();Ce.units&&Ce.units.forEach(U=>{const ue=`${Be}Âπ¥ ${U.unit}`;Bt.set(U.unit,`${U.unit}: ${U.title}`),Bt.set(ue,`${Be}Âπ¥ ${U.unit}: ${U.title}`)})}catch(ae){j.warn(`Grade ${Be} sentence ordering data not found:`,ae)}}catch(Be){j.warn("Unit title mapping failed:",Be)}const Vt=[...Xe,...dt,...rt,...at];if(Vt.length>0){f(Vt);try{const Se=Vt.map(ft=>({word:ft.word,difficulty:ft.difficulty||"beginner"}));localStorage.setItem("all-questions-cache",JSON.stringify(Se))}catch(Se){j.warn("Questions cache save failed:",Se)}const Ce=Array.from(new Set(Vt.map(Se=>Se.category||"").filter(Se=>Se))).map(Se=>Bt.has(Se)?Bt.get(Se):Se).sort((Se,ft)=>{const It=/(\d+)Âπ¥\s+Unit\s+(\d+)/i,rn=Se.match(It),nn=ft.match(It);if(rn&&nn){const Ut=parseInt(rn[1],10),xn=parseInt(nn[1],10);if(Ut!==xn)return Ut-xn;const es=parseInt(rn[2],10),mt=parseInt(nn[2],10);return es-mt}const St=/Unit\s+(\d+)/i,Ke=Se.match(St),Ct=ft.match(St);if(Ke&&Ct){const Ut=parseInt(Ke[1],10),xn=parseInt(Ct[1],10);return Ut-xn}return Se.localeCompare(ft,"ja")});b(Ce);const U={id:"all",name:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà",questions:Vt,createdAt:Date.now(),isBuiltIn:!0,source:"È´òÊ†°ÂèóÈ®ì2758Ë™û + È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ1791Ë™û"},ue={id:"junior",name:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö",questions:Vt.filter(Se=>Se.source==="junior"),createdAt:Date.now(),isBuiltIn:!0,source:"high-school-entrance (ÂçòË™û2662 + ÁÜüË™û96)"},Me={id:"intermediate",name:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ",questions:Vt.filter(Se=>Se.source==="intermediate"),createdAt:Date.now(),isBuiltIn:!0,source:"junior-high-intermediate (ÂçòË™û1579 + ÁÜüË™û212)"},{getCustomQuestionSets:qe}=await On(async()=>{const{getCustomQuestionSets:Se}=await Promise.resolve().then(()=>Sb);return{getCustomQuestionSets:Se}},void 0),_e=(await qe()).map(Se=>{const ft=new Date(Se.createdAt),It=`${ft.getMonth()+1}/${ft.getDate()}`,rn=Se.source==="reading"?"Èï∑Êñá":Se.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï";return{id:Se.id,name:`„Ç´„Çπ„Çø„É†ÂïèÈ°åÔºà${rn}_${It}Ôºâ`,questions:Se.questions,createdAt:Se.createdAt,isBuiltIn:!1,source:Se.source==="reading"?"Èï∑ÊñáË™≠Ëß£":Se.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}});L([U,ue,Me,..._e]),F(!0)}}catch(K){j.error("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",K),alert("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}})()},[]);const Yt=async()=>{try{const{getCustomQuestionSets:xe}=await On(async()=>{const{getCustomQuestionSets:Xe}=await Promise.resolve().then(()=>Sb);return{getCustomQuestionSets:Xe}},void 0),K=await xe(),pe=P.filter(Xe=>Xe.isBuiltIn),Ne=K.map(Xe=>({id:Xe.id,name:Xe.name,questions:Xe.questions,createdAt:Xe.createdAt,isBuiltIn:!1,source:Xe.source==="reading"?"Èï∑ÊñáË™≠Ëß£":Xe.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}));pe.length>0&&L([...pe,...Ne])}catch(xe){j.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆÂÜçË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",xe)}};N.useEffect(()=>{localStorage.setItem("quiz-adaptive-mode",JSON.stringify(G))},[G]),N.useEffect(()=>{localStorage.setItem("selectedDataSource-translation",JSON.stringify(E))},[E]),N.useEffect(()=>{localStorage.setItem("selectedDataSource-spelling",JSON.stringify(D))},[D]),N.useEffect(()=>{te.questions.length>0&&re()},[c,E,D,w,S,k,A]),N.useEffect(()=>{if(!O)return;const xe=K=>K==="all"||P.some(pe=>pe.id===K);xe(E)||$("all"),xe(D)||M("all")},[O,P,E,D,$,M]);const gn=xe=>{let K=h;if(K=K.filter(pe=>typeof(pe==null?void 0:pe.word)=="string"),xe!=="all"){const pe=P.find(Ne=>Ne.id===xe);pe?K=pe.questions.filter(Ne=>typeof(Ne==null?void 0:Ne.word)=="string"):K=K.filter(Ne=>Ne.source===xe)}if(w!=="all"&&(K=K.filter(pe=>pe.category===w)),S!=="all"){const pe={all:"",beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö"};K=K.filter(Ne=>Ne.difficulty===pe[S])}return k==="words-only"?K=K.filter(pe=>!pe.word.includes(" ")):k==="phrases-only"&&(K=K.filter(pe=>pe.word.includes(" ")),A!=="all"&&(K=K.filter(pe=>yk(pe.word)===A))),K=ex(K),K},jt=(xe,K)=>{const pe=c9(xe,K);m(Ne=>({...Ne,sets:[...Ne.sets,pe]})),j.log(`‚úÖ „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${xe}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü`)},hn=xe=>{m(K=>d9(K,xe)),j.log("üóëÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü")},un=(xe,K,pe)=>{m(Ne=>h9(Ne,xe,{name:K,description:pe})),j.log(`‚úèÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${K}„Äç„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`)},Et=(xe,K)=>{m(pe=>l9(pe,xe,K)),j.log(`‚ûï „Äå${K.word}„Äç„Çí„Çª„ÉÉ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`)},q=(xe,K)=>{m(pe=>u9(pe,xe,K)),j.log(`‚ûñ „Äå${K.word}„Äç„Çí„Çª„ÉÉ„Éà„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü`)},re=async()=>{var qe;const xe=rY();j.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥:",xe);const K=U0();let Ne=gn(c==="spelling"?D:E);if(Ne.length===0){alert("ÊåáÂÆö„Åï„Çå„ÅüÊù°‰ª∂„ÅÆÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}if(oe){const Oe=hd();if(Ne=Ne.filter(_e=>Oe.some(Se=>Se&&_e.word&&Se.toLowerCase()===_e.word.toLowerCase())),Ne.length===0){alert("Ë¶ÅÂæ©ÁøíÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"),ve(!1),Ae([]);return}Ae([...Ne]),j.log(`üéØ Ë£ú‰øÆ„É¢„Éº„ÉâÈñãÂßã: ${Ne.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å`)}const Xe=g9(h,y),dt=$k();dt?(S9(Xe),j.log(`üìä ÊîπÂñÑÈÄ≤Êçó: ${dt.currentDay}Êó•ÁõÆ - ÂÖ®‰ΩìÈÄ≤Êçó${dt.overallProgress.toFixed(1)}%`)):Xe.weakCategories.length>0&&(v9(Xe),j.log("üéØ „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÊîπÂñÑ„Éó„É©„É≥„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü")),Xe.aiRecommendations.length>0&&(j.log("üß† AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà „Åã„Çâ„ÅÆÊé®Â•®:"),Xe.aiRecommendations.forEach(Oe=>j.log(`  ${Oe}`))),Xe.weakCategories.length>0&&w==="all"&&(Ne=w9(Ne,Xe.weakCategories,Math.min(30,Ne.length)),j.log(`üí° Âº±ÁÇπÂàÜÈáé„ÇíÂÑ™ÂÖàÂá∫È°å: ${Xe.weakCategories.slice(0,3).map(Oe=>Oe.category).join(", ")}`));const rt=hd(),Bt=nx(10).map(Oe=>Oe.word);let Vt=[];if(rt.length>0){const Oe=Ne.filter(Se=>rt.some(ft=>ft&&Se.word&&ft.toLowerCase()===Se.word.toLowerCase()));Vt=K.maxReviewCount>0?Oe.slice(0,K.maxReviewCount):[];const _e=Ne.filter(Se=>!rt.some(ft=>ft&&Se.word&&ft.toLowerCase()===Se.word.toLowerCase()));Ne=[...Vt,..._e],Vt.length>0&&j.log(`üîÑ Ë¶ÅÂæ©ÁøíÂïèÈ°å: ${Vt.length}ÂïèÔºà‰∏äÈôê: ${K.maxReviewCount}ÂïèÔºâ`)}if(Bt.length>0){const Oe=Ne.filter(_e=>Bt.some(Se=>Se&&_e.word&&Se.toLowerCase()===_e.word.toLowerCase()));if(Oe.length>0){const _e=Ne.filter(Se=>!Bt.some(ft=>ft&&Se.word&&ft.toLowerCase()===Se.word.toLowerCase()));Ne=[...Oe,..._e],j.log(`üîó Ê∑∑ÂêåÂ±•Ê≠¥: ${Oe.length}Âïè„ÇíÂÑ™ÂÖàÂá∫È°å`)}}if(!oe&&Ne.length>0){const Oe=await bs(),_e=new Map;Ne.forEach(Ct=>{const Ut=Oe.wordProgress[Ct.word];if(Ut&&Ut.learningHistory&&Ut.learningHistory.length>0){const xn=Ut.learningHistory.map(mt=>({timestamp:mt.timestamp,wasCorrect:mt.wasCorrect,responseTime:mt.responseTime,userAnswer:mt.userAnswer,confidenceLevel:mt.responseTime<2e3?"instant":mt.responseTime<5e3?"hesitant":"guessed",sessionContext:{questionIndex:mt.sessionIndex||0,previousQuestions:[],sessionFatigue:0}})),es=C9(Ct.word,Ut,xn);_e.set(Ct.word,es)}});const Se=$9(Ne,Oe.wordProgress,_e),ft=A9(Se,Ne.length),It=Cb(Ht.current,Ge.current);Fe.current=It;const rn=D9(ft,It),nn=new Map(rn.map(Ct=>[Ct.word,Ct]));if(Ne=Ne.filter(Ct=>nn.has(Ct.word)).sort((Ct,Ut)=>{const xn=nn.get(Ct.word).priority;return nn.get(Ut.word).priority-xn}),j.log("üß† Â≠¶ÁøíÊõ≤Á∑öAI: ÊúÄÈÅ©„Å™Âá∫È°åÈ†ÜÂ∫è„ÇíÊ±∫ÂÆö"),j.log("  Âá∫È°åÊà¶Áï•:",rn.slice(0,5).map(Ct=>`${Ct.word}(${Ct.strategy}, ÊàêÂäüÁéá${Ct.estimatedSuccessRate.toFixed(0)}%)`).join(", ")),It.fatigueLevel>40){const Ct=_9(It);j.log(`‚ö° Ë™çÁü•Ë≤†Ëç∑: ${It.fatigueLevel.toFixed(0)}% - ${Ct}`)}const St=xQ(Ne,Oe.wordProgress,vt.current),Ke=new Map;if(St.sequence.forEach((Ct,Ut)=>{Ke.set(Ct,Ut)}),Ne=Ne.sort((Ct,Ut)=>{const xn=Ke.get(Ct.word)??999,es=Ke.get(Ut.word)??999;return xn-es}),j.log("üîó ÊñáËÑàÂ≠¶ÁøíAI: ÊÑèÂë≥ÁöÑ„ÇØ„É©„Çπ„Çø„É™„É≥„Ç∞ÂÆå‰∫Ü"),j.log(`  „ÇØ„É©„Çπ„Çø„ÉºÊï∞: ${St.clusters.length}`),St.transitions.length>0){const Ct=St.transitions[0];j.log(`  ‰æã: ${Ct.from} ‚Üí ${Ct.to} (${Ct.reason})`)}}if(c==="translation"&&Ne.length>0){await bs();const Oe=await Re.schedule({questions:Ne,mode:"translation",useCategorySlots:!0,limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:_.correct,incorrect:_.incorrect,still_learning:_.review||0,mastered:_.mastered||0,duration:0},isReviewFocusMode:oe,hybridMode:!0});Ne=Oe.scheduledQuestions,Oe.vibrationScore>50&&j.warn("[Translation Hybrid] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:Oe.vibrationScore,processingTime:Oe.processingTime}),j.log("üß† „É°„ÇøAIÁµ±ÂêàÂ±§: „Éè„Ç§„Éñ„É™„ÉÉ„ÉâË™øÊï¥ÂÆå‰∫Ü",{total:Ne.length,vibrationScore:Oe.vibrationScore,adjustmentRange:"¬±20%"})}oe?j.log(`üéØ Ë£ú‰øÆ„É¢„Éº„Éâ: ${Ne.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å‰∏≠`):j.log(`üìö Â≠¶ÁøíÊï∞: ${Ne.length}Âïè`),he({questions:Ne,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),st(0),pt(!1),se(null),Z({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),Ge.current=Date.now(),ze.current=Date.now(),Nt.current=[],Ht.current=[],Fe.current=null;const Be=await bs(),ae=P9(Be.wordProgress,tt.current);ge.current=ae;const Ce=Ne.map(Oe=>Oe.word),U=((qe=Fe.current)==null?void 0:qe.fatigueLevel)??0,ue=W9(Ce,Be.wordProgress,ae,U);Pe.current=ue,j.log("üîÆ „Ç®„É©„Éº‰∫àÊ∏¨AI: Ë™§Á≠î„É™„Çπ„ÇØÂàÜÊûêÂÆå‰∫Ü");const Me=Array.from(ue.values()).filter(Oe=>Oe.warningLevel==="high"||Oe.warningLevel==="critical").sort((Oe,_e)=>_e.errorRisk-Oe.errorRisk);Me.length>0&&(j.log(`  È´ò„É™„Çπ„ÇØÂïèÈ°å: ${Me.length}Âïè`),j.log(`  ÊúÄÈ´ò„É™„Çπ„ÇØ: ${Me[0].word} (${Me[0].errorRisk.toFixed(0)}% - ${Me[0].primaryPattern})`))},ne=()=>{oe?(ve(!1),Ae([]),we(new Map)):(ve(!0),we(new Map))},B=()=>{oe?(ve(!1),Ae([]),we(new Map)):(ve(!0),we(new Map))},z=xe=>{v(xe),ve(!1),Ae([]),te.questions.length>0&&re()},le=xe=>{C(xe),ve(!1),Ae([]),te.questions.length>0&&re()},ee=async(xe,K,pe)=>{var Be,ae,Ce,U;if(te.answered)return;const Ne=xe==="ÂàÜ„Åã„Çâ„Å™„ÅÑ",Xe=xe.trim(),dt=K.trim(),rt=!Ne&&Xe===dt,at=te.questions[te.currentIndex];!rt&&pe&&pe.word&&(await tx(pe.word,at.word),j.log(`üîó Ê∑∑Âêå„ÇíË®òÈå≤: ${pe.word} ‚Üê ${at.word}`));const Bt=Date.now()-ze.current;if(at){const Me=(Be=(await bs()).wordProgress)==null?void 0:Be[at.word],Oe=1-(Me?Me.correctCount/(Me.correctCount+Me.incorrectCount):.5);Ht.current.push({timestamp:Date.now(),wasCorrect:rt,responseTime:Bt,questionDifficulty:Oe});const _e=Cb(Ht.current,Ge.current);Fe.current=_e,(ae=_e.breakRecommendation)!=null&&ae.shouldBreak&&j.log(`üí§ ‰ºëÊÜ©Êé®Â•®: ${_e.breakRecommendation.reason}`),tt.current.push({word:at.word,wasCorrect:rt,userAnswer:Xe}),tt.current.length>50&&(tt.current=tt.current.slice(-50))}if(at){await Wo(at.word,rt,Bt,void 0,"translation");const Me=(Ce=(await bs()).wordProgress)==null?void 0:Ce[at.word];let qe=rt?"correct":"incorrect";Me&&Me.masteryLevel==="mastered"?qe="mastered":!rt&&Me&&Me.incorrectCount>=2&&(qe="review"),Z(Se=>({...Se,correct:Se.correct+(qe==="correct"?1:0),incorrect:Se.incorrect+(qe==="incorrect"?1:0),review:Se.review+(qe==="review"?1:0),mastered:Se.mastered+(qe==="mastered"?1:0)})),_a({status:qe,word:at.word,timestamp:Date.now()},"translation"),vt.current.push(at.word),vt.current.length>10&&(vt.current=vt.current.slice(-10)),sn.current++;const _e=(U=(await bs()).wordProgress)==null?void 0:U[at.word];if(_e&&_e.skippedCount&&_e.skippedCount>0&&(rt?kk(at.word):(Ik(at.word),j.log("ü§î AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Çπ„Ç≠„ÉÉ„Éó„Åó„ÅüÂçòË™û„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„ÅÆÂçòË™û„ÇíÂÜçÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ"))),Dc({id:Sd(),questionSetId:"main-set-single",questionSetName:"È´òÊ†°ÂèóÈ®ìËã±ÂçòË™û",score:rt?1:0,total:1,percentage:rt?100:0,date:Date.now(),timeSpent:Math.floor(Bt/1e3),incorrectWords:rt?[]:[at.word],mode:"translation",category:w!=="all"?w:void 0,difficulty:S!=="all"?S:void 0}),rt||Nt.current.push(at.word),oe){const Se=new Map(De);if(rt){const ft=Se.get(at.word)||0;if(Se.set(at.word,ft+1),ft+1>=2){const It=$e.filter(rn=>rn.word!==at.word);Ae(It),j.log(`‚úÖ ${at.word} „ÇíË£ú‰øÆÂØæË±°„Åã„ÇâÈô§Â§ñ (2ÂõûÈÄ£Á∂öÊ≠£Ëß£)`),It.length===0&&(alert("üéâ „Åô„Åπ„Å¶„ÅÆË¶ÅÂæ©ÁøíÂïèÈ°å„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„ÅüÔºÅ"),ve(!1),we(new Map))}}else Se.set(at.word,0);we(Se)}}if(at){const ue=String(at.word);oo.onShown(ue),oo.onAnswer(ue,rt),lt(at,_,Z)}let Vt=te.questions;!oe&&at&&!rt&&(Vt=et(at,te.questions,te.currentIndex,"translation",{outcome:"incorrect"})),oe||st(ue=>{const Me=ue+1;if(Me>=50)return pt(!0),se("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(Me%10===0){const qe=ht(Vt,"translation");qe.needsRescheduling&&(pt(!0),se(qe.reason))}return Me}),he(ue=>({...ue,questions:Vt,answered:!0,selectedAnswer:xe,score:rt?ue.score+1:ue.score,totalAnswered:ue.totalAnswered+1}))},be=()=>{he(xe=>{var Ne;const K=oe?$e:xe.questions,pe=xe.currentIndex+1;if(!oe&&pe<K.length){const Xe=je(K,pe-1);if(Xe!==K)return{...xe,questions:Xe,currentIndex:pe,answered:!1,selectedAnswer:null}}if(!oe&&pe>=K.length){if(!window.location.hostname.includes("github.io"))try{const Ce=oo.summarize();j.log("üß™ KPI Summary (translation):",Ce)}catch{}const Xe=Date.now(),dt=Ht.current.reduce((Ce,U)=>Ce+U.responseTime,0),rt=Ht.current.length>0?dt/Ht.current.length:0,at=((Ne=Fe.current)==null?void 0:Ne.fatigueLevel)??0,Bt=B9(Ge.current,Xe,xe.totalAnswered,xe.score,rt,at,_.correct+_.mastered,_.review);q9(Bt);const Vt=K9();if(Vt.length>=3){const Ce=H9("user",Vt),U=Tk(),ue=X9(Ce,U);j.log("üìä Â≠¶Áøí„Çπ„Çø„Ç§„É´AI:",ue)}const Be=(Xe-Ge.current)/(1e3*60),ae=sY(xe.score,xe.totalAnswered,rt,Be,_.correct+_.mastered,at);j.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥ÁµêÊûú:"),j.log(`  Áç≤ÂæóXP: ${ae.xpGained}`),ae.leveledUp&&j.log(`  üéâ „É¨„Éô„É´„Ç¢„ÉÉ„Éó! Lv.${ae.newLevel}`),ae.feedback.forEach(Ce=>{j.log(`  ${Ce.icon} ${Ce.message}`)})}return oe&&pe>=K.length?(j.log("üîÑ Ë£ú‰øÆ„É¢„Éº„Éâ: ÂïèÈ°å„ÇíÁπ∞„ÇäËøî„Åó„Åæ„Åô"),{...xe,questions:K,currentIndex:0,answered:!1,selectedAnswer:null}):{...xe,questions:K,currentIndex:pe%K.length,answered:!1,selectedAnswer:null}}),ze.current=Date.now()},He=()=>{he(xe=>({...xe,currentIndex:xe.currentIndex>0?xe.currentIndex-1:0,answered:!1,selectedAnswer:null}))},Qe=async()=>{const xe=te.questions[te.currentIndex];if(xe){const K=Date.now()-ze.current;await of(xe.word,30),Nk(xe.word),await Wo(xe.word,!0,K,void 0,"translation"),he(pe=>({...pe,score:pe.score+1,totalAnswered:pe.totalAnswered+1,currentIndex:(pe.currentIndex+1)%pe.questions.length,answered:!1,selectedAnswer:null})),Z(pe=>({...pe,correct:pe.correct+1,mastered:pe.mastered+1})),_a({status:"correct",word:xe.word,timestamp:Date.now()},"translation")}else he(K=>({...K,currentIndex:(K.currentIndex+1)%K.questions.length,answered:!1,selectedAnswer:null}));ze.current=Date.now(),!oe&&c==="translation"&&st(K=>{const pe=K+1;if(pe>=50)return pt(!0),se("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(pe%10===0){const Ne=ht(te.questions,"translation");Ne.needsRescheduling&&(pt(!0),se(Ne.reason))}return pe})},ke=xe=>{const K=te.questions[te.currentIndex];if(K){const pe=Date.now()-ze.current;Wo(K.word,te.selectedAnswer===K.meaning,pe,xe,"translation")}};return u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx(qk,{isVisible:l,message:"Ë™≠„ÅøËæº„Åø‰∏≠..."}),u.jsxs("div",{className:"flex gap-0 bg-gray-200 shadow-sm py-0.5 sm:py-1",children:[u.jsx("button",{className:`flex-1 min-w-0 truncate py-1.5 sm:py-2 px-1 sm:px-2 text-[10px] sm:text-sm font-semibold transition-all duration-200 ${n==="japanese"?"bg-white text-blue-600 border-b-2 border-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-50"}`,onClick:()=>e("japanese"),children:"ÂõΩË™û"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-1.5 sm:py-2 px-1 sm:px-2 text-[10px] sm:text-sm font-semibold transition-all duration-200 ${n==="math"?"bg-gray-400 text-gray-500 cursor-not-allowed":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!0,title:"Ê∫ñÂÇô‰∏≠",children:"Êï∞Â≠¶"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-1.5 sm:py-2 px-1 sm:px-2 text-[10px] sm:text-sm font-semibold transition-all duration-200 ${n==="english"?"bg-white text-blue-600 border-b-2 border-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-50"}`,onClick:()=>e("english"),children:"Ëã±Ë™û"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-1.5 sm:py-2 px-1 sm:px-2 text-[10px] sm:text-sm font-semibold transition-all duration-200 ${n==="science"?"bg-gray-400 text-gray-500 cursor-not-allowed":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!0,title:"Ê∫ñÂÇô‰∏≠",children:"ÁêÜÁßë"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-1.5 sm:py-2 px-1 sm:px-2 text-[10px] sm:text-sm font-semibold transition-all duration-200 ${n==="social"?"bg-white text-blue-600 border-b-2 border-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-50"}`,onClick:()=>e("social"),children:"Á§æ‰ºö"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-1.5 sm:py-2 px-1 sm:px-2 text-[10px] sm:text-sm font-semibold transition-all duration-200 ${n==="settings"?"bg-white text-blue-600 border-b-2 border-blue-600":"bg-gray-100 text-gray-700 hover:bg-gray-50"}`,onClick:()=>e("settings"),children:"Ë®≠ÂÆö"})]}),n==="english"&&u.jsxs("div",{className:"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2",children:[u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-1 sm:px-2 text-[11px] sm:text-base font-semibold transition-all duration-200 border-b-4 ${r==="memorization"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>o("memorization"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° ÊöóË®ò"}),u.jsx("span",{className:"sm:hidden",children:"ÊöóË®ò"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-1 sm:px-2 text-[11px] sm:text-base font-semibold transition-all duration-200 border-b-4 ${r==="multiple-choice"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>o("multiple-choice"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üìù ‰∏âÊäû"}),u.jsx("span",{className:"sm:hidden",children:"‰∏âÊäû"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-1 sm:px-2 text-[11px] sm:text-base font-semibold transition-all duration-200 border-b-4 ${r==="spelling"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>o("spelling"),children:[u.jsx("span",{className:"hidden sm:inline",children:"‚úèÔ∏è „Çπ„Éö„É´"}),u.jsx("span",{className:"sm:hidden",children:"„Çπ„Éö„É´"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-1 sm:px-2 text-[11px] sm:text-base font-semibold transition-all duration-200 border-b-4 ${r==="grammar"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>{o("grammar"),d(!0),setTimeout(()=>d(!1),1500),qb()},children:[u.jsx("span",{className:"hidden sm:inline",children:"üìö ÊñáÊ≥ï"}),u.jsx("span",{className:"sm:hidden",children:"ÊñáÊ≥ï"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-1 sm:px-2 text-[11px] sm:text-base font-semibold transition-all duration-200 border-b-4 ${r==="reading"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>{o("reading"),d(!0),setTimeout(()=>d(!1),1500),qb()},children:[u.jsx("span",{className:"hidden sm:inline",children:"üìñ Èï∑Êñá"}),u.jsx("span",{className:"sm:hidden",children:"Èï∑Êñá"})]})]}),n==="japanese"&&u.jsxs("div",{className:"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2",children:[u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-2 sm:px-4 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${t==="memorization"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>s("memorization"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° ÊöóË®ò"}),u.jsx("span",{className:"sm:hidden",children:"ÊöóË®ò"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-2 sm:px-4 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${t==="multiple-choice"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>s("multiple-choice"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üìù ‰∏âÊäû"}),u.jsx("span",{className:"sm:hidden",children:"‰∏âÊäû"})]})]}),n==="social"&&u.jsxs("div",{className:"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2",children:[u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-2 sm:px-4 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${i==="memorization"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>a("memorization"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° ÊöóË®ò"}),u.jsx("span",{className:"sm:hidden",children:"ÊöóË®ò"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-2 sm:py-3 px-2 sm:px-4 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${i==="multiple-choice"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100"}`,onClick:()=>a("multiple-choice"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üìù ‰∏âÊäû"}),u.jsx("span",{className:"sm:hidden",children:"‰∏âÊäû"})]})]}),u.jsx(dZ,{isOpen:g,onClose:()=>x(!1),sets:p.sets,onCreateSet:jt,onDeleteSet:hn,onEditSet:un,onRemoveWord:q}),u.jsx("div",{className:"p-2 md:p-6 bg-gray-50",children:u.jsxs("div",{className:"max-w-app mx-auto",children:[n==="english"&&r==="memorization"&&u.jsx(Uk,{allQuestions:h,questionSets:P,customQuestionSets:p.sets,onAddWordToCustomSet:Et,onRemoveWordFromCustomSet:q,onOpenCustomSetManagement:()=>x(!0)}),n==="english"&&r==="multiple-choice"&&u.jsx(CJ,{quizState:te,_categoryList:y,selectedCategory:w,onCategoryChange:z,selectedDifficulty:S,onDifficultyChange:le,selectedWordPhraseFilter:k,onWordPhraseFilterChange:I,selectedPhraseTypeFilter:A,onPhraseTypeFilterChange:T,selectedDataSource:E,onDataSourceChange:$,questionSets:P,onStartQuiz:re,onAnswer:ee,onNext:be,onPrevious:He,onSkip:Qe,onDifficultyRate:ke,onReviewFocus:ne,isReviewFocusMode:oe,errorPrediction:te.questions.length>0&&te.currentIndex<te.questions.length?Pe.current.get(te.questions[te.currentIndex].word):void 0,customQuestionSets:p.sets,onAddWordToCustomSet:Et,onRemoveWordFromCustomSet:q,onOpenCustomSetManagement:()=>x(!0)}),n==="english"&&r==="spelling"&&u.jsx(IJ,{questions:te.questions,questionSets:P,_categoryList:y,selectedCategory:w,onCategoryChange:z,selectedDifficulty:S,onDifficultyChange:le,selectedWordPhraseFilter:k,onWordPhraseFilterChange:I,selectedPhraseTypeFilter:A,onPhraseTypeFilterChange:T,selectedDataSource:D,onDataSourceChange:M,onStartQuiz:re,onReviewFocus:B,isReviewFocusMode:oe,customQuestionSets:p.sets,onAddWordToCustomSet:Et,onRemoveWordFromCustomSet:q,onOpenCustomSetManagement:()=>x(!0)}),n==="english"&&r==="grammar"&&u.jsx(Wk,{}),n==="english"&&r==="reading"&&u.jsx(GJ,{onAddWordToCustomSet:xe=>{var pe;const K=(pe=p.sets[0])==null?void 0:pe.id;K&&Et(K,xe)}}),n==="english"&&r==="reading_old"&&u.jsx("div",{}),n==="settings"&&u.jsx(jZ,{allQuestions:h,customQuestionSets:p.sets,questionSets:P,categoryList:y,onResetComplete:()=>e("settings"),onQuestionSetsUpdated:Yt,onOpenCustomSetManagement:()=>x(!0),onStartSession:(xe,K)=>{he({questions:K,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),Ge.current=Date.now(),ze.current=Date.now(),Nt.current=[],e("english"),o("multiple-choice")}}),n==="japanese"&&t==="memorization"&&u.jsx(Ub,{dataSource:"classical-words.csv"}),n==="japanese"&&t==="multiple-choice"&&u.jsx(Vb,{dataSource:"classical-words.csv"}),n==="social"&&i==="multiple-choice"&&u.jsx(Vb,{dataSource:"all-social-studies.csv"}),n==="social"&&i==="memorization"&&u.jsx(Ub,{dataSource:"all-social-studies.csv"})]})})]})}const UZ=()=>{const n=localStorage.getItem("darkMode");let e="system";n==="system"||n==="light"||n==="dark"?e=n:n==="true"?(e="dark",localStorage.setItem("darkMode","dark")):n==="false"&&(e="light",localStorage.setItem("darkMode","light"));let t=!1;e==="system"?t=window.matchMedia("(prefers-color-scheme: dark)").matches:t=e==="dark",document.documentElement.classList.toggle("dark",t)};UZ();Jf.createRoot(document.getElementById("root")).render(u.jsx(n$.StrictMode,{children:u.jsx(VZ,{})}));export{xc as A,nee as B,tee as C,eee as D,Po as G,zs as P,On as _,ma as a,D2 as b,nt as c,Af as d,Wx as e,zY as f,fd as g,sx as h,af as i,xd as j,pd as k,j as l,hk as m,jk as n,pk as o,bc as p,ZZ as q,Lk as r,CF as s,di as t,see as u,ree as v,O$ as w,kn as x,kr as y,oee as z};
//# sourceMappingURL=index-DZEYaTGs.js.map
