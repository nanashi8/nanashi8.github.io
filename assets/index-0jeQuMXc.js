const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/scoreBoardTests-CdBC1UKO.js","assets/chart-vendor-Eu4deRvW.js","assets/react-vendor-C14am9Lm.js"])))=>i.map(i=>d[i]);
var Mk=Object.defineProperty;var Fk=(n,e,t)=>e in n?Mk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ee=(n,e,t)=>Fk(n,typeof e!="symbol"?e+"":e,t);import{j as u}from"./chart-vendor-Eu4deRvW.js";import{a as Ok,g as Lk,c as vi,b as zk,r as T,R as Wk}from"./react-vendor-C14am9Lm.js";function Bk(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var Pf={},sx=Ok;Pf.createRoot=sx.createRoot,Pf.hydrateRoot=sx.hydrateRoot;const Vk="modulepreload",Uk=function(n){return"/"+n},rx={},Yn=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=Uk(c),c in rx)return;rx[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":Vk,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return r.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},Db=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function Gk(n){return Db.includes(n)}const zl=typeof window<"u"&&new URLSearchParams(window.location.search).get("debug")==="true",E={log:(...n)=>{zl&&console.log(...n)},warn:(...n)=>{zl&&console.warn(...n)},error:(...n)=>{console.error(...n)},debug:(...n)=>{zl&&console.debug(...n)},info:(...n)=>{zl&&console.info(...n)}};class Lt{static start(e){this.enabled&&performance.mark(`${e}-start`)}static end(e){if(!this.enabled)return 0;try{if(performance.getEntriesByName(`${e}-start`,"mark").length===0)return 0;performance.mark(`${e}-end`),performance.measure(e,`${e}-start`,`${e}-end`);const s=performance.getEntriesByName(e),r=s[s.length-1],o=(r==null?void 0:r.duration)||0;return this.measurements.has(e)||this.measurements.set(e,[]),this.measurements.get(e).push(o),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e),o}catch{return 0}}static getStats(e){const t=this.measurements.get(e);return!t||t.length===0?null:{count:t.length,avg:t.reduce((s,r)=>s+r,0)/t.length,min:Math.min(...t),max:Math.max(...t),p50:this.percentile(t,.5),p95:this.percentile(t,.95),p99:this.percentile(t,.99)}}static percentile(e,t){if(e.length===0)return 0;const s=[...e].sort((o,i)=>o-i),r=Math.ceil(s.length*t)-1;return s[Math.max(0,r)]}static report(){if(!this.enabled)return;const e=Array.from(this.measurements.keys()).map(t=>{const s=this.getStats(t);return s?{label:t,count:s.count,avg:`${s.avg.toFixed(2)}ms`,min:`${s.min.toFixed(2)}ms`,max:`${s.max.toFixed(2)}ms`,p50:`${s.p50.toFixed(2)}ms`,p95:`${s.p95.toFixed(2)}ms`,p99:`${s.p99.toFixed(2)}ms`}:null}).filter(Boolean);console.group("üìä Performance Report"),console.table(e),console.groupEnd()}static export(){const e=Array.from(this.measurements.keys()).reduce((t,s)=>{const r=this.getStats(s);return r&&(t[s]=r),t},{});return JSON.stringify({timestamp:new Date().toISOString(),measurements:e},null,2)}static clear(){this.measurements.clear(),performance.clearMarks(),performance.clearMeasures()}static clearLabel(e){this.measurements.delete(e),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e)}static warnIfSlow(e,t,s){this.enabled&&t>s&&console.warn(`‚ö†Ô∏è [PerformanceMonitor] ${e} took ${t.toFixed(2)}ms (threshold: ${s}ms)`)}static logWithStats(e,t){if(!this.enabled)return;const s=this.getStats(e);s&&s.count>=5?console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms (avg: ${s.avg.toFixed(2)}ms, p95: ${s.p95.toFixed(2)}ms)`):console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms`)}}Ee(Lt,"measurements",new Map),Ee(Lt,"enabled",!1);const Hk="QuizAppDB",qk=1,wn={PROGRESS:"progress",SESSION_HISTORY:"sessionHistory",DAILY_STATS:"dailyStats",SETTINGS:"settings"},Jo=class Jo{constructor(){Ee(this,"connections",[]);Ee(this,"pendingConnectionCreations",0);Ee(this,"config",{maxConnections:5,connectionTimeout:5e3,idleTimeout:6e4});Ee(this,"initializationPromise",null);Ee(this,"cleanupInterval",null);this.startCleanupTimer()}static getInstance(){return Jo.instance||(Jo.instance=new Jo),Jo.instance}async initialize(){return this.initializationPromise?this.initializationPromise:(this.initializationPromise=this.performInitialization(),this.initializationPromise)}async performInitialization(){Lt.start("db-pool-init");try{this.pendingConnectionCreations++;const e=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:e,lastUsed:Date.now(),inUse:!1});const t=Lt.end("db-pool-init");E.log(`üèä [DBConnectionPool] ÂàùÊúüÂåñÂÆå‰∫Ü (${t.toFixed(2)}ms)`)}catch(e){throw E.error("‚ùå [DBConnectionPool] ÂàùÊúüÂåñÂ§±Êïó:",e),e}}createNewConnection(){return new Promise((e,t)=>{Lt.start("db-connection-open");const s=indexedDB.open(Hk,qk),r=setTimeout(()=>{t(new Error("IndexedDB open timeout"))},this.config.connectionTimeout);s.onerror=()=>{clearTimeout(r),Lt.end("db-connection-open"),E.error("‚ùå IndexedDB open error:",s.error),t(s.error)},s.onsuccess=()=>{clearTimeout(r),Lt.end("db-connection-open"),e(s.result)},s.onupgradeneeded=o=>{const i=o.target.result;if(i.objectStoreNames.contains(wn.PROGRESS)||i.createObjectStore(wn.PROGRESS),!i.objectStoreNames.contains(wn.SESSION_HISTORY)){const a=i.createObjectStore(wn.SESSION_HISTORY,{keyPath:"id",autoIncrement:!0});a.createIndex("mode","mode",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("modeTimestamp",["mode","timestamp"],{unique:!1})}i.objectStoreNames.contains(wn.DAILY_STATS)||i.createObjectStore(wn.DAILY_STATS,{keyPath:"date"}).createIndex("date","date",{unique:!0}),i.objectStoreNames.contains(wn.SETTINGS)||i.createObjectStore(wn.SETTINGS),E.log("üì¶ [DBConnectionPool] Stores created")}})}async getConnection(){Lt.start("db-pool-get-connection"),await this.initialize();const e=this.connections.find(t=>!t.inUse);if(e)return e.inUse=!0,e.lastUsed=Date.now(),Lt.end("db-pool-get-connection"),e.db;if(this.connections.length+this.pendingConnectionCreations<this.config.maxConnections){this.pendingConnectionCreations++;const t=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:t,lastUsed:Date.now(),inUse:!0});const s=Lt.end("db-pool-get-connection");return E.log(`‚ûï [DBConnectionPool] Êñ∞Ë¶èÊé•Á∂ö‰ΩúÊàê (${this.connections.length}/${this.config.maxConnections}) (${s.toFixed(2)}ms)`),t}return E.warn("‚ö†Ô∏è [DBConnectionPool] Êé•Á∂ö„Éó„Éº„É´Ê∫ÄÊùØ„ÄÅÂæÖÊ©ü‰∏≠..."),new Promise(t=>{const s=setInterval(()=>{const r=this.connections.find(o=>!o.inUse);if(r){clearInterval(s),r.inUse=!0,r.lastUsed=Date.now();const o=Lt.end("db-pool-get-connection");E.log(`‚úÖ [DBConnectionPool] ÂæÖÊ©üÂæåÊé•Á∂öÂèñÂæó (${o.toFixed(2)}ms)`),t(r.db)}},10)})}releaseConnection(e){const t=this.connections.find(s=>s.db===e);t&&(t.inUse=!1,t.lastUsed=Date.now())}cleanupIdleConnections(){const t=Date.now()-this.config.idleTimeout,s=this.connections.filter(r=>!r.inUse&&r.lastUsed<t);s.length>0&&(s.forEach(r=>{r.db.close();const o=this.connections.indexOf(r);o!==-1&&this.connections.splice(o,1)}),E.log(`üßπ [DBConnectionPool] „Ç¢„Ç§„Éâ„É´Êé•Á∂öÂâäÈô§: ${s.length}ÂÄã`))}startCleanupTimer(){this.cleanupInterval=window.setInterval(()=>{this.cleanupIdleConnections()},3e4)}async closeAll(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.connections.forEach(e=>{try{e.db.close()}catch(t){E.error("‚ùå [DBConnectionPool] Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫„Ç®„É©„Éº:",t)}}),this.connections=[],this.initializationPromise=null,E.log("üîí [DBConnectionPool] ÂÖ®Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫ÂÆå‰∫Ü")}getStats(){return{totalConnections:this.connections.length,inUseConnections:this.connections.filter(e=>e.inUse).length,availableConnections:this.connections.filter(e=>!e.inUse).length,maxConnections:this.config.maxConnections,oldestConnectionAge:this.connections.length>0?Math.min(...this.connections.map(e=>Date.now()-e.lastUsed)):0}}};Ee(Jo,"instance",null);let jf=Jo;const rc=jf.getInstance();async function Kk(){return await rc.initialize(),rc.getConnection()}async function $p(n,e,t){Lt.start("db-transaction");const s=await rc.getConnection();try{const r=s.transaction(n,e),o=await t(r),i=Lt.end("db-transaction");return o}finally{rc.releaseConnection(s)}}async function Qk(){return rc.closeAll()}const Xk="QuizAppDB";function ad(){try{return"indexedDB"in window&&indexedDB!==null}catch{return!1}}function Jk(){return Lt.start("db-init-legacy"),Kk().then(n=>(Lt.end("db-init-legacy"),n)).catch(n=>{throw Lt.end("db-init-legacy"),E.error("‚ùå IndexedDB initialization failed:",n),n})}async function Tp(n,e){try{Lt.start("db-get");const t=await $p(n,"readonly",async r=>new Promise((o,i)=>{const c=r.objectStore(n).get(e);c.onsuccess=()=>o(c.result||null),c.onerror=()=>i(c.error)})),s=Lt.end("db-get");return t}catch(t){return Lt.end("db-get"),E.error("getFromDB error:",t),null}}async function pr(n,e,t){try{Lt.start("db-put");const s=await $p(n,"readwrite",async o=>new Promise((i,a)=>{const c=o.objectStore(n),l=t!==void 0?c.put(e,t):c.put(e);l.onsuccess=()=>i(!0),l.onerror=()=>a(l.error)})),r=Lt.end("db-put");return s}catch(s){return Lt.end("db-put"),E.error("putToDB error:",s),!1}}async function ox(n){try{Lt.start("db-get-all");const e=await $p(n,"readonly",async s=>new Promise((r,o)=>{const a=s.objectStore(n).getAll();a.onsuccess=()=>r(a.result||[]),a.onerror=()=>o(a.error)})),t=Lt.end("db-get-all");return e}catch(e){return Lt.end("db-get-all"),E.error("getAllFromDB error:",e),[]}}async function Yk(){try{await Qk(),E.log("üîí Connection pool closed before DB deletion")}catch(n){E.error("‚ö†Ô∏è Pool close error:",n)}return new Promise(n=>{const e=indexedDB.deleteDatabase(Xk);e.onsuccess=()=>{E.log("üóëÔ∏è Database deleted"),n(!0)},e.onerror=()=>{E.error("Database delete error"),n(!1)}})}const _b="indexeddb-migration-completed",Ap="1.1";function cd(){try{return localStorage.getItem(_b)===Ap}catch{return!1}}function tf(){try{localStorage.setItem(_b,Ap),E.log("‚úÖ Migration flag set")}catch(n){E.error("Failed to set migration flag:",n)}}function ld(n){try{const e=localStorage.getItem(n);return!e||n.includes("lastLogin")||n.includes("Date")||n.includes("daily-plan")||n.includes("score-board")?null:JSON.parse(e)}catch{return E.warn(`${n} is not valid JSON (skipping)`),null}}function Zk(n){try{return localStorage.getItem(n)}catch(e){return E.error(`Failed to get ${n} from localStorage:`,e),null}}async function e$(){try{const n=ld("progress-data");if(n)return n.wordProgress||(n.wordProgress={}),n.results||(n.results=[]),n.statistics||(n.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),n.questionSetStats||(n.questionSetStats={}),await pr(wn.PROGRESS,n,"main"),E.log("üì¶ Progress data migrated:",Object.keys(n.wordProgress||{}).length,"words"),!0;E.log("‚ÑπÔ∏è No progress data to migrate, creating initial data");const e={wordProgress:{},results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{}};return await pr(wn.PROGRESS,e,"main"),!0}catch(n){return E.error("Progress data migration error:",n),!1}}async function t$(){try{const n=["translation","spelling"];let e=0;for(const t of n){const s=`session-history-${t}`,r=ld(s);if(r&&Array.isArray(r))for(const o of r)await pr(wn.SESSION_HISTORY,{mode:t,status:o.status,word:o.word,timestamp:o.timestamp}),e++}return e>0&&E.log("üìú Session history migrated:",e,"items"),!0}catch(n){return E.error("Session history migration error:",n),!1}}async function n$(){try{const n=new Date,e=new Date(n.getTime()-90*24*60*60*1e3);let t=0,s=0;for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.startsWith("studyStats-")){const i=o.replace("studyStats-","");if(new Date(i)>=e){const c=ld(o);c&&(await pr(wn.DAILY_STATS,{date:i,...c}),t++)}else localStorage.removeItem(o),s++}}return(t>0||s>0)&&E.log(`üìä Daily stats: migrated ${t}, cleaned ${s}`),!0}catch(n){return E.error("Daily stats migration error:",n),!1}}async function s$(){try{const n=["user-goal-level","loginStreak","radar-improvement-progress","skip-exclude-groups"],e=["lastLoginDate","lastLoginData"];let t=0;for(const r of n)try{if(r.includes("lastLogin")){E.warn(`Skipping ${r} from JSON migration`);continue}const o=ld(r);o!==null&&(await pr(wn.SETTINGS,o,r),t++)}catch(o){E.warn(`Failed to migrate ${r}:`,o)}for(const r of e)try{const o=Zk(r);o!==null&&(await pr(wn.SETTINGS,o,r),t++)}catch(o){E.warn(`Failed to migrate ${r}:`,o)}const s=["translation","spelling","reading"];for(const r of s){const o=`daily-plan-target-${r}`,i=`score-board-goal-${r}`;try{const a=localStorage.getItem(o);a&&(await pr(wn.SETTINGS,a,o),t++)}catch(a){E.warn(`Failed to migrate ${o}:`,a)}try{const a=localStorage.getItem(i);a&&(await pr(wn.SETTINGS,a,i),t++)}catch(a){E.warn(`Failed to migrate ${i}:`,a)}}return t>0&&E.log("‚öôÔ∏è Settings migrated:",t,"items"),!0}catch(n){return E.error("Settings migration error:",n),!1}}async function r$(){try{const n=await Tp(wn.PROGRESS,"main");return n?!n.wordProgress||typeof n.wordProgress!="object"?(E.warn("‚ö†Ô∏è Progress data verification failed - invalid wordProgress"),!1):(E.log("‚úÖ Migration verification passed"),!0):(E.warn("‚ö†Ô∏è Progress data verification failed - no data found"),!1)}catch(n){return E.error("Migration verification error:",n),!1}}async function o$(){if(cd())return E.log("‚ÑπÔ∏è Migration already completed"),!0;if(!ad())return E.warn("‚ö†Ô∏è IndexedDB not supported, using localStorage"),!1;E.log("üöÄ Starting data migration to IndexedDB...");try{await Jk();const n=await Promise.all([e$(),t$(),n$(),s$()]),e=["Progress","SessionHistory","DailyStats","Settings"];return n.forEach((s,r)=>{s||E.warn(`‚ö†Ô∏è ${e[r]} migration incomplete (may be empty)`)}),n[0]||n.some(s=>s)?await r$()?(tf(),E.log("üéâ Migration completed successfully!"),!0):(E.warn("‚ö†Ô∏è Migration verification failed, but marking as complete"),tf(),!0):(E.warn("‚ö†Ô∏è All migrations returned false, marking as complete anyway"),tf(),!0)}catch(n){return E.error("‚ùå Migration failed:",n),!1}}function i$(){return{completed:cd(),indexedDBSupported:ad(),version:Ap}}let oa=!1;function Pb(){oa=ad()&&cd(),E.log(`üì¶ Storage strategy: ${oa?"IndexedDB":"localStorage"}`)}async function jb(n){try{return oa?await pr(wn.PROGRESS,n,"main"):(localStorage.setItem("progress-data",JSON.stringify(n)),!0)}catch(e){E.error("saveProgressData error:",e);try{return localStorage.setItem("progress-data",JSON.stringify(n)),!0}catch(t){return E.error("localStorage fallback failed:",t),!1}}}async function Mb(){try{if(oa){const n=await Tp(wn.PROGRESS,"main");if(n)return n;const e=localStorage.getItem("progress-data");return e?JSON.parse(e):null}else{const n=localStorage.getItem("progress-data");return n?JSON.parse(n):null}}catch(n){return E.error("loadProgressData error:",n),null}}async function wa(n,e){try{return oa?await pr(wn.SETTINGS,e,n):(localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0)}catch(t){E.error(`saveSetting(${n}) error:`,t);try{return localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0}catch{return!1}}}async function bc(n){try{if(oa){const e=await Tp(wn.SETTINGS,n);return e!==null?e:localStorage.getItem(n)||null}else return localStorage.getItem(n)||null}catch(e){return E.error(`loadSetting(${n}) error:`,e),null}}const a$=Object.freeze(Object.defineProperty({__proto__:null,initStorageStrategy:Pb,loadProgressData:Mb,loadSetting:bc,saveProgressData:jb,saveSetting:wa},Symbol.toStringTag,{value:"Module"}));class c${filter(e,t){if(e.length===0)return e;const s=Date.now();let r=0;const o=e.map(i=>{if(i.position>=40)return i;const a=this.findRecentAnswer(i.question.word,t.recentAnswers);if(!a)return i;const c=s-a.timestamp;let l=!1,d=i.position;return c<3e4?(d-=100,l=!0,E.debug(`[AntiVibration] Âç≥Â∫ßÂÜçÂá∫È°åÈò≤Ê≠¢: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-100})):c<t.minInterval&&a.correct?(d-=5,l=!0,E.debug(`[AntiVibration] Áü≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-5})):c<t.minInterval*5&&a.correct&&(d-=2,l=!0,E.debug(`[AntiVibration] ‰∏≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-2})),a.consecutiveCorrect>=t.consecutiveThreshold&&(d-=2,l=!0,E.debug(`[AntiVibration] ÈÄ£Á∂öÊ≠£Ëß£È†ªÂ∫¶‰ΩéÊ∏õ: ${i.question.word}`,{consecutiveCorrect:a.consecutiveCorrect,penalty:-2})),l?(r++,{...i,position:d,antiVibrationApplied:!0}):i});return r>0&&E.info(`[AntiVibration] „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®: ${r}Âïè„Å´ÊåØÂãïÈò≤Ê≠¢„Éö„Éä„É´„ÉÜ„Ç£`),o}findRecentAnswer(e,t){return t.find(s=>s.word===e)||null}calculateVibrationScore(e,t,s=20){if(e.length===0)return 0;const r=Date.now();let o=0;const i=e.slice(0,Math.min(s,e.length));i.forEach(c=>{const l=this.findRecentAnswer(c.question.word,t);if(!l)return;const d=r-l.timestamp;d<6e4?o+=10:d<3e5?o+=5:d<6e5&&(o+=2),l.consecutiveCorrect>=3&&(o+=5)});const a=Math.min(o,100);return a>50&&E.warn(`[AntiVibration] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫: ${a}`,{topQuestions:i.slice(0,5).map(c=>c.question.word)}),a}extractSessionPriorityQuestions(e){return e.filter(t=>t.question.sessionPriority!==void 0)}extractNormalQuestions(e){return e.filter(t=>t.question.sessionPriority===void 0)}}function l$(n,e){const t=e!=null&&e.mode?String(e.mode):"";return t?[`${n}_${t}`,n]:[n]}function lu(n,e){if(typeof localStorage>"u")return{raw:null,key:null};const t=l$(n,e);for(const s of t)try{const r=localStorage.getItem(s);if(r!=null)return{raw:r,key:s}}catch{}return{raw:null,key:null}}function Fb(n,e){const{raw:t,key:s}=lu(n,e);if(!t)return{value:null,key:null};try{return{value:JSON.parse(t),key:s}}catch{return{value:null,key:null}}}function Fi(n,e,t,s){if(typeof localStorage>"u")return;const r=t!=null&&t.mode?String(t.mode):"",o=(s==null?void 0:s.writeLegacy)!==!1;try{const i=JSON.stringify(e);r&&localStorage.setItem(`${n}_${r}`,i),o&&localStorage.setItem(n,i)}catch{}}const nf={weights:{memory:1,cognitiveLoad:.8,errorPrediction:.7,learningStyle:.5,linguistic:.4,contextual:.6,gamification:.3},emergencyThresholds:{forgettingRisk:150,cognitiveOverload:!0,consecutiveErrors:5},debugMode:!1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u$=1e-7,d$=1e-4;class Ob{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Ep{refCount(e){return Ns("refCount")}incRef(e){return Ns("incRef")}timerAvailable(){return!0}time(e){return Ns("time")}read(e){return Ns("read")}readSync(e){return Ns("readSync")}readToGPU(e,t){return Ns("readToGPU")}numDataIds(){return Ns("numDataIds")}disposeData(e,t){return Ns("disposeData")}write(e,t,s){return Ns("write")}move(e,t,s,r,o){return Ns("move")}createTensorFromGPUData(e,t,s){return Ns("createTensorFromGPUData")}memory(){return Ns("memory")}floatPrecision(){return Ns("floatPrecision")}epsilon(){return this.floatPrecision()===32?u$:d$}dispose(){return Ns("dispose")}}function Ns(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h$(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Ui(n,e,t)}function ii(n,e,t){return Math.max(n,Math.min(e,t))}function Rp(n){return n%2===0?n:n+1}function Ui(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function f$(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function R(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Dp(n,e,t=""){R(nn(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function Lb(n){R(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Ce(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function nn(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ia(n){return n%1===0}function Mf(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Xi(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function ix(n,e=r=>0,t,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const c=e(i);if(t!=null&&i>=t){o();return}s!=null?s(a,c):setTimeout(a,c)};a()})}function zb(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Wt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),R(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),R(n.every(s=>ia(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Do(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Wt(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function es(n,e){return In(n,e)}function In(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function p$(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function m$(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Wb(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function mu(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function g$(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function wc(n){return typeof n=="string"||n instanceof String}function x$(n){return typeof n=="boolean"}function Ff(n){return typeof n=="number"}function va(n){return Array.isArray(n)?va(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Ff(n)?"float32":wc(n)?"string":x$(n)?"bool":"float32"}function Of(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Lf(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function pt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function Bb(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((c,l)=>c*l)*(s?2:1);for(let c=0;c<o;c++)r[c]=Bb(n+c*a,i,t,s)}return r}function gr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return Bb(0,n,e,t)}function y$(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function _p(n,e){const t=ts(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function ts(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function Vb(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return gr(n,new Float32Array(t));if(e==="int32")return gr(n,new Int32Array(t));if(e==="bool")return gr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function io(n){n.forEach(e=>{R(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Mr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Sa(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function Pp(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ax="tfjsflags";class b${constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=w$,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Pp(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);ax in e&&e[ax].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=S$(r,o)})}}function w$(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(v$(e,s[0],s[1]),s.join("="))),e}function v$(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function S$(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function pe(){return Ub}let Ub=null;function C$(n){Ub=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let sf;function Gb(){if(sf==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");sf=n}return sf}function N$(){const n=Gb();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function jp(n,e){const t=N$();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const ud="Abs",vc="Acos",Sc="Acosh",Ca="Add",Mp="AddN",Fp="All",Op="Any",dd="ArgMax",hd="ArgMin",Cc="Asin",Nc="Asinh",Ic="Atan",kc="Atanh",$c="Atan2",fd="AvgPool",Lp="AvgPoolGrad",pd="AvgPool3D",zp="AvgPool3DGrad",md="BatchMatMul",gd="BatchToSpaceND",Wp="Bincount",Bp="BitwiseAnd",I$="BroadcastTo",Hb="BroadcastArgs",Tc="Cast",Ac="Ceil",Ec="ClipByValue",Vp="Complex",xd="ComplexAbs",yd="Concat",bd="Conv2D",Up="Conv2DBackpropFilter",wd="Conv2DBackpropInput",vd="Conv3D",Gp="Conv3DBackpropFilterV2",Hp="Conv3DBackpropInputV2",Rc="Cos",Dc="Cosh",qp="Cumprod",Sd="Cumsum",Kp="CropAndResize",Qp="DenseBincount",Xp="DepthToSpace",Cd="DepthwiseConv2dNative",Jp="DepthwiseConv2dNativeBackpropFilter",Yp="DepthwiseConv2dNativeBackpropInput",qb="Diag",Nd="Dilation2D",zf="Dilation2DBackpropInput",Wf="Dilation2DBackpropFilter",k$="Draw",_c="RealDiv",Zp="Einsum",Pc="Elu",em="EluGrad",jc="Erf",Id="Equal",Mc="Exp",kd="ExpandDims",Fc="Expm1",tm="FFT",nm="Fill",sm="FlipLeftRight",Oc="Floor",Lc="FloorDiv",$d="FusedBatchNorm",Td="GatherV2",Kb="GatherNd",Ad="Greater",zc="GreaterEqual",Wc="Identity",rm="IFFT",om="Imag",Bc="IsFinite",Vc="IsInf",Uc="IsNan",Ed="LeakyRelu",Rd="Less",Dd="LessEqual",Qb="LinSpace",Gc="Log",Hc="Log1p",_d="LogicalAnd",Pd="LogicalNot",jd="LogicalOr",$$="LogSoftmax",Md="LRN",im="LRNGrad",Fd="Max",qc="Maximum",Od="MaxPool",am="MaxPoolGrad",Ld="MaxPool3D",cm="MaxPool3DGrad",Xb="MaxPoolWithArgmax",zd="Mean",Wd="Min",Kc="Minimum",Bd="MirrorPad",Qc="Mod",Jb="Multinomial",Xc="Multiply",Vd="Neg",Ud="NotEqual",lm="NonMaxSuppressionV3",um="NonMaxSuppressionV4",dm="NonMaxSuppressionV5",Gd="OnesLike",Hd="OneHot",qd="Pack",Kd="PadV2",Jc="Pow",Qd="Prelu",Xd="Prod",Yb="RaggedGather",Zb="RaggedRange",ew="RaggedTensorToTensor",hm="Range",fm="Real",Yc="Reciprocal",Zc="Relu",Jd="Reshape",Yd="ResizeNearestNeighbor",pm="ResizeNearestNeighborGrad",Zd="ResizeBilinear",mm="ResizeBilinearGrad",el="Relu6",eh="Reverse",tl="Round",nl="Rsqrt",tw="ScatterNd",nw="TensorScatterUpdate",sw="SearchSorted",th="Select",sl="Selu",nh="Slice",rl="Sin",ol="Sinh",il="Sign",al="Sigmoid",cl="Softplus",ll="Sqrt",sh="Sum",rh="SpaceToBatchND",oh="SplitV",ih="Softmax",rw="SparseFillEmptyRows",ow="SparseReshape",iw="SparseSegmentMean",aw="SparseSegmentSum",cw="SparseToDense",ul="SquaredDifference",gm="Square",xm="StaticRegexReplace",ym="StridedSlice",lw="StringNGrams",uw="StringSplit",dw="StringToHashBucketFast",dl="Sub",hl="Tan",fl="Tanh",pl="Tile",bm="TopK",wm="Transform",Ji="Transpose",vm="Unique",ah="Unpack",ch="UnsortedSegmentSum",lh="ZerosLike",ml="Step",T$="FromPixels",Sm="RotateWithOffset",gu="_FusedMatMul",xu="FusedConv2D",hw="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.warn(...n)}function A$(...n){pe().getBool("IS_TEST")||pe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yu=jp("kernelRegistry",()=>new Map),Bf=jp("gradRegistry",()=>new Map);function cx(n,e){const t=pw(n,e);return yu.get(t)}function lx(n){return Bf.get(n)}function ux(n){const e=yu.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&t.push(i)}return t}function fw(n){const{kernelName:e,backendName:t}=n,s=pw(e,t);yu.has(s)&&Fs(`The kernel '${e}' for backend '${t}' is already registered`),yu.set(s,n)}function E$(n){const{kernelName:e}=n;Bf.has(e)&&pe().getBool("DEBUG")&&Fs(`Overriding the gradient for '${e}'`),Bf.set(e,n)}function pw(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mw(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var gw=mn,Xs=null;try{Xs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function mn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}mn.prototype.__isLong__;Object.defineProperty(mn.prototype,"__isLong__",{value:!0});function js(n){return(n&&n.__isLong__)===!0}mn.isLong=js;var dx={},hx={};function Si(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=hx[n],s)?s:(t=gn(n,(n|0)<0?-1:0,!0),r&&(hx[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=dx[n],s)?s:(t=gn(n,n<0?-1:0,!1),r&&(dx[n]=t),t))}mn.fromInt=Si;function Js(n,e){if(isNaN(n))return e?Yo:Ys;if(e){if(n<0)return Yo;if(n>=xw)return ww}else{if(n<=-px)return Es;if(n+1>=px)return bw}return n<0?Js(-n,e).neg():gn(n%aa|0,n/aa|0,e)}mn.fromNumber=Js;function gn(n,e,t){return new mn(n,e,t)}mn.fromBits=gn;var bu=Math.pow;function Cm(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ys;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Cm(n.substring(1),e,t).neg();for(var r=Js(bu(t,8)),o=Ys,i=0;i<n.length;i+=8){var a=Math.min(8,n.length-i),c=parseInt(n.substring(i,i+a),t);if(a<8){var l=Js(bu(t,a));o=o.mul(l).add(Js(c))}else o=o.mul(r),o=o.add(Js(c))}return o.unsigned=e,o}mn.fromString=Cm;function Sr(n,e){return typeof n=="number"?Js(n,e):typeof n=="string"?Cm(n,e):gn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}mn.fromValue=Sr;var fx=65536,R$=1<<24,aa=fx*fx,xw=aa*aa,px=xw/2,mx=Si(R$),Ys=Si(0);mn.ZERO=Ys;var Yo=Si(0,!0);mn.UZERO=Yo;var Qi=Si(1);mn.ONE=Qi;var yw=Si(1,!0);mn.UONE=yw;var Vf=Si(-1);mn.NEG_ONE=Vf;var bw=gn(-1,2147483647,!1);mn.MAX_VALUE=bw;var ww=gn(-1,-1,!0);mn.MAX_UNSIGNED_VALUE=ww;var Es=gn(0,-2147483648,!1);mn.MIN_VALUE=Es;var Qe=mn.prototype;Qe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Qe.toNumber=function(){return this.unsigned?(this.high>>>0)*aa+(this.low>>>0):this.high*aa+(this.low>>>0)};Qe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Es)){var t=Js(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Js(bu(e,6),this.unsigned),i=this,a="";;){var c=i.div(o),l=i.sub(c.mul(o)).toInt()>>>0,d=l.toString(e);if(i=c,i.isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}};Qe.getHighBits=function(){return this.high};Qe.getHighBitsUnsigned=function(){return this.high>>>0};Qe.getLowBits=function(){return this.low};Qe.getLowBitsUnsigned=function(){return this.low>>>0};Qe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Es)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Qe.isZero=function(){return this.high===0&&this.low===0};Qe.eqz=Qe.isZero;Qe.isNegative=function(){return!this.unsigned&&this.high<0};Qe.isPositive=function(){return this.unsigned||this.high>=0};Qe.isOdd=function(){return(this.low&1)===1};Qe.isEven=function(){return(this.low&1)===0};Qe.equals=function(e){return js(e)||(e=Sr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Qe.eq=Qe.equals;Qe.notEquals=function(e){return!this.eq(e)};Qe.neq=Qe.notEquals;Qe.ne=Qe.notEquals;Qe.lessThan=function(e){return this.comp(e)<0};Qe.lt=Qe.lessThan;Qe.lessThanOrEqual=function(e){return this.comp(e)<=0};Qe.lte=Qe.lessThanOrEqual;Qe.le=Qe.lessThanOrEqual;Qe.greaterThan=function(e){return this.comp(e)>0};Qe.gt=Qe.greaterThan;Qe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Qe.gte=Qe.greaterThanOrEqual;Qe.ge=Qe.greaterThanOrEqual;Qe.compare=function(e){if(js(e)||(e=Sr(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Qe.comp=Qe.compare;Qe.negate=function(){return!this.unsigned&&this.eq(Es)?Es:this.not().add(Qi)};Qe.neg=Qe.negate;Qe.add=function(e){js(e)||(e=Sr(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,d=0,h=0,f=0,p=0;return p+=o+l,f+=p>>>16,p&=65535,f+=r+c,h+=f>>>16,f&=65535,h+=s+a,d+=h>>>16,h&=65535,d+=t+i,d&=65535,gn(f<<16|p,d<<16|h,this.unsigned)};Qe.subtract=function(e){return js(e)||(e=Sr(e)),this.add(e.neg())};Qe.sub=Qe.subtract;Qe.multiply=function(e){if(this.isZero())return Ys;if(js(e)||(e=Sr(e)),Xs){var t=Xs.mul(this.low,this.high,e.low,e.high);return gn(t,Xs.get_high(),this.unsigned)}if(e.isZero())return Ys;if(this.eq(Es))return e.isOdd()?Es:Ys;if(e.eq(Es))return this.isOdd()?Es:Ys;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(mx)&&e.lt(mx))return Js(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,d=e.low&65535,h=0,f=0,p=0,m=0;return m+=i*d,p+=m>>>16,m&=65535,p+=o*d,f+=p>>>16,p&=65535,p+=i*l,f+=p>>>16,p&=65535,f+=r*d,h+=f>>>16,f&=65535,f+=o*l,h+=f>>>16,f&=65535,f+=i*c,h+=f>>>16,f&=65535,h+=s*d+r*l+o*c+i*a,h&=65535,gn(p<<16|m,h<<16|f,this.unsigned)};Qe.mul=Qe.multiply;Qe.divide=function(e){if(js(e)||(e=Sr(e)),e.isZero())throw Error("division by zero");if(Xs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Xs.div_u:Xs.div_s)(this.low,this.high,e.low,e.high);return gn(t,Xs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Yo:Ys;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Yo;if(e.gt(this.shru(1)))return yw;o=Yo}else{if(this.eq(Es)){if(e.eq(Qi)||e.eq(Vf))return Es;if(e.eq(Es))return Qi;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(Ys)?e.isNegative()?Qi:Vf:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(Es))return this.unsigned?Yo:Ys;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Ys}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:bu(2,a-48),l=Js(s),d=l.mul(e);d.isNegative()||d.gt(r);)s-=c,l=Js(s,this.unsigned),d=l.mul(e);l.isZero()&&(l=Qi),o=o.add(l),r=r.sub(d)}return o};Qe.div=Qe.divide;Qe.modulo=function(e){if(js(e)||(e=Sr(e)),Xs){var t=(this.unsigned?Xs.rem_u:Xs.rem_s)(this.low,this.high,e.low,e.high);return gn(t,Xs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Qe.mod=Qe.modulo;Qe.rem=Qe.modulo;Qe.not=function(){return gn(~this.low,~this.high,this.unsigned)};Qe.and=function(e){return js(e)||(e=Sr(e)),gn(this.low&e.low,this.high&e.high,this.unsigned)};Qe.or=function(e){return js(e)||(e=Sr(e)),gn(this.low|e.low,this.high|e.high,this.unsigned)};Qe.xor=function(e){return js(e)||(e=Sr(e)),gn(this.low^e.low,this.high^e.high,this.unsigned)};Qe.shiftLeft=function(e){return js(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):gn(0,this.low<<e-32,this.unsigned)};Qe.shl=Qe.shiftLeft;Qe.shiftRight=function(e){return js(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):gn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Qe.shr=Qe.shiftRight;Qe.shiftRightUnsigned=function(e){if(js(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var s=this.low;return gn(s>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?gn(t,0,this.unsigned):gn(t>>>e-32,0,this.unsigned)};Qe.shru=Qe.shiftRightUnsigned;Qe.shr_u=Qe.shiftRightUnsigned;Qe.toSigned=function(){return this.unsigned?gn(this.low,this.high,!1):this};Qe.toUnsigned=function(){return this.unsigned?this:gn(this.low,this.high,!0)};Qe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Qe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Qe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};mn.fromBytes=function(e,t,s){return s?mn.fromBytesLE(e,t):mn.fromBytesBE(e,t)};mn.fromBytesLE=function(e,t){return new mn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};mn.fromBytesBE=function(e,t){return new mn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const vw=Lk(gw),D$=Bk({__proto__:null,default:vw},[gw]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ko=vw||D$;function uh(n){return Ko.fromString(n,!0,16)}const Sw=uh("c3a5c85c97cb3127"),Ho=uh("b492b66fbe98f273"),ls=uh("9ae16a3b2f90404f");function Uf(n){return n.xor(n.shru(47))}function Cw(n,e,t){const s=n.slice(e,e+t);return Ko.fromBytes(Array.from(s),!0,!0)}function dn(n,e){return Cw(n,e,8)}function gx(n,e){return Cw(n,e,4)}function Bn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function bo(n,e,t=uh("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function _$(n,e,t,s,r,o){r=r.add(n),o=Bn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(Bn(r,44)),[r.add(s),o.add(i)]}function Wl(n,e,t,s){return _$(dn(n,e),dn(n,e+8),dn(n,e+16),dn(n,e+24),t,s)}function P$(n,e=n.length){if(e>=8){const t=ls.add(e*2),s=dn(n,0).add(ls),r=dn(n,e-8),o=Bn(r,37).mul(t).add(s),i=Bn(s,25).add(r).mul(t);return bo(o,i,t)}if(e>=4){const t=ls.add(e*2),s=gx(n,0);return bo(s.shl(3).add(e),gx(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return Uf(ls.mul(o).xor(Sw.mul(i))).mul(ls)}return ls}function j$(n,e=n.length){const t=ls.add(e*2),s=dn(n,0).mul(Ho),r=dn(n,8),o=dn(n,e-8).mul(t),i=dn(n,e-16).mul(ls);return bo(Bn(s.add(r),43).add(Bn(o,30)).add(i),s.add(Bn(r.add(ls),18)).add(o),t)}function M$(n,e=n.length){const t=ls.add(e*2),s=dn(n,0).mul(ls),r=dn(n,8),o=dn(n,e-8).mul(t),i=dn(n,e-16).mul(ls),a=Bn(s.add(r),43).add(Bn(o,30)).add(i),c=bo(a,s.add(Bn(r.add(ls),18)).add(o),t),l=dn(n,16).mul(t),d=dn(n,24),h=a.add(dn(n,e-32)).mul(t),f=c.add(dn(n,e-24)).mul(t);return bo(Bn(l.add(d),43).add(Bn(h,30)).add(f),l.add(Bn(d.add(s),18)).add(h),t)}function F$(n,e=n.length){const t=Ko.fromNumber(81,!0);if(e<=32)return e<=16?P$(n,e):j$(n,e);if(e<=64)return M$(n,e);let s=t,r=t.mul(Ho).add(113),o=Uf(r.mul(ls).add(113)).mul(ls),i=[Ko.UZERO,Ko.UZERO],a=[Ko.UZERO,Ko.UZERO];s=s.mul(ls).add(dn(n,0));let c=0;const l=(e-1>>6)*64,d=l+(e-1&63)-63;do s=Bn(s.add(r).add(i[0]).add(dn(n,c+8)),37).mul(Ho),r=Bn(r.add(i[1]).add(dn(n,c+48)),42).mul(Ho),s=s.xor(a[1]),r=r.add(i[0]).add(dn(n,c+40)),o=Bn(o.add(a[0]),33).mul(Ho),i=Wl(n,c,i[1].mul(Ho),s.add(a[0])),a=Wl(n,c+32,o.add(a[1]),r.add(dn(n,c+16))),[o,s]=[s,o],c+=64;while(c!==l);const h=Ho.add(o.and(255).shl(1));return c=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Bn(s.add(r).add(i[0]).add(dn(n,c+8)),37).mul(h),r=Bn(r.add(i[1]).add(dn(n,c+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(dn(n,c+40))),o=Bn(o.add(a[0]),33).mul(h),i=Wl(n,c,i[1].mul(h),s.add(a[0])),a=Wl(n,c+32,o.add(a[1]),r.add(dn(n,c+16))),[o,s]=[s,o],bo(bo(i[0],a[0],h).add(Uf(r).mul(Sw)).add(o),bo(i[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _o(n,e){return e==="string"?wo(n):Ci([n],e)}function O$(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Ci(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ai(n)),pe().getBool("DEBUG")&&p$(n,e),O$(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function ms(){return pe().platform.now()}function wo(n,e="utf-8"){return e=e||"utf-8",pe().platform.encode(n,e)}function ko(n,e="utf-8"){return e=e||"utf-8",pe().platform.decode(n,e)}function tr(n){return pe().platform.isTypedArray!=null?pe().platform.isTypedArray(n):mw(n)}function ai(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Pp(n)||n==null||tr(n)&&t)e.push(n);else if(Array.isArray(n)||tr(n))for(let s=0;s<n.length;++s)ai(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)ai(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L${constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new W$)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const a=ms();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const l of r)l.dataSync();i=Promise.resolve({kernelMs:ms()-a})}if(pe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const d=r[l];d.data().then(h=>{z$(h,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(c=>{this.logger.logKernelProfile(t,a,c[0],c[1],o,c[2])})})}}function z$(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class W${logKernelProfile(e,t,s,r,o,i){const a=typeof r=="number"?Xi(`${r}ms`,9):r.error,c=Xi(e,25),l=t.rank,d=t.size,h=Xi(t.shape.toString(),14);let f="";for(const p in o){const m=o[p];if(m!=null){const g=m.shape||t.shape,x=g.length;f+=`${p}: ${x}D ${x>0?g:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${d}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$(n,e,t){const s={},r={};for(let c=0;c<e.length;c++)s[e[c].id]=!0;for(let c=0;c<n.length;c++){const l=n[c],d=l.inputs;for(const h in d){const f=d[h];let p=!1;for(let m=0;m<e.length;m++)if(s[f.id]){l.outputs.forEach(g=>s[g.id]=!0),p=!0,r[l.id]=!0;break}if(p)break}}const o={};o[t.id]=!0;const i={};for(let c=n.length-1;c>=0;c--){const l=n[c],d=l.inputs;for(let h=0;h<l.outputs.length;h++)if(o[l.outputs[h].id]){for(const f in d)o[d[f].id]=!0,i[l.id]=!0;break}}const a=[];for(let c=0;c<n.length;c++){const l=n[c];if(r[l.id]&&i[l.id]){const d={};for(const f in l.inputs){const p=l.inputs[f];s[p.id]&&(d[f]=p)}const h=Object.assign({},l);h.inputs=d,h.outputs=l.outputs,a.push(h)}}return a}function V$(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(c=>{const l=n[c.id];l!=null?i.push(l):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const c in o.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=t(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const d=o.inputs[c];if(!nn(l.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=l;else{const h=n[d.id];n[d.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xx=20,Oa=3,rf=7;function U$(n,e,t,s){const r=pt(e),o=G$(n,e,t,r),i=e.length,a=uu(n,e,t,r,o),c=["Tensor"];return s&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${i}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function G$(n,e,t,s){const r=Ce(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,c=t==="complex64"?Ha(n):n;if(a>1)for(let l=0;l<r/o;l++){const d=l*o;for(let h=0;h<o;h++)i[h]=Math.max(i[h],Ga(c[d+h],0,t).length)}return i}function Ga(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(rf))} + ${parseFloat(n[1].toFixed(rf))}j`:wc(n)?s=`'${n}'`:t==="bool"?s=Nw(n):s=parseFloat(n.toFixed(rf)).toString(),Xi(s,e)}function Nw(n){return n===0?"false":"true"}function uu(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,a=e[0],c=e.length;if(c===0){if(t==="complex64"){const g=Ha(n);return[Ga(g[0],0,t)]}return t==="bool"?[Nw(n[0])]:[n[0].toString()]}if(c===1){if(a>xx){const x=Oa*i;let y=Array.from(n.slice(0,x)),b=Array.from(n.slice((a-Oa)*i,a*i));return t==="complex64"&&(y=Ha(y),b=Ha(b)),["["+y.map((v,w)=>Ga(v,r[w],t)).join(", ")+", ..., "+b.map((v,w)=>Ga(v,r[a-Oa+w],t)).join(", ")+"]"]}return["["+(t==="complex64"?Ha(n):Array.from(n)).map((x,y)=>Ga(x,r[y],t)).join(", ")+"]"]}const l=e.slice(1),d=s.slice(1),h=s[0]*i,f=[];if(a>xx){for(let g=0;g<Oa;g++){const x=g*h,y=x+h;f.push(...uu(n.slice(x,y),l,t,d,r,!1))}f.push("...");for(let g=a-Oa;g<a;g++){const x=g*h,y=x+h;f.push(...uu(n.slice(x,y),l,t,d,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*h,y=x+h;f.push(...uu(n.slice(x,y),l,t,d,r,g===a-1))}const p=c===2?",":"";f[0]="["+(a>0?f[0]+p:"");for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+p;let m=`,
`;for(let g=2;g<c;g++)m+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":m),f}function Ha(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=Ce(e),s!=null){const r=s.length;R(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||In(t,this.size),this.strides=pt(e)}set(e,...t){t.length===0&&(t=[0]),R(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return hr().makeTensor(this.values,this.shape,this.dtype)}}let hr=null,Gi=null;function H$(n){hr=n}function q$(n){Gi=n}class Pn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ce(e),this.strides=pt(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Gi.buffer(this.shape,this.dtype,e)}bufferSync(){return Gi.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return gr(this.shape,e,this.dtype==="complex64")}arraySync(){return gr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=hr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>ko(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),hr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=hr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ko(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await hr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),hr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Gi.print(this,e)}clone(){return this.throwIfDisposed(),Gi.clone(this)}toString(e=!1){const t=this.dataSync();return U$(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Gi.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),hr().makeVariable(this,e,t,s)}}Object.defineProperty(Pn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Se(){return jp("Tensor",()=>Pn)}Se();class wu extends Pn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!nn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);hr().disposeTensor(this),this.dataId=e.dataId,hr().incRef(this,null)}dispose(){hr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(wu,Symbol.hasInstance,{value:n=>n instanceof Pn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yx;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(yx||(yx={}));var Gf;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Gf||(Gf={}));var Hf;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(Hf||(Hf={}));var qf;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(qf||(qf={}));var Kf;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Kf||(Kf={}));const K$={float32:qf,int32:Gf,bool:Hf,complex64:Kf};function Ds(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return K$[n][e]}function Nm(n){return Ds(n,"int32")}function Iw(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function kw(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ds(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function $w(n){const e=[];return Tw(n,e,new Set),e}function Tw(n,e,t){if(n==null)return;if(n instanceof Pn){e.push(n);return}if(!Q$(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),Tw(o,e,t))}}function Q$(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function of(n){return n.kernelName!=null}class bx{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ca{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bx}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Fs(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new L$(this.backendInstance),!0}setupRegisteredKernels(){ux(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ux(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof Ep)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Fs(`Initialization of backend ${e} failed`),Fs(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Fs(`Initialization of backend ${e} failed`),Fs(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return ca.nextTensorId++}nextVariableId(){return ca.nextVariableId++}clone(e){const t=ee.runKernel(Wc,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",c={x:i},l={dtype:a};return ee.runKernel(Tc,c,l)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(cx(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(c=>{o+=c.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=of(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(of(e)){const{kernelName:m,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const y=cx(m,this.backendName);R(y!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();c=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});const v=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,b,v);const w=v.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(m,g,w);s=this.saveTensorsForBackwardMode(S)}return w}}else{const{forwardFunc:m}=e,g=x=>{r&&(s=x.map(y=>this.keep(this.clone(y))))};a=()=>{const x=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,g));const y=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,x,y),y}}const{inputs:d,attrs:h}=e,f=of(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(p=this.profiler.profileKernel(l,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),r&&this.addTapeNode(l,d,t,f,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(m=>d[m]!=null?d[m].shape:null),outputShapes:t.map(m=>m.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(c)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=lx(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(R(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(l=>t[l])):a=o.map(l=>t[l]);const c=s.filter((l,d)=>i[d]);return a.concat(c)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&wc(e[0])&&(o=e.map(c=>wo(c)));const i=r.write(o,t,s),a=new Pn(t,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const c=this.state.tensorInfo.get(i),l=g$(o);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new Pn(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new wu(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*mu(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof wu||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*mu(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},c=lx(e);c!=null&&(r=c.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((d,h)=>{if(d==null){const f=s[h],p=ts(f.size,f.dtype);return this.makeTensor(p,f.shape,f.dtype)}return d}),r(l.length>1?l:l[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=$w(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(R(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));R(o instanceof Pn,()=>"The result y returned by f() must be a tensor.");const i=B$(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??X$(o.shape),V$(a,i,l=>this.tidy(l),J$);const c=t.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const d of l.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:c}})}customGrad(e){return R(Of(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{R(t.every(a=>a instanceof Pn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,c)=>{r[c]=a});const o=(a,c)=>(s=e(...t,c),R(s.value instanceof Pn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),R(Of(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,c)=>{const l=s.gradFunc(a,c),d=Array.isArray(l)?l:[l];R(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),R(d.every(f=>f instanceof Pn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return d.forEach((f,p)=>{h[p]=()=>f}),h};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=ms(),s=await this.backend.time(e);return s.wallMs=ms()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bx;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ca.nextTensorId=0;ca.nextVariableId=0;function X$(n){const e=_p(Ce(n),"float32");return ee.makeTensor(e,n,"float32")}function Aw(){const n=Gb();if(n._tfengine==null){const e=new b$(n);n._tfengine=new ca(e)}return C$(n._tfengine.ENV),H$(()=>n._tfengine),n._tfengine}const ee=Aw();function J$(n,e){const t={a:n,b:e};return ee.runKernel(Ca,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(){return typeof navigator<"u"&&navigator!=null}function Ew(n){if(n||Y$()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Rw(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bs=pe();bs.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});bs.registerFlag("IS_BROWSER",()=>Rw());bs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");bs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));bs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));bs.registerFlag("PROD",()=>!1);bs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>bs.getBool("DEBUG"));bs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);bs.registerFlag("IS_TEST",()=>!1);bs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>bs.getBool("DEBUG"));bs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);bs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);bs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dh(n,e){let t=n;if(tr(n))return e==="string"?[]:[n.length];if(Iw(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(kw(n))return[n.buffer.size/(e==null?4:mu(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||tr(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&pe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Dw(n,s,[]),s}function Dw(n,e,t){if(t=t||[],!Array.isArray(n)&&!tr(n)){R(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}R(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),R(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)Dw(n[r],s,t.concat(r))}function wx(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function z(n,e,t,s="numeric"){if(n instanceof Se())return wx(s,n.dtype,e,t),n;let r=va(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),wx(s,r,e,t),n==null||!tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const c=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}const o=dh(n,r);!tr(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Ci(n,r):ai(n,[],!0);return ee.makeTensor(a,o,r)}function _w(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>z(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$="__op";function se(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Z$;const r=(...o)=>{ee.startScope(t);try{const i=s(...o);return Pp(i)&&console.error("Cannot return a Promise inside of tidy."),ee.endScope(i),i}catch(i){throw ee.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e2(n,e){const t=z(n,"real","complex"),s=z(e,"imag","complex");Dp(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return ee.runKernel(Vp,r)}const ci=se({complex_:e2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hh(n,e,t,s){if(s==null)s=va(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(kw(n)||Iw(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return ee.backend.createTensorFromGPUData(n,e||t,s)}if(!tr(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){io(e);const r=Ce(e),o=Ce(t);R(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],c=i===t.length-1?a!==Ce(e.slice(i)):!0;R(t[i]===e[i]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!tr(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Ci(n,s):ai(n,[],!0),ee.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(n,e,t){const s=dh(n,t);return hh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Po{static join(e){return new Po(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>tr(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let c=s;c<this.shards.length;c++){const l=this.shards[c],h=e+a-l.start,f=a,m=Math.min(t,l.end)-l.start,g=new Uint8Array(l.buffer,h,m-h);if(i.set(g,f),a+=g.length,t<l.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=t2(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function t2(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $r(){return ee}function Qf(){return ee.memory()}function ae(n,e){return ee.tidy(n,e)}function Ft(n){$w(n).forEach(t=>t.dispose())}function Fr(n){return ee.keep(n)}function Pw(n,e,t=1){return ee.registerBackend(n,e,t)}function n2(){return ee.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const la=4;async function vx(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],c=Array.isArray(n)?n[i].tensor:n[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);const l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const d=new Promise(async h=>{const f=await c.bytes(),p=f.reduce((x,y)=>x+y.length,0)+la*f.length,m=new Uint8Array(p);let g=0;for(let x=0;x<f.length;x++){const y=f[x],b=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(b,g),g+=la,m.set(y,g),g+=y.length}h(m)});s.push(d)}else s.push(c.data());e!=null&&(l.group=e),t.push(l)}const o=await Promise.all(s);return{data:i2(o),specs:t}}function s2(n,e){const t=new Po(n),s={};let r=0;for(const o of e){const i=r2(o,(a,c)=>t.slice(r+a,r+c));s[o.name]=o2(o,t.slice(r,r+i)),r+=i}return s}function r2(n,e){const t=Ce(n.shape);let s;if("quantization"in n){const r=n.quantization;s=vu[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=la+new Uint32Array(e(r,r+la))[0];return r}else s=vu[n.dtype];return t*s}function o2(n,e){const t=n.name,s=n.dtype,r=n.shape,o=Ce(r);let i,a=0;if("quantization"in n){const c=n.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${n.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const l=vu[c.dtype],d=c.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){i=new Float32Array(d.length);for(let h=0;h<d.length;h++){const f=d[h];i[h]=f*c.scale+c.min}}else if(c.dtype==="float16")i=g2()(d);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(s==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let h=0;h<d.length;h++){const f=d[h];i[h]=Math.round(f*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*l}else if(s==="string"){const c=Ce(n.shape);i=[];for(let l=0;l<c;l++){const d=new Uint32Array(e.slice(a,a+la))[0];a+=la;const h=new Uint8Array(e.slice(a,a+d));i.push(h),a+=d}}else{const c=vu[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const l=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let m=0;m<l.length;m++)l[m]=i[m*2],d[m]=i[m*2+1];const h=Yi(l,r,"float32"),f=Yi(d,r,"float32"),p=ci(h,f);return h.dispose(),f.dispose(),p}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*c}return Yi(i,r,s)}function i2(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const Im=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Sx(n){return Im?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function a2(n){if(Im)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function c2(n){if(Im){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function l2(n){return Po.join(n)}function u2(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function d2(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function h2(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),d2(n,t,s)}function km(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:Sx(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:Sx(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Po(n.weightData).byteLength}}function Cx(n){const e=[];for(const t of n)e.push(...t.weights);return e}function f2(){const n=t=>{let s=t<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function p2(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function m2(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function g2(){const n=f2(),e=p2(),t=m2();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],c=n[t[a>>10]+(a&1023)]+e[a>>10];o[i]=c}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Wn.instance==null&&(Wn.instance=new Wn),Wn.instance}static registerSaveRouter(e){Wn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Wn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Wn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Wn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Wn.getInstance().loadRouters:Wn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const x2=n=>Wn.getSaveHandlers(n),y2=(n,e)=>Wn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xf="tensorflowjs",Jf=1,Zo="models_store",go="model_info_store";function jw(){if(!pe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Yf(n){const e=n.result;e.createObjectStore(Zo,{keyPath:"modelPath"}),e.createObjectStore(go,{keyPath:"modelPath"})}class li{constructor(e){if(this.indexedDB=jw(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(Xf,Jf);o.onupgradeneeded=()=>Yf(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(Zo,"readonly"),l=a.objectStore(Zo).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=d=>(i.close(),r(l.error)),a.oncomplete=()=>i.close()}else{t.weightData=Po.join(t.weightData);const a=km(t),c=i.transaction(go,"readwrite");let l=c.objectStore(go),d;try{d=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return r(f)}let h;d.onsuccess=()=>{h=i.transaction(Zo,"readwrite");const f=h.objectStore(Zo);let p;try{p=f.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(m){return r(m)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=m=>{l=c.objectStore(go);const g=l.delete(this.modelPath);g.onsuccess=()=>(i.close(),r(p.error)),g.onerror=x=>(i.close(),r(p.error))}},d.onerror=f=>(i.close(),r(d.error)),c.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}li.URL_SCHEME="indexeddb://";const Mw=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(li.URL_SCHEME)?b2(n.slice(li.URL_SCHEME.length)):null;Wn.registerSaveRouter(Mw);Wn.registerLoadRouter(Mw);function b2(n){return new li(n)}function w2(n){return n.startsWith(li.URL_SCHEME)?n.slice(li.URL_SCHEME.length):n}class v2{constructor(){this.indexedDB=jw()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(Xf,Jf);s.onupgradeneeded=()=>Yf(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(go,"readonly"),a=o.objectStore(go).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;e(c)},a.onerror=c=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=w2(e),new Promise((t,s)=>{const r=this.indexedDB.open(Xf,Jf);r.onupgradeneeded=()=>Yf(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(go,"readwrite"),a=i.objectStore(go),c=a.get(e);let l;c.onsuccess=()=>{if(c.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),h=()=>{l=o.transaction(Zo,"readwrite");const p=l.objectStore(Zo).delete(e);p.onsuccess=()=>t(c.result.modelArtifactsInfo),p.onerror=m=>s(c.error)};d.onsuccess=h,d.onerror=f=>(h(),o.close(),s(c.error))}},c.onerror=d=>(o.close(),s(c.error)),i.oncomplete=()=>{l==null?o.close():l.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jr="/",Hi="tensorflowjs_models",Fw="info",S2="model_topology",C2="weight_specs",N2="weight_data",I2="model_metadata";function Ow(n){return{info:[Hi,n,Fw].join(Jr),topology:[Hi,n,S2].join(Jr),weightSpecs:[Hi,n,C2].join(Jr),weightData:[Hi,n,N2].join(Jr),modelMetadata:[Hi,n,I2].join(Jr)}}function Lw(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function k2(n){const e=n.split(Jr);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Jr)}function $2(n){return n.startsWith(ui.URL_SCHEME)?n.slice(ui.URL_SCHEME.length):n}class ui{constructor(e){if(!pe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Ow(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=km(e),o=Po.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,a2(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw Lw(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=c2(i),t}}ui.URL_SCHEME="localstorage://";const zw=n=>pe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ui.URL_SCHEME)?T2(n.slice(ui.URL_SCHEME.length)):null;Wn.registerSaveRouter(zw);Wn.registerLoadRouter(zw);function T2(n){return new ui(n)}class A2{constructor(){R(pe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),R(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Hi+Jr,s=Jr+Fw;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=k2(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=$2(e);const t=Ow(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return Lw(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nx="://";class Ar{constructor(){this.managers={}}static getInstance(){return Ar.instance==null&&(Ar.instance=new Ar),Ar.instance}static registerManager(e,t){R(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Nx)&&(e=e.slice(0,e.indexOf(Nx))),R(e.length>0,()=>"scheme must not be an empty string.");const s=Ar.getInstance();R(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Ar.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Ar.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E2{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!pe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return mw(e)}}if(pe().get("IS_BROWSER")){pe().setPlatform("browser",new E2);try{Ar.registerManager(ui.URL_SCHEME,new A2)}catch{}try{Ar.registerManager(li.URL_SCHEME,new v2)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R2={importFetch:()=>require("node-fetch")};let af;class D2{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return pe().global.fetch!=null?pe().global.fetch(e,t):(af==null&&(af=R2.importFetch()),af(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}pe().get("IS_NODE")&&!pe().get("IS_BROWSER")&&pe().setPlatform("node",new D2);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zt(n,e="float32",t){return e=e||"float32",io(n),new Kn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _2(n,e){const t=z(n,"x","cast");if(!m$(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return ee.runKernel(Tc,s,r)}const et=se({cast_:_2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P2(n){const t={x:z(n,"x","clone","string_or_numeric")};return ee.runKernel(Wc,t)}const ni=se({clone_:P2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j2(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Aw();const M2={buffer:zt,cast:et,clone:ni,print:j2};q$(M2);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F2(n,e){let t=z(n,"a","add"),s=z(e,"b","add");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel(Ca,r)}const ze=se({add_:F2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2(n,e){let t=z(n,"a","floorDiv"),s=z(e,"b","floorDiv");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel(Lc,r)}const Ww=se({floorDiv_:O2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L2(n,e){let t=z(n,"a","div"),s=z(e,"b","div");if([t,s]=$n(t,s),t.dtype==="int32"&&s.dtype==="int32")return Ww(t,s);const r={a:t,b:s},o={};return ee.runKernel(_c,r,o)}const xt=se({div_:L2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2(n,e){let t=z(n,"a","mul"),s=z(e,"b","mul");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel(Xc,r)}const Y=se({mul_:z2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2(n){const e=z(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return ee.runKernel(xd,t)}else{const t={x:e};return ee.runKernel(ud,t)}}const as=se({abs_:W2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B2(n){const t={x:z(n,"x","acos")};return ee.runKernel(vc,t)}const V2=se({acos_:B2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U2(n){const t={x:z(n,"x","acosh")};return ee.runKernel(Sc,t)}const G2=se({acosh_:U2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H2(n,e=null,t=!1){const r={x:z(n,"x","all","bool")},o={axis:e,keepDims:t};return ee.runKernel(Fp,r,o)}const Bw=se({all_:H2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2(n,e=null,t=!1){const r={x:z(n,"x","any","bool")},o={axis:e,keepDims:t};return ee.runKernel(Op,r,o)}const Zf=se({any_:q2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K2(n,e=0){const s={x:z(n,"x","argMax")},r={axis:e};return ee.runKernel(dd,s,r)}const oc=se({argMax_:K2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q2(n,e=0){const s={x:z(n,"x","argMin")},r={axis:e};return ee.runKernel(hd,s,r)}const X2=se({argMin_:Q2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2(n){const t={x:z(n,"x","asin")};return ee.runKernel(Cc,t)}const Y2=se({asin_:J2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z2(n){const t={x:z(n,"x","asinh")};return ee.runKernel(Nc,t)}const eT=se({asinh_:Z2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tT(n){const t={x:z(n,"x","atan")};return ee.runKernel(Ic,t)}const nT=se({atan_:tT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sT(n,e){let t=z(n,"a","atan2"),s=z(e,"b","atan2");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel($c,r)}const rT=se({atan2_:sT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(n){const t={x:z(n,"x","atanh")};return ee.runKernel(kc,t)}const iT=se({atanh_:oT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gl(n,e,t,s,r="NHWC",o){const i=n[3],a=[...e,i],c=co(r);return Qn(n,a,t,o,s,null,null,c)}function sr(n,e,t,s,r,o,i="channelsLast"){const[a,c]=ic(e);let l;if(i==="channelsLast")l=[a,c,n[3],n[3]];else if(i==="channelsFirst")l=[a,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Qn(n,l,t,s,r,o,!1,i)}function ao(n,e,t,s,r,o,i="NDHWC"){const[a,c,l]=ep(e);let d,h;if(i==="NDHWC")h="channelsLast",d=[a,c,l,n[4],n[4]];else if(i==="NCDHW")h="channelsFirst",d=[a,c,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return jo(n,d,t,s,r,!1,h,o)}function Qn(n,e,t,s,r,o,i=!1,a="channelsLast"){let[c,l,d,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,d,h]=n;else if(a==="channelsFirst")[c,h,l,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[f,p,,m]=e,[g,x]=ic(t),[y,b]=ic(s),v=Zi(f,y),w=Zi(p,b),{padInfo:S,outHeight:I,outWidth:C}=lT(r,l,d,g,x,v,w,o,a),k=i?m*h:m;let $;return a==="channelsFirst"?$=[c,k,I,C]:a==="channelsLast"&&($=[c,I,C,k]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:d,inChannels:h,outHeight:I,outWidth:C,outChannels:k,padInfo:S,strideHeight:g,strideWidth:x,filterHeight:f,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:n,outShape:$,filterShape:e}}function jo(n,e,t,s,r,o=!1,i="channelsLast",a){let[c,l,d,h,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[c,l,d,h,f]=n;else if(i==="channelsFirst")[c,f,l,d,h]=n;else throw new Error(`Unknown dataFormat ${i}`);const[p,m,g,,x]=e,[y,b,v]=ep(t),[w,S,I]=ep(s),C=Zi(p,w),k=Zi(m,S),$=Zi(g,I),{padInfo:N,outDepth:_,outHeight:P,outWidth:j}=uT(r,l,d,h,y,b,v,C,k,$,a),A=o?x*f:x;let F;return i==="channelsFirst"?F=[c,A,_,P,j]:i==="channelsLast"&&(F=[c,_,P,j,A]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:d,inWidth:h,inChannels:f,outDepth:_,outHeight:P,outWidth:j,outChannels:A,padInfo:N,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:p,filterHeight:m,filterWidth:g,effectiveFilterDepth:C,effectiveFilterHeight:k,effectiveFilterWidth:$,dilationDepth:w,dilationHeight:S,dilationWidth:I,inShape:n,outShape:F,filterShape:e}}function aT(n,e,t,s,r){s==null&&(s=$m(n,e,t));const o=n[0],i=n[1],a=ac((o-e+2*s)/t+1,r),c=ac((i-e+2*s)/t+1,r);return[a,c]}function cT(n,e,t,s,r,o){r==null&&(r=$m(n,e[0],s[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(i[a]=ac((n[a]-e[a]+2*r)/s[a]+1,o));return i}function $m(n,e,t,s=1){const r=Zi(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function ic(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function ep(n){return typeof n=="number"?[n,n,n]:n}function Zi(n,e){return e<=1?n:n+(n-1)*(e-1)}function lT(n,e,t,s,r,o,i,a,c){let l,d,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const p=aT([e,t],o,s,n,a);d=p[0],h=p[1]}else if(n==="same"){d=Math.ceil(e/s),h=Math.ceil(t/r);const f=Math.max(0,(d-1)*s+o-e),p=Math.max(0,(h-1)*r+i-t),m=Math.floor(f/2),g=f-m,x=Math.floor(p/2),y=p-x;l={top:m,bottom:g,left:x,right:y,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),h=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const f=c==="channelsLast"?n[1][0]:n[2][0],p=c==="channelsLast"?n[1][1]:n[2][1],m=c==="channelsLast"?n[2][0]:n[3][0],g=c==="channelsLast"?n[2][1]:n[3][1];l={top:f,bottom:p,left:m,right:g,type:f===0&&p===0&&m===0&&g===0?"VALID":"EXPLICIT"},d=ac((e-o+f+p)/s+1,a),h=ac((t-i+m+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:d,outWidth:h}}function uT(n,e,t,s,r,o,i,a,c,l,d){let h,f,p,m;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=cT([e,t,s,1],[a,c,l],1,[r,o,i],n,d);f=x[0],p=x[1],m=x[2]}else if(n==="same"){f=Math.ceil(e/r),p=Math.ceil(t/o),m=Math.ceil(s/i);const g=(f-1)*r+a-e,x=(p-1)*o+c-t,y=(m-1)*i+l-s,b=Math.floor(g/2),v=g-b,w=Math.floor(x/2),S=x-w,I=Math.floor(y/2),C=y-I;h={top:w,bottom:S,left:I,right:C,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:f,outHeight:p,outWidth:m}}function ac(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function di(n){const[e,t,s]=ic(n);return e===1&&t===1&&s===1}function ss(n,e){return di(n)||di(e)}function hi(n){return ic(n).every(e=>e>0)}function co(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function vs(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")R(ia(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{R(ia(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dT(n,e){const s={x:z(n,"x","reshape","string_or_numeric")},r={shape:e};return ee.runKernel(Jd,s,r)}const ne=se({reshape_:dT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hT(n,e,t,s,r){const o=z(n,"x","avgPool","float32"),i=1;R(ss(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,c=!1;o.rank===3&&(c=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]])),R(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),vs("avgPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let h=ee.runKernel(fd,l,d);return h=et(h,o.dtype),c?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Tm=se({avgPool_:hT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(n,e,t,s,r,o="NDHWC"){const i=z(n,"x","avgPool3d","float32");let a=i,c=!1;i.rank===4&&(c=!0,a=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),R(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),R(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),R(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),vs("avgPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let h=ee.runKernel(pd,l,d);return h=et(h,a.dtype),c?ne(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const pT=se({avgPool3d_:fT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(n,e=0){R(n.length>=1,()=>"Pass at least one tensor to concat");const t=_w(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return ni(t[0]);const s=t,r={axis:e};return ee.runKernel(yd,s,r)}const ys=se({concat_:mT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gT(n,e,t=!1,s=!1){let r=z(n,"a","matMul"),o=z(e,"b","matMul");[r,o]=$n(r,o);const i={a:r,b:o},a={transposeA:t,transposeB:s};return ee.runKernel(md,i,a)}const en=se({matMul_:gT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(n){const t={x:z(n,"x","sigmoid","float32")};return ee.runKernel(al,t)}const Na=se({sigmoid_:xT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(n,e,t){const s=z(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return ee.runKernel(nh,r,o)}const hn=se({slice_:yT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(n){const t={x:z(n,"x","tanh","float32")};return ee.runKernel(fl,t)}const fh=se({tanh_:bT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wT(n,e,t){const s=z(n,"x","batchToSpaceND"),r=e.reduce((a,c)=>a*c);R(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),R(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),R(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return ee.runKernel(gd,o,i)}const Am=se({batchToSpaceND_:wT});function vT(n){let e;return n.rank===0||n.rank===1?e=ne(n,[1,1,1,n.size]):n.rank===2?e=ne(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ne(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ST(n,e,t,s,r,o){o==null&&(o=.001);const i=z(n,"x","batchNorm"),a=z(e,"mean","batchNorm"),c=z(t,"variance","batchNorm");let l;r!=null&&(l=z(r,"scale","batchNorm"));let d;s!=null&&(d=z(s,"offset","batchNorm")),R(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:vT(i),scale:l,offset:d,mean:a,variance:c},p={varianceEpsilon:o},m=ee.runKernel($d,f,p);return ne(m,i.shape)}const ph=se({batchNorm_:ST});function CT(n,e,t,s,r,o){const i=z(n,"x","batchNorm"),a=z(e,"mean","batchNorm"),c=z(t,"variance","batchNorm");let l;r!=null&&(l=z(r,"scale","batchNorm"));let d;return s!=null&&(d=z(s,"offset","batchNorm")),R(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),R(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),R(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&R(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),d!=null&&R(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),ph(i,a,c,d,l,o)}const NT=se({batchNorm2d_:CT});function IT(n,e,t,s,r,o){const i=z(n,"x","batchNorm"),a=z(e,"mean","batchNorm"),c=z(t,"variance","batchNorm");let l;r!=null&&(l=z(r,"scale","batchNorm"));let d;return s!=null&&(d=z(s,"offset","batchNorm")),R(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),R(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),R(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&R(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),d!=null&&R(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),ph(i,a,c,d,l,o)}const kT=se({batchNorm3d_:IT});function $T(n,e,t,s,r,o){const i=z(n,"x","batchNorm"),a=z(e,"mean","batchNorm"),c=z(t,"variance","batchNorm");let l;r!=null&&(l=z(r,"scale","batchNorm"));let d;return s!=null&&(d=z(s,"offset","batchNorm")),R(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),R(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),R(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&R(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),d!=null&&R(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),ph(i,a,c,d,l,o)}const TT=se({batchNorm4d_:$T});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AT(n,e,t){const s=z(n,"x","bincount"),r=z(e,"weights","bincount");R(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),R(t>=0,()=>`size must be non-negative, but got ${t}.`),R(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return ee.runKernel(Wp,o,i)}const ET=se({bincount_:AT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RT(n,e){let t=z(n,"broadcastTo","x");const s=t.shape;if(io(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=ne(t,l)}const r=t.shape,o=Array.from(e);for(let l=e.length-1;l>=0;l--)if(r[l]===e[l])o[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((l,d)=>l>1?d:-1).filter(l=>l>=0).length===0)return ni(t);const a={x:t},c={reps:o};return ee.runKernel(pl,a,c)}const nc=se({broadcastTo_:RT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DT(n){const t={x:z(n,"x","ceil","float32")};return ee.runKernel(Ac,t)}const _T=se({ceil_:DT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mh(n,e,t){io(n),t=t||va(e);const s={shape:n,value:e,dtype:t};return ee.runKernel(nm,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(n,e,t){const s=z(n,"x","clipByValue");if(R(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return mh(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return ee.runKernel(Ec,r,o)}const zs=se({clipByValue_:PT});function jT(n){return ys(n,0)}const MT=se({concat1d_:jT});function FT(n,e){return ys(n,e)}const OT=se({concat2d_:FT});function LT(n,e){return ys(n,e)}const zT=se({concat3d_:LT});function WT(n,e){return ys(n,e)}const BT=se({concat4d_:WT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VT(n,e,t,s,r="NHWC",o=[1,1],i){const a=z(n,"x","conv2d","float32"),c=z(e,"filter","conv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),vs("conv2d",s,i);const h=r==="NHWC"?l.shape[3]:l.shape[1];R(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),R(ss(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),R(hi(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),R(hi(t),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:l,filter:c},p={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=ee.runKernel(bd,f,p);return d?ne(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const fi=se({conv2d_:VT});function UT(n,e,t,s,r="NWC",o=1,i){const a=z(n,"x","conv1d"),c=z(e,"filter","conv1d");let l=a,d=!1;a.rank===2&&(d=!0,l=ne(a,[1,a.shape[0],a.shape[1]])),R(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),R(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),vs("conv1d",s,i),R(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),R(ss(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),R(hi(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),R(hi(t),()=>"Error in conv1D: Stride should be larger than 0."),R(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=ne(c,[1,c.shape[0],c.shape[1],c.shape[2]]),f=ne(l,[l.shape[0],1,l.shape[1],l.shape[2]]),x=fi(f,h,[1,t],s,"NHWC",[1,o],i);return d?ne(x,[x.shape[2],x.shape[3]]):ne(x,[x.shape[0],x.shape[2],x.shape[3]])}const Vw=se({conv1d_:UT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GT(n,e,t,s,r,o="NHWC",i){R(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,c=e,l=!1;e.rank===3&&(l=!0,c=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),R(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),R(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),R(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?c.shape[3]:c.shape[1];R(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),R(h===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[3]}.`),vs("conv2dDerInput",r,i);const f={dy:c,filter:t},p={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},m=ee.runKernel(wd,f,p);return l?ne(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Em=se({conv2DBackpropInput_:GT});function HT(n,e,t,s,r,o){const i=z(n,"x","conv2dTranspose"),a=z(e,"filter","conv2dTranspose");return Em(t,i,a,s,r,"NHWC",o)}const Uw=se({conv2dTranspose_:HT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qT(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=z(n,"x","conv3d"),a=z(e,"filter","conv3d");let c=i,l=!1;i.rank===4&&(l=!0,c=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),R(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),R(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),R(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),R(ss(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),R(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),R(hi(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),R(hi(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:c,filter:a},h={strides:t,pad:s,dataFormat:r,dilations:o},f=ee.runKernel(vd,d,h);return l?ne(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const KT=se({conv3d_:qT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QT(n,e,t,s,r){R(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=ne(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const c=o[4],l=i.shape[4];R(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),R(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),R(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),R(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),R(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},h={pad:r,strides:s,inputShape:o},f=ee.runKernel(Hp,d,h);return a?ne(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Gw=se({conv3DBackpropInput_:QT});function XT(n,e,t,s,r){const o=z(n,"x","conv3dTranspose"),i=z(e,"filter","conv3dTranspose");return Gw(t,o,i,s,r)}const JT=se({conv3dTranspose_:XT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(n){const t={x:z(n,"x","cos","float32")};return ee.runKernel(Rc,t)}const Rm=se({cos_:YT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(n){const t={x:z(n,"x","cosh","float32")};return ee.runKernel(Dc,t)}const Hw=se({cosh_:ZT});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(n,e=0,t=!1,s=!1){const o={x:z(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return ee.runKernel(qp,o,i)}const tp=se({cumprod_:eA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(n,e=0,t=!1,s=!1){const o={x:z(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return ee.runKernel(Sd,o,i)}const qw=se({cumsum_:tA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(n,e,t,s=!1){const r=z(n,"x","denseBincount"),o=z(e,"weights","denseBincount");R(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),R(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),R(t>=0,()=>`size must be non-negative, but got ${t}.`),R(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:t,binaryOutput:s};return ee.runKernel(Qp,i,a)}const Ix=se({denseBincount_:nA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sA(n,e,t="NHWC"){const s=z(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];R(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),R(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),R(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),R(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},c={blockSize:e,dataFormat:t};return ee.runKernel(Xp,a,c)}const rA=se({depthToSpace_:sA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oA(n,e,t,s,r="NHWC",o=[1,1],i){const a=z(n,"x","depthwiseConv2d","float32"),c=z(e,"filter","depthwiseConv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),R(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=r==="NHWC"?l.shape[3]:l.shape[1];R(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),vs("depthwiseConv2d",s,i);const f={x:l,filter:c},p={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=ee.runKernel(Cd,f,p);return d?ne(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Dm=se({depthwiseConv2d_:oA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(n,e,t,s,r=[1,1],o="NHWC"){const i=z(n,"x","dilation2d"),a=z(e,"filter","dilation2d");R(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),R(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),R(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let c=i,l=!1;i.rank===3&&(c=ne(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),R(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);const d={x:c,filter:a},h={strides:t,pad:s,dilations:r},f=ee.runKernel(Nd,d,h);return l?ne(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const aA=se({dilation2d_:iA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ua(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function Ln(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function _t(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[t-r-1]=i;else if(i===1)s[t-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(n,e){let t=z(n,"a","equal","string_or_numeric"),s=z(e,"b","equal","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(Id,r)}const Vr=se({equal_:cA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lA(n,e,t){const s=z(e,"a","where"),r=z(t,"b","where"),o=z(n,"condition","where","bool"),i=_t(_t(o.shape,s.shape),r.shape),a=nc(o,i),c=nc(s,i),l=nc(r,i),d={condition:a,t:c,e:l};return ee.runKernel(th,d)}const ds=se({where_:lA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(n){const t={x:z(n,"x","zerosLike")};return ee.runKernel(lh,t)}const Kt=se({zerosLike_:uA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n,e){let t=z(n,"a","div"),s=z(e,"b","div");[t,s]=$n(t,s);const r=xt(t,s),o=Kt(r),i=Vr(s,o);return ds(i,o,r)}const hA=se({divNoNan_:dA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(n,e){const t=z(n,"t1","dot"),s=z(e,"t2","dot");R((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(R(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=ne(t,[1,-1]),a=ne(s,[-1,1]),c=en(i,a);return ne(c,[])}else if(t.rank===1&&s.rank===2){const i=ne(t,[1,-1]),a=ne(s,[s.shape[0],s.shape[1]]),c=en(i,a);return ne(c,[c.size])}else if(t.rank===2&&s.rank===1){const i=ne(s,[-1,1]),a=en(t,i);return ne(a,[a.size])}else{const i=ne(s,[s.shape[0],s.shape[1]]);return en(t,i)}}const pA=se({dot_:fA});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n,...e){const t=e.map((r,o)=>z(r,`tensors${o}`,"einsum")),s={equation:n};return ee.runKernel(Zp,t,s)}const La=se({einsum_:mA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gA(n){const t={x:z(n,"x","elu","float32")};return ee.runKernel(Pc,t)}const gh=se({elu_:gA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(n){let e=z(n,"x","erf");R(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=et(e,"float32"));const t={x:e};return ee.runKernel(jc,t)}const Kw=se({erf_:xA});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _m(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Qw(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[i++]);return r}function Hn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function Dn(n,e){const t=e.map(s=>1);return Qw(n,t,e)}function Xn(n,e,t){R(_m(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Sn(n,e){if(_m(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function Mo(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Tn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(n,e=null,t=!1){const r={x:z(n,"x","max")},o={reductionIndices:e,keepDims:t};return ee.runKernel(Fd,r,o)}const xr=se({max_:yA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(n,e=null,t=!1){const r={x:z(n,"x","min")},o={axis:e,keepDims:t};return ee.runKernel(Wd,r,o)}const Su=se({min_:bA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(n,e){let t=z(n,"base","pow"),s=z(e,"exp","pow");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel(Jc,r)}const pi=se({pow_:wA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(n,e){if((tr(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&tr(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return hh(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vA(n){const t={x:z(n,"x","sqrt","float32")};return ee.runKernel(ll,t)}const ns=se({sqrt_:vA});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n){const e=z(n,"x","square"),t={};return ee.runKernel("Square",{x:e},t)}const pn=se({square_:SA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CA(n,e=null,t=!1){let s=z(n,"x","sum");s.dtype==="bool"&&(s=et(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return ee.runKernel(sh,r,o)}const gt=se({sum_:CA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n,e="euclidean",t=null,s=!1){n=z(n,"x","norm");const r=Xw(n,e,t);let o=r.shape;if(s){const i=Wt(t,n.shape);o=Dn(r.shape,i)}return ne(r,o)}function Xw(n,e,t=null){if(n.rank===0)return as(n);if(n.rank!==1&&t===null)return Xw(ne(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return gt(as(n),t);if(e===1/0)return xr(as(n),t);if(e===-1/0)return Su(as(n),t);if(e==="euclidean"||e===2)return ns(gt(pi(as(n),tn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return xr(gt(as(n),t[0]),t[1]-1);if(e===1/0)return xr(gt(as(n),t[1]),t[0]);if(e===-1/0)return Su(gt(as(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ns(gt(pn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const xh=se({norm_:NA});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IA(n,e=null,t=!1){return xh(n,"euclidean",e,t)}const kA=se({euclideanNorm_:IA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n){const t={x:z(n,"x","exp")};return ee.runKernel(Mc,t)}const Ur=se({exp_:$A});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n,e=0){const t=z(n,"x","expandDims","string_or_numeric");R(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return ee.runKernel(kd,s,r)}const gs=se({expandDims_:TA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AA(n){const t={x:z(n,"x","expm1")};return ee.runKernel(Fc,t)}const EA=se({expm1_:AA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n,e){const t=z(n,"x","tile","string_or_numeric");R(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return ee.runKernel(pl,s,r)}const mr=se({tile_:RA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n,e,t,s="float32"){e==null&&(e=n);const r=zt([n,e],s),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=ne(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return mr(gs(i,0),[t[0],1,1]);if(t.length===2)return mr(gs(gs(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return mr(gs(gs(gs(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Jw=se({eye_:DA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n){const t={x:z(n,"x","floor","float32")};return ee.runKernel(Oc,t)}const yh=se({floor_:_A});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PA(n,e,t=0,s=0){const r=z(n,"x","gather"),o=z(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:t,batchDims:s};return ee.runKernel(Td,i,a)}const Pm=se({gather_:PA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jA(n,e){let t=z(n,"a","greater","string_or_numeric"),s=z(e,"b","greater","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(Ad,r)}const Ws=se({greater_:jA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(n,e){let t=z(n,"a","greaterEqual","string_or_numeric"),s=z(e,"b","greaterEqual","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(zc,r)}const Ni=se({greaterEqual_:MA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FA(n){const t={input:z(n,"input","imag")};return ee.runKernel(om,t)}const jm=se({imag_:FA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(n){const t={x:z(n,"x","isFinite")};return ee.runKernel(Bc,t)}const LA=se({isFinite_:OA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n){const t={x:z(n,"x","isInf")};return ee.runKernel(Vc,t)}const WA=se({isInf_:zA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BA(n){const t={x:z(n,"x","isNaN")};return ee.runKernel(Uc,t)}const VA=se({isNaN_:BA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UA(n,e=.2){const s={x:z(n,"x","leakyRelu")},r={alpha:e};return ee.runKernel(Ed,s,r)}const Mm=se({leakyRelu_:UA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GA(n,e){let t=z(n,"a","less","string_or_numeric"),s=z(e,"b","less","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(Rd,r)}const Cu=se({less_:GA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HA(n,e){let t=z(n,"a","lessEqual","string_or_numeric"),s=z(e,"b","lessEqual","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(Dd,r)}const Ia=se({lessEqual_:HA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qA(n,e=5,t=1,s=1,r=.5){const o=z(n,"x","localResponseNormalization");R(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),R(ia(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={x:i},l={depthRadius:e,bias:t,alpha:s,beta:r},d=ee.runKernel(Md,c,l);return a?ne(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const KA=se({localResponseNormalization_:qA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QA(n){const t={x:z(n,"x","log","float32")};return ee.runKernel(Gc,t)}const Gr=se({log_:QA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XA(n){const t={x:z(n,"x","log1p")};return ee.runKernel(Hc,t)}const Yw=se({log1p_:XA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(n,e){R(Of(n),()=>"The f passed in variableGrads(f) must be a function"),R(e==null||Array.isArray(e)&&e.every(l=>l instanceof wu),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const l in ee.registeredVariables)e.push(ee.registeredVariables[l])}const s=t?e.filter(l=>!l.trainable):null,r=e.length;e=e.filter(l=>l.trainable),R(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=ee.gradients(n,e,null,o);R(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),R(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const c={};return e.forEach((l,d)=>{a[d]!=null&&(c[l.name]=a[d])}),s!=null&&s.forEach(l=>c[l.name]=null),{value:i,grads:c}}function da(n){return ee.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YA(n){const t={x:z(n,"x","neg")};return ee.runKernel(Vd,t)}const kn=se({neg_:YA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZA(n){const t={x:z(n,"x","softplus")};return ee.runKernel(cl,t)}const xl=se({softplus_:ZA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eE(n){const e=z(n,"x","logSigmoid");return da(s=>({value:kn(xl(kn(s))),gradFunc:i=>Y(i,Na(kn(s)))}))(e)}const tE=se({logSigmoid_:eE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nE(n,e){let t=z(n,"a","sub"),s=z(e,"b","sub");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel(dl,r)}const Nt=se({sub_:nE});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sE(n,e=-1){const t=z(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return da((r,o)=>{const a=xr(r,e,!0),c=Nt(r,a),l=Nt(et(c,"float32"),Gr(gt(Ur(c),e,!0)));return o([l]),{value:l,gradFunc:(h,f)=>{const[p]=f,m=!0,g=Ur(p);return Nt(h,Y(gt(h,e,m),g))}}})(t)}const Zw=se({logSoftmax_:sE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(n,e=null,t=!1){const s=z(n,"x","logSumExp"),r=Wt(e,s.shape),o=xr(s,r,!0),i=Nt(s,o),a=Ur(i),c=gt(a,r),l=Gr(c),d=ze(ne(o,l.shape),l);if(t){const h=Dn(d.shape,r);return ne(d,h)}return d}const ev=se({logSumExp_:rE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(n,e){const t=z(n,"a","logicalAnd","bool"),s=z(e,"b","logicalAnd","bool");_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(_d,r)}const to=se({logicalAnd_:oE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iE(n){const t={x:z(n,"x","logicalNot","bool")};return ee.runKernel(Pd,t)}const Fm=se({logicalNot_:iE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(n,e){const t=z(n,"a","logicalOr","bool"),s=z(e,"b","logicalOr","bool");_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(jd,r)}const tv=se({logicalOr_:aE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cE(n,e){const t=z(n,"a","logicalXor","bool"),s=z(e,"b","logicalXor","bool");return _t(t.shape,s.shape),to(tv(n,e),Fm(to(n,e)))}const lE=se({logicalXor_:cE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uE(n,e,t,s,r){const o=z(n,"x","maxPool"),i=1;let a=o,c=!1;o.rank===3&&(c=!0,a=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]])),R(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),R(ss(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),vs("maxPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},h=ee.runKernel(Od,l,d);return c?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Om=se({maxPool_:uE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dE(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=z(n,"x","maxPool3d");let a=i,c=!1;i.rank===4&&(c=!0,a=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),R(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),R(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),vs("maxPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},h=ee.runKernel(Ld,l,d);return c?ne(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const hE=se({maxPool3d_:dE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fE(n,e){let t=z(n,"a","maximum"),s=z(e,"b","maximum");[t,s]=$n(t,s),t.dtype==="bool"&&(t=et(t,"int32"),s=et(s,"int32")),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(qc,r)}const Fo=se({maximum_:fE});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pE(n,e=null,t=!1){const r={x:z(n,"x","mean")},o={axis:e,keepDims:t};return ee.runKernel(zd,r,o)}const Rn=se({mean_:pE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vn(n,e="float32"){if(io(n),e==="complex64"){const s=Vn(n,"float32"),r=Vn(n,"float32");return ci(s,r)}const t=ts(Ce(n),e);return ee.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oo(n,e="float32"){if(io(n),e==="complex64"){const s=Oo(n,"float32"),r=Vn(n,"float32");return ci(s,r)}const t=_p(Ce(n),e);return ee.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mE(n,e){let t=z(n,"a","minimum"),s=z(e,"b","minimum");[t,s]=$n(t,s),t.dtype==="bool"&&(t=et(t,"int32"),s=et(s,"int32")),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(Kc,r)}const cc=se({minimum_:mE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(n,e,t){R(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=z(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");R(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)R(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),R(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return ee.runKernel(Bd,i,o)}const xE=se({mirrorPad_:gE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(n,e){let t=z(n,"a","mod"),s=z(e,"b","mod");[t,s]=$n(t,s);const r={a:t,b:s};return ee.runKernel(Qc,r)}const bE=se({mod_:yE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wE(n,e=null,t=!1){n=z(n,"x","moments");const s=Wt(e,n.shape),r=Rn(n,s,t);let o=r.shape;t||(o=Dn(r.shape,s));const i=pn(Nt(et(n,"float32"),ne(r,o))),a=Rn(i,s,t);return{mean:r,variance:a}}const Lm=se({moments_:wE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(n,e){let t=z(n,"a","notEqual","string_or_numeric"),s=z(e,"b","notEqual","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return ee.runKernel(Ud,r)}const Nu=se({notEqual_:vE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SE(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:z(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return ee.runKernel(Hd,i,a)}const nv=se({oneHot_:SE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CE(n){const t={x:z(n,"x","onesLike")};return ee.runKernel(Gd,t)}const nr=se({onesLike_:CE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(n,e,t=0){const s=z(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return ee.runKernel(Kd,o,r)}const zm=se({pad_:NE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(n,e,t){const s=z(n,"x","spaceToBatchND");R(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),R(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),R(s.shape.reduce((i,a,c)=>c>0&&c<=e.length?i&&(a+t[c-1][0]+t[c-1][1])%e[c-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return ee.runKernel(rh,r,o)}const Wm=se({spaceToBatchND_:IE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kE(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=z(n,"x","maxPool");let c=a,l=!1;a.rank===3&&(l=!0,c=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),R(ss(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=sr(c.shape,e,o,r,s),h=[d.dilationHeight,d.dilationWidth];let f;s==="same"?f=TE([d.filterHeight,d.filterWidth],h):f=[[0,0],[0,0]];const p=h[0]===1&&h[1]===1,[m,g]=$E([d.inHeight,d.inWidth],h,f),x=p?s:"valid",y=p?c:Wm(c,h,m),v=(t==="avg"?()=>Tm(y,e,o,x,i):()=>Om(y,e,o,x,i))(),w=p?v:Am(v,h,g);return l?ne(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function $E(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,h)=>(d-o[h]%d)%d),a=r.map((d,h)=>d+i[h]),c=e.map((d,h)=>[s[h],a[h]]),l=e.map((d,h)=>[0,i[h]]);return[c,l]}function TE(n,e){const s=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const AE=se({pool_:kE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EE(n,e){const t=z(n,"x","prelu"),s=z(e,"alpha","prelu"),r={x:t,alpha:s};return ee.runKernel(Qd,r)}const Bm=se({prelu_:EE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RE(n,e=null,t=!1){let s=z(n,"x","prod");s.dtype==="bool"&&(s=et(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return ee.runKernel(Xd,r,o)}const DE=se({prod_:RE});var Vm={exports:{}};Vm.exports;(function(n){(function(e,t,s){function r(c){var l=this,d=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=d(" "),l.s1=d(" "),l.s2=d(" "),l.s0-=d(c),l.s0<0&&(l.s0+=1),l.s1-=d(c),l.s1<0&&(l.s1+=1),l.s2-=d(c),l.s2<0&&(l.s2+=1),d=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function i(c,l){var d=new r(c),h=l&&l.state,f=d.next;return f.int32=function(){return d.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,d),f.state=function(){return o(d,{})}),f}function a(){var c=4022871197,l=function(d){d=String(d);for(var h=0;h<d.length;h++){c+=d.charCodeAt(h);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=i:this.alea=i})(vi,n)})(Vm);var _E=Vm.exports,Um={exports:{}};Um.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor128=i})(vi,n)})(Um);var PE=Um.exports,Gm={exports:{}};Gm.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,d==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorwow=i})(vi,n)})(Gm);var jE=Gm.exports,Hm={exports:{}};Hm.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.x,h=c.i,f,p;return f=d[h],f^=f>>>7,p=f^f<<24,f=d[h+1&7],p^=f^f>>>10,f=d[h+3&7],p^=f^f>>>3,f=d[h+4&7],p^=f^f<<7,f=d[h+7&7],f=f^f<<13,p^=f^f<<9,d[h]=p,c.i=h+1&7,p};function l(d,h){var f,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,f=0;f<h.length;++f)p[f&7]=p[f&7]<<15^h.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],d.x=p,d.i=0,f=256;f>0;--f)d.next()}l(c,a)}function o(a,c){return c.x=a.x.slice(),c.i=a.i,c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.x&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorshift7=i})(vi,n)})(Hm);var ME=Hm.exports,qm={exports:{}};qm.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.w,h=c.X,f=c.i,p,m;return c.w=d=d+1640531527|0,m=h[f+34&127],p=h[f=f+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,m=h[f]=m^p,c.i=f,m+(d^d>>>16)|0};function l(d,h){var f,p,m,g,x,y=[],b=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,b=Math.max(b,h.length)),m=0,g=-32;g<b;++g)h&&(p^=h.charCodeAt((g+32)%h.length)),g===0&&(x=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,g>=0&&(x=x+1640531527|0,f=y[g&127]^=p+x,m=f==0?m+1:0);for(m>=128&&(y[(h&&h.length||0)&127]=-1),m=127,g=4*128;g>0;--g)p=y[m+34&127],f=y[m=m+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,y[m]=p^f;d.w=x,d.X=y,d.i=m}l(c,a)}function o(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.X&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor4096=i})(vi,n)})(qm);var FE=qm.exports,Km={exports:{}};Km.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.b,f=c.c,p=c.d,m=c.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^f,c.c=f=f-p|0,c.d=p<<16^f>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var d=0;d<l.length+20;d++)c.b^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.tychei=i})(vi,n)})(Km);var OE=Km.exports,sv={exports:{}};const LE={},zE=Object.freeze(Object.defineProperty({__proto__:null,default:LE},Symbol.toStringTag,{value:"Module"})),WE=zk(zE);(function(n){(function(e,t,s){var r=256,o=6,i=52,a="random",c=s.pow(r,o),l=s.pow(2,i),d=l*2,h=r-1,f;function p(w,S,I){var C=[];S=S==!0?{entropy:!0}:S||{};var k=y(x(S.entropy?[w,v(t)]:w??b(),3),C),$=new m(C),N=function(){for(var _=$.g(o),P=c,j=0;_<l;)_=(_+j)*r,P*=r,j=$.g(1);for(;_>=d;)_/=2,P/=2,j>>>=1;return(_+j)/P};return N.int32=function(){return $.g(4)|0},N.quick=function(){return $.g(4)/4294967296},N.double=N,y(v($.S),t),(S.pass||I||function(_,P,j,A){return A&&(A.S&&g(A,$),_.state=function(){return g($,{})}),j?(s[a]=_,P):_})(N,k,"global"in S?S.global:this==s,S.state)}function m(w){var S,I=w.length,C=this,k=0,$=C.i=C.j=0,N=C.S=[];for(I||(w=[I++]);k<r;)N[k]=k++;for(k=0;k<r;k++)N[k]=N[$=h&$+w[k%I]+(S=N[k])],N[$]=S;(C.g=function(_){for(var P,j=0,A=C.i,F=C.j,M=C.S;_--;)P=M[A=h&A+1],j=j*r+M[h&(M[A]=M[F=h&F+P])+(M[F]=P)];return C.i=A,C.j=F,j})(r)}function g(w,S){return S.i=w.i,S.j=w.j,S.S=w.S.slice(),S}function x(w,S){var I=[],C=typeof w,k;if(S&&C=="object")for(k in w)try{I.push(x(w[k],S-1))}catch{}return I.length?I:C=="string"?w:w+"\0"}function y(w,S){for(var I=w+"",C,k=0;k<I.length;)S[h&k]=h&(C^=S[h&k]*19)+I.charCodeAt(k++);return v(S)}function b(){try{var w;return f&&(w=f.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),v(w)}catch{var S=e.navigator,I=S&&S.plugins;return[+new Date,e,I,e.screen,v(t)]}}function v(w){return String.fromCharCode.apply(0,w)}if(y(s.random(),t),n.exports){n.exports=p;try{f=WE}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:vi,[],Math)})(sv);var BE=sv.exports,VE=_E,UE=PE,GE=jE,HE=ME,qE=FE,KE=OE,Ii=BE;Ii.alea=VE;Ii.xor128=UE;Ii.xorwow=GE;Ii.xorshift7=HE;Ii.xor4096=qE;Ii.tychei=KE;var Qm=Ii;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rv{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Qm.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class QE{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Qm.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(n,e=0,t=1,s,r){if(io(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new rv(e,t,s,!1,r),i=zt(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const JE=se({randomNormal_:XE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(n,e=0,t=1,s="float32",r){io(n);const o=zt(n,s),i=new QE(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const yl=se({randomUniform_:YE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lc(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return ee.runKernel(hm,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(n){const t={input:z(n,"input","real")};return ee.runKernel(fm,t)}const Iu=se({real_:ZE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(n){const t={x:z(n,"x","reciprocal")};return ee.runKernel(Yc,t)}const tR=se({reciprocal_:eR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n){const t={x:z(n,"x","relu")};return ee.runKernel(Zc,t)}const ki=se({relu_:nR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR(n){const t={x:z(n,"x","relu6")};return ee.runKernel(el,t)}const ov=se({relu6_:sR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(n,e){const s={x:z(n,"x","reverse")},r={dims:e};return ee.runKernel(eh,s,r)}const mi=se({reverse_:rR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(n){const t={x:z(n,"x","round")};return ee.runKernel(tl,t)}const iv=se({round_:oR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iR(n){const t={x:z(n,"x","rsqrt","float32")};return ee.runKernel(nl,t)}const av=se({rsqrt_:iR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n){const t={x:z(n,"x","selu")};return ee.runKernel(sl,t)}const cv=se({selu_:aR});function cR(n,e,t,s,r,o=[1,1],i="NHWC"){const a=z(n,"x","separableConv2d"),c=z(e,"depthwiseFilter","separableConv2d"),l=z(t,"pointwiseFilter","separableConv2d");let d=a,h=!1;if(a.rank===3&&(h=!0,d=ne(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");R(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),R(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),R(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),R(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const f=c.shape[2],p=c.shape[3];R(l.shape[2]===f*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*p}, but got ${l.shape[2]}.`);const m=Dm(d,c,s,r,i,o),x=fi(m,l,1,"valid",i);return h?ne(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const lv=se({separableConv2d_:cR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lR(n){const t={x:z(n,"x","sign")};return ee.runKernel(il,t)}const uR=se({sign_:lR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dR(n){const t={x:z(n,"x","sin","float32")};return ee.runKernel(rl,t)}const uv=se({sin_:dR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hR(n){const t={x:z(n,"x","sinh")};return ee.runKernel(ol,t)}const dv=se({sinh_:hR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n,e,t){const s=z(n,"x","slice1d");return R(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),hn(s,[e],[t])}const Xm=se({slice1d_:fR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pR(n,e,t){const s=z(n,"x","slice2d");return R(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const hv=se({slice2d_:pR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mR(n,e,t){const s=z(n,"x","slice3d");return R(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const Jm=se({slice3d_:mR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gR(n,e,t){const s=z(n,"x","slice4d");return R(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const ku=se({slice4d_:gR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xR(n,e=-1){const t=z(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return ee.runKernel(ih,s,r)}const Ym=se({softmax_:xR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(n){R(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return ee.runKernel(tm,e)}const fv=se({fft_:yR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bR(n){R(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return ee.runKernel(rm,e)}const np=se({ifft_:bR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ne(n,[t,e]);s=np(r)}else{const r=[t,2*(e-1)],o=ne(Iu(n),[t,e]),i=ne(jm(n),[t,e]),a=mi(hn(o,[0,1],[t,e-2]),1),c=Y(mi(hn(i,[0,1],[t,e-2]),1),tn(-1)),l=ys([o,a],1),d=ys([i,c],1),h=ne(ci(l,d),[r[0],r[1]]);s=np(h)}if(s=Iu(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=ne(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const vR=se({irfft_:wR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SR(n,e,t=0){const r={x:z(n,"x","split")},o={numOrSizeSplits:e,axis:t};return ee.runKernel(oh,r,o)}const Ls=se({split_:SR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CR(n,e){R(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const m=n.shape.map(x=>0),g=n.shape.map(x=>x);g[n.shape.length-1]=e,r=hn(n,m,g),t=e}else if(e!=null&&e>t){const m=n.shape.map(g=>g);m[n.shape.length-1]=e-t,r=ys([n,Vn(m)],n.shape.length-1),t=e}else r=n;const o=Kt(r),i=ne(ci(r,o),[s,t]),a=fv(i),c=Math.floor(t/2)+1,l=Iu(a),d=jm(a),h=Ls(l,[c,t-c],l.shape.length-1),f=Ls(d,[c,t-c],d.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=c,ne(ci(h[0],f[0]),p)}const NR=se({rfft_:CR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IR(n,e){let t=z(n,"a","squaredDifference"),s=z(e,"b","squaredDifference");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s},o={};return ee.runKernel(ul,r,o)}const kR=se({squaredDifference_:IR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(n,e){const t=z(n,"x","squeeze","string_or_numeric");return ne(t,Do(t.shape,e).newShape)}const bl=se({squeeze_:$R});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TR(n,e=0){const t=_w(n,"tensors","stack","string_or_numeric");R(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&R(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return ee.runKernel(qd,s,r)}const no=se({stack_:TR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AR(n,e=0){const s={x:z(n,"x","step")},r={alpha:e};return ee.runKernel(ml,s,r)}const wl=se({step_:AR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(n,e,t,s,r=0,o=0,i=0,a=0,c=0){const d={x:z(n,"x","stridedSlice","string_or_numeric")},h={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};return ee.runKernel(ym,d,h)}const RR=se({stridedSlice_:ER});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DR(n){const t={x:z(n,"x","tan","float32")};return ee.runKernel(hl,t)}const _R=se({tan_:DR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rs(n,e){Lb(n);const t=dh(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return hh(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ea(n,e,t){if(Lb(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=dh(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return hh(n,e,s,t)}function pv(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function PR(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}pv(t,e,n)}function $i(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let h=r;h<o;++h)i*=t[h];const a=r<1?1:r,c=Ce(e.shape)/a,l=[...pt(t.slice(0,r)),1],d=Ce(t);return{sliceRank:r,numUpdates:c,sliceSize:i,strides:l,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jR(n,e=1,t=!0){const s=z(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[a,c]=ee.runKernel(bm,o,i);return{values:a,indices:c}}const MR=se({topk_:jR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FR(n,e=0,t=1,s,r){if(io(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new rv(e,t,s,!0,r),i=zt(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const mv=se({truncatedNormal_:FR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(n,e=0){const t=z(n,"x","unique","string_or_numeric");R(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=ee.runKernel(vm,s,r);return{values:o,indices:i}}const LR=se({unique_:OR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n,e,t){const s=z(n,"x","unsortedSegmentSum"),r=z(e,"segmentIds","unsortedSegmentSum","int32");R(ia(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return ee.runKernel(ch,o,i)}const gv=se({unsortedSegmentSum_:zR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WR(n,e=0){const t=z(n,"x","unstack","string_or_numeric");R(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return ee.runKernel(ah,s,r)}const gi=se({unstack_:WR});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n,e=!0,t,s){return ee.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=zt(n,"int32"),r=zt([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VR(n,e,t){const s=z(n,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),R(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{R(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?ae(()=>{let i=Iu(s),a=jm(s);return i=ee.runKernel(Ji,{x:i},o),a=ee.runKernel(Ji,{x:a},o),t&&(a=kn(a)),ci(i,a)}):ee.runKernel(Ji,r,o)}const qt=se({transpose_:VR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UR(n,e){if(e==null)return n.shape.slice();if(nn(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,e,t,s){const r=z(n,"x","dropout");if(R(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),R(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof Pn?r.clone():r;const o=UR(r,t),i=1-e,a=xt(yh(ze(yl(o,0,1,"float32",s),i)),i);return Y(r,a)}const HR=se({dropout_:GR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n,e,t,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=ne(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]])),R(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),R(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),R(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const l=o==="NHWC"?a.shape[3]:a.shape[1],d=o==="NHWC"?c.shape[3]:c.shape[1];R(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),R(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),vs("conv2dDerFilter",r,i);const h={x:a,dy:c},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return ee.runKernel(Up,h,f)}const Zm=se({conv2DBackpropFilter_:qR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eg(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Y(n,wl(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function tg(n,e){let t=e;const s=Ln(n.shape,e.shape);return s.length>0&&(t=gt(t,s)),ne(t,n.shape)}function ng(n,e,t,s){if(e==="linear")return n;if(e==="relu")return ki(n);if(e==="elu")return gh(n);if(e==="relu6")return ov(n);if(e==="prelu")return Bm(n,t);if(e==="leakyrelu")return Mm(n,s);if(e==="sigmoid")return Na(n);throw new Error(`Unknown fused activation ${e}.`)}const sg=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:d}){if(c=c||"linear",sg(ee.state.gradientDepth,c)===!1){R(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let I=fi(n,e,t,s,r,o,i);return a!=null&&(I=ze(I,a)),ng(I,c,l,d)}const h=z(n,"x","conv2d","float32"),f=z(e,"filter","conv2d","float32");let p=h,m=!1;h.rank===3&&(m=!0,p=ne(h,[1,h.shape[0],h.shape[1],h.shape[2]])),R(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),R(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),vs("fused conv2d",s,i);const g=r==="NHWC"?p.shape[3]:p.shape[1];R(f.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${f.shape[2]}.`),R(ss(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const x=Qn(p.shape,f.shape,t,o,s,i);let y;a!=null&&(y=z(a,"bias","fused conv2d"),[y]=$n(y,h),r==="NHWC"?_t(x.outShape,y.shape):(R(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),R(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let b;if(l!=null){const I=l.shape;if(R(I.length<=1||I.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${I.length}.`),I.length===1)R(I[0]===1||I[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the number of output channels (${x.outChannels}).`);else if(I.length===3)try{_t(I,x.outShape)}catch{const k=`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(k)}b=z(l,"prelu weights","fused conv2d")}const v=(I,C)=>{R(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[k,$,N,_]=C,P=eg(I,N,c);R(di(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const j=Em($.shape,P,k,t,s),A=Zm($,P,k.shape,t,s),F=[j,A];if(_!=null){const M=tg(_,P);F.push(M)}return F},w={x:p,filter:f,bias:y,preluActivationWeights:b},S={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:c,leakyreluAlpha:d};return a==null?da((C,k,$)=>{let N=ee.runKernel(xu,w,S);return $([k,C,N]),m&&(N=ne(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:v}})(p,f):da((C,k,$,N)=>{let _=ee.runKernel(xu,w,S);return N([k,C,_,$]),m&&(_=ne(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:v}})(p,f,y)}const QR=se({fusedConv2d_:KR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(n,e,t,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=ne(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:a,dy:c},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return ee.runKernel(Jp,l,d)}const JR=se({depthwiseConv2dNativeBackpropFilter_:XR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YR(n,e,t,s,r,o=[1,1],i){let a=e,c=!1;e.rank===3&&(c=!0,a=ne(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},h=ee.runKernel(Yp,l,d);return c?ne(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const ZR=se({depthwiseConv2dNativeBackpropInput_:YR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eD({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(sg(ee.state.gradientDepth,o)===!1){let _=en(n,e,t,s);return r!=null&&(_=ze(_,r)),ng(_,o,i,a)}let c=z(n,"a","fused matMul"),l=z(e,"b","fused matMul");[c,l]=$n(c,l);const d=t?c.shape[c.rank-2]:c.shape[c.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],f=t?c.shape[c.rank-1]:c.shape[c.rank-2],p=s?l.shape[l.rank-2]:l.shape[l.rank-1],m=c.shape.slice(0,-2),g=l.shape.slice(0,-2),x=Ce(m),y=Ce(g);R(d===h,()=>`Error in fused matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${t} and transposeB=${s} must match.`);const v=_t(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([f,p]),w=t?ne(c,[x,d,f]):ne(c,[x,f,d]),S=s?ne(l,[y,p,h]):ne(l,[y,h,p]);let I;r!=null&&(I=z(r,"bias","fused matMul"),[I]=$n(I,c),_t(v,I.shape));let C;i!=null&&(C=z(i,"prelu weights","fused matMul"));const k=(_,P)=>{const[j,A,F,M]=P,K=eg(ne(_,F.shape),F,o);let D,G;if(!t&&!s?(D=en(K,A,!1,!0),G=en(j,K,!0,!1)):!t&&s?(D=en(K,A,!1,!1),G=en(K,j,!0,!1)):t&&!s?(D=en(A,K,!1,!0),G=en(j,K,!1,!1)):(D=en(A,K,!0,!0),G=en(K,j,!0,!0)),r!=null){const te=tg(M,K);return[D,G,te]}else return[D,G]},$={a:w,b:S,bias:I,preluActivationWeights:C},N={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?da((P,j,A)=>{const F=ee.runKernel(gu,$,N);return A([P,j,F]),{value:ne(F,v),gradFunc:k}})(w,S):da((P,j,A,F)=>{const M=ee.runKernel(gu,$,N);return F([P,j,M,A]),{value:ne(M,v),gradFunc:k}})(w,S,I)}const kx=se({fusedMatMul_:eD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tD(n,e,t,s,r="bilinear",o=0){const i=z(n,"image","cropAndResize"),a=z(e,"boxes","cropAndResize","float32"),c=z(t,"boxInd","cropAndResize","int32"),l=a.shape[0];R(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),R(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),R(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),R(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),R(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),R(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:a,boxInd:c},h={method:r,extrapolationValue:o,cropSize:s};return ee.runKernel(Kp,d,h)}const nD=se({cropAndResize_:tD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(n){const e=z(n,"image","flipLeftRight","float32");R(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return ee.runKernel(sm,t,{})}const rD=se({flipLeftRight_:sD});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(n){const e=z(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];R(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),R(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,mr(e,r)}const iD=se({grayscaleToRGB_:oD});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aD(n){const e=z(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];R(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),R(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=et(e,"float32"),i=Rs([.2989,.587,.114]);let a;switch(e.rank){case 2:a=La("ij,j->i",o,i);break;case 3:a=La("ijk,k->ij",o,i);break;case 4:a=La("ijkl,l->ijk",o,i);break;case 5:a=La("ijklm,m->ijkl",o,i);break;case 6:a=La("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=gs(a,-1),et(a,r)}const cD=se({rgbToGrayscale_:aD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lD(n,e,t=0,s=.5){const r=z(n,"image","rotateWithOffset","float32");R(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return ee.runKernel(Sm,o,i)}const uD=se({rotateWithOffset_:lD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ka(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),R(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),R(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),R(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),R(e.rank===1,()=>"scores must be a 1D tensor"),R(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),R(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=z(n,"boxes","nonMaxSuppression","float32"),i=z(e,"scores","nonMaxSuppression","float32"),a=ka(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return ee.runKernel(lm,{boxes:o,scores:i},c)}const hD=se({nonMaxSuppression_:dD});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fD(n,e,t){const s=pD(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function pD(n,e,t){return gD(n,e,t||mD)}function mD(n,e){return n>e?1:n<e?-1:0}function gD(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=t(e,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rg(n,e,t,s,r){return ag(n,e,t,s,r,0)}function og(n,e,t,s,r,o){return ag(n,e,t,s,r,0,!1,o,!0)}function ig(n,e,t,s,r,o){return ag(n,e,t,s,r,o,!0)}function ag(n,e,t,s,r,o,i=!1,a=!1,c=!1){const l=[];for(let x=0;x<e.length;x++)e[x]>r&&l.push({score:e[x],boxIndex:x,suppressBeginIndex:0});l.sort($x);const d=o>0?-.5/o:0,h=[],f=[];for(;h.length<t&&l.length>0;){const x=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=x;if(y<r)break;let w=!1;for(let S=h.length-1;S>=v;--S){const I=xD(n,b,h[S]);if(I>=s){w=!0;break}if(x.score=x.score*yD(s,d,I),x.score<=r)break}x.suppressBeginIndex=h.length,w||(x.score===y?(h.push(b),f.push(x.score)):x.score>r&&fD(l,x,$x))}const p=h.length,m=t-p;a&&m>0&&(h.push(...new Array(m).fill(0)),f.push(...new Array(m).fill(0)));const g={selectedIndices:h};return i&&(g.selectedScores=f),c&&(g.validOutputs=p),g}function xD(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),l=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),p=(a-o)*(c-i),m=(h-l)*(f-d);if(p<=0||m<=0)return 0;const g=Math.max(o,l),x=Math.max(i,d),y=Math.min(a,h),b=Math.min(c,f),v=Math.max(y-g,0)*Math.max(b-x,0);return v/(p+m-v)}function yD(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function $x(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function bD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=z(n,"boxes","nonMaxSuppressionAsync"),i=z(e,"scores","nonMaxSuppressionAsync"),a=ka(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c=await Promise.all([o.data(),i.data()]),l=c[0],d=c[1],{selectedIndices:h}=rg(l,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),Rs(h,"int32")}const wD=bD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=z(n,"boxes","nonMaxSuppression"),a=z(e,"scores","nonMaxSuppression"),c=ka(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l={boxes:i,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},h=ee.runKernel(dm,l,d);return{selectedIndices:h[0],selectedScores:h[1]}}const SD=se({nonMaxSuppressionWithScore_:vD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function CD(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=z(n,"boxes","nonMaxSuppressionAsync"),a=z(e,"scores","nonMaxSuppressionAsync"),c=ka(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l=await Promise.all([i.data(),a.data()]),d=l[0],h=l[1],{selectedIndices:f,selectedScores:p}=ig(d,h,t,s,r,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Rs(f,"int32"),selectedScores:Rs(p)}}const ND=CD;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ID(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=z(n,"boxes","nonMaxSuppression"),a=z(e,"scores","nonMaxSuppression"),c=ka(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,f={boxes:i,scores:a},p={maxOutputSize:l,iouThreshold:d,scoreThreshold:h,padToMaxOutputSize:o},m=ee.runKernel(um,f,p);return{selectedIndices:m[0],validOutputs:m[1]}}const kD=se({nonMaxSuppressionPadded_:ID});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $D(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=z(n,"boxes","nonMaxSuppressionAsync"),a=z(e,"scores","nonMaxSuppressionAsync"),c=ka(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,[f,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:m,validOutputs:g}=og(f,p,l,d,h,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Rs(m,"int32"),validOutputs:tn(g,"int32")}}const TD=$D;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AD(n,e,t=!1,s=!1){const r=z(n,"images","resizeBilinear");R(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),R(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),R(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=ne(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=ee.runKernel(Zd,a,c);return i?ne(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const yv=se({resizeBilinear_:AD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e,t=!1,s=!1){const r=z(n,"images","resizeNearestNeighbor");R(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),R(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),R(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),R(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=ne(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=ee.runKernel(Yd,a,c);return i?ne(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const bv=se({resizeNearestNeighbor_:ED});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(n,e="binary",t=!1,s=.5){const r=z(n,"image","threshold"),o=.2989,i=.587,a=.114,c=r.shape[0]*r.shape[1];let l=Y(Rs([s]),255),d,h,f,p;if(R(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),R(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),R(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),R(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,h,f]=Ls(r,[1,1,1],-1);const x=Y(d,o),y=Y(h,i),b=Y(f,a);p=ze(ze(x,y),b)}else p=n;if(e==="otsu"){const x=ET(et(iv(p),"int32"),Yi([]),256);l=DD(x,c)}const m=t?Ia(p,l):Ws(p,l);return et(Y(m,255),"int32")}function DD(n,e){let t=Rs([-1]),s=Rs([0]),r=Rs([0]),o,i,a,c,l,d;for(let h=0;h<n.size-1;h++){o=hn(n,0,h+1),i=hn(n,h+1),l=xt(gt(o),e),d=xt(gt(i),e);const f=gt(Y(o,lc(0,o.size)));a=xt(f,gt(o));const p=mh(i.shape,o.size),m=ze(lc(0,i.size),p),g=Y(i,m);c=xt(gt(g),gt(i));const x=Nt(a,c),y=Nt(a,c),b=Y(l,d);r=Y(Y(b,x),y);const v=Ws(r,s);s=ds(v,r,s),t=ds(v,Rs([h]),t)}return t}const _D=se({threshold_:RD});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PD(n,e,t="nearest",s="constant",r=0,o){const i=z(n,"image","transform","float32"),a=z(e,"transforms","transform","float32");R(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),R(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),R(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const c={image:i,transforms:a},l={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return ee.runKernel(wm,c,l)}const jD=se({transform_:PD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MD(n,e,t){const s=z(n,"a","bandPart");R(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,c;typeof e=="number"?(R(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),R(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=z(e<0?o:e,"numLower","bandPart")):(R(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ds(Cu(e,0),o,cc(e,o))),typeof t=="number"?(R(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),R(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),c=z(t<0?i:t,"numUpper","bandPart")):(R(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=ds(Cu(t,0),i,cc(t,i)));const l=ne(lc(0,o,1,"int32"),[-1,1]),d=lc(0,i,1,"int32"),h=Nt(l,d),f=to(Ia(h,a),Ni(h,kn(c))),p=Vn([o,i],s.dtype);return ne(no(gi(ne(s,[-1,o,i])).map(m=>ds(f,m,p))),r)}const FD=se({bandPart_:MD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OD(n){let e;if(Array.isArray(n)){e=!1,R(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)R(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Ls(n,n.shape[0],0).map(r=>bl(r,[0]));R(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(ee.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=Y(gt(Y(t[i],o)),t[i]);o=Nt(o,a)}return xt(o,xh(o,"euclidean"))}));return e?no(t,0):t}const LD=se({gramSchmidt_:OD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n,e=!1){if(R(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return Tx(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((c,l)=>c*l),s=gi(ne(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(c=>{const[l,d]=Tx(c,e);r.push(l),o.push(d)});const i=ne(no(r,0),n.shape),a=ne(no(o,0),n.shape);return[i,a]}}function Tx(n,e=!1){return ee.tidy(()=>{R(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=Jw(t),o=ni(n);const i=ea([[1]],[1,1]);let a=ni(i);const c=t>=s?s:t;for(let l=0;l<c;++l){const d=o,h=a,f=r;[a,o,r]=ee.tidy(()=>{const p=hn(o,[l,l],[t-l,1]),m=xh(p),g=hn(o,[l,l],[1,1]),x=ds(Ws(g,0),ea([[-1]]),ea([[1]])),y=Nt(g,Y(x,m)),b=xt(p,y);b.shape[0]===1?a=ni(i):a=ys([i,hn(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const v=kn(xt(en(x,y),m)),w=hn(o,[l,0],[t-l,s]),S=Y(v,a),I=qt(a);if(l===0)o=Nt(w,en(S,en(I,w)));else{const $=Nt(w,en(S,en(I,w)));o=ys([hn(o,[0,0],[l,s]),$],0)}const C=qt(S),k=hn(r,[0,l],[t,r.shape[1]-l]);if(l===0)r=Nt(k,en(en(k,a),C));else{const $=Nt(k,en(en(k,a),C));r=ys([hn(r,[0,0],[t,l]),$],1)}return[a,o,r]}),Ft([d,h,f])}return!e&&t>s&&(r=hn(r,[0,0],[t,s]),o=hn(o,[0,0],[s,s])),[r,o]})}const WD=se({qr_:zD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zr={flipLeftRight:rD,grayscaleToRGB:iD,resizeNearestNeighbor:bv,resizeBilinear:yv,rgbToGrayscale:cD,rotateWithOffset:uD,cropAndResize:nD,nonMaxSuppression:hD,nonMaxSuppressionAsync:wD,nonMaxSuppressionWithScore:SD,nonMaxSuppressionWithScoreAsync:ND,nonMaxSuppressionPadded:kD,nonMaxSuppressionPaddedAsync:TD,threshold:_D,transform:jD},BD={bandPart:FD,gramSchmidt:LD,qr:WD};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD=new Map,UD=new Map;class $a{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Qs{constructor(){this.classNameMap={}}static getMap(){return Qs.instance==null&&(Qs.instance=new Qs),Qs.instance}static register(e){Qs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function je(n,e,t){R(n.className!=null,()=>"Class being registered does not have the static className property defined."),R(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),R(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Qs.register(n),VD.set(r,n),UD.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lo extends $a{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Ft(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return JA(e,t)}dispose(){this.iterations_!=null&&Ft(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:tn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Lo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wv extends Lo{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=ee.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=ee.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ae(()=>Kt(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ae(()=>Kt(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;ae(()=>{const d=ze(Y(c,this.rho),Y(pn(a),1-this.rho)),h=Y(xt(ns(ze(l,this.epsilon)),ns(ze(c,this.epsilon))),a),f=ze(Y(l,this.rho),Y(pn(h),1-this.rho));c.assign(d),l.assign(f);const p=ze(Y(h,-this.learningRate),o);o.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ft(this.accumulatedGrads.map(e=>e.variable)),Ft(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vv extends Lo{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=ee.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ae(()=>mh(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;ae(()=>{const c=ze(a,pn(i));a.assign(c);const l=ze(Y(xt(i,ns(ze(c,ee.backend.epsilon()))),-this.learningRate),o);o.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ft(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sv extends Lo{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ae(()=>{this.accBeta1=tn(t).variable(),this.accBeta2=tn(s).variable()}),r==null&&(this.epsilon=ee.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ae(()=>{const s=Nt(1,this.accBeta1),r=Nt(1,this.accBeta2);t.forEach((o,i)=>{const a=ee.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ae(()=>Kt(a).variable(c))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:ae(()=>Kt(a).variable(c))});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,f=ze(Y(d,this.beta1),Y(l,1-this.beta1)),p=ze(Y(h,this.beta2),Y(pn(l),1-this.beta2)),m=xt(f,s),g=xt(p,r);d.assign(f),h.assign(p);const x=ze(Y(xt(m,ze(ns(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(Y(this.accBeta1,this.beta1)),this.accBeta2.assign(Y(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ft(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ft(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ae(()=>{this.accBeta1.assign(pi(this.beta1,this.iterations_+1)),this.accBeta2.assign(pi(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cv extends Lo{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ae(()=>{this.iteration=tn(0).variable(),this.accBeta1=tn(t).variable()}),r==null&&(this.epsilon=ee.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ae(()=>{const s=Nt(1,this.accBeta1),r=xt(-this.learningRate,ze(Y(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=ee.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Kt(a).variable(c)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Kt(a).variable(c)});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,f=ze(Y(d,this.beta1),Y(l,1-this.beta1)),p=Y(h,this.beta2),m=as(l),g=Fo(p,m);d.assign(f),h.assign(g);const x=ze(Y(xt(r,s),xt(f,ze(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(ze(this.iteration,1)),this.accBeta1.assign(Y(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ft(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ft(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cg extends Lo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=ee.registeredVariables[s];ae(()=>{const a=ze(Y(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Fr(tn(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nv extends cg{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=tn(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=ee.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ae(()=>Kt(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ae(()=>{let c;const l=ze(Y(this.m,i),a);this.useNesterov?c=ze(Y(this.c,ze(a,Y(l,this.m))),o):c=ze(Y(this.c,l),o),i.assign(l),o.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ft(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iv extends Lo{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=ee.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=ee.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ae(()=>Kt(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ae(()=>Kt(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ae(()=>Kt(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;ae(()=>{const d=ze(Y(c,this.decay),Y(pn(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,f=ze(Y(h,this.decay),Y(a,1-this.decay)),p=xt(Y(a,this.learningRate),ns(Nt(d,ze(pn(f),this.epsilon)))),m=ze(Y(l,this.momentum),p);c.assign(d),h.assign(f),l.assign(m);const g=Nt(o,m);o.assign(g)}else{const h=ze(Y(c,this.decay),Y(pn(a),1-this.decay)),f=ze(Y(l,this.momentum),xt(Y(a,this.learningRate),ns(ze(h,this.epsilon))));c.assign(h),l.assign(f);const p=Nt(o,f);o.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ft(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ft(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ft(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=[wv,vv,Sv,Cv,Nv,Iv,cg];function HD(){for(const n of GD)je(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ax(n,e,t,s){i(n),t=t??0,s=s??1,a(t,s);let r=0;const o=c=>(c.then(l=>{const d=t+ ++r/n.length*(s-t);return e(d),l}),c);function i(c){R(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function a(c,l){R(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),R(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),R(l>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${l}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qD(n,e){e==null&&(e={});const t=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc,s=n.map(h=>t(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await Ax(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await Ax(a,e.onProgress,.5,1)}function KD(n,e){var t;const s=e.fetchFunc==null?pe().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:c,value:l}=await o.read();if(c){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}i.enqueue(l);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD="application/octet-stream",XD="application/json";class lg{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(R(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=pe().platform.fetch,R(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&R(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=u2(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:XD}),"model.json"),e.weightData!=null){const i=Po.join(e.weightData);t.body.append("model.weights.bin",new Blob([i],{type:QD}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:km(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return h2(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=Cx(e.weightsManifest),r=()=>KD(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=JD(t),o=this.weightPathPrefix||s,i=[],a=[];for(const c of e)for(const l of c.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(l)):i.push(o+l+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const t=await this.getWeightUrls(e),s=Cx(e),r=await qD(t,this.loadOptions);return[s,r]}}lg.URL_SCHEME_REGEX=/^https?:\/\//;function JD(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function Ex(n){return n.match(lg.URL_SCHEME_REGEX)!=null}const kv=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>Ex(s)):t=Ex(n),t)return $v(n,e)}return null};Wn.registerSaveRouter(kv);Wn.registerLoadRouter(kv);function $v(n,e){return new lg(n,e)}function YD(n,e){return $v(n,e)}function ug(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(Ce(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let h=0;h<r.length-1;++h)i*=r[h];const a=n.shape,c=r.slice();c.pop();let l=1;for(let h=o;h<t;++h)l*=a[h],c.push(a[h]);const d=[...pt(n.shape).map(h=>h/l),1].slice(0,o);return[c,i,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sp=-2,ZD=-1;function dg(n,e,t){const s=n.shape.length;R(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),R(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)R(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function e_(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function hg(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function Tv(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Av(n,e,t){return t<=n?t:t-(e-1)}function Ev(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function t_(n,e,t,s,r,o,i,a,c){const l=n.length;let d=new Array(l),h=new Array(l),f=new Array(l);if(e.length&&t>0){const p=e[0],m=t+1;d=Rv(i,p,m,s,n),h=Dv(a,p,m,r,n),f=Tv(o,p,m,n)}else for(let p=0;p<l;p++)d[p]=Pv(i,s,o,n,p,c),h[p]=jv(a,r,o,n,p,c),f[p]=_v(o,p,c);return{begin:d,end:h,strides:f}}function Rv(n,e,t,s,r){const o=[...r],i=Ev(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const c=Av(e,t,a);let l=s[c];n&1<<c&&(l=0),o[a]=l}return o}function Dv(n,e,t,s,r){const o=[...r],i=Ev(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const c=Av(e,t,a);let l=s[c];n&1<<c&&(l=Number.MAX_SAFE_INTEGER),o[a]=l}for(let a=0;a<o.length;a++){const c=r[a];o[a]<0&&(o[a]+=c),o[a]=ii(0,o[a],r[a])}return o}function _v(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function Pv(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),i=ii(0,i,c-1),i}function jv(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),a>0?i=ii(0,i,c):i=ii(-1,i,c-1),i}function fg(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function pg(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function bh(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{R(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(R(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function mg(n,e,t,s,r,o,i,a,c){let l;if(s==null?(l=new Array(e.length),l.fill(1)):l=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};for(let v=0;v<h.dims;v++)d&&1<<v&a&&h.numAddAxisAfterEllipsis++,1<<v&i&&(d=!0);d||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};n_(h,f);let p=!0,m=!0,g=!0;const x=[],y=[];for(let v=0;v<n.length;++v){if(f.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const w=!!(f.shrinkAxisMask&1<<v),S=n[v];if(S===-1){x.push(w?1:-1);continue}const I=[f.beginMask&1<<v,f.endMask&1<<v],C=[f.strides[v]>0?0:-1,f.strides[v]>0?S:S-1];if(w&&f.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&f.strides[v]===1;const k=!!(f.beginMask&1<<v&&f.endMask&1<<v);if(f.beginValid&&f.endValid){if(w){const P=f.begin[v]<0?S+f.begin[v]:f.begin[v];if(f.begin[v]=P,f.end[v]=f.begin[v]+1,P<0||P>=S)throw Error(`slice index ${f.begin[v]} of dimension ${v} out of bounds.`)}else f.begin[v]=Rx(f.begin[v],0,f.strides[v],S,I,C),f.end[v]=Rx(f.end[v],1,f.strides[v],S,I,C);const _=f.strides[v]===1&&f.begin[v]===0&&f.end[v]===S;p=p&&_,m=m&&(v===0&&f.strides[v]===1||_)}else p=p&&f.strides[v]===1&&k,m=m&&(v===0&&f.strides[v]===1||k);let $,N=!1;if(f.beginValid&&f.endValid?($=f.end[v]-f.begin[v],N=!0):w?($=1,N=!0):k&&S>=0&&(f.strides[v]<0?$=-S:$=S,N=!0),N){let _;$===0||$<0!=f.strides[v]<0?_=0:_=Math.trunc($/f.strides[v])+($%f.strides[v]!==0?1:0),x.push(_)}else x.push(-1)}for(let v=0;v<f.finalShapeGatherIndices.length;++v){const w=f.finalShapeGatherIndices[v];w>=0?y.push(x[w]):w===sp&&y.push(1)}return{finalShapeSparse:y.filter((v,w)=>f.finalShapeGatherIndices[w]!==sp),finalShape:y,isIdentity:p,sliceDim0:m,isSimpleSlice:g,begin:f.begin,end:f.end,strides:f.strides}}function n_(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(sp),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(ZD),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function Rx(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const s_=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:dg,computeFlatOffset:pg,computeOutShape:hg,getNormalizedAxes:t_,isSliceContinous:fg,maskToAxes:e_,parseSliceParams:bh,sliceInfo:mg,startForAxis:Pv,startIndicesWithElidedDims:Rv,stopForAxis:jv,stopIndicesWithElidedDims:Dv,stridesForAxis:_v,stridesWithElidedDims:Tv},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r_{static sgd(e){return new cg(e)}static momentum(e,t,s=!1){return new Nv(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new Iv(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new Sv(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new wv(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new Cv(e,t,s,r,o)}static adagrad(e,t=.1){return new vv(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qo=r_;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function Mv(){return new Promise(n=>o_(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gg(n,e){const t=n[0].length;n.forEach((r,o)=>{R(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),R(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)R(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Or(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(fr||(fr={}));function Fv(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function Ov(n){const e={FIRST_DIM_SIZE:fr.FIRST_DIM_SIZE,VALUE_ROWIDS:fr.VALUE_ROWIDS,ROW_LENGTHS:fr.ROW_LENGTHS,ROW_SPLITS:fr.ROW_SPLITS,ROW_LIMITS:fr.ROW_LIMITS,ROW_STARTS:fr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Lv(n){return n.length===0?0:n[0]===fr.FIRST_DIM_SIZE?n.length-1:n.length}function zv(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xg=30;function wh(n){return n<=xg?n:Lf(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yg(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vl(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function Sl(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function Cl(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function bg(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function wg(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vh=1.7580993408473768,Sh=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vg=.3275911,Sg=.254829592,Cg=-.284496736,Ng=1.421413741,Ig=-1.453152027,kg=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function Wv(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function Bv(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function Vv(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function $g(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function Uv(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function Gv(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function Hv(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cf="->",i_=/->/g,Dx=",",_x="...";function Tg(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(i_,"").length)/cf.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${cf}").`);const[s,r]=n.split(cf);R(s.indexOf(_x)===-1,()=>`The ellipsis notation ("${_x}") is not supported yet.`);const o=s.split(Dx),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<r.length;++f){const p=r[f];if(!o.some(m=>m.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let f=0;f<s.length;++f){const p=s[f];a.indexOf(p)===-1&&p!==Dx&&a.push(p)}const c=new Array(o.length);for(let f=0;f<i;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);c[f]=[];for(let p=0;p<o[f].length;++p)c[f].push(a.indexOf(o[f][p]))}const l=a.length,d=r.length,h=[];for(let f=d;f<l;++f)h.push(f);return{allDims:a,summedDims:h,idDims:c}}function Ag(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function Eg(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:R(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function Rg(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],c=a_(e,a);for(const l of c)o.indexOf(l)===-1&&(s[i].push(l),o.push(l))}return{path:t,steps:s}}function Dg(n){return n.every((e,t)=>e===t)}function a_(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function _g(n,e,t=0){let s=[];if(typeof e=="number")R(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);R(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,c)=>c>0?a+c:a);e[o]=n.shape[t]-i}R(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qv(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function Kv(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function Qv(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xv(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function Jv(n,e){return`size ${n} must be non-negative, not ${e}`}function Yv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Zv(n,e){const t=Ce(n),s=Ce(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function e1(n,e){const t=Ce(n),s=Ce(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rp(){return"segment ids must be >= 0"}function t1(){return"segment ids are not increasing"}function n1(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function s1(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r1(n,e){let t=!1,s;for(n<=xg?(s=n,t=!0):s=Lf(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=Lf(n,s+1);return s}function o1(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function Pg(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let h=0;h<s;++h)if(n.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const i=n.shape[t],a=[];let c=1,l=1,d=1;for(let h=0;h<s;++h)a.push(n.shape[h]),c*=n.shape[h];for(let h=s;h<t;h++)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=t+1;h<o;h++)a.push(n.shape[h]),d*=n.shape[h];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:i,outputShape:a}}const c_=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Pg,computeOutShape:o1,segOpComputeOptimalWindowSize:r1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ro(n){try{return n.map(e=>ko(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function i1(n){return n.map(e=>wo(e))}const l_=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Sg,ERF_A2:Cg,ERF_A3:Ng,ERF_A4:Ig,ERF_A5:kg,ERF_P:vg,PARALLELIZE_THRESHOLD:xg,get RowPartitionType(){return fr},SELU_SCALE:Sh,SELU_SCALEALPHA:vh,applyActivation:ng,assertAndGetBroadcastShape:_t,assertAxesAreInnerMostDims:Xn,assertParamsConsistent:gg,assignToTypedArray:Uv,axesAreInnerMostDims:_m,calculateShapes:$i,checkEinsumDimSizes:Eg,checkPadOnDimRoundingMode:vs,combineLocations:Qw,combineRaggedTensorToTensorShapes:Fv,complexWithEvenIndex:Bv,complexWithOddIndex:Vv,computeConv2DInfo:Qn,computeConv3DInfo:jo,computeDefaultPad:$m,computeDilation2DInfo:gl,computeOptimalWindowSize:wh,computeOutAndReduceShapes:Hn,computeOutShape:Or,computePool2DInfo:sr,computePool3DInfo:ao,convertConv2DDataFormat:co,decodeEinsumEquation:Tg,eitherStridesOrDilationsAreOne:ss,expandShapeToKeepDim:Dn,exponent:Hv,exponents:Gv,fromStringArrayToUint8:i1,fromUint8ToStringArray:ro,getAxesPermutation:Sn,getBroadcastDims:ua,getComplexWithIndex:$g,getEinsumComputePath:Rg,getEinsumPermutation:Ag,getFusedBiasGradient:tg,getFusedDyActivation:eg,getImageCenter:yg,getInnerMostAxes:Tn,getPermuted:Sl,getRaggedRank:Lv,getReductionAxes:Ln,getReshaped:vl,getReshapedPermuted:Cl,getRowPartitionTypesHelper:Ov,getSliceBeginCoords:bg,getSliceSize:wg,getSparseFillEmptyRowsIndicesDenseShapeMismatch:qv,getSparseFillEmptyRowsNegativeIndexErrorMessage:Kv,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Qv,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Yv,getSparseReshapeInputOutputMismatchErrorMessage:e1,getSparseReshapeInputOutputMultipleErrorMessage:Zv,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Xv,getSparseReshapeNegativeOutputDimErrorMessage:Jv,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:s1,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:rp,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:t1,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:n1,getUndoAxesPermutation:Mo,isIdentityPermutation:Dg,log:A$,mergeRealAndImagArrays:so,prepareAndValidate:ug,prepareSplitSize:_g,segment_util:c_,shouldFuse:sg,slice_util:s_,splitRealAndImagArrays:Wv,stridesOrDilationsArePositive:hi,tupleValuesAreOne:di,upcastType:Ds,validateDefaultValueShape:zv,validateInput:PR,validateUpdateShape:pv,warn:Fs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */HD();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1={kernelName:ud,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,wl(et(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:vc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=pn(et(t,"float32")),r=ns(Nt(tn(1),s));return kn(xt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_={kernelName:Sc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ns(Nt(pn(et(t,"float32")),1));return xt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_={kernelName:Ca,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{let a=n;const c=Ln(t.shape,r);return c.length>0&&(a=gt(a,c)),ne(a,t.shape)},b:()=>{let a=n;const c=Ln(s.shape,r);return c.length>0&&(a=gt(a,c)),ne(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_={kernelName:Mp,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_={kernelName:dd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_={kernelName:hd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Kt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_={kernelName:Cc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,ns(Nt(tn(1),pn(et(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_={kernelName:Nc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=ns(ze(tn(1),pn(et(t,"float32"))));return xt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y_={kernelName:$c,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=ze(pn(t),pn(s));let c=Y(n,xt(s,a));const l=Ln(t.shape,r);return l.length>0&&(c=gt(c,l)),ne(c,t.shape)},b:()=>{const a=ze(pn(t),pn(s));let c=kn(Y(n,xt(t,a)));const l=Ln(s.shape,r);return l.length>0&&(c=gt(c,l)),ne(c,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_={kernelName:Ic,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,ze(pn(et(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_={kernelName:kc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,Nt(tn(1),pn(et(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_(n,e,t,s,r,o){const i=z(n,"dy","avgPool3dGrad"),a=z(e,"input","avgPool3dGrad");let c=i,l=a,d=!1;a.rank===4&&(d=!0,c=ne(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=ne(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),R(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),R(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),vs("avgPool3dGrad",r,o);const h={dy:c,input:l},f={filterSize:t,strides:s,pad:r,dimRoundingMode:o},p=ee.runKernel(zp,h,f);return d?ne(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const S_=se({avgPool3dGrad_:v_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C_={kernelName:pd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>S_(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_(n,e,t,s,r){const o=z(n,"dy","avgPoolGrad"),i=z(e,"input","avgPoolGrad");R(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,c=o,l=!1;i.rank===3&&(l=!0,a=ne(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=ne(o,[1,o.shape[0],o.shape[1],o.shape[2]])),R(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),R(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:c,input:a},h={filterSize:t,strides:s,pad:r},f=ee.runKernel(Lp,d,h);return l?ne(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const I_=se({avgPoolGrad_:N_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k_={kernelName:fd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>I_(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $_={kernelName:md,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>en(n,r,!1,!0),b:()=>en(s,n,!0,!1)}:!o&&i?{a:()=>en(n,r,!1,!1),b:()=>en(n,s,!0,!1)}:o&&!i?{a:()=>en(r,n,!1,!0),b:()=>en(s,n,!1,!1)}:{a:()=>en(r,n,!0,!0),b:()=>en(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_={kernelName:gd,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>Wm(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_={kernelName:I$,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let c=r.length-1;c>=0;c--)if(r[c]===o[c])i[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let c=0;c<i.length;c++)i[c]>1&&a.push(c);return{x:()=>gt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_={kernelName:Tc,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_={kernelName:Ac,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_={kernelName:Ec,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>ds(to(Ni(s,r),Ia(s,o)),n,Kt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __={kernelName:xd,inputsToSave:["x"],gradFunc:a1.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_={kernelName:yd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(c=>c.shape),{axis:r}=t,o=Wt(r,e[0].shape)[0],i=s.map(c=>c[o]);return Ls(n,i,o).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j_={kernelName:bd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:c}=t;return R(di(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>Em(s.shape,n,r,i,a,c),filter:()=>Zm(s,n,r.shape,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_={kernelName:wd,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:c}=t;return{dy:()=>fi(n,r,o,i,a,1,c),filter:()=>Zm(n,s,r.shape,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F_(n,e,t,s,r){let o=n;n.rank===4&&(o=ne(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=ne(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),R(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),R(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),R(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),R(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),R(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},c={strides:s,pad:r,filterShape:t};return ee.runKernel(Gp,a,c)}const O_=se({conv3DBackpropFilter_:F_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L_={kernelName:vd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;R(di(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>Gw(i.shape,n,a,r,o),filter:()=>O_(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_={kernelName:Rc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(kn(uv(et(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W_={kernelName:Dc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(dv(et(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B_={kernelName:Sd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const a=Sn([r],s.rank);let c=qw(n,r,o,!i);return a!=null&&(c=qt(c,a)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V_={kernelName:Cd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,a=s??[1,1];R(di(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[c,l]=e;return R(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),R(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),R(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),R(ss(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),vs("depthwiseConv2d",o,i),{x:()=>ZR(c.shape,n,l,r,o,a,i),filter:()=>JR(c,n,l.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_={kernelName:Nd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>ee.runKernel(zf,o,t),filter:()=>ee.runKernel(Wf,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_={kernelName:Pc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>ee.runKernel(em,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_={kernelName:jc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=Y(Ur(kn(pn(t))),2/Math.sqrt(Math.PI));return{x:()=>Y(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_={kernelName:Mc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_={kernelName:kd,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ne(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_={kernelName:Fc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Ur(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_={kernelName:Oc,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J_={kernelName:Lc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=xt(n,et(s,"float32")),c=Ln(t.shape,r);return c.length>0?ne(gt(a,c),t.shape):a},b:()=>{let a=Y(n,et(t,"float32"));const c=Ln(s.shape,r);c.length>0&&(a=ne(gt(a,c),s.shape));const l=pn(s);return kn(xt(a,et(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y_={kernelName:$d,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,a]=e,c=a??tn(1),l=Ln(o.shape,r.shape),d=[];if(o.rank===1){for(let w=0;w<r.shape.length-1;++w)d.push(r.shape[w]);d.push(1)}const h=Nt(r,o),f=Y(n,c),p=av(ze(i,tn(s))),m=Y(Y(Y(p,p),p),tn(-.5));return{x:()=>o.rank===1?ne(Y(Y(n,mr(ne(p,[1,1,1,o.shape[0]]),d)),c),r.shape):ne(Y(Y(n,p),c),r.shape),mean:()=>{let w=Y(Y(p,tn(-1)),f);return o.rank===1&&(w=gt(w,l)),ne(w,o.shape)},variance:()=>{let w=Y(Y(m,h),f);return o.rank===1&&(w=gt(w,l)),ne(w,o.shape)},scale:()=>{const w=Y(h,p);let S=Y(n,w);return o.rank===1&&(S=gt(S,l)),ne(S,o.shape)},offset:()=>{let w=n;return o.rank===1&&(w=gt(w,l)),ne(w,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z_={kernelName:Td,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:i}=t,a=Wt(o,s.shape)[0],c=(l,d,h)=>()=>{const f=l.shape,p=d.size,m=f.slice(0,a),g=m.length,x=f.slice(o,f.length).slice(1),y=x.length,b=Px(0,g),v=Px(g+1,g+1+y),w=jx([m,[p],x]),S=ne(h,w),I=ne(d,[p]),C=jx([[g],b,v]),k=qt(S,C);let $=gv(k,I,l.shape[a]);const N=Mo(C);return $=qt($,N),$};if(i===1){const l=s.shape[0],d=s.split(l,0);return{x:()=>no(d.map((p,m)=>c(p,r.slice(m,1),n.slice(m,1))())).reshape(s.shape),indices:()=>r}}else return{x:c(s,r,n),indices:()=>r}}};function Px(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function jx(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP={kernelName:zc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Kt(t),b:()=>Kt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP={kernelName:Wc,gradFunc:n=>({x:()=>et(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP={kernelName:Bc,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={kernelName:Vc,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP={kernelName:Uc,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=Ws(s,0);return{x:()=>ds(o,n,Y(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP={kernelName:Hc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,ze(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP={kernelName:Gc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,et(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP={kernelName:$$,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=Ur(s);return Nt(n,Y(gt(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lP(n,e,t,s=5,r=1,o=1,i=.5){const a={x:n,y:e,dy:t},c={depthRadius:s,bias:r,alpha:o,beta:i};return ee.runKernel(im,a,c)}const uP=se({localResponseNormalizationBackprop_:lP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP={kernelName:Md,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:c}=t;return{x:()=>uP(s,r,n,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c1(n,e,t,s){return e.rank<t.rank&&(e=ne(e,Dn(e.shape,s))),n.rank<t.rank&&(n=ne(n,Dn(n.shape,s))),{x:()=>Y(n,et(Vr(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mx={kernelName:Fd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],a=Wt(r,o.shape),c=c1(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:qc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Y(n,et(Ni(t,s),"float32")),b:()=>Y(n,et(Cu(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fP(n,e,t,s,r,o,i){const a=z(n,"dy","maxPool3dGrad"),c=z(e,"input","maxPool3dGrad"),l=z(t,"output","maxPool3dGrad");let d=a,h=c,f=l,p=!1;c.rank===4&&(p=!0,d=ne(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=ne(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),f=ne(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),R(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),R(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),R(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),vs("maxPool3dGrad",o,i);const m={dy:d,input:h,output:f},g={filterSize:s,strides:r,pad:o,dimRoundingMode:i},x=ee.runKernel(cm,m,g);return p?ne(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const pP=se({maxPool3dGrad_:fP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP={kernelName:Ld,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=t;return{x:()=>pP(n,s,r,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gP(n,e,t,s,r,o,i){const a=z(n,"dy","maxPoolGrad"),c=z(e,"input","maxPoolGrad"),l=z(t,"output","maxPoolGrad");R(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),R(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),R(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),vs("maxPoolGrad",o,i);const d={dy:a,input:c,output:l},h={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return ee.runKernel(am,d,h)}const xP=se({maxPoolGrad_:gP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP={kernelName:Od,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>xP(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP={kernelName:zd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=Wt(r,s.shape),a=Hn(s.shape,o)[1],c=Ce(a);return{x:()=>{const d=s.shape.slice();o.forEach(p=>{d[p]=1});const h=ne(n,d);return xt(Y(h,Oo(s.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wP={kernelName:Wd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,a=Wt(r,o.shape),c=c1(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP={kernelName:Kc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>Y(n,et(Ia(t,s),"float32")),b:()=>Y(n,et(Ws(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP={kernelName:Bd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>hn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CP={kernelName:Qc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=Ln(t.shape,r);return a.length>0?ne(gt(n,a),t.shape):n},b:()=>{const a=Y(n,kn(yh(xt(t,s)))),c=Ln(s.shape,r);return c.length>0?ne(gt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NP={kernelName:Xc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=Y(n,et(s,"float32")),c=Ln(t.shape,r);return c.length>0?ne(gt(a,c),t.shape):a},b:()=>{const a=Y(n,et(t,"float32")),c=Ln(s.shape,r);return c.length>0?ne(gt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IP={kernelName:Vd,gradFunc:n=>({x:()=>kn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kP={kernelName:Hd,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Vn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $P={kernelName:Gd,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TP={kernelName:qd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return gi(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fx={kernelName:Kd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>hn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AP={kernelName:Jc,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,a=_t(o.shape,i.shape);return{a:()=>{const d=et(i,"float32");let h=Y(n,Y(d,pi(o,Nt(d,tn(1)))));const f=Ln(o.shape,a);return f.length>0&&(h=gt(h,f)),ne(h,o.shape)},b:()=>{const d=Ws(o,0),h=ds(d,Gr(o),Kt(o));let f=Y(n,Y(r,h));const p=Ln(i.shape,a);return p.length>0&&(f=gt(f,p)),ne(f,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP={kernelName:Qd,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=Ws(t,0);return{x:()=>ds(r,n,Y(n,s)),alpha:()=>{let o=ds(r,Kt(n),Y(n,t));const i=Ln(s.shape,n.shape);return i.length>0&&(o=gt(o,i)),ne(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RP(n,e,t){const s=n.shape.slice();s[t]=1;const r=ne(e,s),o=tp(n,t,!0,!1),i=tp(n,t,!0,!0),a=Y(o,i);return Y(r,a)}function DP(n,e,t){const s=n.shape.length,r=s-t.length,o=Sn(t,s);let i=n;o!=null&&(i=qt(n,o));const a=i.shape.slice(),l=a.splice(s-t.length,t.length).reduce((f,p)=>f*p,1);a.push(l);const d=i.reshape(a);let h=RP(d,e,r);if(h=h.reshape(i.shape),o!=null){const f=Mo(o);h=qt(h,f)}return h}const _P={kernelName:Xd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>DP(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PP={kernelName:_c,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=xt(n,et(s,"float32")),c=Ln(t.shape,r);return c.length>0?ne(gt(a,c),t.shape):a},b:()=>{let a=Y(n,et(t,"float32"));const c=Ln(s.shape,r);c.length>0&&(a=ne(gt(a,c),s.shape));const l=pn(s);return kn(xt(a,et(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jP={kernelName:Yc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,kn(pn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MP={kernelName:el,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=Y(Ia(t,6),wl(t));return{x:()=>Y(n,et(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FP={kernelName:Zc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,et(wl(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OP={kernelName:Jd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ne(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LP={kernelName:Zd,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>ee.runKernel(mm,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zP={kernelName:Yd,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>ee.runKernel(pm,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WP={kernelName:eh,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Wt(s,n.shape);return{x:()=>mi(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BP={kernelName:tl,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VP={kernelName:nl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>kn(xt(n,Y(pi(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UP={kernelName:th,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>et(Kt(t),"float32"),t:()=>Y(n,et(t,n.dtype)),e:()=>Y(n,et(Fm(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GP={kernelName:sl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=Ws(t,tn(0)),r=tn(vh),o=tn(Sh),i=Y(n,o),a=Y(Y(n,r),Ur(et(t,"float32")));return ds(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HP={kernelName:al,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Y(t,Nt(tn(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qP={kernelName:il,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KP={kernelName:rl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(Rm(et(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QP={kernelName:ol,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(Hw(et(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XP={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[a,c]=bh(s,r,o),l=[];for(let d=0;d<n.rank;d++)l.push([a[d],i[d]-a[d]-c[d]]);return{x:()=>zm(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JP={kernelName:ih,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=Y(n,s);return{logits:()=>Nt(i,Y(gt(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YP={kernelName:cl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Na(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ox={kernelName:rh,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>Am(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lx={kernelName:oh,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>ys(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZP={kernelName:ll,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,Y(ns(et(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ej={kernelName:gm,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(n,Y(et(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tj={kernelName:ul,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=tn(2);return{a:()=>Y(n,Y(r,Nt(t,s))),b:()=>Y(n,Y(r,Nt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nj={kernelName:ml,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sj={kernelName:dl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{let a=n;const c=Ln(t.shape,r);return c.length>0&&(a=gt(a,c)),ne(a,t.shape)},b:()=>{let a=n;const c=Ln(s.shape,r);return c.length>0&&(a=gt(a,c)),ne(kn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rj={kernelName:sh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;Wt(o,s.shape).forEach(l=>{r[l]=1});const a=ne(n,r),c=Y(a,Oo(s.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oj={kernelName:hl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>xt(n,pn(Rm(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ij={kernelName:fl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Y(Nt(tn(1),pn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aj={kernelName:pl,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=Kt(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=ze(i,hn(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)i=ze(i,hn(n,[a*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)i=ze(i,hn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)for(let d=0;d<r[3];++d)i=ze(i,hn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cj={kernelName:Ji,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=Mo(r);return{x:()=>qt(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lj={kernelName:ah,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>no(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uj={kernelName:ch,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>dj(n,t)}}};function dj(n,e){const t=Fo(e,Kt(e)),s=Pm(n,t);let r=Ni(e,tn(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=gs(r,a+1);r=to(r,Oo(s.shape,"bool"));const i=Kt(s);return ds(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hj={kernelName:lh,gradFunc:n=>({x:()=>Kt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fj=[a1,u_,d_,h_,f_,p_,m_,g_,x_,y_,b_,w_,C_,k_,$_,T_,A_,E_,R_,D_,__,P_,M_,j_,L_,z_,W_,B_,V_,U_,PP,G_,H_,q_,K_,Q_,J_,X_,Y_,Z_,eP,tP,nP,sP,rP,oP,iP,aP,cP,dP,Mx,Mx,hP,mP,yP,bP,wP,vP,SP,CP,NP,IP,kP,$P,TP,Fx,Fx,AP,EP,_P,jP,MP,FP,OP,LP,zP,WP,BP,VP,UP,GP,HP,qP,KP,QP,XP,JP,YP,Ox,Ox,Lx,Lx,ZP,tj,ej,nj,sj,rj,oj,ij,aj,cj,lj,uj,hj];for(const n of fj)E$(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.abs=function(){return this.throwIfDisposed(),as(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.acos=function(){return this.throwIfDisposed(),V2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.acosh=function(){return this.throwIfDisposed(),G2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.add=function(n){return this.throwIfDisposed(),ze(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.all=function(n,e){return this.throwIfDisposed(),Bw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.any=function(n,e){return this.throwIfDisposed(),Zf(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.argMax=function(n){return this.throwIfDisposed(),oc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.argMin=function(n){return this.throwIfDisposed(),X2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asScalar=function(){return this.throwIfDisposed(),R(this.size===1,()=>"The array must have only 1 element."),ne(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asType=function(n){return this.throwIfDisposed(),et(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as1D=function(){return this.throwIfDisposed(),ne(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as2D=function(n,e){return this.throwIfDisposed(),ne(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ne(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ne(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),ne(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asin=function(){return this.throwIfDisposed(),Y2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.asinh=function(){return this.throwIfDisposed(),eT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.atan=function(){return this.throwIfDisposed(),nT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.atan2=function(n){return this.throwIfDisposed(),rT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.atanh=function(){return this.throwIfDisposed(),iT(this)};Se().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),Tm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Am(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),ph(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.broadcastTo=function(n){return this.throwIfDisposed(),nc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cast=function(n){return this.throwIfDisposed(),et(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.ceil=function(){return this.throwIfDisposed(),_T(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),zs(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Pn&&(n=[n]),ys([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Vw(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),Uw(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),fi(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cos=function(){return this.throwIfDisposed(),Rm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cosh=function(){return this.throwIfDisposed(),Hw(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),tp(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),qw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),rA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Dm(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),aA(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.divNoNan=function(n){return this.throwIfDisposed(),hA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.div=function(n){return this.throwIfDisposed(),xt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.dot=function(n){return this.throwIfDisposed(),pA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.elu=function(){return this.throwIfDisposed(),gh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.equal=function(n){return this.throwIfDisposed(),Vr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.erf=function(){return this.throwIfDisposed(),Kw(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),kA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.exp=function(){return this.throwIfDisposed(),Ur(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.expandDims=function(n){return this.throwIfDisposed(),gs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.expm1=function(){return this.throwIfDisposed(),EA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.fft=function(){return this.throwIfDisposed(),fv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.flatten=function(){return this.throwIfDisposed(),ne(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.floor=function(){return this.throwIfDisposed(),yh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.floorDiv=function(n){return this.throwIfDisposed(),Ww(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.gather=function(n,e,t){return this.throwIfDisposed(),Pm(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Ni(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.greater=function(n){return this.throwIfDisposed(),Ws(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.ifft=function(){return this.throwIfDisposed(),np(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.irfft=function(){return this.throwIfDisposed(),vR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.isFinite=function(){return this.throwIfDisposed(),LA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.isInf=function(){return this.throwIfDisposed(),WA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.isNaN=function(){return this.throwIfDisposed(),VA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.leakyRelu=function(n){return this.throwIfDisposed(),Mm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.lessEqual=function(n){return this.throwIfDisposed(),Ia(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.less=function(n){return this.throwIfDisposed(),Cu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),KA(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logSigmoid=function(){return this.throwIfDisposed(),tE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Zw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),ev(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.log=function(){return this.throwIfDisposed(),Gr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.log1p=function(){return this.throwIfDisposed(),Yw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalAnd=function(n){return this.throwIfDisposed(),to(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalNot=function(){return this.throwIfDisposed(),Fm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalOr=function(n){return this.throwIfDisposed(),tv(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.logicalXor=function(n){return this.throwIfDisposed(),lE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),en(this,n,e,t)};Se().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),Om(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.max=function(n,e){return this.throwIfDisposed(),xr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.maximum=function(n){return this.throwIfDisposed(),Fo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mean=function(n,e){return this.throwIfDisposed(),Rn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.min=function(n,e){return this.throwIfDisposed(),Su(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.minimum=function(n){return this.throwIfDisposed(),cc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),xE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mod=function(n){return this.throwIfDisposed(),bE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.mul=function(n){return this.throwIfDisposed(),Y(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.neg=function(){return this.throwIfDisposed(),kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.norm=function(n,e,t){return this.throwIfDisposed(),xh(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.notEqual=function(n){return this.throwIfDisposed(),Nu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),nv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.onesLike=function(){return this.throwIfDisposed(),nr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.pad=function(n,e){return this.throwIfDisposed(),zm(this,n,e)};Se().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),AE(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.pow=function(n){return this.throwIfDisposed(),pi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.prelu=function(n){return this.throwIfDisposed(),Bm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.prod=function(n,e){return this.throwIfDisposed(),DE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reciprocal=function(){return this.throwIfDisposed(),tR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.relu=function(){return this.throwIfDisposed(),ki(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.relu6=function(){return this.throwIfDisposed(),ov(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ne(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reshape=function(n){return this.throwIfDisposed(),ne(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),yv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),bv(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.reverse=function(n){return this.throwIfDisposed(),mi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.rfft=function(){return this.throwIfDisposed(),NR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.round=function(){return this.throwIfDisposed(),iv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.rsqrt=function(){return this.throwIfDisposed(),av(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.selu=function(){return this.throwIfDisposed(),cv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),lv(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sigmoid=function(){return this.throwIfDisposed(),Na(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sign=function(){return this.throwIfDisposed(),uR(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sin=function(){return this.throwIfDisposed(),uv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sinh=function(){return this.throwIfDisposed(),dv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.slice=function(n,e){return this.throwIfDisposed(),hn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.softmax=function(n){return this.throwIfDisposed(),Ym(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.softplus=function(){return this.throwIfDisposed(),xl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Wm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.split=function(n,e){return this.throwIfDisposed(),Ls(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sqrt=function(){return this.throwIfDisposed(),ns(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.square=function(){return this.throwIfDisposed(),pn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.squaredDifference=function(n){return this.throwIfDisposed(),kR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.squeeze=function(n){return this.throwIfDisposed(),bl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof Pn?[this,n]:[this,...n];return no(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.step=function(n){return this.throwIfDisposed(),wl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.stridedSlice=function(n,e,t,s,r,o,i,a){return this.throwIfDisposed(),RR(this,n,e,t,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sub=function(n){return this.throwIfDisposed(),Nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.sum=function(n,e){return this.throwIfDisposed(),gt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.tan=function(){return this.throwIfDisposed(),_R(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.tanh=function(){return this.throwIfDisposed(),fh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.tile=function(n){return this.throwIfDisposed(),mr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.toBool=function(){return this.throwIfDisposed(),et(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.toFloat=function(){return this.throwIfDisposed(),et(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.toInt=function(){return this.throwIfDisposed(),et(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.topk=function(n,e){return this.throwIfDisposed(),MR(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.transpose=function(n){return this.throwIfDisposed(),qt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.unique=function(n){return this.throwIfDisposed(),LR(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),gv(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.unstack=function(n){return this.throwIfDisposed(),gi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.where=function(n,e){return this.throwIfDisposed(),ds(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Se().prototype.zerosLike=function(){return this.throwIfDisposed(),Kt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Er extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Er.prototype)}}class Zs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zs.prototype)}}class J extends Error{constructor(e){super(e),Object.setPrototypeOf(this,J.prototype)}}class Mt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Mt.prototype)}}class jg extends Error{constructor(e){super(e),Object.setPrototypeOf(this,jg.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class l1{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xi(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Rr(n,e){if(!n)throw new jg(e)}function zx(n,e){let t=0;for(const s of n)s===e&&t++;return t}function xs(n){return n.length===1?n[0]:n}function rn(n){return Array.isArray(n)?n:[n]}function Xr(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Qo(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Gs={};function Mg(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function op(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>op(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:op(s))}}}function Nl(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in Gs)i=Gs[o];else if(i=e[o],i==null)throw new J(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new J(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,c;if(i in t?[a,c]=t[i]:i in Gs?[a,c]=Gs.className:i in e&&([a,c]=e[i]),a==null)throw new J(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const l={};for(const p of Object.keys(Gs))l[p]=Gs[p];for(const p of Object.keys(t))l[p]=t[p];const d=o.config;d.customObjects=l;const h=Object.assign({},Gs);for(const p of Object.keys(t))Gs[p]=t[p];op(o.config);const f=c(a,o.config,t,r);return Gs=Object.assign({},h),f}else{const l=Object.assign({},Gs);for(const h of Object.keys(t))Gs[h]=t[h];const d=new a(o.config);return Gs=Object.assign({},l),d}}}function pj(n,e){return n<e?-1:n>e?1:0}function Bl(n,e){return-1*pj(n,e)}function vo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function mj(n){if(n==null)throw new J(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Ti(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new J(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Fg(n,e,t=0,s=1/0){return Rr(t>=0),Rr(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Gn(n,e){Array.isArray(n)?(R(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Gn(t,`element ${s+1} of ${e}`))):R(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${u1(n)}.`)}function u1(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>u1(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function gj(n,e,t){let s=t!=null?t():ms(),r;return(...i)=>{const a=t!=null?t():ms();return a-s<e||(s=a,r=n(...i)),r}}function d1(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let xj=0;function h1(){return xj++}const Vl={};function Ch(n=""){return n in Vl||(Vl[n]=0),Vl[n]+=1,n+Vl[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const yj=["channelsFirst","channelsLast"],bj=["nearest","bilinear"],wj=["valid","same","causal"],vj=["max","avg"],Sj=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Oi=new Map;function An(n){Ti(yj,"DataFormat",n)}function Cj(n){Ti(bj,"InterpolationFormat",n)}function Bs(n){Ti(wj,"PaddingMode",n)}function f1(n){Ti(vj,"PoolMode",n)}const sc=[],Wx="/";function si(n,e){sc.push(n);try{const t=e();return sc.pop(),t}catch(t){throw sc.pop(),t}}function Nj(){return sc.length===0?"":sc.join(Wx)+Wx}function p1(n){if(!g1(n))throw new Error("Not a valid tensor name: '"+n+"'");return Nj()+n}function m1(n){if(!g1(n))throw new Error("Not a valid tensor name: '"+n+"'");Oi.has(n)||Oi.set(n,0);const e=Oi.get(n);if(Oi.set(n,Oi.get(n)+1),e>0){const t=`${n}_${e}`;return Oi.set(t,1),t}else return n}const Ij=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function g1(n){return!!n.match(Ij)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kj(n){return n===parseInt(n.toString(),10)}function So(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function ha(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function $o(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function br(n,e){if(e<n)throw new J(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let lf;function jn(){return lf==null&&(lf=n2().epsilon()),lf}function wr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lr(n,e){return et(n,e)}function Il(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ne(n,t)}function $j(n,e){return ae(()=>{if(n.shape.length!==2)throw new J(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Il(n,1);return ip(t,[1,e,1])})}function Tj(n){const e=[So(n.shape)];return ne(n,e)}function Aj(n){if(n.rank<=1)throw new J(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],So(n.shape,1)];return ne(n,e)}function ri(n,e,t){return ae(()=>{switch(n.rank){case 1:return Xm(n,e,t);case 2:return hv(n,[e,0],[t,n.shape[1]]);case 3:return Jm(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return ku(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return hn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return hn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new J(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function uf(n,e,t){return ae(()=>{switch(n.rank){case 1:return Xm(n,e,t);case 2:return hv(n,[0,e],[n.shape[0],t]);case 3:return Jm(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return ku(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new J(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Ul(n,e,t,s){return ae(()=>{switch(n.rank){case 1:return Xm(n,e,t);case 2:switch(s){case 1:return ri(n,e,t);case 2:return uf(n,e,t);default:throw new J(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return ri(n,e,t);case 2:return Jm(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return uf(n,e,t);default:throw new J(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return ri(n,e,t);case 2:return ku(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return ku(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return uf(n,e,t);default:throw new J(`The axis is not within the rank of the tensor ${s}`)}default:throw new J(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Og(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),ys(n,e)}function Bx(n,e){switch(n.rank){case 1:return MT([n,e]);case 2:return OT([n,e],0);case 3:return zT([n,e],0);case 4:return BT([n,e],0);default:throw new J(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function ip(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new J(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return mr(n,e)}function Nh(n,e=0,t=1,s,r){return JE(n,e,t,s,r)}function zr(n,e,t,s){if(n.rank<2||e.rank<2)throw new Mt(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new Mt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return kx({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?ap(n.rank,s,wr()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=ne(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),c=i.pop(),l=[...i,a],d=Array.from({length:e.rank},(m,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=ne(qt(e,d),[c,-1]);const h=[...r,...l];return ne(kx({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?ap(n.rank,s,wr()):null,activation:t}),h)}}function x1(n,e,t){return ae(()=>(Array.isArray(e)?e=Rs(e,"int32"):e=et(e,"int32"),Pm(n,e,t)))}function kl(n){return Y(n,n)}function ap(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new J(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ne(e,[1,s[0],1,1,1]):ne(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ne(e,[1,1,1,1,s[0]]):ne(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ne(e,[1,s[0],1,1]):ne(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ne(e,[1,1,1,s[0]]):ne(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ne(e,[1,s[0],1]):ne(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ne(e,[1,1,s[0]]):ne(e,[1].concat(s))}else if(n<3)return e;throw new J(`Unsupported input rank by biasAdd: ${e.rank}`)}function Cr(n,e,t){return ae(()=>(t==null&&(t=wr()),An(t),ze(n,ap(n.rank,e,t))))}function Ej(n,e=1){if(e!==1)throw new Mt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return gh(n)}function Rj(n){return ae(()=>xt(n,ze(as(n),1)))}function y1(n,e,t,s){return ae(()=>HR(n,e,t,s))}function Dj(n){return ae(()=>{const e=ze(.5,Y(.2,n));return zs(e,0,1)})}function $l(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _j=["fanIn","fanOut","fanAvg"],Pj=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jj(n){Ti(_j,"FanMode",n)}function Mj(n){Ti(Pj,"Distribution",n)}class rr extends $a{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class b1 extends rr{apply(e,t){return Vn(e,t)}}b1.className="Zeros";je(b1);class Lg extends rr{apply(e,t){return Oo(e,t)}}Lg.className="Ones";je(Lg);class w1 extends rr{constructor(e){if(super(),typeof e!="object")throw new J(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new J(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ae(()=>Y(tn(this.value),Oo(e,t)))}getConfig(){return{value:this.value}}}w1.className="Constant";je(w1);class v1 extends rr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return yl(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}v1.className="RandomUniform";je(v1);class S1 extends rr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Mt(`randomNormal does not support dType ${t}.`);return Nh(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}S1.className="RandomNormal";je(S1);class C1 extends rr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Mt(`truncatedNormal does not support dType ${t}.`);return mv(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}C1.className="TruncatedNormal";je(C1);class N1 extends rr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ae(()=>{if(e.length!==2||e[0]!==e[1])throw new J("Identity matrix initializer can only be used for 2D square matrices.");return Y(this.gain,Jw(e[0]))})}getConfig(){return{gain:this.gain}}}N1.className="Identity";je(N1);function Fj(n,e="channelsLast"){let t,s;if(An(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=So(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=So(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=So(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class _s extends rr{constructor(e){if(super(),e.scale<0)throw new J(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,jj(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Mj(this.distribution),this.seed=e.seed}apply(e,t){const s=Fj(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Mt(`${this.getClassName()} does not support dType ${t}.`);return mv(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return yl(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}_s.className="VarianceScaling";je(_s);class zg extends _s{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return _s.className}}zg.className="GlorotUniform";je(zg);class Wg extends _s{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return _s.className}}Wg.className="GlorotNormal";je(Wg);class Bg extends _s{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return _s.className}}Bg.className="HeNormal";je(Bg);class Vg extends _s{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return _s.className}}Vg.className="HeUniform";je(Vg);class Ug extends _s{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return _s.className}}Ug.className="LeCunNormal";je(Ug);class Gg extends _s{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return _s.className}}Gg.className="LeCunUniform";je(Gg);class I1 extends rr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ae(()=>{if(e.length<2)throw new Mt("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=Ce(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=Nh(i,0,1,t,this.seed),c=BD.qr(a,!1);let l=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return l=Y(l,h.sign()),s<r&&(l=l.transpose()),Y(tn(this.gain),l.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}I1.className="Orthogonal";je(I1);const Vx={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ux(n,e={}){return Nl(n,Qs.getMap().classNameMap,e,"initializer")}function vn(n){return Mg(n)}function yn(n){if(typeof n=="string"){const e=n in Vx?Vx[n]:n;if(e==="GlorotNormal")return new Wg;if(e==="GlorotUniform")return new zg;if(e==="HeNormal")return new Bg;if(e==="HeUniform")return new Vg;if(e==="LeCunNormal")return new Ug;if(e==="LeCunUniform")return new Gg;{const t={};return t.className=e,t.config={},Ux(t)}}else return n instanceof rr?n:Ux(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cp(n){return Array.isArray(n)&&Array.isArray(n[0])}function $u(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function It(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new J(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Yt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new J(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Tu(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Gx="Variable";class Oj{constructor(e,t="float32",s=Gx,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=h1(),s=s??Gx,this.originalName=p1(s),this.name=m1(this.originalName),this.trainable_=r,this.constraint=o,this.val=BR(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Lj(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Lj(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function lp(n){return n.map(e=>e.read())}function Hg(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Mn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Hr{constructor(e,t,s,r,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=h1(),i!=null&&(this.originalName=p1(i),this.name=m1(this.originalName)),this.rank=t.length}}let zj=0;class Ih{constructor(e,t){this.callArgs=t,this.id=zj++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Wj=0;class Bt extends $a{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Wj++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Xr(s)+"_"+Ch(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Zs(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new J(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return xs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return xs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Er(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Er(`Layer ${this.name} is not connected, no input to return.`);return xs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Er(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Er(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return xs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=rn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=rn(this.inputSpec);if(t.length!==s.length)throw new J(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new J(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const c=o.shape;for(const l in i.axes){const d=Number(l),h=i.axes[l],f=d>=0?c[d]:c[c.length+d];if(h!=null&&[h,null].indexOf(f)===-1)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${h} but got shape ${c}.`)}}if(i.shape!=null)for(let c=0;c<i.shape.length;++c){const l=i.shape[c],d=o.shape[c];if(l!=null&&d!=null&&l!==d)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=rn(e),r=Uj(e),o=Gj(e);if(r===o)throw new J("Arguments to apply() must be all SymbolicTensors or all Tensors");return si(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of rn(e))i.push(a.shape);this.build(xs(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=rn(i),c=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(i=xs(c),this.activityRegularizer!=null)throw new Mt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=Bj(e),a=this.computeOutputShape(i);let c;const l=Vj(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((d,h)=>new Hr(l,d,this,rn(e),t,this.name,h)):c=new Hr(l,a,this,rn(e),t,this.name),this.addInboundNode(e,c,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new Mt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Er(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Er(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Zs(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Tu(this.weights)}build(e){this.built=!0}getWeights(e=!1){return lp(e?this.trainableWeights:this.weights)}setWeights(e){ae(()=>{const t=this.weights;if(t.length!==e.length)throw new J(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=lp(t);for(let o=0;o<r.length;++o){const i=r[o],a=t[o],c=e[o];if(!nn(i.shape,c.shape))throw new J(`Layer weight shape ${i.shape} not compatible with provided weight shape ${c.shape}`);s.push([a,c])}Hg(s)})}addWeight(e,t,s,r,o,i,a,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new J(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():yn("zeros"));const l=r.apply(t,s),d=new Oj(l,s,e,i,a);return l.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=rn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=rn(t),i=rn(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,s,r,o,i,a=null){const c=rn(e);t=rn(t),s=rn(s),r=rn(r),o=$u(o),i=$u(i);const l=[],d=[],h=[];for(const f of c)l.push(f.sourceLayer),d.push(f.nodeIndex),h.push(f.tensorIndex);new Ih({outboundLayer:this,inboundLayers:l,nodeIndices:d,tensorIndices:h,inputTensors:c,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function Bj(n){n=rn(n);const e=[];for(const t of n)e.push(t.shape);return xs(e)}function Vj(n){return"float32"}function k1(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],c=s.nodeIndices[o],l=k1(i,a,c);for(const d of l)r.indexOf(d)===-1&&r.push(d)}return r}}}function Uj(n){let e=!0;for(const t of rn(n))if(!(t instanceof Hr)){e=!1;break}return e}function Gj(n){let e=!0;for(const t of rn(n))if(t instanceof Hr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Tl extends Bt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Ch("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new J("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new J("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new J("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Hr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Ih({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new J(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Tl.className="InputLayer";je(Tl);function Hj(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new J("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Tl({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qj(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return et(e,n.dtype)}catch{throw new J(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class xo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof xo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=qj(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new J(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Hr){if(this.id2Value[e.id]==null)throw new J(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new J(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Hr){if(this.id2Value[e.id]==null)throw new J(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new J(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Ft(this.id2Mask)}}const Au=new l1,Eu=new l1;function Kj(n){Au!=null&&Au.setMaxEntries(n),Eu!=null&&Eu.setMaxEntries(n)}function qa(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(m=>m.name),c=[],l=e.names();for(const m of a)l.indexOf(m)!==-1?c.push(e.getValue(m)):c.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let h=Au.get(d),f;if(h==null){const m=Qj(i,e);h=m.sorted,f=m.recipientCounts,Au.put(d,h),Eu.put(d,f)}f={},r||Object.assign(f,Eu.get(d));const p=new xo(e);for(let m=0;m<h.length;++m){const g=h[m],x=g.sourceLayer;if(x instanceof Tl)continue;const y=[],b=[],v=[];let w=!1;for(const $ of g.inputs){const N=p.getValue($),_=p.getMask($);y.push(N),b.push(_),_!=null&&(w=!0),r||(f[$.name]--,f[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!N.isDisposed&&$.sourceLayer.stateful!==!0&&v.push(N))}w&&(t=t||{},t.mask=b[0]);const S=rn(x.apply(y,t));let I=null;x.supportsMasking&&(I=x.computeMask(y,b));const C=Jj(g),k=Array.isArray(C)?C:[C];for(let $=0;$<k.length;++$){p.hasKey(k[$])||p.add(k[$],S[$],Array.isArray(I)?I[0]:I);const N=a.indexOf(k[$].name);N!==-1&&(c[N]=S[$])}r||Ft(v)}return p.disposeMasks(),o?c:c[0]}function Qj(n,e){R(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=Hx(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=Hx(o,e);for(const c of i)r.has(c.name)||(t.push(c),r.add(c.name));for(const c in a)s[c]==null&&(s[c]=new Set),a[c].forEach(l=>s[c].add(l))}}return{sorted:t,recipientCounts:Xj(s)}}function Xj(n){const e={};for(const t in n)e[t]=n[t].size;return e}function Hx(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const c=i[i.length-1]===o.length-1;if(a.inputs.length===0||c)o.pop(),s.push(a),t.add(a.name),c&&i.pop();else{i.push(o.length-1);for(const l of a.inputs)r[l.name]==null&&(r[l.name]=new Set),r[l.name].add(a.name),!t.has(l.name)&&o.push(l)}}return{sorted:s,recipientMap:r}}function Jj(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj=pe();Yj.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Kj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qg(n,e){return ae(()=>ns(gt(Y(n,n),e,!0)))}class Al extends $a{getConfig(){return{}}}class $1 extends Al{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>{const t=qg(e,this.axis),s=zs(t,0,this.maxValue);return Y(e,xt(s,ze(jn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}$1.className="MaxNorm";je($1);class T1 extends Al{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>xt(e,ze(jn(),qg(e,this.axis))))}getConfig(){return{axis:this.axis}}}T1.className="UnitNorm";je(T1);class A1 extends Al{apply(e){return ki(e)}}A1.className="NonNeg";je(A1);class E1 extends Al{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ae(()=>{const t=qg(e,this.axis),s=ze(Y(this.rate,zs(t,this.minValue,this.maxValue)),Y(1-this.rate,t));return Y(e,xt(s,ze(jn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}E1.className="MinMaxNorm";je(E1);const qx={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Fn(n){return Mg(n)}function Kx(n,e={}){return Nl(n,Qs.getMap().classNameMap,e,"constraint")}function On(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in qx?qx[n]:n,config:{}};return Kx(t)}else return n instanceof Al?n:Kx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Uo(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Ft(s)}}function R1(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Qx;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(Qx||(Qx={}));const Zj=125;class uc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class eM{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class tM extends uc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=ae(()=>ze(this.totals[r],Y(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ae(()=>{const r=Y(xt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Fr(t[s])}))}}class nM extends uc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const c=i[a];e.push(c.data()),t.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class sM extends uc{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Mv,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Zj),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Ff(this.yieldEvery)&&(this.maybeWait=gj(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Uo(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Uo(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Uo(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Uo(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Uo(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Ff(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Uo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Uo(e),await this.trainEnd(e))}}function D1(n,e){return n==null&&(n={}),n instanceof uc?[n]:Array.isArray(n)&&n[0]instanceof uc?n:rn(n).map(s=>new sM(s,e))}class Ks{constructor(){}static registerCallbackConstructor(e,t){R(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Ks.checkForDuplicate(t),Ks.constructors[e]==null&&(Ks.constructors[e]=[]),Ks.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Ks.constructors)Ks.constructors[+t].forEach(r=>{if(r===e)throw new J("Duplicate callback constructor.")})}static clear(){Ks.constructors={}}static createCallbacks(e){const t=[];for(const s in Ks.constructors){const r=+s;e>=r&&t.push(...Ks.constructors[r])}return t.map(s=>new s)}}Ks.constructors={};function _1(n,e,t,s,r,o,i,a,c){const l=new nM,d=[new tM,...Ks.createCallbacks(e)];n!=null&&d.push(...n),d.push(l);const h=new eM(d);return h.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:c}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wr(n,e={},t=!1){return Nl(n,Qs.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ru(n,e){return ae(()=>{n.dtype!=="float32"&&(n=et(n,"float32"));const t=gt(kl(n),e,!0),s=mh(t.shape,jn()),r=ns(Fo(t,s));return xt(n,r)})}function kh(n,e){return ae(()=>Rn(kl(Nt(e,n)),-1))}function Kg(n,e){return ae(()=>Rn(as(Nt(e,n)),-1))}function Qg(n,e){return ae(()=>{const t=Nt(n,e),s=zs(as(n),jn(),Number.MAX_VALUE),r=as(xt(t,s));return Y(100,Rn(r,-1))})}function rM(n,e){return ae(()=>{const t=zs(e,jn(),Number.MAX_VALUE),s=Gr(ze(1,t)),r=zs(n,jn(),Number.MAX_VALUE),o=Gr(ze(1,r));return Rn(kl(Nt(s,o)),-1)})}function oM(n,e){return ae(()=>{const t=Fo(0,Nt(1,Y(n,e)));return Rn(kl(t),-1)})}function iM(n,e){return ae(()=>{const t=Fo(0,Nt(1,Y(n,e)));return Rn(t,-1)})}function aM(n,e){return ae(()=>{const t=gt(Y(n,e),-1),s=xr(Y(Nt(1,n),e),-1);return Fo(0,ze(1,Nt(s,t)))})}function cM(n,e){return ae(()=>{const t=Math.log(2),s=Nt(e,n),r=Nt(ze(s,xl(Y(-2,s))),t);return Rn(r,-1)})}function dc(n,e,t=!1){return ae(()=>{if(t)e=Ym(e);else{const s=gt(e,e.shape.length-1,!0);e=xt(e,s)}return e=zs(e,jn(),1-jn()),kn(gt(Y(et(n,"float32"),Gr(e)),e.shape.length-1))})}function Du(n,e,t=!1){return ae(()=>{const s=et(yh(Tj(n)),"int32");e=zs(e,jn(),1-jn());const r=e.shape,o=ne(nv(s,r[r.length-1]),r);return dc(o,e,t)})}function lM(n,e){if(!nn(n.shape,e.shape))throw new J(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ae(()=>{const t=ki(e),s=kn(as(e));return ze(Nt(t,Y(e,n)),Yw(Ur(s)))})}function $h(n,e){return ae(()=>{let t;return t=zs(e,jn(),1-jn()),t=Gr(xt(t,Nt(1,t))),Rn(lM(n,t),-1)})}function uM(n,e){return ae(()=>{const t=zs(n,jn(),1),s=zs(e,jn(),1);return gt(Y(n,Gr(xt(t,s))),-1)})}function dM(n,e){return ae(()=>{const t=Gr(ze(jn(),e));return Rn(Nt(e,Y(n,t)),-1)})}function P1(n,e){return ae(()=>{const t=Ru(n,-1),s=Ru(e,-1),r=Y(t,s);return kn(gt(r,-1))})}const _u={meanSquaredError:kh,meanAbsoluteError:Kg,meanAbsolutePercentageError:Qg,meanSquaredLogarithmicError:rM,squaredHinge:oM,hinge:iM,categoricalHinge:aM,logcosh:cM,categoricalCrossentropy:dc,sparseCategoricalCrossentropy:Du,binaryCrossentropy:$h,kullbackLeiblerDivergence:uM,poisson:dM,cosineProximity:P1};function df(n){if(typeof n=="string"){if(n in _u)return _u[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new J(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function j1(n,e){return ae(()=>{const t=Y(.5,nr(e)),s=Lr(Ws(e,t),n.dtype);return Rn(Vr(n,s),-1)})}function M1(n,e){return ae(()=>Lr(Vr(oc(n,-1),oc(e,-1)),"float32"))}function hM(n,e){return ae(()=>et(gt(to(Vr(n,1),Vr(e,1))),"float32"))}function fM(n,e){return ae(()=>et(gt(to(Vr(n,0),Vr(e,1))),"float32"))}function pM(n,e){return ae(()=>{const t=hM(n,e),s=fM(n,e),r=ze(t,s);return et(ds(Ws(r,0),xt(t,r),0),"float32")})}function mM(n,e){return $h(n,e)}function gM(n,e){return n.rank===e.rank&&(n=bl(n,[n.rank-1])),e=oc(e,-1),e.dtype!==n.dtype&&(e=et(e,n.dtype)),et(Vr(n,e),"float32")}const xM=kh,yM=kh,bM=Kg,wM=Kg,vM=Qg,SM=Qg,F1=dc,CM=P1,O1=Du,Pu={binaryAccuracy:j1,categoricalAccuracy:M1,precision:pM,categoricalCrossentropy:F1,sparseCategoricalCrossentropy:O1,mse:xM,MSE:yM,mae:bM,MAE:wM,mape:vM,MAPE:SM,cosine:CM};function NM(n){if(typeof n=="string"&&n in Pu)return Pu[n];if(typeof n!="string"&&n!=null)return n;throw new J(`Unknown metric ${n}`)}function Gl(n){if(Rr(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(_u))if(_u[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Pu))if(Pu[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function IM(n){const e={Adagrad:()=>qo.adagrad(.01),Adadelta:()=>qo.adadelta(1,.95,jn()),Adam:()=>qo.adam(.001,.9,.999,jn()),Adamax:()=>qo.adamax(.002,.9,.999,jn(),0),RMSProp:()=>qo.rmsprop(.001,.9,0,jn()),SGD:()=>qo.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new J(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xx=1*1024*1024;function Jx(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!up(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>Xx&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Xx}.`)}}function up(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!up(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!up(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kM(n,e,t,s=console.log){const r=TM(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),ju(o,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?AM(a[d],t,s):EM(a[d],t,i,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const c=$M(n),l=Tu(n.nonTrainableWeights);s(`Total params: ${c+l}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${l}`),s("_".repeat(e))}function $M(n){let e;return n.collectedTrainableWeights!=null?e=Tu(n.collectedTrainableWeights):e=Tu(n.trainableWeights),e}function TM(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function ju(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function AM(n,e,t){let s,r;try{r=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];ju(a,e,t)}function EM(n,e,t,s){let r,o;try{o=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const h of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(h)===-1))for(let f=0;f<h.inboundLayers.length;++f){const p=h.inboundLayers[f].name,m=h.nodeIndices[f],g=h.tensorIndices[f];i.push(`${p}[${m}][${g}]`)}const a=n.name,c=n.getClassName(),l=i.length===0?"":i[0],d=[`${a} (${c})`,o,r,n.countParams().toString(),l];ju(d,e,s);for(let h=1;h<i.length;++h)ju(["","","","",i[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function L1(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Mu(n,e){if(n===null)return null;if(typeof n=="string")return Qo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];L1(e,r,o)?t.push(o):t.push(Mu(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=Qo(s);t[o]=Mu(r,o)}}return t}}function dp(n,e){if(n==null)return null;if(typeof n=="string")return Xr(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];L1(e,r,o)?t.push(o):t.push(dp(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=Xr(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=dp(r,s)}return t}}/** @license See the LICENSE file. */const z1="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const RM=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class ur extends Bt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=Ch(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],vo(this.inputs).length!==this.inputs.length)throw new J(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);vo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const v=b.sourceLayer,w=b.nodeIndex,S=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(S)}for(const b of this.inputs){const v=b.sourceLayer,w=b.nodeIndex,S=b.tensorIndex;Rr(w===0,"input layer has >1 nodes"),Rr(S===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const v=this.inputLayers[b];if(!(v instanceof Tl))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const t={},s={},r={},o={},i={},a=[],c=(b,v,w,S,I,C)=>{(S==null||I==null||C==null)&&(S=b.sourceLayer,I=b.nodeIndex,C=b.tensorIndex);const k=S.inboundNodes[I];if(w.indexOf(k)!==-1)throw new Zs(`The tensor ${b.name} at layer "${S.name}" is part of a cycle.`);if(v.indexOf(k)!==-1)return;this.containerNodes.add(ur.nodeKey(S,I)),S.id in i||(i[S.id]=Object.keys(i).length),w.indexOf(k)===-1&&w.push(k);const $=k.inboundLayers.length;for(let N=0;N<$;N++){const _=k.inputTensors[N],P=k.inboundLayers[N],j=k.nodeIndices[N],A=k.tensorIndices[N];c(_,v,w,P,j,A)}for(v.push(k);w.indexOf(k)>=0;)w.splice(w.indexOf(k),1);a.push(k)},l=[],d=[];for(const b of this.outputs)c(b,l,d);const h=a.slice().reverse();for(const b of h){s[b.id]=b,b.id in t||(t[b.id]=0);let v=t[b.id];const w=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];v=Math.max(v,w),r[b.outboundLayer.id]=v,o[b.outboundLayer.id]=b.outboundLayer,t[b.id]=v;for(let S=0;S<b.inboundLayers.length;S++){const I=b.inboundLayers[S],C=b.nodeIndices[S],k=I.inboundNodes[C],$=t[k.id]==null?0:t[k.id];t[k.id]=Math.max(v+1,$),s[k.id]=k}}const f={};for(const b in t){const v=t[b];v in f||(f[v]=[]),f[v].push(s[b])}const p={};for(const b in r){const v=r[b];v in p||(p[v]=[]),p[v].push(o[b])}let m=Object.keys(p).map(b=>parseInt(b,10)).sort(Bl);this.layers=[];for(const b of m){const v=p[b];v.sort((w,S)=>{const I=i[w.id],C=i[S.id];return I<C?-1:I>C?1:0});for(const w of v)w instanceof ur&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=p,m=Object.keys(f).map(b=>parseInt(b,10)).sort(Bl);const g=this.inputs.slice(),x=[];for(const b of m)for(const v of f[b]){const w=v.outboundLayer;if(w!=null){for(const S of v.inputTensors)if(g.indexOf(S)===-1)throw new Zs(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${w.name}". The following previous layers were accessed without issue: ${x}`);for(const S of v.outputTensors)g.push(S);x.push(w.name)}}this.nodesByDepth=f;const y=this.layers.map(b=>b.name);for(const b of y){const v=y.filter(w=>w===b).length;if(v!==1)throw new Zs(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Ih({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new J("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=RM(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[c,l]of a.weights.entries()){const d=o?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(s[d]!=null)throw new J(`Duplicate weight name: ${d}`);s[d]=l,r++}const i=[];for(const a in e){let c=a;if(s[a]==null){const l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[c]!=null)i.push([s[c],e[a]]);else if(t)throw new J(`Provided weight data has no target variable: ${a}`);delete s[c]}if(t){const a=[];for(const c in s)a.push(c);if(a.length>0)throw new J(`${a.length} of ${r} weights are not set: ${a}`)}Hg(i)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${z1}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=dp(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ae(()=>{e=rn(e);const s=new xo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return qa(this.outputs,s,t)})}computeMask(e,t){return ae(()=>{e=rn(e);let s;return t==null?s=xi(null,e.length):s=rn(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=$u(e);if(t.length!==this.inputLayers.length)throw new J(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const c=this.inputLayers[a],l=t[a],d=c.name+"_0_0";s[d]=l}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Bl);if(r.length>1)for(const a of r){const c=this.nodesByDepth[a];for(const l of c){const d=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(d.id)!==-1)continue;const h=[];for(let g=0;g<l.inboundLayers.length;g++){const x=l.inboundLayers[g],y=l.nodeIndices[g],b=l.tensorIndices[g],v=`${x.name}_${y}_${b}`,w=s[v];h.push(w)}const f=d.computeOutputShape(xs(h)),p=$u(f),m=d.inboundNodes.indexOf(l);for(let g=0;g<p.length;g++){const x=`${d.name}_${m}_${g}`;s[x]=p[g]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],h=`${c.name}_${l}_${d}`;i.push(h)}for(let a=0;a<i.length;a++){const c=i[a];Rr(c in s),o.push(s[c])}return xs(o)}runInternalGraph(e,t){t==null&&(t=xi(null,e.length));const s={};for(let c=0;c<this.inputs.length;++c){const l=this.inputs[c],d=e[c],h=t[c];s[l.id]=[d,h]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Bl);for(const c of r){const l=this.nodesByDepth[c];for(const d of l){const h=d.outboundLayer,f=d.inputTensors,p=d.outputTensors,m=new Array;for(const g of f)g.id in s&&m.push(s[g.id]);if(m.length===f.length){let g={},x,y,b,v;if(d.callArgs!=null&&(g=d.callArgs),m.length===1){const[w,S]=m[0];g.mask==null&&(g.mask=S),b=rn(h.call(w,g)),v=rn(h.computeMask(w,S)),x=[w],y=[S]}else x=m.map(w=>w[0]),y=m.map(w=>w[1]),g.mask==null&&(g.mask=y),b=rn(h.call(x,g)),v=rn(h.computeMask(x,y));if(h.activityRegularizer)throw new Mt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<p.length;++w){const S=p[w],I=b[w],C=v[w];s[S.id]=[I,C]}}}}const o=[],i=[],a=[];for(const c of this.outputs){Rr(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[l,d]=s[c.id];a.push(l.shape),o.push(l),i.push(d)}return[o,i,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof ur?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=ur.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new J("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new J(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new J(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ae(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=ur.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),c=i.getConfig(),l=[];for(let h=0;h<i.inboundNodes.length;h++){const f=i.inboundNodes[h],p=ur.nodeKey(i,h);let m={};if(this.containerNodes.has(p)){if(f.callArgs)try{JSON.stringify(f.callArgs),m=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(f.inboundLayers.length>0){const g=[];for(let x=0;x<f.inboundLayers.length;x++){const y=f.inboundLayers[x],b=f.nodeIndices[x],v=f.tensorIndices[x],w=ur.nodeKey(y,b);let S=t[w];S==null&&(S=0),g.push([y.name,S,v,m])}l.push(g)}}}const d={};d.name=i.name,d.className=a,d.config=c,d.inboundNodes=l,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],c=this.inputLayersNodeIndices[i],l=ur.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.inputLayersTensorIndices[i];r.push([a.name,d,h])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],c=this.outputLayersNodeIndices[i],l=ur.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.outputLayersTensorIndices[i];o.push([a.name,d,h])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function a(x,y){x.name in i?i[x.name].push(y):i[x.name]=[y]}function c(x,y){const b=[];let v;for(const w of y){const S=w[0],I=w[1],C=w[2];if(v=w[3]==null?{}:w[3],!(S in o)){a(x,y);return}const k=o[S];if(k.inboundNodes.length<=I){a(x,y);return}const $=k.inboundNodes[I];b.push($.outputTensors[C])}b.length>0&&x.apply(xs(b),v)}function l(x){const y=x.name,b=Wr(x,t.customObjects!=null?t.customObjects:{});b.setFastWeightInitDuringBuild(r),o[y]=b,x.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new J(`Corrupted configuration, expected array for nodeData: ${w}`);a(b,w)})}const d=t.name,h=t.layers;for(const x of h)l(x);for(;!mj(i);)for(const x of h){const y=o[x.name];if(y.name in i){const b=i[y.name];delete i[y.name];for(const v of b)c(y,v)}}const f=[],p=[],m=t.inputLayers;for(const x of m){const y=x[0],b=x[1],v=x[2];Rr(y in o);const S=o[y].inboundNodes[b].outputTensors;f.push(S[v])}const g=t.outputLayers;for(const x of g){const y=x[0],b=x[1],v=x[2];Rr(y in o);const S=o[y].inboundNodes[b].outputTensors;p.push(S[v])}return new e({inputs:f,outputs:p,name:d})}get stateful(){if(this._stateful)throw new J("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ae(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DM(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function W1(n,e){return DM(n,e,"classWeight")}async function B1(n,e,t,s){if(t!=null){const r=ae(()=>{if(n.shape.length===1)return ni(n);if(n.shape.length===2){if(n.shape[1]>1)return oc(n,1);if(n.shape[1]===1)return ne(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Ft(r);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Rs(i,"float32")}else return null}function _M(n,e){return Y(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const PM=32;function V1(n,e){let t,s;const r=e;t=r.xs,s=r.ys,R(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=Yx("input",n.inputNames,t),i=Yx("output",n.outputNames,s),a=o[0].shape[0];R(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),R(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<o.length;c++)R(o[c].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${o[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let c=0;c<i.length;c++)R(i[c].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${i[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function Yx(n,e,t){if(t instanceof Pn)return[t];if(Array.isArray(t))return R(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new J(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function jM(n){if(n.length===3)throw new Mt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function MM(n,e,t){const s=t.batchesPerEpoch!=null;if(R(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),R(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),R(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),R(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),R(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(Zx(t.validationData))R(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=jM(t.validationData);o=x.xs,i=x.ys}const a=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let l;r?l=c.slice().concat(c.map(x=>"val_"+x)):l=c.slice();const d=D1(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,{callbackList:f,history:p}=_1(d,h,t.epochs,null,null,FM(e,t),null,r,l);f.setModel(n),n.history=p,await f.onTrainBegin(),n.stopTraining_=!1;let m=t.initialEpoch==null?0:t.initialEpoch,g=await e.iterator();for(;m<t.epochs;){const x={};await f.onEpochBegin(m);let y=0,b=0;for(s||(g=await e.iterator());!s||y<t.batchesPerEpoch;){const v=await g.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:w,ys:S}=V1(n,v.value),I={};I.batch=b,I.size=w[0].shape[0],await f.onBatchBegin(b,I);const C=[];if(t.classWeight!=null){const N=W1(t.classWeight,n.outputNames);for(let _=0;_<N.length;++_)C.push(await B1(S[_],null,N[_]))}const k=w.concat(S).concat(C),$=a(k);Ft(k);for(let N=0;N<c.length;++N){const _=c[N],P=$[N];I[_]=P,Fr(P)}await f.onBatchEnd(b,I),R1(I),b++,y++}if(s?y>=t.batchesPerEpoch:v.done){if(r){let w;Zx(t.validationData)?w=rn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):w=rn(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?PM:t.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)x[`val_${n.metricsNames[S]}`]=w[S]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(m,x),m++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function FM(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function Zx(n){return typeof n.iterator=="function"}function OM(n){return typeof n.next=="function"}async function LM(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new Mt("Verbose mode is not implemented yet.");R(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=OM(e)?e:await e.iterator();let a=0,c=0;for(;!s||c<t.batches;){const l=await i.next();if(o=ae(()=>{if(l.value){const{xs:d,ys:h}=V1(n,l.value),f=d.concat(h),p=ae(()=>r(f));if(Ft(f),c===0)for(let g=0;g<p.length;++g)o.push(tn(0));const m=f[0].shape[0];for(let g=0;g<p.length;++g){const x=p[g],y=o[g];o[g]=ae(()=>ze(o[g],Y(m,x))),c>0&&Ft(y)}Ft(p),a+=m,++c}return o}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<o.length;++l){const d=o[l];o[l]=xt(o[l],a),Ft(d)}return xs(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hf(n){R(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function za(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>ri(s,e,t-e)):ri(n,e,t-e)}function hp(n,e){return ae(()=>n==null?null:Array.isArray(n)?n.map(t=>hp(t,e)):x1(n,e.dtype==="int32"?e:et(e,"int32")))}function ff(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function U1(n){const e=[];n instanceof Pn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Il(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function cr(n,e){if(n==null)return;const t=[];if(e instanceof Pn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof Pn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zM(n){return n instanceof Pn}function fp(n){return Array.isArray(n)}function ey(n){return!zM(n)&&!fp(n)}function ty(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(fp(n)&&n.length>0)i=!0;else if(ey(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new J(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(ey(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new J(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(fp(n)){if(n=n,n.length!==e.length)throw new J(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new J(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=U1(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new J(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d>=0&&l!==d)throw new J(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function WM(n,e,t){const s=vo(n.map(o=>o.shape[0]));s.sort();const r=vo(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new J(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new J(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!nn(s,r))throw new J(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function BM(n,e,t){const s=[kh,$h,dc];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],a=t[r];if(i!=null){if(i===dc&&o.shape[o.shape.length-1]===1)throw new J(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const c=o.shape.slice(1),l=a.slice(1);for(let d=0;d<c.length;++d){const h=c[d],f=l[d];if(f!=null&&h!==f)throw new J(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function ny(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new J(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new J(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new J(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d!==l)throw new J(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function VM(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const UM="layers-model";class ta extends ur{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new J("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");kM(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=IM(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Lo))throw new J("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new J(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(df(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new J(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>df(a))}else{const i=df(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],c=this.outputNames[i];this.feedOutputNames.push(c),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],si("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=VM(e.metrics,this.outputNames),o=(i,a,c)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([c,i])};si("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(l=>{const d="";let h,f,p;for(const m of l){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===$h?["accuracy","acc"].indexOf(m)!==-1?f=j1:["crossentropy","ce"].indexOf(m)!==-1&&(f=mM):this.lossFunctions[i]===Du?["accuracy","acc"].indexOf(m)!==-1?f=gM:["crossentropy","ce"].indexOf(m)!==-1&&(f=O1):["accuracy","acc"].indexOf(m)!==-1?f=M1:["crossentropy","ce"].indexOf(m)!==-1&&(f=F1);let y;["accuracy","acc"].indexOf(m)!==-1?y="acc":["crossentropy","ce"].indexOf(m)!==-1&&(y="ce"),p=f,h=d+y}else p=NM(m),h=d+Gl(m);let g;si(h,()=>{g=p}),o(i,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;hf(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const c=this.testFunction,l=this.testLoop(c,a,r,s.verbose,s.steps);return xs(l)}finally{cr(i[0],e),cr(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),LM(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new J(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new J(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new J("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new xo;if(e instanceof Pn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new J(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)i.add(this.inputs[c],e[c])}else for(const c of this.inputs){const l=e[c.name];if(l==null)throw new J(`No value is provided for the model's input ${c.name}`);i.add(c,l)}const a=qa(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const t=xi(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const c=i.indexOf(e[a]);if(c!==-1&&(t[a]=o[c],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new J(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ae(()=>{const r=this.checkNumSamples(e);if(s)throw new Mt("Verbose predictLoop() is not implemented yet.");const o=ff(r,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ae(()=>{const l=o[a][0],d=o[a][1],h=za(e,l,d),f=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)f.push({key:this.inputs[m],value:h[m]});else f.push({key:this.inputs[0],value:h});const p=new xo(f);return qa(this.outputs,p)}).forEach((l,d)=>i[d].push(l));return xs(i.map(a=>ys(a,0)))})}predict(e,t={}){const s=U1(e);ny(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return hf(r),this.predictLoop(s,r)}finally{cr(s,e)}}predictOnBatch(e){ny(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Zs("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Du?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=ty(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=ty(t,this.feedOutputNames,o,!1,"target"),WM(e,t),BM(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new J(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[a,c]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){const d=W1(r,this.outputNames);l=[];for(let h=0;h<d.length;++h)l.push(await B1(c[h],null,d[h]))}return[a,c,l]}testLoop(e,t,s,r=0,o){return ae(()=>{const i=this.checkNumSamples(t,s,o,"steps"),a=[];if(r>0)throw new Mt("Verbose mode is not implemented yet.");if(o!=null)throw new Mt("steps mode in testLoop() is not implemented yet");{const c=ff(i,s),l=Rs(br(0,i));for(let d=0;d<c.length;++d){const h=c[d][0],f=c[d][1],p=ri(l,h,f-h),m=hp(t,p),g=e(m);if(d===0)for(let x=0;x<g.length;++x)a.push(tn(0));for(let x=0;x<g.length;++x){const y=g[x];a[x]=ze(a[x],Y(f-h,y))}}for(let d=0;d<a.length;++d)a[d]=xt(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(zx(e,r)>1){const i=zx(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:s[g]});const f=new xo(h),p=qa(this.outputs,f,{training:!0});let m;for(let g=0;g<this.lossFunctions.length;++g){const x=this.lossFunctions[g];let y=x(r[g],p[g]);o[g]!=null&&(y=_M(y,o[g]));const b=Rn(y);t.push(b),g===0?m=y:m=ze(m,y)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=t[g];else{const y=this.metricsTensors[g][0],b=this.metricsTensors[g][1];x=Rn(y(r[b],p[b]))}Fr(x),i.push(x)}return m=Rn(m),this.calculateLosses().forEach(g=>{m=ze(m,g)}),m},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,c)].concat(i)}}makeTestFunction(){this.testFunction=e=>ae(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let l=0;l<this.inputs.length;++l)i.push({key:this.inputs[l],value:r[l]});const a=new xo(i),c=qa(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const d=this.lossFunctions[l],h=Rn(d(o[l],c[l]));l===0?s=h:s=ze(s,h),t.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const d=this.metricsTensors[l][0],h=this.metricsTensors[l][1],f=Rn(d(o[h],c[h]));t.push(f)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,c,l,d,h,f;try{const p=s.batchSize==null?32:s.batchSize;hf(p);const g=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,p);r=g[0],o=g[1],f=g[2];let x=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)c=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new Mt("validationData including sample weights is not supported yet."):new J(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const N=await this.standardizeUserData(c,l,null,null,!0,p);d=N[0],h=N[1],y=d.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const $=Math.floor(r[0].shape[0]*(1-s.validationSplit)),N=r[0].shape[0];d=za(r,$,N),i=r,r=za(r,0,$),h=za(o,$,N),a=o,o=za(o,0,$),y=d.concat(h)}else s.validationSteps!=null&&(x=!0);const b=r.concat(o).concat(f);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let S,I;x?(this.makeTestFunction(),S=this.testFunction,I=w.slice().concat(w.map($=>"val_"+$))):(S=null,y=[],I=w.slice());const C=D1(s.callbacks,s.yieldEvery);return await this.fitLoop(v,b,w,p,s.epochs,s.verbose,C,S,y,s.shuffle,I,s.initialEpoch,null,null)}finally{this.isTraining=!1,cr(r,e),cr(o,t),cr(i,e),cr(a,t),cr(d,c),cr(h,l),f!=null&&Ft(f)}}async fitLoop(e,t,s,r,o,i,a,c,l,d,h,f,p,m){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),f==null&&(f=0);let g=!1;if(c!=null&&l!=null&&(g=!0),m!=null&&(g=!0,p==null))throw new J("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,r,p,"steps_per_epoch");let y;x!=null&&(y=br(0,x)),i==null&&(i=1);const{callbackList:b,history:v}=_1(a,i,o,f,x,p,r,g,h);b.setModel(this),this.history=v,await b.onTrainBegin(),this.stopTraining_=!1;for(let w=f;w<o;++w){await b.onEpochBegin(w);const S={};if(p!=null)throw new Mt("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new Mt("batch shuffling is not implemneted yet");d&&h$(y);const I=Rs(y),C=ff(x,r);for(let k=0;k<C.length;++k){const $={};if(await b.onBatchBegin(k,$),ae(()=>{const N=C[k][0],_=C[k][1],P=ri(I,N,_-N);$.batch=k,$.size=_-N;const j=hp(t,P),A=e(j);for(let F=0;F<s.length;++F){const M=s[F],K=A[F];$[M]=K,Fr(K)}if(k===C.length-1&&g){const F=this.testLoop(c,l,r);for(let M=0;M<s.length;++M){const K=s[M],D=F[M];Fr(D),S["val_"+K]=D}}}),await b.onBatchEnd(k,$),R1($),this.stopTraining_)break}I.dispose()}if(await b.onEpochEnd(w,S),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return MM(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),c=[];for(const l of a){const d=await l.data();c.push(d[0])}return Ft(a),cr(s[0],e),cr(s[1],t),xs(c)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=Qf().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Qf().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Xr(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Xr(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Xr(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Xr(Gl(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Xr(Gl(e)));{const e={};for(const t in this.metrics)e[t]=Xr(Gl(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Mu(e.optimizer_config),s=Wr(t);let r;if(typeof e.loss=="string")r=Qo(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>Qo(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=Qo(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>Qo(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=Qo(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const l=x2(e);if(l.length===0)throw new J(`Cannot find any save handlers for URL '${e}'`);if(l.length>1)throw new J(`Found more than one (${l.length}) save handlers for URL '${e}'`);e=l[0]}if(e.save==null)throw new J("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await vx(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:UM,generatedBy:`TensorFlow.js tfjs-layers v${z1}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:d,specs:h}=await vx(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=l2([s.data,d])}return this.userDefinedMetadata!=null&&(Jx(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){Jx(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ta.className="Model";je(ta);class G1 extends ta{}G1.className="Functional";je(G1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function GM(n,e){if(e==null&&(e={}),typeof n=="string"){const t=y2(n,e);if(t.length===0)t.push(YD(n,e));else if(t.length>1)throw new J(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return HM(n,void 0,e)}async function HM(n,e,t){if(t==null&&(t={}),n.load==null)throw new J("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=Wr(Mu(r),e,i),c=s.trainingConfig;if(c!=null&&a.loadTrainingConfig(c),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new J("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:l,optimizerWeights:d}=qM(s.weightData,s.weightSpecs);a.loadWeights(l,o),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),Ft(l),Ft(d.map(h=>h.tensor))}return a}function qM(n,e){const t=s2(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class fa extends ta{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Ch("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new J(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof fa||e instanceof ta;let s;if(t){if(s=e,s.outputs.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new J("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new J("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=Hj({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new J(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=k1(this.outputs[0])}this.inboundNodes=[],new Ih({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:xi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Yt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ta({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Zs("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Zs("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Zs("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Zs("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new J("Legacy serialization format not supported yet.");o=t}else R(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof fa))throw new Mt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const c of o){const d=Wr(c,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new J("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new J("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}fa.className="Sequential";je(fa);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KM(n){return new fa(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let rs=class extends $a{getConfig(){return{}}};class H1 extends rs{apply(e,t=1){return Ej(e,t)}}H1.className="elu";je(H1);class q1 extends rs{apply(e){return cv(e)}}q1.className="selu";je(q1);class K1 extends rs{apply(e){return ki(e)}}K1.className="relu";je(K1);class Q1 extends rs{apply(e){return ae(()=>cc(6,ki(e)))}}Q1.className="relu6";je(Q1);class X1 extends rs{apply(e){return e}}X1.className="linear";je(X1);class J1 extends rs{apply(e){return Na(e)}}J1.className="sigmoid";je(J1);class Y1 extends rs{apply(e){return Dj(e)}}Y1.className="hardSigmoid";je(Y1);class Z1 extends rs{apply(e){return xl(e)}}Z1.className="softplus";je(Z1);class eS extends rs{apply(e){return Rj(e)}}eS.className="softsign";je(eS);class tS extends rs{apply(e){return fh(e)}}tS.className="tanh";je(tS);let Xg=class extends rs{apply(e,t=-1){return Ym(e,t)}};Xg.className="softmax";je(Xg);class nS extends rs{apply(e,t=-1){return Zw(e,t)}}nS.className="logSoftmax";je(nS);class sS extends rs{apply(e){return ae(()=>ae(()=>{const t=Math.sqrt(2),s=Y(.5,ze(1,Kw(xt(e,t))));return Y(e,s)}))}}sS.className="gelu";je(sS);class rS extends rs{apply(e){return ae(()=>Y(.5,Y(e,ze(1,fh(Y(ns(xt(2,Math.PI)),ze(e,Y(.044715,pi(e,3)))))))))}}rS.className="gelu_new";je(rS);class oS extends rs{apply(e){return ae(()=>Y(e,fh(xl(e))))}}oS.className="mish";je(oS);class iS extends rs{apply(e,t=1){return ae(()=>Y(Na(Y(e,t)),e))}}iS.className="swish";je(iS);function To(n){return n.getClassName()}function pf(n,e={}){return Nl(n,Qs.getMap().classNameMap,e,"activation")}function Ao(n){if(n==null){const e={};return e.className="linear",e.config={},pf(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},pf(e)}else return n instanceof rs?n:pf(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QM(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class aS extends $a{}class cS extends aS{constructor(e){super(),QM(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ae(()=>{let t=Vn([1]);return this.hasL1&&(t=ze(t,gt(Y(this.l1,as(e))))),this.hasL2&&(t=ze(t,gt(Y(this.l2,kl(e))))),ne(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}cS.className="L1L2";je(cS);const sy={l1l2:"L1L2"};function cn(n){return Mg(n)}function ry(n,e={}){return Nl(n,Qs.getMap().classNameMap,e,"regularizer")}function bn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in sy?sy[n]:n,config:{}};return ry(t)}else return n instanceof aS?n:ry(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class lS extends Bt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=It(e);let s=ki(e);return this.maxValue!=null&&(s=zs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}lS.className="ReLU";je(lS);class uS extends Bt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=It(e);return Mm(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}uS.className="LeakyReLU";je(uS);class dS extends Bt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=yn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=bn(e.alphaRegularizer),this.alphaConstraint=On(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new J(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Yt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Mn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=It(e),Bm(e,this.alpha.read())}getConfig(){const e={alphaInitializer:vn(this.alphaInitializer),alphaRegularizer:cn(this.alphaRegularizer),alphaConstraint:Fn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}dS.className="PReLU";je(dS);let hS=class extends Bt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Mt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=It(e);return gh(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};hS.className="ELU";je(hS);class fS extends Bt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=It(e);return Y(s,et(Ws(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}fS.className="ThresholdedReLU";je(fS);class pS extends Bt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Xg().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ae(()=>{let s=It(e);const r=t.mask;if(r!=null){const o=Y(Nt(Oo(s.shape),et(r,s.dtype)),tn(-1e9));s=ze(s,o)}return this.axis instanceof Array?this.axis.length>1?Ur(Nt(s,ev(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}pS.className="Softmax";je(pS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function na(n,e,t){if(typeof n=="number")return xi(n,e);if(n.length!==e)throw new J(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!kj(r))throw new J(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function yr(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Dr(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+$o([t-e,0]);else if(s==="same")n=n*e;else throw new J(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jg(n,e){return ae(()=>(An(e),e==="channelsFirst"?qt(n,[0,2,3,1]):n))}function mS(n,e){return ae(()=>(An(e),e==="channelsFirst"?qt(n,[0,2,3,4,1]):n))}function XM(n,e,t,s=1,r="valid",o,i=1){return ae(()=>{if(o==null&&(o=wr()),An(o),n.shape.length!==3)throw new J(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new J(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new J(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=qt(n,[0,2,1])),r==="causal")throw new Mt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Vw(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(a=Cr(a,t)),a})}function oy(n,e,t,s=[1,1],r="valid",o,i,a=null){return ae(()=>{if(o==null&&(o=wr()),An(o),n.rank!==3&&n.rank!==4)throw new J(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new J(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=Jg(n,o);if(r==="causal")throw new Mt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=QR({x:c,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(c=qt(c,[0,3,1,2])),c})}function JM(n,e,t,s=[1,1,1],r="valid",o,i){return ae(()=>{if(o==null&&(o=wr()),An(o),n.rank!==4&&n.rank!==5)throw new J(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new J(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=mS(n,o);if(r==="causal")throw new Mt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=KT(a,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(a=Cr(a,t)),o==="channelsFirst"&&(a=qt(a,[0,4,1,2,3])),a})}class Th extends Bt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Th.verifyArgs(t),this.rank=e,Gn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Mt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=na(t.kernelSize,e,"kernelSize"),this.strides=na(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Bs(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,An(this.dataFormat),this.activation=Ao(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=yn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=On(t.biasConstraint),this.biasRegularizer=bn(t.biasRegularizer),this.activityRegularizer=bn(t.activityRegularizer),this.dilationRate=na(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new J(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new J(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new J(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Rr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Fg(e.kernelSize,"number",1,3))throw new J(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:To(this.activation),useBias:this.useBias,biasInitializer:vn(this.biasInitializer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),biasConstraint:Fn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Ta extends Th{constructor(e,t){super(e,t),this.kernel=null,Ta.verifyArgs(t),this.filters=t.filters,Gn(this.filters,"filters"),this.kernelInitializer=yn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=On(t.kernelConstraint),this.kernelRegularizer=bn(t.kernelRegularizer)}build(e){e=Yt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new J(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ae(()=>{e=It(e);let s;const r=this.bias==null?null:this.bias.read(),o=d1(this.activation.getClassName());if(o!=null&&this.rank===2)s=oy(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=XM(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=oy(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=JM(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Mt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Yt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=yr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:vn(this.kernelInitializer),kernelRegularizer:cn(this.kernelRegularizer),kernelConstraint:Fn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new J(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class El extends Ta{constructor(e){super(2,e),El.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Fg(e.kernelSize,"number",1,2))throw new J(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}El.className="Conv2D";je(El);class Rl extends Ta{constructor(e){super(3,e),Rl.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new J(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Rl.className="Conv3D";je(Rl);class gS extends El{constructor(e){if(super(e),this.inputSpec=[new Mn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new J(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Yt(e),e.length!==4)throw new J("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Mn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ae(()=>{let s=It(e);if(s.shape.length!==4)throw new J(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const c=r[i],l=r[a],d=this.kernelSize[0],h=this.kernelSize[1],f=this.strides[0],p=this.strides[1],m=Dr(c,f,d,this.padding),g=Dr(l,p,h,this.padding),x=[o,m,g,this.filters];this.dataFormat!=="channelsLast"&&(s=qt(s,[0,2,3,1]));let y=Uw(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=qt(y,[0,3,1,2])),this.bias!=null&&(y=Cr(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Yt(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return t[s]=this.filters,t[r]=Dr(t[r],c,i,this.padding),t[o]=Dr(t[o],l,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}gS.className="Conv2DTranspose";je(gS);class xS extends Rl{constructor(e){if(super(e),this.inputSpec=[new Mn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new J(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Yt(e),e.length!==5)throw new J("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Mn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ae(()=>{let s=It(e);if(s.shape.length!==5)throw new J(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,c;this.dataFormat==="channelsFirst"?(c=2,i=3,a=4):(c=1,i=2,a=3);const l=r[c],d=r[i],h=r[a],f=this.kernelSize[0],p=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],x=this.strides[1],y=this.strides[2],b=Dr(l,g,f,this.padding),v=Dr(d,x,p,this.padding),w=Dr(h,y,m,this.padding),S=[o,b,v,w,this.filters];this.dataFormat!=="channelsLast"&&(s=qt(s,[0,2,3,4,1]));let I=JT(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(I=qt(I,[0,4,1,2,3])),this.bias!==null&&(I=Cr(I,this.bias.read(),this.dataFormat)),this.activation!==null&&(I=this.activation.apply(I)),I})}computeOutputShape(e){e=Yt(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],d=this.strides[0],h=this.strides[1],f=this.strides[2];return t[s]=this.filters,t[r]=Dr(t[r],d,a,this.padding),t[o]=Dr(t[o],h,c,this.padding),t[i]=Dr(t[i],f,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}xS.className="Conv3DTranspose";je(xS);class yS extends Ta{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new J("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new J("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new J(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=yn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=bn(t.depthwiseRegularizer),this.depthwiseConstraint=On(t.depthwiseConstraint),this.pointwiseInitializer=yn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=bn(t.pointwiseRegularizer),this.pointwiseConstraint=On(t.pointwiseConstraint)}build(e){if(e=Yt(e),e.length<this.rank+2)throw new J(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new J(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Mn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ae(()=>{e=It(e);let s;if(this.rank===1)throw new Mt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=qt(e,[0,2,3,1])),s=lv(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Cr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=qt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=vn(this.depthwiseInitializer),e.pointwiseInitializer=vn(this.pointwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.pointwiseRegularizer=cn(this.pointwiseRegularizer),e.depthwiseConstraint=Fn(this.depthwiseConstraint),e.pointwiseConstraint=Fn(this.pointwiseConstraint),e}}yS.className="SeparableConv";class bS extends yS{constructor(e){super(2,e)}}bS.className="SeparableConv2D";je(bS);class Ah extends Ta{constructor(e){super(1,e),Ah.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Fg(e.kernelSize,"number",1,1))throw new J(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Ah.className="Conv1D";je(Ah);class wS extends Bt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ae(()=>{if(e=It(e),this.dataFormat==="channelsLast"){const s=Ul(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ul(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Ul(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ul(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}wS.className="Cropping2D";je(wS);class vS extends Bt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Cj(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ae(()=>{let s=It(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=qt(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?Zr.resizeNearestNeighbor(s,[o,i]):Zr.resizeBilinear(s,[o,i]);return qt(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?Zr.resizeNearestNeighbor(s,[o,i]):Zr.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}vS.className="UpSampling2D";je(vS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function YM(n,e,t=[1,1],s="valid",r,o){return ae(()=>{r==null&&(r=wr()),An(r);let i=Jg(n,r);if(n.rank!==4)throw new J(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new J(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=Dm(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=qt(i,[0,3,1,2])),i})}class SS extends Th{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=yn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=On(e.depthwiseConstraint),this.depthwiseRegularizer=bn(e.depthwiseRegularizer)}build(e){if(e=Yt(e),e.length<4)throw new J(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new J(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{e=It(e);let s=YM(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Cr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Yt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=yr(t,this.kernelSize[0],this.padding,this.strides[0]),i=yr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=vn(this.depthwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.depthwiseConstraint=Fn(this.depthwiseRegularizer),e}}SS.className="DepthwiseConv2D";je(SS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CS(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new J("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function NS(n,e,t,s=!1,r,o,i=!1,a=!1){return ae(()=>{const c=e.shape.length;if(c<3)throw new J(`Input should be at least 3D, but is ${c}D.`);const l=[1,0].concat(br(2,c));e=qt(e,l),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=et(et(r,"bool"),"float32"),r.rank===c-1&&(r=gs(r,-1)),r=qt(r,l)),s&&(e=mi(e,0),r!=null&&(r=mi(r,0)));const d=[];let h,f=t;const p=e.shape[0],m=gi(e);let g;r!=null&&(g=gi(r));for(let y=0;y<p;++y){const b=m[y],v=ae(()=>n(b,f));if(r==null)h=v[0],f=v[1];else{const w=ae(()=>{const S=g[y],I=Nt(nr(S),S),C=ze(Y(v[0],S),Y(f[0],I)),k=f.map(($,N)=>ze(Y(v[1][N],S),Y($,I)));return{output:C,newStates:k}});h=w.output,f=w.newStates}a&&d.push(h)}let x;return a&&(x=no(d,1)),[h,x,f]})}class zo extends Bt{constructor(e){super(e);let t;if(e.cell==null)throw new J("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new e0({cells:e.cell}):t=e.cell,t.stateSize==null)throw new J("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Mn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return br(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){cp(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return ae(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Mt("Constants support is not implemented in RNN yet.");cp(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Mn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!nn(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new J(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Mn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ae(()=>{if(!this.stateful)throw new Er("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Vn([s,r])):this.states_=[Vn([s,this.cell.stateSize])];else if(e==null)Ft(this.states_),this.keptStates!=null&&(Ft(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Vn([s,r])):this.states_[0]=Vn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new J(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Ft(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!nn(o.shape,a))throw new J(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>Fr(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=CS(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new Mn({shape:l.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Hr){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const f=super.apply(l,t);return this.inputSpec=h,f}else return super.apply(e,t)}call(e,t){return ae(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=It(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new J(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},l=NS((m,g)=>{const x=this.cell.call([m].concat(g),a);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=l[0],h=l[1],f=l[2];this.stateful&&this.resetStates(f,r);const p=this.returnSequences?h:d;return this.returnState?[p].concat(f):p})}getInitialState(e){return ae(()=>{let t=Vn(e.shape);return t=gt(t,[1,2]),t=Il(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?ip(t,[1,s]):t):this.cell.stateSize>1?[ip(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===zo.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=Wr(r,s);return new e(Object.assign(t,{cell:o}))}}zo.className="RNN";je(zo);class Eh extends Bt{}class Yg extends Eh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=Ao(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=bn(e.kernelRegularizer),this.recurrentRegularizer=bn(e.recurrentRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.kernelConstraint=On(e.kernelConstraint),this.recurrentConstraint=On(e.recurrentConstraint),this.biasConstraint=On(e.biasConstraint),this.dropout=ha([1,$o([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ha([1,$o([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Yt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{if(e=e,e.length!==2)throw new J(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Eo({ones:()=>nr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Eo({ones:()=>nr(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=zr(Y(e,i),this.kernel.read()):o=zr(e,this.kernel.read()),this.bias!=null&&(o=Cr(o,this.bias.read())),a!=null&&(s=Y(s,a));let c=ze(o,zr(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:To(this.activation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),recurrentConstraint:Fn(this.recurrentConstraint),biasConstraint:Fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Yg.className="SimpleRNNCell";je(Yg);class IS extends zo{constructor(e){e.cell=new Yg(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(Ft(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ft(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}IS.className="SimpleRNN";je(IS);class Zg extends Eh{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new J("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Gn(this.units,"units"),this.activation=Ao(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Ao(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=bn(e.kernelRegularizer),this.recurrentRegularizer=bn(e.recurrentRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.kernelConstraint=On(e.kernelConstraint),this.recurrentConstraint=On(e.recurrentConstraint),this.biasConstraint=On(e.biasConstraint),this.dropout=ha([1,$o([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ha([1,$o([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Yt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ae(()=>{if(e=e,e.length!==2)throw new J(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Eo({ones:()=>nr(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Eo({ones:()=>nr(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,c,l;0<this.dropout&&this.dropout<1&&(e=Y(e,o[0]));let d=zr(e,this.kernel.read());this.useBias&&(d=Cr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Y(r,i[0]));const h=this.recurrentKernel.read(),[f,p]=Ls(h,[2*this.units,this.units],h.rank-1),m=zr(r,f),[g,x,y]=Ls(d,3,d.rank-1),[b,v]=Ls(m,2,m.rank-1);a=this.recurrentActivation.apply(ze(g,b)),c=this.recurrentActivation.apply(ze(x,v));const w=zr(Y(c,r),p);l=this.activation.apply(ze(y,w));const S=ze(Y(a,r),Y(ze(1,kn(a)),l));return[S,S]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:To(this.activation),recurrentActivation:To(this.recurrentActivation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),recurrentConstraint:Fn(this.recurrentConstraint),biasConstraint:Fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Zg.className="GRUCell";je(Zg);class kS extends zo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Zg(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(Ft(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ft(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}kS.className="GRU";je(kS);class Rh extends Eh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=Ao(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Ao(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=bn(e.kernelRegularizer),this.recurrentRegularizer=bn(e.recurrentRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.kernelConstraint=On(e.kernelConstraint),this.recurrentConstraint=On(e.recurrentConstraint),this.biasConstraint=On(e.biasConstraint),this.dropout=ha([1,$o([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ha([1,$o([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Yt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends rr{apply(c,l){const d=o.apply([i]),h=new Lg().apply([i]),f=o.apply([i*2]);return Bx(Bx(d,h),f)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ae(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new J(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Eo({ones:()=>nr(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Eo({ones:()=>nr(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let c,l,d,h;0<this.dropout&&this.dropout<1&&(e=Y(e,i[0]));let f=zr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Y(r,a[0])),f=ze(f,zr(r,this.recurrentKernel.read())),this.useBias&&(f=Cr(f,this.bias.read()));const[p,m,g,x]=Ls(f,4,f.rank-1);c=this.recurrentActivation.apply(p),l=this.recurrentActivation.apply(m),d=ze(Y(l,o),Y(c,this.activation.apply(g))),h=this.recurrentActivation.apply(x);const y=Y(h,this.activation.apply(d));return[y,y,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:To(this.activation),recurrentActivation:To(this.recurrentActivation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),recurrentConstraint:Fn(this.recurrentConstraint),biasConstraint:Fn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Rh.className="LSTMCell";je(Rh);class $S extends zo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Rh(e),super(e)}call(e,t){return ae(()=>{this.cell.dropoutMask!=null&&(Ft(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ft(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}$S.className="LSTM";je($S);class e0 extends Eh{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ae(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const c=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=c.call(i,t),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){cp(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{si(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(Wr(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return lp(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}Hg(t)}}e0.className="StackedRNNCells";je(e0);function Eo(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):y1(e(),t),a=()=>$l(i,e,s);return!r||r<=1?Fr(a().clone()):Array(r).fill(void 0).map(a).map(l=>Fr(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var ZM=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class TS extends zo{constructor(e){if(e.unroll)throw new Mt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Mt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Mn({ndim:5})]}call(e,t){return ae(()=>{if(this.cell.dropoutMask!=null&&(Ft(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ft(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new J("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ae(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Vn(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){ae(()=>{if(!this.stateful)throw new Er("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Vn(o)):this.states_=[Vn(o)];else if(e==null)Ft(this.states_),this.keptStates!=null&&(Ft(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Vn(o)):this.states_[0]=Vn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new J(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Ft(this.states_);for(let a=0;a<this.states_.length;++a){const c=e[a],l=o;if(!nn(c.shape,l))throw new J(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${c.shape}`);this.states_[a]=c}}this.states_=this.states_.map(a=>Fr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,c=t==="channelsFirst",l=e[c?3:2],d=e[c?4:3],h=yr(l,r[0],o,i[0],a[0]),f=yr(d,r[1],o,i[1],a[1]);return[...e.slice(0,2),...c?[s,h,f]:[h,f,s]]}}TS.className="ConvRNN2D";class t0 extends Rh{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Gn(this.filters,"filters"),this.kernelSize=na(s,2,"kernelSize"),this.kernelSize.forEach(c=>Gn(c,"kernelSize")),this.strides=na(r||1,2,"strides"),this.strides.forEach(c=>Gn(c,"strides")),this.padding=o||"valid",Bs(this.padding),this.dataFormat=i||"channelsLast",An(this.dataFormat),this.dilationRate=na(a||1,2,"dilationRate"),this.dilationRate.forEach(c=>Gn(c,"dilationRate"))}build(e){var t;e=Yt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new J(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const l=this.biasInitializer,d=this.filters;c=new(t=class extends rr{apply(f,p){const m=l.apply([d]),g=Oo([d]),x=l.apply([d*2]);return Og([m,g,x])}},t.className="CustomInit",t)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ae(()=>{if(e.length!==3)throw new J(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Eo({ones:()=>nr(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,l=(te,W,de)=>!W||!W[de]?te:Y(W[de],te);let d=l(r,c,0),h=l(r,c,1),f=l(r,c,2),p=l(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Eo({ones:()=>nr(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let g=l(o,m,0),x=l(o,m,1),y=l(o,m,2),b=l(o,m,3);const v=3,[w,S,I,C]=Ls(this.kernel.read(),a,v),[k,$,N,_]=this.useBias?Ls(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,w,k,this.padding),h=this.inputConv(h,S,$,this.padding),f=this.inputConv(f,I,N,this.padding),p=this.inputConv(p,C,_,this.padding);const[P,j,A,F]=Ls(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,P),x=this.recurrentConv(x,j),y=this.recurrentConv(y,A),b=this.recurrentConv(b,F);const M=this.recurrentActivation.apply(ze(d,g)),K=this.recurrentActivation.apply(ze(h,x)),D=ze(Y(K,i),Y(M,this.activation.apply(ze(f,y)))),G=Y(this.recurrentActivation.apply(ze(p,b)),this.activation.apply(D));return[G,G,D]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=ZM(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=fi(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Cr(o,s,this.dataFormat):o}recurrentConv(e,t){return fi(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}t0.className="ConvLSTM2DCell";je(t0);class AS extends TS{constructor(e){const t=new t0(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}AS.className="ConvLSTM2D";je(AS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dh extends Bt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return $l(()=>y1(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Dh.className="Dropout";je(Dh);class ES extends Dh{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}ES.className="SpatialDropout1D";je(ES);class n0 extends Bt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Gn(this.units,"units"),this.activation=Ao(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=On(e.kernelConstraint),this.biasConstraint=On(e.biasConstraint),this.kernelRegularizer=bn(e.kernelRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.activityRegularizer=bn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Yt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Yt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e),r=d1(this.activation.getClassName());let o;return r!=null?o=zr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=zr(s,this.kernel.read()),this.bias!=null&&(o=Cr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:To(this.activation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:Fn(this.kernelConstraint),biasConstraint:Fn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}n0.className="Dense";je(n0);class RS extends Bt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Yt(e);for(const t of e.slice(1))if(t==null)throw new J(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],So(e,1)]}call(e,t){return ae(()=>{this.invokeCallHook(e,t);let s=It(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=qt(s,r)}return Aj(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}RS.className="Flatten";je(RS);class DS extends Bt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Ao(e.activation)}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e);return this.activation.apply(s)})}getConfig(){const e={activation:To(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}DS.className="Activation";je(DS);class _S extends Bt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ae(()=>(e=It(e),$j(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}_S.className="RepeatVector";je(_S);class PS extends Bt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let c=0;c<r.length;++c){const l=r[c];if(this.isUnknown(l))if(i===null)i=c;else throw new J("Can only specifiy one unknown dimension.");else o*=l}const a=So(e);if(i!==null){if(o===0||a%o!==0)throw new J(s);r[i]=a/o}else if(a!==o)throw new J(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ne(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}PS.className="Reshape";je(PS);class jS extends Bt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=br(1,e.dims.length+1);if(!nn(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Mn({ndim:this.dims.length+1})]}computeOutputShape(e){e=Yt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return qt(It(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}jS.className="Permute";je(jS);class MS extends Bt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=It(e);return Zf(Nu(s,this.maskValue),-1)}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e),i=Zf(Nu(s,this.maskValue),-1,!0);return Y(s,et(i,s.dtype))})}}MS.className="Masking";je(MS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FS extends Bt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(rn(e.inputLength))}this.inputDim=e.inputDim,Gn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Gn(this.outputDim,"outputDim"),this.embeddingsInitializer=yn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=bn(e.embeddingsRegularizer),this.activityRegularizer=bn(e.activityRegularizer),this.embeddingsConstraint=On(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ae(()=>this.maskZero?(e=It(e),Nu(e,Kt(e))):null)}computeOutputShape(e){if(e=Yt(e),this.inputLength==null)return[...e,this.outputDim];const t=rn(this.inputLength);if(t.length!==e.length-1)throw new J(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new J(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ae(()=>{this.invokeCallHook(e,t);let s=It(e);s.dtype!=="int32"&&(s=Lr(s,"int32"));const r=x1(this.embeddings.read(),ne(s,[s.size]));return ne(r,Yt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:vn(this.embeddingsInitializer),embeddingsRegularizer:cn(this.embeddingsRegularizer),activityRegularizer:cn(this.activityRegularizer),embeddingsConstraint:Fn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}FS.className="Embedding";je(FS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ai extends Bt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Mt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new J("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Yt(e)]),e=e,e.length<2)throw new J(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=vo(t),t.length>1)throw new J(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&vo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ae(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=$o(r);for(let i of e){const a=i.rank;for(let c=0;c<o-a;++c)i=Il(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const c of e){const l=c.rank;if(l==null){const d=c.shape,h=d[0],f=d.slice(1).concat([h]);let p=ne(c,[h].concat(So(d.slice(1))));p=qt(p,[1,0]),p=ne(p,f),s.push(p),o=!0}else if(l>1){const d=br(1,l).concat([0]);s.push(qt(c,d)),o=!0}else s.push(c)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const c=i.shape,l=c.length,d=c[l-1],h=[d].concat(c.slice(0,c.length-1));i=ne(qt(ne(i,[-1,d]),[1,0]),h)}else if(a>1){const c=[a-1].concat(br(0,a-1));i=qt(i,c)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=vo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ae(()=>{if(t==null)return null;if(!Array.isArray(t))throw new J("`mask` should be an Array");if(!Array.isArray(e))throw new J("`inputs` should be an Array");if(t.length!==e.length)throw new J(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:gs(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=to(s,t[r]);return s})}}class OS extends Ai{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ze(t,e[s]);return t})}}OS.className="Add";je(OS);class LS extends Ai{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Y(t,e[s]);return t})}}LS.className="Multiply";je(LS);class zS extends Ai{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ze(t,e[s]);return Y(1/e.length,t)})}}zS.className="Average";je(zS);class WS extends Ai{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Fo(t,e[s]);return t})}}WS.className="Maximum";je(WS);class BS extends Ai{constructor(e){super(e)}mergeFunction(e){return ae(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=cc(t,e[s]);return t})}}BS.className="Minimum";je(BS);class VS extends Ai{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new J("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(nn(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new J("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ae(()=>Og(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new J("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new J("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new J("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new J(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ae(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(et(nr(e[i]),"bool")):t[i].rank<e[i].rank?r.push(gs(t[i],-1)):r.push(t[i]);const o=ys(r,this.axis);return Bw(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}VS.className="Concatenate";je(VS);function Wa(n,e){for(;n<0;)n+=e;return n}function eF(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Mt("batchDot is not implemented for tensors of 4D or higher rank yet");if(R(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),R(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Mt("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return ae(()=>{let i;if(s>r){i=s-r;const c=[];for(let l=0;l<i;++l)c.push(1);e=ne(e,e.shape.concat(c))}else if(r>s){i=r-s;const c=[];for(let l=0;l<i;++l)c.push(1);n=ne(n,n.shape.concat(c))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=gt(Y(n,e),o[0]):a=gt(Y(qt(n,[1,0]),e),o[1]);else{const c=o[0]!==n.shape.length-1,l=o[1]===e.shape.length-1;a=en(n,e,c,l)}if(i>0){let c;s>r?c=s+r-3:c=s-1;const l=[];for(let d=c;d<c+i;++d)l.push(d);a=bl(a,l)}return a.shape.length===1&&(a=gs(a,1)),a})}class US extends Ai{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new Mt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new J(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new J(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>Wa(o,e[i].shape.length)):r=[Wa(this.axes,t.shape.length),Wa(this.axes,s.shape.length)],this.normalize&&(t=Ru(t,r[0]),s=Ru(s,r[1])),eF(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Wa(this.axes,e.length),Wa(this.axes,t.length)],s}computeOutputShape(e){R(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new Mt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}US.className="Dot";je(US);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class GS extends Bt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e);return $l(()=>ze(Nh(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}GS.className="GaussianNoise";je(GS);class HS extends Bt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ae(()=>{this.invokeCallHook(e,t);const s=It(e);return this.rate>0&&this.rate<1?$l(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return Y(s,Nh(s.shape,1,o))},()=>s,t.training||!1):s})}}HS.className="GaussianDropout";je(HS);class qS extends Bt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||It(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ae(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return $l(()=>{const o=It(e),a=-1.6732632423543772*1.0507009873554805;let c=Ni(yl(s),this.rate);c=Lr(c,"float32");const l=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-l*a*this.rate,h=ze(Y(o,c),Y(ze(c,-1),a));return ze(Y(h,l),d)},()=>It(e),t.training||!1)}return e})}}qS.className="AlphaDropout";je(qS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hc(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=NT(n,e,t,s,r,o);else if(n.rank===3)i=kT(n,e,t,s,r,o);else if(n.rank===4)i=TT(n,e,t,s,r,o);else throw new Mt(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function tF(n,e,t,s,r=.001){return ae(()=>{const o=Lm(n,s),i=o.mean,a=o.variance;return[hc(n,i,a,t,e,r),i,a]})}function nF(n,e,t,s,r=.001){return ae(()=>{const o=Lm(n,s),i=o.mean,a=o.variance,c=[];for(const m of br(0,n.rank))s.indexOf(m)!==-1?c.push(1):c.push(n.shape[m]);const l=ne(i,c),d=ne(a,c),h=e==null?null:ne(e,c),f=t==null?null:ne(t,c);return[hc(n,l,d,f,h,r),i,a]})}function sF(n,e,t,s,r=.001){return nn(s.slice().sort(),br(0,n.rank-1))?tF(n,e,t,s,r):nF(n,e,t,s,r)}class KS extends Bt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=yn(e.betaInitializer||"zeros"),this.gammaInitializer=yn(e.gammaInitializer||"ones"),this.movingMeanInitializer=yn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=yn(e.movingVarianceInitializer||"ones"),this.betaConstraint=On(e.betaConstraint),this.gammaConstraint=On(e.gammaConstraint),this.betaRegularizer=bn(e.betaRegularizer),this.gammaRegularizer=bn(e.gammaRegularizer)}build(e){e=Yt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new J(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Mn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ae(()=>{const s=t.training==null?!1:t.training,r=It(e),o=r.shape,i=o.length,a=br(0,i),c=this.axis>=0?this.axis:this.axis+i;a.splice(c,1);const l=xi(1,i);l[c]=o[c];const d=a.slice();d.sort();const h=!nn(d,br(0,i).slice(0,i-1)),f=()=>{if(h){const b=ne(this.movingMean.read(),l),v=ne(this.movingVariance.read(),l),w=this.center?ne(this.beta.read(),l):null,S=this.scale?ne(this.gamma.read(),l):null;return hc(r,b,v,w,S,this.epsilon)}else return hc(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[p,m,g]=sF(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(b,v,w)=>{ae(()=>{const S=1-w,I=b.read(),C=Y(Nt(I,v),S);b.write(Nt(I,C))})};return(()=>{x(this.movingMean,m,this.momentum),x(this.movingVariance,g,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:vn(this.betaInitializer),gammaInitializer:vn(this.gammaInitializer),movingMeanInitializer:vn(this.movingMeanInitializer),movingVarianceInitializer:vn(this.movingVarianceInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer),betaConstraint:Fn(this.betaConstraint),gammaConstraint:Fn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}KS.className="BatchNormalization";je(KS);class QS extends Bt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=yn(e.betaInitializer||"zeros"),this.gammaInitializer=yn(e.gammaInitializer||"ones"),this.betaRegularizer=bn(e.betaRegularizer),this.gammaRegularizer=bn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Yt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==vo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=It(e),r=s.shape,o=r.length;return ae(()=>{let{mean:a,variance:c}=Lm(s,this.axis,!0);const l=xi(1,o);for(const g of this.axis)l[g]=r[g];const d=g=>g!=null&&g.shape.length!==o?ne(g,l):g;let h=this.scale?d(this.gamma.read()):null,f=this.center?d(this.beta.read()):null;const p=[],m=[];for(let g=0;g<o;++g)this.axis.indexOf(g)!==-1?(p.push(r[g]),m.push(1)):(p.push(1),m.push(r[g]));return a=mr(a,p),c=mr(c,p),h!=null&&(h=mr(h,m)),f!=null&&(f=mr(f,m)),hc(s,a,c,f,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:vn(this.betaInitializer),gammaInitializer:vn(this.gammaInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}QS.className="LayerNormalization";je(QS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rF(n,e,t){return ae(()=>{if(n.rank!==4)throw new J(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new J("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=wr()),t!=="channelsLast"&&t!=="channelsFirst")throw new J(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],zm(n,s)})}class XS extends Bt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?wr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new J(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new J(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new J(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Mn({ndim:4})]}computeOutputShape(e){e=Yt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ae(()=>rF(It(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}XS.className="ZeroPadding2D";je(XS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _h(n,e,t,s,r,o){return ae(()=>{An(r),f1(o),Bs(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=wr()),o==null&&(o="max"),n=Jg(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=Om(n,e,t,a):i=Tm(n,e,t,a),r==="channelsFirst"&&(i=qt(i,[0,3,1,2])),i})}function JS(n,e,t,s,r,o){return ae(()=>{An(r),f1(o),Bs(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=wr()),o==null&&(o="max"),n=mS(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=hE(n,e,t,a):i=pT(n,e,t,a),r==="channelsFirst"&&(i=qt(i,[0,4,1,2,3])),i})}class YS extends Bt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new J(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Gn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new J(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Bs(this.padding),this.inputSpec=[new Mn({ndim:3})]}computeOutputShape(e){e=Yt(e);const t=yr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ae(()=>{this.invokeCallHook(e,t),e=Il(It(e),2);const s=this.poolingFunction(It(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return bl(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class ZS extends YS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Bs(r),_h(e,t,s,r,o,"max")}}ZS.className="MaxPooling1D";je(ZS);class eC extends YS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Bs(r),_h(e,t,s,r,o,"avg")}}eC.className="AveragePooling1D";je(eC);class tC extends Bt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new J(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),Bs(this.padding),this.inputSpec=[new Mn({ndim:4})]}computeOutputShape(e){e=Yt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=yr(t,this.poolSize[0],this.padding,this.strides[0]),s=yr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ae(()=>(this.invokeCallHook(e,t),this.poolingFunction(It(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class nC extends tC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Bs(r),_h(e,t,s,r,o,"max")}}nC.className="MaxPooling2D";je(nC);class sC extends tC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Bs(r),_h(e,t,s,r,o,"avg")}}sC.className="AveragePooling2D";je(sC);class rC extends Bt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new J(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),Bs(this.padding),this.inputSpec=[new Mn({ndim:5})]}computeOutputShape(e){e=Yt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=yr(t,this.poolSize[0],this.padding,this.strides[0]),s=yr(s,this.poolSize[1],this.padding,this.strides[1]),r=yr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ae(()=>(this.invokeCallHook(e,t),this.poolingFunction(It(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class oC extends rC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Bs(r),JS(e,t,s,r,o,"max")}}oC.className="MaxPooling3D";je(oC);class iC extends rC{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Bs(r),JS(e,t,s,r,o,"avg")}}iC.className="AveragePooling3D";je(iC);class aC extends Bt{constructor(e){super(e),this.inputSpec=[new Mn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Mt}}class cC extends aC{constructor(e){super(e||{})}call(e,t){return ae(()=>{const s=It(e);return Rn(s,1)})}}cC.className="GlobalAveragePooling1D";je(cC);class lC extends aC{constructor(e){super(e||{})}call(e,t){return ae(()=>{const s=It(e);return xr(s,1)})}}lC.className="GlobalMaxPooling1D";je(lC);class uC extends Bt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),this.inputSpec=[new Mn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Mt}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class dC extends uC{call(e,t){return ae(()=>{const s=It(e);return this.dataFormat==="channelsLast"?Rn(s,[1,2]):Rn(s,[2,3])})}}dC.className="GlobalAveragePooling2D";je(dC);class hC extends uC{call(e,t){return ae(()=>{const s=It(e);return this.dataFormat==="channelsLast"?xr(s,[1,2]):xr(s,[2,3])})}}hC.className="GlobalMaxPooling2D";je(hC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fC extends Bt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=Wr(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class pC extends fC{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Yt(e),e.length<3)throw new J(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Yt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ae(()=>(e=It(e),NS((i,a)=>[It(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}pC.className="TimeDistributed";je(pC);function oF(n){Ti(Sj,"BidirectionalMergeMode",n)}const iF="concat";class mC extends fC{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Wr(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Wr(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?iF:e.mergeMode,oF(this.mergeMode),e.weights)throw new Mt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):xs(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=CS(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new J("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(h=>new Mn({shape:h.shape}));this.forwardLayer.stateSpec=d.slice(0,l/2),this.backwardLayer.stateSpec=d.slice(l/2),a.push(...d)}if(r!=null)throw new Mt("Support for constants in Bidirectional layers is not implemented yet.");const c=i[0]instanceof Hr;for(const l of i)if(l instanceof Hr!==c)throw new J("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const f=super.apply(l,t);return this.inputSpec=h,f}else return super.apply(e,t)}call(e,t){return ae(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const c=s.slice(0,s.length/2),l=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:c})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:l}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=mi(o,1));let a;return this.mergeMode==="concat"?a=Og([r,o]):this.mergeMode==="sum"?a=ze(r,o):this.mergeMode==="ave"?a=Y(.5,ze(r,o)):this.mergeMode==="mul"?a=Y(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){si(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),si(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Wr(t.layer);if(delete t.layer,t.numConstants!=null)throw new Mt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}mC.className="Bidirectional";je(mC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gC extends Bt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ae(()=>(e=It(e),e.dtype!=="float32"&&(e=Lr(e,"float32")),ze(Y(e,this.scale),this.offset)))}}gC.className="Rescaling";je(gC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:aF,cropAndResize:cF}=Zr;class xC extends Bt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,i,a,c){return ae(()=>{let l,d=!1;const h=t/i,f=s/a,p=(r+t)/i,m=(o+s)/a,g=[h,f,p,m],x=[];e.rank===3?(d=!0,l=no([e])):l=e;for(let S=0;S<l.shape[0];S++)x.push(g);const y=Yi(x,[x.length,4]),b=lc(0,x.length,1,"int32"),w=cF(l,y,b,[r,o],"nearest");return Lr(d?It(gi(w)):w,c)})}upsize(e,t,s,r){return ae(()=>{const o=aF(e,[t,s]);return Lr(o,r)})}call(e,t){return ae(()=>{const s=It(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let c=0;i!==this.height&&(c=Math.floor((i-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),c>=0&&l>=0?this.centerCrop(s,c,l,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Yt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}xC.className="CenterCrop";je(xC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lF(n,e,t,s){let r=It(n);if(r.dtype!=="int32"&&(r=Lr(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=gs(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=gs(r,-1)),r.rank>2)throw new J(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let c;if(typeof s<"u"&&e==="count"?c=Ix(a,s,t,i):c=Ix(a,[],t,i),e!=="tfIdf")return c;if(s)return Y(c,s);throw new J("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yC extends Bt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Yt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ae(()=>{e=It(e),e.dtype!=="int32"&&(e=Lr(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new J(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=It(t.countWeights)}const r=xr(e),o=Su(e),i=Ws(this.numTokens,r).bufferSync().get(0),a=Ni(o,0).bufferSync().get(0);if(!(i&&a))throw new J(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return lF(e,this.outputMode,this.numTokens,s)})}}yC.className="CategoryEncoding";je(yC);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const uF=["bilinear","nearest"],iy=new Set(uF);class bC extends Bt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(iy.has(e.interpolation))this.interpolation=e.interpolation;else throw new J(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Yt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ae(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Zr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Zr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...iy]} are supported`)})}}bC.className="Resizing";je(bC);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wC{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}wC.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vC extends Bt{constructor(e){super(e),this.randomGenerator=new wC(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}vC.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const dF=["bilinear","nearest"],ay=new Set(dF);class SC extends vC{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new J(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new J(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new J(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(ay.has(s))this.interpolation=s;else throw new J(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Yt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ae(()=>{const s=It(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=yl([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Zr.resizeBilinear(e,i);case"nearest":return Zr.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...ay]} are supported`)}})}}SC.className="RandomWidth";je(SC);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mf(n){return new n0(n)}function hF(n){return new Dh(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fF=pe();fF.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var cy;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(cy||(cy={}));var ly;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(ly||(ly={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var uy;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(uy||(uy={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function it(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&R(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pF=xv;class Ph extends Ep{nextDataId(){return Ph.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Ob(this,$r())}write(e,t,s){this.firstUse&&(this.firstUse=!1,pe().get("IS_NODE")&&Fs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&wc(s[0])){const o=s.map(i=>wo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return so(r,o)}return y$(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>ko(r));return zt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return zt(e.shape,e.dtype,t)}makeOutput(e,t,s){return $r().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=ms();return e(),{kernelMs:ms()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){it([e],"where");const t=this.readSync(e.dataId);return pF(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Ph.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CC(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const mF=n=>{const{x:e}=n.inputs,t=n.backend;it(e,"abs");let s=new Float32Array(Ce(e.shape));const r=t.data.get(e.dataId).values;return s=CC(r),t.makeOutput(s,e.shape,e.dtype)},gF={kernelName:ud,backendName:"cpu",kernelFunc:mF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function En(n){return(e,t,s,r,o)=>{const i=_t(e,t),a=i.length,c=pt(i),l=Ce(i),d=es(o,l),h=e.length,f=t.length,p=pt(e),m=pt(t),g=ua(e,i),x=ua(t,i);if(g.length+x.length===0)for(let y=0;y<d.length;++y)d[y]=n(s[y%s.length],r[y%r.length]);else for(let y=0;y<d.length;++y){const b=Sa(y,a,c),v=b.slice(-h);g.forEach(C=>v[C]=0);const w=Mr(v,h,p),S=b.slice(-f);x.forEach(C=>S[C]=0);const I=Mr(S,f,m);d[y]=n(s[w],r[I])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),c=t.data.get(a.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},a}const xF={kernelName:Vp,backendName:"cpu",kernelFunc:Ts};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fu(n,e,t="float32"){if(t==="complex64"){const r=Fu(n,e,"float32"),o=Fu(n,e,"float32");return Ts({inputs:{real:r,imag:o},backend:n})}const s=ts(Ce(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const yF={kernelName:Wc,backendName:"cpu",kernelFunc:qr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yi(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const bF={kernelName:fm,backendName:"cpu",kernelFunc:yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NC(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=Ci([0],t),[o,i]=En((a,c)=>a!==c?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Ro(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return qr({inputs:{x:r},backend:t});const d=Fu(t,r.shape,r.dtype),h=Ro({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),f=Ts({inputs:{real:h,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),f}if(r.dtype==="complex64"){const d=yi({inputs:{input:r},backend:t}),h=Ro({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),h}if(!Wb(r.dtype,o)){const d=qr({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[a,c,l]=NC(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}const wF={kernelName:Tc,backendName:"cpu",kernelFunc:Ro};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;it([i,a],n);const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=i.dtype==="string"?ro(l):l,f=i.dtype==="string"?ro(d):d,p=s||i.dtype,[m,g]=e(i.shape,a.shape,h,f,p);return c.makeTensorInfo(g,p,m)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const l=Ro({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(l.dataId),h=d.complexTensorInfos.real,f=d.complexTensorInfos.imag,p=c.data.get(h.dataId).values,m=c.data.get(f.dataId).values,g=Ro({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),x=c.data.get(g.dataId),y=x.complexTensorInfos.real,b=x.complexTensorInfos.imag,v=c.data.get(y.dataId).values,w=c.data.get(b.dataId).values,[S,I,C]=t(i.shape,a.shape,p,m,v,w),k=c.makeTensorInfo(C,"float32",S),$=c.makeTensorInfo(C,"float32",I),N=Ts({inputs:{real:k,imag:$},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(k),c.disposeIntermediateTensorInfo($),N}else{const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=s||i.dtype,[f,p]=e(i.shape,a.shape,l,d,h);return c.makeTensorInfo(p,h,f)}}}function s0(n){return(e,t,s,r,o,i)=>{const a=_t(e,t),c=Ce(a),l=a.length,d=pt(a),h=es("float32",c),f=es("float32",c),p=ua(e,a),m=ua(t,a),g=so(s,r),x=so(o,i),y=e.length,b=pt(e),v=t.length,w=pt(t);if(p.length+m.length===0)for(let S=0;S<h.length;S++){const I=S%g.length,C=S%x.length,k=n(g[I*2],g[I*2+1],x[C*2],x[C*2+1]);h[S]=k.real,f[S]=k.imag}else for(let S=0;S<h.length;S++){const I=Sa(S,l,d),C=I.slice(-y);p.forEach(P=>C[P]=0);const k=Mr(C,y,b),$=I.slice(-v);m.forEach(P=>$[P]=0);const N=Mr($,v,w),_=n(g[k*2],g[k*2+1],x[N*2],x[N*2+1]);h[S]=_.real,f[S]=_.imag}return[h,f,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IC=En((n,e)=>n+e),vF=s0((n,e,t,s)=>({real:n+t,imag:e+s})),pa=zn(Ca,IC,vF),SF={kernelName:Ca,backendName:"cpu",kernelFunc:pa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r0(n,e,t,s,r){const o=Ce(s),i=ts(r,t);for(let a=0;a<n.length;a++){const c=n[a];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(o>0?i[c]+=e[a]:i[c]+=1)}return i}function kC(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=zt([r,t],e.dtype);for(let a=0;a<r;a++)for(let c=0;c<o;c++){const l=n.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(s?i.set(1,a,l):e.size>0?i.set(i.get(a,l)+e.get(a,c),a,l):i.set(i.get(a,l)+1,a,l))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $C=En((n,e)=>n&e),CF=zn(Bp,$C),NF={kernelName:Bp,backendName:"cpu",kernelFunc:CF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kr(n){return(e,t,s)=>{const r=In(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(n,e,t){const s=Kr(e);return Wo(n,s,t)}function Wo(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;it(i,n);const a=o,c=a.data.get(i.dataId).values;let l;if(i.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=ro(c)}else l=c;const d=t||i.dtype,h=e(l,d,r);return a.makeTensorInfo(i.shape,d,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TC=Kr(n=>Math.ceil(n)),IF=Wo(Ac,TC),kF={kernelName:Ac,backendName:"cpu",kernelFunc:IF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AC(n,e,t,s){const r=In(t,Ce(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const a=Ce(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?ro(i.vals):i.vals;let c=0;for(let l=0;l<i.shape[0];++l){const d=l*e[1]+o;for(let h=0;h<i.shape[1];++h)r[d+h]=a[c++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EC=En((n,e)=>n===e?1:0),RC=zn(Id,EC,null,"bool"),$F={kernelName:Id,backendName:"cpu",kernelFunc:RC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DC=Kr(n=>Math.exp(n)),_C=Wo(Mc,DC,"float32"),TF={kernelName:Mc,backendName:"cpu",kernelFunc:_C};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PC=Kr(n=>Math.expm1(n)),AF=Wo(Fc,PC),EF={kernelName:Fc,backendName:"cpu",kernelFunc:AF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jC=Kr(n=>Math.floor(n)),RF=Wo(Oc,jC),DF={kernelName:Oc,backendName:"cpu",kernelFunc:RF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MC=En((n,e)=>Math.floor(n/e)),_F=zn(Lc,MC,null,"int32"),PF={kernelName:Lc,backendName:"cpu",kernelFunc:_F};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FC(n,e,t,s,r,o,i,a,c){const l=zt([s,o],t);for(let d=0;d<s;d++){const h=[];let f=0;for(let p=0;p<r;p++){const m=n[d*r+p];f+=m*i[p],h.push(m)}if(f<0||f>=c/o)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<o;p++)l.values[d*o+p]=e.get(...e.indexToLoc(f*o+p))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OC(n,e,t){const s=zt(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],c=i[2],l=e.locToIndex([a,c]);i[2]=e.values[l];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LC=En((n,e)=>n>e?1:0),jF=zn(Ad,LC,null,"bool"),MF={kernelName:Ad,backendName:"cpu",kernelFunc:jF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zC=En((n,e)=>n>=e?1:0),FF=zn(zc,zC,null,"bool"),OF={kernelName:zc,backendName:"cpu",kernelFunc:FF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WC=En((n,e)=>n<e?1:0),LF=zn(Rd,WC,null,"bool"),zF={kernelName:Rd,backendName:"cpu",kernelFunc:LF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BC=En((n,e)=>n<=e?1:0),WF=zn(Dd,BC,null,"bool"),BF={kernelName:Dd,backendName:"cpu",kernelFunc:WF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VC(n,e,t){const s=(e-n)/(t-1),r=ts(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC=Kr(n=>Math.log(n)),VF=Wo(Gc,UC),UF={kernelName:Gc,backendName:"cpu",kernelFunc:VF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GC(n,e,t,s){const r=es(s,Ce(t));for(let o=0;o<r.length;++o){const i=o*e;let a=n[i];for(let c=0;c<e;++c){const l=n[i+c];(Number.isNaN(l)||l>a)&&(a=l)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HC=En((n,e)=>Math.max(n,e)),GF=zn(qc,HC),HF={kernelName:qc,backendName:"cpu",kernelFunc:GF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qC=En((n,e)=>Math.min(n,e)),qF=zn(Kc,qC),KF={kernelName:Kc,backendName:"cpu",kernelFunc:qF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o0=En((n,e)=>n*e),QF=s0((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),jh=zn(Xc,o0,QF),XF={kernelName:Xc,backendName:"cpu",kernelFunc:jh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KC(n,e,t){const s=_o(-1,t);return o0([],e,s,n,t)}function JF(n){const{inputs:e,backend:t}=n,{x:s}=e;it(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=KC(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const YF={kernelName:Vd,backendName:"cpu",kernelFunc:JF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QC=En((n,e)=>n!==e?1:0),ZF=zn(Ud,QC,null,"bool"),eO={kernelName:Ud,backendName:"cpu",kernelFunc:ZF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0(n,e,t,s,r){const o=e.length,i=Ce(e),a=pt(e),c=pt(r),l=es(t,Ce(r));for(let d=0;d<i;++d){const h=Sa(d,o,a),f=new Array(h.length);for(let m=0;m<f.length;m++)f[m]=h[s[m]];const p=Mr(f,o,c);l[p]=n[d]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;it(r,"transpose");const i=r.shape.length,a=new Array(i);for(let h=0;h<a.length;h++)a[h]=r.shape[o[h]];const c=s.data.get(r.dataId).values,l=i0(c,r.shape,r.dtype,o,a);return{dataId:s.write(l,a,r.dtype),shape:a,dtype:r.dtype}}const tO={kernelName:Ji,backendName:"cpu",kernelFunc:ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XC(n,e,t,s){const[r,o]=Hn(n,s),i=Ds(e,"int32"),a=ts(Ce(r),i),c=Ce(o);for(let l=0;l<a.length;++l){const d=l*c;let h=1;for(let f=0;f<c;++f)h*=t[d+f];a[l]=h}return{outVals:a,outShape:r,outDtype:i}}function nO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;it(r,"prod");const a=r.shape.length,c=Wt(o,r.shape),l=Sn(c,a);let d=c,h=r;const f=[];l!=null&&(h=ws({inputs:{x:r},backend:t,attrs:{perm:l}}),f.push(h),d=Tn(d.length,a));const p=t.data.get(h.dataId).values,{outVals:m,outShape:g,outDtype:x}=XC(h.shape,h.dtype,p,d);let y=g;return i&&(y=Dn(g,c)),f.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(y,x,m)}const sO={kernelName:Xd,backendName:"cpu",kernelFunc:nO};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rO(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=Sa(r,e.length,pt(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function oO(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function iO(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);oO(t,s);let c=1;for(let l=0;l<e.length-1;++l){c*=e[l];const d=e[l+1];for(let h=1;h<c+1;++h)a[l].push(h*d)}for(let l=0;l<n.length;++l){let d=n[l],h=n[l]+1;for(let f=0;f<t.length;++f){const p=t[f],m=f+e.length-1;if(m>=0){const g=a[m],x=g[g.length-1]-p[d];for(let y=d;y<h;++y)a[m].push(p[y+1]+x)}d=p[d],h=p[h]}h!==d&&(r.push([d,h]),o+=h-d)}return{outSplits:a,valueSlices:r,numValues:o}}function aO(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=In("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function dy(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function cO(n,e,t,s,r,o){const i=dy(e,2)[1],a=dy(o,2)[1];let c=0;for(const l of t)for(let d=l[0];d<l[1];++d){for(let h=0;h<s;++h)r[c*a+h]=n[d*i+h];++c}}function lO(n,e,t,s,r){const o=e.slice();o[0]=r;const i=In(t,Ce(o)),a=n.length,c=a===0?0:a/e[0];return cO(n,e,s,c,i,o),[i,o]}function JC(n,e,t,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(rO(o,i,c),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:d,valueSlices:h,numValues:f}=iO(o,i,n,l),p=aO(d),m=lO(t,s,r,h,f);return[p,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hy=2147483647;function YC(n,e,t,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,c=r.length===0,l=i.length===0,d=[];a||d.push(e[0]),c||d.push(r[0]),l||d.push(i[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const h=d.length===0?1:d[0],f=In("int32",h+1);f[0]=0;for(let x=0;x<h;++x){const y=a?n[0]:n[x],b=c?s[0]:s[x],v=l?o[0]:o[x];if(v===0)throw new Error("Requires delta != 0");let w;if(v>0&&b<y||v<0&&b>y)w=0;else if(w=Math.ceil(Math.abs((b-y)/v)),w>hy)throw new Error(`Requires ((limit - start) / delta) <= ${hy}`);f[x+1]=f[x]+w}const p=f[h],m=In(t,p);let g=0;for(let x=0;x<h;++x){const y=f[x+1]-f[x];let b=a?n[0]:n[x];const v=l?o[0]:o[x];for(let w=0;w<y;++w)m[g++]=b,b+=v}return[f,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Hs=fr;class Ou{constructor(e,t,s,r,o,i,a,c,l,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=Ov(d),this.raggedRank=Lv(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Hs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Hs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Hs.VALUE_ROWIDS:return Ou.getMaxWidthValueRowID(t);case Hs.ROW_SPLITS:return Ou.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Hs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return py(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;zv(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=Fv(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=t)o.push(i);for(let a=r;a<e;++a)o.push(-1);return R(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const c=e[a+1]-e[a];let l=Math.min(r,c),d=t[a];d===-1&&(l=0);for(let h=0;h<l;++h)i.push(d),d+=s;for(let h=0;h<c-l;++h)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let l=t[c];i.push(l);for(let d=1;d<o;++d){const h=e[d];if(h===c)l>=0&&(++a,a<r?l+=s:l=-1);else{if(a=0,c=h,h>=t.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${t.length}`);l=t[h]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Hs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case Hs.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${Hs[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Hs.FIRST_DIM_SIZE:return e[0];case Hs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Hs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Hs[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*s[c+1];const o=py(s,!1),i=In(this.valuesDType,Ce(o));if(r[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,r[l],s[l]);this.setOutput(this.raggedRank,c,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const c=Ce(a),l=t.length;let d=this.defaultValue;if(d.length!==c&&d.length!==1){const m=this.defaultValueShape;ae(()=>{const g=ne(d,m);d=nc(g,a).dataSync()})}let h=0,f=0,p=0;for(let m=0;m<=l;++m){let g=m<l?t[m]:-1;if(g===p){++p;continue}if(f<p){const x=o.subarray(h*c),y=i.subarray(f*c),b=(p-f)*c;fy(y,x,b)}if(m>=l){const x=s.length;g=Math.floor(x/c)}if(g>p)if(this.defaultValue.length===1)i.subarray(p*c,g*c).fill(this.defaultValue[0]),p=g;else for(;g>p;){const x=i.slice(p*c);fy(x,d,c),++p}g<0?(h=m+1,f=p):(h=m,f=p,p=f+1)}}}function fy(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function py(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function ZC(n,e,t,s,r,o,i,a,c,l){return new Ou(n,e,t,s,r,o,i,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eN(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return ts(0,s);const a=Math.abs(Math.ceil((e-n)/t)),c=ts(a,s);e<n&&t===1&&(t=-1),c[0]=n;for(let l=1;l<c.length;l++)c[l]=c[l-1]+t;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tN=Kr(n=>1/Math.sqrt(n)),uO=Wo(nl,tN),dO={kernelName:nl,backendName:"cpu",kernelFunc:uO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ei(n,e,t,s,r,o,i,a,c,l){const d=[s/r,r],h=n.values,f=e.values;if(s===0)return zt(t,e.dtype);const p=c instanceof Kn?c:zt(d,e.dtype);typeof c=="string"||typeof c=="number"?p.values.fill(c):typeof c=="boolean"&&p.values.fill(+c);for(let m=0;m<o;m++){const g=[];let x=0;for(let y=0;y<i;y++){const b=h[m*i+y];g.push(b),x+=b*a[y]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${t}`);for(let y=0;y<r;y++)l?p.values[x*r+y]+=f[m*r+y]:p.values[x*r+y]=e.rank===0?f[0]:f[m*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hO=Kr(n=>1/(1+Math.exp(-n))),nN=on(al,n=>1/(1+Math.exp(-n))),fO={kernelName:al,backendName:"cpu",kernelFunc:nN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sN(n,e,t,s,r){const o=fg(s,e,t),i=Ce(t),a=pt(s);if(o){const h=pg(e,a);return r==="string"?n.slice(h,h+i):n.subarray(h,h+i)}const c=r==="string"?ro(n):n,l=zt(s,r,c),d=zt(t,r);for(let h=0;h<d.size;++h){const f=d.indexToLoc(h),p=f.map((m,g)=>m+e[g]);d.set(l.get(...p),...f)}return r==="string"?i1(d.values):d.values}function bi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;it(r,"slice");const[a,c]=bh(r,o,i);dg(r,a,c);const l=t.data.get(r.dataId).values,d=sN(l,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,d)}const pO={kernelName:nh,backendName:"cpu",kernelFunc:bi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rN(n,e,t,s,r,o,i){const a=e[0],c=o[0],l=new Array(c),d=new Array(a),h=e[1];if(c===0){if(a!==0)throw new Error(qv(a));const x=In(t,0),y=In(r,0);return[x,[0,h],y,l,d]}let f=!0,p=0;const m=new Array(c).fill(0);for(let x=0;x<a;++x){const y=n[x*h];if(y<0)throw new Error(Kv(x,y));if(y>=c)throw new Error(Qv(x,y,c));++m[y],f=f&&y>=p,p=y}let g=!0;for(let x=0;x<c;++x){const y=m[x]===0;l[x]=y,g=g&&!y,m[x]=Math.max(m[x],1),x>0&&(m[x]+=m[x-1])}if(g&&f){const x=n,y=s;for(let b=0;b<a;++b)d[b]=b;return[x,[a,h],y,l,d]}else{const x=m[c-1],y=In(t,x*h),b=In(r,x),v=new Array(c).fill(0);for(let w=0;w<a;++w){const S=n[w*h],I=v[S],C=(S===0?0:m[S-1])+I;v[S]++;for(let k=0;k<h;++k)y[C*h+k]=n[w*h+k];b[C]=s[w],d[w]=C}for(let w=0;w<c;++w)if(v[w]===0){const I=w===0?0:m[w-1];y[I*h+0]=w;for(let C=1;C<h;++C)y[I*h+C]=0;b[I]=i}return[y,[x,h],b,l,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oN(n,e,t,s,r){const o=Ce(s),i=e[0],a=r.length,c=[];let l=1,d=-1;for(let x=0;x<a;++x){const y=r[x];if(y===-1){if(d!==-1)throw new Error(Xv(d,x));d=x,c.push(1)}else{if(y<0)throw new Error(Jv(x,y));l*=y,c.push(y)}}if(d!==-1){if(l<=0)throw new Error(Yv());const x=Math.trunc(o/l);if(l*x!==o)throw new Error(Zv(s,c));c[d]=x}if(Ce(c)!==o)throw new Error(e1(s,c));const f=s.length,p=[];if(f>0){p[f-1]=1;for(let x=f-2;x>=0;--x)p[x]=p[x+1]*s[x+1]}const m=[];if(a>0){m[a-1]=1;for(let x=a-2;x>=0;--x)m[x]=m[x+1]*c[x+1]}const g=In(t,i*a);for(let x=0;x<i;++x){let y=0;for(let b=0;b<f;++b)y+=n[x*f+b]*p[b];for(let b=0;b<a;++b)g[x*a+b]=Math.trunc(y/m[b]),y%=m[b]}return[g,[i,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0(n,e,t,s,r,o=!1,i=0){const a=s.length,c=[e[0],n.length/e[0]],l=c[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(rp());const f=e.slice();f[0]=h;const p=f.reduce((v,w)=>v*w,1),m=In(t,p);if(a===0)return h>0&&m.fill(i),[m,f];if(h<=0)throw new Error(rp());let g=0,x=1,y=0,b=r[g];for(;;){let v=0;if(x<a){if(v=r[x],b===v){++x;continue}if(b>=v)throw new Error(t1())}if(b<0||b>=h)throw new Error(n1(b,h));b>y&&m.fill(i,y*l,b*l);for(let w=g;w<x;++w){const S=s[w];if(S<0||S>=c[0])throw new Error(s1(w,s[w],c[0]));for(let I=0;I<l;I++)m[b*l+I]+=n[S*l+I]}if(o)for(let w=0;w<l;w++)m[b*l+w]/=x-g;if(g=x,++x,y=b+1,b=v,x>a)break}return y<h&&m.fill(i,y*l,h*l),[m,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mO=Kr(n=>Math.sqrt(n)),gO=on(ll,n=>Math.sqrt(n)),xO={kernelName:ll,backendName:"cpu",kernelFunc:gO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iN=En((n,e)=>{const t=n-e;return t*t}),yO=zn(ul,iN),bO={kernelName:ul,backendName:"cpu",kernelFunc:yO};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aN=Kr((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),wO=Wo(xm,aN),vO={kernelName:xm,backendName:"cpu",kernelFunc:wO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cN(n,e,t,s){const r=zt(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let c=0;c<a.length;c++)a[c]=i[c]*t[c]+s[c];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SO{constructor(e,t,s,r,o,i){this.separator=wo(e),this.nGramWidths=t,this.leftPad=wo(s),this.rightPad=wo(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let a=0;a<o;++a){const c=this.getPadWidth(i),l=Math.max(0,c-a),d=Math.max(0,c-(o-(a+1))),h=i-(l+d),f=t+(l>0?0:a-c);let p=0;p+=l*this.leftPad.length;for(let b=0;b<h;++b)p+=e[f+b].length;p+=d*this.rightPad.length;const m=l+d+h-1;p+=m*this.separator.length,s[r+a]=new Uint8Array(p);const g=s[r+a];let x=0;const y=b=>b.forEach(v=>g[x++]=v);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<h-1;++b)y(e[f+b]),y(this.separator);if(h>0){y(e[f+h-1]);for(let b=0;b<d;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<d-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<r;++l){let d=t[l]>=c;if(d=d&&t[l]<=s,!d)throw new Error(`Invalid split value ${t[l]}, must be in [${c}, ${s}]`);c=t[l]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const o=r-1,i=In("int32",r);if(s===0||r===0){const c=new Array(s);for(let l=0;l<=o;++l)i[l]=0;return[c,i]}i[0]=0;for(let c=1;c<=o;++c){const l=t[c]-t[c-1];let d=0;this.nGramWidths.forEach(h=>{d+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&d===0&&(d=1),i[c]=i[c-1]+d}const a=new Array(i[o]);for(let c=0;c<o;++c){const l=t[c];let d=i[c];if(this.nGramWidths.forEach(h=>{const f=t[c+1]-t[c],p=this.getNumNGrams(f,h);this.createNGrams(e,l,a,d,p,h),d+=p}),this.preserveShort&&d===i[c]){const h=t[c+1]-t[c];if(h===0)continue;const f=h+2*this.padWidth;this.createNGrams(e,l,a,d,1,f)}}return[a,i]}}function lN(n,e,t,s,r,o,i,a){return new SO(t,s,r,o,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CO(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function uN(n,e,t){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let f=0;f<s;++f){const p=r.length;CO(n[f],e,t,r);const m=r.length-p;a[f]=m,o+=m,i=Math.max(i,m)}const c=In("int32",o*2),l=new Array(o),d=[s,i];let h=0;for(let f=0;f<s;++f)for(let p=0;p<a[f];++p)c[h*2]=f,c[h*2+1]=p,l[h]=r[h],++h;return[c,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dN(n,e){const t=In("int32",n.length);for(let s=0;s<n.length;++s)t[s]=F$(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hN=En((n,e)=>n-e),NO=s0((n,e,t,s)=>({real:n-t,imag:e-s})),c0=zn(dl,hN,NO),IO={kernelName:dl,backendName:"cpu",kernelFunc:c0};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fN(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=zt(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let c=0;c<i.length;c++)i[c]=o[c]%n.shape[c];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ka=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function pN(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,c=e-t+1,l=Math.log(a),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(a-d)/a)*Math.sign(c-a/2),f=Math.max(t,Math.floor(e-c*d/a+h)),p=Math.min(s,Math.floor(e+(a-c)*d/a+h));pN(n,e,f,p)}const r=n[e];let o=t,i=s;for(Ui(n,t,e),Ka(n[s],r)>0&&Ui(n,t,s);o<i;){for(Ui(n,o,i),o++,i--;Ka(n[o],r)<0;)o=o+1;for(;Ka(n[i],r)>0;)i=i-1}Ka(n[t],r)===0?Ui(n,t,i):(i=i+1,Ui(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function mN(n,e,t,s,r){const o=e[e.length-1],[i,a]=[n.length/o,o],c=es(t,i*s),l=es("int32",i*s);for(let h=0;h<i;h++){const f=h*a,p=n.subarray(f,f+a);let m=new Array(p.length);p.forEach((b,v)=>m[v]={value:b,index:v}),s<m.length&&(pN(m,s),m=m.slice(0,s)),r&&m.sort(Ka);const g=h*s,x=c.subarray(g,g+s),y=l.subarray(g,g+s);for(let b=0;b<s;b++)x[b]=m[b].value,y[b]=m[b].index}const d=e.slice();return d[d.length-1]=s,[zt(d,t,c),zt(d,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gN(n,e,t,s){const r=Wt(e,t)[0],o=[1,t[0],1];for(let m=0;m<r;m++)o[0]*=t[m];o[1]=t[r];for(let m=r+1;m<t.length;m++)o[2]*=t[m];const i=new Map,a=new Int32Array(t[r]),c=new Kn(o,s,n),l=[],d=o[0]===1&&o[2]===1;for(let m=0;m<t[r];m++){let g;if(d)g=n[m].toString();else{const y=[];for(let b=0;b<o[0];b++)for(let v=0;v<o[2];v++)y.push(c.get(b,m,v));g=y.join(",")}const x=i.get(g);if(x!=null)a[m]=x;else{const y=i.size;i.set(g,y),a[m]=y,l.push(m)}}const h=o.slice();h[1]=i.size;const f=new Kn(h,s);l.forEach((m,g)=>{for(let x=0;x<o[0];x++)for(let y=0;y<o[2];y++)f.set(c.get(x,m,y),x,g,y)});const p=t.slice();return p[r]=h[1],{outputValues:f.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kO=Object.freeze(Object.defineProperty({__proto__:null,addImpl:IC,bincountImpl:r0,bincountReduceImpl:kC,bitwiseAndImpl:$C,castImpl:NC,ceilImpl:TC,concatImpl:AC,equalImpl:EC,expImpl:DC,expm1Impl:PC,floorDivImpl:MC,floorImpl:jC,gatherNdImpl:FC,gatherV2Impl:OC,greaterEqualImpl:zC,greaterImpl:LC,lessEqualImpl:BC,lessImpl:WC,linSpaceImpl:VC,logImpl:UC,maxImpl:GC,maximumImpl:HC,minimumImpl:qC,multiplyImpl:o0,negImpl:KC,notEqualImpl:QC,prodImpl:XC,raggedGatherImpl:JC,raggedRangeImpl:YC,raggedTensorToTensorImpl:ZC,rangeImpl:eN,rsqrtImpl:tN,scatterImpl:ei,sigmoidImpl:hO,simpleAbsImpl:CC,sliceImpl:sN,sparseFillEmptyRowsImpl:rN,sparseReshapeImpl:oN,sparseSegmentReductionImpl:a0,sqrtImpl:mO,squaredDifferenceImpl:iN,staticRegexReplaceImpl:aN,stridedSliceImpl:cN,stringNGramsImpl:lN,stringSplitImpl:uN,stringToHashBucketFastImpl:dN,subImpl:hN,tileImpl:fN,topKImpl:mN,transposeImpl:i0,uniqueImpl:gN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Pw("cpu",()=>new Ph,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xN=on(Pc,n=>n>=0?n:Math.exp(n)-1),$O={kernelName:Pc,backendName:"cpu",kernelFunc:xN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;it([r],"leakyRelu");const i=Ce(r.shape),a=t.data.get(r.dataId).values,c=es("float32",i);for(let l=0;l<a.length;l++)c[l]=a[l]<0?o*a[l]:a[l];return t.makeTensorInfo(r.shape,"float32",c)}const TO={kernelName:Ed,backendName:"cpu",kernelFunc:yN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AO=En((n,e)=>n<0?e*n:n);function bN(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;it([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[a,c]=AO(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(c,"float32",a)}const EO={kernelName:Qd,backendName:"cpu",kernelFunc:bN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wN=on(Zc,n=>Math.max(0,n)),RO={kernelName:Zc,backendName:"cpu",kernelFunc:wN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vN=on(el,n=>Math.min(Math.max(0,n),6)),DO={kernelName:el,backendName:"cpu",kernelFunc:vN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lu(n,e,t,s,r){if(t==="linear")return qr({inputs:{x:e},backend:n});if(t==="relu")return wN({inputs:{x:e},backend:n});if(t==="elu")return xN({inputs:{x:e},backend:n});if(t==="relu6")return vN({inputs:{x:e},backend:n});if(t==="prelu")return bN({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return yN({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return nN({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=Ce(r.shape),a=zb(o,i),c=Ce(a);R(i===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const l=t.data.get(r.dataId);if(l.complexTensorInfos!=null){const d=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;d.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const _O={kernelName:Jd,backendName:"cpu",kernelFunc:fn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SN(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;it([r,o],"matMul");const c=r.shape.length,l=o.shape.length,d=i?r.shape[c-2]:r.shape[c-1],h=a?o.shape[l-1]:o.shape[l-2],f=i?r.shape[c-1]:r.shape[c-2],p=a?o.shape[l-2]:o.shape[l-1],m=r.shape.slice(0,-2),g=o.shape.slice(0,-2),x=Ce(m),y=Ce(g),v=_t(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,p]);R(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const w=i?[x,d,f]:[x,f,d],S=a?[y,p,h]:[y,h,p],I=fn({inputs:{x:r},backend:t,attrs:{shape:w}}),C=fn({inputs:{x:o},backend:t,attrs:{shape:S}}),k=i?I.shape[1]:I.shape[2],$=i?I.shape[2]:I.shape[1],N=a?C.shape[1]:C.shape[2],_=Math.max(x,y),P=t.data.get(I.dataId).values,j=t.data.get(C.dataId).values,A=pt(I.shape),F=pt(C.shape),[M,K,D]=i?[A[0],1,A[1]]:[A[0],A[1],1],[G,te,W]=a?[1,F[1],F[0]]:[F[1],1,F[0]],de=$*N,le=zt([_,$,N],I.dtype),oe=le.values,ge=t.blockSize;for(let Ae=0;Ae<_;Ae++){const Ue=Ae%x,Pe=Ae%y;for(let Ne=0;Ne<$;Ne+=ge){const Ye=Math.min(Ne+ge,$);for(let at=0;at<N;at+=ge){const mt=Math.min(at+ge,N);for(let wt=0;wt<k;wt+=ge){const kt=Math.min(wt+ge,k);for(let dt=Ne;dt<Ye;dt++)for(let ue=at;ue<mt;ue++){let xe=0;for(let Q=wt;Q<kt;Q++){const fe=P[Ue*M+dt*K+Q*D],Z=j[Q*G+ue*te+Pe*W];xe+=fe*Z}oe[Ae*de+(dt*N+ue)]+=xe}}}}}return t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(C),t.makeTensorInfo(v,le.dtype,le.values)}const PO={kernelName:md,backendName:"cpu",kernelFunc:SN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jO(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;let f,p,m;const g=[];f=SN({inputs:{a:r,b:o},attrs:{transposeA:c,transposeB:l},backend:t}),i&&(p=pa({inputs:{a:f,b:i},backend:t}),g.push(f),f=p),d&&(m=Lu(t,f,d,a,h),g.push(f),f=m);for(const y of g)t.disposeIntermediateTensorInfo(y);return f}const MO={kernelName:gu,backendName:"cpu",kernelFunc:jO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FO=on(vc,n=>Math.acos(n)),OO={kernelName:vc,backendName:"cpu",kernelFunc:FO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LO=on(Sc,n=>Math.acosh(n)),zO={kernelName:Sc,backendName:"cpu",kernelFunc:LO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WO(n){const{inputs:e,backend:t}=n,s=e;it(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),o=zt(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const c=r[a];for(let l=0;l<i.length;l++)i[l]+=c[l]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const BO={kernelName:Mp,backendName:"cpu",kernelFunc:WO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;it(r,"all");const a=Wt(o,r.shape);let c=a;const l=Sn(c,r.shape.length);let d=r;l!=null&&(d=ws({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Xn("all",c,d.shape.length);const[h,f]=Hn(d.shape,c),p=Ce(f),m=ts(Ce(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*p;let v=g[b];for(let w=0;w<p;++w){const S=g[b+w];v=v&&S}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=Dn(h,a),b=fn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const UO={kernelName:Fp,backendName:"cpu",kernelFunc:VO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;it(r,"any");const a=Wt(o,r.shape);let c=a;const l=Sn(c,r.shape.length);let d=r;l!=null&&(d=ws({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Xn("any",c,d.shape.length);const[h,f]=Hn(d.shape,c),p=Ce(f),m=ts(Ce(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*p;let v=g[b];for(let w=0;w<p;++w){const S=g[b+w];v=v||S}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=Dn(h,a),b=fn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const HO={kernelName:Op,backendName:"cpu",kernelFunc:GO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;it(r,"argMax");let i=Wt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),i=[i[0]],Xn("argMax",i,c.shape.length);const[d,h]=Hn(c.shape,i),f=Ce(d),p=ts(f,"int32"),m=Ce(h),g=t.data.get(c.dataId).values;for(let x=0;x<p.length;++x){const y=x*m;let b=g[y],v=0;for(let w=0;w<m;++w){const S=g[y+w];S>b&&(b=S,v=w)}p[x]=v}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",p)}const KO={kernelName:dd,backendName:"cpu",kernelFunc:qO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;it(r,"argMin");let i=Wt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=ws({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),i=[i[0]],Xn("argMin",i,c.shape.length);const[d,h]=Hn(c.shape,i),f=Ce(d),p=ts(f,"int32"),m=Ce(h),g=t.data.get(c.dataId).values;for(let x=0;x<p.length;++x){const y=x*m;let b=g[y],v=0;for(let w=0;w<m;++w){const S=g[y+w];S<b&&(b=S,v=w)}p[x]=v}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",p)}const XO={kernelName:hd,backendName:"cpu",kernelFunc:QO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JO=on(Cc,n=>Math.asin(n)),YO={kernelName:Cc,backendName:"cpu",kernelFunc:JO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZO=on(Nc,n=>Math.asinh(n)),eL={kernelName:Nc,backendName:"cpu",kernelFunc:ZO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tL=on(Ic,n=>Math.atan(n)),nL={kernelName:Ic,backendName:"cpu",kernelFunc:tL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sL=En((n,e)=>Math.atan2(n,e)),rL=zn($c,sL),oL={kernelName:$c,backendName:"cpu",kernelFunc:rL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iL=on(kc,n=>Math.atanh(n)),aL={kernelName:kc,backendName:"cpu",kernelFunc:iL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0(n,e,t,s,r,o){const i=r.strideHeight,a=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=zt(r.outShape,t),x=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let w=0;w<r.batchSize;++w){const S=w*y,I=w*s[0];for(let C=0;C<r.inChannels;++C)for(let k=0;k<r.outHeight;++k){const $=k*i-f,N=Math.max(0,$),_=Math.min(r.inHeight,d+$),P=S+k*b;for(let j=0;j<r.outWidth;++j){const A=j*a-p,F=Math.max(0,A),M=Math.min(r.inWidth,h+A);let K=m,D=0,G=0;for(let W=N;W<_;W+=c){const de=I+W*s[1];for(let le=F;le<M;le+=l){const oe=de+le*s[2],ge=n[oe+C];o==="max"&&ge>K?K=ge:o==="avg"&&(D+=ge,G++)}if(isNaN(K))break}const te=P+j*v+C;x[te]=o==="avg"?D/G:K}}}return g}function CN(n,e,t,s,r=!1,o=!1){const i=zt(s.outShape,"int32"),a=s.strideHeight,c=s.strideWidth,l=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,f=s.effectiveFilterWidth,p=s.padInfo.top,m=s.padInfo.left,g=zt(e,t,n);for(let x=0;x<s.batchSize;++x)for(let y=0;y<s.inChannels;++y)for(let b=0;b<s.outHeight;++b){const v=b*a-p;let w=v;for(;w<0;)w+=l;const S=Math.min(s.inHeight,h+v);for(let I=0;I<s.outWidth;++I){const C=I*c-m;let k=C;for(;k<0;)k+=d;const $=Math.min(s.inWidth,f+C);let N=Number.NEGATIVE_INFINITY,_=-1;for(let P=w;P<S;P+=l){const j=P-v;for(let A=k;A<$;A+=d){const F=A-C,M=g.get(x,P,A,y);M>N&&(N=M,r?_=o?((x*s.inHeight+P)*s.inWidth+A)*s.inChannels+y:(P*s.inWidth+A)*s.inChannels+y:_=j*f+F)}}i.set(_,x,b,I,y)}}return i}function NN(n,e,t,s,r,o){const i=r.strideDepth,a=r.strideHeight,c=r.strideWidth,l=r.dilationDepth,d=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,p=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=zt(r.outShape,t),w=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],k=r.outShape[4];for(let $=0;$<r.batchSize;++$){const N=$*S,_=$*s[0];for(let P=0;P<r.inChannels;++P)for(let j=0;j<r.outDepth;++j){const A=j*i-g;let F=A;for(;F<0;)F+=l;const M=Math.min(r.inDepth,f+A),K=N+j*I;for(let D=0;D<r.outHeight;++D){const G=D*a-x;let te=G;for(;te<0;)te+=d;const W=Math.min(r.inHeight,p+G),de=K+D*C;for(let le=0;le<r.outWidth;++le){const oe=le*c-y;let ge=oe;for(;ge<0;)ge+=h;const Ae=Math.min(r.inWidth,m+oe),Ue=de+le*k;let Pe=b,Ne=0,Ye=0;for(let mt=F;mt<M;mt+=l){const wt=_+mt*s[1];for(let kt=te;kt<W;kt+=d){const dt=wt+kt*s[2];for(let ue=ge;ue<Ae;ue+=h){const xe=dt+ue*s[3],Q=n[xe+P];if(o==="max"&&Q>Pe?Pe=Q:o==="avg"&&(Ne+=Q,Ye++),isNaN(Pe))break}if(isNaN(Pe))break}if(isNaN(Pe))break}const at=Ue+P;w[at]=o==="avg"?Ne/Math.max(Ye,1):Pe}}}}return v}function cL(n,e){const t=zt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let x=0;x<e.inChannels;++x)for(let y=0;y<e.outDepth;++y){const b=y*s-f;let v=b;for(;v<0;)v+=i;const w=Math.min(e.inDepth,l+b);for(let S=0;S<e.outHeight;++S){const I=S*r-p;let C=I;for(;C<0;)C+=a;const k=Math.min(e.inHeight,d+I);for(let $=0;$<e.outWidth;++$){const N=$*o-m;let _=N;for(;_<0;)_+=c;const P=Math.min(e.inWidth,h+N);let j=Number.NEGATIVE_INFINITY,A=-1;for(let F=v;F<w;F+=i){const M=F-b;for(let K=C;K<k;K+=a){const D=K-I;for(let G=_;G<P;G+=c){const te=G-N,W=n.get(g,F,K,G,x);W>=j&&(j=W,A=M*d*h+D*d+te)}}}t.set(A,g,y,S,$,x)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;it(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(ss(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=sr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&nn(d.inShape,d.outShape))h=qr({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,p=pt(r.shape),m=l0(f,r.shape,r.dtype,p,d,"avg");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const uL={kernelName:fd,backendName:"cpu",kernelFunc:lL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;it(r,"avgPool3d");const d=ao(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,f=NN(h,r.shape,r.dtype,pt(r.shape),d,"avg");return t.makeTensorInfo(f.shape,"float32",f.values)}const hL={kernelName:pd,backendName:"cpu",kernelFunc:dL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;it([r,o],"avgPool3DGrad");const d=ao(o.shape,i,a,1,c,l),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,x=d.filterWidth,y=d.dilationDepth,b=d.dilationHeight,v=d.dilationWidth,w=d.effectiveFilterDepth,S=d.effectiveFilterHeight,I=d.effectiveFilterWidth,C=w-1-d.padInfo.front,k=I-1-d.padInfo.left,$=S-1-d.padInfo.top,N=zt(o.shape,"float32"),_=1/(m*g*x),P=t.bufferSync(r);for(let j=0;j<d.batchSize;++j)for(let A=0;A<d.inChannels;++A)for(let F=0;F<d.inDepth;++F)for(let M=0;M<d.inHeight;++M)for(let K=0;K<d.inWidth;++K){const D=F-C,G=M-$,te=K-k;let W=0;for(let de=0;de<w;de+=y){const le=(D+de)/h;if(!(le<0||le>=d.outDepth||Math.floor(le)!==le))for(let oe=0;oe<S;oe+=b){const ge=(G+oe)/f;if(!(ge<0||ge>=d.outHeight||Math.floor(ge)!==ge))for(let Ae=0;Ae<I;Ae+=v){const Ue=(te+Ae)/p;if(Ue<0||Ue>=d.outWidth||Math.floor(Ue)!==Ue)continue;const Pe=P.get(j,le,ge,Ue,A);W+=Pe}}}N.set(W*_,j,F,M,K,A)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const pL={kernelName:zp,backendName:"cpu",kernelFunc:fL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;it([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=sr(i.shape,a,c,1,l),h=d.strideHeight,f=d.strideWidth,p=d.filterHeight,m=d.filterWidth,g=d.dilationHeight,x=d.dilationWidth,y=d.effectiveFilterHeight,b=d.effectiveFilterWidth,v=b-1-d.padInfo.left,w=y-1-d.padInfo.top,S=zt(i.shape,"float32"),I=1/(p*m),C=t.data.get(r.dataId).values,k=zt(r.shape,"float32",C);for(let $=0;$<d.batchSize;++$)for(let N=0;N<d.inChannels;++N)for(let _=0;_<d.inHeight;++_)for(let P=0;P<d.inWidth;++P){const j=_-w,A=P-v;let F=0;for(let M=0;M<y;M+=g){const K=(j+M)/h;if(!(K<0||K>=d.outHeight||Math.floor(K)!==K))for(let D=0;D<b;D+=x){const G=(A+D)/f;if(G<0||G>=d.outWidth||Math.floor(G)!==G)continue;const te=k.get($,K,G,N);F+=te}}S.set(F*I,$,_,P,N)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const gL={kernelName:Lp,backendName:"cpu",kernelFunc:mL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:c}=e;R(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),it([r,a,c,o,i],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const d=t.data.get(r.dataId).values,h=t.data.get(a.dataId).values,f=t.data.get(c.dataId).values,p=o?t.data.get(o.dataId).values:new Float32Array([1]),m=i?t.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(d.length),x=m.length,y=p.length,b=f.length,v=h.length;let w=0,S=0,I=0,C=0;for(let k=0;k<d.length;++k)g[k]=m[w++]+(d[k]-h[S++])*p[I++]/Math.sqrt(f[C++]+l),w>=x&&(w=0),S>=v&&(S=0),I>=y&&(I=0),C>=b&&(C=0);return t.makeTensorInfo(r.shape,r.dtype,g)}const yL={kernelName:$d,backendName:"cpu",kernelFunc:xL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;it([r],"batchToSpaceND");const a=o.reduce((y,b)=>y*b),c=vl(r.shape,o,a),l=Sl(c.length,o.length),d=Cl(r.shape,o,a),h=bg(i,o.length),f=wg(d,i,o.length),p=fn({inputs:{x:r},backend:t,attrs:{shape:c}}),m=ws({inputs:{x:p},backend:t,attrs:{perm:l}}),g=fn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=bi({inputs:{x:g},backend:t,attrs:{begin:h,size:f}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const wL={kernelName:gd,backendName:"cpu",kernelFunc:bL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=r0(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const SL={kernelName:Wp,backendName:"cpu",kernelFunc:vL};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=_t(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const NL={kernelName:Hb,backendName:"cpu",kernelFunc:CL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL=on(Ec,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),kL={kernelName:Ec,backendName:"cpu",kernelFunc:IL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $L=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(Ce(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values;for(let l=0;l<a.length;l++){const d=a[l],h=c[l];s[l]=Math.hypot(d,h)}return t.makeOutput(s,e.shape,"float32")},TL={kernelName:xd,backendName:"cpu",kernelFunc:$L};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ma(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const AL={kernelName:om,backendName:"cpu",kernelFunc:ma};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ga(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Wt(r,e[0].shape)[0],i=e.map(g=>g.shape);gg(i,o);let a=Or(e.map(g=>g.shape),o);if(Ce(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(g=>Ce(g.shape)>0);if(c.length===1)return qr({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){const g=c.map(w=>yi({inputs:{input:w},backend:t})),x=c.map(w=>ma({inputs:{input:w},backend:t})),y=ga({inputs:g,backend:t,attrs:{axis:o}}),b=ga({inputs:x,backend:t,attrs:{axis:o}}),v=Ts({inputs:{real:y,imag:b},backend:t});return g.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),v}const l=c.map(g=>{const y=[-1,Ce(g.shape.slice(o))];return fn({inputs:{x:g},backend:t,attrs:{shape:y}})}),d=l.map(g=>({vals:t.data.get(g.dataId).values,shape:g.shape}));a=Or(l.map(g=>g.shape),1);const h=l[0].shape[0]===1,f=AC(d,a,e[0].dtype,h),p=Or(c.map(g=>g.shape),o),m=t.makeTensorInfo(p,e[0].dtype,f);return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const EL={kernelName:yd,backendName:"cpu",kernelFunc:ga};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s;it([r,o],"conv2d");const h=co(c),f=Qn(r.shape,o.shape,i,l,a,d,!1,h),p=f.filterHeight,m=f.filterWidth,g=f.dilationHeight,x=f.dilationWidth,y=f.padInfo.left,b=f.padInfo.top,v=f.dataFormat==="channelsLast",w=new Kn(f.outShape,r.dtype),S=pt(r.shape),I=pt(o.shape),C=S[0],k=v?S[1]:S[2],$=v?S[2]:1,N=v?1:S[1],_=w.strides[0],P=v?w.strides[1]:w.strides[2],j=v?w.strides[2]:1,A=v?1:w.strides[1],F=t.data.get(r.dataId).values,M=t.data.get(o.dataId).values,K=w.values;for(let D=0;D<f.batchSize;++D){const G=D*C,te=D*_;for(let W=0;W<f.outHeight;++W){const de=te+W*P,le=W*f.strideHeight-b;for(let oe=0;oe<p;++oe){const ge=le+oe*g;if(ge<0||ge>=f.inHeight)continue;const Ae=oe*I[0],Ue=G+ge*k;for(let Pe=0;Pe<f.outWidth;++Pe){const Ne=de+Pe*j,Ye=Pe*f.strideWidth-y;for(let at=0;at<m;++at){const mt=Ye+at*x;if(mt<0||mt>=f.inWidth)continue;const wt=Ae+at*I[1],kt=Ue+mt*$;let dt=wt;for(let ue=0;ue<f.inChannels;++ue){const xe=F[kt+ue*N];for(let Q=0;Q<f.outChannels;++Q)K[Ne+Q*A]+=xe*M[dt+Q];dt+=f.outChannels}}}}}}return t.makeTensorInfo(w.shape,w.dtype,K)}const RL={kernelName:bd,backendName:"cpu",kernelFunc:IN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s;it([r,o],"conv2dBackpropFilter");const h=co(c),f=Qn(r.shape,d,i,1,a,l,!1,h),{strideHeight:p,strideWidth:m,filterHeight:g,filterWidth:x}=f,y=f.dataFormat==="channelsLast",b=new Kn(f.filterShape,"float32"),v=f.padInfo.left,w=f.padInfo.top,S=t.data.get(r.dataId).values,I=t.data.get(o.dataId).values,C=new Kn(r.shape,r.dtype,S),k=new Kn(o.shape,o.dtype,I);for(let $=0;$<g;++$){const N=Math.max(0,Math.ceil((w-$)/p)),_=Math.min(f.outHeight,(f.inHeight+w-$)/p);for(let P=0;P<x;++P){const j=Math.max(0,Math.ceil((v-P)/m)),A=Math.min(f.outWidth,(f.inWidth+v-P)/m);for(let F=0;F<f.inChannels;++F)for(let M=0;M<f.outChannels;++M){let K=0;for(let D=0;D<f.batchSize;++D)for(let G=N;G<_;++G){const te=$+G*p-w;for(let W=j;W<A;++W){const de=P+W*m-v;y?K+=C.get(D,te,de,F)*k.get(D,G,W,M):K+=C.get(D,F,te,de)*k.get(D,M,G,W)}}b.set(K,$,P,F,M)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const _L={kernelName:Up,backendName:"cpu",kernelFunc:DL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s;it([r,o],"conv2dBackpropInput");const h=pt(o.shape),f=pt(r.shape);let p=co(l);const m=Qn(i,o.shape,a,1,c,d,!1,p),g=new Kn(m.inShape,"float32"),x=g.values,y=t.data.get(r.dataId).values,b=t.data.get(o.dataId).values,[v,w,S]=h,{batchSize:I,filterHeight:C,filterWidth:k,inChannels:$,inHeight:N,inWidth:_,outChannels:P,outHeight:j,outWidth:A,strideHeight:F,strideWidth:M}=m;p=m.dataFormat;const K=C-1-m.padInfo.top,D=k-1-m.padInfo.left,G=p==="channelsLast",te=g.strides[0],W=G?g.strides[1]:g.strides[2],de=G?g.strides[2]:1,le=G?1:g.strides[1],oe=f[0],ge=G?f[1]:f[2],Ae=G?f[2]:1,Ue=G?1:f[1];for(let Pe=0;Pe<I;++Pe)for(let Ne=0;Ne<$;++Ne)for(let Ye=0;Ye<N;++Ye){const at=Ye-K,mt=Math.max(0,Math.ceil(at/F)),wt=Math.min(j,(C+at)/F);for(let kt=0;kt<_;++kt){const dt=kt-D,ue=Math.max(0,Math.ceil(dt/M)),xe=Math.min(A,(k+dt)/M);let Q=0;for(let Z=mt;Z<wt;++Z){const Fe=Z*F-at;for(let Ge=ue;Ge<xe;++Ge){const Le=Ge*M-dt,ut=oe*Pe+ge*Z+Ae*Ge,ye=v*(C-1-Fe)+w*(k-1-Le)+S*Ne;for(let Ve=0;Ve<P;++Ve){const lt=y[ut+Ue*Ve],B=b[ye+Ve];Q+=lt*B}}}const fe=te*Pe+W*Ye+de*kt+le*Ne;x[fe]=Q}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const jL={kernelName:wd,backendName:"cpu",kernelFunc:PL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ML(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s;it([r,o],"conv3d");const l=jo(r.shape,o.shape,i,c,a),{filterDepth:d,filterHeight:h,filterWidth:f,dilationDepth:p,dilationHeight:m,dilationWidth:g,padInfo:x}=l,y=x.front,b=x.left,v=x.top,w=new Kn(l.outShape,r.dtype),S=t.data.get(r.dataId).values,I=t.data.get(o.dataId).values,C=w.values,k=pt(r.shape),$=pt(o.shape);for(let N=0;N<l.batchSize;++N){const _=N*k[0],P=N*w.strides[0];for(let j=0;j<l.outDepth;++j){const A=P+j*w.strides[1],F=j*l.strideDepth-y;for(let M=0;M<d;++M){const K=F+M*p;if(K<0||K>=l.inDepth)continue;const D=M*$[0],G=_+K*k[1];for(let te=0;te<l.outHeight;++te){const W=A+te*w.strides[2],de=te*l.strideHeight-v;for(let le=0;le<h;++le){const oe=de+le*m;if(oe<0||oe>=l.inHeight)continue;const ge=D+le*$[1],Ae=G+oe*k[2];for(let Ue=0;Ue<l.outWidth;++Ue){const Pe=W+Ue*l.outChannels,Ne=Ue*l.strideWidth-b;for(let Ye=0;Ye<f;++Ye){const at=Ne+Ye*g;if(at<0||at>=l.inWidth)continue;const mt=ge+Ye*$[2],wt=Ae+at*l.inChannels;let kt=mt;for(let dt=0;dt<l.inChannels;++dt){const ue=S[wt+dt];for(let xe=0;xe<l.outChannels;++xe)C[Pe+xe]+=ue*I[kt+xe];kt+=l.outChannels}}}}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const FL={kernelName:vd,backendName:"cpu",kernelFunc:ML};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s;it([r,o],"conv3dBackpropFilterV2");const l=pt(r.shape),d=pt(o.shape),h=jo(r.shape,c,i,1,a),f=h.strideDepth,p=h.strideHeight,m=h.strideWidth,g=h.filterDepth,x=h.filterHeight,y=h.filterWidth,b=new Kn(h.filterShape,"float32"),v=b.values,[w,S,I,C]=b.strides,k=t.data.get(o.dataId).values,[$,N,_,P]=d,j=t.data.get(r.dataId).values,[A,F,M,K]=l,D=h.padInfo.front,G=h.padInfo.left,te=h.padInfo.top;for(let W=0;W<g;++W){const de=Math.max(0,Math.ceil((D-W)/f)),le=Math.min(h.outDepth,(h.inDepth+D-W)/f),oe=W*w;for(let ge=0;ge<x;++ge){const Ae=Math.max(0,Math.ceil((te-ge)/p)),Ue=Math.min(h.outHeight,(h.inHeight+te-ge)/p),Pe=ge*S+oe;for(let Ne=0;Ne<y;++Ne){const Ye=Math.max(0,Math.ceil((G-Ne)/m)),at=Math.min(h.outWidth,(h.inWidth+G-Ne)/m),mt=Ne*I+Pe;for(let wt=0;wt<h.inChannels;++wt){const kt=wt*C+mt;for(let dt=0;dt<h.outChannels;++dt){let ue=0;for(let xe=0;xe<h.batchSize;++xe){const Q=xe*A,fe=xe*$;for(let Z=de;Z<le;++Z){const Ge=(W+Z*f-D)*F+Q,Le=Z*N+fe;for(let ut=Ae;ut<Ue;++ut){const Ve=(ge+ut*p-te)*M+Ge,lt=ut*_+Le;for(let B=Ye;B<at;++B){const U=(Ne+B*m-G)*K+Ve,V=B*P+lt;ue+=j[U+wt]*k[V+dt]}}}}v[kt+dt]=ue}}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const LL={kernelName:Gp,backendName:"cpu",kernelFunc:OL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s;it([r],"conv3dBackpropInputV2");const l=pt(r.shape),d=pt(o.shape),h=jo(c,o.shape,a,1,i),f=new Kn(h.inShape,"float32"),p=f.values,[m,g,x,y]=f.strides,b=t.data.get(r.dataId).values,[v,w,S,I]=l,C=t.data.get(o.dataId).values,[k,$,N,_]=d,{batchSize:P,filterDepth:j,filterHeight:A,filterWidth:F,inChannels:M,inDepth:K,inHeight:D,inWidth:G,outChannels:te,outDepth:W,outHeight:de,outWidth:le,strideDepth:oe,strideHeight:ge,strideWidth:Ae}=h,Ue=j-1-h.padInfo.front,Pe=A-1-h.padInfo.top,Ne=F-1-h.padInfo.left;for(let Ye=0;Ye<P;++Ye)for(let at=0;at<M;++at)for(let mt=0;mt<K;++mt){const wt=mt-Ue,kt=Math.max(0,Math.ceil(wt/oe)),dt=Math.min(W,(j+wt)/oe);for(let ue=0;ue<D;++ue){const xe=ue-Pe,Q=Math.max(0,Math.ceil(xe/ge)),fe=Math.min(de,(A+xe)/ge);for(let Z=0;Z<G;++Z){const Fe=Z-Ne,Ge=Math.max(0,Math.ceil(Fe/Ae)),Le=Math.min(le,(F+Fe)/Ae);let ut=0;for(let ye=kt;ye<dt;++ye){const Ve=ye*oe-wt;for(let lt=Q;lt<fe;++lt){const B=lt*ge-xe;for(let L=Ge;L<Le;++L){const U=L*Ae-Fe,V=v*Ye+w*ye+S*lt+I*L,ce=k*(j-1-Ve)+$*(A-1-B)+N*(F-1-U)+_*at;for(let ie=0;ie<te;++ie){const O=b[V+ie],q=C[ce+ie];ut+=O*q}}}}p[m*Ye+g*mt+x*ue+y*Z+at]=ut}}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const WL={kernelName:Hp,backendName:"cpu",kernelFunc:zL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BL=on(Rc,n=>Math.cos(n)),VL={kernelName:Rc,backendName:"cpu",kernelFunc:BL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UL=on(Dc,n=>Math.cosh(n)),GL={kernelName:Dc,backendName:"cpu",kernelFunc:UL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,[d,h,f,p]=r.shape,m=o.shape[0],[g,x]=a,y=zt([m,g,x,p],"float32"),b=t.data.get(o.dataId).values,v=t.data.get(i.dataId).values,w=t.data.get(r.dataId).values,S=pt(r.shape),I=pt(y.shape);for(let C=0;C<m;C++){const k=C*4,$=b[k],N=b[k+1],_=b[k+2],P=b[k+3],j=v[C];if(j>=d)continue;const A=g>1?(_-$)*(h-1)/(g-1):0,F=x>1?(P-N)*(f-1)/(x-1):0;for(let M=0;M<g;M++){const K=g>1?$*(h-1)+M*A:.5*($+_)*(h-1);if(K<0||K>h-1){for(let D=0;D<x;D++)for(let G=0;G<p;G++){const te=G+D*I[2]+M*I[1]+C*I[0];y.values[te]=l}continue}if(c==="bilinear"){const D=Math.floor(K),G=Math.ceil(K),te=K-D;for(let W=0;W<x;W++){const de=x>1?N*(f-1)+W*F:.5*(N+P)*(f-1);if(de<0||de>f-1){for(let Ae=0;Ae<p;Ae++){const Ue=Ae+W*I[2]+M*I[1]+C*I[0];y.values[Ue]=l}continue}const le=Math.floor(de),oe=Math.ceil(de),ge=de-le;for(let Ae=0;Ae<p;Ae++){let Ue=Ae+le*S[2]+D*S[1]+j*S[0];const Pe=w[Ue];Ue=Ae+oe*S[2]+D*S[1]+j*S[0];const Ne=w[Ue];Ue=Ae+le*S[2]+G*S[1]+j*S[0];const Ye=w[Ue];Ue=Ae+oe*S[2]+G*S[1]+j*S[0];const at=w[Ue],mt=Pe+(Ne-Pe)*ge,wt=Ye+(at-Ye)*ge;Ue=Ae+W*I[2]+M*I[1]+C*I[0],y.values[Ue]=mt+(wt-mt)*te}}}else for(let D=0;D<x;++D){const G=x>1?N*(f-1)+D*F:.5*(N+P)*(f-1);if(G<0||G>f-1){for(let de=0;de<p;de++){const le=de+D*I[2]+M*I[1]+C*I[0];y.values[le]=l}continue}const te=Math.round(G),W=Math.round(K);for(let de=0;de<p;de++){const le=de+te*S[2]+W*S[1]+j*S[0],oe=de+D*I[2]+M*I[1]+C*I[0];y.values[oe]=w[le]}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const qL={kernelName:Kp,backendName:"cpu",kernelFunc:HL};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;it(r,"cumprod");const c=Sn([o],r.shape.length);let l=r;c!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Tn(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Ds(l.dtype,"int32"),f=_p(Ce(l.shape),h),p=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<p.length;y+=m)for(let b=0;b<m;b++){const v=g(y,b);if(b===0)f[v]=i?1:p[v];else{const w=g(y,b-1);f[v]=i?p[w]*f[w]:p[v]*f[w]}}const x=t.makeTensorInfo(l.shape,h,f);if(c!=null){const y=Mo(c),b=ws({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const QL={kernelName:qp,backendName:"cpu",kernelFunc:KL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;it(r,"cumsum");const c=Sn([o],r.shape.length);let l=r;c!=null&&(l=ws({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Tn(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Ds(l.dtype,"int32"),f=ts(Ce(l.shape),h),p=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<p.length;y+=m)for(let b=0;b<m;b++){const v=g(y,b);if(b===0)f[v]=i?0:p[v];else{const w=g(y,b-1);f[v]=i?p[w]+f[w]:p[v]+f[w]}}const x=t.makeTensorInfo(l.shape,h,f);if(c!=null){const y=Mo(c),b=ws({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const JL={kernelName:Sd,backendName:"cpu",kernelFunc:XL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=r0(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=kC(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const ZL={kernelName:Qp,backendName:"cpu",kernelFunc:YL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;R(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],c=r.shape[1],l=r.shape[2],d=r.shape[3],h=c*o,f=l*o,p=d/(o*o),m=t.data.get(r.dataId).values,g=new Float32Array(a*h*f*p);let x=0;for(let y=0;y<a;++y)for(let b=0;b<h;++b){const v=Math.floor(b/o),w=b%o;for(let S=0;S<f;++S){const I=Math.floor(S/o),C=S%o,k=(w*o+C)*p;for(let $=0;$<p;++$){const _=$+k+d*(I+l*(v+c*y));g[x++]=m[_]}}}return t.makeTensorInfo([a,h,f,p],r.dtype,g)}const t3={kernelName:Xp,backendName:"cpu",kernelFunc:e3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;it([r,o],"depthwiseConv2DNative");const d=pt(r.shape),h=pt(o.shape);let f=c;f==null&&(f=[1,1]),R(ss(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);const p=Qn(r.shape,o.shape,i,f,a,l,!0),{filterHeight:m,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=p,v=b.left,w=b.top,S=p.outChannels/p.inChannels,I=new Kn(p.outShape,r.dtype),C=t.data.get(r.dataId).values,k=t.data.get(o.dataId).values,$=I.values;for(let N=0;N<p.batchSize;++N){const _=N*d[0],P=N*I.strides[0];for(let j=0;j<p.outHeight;++j){const A=P+j*I.strides[1],F=j*p.strideHeight-w;for(let M=0;M<m;++M){const K=F+M*x;if(K<0||K>=p.inHeight)continue;const D=M*h[0],G=_+K*d[1];for(let te=0;te<p.outWidth;++te){const W=A+te*I.strides[2],de=te*p.strideWidth-v;for(let le=0;le<g;++le){const oe=de+le*y;if(oe<0||oe>=p.inWidth)continue;const ge=D+le*h[1],Ae=G+oe*p.inChannels;let Ue=W,Pe=ge;for(let Ne=0;Ne<p.inChannels;++Ne){const Ye=C[Ae+Ne];for(let at=0;at<S;++at)$[Ue+at]+=Ye*k[Pe+at];Ue+=S,Pe+=S}}}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const n3={kernelName:Cd,backendName:"cpu",kernelFunc:kN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s;it([r,o],"depthwiseConv2dNativeBackpropFilter");const h=Qn(r.shape,d,i,a,c,l,!0),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=h,x=new Kn(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=t.data.get(r.dataId).values,S=new Kn(r.shape,r.dtype,w),I=t.data.get(o.dataId).values,C=new Kn(o.shape,o.dtype,I);for(let k=0;k<m;++k){const $=Math.max(0,Math.ceil((b-k)/f)),N=Math.min(h.outHeight,(h.inHeight+b-k)/f);for(let _=0;_<g;++_){const P=Math.max(0,Math.ceil((y-_)/p)),j=Math.min(h.outWidth,(h.inWidth+y-_)/p);for(let A=0;A<h.outChannels;++A){const F=Math.trunc(A/v),M=A%v;let K=0;for(let D=0;D<h.batchSize;++D)for(let G=$;G<N;++G){const te=k+G*f-b;for(let W=P;W<j;++W){const de=_+W*p-y;K+=S.get(D,te,de,F)*C.get(D,G,W,A)}}x.set(K,k,_,F,M)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const r3={kernelName:Jp,backendName:"cpu",kernelFunc:s3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s;it([r,o],"depthwiseConv2DNativeBackpropInput");const h=pt(r.shape),f=pt(o.shape),p=Qn(d,o.shape,i,a,c,l,!0),m=new Kn(p.inShape,"float32"),g=m.values,[x,y,b]=m.strides,v=t.data.get(r.dataId).values,[w,S,I]=h,C=t.data.get(o.dataId).values,[k,$,N]=f,{batchSize:_,filterHeight:P,filterWidth:j,inChannels:A,inHeight:F,inWidth:M,outChannels:K,outHeight:D,outWidth:G,strideHeight:te,strideWidth:W}=p,de=P-1-p.padInfo.top,le=j-1-p.padInfo.left,oe=K/A;for(let ge=0;ge<_;++ge)for(let Ae=0;Ae<A;++Ae)for(let Ue=0;Ue<F;++Ue){const Pe=Ue-de,Ne=Math.max(0,Math.ceil(Pe/te)),Ye=Math.min(D,(P+Pe)/te);for(let at=0;at<M;++at){const mt=at-le,wt=Math.max(0,Math.ceil(mt/W)),kt=Math.min(G,(j+mt)/W);let dt=0;for(let ue=Ne;ue<Ye;++ue){const xe=ue*te-Pe;for(let Q=wt;Q<kt;++Q){const fe=Q*W-mt,Z=w*ge+S*ue+I*Q,Fe=k*(P-1-xe)+$*(j-1-fe)+N*Ae;for(let Ge=0;Ge<oe;++Ge){const Le=Ae*oe+Ge,ut=v[Z+Le],ye=C[Fe+Ge];dt+=ut*ye}}}g[x*ge+y*Ue+b*at+Ae]=dt}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const i3={kernelName:Yp,backendName:"cpu",kernelFunc:o3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3(n){const{inputs:e,backend:t}=n,{x:s}=e,r=Ce(s.shape),o=t.data.get(s.dataId).values,i=zt([r,r],s.dtype),a=i.values;for(let l=0;l<o.length;l++)a[l*r+l]=o[l];const c=[...s.shape,...s.shape];return t.makeTensorInfo(c,i.dtype,i.values)}const c3={kernelName:qb,backendName:"cpu",kernelFunc:a3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3={kernelName:Nd,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=t,c=e,l=c.data.get(s.dataId).values,d=s.shape.length,h=c.data.get(r.dataId).values,f=r.shape.length,{batchSize:p,inHeight:m,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:S,filterHeight:I,filterWidth:C,dilationHeight:k,dilationWidth:$,outShape:N}=gl(s.shape,r.shape,o,i,"NHWC",a),_=Ce(N),P=N.length,j=In(s.dtype,_);for(let F=0;F<p;++F)for(let M=0;M<y;++M){const K=M*w-v.top;for(let D=0;D<b;++D){const G=D*S-v.left;for(let te=0;te<x;++te){let W=Number.MIN_SAFE_INTEGER;for(let le=0;le<I;++le){const oe=K+le*k;if(oe>=0&&oe<m)for(let ge=0;ge<C;++ge){const Ae=G+ge*$;if(Ae>=0&&Ae<g){const Ue=Mr([F,oe,Ae,te],d,pt(s.shape)),Pe=Mr([le,ge,te],f,pt(r.shape)),Ne=l[Ue]+h[Pe];Ne>W&&(W=Ne)}}}const de=Mr([F,M,D,te],P,pt(N));j[de]=W}}}return{dataId:c.write(Ci(j,s.dtype),N,s.dtype),shape:N,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3={kernelName:Wf,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=gr(s.shape,l.data.get(s.dataId).values),h=gr(r.shape,l.data.get(r.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:I,dilationHeight:C,dilationWidth:k,outShape:$}=gl(s.shape,r.shape,i,a,"NHWC",c);R(o.rank===$.length,()=>`Error in ${Wf}, dy must have the same rank as output ${$.length}, but got ${o.rank}`);const N=gr($,l.data.get(o.dataId).values),_=Vb(r.shape,r.dtype);for(let j=0;j<f;++j)for(let A=0;A<x;++A){const F=A*v-b.top;for(let M=0;M<y;++M){const K=M*w-b.left;for(let D=0;D<g;++D){let G=Number.MIN_SAFE_INTEGER,te=0,W=0;for(let de=0;de<S;++de){const le=F+de*C;if(le>=0&&le<p)for(let oe=0;oe<I;++oe){const ge=K+oe*k;if(ge>=0&&ge<m){const Ae=d[j][le][ge][D]+h[de][oe][D];Ae>G&&(G=Ae,te=de,W=oe)}}}_[te][W][D]+=N[j][A][M][D]}}}return{dataId:l.write(Ci(_,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d3={kernelName:zf,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=gr(s.shape,l.data.get(s.dataId).values),h=gr(r.shape,l.data.get(r.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:I,dilationHeight:C,dilationWidth:k,outShape:$}=gl(s.shape,r.shape,i,a,"NHWC",c);R(o.rank===$.length,()=>`Error in ${zf}, dy must have the same rank as output ${$.length}, but got ${o.rank}`);const N=gr($,l.data.get(o.dataId).values),_=Vb(s.shape,s.dtype);for(let j=0;j<f;++j)for(let A=0;A<x;++A){const F=A*v-b.top;for(let M=0;M<y;++M){const K=M*w-b.left;for(let D=0;D<g;++D){let G=Number.MIN_SAFE_INTEGER,te=F<0?0:F,W=K<0?0:K;for(let de=0;de<S;++de){const le=F+de*C;if(le>=0&&le<p)for(let oe=0;oe<I;++oe){const ge=K+oe*k;if(ge>=0&&ge<m){const Ae=d[j][le][ge][D]+h[de][oe][D];Ae>G&&(G=Ae,te=le,W=ge)}}}_[j][te][W][D]+=N[j][A][M][D]}}}return{dataId:l.write(Ci(_,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h3(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:c}=i||{},l=(c==null?void 0:c.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=o.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${d} type.`);const[f,p]=r.shape.slice(0,2),m=r.shape.length===2?1:r.shape[2],g=t.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(p*f*4);for(let v=0;v<f*p;++v){const w=[0,0,0,255*l];for(let I=0;I<m;I++){const C=g[v*m+I];if(r.dtype==="float32"){if(C<0||C>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${C}.`)}else if(r.dtype==="int32"&&(C<0||C>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${C}.`);m===1?(w[0]=C*x,w[1]=C*x,w[2]=C*x):w[I]=C*x}const S=v*4;y[S+0]=Math.round(w[0]),y[S+1]=Math.round(w[1]),y[S+2]=Math.round(w[2]),y[S+3]=Math.round(w[3])}o.width=p,o.height=f;const b=new ImageData(y,p,f);return h.putImageData(b,0,0),r}const f3={kernelName:k$,backendName:"cpu",kernelFunc:h3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;it(r,"sum");let a;r.dtype==="bool"?a=Ro({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=qr({inputs:{x:r},backend:t});const c=a.shape.length,l=Wt(o,a.shape),d=Sn(l,c);let h=l,f=a;d!=null&&(f=ws({inputs:{x:a},backend:t,attrs:{perm:d}}),h=Tn(h.length,c)),Xn("sum",h,f.shape.length);const[p,m]=Hn(f.shape,h),g=Ds(f.dtype,"int32");let x=Fu(t,p,g);const y=Ce(m),b=t.data.get(x.dataId).values,v=t.data.get(f.dataId).values;for(let w=0;w<b.length;++w){const S=w*y;let I=0;for(let C=0;C<y;++C)I+=v[S+C];b[w]=I}if(i){const w=Dn(x.shape,l),S=x;x=fn({inputs:{x},backend:t,attrs:{shape:w}}),t.disposeIntermediateTensorInfo(S)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(f),x}const p3={kernelName:sh,backendName:"cpu",kernelFunc:Dl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=Tg(r,o.length);Eg(i.length,c,o);const{path:l,steps:d}=Rg(a,c),h=d.length;let f=null,p=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=Ag(p,c[x]);let v;Dg(y)?v=o[x]:(v=ws({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(v));const w=v.shape.slice();for(let S=0;S<b.length;++S)w.splice(b[S],0,1);nn(v.shape,w)||(v=fn({inputs:{x:v},backend:t,attrs:{shape:w}}),m.push(v)),f===null?f=v:(f=jh({inputs:{a:v,b:f},backend:t}),m.push(f))}g<h-1&&(l[g]>=0&&(f=Dl({inputs:{x:f},backend:t,attrs:{axis:l[g]-(i.length-p),keepDims:!1}}),m.push(f)),p--)}for(const g of m)g!==f&&t.disposeIntermediateTensorInfo(g);return f}const g3={kernelName:Zp,backendName:"cpu",kernelFunc:m3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x3(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;it([s,r],"eluGrad");const o=new Float32Array(Ce(r.shape)),i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let c=0;c<i.length;++c){const l=i[c];l>=0?o[c]=a[c]:o[c]=a[c]*(l+1)}return t.makeTensorInfo(r.shape,"float32",o)}const y3={kernelName:em,backendName:"cpu",kernelFunc:x3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3=vg,w3=Sg,v3=Cg,S3=Ng,C3=Ig,N3=kg,I3=on(jc,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+b3*t);return e*(1-((((N3*s+C3)*s+S3)*s+v3)*s+w3)*s*Math.exp(-t*t))}),k3={kernelName:jc,backendName:"cpu",kernelFunc:I3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zu(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let c=o;return o<0&&(R(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),fn({inputs:{x:r},backend:t,attrs:{shape:a}})}const $3={kernelName:kd,backendName:"cpu",kernelFunc:zu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T3=En((n,e)=>n/e),u0=zn(_c,T3),pp={kernelName:_c,backendName:"cpu",kernelFunc:u0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,l=[r,o],d=Ce(l),h=es("float32",d),f=es("float32",d);for(let x=0;x<r;x++){const y=bi({inputs:{x:a},backend:t,attrs:{begin:[x,0],size:[1,o]}}),b=bi({inputs:{x:c},backend:t,attrs:{begin:[x,0],size:[1,o]}}),v=Ts({inputs:{real:y,imag:b},backend:t}),{real:w,imag:S}=A3(v,e,t),I=so(w,S);for(let C=0;C<o;C++){const k=$g(I,C);h[x*o+C]=k.real,f[x*o+C]=k.imag}t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v)}const p=t.makeTensorInfo(l,"float32",h),m=t.makeTensorInfo(l,"float32",f),g=Ts({inputs:{real:p,imag:m},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),g}function A3(n,e,t){const s=Ce(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(E3(s)){const a=mp(o,i,s,e,t),c=[n.shape[0],n.shape[1]];if(e){const l=t.makeTensorInfo(c,"float32",a.real),d=t.makeTensorInfo(c,"float32",a.imag),h=t.makeTensorInfo([],"float32",_o(s,"float32")),f=qr({inputs:{x:h},backend:t}),p=pp.kernelFunc({inputs:{a:l,b:h},backend:t}),m=pp.kernelFunc({inputs:{a:d,b:f},backend:t}),g=t.data.get(p.dataId).values,x=t.data.get(m.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),{real:g,imag:x}}return a}else{const a=so(o,i),c=R3(a,s,e);return Wv(c)}}function E3(n){return(n&n-1)===0}function mp(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=so(n,e),i=t/2,a=Bv(o),c=a.real,l=a.imag,d=[c.length],h=r.makeTensorInfo(d,"float32",c),f=r.makeTensorInfo(d,"float32",l),p=Ts({inputs:{real:h,imag:f},backend:r}),m=Vv(o),g=m.real,x=m.imag,y=[g.length],b=r.makeTensorInfo(y,"float32",g),v=r.makeTensorInfo(y,"float32",x),w=Ts({inputs:{real:b,imag:v},backend:r}),S=mp(c,l,i,s,r),I=S.real,C=S.imag,k=[I.length],$=r.makeTensorInfo(k,"float32",I),N=r.makeTensorInfo(k,"float32",C),_=Ts({inputs:{real:$,imag:N},backend:r}),P=mp(g,x,i,s,r),j=P.real,A=P.imag,F=[j.length],M=r.makeTensorInfo(F,"float32",j),K=r.makeTensorInfo(F,"float32",A),D=Ts({inputs:{real:M,imag:K},backend:r}),G=Gv(t,s),te=[G.real.length],W=r.makeTensorInfo(te,"float32",G.real),de=r.makeTensorInfo(te,"float32",G.imag),le=Ts({inputs:{real:W,imag:de},backend:r}),oe=jh({inputs:{a:le,b:D},backend:r}),ge=pa({inputs:{a:_,b:oe},backend:r}),Ae=c0({inputs:{a:_,b:oe},backend:r}),Ue=yi({inputs:{input:ge},backend:r}),Pe=yi({inputs:{input:Ae},backend:r}),Ne=ma({inputs:{input:ge},backend:r}),Ye=ma({inputs:{input:Ae},backend:r}),at=ga({inputs:[Ue,Pe],backend:r,attrs:{axis:0}}),mt=ga({inputs:[Ne,Ye],backend:r,attrs:{axis:0}}),wt=r.data.get(at.dataId).values,kt=r.data.get(mt.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(W),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(Ae),r.disposeIntermediateTensorInfo(Ue),r.disposeIntermediateTensorInfo(Ne),r.disposeIntermediateTensorInfo(Pe),r.disposeIntermediateTensorInfo(Ye),r.disposeIntermediateTensorInfo(at),r.disposeIntermediateTensorInfo(mt),{real:wt,imag:kt}}function R3(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const c=Hv(r*a,e,t),l=$g(n,a);o+=l.real*c.real-l.imag*c.imag,i+=l.real*c.imag+l.imag*c.real}t&&(o/=e,i/=e),Uv(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(n){const{inputs:e,backend:t}=n,{input:s}=e,r=Ce(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=fn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=$N(a,!1,t),l=fn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const _3={kernelName:tm,backendName:"cpu",kernelFunc:D3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||va(r),a=In(i,Ce(s));return j3(a,r,i),e.makeTensorInfo(s,i,a)}const P3={kernelName:nm,backendName:"cpu",kernelFunc:d0};function j3(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M3={kernelName:sm,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=es(s.dtype,Ce(s.shape)),[i,a,c,l]=s.shape,d=r.data.get(s.dataId).values;for(let f=0;f<i;f++){const p=f*c*a*l;for(let m=0;m<a;m++){const g=m*(c*l);for(let x=0;x<c;x++){const y=x*l;for(let b=0;b<l;b++){const v=Math.round(c-x-1),w=p+g+y+b;let S=d[w];if(v>=0&&v<c){const I=v*l,C=p+g+I+b;S=d[C]}o[w]=S}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s;let g=IN({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f}});if(i){const x=g;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const y=fn({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});g=pa({inputs:{a:g,b:y},backend:t}),t.disposeIntermediateTensorInfo(y)}else g=pa({inputs:{a:g,b:i},backend:t});t.disposeIntermediateTensorInfo(x)}if(p){const x=g;if(d==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=fn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});g=Lu(t,g,p,y,m),t.disposeIntermediateTensorInfo(y)}else g=Lu(t,g,p,a,m);t.disposeIntermediateTensorInfo(x)}return g}const O3={kernelName:xu,backendName:"cpu",kernelFunc:F3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s;let g=kN({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f}});if(i){const x=g;g=pa({inputs:{a:g,b:i},backend:t}),t.disposeIntermediateTensorInfo(x)}if(p){const x=g;g=Lu(t,g,p,a,m),t.disposeIntermediateTensorInfo(x)}return g}const z3={kernelName:hw,backendName:"cpu",kernelFunc:L3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W3(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=Ce(s.shape),i=r.shape,a=i[i.length-1],[c,l,d,h]=ug(s,r);if(l===0)return t.makeTensorInfo(c,s.dtype,[]);const f=t.data.get(r.dataId).values,p=t.bufferSync(s),m=FC(f,p,s.dtype,l,a,d,h,s.shape,o);return t.makeTensorInfo(c,s.dtype,m.values)}const B3={kernelName:Kb,backendName:"cpu",kernelFunc:W3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;it([r,o],"gatherV2");const c=Wt(i,r.shape)[0],l=t.data.get(o.dataId).values,d=r.shape[c];for(let w=0;w<l.length;++w){const S=l[w];R(S<=d-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${d-1}]`)}let h=a;a==null&&(h=0);const f=Ce(o.shape),p=Pg(r,o,c,h),m=fn({inputs:{x:r},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=fn({inputs:{x:o},backend:t,attrs:{shape:[p.batchSize,f/p.batchSize]}}),x=[p.batchSize,p.outerSize,f/p.batchSize,p.sliceSize],y=t.bufferSync(g),b=t.bufferSync(m),v=OC(b,y,x);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(p.outputShape,v.dtype,v.values)}const U3={kernelName:Td,backendName:"cpu",kernelFunc:V3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3(n){const{inputs:e,backend:t}=n,{input:s}=e,r=Ce(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=fn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=$N(a,!0,t),l=fn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const H3={kernelName:rm,backendName:"cpu",kernelFunc:G3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q3=on(Bc,n=>Number.isFinite(n)?1:0,"bool"),K3={kernelName:Bc,backendName:"cpu",kernelFunc:q3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3=on(Vc,n=>Math.abs(n)===1/0?1:0,"bool"),X3={kernelName:Vc,backendName:"cpu",kernelFunc:Q3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J3=on(Uc,n=>Number.isNaN(n)?1:0,"bool"),Y3={kernelName:Uc,backendName:"cpu",kernelFunc:J3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z3(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=VC(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const ez={kernelName:Qb,backendName:"cpu",kernelFunc:Z3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tz=on(Hc,n=>Math.log1p(n)),nz={kernelName:Hc,backendName:"cpu",kernelFunc:tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sz=En((n,e)=>n&&e),rz=zn(_d,sz,null,"bool"),oz={kernelName:_d,backendName:"cpu",kernelFunc:rz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iz=on(Pd,n=>n?0:1,"bool"),az={kernelName:Pd,backendName:"cpu",kernelFunc:iz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cz=En((n,e)=>n||e),lz=zn(jd,cz,null,"bool"),uz={kernelName:jd,backendName:"cpu",kernelFunc:lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s;it(r,"LRN");const l=r.shape[3],d=l-1,h=t.data.get(r.dataId).values,f=Ce(r.shape),p=new Float32Array(f);function m(g){const x=g%l;let y=g-x+Math.max(0,x-o);const b=g-x+Math.min(x+o,d);let v=0;for(;y<=b;y++){const w=h[y];v+=w*w}return v}for(let g=0;g<f;g++){const x=m(g),y=h[g]*Math.pow(i+a*x,-c);p[g]=y}return t.makeTensorInfo(r.shape,r.dtype,p)}const hz={kernelName:Md,backendName:"cpu",kernelFunc:dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s;it(i,"LRNGrad");const h=Ce(i.shape),f=i.shape[3],p=t.data.get(i.dataId).values,m=t.data.get(r.dataId).values,g=t.data.get(o.dataId).values,x=new Float32Array(h),y=h;for(let b=0;b<y;b++){const v=b%f,w=b-v+Math.max(0,v-a),S=b-v+Math.min(f,v+a+1);let I=0;for(let C=w;C<S;C++)I+=Math.pow(m[C],2);I=l*I+c;for(let C=w;C<S;C++){let k=-2*l*d*m[C]*g[b]/I;b===C&&(k+=Math.pow(I,-d)),k*=p[b],x[C]+=k}}return t.makeTensorInfo(i.shape,r.dtype,x)}const pz={kernelName:im,backendName:"cpu",kernelFunc:fz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=t;let c=r.shape;const l=c.length,d=Wt(o,c);let h=d;const f=Sn(h,l);let p=a.data.get(r.dataId).values;if(f!=null){const w=new Array(l);for(let S=0;S<w.length;S++)w[S]=c[f[S]];p=i0(p,c,r.dtype,f,w),h=Tn(h.length,l),c=w}it(r,"max"),Xn("max",h,l);const[m,g]=Hn(c,h),x=Ce(g),y=GC(p,x,m,r.dtype),b=a.write(y,m,r.dtype);let v=m;return i&&(v=Dn(m,d)),{dataId:b,shape:v,dtype:r.dtype}}const mz={kernelName:Fd,backendName:"cpu",kernelFunc:TN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;it(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(ss(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=sr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&nn(d.inShape,d.outShape))h=qr({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,p=pt(r.shape),m=l0(f,r.shape,r.dtype,p,d,"max");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const xz={kernelName:Od,backendName:"cpu",kernelFunc:gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;it(r,"maxPool3d");const d=ao(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,f=NN(h,r.shape,r.dtype,pt(r.shape),d,"max");return t.makeTensorInfo(f.shape,"float32",f.values)}const bz={kernelName:Ld,backendName:"cpu",kernelFunc:yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;it([r,o],"maxPool3DGrad");const d=ao(o.shape,i,a,1,c,l),h=t.bufferSync(o),f=cL(h,d),p=d.strideDepth,m=d.strideHeight,g=d.strideWidth,x=d.dilationDepth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterDepth,w=d.effectiveFilterHeight,S=d.effectiveFilterWidth,I=v-1-d.padInfo.front,C=S-1-d.padInfo.left,k=w-1-d.padInfo.top,$=zt(o.shape,"float32"),N=t.bufferSync(r);for(let _=0;_<d.batchSize;++_)for(let P=0;P<d.inChannels;++P)for(let j=0;j<d.inDepth;++j)for(let A=0;A<d.inHeight;++A)for(let F=0;F<d.inWidth;++F){const M=j-I,K=A-k,D=F-C;let G=0;for(let te=0;te<v;te+=x){const W=(M+te)/p;if(!(W<0||W>=d.outDepth||Math.floor(W)!==W))for(let de=0;de<w;de+=y){const le=(K+de)/m;if(!(le<0||le>=d.outHeight||Math.floor(le)!==le))for(let oe=0;oe<S;oe+=b){const ge=(D+oe)/g;if(ge<0||ge>=d.outWidth||Math.floor(ge)!==ge)continue;const Ae=v*w*S-1-f.get(_,W,le,ge,P),Ue=te*w*S+de*S+oe,Pe=Ae===Ue?1:0;if(Pe===0)continue;const Ne=N.get(_,W,le,ge,P);G+=Ne*Pe}}}$.set(G,_,j,A,F,P)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const vz={kernelName:cm,backendName:"cpu",kernelFunc:wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;it([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,f=sr(a.shape,c,l,1,d,h),p=t.data.get(a.dataId).values,m=zt(f.outShape,a.dtype,CN(p,a.shape,a.dtype,f).values),g=f.strideHeight,x=f.strideWidth,y=f.dilationHeight,b=f.dilationWidth,v=f.effectiveFilterHeight,w=f.effectiveFilterWidth,S=w-1-f.padInfo.left,I=v-1-f.padInfo.top,C=zt(a.shape,"float32"),k=t.data.get(r.dataId).values,$=zt(r.shape,"float32",k);for(let N=0;N<f.batchSize;++N)for(let _=0;_<f.inChannels;++_)for(let P=0;P<f.inHeight;++P)for(let j=0;j<f.inWidth;++j){const A=P-I,F=j-S;let M=0;for(let K=0;K<v;K+=y){const D=(A+K)/g;if(!(D<0||D>=f.outHeight||Math.floor(D)!==D))for(let G=0;G<w;G+=b){const te=(F+G)/x;if(te<0||te>=f.outWidth||Math.floor(te)!==te)continue;const W=v*w-1-m.get(N,D,te,_),de=K*w+G,le=W===de?1:0;if(le===0)continue;const oe=$.get(N,D,te,_);M+=oe*le}}C.set(M,N,P,j,_)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const Cz={kernelName:am,backendName:"cpu",kernelFunc:Sz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(n,e,t,s,r){const o=pt(e),i=l0(n,e,t,o,r,"max"),a=CN(n,e,t,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iz={kernelName:Xb,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;it(s,"MaxPoolWithArgmax");const l=c.data.get(s.dataId).values,d=sr(s.shape,r,o,[1,1],i),[h,f]=Nz(l,s.shape,s.dtype,a,d),p=c.write(h,d.outShape,s.dtype),m=c.write(f,d.outShape,s.dtype);return[{dataId:p,shape:d.outShape,dtype:s.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=Wt(o,r.shape),l=Hn(r.shape,a)[1],d=Ce(l),h=[],f=t.makeTensorInfo([],"float32",new Float32Array([d]));h.push(f);const p=Ro({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});h.push(p);const m=u0({inputs:{a:p,b:f},backend:t});h.push(m);const g=Dl({inputs:{x:m},backend:t,attrs:{axis:o,keepDims:i}});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const $z={kernelName:zd,backendName:"cpu",kernelFunc:kz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;it(r,"min");const a=Wt(o,r.shape);let c=a;const l=Sn(c,r.shape.length);let d=r;l!=null&&(d=ws({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Xn("min",c,d.shape.length);const[h,f]=Hn(d.shape,c),p=Ce(f),m=ts(Ce(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*p;let v=g[b];for(let w=0;w<p;++w){const S=g[b+w];(Number.isNaN(S)||S<v)&&(v=S)}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=Dn(h,a),b=fn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const Az={kernelName:Wd,backendName:"cpu",kernelFunc:Tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ez(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;it(r,"mirrorPad");const a=o.map((v,w)=>v[0]+r.shape[w]+v[1]),c=o.map(v=>v[0]),l=o.map((v,w)=>v[0]+r.shape[w]),d=i==="reflect"?0:1,h=t.data.get(r.dataId).values,f=r.shape.length,p=pt(r.shape),m=Ce(a),g=a.length,x=pt(a),y=es(r.dtype,m);for(let v=0;v<m;v++){let w=Sa(v,g,x);for(let I=0;I<g;I++)w[I]<c[I]?w[I]=c[I]*2-w[I]-d:w[I]>=l[I]&&(w[I]=(l[I]-1)*2-w[I]+d);w=w.map((I,C)=>I-c[C]);const S=Mr(w,f,p);y[v]=h[S]}return{dataId:t.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const Rz={kernelName:Bd,backendName:"cpu",kernelFunc:Ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dz=En((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),_z=zn(Qc,Dz),Pz={kernelName:Qc,backendName:"cpu",kernelFunc:_z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AN(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const c=Wt([a],r.shape),l=TN({inputs:{x:r},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),d=Dn(l.shape,c),h=fn({inputs:{x:l},backend:t,attrs:{shape:d}}),f=c0({inputs:{a:r,b:h},backend:t}),p=_C({inputs:{x:f},backend:t}),m=Dl({inputs:{x:p},backend:t,attrs:{axis:c,keepDims:!1}}),g=fn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=u0({inputs:{a:p,b:g},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const jz={kernelName:ih,backendName:"cpu",kernelFunc:AN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mz(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;it(r,"multinomial");const c=a?r:AN({inputs:{logits:r},backend:t,attrs:{dim:-1}}),l=c.shape[0],d=c.shape[1],h=t.data.get(c.dataId).values,f=[l,o],p=ts(Ce(f),"int32");for(let m=0;m<l;++m){const g=m*d,x=new Float32Array(d-1);x[0]=h[g];for(let v=1;v<x.length;++v)x[v]=x[v-1]+h[g+v];const y=Qm.alea(i.toString()),b=m*o;for(let v=0;v<o;++v){const w=y();p[b+v]=x.length;for(let S=0;S<x.length;S++)if(w<x[S]){p[b+v]=S;break}}}return a||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(f,"int32",p)}const Fz={kernelName:Jb,backendName:"cpu",kernelFunc:Mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oz=rg;function Lz(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s;it(r,"NonMaxSuppression");const l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:h}=Oz(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const zz={kernelName:lm,backendName:"cpu",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wz=og;function Bz(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s;it(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,{selectedIndices:f,validOutputs:p}=Wz(d,h,i,a,c,l);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const Vz={kernelName:um,backendName:"cpu",kernelFunc:Bz};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uz=ig;function Gz(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s;it(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,f=i,p=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=Uz(d,h,f,p,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Hz={kernelName:dm,backendName:"cpu",kernelFunc:Gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s;it(r,"oneHot");const l=Ce(r.shape),d=new Float32Array(l*i);d.fill(c);const h=t.data.get(r.dataId).values;for(let f=0;f<l;++f)h[f]>=0&&h[f]<i&&(d[f*i+h[f]]=a);return t.makeTensorInfo([...r.shape,i],o,d)}const Kz={kernelName:Hd,backendName:"cpu",kernelFunc:qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wu(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=yi({inputs:{input:s},backend:t}),o=Wu({inputs:{x:r},backend:t}),i=ma({inputs:{input:s},backend:t}),a=Wu({inputs:{x:i},backend:t}),c=Ts({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return d0({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Qz={kernelName:lh,backendName:"cpu",kernelFunc:Wu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EN(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=yi({inputs:{input:s},backend:t}),o=EN({inputs:{x:r},backend:t}),i=ma({inputs:{input:s},backend:t}),a=Wu({inputs:{x:i},backend:t}),c=Ts({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return d0({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Xz={kernelName:Gd,backendName:"cpu",kernelFunc:EN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return zu({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Dp(o,d.shape,"All tensors passed to stack must have matching shapes"),R(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=zu({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=ga({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const Jz={kernelName:qd,backendName:"cpu",kernelFunc:RN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;it(r,"pad");const a=o.map((b,v)=>b[0]+r.shape[v]+b[1]),c=o.map(b=>b[0]),l=t.data.get(r.dataId).values,d=Ce(r.shape),h=r.shape.length,f=pt(r.shape),p=Ce(a),m=a.length,g=pt(a),x=es(r.dtype,p);i!==0&&x.fill(i);for(let b=0;b<d;b++){const w=Sa(b,h,f).map((I,C)=>I+c[C]),S=Mr(w,m,g);x[S]=l[b]}return{dataId:t.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const DN={kernelName:Kd,backendName:"cpu",kernelFunc:Yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zz=En((n,e)=>Math.pow(n,e)),eW=zn(Jc,Zz),tW={kernelName:Jc,backendName:"cpu",kernelFunc:eW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.data.get(y.dataId).values),l=r.map(y=>y.shape),d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,[f,p,m]=JC(c,l,d,o.shape,o.dtype,h,i.shape),g=f.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,p);return g.concat([x])}const sW={kernelName:Yb,backendName:"cpu",kernelFunc:nW};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=YC(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),f=t.makeTensorInfo([d.length],s.dtype,d);return[h,f]}const oW={kernelName:Zb,backendName:"cpu",kernelFunc:rW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,f=a.map(x=>t.data.get(x.dataId).values),p=a.map(x=>x.shape),[m,g]=ZC(l,r.shape,d,o.shape,o.dtype,h,i.shape,f,p,c);return t.makeTensorInfo(m,o.dtype,g)}const aW={kernelName:ew,backendName:"cpu",kernelFunc:iW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,a=eN(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const lW={kernelName:hm,backendName:"cpu",kernelFunc:cW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uW=on(Yc,n=>1/n),dW={kernelName:Yc,backendName:"cpu",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;it(r,"resizeBilinear");const c=pt(r.shape),[l,d]=a,[h,f,p,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(Ce([h,l,d,m])),y=[o&&l>1?f-1:f,o&&d>1?p-1:p],b=[o&&l>1?l-1:l,o&&d>1?d-1:d];let v=0;const w=y[0]/b[0],S=y[1]/b[1];for(let I=0;I<h;I++)for(let C=0;C<l;C++){let k;i?k=w*(C+.5)-.5:k=w*C;const $=Math.max(0,Math.floor(k)),N=k-$,_=Math.min(f-1,Math.ceil(k)),P=I*c[0]+$*c[1],j=I*c[0]+_*c[1];for(let A=0;A<d;A++){let F;i?F=S*(A+.5)-.5:F=S*A;const M=Math.max(0,Math.floor(F)),K=F-M,D=Math.min(p-1,Math.ceil(F)),G=P+M*c[2],te=j+M*c[2],W=P+D*c[2],de=j+D*c[2];for(let le=0;le<m;le++){const oe=g[G+le],ge=g[te+le],Ae=g[W+le],Ue=g[de+le],Pe=oe+(Ae-oe)*K,Ne=ge+(Ue-ge)*K,Ye=Pe+(Ne-Pe)*N;x[v++]=Ye}}}return t.makeTensorInfo([h,l,d,m],"float32",x)}const fW={kernelName:Zd,backendName:"cpu",kernelFunc:hW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;it([o,r],"resizeBilinearGrad");const a=pt(r.shape),[c,l,d,h]=r.shape,[,f,p]=o.shape,m=new Float32Array(c*l*d*h),g=[i&&f>1?l-1:l,i&&p>1?d-1:d],x=[i&&f>1?f-1:f,i&&p>1?p-1:p],y=g[0]/x[0],b=g[1]/x[1],v=t.data.get(o.dataId).values;let w=0;for(let S=0;S<c;S++){const I=S*a[0];for(let C=0;C<f;C++){const k=C*y,$=Math.floor(k),N=Math.min(Math.ceil(k),l-1),_=I+$*a[1],P=I+N*a[1],j=k-$,A=1-j;for(let F=0;F<p;F++){const M=F*b,K=Math.floor(M),D=Math.min(Math.ceil(M),d-1),G=M-K,te=1-G,W=_+K*a[2],de=_+D*a[2],le=P+K*a[2],oe=P+D*a[2],ge=A*te,Ae=A*G,Ue=j*te,Pe=j*G;for(let Ne=0;Ne<h;Ne++){const Ye=v[w++];m[W+Ne]+=Ye*ge,m[de+Ne]+=Ye*Ae,m[le+Ne]+=Ye*Ue,m[oe+Ne]+=Ye*Pe}}}}return t.makeTensorInfo([c,d,l,h],"float32",m)}const mW={kernelName:mm,backendName:"cpu",kernelFunc:pW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;it(r,"resizeNearestNeighbor");const c=pt(r.shape),[l,d]=a,[h,f,p,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(h*l*d*m),y=[o&&l>1?f-1:f,o&&d>1?p-1:p],b=[o&&l>1?l-1:l,o&&d>1?d-1:d],v=y[0]/b[0],w=y[1]/b[1];let S=0;for(let I=0;I<h;I++){const C=I*c[0];for(let k=0;k<l;k++){const $=i?v*(k+.5):v*k;let N=Math.min(f-1,o?Math.round($):Math.floor($));i&&(N=Math.max(0,N));const _=C+N*c[1];for(let P=0;P<d;P++){const j=i?w*(P+.5):w*P;let A=Math.min(p-1,o?Math.round(j):Math.floor(j));i&&(A=Math.max(0,A));const F=_+A*c[2];for(let M=0;M<m;M++){const K=g[F+M];x[S++]=K}}}}return t.makeTensorInfo([h,l,d,m],r.dtype,x)}const xW={kernelName:Yd,backendName:"cpu",kernelFunc:gW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;it([o,r],"resizeNearestNeighborGrad");const a=pt(r.shape),c=pt(o.shape),[l,d,h,f]=r.shape,[,p,m]=o.shape,g=new Float32Array(l*d*h*f),x=t.data.get(o.dataId).values,y=[i&&p>1?d-1:d,i&&m>1?h-1:h],b=[i&&p>1?p-1:p,i&&m>1?m-1:m],v=y[0]/b[0],w=y[1]/b[1],S=1/v,I=1/w,C=Math.ceil(S)*2+2,k=Math.ceil(I)*2+2;for(let $=0;$<l;$++){const N=$*a[0];for(let _=0;_<d;_++){const P=N+_*a[1],j=Math.floor(_*S),A=Math.floor(j-C/2);for(let F=0;F<h;F++){const M=P+F*a[2],K=Math.floor(F*I),D=Math.floor(K-k/2);for(let G=0;G<f;G++){let te=0;for(let W=0;W<C;W++){const de=W+A;if(de<0||de>=p)continue;const le=N+de*c[1],oe=de*v,ge=Math.min(d-1,i?Math.round(oe):Math.floor(oe));if(_===ge)for(let Ae=0;Ae<k;Ae++){const Ue=Ae+D;if(Ue<0||Ue>=m)continue;const Pe=le+Ue*c[2],Ne=Ue*w,Ye=Math.min(h-1,i?Math.round(Ne):Math.floor(Ne));F===Ye&&(te+=x[Pe+G])}}g[M+G]=te}}}}return t.makeTensorInfo(r.shape,r.dtype,g)}const bW={kernelName:pm,backendName:"cpu",kernelFunc:yW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;it(r,"reverse");const i=r.shape.length,a=Wt(o,r.shape);if(i===0)return qr({inputs:{x:r},backend:t});const c=new Kn(r.shape,r.dtype),l=t.bufferSync(r);for(let d=0;d<c.size;d++){const h=c.indexToLoc(d),f=h.slice();a.forEach(p=>f[p]=r.shape[p]-1-f[p]),c.set(l.get(...f),...h)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}const vW={kernelName:eh,backendName:"cpu",kernelFunc:wW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SW={kernelName:Sm,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=es(s.dtype,Ce(s.shape)),[l,d,h,f]=s.shape,[p,m]=yg(i,d,h),g=255,x=Math.sin(r),y=Math.cos(r),b=a.data.get(s.dataId).values;for(let w=0;w<l;w++){const S=w*h*d*f;for(let I=0;I<d;I++){const C=I*(h*f);for(let k=0;k<h;k++){const $=k*f;for(let N=0;N<f;N++){const _=[l,I,k,N],P=_[2],j=_[1];let A=(P-p)*y-(j-m)*x,F=(P-p)*x+(j-m)*y;A=Math.round(A+p),F=Math.round(F+m);let M=o;if(typeof o!="number"&&(N===3?M=g:M=o[N]),A>=0&&A<h&&F>=0&&F<d){const D=F*(h*f),G=A*f,te=S+D+G+N;M=b[te]}const K=S+C+$+N;c[K]=M}}}}return{dataId:a.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CW=on(tl,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),NW={kernelName:tl,backendName:"cpu",kernelFunc:CW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=$i(o,r,i),f=!0,p=t.bufferSync(r),m=t.bufferSync(o),g=ei(p,m,i,h,l,c,a,d,0,f);return t.makeTensorInfo(i,g.dtype,g.values)}const kW={kernelName:tw,backendName:"cpu",kernelFunc:IW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $W(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function TW(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function AW(n,e,t,s,r,o){const i=In("int32",t*r);for(let a=0;a<t;++a){const c=n.slice(a*s,(a+1)*s),l=a*r;for(let d=0;d<r;++d)i[l+d]=o==="left"?$W(c,e[d+l]):TW(c,e[d+l])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=AW(a,c,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",l)}const RW={kernelName:sw,backendName:"cpu",kernelFunc:EW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DW(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;it([s,r,o],"select");const i=s.shape.length,a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=Ds(r.dtype,o.dtype),h=ts(Ce(r.shape),d);let f=0;const p=i===0||i>1||r.shape.length===1?1:Ce(r.shape.slice(1));for(let m=0;m<a.length;m++)for(let g=0;g<p;g++)a[m]===1?h[f++]=c[m]:h[f++]=l[m];return t.makeTensorInfo(r.shape,d,h)}const _W={kernelName:th,backendName:"cpu",kernelFunc:DW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PW=vh,jW=Sh,MW=on(sl,n=>n>=0?jW*n:PW*(Math.exp(n)-1)),FW={kernelName:sl,backendName:"cpu",kernelFunc:MW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OW=on(il,n=>n<0?-1:n>0?1:0),LW={kernelName:il,backendName:"cpu",kernelFunc:OW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zW=on(rl,n=>Math.sin(n)),WW={kernelName:rl,backendName:"cpu",kernelFunc:zW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BW=on(ol,n=>Math.sinh(n)),VW={kernelName:ol,backendName:"cpu",kernelFunc:BW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW=11920928955078125e-23,my=Math.log(UW)+2,GW=on(cl,n=>{const e=n>-my,t=n<my,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),HW={kernelName:cl,backendName:"cpu",kernelFunc:GW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;it([r],"spaceToBatchND");const a=Ce(o),c=[[0,0]];c.push(...i);for(let I=1+o.length;I<r.shape.length;++I)c.push([0,0]);const l=DN.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),d=vl(l.shape,o,a,!1),h=Sl(d.length,o.length,!1),f=Cl(l.shape,o,a,!1),g=fn({inputs:{x:l},backend:t,attrs:{shape:d}}),b=ws({inputs:{x:g},backend:t,attrs:{perm:h}}),S=fn({inputs:{x:b},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),S}const KW={kernelName:rh,backendName:"cpu",kernelFunc:qW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[h,f,p,m,g]=rN(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(f,s.dtype,h),t.makeTensorInfo([f[0]],r.dtype,p),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const XW={kernelName:rw,backendName:"cpu",kernelFunc:QW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JW(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,c=Array.from(t.data.get(o.dataId).values),[l,d,h]=oN(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const YW={kernelName:ow,backendName:"cpu",kernelFunc:JW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=a0(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const e4={kernelName:iw,backendName:"cpu",kernelFunc:ZW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t4(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=a0(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const n4={kernelName:aw,backendName:"cpu",kernelFunc:t4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:f}=$i(o,r,a),p=!1,m=t.bufferSync(r);let g;switch(o.dtype){case"bool":{const x=t.bufferSync(o),y=!!t.data.get(i.dataId).values[0];g=ei(m,x,a,f,d,l,c,h,y,p);break}case"float32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=ei(m,x,a,f,d,l,c,h,y,p);break}case"int32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=ei(m,x,a,f,d,l,c,h,y,p);break}case"string":{const x=t.bufferSync(o),y=ko(t.data.get(i.dataId).values[0]);g=ei(m,x,a,f,d,l,c,h,y,p);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,g.dtype,g.values)}const r4={kernelName:cw,backendName:"cpu",kernelFunc:s4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Wt(i,r.shape)[0],c=_g(r,o,a),l=new Array(r.shape.length).fill(0),d=r.shape.slice();return c.map(h=>{const f=[...d];f[a]=h;const p=bi({inputs:{x:r},backend:t,attrs:{begin:l,size:f}});return l[a]+=h,p})}const i4={kernelName:oh,backendName:"cpu",kernelFunc:o4};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a4={kernelName:gm,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;it(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const c=r[a];o[a]=c*c}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c4=on(ml,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),l4={kernelName:ml,backendName:"cpu",kernelFunc:c4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=s;it(r,"stridedSlice");const{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=mg(r.shape,o,i,a,c,l,d,h,f);let S;if(g)S=fn({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){R(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=hg(b,v,w),C=bi({inputs:{x:r},backend:t,attrs:{begin:b,size:I}});S=fn({inputs:{x:C},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(C)}else{const I=t.bufferSync(r),C=cN(p,I,w,b);S=t.makeTensorInfo(m,C.dtype,C.values)}return S}const d4={kernelName:ym,backendName:"cpu",kernelFunc:u4};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h4(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,f=t.data.get(d.dataId).values,p=t.data.get(h.dataId).values,[m,g]=lN(f,p,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const f4={kernelName:lw,backendName:"cpu",kernelFunc:h4};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values[0],[l,d,h]=uN(a,c,r),f=d.length;return[t.makeTensorInfo([f,2],"int32",l),t.makeTensorInfo([f],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const m4={kernelName:uw,backendName:"cpu",kernelFunc:p4};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=dN(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const x4={kernelName:dw,backendName:"cpu",kernelFunc:g4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y4=on(hl,n=>Math.tan(n)),b4={kernelName:hl,backendName:"cpu",kernelFunc:y4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4=on(fl,n=>Math.tanh(n)),v4={kernelName:fl,backendName:"cpu",kernelFunc:w4};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S4(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:c,strides:l,outputSize:d}=$i(o,r,s.shape),h=!1,f=t.bufferSync(r),p=t.bufferSync(o),m=t.bufferSync(s),g=ei(f,p,s.shape,d,c,a,i,l,m,h);return t.makeTensorInfo(s.shape,g.dtype,g.values)}const C4={kernelName:nw,backendName:"cpu",kernelFunc:S4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;it(r,"tile");const i=fN(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const I4={kernelName:pl,backendName:"cpu",kernelFunc:N4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;it(r,"topk");const a=t.data.get(r.dataId).values,[c,l]=mN(a,r.shape,r.dtype,o,i);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}const $4={kernelName:bm,backendName:"cpu",kernelFunc:k4};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T4(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=t,[d,h,f,p]=r.shape,[m,g]=l??[h,f],x=[d,m,g,p],y=pt(r.shape),b=y[0],v=y[1],w=y[2],S=pt(x),I=S[0],C=S[1],k=S[2],$=es(r.dtype,Ce(x));$.fill(c);const N=s.data.get(r.dataId).values,_=s.data.get(o.dataId).values;for(let j=0;j<d;++j){const A=o.shape[0]===1?_:_.subarray(j*8,j*8+8);for(let F=0;F<m;++F)for(let M=0;M<g;++M)for(let K=0;K<p;++K){let D;const G=A[6]*M+A[7]*F+1;if(G===0)continue;const te=(A[0]*M+A[1]*F+A[2])/G,W=(A[3]*M+A[4]*F+A[5])/G,de=gy(te,f,a),le=gy(W,h,a);switch(i){case"nearest":D=P4(N,h,f,b,v,w,j,le,de,K,c);break;case"bilinear":D=j4(N,h,f,b,v,w,j,le,de,K,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const oe=j*I+F*C+M*k+K;$[oe]=D}return s.makeTensorInfo(x,r.dtype,$)}return{dataId:s.write($,x,r.dtype),shape:r.shape,dtype:r.dtype}}const A4={kernelName:wm,backendName:"cpu",kernelFunc:T4};function gy(n,e,t){switch(t){case"reflect":return E4(n,e);case"wrap":return R4(n,e);case"nearest":return _4(n,e);case"constant":default:return D4(n)}}function E4(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return ii(0,t,e-1)}function R4(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return ii(0,t,e-1)}function D4(n,e){return n}function _4(n,e){return ii(0,n,e-1)}function Qa(n,e,t,s,r,o,i,a,c,l,d){const h=i*s+a*r+c*o+l;return 0<=a&&a<e&&0<=c&&c<t?n[h]:d}function P4(n,e,t,s,r,o,i,a,c,l,d){const h=Math.round(a),f=Math.round(c);return Qa(n,e,t,s,r,o,i,h,f,l,d)}function j4(n,e,t,s,r,o,i,a,c,l,d){const h=Math.floor(a),f=Math.floor(c),p=h+1,m=f+1,g=(m-c)*Qa(n,e,t,s,r,o,i,h,f,l,d)+(c-f)*Qa(n,e,t,s,r,o,i,h,m,l,d),x=(m-c)*Qa(n,e,t,s,r,o,i,p,f,l,d)+(c-f)*Qa(n,e,t,s,r,o,i,p,m,l,d);return(p-a)*g+(a-h)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M4(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;it(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:c,indices:l}=gN(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const F4={kernelName:vm,backendName:"cpu",kernelFunc:M4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],c=new Array(i-1);let l=0;for(let p=0;p<i;p++)p!==o&&(c[l++]=r.shape[p]);const d=new Array(i).fill(0),h=r.shape.slice();h[o]=1;const f=new Array(a);for(let p=0;p<f.length;p++){d[o]=p;const m=bi({inputs:{x:r},backend:t,attrs:{begin:d,size:h}});f[p]=fn({inputs:{x:m},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(m)}return f}const L4={kernelName:ah,backendName:"cpu",kernelFunc:O4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;it(r,"unsortedSegmentSum");const a=r.shape.length,c=o.shape.length,l=[],d=[],h=a-c;let f=o;for(let m=0;m<h;++m){const g=zu({inputs:{input:f},backend:t,attrs:{dim:m+1}});f=g,d.push(g)}for(let m=0;m<i;++m){const g=_o(m,"int32"),x=t.makeTensorInfo([],"int32",g),y=RC({inputs:{a:x,b:f},backend:t}),b=Ro({inputs:{x:y},backend:t,attrs:{dtype:"float32"}}),v=jh({inputs:{a:b,b:r},backend:t}),w=Dl({inputs:{x:v},backend:t,attrs:{axis:0,keepDims:!1}});l.push(w),d.push(x),d.push(y),d.push(b),d.push(v),d.push(w)}const p=RN({inputs:l,backend:t,attrs:{axis:0}});return d.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const W4={kernelName:ch,backendName:"cpu",kernelFunc:z4};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B4=[MO,gF,OO,zO,SF,BO,UO,HO,KO,XO,YO,eL,nL,oL,aL,uL,hL,pL,gL,PO,yL,wL,SL,NF,NL,wF,kF,kL,xF,TL,EL,RL,_L,jL,FL,LL,WL,VL,GL,qL,QL,JL,ZL,t3,n3,r3,i3,c3,l3,u3,d3,f3,g3,$O,y3,$F,k3,TF,$3,EF,_3,P3,M3,DF,PF,O3,z3,B3,U3,MF,OF,yF,H3,AL,K3,X3,Y3,TO,zF,BF,ez,UF,nz,oz,az,uz,hz,pz,mz,HF,xz,bz,vz,Cz,Iz,$z,Az,KF,Rz,Pz,Fz,XF,YF,zz,Vz,Hz,eO,Kz,Xz,Jz,DN,tW,EO,sO,sW,oW,aW,lW,bF,pp,dW,RO,DO,_O,fW,mW,xW,bW,vW,SW,NW,dO,kW,RW,_W,FW,fO,LW,WW,VW,pO,jz,HW,KW,XW,YW,e4,n4,r4,i4,xO,a4,bO,vO,l4,d4,f4,m4,x4,IO,p3,b4,v4,C4,I4,$4,A4,tO,F4,L4,W4,Qz];for(const n of B4)fw(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xo={},Hl={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function V4(n,e){Xo[n]=e}function vr(n,e){if(!(n in Xo)||e!=null){const s=G4(n,e);if(s!==null)Xo[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Xo[n];return t==null||t.isContextLost()?(delete Xo[n],vr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Xo[n])}function U4(n){if(!pe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function G4(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??U4(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Xo[n]},!1),pe().getBool("SOFTWARE_WEBGL_ENABLED")&&(Hl.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Hl)||t.getContext("experimental-webgl",Hl):t.getContext("webgl2",Hl)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fc;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(fc||(fc={}));var Os;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Os||(Os={}));var qn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qn||(qn={}));function _l(n,e){return[e,n]}function H4(n,e){return n*e}function ql(n){const e=Ce(n),t=Math.ceil(e/4);return Mf(t)}function Aa(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function q4(n,e){const[t,s]=Aa(n,e);return t*s*4}function h0(n,e){const t=n;let s,r,o,i,a,c,l,d,h,f;return pe().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,l=4,d=1,h=t.HALF_FLOAT,f=t.FLOAT,c=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,l=4,d=4,h=e!=null?e.HALF_FLOAT_OES:null,f=n.FLOAT,c=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ze(n,e){const t=e();return pe().getBool("DEBUG")&&K4(n),t}function K4(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+Y4(n,e))}const Q4=596e-10,X4=65504;function J4(n){return!!(pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Q4<Math.abs(n)&&Math.abs(n)<X4)}function Y4(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Kl(n,e){return lo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function Z4(n,e){const t=lo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ze(n,()=>n.shaderSource(t,e)),Ze(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function eB(n,e){const t=lo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ze(n,()=>n.shaderSource(t,e)),Ze(n,()=>n.compileShader(t)),pe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw _N(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const tB=/ERROR: [0-9]+:([0-9]+):/g;function _N(n,e){const t=tB.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((h,f)=>Xi((f+1).toString(),o)+h);let a=0;for(let h=0;h<i.length;h++)a=Math.max(i[h].length,a);const c=i.slice(0,s-1),l=i.slice(s-1,s),d=i.slice(s);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Xi(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function nB(n){return lo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function sB(n,e){if(Ze(n,()=>n.linkProgram(e)),!pe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function gf(n,e){if(Ze(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function rB(n,e){const t=lo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ze(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Ze(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function oB(n,e){const t=lo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ze(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Ze(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function iB(n){return lo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function aB(n,e){const t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function cB(n){return lo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function xy(n,e,t,s,r,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Ze(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Ze(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Ze(n,()=>n.enableVertexAttribArray(a)),!0)}function lB(n,e,t){pB(n,t),Ze(n,()=>n.activeTexture(n.TEXTURE0+t)),Ze(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function uB(n,e,t){return lo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function dB(n,e,t){return n.getUniformLocation(e,t)}function hB(n,e,t,s){Ze(n,()=>lB(n,e,s)),Ze(n,()=>n.uniform1i(t,s))}function xf(n,e,t){Ze(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Ze(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function yy(n,e){Ze(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Ze(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Ql(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+fB(n,e))}function fB(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function lo(n,e,t){const s=Ze(n,()=>e());if(s==null)throw new Error(t);return s}function pB(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function xa(n,e=2){return Ce(n.slice(0,n.length-e))}function ya(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Xl(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[xa(n),...ya(n)]),e}function mB(n,e=!1){let t=pe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=pe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&pe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,c)=>c>=n.length-2?Rp(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Do(n).newShape);let r=Ce(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=xa(n);let c=2,l=2;n.length&&([c,l]=ya(n)),r=a*(c/2)*(l/2),o=Mf(r).map(d=>d*2)}else o=Mf(r);return o}function Jl(n){return n%2===0}function Bu(n,e){if(n=n.slice(-2),e=e.slice(-2),nn(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Jl(t)&&Jl(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Jl(n[0])&&Jl(e[0])}let yf,bf;function gB(n){if(yf==null){const e=vr(n);yf=e.getParameter(e.MAX_TEXTURE_SIZE)}return yf}function xB(n){if(bf==null){const e=vr(n);bf=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,bf)}function yB(n){if(n===0)return 0;let e;const t=vr(n);return er(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:er(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function er(n,e){return n.getExtension(e)!=null}function by(n){try{if(vr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function bB(n){if(n===0)return!1;const e=vr(n);if(n===1){if(!er(e,"OES_texture_float"))return!1}else if(!er(e,"EXT_color_buffer_float"))return!1;return gp(e)}function wB(n){if(n===0)return!1;const e=vr(n);if(n===1){if(!er(e,"OES_texture_float")||!er(e,"WEBGL_color_buffer_float"))return!1}else{if(er(e,"EXT_color_buffer_float"))return gp(e);const s="EXT_color_buffer_half_float";if(er(e,s)){const r=e.getExtension(s);return vB(e,r)}return!1}return gp(e)}function gp(n){const e=h0(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function vB(n,e){const t=h0(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function SB(n){return n!==2?!1:vr(n).fenceSync!=null}function Pl(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&R(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ct=pe();ct.registerFlag("HAS_WEBGL",()=>ct.getNumber("WEBGL_VERSION")>0);ct.registerFlag("WEBGL_VERSION",()=>by(2)?2:by(1)?1:0);ct.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ct.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ct.get("WEBGL_VERSION")===2);ct.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ct.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ct.registerFlag("WEBGL_PACK",()=>ct.getBool("HAS_WEBGL"));ct.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_CLIP",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_REDUCE",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_LAZILY_UNPACK",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_CONV_IM2COL",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>gB(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>xB(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=ct.getNumber("WEBGL_VERSION");return n===0?0:yB(n)});ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ct.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Ew());ct.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>bB(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ct.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ct.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ct.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>wB(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_FENCE_API_ENABLED",()=>SB(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ct.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ct.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});ct.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Ew()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});ct.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ct.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ct.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ct.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ct.registerFlag("WEBGL_EXP_CONV",()=>!1);ct.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ct.getBool("IS_TEST"));ct.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ct.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ct.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ct.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fs(){let n,e,t,s,r,o,i,a,c,l;return pe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=pe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ei(n,e,t="index"){const s=pt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function Mh(n,e,t="index"){const s=pt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function CB(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function NB(n,e,t="index"){const s=n.map((o,i)=>i),r=CB(s,e);return r.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${r[i]}`,c=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${c};`}).join("")}function f0(n){const e=pt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function p0(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const PN=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:jN}=l_;function IB(n,e,t){const s=[];if(n.forEach(p=>{const m=Ce(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${m>1?`[${m}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),t.enableShapeUniforms){const{uniformShape:g}=m0(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(p=>kB(p,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=fs(),c=AB(a);let l,d,h=DB(a);return e.isPacked?(l=$B(e.logicalShape,i,t.enableShapeUniforms),d=RB(a)):(l=TB(e.logicalShape,i,t.enableShapeUniforms),d=EB(a)),t.packedInputs&&(h+=MB),[h,c,d,r,l,o,t.userCode].join(`
`)}function Ea(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return KB(n,e);case 1:return XB(n,e);case 2:return YB(n,e);case 3:return e5(n,e);case 4:return n5(n,e);case 5:return s5(n);case 6:return r5(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function MN(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return qB(n);case 1:return QB(n,e);case 2:return JB(n,e);case 3:return ZB(n,e);default:return t5(n,e)}}function kB(n,e,t=!1,s){let r="";t?r+=MN(n,s):r+=Ea(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=o5(n,e):r+=i5(n,e)),r}function $B(n,e,t){switch(n.length){case 0:return FN();case 1:return FB(n,e,t);case 2:return GB(n,e,t);case 3:return LB(n,e,t);default:return WB(n,e,t)}}function TB(n,e,t){switch(n.length){case 0:return FN();case 1:return OB(n,e,t);case 2:return HB(n,e,t);case 3:return zB(n,e,t);case 4:return BB(n,e,t);case 5:return VB(n,e);case 6:return UB(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function AB(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function EB(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function RB(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function DB(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${_B}
    ${PB}
    ${jB}
  `}const _B=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,PB=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jB=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,MB=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function FN(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function FB(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function OB(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function LB(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function zB(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Mh(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Ei(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function WB(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",c="b, r, c";for(let l=2;l<n.length-1;l++)i*=n[n.length-l-1],a=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+a,c=`b${l}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${c});
    }
  `}function BB(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Mh(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ei(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function VB(n,e){const t=Ei(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function UB(n,e){const t=Ei(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function GB(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(nn(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function HB(n,e,t){return nn(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ri(n){return`offset${n}`}function qB(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=fs();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function KB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Ri(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,c]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function QB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=fs();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function XB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Ra(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ri(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function JB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],c=fs();if(o!=null&&nn(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function YB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&nn(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Do(t),c=i;if(c.length<t.length){const f=Da(n,c),p=["row","col"];return`
      ${Ea(f,e)}
      float ${r}(int row, int col) {
        return ${r}(${_a(p,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Ra(n)}
      }
    `;const l=o[0],d=o[1],h=Ri(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function ZB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const f=t.slice(1),p=[1,2],m=Da(n,f),g=["b","row","col"];return`
        ${MN(m,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${_a(g,p)});
        }
      `}const a=fs();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const c=i[0],l=i[1],d=Math.ceil(t[2]/2),h=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function e5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:c}=Do(t),l=a;if(l.length<t.length){const g=Da(n,l),x=["row","col","depth"];return`
        ${Ea(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${_a(x,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Ra(n)}
      }
    `;const d=n.shapeInfo.texShape,h=d[0],f=d[1],p=n.shapeInfo.flatOffset;if(f===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const m=Ri(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function t5(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=fs();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],d=c[1],h=Math.ceil(o[i-1]/2);let f=h*Math.ceil(o[i-2]/2),p="int b, int row, int col",m=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<i-1;g++)p=`int b${g}, `+p,f*=o[i-g-1],m=`b${g} * ${f} + `+m;return`
    vec4 ${s}(${p}) {
      int index = ${m};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${l});
      return ${r.texture2D}(${t}, uv);
    }
  `}function n5(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:c,keptDims:l}=Do(t);if(c.length<t.length){const b=Da(n,c),v=["row","col","depth","depth2"];return`
      ${Ea(b,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${_a(v,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Ra(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],p=h[1],m=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${m}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Ri(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function s5(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:c,keptDims:l}=Do(e);if(c.length<e.length){const g=Da(n,c),x=["row","col","depth","depth2","depth3"];return`
      ${Ea(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${_a(x,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Ra(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,f=h[0],p=h[1];if(p===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const m=Ri(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function r5(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=Do(e);if(r.length<e.length){const x=Da(n,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ea(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${_a(y,o)});
      }
    `}const i=e[5],a=e[4]*i,c=e[3]*a,l=e[2]*c,d=e[1]*l;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ra(n)}
      }
    `;const h=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],m=f[1];if(m===d&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(m===i&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const g=Ri(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Ra(n){const e=n.name,t=Ce(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function o5(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=jN(n.shapeInfo.logicalShape,e.logicalShape),c=an(i),l=i-o;let d;const h=["x","y","z","w","u","v"];o===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(b=>`coords.${h[b+l]} = 0;`).join(`
`);let f="";i<2&&o>0?f="coords":f=n.shapeInfo.logicalShape.map((b,v)=>`coords.${h[v+l]}`).join(", ");let p="return outputValue;";const g=Ce(n.shapeInfo.logicalShape)===1,y=Ce(e.logicalShape)===1;if(o===1&&!g&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)i===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=o-2,v=o-1;a.indexOf(b)>-1&&a.indexOf(v)>-1?p="return vec4(outputValue.x);":a.indexOf(b)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${f});
      ${p}
    }
  `}function i5(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===c&&n.shapeInfo.flatOffset==null&&nn(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const l=an(c),d=jN(n.shapeInfo.logicalShape,e.logicalShape),h=c-a;let f;const p=["x","y","z","w","u","v"];a===0?f="":c<2&&d.length>=1?f="coords = 0;":f=d.map(g=>`coords.${p[g+h]} = 0;`).join(`
`);let m="";return c<2&&a>0?m="coords":m=n.shapeInfo.logicalShape.map((g,x)=>`coords.${p[x+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${f}
      return get${s}(${m});
    }
  `}function an(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function m0(n,e,t){const{newShape:s,keptDims:r}=Do(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):s,c=!n&&o>1&&!nn(e,t)&&s.length<o||i;return{useSqueezeShape:c,uniformShape:c?a:e,keptDims:r}}function Da(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function _a(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(n,e,t,s){const r=t.map((d,h)=>{const f={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(f.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:f}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=IB(r,i,e),c=eB(n.gl,a),l=n.createProgram(c);return pe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i},ON(n,e,l)))}function ON(n,e,t){const s=[],r=[];let o,i,a,c=null,l=null;l=n.getUniformLocation(t,"NAN",!1),pe().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const h of e.variableNames){const f={name:h,uniform:n.getUniformLocation(t,h,d),offset:n.getUniformLocation(t,`offset${h}`,d)};e.enableShapeUniforms&&(f.shape=n.getUniformLocation(t,`${h}Shape`,d),f.texShape=n.getUniformLocation(t,`${h}TexShape`,d)),s.push(f)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),i=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const h of e.customUniforms)r.push(n.getUniformLocation(t,h.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:c,nanLoc:l,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function wy(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!nn(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,c=o.isUniform?null:o.texData.texShape;if(!nn(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function c5(n,e,t,s,r){e.program.enableShapeUniforms||(wy(e.inShapeInfos,t),wy([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),pe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){const l=t[c],{uniform:d,offset:h,shape:f,texShape:p}=e.variablesLocations[c];if(f){const{uniformShape:m}=m0(e.program.packedInputs,l.shape,l.texData.texShape);switch(m.length){case 1:n.gl.uniform1iv(f,new Int32Array(m));break;case 2:n.gl.uniform2iv(f,new Int32Array(m));break;case 3:n.gl.uniform3iv(f,new Int32Array(m));break;case 4:n.gl.uniform4iv(f,new Int32Array(m));break}}if(p&&n.gl.uniform2i(p,l.texData.texShape[0],l.texData.texShape[1]),d!=null){if(l.isUniform){if(Ce(l.shape)<2)n.gl.uniform1f(d,l.uniformValues[0]);else{let m=l.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),n.gl.uniform1fv(d,m)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,d,c)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const c=pt(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const l=e.program.customUniforms[c],d=e.customUniformLocations[c],h=r[c];if(l.type==="float")n.gl.uniform1fv(d,h);else if(l.type==="vec2")n.gl.uniform2fv(d,h);else if(l.type==="vec3")n.gl.uniform3fv(d,h);else if(l.type==="vec4")n.gl.uniform4fv(d,h);else if(l.type==="int")n.gl.uniform1iv(d,h);else if(l.type==="ivec2")n.gl.uniform2iv(d,h);else if(l.type==="ivec3")n.gl.uniform3iv(d,h);else if(l.type==="ivec4")n.gl.uniform4iv(d,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function l5(n,e,t){let s="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const c=i.texData.texShape,{useSqueezeShape:l,uniformShape:d,keptDims:h}=m0(n.packedInputs,i.shape,c);let f="",p="",m="";if(d.length===1&&n.packedInputs){const S=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];f=`${S[0]>1}_${S[1]>1}`}else if(d.length===2&&!n.packedInputs)p=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const S=pt(d);m=`${S[0]===c[1]}_${S[S.length-1]===c[1]}`}const g=i.shape.length,x=d.length===2&&nn(i.shape,c),y=Ce(i.shape)===1,b=ua(i.shape,t.shape),v=!n.packedInputs&&g===t.shape.length&&nn(c,t.texData.texShape),w=n.packedInputs||d.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${g}_${v}_${l?h:""}_${d.length}_${y}_${b}_${x}_${f}_${p}_${m}_${w}_${a}`}else{const c=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${c}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${pe().getNumber("WEBGL_VERSION")}`,o}function os(n){return pe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u5{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=fc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=fs();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Mh(["r","c","d"],e):Ei(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d5{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=fc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=fs();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Mh(["r","c","d"],e):Ei(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h5{constructor(e){this.variableNames=["A"],this.outTexUsage=Os.DOWNLOAD;const t=fs();this.outputShape=e,this.userCode=`
      ${PN}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f5{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Os.DOWNLOAD;const t=fs();this.outputShape=e,this.userCode=`
      ${PN}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p5={R:0,G:1,B:2,A:3};class vy{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=fs();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const c=s[a];i+=`
          if(offset == ${a}) {
            result = values[${p5[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?p0():f0(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m5{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=fs();this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const c=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?p0():f0(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(n){const e=fs(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Z4(n,t)}function x5(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return rB(n,e)}function y5(n){const e=new Uint16Array([0,1,2,2,1,3]);return oB(n,e)}function jl(n,e,t,s,r,o){aB(e,t);const i=iB(n),a=n.TEXTURE_2D;return Ze(n,()=>n.bindTexture(a,i)),Ze(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Ze(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Ze(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Ze(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),pe().getNumber("WEBGL_VERSION")===1?Ze(n,()=>n.texImage2D(a,0,s,e,t,0,r,o,null)):Ze(n,()=>n.texStorage2D(a,1,s,e,t)),Ze(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function LN(n){return n.internalFormatFloat}function b5(n,e,t,s){const[r,o]=_l(e,t);return jl(n,r,o,LN(s),s.textureFormatFloat,n.FLOAT)}function zN(n){return n.internalFormatHalfFloat}function w5(n,e,t,s){const[r,o]=_l(e,t);return jl(n,r,o,zN(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function WN(n){return n.downloadTextureFormat}function v5(n,e,t,s){const[r,o]=_l(e,t);return jl(n,r,o,WN(s),n.RGBA,n.UNSIGNED_BYTE)}function BN(n){return n.internalFormatPackedFloat}function S5(n,e,t,s){const[r,o]=Aa(e,t);return jl(n,r,o,BN(s),n.RGBA,n.FLOAT)}function VN(n){return n.internalFormatPackedHalfFloat}function C5(n,e,t,s){const[r,o]=Aa(e,t);return jl(n,r,o,VN(s),n.RGBA,s.textureTypeHalfFloat)}function N5(n,e,t){return Ze(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),xy(n,e,"clipSpacePos",t,3,20,0)&&xy(n,e,"uv",t,2,20,12)}function I5(n,e,t,s,r,o){Ze(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,c;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,c=n.RGBA):(i=new Float32Array(t*s*4),a=n.FLOAT,c=o.internalFormatPackedFloat),i.set(r),pe().getNumber("WEBGL_VERSION")===2?Ze(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,i)):Ze(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,t,s,0,n.RGBA,a,i)),Ze(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function k5(n,e,t){Ze(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?pe().getNumber("WEBGL_VERSION")===2?Ze(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Ze(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):pe().getNumber("WEBGL_VERSION")===2?Ze(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Ze(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Ze(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function $5(n,e,t,s){const r=n.createBuffer();Ze(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Ze(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Ze(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Ze(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function T5(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function A5(n,e,t,s){const[r,o]=_l(e,t),i=4,a=new Uint8Array(H4(e*t,i));return Ze(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function E5(n,e,t,s,r,o,i,a){const c=n,l=new Float32Array(q4(o,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function R5(n,e,t){const s=new Float32Array(e*t*4);return Ze(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wf{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=pe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,V4(t,e)):this.gl=vr(t),e=this.gl,pe().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Ze(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Ze(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Ze(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Ze(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ze(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Ze(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Ze(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Ze(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),pe().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Kl(this.gl,o),er(this.gl,i))this.textureHalfFloatExtension=Kl(this.gl,i);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),er(this.gl,r))this.colorBufferHalfFloatExtension=Kl(this.gl,r);else if(pe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",er(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(er(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=x5(this.gl),this.indexBuffer=y5(this.gl),this.framebuffer=cB(this.gl),this.textureConfig=h0(this.gl,this.textureHalfFloatExtension)}get debug(){return pe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ze(e,()=>e.finish()),Ze(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ze(e,()=>e.deleteFramebuffer(this.framebuffer)),Ze(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ze(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ze(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),b5(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),w5(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),v5(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),k5(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),I5(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),C5(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),S5(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(yy(this.gl,this.framebuffer),this.outputTexture=null),Ze(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>A5(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return E5(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return T5(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=$5(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(pe().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>R5(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=g5(t));const s=nB(t);Ze(t,()=>t.attachShader(s,this.vertexShader)),Ze(t,()=>t.attachShader(s,e)),sB(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&gf(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Ze(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),N5(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ze(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&gf(this.gl,this.program),Ze(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?uB(this.gl,e,t):dB(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Ze(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),hB(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=Aa(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&gf(this.gl,this.program),Ql(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ze(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ze(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Kl(this.gl,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await ix(()=>this.disposed||this.isQueryAvailable(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=D5(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in pe().platform&&(s=pe().platform.setTimeoutCustom.bind(pe().platform)),ix(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),xf(this.gl,e,this.framebuffer),this.debug&&Ql(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(xf(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ql(this.gl)):yy(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;xf(r,e,this.framebuffer),this.debug&&Ql(r),this.outputTexture=e,Ze(r,()=>r.viewport(0,0,t,s)),Ze(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Ze(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function D5(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:_5,bincountImpl:UN,bincountReduceImpl:P5,bitwiseAndImpl:j5,castImpl:M5,ceilImpl:F5,concatImpl:O5,equalImpl:L5,expImpl:z5,expm1Impl:W5,floorImpl:B5,gatherNdImpl:V5,gatherV2Impl:U5,greaterImpl:G5,greaterEqualImpl:H5,lessImpl:q5,lessEqualImpl:K5,linSpaceImpl:Q5,logImpl:X5,maxImpl:J5,maximumImpl:Y5,minimumImpl:Z5,multiplyImpl:eV,negImpl:tV,notEqualImpl:nV,prodImpl:sV,raggedGatherImpl:rV,raggedRangeImpl:oV,raggedTensorToTensorImpl:iV,rangeImpl:aV,rsqrtImpl:cV,scatterImpl:lV,sigmoidImpl:uV,simpleAbsImpl:GN,sliceImpl:dV,sparseFillEmptyRowsImpl:hV,sparseReshapeImpl:fV,sparseSegmentReductionImpl:HN,sqrtImpl:pV,staticRegexReplaceImpl:mV,stridedSliceImpl:gV,stringNGramsImpl:xV,stringSplitImpl:yV,stringToHashBucketFastImpl:bV,subImpl:wV,tileImpl:vV,topKImpl:SV,transposeImpl:g0,uniqueImpl:CV}=kO;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qN(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function us(n,e){return e===1?[n]:qN(n,e)}function NV(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IV{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=os(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=us("rc",this.rank),s=an(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${kV(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?p0():f0(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function kV(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?NB(["r","c","d"],"inputShape"):Ei(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $V{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=Cy(t,s),o=Ny(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=Sy(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const c=this.freeTextures[o].pop();return this.usedTextures[o].push(c),c}let a;return r===qn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===qn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===qn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=Cy(s,r),i=Ny(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=Sy(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=pe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[i],d=l&&l.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[d]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function TV(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function Sy(n,e,t,s,r){const o=AV(e,s);let i;if(r){const[c,l]=Aa(n[0],n[1]);i=c*l}else{const[c,l]=_l(n[0],n[1]);i=c*l}const a=TV(t,o);return i*a}function AV(n,e){switch(n){case qn.PACKED_2X2_FLOAT32:return BN(e);case qn.PACKED_2X2_FLOAT16:return VN(e);case qn.UNPACKED_FLOAT32:return LN(e);case qn.UNPACKED_FLOAT16:return zN(e);case qn.PACKED_4X1_UNSIGNED_BYTE:return WN(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function EV(n){return pe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qn.PACKED_2X2_FLOAT32:qn.UNPACKED_FLOAT32:n?qn.PACKED_2X2_FLOAT16:qn.UNPACKED_FLOAT16}function Cy(n,e){if(n===Os.UPLOAD)return qn.PACKED_2X2_FLOAT32;if(n===Os.RENDER||n==null)return EV(e);if(n===Os.DOWNLOAD||n===Os.PIXELS)return qn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function Ny(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _r{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const or="if (isnan(x)) return x;",RV="return x;",Iy="return abs(x);",DV="return (x >= 0.0) ? x : (exp(x) - 1.0);",_V=or+`
  return (x < 0.0) ? 0.0 : x;
`,PV=or+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,po="return x;",jV="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MV="return x;",FV=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,OV=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,LV=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zV="return 1.0 / (1.0 + exp(-1.0 * x));";class yo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WV{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const t=e.length,s=us("rc",t),r=an(t),o=NV(t,s),i=s.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BV=xv,VV=1e-7,UV=1e-4,Yl={};function GV(n){return n in Yl||(Yl[n]={}),Yl[n]}const HV=pe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),qV=600;function KV(){return pe().global.screen==null?1024:pe().global.screen.height*pe().global.screen.width*window.devicePixelRatio*qV/1024/1024}class Fh extends Ep{nextDataId(){return Fh.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!pe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof wf)t=e;else{const s=vr(pe().getNumber("WEBGL_VERSION"),e);t=new wf(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=vr(pe().getNumber("WEBGL_VERSION"));t=new wf(s),this.binaryCache=GV(pe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new $V(this.gpgpu),this.numMBBeforeWarning=KV(),this.texData=new Ob(this,$r())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,i){const a=this.makeTensorInfo(t,s),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,o]},c.texShape=[r,o];const l=Xl(t),d=new vy(l,!1,i),h=this.runWebGLProgram(d,[a],s,[[r,o]]);return h.shape=t,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,t,s){if((pe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||pe().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Os.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(pe().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Os.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:c}=t;if(i!=null){let f;c?f=new yo(a,po):f=new _r(a,po);const p=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:r}],r),m=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),m}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const l=this.activeTimers!=null;let d;l&&(d=ms());let h;if(r==="complex64"){const f=this.readSync(o.real.dataId),p=this.readSync(o.imag.dataId);h=so(f,p)}else h=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=ms()-d),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:c}=t;if(o!=null){let m;c?m=new yo(r,po):m=new _r(r,po);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:i}],i),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(pe().getBool("DEBUG")&&!pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&pe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,d;if(i!=="complex64"&&pe().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const m=this.texData.get(d.dataId);l=this.gpgpu.createBufferFromTexture(m.texture.texture,...ql(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=m[0],x=m[1];h=so(g,x)}else if(l==null)h=this.getValuesFromTexture(e);else{const m=Ce(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,m)}if(d!=null&&this.disposeIntermediateTensorInfo(d),l!=null){const m=this.gpgpu.gl;Ze(m,()=>m.deleteBuffer(l))}const f=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(m=>m(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&$r().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:c,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let p;c?p=new yo(o,po):p=new _r(o,po);const m=this.runWebGLProgram(p,[{dataId:e,shape:o,dtype:a}],a),g=this.readToGPU(m,t);return this.disposeIntermediateTensorInfo(m),g}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),h=$r().makeTensorFromTensorInfo(d),f=this.texData.get(d.dataId);return Object.assign({tensorRef:h},f.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>ko(r));return zt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return zt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!J4(s))throw pe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=Ce(t);if(pe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),p=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...ql(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),m}const i=pe().getBool("WEBGL_PACK")&&r===!0,a=i?Xl(t):t,c=i?new f5(a):new h5(a),l=this.runWebGLProgram(c,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=ai(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),i=ai(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(o);a.kernelMs=f$(c),a.getExtraProfileInfo=()=>c.map((l,d)=>({name:i[d],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ms(),endMs:null}}endTimer(e){return pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ms(),e)}async getQueryTime(e){if(pe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),c=a&&a.origDataId||e,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=HV){return pe().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&Ce(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Fs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return BV(e.shape,t)}packedUnaryOp(e,t,s){const r=new yo(e.shape,t),o=this.compileAndRun(r,[e],s);return $r().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=GN(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(pe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Iy,e.dtype);const t=new _r(e.shape,Iy),s=this.compileAndRun(t,[e]);return $r().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&wc(s[0])){const o=s.map(i=>wo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return $r().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new WV(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new IV(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[xa(e.shape),...ya(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[xa(t),...ya(t)],i=new KN(o,s),a=!0,c=[s],l=this.runWebGLProgram(i,[r],e.dtype,c,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const f=Ce(o),p=t[0]*t[1]*4;R(f<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Xl(o);let c;r?c=new d5(a):c=new u5(a);const l=!0,d=[t??ql(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:i,dataId:e}],i,d,l,t);return{dtype:i,shape:o,dataId:h.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),c=this.texData.get(a.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===fc.DENSE){const y=i??ql(e.outputShape);c.texShape=y.map(b=>b*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),Ce(a.shape)===0)return c.values=es(a.dtype,0),a;const l=[],d=t.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!e.packedInputs&&Ce(y.shape)<=pe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!e.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!Bu(b.shape,y.shape)){const v=y,w=y.shape;y.shape=b.shape,y=this.packedReshape(y,w),l.push(y),b=this.texData.get(y.dataId),v.shape=w}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},f=l5(e,d,h),p=this.getAndSaveBinary(f,()=>a5(this.gpgpu,e,d,h)),m=this.activeTimers!=null;let g;m&&(g=this.startTimer()),pe().get("ENGINE_COMPILE_ONLY")||c5(this.gpgpu,p,d,h,r),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=pe().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const y=ms();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!pe().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(pe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ae(()=>{if(!pe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=pe().getBool("DEBUG");pe().set("DEBUG",!1);const t=this.abs(tn(1e-8)).dataSync()[0];if(pe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?VV:UV}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:c}=t;if(i!=null)return;const l=this.activeTimers!=null;let d;l&&(d=ms());let h=t.texShape;if(h==null&&(h=mB(s,c),t.texShape=h),o!=null){const f=Xl(s);let p,m=h[1],g=h[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(c||!x)&&([m,g]=Aa(h[0],h[1])),c?p=new m5(f,x):p=new vy(f,x);const y=x?[g,m]:h,b=this.makeTensorInfo(y,r),v=this.texData.get(b.dataId);x?v.usage=Os.PIXELS:v.usage=Os.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,g,o);const w=[[g,m]],I=this.runWebGLProgram(p,[b],r,w,!0),C=this.texData.get(I.dataId);t.texShape=C.texShape,t.isPacked=C.isPacked,t.usage=C.usage,pe().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=C.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=ms()-d)}else{const f=this.acquireTexture(h,a,r,c);t.texture=f}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=QV(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*mu(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Mv(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(_N(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:c}=ON(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,c=$r().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(r,t,s,o,i,a);return $r().makeTensorFromDataId(l,t,s,c)}}Fh.nextDataId=0;function QV(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Rw()&&Pw("webgl",()=>new Fh,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x0=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class wi{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=_t(t,s),this.enableShapeUniforms=os(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Di=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Pa{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_t(t,s);const o=this.outputShape.length;this.enableShapeUniforms=os(o);let i="";if(r)if(o===0||Ce(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${an(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=us("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ps(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const XV={kernelName:Wc,backendName:"webgl",kernelFunc:Ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bo(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),a=Ps({inputs:{x:s},backend:t}),c=Ps({inputs:{x:r},backend:t});return i.complexTensorInfos={real:a,imag:c},o}const JV={kernelName:Vp,backendName:"webgl",kernelFunc:Bo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QN="return (a < 0.) ? b * a : a;",XN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function YV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",_o(o,"float32")),a=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Pa(XN,r.shape,i.shape):new wi(QN,r.shape,i.shape),c=t.runWebGLProgram(a,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),c}const ZV={kernelName:Ed,backendName:"webgl",kernelFunc:YV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN="return (a < 0.) ? b * a : a;",YN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function eU(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Pa(YN,s.shape,r.shape):new wi(JN,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const tU={kernelName:Qd,backendName:"webgl",kernelFunc:eU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ja="if (isnan(x)) return x;";function Qt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,c=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const h=a.texData.get(i.dataId),f=t(h.values,c);return a.makeTensorInfo(i.shape,c,f)}const l=pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return l?d=new yo(i.shape,e):d=new _r(i.shape,n),a.runWebGLProgram(d,[i],c)}}function Jn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:c,b:l}=i,d=a;if(s&&c.dtype==="complex64"){const m=d.texData.get(c.dataId),g=d.texData.get(l.dataId),[x,y]=[[m.complexTensorInfos.real,g.complexTensorInfos.real],[m.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[w,S]=v,I={dataId:w.dataId,dtype:w.dtype,shape:c.shape},C={dataId:S.dataId,dtype:S.dtype,shape:l.shape},k=new wi(n,c.shape,l.shape);return d.runWebGLProgram(k,[I,C],Ds(w.dtype,S.dtype))}),b=Bo({inputs:{real:x,imag:y},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(y),b}const h=o||Ds(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||d.shouldExecuteOnCPU([c,l]))&&r!=null){const m=d.texData.get(c.dataId).values,g=d.texData.get(l.dataId).values,x=c.dtype==="string"?ro(m):m,y=c.dtype==="string"?ro(g):g,[b,v]=r(c.shape,l.shape,x,y,h),w=d.makeTensorInfo(v,h),S=d.texData.get(w.dataId);return S.values=b,w}const f=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return f?p=new Pa(e,c.shape,l.shape,t):p=new wi(n,c.shape,l.shape),d.runWebGLProgram(p,[c,l],h)}}function pc(n,e=!1){if(n==="linear")return e?MV:RV;if(n==="relu")return e?OV:_V;if(n==="elu")return e?FV:DV;if(n==="relu6")return e?LV:PV;if(n==="prelu")return e?YN:JN;if(n==="leakyrelu")return e?XN:QN;if(n==="sigmoid")return e?zV:jV;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZN{constructor(e,t,s,r=!1,o=!1,i=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=os(this.outputShape.length);const d=r?e[1]:e[2],h=Math.ceil(d/2),f=r?"i * 2, rc.y":"rc.y, i * 2",p=o?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",y="";a&&(c?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",w="rc.x";e[0]<t[0]?v=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(w=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${w};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${g[0]});
          result += (${m[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ky={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class $y{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=_t(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ty="return a * b;";function y0(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=Ds(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),l=new $y(ky.REAL,s.shape,r.shape),d=new $y(ky.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],f=t.runWebGLProgram(l,h,"float32"),p=t.runWebGLProgram(d,h,"float32"),m=Bo({inputs:{real:f,imag:p},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),m}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),[l,d]=eV(s.shape,r.shape,a.values,c.values,o),h=t.makeTensorInfo(d,o),f=t.texData.get(h.dataId);return f.values=l,h}let i;return pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Pa(Ty,s.shape,r.shape):i=new wi(Ty,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const nU={kernelName:Xc,backendName:"webgl",kernelFunc:y0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sU(n,e,t){const s=[xa(n.shape),...ya(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[xa(e),...ya(e)],i=new KN(o,s),a=!0,c=[s],l=t.runWebGLProgram(i,[r],n.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,a=Ce(r.shape),c=zb(o,a),l=Ce(c);R(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!Bu(r.shape,c)&&!(d.texture!==null&&Bu(d.shape,c))?sU(r,c,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const rU={kernelName:Jd,backendName:"webgl",kernelFunc:qe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ay{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,c=s%4;let l="sumValue += dot(values, ones);";if(t!=null){const h=1/t;l=`sumValue += dot(values * ${ia(h)?h.toPrecision(2):h}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oU{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",c="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",c="min"):t==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");const d=Math.floor(s/4)*4,h=s%4;let f=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=wh(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function _i(n,e,t,s){const r=iU(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:c,outSize:l}=r[i];let d,h;t==="mean"?d=i===0?new Ay({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},a):new Ay({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l}):d=new oU({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},t),h=o,o=s.runWebGLProgram(d,[o],e),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aU{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=an(this.rank),o=cU(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function cU(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lU{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=an(this.rank),o=qN("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const a=`vec2(${i.slice(-2).join()})`,c=`++${o[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(n,e,t){const s=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lU(n.shape,e):new aU(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uU(n,e,t,s){const r=e,o=n.shape.length,i=Wt(r,n.shape);let a=i;const c=Sn(a,o),l=c!=null;let d=n;l&&(d=Oh(n,c,s),a=Tn(a.length,o)),Xn("sum",a,o);const[h,f]=Hn(d.shape,a);let p=h;t&&(p=Dn(h,i));const m=Ce(f),x=Ce(n.shape)/m,y=qe({inputs:{x:d},attrs:{shape:[x,m]},backend:s}),b=Nm(n.dtype),v=_i(y,b,"sum",s),w=qe({inputs:{x:v},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),l&&s.disposeIntermediateTensorInfo(d),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return uU(r,o,i,t)}const dU={kernelName:sh,backendName:"webgl",kernelFunc:Lh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hs(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,a=r.shape.length,c=new Array(a);for(let d=0;d<c.length;d++)c[d]=r.shape[o[d]];let l;if(i.shouldExecuteOnCPU([r])){const h=i.texData.get(r.dataId).values,f=g0(h,r.shape,r.dtype,o,c);l=i.makeTensorInfo(c,r.dtype);const p=i.texData.get(l.dataId);p.values=f}else l=Oh(r,o,i);return l}const hU={kernelName:Ji,backendName:"webgl",kernelFunc:hs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eI=1e3;function Vu({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){const l=n.shape.length,d=e.shape.length,h=t?n.shape[l-2]:n.shape[l-1],f=s?e.shape[d-1]:e.shape[d-2],p=t?n.shape[l-1]:n.shape[l-2],m=s?e.shape[d-2]:e.shape[d-1],g=n.shape.slice(0,-2),x=e.shape.slice(0,-2),y=Ce(g),b=Ce(x),w=_t(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,m]);R(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=t?[y,h,p]:[y,p,h],I=s?[b,m,f]:[b,f,m],C=qe({inputs:{x:n},backend:r,attrs:{shape:S}}),k=qe({inputs:{x:e},backend:r,attrs:{shape:I}}),$=[C,k],N=Math.max(y,b),_=t?C.shape[1]:C.shape[2],P=o!=null,j=i!=null,A=c==="leakyrelu",F=c!=null?pc(c,!0):null,M=P||j||A||F!=null;let K;if((p===1||m===1)&&_>eI&&M===!1){let G=C,te=k;t&&(G=hs({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),$.push(G)),s&&(te=hs({inputs:{x:k},backend:r,attrs:{perm:[0,2,1]}}),$.push(te));const W=m!==1,de=m===1;let le=G;W&&(le=qe({inputs:{x:G},backend:r,attrs:{shape:[N,_,1]}}),$.push(le));const oe=m===1?2:1;let ge=te;de&&(ge=qe({inputs:{x:te},backend:r,attrs:{shape:[N,1,_]}}),$.push(ge));const Ae=y0({inputs:{a:le,b:ge},backend:r});K=Lh({inputs:{x:Ae},backend:r,attrs:{axis:oe,keepDims:!0}}),$.push(Ae)}else{const G=Ds(n.dtype,e.dtype),te=new ZN(S,I,[N,p,m],t,s,P,F,j,A),W=[C,k];if(o!=null&&W.push(o),j&&W.push(i),A){const de=r.makeTensorInfo([],"float32",_o(a,"float32"));W.push(de),$.push(de)}K=r.runWebGLProgram(te,W,G)}const D=qe({inputs:{x:K},backend:r,attrs:{shape:w}});$.push(K);for(const G of $)r.disposeIntermediateTensorInfo(G);return D}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;return Vu({a:r,b:o,transposeA:c,transposeB:l,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const pU={kernelName:gu,backendName:"webgl",kernelFunc:fU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ey="return abs(x);";function mU(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=GN(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new yo(s.shape,Ey):r=new _r(s.shape,Ey),t.runWebGLProgram(r,[s],s.dtype)}const gU={kernelName:ud,backendName:"webgl",kernelFunc:mU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU=or+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,yU=Qt({opSnippet:xU}),bU={kernelName:vc,backendName:"webgl",kernelFunc:yU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU=or+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,vU=Qt({opSnippet:wU}),SU={kernelName:Sc,backendName:"webgl",kernelFunc:vU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ry="return a + b;",CU=Jn({opSnippet:Ry,packedOpSnippet:Ry,supportsComplex:!0,cpuKernelImpl:_5}),NU={kernelName:Ca,backendName:"webgl",kernelFunc:CU};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IU{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kU{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function du(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return Ps({inputs:{x:s[0]},backend:t});if(s.length>pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),l=du({inputs:s.slice(0,c),backend:t}),d=du({inputs:s.slice(c),backend:t});return du({inputs:[l,d],backend:t})}const r=s.map(c=>c.dtype).reduce((c,l)=>Ds(c,l)),o=s.map(c=>c.shape),a=pe().getBool("WEBGL_PACK")?new kU(s[0].shape,o):new IU(s[0].shape,o);return t.runWebGLProgram(a,s,r)}const $U={kernelName:Mp,backendName:"webgl",kernelFunc:du};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Wt(o,r.shape);let l=c;const d=Sn(l,a);let h=r;d!=null&&(h=hs({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,a)),Xn("all",l,a);const[f,p]=Hn(h.shape,l),m=Ce(p),g=qe({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=_i(g,g.dtype,"all",t);let y;if(i){const b=Dn(f,c);y=qe({inputs:{x},backend:t,attrs:{shape:b}})}else y=qe({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const AU={kernelName:Fp,backendName:"webgl",kernelFunc:TU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Wt(o,r.shape);let l=c;const d=Sn(l,a);let h=r;d!=null&&(h=hs({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,a)),Xn("any",l,a);const[f,p]=Hn(h.shape,l),m=Ce(p),g=qe({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=_i(g,g.dtype,"any",t);let y;if(i){const b=Dn(f,c);y=qe({inputs:{x},backend:t,attrs:{shape:b}})}else y=qe({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const RU={kernelName:Op,backendName:"webgl",kernelFunc:EU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DU{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _U{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,R(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=an(c),d=us("coords",c);let h,f;if(i===1){f=c+1;const k=an(f);h=`
        ${k} sourceLocR = ${k}(${d.join()}, 0);
        ++${d[c-1]};
        ${k} sourceLocG = ${k}(${d.join()}, 0);
        ++${d[c-2]};
        ${k} sourceLocA = ${k}(${d.join()}, 0);
        --${d[c-1]};
        ${k} sourceLocB = ${k}(${d.join()}, 0);
        --${d[c-2]};`}else f=c,h=`
        ${l} sourceLocR = coords;
        ++${d[c-1]};
        ${l} sourceLocG = coords;
        ++${d[c-2]};
        ${l} sourceLocA = coords;
        --${d[c-1]};
        ${l} sourceLocB = coords;
        --${d[c-2]};`;const p=["x","y","z","w","u","v"].slice(0,f),m="."+p[f-1],g=p.map(k=>"int "+k),x=us("sourceLocR",f-1).concat("inIdx.r"),y=us("sourceLocG",f-1).concat("inIdx.g"),b=us("sourceLocB",f-1).concat("inIdx.b"),v=us("sourceLocA",f-1).concat("inIdx.a"),w=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${v.join()})));`,I=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,C=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${C}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${d[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${d[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${I};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${I};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tI(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=wh(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},c=new DU(a,t,s==null),l=[e];s!=null&&l.push(s);const d=n.runWebGLProgram(c,l,"int32");if(d.shape[1]===1)return d;const h=tI(n,e,t,d);return n.disposeIntermediateTensorInfo(d),h}function nI(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=wh(o),a=new _U(r,i,t,s==null),c=s==null?[e]:[e,s],l=n.runWebGLProgram(a,c,"int32");if(l.shape.length===e.shape.length){const d=nI(n,e,t,l);return n.disposeIntermediateTensorInfo(l),d}return l}function sI(n,e,t,s){const r=[t];if(Xn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!pe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let c=e;a&&(c=n.unpackTensor(e),o.push(c));const[l,d]=Hn(c.shape,r),h=Ce(d),f=qe({inputs:{x:c},backend:n,attrs:{shape:[-1,h]}});o.push(f);const p=tI(n,f,s);o.push(p);const m=qe({inputs:{x:p},backend:n,attrs:{shape:l}});return o.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}return nI(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Wt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=hs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),Xn("argMax",[i[0]],c.shape.length);const d=sI(t,c,i[0],"max");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const jU={kernelName:dd,backendName:"webgl",kernelFunc:PU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Wt(o,r.shape);const a=Sn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=hs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),Xn("argMin",[i[0]],c.shape.length);const d=sI(t,c,i[0],"min");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const FU={kernelName:hd,backendName:"webgl",kernelFunc:MU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU=or+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,LU=Qt({opSnippet:OU}),zU={kernelName:Cc,backendName:"webgl",kernelFunc:LU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU=or+"return log(x + sqrt(x * x + 1.0));",BU=Qt({opSnippet:WU}),VU={kernelName:Nc,backendName:"webgl",kernelFunc:BU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU=or+`
  return atan(x);
`,GU=Qt({opSnippet:UU}),HU={kernelName:Ic,backendName:"webgl",kernelFunc:GU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU=x0+`
  return atan(a, b);
`,KU=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Di+`
  return result;
`,QU=Jn({opSnippet:qU,packedOpSnippet:KU}),XU={kernelName:$c,backendName:"webgl",kernelFunc:QU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU=or+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,YU=Qt({opSnippet:JU}),ZU={kernelName:kc,backendName:"webgl",kernelFunc:YU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mc{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const g=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),s){const k=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${p}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:y:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let w=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(w="avgValue / max(count, 1.0)");const S=Math.floor(i/4)*4,I=i%4,C=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${p}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${C}
          }

          int xC = xCCorner + ${S};
          if (${I===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${I===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${I===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${C}
          }
        }
        setOutput(${w});
      }
    `}}class b0{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,c=e.strideHeight,l=e.strideWidth,d=e.dilationDepth,h=e.dilationHeight,f=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,y=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg";let w="0.0";if(v||(w="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${x}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let I=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(I="avgValue / max(count, 1.0)");const C=Math.floor(i/4)*4,k=i%4,$=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${C};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${I});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Pl(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(ss(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=sr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&nn(d.inShape,d.outShape))return Ps({inputs:{x:r},backend:t});const h=new mc(d,"avg",!1);return t.runWebGLProgram(h,[r],"float32")}const t6={kernelName:fd,backendName:"webgl",kernelFunc:e6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s,d=[1,1,1],h=ao(r.shape,o,i,d,a,c,l),f=new b0(h,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const s6={kernelName:pd,backendName:"webgl",kernelFunc:n6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r6{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=c-1-e.padInfo.top,h=l-1-e.padInfo.left,f=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class o6{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=h-1-e.padInfo.front,g=f-1-e.padInfo.top,x=p-1-e.padInfo.left,y=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${g}, ${x});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],f=ao(i.shape,a,c,h,l,d),p=new o6(f);return t.runWebGLProgram(p,[r],i.dtype)}const a6={kernelName:zp,backendName:"webgl",kernelFunc:i6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Pl([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=sr(i.shape,a,c,1,l),h=new r6(d);return t.runWebGLProgram(h,[r],i.dtype)}const l6={kernelName:Lp,backendName:"webgl",kernelFunc:c6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return Vu({a:r,b:o,transposeA:i,transposeB:a,backend:t})}const d6={kernelName:md,backendName:"webgl",kernelFunc:u6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h6{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],_t(e,t),_t(e,s);let a="0.0";r!=null&&(_t(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";o!=null&&(_t(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f6{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],_t(e,t),_t(e,s);let a="vec4(0.0)";r!=null&&(_t(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";o!=null&&(_t(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p6=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;R(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),R(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),R(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);const l=[s,r,o];let d=null;i!=null&&(d=i.shape,l.push(i));let h=null;a!=null&&(h=a.shape,l.push(a));const f=pe().getBool("WEBGL_PACK_NORMALIZATION")?new f6(s.shape,r.shape,o.shape,d,h,c):new h6(s.shape,r.shape,o.shape,d,h,c);return e.runWebGLProgram(f,l,l[0].dtype)},m6={kernelName:$d,backendName:"webgl",kernelFunc:p6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g6{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=an(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=x6(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${xp[a]} = start[${a}] + coords.${xp[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const xp=["x","y","z","w","u","v"];function x6(n){if(n===1)return"sourceLoc";if(n<=6)return xp.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y6{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=an(this.rank),s=us("coords",this.rank),r=us("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,h)=>`start[${h}]`).join()});`:e.map((d,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=pg(e,pt(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const c=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,c+1),o}function Ma(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[a,c]=bh(r,o,i);if(dg(r,a,c),Ce(c)===0)return t.makeTensorInfo(c,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=t.texData.get(r.dataId),f=dV(h.values,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,f)}const{isPacked:l}=t.texData.get(r.dataId),d=fg(r.shape,a,c);if(l||!d){const h=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new y6(c):new g6(c),f=[a];return t.runWebGLProgram(h,[r],r.dtype,f)}return t.uploadToGPU(r.dataId),b6(r,a,c,t)}const w6={kernelName:nh,backendName:"webgl",kernelFunc:Ma};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v6=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;R(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,v)=>b*v),c=vl(r.shape,o,a),l=Sl(c.length,o.length),d=Cl(r.shape,o,a),h=bg(i,o.length),f=wg(d,i,o.length),p=[],m=qe({inputs:{x:r},backend:t,attrs:{shape:c}}),g=hs({inputs:{x:m},backend:t,attrs:{perm:l}}),x=qe({inputs:{x:g},backend:t,attrs:{shape:d}}),y=Ma({inputs:{x},backend:t,attrs:{begin:h,size:f}});return p.push(m),p.push(g),p.push(x),p.forEach(b=>t.disposeIntermediateTensorInfo(b)),y},S6={kernelName:gd,backendName:"webgl",kernelFunc:v6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.readSync(r.dataId),c=t.readSync(o.dataId),l=UN(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const N6={kernelName:Wp,backendName:"webgl",kernelFunc:C6};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I6=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,k6=`
  return float(int(a.r) & int(b.r));
`;function $6(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=pe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||i===1){const c=t.texData.get(s.dataId).values,l=t.texData.get(r.dataId).values,[d,h]=j5(s.shape,r.shape,c,l,s.dtype),f=t.makeTensorInfo(h,s.dtype),p=t.texData.get(f.dataId);return p.values=d,f}let a;return o?a=new Pa(I6,s.shape,r.shape,!1):a=new wi(k6,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const T6={kernelName:Bp,backendName:"webgl",kernelFunc:$6};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),a=_t(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const E6={kernelName:Hb,backendName:"webgl",kernelFunc:A6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R6="return float(a != b);",rI=Jn({opSnippet:R6,cpuKernelImpl:nV,dtype:"bool"}),D6={kernelName:Ud,backendName:"webgl",kernelFunc:rI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ml(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Ps({inputs:{x:r.complexTensorInfos.real},backend:t})}const _6={kernelName:fm,backendName:"webgl",kernelFunc:Ml};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P6="return float(int(x));";function j6(n,e){const t=new _r(n.shape,P6),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yp(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Ps({inputs:{x:r},backend:t});const i=Vn(r.shape),a=yp({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),c=Bo({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),c}if(r.dtype==="complex64"){const i=Ml({inputs:{input:r},backend:t}),a=yp({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!Wb(r.dtype,o)){const i=Ps({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[a,c,l]=M5(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}if(o==="int32")return j6(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",es("bool",1)),c=rI({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const M6={kernelName:Tc,backendName:"webgl",kernelFunc:yp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dy="return ceil(x);",F6=Qt({opSnippet:Dy,packedOpSnippet:Dy,cpuKernelImpl:F5}),O6={kernelName:Ac,backendName:"webgl",kernelFunc:F6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L6{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z6{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;pe().getBool("WEBGL_PACK_CLIP")?a=new z6(r.shape):a=new L6(r.shape);const c=[[o],[i]];return t.runWebGLProgram(a,[r],r.dtype,c)}const B6={kernelName:Ec,backendName:"webgl",kernelFunc:W6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V6{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _y(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function U6(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new V6(s.shape),i=[_y(s,r.complexTensorInfos.real),_y(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const G6={kernelName:xd,backendName:"webgl",kernelFunc:U6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H6{constructor(e){this.outputShape=[],this.outputShape=Or(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q6{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Or(e,t);const s=this.outputShape,r=s.length,o=an(r),i=us("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const c=new Array(e.length-1);c[0]=e[0][t];for(let g=1;g<c.length;g++)c[g]=c[g-1]+e[g][t];const l=a[t],d=a.slice(-2),h=a.join();let f=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${d.join()}));
        }`;for(let g=1;g<c.length;g++){const x=c[g-1];f+=`
        if (${l} < ${c[g]}  && ${l} >= ${c[g-1]}) {
          return getChannel(
            getT${g}(${Zl(a,l,x)}),
            vec2(${Zl(d,l,x)}));
        }`}const p=c.length,m=c[c.length-1];f+=`
        return getChannel(
          getT${p}(${Zl(a,l,m)}),
          vec2(${Zl(d,l,m)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Zl(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return Ps({inputs:{x:r.complexTensorInfos.imag},backend:t})}const K6={kernelName:om,backendName:"webgl",kernelFunc:zh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xa(n,e,t){const s=n[0].dtype;if(s==="complex64"){const p=n.map(b=>Ml({inputs:{input:b},backend:t})),m=n.map(b=>zh({inputs:{input:b},backend:t})),g=Xa(p,e,t),x=Xa(m,e,t),y=Bo({inputs:{real:g,imag:x},backend:t});return p.forEach(b=>t.disposeIntermediateTensorInfo(b)),m.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const p=n.map(w=>{const I=[-1,Ce(w.shape.slice(e))];return qe({inputs:{x:w},backend:t,attrs:{shape:I}})}),m=p.map(w=>({vals:t.readSync(w.dataId),shape:w.shape})),g=Or(p.map(w=>w.shape),1),x=p[0].shape[0]===1,y=O5(m,g,s,x),b=Or(n.map(w=>w.shape),e),v=t.makeTensorInfo(b,s,y);return p.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const o=n.filter(p=>Ce(p.shape)>0),i=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const p=i?new _r(n[0].shape,po):new yo(n[0].shape,po);return t.runWebGLProgram(p,n,s)}const a=pe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const p=[];for(let g=0;g<o.length;g+=a){const x=o.slice(g,g+a);p.push(Xa(x,e,t))}const m=Xa(p,e,t);for(const g of p)t.disposeIntermediateTensorInfo(g);return m}if(i){const p=new q6(o.map(m=>m.shape),e);return t.runWebGLProgram(p,o,s)}const{tensors2D:c,outShape:l}=Q6(o,e,t),d=new H6(c.map(p=>p.shape)),h=t.runWebGLProgram(d,c,s);c.forEach(p=>t.disposeIntermediateTensorInfo(p));const f=qe({inputs:{x:h},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(h),f}function Q6(n,e,t){const s=Or(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>qe({inputs:{x:o},attrs:{shape:[-1,Ce(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oI(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Wt(r,e[0].shape)[0],i=e.map(l=>l.shape);gg(i,o);const a=Or(e.map(l=>l.shape),o);if(Ce(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(l=>Ce(l.shape)>0);return c.length===1?Ps({inputs:{x:c[0]},backend:t}):Xa(c,o,t)}const X6={kernelName:yd,backendName:"webgl",kernelFunc:oI};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",y=x?1:2,b=x?2:3,v=x?3:1;let w="",S="";s&&(r?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:w=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const I=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${I}
        ${S}
        setOutput(result);
      }
    `}}class J6{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.filterDepth,f=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,h=d;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)f+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;f+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)f+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(h+1)/2;x++){const y=x*2;if(f+=`
           xC = xCCorner + ${y*c};
           `,a===1){if(y<d&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,c===1&&y>0?f+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<d)){const b=i%2===0?Rp(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,c>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:f+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?f+=`
                     xC${y+1} = xTexelC${y};
                     `:f+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<d&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<d&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<d&&(f+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<d&&(f+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<d&&(f+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y6{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=os(this.outputShape.length);const{dataFormat:s}=t,r=fs(),o=s==="channelsLast",i=o?1:2,a=o?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let d=0;d<=1;d++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${d};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uu(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function cI({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const c=n.shape,l=s.texData.get(n.dataId),d=t.inChannels,h=c[0]*c[1]*c[2],f=t.outChannels,p=t.dataFormat==="channelsLast",m=!1,g=!1;let x;const y=[];if(o!=null){const w=Uu(o.shape,p);w!=null&&(o=qe({inputs:{x:o},backend:s,attrs:{shape:w}}),y.push(o))}if(r!=null){const w=Uu(r.shape,p);w!=null&&(r=qe({inputs:{x:r},backend:s,attrs:{shape:w}}),y.push(r))}if(!((h===1||f===1)&&d>eI)&&l.isPacked&&p&&l.texture!=null&&c[2]%2!==0&&nn(l.shape.slice(-3),c.slice(-3))){const w=c[0]*c[1]*(c[2]+1),S={dataId:n.dataId,shape:[1,w,t.inChannels],dtype:n.dtype},I=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,R(Bu(l.shape,S.shape),()=>`packed reshape ${l.shape} to ${S.shape} isn't free`);const C=qe({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});y.push(C);const k=Vu({a:S,b:C,backend:s,transposeA:m,transposeB:g,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),$=s.texData.get(k.dataId);R($.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=I,$.shape=t.outShape,x=Ps({inputs:{x:k},backend:s}),x.shape=t.outShape,y.push(k)}else{const w=t.outHeight*t.outWidth,S=qe({inputs:{x:n},backend:s,attrs:{shape:p?[t.batchSize,w,t.inChannels]:[t.batchSize,t.inChannels,w]}}),I=qe({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),C=Vu({a:p?S:I,b:p?I:S,transposeA:!p,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});x=qe({inputs:{x:C},backend:s,attrs:{shape:t.outShape}}),y.push(S),y.push(I),y.push(C)}for(const w of y)s.disposeIntermediateTensorInfo(w);return x}function lI({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:d,outWidth:h,outHeight:f,dataFormat:p}=t,m=p==="channelsLast",g=c*l*d,x=f*h,y=[t.batchSize,g,x],b=!0,v=!1,w=[];if(o!=null){const D=Uu(o.shape,m);D!=null&&(o=qe({inputs:{x:o},backend:s,attrs:{shape:D}}),w.push(o))}if(r!=null){const D=Uu(r.shape,m);D!=null&&(r=qe({inputs:{x:r},backend:s,attrs:{shape:D}}),w.push(r))}const S=qe({inputs:{x:e},backend:s,attrs:{shape:[1,g,Ce(e.shape)/g]}});w.push(S);const I=new Y6(y,t),C=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],k=s.runWebGLProgram(I,[n],"float32",C),$=qe({inputs:{x:k},backend:s,attrs:{shape:y}});w.push(k),w.push($);const N=r!=null,_=o!=null,P=a==="leakyrelu",j=a?pc(a,!0):null,A=new ZN(m?$.shape:S.shape,m?S.shape:$.shape,m?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],b,v,N,j,_,P),F=m?[$,S]:[S,$];if(r&&F.push(r),_&&F.push(o),P){const D=s.makeTensorInfo([],"float32",_o(i,"float32"));F.push(D),w.push(D)}const M=s.runWebGLProgram(A,F,"float32"),K=qe({inputs:{x:M},backend:s,attrs:{shape:t.outShape}});w.push(M);for(const D of w)s.disposeIntermediateTensorInfo(D);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s,h=co(c),f=Qn(r.shape,o.shape,i,l,a,d,!1,h);let p;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))p=cI({x:r,filter:o,convInfo:f,backend:t});else if(f.strideWidth<=2&&h==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const g=new aI(f),x=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];p=t.runWebGLProgram(g,[r,o],"float32",x)}else if(pe().getBool("WEBGL_CONV_IM2COL"))p=lI({x:r,filter:o,convInfo:f,backend:t});else{const g=new iI(f);p=t.runWebGLProgram(g,[r,o],"float32")}const m=qe({inputs:{x:p},backend:t,attrs:{shape:f.outShape}});return t.disposeIntermediateTensorInfo(p),m}const eG={kernelName:bd,backendName:"webgl",kernelFunc:Z6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tG{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class nG{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,c=s-1-e.padInfo.left,l=i?1:2,d=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class sG{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class rG{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=t-1-e.padInfo.front,l=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s,h=co(c),f=Qn(r.shape,d,i,1,a,l,!1,h),p=new tG(f);return t.runWebGLProgram(p,[r,o],"float32")}const iG={kernelName:Up,backendName:"webgl",kernelFunc:oG};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aG{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=os(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s,h=co(l),f=Qn(i,o.shape,a,1,c,d,!1,h);if(pe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[f.strideHeight,f.strideWidth]],m=new aG(f);return t.runWebGLProgram(m,[r,o],"float32",p)}else{const p=new nG(f);return t.runWebGLProgram(p,[r,o],"float32")}}const lG={kernelName:wd,backendName:"webgl",kernelFunc:cG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=jo(r.shape,o.shape,i,c,a),d=new J6(l);return t.runWebGLProgram(d,[r,o],"float32")}const dG={kernelName:vd,backendName:"webgl",kernelFunc:uG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s,l=jo(r.shape,c,i,1,a),d=new sG(l);return t.runWebGLProgram(d,[r,o],"float32")}const fG={kernelName:Gp,backendName:"webgl",kernelFunc:hG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s,l=jo(c,o.shape,a,1,i),d=new rG(l);return t.runWebGLProgram(d,[r,o],"float32")}const mG={kernelName:Hp,backendName:"webgl",kernelFunc:pG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG=ja+`
  return cos(x);
`,xG=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Di}
  return result;
`,yG=Qt({opSnippet:gG,packedOpSnippet:xG}),bG={kernelName:Rc,backendName:"webgl",kernelFunc:yG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,vG=Qt({opSnippet:wG}),SG={kernelName:Dc,backendName:"webgl",kernelFunc:vG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CG{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,c,l]=e,[d]=t,[h,f]=s;this.outputShape=[d,h,f,l];const p=r==="bilinear"?1:0,[m,g]=[`${a-1}.0`,`${c-1}.0`],[x,y,b]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[v,w,S]=f>1?[`${(c-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,d=new CG(r.shape,o.shape,a,c,l);return t.runWebGLProgram(d,[r,o,i],"float32")},IG={kernelName:Kp,backendName:"webgl",kernelFunc:NG};var gc;(function(n){n.Prod="*",n.Sum="+"})(gc||(gc={}));class Py{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===gc.Prod?"1.0":"0.0",a=s?i:`getX(${jy(o,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",d="";s?(l=r?`end != ${c-1}`:"end != 0",d=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${c}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${an(o)} coords = getOutputCoords();
        int end = ${My(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${d};
          ${My(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${jy(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function jy(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function My(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uI(n,e,t,s,r,o){const i=e.shape.length,a=Sn([s],i);let c=e;a!=null&&(c=hs({inputs:{x:e},backend:t,attrs:{perm:a}}));const l=Tn(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=c.shape[l];let h=Ps({inputs:{x:c},backend:t});for(let f=0;f<=Math.ceil(Math.log2(d))-1;f++){const p=new Py(n,c.shape,!1,o),m=[[f]],g=h;h=t.runWebGLProgram(p,[h],h.dtype,m),t.disposeIntermediateTensorInfo(g)}if(r){const f=new Py(n,c.shape,r,o),p=h;h=t.runWebGLProgram(f,[h],h.dtype),t.disposeIntermediateTensorInfo(p)}if(a!=null){const f=Mo(a),p=hs({inputs:{x:h},backend:t,attrs:{perm:f}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(c),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return uI(gc.Prod,r,t,o,i,a)}const $G={kernelName:qp,backendName:"webgl",kernelFunc:kG};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return uI(gc.Sum,r,t,o,i,a)}const AG={kernelName:Sd,backendName:"webgl",kernelFunc:TG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=UN(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=P5(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const RG={kernelName:Qp,backendName:"webgl",kernelFunc:EG};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DG{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],c=i==="NHWC"?r.shape[1]:r.shape[2],l=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],h=c*o,f=l*o,p=d/(o*o),m=i==="NHWC"?[a,h,f,p]:[a,p,h,f],g=new DG(m,o,i);return t.runWebGLProgram(g,[r],r.dtype)}const PG={kernelName:Xp,backendName:"webgl",kernelFunc:_G};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,c=e.outChannels/e.inChannels;let l="",d="";s&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const h=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hI{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=os(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,c=e.strideWidth,l=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let y=0;y<h;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(f+1)/2;y++){const b=y*2;if(p+=`
          xC = xCCorner + ${b*l};
          `,c===1){if(b<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?p+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<h)){const v=a%2===0?Rp(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:p+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):v===1?p+=`
                    xC${b+1} = xTexelC${b};
                    `:p+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<h&&(p+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<h&&(p+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<h&&(p+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let m="",g="";s&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:m=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;let d=c;d==null&&(d=[1,1]),R(ss(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const h=Qn(r.shape,o.shape,i,d,a,l,!0);let f;pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?f=new hI(h):f=new dI(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return t.runWebGLProgram(f,[r,o],"float32",p)}const MG={kernelName:Cd,backendName:"webgl",kernelFunc:jG};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FG{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class OG{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=s-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s,h=Qn(r.shape,d,i,a,c,l,!0),f=new FG(h);return t.runWebGLProgram(f,[r,o],"float32")}const zG={kernelName:Jp,backendName:"webgl",kernelFunc:LG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WG(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s,h=Qn(d,o.shape,i,a,c,l,!0),f=new OG(h);return t.runWebGLProgram(f,[r,o],"float32")}const BG={kernelName:Yp,backendName:"webgl",kernelFunc:WG};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VG{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UG(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=Ce(s.shape),i=qe({inputs:{x:s},backend:t,attrs:{shape:[o]}}),a=new VG(o),c=t.runWebGLProgram(a,[i],i.dtype),l=qe({inputs:{x:c},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(c),l}const GG={kernelName:qb,backendName:"webgl",kernelFunc:UG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HG{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:d}=e,{top:h,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=gl(r.shape,o.shape,i,a,"NHWC",c);let d;const h=new HG(l);d=t.runWebGLProgram(h,[r,o],"float32");const f=qe({inputs:{x:d},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(d),f}const KG={kernelName:Nd,backendName:"webgl",kernelFunc:qG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=Tg(r,o.length);Eg(i.length,c,o);const{path:l,steps:d}=Rg(a,c),h=d.length;let f=null,p=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=Ag(p,c[x]);let v;Dg(y)?v=o[x]:(v=hs({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(v));const w=v.shape.slice();for(let S=0;S<b.length;++S)w.splice(b[S],0,1);nn(v.shape,w)||(v=qe({inputs:{x:v},backend:t,attrs:{shape:w}}),m.push(v)),f===null?f=v:(f=y0({inputs:{a:v,b:f},backend:t}),m.push(f))}g<h-1&&(l[g]>=0&&(f=Lh({inputs:{x:f},backend:t,attrs:{axis:l[g]-(i.length-p),keepDims:!1}}),m.push(f)),p--)}for(const g of m)g!==f&&t.disposeIntermediateTensorInfo(g);return f}const XG={kernelName:Zp,backendName:"webgl",kernelFunc:QG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG="return (x >= 0.0) ? x : (exp(x) - 1.0);",YG=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ZG=Qt({opSnippet:JG,packedOpSnippet:YG}),eH={kernelName:Pc,backendName:"webgl",kernelFunc:ZG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tH="return (b >= 0.0) ? a : a * (b + 1.0);",nH=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,sH=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=pe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Pa(nH,s.shape,r.shape):new wi(tH,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},rH={kernelName:em,backendName:"webgl",kernelFunc:sH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oH=`
  return vec4(equal(a, b));
`,iH="return float(a == b);",aH=Jn({opSnippet:iH,packedOpSnippet:oH,dtype:"bool",cpuKernelImpl:L5}),cH={kernelName:Id,backendName:"webgl",kernelFunc:aH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${vg};
  float a1 = ${Sg};
  float a2 = ${Cg};
  float a3 = ${Ng};
  float a4 = ${Ig};
  float a5 = ${kg};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,uH=Qt({opSnippet:lH}),dH={kernelName:jc,backendName:"webgl",kernelFunc:uH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH=ja+`
  return exp(x);
`,fH=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fI=Qt({opSnippet:hH,packedOpSnippet:fH,cpuKernelImpl:z5,dtype:"float32"}),pH={kernelName:Mc,backendName:"webgl",kernelFunc:fI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bp(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let c=r;return r<0&&(R(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+r+1),a.splice(c,0,1),qe({inputs:{x:o},backend:s,attrs:{shape:a}})}const mH={kernelName:kd,backendName:"webgl",kernelFunc:bp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fy="return exp(x) - 1.0;",gH=Qt({opSnippet:Fy,packedOpSnippet:Fy,cpuKernelImpl:W5}),xH={kernelName:Fc,backendName:"webgl",kernelFunc:gH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oy{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pI(n,e,t){const s=t.texData.get(n.dataId),r=Ce(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=qe({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),c=a.shape,l=new Oy("real",c,e),d=new Oy("imag",c,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],f=t.runWebGLProgram(l,h,"float32"),p=t.runWebGLProgram(d,h,"float32"),m=Bo({inputs:{real:f,imag:p},backend:t});t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p);const g=qe({inputs:{x:m},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(m),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(n){const{inputs:e,backend:t}=n,{input:s}=e;return pI(s,!1,t)}const bH={kernelName:tm,backendName:"webgl",kernelFunc:yH};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wH{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fl(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||va(r),o==="string"){const i=In(o,Ce(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new wH(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const vH={kernelName:nm,backendName:"webgl",kernelFunc:Fl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SH{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CH={kernelName:sm,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new SH(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ly="return floor(x);",NH=Qt({opSnippet:Ly,packedOpSnippet:Ly,cpuKernelImpl:B5}),IH={kernelName:Oc,backendName:"webgl",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kH=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,$H=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,TH=Jn({opSnippet:kH,packedOpSnippet:$H,dtype:"int32"}),AH={kernelName:Lc,backendName:"webgl",kernelFunc:TH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EH{constructor(e){this.variableNames=["A"];const t=fs(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RH{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=fs(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH={kernelName:T$,backendName:"webgl",kernelFunc:_H};let Li,vf=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function _H(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,l]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[l,c],h=[l,c,o];if(a||i){const g=pe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Li==null||g!==vf)&&(vf=g,Li=document.createElement("canvas").getContext("2d",{willReadFrequently:vf})),Li.canvas.width=c,Li.canvas.height=l,Li.drawImage(r,0,0,c,l),r=Li.canvas}const f=t.makeTensorInfo(d,"int32");t.texData.get(f.dataId).usage=Os.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),r);const p=pe().getBool("WEBGL_PACK")?new RH(h):new EH(h),m=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s,g=co(d),x=Qn(r.shape,o.shape,c,h,l,f,!1,g);let y;const b=[],v=i!=null,w=a!=null,S=p==="leakyrelu",I=()=>{const k=[r,o],$=(N,_)=>{if(_==="NCHW"&&N.shape.length===1&&N.shape[0]!==1){const P=qe({inputs:{x:N},backend:t,attrs:{shape:[N.shape[0],1,1]}});return b.push(P),P}return N};if(v&&k.push($(i,d)),w&&k.push($(a,d)),S){const N=t.makeTensorInfo([],"float32",_o(m,"float32"));k.push(N),b.push(N)}return k};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=cI({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:m});else if(x.strideWidth<=2&&g==="channelsLast"&&pe().getBool("WEBGL_EXP_CONV")){const k=p?pc(p,!0):null,$=new aI(x,v,k,w,S),N=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],_=I();y=t.runWebGLProgram($,_,"float32",N)}else if(pe().getBool("WEBGL_CONV_IM2COL"))y=lI({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:m});else{const k=p?pc(p,!1):null,$=new iI(x,v,k,w,S),N=I();y=t.runWebGLProgram($,N,"float32")}const C=qe({inputs:{x:y},backend:t,attrs:{shape:x.outShape}});return b.push(y),b.forEach(k=>t.disposeIntermediateTensorInfo(k)),C}const jH={kernelName:xu,backendName:"webgl",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,m=[];let g=d;g==null&&(g=[1,1]),R(ss(c,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const x=Qn(r.shape,o.shape,c,g,l,h,!0),y=pe().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,b=f?pc(f,y):null,v=[r,o],w=i!=null,S=a!=null,I=f==="leakyrelu";if(w&&v.push(i),S&&v.push(a),I){const N=t.makeTensorInfo([],"float32",_o(p,"float32"));v.push(N),m.push(N)}let C;y?C=new hI(x,w,b,S,I):C=new dI(x,w,b,S,I);const k=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],$=t.runWebGLProgram(C,v,"float32",k);return m.forEach(N=>t.disposeIntermediateTensorInfo(N)),$}const FH={kernelName:hw,backendName:"webgl",kernelFunc:MH};class OH{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=an(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LH(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=Ce(s.shape),[c,l,d,h]=ug(s,r),f=qe({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),p=qe({inputs:{x:s},backend:t,attrs:{shape:[Ce(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=t.readSync(r.dataId),b=t.bufferSync(s),v=V5(y,b,s.dtype,l,i,d,h,s.shape,a);return t.makeTensorInfo(c,s.dtype,v.values)}const m=new OH(i,h,[l,d],s.shape),g=t.runWebGLProgram(m,[p,f],p.dtype),x=qe({inputs:{x:g},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const zH={kernelName:Kb,backendName:"webgl",kernelFunc:LH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WH{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=an(this.rank),r=BH(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function BH(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,c=Wt(i,r.shape)[0];if(pe().get("DEBUG")){const b=t.readSync(o.dataId),v=r.shape[c];for(let w=0;w<b.length;++w){const S=b[w];R(S<=v-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${v-1}]`)}}const l=Pg(r,o,c,a),d=Ce(o.shape),h=[],f=qe({inputs:{x:r},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),p=qe({inputs:{x:o},backend:t,attrs:{shape:[l.batchSize,d/l.batchSize]}});h.push(f),h.push(p);const m=[l.batchSize,l.outerSize,d/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=t.bufferSync(p),v=t.bufferSync(f),w=U5(v,b,m);return h.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(l.outputShape,w.dtype,w.values)}const g=new WH(f.shape,m),x=t.runWebGLProgram(g,[f,p],f.dtype);h.push(x);const y=qe({inputs:{x},backend:t,attrs:{shape:l.outputShape}});return h.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const VH={kernelName:Td,backendName:"webgl",kernelFunc:mI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH="return float(a > b);",GH=`
  return vec4(greaterThan(a, b));
`,HH=Jn({opSnippet:UH,packedOpSnippet:GH,cpuKernelImpl:G5,dtype:"bool"}),qH={kernelName:Ad,backendName:"webgl",kernelFunc:HH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH="return float(a >= b);",QH=`
  return vec4(greaterThanEqual(a, b));
`,XH=Jn({opSnippet:KH,packedOpSnippet:QH,dtype:"bool",cpuKernelImpl:H5}),JH={kernelName:zc,backendName:"webgl",kernelFunc:XH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YH(n){const{inputs:e,backend:t}=n,{input:s}=e;return pI(s,!0,t)}const ZH={kernelName:rm,backendName:"webgl",kernelFunc:YH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eq="return float(!isnan(x) && !isinf(x));",tq=Qt({opSnippet:eq,dtype:"bool"}),nq={kernelName:Bc,backendName:"webgl",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq="return float(isinf(x));",rq=Qt({opSnippet:sq,dtype:"bool"}),oq={kernelName:Vc,backendName:"webgl",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iq="return float(isnan(x));",aq=Qt({opSnippet:iq,dtype:"bool"}),cq={kernelName:Uc,backendName:"webgl",kernelFunc:aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq="return float(a < b);",uq=`
  return vec4(lessThan(a, b));
`,dq=Jn({opSnippet:lq,packedOpSnippet:uq,cpuKernelImpl:q5,dtype:"bool"}),hq={kernelName:Rd,backendName:"webgl",kernelFunc:dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fq="return float(a <= b);",pq=`
  return vec4(lessThanEqual(a, b));
`,mq=Jn({opSnippet:fq,packedOpSnippet:pq,cpuKernelImpl:K5,dtype:"bool"}),gq={kernelName:Dd,backendName:"webgl",kernelFunc:mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=Q5(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const yq={kernelName:Qb,backendName:"webgl",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bq=ja+`
  return x < 0.0 ? 0./0. : log(x);
`,wq=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,vq=Qt({opSnippet:bq,packedOpSnippet:wq,cpuKernelImpl:X5}),Sq={kernelName:Gc,backendName:"webgl",kernelFunc:vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cq=ja+`
  return log(1.0 + x);
`,Nq=Qt({opSnippet:Cq}),Iq={kernelName:Hc,backendName:"webgl",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kq="return float(a >= 1.0 && b >= 1.0);",$q=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Tq=Jn({opSnippet:kq,packedOpSnippet:$q,dtype:"bool"}),Aq={kernelName:_d,backendName:"webgl",kernelFunc:Tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eq="return float(!(x >= 1.0));",Rq=Qt({opSnippet:Eq}),Dq={kernelName:Pd,backendName:"webgl",kernelFunc:Rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _q="return float(a >= 1.0 || b >= 1.0);",Pq=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,jq=Jn({opSnippet:_q,packedOpSnippet:Pq,dtype:"bool"}),Mq={kernelName:jd,backendName:"webgl",kernelFunc:jq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fq{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oq{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lq=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s,l=pe().getBool("WEBGL_PACK_NORMALIZATION")?new Oq(r.shape,o,i,a,c):new Fq(r.shape,o,i,a,c);return t.runWebGLProgram(l,[r],r.dtype)},zq={kernelName:Md,backendName:"webgl",kernelFunc:Lq};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wq{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bq=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s,h=new Wq(r.shape,a,c,l,d);return t.runWebGLProgram(h,[r,o,i],r.dtype)},Vq={kernelName:im,backendName:"webgl",kernelFunc:Bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uq(n,e,t,s){const r=Ce(e),i=Ce(n.shape)/r,a=qe({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=_i(a,n.dtype,"max",s),l=qe({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,c=Wt(o,r.shape);let l=c;const d=Sn(l,a),h=d!=null,f=t.shouldExecuteOnCPU([r]);let p=r;if(h){if(f){const v=t.texData.get(p.dataId).values,w=new Array(a);for(let C=0;C<w.length;C++)w[C]=r.shape[d[C]];const S=g0(v,r.shape,r.dtype,d,w);p=t.makeTensorInfo(w,r.dtype);const I=t.texData.get(p.dataId);I.values=S}else p=Oh(r,d,t);l=Tn(l.length,a)}Xn("max",l,a);const[m,g]=Hn(p.shape,l);let x=m;i&&(x=Dn(m,c));let y;if(f){const v=t.texData.get(p.dataId).values,w=J5(v,Ce(g),x,r.dtype);y=t.makeTensorInfo(x,r.dtype);const S=t.texData.get(y.dataId);S.values=w}else y=Uq(p,g,x,t);return h&&t.disposeIntermediateTensorInfo(p),y}const Gq={kernelName:Fd,backendName:"webgl",kernelFunc:gI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hq=x0+`
  return max(a, b);
`,qq=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Di+`
  return result;
`,Kq=Jn({opSnippet:Hq,packedOpSnippet:qq,cpuKernelImpl:Y5}),Qq={kernelName:qc,backendName:"webgl",kernelFunc:Kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Pl(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;R(ss(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=sr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&nn(d.inShape,d.outShape))return Ps({inputs:{x:r},backend:t});const h=new mc(d,"max",!1);return t.runWebGLProgram(h,[r],r.dtype)}const Jq={kernelName:Od,backendName:"webgl",kernelFunc:Xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=s,d=[1,1,1],h=ao(r.shape,o,i,d,a,l,c),f=new b0(h,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Zq={kernelName:Ld,backendName:"webgl",kernelFunc:Yq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e8{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,c=i-1-e.padInfo.left,l=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class t8{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=c-1-e.padInfo.front,f=l-1-e.padInfo.top,p=d-1-e.padInfo.left,m=c*l*d-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],f=ao(i.shape,a,c,h,l,d),p=new b0(f,"max",!0),m=t.runWebGLProgram(p,[i],i.dtype),g=new t8(f),x=t.runWebGLProgram(g,[r,m],i.dtype);return t.disposeIntermediateTensorInfo(m),x}const s8={kernelName:cm,backendName:"webgl",kernelFunc:n8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;Pl([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,f=sr(a.shape,c,l,1,d,h),p=!0,m=new mc(f,"max",p),g=t.runWebGLProgram(m,[a],a.dtype),x=new e8(f),y=t.runWebGLProgram(x,[r,g],a.dtype);return t.disposeIntermediateTensorInfo(g),y}const o8={kernelName:am,backendName:"webgl",kernelFunc:r8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(n,e,t,s){let r=new mc(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new mc(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8={kernelName:Xb,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;R(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];R(ss(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const d=sr(s.shape,r,o,l,i),[h,f]=i8(s,a,d,c);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c8(n,e,t,s){const r=Ce(e),i=Ce(n.shape)/r,a=qe({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=_i(a,"float32","mean",s),l=qe({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8={kernelName:zd,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,a=s.shape.length,c=Wt(o,s.shape);let l=c;const d=Sn(l,a),h=d!=null,f=i.shouldExecuteOnCPU([s]),p=[];let m=s;if(h){if(f){const w=i.texData.get(m.dataId).values,S=new Array(a);for(let k=0;k<S.length;k++)S[k]=s.shape[d[k]];const I=g0(w,s.shape,s.dtype,d,S);m=i.makeTensorInfo(S,s.dtype);const C=i.texData.get(m.dataId);C.values=I}else m=Oh(s,d,i);p.push(m),l=Tn(l.length,a)}Xn("sum",l,a);const[g,x]=Hn(m.shape,l);let y=g;r&&(y=Dn(g,c));const b=c8(m,x,y,i);for(const v of p)i.disposeIntermediateTensorInfo(v);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Wt(o,r.shape);let l=c;const d=Sn(l,a);let h=r;d!=null&&(h=hs({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,r.shape.length)),Xn("min",l,a);const[f,p]=Hn(h.shape,l),m=Ce(p),g=qe({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=_i(g,g.dtype,"min",t);let y;if(i){const b=Dn(f,c);y=qe({inputs:{x},backend:t,attrs:{shape:b}})}else y=qe({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const d8={kernelName:Wd,backendName:"webgl",kernelFunc:u8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8=x0+`
  return min(a, b);
`,f8=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Di+`
  return result;
`,p8=Jn({opSnippet:h8,packedOpSnippet:f8,cpuKernelImpl:Z5}),m8={kernelName:Kc,backendName:"webgl",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g8{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,h)=>d[0]+e[h]+d[1]);const r=e.length,o=an(r),i=t.map(d=>d[0]).join(","),a=t.map((d,h)=>d[0]+e[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x8{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,o=an(r),i=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),c=us("rc",r),l=us("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,f=s==="reflect"?0:1;let p="";if(r===1){const m=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const m=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new x8(s.shape,r,o):new g8(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},b8={kernelName:Bd,backendName:"webgl",kernelFunc:y8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8=`if (b == 0.0) return NAN;
  return mod(a, b);`,v8=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Di+`
  return result;
`,S8=Jn({opSnippet:w8,packedOpSnippet:v8}),C8={kernelName:Qc,backendName:"webgl",kernelFunc:S8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N8{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I8=`
if (a == b) {
  return 1.0;
};
return a / b;`,k8=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,xI=Jn({opSnippet:I8,packedOpSnippet:k8,checkOutOfBounds:!0}),$8={kernelName:_c,backendName:"webgl",kernelFunc:xI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zy="return a - b;",yI=Jn({opSnippet:zy,packedOpSnippet:zy,supportsComplex:!0,cpuKernelImpl:wV}),T8={kernelName:dl,backendName:"webgl",kernelFunc:yI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bI(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=Wt([o],r.shape),a=gI({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),c=Dn(a.shape,i),l=qe({inputs:{x:a},backend:t,attrs:{shape:c}}),d=yI({inputs:{a:r,b:l},backend:t}),h=fI({inputs:{x:d},backend:t}),f=Lh({inputs:{x:h},backend:t,attrs:{axis:i,keepDims:!1}}),p=qe({inputs:{x:f},backend:t,attrs:{shape:c}}),m=xI({inputs:{a:h,b:p},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),m}const A8={kernelName:ih,backendName:"webgl",kernelFunc:bI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,c=a?r:bI({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),l=c.shape[0],d=c.shape[1],h=new N8(l,d,o),f=[[i]],p=t.runWebGLProgram(h,[c],"int32",f);return a||t.disposeIntermediateTensorInfo(c),p}const R8={kernelName:Jb,backendName:"webgl",kernelFunc:E8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D8=or+`
  return -x;
`,_8=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function P8(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,a]=tV(o.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}let r;return pe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new yo(s.shape,_8):r=new _r(s.shape,D8),t.runWebGLProgram(r,[s],s.dtype)}const j8={kernelName:Vd,backendName:"webgl",kernelFunc:P8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8=rg;function F8(n){Fs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:h}=M8(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const O8={kernelName:lm,backendName:"webgl",kernelFunc:F8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8=og;function z8(n){Fs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),{selectedIndices:f,validOutputs:p}=L8(d,h,i,a,c,l);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const W8={kernelName:um,backendName:"webgl",kernelFunc:z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8=ig;function V8(n){Fs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),f=i,p=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=B8(d,h,f,p,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const U8={kernelName:dm,backendName:"webgl",kernelFunc:V8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G8{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s,l=Ce(r.shape),d=new G8(l,i,a,c),h=qe({inputs:{x:r},backend:t,attrs:{shape:[l]}}),f=t.runWebGLProgram(d,[h],o);t.disposeIntermediateTensorInfo(h);const p=[...r.shape,i],m=qe({inputs:{x:f},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(f),m},q8={kernelName:Hd,backendName:"webgl",kernelFunc:H8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gu(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Ml({inputs:{input:s},backend:t}),o=Gu({inputs:{x:r},backend:t}),i=zh({inputs:{input:s},backend:t}),a=Gu({inputs:{x:i},backend:t}),c=Bo({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Fl({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const K8={kernelName:lh,backendName:"webgl",kernelFunc:Gu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wI(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ml({inputs:{input:s},backend:t}),o=wI({inputs:{x:r},backend:t}),i=zh({inputs:{input:s},backend:t}),a=Gu({inputs:{x:i},backend:t}),c=Bo({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Fl({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const Q8={kernelName:Gd,backendName:"webgl",kernelFunc:wI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return bp({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Dp(o,d.shape,"All tensors passed to stack must have matching shapes"),R(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=bp({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=oI({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const J8={kernelName:qd,backendName:"webgl",kernelFunc:X8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y8{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,d)=>l[0]+e[d]+l[1]);const r=e.length,o=an(r),i=t.map(l=>l[0]).join(","),a=t.map((l,d)=>l[0]+e[d]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z8{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,o=an(r),i=t.map(g=>g[0]).join(","),a=t.map((g,x)=>g[0]+e[x]).join(","),c=us("rc",r),l=us("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${d}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let g=0,x=r===1?2:4;g<x;g++)m+=`
        ${f[g]}
        if (${p}) {
          result[${g}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${h});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vI=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(Ce(r.shape)===0){const l=o.map((d,h)=>d[0]+r.shape[h]+d[1]);return Fl({backend:t,attrs:{shape:l,value:i,dtype:r.dtype}})}const a=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Z8(r.shape,o,i):new Y8(r.shape,o,i),c=[[i]];return t.runWebGLProgram(a,[r],r.dtype,c)},e7={kernelName:Kd,backendName:"webgl",kernelFunc:vI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t7=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n7=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Di+`
  return result;
`,s7=Jn({opSnippet:t7,packedOpSnippet:n7}),r7={kernelName:Jc,backendName:"webgl",kernelFunc:s7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=[],l=Wt(o,r.shape);let d=l;const h=Sn(d,a);let f=r;h!=null&&(f=hs({inputs:{x:r},backend:t,attrs:{perm:h}}),d=Tn(d.length,a),c.push(f)),Xn("prod",d,a);let p;if(t.shouldExecuteOnCPU([f])){const m=t.texData.get(f.dataId).values,{outVals:g,outShape:x,outDtype:y}=sV(f.shape,f.dtype,m,d);p=t.makeTensorInfo(x,y,g)}else{const[m,g]=Hn(f.shape,d),x=Ce(g),y=qe({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),b=Nm(r.dtype),v=_i(y,b,"prod",t);p=qe({inputs:{x:v},backend:t,attrs:{shape:m}}),c.push(y),c.push(v)}if(i){c.push(p);const m=Dn(p.shape,l);p=qe({inputs:{x:p},backend:t,attrs:{shape:m}})}return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}const i7={kernelName:Xd,backendName:"webgl",kernelFunc:o7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.readSync(y.dataId)),l=r.map(y=>y.shape),d=t.readSync(o.dataId),h=t.readSync(i.dataId),[f,p,m]=rV(c,l,d,o.shape,o.dtype,h,i.shape,a),g=f.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,p);return g.concat([x])}const c7={kernelName:Yb,backendName:"webgl",kernelFunc:a7};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=oV(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),f=t.makeTensorInfo([d.length],s.dtype,d);return[h,f]}const u7={kernelName:Zb,backendName:"webgl",kernelFunc:l7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),h=t.readSync(i.dataId),f=a.map(x=>t.readSync(x.dataId)),p=a.map(x=>x.shape),[m,g]=iV(l,r.shape,d,o.shape,o.dtype,h,i.shape,f,p,c);return t.makeTensorInfo(m,o.dtype,g)}const h7={kernelName:ew,backendName:"webgl",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SI=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,a=aV(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},f7={kernelName:hm,backendName:"webgl",kernelFunc:SI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7="return 1.0 / x;",m7=Qt({opSnippet:p7}),g7={kernelName:Yc,backendName:"webgl",kernelFunc:m7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7=or+`
  return (x < 0.0) ? 0.0 : x;
`,y7=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,b7=Qt({opSnippet:x7,packedOpSnippet:y7}),w7={kernelName:Zc,backendName:"webgl",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7=or+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,S7=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,C7=Qt({opSnippet:v7,packedOpSnippet:S7}),N7={kernelName:el,backendName:"webgl",kernelFunc:C7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I7{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k7{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new k7(r.shape,c,l,o,i):new I7(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],"float32")}const T7={kernelName:Zd,backendName:"webgl",kernelFunc:$7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A7{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],f=1/d,p=1/h,m=Math.ceil(f)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new A7(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const R7={kernelName:mm,backendName:"webgl",kernelFunc:E7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D7{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],f=r?"0.5":"0.0";let p;o?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _7{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],f=r?"0.5":"0.0";let p;o?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=pe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new _7(r.shape,c,l,o,i):new D7(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const j7={kernelName:Yd,backendName:"webgl",kernelFunc:P7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M7{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],f=1/d,p=1/h,m=Math.ceil(f)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new M7(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const O7={kernelName:pm,backendName:"webgl",kernelFunc:F7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L7{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,c)=>r(c)).join(","),i=an(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z7{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=us("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=an(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${o}){
            result.g = ${l(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(m){return f(m)}function l(m){return m[s-1]="("+m[s-1]+" + 1)",f(m)}function d(m){return m[s-2]="("+m[s-2]+" + 1)",f(m)}function h(m){return m[s-1]="("+m[s-1]+" + 1)",m[s-2]="("+m[s-2]+" + 1)",f(m)}function f(m){const g=e.map((b,v)=>p(v,m)),x=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${y}))`}function p(m,g){return t.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${g[m]} - 1`:`${g[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,a=Wt(o,r.shape);if(i===0)return Ps({inputs:{x:r},backend:t});const c=pe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new z7(r.shape,a):new L7(r.shape,a);return t.runWebGLProgram(c,[r],r.dtype)}const B7={kernelName:eh,backendName:"webgl",kernelFunc:W7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V7{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7={kernelName:Sm,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=new V7(s.shape,o),[l,d]=yg(i,s.shape[1],s.shape[2]),h=[[l,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(c,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,H7=Qt({opSnippet:G7}),q7={kernelName:tl,backendName:"webgl",kernelFunc:H7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7="return inversesqrt(x);",Q7=Qt({opSnippet:K7,cpuKernelImpl:cV}),X7={kernelName:nl,backendName:"webgl",kernelFunc:Q7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w0{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=an(o.length),d=an(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const m=`getUpdates(${p})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J7{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=an(o.length),d=an(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const m=`getUpdates(${p})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides",b=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y7(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=$i(o,r,i),f=[h/l,l];if(h===0)return t.makeTensorInfo(i,r.dtype);const p=qe({inputs:{x:r},backend:t,attrs:{shape:[c,a]}}),m=qe({inputs:{x:o},backend:t,attrs:{shape:[c,l]}}),g=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;pe().getBool("WEBGL_PACK")?x=new J7(c,a,p.shape.length,m.shape.length,d,f):x=new w0(c,a,p.shape.length,m.shape.length,d,f);const y=t.runWebGLProgram(x,[m,p,g],m.dtype),b=qe({inputs:{x:y},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(g),b}const Z7={kernelName:tw,backendName:"webgl",kernelFunc:Y7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eK{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=pe().getNumber("WEBGL_VERSION")===2?o:i,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=new eK(r.shape[0],r.shape[1],o.shape[1],i),c=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",c)}const nK={kernelName:sw,backendName:"webgl",kernelFunc:tK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sK{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let d=0;d<t.length;d++)l.push(`${a[d]}`),d<e&&c.push(`${a[d]}`);r=c.join(),o=l.join()}const i=an(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new sK(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],Ds(r.dtype,o.dtype))}const oK={kernelName:th,backendName:"webgl",kernelFunc:rK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${vh};
  float scale = ${Sh};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,aK=Qt({opSnippet:iK}),cK={kernelName:sl,backendName:"webgl",kernelFunc:aK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lK=ja+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,uK=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,dK=Qt({opSnippet:lK,packedOpSnippet:uK,cpuKernelImpl:uV}),hK={kernelName:al,backendName:"webgl",kernelFunc:dK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fK=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,pK=Qt({opSnippet:fK}),mK={kernelName:il,backendName:"webgl",kernelFunc:pK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK=ja+`
  return sin(x);
`,xK=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Di}
  return result;
`,yK=Qt({opSnippet:gK,packedOpSnippet:xK}),bK={kernelName:rl,backendName:"webgl",kernelFunc:yK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wK=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,vK=Qt({opSnippet:wK}),SK={kernelName:ol,backendName:"webgl",kernelFunc:vK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,NK=Qt({opSnippet:CK}),IK={kernelName:cl,backendName:"webgl",kernelFunc:NK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kK=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;R(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,b)=>y*b),c=[[0,0]];c.push(...i);for(let y=1+o.length;y<r.shape.length;++y)c.push([0,0]);const l=[],d=vI({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),h=vl(d.shape,o,a,!1),f=Sl(h.length,o.length,!1),p=Cl(d.shape,o,a,!1),m=qe({inputs:{x:d},backend:t,attrs:{shape:h}}),g=hs({inputs:{x:m},backend:t,attrs:{perm:f}}),x=qe({inputs:{x:g},backend:t,attrs:{shape:p}});return l.push(d),l.push(m),l.push(g),l.forEach(y=>t.disposeIntermediateTensorInfo(y)),x},$K={kernelName:rh,backendName:"webgl",kernelFunc:kK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(s.dataId),c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[h,f,p,m,g]=hV(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(f,s.dtype,h),t.makeTensorInfo([f[0]],r.dtype,p),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const AK={kernelName:rw,backendName:"webgl",kernelFunc:TK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),c=Array.from(t.readSync(o.dataId)),[l,d,h]=fV(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const RK={kernelName:ow,backendName:"webgl",kernelFunc:EK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=HN(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const _K={kernelName:iw,backendName:"webgl",kernelFunc:DK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PK(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=HN(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const jK={kernelName:aw,backendName:"webgl",kernelFunc:PK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MK(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:f}=$i(o,r,a),p=!1;if(o.dtype==="string"){const y=t.bufferSync(r),b=t.bufferSync(o),v=ko(t.readSync(i.dataId)[0]),w=lV(y,b,a,f,d,l,c,h,v,p);return t.makeTensorInfo(a,w.dtype,w.values)}const m=new w0(l,c,r.shape.length,o.shape.length,h,[f,1],p),g=t.runWebGLProgram(m,[o,r,i],o.dtype),x=qe({inputs:{x:g},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(g),x}const FK={kernelName:cw,backendName:"webgl",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Wt(i,r.shape)[0],c=_g(r,o,a),l=r.shape.length,d=new Array(l).fill(0),h=r.shape.slice();return c.map(f=>{const p=[...h];p[a]=f;const m=Ma({inputs:{x:r},backend:t,attrs:{begin:d,size:p}});return d[a]+=f,m})}const LK={kernelName:oh,backendName:"webgl",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wy="return sqrt(x);",zK=Qt({opSnippet:Wy,packedOpSnippet:Wy,cpuKernelImpl:pV}),WK={kernelName:ll,backendName:"webgl",kernelFunc:zK};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BK="return x * x;",VK=Qt({opSnippet:BK}),UK={kernelName:gm,backendName:"webgl",kernelFunc:VK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const By="return (a - b) * (a - b);",GK=Jn({opSnippet:By,packedOpSnippet:By}),HK={kernelName:ul,backendName:"webgl",kernelFunc:GK};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),i=ro(o),a=mV(i,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const KK={kernelName:xm,backendName:"webgl",kernelFunc:qK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=or+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new _r(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const XK={kernelName:ml,backendName:"webgl",kernelFunc:QK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JK{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=an(s.length),i=an(s.length);let a="";if(r===1)a="coords * strides + begin";else{let c=0;a=s.map((l,d)=>(c++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${c-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=s,{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=mg(r.shape,o,i,a,c,l,d,h,f);let S;if(g)S=qe({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){R(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=hg(b,v,w),k=Ma({inputs:{x:r},backend:t,attrs:{begin:b,size:C}});S=qe({inputs:{x:k},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(k)}else if(t.shouldExecuteOnCPU([r])){const k=t.readSync(r.dataId),$=zt(r.shape,r.dtype,k),N=gV(p,$,w,b);S=t.makeTensorInfo(m,r.dtype,N.values)}else{const k=new JK(b,w,p);S=t.runWebGLProgram(k,[r],r.dtype)}const I=qe({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),I}const ZK={kernelName:ym,backendName:"webgl",kernelFunc:YK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,f=t.readSync(d.dataId),p=t.readSync(h.dataId),[m,g]=xV(f,p,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const tQ={kernelName:lw,backendName:"webgl",kernelFunc:eQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),c=t.readSync(i.dataId)[0],[l,d,h]=yV(a,c,r),f=d.length;return[t.makeTensorInfo([f,2],"int32",l),t.makeTensorInfo([f],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const sQ={kernelName:uw,backendName:"webgl",kernelFunc:nQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=bV(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const oQ={kernelName:dw,backendName:"webgl",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ="return tan(x);",aQ=Qt({opSnippet:iQ}),cQ={kernelName:hl,backendName:"webgl",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lQ=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,uQ=Qt({opSnippet:lQ}),dQ={kernelName:fl,backendName:"webgl",kernelFunc:uQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hQ(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=$i(i,o,r.shape),f=[h/l,l];if(h===0)return t.makeTensorInfo(r.shape,o.dtype);const p=qe({inputs:{x:o},backend:t,attrs:{shape:[c,a]}}),m=qe({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),g=qe({inputs:{x:r},backend:t,attrs:{shape:f}}),x=new w0(c,a,p.shape.length,m.shape.length,d,f,!1,!0),y=t.runWebGLProgram(x,[m,p,g],g.dtype),b=qe({inputs:{x:y},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const fQ={kernelName:nw,backendName:"webgl",kernelFunc:hQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pQ{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=an(this.rank),o=mQ(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function mQ(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CI(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const c=t.readSync(r.dataId),l=r.dtype==="string"?c.map(f=>ko(f)):c,d=zt(r.shape,r.dtype,l),h=vV(d,o);return t.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new pQ(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const gQ={kernelName:pl,backendName:"webgl",kernelFunc:CI};class xQ{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class yQ{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Go(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function Vy(n){let e=1;for(;e<n;)e*=2;return e}function bQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,a=pe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=pe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,d=l[l.length-1];if(t.shouldExecuteOnCPU([r])||d<a||o>c){const N=t.readSync(r.dataId),[_,P]=SV(N,l,r.dtype,o,i);return[t.makeTensorInfo(_.shape,_.dtype,_.values),t.makeTensorInfo(P.shape,P.dtype,P.values)]}if(o===0)return l[l.length-1]=0,[t.makeTensorInfo(l,r.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(d===1)return[r,Fl({attrs:{shape:l,dtype:"int32",value:0},backend:t})];const h=t.texData.get(r.dataId),f=h!==null&&h.isPacked,p=f?t.unpackTensor(r):r,g=Ce(l)/d,x=qe({inputs:{x:p},attrs:{shape:[g,d]},backend:t});f&&Go(t,p);const y=Vy(o),b=Vy(d);let v=null;const w=()=>v===null?[x,x]:[x,v],S=(N,_,P)=>{const j=w(),A=new xQ(P),M=[[d],[v===null?1:0],[Number.NEGATIVE_INFINITY],[N],[_]],K=v;v=t.runWebGLProgram(A,j,"int32",M),Go(t,K)};for(let N=1;N<y;N*=2){const _=N*2;for(let P=N;P>=1;P/=2)S(_,P,[g,b])}for(let N=b;N>y;N/=2){const _=w(),P=new yQ([g,N/2]),A=[[d],[v===null?1:0],[y]],F=v;v=t.runWebGLProgram(P,_,"int32",A),Go(t,F);const M=y/2,K=M*2;for(let D=M;D>=1;D/=2)S(K,D,v.shape)}let I=v;v=Ma({inputs:{x:v},backend:t,attrs:{begin:0,size:[g,o]}}),Go(t,I);let C=mI({inputs:{x,indices:v},backend:t,attrs:{axis:1,batchDims:1}});Go(t,x);const k=l.slice(0,-1);k.push(o),I=v,v=qe({inputs:{x:v},attrs:{shape:k},backend:t}),Go(t,I);const $=C;return C=qe({inputs:{x:C},attrs:{shape:k},backend:t}),Go(t,$),[C,v]}const wQ={kernelName:bm,backendName:"webgl",kernelFunc:bQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vQ{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SQ(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=s,[d,h,f,p]=r.shape,[m,g]=l??[h,f],x=[d,m,g,p],y=new vQ(h,f,i,a,c,x);return t.runWebGLProgram(y,[r,o],"float32")}const CQ={kernelName:wm,backendName:"webgl",kernelFunc:SQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NQ(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Pl(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:c,indices:l}=CV(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const IQ={kernelName:vm,backendName:"webgl",kernelFunc:NQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,c=r.shape[o],l=new Array(a-1);let d=0;for(let g=0;g<a;g++)g!==o&&(l[d++]=i.shape[g]);const h=[],f=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const m=new Array(c);for(let g=0;g<m.length;g++){f[o]=g;const x=Ma({inputs:{x:i},backend:t,attrs:{begin:f,size:p}}),y=qe({inputs:{x},backend:t,attrs:{shape:l}});m[g]=y,h.push(x)}return h.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const $Q={kernelName:ah,backendName:"webgl",kernelFunc:kQ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TQ{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const c="0.0",l="sumValue",d=Math.floor(s/4)*4,h=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,c=[];let l=0;const d=Sn([l],a);let h=r;d!=null&&(h=hs({inputs:{x:r},backend:t,attrs:{perm:d}}),c.push(h),l=Tn(1,a)[0]);const f=o1(h.shape,l,i),p=Ce([h.shape[l]]),m=qe({inputs:{x:h},backend:t,attrs:{shape:[-1,p]}});c.push(m);const g=Nm(r.dtype),x=(w,S,I,C,k)=>{const $=w.shape[0],N=w.shape[1],_=r1(N,k),P={windowSize:_,inSize:N,batchSize:$,numSegments:k},j=new TQ(P,S),A=t.compileAndRun(j,[w,I],C);if(c.push(A),A.shape[1]===k)return A;const F=SI({backend:t,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),M=CI({inputs:{x:F},backend:t,attrs:{reps:[N/_]}});return c.push(F),c.push(M),x(A,S,M,C,k)},y=x(m,"unsortedSegmentSum",o,g,i),b=qe({inputs:{x:y},backend:t,attrs:{shape:f}});let v=b;if(d!=null){c.push(b);const w=Mo(d);v=hs({inputs:{x:v},backend:t,attrs:{perm:w}})}return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const EQ={kernelName:ch,backendName:"webgl",kernelFunc:AQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RQ=[pU,gU,bU,SU,NU,$U,AU,RU,jU,FU,zU,VU,HU,XU,ZU,t6,s6,a6,l6,d6,m6,S6,N6,T6,E6,M6,O6,B6,JV,G6,X6,eG,iG,lG,dG,fG,mG,bG,SG,IG,$G,AG,RG,PG,MG,zG,BG,GG,KG,XG,eH,rH,cH,dH,pH,mH,xH,bH,vH,CH,IH,AH,DH,jH,FH,zH,VH,qH,JH,XV,ZH,K6,nq,oq,cq,ZV,hq,gq,yq,Sq,Iq,Aq,Dq,Mq,zq,Vq,Gq,Qq,Jq,Zq,s8,o8,a8,l8,d8,m8,b8,C8,R8,nU,j8,O8,W8,U8,D6,q8,Q8,J8,e7,r7,tU,i7,c7,u7,h7,f7,_6,$8,g7,w7,N7,rU,T7,R7,j7,O7,B7,U7,q7,X7,Z7,nK,oK,cK,hK,mK,bK,SK,w6,A8,IK,$K,AK,RK,_K,jK,FK,LK,WK,UK,HK,KK,XK,ZK,tQ,sQ,oQ,T8,dU,cQ,dQ,fQ,gQ,wQ,CQ,hU,IQ,$Q,EQ,K8];for(const n of RQ)fw(n);const ks=class ks{constructor(){Ee(this,"mlModel",null);Ee(this,"mlEnabled",!1);Ee(this,"mlState",{initialized:!1,ready:!1,trainingCount:0,lastTrainedAt:null,accuracy:null})}async analyze(e){const t=this.analyzeByRules(e);if(this.canUseML(e))try{const s=await this.analyzeByML(e);return this.mergeSignals(t,s,e)}catch(s){E.warn(`[${this.name}] ML analysis failed, using rules only`,s)}return t}async initializeML(e){if(this.mlState.initialized){E.info(`[${this.name}] ML already initialized`);return}try{const t=e||`/models/${this.id}/model.json`,s=`${this.id}_${t}`,r=ks.modelCache.get(s);if(r){this.mlModel=r,await this.loadPersonalWeights(),this.mlState.initialized=!0,this.mlState.ready=!0,E.info(`[${this.name}] ‚úÖ ML model loaded from cache (weights reloaded)`);return}E.info(`[${this.name}] Loading ML model from ${t}`),this.mlModel=await GM(t),await this.loadPersonalWeights(),ks.modelCache.set(s,this.mlModel),this.updateMemoryUsage(),this.mlState.initialized=!0,this.mlState.ready=!0,E.info(`[${this.name}] ‚úÖ ML initialized successfully`)}catch{this.mlState.initialized=!1,this.mlState.ready=!1,await this.createFallbackModel()}}async createFallbackModel(){try{const e=this.getFeatureDimension();this.mlModel=KM({layers:[mf({inputShape:[e],units:Math.ceil(e*.7),activation:"relu",kernelInitializer:"glorotUniform"}),hF({rate:.2}),mf({units:Math.ceil(e*.5),activation:"relu"}),mf({units:this.getOutputDimension(),activation:"sigmoid"})]}),this.mlModel.compile({optimizer:qo.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.mlState.initialized=!0,this.mlState.ready=!0,E.info(`[${this.name}] ‚úÖ Fallback model created`)}catch(e){E.error(`[${this.name}] Failed to create fallback model`,e)}}async learn(e,t){if(!(!this.mlEnabled||!this.mlState.ready||!this.mlModel))try{const s=this.extractFeatures(e),r=this.outcomeToLabel(t),o=await this.mlModel.fit(ea([s]),ea([r]),{epochs:1,verbose:0,shuffle:!1});this.mlState.trainingCount++,this.mlState.lastTrainedAt=Date.now(),o.history.acc&&(this.mlState.accuracy=o.history.acc[0]),this.mlState.trainingCount%10===0&&(await this.savePersonalWeights(),E.debug(`[${this.name}] Weights saved (${this.mlState.trainingCount} trainings)`))}catch(s){E.error(`[${this.name}] Learning failed`,s)}}async predict(e){if(!this.mlModel)throw new Error("ML model not initialized");const t=performance.now(),s=ea([e]),r=this.mlModel.predict(s),o=await r.data();return s.dispose(),r.dispose(),performance.now()-t,{values:Array.from(o),confidence:this.calculatePredictionConfidence(Array.from(o)),timestamp:Date.now()}}canUseML(e){return this.mlEnabled&&this.mlState.ready&&this.mlModel!==null&&this.hasEnoughData(e)}hasEnoughData(e){const t=e.progress;return t?(t.memorizationAttempts??0)>=10:!1}outcomeToLabel(e){return[e.wasCorrect?0:1]}calculatePredictionConfidence(e){return 1-Array.from(e).reduce((s,r)=>r>0&&r<1?s-(r*Math.log2(r)+(1-r)*Math.log2(1-r)):s,0)/e.length}async savePersonalWeights(){if(this.mlModel)try{const e=this.mlModel.getWeights(),t=await this.serializeWeights(e),s={version:"1.0",timestamp:Date.now(),weights:t,metadata:{trainingCount:this.mlState.trainingCount,accuracy:this.mlState.accuracy}};localStorage.setItem(`ml-weights-${this.id}`,JSON.stringify(s))}catch(e){E.error(`[${this.name}] Failed to save weights`,e)}}async loadPersonalWeights(){try{const e=localStorage.getItem(`ml-weights-${this.id}`);if(!e||!this.mlModel)return;const t=JSON.parse(e),s=await this.deserializeWeights(t.weights);this.mlModel.setWeights(s),this.mlState.trainingCount=t.metadata.trainingCount,this.mlState.accuracy=t.metadata.accuracy,E.info(`[${this.name}] Personal weights loaded (${t.metadata.trainingCount} trainings)`)}catch(e){E.warn(`[${this.name}] Failed to load personal weights`,e)}}async serializeWeights(e){const t=await Promise.all(e.map(async s=>Array.from(await s.data())));return btoa(JSON.stringify(t))}async deserializeWeights(e){return JSON.parse(atob(e)).map(s=>Yi(s))}enableML(){this.mlEnabled=!0,E.info(`[${this.name}] ML enabled`)}disableML(){this.mlEnabled=!1,E.info(`[${this.name}] ML disabled`)}getMLState(){return{...this.mlState}}updateMemoryUsage(){try{const t=Qf().numBytes/(1024*1024);ks.memoryUsage.current=t,ks.memoryUsage.peak=Math.max(ks.memoryUsage.peak,t),ks.memoryUsage.lastCheck=Date.now(),t>100}catch(e){E.warn(`[${this.name}] Memory check failed`,e)}}static getMemoryUsage(){return{...ks.memoryUsage}}static clearModelCache(){ks.modelCache.forEach(e=>{try{e.dispose()}catch(t){E.warn("Failed to dispose model",t)}}),ks.modelCache.clear(),E.info("ML model cache cleared")}};Ee(ks,"modelCache",new Map),Ee(ks,"memoryUsage",{current:0,peak:0,lastCheck:Date.now()}),Ee(ks,"initWarningShown",new Set);let oo=ks;const kr={MASTERED:3,LEARNING:2,STRUGGLING:1,INCORRECT:3,HIGH_PRIORITY:2},qi={EXCELLENT:.9,GOOD:.8,FAIR:.6,POOR:.5},_n={MASTERED_PERFECT:10,MASTERED_ALMOST:15,ONE_SHOT_CORRECT:18,NEAR_MASTERY:25,NEW_NEAR_MASTERY:30,NEW_DEFAULT:35,STILL_LEARNING_LOW:45,STILL_LEARNING_DEFAULT:50,INCORRECT_LIGHT:55,INCORRECT_MEDIUM:70,INCORRECT_HIGH:75,INCORRECT_URGENT:85},zi={STILL_LEARNING_MAX:15,STILL_LEARNING_MULTIPLIER:5,TIME_DECAY_MAX:15,TIME_DECAY_MULTIPLIER:1.5},DQ={QUICK_LEARNER:2};function _Q(n){return Math.max(0,Math.min(100,n))}function NI(n,e){switch(e){case"memorization":return n.memorizationPosition;case"translation":return n.translationPosition;case"spelling":return n.spellingPosition;case"grammar":return n.grammarPosition}}function II(n,e){switch(e){case"memorization":return{attempts:n.memorizationAttempts||0,correct:n.memorizationCorrect||0,stillLearning:n.memorizationStillLearning||0};case"translation":return{attempts:n.translationAttempts||0,correct:n.translationCorrect||0,stillLearning:0};case"spelling":return{attempts:n.spellingAttempts||0,correct:n.spellingCorrect||0,stillLearning:0};case"grammar":return{attempts:n.grammarAttempts||0,correct:n.grammarCorrect||0,stillLearning:0}}}function kI(n){const{mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}=n,c=s>0?(r+o*.5)/s:0,l=t>=40&&t<70;return e==="memorization"&&o===0&&l&&i===kr.STRUGGLING&&a===0&&c>=qi.FAIR?{decision:"ignore_saved_position",reason:"auto_promoted_still_learning_progress",accuracyForOverride:c}:{decision:"use_saved_position",reason:"other",accuracyForOverride:c}}function PQ(n,e="memorization"){if(!n)return null;const t=NI(n,e);if(t==null)return null;const{attempts:s,correct:r,stillLearning:o}=II(n,e),i=n.consecutiveCorrect||0,a=n.consecutiveIncorrect||0,c=kI({mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a});return{mode:e,savedPosition:t,decision:c.decision,reason:c.reason,accuracyForOverride:c.accuracyForOverride,modeAttempts:s,modeCorrect:r,modeStillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}}function Ut(n,e="memorization"){if(!n)return _n.NEW_DEFAULT;const t=NI(n,e),s=II(n,e),r=s.attempts,o=s.correct,i=s.stillLearning,a=n.consecutiveCorrect||0,c=n.consecutiveIncorrect||0,l=n.lastStudied||Date.now();if(t!=null){if(a>=kr.MASTERED)return _n.MASTERED_PERFECT;if(a>=kr.LEARNING)return(r>0?(o+i*.5)/r:0)>=qi.GOOD?_n.MASTERED_ALMOST:_n.NEAR_MASTERY;if(kI({mode:e,savedPosition:t,attempts:r,correct:o,stillLearning:i,consecutiveCorrect:a,consecutiveIncorrect:c}).decision!=="ignore_saved_position")return t}const d=(Date.now()-l)/(1e3*60*60*24),h=o+i*.5,f=r>0?h/r:0;if(r===0)return _n.NEW_DEFAULT;if(a>=kr.MASTERED)return _n.MASTERED_PERFECT;if(a>=kr.LEARNING)return f>=qi.GOOD?_n.MASTERED_ALMOST:_n.NEAR_MASTERY;if(e==="memorization"&&i>0&&c===0&&a<kr.LEARNING){const y=Math.min(i*zi.STILL_LEARNING_MULTIPLIER,zi.STILL_LEARNING_MAX);return Math.min(_n.STILL_LEARNING_LOW+y,_n.STILL_LEARNING_DEFAULT)}if(a===kr.STRUGGLING)return f>=qi.EXCELLENT&&r<=DQ.QUICK_LEARNER?_n.ONE_SHOT_CORRECT:f>=qi.FAIR?_n.NEW_NEAR_MASTERY:_n.STILL_LEARNING_LOW;if(c>=kr.INCORRECT)return _n.INCORRECT_URGENT;if(c>=kr.HIGH_PRIORITY)return _n.INCORRECT_HIGH;if(c>=kr.STRUGGLING)return f>=qi.POOR?_n.INCORRECT_LIGHT:_n.INCORRECT_MEDIUM;if(i>0&&a===0&&c===0){const y=Math.min(i*zi.STILL_LEARNING_MULTIPLIER,zi.STILL_LEARNING_MAX);return Math.min(_n.STILL_LEARNING_LOW+y,_n.STILL_LEARNING_DEFAULT)}const p=_n.STILL_LEARNING_DEFAULT-f*30+c*10,m=Math.min(d*zi.TIME_DECAY_MULTIPLIER,zi.TIME_DECAY_MAX),g=p+m;return _Q(g)}function Yr(n){return n>=70?"incorrect":n>=40?"still_learning":n>=20?"new":"mastered"}const qs=class qs{calculateNextReview(e,t=qs.DEFAULT_EASE_FACTOR,s=qs.FIRST_INTERVAL,r=0){const o=this.updateEaseFactor(t,e),i=this.updateRepetitions(r,e),a=this.calculateInterval(i,s,o,e),c=new Date(Date.now()+a*24*60*60*1e3);return{nextInterval:a,easeFactor:o,repetitions:i,nextReviewDate:c}}updateEaseFactor(e,t){const s=e+(.1-(5-t)*(.08+(5-t)*.02));return Math.max(qs.MIN_EASE_FACTOR,s)}updateRepetitions(e,t){return t<3?0:e+1}calculateInterval(e,t,s,r){if(r<3)return qs.FIRST_INTERVAL;switch(e){case 1:return qs.FIRST_INTERVAL;case 2:return qs.SECOND_INTERVAL;default:return Math.round(t*s)}}determineQuality(e,t,s=!1,r=1){return e?t<3e3&&!s?5:t<5e3&&!s?4:t<1e4?3:2:r>2?0:1}getQualityDescription(e){return{0:"ÂÆåÂÖ®Â§±Êïó - ÂÖ®„ÅèÊÄù„ÅÑÂá∫„Åõ„Å™„ÅÑ",1:"Â§±Êïó - ÊÄù„ÅÑÂá∫„Åõ„Å™„Åã„Å£„Åü„Åå„ÄÅÁ≠î„Åà„ÇíË¶ã„Å¶Á¥çÂæó",2:"Èï∑ËÄÉÊ≠£Ëß£ - „Åã„Å™„ÇäËÄÉ„Åà„Å¶Ê≠£Ëß£",3:"Ê≠£Ëß£ÔºàËø∑„ÅÑÊúâÔºâ - Â∞ë„ÅóËÄÉ„Åà„Å¶Ê≠£Ëß£",4:"Ê≠£Ëß£ÔºàËø∑„ÅÑÁÑ°Ôºâ - „Åô„Åê„Å´Ê≠£Ëß£",5:"ÂÆåÁíß - Áû¨ÊôÇ„Å´Ê≠£Ëß£"}[e]}logCalculation(e,t,s,r,o){}};Ee(qs,"MIN_EASE_FACTOR",1.3),Ee(qs,"DEFAULT_EASE_FACTOR",2.5),Ee(qs,"FIRST_INTERVAL",1),Ee(qs,"SECOND_INTERVAL",6);let wp=qs;const $s=class $s{calculateRetention(e,t){const r=1/Math.max($s.MIN_STRENGTH,Math.min($s.MAX_STRENGTH,t)),o=Math.exp(-e*r);return Math.max(0,Math.min(1,o))}calculateMemoryStrength(e){const t=$s.MIN_STRENGTH,s=(e.consecutiveCorrect||0)*1.5,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0,a=(r>0?o/r:0)*3,c=Math.min(r*.2,2),d=(e.memorizationStillLearning||0)*.5,f=(e.consecutiveIncorrect||0)*1,p=t+s+a+c-d-f;return Math.max($s.MIN_STRENGTH,Math.min($s.MAX_STRENGTH,p))}suggestReviewTiming(e,t=$s.TARGET_RETENTION){return e<t-.2?"now":e<t-.1?"soon":e<t+.1?"scheduled":"later"}analyzeRetention(e,t,s=$s.TARGET_RETENTION){const r=this.calculateMemoryStrength(e),o=this.calculateRetention(t,r),i=this.suggestReviewTiming(o,s);return{retention:o,memoryStrength:r,daysSince:t,reviewUrgency:i}}predictDecayDays(e,t=$s.TARGET_RETENTION){const s=-e*Math.log(t);return Math.max(0,s)}calculateNextReviewDate(e,t=$s.TARGET_RETENTION){const s=this.calculateMemoryStrength(e),r=this.predictDecayDays(s,t),o=Date.now()+r*24*60*60*1e3;return new Date(o)}logAnalysis(e,t){}getReviewUrgencyLabel(e){return{now:"‰ªä„Åô„ÅêÂæ©Áøí",soon:"ËøëÊó•‰∏≠„Å´Âæ©Áøí",scheduled:"„Çπ„Ç±„Ç∏„É•„Éº„É´ÈÄö„Çä",later:"ÂæåÂõû„Åó„ÅßOK"}[e]}getStrengthDescription(e){return e>=9?"Ë∂ÖÂº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂ÂÆåÂÖ®ÂÆöÁùÄÔºâ":e>=7?"Âº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠Ôºâ":e>=5?"‰∏≠Á®ãÂ∫¶ÔºàÁü≠ÊúüË®òÊÜ∂„Åã„ÇâÁßªË°å‰∏≠Ôºâ":e>=3?"Âº±„ÅÑÔºà„Åæ„Å†Áü≠ÊúüË®òÊÜ∂Ôºâ":"ÈùûÂ∏∏„Å´Âº±„ÅÑÔºà‰ΩúÊ•≠Ë®òÊÜ∂„É¨„Éô„É´Ôºâ"}};Ee($s,"TARGET_RETENTION",.9),Ee($s,"MIN_STRENGTH",1),Ee($s,"MAX_STRENGTH",10);let vp=$s;var Ja=(n=>(n.WORKING_MEMORY="working",n.SHORT_TERM="short",n.CONSOLIDATING="consolidating",n.LONG_TERM="long",n))(Ja||{});const Tr=class Tr{determineMemoryStage(e){const t=this.getDaysSinceFirstAttempt(e),s=e.consecutiveCorrect||0,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0;if(t>=30&&s>=3&&r>=10)return"long";const i=r>0?o/r:0;return t>=7&&s>=2&&i>=.7?"consolidating":t>=1&&o>0?"short":"working"}getDaysSinceFirstAttempt(e){const t=e.firstAttempted||Date.now(),s=(Date.now()-t)/(1e3*60*60*24);return Math.max(0,s)}getReviewIntervals(e){return{working:Tr.WORKING_MEMORY_INTERVALS,short:Tr.SHORT_TERM_INTERVALS,consolidating:Tr.CONSOLIDATING_INTERVALS,long:Tr.LONG_TERM_INTERVALS}[e]}calculateNextReviewInterval(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s),o=t.repetitions,i=r[Math.min(o,r.length-1)],a=t.nextInterval,c=(i+a)/2;return Math.max(.01,c)}analyzeMemoryStage(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s);let o;t?o=this.calculateNextReviewInterval(e,t):o=r[0];const i=this.getStageDescription(s);return{stage:s,recommendedIntervals:r,nextInterval:o,description:i}}getStageDescription(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂ - ÂàùÂõûÂ≠¶ÁøíÁõ¥Âæå„ÄÅÁü≠ÊúüÈñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å",short:"Áü≠ÊúüË®òÊÜ∂ - 1-2ÈÄ±Èñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å„ÄÅÂÆöÁùÄ„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„Çã",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠ - Èï∑ÊúüË®òÊÜ∂„Å∏„ÅÆÁßªË°åÈÅéÁ®ã„ÄÅÊúàÂçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅåÊé®Â•®",long:"Èï∑ÊúüË®òÊÜ∂ - ÂÆåÂÖ®„Å´ÂÆöÁùÄ„ÄÅÂçäÂπ¥ÔΩûÂπ¥Âçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅßÂçÅÂàÜ"}[e]}suggestPriorityAdjustment(e,t){const r=this.getReviewIntervals(e)[0];return t>r*1.5?20:t>r?10:t<r*.5?-10:0}logAnalysis(e,t){}getStageLabel(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂",short:"Áü≠ÊúüË®òÊÜ∂",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠",long:"Èï∑ÊúüË®òÊÜ∂"}[e]}};Ee(Tr,"WORKING_MEMORY_INTERVALS",[1/1440,10/1440,1/24,.5]),Ee(Tr,"SHORT_TERM_INTERVALS",[1,3,7,14]),Ee(Tr,"CONSOLIDATING_INTERVALS",[14,30,60,90]),Ee(Tr,"LONG_TERM_INTERVALS",[180,365,730]);let Sp=Tr;class $I extends oo{constructor(){super();Ee(this,"id","memory");Ee(this,"name","Memory AI");Ee(this,"icon","üß†");Ee(this,"sm2");Ee(this,"forgettingCurve");Ee(this,"longTermStrategy");this.sm2=new wp,this.forgettingCurve=new vp,this.longTermStrategy=new Sp}proposePosition(t,s,r,o,i){if(i===0)return 35;let a=50;const c=this.longTermStrategy.determineMemoryStage(t),l=this.longTermStrategy.suggestPriorityAdjustment(c,r);a+=l;const d=this.determineQuality(t),h=this.sm2.calculateNextReview(d,t.easeFactor||2.5,t.lastInterval||1,t.repetitions||0),f=new Date,p=Math.floor((h.nextReviewDate.getTime()-f.getTime())/(1e3*60*60*24));p<=0?a+=30:p<=2?a+=15:p>=7&&(a-=20);const m=this.forgettingCurve.analyzeRetention(t,r);m.retention<.5?a+=25:m.retention>.8&&(a-=15);const g=o*30;a-=g;const x=Math.min(r*5,40);return a+=x,Math.max(0,Math.min(100,a))}analyzeByRules(t){const{word:s,progress:r,currentTab:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"";if(!r||!r.memorizationAttempts)return this.createNewWordSignal(i);const a=this.determineCategory(r),c=this.calculateForgettingRisk(r),l=this.calculateTimeBoost(r,o),d=this.calculateRetentionStrength(r),h=this.getDaysSinceLastStudy(r),f=this.determineQuality(r),p=this.sm2.calculateNextReview(f,r.easeFactor||2.5,r.lastInterval||1,r.repetitions||0),m=this.forgettingCurve.analyzeRetention(r,h),g=this.longTermStrategy.analyzeMemoryStage(r,p),x={[Ja.WORKING_MEMORY]:"WORKING_MEMORY",[Ja.SHORT_TERM]:"SHORT_TERM",[Ja.CONSOLIDATING]:"CONSOLIDATING",[Ja.LONG_TERM]:"LONG_TERM"};return{aiId:"memory",confidence:this.calculateConfidence(r),timestamp:Date.now(),forgettingRisk:c,timeBoost:l,category:a,retentionStrength:d,sm2Data:{quality:f,easeFactor:p.easeFactor,interval:p.nextInterval,repetitions:p.repetitions,nextReviewDate:p.nextReviewDate},retention:m.retention,memoryStage:x[g.stage],recommendedNextReview:p.nextReviewDate}}determineCategory(t){return Yr(Ut(t))}calculateForgettingRisk(t){const s=t.lastStudied||0,r=t.reviewInterval||1;if(s===0)return 0;const i=(Date.now()-s)/(1e3*60*60*24),a=t.memorizationAttempts||0,c=t.memorizationCorrect||0,l=t.memorizationStillLearning||0,d=c+l*.5,h=a>0?d/a*100:0;let f=i/r*100;return h<50?f*=1.5:h<70&&(f*=1.2),Math.min(f,200)}calculateTimeBoost(t,s){const r=t.lastStudied||0;if(r===0)return 0;const o=Date.now()-r,i=o/(1e3*60);if(s==="memorization")return i>=30?.6:i>=15?.5:i>=5?.3:i>=2?.15:0;const a=o/(1e3*60*60*24);return a>=7?.5:a>=3?.3:a>=1?.15:0}calculateRetentionStrength(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0,i=t.memorizationStreak||0;if(s===0)return 0;const c=(r+o*.5)/s,l=Math.min(i*.1,.3);return Math.min(c+l,1)}calculateConfidence(t){const s=t.memorizationAttempts||0;return s>=10?1:s>=5?.8:s>=3?.6:s>=1?.4:.2}createNewWordSignal(t){return{aiId:"memory",confidence:.1,timestamp:Date.now(),forgettingRisk:0,timeBoost:0,category:"new",retentionStrength:0}}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}determineQuality(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0;if(s===0)return 3;const a=(r+o*.5)/s,c=Ut(t,"memorization");switch(Yr(c)){case"incorrect":return c>=90?0:c>=80?1:2;case"still_learning":return a>=.9?4:a>=.7?3:2;case"new":return a>=.9?5:a>=.7?4:3;case"mastered":return a>=.9?5:(a>=.7,4);default:return 3}}logEnhancedAnalysis(t,s,r,o,i){console.log("[MemoryAI Phase 4 ÂàÜÊûê]",{word:t.word,sm2:{quality:i,easeFactor:s.easeFactor,interval:s.nextInterval,nextReview:s.nextReviewDate},retention:{retention:r.retention,memoryStrength:r.memoryStrength,reviewUrgency:r.reviewUrgency},memoryStage:{stage:o.stage,nextReview:o.nextInterval,description:o.description}})}validateSignal(t){return!(!t.aiId||t.aiId!=="memory"||t.confidence<0||t.confidence>1||t.forgettingRisk<0||t.forgettingRisk>200||t.timeBoost<0||t.timeBoost>1||t.retentionStrength<0||t.retentionStrength>1||!["new","incorrect","still_learning","mastered"].includes(t.category))}calculateOptimalInterval(t,s=2.5){if(t===0)return 0;if(t===1)return 1;if(t===2)return 6;const r=this.calculateOptimalInterval(t-1,s);return Math.round(r*s)}updateEasinessFactor(t,s){const r=t+(.1-(5-s)*(.08+(5-s)*.02));return Math.max(r,1.3)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"memory",confidence:r.confidence,timestamp:Date.now(),forgettingRisk:r.values[0]*100,timeBoost:r.values[1],category:this.predictCategory(r.values[2]),retentionStrength:r.values[3]}}mergeSignals(t,s,r){var c;const o=((c=r.progress)==null?void 0:c.memorizationAttempts)||0,i=Math.min(Math.max((o-10)/20,0),.7),a=1-i;return{aiId:"memory",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),forgettingRisk:t.forgettingRisk*a+s.forgettingRisk*i,timeBoost:t.timeBoost*a+s.timeBoost*i,category:o>30?s.category:t.category,retentionStrength:t.retentionStrength*a+s.retentionStrength*i,sm2Data:t.sm2Data,retention:t.retention,memoryStage:t.memoryStage,recommendedNextReview:t.recommendedNextReview}}extractFeatures(t){const{word:s,progress:r}=t;if(!r)return Array(15).fill(0);const o=r.memorizationAttempts||0,i=r.memorizationCorrect||0,a=r.consecutiveCorrect||0,c=r.consecutiveIncorrect||0;return[s.word.length/15,s.meaning.split(",").length/5,o/20,o>0?i/o:0,a/10,c/5,this.getDaysSinceLastStudy(r)/30,new Date().getHours()/24,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,t.sessionStats.questionsAnswered||t.sessionStats.totalAttempts/50,t.sessionStats.currentAccuracy||(t.sessionStats.totalAttempts>0?t.sessionStats.correctAnswers/t.sessionStats.totalAttempts:0),r.easeFactor||r.easinessFactor||2.5,this.forgettingCurve.analyzeRetention(r,this.getDaysSinceLastStudy(r)).retention]}predictCategory(t){return t<.25?"new":t<.5?"incorrect":t<.75?"still_learning":"mastered"}getFeatureDimension(){return 15}getOutputDimension(){return 4}}class TI extends oo{constructor(){super(...arguments);Ee(this,"id","cognitiveLoad");Ee(this,"name","Cognitive Load AI");Ee(this,"icon","üí§")}proposePosition(t,s){const i=50+s*15;return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{sessionStats:s}=t,r=this.determineLoadLevel(s),o=this.calculateFatigueScore(s),i=this.shouldRecommendBreak(r,o,s),a=this.calculateDifficultyAdjustment(r,s);return{aiId:"cognitiveLoad",confidence:this.calculateConfidence(s),timestamp:Date.now(),loadLevel:r,fatigueScore:o,recommendedBreak:i,difficultyAdjustment:a}}determineLoadLevel(t){const s=t.totalAttempts,r=s>0?t.correctAnswers/s:1,o=t.consecutiveIncorrect;return o>=5||r<.3&&s>=10?"overload":o>=3||r<.5&&s>=5?"high":r<.7?"medium":"low"}calculateFatigueScore(t){const s=t.sessionDuration/6e4,r=t.totalAttempts,o=t.avgResponseTime||0;let i=0;return s>45?i+=.5:s>30?i+=.3:s>15&&(i+=.1),r>50?i+=.3:r>30&&(i+=.2),o>5e3?i+=.2:o>4e3&&(i+=.1),Math.min(i,1)}shouldRecommendBreak(t,s,r){return t==="overload"||s>=.7||r.consecutiveIncorrect>=4||r.sessionDuration/(1e3*60)>=45}calculateDifficultyAdjustment(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return t==="overload"?-.2:t==="high"?-.15:t==="low"&&o>=.85&&r>=10?.15:t==="low"&&o>=.75?.1:0}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.3;return s>=20?o+=.3:s>=10?o+=.2:s>=5&&(o+=.1),r>=15?o+=.3:r>=5?o+=.2:r>=2&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="cognitiveLoad"||t.confidence<0||t.confidence>1||t.fatigueScore<0||t.fatigueScore>1||t.difficultyAdjustment<-.2||t.difficultyAdjustment>.2||!["low","medium","high","overload"].includes(t.loadLevel))}logAnalysis(t,s){}getRecommendedActions(t){const s=[];return t.loadLevel==="overload"?(s.push("5-10ÂàÜ„ÅÆ‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Á∞°Âçò„Å™ÂïèÈ°å„Åã„ÇâÂÜçÈñã„Åó„Åæ„Åó„Çá„ÅÜ"),s.push("Ê∞¥ÂàÜË£úÁµ¶„Çí„Åó„Åæ„Åó„Çá„ÅÜ")):t.loadLevel==="high"?(s.push("2-3ÂàÜ„ÅÆÂ∞è‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Â∞ë„ÅóÁ∞°Âçò„Å™ÂïèÈ°å„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô")):t.recommendedBreak&&s.push("„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅÂ∞ë„Åó‰ºëÊÜ©„Åó„Åæ„Åó„Çá„ÅÜ"),t.fatigueScore>=.7&&s.push("ÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ"),s}isInFlowState(t,s){if(t.loadLevel!=="medium"&&t.loadLevel!=="low"||t.fatigueScore>.5)return!1;const r=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0;if(r<.6||r>.85)return!1;const o=s.sessionDuration/(1e3*60);return!(o<5||o>45)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="low":o<.5?i="medium":o<.75?i="high":i="overload";const a=r.values[1],c=r.values[2],l=(r.values[3]-.5)*.4;return{aiId:"cognitiveLoad",confidence:r.confidence,timestamp:Date.now(),loadLevel:i,fatigueScore:a,recommendedBreak:c>.5,difficultyAdjustment:l}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.floor(o/20),a=Math.min(Math.max((i-3)/10,0),.7),c=1-a;return{aiId:"cognitiveLoad",confidence:t.confidence*c+s.confidence*a,timestamp:Date.now(),loadLevel:i>10?s.loadLevel:t.loadLevel,fatigueScore:t.fatigueScore*c+s.fatigueScore*a,recommendedBreak:t.recommendedBreak||s.recommendedBreak,difficultyAdjustment:t.difficultyAdjustment*c+s.difficultyAdjustment*a}}extractFeatures(t){const{sessionStats:s,progress:r}=t,o=s.sessionDuration/(1e3*60),i=r&&r.memorizationAttempts||0,a=r&&r.memorizationCorrect||0,c=r&&r.consecutiveIncorrect||0;return[o/60,s.totalAttempts/50,s.questionsAnswered||s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveIncorrect/5,s.consecutiveCorrect||0,(s.averageResponseTime||s.avgResponseTime||0)/1e4,s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0,new Date().getHours()/24,new Date().getDay()/7,s.sessionStartTime?(Date.now()-s.sessionStartTime)/(1e3*60*60):0,i/20,i>0?a/i:.5,c/5,s.responseTimeVariance||0,s.slowResponseCount||0,s.fastResponseCount||0,s.timeoutCount||0]}getFeatureDimension(){return 18}getOutputDimension(){return 4}}class AI extends oo{constructor(){super(...arguments);Ee(this,"id","errorPrediction");Ee(this,"name","Error Prediction AI");Ee(this,"icon","üîÆ")}proposePosition(t,s,r){const o=(1-s)*40,i=r>5&&s<.5?20:0,c=50+o+i;return Math.max(0,Math.min(100,c))}analyzeByRules(t){const{word:s,progress:r,allProgress:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"",a=this.identifyWeaknessAreas(r,o),c=this.findConfusionPairs(i,o),l=this.recommendPreemptiveReview(i,o),d=this.calculatePatternConfidence(r);return{aiId:"errorPrediction",confidence:this.calculateConfidence(r),timestamp:Date.now(),weaknessAreas:a,confusionPairs:c,preemptiveReview:l,patternConfidence:d}}identifyWeaknessAreas(t,s){const r=[],o={};return Object.values(s).forEach(i=>{const a=i.errorHistory;a==null||a.forEach(c=>{c.grammarPoint&&(o[c.grammarPoint]=(o[c.grammarPoint]||0)+1)})}),Object.entries(o).forEach(([i,a])=>{a>=3&&r.push(i)}),r}findConfusionPairs(t,s){const r=[],o=s[t],i=o==null?void 0:o.errorHistory;if(!i)return[];const a={};return i.forEach(c=>{c.userAnswer&&(a[c.userAnswer]=(a[c.userAnswer]||0)+1)}),Object.entries(a).forEach(([c,l])=>{l>=2&&r.push([t,c])}),r}recommendPreemptiveReview(t,s){const r=[];return Object.keys(s).forEach(o=>{if(o!==t&&o.substring(0,3)===t.substring(0,3)){const i=s[o],a=i.memorizationAttempts||0,c=i.memorizationCorrect||0;(a>0?c/a:0)<.6&&a>=2&&r.push(o)}}),r.slice(0,5)}calculatePatternConfidence(t){const s=t==null?void 0:t.errorHistory;if(!s)return 0;const r=s.length;return r>=5?.9:r>=3?.7:r>=2?.5:r>=1?.3:.1}calculateConfidence(t){const s=t==null?void 0:t.errorHistory,r=(s==null?void 0:s.length)||0,o=(t==null?void 0:t.memorizationAttempts)||0,i=Math.min(o/10,.5),a=Math.min(r/5,.5);return i+a}validateSignal(t){return!(!t.aiId||t.aiId!=="errorPrediction"||t.confidence<0||t.confidence>1||t.patternConfidence<0||t.patternConfidence>1||!Array.isArray(t.weaknessAreas)||!Array.isArray(t.confusionPairs)||!Array.isArray(t.preemptiveReview))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0],i=r.values[1],a=r.values[2];return{aiId:"errorPrediction",confidence:r.confidence,timestamp:Date.now(),weaknessAreas:i>.7?["predicted_weakness"]:[],confusionPairs:a>.7?[["predicted","confusion"]]:[],preemptiveReview:o>.6?["predicted_review"]:[],patternConfidence:r.confidence,errorProbability:o,weaknessLevel:i,confusionScore:a}}mergeSignals(t,s,r){var h,f;const o=r.progress,i=((h=o==null?void 0:o.errorHistory)==null?void 0:h.length)||0,a=((f=r.progress)==null?void 0:f.memorizationAttempts)||0,c=i+a;let l=Math.min(Math.max((c-10)/15,0),.8);c>50&&(l=.9);const d=1-l;return{aiId:"errorPrediction",confidence:t.confidence*d+s.confidence*l,timestamp:Date.now(),weaknessAreas:t.weaknessAreas,confusionPairs:t.confusionPairs,preemptiveReview:t.preemptiveReview,patternConfidence:t.patternConfidence*d+s.patternConfidence*l,errorProbability:s.errorProbability,weaknessLevel:s.weaknessLevel,confusionScore:s.confusionScore}}extractFeatures(t){var f;const{word:s,progress:r,allProgress:o,sessionStats:i}=t;if(!r)return Array(20).fill(0);Object.keys(o).length;const a=r,c=((f=a.errorHistory)==null?void 0:f.length)||0,l=r.memorizationAttempts||0,d=r.memorizationCorrect||0,h=l>0?d/l:0;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?1:0,s.katakana?1:0,c/10,(r.consecutiveIncorrect||0)/5,l>0?1-h:.5,0,a.lastErrorType==="spelling"?1:0,a.lastErrorType==="meaning"?1:0,l/20,(r.consecutiveCorrect||0)/10,this.getDaysSinceLastStudy(r)/30,(r.memorizationStreak||0)/10,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,i.questionsAnswered||i.totalAttempts/50,i.currentAccuracy||(i.totalAttempts>0?i.correctAnswers/i.totalAttempts:0),(i.averageResponseTime||i.avgResponseTime||0)/1e4]}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}getFeatureDimension(){return 20}getOutputDimension(){return 3}}class EI extends oo{constructor(){super(...arguments);Ee(this,"id","learningStyle");Ee(this,"name","Learning Style AI");Ee(this,"icon","üéØ")}proposePosition(t,s,r){const a=50+(r>10&&s<.6?25:0);return Math.max(0,Math.min(100,a))}analyzeByRules(t){const{progress:s,allProgress:r,sessionStats:o}=t,i=this.determineStyleProfile(s,r),a=this.calculateOptimalSessionLength(r,o),c=this.inferDifficultyPreference(r,o),l=this.inferMotivationType(r);return{aiId:"learningStyle",confidence:this.calculateConfidence(r),timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:c,motivationType:l}}determineStyleProfile(t,s){var i;const r={};Object.values(s).forEach(a=>{var c;(c=a.preferredQuestionTypes)==null||c.forEach(l=>{r[l]=(r[l]||0)+1})});const o=(i=Object.entries(r).sort((a,c)=>c[1]-a[1])[0])==null?void 0:i[0];return o!=null&&o.includes("audio")||o!=null&&o.includes("pronunciation")?"auditory":o!=null&&o.includes("image")||o!=null&&o.includes("visual")?"visual":o!=null&&o.includes("writing")||o!=null&&o.includes("typing")?"kinesthetic":"reading"}calculateOptimalSessionLength(t,s){const r=[];if(Object.values(t).forEach(a=>{const c=a.studyTimePatterns;c&&r.push(...c)}),r.length===0)return 20;r.sort((a,c)=>a-c);const o=[];for(let a=1;a<r.length;a++){const l=(r[a]-r[a-1])/(1e3*60);l>=5&&l<=60&&o.push(l)}if(o.length===0)return 20;o.sort((a,c)=>a-c);const i=o[Math.floor(o.length/2)];return Math.round(i)}inferDifficultyPreference(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return o>=.8&&r>=20?"challenge":o<.6?"gradual":"mixed"}inferMotivationType(t){const s=Object.keys(t).length,r=Object.values(t).filter(i=>(i.memorizationStreak||0)>=3).length,o=s>0?r/s:0;return o>=.7?"mastery":o>=.4?"performance":"social"}calculateConfidence(t){const s=Object.keys(t).length,r=Object.values(t).reduce((i,a)=>i+(a.memorizationAttempts||0),0);let o=.3;return s>=50?o+=.3:s>=20?o+=.2:s>=10&&(o+=.1),r>=100?o+=.4:r>=50?o+=.2:r>=20&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="learningStyle"||t.confidence<0||t.confidence>1||t.optimalSessionLength<5||t.optimalSessionLength>120||!["visual","auditory","kinesthetic","reading"].includes(t.styleProfile)||!["gradual","challenge","mixed"].includes(t.preferredDifficulty)||!["mastery","performance","social"].includes(t.motivationType))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="visual":o<.5?i="auditory":o<.75?i="kinesthetic":i="reading";const a=Math.round(r.values[1]*60+10),c=r.values[2];let l;c<.33?l="gradual":c<.67?l="mixed":l="challenge";const d=r.values[3];let h;return d<.33?h="mastery":d<.67?h="performance":h="social",{aiId:"learningStyle",confidence:r.confidence,timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:l,motivationType:h}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"learningStyle",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),styleProfile:o>50?s.styleProfile:t.styleProfile,optimalSessionLength:Math.round(t.optimalSessionLength*a+s.optimalSessionLength*i),preferredDifficulty:o>50?s.preferredDifficulty:t.preferredDifficulty,motivationType:o>50?s.motivationType:t.motivationType}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=Object.values(r).reduce((a,c)=>a+(c.memorizationAttempts||0),0);return[s.sessionDuration/(1e3*60*60),s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,o/100,i/200,s.questionsAnswered||s.totalAttempts/50,(s.averageResponseTime||s.avgResponseTime||0)/1e4,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 4}}class RI extends oo{constructor(){super(...arguments);Ee(this,"id","linguistic");Ee(this,"name","Linguistic AI");Ee(this,"icon","üìö")}proposePosition(t,s){const r=t.word||"",o=Math.min(r.length*2,20),i=this.calculateIrregularity(r),a=(1-s)*30,l=40+o+i+a;return Math.max(0,Math.min(100,l))}calculateIrregularity(t){const s=/([bcdfghjklmnpqrstvwxyz])\1/.test(t),r=/([qx]|[^aeiou]{4})/.test(t);return(s?5:0)+(r?10:0)}analyzeByRules(t){const{word:s,allProgress:r}=t,o=typeof s=="string"?s:(s==null?void 0:s.word)||"",i=this.calculateInherentDifficulty(o),a=this.findPhoneticallySimilarWords(o,r),c=this.findSemanticCluster(o,r),l=this.assessGrammarComplexity(o);return{aiId:"linguistic",confidence:.8,timestamp:Date.now(),inherentDifficulty:i,phoneticSimilarity:a,semanticCluster:c,grammarComplexity:l}}calculateInherentDifficulty(t){let s=0;t.length>12?s+=.3:t.length>8?s+=.2:t.length>5&&(s+=.1);const r=t.match(/[aeiou]/gi),o=r?r.length:1;return o>4?s+=.2:o>3&&(s+=.1),/[bcdfghjklmnpqrstvwxyz]{3,}/i.test(t)&&(s+=.2),/gh|ph|th|ough|augh/i.test(t)&&(s+=.1),Math.min(s,1)}findPhoneticallySimilarWords(t,s){const r=[];return Object.keys(s).forEach(o=>{o!==t&&(o.substring(0,3)===t.substring(0,3)||o.substring(o.length-3)===t.substring(t.length-3))&&r.push(o)}),r.slice(0,5)}findSemanticCluster(t,s){const r=[],o=this.extractWordRoot(t);return Object.keys(s).forEach(i=>{if(i===t)return;const a=this.extractWordRoot(i);o&&a&&o===a&&r.push(i)}),r.slice(0,5)}extractWordRoot(t){const s=["ing","ed","er","est","ly","s","es","tion","ment"];for(const r of s)if(t.endsWith(r))return t.substring(0,t.length-r.length);return t}assessGrammarComplexity(t){let s=0;return["be","have","do","go","take","get","make","know","think","see","come","want","use","find","give"].some(o=>t.includes(o))&&(s+=.3),(t.includes("-")||t.includes(" "))&&(s+=.2),(t.endsWith("tion")||t.endsWith("ment")||t.endsWith("ness"))&&(s+=.2),Math.min(s,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="linguistic"||t.confidence<0||t.confidence>1||t.inherentDifficulty<0||t.inherentDifficulty>1||t.grammarComplexity<0||t.grammarComplexity>1||!Array.isArray(t.phoneticSimilarity)||!Array.isArray(t.semanticCluster))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"linguistic",confidence:r.confidence,timestamp:Date.now(),inherentDifficulty:r.values[0],phoneticSimilarity:[],semanticCluster:[],grammarComplexity:r.values[1]}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-30)/50,0),.5),a=1-i;return{aiId:"linguistic",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),inherentDifficulty:t.inherentDifficulty*a+s.inherentDifficulty*i,phoneticSimilarity:t.phoneticSimilarity,semanticCluster:t.semanticCluster,grammarComplexity:t.grammarComplexity*a+s.grammarComplexity*i}}extractFeatures(t){var r;const{word:s}=t;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?s.ipa.length/20:0,s.katakana?s.katakana.length/20:0,/[^aeiou]{3}/.test(s.word)?1:0,/([bcdfghjklmnpqrstvwxyz])\1/.test(s.word)?1:0,s.word.split("-").length/3,s.word.includes(" ")?1:0,((r=s.word.match(/[A-Z]/g))==null?void 0:r.length)||0,/(tion|ment|ness|ing|ed)$/.test(s.word)?1:0]}getFeatureDimension(){return 10}getOutputDimension(){return 2}}class DI extends oo{constructor(){super(...arguments);Ee(this,"id","contextual");Ee(this,"name","Contextual AI");Ee(this,"icon","üåç")}proposePosition(t,s){const i=50+Math.min(s*3,30);return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{word:s,currentTab:r,allProgress:o,sessionStats:i}=t,a=typeof s=="string"?s:(s==null?void 0:s.word)||"",c=this.calculateContextRelevance(a,r),l=this.evaluateTopicContinuity(a,o,i),d=this.assessEnvironmentFit(r,i),h=this.identifyCrossTabSynergy(a,r,o);return{aiId:"contextual",confidence:this.calculateConfidence(i),timestamp:Date.now(),contextRelevance:c,topicContinuity:l,environmentFit:d,crossTabSynergy:h}}calculateContextRelevance(t,s){let r=.5;return s==="memorization"&&(r+=.2),s==="grammar"&&(r+=.3),s==="comprehensive"&&(r+=.1),Math.min(r,1)}evaluateTopicContinuity(t,s,r){return r.totalAttempts>=5}assessEnvironmentFit(t,s){let r=.5;const o=s.sessionDuration/(1e3*60),i=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5,a=new Date().getHours();return a>=6&&a<12&&t==="memorization"&&(r+=.2),a>=12&&a<18&&t==="grammar"&&(r+=.2),a>=18&&t==="memorization"&&i>=.7&&(r+=.2),o<15&&t==="memorization"&&(r+=.1),Math.min(r,1)}identifyCrossTabSynergy(t,s,r){const o=[];if(s==="memorization"){const i=r[t];i!=null&&i.grammarAttempts&&i.grammarAttempts>0&&o.push("grammar-memorization-link")}if(s==="grammar"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&o.push("memorization-grammar-link")}if(s==="comprehensive"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&(i!=null&&i.grammarAttempts)&&i.grammarAttempts>0&&o.push("comprehensive-integration")}return o}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.4;return s>=10?o+=.3:s>=5&&(o+=.2),r>=10?o+=.3:r>=5&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="contextual"||t.confidence<0||t.confidence>1||t.contextRelevance<0||t.contextRelevance>1||t.environmentFit<0||t.environmentFit>1||typeof t.topicContinuity!="boolean"||!Array.isArray(t.crossTabSynergy))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"contextual",confidence:r.confidence,timestamp:Date.now(),contextRelevance:r.values[0],topicContinuity:r.values[1]>.5,environmentFit:r.values[2],crossTabSynergy:[]}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"contextual",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),contextRelevance:t.contextRelevance*a+s.contextRelevance*i,topicContinuity:t.topicContinuity||s.topicContinuity,environmentFit:t.environmentFit*a+s.environmentFit*i,crossTabSynergy:t.crossTabSynergy}}extractFeatures(t){const{currentTab:s,sessionStats:r,progress:o}=t;return[s==="memorization"?1:0,s==="grammar"?1:0,s==="comprehensive"?1:0,r.sessionDuration/(1e3*60*60),r.totalAttempts/50,r.currentAccuracy||(r.totalAttempts>0?r.correctAnswers/r.totalAttempts:0),o?(o.memorizationAttempts||0)/20:0,o?(o.grammarAttempts||0)/20:0,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class Ya extends oo{constructor(){super(...arguments);Ee(this,"id","gamification");Ee(this,"name","Gamification AI");Ee(this,"icon","üéÆ")}proposePosition(t,s,r){const o=s>=3?-15:0,i=r>=.8?-10:0,c=50+o+i;return Math.max(0,Math.min(100,c))}adjustPositionForInterleaving(t){var l;const s=t.filter(d=>d.position>=40),r=t.filter(d=>d.position<40);t.filter(d=>d.position>=25&&d.position<40);const o=!1;if(s.length===0)return{result:t,changed:[]};if(r.length===0)return{result:t,changed:[]};let i=0,a=0;s.length>=50?(i=.17,a=10):s.length>=20?(i=.25,a=8):s.length>=5?(i=.33,a=8):s.length>=1&&(i=.5,a=15);const c=[];if(i>0&&r.length>0){const d=Math.floor(r.length*i),h=[...r].filter(m=>m.position>=20).sort((m,g)=>g.position-m.position),f=Math.min(d,h.length);for(let m=0;m<f;m++){const g=h[m].position;h[m].position=Math.min(h[m].position+a,59);const x=((l=h[m].question)==null?void 0:l.word)||"(unknown)";c.push({word:x,before:g,after:h[m].position})}const p=t.filter(m=>{const g=(m.attempts??0)===0,x=m.position>=40;return g&&x&&m.position>=60});p.length>0;try{localStorage.setItem("debug_position_hierarchy_new",JSON.stringify({violations:p.map(m=>{var g;return{word:((g=m.question)==null?void 0:g.word)||"(unknown)",position:m.position,type:"new_exceeds_60"}}),totalNew:t.filter(m=>(m.attempts??0)===0&&m.position>=40).length,violationCount:p.length,timestamp:new Date().toISOString()}))}catch{}}return{result:t,changed:c}}boostStillLearningQuestions(t){var h;const s=t.filter(f=>f.position>=40&&f.position<70&&(f.attempts??0)>0),r=t.filter(f=>f.position>=70&&(f.attempts??0)>0),o=!1,i=r.length===0&&s.length>0;if(s.length===0)return{result:t,changed:[]};const a=[];for(const f of s){const p=f.position;let m;if(i){const x=p<50?25:p<60?15:8;m=Math.min(p+x,69),m=Math.max(m,68)}else{const x=p<50?20:p<60?10:5;m=Math.min(p+x,69),m=Math.max(m,60)}f.position=m;const g=((h=f.question)==null?void 0:h.word)||"(unknown)";a.push({word:g,before:p,after:f.position})}const c=i?68:60,l=69,d=s.filter(f=>f.position<c||f.position>l);d.length>0;try{localStorage.setItem("debug_position_hierarchy_still",JSON.stringify({mode:i?"focus":"normal",targetRange:`${c}-${l}`,violations:d.map(f=>{var p;return{word:((p=f.question)==null?void 0:p.word)||"(unknown)",position:f.position,type:f.position<c?`still_below_${c}`:`still_above_${l}`}}),totalStill:s.length,violationCount:d.length,timestamp:new Date().toISOString()})),localStorage.setItem("debug_still_learning_boost",JSON.stringify({boosted:a.length,changes:a,working:a.length>0,timestamp:new Date().toISOString()}))}catch{}return{result:t,changed:a}}interleaveByCategory(t){const r=Math.max(1,Math.round(4)),o=t.filter(f=>f.position>=40&&(f.attempts??0)>0),i=t.filter(f=>f.position>=40&&f.position<70&&(f.attempts??0)===0),a=t.filter(f=>f.position<40);if(o.length===0&&i.length===0)return t;if(i.length===0)return[...o,...a];if(o.length===0)return[...i,...a];const c=[];let l=0,d=0;for(;l<o.length||d<i.length;){const f=Math.min(r,o.length-l);for(let p=0;p<f;p++)c.push(o[l++]);d<i.length&&c.push(i[d++])}return[...c,...a]}analyzeByRules(t){const{allProgress:s,sessionStats:r}=t,o=this.calculateMotivationLevel(s,r),i=this.shouldTriggerReward(s,r),a=this.determineChallengeLevel(r),c=this.generateSocialFeedback(s,r);return{aiId:"gamification",confidence:this.calculateConfidence(s),timestamp:Date.now(),motivationLevel:o,rewardTiming:i,challengeLevel:a,socialFeedback:c}}calculateMotivationLevel(t,s){let r=.5;const o=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5;o>=.8?r+=.3:o>=.6?r+=.2:o>=.4?r+=.1:r-=.2,s.consecutiveIncorrect===0&&s.totalAttempts>=5&&(r+=.2);const i=s.masteredCount||0,a=Object.keys(t).length,c=a>0?i/a:0;c>=.7?r+=.2:c>=.5&&(r+=.1);const l=s.sessionDuration/(1e3*60);return l>45?r-=.2:l>30&&(r-=.1),Math.max(0,Math.min(r,1))}shouldTriggerReward(t,s){const r=s.masteredCount||0;if(r>0&&r%10===0||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0)>=.9&&s.totalAttempts>=10)return!0;const i=new Set;return Object.values(t).forEach(a=>{if(a.lastStudied){const c=new Date(a.lastStudied).toDateString();i.add(c)}}),i.size>=7}determineChallengeLevel(t){const s=t.totalAttempts>0?t.correctAnswers/t.totalAttempts:.5;return s>=.85?"hard":s>=.6?"medium":"easy"}generateSocialFeedback(t,s){const r=s.masteredCount||0,o=s.totalAttempts,i=o>0?s.correctAnswers/o:0;if(r>=100)return"üéâ 100Ë™û‰ª•‰∏ä„Éû„Çπ„Çø„ÉºÔºÅËã±Ë™ûÂ≠¶Áøí„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö„ÅØÂäõ„Å™„Çä";if(r>=50)return"üåü 50Ë™û„Éû„Çπ„Çø„ÉºÈÅîÊàêÔºÅÁùÄÂÆü„Å´ÊàêÈï∑‰∏≠ÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁõÆÊ®ôÈÅîÊàê";if(r>=10)return"üìö 10Ë™û„Éû„Çπ„Çø„ÉºÔºÅ„Ç≥„ÉÑ„Ç≥„ÉÑÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÂàùÂøÉËÄÖ";if(i>=.9&&o>=10)return"üíØ Ê≠£Á≠îÁéá90%‰ª•‰∏äÔºÅË™øÂ≠ê„Åå„ÅÑ„ÅÑ„Åß„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Â•ΩË™ø";const a=this.calculateStudyDays(t);return a>=30?"üî• 30Êó•ÈÄ£Á∂öÂ≠¶ÁøíÈÅîÊàêÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁøíÊÖ£Âåñ":a>=7?"‚ú® 1ÈÄ±ÈñìÈÄ£Á∂öÂ≠¶ÁøíÔºÅÁøíÊÖ£Âåñ„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö‰∏≠":""}calculateStudyDays(t){const s=new Set;return Object.values(t).forEach(r=>{if(r.lastStudied){const o=new Date(r.lastStudied).toDateString();s.add(o)}}),s.size}calculateConfidence(t){const s=Object.keys(t).length,r=this.calculateStudyDays(t);let o=.3;return s>=50?o+=.3:s>=20&&(o+=.2),r>=7?o+=.4:r>=3&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="gamification"||t.confidence<0||t.confidence>1||t.motivationLevel<0||t.motivationLevel>1||typeof t.rewardTiming!="boolean"||typeof t.socialFeedback!="string"||!["easy","medium","hard"].includes(t.challengeLevel))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[1];let i;return o<.33?i="easy":o<.67?i="medium":i="hard",{aiId:"gamification",confidence:r.confidence,timestamp:Date.now(),motivationLevel:r.values[0],rewardTiming:r.values[2]>.5,challengeLevel:i,socialFeedback:""}}mergeSignals(t,s,r){Object.keys(r.allProgress).length;const o=this.calculateStudyDays(r.allProgress),i=Math.min(Math.max((o-3)/10,0),.6),a=1-i;return{aiId:"gamification",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),motivationLevel:t.motivationLevel*a+s.motivationLevel*i,rewardTiming:t.rewardTiming||s.rewardTiming,challengeLevel:o>7?s.challengeLevel:t.challengeLevel,socialFeedback:t.socialFeedback}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=this.calculateStudyDays(r),a=s.masteredCount||0;return[s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,s.consecutiveIncorrect/5,s.sessionDuration/(1e3*60*60),s.totalAttempts/50,o/100,i/30,a/o||0,s.questionsAnswered||s.totalAttempts/50,new Date().getHours()/24]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class jQ{constructor(e={}){Ee(this,"memoryAI");Ee(this,"cognitiveLoadAI");Ee(this,"errorPredictionAI");Ee(this,"learningStyleAI");Ee(this,"linguisticAI");Ee(this,"contextualAI");Ee(this,"gamificationAI");Ee(this,"config");this.memoryAI=new $I,this.cognitiveLoadAI=new TI,this.errorPredictionAI=new AI,this.learningStyleAI=new EI,this.linguisticAI=new RI,this.contextualAI=new DI,this.gamificationAI=new Ya,this.config={...nf,...e,weights:{...nf.weights,...e.weights||{}},emergencyThresholds:{...nf.emergencyThresholds,...e.emergencyThresholds||{}}},this.initializeMLModels().catch(t=>{console.warn("[AICoordinator] ML initialization failed, using rules only",t)}),this.checkAndEnableML()}checkAndEnableML(){try{this.enableML()}catch(e){console.warn("[AICoordinator] Failed to check ML setting",e)}}enableML(){var e,t,s,r,o,i,a,c,l,d,h,f,p,m;try{(t=(e=this.memoryAI).enableML)==null||t.call(e),(r=(s=this.cognitiveLoadAI).enableML)==null||r.call(s),(i=(o=this.errorPredictionAI).enableML)==null||i.call(o),(c=(a=this.learningStyleAI).enableML)==null||c.call(a),(d=(l=this.linguisticAI).enableML)==null||d.call(l),(f=(h=this.contextualAI).enableML)==null||f.call(h),(m=(p=this.gamificationAI).enableML)==null||m.call(p),console.log("‚úÖ [AICoordinator] ML enabled for all specialists")}catch(g){console.warn("[AICoordinator] Failed to enable ML",g)}}async initializeMLModels(){var e,t,s,r,o,i,a,c,l,d,h,f,p,m;try{await Promise.all([(t=(e=this.memoryAI).initializeML)==null?void 0:t.call(e),(r=(s=this.cognitiveLoadAI).initializeML)==null?void 0:r.call(s),(i=(o=this.errorPredictionAI).initializeML)==null?void 0:i.call(o),(c=(a=this.learningStyleAI).initializeML)==null?void 0:c.call(a),(d=(l=this.linguisticAI).initializeML)==null?void 0:d.call(l),(f=(h=this.contextualAI).initializeML)==null?void 0:f.call(h),(m=(p=this.gamificationAI).initializeML)==null?void 0:m.call(p)]),console.log("‚úÖ [AICoordinator] ML models initialized")}catch(g){console.warn("‚ö†Ô∏è [AICoordinator] ML initialization partial failure",g)}}async learn(e,t){var s,r,o,i,a,c,l,d,h,f,p,m,g,x;try{await Promise.all([(r=(s=this.memoryAI).learn)==null?void 0:r.call(s,e,t),(i=(o=this.cognitiveLoadAI).learn)==null?void 0:i.call(o,e,t),(c=(a=this.errorPredictionAI).learn)==null?void 0:c.call(a,e,t),(d=(l=this.learningStyleAI).learn)==null?void 0:d.call(l,e,t),(f=(h=this.linguisticAI).learn)==null?void 0:f.call(h,e,t),(m=(p=this.contextualAI).learn)==null?void 0:m.call(p,e,t),(x=(g=this.gamificationAI).learn)==null?void 0:x.call(g,e,t)]),this.config.debugMode&&console.log("‚úÖ [AICoordinator] learn() completed",{word:e.word,outcome:t})}catch(y){console.warn("‚ö†Ô∏è [AICoordinator] learn() partial failure",y)}}async analyzeAndCoordinate(e,t){const[s,r,o,i,a,c,l]=await Promise.all([Promise.resolve(this.memoryAI.analyze(e)),Promise.resolve(this.cognitiveLoadAI.analyze(e)),Promise.resolve(this.errorPredictionAI.analyze(e)),Promise.resolve(this.learningStyleAI.analyze(e)),Promise.resolve(this.linguisticAI.analyze(e)),Promise.resolve(this.contextualAI.analyze(e)),Promise.resolve(this.gamificationAI.analyze(e))]);this.memoryAI.validateSignal(s)||console.warn("‚ùå Invalid MemorySignal"),this.cognitiveLoadAI.validateSignal(r)||console.warn("‚ùå Invalid CognitiveLoadSignal");const d=this.checkEmergencyConditions(s,r,e.sessionStats),h=this.calculateFinalPriority(t,s,r,o,i,a,c,l),f=this.generateRecommendedAction(s,r,l),p=this.config.debugMode?this.generateDebugInfo(t,h,s,r,o):void 0;return{finalPriority:d?.1:h,signals:{memory:s,cognitiveLoad:r,errorPrediction:o,learningStyle:i,linguistic:a,contextual:c,gamification:l},urgentFlag:d,recommendedAction:f,debug:p}}checkEmergencyConditions(e,t,s){return!!(e.forgettingRisk>=this.config.emergencyThresholds.forgettingRisk||this.config.emergencyThresholds.cognitiveOverload&&t.loadLevel==="overload"||s.consecutiveIncorrect>=this.config.emergencyThresholds.consecutiveErrors)}calculateFinalPriority(e,t,s,r,o,i,a,c){let l=e;return l*=1-t.timeBoost*this.config.weights.memory,l*=1+s.difficultyAdjustment*this.config.weights.cognitiveLoad,r.weaknessAreas.length>0&&(l*=1-r.patternConfidence*.3*this.config.weights.errorPrediction),l*=1+i.inherentDifficulty*.2*this.config.weights.linguistic,l*=1-(a.contextRelevance-.5)*.3*this.config.weights.contextual,c.motivationLevel<.3&&(l*=1-.2*this.config.weights.gamification),Math.max(.1,Math.min(l,10))}generateRecommendedAction(e,t,s){if(t.recommendedBreak)return"‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ5-10ÂàÜ„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";if(s.rewardTiming)return`üéâ ${s.socialFeedback}`;if(e.forgettingRisk>=100)return"Âæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇË®òÊÜ∂„ÅåËñÑ„Çå„ÇãÂâç„Å´Á¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}generateDebugInfo(e,t,s,r,o){const i={timeBoost:-s.timeBoost*this.config.weights.memory,difficultyAdjustment:r.difficultyAdjustment*this.config.weights.cognitiveLoad,weaknessPenalty:o.weaknessAreas.length>0?-o.patternConfidence*.3*this.config.weights.errorPrediction:0},a=`
      Base Priority: ${e.toFixed(2)}
      Time Boost: ${(i.timeBoost*100).toFixed(1)}%
      Difficulty Adjustment: ${(i.difficultyAdjustment*100).toFixed(1)}%
      Weakness Penalty: ${(i.weaknessPenalty*100).toFixed(1)}%
      Final Priority: ${t.toFixed(2)}
    `.trim();return{basePriority:e,adjustments:i,reasoning:a}}logCoordinationResult(e){}updateConfig(e){this.config={...this.config,...e,weights:{...this.config.weights,...e.weights||{}},emergencyThresholds:{...this.config.emergencyThresholds,...e.emergencyThresholds||{}}}}getConfig(){return{...this.config}}}const MQ=[{prefix:"un-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["unhappy","unable","unfair"]},{prefix:"re-",meaning:"ÂÜç„Å≥„ÉªÂÖÉ„Å´",examples:["return","rebuild","review"]},{prefix:"dis-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["disagree","dislike","disappear"]},{prefix:"in-/im-",meaning:"Âê¶ÂÆö",examples:["impossible","inactive","impolite"]},{prefix:"pre-",meaning:"Ââç„Å´",examples:["preview","predict","prepare"]},{prefix:"post-",meaning:"Âæå„Å´",examples:["postwar","postpone","postgraduate"]},{prefix:"mis-",meaning:"Ë™§„Å£„Å¶",examples:["mistake","misunderstand","mislead"]},{prefix:"over-",meaning:"ÈÅéÂ∫¶„Å´",examples:["overwork","overlook","overcome"]},{prefix:"under-",meaning:"‰∏çË∂≥„Éª‰∏ã„Å´",examples:["understand","underground","underline"]},{prefix:"sub-",meaning:"‰∏ã„Å´„ÉªÂâØ„ÅÆ",examples:["subway","submarine","subtitle"]}],_I=[{suffix:"-tion/-sion",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁä∂ÊÖã",examples:["action","decision","confusion"]},{suffix:"-ment",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁµêÊûú",examples:["development","movement","agreement"]},{suffix:"-ness",pos:"noun",meaning:"ÊÄßË≥™„ÉªÁä∂ÊÖã",examples:["happiness","kindness","darkness"]},{suffix:"-ly",pos:"adverb",meaning:"ÊßòÊÖã",examples:["quickly","slowly","carefully"]},{suffix:"-ful",pos:"adjective",meaning:"ÔΩû„Å´Ê∫Ä„Å°„Åü",examples:["beautiful","careful","wonderful"]},{suffix:"-less",pos:"adjective",meaning:"ÔΩû„ÅÆ„Å™„ÅÑ",examples:["hopeless","careless","endless"]},{suffix:"-able/-ible",pos:"adjective",meaning:"ÔΩû„Åß„Åç„Çã",examples:["readable","possible","comfortable"]},{suffix:"-er/-or",pos:"noun",meaning:"‰∫∫„Éª„ÇÇ„ÅÆ",examples:["teacher","actor","writer"]},{suffix:"-ist",pos:"noun",meaning:"ÔΩû„Åô„Çã‰∫∫",examples:["artist","scientist","pianist"]},{suffix:"-ize",pos:"verb",meaning:"ÔΩûÂåñ„Åô„Çã",examples:["realize","organize","modernize"]},{suffix:"-ing",pos:"noun/adjective",meaning:"ÂãïÂêçË©û„ÉªÁèæÂú®ÂàÜË©û",examples:["running","interesting","learning"]},{suffix:"-ed",pos:"adjective",meaning:"ÈÅéÂéªÂàÜË©û„ÉªÂΩ¢ÂÆπË©û",examples:["tired","excited","surprised"]}],FQ=[{root:"act",meaning:"Ë°åÂãï",words:["action","react","actor","activity","actual"]},{root:"struct",meaning:"Âª∫„Å¶„Çã",words:["structure","construct","destruction","instruct"]},{root:"dict",meaning:"Ë®Ä„ÅÜ",words:["dictionary","predict","contradict","dictate"]},{root:"port",meaning:"ÈÅã„Å∂",words:["transport","import","export","portable","report"]},{root:"duct",meaning:"Â∞é„Åè",words:["conduct","produce","reduce","introduce"]},{root:"scrib/script",meaning:"Êõ∏„Åè",words:["describe","script","prescription","manuscript"]},{root:"spect",meaning:"Ë¶ã„Çã",words:["inspect","respect","expect","spectator"]},{root:"form",meaning:"ÂΩ¢",words:["reform","inform","transform","uniform"]},{root:"ject",meaning:"Êäï„Åí„Çã",words:["project","reject","subject","object"]},{root:"miss/mit",meaning:"ÈÄÅ„Çã",words:["mission","permit","submit","transmit"]}];function OQ(n){const e=n.toLowerCase();return["in the","at the","on the","to the","for the","with the","by the"].some(r=>e.startsWith(r))?"preposition_phrase":["take a","make a","have a","get a","give a","do a"].some(r=>e.startsWith(r))?"verb_phrase":n.includes(" ")?"idiom":"none"}function PI(n){const e=n.toLowerCase();for(const{prefix:t}of MQ){const s=t.replace(/-/g,""),r=[s];(s==="in"||s==="im")&&r.push("in","im","il","ir");for(const o of r)if(e.startsWith(o)&&n.length>o.length+2)return o}}function jI(n){const e=n.toLowerCase();for(const{suffix:t}of _I){const s=t.split("/")[0].replace(/-/g,"");if(e.endsWith(s)&&n.length>s.length+2)return s}}function LQ(n){const e=n.toLowerCase();for(const{root:o,words:i}of FQ)if(i.some(a=>a===e)||e.includes(o))return o;let t=e;const s=PI(n);s&&(t=t.substring(s.length));const r=jI(n);if(r&&(t=t.substring(0,t.length-r.length)),!(t.length<3))return t!==e?t:void 0}function zQ(n,e){const t=n.toLowerCase();if(n.includes(" "))return"phrase";for(const{suffix:s,pos:r}of _I){const o=s.split("/")[0].replace(/-/g,"");if(t.endsWith(o))return r.split("/")[0]}if(e){if(e.includes("„Åô„Çã")||e.includes("„Åï„Çå„Çã"))return"verb";if(e.includes("ÁöÑ„Å™")||e.includes("„ÅÑÔºàÂΩ¢ÂÆπË©ûË™ûÂ∞æÔºâ"))return"adjective";if(e.includes("„Å´")||e.includes("„ÅßÔºàÂâØË©ûÔºâ"))return"adverb"}return"other"}function WQ(n,e){const t=PI(n),s=jI(n),r=LQ(n),o=t||s||r?{prefix:t,suffix:s,root:r}:void 0,i=zQ(n,e),a=OQ(n);return{word:n,family:o,pos:i,phrasePattern:a!=="none"?a:void 0}}class BQ{constructor(){Ee(this,"cache",new Map);Ee(this,"ttl",24*60*60*1e3)}getMetadata(e,t){const s=this.getCacheKey(e,t),r=this.cache.get(s);if(r&&Date.now()-r.timestamp<this.ttl)return r.metadata;const o=WQ(e,t);return this.cache.set(s,{word:e,metadata:o,timestamp:Date.now()}),o}getMetadataFromQuestion(e){return this.getMetadata(e.word,e.meaning)}getBulkMetadata(e){const t=new Map;return e.forEach(s=>{t.set(s,this.getMetadata(s))}),t}getBulkMetadataFromQuestions(e){const t=new Map;return e.forEach(s=>{t.set(s.word,this.getMetadataFromQuestion(s))}),t}clear(){this.cache.clear()}purgeExpired(){const e=Date.now();let t=0;for(const[s,r]of this.cache.entries())e-r.timestamp>=this.ttl&&(this.cache.delete(s),t++);return t}getStats(){const e=Date.now();let t=0,s=1/0;for(const r of this.cache.values()){const o=e-r.timestamp;o>t&&(t=o),o<s&&(s=o)}return{size:this.cache.size,ttl:this.ttl,oldestEntryAge:t,newestEntryAge:s===1/0?0:s}}getCacheKey(e,t){return t?`${e}::${t}`:e}setTTL(e){this.ttl=e}}const MI=new BQ;function Uy(n,e){return MI.getMetadata(n,e)}function Gy(n){return MI.getMetadataFromQuestion(n)}const FI={emotions:{name:"ÊÑüÊÉÖ",keywords:["happy","sad","angry","excited","worried","nervous","calm","joy","fear","love","hate","surprise"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},movement:{name:"Âãï‰Ωú„ÉªÁßªÂãï",keywords:["walk","run","jump","fly","swim","climb","move","go","come","enter","leave","return"],relatedCategories:["ÂãïË©û"]},time:{name:"ÊôÇÈñì",keywords:["day","night","morning","evening","week","month","year","today","tomorrow","yesterday","always","never","sometimes"],relatedCategories:["ÂêçË©û","ÂâØË©û"]},weather:{name:"Â§©Ê∞ó",keywords:["sunny","rainy","cloudy","windy","snowy","hot","cold","warm","cool","weather","temperature"],relatedCategories:["ÂΩ¢ÂÆπË©û","ÂêçË©û"]},food:{name:"È£ü„ÅπÁâ©",keywords:["food","eat","drink","cook","meal","breakfast","lunch","dinner","hungry","thirsty","delicious"],relatedCategories:["ÂêçË©û","ÂãïË©û","ÂΩ¢ÂÆπË©û"]},nature:{name:"Ëá™ÁÑ∂",keywords:["tree","flower","mountain","river","sea","sky","sun","moon","star","nature","plant","animal"],relatedCategories:["ÂêçË©û"]},family:{name:"ÂÆ∂Êóè„Éª‰∫∫ÈñìÈñ¢‰øÇ",keywords:["family","father","mother","brother","sister","parent","child","friend","teacher","student"],relatedCategories:["ÂêçË©û"]},size:{name:"Â§ß„Åç„Åï„ÉªÁ®ãÂ∫¶",keywords:["big","small","large","tiny","huge","long","short","tall","high","low","wide","narrow"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},communication:{name:"„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥",keywords:["say","speak","talk","tell","ask","answer","listen","hear","write","read","call","email"],relatedCategories:["ÂãïË©û"]},learning:{name:"Â≠¶Áøí",keywords:["learn","study","teach","understand","know","remember","forget","practice","improve","test","exam"],relatedCategories:["ÂãïË©û","ÂêçË©û"]}},OI=[["big","small"],["large","small"],["long","short"],["tall","short"],["high","low"],["wide","narrow"],["deep","shallow"],["heavy","light"],["strong","weak"],["hard","soft"],["hot","cold"],["warm","cool"],["fast","slow"],["quick","slow"],["early","late"],["young","old"],["new","old"],["happy","sad"],["good","bad"],["right","wrong"],["easy","difficult"],["simple","complex"],["start","end"],["begin","finish"],["open","close"],["love","hate"],["day","night"],["morning","evening"],["always","never"],["often","rarely"],["many","few"],["much","little"],["more","less"],["increase","decrease"],["rise","fall"],["up","down"],["front","back"],["before","after"],["first","last"],["enter","leave"],["come","go"],["push","pull"],["give","take"],["buy","sell"],["win","lose"],["remember","forget"],["find","lose"]],LI=[["big","large","huge","enormous"],["small","little","tiny"],["happy","glad","joyful","pleased"],["sad","unhappy","sorrowful"],["angry","mad","furious"],["beautiful","pretty","lovely"],["ugly","unattractive"],["important","significant","essential"],["difficult","hard","tough","challenging"],["easy","simple"],["fast","quick","rapid","swift"],["slow","sluggish"],["smart","intelligent","clever","bright"],["stupid","foolish","dumb"],["funny","amusing","humorous"],["boring","dull","tedious"],["interesting","fascinating","engaging"],["tired","exhausted","weary"],["afraid","scared","frightened","terrified"],["brave","courageous","bold"],["kind","nice","gentle","friendly"],["mean","cruel","unkind"],["rich","wealthy","affluent"],["poor","needy"],["famous","well-known","renowned"],["strange","odd","weird","unusual"],["normal","ordinary","common","typical"]];function VQ(n,e){const t=[],s=new Set;Object.entries(FI).forEach(([o,i])=>{const a=n.filter(c=>{const l=c.word.toLowerCase(),d=c.meaning.toLowerCase();return i.keywords.some(h=>l.includes(h)||d.includes(h))&&!s.has(c.word)}).map(c=>c.word);if(a.length>=2){a.forEach(d=>s.add(d));const l=50+a.filter(d=>{const h=e[d];return h&&h.incorrectCount>h.correctCount}).length/a.length*50;t.push({id:`theme_${o}`,name:i.name,theme:o,words:a,relationType:"theme",priority:l})}}),OI.forEach((o,i)=>{const[a,c]=o,l=n.filter(d=>{const h=d.word.toLowerCase();return(h===a||h===c)&&!s.has(d.word)}).map(d=>d.word);l.length===2&&(l.forEach(d=>s.add(d)),t.push({id:`antonym_${i}`,name:`ÂØæÁæ©Ë™û: ${a} ‚áî ${c}`,theme:"antonyms",words:l,relationType:"antonym",priority:70}))}),LI.forEach((o,i)=>{const a=n.filter(c=>{const l=c.word.toLowerCase();return o.includes(l)&&!s.has(c.word)}).map(c=>c.word);a.length>=2&&(a.forEach(c=>s.add(c)),t.push({id:`synonym_${i}`,name:`È°ûÁæ©Ë™û: ${o.join(", ")}`,theme:"synonyms",words:a,relationType:"synonym",priority:60}))});const r=new Map;return n.forEach(o=>{if(!s.has(o.word)&&o.category){const i=r.get(o.category)||[];i.push(o.word),r.set(o.category,i)}}),r.forEach((o,i)=>{o.length>=3&&(o.forEach(a=>s.add(a)),t.push({id:`category_${i}`,name:`„Ç´„ÉÜ„Ç¥„É™„Éº: ${i}`,theme:i,words:o,relationType:"category",priority:40}))}),t.sort((o,i)=>i.priority-o.priority)}function UQ(n,e,t,s){var c,l,d,h,f,p;const r=n.toLowerCase(),o=e.toLowerCase(),i=t?Gy(t):Uy(n),a=s?Gy(s):Uy(e);if((c=i.family)!=null&&c.root&&((l=a.family)!=null&&l.root)&&i.family.root===a.family.root)return{word1:n,word2:e,relationType:"word_family",strength:.95,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòË™ûÊ†πÔºà${i.family.root}Ôºâ`};if((d=i.family)!=null&&d.prefix&&((h=a.family)!=null&&h.prefix)&&i.family.prefix===a.family.prefix)return{word1:n,word2:e,relationType:"word_family",strength:.7,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•È†≠ËæûÔºà${i.family.prefix}-Ôºâ`};if((f=i.family)!=null&&f.suffix&&((p=a.family)!=null&&p.suffix)&&i.family.suffix===a.family.suffix&&i.pos===a.pos)return{word1:n,word2:e,relationType:"word_family",strength:.65,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•Â∞æËæûÔºà-${i.family.suffix}Ôºâ`};if(i.phrasePattern&&a.phrasePattern&&i.phrasePattern===a.phrasePattern&&i.phrasePattern!=="none")return{word1:n,word2:e,relationType:"collocation",strength:.75,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÁÜüË™û„Éë„Çø„Éº„É≥`};for(const m of OI)if(m[0]===r&&m[1]===o||m[0]===o&&m[1]===r)return{word1:n,word2:e,relationType:"antonym",strength:.9,description:`"${n}"„Å®"${e}"„ÅØÂØæÁæ©Ë™û`};for(const m of LI)if(m.includes(r)&&m.includes(o))return{word1:n,word2:e,relationType:"synonym",strength:.8,description:`"${n}"„Å®"${e}"„ÅØÈ°ûÁæ©Ë™û`};for(const[,m]of Object.entries(FI)){const g=m.keywords.some(y=>r.includes(y)||y.includes(r)),x=m.keywords.some(y=>o.includes(y)||y.includes(o));if(g&&x)return{word1:n,word2:e,relationType:"theme",strength:.6,description:`"${n}"„Å®"${e}"„ÅØÂêå„Åò„ÉÜ„Éº„ÉûÔºà${m.name}Ôºâ`}}return null}function zI(n,e,t=[]){const s=VQ(n,e),r=[],o=[],i=new Set;return t.forEach(a=>i.add(a)),s.forEach(a=>{const c=a.words.filter(d=>!i.has(d));if(c.length===0)return;c.sort((d,h)=>{const f=e[d],p=e[h];if(!f&&!p)return 0;if(!f)return-1;if(!p)return 1;const m=f.incorrectCount/(f.correctCount+f.incorrectCount||1);return p.incorrectCount/(p.correctCount+p.incorrectCount||1)-m}).forEach(d=>{if(i.has(d))return;const h=r[r.length-1];if(h){const f=n.find(g=>g.word===h),p=n.find(g=>g.word===d),m=UQ(h,d,f,p);o.push({from:h,to:d,reason:m?m.description:`Âêå„Åò„ÇØ„É©„Çπ„Çø„ÉºÔºà${a.name}Ôºâ`})}r.push(d),i.add(d)})}),n.forEach(a=>{i.has(a.word)||(r.push(a.word),i.add(a.word))}),{clusters:s,sequence:r,transitions:o}}function GQ(n){switch(n){case"incorrect":return!0;default:return!1}}function WI(n){switch(n){case"incorrect":case"still_learning":return!0;default:return!1}}class Hu{static startTrace(e="weak-words-flow"){return""}static startSpan(e,t,s){return""}static endSpan(e,t){}static addEvent(e,t,s){}static endTrace(){return""}static detectLostWords(e){if(e.length===0)return[];const t=[],s=new Map;for(const r of e){const o=r.attributes.weakWords||[];for(const i of o)s.set(i,{span:r.name,count:r.attributes.weakWordsCount})}if(e.length>=2){const r=new Set(e[0].attributes.weakWords||[]),o=new Set(e[e.length-1].attributes.weakWords||[]);for(const i of r)if(!o.has(i)){const a=s.get(i);a&&t.push({word:i,lastSeenSpan:a.span,lastSeenCount:a.count})}}return t}static generateSummary(e){if(!this.currentContext)return"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó";const t=Array.from(this.currentContext.spans.values()).sort((l,d)=>l.startTime-d.startTime);if(t.length===0)return"„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó";let s="";try{const l=localStorage.getItem("debug_ab_session_info");if(l){const d=JSON.parse(l);s+=`## üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±

`,s+=`**ÁèæÂú®„ÅÆVariant**: ${d.variant}
`,s+=`- **A**: ÈÄöÂ∏∏„É¢„Éº„ÉâÔºàcalculatePrioritiesÔºâ
`,s+=`- **B**: „Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„ÉâÔºàPosition‰∏ªËª∏+AIÂ∞èË£úÊ≠£Ôºâ
`,s+=`- **C**: AI‰∏ªËª∏„É¢„Éº„ÉâÔºàfinalPriorityMode„ÄÅGamificationAI„Éñ„Éº„Çπ„ÉàÔºâ

`,d.variant==="A"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant A„Åß„Åô„ÄÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„ÅØÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):d.variant==="B"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant B„Åß„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅØÈÉ®ÂàÜÁöÑ„Å´„Åó„ÅãÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):d.variant==="C"&&(s+=`‚úÖ **Ê≠£Â∏∏**: Variant C„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅåÊúâÂäπ„Åß„Åô„ÄÇ

`)}}catch{}s+=`## üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ

`,s+=`| „Çπ„Éë„É≥ | ÈñãÂßãÊôÇÂàª | ÊâÄË¶ÅÊôÇÈñì | „Åæ„Å†„Åæ„Å†Ë™û | Á∑èÂçòË™ûÊï∞ | Áä∂ÊÖã |
`,s+=`|---|---|---|---|---|---|
`;const r=30,o=t.length>r?t.slice(-r):t;t.length>r&&(s+=`> ‚ÑπÔ∏è „Çπ„Éë„É≥„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂÖ®${t.length}‰ª∂‰∏≠„ÄÅÊú´Â∞æ${r}‰ª∂„ÅÆ„ÅøË°®Á§∫„Åó„Åæ„Åô

`);let i=-1;for(const l of o){const d=l.endTime?`${(l.endTime-l.startTime).toFixed(2)}ms`:"ÂÆüË°å‰∏≠",h=new Date(Date.now()-performance.now()+l.startTime).toISOString().split("T")[1],f=l.attributes.weakWordsCount??l.attributes.weakWordsCountAfter??0,p=l.attributes.totalCount??l.attributes.totalCountAfter??0;let m="‚úÖ Ê≠£Â∏∏",g="";if(i!==-1){const x=f-i;f===0&&i>0?(m="‚ùå Ê∂àÂ§±",g=` (-${i}Ë™û)`):x<0?(m="‚ö†Ô∏è Ê∏õÂ∞ë",g=` (${x}Ë™û)`):x>0&&(m="üìà Â¢óÂä†",g=` (+${x}Ë™û)`)}i=f,s+=`| ${l.name} | ${h} | ${d} | ${f}Ë™û${g} | ${p}Ë™û | ${m} |
`}const a=t.find(l=>l.name==="MemorizationView.prepareScheduling");if(a){const l=a.attributes.weakWordsCount??0,d=a.attributes.weakWordsCountAfter??0,h=a.attributes.totalCount??0,f=a.attributes.totalCountAfter??0;if(s+=`
### üìä „Çπ„Ç±„Ç∏„É•„Éº„É´ÂâçÂæå„ÅÆÊØîËºÉ

`,s+=`**MemorizationView.prepareScheduling**:
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Ââç: ${l}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${h}Ë™û„ÅÆÂÄôË£ú
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Âæå: ${d}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${f}Ë™û„ÅÆÁµêÊûú
`,l>d){const y=l-d,b=(y/l*100).toFixed(1);s+=`- **Â§âÂåñ**: ${y}Ë™ûÊ∏õÂ∞ëÔºà${b}%Ê∂àÂ§±Ôºâ ‚ö†Ô∏è
`}else if(l<d){const y=d-l;s+=`- **Â§âÂåñ**: ${y}Ë™ûÂ¢óÂä† üìà
`}else s+=`- **Â§âÂåñ**: Â§âÂåñ„Å™„Åó ‚úÖ
`;const p=new Set(a.attributes.weakWords||[]),m=new Set(a.attributes.weakWordsAfter||[]),g=[...p].filter(y=>!m.has(y)),x=[...m].filter(y=>!p.has(y));g.length>0&&(s+=`
**Ê∂àÂ§±„Åó„ÅüÂçòË™ûÔºà${g.length}Ë™ûÔºâ**:
`,s+=`- ${g.slice(0,10).join(", ")}`,g.length>10&&(s+=` (+${g.length-10}Ë™û)`),s+=`
`),x.length>0&&(s+=`
**Êñ∞„Åü„Å´ËøΩÂä†„Åï„Çå„ÅüÂçòË™ûÔºà${x.length}Ë™ûÔºâ**:
`,s+=`- ${x.slice(0,10).join(", ")}`,x.length>10&&(s+=` (+${x.length-10}Ë™û)`),s+=`
`)}const c=this.detectLostWords(t);c.length>0?(s+=`
### ‚ùå Ê∂àÂ§±„Åó„ÅüÂçòË™û

`,c.slice(0,10).forEach(l=>{s+=`- **${l.word}**: ÊúÄÂæå„Å´Á¢∫Ë™ç ‚Üí ${l.lastSeenSpan}
`}),c.length>10&&(s+=`
_...‰ªñ${c.length-10}Ë™û_
`)):s+=`
### ‚úÖ Ê∂àÂ§±„Åó„ÅüÂçòË™û„Å™„Åó

`,s+=`
### üìä „Çπ„Éë„É≥„Åî„Å®„ÅÆÂçòË™û„É™„Çπ„ÉàÂ§âÂåñ

`;for(const l of t){const d=l.attributes.weakWords||[];if(d.length>0){const h=d.slice(0,5).join(", "),f=d.length>5?` (+${d.length-5}Ë™û)`:"";s+=`- **${l.name}**: ${d.length}Ë™û ‚Üí [${h}${f}]
`}else s+=`- **${l.name}**: 0Ë™û
`}if(c.length>0){s+=`
### üîç Ê∂àÂ§±„ÅÆË©≥Á¥∞ÂàÜÊûê

`,s+=`**Á∑èÊ∂àÂ§±Êï∞**: ${c.length}Ë™û

`;for(let l=0;l<t.length-1;l++){const d=new Set(t[l].attributes.weakWords||t[l].attributes.weakWordsAfter||[]),h=new Set(t[l+1].attributes.weakWords||[]),f=[...d].filter(m=>!h.has(m)),p=[...h].filter(m=>!d.has(m));if(f.length>0||p.length>0){const m=d.size,g=h.size,x=g-m,y=m>0?(Math.abs(x)/m*100).toFixed(1):"0.0";s+=`
**${t[l].name} ‚Üí ${t[l+1].name}**:
`,s+=`- ÂçòË™ûÊï∞Â§âÂåñ: ${m}Ë™û ‚Üí ${g}Ë™û`,x<0?s+=` (${x}Ë™û„ÄÅ-${y}%) ‚ö†Ô∏è`:x>0&&(s+=` (+${x}Ë™û„ÄÅ+${y}%) üìà`),s+=`
`,f.length>0&&(s+=`- Ê∂àÂ§±Ôºà${f.length}Ë™ûÔºâ: ${f.slice(0,5).join(", ")}`,f.length>5&&(s+=` (+${f.length-5}Ë™û)`),s+=`
`),p.length>0&&(s+=`- ËøΩÂä†Ôºà${p.length}Ë™ûÔºâ: ${p.slice(0,5).join(", ")}`,p.length>5&&(s+=` (+${p.length-5}Ë™û)`),s+=`
`)}}}try{const l=lu("debug_finalPriority_output",{mode:e}).raw,d=lu("debug_finalPriority_sessionStats",{mode:e}).raw;if(l&&d){const h=JSON.parse(l),f=JSON.parse(d);s+=`
### üß† finalPriority„É¢„Éº„ÉâÔºàAI‰∏ªËª∏Ôºâ„ÅÆË©≥Á¥∞

`,s+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊÉÖÂ†±**:
`,s+=`- „Çø„Éñ: ${f.currentTab}
`,s+=`- Á∑èÂïèÈ°åÊï∞: ${f.totalQuestions}Âïè
`,s+=`- ÈÄ≤Êçó„Éá„Éº„Çø: ${f.allProgressCount}Ë™û
`,s+=`- „Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${f.timestamp}

`,s+=`**TOP10„ÅÆÂïèÈ°åÔºàfinalPriorityÈôçÈ†ÜÔºâ**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | finalPriority | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|---|
`,h.slice(0,10).forEach(m=>{const g=m.position>=70?"üî¥":m.position>=40?"üü°":m.position>=20?"‚ö™":"‚úÖ";s+=`| ${m.rank} | **${m.word}** | ${m.position} ${g} | ${m.finalPriority.toFixed(3)} | ${m.category||"-"} | ${m.attempts}Âõû |
`});const p=h.filter(m=>m.position>=40&&m.attempts>0);s+=`
**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞**:
`,s+=`- TOP10„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${p.slice(0,10).length}Ë™û
`,s+=`- TOP30„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${p.length}Ë™û
`,p.length>0?(s+=`
**„Åæ„Å†„Åæ„Å†Ë™ûTOP5**:
`,p.slice(0,5).forEach(m=>{s+=`- **${m.word}** („É©„É≥„ÇØ${m.rank}, Position ${m.position}, finalPriority ${m.finalPriority.toFixed(3)})
`})):(s+=`
‚ö†Ô∏è **Ë≠¶Âëä**: TOP30„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,s+=`‚Üí GamificationAI„ÅÆ„Éñ„Éº„Çπ„ÉàÂá¶ÁêÜ„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`)}else s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì

`,s+=`finalPriorityMode„Åå‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÄÅ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`}catch(l){s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${l}
`}try{const l=lu("debug_postProcess_output",{mode:e}).raw,d=localStorage.getItem("debug_sortAndBalance_output");if(l||d){if(s+=`
### üîç sortAndBalance ‚Üí postProcess „ÅÆÈ†ÜÂ∫èÊ§úË®º

`,d){const h=JSON.parse(d);s+=`**sortAndBalanceÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|
`,h.slice(0,10).forEach((p,m)=>{const g=p.position>=70?"üî¥":p.position>=60?"üü°":p.position>=40?"üîµ":p.position>=20?"‚ö™":"‚úÖ";s+=`| ${m+1} | **${p.word}** | ${p.position} ${g} | ${p.category||"-"} | ${p.attempts}Âõû |
`});const f={incorrect:h.filter(p=>p.position>=70).length,stillLearning:h.filter(p=>p.position>=60&&p.position<70&&p.attempts>0).length,newBoosted:h.filter(p=>p.position>=40&&p.position<60&&p.attempts===0).length,newNormal:h.filter(p=>p.position>=20&&p.position<40).length,mastered:h.filter(p=>p.position<20).length};s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${f.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å† (Position 60-69, attempts>0): ${f.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà (Position 40-59, attempts=0): ${f.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏ (Position 20-39): ${f.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à (Position <20): ${f.mastered}Ë™û

`}if(l){const h=JSON.parse(l),p=(Array.isArray(h)?h:Array.isArray(h==null?void 0:h.top30)?h.top30:[]).slice(0,30).map((g,x)=>({rank:Number(g==null?void 0:g.rank)||x+1,word:String((g==null?void 0:g.word)??""),position:Number((g==null?void 0:g.position)??0),attempts:Number((g==null?void 0:g.attempts)??0)})),m={incorrect:p.filter(g=>g.position>=70).length,stillLearning:p.filter(g=>g.position>=60&&g.position<70&&g.attempts>0).length,newBoosted:p.filter(g=>g.position>=40&&g.position<60&&g.attempts===0).length,newNormal:p.filter(g=>g.position>=20&&g.position<40).length,mastered:p.filter(g=>g.position<20).length};if(s+=`**postProcessÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | Áä∂ÊÖã |
`,s+=`|---|---|---|---|
`,p.slice(0,10).forEach(g=>{const x=g.position>=70?"üî¥":g.position>=60?"üü°":g.position>=40?"üîµ":g.position>=20?"‚ö™":"‚úÖ",y=g.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":g.position>=60?"„Åæ„Å†„Åæ„Å†":g.position>=40?"Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà":g.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";s+=`| ${g.rank} | **${g.word}** | ${g.position} ${x} | ${y} |
`}),s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${m.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å†: ${m.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà: ${m.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏: ${m.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à: ${m.mastered}Ë™û

`,d){const x=JSON.parse(d).slice(0,10).map(v=>v.word),y=p.slice(0,10).map(v=>v.word);x.some((v,w)=>v!==y[w])?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`,s+=`‚Üí postProcess()„ÅÆÈñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„ÅåPositionÈöéÂ±§„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

`):s+=`‚úÖ **È†ÜÂ∫è‰øùÊåÅ**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

`}}else s+=`‚ö†Ô∏è postProcessÂæå„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
`}}catch(l){s+=`
### ‚ö†Ô∏è postProcessÊÉÖÂ†±„ÅÆË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${l}
`}return s}static saveContext(){if(this.currentContext)try{const e={traceId:this.currentContext.traceId,spans:Array.from(this.currentContext.spans.entries()),activeSpanId:this.currentContext.activeSpanId};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch{}}static restoreContext(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return this.currentContext={traceId:t.traceId,spans:new Map(t.spans),activeSpanId:t.activeSpanId},this.currentContext}catch{return null}}static clearTrace(){this.currentContext=null;try{localStorage.removeItem(this.STORAGE_KEY)}catch{}}}Ee(Hu,"STORAGE_KEY","debug_trace_context"),Ee(Hu,"currentContext",null);const BI="learning-efficiency-",HQ=`${BI}profile`,VI=`${BI}word-relations`;function qQ(){try{const n=localStorage.getItem(HQ);if(!n)return null;const e=JSON.parse(n);return E.info("[LearningEfficiency] „Éó„É≠„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÊàêÂäü",{score:e.overallMetrics.efficiencyScore,categories:e.categoryEfficiencies.length,historyCount:e.recentHistory.length}),e}catch(n){return E.error("[LearningEfficiency] „Éó„É≠„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº",n),null}}function UI(n){try{localStorage.setItem(VI,JSON.stringify(n)),E.info("[LearningEfficiency] Èñ¢ÈÄ£Ë™û„Éá„Éº„Çø‰øùÂ≠òÂÆå‰∫Ü",{count:n.length})}catch(e){E.error("[LearningEfficiency] Èñ¢ÈÄ£Ë™û„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº",e)}}function v0(){try{const n=localStorage.getItem(VI);return n?JSON.parse(n):[]}catch(n){return E.error("[LearningEfficiency] Èñ¢ÈÄ£Ë™û„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº",n),[]}}const GI=30,KQ=12,QQ=45,XQ=18,JQ=40,Hy=8,qy=.2,hu=7,YQ=1,ZQ=2,eX=-1,eu=.12;let Un=null,Co=null,Zn=null,Sf=!1,Cf=!1,fu=!1,qu=0;const HI="debug_vocabulary_network_perf",tX=50;function Ku(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function Nf(){return{updatedAt:Date.now(),counters:{lookupBuildCount:0,lookupHitCount:0,answerUpdateCount:0,answerUpdateTotalMs:0,answerUpdateMaxMs:0,schedulerReorderCount:0,schedulerReorderTotalMs:0,schedulerReorderMaxMs:0},history:[]}}function nX(){try{const n=localStorage.getItem(HI);if(!n)return Nf();const e=JSON.parse(n);return!(e!=null&&e.counters)||!Array.isArray(e==null?void 0:e.history)?Nf():e}catch{return Nf()}}function sX(n){try{for(n.updatedAt=Date.now();n.history.length>tX;)n.history.shift();localStorage.setItem(HI,JSON.stringify(n))}catch{}}function Wh(n,e,t){const s=nX();n==="lookup_build"&&(s.counters.lookupBuildCount+=1),n==="lookup_hit"&&(s.counters.lookupHitCount+=1),n==="answer_update"&&(s.counters.answerUpdateCount+=1,typeof e=="number"&&Number.isFinite(e)&&(s.counters.answerUpdateTotalMs+=e,s.counters.answerUpdateMaxMs=Math.max(s.counters.answerUpdateMaxMs,e))),n==="scheduler_reorder"&&(s.counters.schedulerReorderCount+=1,typeof e=="number"&&Number.isFinite(e)&&(s.counters.schedulerReorderTotalMs+=e,s.counters.schedulerReorderMaxMs=Math.max(s.counters.schedulerReorderMaxMs,e))),s.history.push({at:Date.now(),event:n,ms:e,meta:t}),sX(s)}function rX(n){Wh("scheduler_reorder",n.ms,n)}function oX(n){if(typeof n.relatedFields!="string")return["„Åù„ÅÆ‰ªñ"];const e=n.relatedFields.split(",").map(t=>t.trim()).filter(Boolean);return e.length>0?e:["„Åù„ÅÆ‰ªñ"]}function tu(n,e,t,s){if(e===t)return;n.has(e)||n.set(e,new Map);const r=n.get(e),o=r.get(t);(!o||s.strength>o.strength)&&r.set(t,s)}function qI(n,e){const t=GI,s=KQ,r=new Map,o=new Map,i=new Map,a=new Map,c=n.map(p=>p.word);for(const p of n){const m=p.word;for(const b of oX(p))r.has(b)||r.set(b,[]),r.get(b).push(m);const g=m.toLowerCase(),x=["un","re","dis","pre","post","anti","de"];for(const b of x)g.startsWith(b)&&g.length>b.length+2&&(o.has(b)||o.set(b,[]),o.get(b).push(m));const y=["ing","ed","er","tion","ness","ly","ful","less"];for(const b of y)g.endsWith(b)&&g.length>b.length+2&&(i.has(b)||i.set(b,[]),i.get(b).push(m));if(g.length>=4){const b=g.slice(0,4);a.has(b)||a.set(b,[]),a.get(b).push(m)}}const l=new Map;for(const[,p]of r)for(let m=0;m<p.length;m++){const g=p[m];for(let x=m+1;x<Math.min(p.length,m+1+s);x++){const y=p[x],b={relatedWord:y,relationType:"category",strength:70};tu(l,g,y,b),tu(l,y,g,{...b,relatedWord:g})}}const d=(p,m,g)=>{for(let x=0;x<p.length;x++){const y=p[x];for(let b=x+1;b<Math.min(p.length,x+1+s);b++){const v=p[b],w={relatedWord:v,relationType:g,strength:m};tu(l,y,v,w),tu(l,v,y,{...w,relatedWord:y})}}};for(const[,p]of o)d(p,60,"derivation");for(const[,p]of i)d(p,55,"derivation");for(const[,p]of a)p.length>=4&&d(p,65,"derivation");const h=Date.now();return c.map(p=>{var g;const m=Array.from(((g=l.get(p))==null?void 0:g.values())??[]);return m.sort((x,y)=>y.strength-x.strength),{word:p,relations:m.slice(0,t),updatedAt:h}})}function KI(n){const e=window.requestIdleCallback;typeof e=="function"?e(()=>n()):window.setTimeout(()=>n(),0)}function Qu(n){return Math.max(0,Math.min(100,Math.round(n)))}function Ky(n,e,t,s){const r=n.relations.find(i=>i.relatedWord===e);if(r)return r;const o={relatedWord:e,relationType:t,strength:Qu(s),lastUpdatedAt:Date.now(),sampleCount:0};return n.relations.push(o),o}function Cp(n,e){n.relations.sort((t,s)=>s.strength-t.strength),n.relations.length>e&&(n.relations=n.relations.slice(0,e))}function QI(){if(Co)return Co;const n=new Map;for(const e of Un??[])n.set(e.word,e);return Co=n,n}function iX(){if(Zn)return Zn;const n=Ku(),e=hX(Un??[]),t=Ku();return Zn=e,Wh("lookup_build",t-n,{words:(Un==null?void 0:Un.length)??0}),e}function Qy(n,e,t){Zn&&(Zn.has(n)||Zn.set(n,new Map),Zn.get(n).set(e,t))}function aX(n,e){var a,c,l,d;if(Zn){const h=((a=Zn.get(n))==null?void 0:a.get(e))??0,f=((c=Zn.get(e))==null?void 0:c.get(n))??0;return Math.max(h,f)}const t=QI(),s=t.get(n),r=t.get(e),o=((l=s==null?void 0:s.relations.find(h=>h.relatedWord===e))==null?void 0:l.strength)??0,i=((d=r==null?void 0:r.relations.find(h=>h.relatedWord===n))==null?void 0:d.strength)??0;return Math.max(o,i)}function Xy(n,e,t){const r=(e-(qu===0?e:qu))/(1e3*60*60*24);if(r<hu)return;const o=Math.floor(r/hu);if(o<=0)return;const i=[];for(const a of n.relations){const c=a.successRate,l=a.sampleCount??0;if(a.lastUpdatedAt&&e-a.lastUpdatedAt>1e3*60*60*24*hu){let d=YQ*o;c!==void 0&&l>=Hy&&c<=qy&&(d*=2),a.strength=Qu(a.strength-d)}c!==void 0&&l>=Hy&&c<=qy&&a.strength<JQ||a.strength<XQ||i.push(a)}n.relations=i,Cp(n,t)}function cX(){fu&&(Cf||(Cf=!0,KI(()=>{try{Un&&fu&&(UI(Un),fu=!1,E.debug("[VocabularyNetwork] ÂÄã‰∫∫Âà•Êõ¥Êñ∞„ÅÆ‰øùÂ≠òÂÆå‰∫Ü",{words:Un.length}))}catch(n){E.warn("[VocabularyNetwork] ÂÄã‰∫∫Âà•Êõ¥Êñ∞„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó",n)}finally{Cf=!1}})))}function XI(n){if(Un)return Un;const e=v0();return e.length>0?(Un=e,Co=null,Zn=null,e):(Un=qI(n),Co=null,Zn=null,Un)}function lX(n){if(Sf)return;const e=v0();if(e.length>0){Un=e,Co=null,Zn=null;return}Sf=!0,KI(()=>{var t,s;try{const r=Un??qI(n);UI(r),Un=r,Co=null,Zn=null,E.info("[VocabularyNetwork] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰øùÂ≠òÂÆå‰∫Ü",{words:r.length,topK:((s=(t=r[0])==null?void 0:t.relations)==null?void 0:s.length)??0})}catch(r){E.warn("[VocabularyNetwork] „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ‰øùÂ≠ò„Å´Â§±Êïó",r)}finally{Sf=!1}})}function uX(n){const e=Ku(),{word:t,previousWord:s,isCorrect:r}=n;if(!s||t===s)return;if(!Un){const x=v0();x.length>0&&(Un=x,Co=null,Zn=null)}if(!Un)return;const o=GI,i=aX(s,t);if(i<QQ)return;const a=r?eX:ZQ,c=QI(),l=c.get(s),d=c.get(t);if(!l||!d)return;const h=Ky(l,t,"context",i),f=Ky(d,s,"context",i);h.strength=Qu(h.strength+a),f.strength=Qu(f.strength+a);const p=Date.now();h.lastUpdatedAt=p,f.lastUpdatedAt=p;const m=r?1:0;h.successRate=h.successRate===void 0?m:h.successRate*(1-eu)+m*eu,f.successRate=f.successRate===void 0?m:f.successRate*(1-eu)+m*eu,h.sampleCount=(h.sampleCount??0)+1,f.sampleCount=(f.sampleCount??0)+1,l.updatedAt=p,d.updatedAt=p,Cp(l,o),Cp(d,o),Qy(s,t,h.strength),Qy(t,s,f.strength),Xy(l,p,o),Xy(d,p,o),p-qu>=1e3*60*60*24*hu&&(qu=p),fu=!0,cX();const g=Ku();Wh("answer_update",g-e,{isCorrect:r,baseStrength:i})}function dX(n){return XI(n),Zn?(Wh("lookup_hit"),Zn):iX()}function hX(n){const e=new Map;for(const t of n){e.has(t.word)||e.set(t.word,new Map);const s=e.get(t.word);for(const r of t.relations)s.set(r.relatedWord,r.strength)}return e}class JI{constructor(e,t){Ee(this,"tests",new Map);Ee(this,"storage");Ee(this,"userId");this.storage=e,this.userId=t||this.getOrCreateUserId()}getOrCreateUserId(){const e="ab_test_user_id";let t=localStorage.getItem(e);return t||(t=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(e,t)),t}registerTest(e){const t=e.variants.reduce((s,r)=>s+r.weight,0);if(Math.abs(t-100)>.01)throw new Error(`Test ${e.id}: Variant weights must sum to 100, got ${t}`);this.tests.set(e.id,e)}getTest(e){return this.tests.get(e)}getActiveTests(){const e=new Date;return Array.from(this.tests.values()).filter(t=>!(!t.active||t.startDate>e||t.endDate&&t.endDate<e))}getVariant(e){const t=this.tests.get(e);if(!t||!t.active)return null;const s=this.storage.getAssignment(e);if(s)return s.variantId;const r=this.assignVariant(t);return this.storage.setAssignment({testId:e,variantId:r,assignedAt:new Date}),r}assignVariant(e){const s=this.hashString(`${this.userId}_${e.id}`)%100;let r=0;for(const o of e.variants)if(r+=o.weight,s<r)return o.id;return e.variants[0].id}hashString(e){let t=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}isFeatureEnabled(e,t){const s=this.getVariant(e);if(!s)return!1;const r=this.tests.get(e);if(!r)return!1;const o=r.variants.find(i=>i.id===s);return o?o.features[t]===!0:!1}getAllAssignments(){return this.storage.getAllAssignments()}resetAssignment(e){const s=this.storage.getAllAssignments().filter(r=>r.testId!==e);for(const r of s)this.storage.setAssignment(r)}}let If=null;function YI(){if(!If){const n={getAssignment(e){const t=`ab_test_assignment_${e}`,s=localStorage.getItem(t);if(!s)return null;const r=JSON.parse(s);return{...r,assignedAt:new Date(r.assignedAt)}},setAssignment(e){const t=`ab_test_assignment_${e.testId}`;localStorage.setItem(t,JSON.stringify(e))},getAllAssignments(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);if(s!=null&&s.startsWith("ab_test_assignment_")){const r=localStorage.getItem(s);if(r){const o=JSON.parse(r);e.push({...o,assignedAt:new Date(o.assignedAt)})}}}return e}};If=new JI(n)}return If}const fX=Object.freeze(Object.defineProperty({__proto__:null,ABTestManager:JI,getABTestManager:YI},Symbol.toStringTag,{value:"Module"}));class Ol{constructor(){Ee(this,"antiVibration");Ee(this,"recentAnswersCache",new Map);Ee(this,"aiCoordinator",null);Ee(this,"useAICoordinator",!1);Ee(this,"incorrectSkipQueue",[]);Ee(this,"skipCounter",0);Ee(this,"skipTarget",0);this.antiVibration=new c$}getRandomSkipCount(){const e=Math.random();return e<.4?2:e<.7?3:e<.9?4:5}enableAICoordination(e=!0){this.useAICoordinator=e,e&&!this.aiCoordinator&&(this.aiCoordinator=new jQ({debugMode:!1}))}async schedule(e){const t=performance.now();typeof e.useChainLearning!="boolean"&&(e={...e,useChainLearning:YI().isFeatureEnabled("chain_learning_retention_2025_01","useChainLearning")});const s={timestamp:new Date().toISOString(),mode:e.mode,questionCount:e.questions.length,useMetaAI:e.useMetaAI,hybridMode:e.hybridMode||!1,useChainLearning:e.useChainLearning,firstQuestions:e.questions.slice(0,10).map(m=>m.word)};try{const m=JSON.parse(localStorage.getItem("debug_scheduler_calls")||"[]");m.push(s),m.length>10&&m.shift(),localStorage.setItem("debug_scheduler_calls",JSON.stringify(m))}catch{}if(this.skipCounter>=this.skipTarget&&this.incorrectSkipQueue.length>0){const m=this.incorrectSkipQueue.shift();this.skipCounter=0,this.skipTarget=0;const g=e.questions.filter(x=>x.word!==m.question.word);return this.schedule({...e,questions:[m.question,...g]})}if(this.skipTarget>0&&this.skipCounter++,e.hybridMode)return this.scheduleHybridMode(e,t);if(e.finalPriorityMode)return this.scheduleFinalPriorityMode(e,t);const r=this.buildContext(e),o=e.useMetaAI?this.detectSignals(r):[],i=this.calculatePriorities(e.questions,r,o,!1),a=this.applyAntiVibration(i,r),c=this.applyLearningLimits(a,e,r),l=this.sortAndBalance(c,e,r),d=this.postProcess(l,r);try{const m=d.slice(0,30).map((x,y)=>{var v,w;const b=l.find(S=>S.question.word===x.word);return{word:x.word,position:(b==null?void 0:b.position)||0,category:(v=b==null?void 0:b.status)==null?void 0:v.category,attempts:((w=b==null?void 0:b.status)==null?void 0:w.attempts)||0}}),g={timestamp:new Date().toISOString(),mode:r.mode,source:"schedule",top30:m};Fi("debug_postProcess_output",g,{mode:r.mode})}catch{}const h=this.antiVibration.calculateVibrationScore(l,r.recentAnswers,20),f=performance.now()-t,p={top10Words:d.slice(0,10).map(m=>m.word),top10Positions:l.slice(0,10).map(m=>({word:m.question.word,position:m.position}))};E.info("[QuestionScheduler] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(f)+"ms",vibrationScore:h,signalCount:o.length,resultDebug:p});try{const m=JSON.parse(localStorage.getItem("debug_scheduler_results")||"[]");m.push({timestamp:new Date().toISOString(),...p}),m.length>10&&m.shift(),localStorage.setItem("debug_scheduler_results",JSON.stringify(m))}catch{}if(l.length>0&&r.recentAnswers.length>0){const m=l[0],g=r.recentAnswers.find(x=>x.word===m.question.word);if(g&&!g.correct&&!this.incorrectSkipQueue.some(y=>y.question.word===m.question.word)){this.incorrectSkipQueue.push(m),this.skipTarget=this.getRandomSkipCount(),this.skipCounter=0;const y=d.slice(1);if(y.length>0)return{scheduledQuestions:y,vibrationScore:h,processingTime:f,signalCount:o.length,debug:{dtaApplied:l.filter(b=>{var v;return(((v=b.status)==null?void 0:v.position)??50)<20}).length,antiVibrationApplied:l.filter(b=>b.antiVibrationApplied).length,signalsDetected:o,randomSkipApplied:!0}}}}return{scheduledQuestions:d,vibrationScore:h,processingTime:f,signalCount:o.length,debug:{dtaApplied:l.filter(m=>{var g;return(((g=m.status)==null?void 0:g.position)??50)<20}).length,antiVibrationApplied:l.filter(m=>m.antiVibrationApplied).length,signalsDetected:o}}}buildContext(e){const s=new Date().getHours(),r=s<12?"morning":s<17?"afternoon":s<21?"evening":"night",o=this.calculateCognitiveLoad(e.sessionStats),i=this.getRecentAnswers(e.mode),a=rt(),c={};if(a&&a.wordProgress)for(const l of e.questions){const d=a.wordProgress[l.word];d&&(c[l.word]=d)}return{mode:e.mode,sessionStats:e.sessionStats,recentAnswers:i,timeOfDay:r,cognitiveLoad:o,useMetaAI:e.useMetaAI||!1,isReviewFocusMode:e.isReviewFocusMode||!1,sessionStartTime:Date.now()-(e.sessionStats.duration||0),wordProgress:c}}calculateCognitiveLoad(e){const t=e.correct+e.incorrect>0?e.incorrect/(e.correct+e.incorrect):0,s=(e.duration||0)/6e4,r=Math.min(s/30,1);return Math.min(t*.7+r*.3,1)}getRecentAnswers(e){if(this.recentAnswersCache.has(e))return this.recentAnswersCache.get(e);try{const t=rt(),s=[];Object.entries(t.wordProgress||{}).forEach(([o,i])=>{if(i.lastStudied>0){const a=Yr(Ut(i,e));s.push({word:o,correct:!GQ(a),timestamp:i.lastStudied,consecutiveCorrect:i.streak||0})}}),s.sort((o,i)=>i.timestamp-o.timestamp);const r=s.slice(0,100);return this.recentAnswersCache.set(e,r),r}catch(t){return E.error("[QuestionScheduler] Ëß£Á≠îÂ±•Ê≠¥„ÅÆÂèñÂæó„Å´Â§±Êïó",t),[]}}detectSignals(e){try{const t=[],s=e.sessionStats,r=s.correct+s.incorrect+s.still_learning,o=r>0?s.incorrect/r:0,i=(s.duration||0)/6e4;if(i>20||e.cognitiveLoad>.7){const c=Math.min(i/30*.5+e.cognitiveLoad*.5,1);t.push({type:"fatigue",confidence:c,action:"easier"}),E.debug(`[Signal] Áñ≤Âä¥Ê§úÂá∫: ${(c*100).toFixed(0)}%`)}if(o>.4&&r>=5){const c=Math.min(o,.9);t.push({type:"struggling",confidence:c,action:"review"}),E.debug(`[Signal] Ëã¶Êà¶Ê§úÂá∫: ${(c*100).toFixed(0)}% („Ç®„É©„ÉºÁéá${(o*100).toFixed(0)}%)`)}const a=s.consecutiveCorrect||0;if(a>10){const c=Math.min(a/15,.9);t.push({type:"overlearning",confidence:c,action:"harder"}),E.debug(`[Signal] ÈÅéÂ≠¶ÁøíÊ§úÂá∫: ${(c*100).toFixed(0)}% (ÈÄ£Á∂ö${a}ÂõûÊ≠£Ëß£)`)}return o>=.2&&o<=.35&&a<8&&(t.push({type:"optimal",confidence:.8,action:"continue"}),E.debug("[Signal] ÊúÄÈÅ©Â≠¶ÁøíÁä∂ÊÖãÊ§úÂá∫")),t.length===0&&E.debug("[Signal] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Å™„Åó - ÈÄöÂ∏∏„É¢„Éº„Éâ"),t}catch(t){return E.error("[QuestionScheduler] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Ç®„É©„Éº",t),[]}}calculatePriorities(e,t,s,r=!1){this.recordFunctionCall("calculatePriorities",{questionsCount:e.length,hybridMode:r});const o=this.loadProgressCache(),i=this.calculateDifficultyAdaptation(o),a=e.map((l,d)=>{const h=this.getWordStatusFromCache(l.word,t.mode,o);if(r){const p=d/e.length*100;return{question:l,position:p,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}}let f=(h==null?void 0:h.position)||35;return f=this.applyDifficultyAdaptation(f,l,i),{question:l,position:f,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}});return this.applyInterleavingAdjustment(a,t.mode,e.length)}applyInterleavingAdjustment(e,t,s){this.recordFunctionCall("applyInterleavingAdjustment",{prioritizedCount:e.length,mode:t,questionsCount:s});const r=new Ya,o={stillLearning:e.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0).length,incorrect:e.filter(x=>x.position>=70).length,new:e.filter(x=>x.position<40).length,boostable:e.filter(x=>x.position>=25&&x.position<40&&(x.attempts??0)===0).length},{result:i,changed:a}=r.boostStillLearningQuestions(e),{result:c,changed:l}=r.adjustPositionForInterleaving(i),d={stillLearning:c.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0).length,incorrect:c.filter(x=>x.position>=70).length,new:c.filter(x=>x.position<40).length,boostable:c.filter(x=>x.position>=25&&x.position<40&&(x.attempts??0)===0).length},h=c.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0&&x.position>=60&&x.position<70).length,f=c.filter(x=>x.position>=40&&(x.attempts??0)===0&&x.position>=40&&x.position<60).length,p=c.filter(x=>{const y=(x.attempts??0)===0,b=(x.attempts??0)>0&&x.position>=40&&x.position<70;return y&&x.position>=60||b&&x.position<60});try{const x={mode:t,questionsCount:s,stillInBoostedZone:h,newInBoostedZone:f,violations:p.map(y=>({word:y.question.word,position:y.position,attempts:y.attempts??0,type:(y.attempts??0)===0?"new_exceeds_60":"still_below_60"})),violationCount:p.length,isValid:p.length===0,timestamp:new Date().toISOString()};localStorage.setItem("debug_position_hierarchy_validation",JSON.stringify(x)),localStorage.setItem(`debug_position_hierarchy_validation_${t}`,JSON.stringify(x))}catch{}try{const x={mode:t,questionsCount:s,timestamp:new Date().toISOString(),before:o,after:d,stillChanged:a,changed:l,summary:{stillBoosted:a.length,newBoosted:l.length,working:a.length>0||l.length>0}};localStorage.setItem("debug_position_interleaving",JSON.stringify(x));const y=`debug_position_interleaving_${t}`;localStorage.setItem(y,JSON.stringify(x));const b=`debug_position_interleaving_history_${t}`;try{const v=localStorage.getItem(b),w=JSON.parse(v||"[]"),S=Array.isArray(w)?w:[];for(S.push(x);S.length>5;)S.shift();localStorage.setItem(b,JSON.stringify(S))}catch{}}catch{}const{result:m,changed:g}=r.boostStillLearningQuestions(c);try{const x={mode:t,questionsCount:s,timestamp:new Date().toISOString(),boosted:g.length,changes:g,working:g.length>0};localStorage.setItem("debug_still_learning_boost",JSON.stringify(x)),localStorage.setItem(`debug_still_learning_boost_${t}`,JSON.stringify(x))}catch{}return m}recordFunctionCall(e,t){try{const s=localStorage.getItem("debug_function_calls"),r=s?JSON.parse(s):[];r.push({timestamp:new Date().toISOString(),function:e,params:t}),r.length>30&&r.shift(),localStorage.setItem("debug_function_calls",JSON.stringify(r))}catch{}}calculateForgettingRisk(e){if(e.lastStudied===0)return 0;const t=(Date.now()-e.lastStudied)/(1e3*60*60*24);let r=(e.reviewInterval>0?t/e.reviewInterval:0)*100;return e.accuracy<50?r*=1.5:e.accuracy>=80&&(r*=.7),Math.round(Math.min(r,200))}applySignals(e,t,s){if(t.length===0)return e;let r=e;for(const o of t)switch(o.type){case"fatigue":e>8&&(r*=1-o.confidence*.2);break;case"struggling":e<2&&(r*=1-o.confidence*.3);break;case"overlearning":e>=3&&e<=5&&(r*=1-o.confidence*.15);break}return r}loadProgressCache(){try{return rt()}catch{return null}}getWordStatusFromCache(e,t,s){if(!s||!s.wordProgress)return null;const r=s.wordProgress[e];if(!r)return null;const o=Ut(r,t),i=Yr(o);let a=0,c=0;switch(t){case"memorization":a=r.memorizationAttempts||0,c=r.memorizationCorrect||0;break;case"translation":a=r.translationAttempts||0,c=r.translationCorrect||0;break;case"spelling":a=r.spellingAttempts||0,c=r.spellingCorrect||0;break;case"grammar":a=r.grammarAttempts||0,c=r.grammarCorrect||0;break;default:a=(r.correctCount||0)+(r.incorrectCount||0),c=r.correctCount||0}return{category:i,position:o,lastStudied:r.lastStudied||0,attempts:a,correct:c,streak:r.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1}}getWordStatus(e,t){var s;try{const o=(s=rt().wordProgress)==null?void 0:s[e];if(!o)return null;const i=Ut(o,t),a=Yr(i);let c=0,l=0;switch(t){case"memorization":c=o.memorizationAttempts||0,l=o.memorizationCorrect||0;break;case"translation":c=o.translationAttempts||0,l=o.translationCorrect||0;break;case"spelling":c=o.spellingAttempts||0,l=o.spellingCorrect||0;break;case"grammar":c=o.grammarAttempts||0,l=o.grammarCorrect||0;break;default:c=(o.correctCount||0)+(o.incorrectCount||0),l=o.correctCount||0}const d={category:a,position:i,lastStudied:o.lastStudied||0,attempts:c,correct:l,streak:o.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1};return WI(a)&&E.debug(`[WordStatus] ${e}: ${a} (position=${i}, attempts=${d.attempts}, consecutiveIncorrect=${o.consecutiveIncorrect||0})`),d}catch(r){return E.error("[QuestionScheduler] Â≠¶ÁøíÁä∂Ê≥Å„ÅÆÂèñÂæó„Å´Â§±Êïó",r),null}}applyAntiVibration(e,t){return this.antiVibration.filter(e,{recentAnswers:t.recentAnswers,minInterval:6e4,consecutiveThreshold:3})}applyLearningLimits(e,t,s){var f,p;const r=((f=t.limits)==null?void 0:f.learningLimit)??null,o=((p=t.limits)==null?void 0:p.reviewLimit)??null;if(r===null&&o===null&&!s.isReviewFocusMode)return e;const i=e.reduce((m,g)=>{var y;return(((y=g.status)==null?void 0:y.attempts)??0)<=0?m:g.position>=40&&g.position<70?m+1:m},0),a=e.reduce((m,g)=>{var y;return(((y=g.status)==null?void 0:y.attempts)??0)<=0?m:g.position>=70?m+1:m},0),c=r!==null&&i>=r,l=o!==null&&a>=o;if(!(s.isReviewFocusMode||c||l))return e;const h=e.filter(m=>{var x;return(((x=m.status)==null?void 0:x.attempts)??0)>0&&m.position>=40});return h.length>0?h:e}sortAndBalance(e,t,s){this.recordFunctionCall("sortAndBalance",{questionsCount:e.length});const r=e.filter(f=>f.position>=70),o=e.filter(f=>f.position>=40&&f.position<70),i=e.filter(f=>f.position<40);e.reduce((f,p)=>{var g;const m=((g=p.status)==null?void 0:g.category)||"null";return f[m]=(f[m]||0)+1,f},{}).null,e.length;const c=(f,p)=>f.position!==p.position?p.position-f.position:(f.originalIndex||0)-(p.originalIndex||0);r.sort(c),o.sort(c),i.sort(c);const l=[...e].sort((f,p)=>f.position!==p.position?p.position-f.position:(f.originalIndex||0)-(p.originalIndex||0)),h=new Ya().interleaveByCategory(l);try{const f=h.slice(0,30).map(w=>{var S,I;return{word:w.question.word,position:w.position,category:(S=w.status)==null?void 0:S.category,attempts:w.attempts??((I=w.status)==null?void 0:I.attempts)??0}});localStorage.setItem("debug_sortAndBalance_output",JSON.stringify(f));const p=h.slice(0,100).map((w,S)=>{var I,C;return{rank:S+1,word:w.question.word,position:w.position,category:(I=w.status)==null?void 0:I.category,attempts:w.attempts??((C=w.status)==null?void 0:C.attempts)??0}}),m=p.filter(w=>w.position>=40&&w.position<70&&w.attempts>0),g=h.slice(0,600).map((w,S)=>{var I;return{rank:S+1,word:w.question.word,position:w.position,attempts:w.attempts??((I=w.status)==null?void 0:I.attempts)??0}}),x=g.filter(w=>w.position>=40&&w.position<70&&w.attempts>0),y={timestamp:new Date().toISOString(),mode:t.mode,questionsCount:e.length,interleavedCount:h.length,top100:p,top600:g,top600Count:g.length,stillLearningInTop100:m.length,stillLearningInTop600:x.length,stillLearningWordsInTop100:m.map(w=>`${w.rank}‰Ωç: ${w.word} (Position ${w.position}, ${w.attempts}Âõû)`),stillLearningWordsInTop600:x.slice(0,20).map(w=>`${w.rank}‰Ωç: ${w.word} (Position ${w.position}, ${w.attempts}Âõû)`),position50Count:g.filter(w=>w.position===50&&w.attempts===0).length};localStorage.setItem("debug_sortAndBalance_top100",JSON.stringify(y));const b=`debug_sortAndBalance_top100_${t.mode}`;localStorage.setItem(b,JSON.stringify(y));const v=`debug_sortAndBalance_top100_history_${t.mode}`;try{const w=localStorage.getItem(v),S=JSON.parse(w||"[]"),I=Array.isArray(S)?S:[];for(I.push(y);I.length>5;)I.shift();localStorage.setItem(v,JSON.stringify(I))}catch{}}catch{}return t.useChainLearning?this.applyChainLearningWithinTopN(h,t):h}applyChainLearningWithinTopN(e,t){const s=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),o=Math.min(80,e.length);if(o<=2)return e;XI(t.questions),lX(t.questions);const i=dX(t.questions),a=e.slice(0,o),c=e.slice(o),l=y=>Math.floor(y.position/10),d=(y,b)=>{var S,I;const v=((S=i.get(y))==null?void 0:S.get(b))??0,w=((I=i.get(b))==null?void 0:I.get(y))??0;return Math.max(v,w)},h=[];let f=0;const p=new Set;let m=!1;for(;f<a.length;){const y=l(a[f]);p.add(y);let b=f+1;for(;b<a.length&&l(a[b])===y;)b++;const v=a.slice(f,b);if(v.length<=2){h.push(...v),f=b;continue}const w=v.slice(1),S=[v[0]];let I=0;for(;w.length>0;){const C=S[S.length-1].question.word;let k=0,$=-1;for(let N=0;N<w.length;N++){const _=w[N].question.word,P=d(C,_);P>$&&($=P,k=N)}I+=Math.max(0,$),S.push(w.splice(k,1)[0])}I===0?h.push(...v):(m=!0,h.push(...S)),f=b}const g=[...h,...c],x=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();return rX({ms:x-s,topCount:o,buckets:p.size,usedReorder:m}),g}scheduleHybridMode(e,t){const s=this.buildContext(e),r=e.useMetaAI?this.detectSignals(s):[],o=this.calculatePriorities(e.questions,s,r,!1),i=this.applyAntiVibration(o,s),a=this.sortAndBalance(i,e,s),c=a.filter(g=>g.position>=70),l=a.filter(g=>g.position>=40&&g.position<70),d=c.length+l.length,h=a.length;E.info("[QuestionScheduler Hybrid] ÂÑ™ÂÖàÂçòË™ûÈÖçÁΩÆÂÆå‰∫Ü",{incorrectWords:c.slice(0,5).map(g=>g.question.word),stillLearningWords:l.slice(0,5).map(g=>g.question.word),incorrectCount:c.length,stillLearningCount:l.length,otherCount:h-d,reviewRatio:h>0?`${(d/h*100).toFixed(0)}%`:"0%",top5:a.slice(0,5).map(g=>{var x;return`${g.question.word}(${(x=g.status)==null?void 0:x.category})`})});const f=this.postProcess(a,s);try{const g=f.slice(0,30).map((x,y)=>{var v,w;const b=a.find(S=>S.question.word===x.word);return{word:x.word,position:(b==null?void 0:b.position)||0,category:(v=b==null?void 0:b.status)==null?void 0:v.category,attempts:((w=b==null?void 0:b.status)==null?void 0:w.attempts)||0}});localStorage.setItem("debug_postProcess_output",JSON.stringify({timestamp:new Date().toISOString(),mode:s.mode,source:"scheduleHybridMode",top30:g}))}catch{}const p=this.antiVibration.calculateVibrationScore(a,s.recentAnswers,20),m=performance.now()-t;return E.info("[QuestionScheduler Hybrid] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(m)+"ms",vibrationScore:p,incorrectCount:c.length,stillLearningCount:l.length,aiEnabled:this.useAICoordinator,totalCount:f.length}),{scheduledQuestions:f,vibrationScore:p,processingTime:m,signalCount:r.length}}async scheduleFinalPriorityMode(e,t){var k;const s=this.buildContext(e),r=e.useMetaAI?this.detectSignals(s):[],o=this.loadProgressCache(),i=(o==null?void 0:o.wordProgress)??{},a=e.mode==="grammar"?"grammar":e.mode==="memorization"?"memorization":"comprehensive",c=(e.sessionStats.correct||0)+(e.sessionStats.incorrect||0)+(e.sessionStats.still_learning||0)+(e.sessionStats.mastered||0);let l=0,d=0,h=0,f=0;for(const $ of Object.values(i)){const N=Ut($,e.mode);N>=70?h++:N>=40?d++:N>=20?f++:l++}const p={totalAttempts:c,correctAnswers:e.sessionStats.correct||0,incorrectAnswers:e.sessionStats.incorrect||0,stillLearningAnswers:e.sessionStats.still_learning||0,sessionStartTime:s.sessionStartTime,sessionDuration:e.sessionStats.duration||0,consecutiveIncorrect:0,masteredCount:l,stillLearningCount:d,incorrectCount:h,newCount:f,consecutiveCorrect:e.sessionStats.consecutiveCorrect||0};if(!this.useAICoordinator||!this.aiCoordinator)return E.warn("[QuestionScheduler FinalPriority] AICoordinator„ÅåÊú™ÂàùÊúüÂåñ„ÄÅ„Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„Éâ„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ"),this.scheduleHybridMode(e,t);const m=[];for(const $ of e.questions){const N=i[$.word]??s.wordProgress[$.word]??null,_=this.getWordStatusFromCache($.word,s.mode,o),P=(_==null?void 0:_.position)??Ut(N,e.mode);let j=0,A=0;if(N)switch(e.mode){case"memorization":j=N.memorizationAttempts||0,A=N.memorizationCorrect||0;break;case"translation":j=N.translationAttempts||0,A=N.translationCorrect||0;break;case"spelling":j=N.spellingAttempts||0,A=N.spellingCorrect||0;break;case"grammar":j=N.grammarAttempts||0,A=N.grammarCorrect||0;break}const F=_??{category:Yr(P),position:P,lastStudied:(N==null?void 0:N.lastStudied)||0,attempts:j,correct:A,streak:(N==null?void 0:N.consecutiveCorrect)||0,forgettingRisk:0,reviewInterval:1},M=await this.aiCoordinator.analyzeAndCoordinate({word:{word:$.word,meaning:$.meaning,reading:$.reading,difficulty:$.difficulty,category:$.category,source:$.source,type:$.type,isPhraseOnly:$.isPhraseOnly},progress:N,sessionStats:p,currentTab:a,allProgress:i},P/100);m.push({question:$,position:P,finalPriority:M.finalPriority,status:F,attempts:(F==null?void 0:F.attempts)??0,timeBoost:1})}const g=new Ya,y=g.boostStillLearningQuestions(m).result;for(const $ of y)$.position>=60&&$.position<70&&(((k=$.status)==null?void 0:k.attempts)??0)>0&&($.finalPriority=($.finalPriority??0)+100);const{result:b}=g.adjustPositionForInterleaving(y),v=[...b].sort(($,N)=>(N.finalPriority??0)-($.finalPriority??0)),w=g.interleaveByCategory(v);try{const $=w.slice(0,30).map((_,P)=>{var j,A;return{rank:P+1,word:_.question.word,position:_.position,finalPriority:_.finalPriority??0,category:(j=_.status)==null?void 0:j.category,attempts:((A=_.status)==null?void 0:A.attempts)??0}});Fi("debug_finalPriority_output",$,{mode:s.mode});const N={currentTab:a,totalQuestions:e.questions.length,allProgressCount:Object.keys(i||{}).length,aiSessionStats:p,timestamp:new Date().toISOString(),mode:s.mode};Fi("debug_finalPriority_sessionStats",N,{mode:s.mode})}catch{}const S=this.postProcess(w,s);try{const $=S.slice(0,30).map(_=>{var j,A;const P=w.find(F=>F.question.word===_.word);return{word:_.word,position:(P==null?void 0:P.position)||_.position||0,category:(j=P==null?void 0:P.status)==null?void 0:j.category,attempts:((A=P==null?void 0:P.status)==null?void 0:A.attempts)||0,finalPriority:(P==null?void 0:P.finalPriority)??_.finalPriority??0}}),N={timestamp:new Date().toISOString(),mode:s.mode,source:"scheduleFinalPriorityMode",top30:$};Fi("debug_postProcess_output",N,{mode:s.mode})}catch{}const I=this.antiVibration.calculateVibrationScore(w,s.recentAnswers,20),C=performance.now()-t;return E.info("[QuestionScheduler FinalPriority] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(C)+"ms",vibrationScore:I,aiEnabled:!0,totalCount:S.length,top5FinalPriority:w.slice(0,5).map($=>({word:$.question.word,finalPriority:($.finalPriority??0).toFixed(3),position:$.position}))}),{scheduledQuestions:S,vibrationScore:I,processingTime:C,signalCount:r.length}}postProcess(e,t){const s=e.map(a=>({...a.question,position:a.position,finalPriority:a.finalPriority})),r=a=>a>=70?0:a>=60?1:a>=40?2:a>=20?3:4;let o=!1,i=-1;for(const a of e){const c=r(a.position);if(i!==-1&&c<i){o=!0;break}i=c}try{const a=e.slice(0,30).map(l=>{var d;return{word:l.question.word,position:l.position??0,attempts:((d=l.status)==null?void 0:d.attempts)??0}}),c={timestamp:new Date().toISOString(),mode:t.mode,isInterleavedAcrossBands:o,action:o?"skipped_contextual_reorder":"applied_contextual_reorder",top30:a};Fi("debug_postProcess_meta",c,{mode:t.mode})}catch{}if(o)return s;try{const a=this.getAllProgress(),c=this.getRecentlyStudiedWords(t),l=this.splitByPositionBands(e,t),d=[];let h=0,f=0;for(const p of l){if(p.questions.length===0)continue;const m=p.questions.map(b=>({...b.question,position:b.position,finalPriority:b.finalPriority})),g=zI(m,a,[]),x=new Map(m.map(b=>[b.word,b])),y=g.sequence.map(b=>x.get(b)).filter(b=>b!==void 0);d.push(...y),h+=g.clusters.length,f+=g.transitions.length}try{const p=d.slice(0,30).map((x,y)=>({rank:y+1,word:x.word,position:x.position??0,attempts:x.attempts??0})),m={incorrect:p.filter(x=>x.position>=70).length,stillLearning:p.filter(x=>x.position>=60&&x.position<70).length,newBoosted:p.filter(x=>x.position>=40&&x.position<60).length,newNormal:p.filter(x=>x.position>=20&&x.position<40).length,mastered:p.filter(x=>x.position<20).length},g={timestamp:new Date().toISOString(),mode:t.mode,source:"postProcess",top30:p,positionDistribution:m,totalQuestions:d.length};Fi("debug_postProcess_output",g,{mode:t.mode})}catch{}return d}catch(a){return E.warn("[postProcess] Èñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„Åß„Ç®„É©„Éº„ÄÅÂü∫Êú¨È†ÜÂ∫è„Çí‰ΩøÁî®:",a),s}}splitByPositionBands(e,t){const s=[{range:"70-100 (incorrect)",min:70,max:100,questions:[]},{range:"60-69 (still_learning)",min:60,max:69,questions:[]},{range:"40-59 (new boosted)",min:40,max:59,questions:[]},{range:"20-39 (new normal)",min:20,max:39,questions:[]},{range:"0-19 (mastered)",min:0,max:19,questions:[]}];return e.forEach(r=>{const o=r.position;for(const i of s)if(o>=i.min&&o<=i.max){i.questions.push(r);break}}),s.filter(r=>r.questions.length>0)}getRecentlyStudiedWords(e){const t=[],s=Date.now(),r=5*60*1e3;for(const[o,i]of Object.entries(e.wordProgress)){const a=i==null?void 0:i.lastStudied;a&&s-new Date(a).getTime()<r&&t.push(o)}return t.slice(-20)}clearCache(){this.recentAnswersCache.clear(),E.info("[QuestionScheduler] „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü")}getWordProgress(e){var t;try{return((t=rt().wordProgress)==null?void 0:t[e])||null}catch{return null}}getAllProgress(){try{return rt().wordProgress||{}}catch{return{}}}convertToAISessionStats(e){return{totalAttempts:e.correct+e.incorrect+e.still_learning,correctAnswers:e.correct||0,incorrectAnswers:e.incorrect||0,stillLearningAnswers:e.still_learning||0,sessionStartTime:Date.now()-(e.duration||0),sessionDuration:e.duration||0,avgResponseTime:e.avgResponseTime,consecutiveIncorrect:e.consecutiveIncorrect||0,masteredCount:e.masteredCount||0,stillLearningCount:e.still_learningCount||0,incorrectCount:e.incorrectCount||0,newCount:e.newCount||0}}recalculatePriorityAfterAnswer(e,t,s="memorization"){const r=(()=>{switch(s){case"memorization":return t.memorizationPosition??50;case"translation":return t.translationPosition??50;case"spelling":return t.spellingPosition??50;case"grammar":return t.grammarPosition??50;default:return 50}})(),o=this.determinePositionAfterAnswer(t,s),i=Ut(t,s),a=PQ(t,s);(Date.now()-(t.lastStudied||Date.now()))/(1e3*60*60*24);const c=Yr(o),l=t.correctCount+t.incorrectCount;t.accuracyRate=l>0?t.correctCount/l:0;let d=0,h=0,f=0;switch(s){case"memorization":d=t.memorizationAttempts||0,h=t.memorizationCorrect||0,f=t.memorizationStillLearning||0;break;case"translation":d=t.translationAttempts||0,h=t.translationCorrect||0;break;case"spelling":d=t.spellingAttempts||0,h=t.spellingCorrect||0;break;case"grammar":d=t.grammarAttempts||0,h=t.grammarCorrect||0;break}try{const p={timestamp:new Date().toISOString(),word:e,mode:s,positionBefore:r,positionAfter:o,positionWithSavedPosition:i,category:c,savedPositionDebug:a,progress:{correctCount:t.correctCount,incorrectCount:t.incorrectCount,consecutiveCorrect:t.consecutiveCorrect||0,consecutiveIncorrect:t.consecutiveIncorrect||0,accuracy:t.accuracyRate||0,modeAttempts:d,modeCorrect:h,modeStillLearning:f}},m=localStorage.getItem("debug_answer_logs"),g=m?JSON.parse(m):[];g.push(p),g.length>20&&g.shift(),localStorage.setItem("debug_answer_logs",JSON.stringify(g))}catch{}return o}calculateAIEvaluations(e,t,s){const r=e.correctCount+e.incorrectCount,o=r>0?e.correctCount/r:0,i=e.consecutiveCorrect||0,a=e.consecutiveIncorrect||0,c=new $I,l=new TI,d=new AI,h=new RI,f=new DI,p=new EI,m=new Ya;return{memory:c.proposePosition(e,"",s,o,r),cognitiveLoad:l.proposePosition(e,a),errorPrediction:d.proposePosition(e,o,r),linguistic:h.proposePosition(e,o),contextual:f.proposePosition(e,s),learningStyle:p.proposePosition(e,o,r),gamification:m.proposePosition(e,i,o)}}recordAIEvaluation(e,t){try{const s="debug_ai_evaluations",r=localStorage.getItem(s),o=r?JSON.parse(r):{};o[e]={...t,word:e};const i=Object.entries(o);if(i.length>100){const d=Object.fromEntries(i.slice(-100));localStorage.setItem(s,JSON.stringify(d))}else localStorage.setItem(s,JSON.stringify(o));const a=(t==null?void 0:t.aiEvaluations)??(t==null?void 0:t.aiProposals)??{},c=Object.values(a).map(d=>Number(d).toFixed(1)).join("/"),l=Number((t==null?void 0:t.finalPriority)??(t==null?void 0:t.position)??0);console.log(`ü§ñ [AIË©ï‰æ°] ${e}: ${l.toFixed(1)}[${c}] (${(t==null?void 0:t.category)??"n/a"})`)}catch{}}determinePosition(e,t="memorization"){return Ut(e,t)}determinePositionAfterAnswer(e,t="memorization"){const s={...e};switch(t){case"memorization":s.memorizationPosition=void 0;break;case"translation":s.translationPosition=void 0;break;case"spelling":s.spellingPosition=void 0;break;case"grammar":s.grammarPosition=void 0;break}return Ut(s,t)}enforceCompletionRequirement(e){return e>=70?100:e>=40?75:e<20?10:50}calculateDifficultyAdaptation(e){if(!e||!e.wordProgress)return{beginner:70,intermediate:60,advanced:50,shouldPrioritizeBeginner:!1,priorityBoost:0};const t=Object.values(e.wordProgress||{}),s={beginner:{correct:0,total:0},intermediate:{correct:0,total:0},advanced:{correct:0,total:0}};t.forEach(a=>{const l={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[a.difficulty];if(l&&s[l]){const d=(a.correctCount||0)+(a.incorrectCount||0);s[l].total+=d,s[l].correct+=a.correctCount||0}});const r={beginner:s.beginner.total>0?s.beginner.correct/s.beginner.total*100:70,intermediate:s.intermediate.total>0?s.intermediate.correct/s.intermediate.total*100:60,advanced:s.advanced.total>0?s.advanced.correct/s.advanced.total*100:50},o=r.intermediate<60||r.advanced<50;let i=0;if(o){const a=Math.max(0,60-r.intermediate),c=Math.max(0,50-r.advanced);i=Math.min(20,(a+c)/2)}return{...r,shouldPrioritizeBeginner:o,priorityBoost:i}}applyDifficultyAdaptation(e,t,s){if(!s.shouldPrioritizeBeginner)return e;const o={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[t.difficulty];return o?o==="beginner"?Math.max(0,e-s.priorityBoost):o==="intermediate"||o==="advanced"?Math.min(100,e+Math.min(10,s.priorityBoost/2)):e:e}}const mo=2;function S0(n){return typeof n!="number"||!Number.isFinite(n)?null:n}function ZI(n,e){const t=e??S0(n.schemaVersion)??0;if(t>mo)return{status:"too_new",storedVersion:t,supportedVersion:mo,notes:["Stored progress schema is newer than this app supports; skipping migration/save"],progress:n};let s=!1;const r=[];if(t<1&&r.push("Set schemaVersion (v0 -> v1)"),t<2){const o={},i=new Map;for(const a of n.results||[]){if(!a||typeof a!="object")continue;const c=a.mode,l=a.questionSetId,d=a.percentage,h=a.date,f=a.timeSpent;if(!c||!l)continue;const p=`${c}:${l}`;o[p]||(o[p]={attempts:0,bestScore:0,averageScore:0,lastAttempt:0,totalTimeSpent:0});const m=o[p];if(m.attempts++,typeof d=="number"&&Number.isFinite(d)){m.bestScore=Math.max(m.bestScore,d);const g=i.get(p)||{sum:0,count:0};g.sum+=d,g.count+=1,i.set(p,g)}typeof h=="number"&&Number.isFinite(h)&&(m.lastAttempt=Math.max(m.lastAttempt,h)),typeof f=="number"&&Number.isFinite(f)&&(m.totalTimeSpent+=f)}for(const[a,c]of i.entries())o[a]&&(o[a].averageScore=c.count>0?c.sum/c.count:0);n.questionSetStats=o,s=!0,r.push("Migrate questionSetStats keying to mode:questionSetId (v1 -> v2)")}return n.schemaVersion!==mo&&(n.schemaVersion=mo,s=!0),(!n.wordProgress||typeof n.wordProgress!="object")&&(n.wordProgress={},s=!0,r.push("Initialize missing wordProgress")),(!n.results||!Array.isArray(n.results))&&(n.results=[],s=!0,r.push("Initialize missing results")),(!n.questionSetStats||typeof n.questionSetStats!="object")&&(n.questionSetStats={},s=!0,r.push("Initialize missing questionSetStats")),{status:"ok",fromVersion:t,toVersion:mo,didMigrate:s,notes:r,progress:n}}const Jy={maxReviewCount:10};function C0(){try{const n=localStorage.getItem("study-settings");if(n)return{maxReviewCount:JSON.parse(n).maxReviewCount??Jy.maxReviewCount}}catch(n){E.error("Â≠¶ÁøíË®≠ÂÆö„ÅÆÂèñÂæó„Ç®„É©„Éº:",n)}return{...Jy}}const pX="session-history",mX=50;async function ba(n,e){const t=ad()&&cd();try{if(t)await pr(wn.SESSION_HISTORY,{mode:e,status:n.status,word:n.word,timestamp:n.timestamp});else{const s=`${pX}-${e}`,r=localStorage.getItem(s),o=r?JSON.parse(r):[];o.push(n),o.length>mX&&o.shift(),localStorage.setItem(s,JSON.stringify(o))}}catch(s){E.error("„Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",s)}}function Xu(){const n=rt(),e=new Date().toLocaleDateString("ja-JP"),t=new Set;return n.results.forEach(s=>{new Date(s.date).toLocaleDateString("ja-JP")===e&&s.incorrectWords.forEach(r=>t.add(r))}),Array.from(t)}function Ju(n){const e=rt(),t=new Date().setHours(0,0,0,0),s=t+24*60*60*1e3;let r=e.results.filter(c=>c.date>=t&&c.date<s);n&&(r=r.filter(c=>c.mode===n));const o=r.reduce((c,l)=>c+l.score,0),i=r.reduce((c,l)=>c+l.total,0),a=i>0?Math.round(o/i*100):0;return{todayCorrectCount:o,todayTotalAnswered:i,todayAccuracy:a}}function N0(){const n=rt(),e=new Date,t=e.getDay(),s=t===0?-6:1-t,r=new Date(e);r.setDate(e.getDate()+s),r.setHours(0,0,0,0);const o=new Date(r);o.setDate(r.getDate()+7);const i=new Date(r);i.setDate(r.getDate()-7);const a=new Date(r),c=n.results.filter(b=>b.date>=r.getTime()&&b.date<o.getTime()),l=n.results.filter(b=>b.date>=i.getTime()&&b.date<a.getTime()),d=new Set;c.forEach(b=>{const v=new Date(b.date).toISOString().split("T")[0];d.add(v)});const h=c.reduce((b,v)=>b+v.total,0),f=c.reduce((b,v)=>b+v.score,0),p=h>0?f/h*100:0,m=l.reduce((b,v)=>b+v.total,0),g=l.reduce((b,v)=>b+v.score,0),x=m>0?g/m*100:0;let y=0;return Object.values(n.wordProgress).forEach(b=>{b.masteryLevel==="mastered"&&b.lastStudied>=r.getTime()&&y++}),{studyDays:d.size,totalDays:7,totalAnswered:h,accuracy:p,newMastered:y,previousWeekAccuracy:x}}function I0(){const n=rt(),e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const s=new Date(e.getFullYear(),e.getMonth()+1,0);s.setHours(23,59,59,999);const r=n.results.filter(h=>h.date>=t.getTime()&&h.date<=s.getTime()),o=new Set;r.forEach(h=>{const f=new Date(h.date).toISOString().split("T")[0];o.add(f)});const i=r.reduce((h,f)=>h+f.total,0),a=r.reduce((h,f)=>h+f.score,0),c=i>0?a/i*100:0;let l=0;Object.values(n.wordProgress).forEach(h=>{h.masteryLevel==="mastered"&&h.lastStudied>=t.getTime()&&l++});const d=s.getDate();return{studyDays:o.size,totalDays:d,totalAnswered:i,accuracy:c,newMastered:l}}function Yu(){const n=rt(),e=Object.values(n.wordProgress),t=e.filter(d=>(d.totalAttempts||0)>0);let s=0,r=0,o=0;const i=t.slice(0,Math.min(500,t.length)),a=t.length/i.length;i.forEach(d=>{const h=Ut(d);h<40?s++:h>=40&&h<70?r++:h>=70&&o++}),s=Math.round(s*a),r=Math.round(r*a),o=Math.round(o*a);const c=t.length,l=s*1+r*.5;return{totalWords:e.length,appearedWords:c,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:c>0?Math.round(s/c*100):0,weightedRetentionRate:c>0?Math.round(l/c*100):0,masteredPercentage:c>0?Math.round(s/c*100):0,learningPercentage:c>0?Math.round(r/c*100):0,strugglingPercentage:c>0?Math.round(o/c*100):0,masteredWords:s,learningWords:r,newWords:e.length-c,retentionRate:c>0?Math.round(s/c*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function ek(){const n=rt();let e=0,t=0,s=0,r=0,o=0;return Object.values(n.wordProgress).forEach(i=>{const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=Ut(i);if(c<20){i.consecutiveCorrect>=7?o++:i.consecutiveCorrect>=5&&r++;return}if(c>=40){t++;const{consecutiveCorrect:l}=i,d=i.correctCount/a;l===2||d>=.9&&l===1&&a>=2||a>=4&&d>=.75?(e++,s+=1):s+=Math.max(1,3-l)}}),{nearMasteryCount:e,learningCount:t,averageRemainingAnswers:t>0?Math.round(s/t*10)/10:0,longTermMemoryCount:r,superMemoryCount:o}}function k0(n=7,e=10){const t=rt(),s=Date.now()-n*24*60*60*1e3;return Object.entries(t.wordProgress).filter(([o,i])=>i.masteryLevel==="mastered"&&i.lastStudied>=s).map(([o,i])=>({word:o,masteredDate:i.lastStudied,totalAttempts:i.correctCount+i.incorrectCount})).sort((o,i)=>i.masteredDate-o.masteredDate).slice(0,e)}function Zu(){const n=rt(),t=Object.values(n.wordProgress).filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.word.startsWith("grammar_")||l.word.includes("_g")),s=t.filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.correctCount+l.incorrectCount>0);let r=0,o=0,i=0;s.forEach(l=>{const d=l.grammarAttempts||l.correctCount+l.incorrectCount,h=l.grammarCorrect||l.correctCount,f=l.grammarStreak||l.consecutiveCorrect,p=d>0?h/d*100:0;d===1&&h===1||f>=3||f>=2&&p>=80?r++:p>=50?o++:i++});const a=s.length,c=r*1+o*.5;return{totalWords:t.length,appearedWords:a,masteredCount:r,learningCount:o,strugglingCount:i,basicRetentionRate:a>0?Math.round(r/a*100):0,weightedRetentionRate:a>0?Math.round(c/a*100):0,masteredPercentage:a>0?Math.round(r/a*100):0,learningPercentage:a>0?Math.round(o/a*100):0,strugglingPercentage:a>0?Math.round(i/a*100):0,masteredWords:r,learningWords:o,newWords:t.length-a,retentionRate:a>0?Math.round(r/a*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function ed(){const n=rt(),e=Object.values(n.wordProgress),t=e.filter(c=>c.memorizationAttempts&&c.memorizationAttempts>0);let s=0,r=0,o=0;t.forEach(c=>{c.category}),t.forEach(c=>{const l=Ut(c,"memorization");l<40?s++:l>=40&&l<70?r++:l>=70&&o++});const i=t.length,a=s*1+r*.5;return{totalWords:e.length,appearedWords:i,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:i>0?Math.round(s/i*100):0,weightedRetentionRate:i>0?Math.round(a/i*100):0,masteredPercentage:i>0?Math.round(s/i*100):0,learningPercentage:i>0?Math.round(r/i*100):0,strugglingPercentage:i>0?Math.round(o/i*100):0,masteredWords:s,learningWords:r,newWords:e.length-i,retentionRate:i>0?Math.round(s/i*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function $0(){const n=rt(),e=Object.entries(n.wordProgress).filter(([r,o])=>r.startsWith("grammar_")),t=new Map;e.forEach(([r,o])=>{const i=r.match(/grammar_(?:\w+-)?g(\d+)-u(\d+)/);if(!i){r.startsWith("grammar_")&&!r.includes("unknown")&&console.warn(`‚ö†Ô∏è ÊñáÊ≥ïÂïèÈ°åID„Åå„Éë„Çø„Éº„É≥„Å´„Éû„ÉÉ„ÉÅ„Åó„Åæ„Åõ„Çì: ${r}`);return}const a=i[1],c=i[2],l=`‰∏≠${a}_Unit${c}`;t.has(l)||t.set(l,{questions:[],answered:[],correct:0,incorrect:0,mastered:0,allHistory:[]});const d=t.get(l);d.questions.push([r,o]);const h=o.grammarAttempts||o.correctCount+o.incorrectCount;if(h>0){d.answered.push([r,o]);const f=o.grammarCorrect||o.correctCount||0,p=h-f;if(d.correct+=f,d.incorrect+=p,o.learningHistory&&o.learningHistory.length>0){const v=o.learningHistory.slice(-10);d.allHistory.push(...v)}const m=o.grammarStreak||o.consecutiveCorrect||0,g=h>0?f/h*100:0,x=o.masteryLevel==="mastered",y=h===1&&f===1,b=h>=3&&g>=85;(x||y||b||m>=3)&&d.mastered++}});const s=Array.from(t.entries()).map(([r,o])=>{const i=o.correct+o.incorrect,a=i>0?o.correct/i*100:0,c=o.questions.length>0?o.answered.length/o.questions.length*100:0,d=o.allHistory.sort((h,f)=>h.timestamp-f.timestamp).slice(-10).map(h=>h.wasCorrect?"üü©":"üü•").join("");return{unit:r,totalQuestions:o.questions.length,answeredQuestions:o.answered.length,correctCount:o.correct,incorrectCount:o.incorrect,masteredCount:o.mastered,accuracy:Math.round(a),progress:Math.round(c),historyIcons:d}});return s.sort((r,o)=>r.unit.localeCompare(o.unit)),s}function kf(n){const e=rt(),s=Object.entries(e.wordProgress).map(([r,o])=>{let i=0;if(n){switch(n){case"memorization":i=o.memorizationAttempts||0;break;case"translation":i=o.translationAttempts||0;break;case"spelling":i=o.spellingAttempts||0;break;case"grammar":i=o.grammarAttempts||0;break}if(i===0)return null}else if(i=o.totalAttempts||0,i===0)return null;const a=n?Ut(o,n):Ut(o);if(a<40)return null;const c=a>=70?"incorrect":"still_learning";return{word:r,position:a,category:c,attempts:i,correctCount:o.correctCount||0,incorrectCount:o.incorrectCount||0,lastStudied:o.lastStudied||0}}).filter(r=>r!==null);return s.sort((r,o)=>o.position-r.position),s}const Np="english-progress",Yy=9999,Zy=3,gX="backup_progress_before_migration";async function xX(n){try{await wa(gX,{createdAt:new Date().toISOString(),fromVersion:n.fromVersion,toVersion:n.toVersion,storedData:n.storedData})}catch(e){E.warn("Failed to backup progress before migration:",e)}}function oi(){return{schemaVersion:mo,results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},categoryStats:{},difficultyStats:{},wordProgress:{}}}async function cs(){try{const n=await Mb();if(!n){const l=oi();return Pr(l),l}const e=S0(n==null?void 0:n.schemaVersion),t=n,s={results:t.results||[],statistics:t.statistics||{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:t.questionSetStats||{},categoryStats:{},difficultyStats:{},wordProgress:t.wordProgress||{}};s.statistics||(s.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),s.questionSetStats||(s.questionSetStats={}),s.wordProgress||(s.wordProgress={}),s.results||(s.results=[]),T0(s);const r=ZI(s,e);if(r.status==="too_new"){try{localStorage.setItem("debug_progress_schema_too_new",JSON.stringify({timestamp:new Date().toISOString(),storedVersion:r.storedVersion,supportedVersion:r.supportedVersion,notes:r.notes}))}catch{}return Pr(s),s}let o=0,i=0,a=!1;Object.values(s.wordProgress).forEach(l=>{l.category||(l.category="Êú™ÂàÜÈ°û",o++,a=!0);const d=l.memorizationAttempts||0,h=l.memorizationStillLearning||0,f=l.consecutiveIncorrect||0,p=l.memorizationPosition;if(d>0&&(h>0||f>0)){const m=typeof p=="number"?p:-1;if(m<40){const g=Ut({...l,memorizationPosition:void 0},"memorization");typeof g=="number"&&g>=40&&g>m&&(l.memorizationPosition=g,i++,a=!0)}}}),a&&(o>0&&E.info(`[Category Repair] ${o}ÂÄã„ÅÆÂçòË™û„Å´category„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`),i>0&&E.info(`[Position Repair] memorizationPosition„ÇíÂÜçË®àÁÆó„Åó„Å¶Ë£úÊ≠£: ${i}Ë™û`));try{localStorage.setItem("debug_progress_repair_summary",JSON.stringify({timestamp:new Date().toISOString(),categoryAdded:o,memorizationPositionRepaired:i,saved:a}))}catch{}const c=a||r.didMigrate;if(r.didMigrate){await xX({fromVersion:r.fromVersion,toVersion:r.toVersion,storedData:n});try{localStorage.setItem("debug_progress_migration_summary",JSON.stringify({timestamp:new Date().toISOString(),fromVersion:r.fromVersion,toVersion:r.toVersion,didMigrate:r.didMigrate,notes:r.notes}))}catch{}}return c&&await Nr(s),Pr(s),s}catch(n){E.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=oi();return Pr(e),e}}let dr=null;function yX(){return dr||(dr=oi(),E.log("üì¶ Progress cache initialized with default data")),dr}function rt(){if(dr)return dr.statistics||(E.warn("‚ö†Ô∏è Cache missing statistics, reinitializing"),dr=oi()),dr;yX();try{const n=localStorage.getItem(Np);if(!n){const s=oi();return dr=s,s}const e=JSON.parse(n),t=ZI(e,S0(e==null?void 0:e.schemaVersion));if(t.status==="ok"&&t.didMigrate)try{localStorage.setItem(Np,JSON.stringify(e))}catch{}return e.statistics||(e.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),e.questionSetStats||(e.questionSetStats={}),e.wordProgress||(e.wordProgress={}),e.results||(e.results=[]),e.results||(e.results=[]),T0(e),dr=e,e}catch(n){E.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=oi();return dr=e,e}}function Pr(n){dr=n,E.log("üîÑ progressCacheÊõ¥Êñ∞ - results‰ª∂Êï∞:",n.results.length)}async function Nr(n){try{n.schemaVersion=mo,T0(n),Pr(n);try{localStorage.setItem(Np,JSON.stringify(n))}catch(s){E.warn("LocalStorage‰øùÂ≠òÂ§±ÊïóÔºàÂÆπÈáè‰∏çË∂≥„ÅÆÂèØËÉΩÊÄßÔºâ:",s)}const e={schemaVersion:mo,quizzes:{},lastUpdated:Date.now(),totalAnswered:{},totalMastered:{},results:n.results,statistics:n.statistics,questionSetStats:n.questionSetStats,wordProgress:n.wordProgress};await jb(e)||E.error("„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}catch(e){E.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:",e)}}function T0(n){n.results.length>Yy&&(n.results.sort((e,t)=>t.date-e.date),n.results=n.results.slice(0,Yy)),Object.values(n.wordProgress).forEach(e=>{e.responseTimes&&e.responseTimes.length>Zy&&(e.responseTimes=e.responseTimes.slice(-Zy))})}async function xc(n){const e=await cs();e.results.push(n),E.log("‚úÖ addQuizResultÂëº„Å≥Âá∫„Åó:",{mode:n.mode,score:n.score,total:n.total,date:new Date(n.date).toISOString(),resultsCount:e.results.length}),wX(e,n),await Nr(e),E.log("üíæ saveProgressÂÆå‰∫Ü - results‰ª∂Êï∞:",e.results.length);try{if(typeof window<"u"){const t=new CustomEvent(sa,{detail:{result:n}});window.dispatchEvent(t)}}catch{}}function bX(n,e){return`${n}:${e}`}function wX(n,e){const t=n.statistics;t.totalQuizzes++,t.totalQuestions+=e.total,t.totalCorrect+=e.score,t.averageScore=t.totalQuestions>0?t.totalCorrect/t.totalQuestions*100:0,t.bestScore=Math.max(t.bestScore,e.percentage),t.lastStudyDate=e.date;const s=new Date(e.date).setHours(0,0,0,0);t.studyDates.includes(s)||(t.studyDates.push(s),t.studyDates.sort((c,l)=>l-c)),t.streakDays=vX(t.studyDates);const r=bX(e.mode,e.questionSetId);n.questionSetStats[r]||(n.questionSetStats[r]={attempts:0,bestScore:0,averageScore:0,lastAttempt:0,totalTimeSpent:0});const o=n.questionSetStats[r];o.attempts++,o.bestScore=Math.max(o.bestScore,e.percentage),o.lastAttempt=e.date,o.totalTimeSpent+=e.timeSpent;const i=n.results.filter(c=>c.mode===e.mode&&c.questionSetId===e.questionSetId),a=i.reduce((c,l)=>c+l.percentage,0);o.averageScore=a/i.length}function vX(n){if(n.length===0)return 0;const e=new Date().setHours(0,0,0,0),t=e-24*60*60*1e3,s=n[0];if(s!==e&&s!==t)return 0;let r=1;for(let o=1;o<n.length&&(n[o-1]-n[o])/(24*60*60*1e3)===1;o++)r++;return r}function A0(n=10){const e=rt(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{if(r<5)return;const i=e.wordProgress[o];if(!i)return;const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=i.correctCount/a*100,l=c>=80,h=a===1&&i.correctCount===1||i.consecutiveCorrect>=3||c>=85;if(l&&h){const f=r*c;s.push({word:o,totalMistakes:r,recentAccuracy:Math.round(c),overcomeScore:f})}}),s.sort((r,o)=>o.overcomeScore-r.overcomeScore).slice(0,n)}function Bh(n=10){const e=rt(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{const i=e.wordProgress[o];if(!i){s.push({word:o,mistakes:r,recentAccuracy:0,meaning:void 0,reading:void 0});return}const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=a===1&&i.correctCount===1;r>=5&&c>=80&&(l||i.consecutiveCorrect>=3||c>=85)||s.push({word:o,mistakes:r,recentAccuracy:Math.round(c),meaning:i.meaning,reading:i.reading})}),s.sort((r,o)=>o.mistakes-r.mistakes).slice(0,n)}function tk(n){return{word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,firstAttempted:Date.now(),lastStudied:0,totalResponseTime:0,averageResponseTime:0,difficultyScore:50,masteryLevel:"new",responseTimes:[],category:"new"}}function SX(n){const e=n.correctCount+n.incorrectCount;if(e===0)return 50;const s=(1-n.correctCount/e)*100,r=Math.min(n.consecutiveIncorrect*5,20),o=n.averageResponseTime/1e3,i=Math.min(o>5?(o-5)*3:0,15),a=n.userDifficultyRating?(n.userDifficultyRating-5.5)*5:0,c=s+r+i+a;return Math.max(0,Math.min(100,c))}function ho(n){const e=[1,1,3,7,14,30,90,180,365];return n>=e.length?365:e[n]||1}function E0(n,e){const t=n.correctCount+n.incorrectCount,s=t>0?n.correctCount/t:0,{consecutiveCorrect:r,lastStudied:o}=n,a=(Date.now()-o)/(1e3*60*60)/24;if(t===1&&e){const c=ho(1);return{isMastered:!0,excludeDays:c,reason:`1Áô∫Ê≠£Ëß£Ôºà${c}Êó•Âæå„Å´ÂÜçÁ¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:1}}if(r>=2&&e){const c=ho(r),l=Math.min(7,Math.floor(r/1));let d="";return r>=7?d=`Ë∂ÖÈï∑ÊúüË®òÊÜ∂ÈÅîÊàêÔºÅÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âπ¥Ê¨°Á¢∫Ë™çÔºâ`:r>=5?d=`Èï∑ÊúüË®òÊÜ∂ÂÆöÁùÄÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:r>=3?d=`Áü≠Êúü‚ÜíÈï∑ÊúüË®òÊÜ∂ÁßªË°åÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:d=`Â≠¶Áøí‰∏≠ÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âæ©ÁøíÔºâ`,{isMastered:!0,excludeDays:c,reason:d,confidence:Math.min(.99,.75+r*.05),masteryLevel:l}}if(t>=3&&s>=.9&&r>=2){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`È´òÁ≤æÂ∫¶ÂÆâÂÆöÂûãÔºàÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.88,masteryLevel:2}}if(r>=2&&a>=7&&e){const c=ho(r),l=Math.floor(c*1.5);return{isMastered:!0,excludeDays:l,reason:`Èï∑ÊúüË®òÊÜ∂ÂûãÔºà7Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.92,masteryLevel:3}}if(r>=2&&a>=3&&e){const c=ho(r),l=Math.floor(c*1.2);return{isMastered:!0,excludeDays:l,reason:`‰∏≠ÊúüË®òÊÜ∂ÂûãÔºà3Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:2}}if(r>=2&&a<=1&&s>=.85&&t>=4){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`Áü≠ÊúüÂÆåÁíßÂûãÔºà24ÊôÇÈñìÂÜÖ„Å´ÈÄ£Á∂öÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.8,masteryLevel:1}}if(t>=5&&s>=.8&&e){const c=Math.max(7,ho(2));return{isMastered:!0,excludeDays:c,reason:`È´òÂõûÊï∞ÂÆâÂÆöÂûãÔºà${t}ÂõûÊåëÊà¶„ÉªÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.83,masteryLevel:2}}if(r>=2&&s>=.75&&t>=3&&e){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`Ê¨°ÂõûÂÆöÁùÄÈÅîÊàêÔºà${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.78,masteryLevel:1}}return{isMastered:!1,excludeDays:0,reason:"Êú™ÂÆöÁùÄ",confidence:1,masteryLevel:0}}function CX(n){const e=n.correctCount+n.incorrectCount;if(e===0)return"new";const t=n.correctCount/e,s=e===1&&n.correctCount===1,r=e===2&&t===1,o=e>=5&&t>=.85,i=e>=3&&t>=.9,a=n.consecutiveCorrect>=5,c=e>=10&&t>=.75&&n.consecutiveCorrect>=2;return s||r||o||i||a||c?"mastered":"learning"}async function No(n,e,t,s,r,o){const i=await cs();let a=i.wordProgress[n];if(a||(a=tk(n),i.wordProgress[n]=a),a.lastRetentionRate!==void 0){const m=a.lastRetentionRate,g=e?1:o?.5:0;Yn(async()=>{const{getPredictionLogger:x}=await Promise.resolve().then(()=>XY);return{getPredictionLogger:x}},void 0).then(({getPredictionLogger:x})=>{x().logPrediction(n,m,g).catch(y=>{console.warn("Failed to log prediction:",y)})})}e?(a.correctCount++,a.consecutiveCorrect++,a.consecutiveIncorrect=0):o?(a.consecutiveCorrect=0,a.consecutiveIncorrect=0):(a.incorrectCount++,a.consecutiveIncorrect++,a.consecutiveCorrect=0);const c=r;c==="translation"?(a.translationAttempts=(a.translationAttempts||0)+1,e?(a.translationCorrect=(a.translationCorrect||0)+1,a.translationStreak=(a.translationStreak||0)+1):a.translationStreak=0):c==="spelling"?(a.spellingAttempts=(a.spellingAttempts||0)+1,e?(a.spellingCorrect=(a.spellingCorrect||0)+1,a.spellingStreak=(a.spellingStreak||0)+1):a.spellingStreak=0):c==="grammar"?(a.grammarAttempts=(a.grammarAttempts||0)+1,e?(a.grammarCorrect=(a.grammarCorrect||0)+1,a.grammarStreak=(a.grammarStreak||0)+1):a.grammarStreak=0):c==="memorization"&&(a.memorizationAttempts=(a.memorizationAttempts||0)+1,e?(a.memorizationCorrect=(a.memorizationCorrect||0)+1,a.memorizationStreak=(a.memorizationStreak||0)+1):o?a.memorizationStillLearning=(a.memorizationStillLearning||0)+1:a.memorizationStreak=0),a.totalAttempts=(a.translationAttempts||0)+(a.spellingAttempts||0)+(a.grammarAttempts||0)+(a.memorizationAttempts||0),a.totalResponseTime+=t;const l=a.correctCount+a.incorrectCount;if(l>0&&(a.averageResponseTime=a.totalResponseTime/l),s!==void 0&&(a.userDifficultyRating=s),a.lastStudied=Date.now(),c==="memorization"){a.easinessFactor===void 0&&(a.easinessFactor=2.5),e?a.easinessFactor=Math.min(2.5,a.easinessFactor+.1):o||(a.easinessFactor=Math.max(1.3,a.easinessFactor-.2));const m=a.memorizationStreak||0,g=a.easinessFactor;let x=0;if(m===0)x=0;else if(m===1)x=1;else if(m===2)x=3;else if(m===3)x=7;else{const y=a.reviewInterval||7;x=Math.round(y*g)}a.reviewInterval=x,a.lastReviewDate=Date.now(),a.totalReviews=(a.totalReviews||0)+1,a.avgResponseSpeed?a.avgResponseSpeed=a.avgResponseSpeed*.8+t*.2:a.avgResponseSpeed=t,t<2e3&&e&&(a.easinessFactor=Math.min(2.5,a.easinessFactor+.05))}a.learningHistory||(a.learningHistory=[]),a.learningHistory.push({timestamp:Date.now(),wasCorrect:e,responseTime:t,sessionIndex:0}),o||(a.responseTimes||(a.responseTimes=[]),a.responseTimes.push(t),a.responseTimes.length>10&&(a.responseTimes=a.responseTimes.slice(-10))),a.learningHistory.length>20&&(a.learningHistory=a.learningHistory.slice(-20)),a.difficultyScore=SX(a);const d=a.masteryLevel;a.masteryLevel=CX(a);try{const m=d!=="mastered"&&a.masteryLevel==="mastered";Yn(async()=>{const{getABTestManager:g}=await Promise.resolve().then(()=>fX);return{getABTestManager:g}},void 0).then(({getABTestManager:g})=>{const x=g(),y="chain_learning_retention_2025_01",b=x.getVariant(y);b&&Yn(async()=>{const{getMetricsCollector:v}=await import("./MetricsCollector-GSSz_ROG.js");return{getMetricsCollector:v}},[]).then(({getMetricsCollector:v})=>{v().logLearningOutcome(y,b,{word:n,isCorrect:e,isStillLearning:!!o,retentionRate:m?1:0})})})}catch{}d!==a.masteryLevel&&E.log(`üîÑ ${n}: ${d} ‚Üí ${a.masteryLevel} (Ê≠£Ëß£: ${a.correctCount}, ‰∏çÊ≠£Ëß£: ${a.incorrectCount}, ÈÄ£Á∂ö: ${a.consecutiveCorrect})`);const h=E0(a,e);h.isMastered&&(a.skipExcludeUntil=Date.now()+h.excludeDays*24*60*60*1e3,NX(n),h.reason!=="Êú™ÂÆöÁùÄ"&&E.log(`‚úÖ ${n} „ÅåÂÆöÁùÄ: ${h.reason} (Èô§Â§ñÊúüÈñì: ${h.excludeDays}Êó•)`));const p=new Ol().recalculatePriorityAfterAnswer(n,a,c);if(c==="memorization"?a.memorizationPosition=p:c==="translation"?a.translationPosition=p:c==="spelling"?a.spellingPosition=p:c==="grammar"&&(a.grammarPosition=p),a.position=p,c){const m=c==="translation"?"ÂíåË®≥":c==="spelling"?"„Çπ„Éö„É´":c==="grammar"?"ÊñáÊ≥ï":c==="memorization"?"ÊöóË®ò":"Ë™≠Ëß£";i.results.push({id:`word-${n}-${Date.now()}`,questionSetId:"individual-word",questionSetName:m,score:e?1:0,total:1,percentage:e?100:0,date:Date.now(),timeSpent:t/1e3,incorrectWords:e?[]:[n],mode:c,difficulty:a.difficultyScore>.7?"advanced":a.difficultyScore>.4?"intermediate":"beginner"})}await Nr(i);try{if(typeof window<"u"){const m=new CustomEvent(sa,{detail:{word:n,isCorrect:e,responseTime:t,mode:c}});window.dispatchEvent(m)}}catch{}try{if(typeof window<"u"&&p>=60){const m=new CustomEvent("weak-word-detected",{detail:{word:n,position:p,mode:c,isIncorrect:!e,timestamp:Date.now()}});window.dispatchEvent(m)}}catch{}}function NX(n){const e="reading-passages-data",t=localStorage.getItem(e);if(t)try{const s=JSON.parse(t);let r=!1;if(s.forEach(o=>{o.phrases&&o.phrases.forEach(i=>{i.segments&&i.segments.forEach(a=>{a.word.toLowerCase()===n.toLowerCase()&&a.isUnknown&&(a.isUnknown=!1,r=!0)})})}),r)try{localStorage.setItem(e,JSON.stringify(s))}catch(o){if(o instanceof DOMException&&o.name==="QuotaExceededError")E.warn("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±ÊïóÔºàÂÆπÈáèË∂ÖÈÅéÔºâ„ÄÇ„Éá„Éº„Çø„ÇíÂúßÁ∏Æ„Åó„Åæ„Åô„ÄÇ"),localStorage.removeItem(e),E.log("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇÊ¨°ÂõûË™≠„ÅøËæº„ÅøÊôÇ„Å´ÂÜçÂèñÂæó„Åï„Çå„Åæ„Åô„ÄÇ");else throw o}}catch(s){E.error("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞„Ç®„É©„Éº:",s)}}function Vh(n,e=30){const t=rt();t.wordProgress[n]||(t.wordProgress[n]=tk(n));const s=t.wordProgress[n];s.skippedCount=(s.skippedCount||0)+1,s.lastSkipped=Date.now(),s.skipExcludeUntil=Date.now()+e*24*60*60*1e3,Nr(t)}function R0(n){const t=rt().wordProgress[n];return t?!!(t.skipExcludeUntil&&Date.now()<t.skipExcludeUntil||t.masteryLevel==="mastered"&&t.nextReviewDate&&Date.now()<t.nextReviewDate):!1}function D0(n){return n.filter(e=>!R0(e.word))}function td(n){return rt().wordProgress[n]||null}function Pi(){const n=rt();return Object.values(n.wordProgress)}async function _0(n,e){const t=await cs();t.wordProgress[n]||(t.wordProgress[n]={word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,lastStudied:Date.now(),totalResponseTime:0,averageResponseTime:0,difficultyScore:0,masteryLevel:"new",responseTimes:[],confusedWith:[],confusionCount:0,lastConfused:Date.now()});const s=t.wordProgress[n];s.confusedWith||(s.confusedWith=[]),s.confusedWith.push({word:e,timestamp:Date.now()}),s.confusedWith.length>10&&(s.confusedWith=s.confusedWith.slice(-10)),s.confusionCount=(s.confusionCount||0)+1,s.lastConfused=Date.now(),s.difficultyScore=Math.min(100,(s.difficultyScore||0)+5),await Nr(t),Pr(t)}function P0(n=20){return Pi().filter(t=>(t.confusionCount||0)>0).sort((t,s)=>{const r=(s.confusionCount||0)-(t.confusionCount||0);return r!==0?r:(s.lastConfused||0)-(t.lastConfused||0)}).slice(0,n)}function j0(n){let t=rt().results;return n&&(t=t.filter(s=>s.mode===n)),t.reduce((s,r)=>s+r.total,0)}function nk(n){const e=rt(),t=new Set;for(const[s,r]of Object.entries(e.wordProgress)){const o=r.correctCount>0||r.incorrectCount>0,i=r.skippedCount&&r.skippedCount>0;(o||i)&&t.add(s)}return t.size}function Uh(){const n=rt();let e=0;for(const t of Object.values(n.wordProgress)){const r=t.correctCount+t.incorrectCount===1&&t.correctCount===1,o=t.consecutiveCorrect>=3,i=t.skippedCount&&t.skippedCount>0;(r||o||i)&&e++}return e}function nd(){const n=rt(),t=Object.values(n.wordProgress).filter(i=>i.correctCount+i.incorrectCount>0);let s=0;t.forEach(i=>{const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=i.masteryLevel==="mastered",d=a===1&&i.correctCount===1,h=a>=5&&c>=85,f=a>=3&&c>=90,p=i.consecutiveCorrect>=5,m=a>=10&&c>=75;(l||d||h||f||p||m)&&s++});const r=t.length>0?s/t.length*100:0,o=Math.min(100,Math.max(0,r));return{retentionRate:Math.round(o),masteredCount:s,appearedCount:t.length}}async function M0(){try{await Yk(),E.log("‚úÖ IndexedDBÂâäÈô§ÂÆå‰∫Ü")}catch(t){E.error("IndexedDBÂâäÈô§„Ç®„É©„Éº:",t)}const n=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&(s.startsWith("quiz-result-")||s==="quiz-app-user-progress"||s==="progress-data"||s.startsWith("session-history-")||s==="session-history"||s==="skipped-words"||s==="skip-groups"||s==="improvement-progress"||s==="study-settings"||s==="reading-passages-data"||s==="all-questions-cache")&&n.push(s)}n.forEach(t=>{try{localStorage.removeItem(t)}catch(s){E.error(`Failed to remove ${t}:`,s)}});const e=oi();Nr(e),E.log(`‚úÖ „É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü: LocalStorage ${n.length}ÂÄã„ÅÆ„Ç≠„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`),window.location.reload()}function F0(n=14){const e=rt(),t=new Date,s=[];E.log("üìä getStudyCalendarByModeÂëº„Å≥Âá∫„Åó - progress.results‰ª∂Êï∞:",e.results.length);for(let r=n-1;r>=0;r--){const o=new Date(t);o.setDate(o.getDate()-r);const i=q0(o),a=new Date(o).setHours(0,0,0,0),c=new Date(o).setHours(23,59,59,999),l=e.results.filter(g=>g.date>=a&&g.date<=c),d={count:0,correct:0},h={count:0,correct:0},f={count:0,correct:0},p={count:0,correct:0};l.forEach(g=>{var y;const x=((y=g.mode)==null?void 0:y.toLowerCase())||"";x.includes("memorization")||x.includes("ÊöóË®ò")?(d.count+=g.total,d.correct+=g.score):x.includes("translation")||x.includes("ÂíåË®≥")?(h.count+=g.total,h.correct+=g.score):x.includes("spelling")||x.includes("„Çπ„Éö„É´")?(f.count+=g.total,f.correct+=g.score):(x.includes("grammar")||x.includes("ÊñáÊ≥ï"))&&(p.count+=g.total,p.correct+=g.score)});const m=d.count+h.count+f.count+p.count;s.push({date:i,memorization:d,translation:h,spelling:f,grammar:p,total:m})}return s}function O0(n=12){const e=rt(),t=new Date,s=[];let r=0,o=0;for(let i=n-1;i>=0;i--){const a=new Date(t);a.setDate(t.getDate()-i*7),a.setHours(23,59,59,999);const c=new Date(a);c.setDate(a.getDate()-6),c.setHours(0,0,0,0);const d=e.results.filter(p=>p.date>=c.getTime()&&p.date<=a.getTime()).reduce((p,m)=>p+m.total,0);o+=d;let h=0;Object.values(e.wordProgress).forEach(p=>{p.masteryLevel==="mastered"&&p.lastStudied>=c.getTime()&&p.lastStudied<=a.getTime()&&h++}),r+=h;const f=`${c.getMonth()+1}/${c.getDate()}`;s.push({weekLabel:f,cumulativeMastered:r,weeklyMastered:h,cumulativeAnswered:o,weeklyAnswered:d})}return s}function L0(){const n=rt(),e=Date.now(),t=e-7*24*60*60*1e3,s=e-30*24*60*60*1e3,r=new Set,o=new Set,i=new Set,a=new Set,c=new Set,l=new Set;return n.results.forEach(d=>{d.incorrectWords.forEach(h=>{c.add(h),d.date>=s&&i.add(h),d.date>=t&&r.add(h)})}),Object.entries(n.wordProgress).forEach(([d,h])=>{h.masteryLevel==="mastered"&&(l.add(d),h.lastStudied>=s&&a.add(d),h.lastStudied>=t&&o.add(d))}),{last7Days:Math.min(100,Math.max(0,r.size>0?o.size/r.size*100:0)),last30Days:Math.min(100,Math.max(0,i.size>0?a.size/i.size*100:0)),allTime:Math.min(100,Math.max(0,c.size>0?l.size/c.size*100:0))}}function sd(n){const t=rt().wordProgress[n];if(!t)return null;const s=t.correctCount,r=t.correctCount+t.incorrectCount,a=(t.learningHistory||[]).slice(-10).map(f=>f.wasCorrect?"üü©":"üü•").join("");let c=0;if(r===0)c=0;else{const f=s/r*70,p=Math.min(20,(t.consecutiveCorrect||0)*5),m=(Date.now()-t.lastStudied)/(24*60*60*1e3),g=Math.min(10,Math.max(0,(m-1)*2));c=Math.min(100,Math.max(0,f+p-g)),t.masteryLevel==="mastered"&&(c=Math.max(90,c))}let l="new",d="Êú™Â≠¶Áøí",h="‚ö™";return r===0?(l="new",d="Êú™Â≠¶Áøí",h="‚ö™"):t.masteryLevel==="mastered"||c>=80?(l="mastered",d="ÂÆöÁùÄÊ∏à",h="üü¢"):c>=50?(l="learning",d="Â≠¶Áøí‰∏≠",h="üü°"):(l="struggling",d="Ë¶ÅÂæ©Áøí",h="üî¥"),{correctCount:s,totalCount:r,accuracyHistory:a,retentionRate:Math.round(c),status:l,statusLabel:d,statusIcon:h,position:t.position,memorizationPosition:t.memorizationPosition,translationPosition:t.translationPosition,spellingPosition:t.spellingPosition,grammarPosition:t.grammarPosition}}async function z0(n){try{await wa("memorization-card-settings",n)}catch(e){E.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-card-settings",JSON.stringify(n))}}async function W0(){try{const n=await bc("memorization-card-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"showFurigana"in n?n:null:null}catch(n){E.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-card-settings");return e?JSON.parse(e):null}}async function B0(n){try{await wa("memorization-settings",n)}catch(e){E.error("ÊöóË®òË®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-settings",JSON.stringify(n))}}async function V0(){try{const n=await bc("memorization-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"shuffleOrder"in n?n:null:null}catch(n){E.error("ÊöóË®òË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-settings");return e?JSON.parse(e):null}}async function U0(n){try{const e=await bc("memorization-behaviors"),s=[...e?typeof e=="string"?JSON.parse(e):e:[],n].slice(-1e3);await wa("memorization-behaviors",s)}catch(e){E.error("ÊöóË®òË°åÂãïË®òÈå≤„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}const sk="custom-question-sets";async function Gh(){try{const n=await bc(sk);return n?typeof n=="string"?JSON.parse(n):Array.isArray(n)?n:[]:[]}catch(n){return E.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÂèñÂæó„Ç®„É©„Éº:",n),[]}}async function rd(n){try{const e=await Gh(),t=e.findIndex(s=>s.id===n.id);t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),await wa(sk,e)}catch(e){throw E.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà‰øùÂ≠ò„Ç®„É©„Éº:",e),e}}async function od(n,e=20,t=3,s=60,r){const a=Bh(100).filter(l=>l.mistakes>=t&&l.recentAccuracy<=s).slice(0,e).map(l=>{const d=r.find(h=>h.word.toLowerCase()===l.word.toLowerCase());return d||{word:l.word,reading:l.reading||"",meaning:l.meaning||"",etymology:"",relatedWords:"",relatedFields:"",difficulty:"intermediate"}});return{id:`weak-words-${Date.now()}`,name:n,source:"weak-words",questions:a,createdAt:Date.now(),updatedAt:Date.now(),isAutoUpdate:!0,autoUpdateConfig:{limit:e,minMistakes:t,maxAccuracy:s},metadata:{description:`Ëã¶ÊâãË™ûÂè•„Åã„ÇâËá™ÂãïÁîüÊàêÔºàÈñìÈÅï„ÅÑ${t}Âõû‰ª•‰∏ä„ÄÅÊ≠£Á≠îÁéá${s}%‰ª•‰∏ãÔºâ`,totalWords:a.length}}}function id(){const n=rt(),s=Object.values(n.wordProgress).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.word.startsWith("grammar_")||a.word.includes("_g")).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.correctCount+a.incorrectCount>0);let r=0;s.forEach(a=>{const c=a.grammarAttempts||a.correctCount+a.incorrectCount,l=a.grammarCorrect||a.correctCount,d=a.grammarStreak||a.consecutiveCorrect,h=c>0?l/c*100:0,f=a.masteryLevel==="mastered",p=c===1&&l===1,m=c>=5&&h>=85,g=c>=3&&h>=90,x=d>=5,y=c>=10&&h>=75;(f||p||m||g||x||y)&&r++});const o=s.length>0?r/s.length*100:0,i=Math.min(100,Math.max(0,o));return{retentionRate:Math.round(i),masteredCount:r,appearedCount:s.length}}async function G0(){const n=$0();return(await Promise.all(n.map(async t=>{const s=t.unit.match(/‰∏≠(\d+)_Unit(\d+)/);if(!s)return null;const r=s[1],o=s[2];try{const i=await fetch(`/data/grammar/grammar_grade${r}_unit${o}.json`);if(i.ok){const a=await i.json();return a.enabled===!1?null:{...t,title:a.title||""}}}catch{return null}return null}))).filter(t=>t!==null)}function H0(n,e="memorization"){const t=rt(),s={incorrect:0,still_learning:0,mastered:0,new:0,total:n.length};return n.forEach(r=>{const o=t.wordProgress[r.word];if(!o){s.new++;return}const i=Ut(o,e);i>=70?s.incorrect++:i>=40?s.still_learning++:i>=20?s.new++:s.mastered++}),s}const eb=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:xc,addSessionHistory:ba,calculateSessionStats:H0,checkFlexibleMastery:E0,createWeakWordsQuestionSet:od,filterSkippedWords:D0,getAllWordProgress:Pi,getConfusedWords:P0,getCumulativeProgressData:O0,getCurrentWeakWords:Bh,getCustomQuestionSets:Gh,getDetailedRetentionStats:Yu,getGrammarDetailedRetentionStats:Zu,getGrammarRetentionRateWithAI:id,getGrammarUnitStats:$0,getGrammarUnitStatsWithTitles:G0,getMemorizationCardSettings:W0,getMemorizationDetailedRetentionStats:ed,getMemorizationSettings:V0,getMonthlyStats:I0,getNearMasteryStats:ek,getOvercomeWeakWords:A0,getRecentlyMasteredWords:k0,getRetentionRateWithAI:nd,getRetentionTrend:L0,getStudyCalendarByMode:F0,getStudySettings:C0,getTodayIncorrectWords:Xu,getTodayStats:Ju,getTotalAnsweredCount:j0,getTotalMasteredWordsCount:Uh,getUniqueQuestionedWordsCount:nk,getWeeklyStats:N0,getWordDetailedData:sd,getWordProgress:td,isWordSkipExcluded:R0,loadProgress:cs,loadProgressSync:rt,recordConfusion:_0,recordMemorizationBehavior:U0,recordWordSkip:Vh,resetAllProgress:M0,saveCustomQuestionSet:rd,saveMemorizationCardSettings:z0,saveMemorizationSettings:B0,saveProgress:Nr,updateProgressCache:Pr,updateWordProgress:No},Symbol.toStringTag,{value:"Module"}));function Za(n){const e=n.trim().split(`
`);if(e.length===0)return[];function t(i){const a=[];let c="",l=!1;for(let d=0;d<i.length;d++){const h=i[d],f=i[d+1];h==='"'?l&&f==='"'?(c+='"',d++):l=!l:h===","&&!l?(a.push(c.trim()),c=""):c+=h}return a.push(c.trim()),a}let s=0;const r=e[0].trim();(r.includes("Ë™ûÂè•")||r.includes("term")||r.includes("Ë™≠„Åø")||r.includes("reading")||r.includes("ÊÑèÂë≥")||r.includes("meaning"))&&(s=1);const o=[];for(let i=s;i<e.length;i++){const a=e[i].trim();if(!a||a.startsWith("//")||a.startsWith("#"))continue;const c=t(a);if(c.length>=3){const l=c[0]||"",d=c[1]||"",h=c[2]||"",f=c[3]||"";let p="",m="",g="";c.length>=8?(p=(c[4]||"")+(c[5]||""),m=c[6]||"",g=c[7]||""):(p=c[4]||"",m=c[5]||"",g=c[6]||"");let x="";g.includes("ÂàùÁ¥ö")||g==="beginner"?x="beginner":g.includes("‰∏≠Á¥ö")||g==="intermediate"?x="intermediate":(g.includes("‰∏äÁ¥ö")||g==="advanced")&&(x="advanced"),m&&!Gk(m)&&E.warn(`[„Éá„Éº„ÇøÊï¥ÂêàÊÄßË≠¶Âëä] ‰∏çÊ≠£„Å™„Ç´„ÉÜ„Ç¥„É™: "${m}" (ÂçòË™û: "${l}")
ÊúâÂäπ„Å™„Ç´„ÉÜ„Ç¥„É™: ${Db.join(", ")}
ÂèÇÁÖß: docs/specifications/19-junior-high-vocabulary.md`),l&&h&&o.push({word:l,reading:d,meaning:h,etymology:f,relatedWords:p,relatedFields:m,category:m,difficulty:x})}}return o}function Io(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function rk(n,e,t){const s=[],r=e.filter((a,c)=>c!==t),o=Io(r);for(let a=0;a<o.length&&s.length<2;a++){const c=o[a];c.meaning!==n.meaning&&!s.some(l=>l.meaning===c.meaning)&&s.push(c)}for(;s.length<2;)s.push({word:`„ÉÄ„Éü„Éº${s.length+1}`,meaning:`ÈÅ∏ÊäûËÇ¢${s.length+1}`,reading:"",etymology:"",relatedWords:"",relatedFields:"",category:"",difficulty:""});return[...Io([{text:n.meaning,question:n},...s.map(a=>({text:a.meaning,question:a}))]),{text:"ÂàÜ„Åã„Çâ„Å™„ÅÑ",question:null}]}const IX="quizApp_questionSets";function ok(n){try{localStorage.setItem(IX,JSON.stringify(n))}catch(e){E.error("Failed to save question sets:",e)}}function q0(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${s}`}const sa="quiz-result-added";function yc(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function ik(n,e=10){const s=Pi().filter(o=>o.difficultyScore>=50).sort((o,i)=>i.difficultyScore-o.difficultyScore).map(o=>o.word.toLowerCase()),r=n.filter(o=>s.includes(o.word.toLowerCase()));return Io(r).slice(0,Math.min(e,r.length))}function ak(n){if(!n.includes(" "))return"word";const e=n.toLowerCase(),t=e.split(" "),s=["get","go","come","take","make","put","look","turn","break","bring","call","carry","check","figure","fill","find","give","hand","hang","hold","keep","knock","lay","let","pass","pick","pull","push","run","set","show","shut","sit","stand","stay","stick","take","talk","think","throw","try","work","write"],r=["up","down","in","out","on","off","away","back","over","through","around","across","along","about","after","for","from","into","to","with"];return t.length>=2&&s.includes(t[0])&&t.slice(1).some(d=>r.includes(d))?"phrasal-verb":[/^a .+ of$/,/^the .+ (of|in)$/,/^(break|beat|hit|kick) (the|a)/,/^(catch|have|take|make) (a|an|the)/,/(eye|eyes|face|hand|tongue|ear|nose|heart|mind|bone)/i,/^once in a/,/^(cost|pay|worth) (an|a)/,/^at .+ (heart|first|last|once)/].some(l=>l.test(e))?"idiom":[/^(in|on|at|by|with|from|to) (the|a|an) /,/^(make|take|do|have|get) (a|an|the) /,/(strong|weak|heavy|light|high|low|good|bad|big|small) /i].some(l=>l.test(e))?"collocation":"other"}function kX(n,e=90){const t=Math.floor(e/3),s=Math.floor(e*2/3);return n<=t?1:n<=s?2:3}function $X(n){const e=Pi(),t=new Map;return e.forEach(s=>{t.set(s.word.toLowerCase(),s)}),n.filter(s=>{const r=t.get(s.word.toLowerCase());return!r||r.masteryLevel==="new"})}function TX(n){const e=Date.now(),t=Pi(),s=new Map;return t.forEach(r=>{s.set(r.word.toLowerCase(),r)}),n.filter(r=>{const o=s.get(r.word.toLowerCase());if(!o)return!1;const i=(e-o.lastStudied)/(1e3*60*60*24);let a;switch(o.masteryLevel){case"new":a=1;break;case"learning":a=Math.min(7,o.consecutiveCorrect+1);break;case"mastered":a=Math.min(30,o.consecutiveCorrect*2);break;default:a=1}return i>=a})}function AX(n,e,t){let s;switch(e){case 1:s=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),s.length<t&&(s=[...s,...n.filter(c=>c.difficulty==="‰∏≠Á¥ö")]);break;case 2:const r=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),o=n.filter(c=>c.difficulty==="‰∏≠Á¥ö");s=[...r,...o];break;case 3:const i=n.filter(c=>c.difficulty==="‰∏≠Á¥ö"),a=n.filter(c=>c.difficulty==="‰∏äÁ¥ö");s=[...i,...a];break}return Io(s).slice(0,t)}function ck(n,e){const t=n.currentDay,s=kX(t,n.totalDays),r=$X(e),o=TX(e),i=Math.ceil(n.dailyGoals.newWords*.3),a=AX(r,s,i),c=Math.ceil(n.dailyGoals.reviewWords*.4),l=ik(o.length>0?o:e,c),d=Math.floor(i*.3),h=Math.ceil(n.dailyGoals.reviewWords*.3),f=[...Io(a).slice(0,d),...Io(o.length>0?o:e).slice(0,h)];return{date:n.startDate+(t-1)*24*60*60*1e3,dayNumber:t,phase:s,morning:{newWords:a,duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"discovery"},afternoon:{reviewWords:l,duration:Math.ceil(n.dailyGoals.timeMinutes*.3),mode:"weakness"},evening:{mixedWords:Io(f),duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"mixed"},completed:!1,actualAccuracy:0}}function lk(n){const e=Pi(),t=e.filter(l=>l.masteryLevel!=="new").length,s=e.reduce((l,d)=>l+d.correctCount+d.incorrectCount,0),r=e.reduce((l,d)=>l+d.correctCount,0),o=s>0?r/s*100:0,i=t/n.currentDay,c=(4700-t)/(i||50);return{totalLearned:t,totalReviewed:s,averageAccuracy:o,estimatedCompletion:Math.ceil(c)}}function uk(n){const e=Math.ceil(n.currentDay/7),t=n.dailyGoals.newWords*7,s=n.weeklyProgress.find(r=>r.week===e);return s?s.wordsLearned/t*100:0}const EX=Object.freeze(Object.defineProperty({__proto__:null,QUIZ_RESULT_EVENT:sa,calculateProgress:lk,calculateWeeklyAchievement:uk,classifyPhraseType:ak,formatLocalYYYYMMDD:q0,generateChoicesWithQuestions:rk,generateDailyPlan:ck,generateId:yc,parseCSV:Za,saveQuestionSets:ok,selectWeakQuestions:ik,shuffle:Io},Symbol.toStringTag,{value:"Module"}));function RX(){const[n]=T.useState(()=>{const t=localStorage.getItem("autoAdvance");return t?JSON.parse(t):!1}),[e]=T.useState(()=>{const t=localStorage.getItem("autoAdvanceDelay");return t?parseInt(t,10):1500});return{autoAdvance:n,autoAdvanceDelay:e}}function DX(){const[n,e]=T.useState([]),[t,s]=T.useState("all"),[r,o]=T.useState("all"),[i,a]=T.useState("all"),[c,l]=T.useState("all");return{categoryList:n,setCategoryList:e,selectedCategory:t,setSelectedCategory:s,selectedDifficulty:r,setSelectedDifficulty:o,selectedWordPhraseFilter:i,setSelectedWordPhraseFilter:a,selectedPhraseTypeFilter:c,setSelectedPhraseTypeFilter:l}}function _X(){const[n,e]=T.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[t,s]=T.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),[r,o]=T.useState(!1),[i,a]=T.useState([]),[c,l]=T.useState(new Map);return{sessionStats:n,setSessionStats:e,quizState:t,setQuizState:s,reviewFocusMode:r,setReviewFocusMode:o,reviewQuestionPool:i,setReviewQuestionPool:a,reviewCorrectStreak:c,setReviewCorrectStreak:l}}const dk="customQuestionSets";function PX(){try{const n=localStorage.getItem(dk);if(n){const e=JSON.parse(n);return{sets:e.sets||[],activeSetId:e.activeSetId||null,recentSetIds:e.recentSetIds||[]}}}catch(n){console.error("Failed to load custom question state:",n)}return{sets:[],activeSetId:null,recentSetIds:[]}}function jX(n){try{localStorage.setItem(dk,JSON.stringify(n))}catch(e){console.error("Failed to save custom question state:",e)}}function MX(n,e,t,s){const r=new Date().toISOString();return{id:`set_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:n,description:e,words:[],createdAt:r,updatedAt:r,icon:t,color:s}}function FX(n,e,t){const s=n.sets.map(r=>r.id!==e||r.words.some(o=>o.word===t.word)?r:{...r,words:[...r.words,{...t,addedAt:new Date().toISOString()}],updatedAt:new Date().toISOString()});return{...n,sets:s,recentSetIds:WX(n.recentSetIds,e)}}function OX(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,words:r.words.filter(o=>o.word!==t.word),updatedAt:new Date().toISOString()});return{...n,sets:s}}function LX(n,e){return{...n,sets:n.sets.filter(t=>t.id!==e),activeSetId:n.activeSetId===e?null:n.activeSetId,recentSetIds:n.recentSetIds.filter(t=>t!==e)}}function zX(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,...t,updatedAt:new Date().toISOString()});return{...n,sets:s}}function WX(n,e){const t=n.filter(r=>r!==e);return[e,...t].slice(0,5)}class BX{constructor(){Ee(this,"map",new Map);Ee(this,"seqIndex",0);Ee(this,"startedAt",Date.now())}reset(){this.map.clear(),this.seqIndex=0,this.startedAt=Date.now()}onShown(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.timesShown+=1,this.map.set(e,t),this.seqIndex+=1}onAnswer(e,t){const s=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};if(!t)s.timesWrong+=1,s.lastWrongIndex=this.seqIndex;else if(s.lastWrongIndex!==void 0){const r=Math.max(0,this.seqIndex-s.lastWrongIndex);s.lags.push(r),s.lastWrongIndex=void 0}this.map.set(e,s)}onReAdd(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.readds+=1,this.map.set(e,t)}summarize(){const e=Array.from(this.map.values()),t=e.length,s=e.filter(c=>c.timesShown>=2).length,r=t>0?s/t:0,o=e.flatMap(c=>c.lags),i=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length/2)]:0,a=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length*.9)]:0;return{totalItems:t,reappearanceRate:r,medianLag:i,p90Lag:a,durationSec:Math.round((Date.now()-this.startedAt)/1e3)}}}const Br=new BX;function Ll(){const n=T.useCallback((i,a,c,l)=>{if(!a||!Array.isArray(a))return console.warn("[useQuestionRequeue] questions is null or not an array"),[];const d=i.id??i.word??String(i.japanese??""),h=i.position,f=Number.isFinite(h)?Number(h):void 0,p=(()=>{var W;if(l)try{const de=rt(),le=String(i.word??d??""),oe=(W=de==null?void 0:de.wordProgress)==null?void 0:W[le];return oe?Ut(oe,l):35}catch{return}})(),m=p??f,g={...i,sessionPriority:Date.now(),reAddedCount:(i.reAddedCount||0)+1},x=i.reAddedCount||0,y=m!==void 0&&m>=70,b=y?1+Math.floor(Math.random()*2):3+Math.floor(Math.random()*3),v=y?Math.min(x*3,18):Math.min(x*2,12),S=Math.min(c+1+12,a.length),C=a.slice(c+1,S).filter(W=>!!(W!=null&&W.sessionPriority)).length,k=y?Math.min(C*2,12):Math.min(C,8),$=b+v+k,N=l!=="memorization"?0:y?10:0,_=Math.max($,N),P=W=>{try{const de="debug_requeue_events",le=localStorage.getItem(de),oe=le?JSON.parse(le):[];oe.push(W),oe.length>30&&oe.shift(),localStorage.setItem(de,JSON.stringify(oe))}catch{}},j=Math.min(30,Math.max(10,_+5)),A=Math.min(c+j+1,a.length),M=a.slice(c+1,A).findIndex(W=>((W==null?void 0:W.id)??(W==null?void 0:W.word)??String((W==null?void 0:W.japanese)??""))===d);if(M>=0){const W=c+1+M;if(y){const de=Math.min(c+_,a.length),le=c+N,oe=N>0&&W<le;if(W<=de&&!oe)return P({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"skipped_exists_nearby",reason:"incorrect_like",currentIndex:c,windowEnd:A,baseOffset:b,extraDelay:v,plannedOffsetRaw:$,plannedOffset:_,minGapForMode:N,questionPosition:f??null,ssotPosition:p??null,effectivePosition:m??null,reAddedCountBefore:x,note:"already_scheduled_soon",existingNearbyAbsIndex:W}),a;const ge=a[W],Ae=((ge==null?void 0:ge.reAddedCount)||0)+1,Ue={...ge,sessionPriority:Date.now(),reAddedCount:Ae},Pe=[...a.slice(0,W),...a.slice(W+1)],Ne=Math.min(de,Pe.length),Ye=[...Pe.slice(0,Ne),Ue,...Pe.slice(Ne)];return P({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"inserted",reason:"incorrect_like",currentIndex:c,baseOffset:b,extraDelay:v,plannedOffsetRaw:$,plannedOffset:_,minGapForMode:N,insertAt:Ne,originalInsertAt:W,movedExisting:!0,note:oe?"moved_due_to_min_gap":"moved_existing_earlier",questionPosition:f??null,ssotPosition:p??null,effectivePosition:m??null,reAddedCountBefore:(ge==null?void 0:ge.reAddedCount)??null,reAddedCountAfter:Ae}),Ye}return P({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"skipped_exists_nearby",reason:y?"incorrect_like":"still_learning_like",currentIndex:c,windowEnd:A,baseOffset:b,extraDelay:v,plannedOffsetRaw:$,plannedOffset:_,minGapForMode:N,questionPosition:f??null,ssotPosition:p??null,effectivePosition:m??null,reAddedCountBefore:x}),a}let D=Math.min(c+_,a.length);const G=D;let te=!1;if(m!==void 0&&m>=40){const W=Math.max(D,c+1),le=Math.min(W+(y?10:30),a.length);let oe=-1;for(let ge=W;ge<le;ge++){const Ae=a[ge].position;Ae!==void 0&&Ae>=40&&(oe=ge)}if(oe>=0){const ge=D;D=oe+1,te=D!==ge;try{const Ae={timestamp:new Date().toISOString(),word:String(d),position:m,baseOffset:b,extraDelay:v,originalInsert:ge,adjustedInsert:D,currentIndex:c,nearbyHighPositions:a.slice(W,le).filter(Ne=>{const Ye=Ne.position;return Ye!==void 0&&Ye>=40}).map(Ne=>({word:Ne.word||Ne.id,position:Ne.position}))},Ue=localStorage.getItem("debug_position_aware_insertions"),Pe=Ue?JSON.parse(Ue):[];Pe.push(Ae),Pe.length>30&&Pe.shift(),localStorage.setItem("debug_position_aware_insertions",JSON.stringify(Pe))}catch{}}}try{Br.onReAdd(String(d))}catch{}return P({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"inserted",reason:y?"incorrect_like":"still_learning_like",currentIndex:c,baseOffset:b,extraDelay:v,plannedOffsetRaw:$,plannedOffset:_,minGapForMode:N,insertAt:D,originalInsertAt:G,positionAwareAdjusted:te,questionPosition:f??null,ssotPosition:p??null,effectivePosition:m??null,reAddedCountBefore:x,reAddedCountAfter:x+1}),[...a.slice(0,D),g,...a.slice(D)]},[]),e=T.useCallback((i,a)=>a>=i.length-1?i:i.map((c,l)=>{if(c.sessionPriority&&l>a&&l-a>5){const{sessionPriority:d,...h}=c;return h}return c}),[]),t=T.useCallback(i=>(i.reAddedCount||0)>0,[]),s=T.useCallback((i,a,c)=>{const l=(i.reAddedCount||0)>0;c(d=>({...d,newQuestions:l?d.newQuestions:(d.newQuestions||0)+1,reviewQuestions:l?(d.reviewQuestions||0)+1:d.reviewQuestions||0,consecutiveNew:l?0:(d.consecutiveNew||0)+1,consecutiveReview:l?(d.consecutiveReview||0)+1:0}))},[]),r=T.useCallback((i,a)=>{const c=[];return i.forEach((l,d)=>{if(d>a&&l.sessionPriority){const h=String(l.word||l.japanese||"(unknown)");c.push({word:h,reason:"still_learning",insertAt:d+1,timestamp:l.sessionPriority})}}),c},[]),o=T.useCallback((i,a)=>{try{const c=rt();if(!(c!=null&&c.wordProgress))return{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"LocalStorageÊú™ÂàùÊúüÂåñ"};let l=0,d=0;for(const f of i){const p=f.word;if(!p)continue;const m=f.position,g=Number.isFinite(m)?Number(m):null;if(g===null)continue;const x=c.wordProgress[p];if(!x)continue;const y=Ut(x,a),b=Math.abs(y-g);b>=5&&(l++,d+=b)}const h=l>=10&&d>=200;return{needsRescheduling:h,mismatchCount:l,totalDiff:d,reason:h?`‰∏çÊï¥Âêà${l}Ë™ûÔºàÂ∑ÆÂàÜÂêàË®à: ${d}Ôºâ`:"Ê≠£Â∏∏ÁØÑÂõ≤ÂÜÖ"}}catch(c){return console.error("[useQuestionRequeue] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",c),{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"„ÉÅ„Çß„ÉÉ„ÇØÂ§±Êïó"}}},[]);return{reAddQuestion:n,clearExpiredFlags:e,isReviewQuestion:t,updateRequeueStats:s,getRequeuedWords:r,checkPositionMismatch:o}}const hk="learning-assistant-skip-groups",VX=5*60*1e3;function K0(){try{const n=localStorage.getItem(hk);return n?JSON.parse(n):[]}catch(n){return E.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n),[]}}function Q0(n){try{localStorage.setItem(hk,JSON.stringify(n))}catch(e){E.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}function fk(n){const e=K0(),t=Date.now(),s=e.find(r=>r.verificationStatus==="pending"&&t-r.timestamp<VX);s?s.words.includes(n)||s.words.push(n):e.push({timestamp:t,words:[n],verificationStatus:"pending",suspiciousWords:[]}),Q0(e)}function pk(n){const e=K0(),t=rt(),s=e.find(r=>r.words.includes(n));s&&s.verificationStatus==="pending"&&(s.verificationStatus="suspicious",s.suspiciousWords=s.words.filter(r=>r!==n),s.suspiciousWords.forEach(r=>{if(t.wordProgress[r]){const o=t.wordProgress[r];delete o.skipExcludeUntil,o.masteryLevel="learning",o.consecutiveCorrect=0,o.needsVerification=!0,o.verificationReason=`ÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü„Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Å†„Å£„Åü„Åü„ÇÅ`}}),Nr(t),Q0(e),E.log(`AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü${s.suspiciousWords.length}ÂÄã„ÅÆÂçòË™û„ÇíÂÜçÂá∫È°åÂØæË±°„Å´„Åó„Åæ„Åô„ÄÇ`))}function mk(n){const e=K0(),t=rt(),s=e.find(r=>r.words.includes(n));s&&(s.suspiciousWords=s.suspiciousWords.filter(o=>o!==n),s.words.every(o=>{const i=t.wordProgress[o];return i&&(i.correctCount>0||i.incorrectCount>0)})&&s.suspiciousWords.length===0&&(s.verificationStatus="verified"),t.wordProgress[n]&&(delete t.wordProgress[n].needsVerification,delete t.wordProgress[n].verificationReason),Nr(t),Q0(e))}function UX(n,e){const t=rt(),s=new Map;e.forEach(l=>{s.set(l,{correct:0,total:0,mastered:0,wordCount:0})}),t.results.forEach(l=>{if(l.category&&s.has(l.category)){const d=s.get(l.category);d.correct+=l.score,d.total+=l.total}}),n.forEach(l=>{const d=l.category;if(!d||!s.has(d))return;const h=s.get(d);h.wordCount++;const f=t.wordProgress[l.word];if(f){const p=f.correctCount+f.incorrectCount,m=p===1&&f.correctCount===1||f.consecutiveCorrect>=3||f.skippedCount&&f.skippedCount>0,g=p>=3&&f.correctCount/p>=.8&&f.consecutiveCorrect>=2;(m||g)&&h.mastered++}});const r=[],o=[];s.forEach((l,d)=>{if(l.total===0&&l.wordCount===0)return;const h=l.total>0?l.correct/l.total*100:0,f=l.wordCount>0?l.mastered/l.wordCount*100:0,p=h*.6+f*.4;if(p<60){let m,g,x;p<40?(m="critical",g=100,x=14):p<50?(m="moderate",g=70,x=10):(m="minor",g=40,x=7),l.total<10&&(g+=20),r.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,weaknessLevel:m,priorityScore:g,estimatedImprovementDays:x})}else if(p>=75){let m;p>=90?m="expert":p>=80?m="proficient":m="good",o.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,strengthLevel:m})}}),r.sort((l,d)=>d.priorityScore-l.priorityScore),o.sort((l,d)=>d.accuracy-l.accuracy);const i=GX(s),a=HX(r),c=qX(r,o,i);return{weakCategories:r,strongCategories:o,balanceScore:i,improvementPlan:a,aiRecommendations:c}}function GX(n){const e=[];if(n.forEach(i=>{if(i.total>0){const a=i.correct/i.total*100;e.push(a)}}),e.length===0)return 50;const t=e.reduce((i,a)=>i+a,0)/e.length,s=e.reduce((i,a)=>i+Math.pow(a-t,2),0)/e.length,r=Math.sqrt(s),o=Math.max(0,Math.min(100,100-r*2));return Math.round(o)}function HX(n){const e=[],t={},s=[],r=n.slice(0,3);r.forEach(i=>{e.push(i.category);let a;i.weaknessLevel==="critical"?a=15:i.weaknessLevel==="moderate"?a=10:a=5,t[i.category]=a;const c={day:Math.ceil(i.estimatedImprovementDays/2),category:i.category,targetAccuracy:Math.min(i.accuracy+20,80),description:`${i.category}„ÅÆÊ≠£Á≠îÁéá„Çí${Math.round(i.accuracy)}%„Åã„Çâ${Math.min(i.accuracy+20,80)}%„Å´ÊîπÂñÑ`};s.push(c)});const o=r.length>0?Math.max(...r.map(i=>i.estimatedImprovementDays)):0;return{targetCategories:e,dailyQuestions:t,estimatedCompletionDays:o,milestones:s}}function qX(n,e,t){const s=[];if(n.length>0){const o=n[0];s.push(`üéØ ÊúÄÂÑ™ÂÖà: „Äå${o.category}„Äç„ÇíÈáçÁÇπÂ≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºàÁèæÂú®${Math.round(o.accuracy)}% ‚Üí ÁõÆÊ®ô80%Ôºâ`),o.weaknessLevel==="critical"&&s.push(`‚ö†Ô∏è „Äå${o.category}„Äç„ÅØÈáçË¶Å„Å™Âº±ÁÇπ„Åß„Åô„ÄÇÊØéÊó•15Âïè‰ª•‰∏äÂèñ„ÇäÁµÑ„ÇÄ„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô`),n.length>=3&&s.push(`üìö ${n.length}ÂÄã„ÅÆÂº±ÁÇπÂàÜÈáé„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ1„Å§„Åö„Å§ÈõÜ‰∏≠„Åó„Å¶ÊîπÂñÑ„Åó„Åæ„Åó„Çá„ÅÜ`)}if(t<50?s.push(`‚öñÔ∏è Â≠¶Áøí„Éê„É©„É≥„Çπ„ÅåÂÅè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„ÄÇÂº±ÁÇπÂàÜÈáé„Å´ÊôÇÈñì„ÇíÈÖçÂàÜ„Åó„Åæ„Åó„Çá„ÅÜ`):t>=80&&s.push(`‚ú® Á¥†Êô¥„Çâ„Åó„ÅÑ„Éê„É©„É≥„Çπ„Åß„ÅôÔºÅÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ`),e.length>0&&n.length>0){const o=e[0];s.push(`üí™ „Äå${o.category}„Äç„ÅØÂæóÊÑèÂàÜÈáé„Åß„ÅôÔºà${Math.round(o.accuracy)}%Ôºâ„ÄÇ„Åì„ÅÆÂ≠¶ÁøíÊñπÊ≥ï„Çí‰ªñ„ÅÆÂàÜÈáé„Å´„ÇÇÂøúÁî®„Åó„Åæ„Åó„Çá„ÅÜ`)}return n.length>0&&s.push("üß† AIÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅåÂº±ÁÇπÂàÜÈáé„ÅÆÂïèÈ°å„ÇíËá™ÂãïÁöÑ„Å´ÂÑ™ÂÖàÂá∫È°å„Åó„Åæ„Åô"),[...n,...e].reduce((o,i)=>o+i.totalAttempts,0)<50&&s.push("üìà „Åæ„Å†Â≠¶Áøí„Éá„Éº„Çø„ÅåÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ50Âïè‰ª•‰∏äËß£„Åè„Å®„Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Åå„Åß„Åç„Åæ„Åô"),s}function KX(n,e,t=30){if(e.length===0)return n.slice(0,t);const s=[],r=new Map,o=e.slice(0,3).reduce((h,f)=>h+f.priorityScore,0);e.slice(0,3).forEach(h=>{const f=Math.ceil(h.priorityScore/o*t*.7);r.set(h.category,f)}),e.slice(0,3).forEach(h=>{const f=r.get(h.category)||0,p=n.filter(y=>y.category===h.category),m=rt(),g=p.filter(y=>{const b=m.wordProgress[y.word];return b?b.consecutiveCorrect<3:!0}),x=$f(g).slice(0,f);s.push(...x)});const i=t-s.length,a=new Set(e.slice(0,3).map(h=>h.category)),c=n.filter(h=>!a.has(h.category||"")),l=new Set(s.map(h=>h.word)),d=c.filter(h=>!l.has(h.word));return s.push(...$f(d).slice(0,i)),$f(s)}function $f(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function QX(n){const e={startDate:Date.now(),currentDay:1,targetCategories:n.improvementPlan.targetCategories,initialAccuracies:{},currentAccuracies:{},improvements:{},overallProgress:0,isCompleted:!1};n.weakCategories.forEach(t=>{n.improvementPlan.targetCategories.includes(t.category)&&(e.initialAccuracies[t.category]=t.accuracy,e.currentAccuracies[t.category]=t.accuracy,e.improvements[t.category]=0)}),localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function gk(){const n=localStorage.getItem("radar-improvement-progress");if(!n)return null;try{return JSON.parse(n)}catch{return null}}function XX(n){const e=gk();if(!e)return;const t=Math.floor((Date.now()-e.startDate)/(1e3*60*60*24));e.currentDay=t+1;let s=0;e.targetCategories.forEach(r=>{const o=n.weakCategories.find(c=>c.category===r),i=(o==null?void 0:o.accuracy)||80;e.currentAccuracies[r]=i;const a=i-e.initialAccuracies[r];e.improvements[r]=a,i>=80&&s++}),e.overallProgress=s/e.targetCategories.length*100,e.isCompleted=s===e.targetCategories.length,localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function JX(n,e,t){const s=YX(t),r=ZX(t),o=e9(e,t,s);return{word:n,attempts:t,confusedWith:r,learningCurve:s,predictionModel:o}}function YX(n){if(n.length===0)return{accuracyHistory:[],stabilityScore:0,stage:"initial",forgettingPattern:{typicalDecayDays:7,forgettingCount:0},efficiency:{attemptsToMastery:10,currentProgress:0,estimatedDaysToMastery:30}};const e=[],t=5;for(let y=0;y<n.length;y++){const b=Math.max(0,y-t+1),v=n.slice(b,y+1),w=v.filter(S=>S.wasCorrect).length/v.length*100;e.push({timestamp:n[y].timestamp,accuracy:w})}const s=n.slice(-10),r=s.map((y,b)=>{const v=Math.max(0,s.length-5),w=s.slice(v,b+1);return w.filter(S=>S.wasCorrect).length/w.length*100}),o=r.reduce((y,b)=>y+b,0)/r.length,i=r.reduce((y,b)=>y+Math.pow(b-o,2),0)/r.length,a=Math.sqrt(i),c=Math.max(0,Math.min(100,100-a/30*100)),l=s.filter(y=>y.wasCorrect).length/s.length;let d;n.length<3?d="initial":l<.3?d="struggling":l<.7&&c<50?d="improving":l>=.7&&c>=50?d="consolidating":l>=.9&&c>=80?d="mastered":d="improving";const h=n.filter(y=>!y.wasCorrect),f=h.length;let p=7;if(h.length>=2){const y=[];for(let b=1;b<h.length;b++){const v=(h[b].timestamp-h[b-1].timestamp)/864e5;y.push(v)}p=y.reduce((b,v)=>b+v,0)/y.length}const m=Math.min(100,(l*100+c)/2),g=n.length<5?10:Math.ceil(10/(m/100)),x=Math.max(1,Math.ceil((100-m)/5));return{accuracyHistory:e,stabilityScore:c,stage:d,forgettingPattern:{typicalDecayDays:p,lastForgetDate:h.length>0?h[h.length-1].timestamp:void 0,forgettingCount:f},efficiency:{attemptsToMastery:g,currentProgress:m,estimatedDaysToMastery:x}}}function ZX(n){const e=new Map;return n.forEach(t=>{if(!t.wasCorrect&&t.userAnswer){const s=t.userAnswer;if(e.has(s)){const r=e.get(s);r.frequency++,r.lastConfusion=t.timestamp}else e.set(s,{confusedWord:t.userAnswer,frequency:1,lastConfusion:t.timestamp,confusionType:"meaning",similarity:.7})}}),Array.from(e.values()).sort((t,s)=>s.frequency-t.frequency).slice(0,5)}function e9(n,e,t){const s=e.slice(-5),r=s.length>0?s.filter(f=>f.wasCorrect).length/s.length*100:50,o=t.stabilityScore/100,i=e.length>0?(Date.now()-e[e.length-1].timestamp)/(1e3*60*60*24):0,a=e.slice(-10).filter(f=>!f.wasCorrect&&f.userAnswer),c=Math.min(1,a.length/5);let l=r;l+=o*20;const d=Math.exp(-i/t.forgettingPattern.typicalDecayDays);l*=d,l-=c*30,l=Math.max(0,Math.min(100,l));const h=Math.min(1,e.length/10);return{nextCorrectProbability:l,predictors:{recentAccuracy:r,stabilityFactor:o,timeSinceLastStudy:i,confusionRisk:c},confidence:h}}function t9(n,e,t){const s=[];return n.forEach(r=>{const o=e[r.word],i=t.get(r.word),a=n9(r,o,i);s.push(a)}),s.sort((r,o)=>o.priority-r.priority)}function n9(n,e,t){if(!e||!t)return{word:n.word,priority:50,reason:"Êñ∞Ë¶èÂçòË™û",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60};const s=t.learningCurve,r=t.predictionModel;switch(s.stage){case"struggling":return{word:n.word,priority:90,reason:`Ëã¶Êà¶‰∏≠ÔºàÊ≠£Á≠îÁéá${r.predictors.recentAccuracy.toFixed(0)}%Ôºâ`,strategy:"immediate_review",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:80};case"improving":{const o=r.predictors.timeSinceLastStudy,i=o>=1&&o<=3;return{word:n.word,priority:i?85:70,reason:`ÊîπÂñÑ‰∏≠Ôºà${o.toFixed(1)}Êó•ÁµåÈÅé„ÄÅÊàêÂäüÁéá${r.nextCorrectProbability.toFixed(0)}%Ôºâ`,strategy:i?"consolidation":"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:75}}case"consolidating":{const o=s.forgettingPattern.typicalDecayDays*.7,i=r.predictors.timeSinceLastStudy,a=Math.abs(i-o)<2;return{word:n.word,priority:a?60:40,reason:`ÂÆöÁùÄÂåñ‰∏≠ÔºàÊ¨°ÂõûÂæ©Áøí„Åæ„Åß${Math.max(0,o-i).toFixed(1)}Êó•Ôºâ`,strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:50}}case"mastered":return{word:n.word,priority:20,reason:"ÁøíÂæóÊ∏à„ÅøÔºàÈï∑ÊúüË®òÊÜ∂Á¢∫Ë™çÔºâ",strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:20};default:return{word:n.word,priority:50,reason:"ÂàùÊúüÊÆµÈöé",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60}}}function s9(n,e){const t=n.filter(a=>a.strategy==="immediate_review");if(t.length===0)return n;const s=[],r=t.slice(0,3);s.push(...r);const o=n.filter(a=>a.strategy==="consolidation");o.length>0&&s.push(o[0]),r.length>0&&e>=10&&s.push(r[0]);const i=n.filter(a=>!s.includes(a));return s.push(...i),s.slice(0,e)}function tb(n,e){const s=(Date.now()-e)/(1e3*60),r=n.slice(-5),o=n.slice(-10),i=r.length>0?r.filter(b=>b.wasCorrect).length/r.length*100:100,a=o.length>0?o.filter(b=>b.wasCorrect).length/o.length*100:100,c=a-i>10,l=n.length>0?n.reduce((b,v)=>b+v.responseTime,0)/n.length:3e3,d=n.slice(-5).map(b=>b.responseTime),h=r9(d);let f=0;f+=Math.min(40,s*2),c&&(f+=25),h>1.3&&(f+=20),n.slice(-3).filter(b=>!b.wasCorrect).length>=2&&(f+=15),f=Math.min(100,Math.max(0,f));const m=100-f,g=new Date().getHours();let x;g>=6&&g<12?x="morning":g>=12&&g<18?x="afternoon":g>=18&&g<22?x="evening":x="night";const y=o9(f,s,c);return{fatigueLevel:f,concentrationLevel:m,recentPerformance:{last5Accuracy:i,last10Accuracy:a,isDecreasing:c,averageResponseTime:l},sessionStats:{duration:s,questionsAnswered:n.length,correctCount:n.filter(b=>b.wasCorrect).length,startTime:e},breakRecommendation:y,timeOfDay:x}}function r9(n){if(n.length<2)return 1;const e=n.slice(-3),t=n.slice(0,Math.max(1,n.length-3)),s=e.reduce((o,i)=>o+i,0)/e.length,r=t.reduce((o,i)=>o+i,0)/t.length;return r>0?s/r:1}function o9(n,e,t){if(n>=70)return{shouldBreak:!0,reason:"Áñ≤Âä¥„ÅåËìÑÁ©ç„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ5ÂàÜ‰ºëÊÜ©„Åó„Å¶ÈõÜ‰∏≠Âäõ„ÇíÂõûÂæ©„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:5};if(e>=25&&n>=50)return{shouldBreak:!0,reason:"25ÂàÜÁµåÈÅé„Åó„Åæ„Åó„Åü„ÄÇÁü≠„ÅÑ‰ºëÊÜ©„ÅßÂäπÁéá„Åå„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÄÇ",suggestedDuration:5};if(t&&n>=40)return{shouldBreak:!0,reason:"Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ÄÂ∫¶„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:3}}function i9(n,e){const{fatigueLevel:t,concentrationLevel:s,timeOfDay:r,sessionStats:o}=e;return E.log(`üß† Ë™çÁü•Ë≤†Ëç∑AI: Áñ≤Âä¥Â∫¶${t}%, ÈõÜ‰∏≠Âäõ${s}%, ÊôÇÈñìÂ∏Ø: ${r}`),t>=70?(E.log("  üí§ Áñ≤Âä¥Â∫¶È´ò: Á∞°Âçò„Å™Âæ©ÁøíÂïèÈ°å„ÇíÂÑ™ÂÖà"),n.filter(i=>i.estimatedSuccessRate>=70||i.strategy==="spaced_repetition").map(i=>({...i,priority:i.priority+(i.estimatedSuccessRate>=80?20:0),reason:i.reason+" (Áñ≤Âä¥ÊôÇ„ÉªÊòìÂïèÂÑ™ÂÖà)"}))):t>=40?(E.log("  üòê Áñ≤Âä¥Â∫¶‰∏≠: „Éê„É©„É≥„ÇπÈáçË¶ñ"),n.map(i=>i.estimatedSuccessRate<40?{...i,priority:i.priority-20}:i)):s>=70&&o.duration<15?(E.log("  ‚ö° ÈõÜ‰∏≠ÂäõÈ´ò: Êñ∞Ë¶èÂçòË™û„ÉªÈõ£Âïè„ÇíÂÑ™ÂÖà"),n.map(i=>i.strategy==="new_learning"?{...i,priority:i.priority+30,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÊñ∞Ë¶èÂÑ™ÂÖà)"}:i.strategy==="immediate_review"&&i.estimatedSuccessRate<60?{...i,priority:i.priority+20,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÈõ£ÂïèÊåëÊà¶)"}:i)):a9(n,r)}function a9(n,e){switch(e){case"morning":return E.log("  üåÖ Êúù: Êñ∞Ë¶èÂ≠¶Áøí„ÇíÂÑ™ÂÖà"),n.map(t=>t.strategy==="new_learning"?{...t,priority:t.priority+15,reason:t.reason+" (Êúù„ÉªÊñ∞Ë¶èÊúÄÈÅ©)"}:t);case"afternoon":return E.log("  ‚òÄÔ∏è ÂçàÂæå: „Éê„É©„É≥„ÇπÂûã"),n;case"evening":return E.log("  üåÜ Â§ïÊñπ: Âæ©Áøí‰∏≠ÂøÉ"),n.map(t=>t.strategy==="spaced_repetition"||t.strategy==="consolidation"?{...t,priority:t.priority+10,reason:t.reason+" (Â§ïÊñπ„ÉªÂæ©ÁøíÊúÄÈÅ©)"}:t);case"night":return E.log("  üåô Â§ú: ËªΩ„ÅÑÂæ©Áøí„ÅÆ„Åø"),n.filter(t=>t.strategy!=="new_learning"||t.estimatedSuccessRate>=60).map(t=>t.estimatedSuccessRate>=70?{...t,priority:t.priority+15,reason:t.reason+" (Â§ú„ÉªÂæ©ÁøíÊé®Â•®)"}:t);default:return n}}function c9(n){const{fatigueLevel:e,breakRecommendation:t}=n;return t!=null&&t.shouldBreak?`üí° ${t.reason}`:e>=60?"üòå Â∞ë„ÅóÁñ≤„Çå„Å¶„Åç„Åü„Åã„ÇÇ„ÄÇÁÑ°ÁêÜ„Åõ„Åö„Éû„Ç§„Éö„Éº„Çπ„ÅßÔºÅ":e<=20?"‚ú® ÈõÜ‰∏≠Âäõ„Éê„ÉÉ„ÉÅ„É™ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ":""}function l9(n,e){const t=new Map,s=[],r=[];let o=0;const i=e.slice(-10),a=i.length>0?i.filter(h=>!h.wasCorrect).length/i.length*100:0;Object.entries(n).forEach(([h,f])=>{o+=f.incorrectCount,f.learningHistory&&f.learningHistory.filter(m=>!m.wasCorrect).forEach(m=>{if(m.userAnswer&&f9(h,m.userAnswer)&&t.set("similar_spelling",(t.get("similar_spelling")||0)+1),m.userAnswer){const g=s.find(x=>x.word1===h&&x.word2===m.userAnswer||x.word2===h&&x.word1===m.userAnswer);g?(g.confusionCount++,g.lastConfusion=m.timestamp):m.userAnswer!==h&&s.push({word1:h,word2:m.userAnswer,confusionCount:1,lastConfusion:m.timestamp,pattern:"confusion_pair"})}})});const c=e.slice(-5),l=c.length>0?c.filter(h=>!h.wasCorrect).length/c.length*100:0,d=l<a-10?"improving":l>a+10?"declining":"stable";return{totalErrors:o,errorsByPattern:t,confusionPairs:s.sort((h,f)=>f.confusionCount-h.confusionCount),weakCategories:r,recentErrorRate:a,errorTrend:d}}function u9(n,e,t,s,r){const o=[];let i=30;if(e){const f=e.correctCount+e.incorrectCount;if(f>0){const p=e.incorrectCount/f*100;p>50&&(i+=30,o.push({type:"category_weakness",weight:.3,description:"„Åì„ÅÆÂçòË™û„ÅÆÈÅéÂéª„ÅÆË™§Á≠îÁéá„ÅåÈ´ò„ÅÑ",evidence:[`Ë™§Á≠îÁéá: ${p.toFixed(0)}%`]}))}if(e.learningHistory&&e.learningHistory.length>0){const p=e.learningHistory.slice(-3),m=p.filter(g=>!g.wasCorrect).length/p.length*100;m>66&&(i+=25,o.push({type:"timing_based",weight:.25,description:"ÊúÄËøë3Âõû„ÅÆ„ÅÜ„Å°2Âõû‰ª•‰∏äÈñìÈÅï„Åà„Å¶„ÅÑ„Çã",evidence:[`Áõ¥Ëøë3Âõû„ÅÆË™§Á≠îÁéá: ${m.toFixed(0)}%`]}))}if(e.lastStudied){const p=(Date.now()-e.lastStudied)/864e5;if(p>7){const m=Math.min(20,p*2);i+=m,o.push({type:"timing_based",weight:m/100,description:"ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµåÈÅé„Åó„Å¶„ÅÑ„Çã",evidence:[`${p.toFixed(1)}Êó•Ââç„Å´Âæ©Áøí`]})}}}else i+=20,o.push({type:"category_weakness",weight:.2,description:"„Åæ„Å†Â≠¶Áøí„Åó„Åü„Åì„Å®„Åå„Å™„ÅÑÂçòË™û",evidence:["ÂàùË¶ã"]});const a=t.confusionPairs.find(f=>f.word1===n||f.word2===n);if(a&&a.confusionCount>=2){i+=15;const f=a.word1===n?a.word2:a.word1;o.push({type:"confusion_pair",weight:.15,description:`"${f}"„Å®Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ`,evidence:[`${a.confusionCount}ÂõûÊ∑∑Âêå`]})}if(s>60){const f=(s-60)/2;i+=f,o.push({type:"timing_based",weight:f/100,description:"Áñ≤Âä¥„Å´„Çà„ÇäÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Çã",evidence:[`Áñ≤Âä¥Â∫¶: ${s.toFixed(0)}%`]})}t.errorTrend==="declining"&&(i+=10,o.push({type:"category_weakness",weight:.1,description:"ÂÖ®‰ΩìÁöÑ„Å´Ë™§Á≠îÁéá„Åå‰∏äÊòáÂÇæÂêë",evidence:[`ÊúÄËøë10Âïè„ÅÆË™§Á≠îÁéá: ${t.recentErrorRate.toFixed(0)}%`]}));const c=Math.min(100,Math.max(0,i)),l=c>=80?"critical":c>=60?"high":c>=40?"medium":"low",d=d9(n,c,l,o,a),h=h9(e,o.length);return{word:n,errorRisk:c,confidence:h,primaryPattern:o.length>0?o[0].type:"category_weakness",riskFactors:o,warningLevel:l,suggestedSupport:d}}function d9(n,e,t,s,r){const o=[],i=[];let a="",c="";return t==="critical"?(a=`‚ö†Ô∏è Ê≥®ÊÑè: „Åì„ÅÆÂïèÈ°å„ÅØÈñìÈÅï„Åà„ÇÑ„Åô„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„ÅôÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÅ„Åó„Å£„Åã„ÇäËÄÉ„Åà„Å¶„Åã„ÇâÁ≠î„Åà„Åæ„Åó„Çá„ÅÜÔºÅ"):t==="high"?(a=`üîî „Åì„ÅÆÂïèÈ°å„ÅØÂ∞ë„ÅóÈõ£„Åó„ÅÑ„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„ÇìÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Çå„Å∞Â§ß‰∏àÂ§´„Åß„ÅôÔºÅ"):t==="medium"&&(a=`üí° ÊÖéÈáç„Å´Á≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶Âèñ„ÇäÁµÑ„Åø„Åæ„Åó„Çá„ÅÜÔºÅ"),s.forEach(l=>{switch(l.type){case"confusion_pair":if(r){const d=r.word1===n?r.word2:r.word1;o.push(`"${d}"„Å®Ê∑∑Âêå„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Ê≥®ÊÑè`),i.push(d)}break;case"similar_spelling":o.push("Á∂¥„Çä„Çí„Çà„ÅèÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ");break;case"timing_based":l.description.includes("ÊôÇÈñì„ÅåÁµåÈÅé")?o.push("ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÑèÂë≥„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"):l.description.includes("Áñ≤Âä¥")&&o.push("Áñ≤„Çå„Å¶„ÅÑ„Çã„Å®„Åç„ÅØÁÑ¶„Çâ„Åö„ÄÅ„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Åæ„Åó„Çá„ÅÜ");break;case"category_weakness":o.push("„Åì„ÅÆÂçòË™û„ÅØÈÅéÂéª„Å´ÈñìÈÅï„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÖéÈáç„Å´ÔºÅ");break}}),{showWarning:t!=="low",warningMessage:a,hints:o.slice(0,2),reviewWords:i,confidenceBooster:c}}function h9(n,e){let t=50;if(n){const s=n.correctCount+n.incorrectCount;t+=Math.min(30,s*5),n.learningHistory&&n.learningHistory.length>=3&&(t+=10)}return t+=Math.min(10,e*3),Math.min(100,t)}function f9(n,e){const t=p9(n.toLowerCase(),e.toLowerCase());return t>0&&t<=2}function p9(n,e){const t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=n.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let r=1;r<=n.length;r++)e.charAt(s-1)===n.charAt(r-1)?t[s][r]=t[s-1][r-1]:t[s][r]=Math.min(t[s-1][r-1]+1,t[s][r-1]+1,t[s-1][r]+1);return t[e.length][n.length]}function m9(n,e,t,s,r){const o=new Map;return n.forEach(i=>{const a=u9(i,e[i],t,s);o.set(i,a)}),o}function xk(n=Date.now()){const e=new Date(n).getHours();return e>=5&&e<12?"morning":e>=12&&e<17?"afternoon":e>=17&&e<21?"evening":"night"}function g9(n,e,t,s,r,o,i,a){const c=(e-n)/6e4,l=t>0?s/t*100:0;return{sessionId:`session_${n}`,startTime:n,endTime:e,duration:c,timeOfDay:xk(n),questionsAnswered:t,correctAnswers:s,accuracy:l,averageResponseTime:r,fatigueLevel:o,newWordsLearned:i,reviewedWords:a}}function x9(n){return["morning","afternoon","evening","night"].map(t=>{const s=n.filter(g=>g.timeOfDay===t);if(s.length===0)return{timeOfDay:t,sessionCount:0,totalQuestions:0,averageAccuracy:0,averageResponseTime:0,averageFatigue:0,efficiencyScore:0,bestForNewLearning:!1,bestForReview:!1};const r=s.reduce((g,x)=>g+x.questionsAnswered,0),i=s.reduce((g,x)=>g+x.correctAnswers,0)/r*100,a=s.reduce((g,x)=>g+x.averageResponseTime,0)/s.length,c=s.reduce((g,x)=>g+x.fatigueLevel,0)/s.length,l=s.reduce((g,x)=>g+x.newWordsLearned,0),d=s.reduce((g,x)=>g+x.reviewedWords,0),h=i,f=Math.max(0,100-a/50),p=100-c,m=h*.4+f*.3+p*.3;return{timeOfDay:t,sessionCount:s.length,totalQuestions:r,averageAccuracy:i,averageResponseTime:a,averageFatigue:c,efficiencyScore:m,bestForNewLearning:l>d,bestForReview:d>=l}}).sort((t,s)=>s.efficiencyScore-t.efficiencyScore)}function y9(n){if(n.length===0)return{optimalDuration:15,currentAverageDuration:0,performanceByDuration:[],recommendation:"Â≠¶Áøí„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åæ„Åö„ÅØ15ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ"};const e=n.reduce((a,c)=>a+c.duration,0)/n.length,s=[{min:0,max:5,label:"0-5ÂàÜ"},{min:5,max:10,label:"5-10ÂàÜ"},{min:10,max:15,label:"10-15ÂàÜ"},{min:15,max:20,label:"15-20ÂàÜ"},{min:20,max:30,label:"20-30ÂàÜ"},{min:30,max:999,label:"30ÂàÜ‰ª•‰∏ä"}].map(a=>{const c=n.filter(f=>f.duration>=a.min&&f.duration<a.max);if(c.length===0)return{durationRange:a.label,accuracy:0,efficiency:0};const l=c.reduce((f,p)=>f+p.accuracy,0)/c.length,d=c.reduce((f,p)=>f+p.fatigueLevel,0)/c.length,h=l-d*.5;return{durationRange:a.label,accuracy:l,efficiency:h}}).filter(a=>a.efficiency>0),r=s.reduce((a,c)=>c.efficiency>a.efficiency?c:a,s[0]||{durationRange:"10-15ÂàÜ",efficiency:0}),o=r?parseInt(r.durationRange.split("-")[0])+5:15;let i="";return o<10?i=`Áü≠ÊúüÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆÁü≠„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥„Çí1Êó•Ë§áÊï∞ÂõûË°å„ÅÜ„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:o<20?i=`${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Åì„ÅÆÈï∑„Åï„ÇíÁõÆÂÆâ„Å´Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`:i=`Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Å™„Çà„ÅÜ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅßÊ∑±„ÅÑÂ≠¶Áøí„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åü„Å†„Åó„ÄÅÁñ≤Âä¥„Å´Ê≥®ÊÑè„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,{optimalDuration:o,currentAverageDuration:e,performanceByDuration:s,recommendation:i}}function b9(n){if(n.length<5)return"moderate";const e=n.reduce((r,o)=>r+o.duration,0)/n.length,t=new Set(n.map(r=>new Date(r.startTime).toDateString())),s=n.length/t.size;return e<10&&s>=2?"distributed":e<10?"short_burst":e<20?"moderate":"extended"}function w9(n,e){var f,p,m;const t=b9(e),s=x9(e),r=y9(e),o=((f=s[0])==null?void 0:f.timeOfDay)||"morning",i=r.optimalDuration;let a=1;t==="distributed"||t==="short_burst"?a=3:t==="moderate"&&(a=2);const c=[],l=[];((p=s[0])==null?void 0:p.averageAccuracy)>80&&c.push(`${s[0].timeOfDay}„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑèÔºàÊ≠£Á≠îÁéá${s[0].averageAccuracy.toFixed(0)}%Ôºâ`),t==="distributed"?c.push("ÂàÜÊï£Â≠¶Áøí„Å´„Çà„ÇäË®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåËâØÂ•Ω"):t==="extended"&&c.push("Èï∑ÊôÇÈñì„ÅÆÈõÜ‰∏≠Â≠¶Áøí„ÅåÂèØËÉΩ"),e.reduce((g,x)=>g+x.fatigueLevel,0)/e.length>60&&l.push("Áñ≤Âä¥„É¨„Éô„É´„ÅåÈ´ò„ÇÅ„ÄÇ‰ºëÊÜ©„ÇíÂ¢ó„ÇÑ„Åô„Åã„ÄÅ„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÁü≠Á∏Æ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"),((m=s[s.length-1])==null?void 0:m.averageAccuracy)<60&&l.push(`${s[s.length-1].timeOfDay}„ÅÆÂ≠¶ÁøíÂäπÁéá„Åå‰Ωé„ÅÑ„Åü„ÇÅ„ÄÅÈÅø„Åë„Çã„Åì„Å®„ÇíÊé®Â•®`);const h=[];return h.push(`ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø: ${o==="morning"?"Êúù":o==="afternoon"?"ÂçàÂæå":o==="evening"?"Â§ïÊñπ":"Â§ú"}`),h.push(`Êé®Â•®„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑: ${i}ÂàÜ`),h.push(`1Êó•„ÅÆÊé®Â•®Â≠¶ÁøíÂõûÊï∞: ${a}Âõû`),t==="distributed"?h.push("Áü≠„ÅÑÂ≠¶Áøí„ÇíË§áÊï∞ÂõûË°å„ÅÜ„Çπ„Çø„Ç§„É´„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇÊúù„ÉªÊòº„ÉªÂ§ú„Å´ÂàÜ„Åë„Å¶Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ"):t==="extended"&&h.push("Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Åß„Åô„ÄÇÈÄ±Êú´„Å™„Å©„Å´„Åæ„Å®„ÇÅ„Å¶Â≠¶Áøí„Åô„ÇãÊñπÊ≥ï„ÇÇÊúâÂäπ„Åß„Åô"),{userId:n,primaryStyle:t,bestTimeOfDay:o,optimalSessionLength:i,optimalDailyFrequency:a,strengths:c,improvements:l,personalizedRecommendations:h}}function v9(n){try{const e="learning-style-sessions",t=localStorage.getItem(e),s=t?JSON.parse(t):[];s.push(n);const r=s.slice(-100);localStorage.setItem(e,JSON.stringify(r))}catch(e){E.error("Failed to save session history:",e)}}function S9(){try{const e=localStorage.getItem("learning-style-sessions");return e?JSON.parse(e):[]}catch(n){return E.error("Failed to load session history:",n),[]}}function C9(n,e){const t=e===n.bestTimeOfDay,s={morning:"Êúù",afternoon:"ÂçàÂæå",evening:"Â§ïÊñπ",night:"Â§ú"};return t?`‚ú® ‰ªä„ÅØ${s[e]}„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆÊúÄ„ÇÇÂ≠¶ÁøíÂäπÁéá„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„Åß„ÅôÔºÅ${n.optimalSessionLength}ÂàÜÁ®ãÂ∫¶„ÅÆÂ≠¶Áøí„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:`üí° ${s[n.bestTimeOfDay]}„ÅÆÂ≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÊûúÁöÑ„Åß„Åô„ÄÇÁèæÂú®„ÅØ${s[e]}„Å™„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ`}const N9={first_session:{type:"first_session",name:"Â≠¶ÁøíÈñãÂßã",description:"Âàù„ÇÅ„Å¶„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÂÆå‰∫Ü",icon:"üéì",rarity:"common"},streak_3_days:{type:"streak_3_days",name:"‰∏âÊó•Âùä‰∏ªÂÖãÊúç",description:"3Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üî•",rarity:"common"},streak_7_days:{type:"streak_7_days",name:"‰∏ÄÈÄ±Èñì„ÅÆÁøíÊÖ£",description:"7Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"‚≠ê",rarity:"rare"},streak_30_days:{type:"streak_30_days",name:"ÁøíÊÖ£„ÅÆÈÅî‰∫∫",description:"30Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üèÜ",rarity:"epic"},total_100_words:{type:"total_100_words",name:"ÁôæÂçòË™û",description:"Á¥ØË®à100ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìö",rarity:"common"},total_500_words:{type:"total_500_words",name:"‰∫îÁôæÂçòË™û",description:"Á¥ØË®à500ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìñ",rarity:"rare"},total_1000_words:{type:"total_1000_words",name:"ÂçÉÂçòË™û„Éû„Çπ„Çø„Éº",description:"Á¥ØË®à1000ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üéñÔ∏è",rarity:"epic"},perfect_session:{type:"perfect_session",name:"„Éë„Éº„Éï„Çß„ÇØ„Éà",description:"1„Çª„ÉÉ„Ç∑„Éß„É≥ÂÖ®ÂïèÊ≠£Ëß£",icon:"üíØ",rarity:"rare"},accuracy_90:{type:"accuracy_90",name:"È´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá90%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üéØ",rarity:"rare"},accuracy_95:{type:"accuracy_95",name:"Ë∂ÖÈ´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá95%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üíé",rarity:"epic"},early_bird:{type:"early_bird",name:"Êó©Ëµ∑„ÅçÈ≥•",description:"ÊúùÔºà6-9ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåÖ",rarity:"common"},night_owl:{type:"night_owl",name:"Â§úÂûãÂ≠¶Áøí",description:"Â§úÔºà21-24ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåô",rarity:"common"},speed_master:{type:"speed_master",name:"„Çπ„Éî„Éº„Éâ„Éû„Çπ„Çø„Éº",description:"Âπ≥ÂùáÂøúÁ≠îÊôÇÈñì2Áßí‰ª•‰∏ã„Çí10ÂõûÈÅîÊàê",icon:"‚ö°",rarity:"rare"},review_champion:{type:"review_champion",name:"Âæ©Áøí„ÉÅ„É£„É≥„Éî„Ç™„É≥",description:"Ë¶ÅÂæ©ÁøíÂçòË™û50ÂÄã„Çí„Éû„Çπ„Çø„Éº",icon:"‚ôªÔ∏è",rarity:"rare"},master_100:{type:"master_100",name:"ÁôæÂçòË™û„Éû„Çπ„Çø„Éº",description:"100ÂçòË™û„ÇíÂÆåÂÖ®ÁøíÂæó",icon:"üëë",rarity:"epic"},comeback:{type:"comeback",name:"„Ç´„É†„Éê„ÉÉ„ÇØ",description:"1ÈÄ±Èñì‰ª•‰∏ä„ÅÆ‰∏≠Êñ≠Âæå„Å´ÂÜçÈñã",icon:"üí™",rarity:"common"},marathon:{type:"marathon",name:"„Éû„É©„ÇΩ„É≥„É©„É≥„Éä„Éº",description:"1ÊôÇÈñì‰ª•‰∏ä„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥",icon:"üèÉ",rarity:"rare"},focused:{type:"focused",name:"ÈõÜ‰∏≠Âäõ„ÅÆÊ•µ„Åø",description:"ÈõÜ‰∏≠Âäõ„ÅÆÈ´ò„ÅÑÂ≠¶Áøí„Çí10Âõû",icon:"üßò",rarity:"rare"}},yk=n=>Math.floor(100*Math.pow(1.15,n-1)),Ba={CORRECT_ANSWER:10,PERFECT_SESSION:100,STREAK_BONUS_PER_DAY:5,SESSION_COMPLETION:50,BADGE_EARNED:200},bk=()=>{const n=localStorage.getItem("gamificationStats");if(n){const e=JSON.parse(n);return e.lastSessionDate&&(e.lastSessionDate=new Date(e.lastSessionDate)),e.badges=e.badges.map(t=>({...t,earnedAt:t.earnedAt?new Date(t.earnedAt):void 0})),e.milestones=e.milestones.map(t=>({...t,completedAt:t.completedAt?new Date(t.completedAt):void 0})),e.challenges=e.challenges.map(t=>({...t,startDate:new Date(t.startDate),endDate:new Date(t.endDate)})),e}return{level:{level:1,currentXP:0,requiredXP:yk(1),totalXP:0},badges:[],streak:{current:0,longest:0,lastStudyDate:""},milestones:k9(),challenges:[],totalSessions:0,totalWordsLearned:0,totalCorrectAnswers:0,averageAccuracy:0}},I9=n=>{localStorage.setItem("gamificationStats",JSON.stringify(n))},k9=()=>[{id:"first_10_words",title:"ÊúÄÂàù„ÅÆ10ÂçòË™û",description:"10ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:10,current:0,reward:{xp:100},completed:!1},{id:"first_50_words",title:"50ÂçòË™ûÈÅîÊàê",description:"50ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:50,current:0,reward:{xp:300,badge:"total_100_words"},completed:!1},{id:"accuracy_80",title:"Ê≠£Á≠îÁéá80%",description:"Ê≠£Á≠îÁéá80%‰ª•‰∏ä„ÇíÈÅîÊàê",target:80,current:0,reward:{xp:200},completed:!1}],$9=(n,e)=>{const t={...n};t.level.currentXP+=e,t.level.totalXP+=e;let s=!1,r;for(;t.level.currentXP>=t.level.requiredXP;)t.level.currentXP-=t.level.requiredXP,t.level.level+=1,t.level.requiredXP=yk(t.level.level),s=!0,r=t.level.level;return{stats:t,leveledUp:s,newLevel:r}},T9=n=>{const e=new Date().toISOString().split("T")[0],t=n.streak.lastStudyDate;if(!t)return{...n,streak:{current:1,longest:1,lastStudyDate:e}};if(t===e)return n;const s=new Date;s.setDate(s.getDate()-1);const r=s.toISOString().split("T")[0];if(t===r){const o=n.streak.current+1;return{...n,streak:{current:o,longest:Math.max(o,n.streak.longest),lastStudyDate:e}}}else return{...n,streak:{current:1,longest:n.streak.longest,lastStudyDate:e}}},A9=(n,e)=>{const t=[],s=new Set(n.badges.map(a=>a.type)),r=a=>{if(!s.has(a)){const c={...N9[a],earnedAt:new Date};t.push(c),s.add(a)}};n.totalSessions===1&&!s.has("first_session")&&r("first_session"),n.streak.current>=3&&r("streak_3_days"),n.streak.current>=7&&r("streak_7_days"),n.streak.current>=30&&r("streak_30_days"),n.totalWordsLearned>=100&&r("total_100_words"),n.totalWordsLearned>=500&&r("total_500_words"),n.totalWordsLearned>=1e3&&r("total_1000_words"),e.perfectScore&&r("perfect_session");const o=n.totalSessions;return e.accuracy>=90&&o>=10&&r("accuracy_90"),e.accuracy>=95&&o>=10&&r("accuracy_95"),e.timeOfDay==="morning"&&n.totalSessions>=5&&r("early_bird"),e.timeOfDay==="night"&&n.totalSessions>=5&&r("night_owl"),e.avgResponseTime<=2e3&&n.totalSessions>=10&&r("speed_master"),e.sessionDuration>=60&&r("marathon"),e.focused&&n.totalSessions>=10&&r("focused"),n.lastSessionDate&&(new Date().getTime()-n.lastSessionDate.getTime())/864e5>=7&&r("comeback"),{stats:{...n,badges:[...n.badges,...t]},newBadges:t}},E9=n=>{const e=[],t=n.milestones.map(s=>{if(s.completed)return s;let r=s.current;if(s.id.includes("words")?r=n.totalWordsLearned:s.id.includes("accuracy")&&(r=n.averageAccuracy),r>=s.target&&!s.completed){const i={...s,current:r,completed:!0,completedAt:new Date};return e.push(i),i}return{...s,current:r}});return{stats:{...n,milestones:t},completedMilestones:e}},R9=(n,e,t,s,r,o)=>{let i=bk();const a=[];let c=0;i.totalSessions+=1,i.totalWordsLearned+=r,i.totalCorrectAnswers+=n,i.averageAccuracy=(i.averageAccuracy*(i.totalSessions-1)+n/e*100)/i.totalSessions,i.lastSessionDate=new Date;const l=i.streak.current;i=T9(i),i.streak.current>l&&(a.push({type:"streak",message:`üî• ${i.streak.current}Êó•ÈÄ£Á∂öÂ≠¶ÁøíÔºÅ`,icon:"üî•",priority:4}),c+=Ba.STREAK_BONUS_PER_DAY*i.streak.current);const d=n/e*100,h=n===e;c+=n*Ba.CORRECT_ANSWER,c+=Ba.SESSION_COMPLETION,h&&(c+=Ba.PERFECT_SESSION,a.push({type:"praise",message:"üíØ „Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅÂÖ®ÂïèÊ≠£Ëß£„Åß„ÅôÔºÅ",icon:"üíØ",priority:5}));const f=new Date().getHours();let p;f>=6&&f<12?p="morning":f>=12&&f<18?p="afternoon":f>=18&&f<21?p="evening":p="night";const m=o<.3,g=A9(i,{accuracy:d,avgResponseTime:t,perfectScore:h,timeOfDay:p,sessionDuration:s,focused:m});i=g.stats,g.newBadges.length>0&&g.newBadges.forEach(b=>{a.push({type:"milestone",message:`üéñÔ∏è „Éê„ÉÉ„Ç∏Áç≤Âæó: ${b.name}`,icon:b.icon,priority:5}),c+=Ba.BADGE_EARNED});const x=E9(i);i=x.stats,x.completedMilestones.length>0&&x.completedMilestones.forEach(b=>{a.push({type:"milestone",message:`üéØ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÈÅîÊàê: ${b.title}`,icon:"üéØ",priority:4}),c+=b.reward.xp});const y=$9(i,c);return i=y.stats,y.leveledUp&&y.newLevel&&a.push({type:"level_up",message:`‚≠ê „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ Lv.${y.newLevel}`,icon:"‚≠ê",priority:5}),d<50?a.push({type:"encouragement",message:"üí™ ÁÑ¶„Çâ„ÅöÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºÅÁ∂ôÁ∂ö„ÅåÂ§ßÂàá„Åß„Åô",icon:"üí™",priority:2}):d>=50&&d<80?a.push({type:"encouragement",message:"üëç ËâØ„ÅÑ„Éö„Éº„Çπ„Åß„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÔºÅ",icon:"üëç",priority:2}):d>=80&&d<95&&a.push({type:"praise",message:"üåü Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÈ´ò„ÅÑÊ≠£Á≠îÁéá„Åß„Åô",icon:"üåü",priority:3}),I9(i),{stats:i,feedback:a.sort((b,v)=>v.priority-b.priority),xpGained:c,leveledUp:y.leveledUp,newLevel:y.newLevel}},D9=()=>{const n=bk(),e=[];return n.streak.current>0&&e.push(`üî• ${n.streak.current}Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ`),n.level.level>1&&e.push(`‚≠ê „É¨„Éô„É´ ${n.level.level}`),n.level.currentXP/n.level.requiredXP*100>80&&e.push("Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ"),e.length===0&&e.push("‰ªäÊó•„ÇÇÂ≠¶Áøí„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ"),e.join(" | ")},ti=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:xc,addSessionHistory:ba,calculateSessionStats:H0,checkFlexibleMastery:E0,createWeakWordsQuestionSet:od,filterSkippedWords:D0,getAllWordProgress:Pi,getConfusedWords:P0,getCumulativeProgressData:O0,getCurrentWeakWords:Bh,getCustomQuestionSets:Gh,getDetailedRetentionStats:Yu,getGrammarDetailedRetentionStats:Zu,getGrammarRetentionRateWithAI:id,getGrammarUnitStats:$0,getGrammarUnitStatsWithTitles:G0,getMemorizationCardSettings:W0,getMemorizationDetailedRetentionStats:ed,getMemorizationSettings:V0,getMonthlyStats:I0,getNearMasteryStats:ek,getOvercomeWeakWords:A0,getRecentlyMasteredWords:k0,getRetentionRateWithAI:nd,getRetentionTrend:L0,getStudyCalendarByMode:F0,getStudySettings:C0,getTodayIncorrectWords:Xu,getTodayStats:Ju,getTotalAnsweredCount:j0,getTotalMasteredWordsCount:Uh,getUniqueQuestionedWordsCount:nk,getWeeklyStats:N0,getWordDetailedData:sd,getWordProgress:td,isWordSkipExcluded:R0,loadProgress:cs,loadProgressSync:rt,recordConfusion:_0,recordMemorizationBehavior:U0,recordWordSkip:Vh,resetAllProgress:M0,saveCustomQuestionSet:rd,saveMemorizationCardSettings:z0,saveMemorizationSettings:B0,saveProgress:Nr,updateProgressCache:Pr,updateWordProgress:No},Symbol.toStringTag,{value:"Module"}));function fo(n){return n[Math.floor(Math.random()*n.length)]}function _9(){const n=localStorage.getItem("progress-data");if(!n)return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0};try{const t=JSON.parse(n).results||[],s=t.slice(-10),r=s.length>0?s.reduce((g,x)=>g+x.score/x.total*100,0)/s.length:0,o=new Map;t.forEach(g=>{if(g.category){const x=o.get(g.category)||{correct:0,total:0};x.correct+=g.score,x.total+=g.total,o.set(g.category,x)}});const i=[],a=[];o.forEach((g,x)=>{const y=g.total>0?g.correct/g.total*100:0;y>=80&&i.push(x),y<60&&a.push(x)});const c=s.slice(0,5),l=s.slice(-5),d=c.length>0?c.reduce((g,x)=>g+x.score/x.total*100,0)/c.length:0,f=(l.length>0?l.reduce((g,x)=>g+x.score/x.total*100,0)/l.length:0)>d+5,p=new Set(t.map(g=>new Date(g.date).toDateString())),m=Math.min(100,p.size*5);return{totalSessions:t.length,averageAccuracy:r,strongCategories:i,weakCategories:a,recentImprovement:f,consistencyScore:m}}catch{return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0}}}function X0(){const n=new Date().getHours();return n>=5&&n<12?"morning":n>=12&&n<17?"afternoon":n>=17&&n<21?"evening":"night"}class P9{generateCorrectComment(e){const t=[],s=_9();return e.attemptCount===1?(e.responseTime<3e3&&t.push(fo(["ÈÄü„ÅÑÔºÅ","ÂèçÂøú„ÅåÈã≠„ÅÑ„ÅûÔºÅ","Âç≥Á≠î„Å†„Å™ÔºÅ"])),t.push(fo(["„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","Ê≠£Ëß£„Å†ÔºÅ"]))):e.attemptCount===2?t.push(fo(["2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ","„ÇÑ„Å£„Å®Ê≠£Ëß£„Åó„Åü„Å™„ÄÇ"])):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèÊ±∫„ÇÅ„ÇçÔºÅ")),e.difficulty==="advanced"&&e.attemptCount===1?t.push(fo(["‰∏äÁ¥öÂçòË™û„Çí‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ","Èõ£„Åó„ÅÑÂçòË™û„ÇÇ„ÇØ„É™„Ç¢„Å†„Å™ÔºÅ"])):e.difficulty==="beginner"&&e.attemptCount>1&&t.push("ÂàùÁ¥ö„Åß„ÇÇ„Åü„Å§„Åè„Å™ÔºÅ"),e.correctStreak>=10?(t.push(`È©öÁï∞„ÅÆ${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(fo(["ÂÆåÂÖ®„Å´Ê≥¢„Å´‰πó„Å£„Å¶„Çã„Å™ÔºÅ","„Åì„ÅÆ„Åæ„ÅæÁ™Å„Å£Ëµ∞„ÇåÔºÅ"]))):e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(fo(["Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åü„Å™ÔºÅ","„ÅÑ„ÅÑÊµÅ„Çå„Å†ÔºÅ"]))):e.correctStreak>=3&&t.push("3ÈÄ£Á∂ö„Å†„ÄÇ"),s.recentImprovement&&s.totalSessions>=10&&t.push(fo(["ÊúÄËøë„ÅÆÊàêÈï∑„ÅåËëó„Åó„ÅÑ„ÅûÔºÅ","Ââç„Çà„ÇäÁ¢∫ÂÆü„Å´Âº∑„Åè„Å™„Å£„Å¶„ÇãÔºÅ"])),e.isWeakCategory&&e.isCorrect&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push(fo(["ÊàêÈï∑„ÇíÊÑü„Åò„Çã„ÅûÔºÅ","Âº±ÁÇπ„ÇíÊΩ∞„Åó„Åü„Å™ÔºÅ"]))),e.todayQuestions>=50&&e.todayAccuracy>=80&&t.push("‰ªäÊó•„ÅØÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ"),e.timeOfDay==="night"&&e.todayQuestions>=30&&t.push("Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÇãÔºÅ"),e.hasSeenBefore&&e.previousAttempts>2&&(t.push(`Ââç„ÅØ${e.previousAttempts}Âõû„ÇÇ„Åã„Åã„Å£„ÅüÂçòË™û„Å†„ÅûÔºÅ`),t.push("„Çà„ÅÜ„ÇÑ„ÅèË¶ö„Åà„Åü„Å™ÔºÅ")),e.learningPhase==="ENCODING"?t.push("Êñ∞Ë¶èË®òÊÜ∂„ÇíËÑ≥„Å´Âàª„ÅøËæº„Çì„Åß„Çã„ÅûÔºÅ"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„Çã„Å™ÔºÅ"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠„Å†ÔºÅ"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åü„Å™ÔºÅ"),t.push("„Åì„ÅÆË™øÂ≠ê„Å†ÔºÅüí™"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÈÅï„ÅÜÔºÅ"):t.push("„Åæ„ÅüÈñìÈÅï„Åà„ÅüÔºÅ"),e.difficulty==="beginner"&&(t.push("ÂàùÁ¥ö„ÅßÈñìÈÅï„Åà„Çã„Å®„ÅØ‚Ä¶"),t.push("Âü∫Á§é„Åã„Çâ„ÇÑ„ÇäÁõ¥„ÅõÔºÅ")),e.incorrectStreak>=3&&(t.push(`${e.incorrectStreak}ÈÄ£Á∂ö„Éü„ÇπÔºÅ`),t.push("„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ")),e.hasSeenBefore&&(t.push(`Ââç„Å´„ÇÇÈñìÈÅï„Åà„Åü${e.word}„Å†„ÅûÔºÅ`),t.push("‰ΩïÂ∫¶„ÇÑ„Çâ„Åõ„ÇãÊ∞ó„Å†ÔºÅ")),e.todayAccuracy<60&&(t.push("‰ªäÊó•„ÅÆÊ≠£Á≠îÁéá„Åå‰Ωé„ÅÑÔºÅ"),t.push("ÈõÜ‰∏≠„Åó„ÇçÔºÅ")),e.timeOfDay==="night"&&e.todayQuestions>=40?(t.push("Áñ≤„Çå„Å¶„Çã„Å™„Çâ‰ºë„ÇÅÔºÅ"),t.push("„Å†„ÅåÊòéÊó•„ÅØÂÄç„ÇÑ„Çã„Çì„Å†„ÅûÔºÅ")):t.push("Ê∞óÂêà„ÇíÂÖ•„Çå„ÇçÔºÅüî•"),t.join(" ")}}class j9{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„ÅôÔºÅ"),e.attemptCount===1?e.responseTime<3e3?t.push("Á¥†Êó©„ÅÑÂà§Êñ≠„Åß„Åó„Åü„Å≠ ‚ú®"):t.push("„Åó„Å£„Åã„ÇäËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠"):e.attemptCount===2?(t.push("2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü"),t.push("ËêΩ„Å°ÁùÄ„ÅÑ„Å¶ËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠")):e.attemptCount>=3&&(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü`),t.push("Á≤ò„ÇäÂº∑„ÅèÂèñ„ÇäÁµÑ„ÇÅ„Åæ„Åó„Åü„Å≠")),e.difficulty==="advanced"&&(t.push(`${e.word}„ÅØÈõ£„Åó„ÅÑÂçòË™û„Åß„Åó„Åü„Åå„ÄÅ`),t.push("Ë¶ã‰∫ã„Å´Ê≠£Ëß£„Åó„Åæ„Åó„ÅüÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„Åß„ÅôÔºÅ`),t.push("Á¥†Êô¥„Çâ„Åó„ÅÑÈõÜ‰∏≠Âäõ„Åß„Åô„Å≠ üå∏")):e.correctStreak>=3&&t.push("Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åæ„Åó„Åü„Å≠"),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push("Â∞ë„Åó„Åö„Å§ÂæóÊÑè„Å´„Å™„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Çà üòä")),e.hasSeenBefore&&e.previousAttempts>2&&(t.push("ÂâçÂõû„Çà„ÇäÊó©„ÅèÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠"),t.push("Á¢∫ÂÆü„Å´ÊàêÈï∑„Åó„Å¶„ÅÑ„Åæ„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ„ÇÇ„ÅÜ${e.todayQuestions}Âïè„ÇÇÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠`),t.push("ÁÑ°ÁêÜ„Åó„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„Å≠")),e.learningPhase==="ENCODING"?t.push("Ë®òÊÜ∂„ÅÆÁ¨¶Âè∑Âåñ„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô üìù"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Å≠ ‚ú®"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å„Åß„Åç„Å¶„ÅÑ„Åæ„Åô üåü"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Åü„Å≠ üéâ"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÊÉú„Åó„ÅÑ„Åß„Åô"):t.push("Èõ£„Åó„Åã„Å£„Åü„Åß„Åô„Å≠"),t.push("„Åß„ÇÇÂ§ß‰∏àÂ§´„Åß„Åô"),e.difficulty==="advanced"?(t.push(`${e.word}„ÅØ‰∏äÁ¥öÂçòË™û„Å™„ÅÆ„Åß`),t.push("‰ΩïÂ∫¶„ÅãÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ")):e.difficulty==="beginner"&&(t.push("Âü∫Á§éÁöÑ„Å™ÂçòË™û„Å™„ÅÆ„Åß"),t.push("„ÇÜ„Å£„Åè„ÇäË¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.incorrectStreak>=3&&(t.push("Â∞ë„ÅóÁñ≤„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü"),t.push("Ê∑±ÂëºÂê∏„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ üå±")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØË¶ÅÊ≥®ÊÑè„ÅÆÂçòË™û„Åß„Åô„Å≠`),t.push("‰∏ÄÁ∑í„Å´Ë¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.timeOfDay==="night"&&(t.push("Â§ú„ÅØÈõÜ‰∏≠„Åó„Å•„Çâ„ÅÑ„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô"),t.push("ÁÑ°ÁêÜ„Åõ„Åö‰ºëÊÜ©„ÇÇÂ§ßÂàá„Åß„Åô„Çà")),t.push("Ê¨°„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åô„Çà üòä"),t.join(" ")}}class M9{generateCorrectComment(e){const t=[];if(t.push("Ê≠£Ëß£„ÄÇ"),t.push(`ÂøúÁ≠îÊôÇÈñì: ${(e.responseTime/1e3).toFixed(1)}Áßí`),e.attemptCount>1&&t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.correctStreak>0){t.push(`ÈÄ£Á∂öÊ≠£Ëß£: ${e.correctStreak}`);const s=Math.min(100,e.userAccuracy+2);t.push(`Ê≠£Á≠îÁéá: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}if(e.difficulty==="advanced"&&(t.push("Èõ£ÊòìÂ∫¶: ‰∏äÁ¥ö"),t.push("ÊúüÂæÖÊ≠£Á≠îÁéá„Çí‰∏äÂõû„Çã„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ")),e.isWeakCategory){t.push(`Ëã¶Êâã„Ç´„ÉÜ„Ç¥„É™„Éº(${e.category})„ÅßÊ≠£Ëß£`);const s=Math.min(100,e.categoryAccuracy+3);t.push(`„Ç´„ÉÜ„Ç¥„É™„ÉºÊ≠£Á≠îÁéá: ${e.categoryAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return t.push("üìä"),t.join(" ")}generateIncorrectComment(e){const t=[];if(t.push("‰∏çÊ≠£Ëß£„ÄÇ"),t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.incorrectStreak>0){t.push(`ÈÄ£Á∂ö‰∏çÊ≠£Ëß£: ${e.incorrectStreak}`);const s=Math.max(0,e.userAccuracy-2);t.push(`Ê≠£Á≠îÁéáÂΩ±Èüø: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return e.difficulty==="beginner"&&(t.push("Âü∫Á§é„É¨„Éô„É´‰∏çÊ≠£Ëß£Ê§úÂá∫"),t.push("ÂÑ™ÂÖàÂæ©ÁøíÂØæË±°„Å´ËøΩÂä†")),e.hasSeenBefore&&(t.push(`Êó¢Âá∫ÂçòË™û: ${e.previousAttempts+1}ÂõûÁõÆ„ÅÆ‰∏çÊ≠£Ëß£`),t.push("ÁøíÂæóÈõ£ÊòìÂ∫¶„Çπ„Ç≥„Ç¢: È´ò")),t.push("Ê¨°ÂõûÂá∫È°åÁ¢∫Áéá: 80%"),t.join(" ")}}class F9{generateCorrectComment(e){const t=[],s=["„Éä„Ç§„ÇπÔºÅ","„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","„ÇÑ„Å£„ÅüÔºÅ"];return t.push(s[Math.floor(Math.random()*s.length)]),e.attemptCount===1?t.push("‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ"):e.attemptCount===2?t.push("Á´ã„Å¶Áõ¥„Åó„Åü„Å™ÔºÅ"):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ±∫„ÇÅ„ÅüÔºÅ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèË°å„Åì„ÅÜÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÔºÅ`),t.push("„ÅäÂâç„ÅØÁÑ°Êïµ„Å†ÔºÅüî•")):e.correctStreak>=3&&t.push("Ê≥¢„Å´‰πó„Å£„Å¶„Åç„Åü„ÅûÔºÅ"),e.difficulty==="advanced"&&(t.push(`${e.word}„ÇíÂÄí„Åó„ÅüÔºÅ`),t.push("„ÅäÂâç„ÅØÂº∑„ÅÑÔºÅüí™")),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÇíÂÖãÊúçÔºÅ`),t.push("„Åì„Çå„ÅåÊàêÈï∑„Å†ÔºÅ")),e.todayQuestions>=50&&e.todayAccuracy>=80&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÇØ„É™„Ç¢ÔºÅ`),t.push("Áµ∂Â•ΩË™ø„Å†ÔºÅüèÜ")),t.push("„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ"),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÊÉú„Åó„ÅÑÔºÅ"),e.incorrectStreak<3?(t.push("„Å†„Åå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑÔºÅ"),t.push("„ÇÇ„ÅÜ‰∏Ä‰∏ÅÔºÅ")):(t.push("ÈÄ£Á∂ö„Éü„ÇπÔºÅ"),t.push("„Å†„ÅåÂãùË≤†„ÅØ„Åì„Çå„Åã„Çâ„Å†ÔºÅ")),e.difficulty==="beginner"&&(t.push("ÁÑ¶„Å£„Åü„Å™ÔºÅ"),t.push("ËêΩ„Å°ÁùÄ„ÅëÔºÅ")),e.hasSeenBefore&&(t.push(`„Åæ„Åü${e.word}„ÅãÔºÅ`),t.push("‰ªäÂ∫¶„Åì„Åù„É™„Éô„É≥„Ç∏„Å†ÔºÅüí™")),e.todayAccuracy<60?(t.push("Ë™øÂ≠ê„ÅåÊÇ™„ÅÑ„Å™ÔºÅ"),t.push("„Å†„ÅåË≤†„Åë„Çã„Å™ÔºÅ"),t.push("„Åì„Åì„Åã„ÇâÈÄÜËª¢„Å†ÔºÅüî•")):t.push("„ÅäÂâç„Å™„Çâ„Åß„Åç„ÇãÔºÅ"),t.join(" ")}}class O9{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„Åô„ÄÇ"),t.push(`${e.word}„Å®„ÅÑ„ÅÜË®ÄËëâ„Åå„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏ÄÈÉ®„Å´„Å™„Çä„Åæ„Åó„Åü`),e.attemptCount>1&&t.push("Ëø∑„ÅÑ„ÅåÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô"),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„ÄÇ`),t.push("Ë®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåÁ¢∫ÂÆü„Å´„Å™„Çä„Åæ„Åó„Åü üåô")):e.correctStreak>=3&&t.push("Áü•Ë≠ò„ÅåÊ†π„ÇíÂºµ„ÇäÂßã„ÇÅ„Å¶„ÅÑ„Åæ„Åô üå±"),e.difficulty==="advanced"&&(t.push("Èõ£„Åó„ÅÑË®ÄËëâ„ÇíÁêÜËß£„Åó„Åæ„Åó„Åü„Å≠"),t.push("Áü•ÊÅµ„ÅåÊ∑±„Åæ„Çä„Åæ„Åô")),e.isWeakCategory&&(t.push("Ëã¶Êâã„ÇíÂÖãÊúç„Åó„Åæ„Åó„Åü"),t.push("ÊàêÈï∑„Å®„ÅØÂ§âÂåñ„ÇíÂèó„ÅëÂÖ•„Çå„Çã„Åì„Å®„Åß„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÅÆÁµåÈ®ì„ÇíÁ©ç„Åø„Åæ„Åó„Åü`),t.push("‰∏ÄÊó•‰∏ÄÊó•„ÅåÊú™Êù•„Å∏„ÅÆÊäïË≥á„Åß„Åô üìñ")),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÈñìÈÅï„ÅÑ„ÅØÂ≠¶„Å≥„ÅÆÂßã„Åæ„Çä„Åß„Åô„ÄÇ"),e.attemptCount===1?t.push("ÂÜçÂ∫¶ÊåëÊà¶„Åó„Åæ„Åó„Çá„ÅÜ"):(t.push("„Åæ„Å†ÁêÜËß£„ÅÆÈÄî‰∏≠„Åß„Åô"),t.push("ÁÑ¶„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì üå±")),e.difficulty==="beginner"&&t.push("Âü∫Á§é„Å´Êàª„Çã„Åì„Å®„ÅØÊÅ•„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"),e.incorrectStreak>=3&&(t.push("ÈÄ£Á∂ö„ÅßÈñìÈÅï„Åà„Åæ„Åó„Åü"),t.push("‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åß„Åô")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØ„ÅÇ„Å™„Åü„ÅÆË™≤È°å„Åß„Åô`),t.push("‰ΩïÂ∫¶„Åß„ÇÇÂêë„ÅçÂêà„ÅÑ„Åæ„Åó„Çá„ÅÜ")),e.todayAccuracy<60&&(t.push("Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô"),t.push("„Åó„Åã„ÅóÈÅì„ÅØÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô")),t.push("Ë®òÊÜ∂„Å®„ÅØÁπ∞„ÇäËøî„Åó„ÅÆËä∏Ë°ì„Åß„Åô üìñ"),t.join(" ")}}function wk(n,e){let t;switch(n){case"drill-sergeant":t=new P9;break;case"kind-teacher":t=new j9;break;case"analyst":t=new M9;break;case"enthusiastic-coach":t=new F9;break;case"wise-sage":t=new O9;break}return e.isCorrect?t.generateCorrectComment(e):t.generateIncorrectComment(e)}const L9={"drill-sergeant":{avatar:"üëπ",name:"È¨ºËªçÊõπ",description:"Âé≥„Åó„ÅèÈçõ„Åà„Çã",tone:"Âé≥„Åó„Åè„ÄÅÂ¶•Âçî„Å™„Åó„ÄÅÁµêÊûúÈáçË¶ñ"},"kind-teacher":{avatar:"üòä",name:"ÂÑ™„Åó„ÅÑÂÖàÁîü",description:"‰∏ÅÂØß„Å´„Çµ„Éù„Éº„Éà",tone:"ÂÑ™„Åó„Åè„ÄÅ‰∏ÅÂØß„ÄÅ„Åß„ÇÇÊ≠£Á¢∫"},analyst:{avatar:"ü§ñ",name:"ÂÜ∑Èùô„Å™ÂàÜÊûêÂÆò",description:"„Éá„Éº„Çø„ÅßÂà§Êñ≠",tone:"ÊÑüÊÉÖ„Å™„Åó„ÄÅ‰∫ãÂÆü„ÅÆ„Åø„ÄÅÁµ±Ë®àÈáçË¶ñ"},"enthusiastic-coach":{avatar:"üòº",name:"ÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ",description:"ÁÜ±„ÅèÂøúÊè¥",tone:"ÁÜ±„Åè„ÄÅ„Éù„Ç∏„ÉÜ„Ç£„Éñ„ÄÅÊåëÊà¶ÁöÑ"},"wise-sage":{avatar:"üßô",name:"Ë≥¢ËÄÖ",description:"Èï∑ÊúüË¶ñÁÇπ„ÅßÂ∞é„Åè",tone:"ËêΩ„Å°ÁùÄ„Åç„ÄÅÈï∑ÊúüË¶ñÁÇπ„ÄÅÊú¨Ë≥™ÈáçË¶ñ"}};function vk(){return localStorage.getItem("lastLoginDate")}function z9(){const n=localStorage.getItem("loginStreak");return n?parseInt(n,10):0}function W9(){const n=vk();if(!n)return 0;const e=new Date().toISOString().split("T")[0],t=new Date(n),r=new Date(e).getTime()-t.getTime();return Math.floor(r/(1e3*60*60*24))}function B9(){const n=new Date().toISOString().split("T")[0],e=localStorage.getItem(`studyStats-${n}`);if(!e)return{count:0,accuracy:0};const t=JSON.parse(e);return{count:t.count||0,accuracy:t.correct&&t.count?t.correct/t.count*100:0}}function V9(n){const e=X0(),t=W9(),s=z9(),{count:r,accuracy:o}=B9(),i={lastLoginDate:vk(),todayStudyCount:r,todayAccuracy:o};return t>=3?U9(n,t):s>=7&&r===0?G9(n,s):H9(n,e,i)}function U9(n,e){switch(n){case"drill-sergeant":return e>=7?`${e}Êó•„ÇÇÁ©∫„Åë„Çã„Å®„ÅØ‰Ωï‰∫ã„Å†ÔºÅ‰ªä„Åô„ÅêÂæ©Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ`:`${e}Êó•„Å∂„Çä„Åã„ÄÇÈÅÖ„Çå„ÇíÂèñ„ÇäÊàª„Åô„ÅûÔºÅ`;case"kind-teacher":return e>=7?`üòÉ „Åä‰πÖ„Åó„Å∂„Çä„Åß„ÅôÔºÅ${e}Êó•Áµå„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÁÑ¶„Çâ„ÅöÂ∞ë„Åó„Åö„Å§ÊÄù„ÅÑÂá∫„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`:`üòÉ ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ„ÇÜ„Å£„Åè„ÇäÂæ©Áøí„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`;case"analyst":return e>=7?`ü§ñ ÂâçÂõû„Åã„Çâ${e}Êó•ÁµåÈÅé„ÄÇË®òÊÜ∂ÂÆöÁùÄÁéá„ÅØÊé®ÂÆö40-60%„ÄÇ‰ΩìÁ≥ªÁöÑ„Å™Âæ©Áøí„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`:`ü§ñ ${e}Êó•„ÅÆÈñìÈöî„ÄÇÂøòÂç¥Êõ≤Á∑ö„ÇíËÄÉÊÖÆ„Åó„ÅüÂæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;case"enthusiastic-coach":return e>=7?`üòº ${e}Êó•„Å∂„Çä„ÅÆ„Ç´„É†„Éê„ÉÉ„ÇØÔºÅ‰ªäÊó•„Åã„ÇâÂÜç„Çπ„Çø„Éº„Éà„Å†ÔºÅÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ`:`üòº ÂæÖ„Å£„Å¶„Åü„ÅúÔºÅ${e}Êó•„ÅÆÈÅÖ„Çå„ÅØ‰ªäÊó•Âèñ„ÇäÊàª„Åù„ÅÜÔºÅ`;case"wise-sage":return e>=7?`üßô ${e}Êó•„ÅÆ‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ`:`üßô ${e}Êó•„ÅÆÁ©∫ÁôΩ„ÇÇ„ÄÅ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅÆÊôÇÈñì„Å†„Å£„Åü„ÅÆ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ„Åï„ÅÇ„ÄÅ„ÇÜ„Å£„Åè„ÇäÂÜçÈñã„Åò„ÇÉ„ÄÇ`;default:return`„ÅäÂ∏∞„Çä„Å™„Åï„ÅÑÔºÅ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ`}}function G9(n,e){switch(n){case"drill-sergeant":return`${e}Êó•ÈÄ£Á∂öÔºÅÁ¥†Êô¥„Çâ„Åó„ÅÑÁ∂ôÁ∂öÂäõ„Å†ÔºÅ‰ªäÊó•„ÇÇÊ≤πÊñ≠„Åô„Çã„Å™ÔºÅ`;case"kind-teacher":return`üòÉ ${e}Êó•ÈÄ£Á∂ö„É≠„Ç∞„Ç§„É≥„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„Çä„Åß„Åô„ÄÇ`;case"analyst":return`ü§ñ ${e}Êó•ÈÄ£Á∂ö„ÄÇÁ∂ôÁ∂öÁéá100%„ÄÇÁµ±Ë®àÁöÑ„Å´Â≠¶ÁøíÂäπÊûú„ÅØÊúÄÂ§ßÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;case"enthusiastic-coach":return`üòº ${e}Êó•ÈÄ£Á∂öÈÅîÊàêÔºÅ„Åì„ÅÆÂã¢„ÅÑ„ÅßÁ™Å„ÅçÈÄ≤„ÇÅÔºÅË®òÈå≤Êõ¥Êñ∞„Å†ÔºÅ`;case"wise-sage":return`üßô ${e}Êó•„ÅÆÁ∂ôÁ∂ö„ÄÅË¶ã‰∫ã„Åò„ÇÉ„ÄÇÂçÉÈáå„ÅÆÈÅì„ÇÇ‰∏ÄÊ≠©„Åã„Çâ„ÄÅ„Åò„ÇÉ„Å™„ÄÇ`;default:return""}}function H9(n,e,t){const{todayStudyCount:s,todayAccuracy:r}=t;switch(n){case"drill-sergeant":return q9(e,s);case"kind-teacher":return K9(e,s);case"analyst":return Q9(e,s,r);case"enthusiastic-coach":return X9(e,s);case"wise-sage":return J9(e,s);default:return null}}function q9(n,e,t){switch(n){case"morning":return e===0?"Êúù„Å†„ÅûÔºÅËÑ≥„Åå‰∏ÄÁï™ÂÜ¥„Åà„Å¶„ÇãÊôÇÈñì„Å†ÔºÅ‰ªä„Åô„ÅêÂ≠¶Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ":e>=20?"Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÇíÁ∂≠ÊåÅ„Åó„ÇçÔºÅ":"Êúù„ÅÆÂ≠¶Áøí„ÅØÂäπÊûúÁöÑ„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÑ„Çå„Çã„ÅØ„Åö„Å†ÔºÅ";case"afternoon":return e===0?"ÂçàÂæå„Å´„Å™„Å£„Åü„ÅûÔºÅ‰ªäÊó•„ÅØ„Åæ„Å†‰Ωï„ÇÇ„ÇÑ„Å£„Å¶„Å™„ÅÑ„ÅÆ„ÅãÔºü„Åï„Å£„Åï„Å®Âßã„ÇÅ„ÇçÔºÅ":e>=20?"ÂçàÂæå„ÇÇÈ†ÜË™ø„Å†„Å™ÔºÅÂçàÂâç‰∏≠„ÅÆÂã¢„ÅÑ„ÇíËêΩ„Å®„Åô„Å™ÔºÅ":"ÂçàÂæå„ÅØÈõÜ‰∏≠Âäõ„ÅåËêΩ„Å°„ÇÑ„Åô„ÅÑ„ÄÇÊ∞óÂêà„ÇíÂÖ•„ÇåÁõ¥„ÅõÔºÅ";case"evening":return e===0?"„ÇÇ„ÅÜÂ§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÂàÜ„ÅØ‰ªäÊó•‰∏≠„Å´ÁµÇ„Çè„Çâ„Åõ„ÇçÔºÅ":e>=30?"‰ªäÊó•„ÅØ„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅ„ÅÇ„Å®Â∞ë„Åó„ÅßÂÆåÁíß„Å†ÔºÅ":"Â§ïÊñπ„ÅØÂæ©Áøí„ÅÆ„Ç¥„Éº„É´„Éá„É≥„Çø„Ç§„É†„Å†ÔºÅËøΩ„ÅÑËæº„Åø„Çí„Åã„Åë„ÇçÔºÅ";case"night":return e===0?"Â§ú„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„Åü„ÅûÔºÅÂ∞ë„Åó„Åß„ÇÇ„ÅÑ„ÅÑ„Åã„ÇâÂ≠¶Áøí„Åó„ÇçÔºÅ0„Çà„Çä1„Å†ÔºÅ":e>=30?"Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅÊó©„Åè‰ºë„Çì„ÅßÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ":"Â§ú„ÅØËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåÂäπÊûúÁöÑ„Å†ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™ÔºÅ";default:return"„Åï„ÅÇ„ÄÅÂ≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„ÅûÔºÅ"}}function K9(n,e,t){switch(n){case"morning":return e===0?"üòÉ „Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅÊúù„ÅØË®òÊÜ∂Âäõ„ÅåÈ´ò„Åæ„ÇãÊôÇÈñì„Åß„Åô„Çà„ÄÇ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ":e>=20?"üòÉ Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Åß„ÇÇÁÑ°ÁêÜ„ÅØ„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åß„Åô„Å≠ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"afternoon":return e===0?"üòÉ „Åì„Çì„Å´„Å°„ÅØÔºÅÂçàÂæå„ÅØÂ∞ë„ÅóÁú†„Åè„Å™„Çä„ÇÑ„Åô„ÅÑ„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„Çà„ÄÇ":e>=20?"üòÉ ÂçàÂæå„ÇÇ„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅ‰ºëÊÜ©„ÇÇÂøò„Çå„Åö„Å´Âèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ ÂçàÂæå„ÇÇÈ†ÜË™ø„Åß„Åô„Å≠„ÄÇ„Éû„Ç§„Éö„Éº„Çπ„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ";case"evening":return e===0?"üòÉ „Åì„Çì„Å∞„Çì„ÅØ„ÄÇÂ§ïÊñπ„ÅØÂæ©Áøí„Å´ÊúÄÈÅ©„Å™ÊôÇÈñì„Åß„Åô„ÄÇ‰ªäÊó•Â≠¶„Çì„Å†„Åì„Å®„ÇíËªΩ„ÅèË¶ãÁõ¥„Åó„Å¶„Åø„Åæ„Åõ„Çì„ÅãÔºü":e>=30?"üòÉ ‰ªäÊó•„ÅØÊú¨ÂΩì„Å´„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠ÔºÅ„ÇÇ„ÅÜÂçÅÂàÜ„Åß„Åô„Çà„ÄÇ":"üòÉ Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑ„Åß„Åô„Å≠ÔºÅÁÑ¶„Çâ„Åö„ÇÜ„Å£„Åè„ÇäÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"night":return e===0?"üòÉ Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßò„Åß„Åô„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅ„Åß„Åç„ÇãÁØÑÂõ≤„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ":e>=30?"üòÉ ‰ªäÊó•„ÅØÂçÅÂàÜÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅ„Åù„Çç„Åù„Çç‰ºë„Çì„Åß„ÄÅÊòéÊó•„Å´ÂÇô„Åà„Åæ„Åó„Çá„ÅÜ„Å≠„ÄÇ":"üòÉ Â§ú„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åß„Åô„Åå„ÄÅÁù°Áú†„ÇÇÂêå„Åò„Åè„Çâ„ÅÑÂ§ßÂàá„Åß„Åô„Çà„ÄÇ";default:return"üòÉ ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Å≠ÔºÅ"}}function Q9(n,e,t){switch(n){case"morning":return e===0?"ü§ñ ÁèæÂú®ÊôÇÂàªÔºöÊúù„ÄÇËÑ≥„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÔºöÊúÄÈÅ©„ÄÇÊñ∞Ë¶èÂ≠¶ÁøíÂäπÁéáÔºö+30%„ÄÇÂ≠¶ÁøíÈñãÂßã„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êúù„ÅÆÂ≠¶Áøí${e}ÂïèÂÆå‰∫Ü„ÄÇÊ≠£Á≠îÁéá${t.toFixed(1)}%„ÄÇËâØÂ•Ω„Å™„Éö„Éº„Çπ„ÄÇ`:"ü§ñ Êúù„ÅÆÂ≠¶ÁøíÈÄ≤Ë°å‰∏≠„ÄÇË™çÁü•Ê©üËÉΩ„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÇíÊ¥ªÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";case"afternoon":return e===0?"ü§ñ ÂçàÂæå„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÈõÜ‰∏≠ÂäõÔºö„ÇÑ„ÇÑ‰Ωé‰∏ãÂÇæÂêë„ÄÇÁü≠ÊôÇÈñìÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êú¨Êó•${e}ÂïèÂ≠¶ÁøíÊ∏à„Åø„ÄÇÂçàÂæå„ÅÆÁîüÁî£ÊÄßÔºöÁ∂≠ÊåÅ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`:"ü§ñ ÂçàÂæå„ÅÆÂ≠¶ÁøíÁ∂ôÁ∂ö‰∏≠„ÄÇ15ÂàÜ√ó3„Çª„ÉÉ„Éà„ÅÆÂàÜÂâ≤Â≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";case"evening":return e===0?"ü§ñ Â§ïÊñπ„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÂæ©ÁøíÂäπÁéáÔºöÊúÄÈ´ò„É¨„Éô„É´„ÄÇ‰ªäÊó•„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÆöÁùÄ„Å´ÊúÄÈÅ©„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÈÅîÊàê„ÄÇÂçÅÂàÜ„Å™Â≠¶ÁøíÈáè„Åß„Åô„ÄÇ‰ºëÊÅØ„ÇíÊé®Â•®„ÄÇ`:"ü§ñ Â§ïÊñπ„ÅÆÂæ©Áøí„Çø„Ç§„É†„ÄÇÊúù„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÜçÁ¢∫Ë™ç„ÅåË®òÊÜ∂ÂÆöÁùÄÁéá„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ";case"night":return e===0?"ü§ñ Â§úÈñì„ÄÇÊñ∞Ë¶èÂ≠¶Áøí„Çà„ÇäÂæ©Áøí„ÇíÊé®Â•®„ÄÇÁù°Áú†Ââç„ÅÆËªΩ„ÅÑÂæ©Áøí„ÅØË®òÊÜ∂„ÅÆÂõ∫ÂÆöÂåñ„Å´ÊúâÂäπ„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÂÆå‰∫Ü„ÄÇÂ≠¶ÁøíÁõÆÊ®ôÈÅîÊàê„ÄÇ22-23ÊôÇ„ÅÆÂ∞±ÂØù„ÅßË®òÊÜ∂ÂÆöÁùÄÁéá„ÅåÂêë‰∏ä„Åó„Åæ„Åô„ÄÇ`:"ü§ñ Â§úÈñìÂ≠¶Áøí‰∏≠„ÄÇÈÅéÂ∫¶„Å™Â≠¶Áøí„ÅØÁù°Áú†„ÅÆË≥™„Çí‰Ωé‰∏ã„Åï„Åõ„Åæ„Åô„ÄÇÈÅ©Â∫¶„Å™Â≠¶Áøí„ÇíÊé®Â•®„ÄÇ";default:return"ü§ñ Â≠¶Áøí„Éá„Éº„Çø„ÇíË®òÈå≤‰∏≠„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Â≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ"}}function X9(n,e,t){switch(n){case"morning":return e===0?"üòº Êúù„Å†ÔºÅÊñ∞„Åó„ÅÑ‰∏ÄÊó•„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ‰ªäÊó•„ÇÇÊúÄÈ´ò„ÅÆÂ≠¶Áøí„Çí„Åó„Çà„ÅÜÔºÅ":e>=20?"üòº Êúù„Åã„ÇâÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ„Åì„ÅÆÂã¢„ÅÑ„Åß‰ªäÊó•„ÇÇÂÆåÁíß„Å´„ÇÑ„ÇäÈÅÇ„Åí„Çà„ÅÜÔºÅ":"üòº Êúù„ÅÆÂ≠¶Áøí„ÄÅÊúÄÈ´ò„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ";case"afternoon":return e===0?"üòº ÂçàÂæå„ÇÇÂÖÉÊ∞óÂá∫„Åó„Å¶„ÅÑ„Åì„ÅÜÔºÅ‰ªä„Åã„Çâ„Åß„ÇÇÈÅÖ„Åè„Å™„ÅÑ„ÅûÔºÅÂÖ®Âäõ„ÅßË°å„ÅëÔºÅ":e>=20?"üòº ÂçàÂæå„ÇÇÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ":"üòº ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÊ∞óÂêàÂçÅÂàÜ„Å†„Å™ÔºÅ„Åì„ÅÆË™øÂ≠ê„Åì„ÅÆË™øÂ≠êÔºÅ";case"evening":return e===0?"üòº Â§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÁõÆÊ®ô„ÅØ„Åæ„Å†ÈÅîÊàê„Åó„Å¶„Å™„ÅÑ„Å†„ÇçÔºü„Åï„ÅÇ„ÄÅ„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº ‰ªäÊó•„ÅØÂÆåÁíß„Å†ÔºÅ„ÅäÂâç„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅË™á„Çä„Å´ÊÄù„ÅàÔºÅ":"üòº Â§ïÊñπ„ÅÆËøΩ„ÅÑËæº„Åø„ÄÅËâØ„ÅÑ„ÅûÔºÅ„É©„Çπ„Éà„Çπ„Éë„Éº„Éà„Å†ÔºÅ";case"night":return e===0?"üòº Â§ú„Å†„Åë„Å©Ë´¶„ÇÅ„Çã„Å™ÔºÅ„Åü„Å£„Åü10ÂàÜ„Åß„ÇÇ„ÅÑ„ÅÑ„ÄÅ‰ªäÊó•„ÅÆÂàÜ„Çí„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßòÔºÅ‰ªäÊó•„ÅÆ„ÅäÂâç„ÅØÊúÄÈ´ò„Å†„Å£„ÅüÔºÅ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÅÔºÅ":"üòº Â§ú„ÅÆÂ≠¶Áøí„ÇÇÈ†ëÂºµ„Å£„Å¶„Çã„Å™ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™„Çà„ÄÅ„Åß„ÇÇÈ†ëÂºµ„ÇåÔºÅ";default:return"üòº „Åï„ÅÇ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ"}}function J9(n,e,t){switch(n){case"morning":return e===0?"üßô Êúù„ÅÆÈùô„Åë„Åï„ÅØÂ≠¶„Å≥„Å´ÊúÄÈÅ©„Åò„ÇÉ„ÄÇÂøÉ„ÇíËêΩ„Å°ÁùÄ„Åë„Å¶„ÄÅ„ÇÜ„Å£„Åè„ÇäÂßã„ÇÅ„Çã„Åå„Çà„ÅÑ„ÄÇ":e>=20?"üßô Êúù„Åã„ÇâËâØ„ÅÑ„Éö„Éº„Çπ„Åò„ÇÉ„ÅÆ„ÅÜ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ":"üßô Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åò„ÇÉ„Å™„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅËá™ÂàÜ„ÅÆ„Éö„Éº„Çπ„ÅßÈÄ≤„ÇÄ„ÅÆ„Åò„ÇÉ„ÄÇ";case"afternoon":return e===0?"üßô ÂçàÂæå„ÅØÂ∞ë„Åó‰ºë„Çì„Åß„Åã„ÇâÂßã„ÇÅ„Çã„ÅÆ„ÇÇËâØ„ÅÑ„Åû„ÄÇÁÑ¶„ÇãÂøÖË¶Å„ÅØ„Å™„ÅÑ„ÄÇ":e>=20?"üßô ÂçàÂæå„ÇÇÁùÄÂÆü„Å´ÈÄ≤„Çì„Åß„Åä„Çã„ÅÆ„ÅÜ„ÄÇÁ∂ôÁ∂ö„Åì„Åù„ÅåÂäõ„Åò„ÇÉ„ÄÇ":"üßô ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åå„ÄÅ‰ºëÊÅØ„ÇÇÂøò„Çå„Å¨„Çà„ÅÜ„Å´„Å™„ÄÇ";case"evening":return e===0?"üßô Â§ïÊöÆ„ÇåÊôÇ„ÅØ‰∏ÄÊó•„ÇíÊåØ„ÇäËøî„ÇãÊôÇÈñì„Åò„ÇÉ„ÄÇÂ≠¶„Å≥„ÇÇÂêå„Åò„Åè„ÄÅÂæ©Áøí„ÅåÂ§ßÂàá„Åò„ÇÉ„Åû„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅØ„Çà„ÅèÂä±„Çì„Å†„ÅÆ„ÅÜ„ÄÇÂ≠¶„Å≥„ÅØÈáè„Çà„ÇäË≥™„Åò„ÇÉ„ÄÇÂçÅÂàÜ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ":"üßô Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑÁøíÊÖ£„Åò„ÇÉ„ÄÇÊÄ•„Åå„Åö„ÄÅÁ¢∫ÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ";case"night":return e===0?"üßô Â§ú„ÅØÂøÉÁ©è„ÇÑ„Åã„Å´ÈÅé„Åî„Åô„ÅåËâØ„ÅÑ„ÄÇËªΩ„ÅÑÂæ©Áøí„Å†„Åë„Åß„ÇÇÂçÅÂàÜ„Åò„ÇÉ„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅÆÂ≠¶„Å≥„ÅØÂçÅÂàÜ„Åò„ÇÉ„ÄÇËâØ„ÅçÁù°Áú†„ÅåÊòéÊó•„Å∏„ÅÆÂäõ„Å®„Å™„Çã„ÄÇ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÄ„Åå„Çà„ÅÑ„ÄÇ":"üßô Â§úÊõ¥„Åã„Åó„ÅØ„Åª„Å©„Åª„Å©„Å´„Å™„ÄÇÁù°Áú†„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„Åû„ÄÇ";default:return"üßô Â≠¶„Å≥„Å®„ÅØÈï∑„ÅÑÊóÖ„Åò„ÇÉ„ÄÇ‰∏ÄÊ≠©„Åö„Å§„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ"}}function Y9(n,e,t){if(Math.random()>.1)return null;const s=Z9(n,e,t);return s.length===0?null:s[Math.floor(Math.random()*s.length)]}function Z9(n,e,t){const s=[];n==="drill-sergeant"&&(e&&t>=5&&(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå„Çà„ÅóÔºÅ„Åù„ÅÆË™øÂ≠ê„Å†ÔºÅ„Äç üòÉ„Äå„Å°„Çá„ÄÅ„Å°„Çá„Å£„Å®Ë§í„ÇÅ„Åô„Åé„Åß„ÅØ...„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅËâØ„ÅÑ„ÇÇ„ÅÆ„ÅØËâØ„ÅÑ„Çì„Å†ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"wise-sage",message:"üòà„ÄåÂÆåÁíß„Å†ÔºÅ„Äç üßô„Äå„Åµ„ÇÄ„ÄÅÈ¨ºËªçÊõπÊÆø„ÇÇÂ¨â„Åó„Åù„ÅÜ„Åò„ÇÉ„ÅÆ„ÅÜ„Äç üòà„Äå„Åπ„ÄÅÂà•„Å´...„Äç",type:"banter"})),e||(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå‰ΩïÂ∫¶Âêå„ÅòÈñìÈÅï„ÅÑ„Çí...ÔºÅ„Äç üòÉ„Äå„Åæ„ÅÇ„Åæ„ÅÇ„ÄÅËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÇË™∞„Å´„Åß„ÇÇËã¶Êâã„ÅØ„ÅÇ„Çä„Åæ„Åô„Åã„Çâ„Äç üòà„ÄåÁîò„ÇÑ„Åã„Åô„Å™ÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"analyst",message:"üòà„Äå„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´„ÅØË®±ÂÆπÁØÑÂõ≤ÂÜÖ„ÅÆ„Éü„Çπ„Åß„Åô„Äç üòà„Äå„Éá„Éº„Çø„Åò„ÇÉ„Å™„ÅÑ„ÄÅÊ∞óÊåÅ„Å°„ÅÆÂïèÈ°å„Å†ÔºÅ„Äç",type:"argument"})),s.push({mainTeacher:"drill-sergeant",otherTeacher:"enthusiastic-coach",message:"üòºÔºàÈÄö„Çä„Åô„Åå„ÇäÔºâ„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„ÅÆÁâπË®ì„ÅãÔºÅÈ†ëÂºµ„Çå„ÇàÔºÅ„Äç üòà„Äå...‰ΩôË®à„Å™Âè£Âá∫„Åó„Åô„Çã„Å™„Äç",type:"passerby"})),n==="kind-teacher"&&(e&&(s.push({mainTeacher:"kind-teacher",otherTeacher:"drill-sergeant",message:"üòÉ„ÄåÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå„Åæ„Å†„Åæ„Å†Ê≤πÊñ≠„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå...ËÅû„Åì„Åà„Å¶„Åæ„ÅôÔºü„Äç",type:"passerby"}),s.push({mainTeacher:"kind-teacher",otherTeacher:"wise-sage",message:"üòÉ„Äå„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ„Äç üßô„Äå„ÅÜ„ÇÄ„ÄÅÁùÄÂÆü„Å™ÊàêÈï∑„Åò„ÇÉ„Äç üòÉ„ÄåË≥¢ËÄÖÂÖàÁîü„ÇÇ„Åù„ÅÜÊÄù„Çè„Çå„Åæ„Åô„Çà„Å≠„Äç",type:"support"})),e||s.push({mainTeacher:"kind-teacher",otherTeacher:"enthusiastic-coach",message:"üòÉ„ÄåÂ§ß‰∏àÂ§´„ÄÅÊ¨°„ÅØÂøÖ„Åö„Åß„Åç„Åæ„Åô„Çà„Äç üòº„Äå„Åù„ÅÜ„Åù„ÅÜÔºÅÂ§±Êïó„ÅØÊàêÂäü„ÅÆÊØç„Å†ÔºÅ„Äç üòÉ„ÄåÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ„ÇÇÂøúÊè¥„Åó„Å¶„Åæ„Åô„Çà„Äç",type:"support"}),s.push({mainTeacher:"kind-teacher",message:"üòÉ„Äå„ÅÇ„ÄÅ„ÅäËå∂„ÇíÂÖ•„ÇåÂøò„Çå„Å¶...„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå‰ªï‰∫ã‰∏≠„Å´‰Ωï„Åó„Å¶„ÇãÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„ÇìÔºÅ„Äç",type:"joke"})),n==="analyst"&&(t>=10&&s.push({mainTeacher:"analyst",otherTeacher:"enthusiastic-coach",message:"ü§ñ„Äå10ÈÄ£Á∂öÊ≠£Ëß£„ÄÇÁµ±Ë®àÁöÑ„Å´ÊúâÊÑè„Åß„Åô„Äç üòº„Äå„Åô„Åí„ÉºÔºÅÊúÄÈ´ò„Å†ÔºÅ„Äç ü§ñ„Äå...ÊÑüÊÉÖË°®Áèæ„ÅØ‰∏çË¶Å„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",otherTeacher:"drill-sergeant",message:"ü§ñ„Äå„Éá„Éº„Çø„Å´Âü∫„Å•„Åè„Å®...„Äç üòà„ÄåÁêÜÂ±à„ÅØ„ÅÑ„ÅÑÔºÅÊ∞óÂêà„Å†ÔºÅ„Äç ü§ñ„ÄåÈùûÁßëÂ≠¶ÁöÑ„Åß„Åô„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"analyst",otherTeacher:"kind-teacher",message:"ü§ñ„ÄåÊ≠£Á≠îÁéá73.4%„Äç üòÉ„Äå„ÅÇ„ÅÆ...„ÇÇ„ÅÜÂ∞ë„ÅóÂÑ™„Åó„Åè‰ºù„Åà„Çâ„Çå„Åæ„Åõ„Çì„ÅãÔºü„Äç ü§ñ„Äå‰∫ãÂÆü„ÇíËø∞„Åπ„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",message:"ü§ñ„Äå...„Ç≥„Éº„Éí„Éº„ÅÆ„Ç´„Éï„Çß„Ç§„É≥Âê´ÊúâÈáè„ÅØ...„Äç üòÉ„ÄåÂàÜÊûêÂÆòÂÖàÁîü„ÄÅ‰ªä„ÅØÊéàÊ•≠‰∏≠„Åß„Åô„Çà„Äç ü§ñ„ÄåÂ§±Á§º„Åó„Åæ„Åó„Åü„Äç",type:"joke"})),n==="enthusiastic-coach"&&(e&&t>=5&&(s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"wise-sage",message:"üòº„ÄåÊúÄ„Å£È´ò„Å†„ÅÅ„ÅÅÔºÅÔºÅ„Äç üßô„Äå...Â∞ë„ÅóÂ£∞„ÅåÂ§ß„Åç„ÅÑ„Åã„ÅÆ„ÅÜ„Äç üòº„Äå„ÅÜ„Çã„Åï„Åè„Å¶ÊÇ™„Åã„Å£„Åü„Å™ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"drill-sergeant",message:"üòº„Äå„Çà„Å£„Åó„ÇÉ„ÉºÔºÅ„Äç üòà„ÄåÈ®í„Åå„Åó„ÅÑ...„Å†„Åå„ÄÅÊÇ™„Åè„Å™„ÅÑ„Å™„Äç üòº„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„Å´Ë§í„ÇÅ„Çâ„Çå„ÅüÔºÅ„Äç",type:"support"})),e||s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"kind-teacher",message:"üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅÊ¨°„Å†Ê¨°ÔºÅ„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÁÑ¶„Çâ„Åö„Å´„Äç üòº„Äå‰∫å‰∫∫„ÅßÂøúÊè¥„Åó„Å¶„Çã„ÅûÔºÅ„Äç",type:"support"}),s.push({mainTeacher:"enthusiastic-coach",message:"üòº„Äå‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨„ÅØ...„Äç ü§ñ„Äå„Åù„Çå„ÅØËã±Ë™ûÂ≠¶Áøí„Å®ÁÑ°Èñ¢‰øÇ„Åß„Åô„Äç üòº„Äå‰Ωì„ÅåË≥áÊú¨„Å†„ÇçÔºÅÔºü„Äç",type:"joke"})),n==="wise-sage"&&(e&&s.push({mainTeacher:"wise-sage",otherTeacher:"drill-sergeant",message:"üßô„ÄåËâØ„ÅçÊàêÈï∑„Åò„ÇÉ„Äç üòà„ÄåÂΩì„Åü„ÇäÂâç„Å†„ÄÅ‰ø∫„ÅÆÊïô„ÅàÂ≠ê„Å†„Åã„Çâ„Å™„Äç üßô„Äå...„Åä‰∏ª„ÇÇÊïô„Åà„Å¶„Åä„Å£„Åü„ÅÆ„ÅãÔºü„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",otherTeacher:"analyst",message:"üßô„ÄåÊôÇ„Å´„ÅØÊÑüË¶ö„ÇÇÂ§ß‰∫ã„Åò„ÇÉ„Åû„Äç ü§ñ„ÄåÊÑüË¶ö„ÅØÊ∏¨ÂÆö‰∏çÂèØËÉΩ„Åß„Åô„Äç üßô„Äå...Ëã•„ÅÑ„ÅÆ„ÅÜ„Äç",type:"argument"}),s.push({mainTeacher:"wise-sage",otherTeacher:"enthusiastic-coach",message:"üßô„ÄåÁÑ¶„Çâ„Åö„ÄÅ„Åò„Å£„Åè„Çä„Å®...„Äç üòº„Äå„Åü„Åæ„Å´„ÅØÂÖ®ÂäõÁñæËµ∞„ÇÇÂ§ß‰∫ã„Å£„Åô„ÇàÔºÅ„Äç üßô„Äå...„Åù„Çå„ÇÇ‰∏ÄÁêÜ„ÅÇ„Çã„Åã„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",message:"üßô„ÄåÊòî„ÅØ„ÅÆ„ÅÜ...„Äç üòÉüòàüòºü§ñ„Äå„Äå„Äå„Äå„Åæ„ÅüÊòîË©±ÔºÅÔºü„Äç„Äç„Äç„Äç üßô„Äå...ÊúÄËøë„ÅÆËã•ËÄÖ„ÅØ„Äç",type:"joke"}));const r=[{mainTeacher:n,message:"üòÉ„Äå„ÅäÊòº„ÅØ‰ΩïÈ£ü„Åπ„Åæ„ÅôÔºü„Äç üòà„ÄåÊôÇÈñì„ÅÆÁÑ°ÈßÑ„Å†„Äç üòº„Äå‰ø∫„ÅØ„Ç´„ÉÑ‰∏ºÔºÅ„Äç ü§ñ„ÄåÊ†ÑÈ§ä„Éê„É©„É≥„Çπ„ÇíËÄÉÊÖÆ„Åô„Åπ„Åç„Åß„Åô„Äç üßô„Äå...„Çè„Åó„ÅØËïéÈ∫¶„Åå„ÅÑ„ÅÑ„ÅÆ„ÅÜ„Äç",type:"joke"},{mainTeacher:n,message:"üòà„Äå...Ë™∞„Å†„ÄÅËÅ∑Âì°ÂÆ§„Åß„Ç≥„Éº„Éí„Éº„Åì„Åº„Åó„Åü„ÅÆ„ÅØÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„Çì...„Äç üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅ„Äç ü§ñ„ÄåÊ∏ÖÊéÉÊñπÊ≥ï„ÇíÊèêÁ§∫„Åó„Åæ„Åô„Äç",type:"joke"},{mainTeacher:n,message:"üßô„Äå...Âç∞Âà∑Ê©ü„ÅåÂãï„Åã„Çì„ÅÆ„Åò„ÇÉ„Åå„Äç ü§ñ„ÄåITÊãÖÂΩì„ÇíÂëº„Å≥„Åæ„Åô„Äç üòÉ„ÄåÁßÅ„ÅåË¶ã„Å¶„Åø„Åæ„Åô„Å≠„Äç üòà„Äå„Åï„Å£„Åï„Å®Áõ¥„ÅõÔºÅ„Äç üòº„Äå„Åø„Çì„Å™„ÅßÂçîÂäõ„Å†ÔºÅ„Äç",type:"joke"},{mainTeacher:n,message:"üòº„Äå‰ªäÊó•„ÅÆÊéàÊ•≠„Å©„ÅÜ„Å†„Å£„ÅüÔºü„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Å£„Å¶„Åæ„Åó„Åü„Çà„Äç üòà„Äå„Åæ„Å†„Åæ„Å†„Å†„Äç ü§ñ„Äå„Éá„Éº„Çø„ÅßË¶ã„Çã„Å®ÊîπÂñÑÂÇæÂêë„Åß„Åô„Äç üßô„Äå„Åù„Çå„Åû„Çå„ÅÆÊàêÈï∑„Åå„ÅÇ„Çã„ÅÆ„ÅÜ„Äç",type:"banter"}];return Math.random()<.05&&s.push(...r),s}function eJ(){const n=new Date().getHours();if(Math.random()>.05)return null;if(n>=6&&n<9){const e=["üòÉ„Äå„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç üòà„ÄåÊúù„Åã„ÇâÂÖÉÊ∞ó„Å†„Å™„Äç üòº„Äå„Çà„Å£„Åó„ÇÉ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„Å†ÔºÅ„Äç","üßô„Äå„ÅÜ„ÇÄ„ÄÅËâØ„ÅÑÊúù„Åò„ÇÉ„ÅÆ„ÅÜ„Äç ü§ñ„ÄåÊ∞óÊ∏©18Â∫¶„ÄÅÂ≠¶Áøí„Å´ÊúÄÈÅ©„Åß„Åô„Äç üòÉ„ÄåÂ§©Ê∞ó„ÇÇËâØ„ÅÑ„Åß„Åô„Å≠„Äç","üòà„ÄåÈÅÖÂàª„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå„Åæ„ÄÅ„Åæ„Å†ÈñãÂßã10ÂàÜÂâç„Åß„Åô„Çà...„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=12&&n<13){const e=["üòº„ÄåËÖπÊ∏õ„Å£„Åü„ÄúÔºÅ„Äç üòÉ„Äå„ÅäÂºÅÂΩìË≤∑„Å£„Å¶„Åç„Åæ„Åó„Åü„Çà„Äç üòà„ÄåÊòº‰ºë„Åø„ÅØ30ÂàÜ„Å†„Åû„Äç","üßô„Äå‰ªäÊó•„ÅÆÂÆöÈ£ü„ÅØ‰Ωï„Åã„ÅÆ„ÅÜ„Äç ü§ñ„Äå„Ç´„É≠„É™„ÉºË®àÁÆó„ÅåÂøÖË¶Å„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™„ÅßÈ£ü„Åπ„Åæ„Åó„Çá„ÅÜ„Äç","üòà„ÄåÈ£üÂæå„ÅØ‰ºë„ÇÄ„Å™ÔºÅ„Äç üòÉ„ÄåÊ∂àÂåñ„Å´ÊÇ™„ÅÑ„Åß„Åô„Çà...„Äç üòº„ÄåÂ∞ë„Åó„ÅØ‰ºë„ÇÇ„ÅÜ„ÅúÔºÅ„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=17&&n<19){const e=["üòÉ„Äå‰ªäÊó•„ÇÇ„ÅäÁñ≤„ÇåÊßò„Åß„Åó„Åü„Äç üòà„Äå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑ„Äç üòº„Äå„ÅÑ„ÇÑ„ÄÅÂçÅÂàÜÈ†ëÂºµ„Å£„Åü„Å£„Å¶ÔºÅ„Äç","üßô„ÄåÊó•„ÅåÊöÆ„Çå„Å¶„Åç„Åü„ÅÆ„ÅÜ„Äç ü§ñ„Äå17ÊôÇ32ÂàÜ„ÄÅÂÆöÂàª„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠„Äç","üòº„Äå‰ªäÊó•„ÅÆÂèçÁúÅ‰ºö„Åô„ÇãÔºü„Äç üòÉ„Äå„ÅÑ„ÅÑ„Åß„Åô„Å≠„Äç üòà„ÄåÁÑ°ÈßÑË©±„ÅØ„Åô„Çã„Å™„Äç üßô„Äå„Åù„Çå„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åû„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=22){const e=["üòÉ„Äå„ÇÇ„ÅÜÈÅÖ„ÅÑ„Åß„Åô„Å≠...„Äç üòà„ÄåÂ∏∞„ÇåÔºÅÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ„Äç üßô„ÄåÁÑ°ÁêÜ„ÅØ„ÅÑ„Åã„Çì„Åû„Äç","ü§ñ„Äå22ÊôÇ„ÇíË∂ÖÈÅé„ÄÇÁù°Áú†ÊôÇÈñìÁ¢∫‰øù„ÇíÊé®Â•®„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÂ∏∞„Çä„Åæ„Åó„Çá„ÅÜ„Äç","üòº„ÄåÂ§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÔºÅ„Äç üòÉ„ÄåÊòéÊó•„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„Äå...Êó©„ÅèÂØù„Çç„Äç"];return e[Math.floor(Math.random()*e.length)]}return null}function tJ(n){return n===10?"üòº„Äå10ÈÄ£Á∂öÔºÅÔºÅ„Äç üòà„Äå„Çà„ÅóÔºÅ„Äç üòÉ„Äå„Åô„Åî„ÅÑÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´ÂÑ™ÁßÄ„Äç üßô„ÄåË¶ã‰∫ã„Åò„ÇÉ„Äç":n===20?"üòà„Äå20ÈÄ£Á∂ö„Å†„Å®...ÔºÅÔºü„Äç üòÉ„Äå‰ø°„Åò„Çâ„Çå„Åæ„Åõ„ÇìÔºÅ„Äç üòº„ÄåÊúÄ„Å£È´ò„Å†ÔºÅ„Äç ü§ñ„ÄåÁï∞Â∏∏ÂÄ§„Åß„ÅôÔºàË§í„ÇÅË®ÄËëâÔºâ„Äç üßô„ÄåÂ§©Êâç„Åã...„Äç":n===50?"üòàüòÉüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå50ÈÄ£Á∂öÔºÅÔºÅÔºÅÔºÅÔºÅ„Äç„Äç„Äç„Äç„ÄçÔºàÂÖ®Âì°„Çπ„Çø„É≥„Éá„Ç£„É≥„Ç∞„Ç™„Éô„Éº„Ç∑„Éß„É≥Ôºâ":null}function nJ(){const n=new Date,e=n.getMonth()+1,t=n.getDate(),s=n.getDay();return s===1?"üòÉ„Äå‰ªäÈÄ±„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„ÄåÊúàÊõú„Åã„ÇâÈ£õ„Å∞„ÅõÔºÅ„Äç üòº„ÄåÈÄ±„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ„Äç":s===5?"üòº„ÄåÈáëÊõú„Å†ÔºÅ„ÅÇ„Å®Â∞ë„ÅóÔºÅ„Äç üòÉ„Äå„Åß„ÇÇÊ∞ó„ÇíÊäú„Åã„Åö„Å´„Äç üòà„ÄåÊúÄÂæå„Åæ„ÅßÊ∞óÂêà„Å†ÔºÅ„Äç":e===12&&t===25?"üòÉ„Äå„É°„É™„Éº„ÇØ„É™„Çπ„Éû„ÇπÔºÅ„Äç üòà„ÄåÊµÆ„Åã„Çå„Çã„Å™„Äç üòº„Äå„Åü„Åæ„Å´„ÅØ„ÅÑ„ÅÑ„Å†„ÇçÔºÅ„Äç üßô„Äå„Åª„Å£„Åª„Å£„Åª„Äç":e===1&&t===1?"üòÉüòàüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå„ÅÇ„Åë„Åæ„Åó„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç„Äç„Äç„Äç„Äç":null}const sJ=[{type:"common-mistake",message:`üòÉ„Äå"I'm exciting"„Å£„Å¶Ë®Ä„Å£„Å¶„Åæ„Åõ„Çì„ÅãÔºüÊ≠£„Åó„Åè„ÅØ"I'm excited"„Åß„Åô„Çà„ÄÇËá™ÂàÜ„Åå„ÉØ„ÇØ„ÉØ„ÇØ„Åó„Å¶„ÇãÊôÇ„ÅØedÂΩ¢„Åß„ÅôÔºÅ„Äç`,teacher:"kind-teacher"},{type:"common-mistake",message:`„Äå"I'm boring"„ÅØ„ÄåÁßÅ„ÅØÈÄÄÂ±à„Å™‰∫∫Èñì„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†„ÅûÔºÅ"I'm bored"„ÅåÊ≠£Ëß£„Å†ÔºÅÈñìÈÅï„Åà„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"},{type:"common-mistake",message:'ü§ñ„Äå"funny"„Å®"fun"„ÅØÁï∞„Å™„Çä„Åæ„Åô„ÄÇ"funny"„ÅØ„ÄåÈù¢ÁôΩ„ÅÑÔºàÁ¨ë„Åà„ÇãÔºâ„Äç„ÄÅ"fun"„ÅØ„ÄåÊ•Ω„Åó„ÅÑ„Äç„ÄÇ‰Ωø„ÅÑÂàÜ„Åë„ÅåÈáçË¶Å„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:'üòÉ„Äå"advice"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å™„ÅÆ„Åß„ÄÅ"an advice"„Å®„ÅØË®Ä„Åà„Åæ„Åõ„Çì„ÄÇ"a piece of advice"„Å®Ë®Ä„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'„Äå"How do you think?"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"What do you think?"„ÅåÊ≠£Ëß£ÔºÅ‰ΩïÂ∫¶Ë®Ä„Çè„Åõ„ÇãÔºÅ„Äç',teacher:"drill-sergeant"},{type:"common-mistake",message:'üòº„Äå"see a dream"„Åò„ÇÉ„Å™„ÅÑ„ÅûÔºÅ"have a dream"„Å†ÔºÅÂ§¢„ÅØË¶ã„Çã„Çì„Åò„ÇÉ„Å™„Åè„Å¶ÊåÅ„Å§„Çì„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"common-mistake",message:'üßô„Äå"say"„Å®"tell"„ÅÆÈÅï„ÅÑ„Åò„ÇÉ„Åå..."say"„ÅØÂÜÖÂÆπ„Çí„ÄÅ"tell"„ÅØÁõ∏Êâã„ÇíÂº∑Ë™ø„Åô„Çã„ÅÆ„Åò„ÇÉ„ÄÇ"tell me"„Å®„ÅØË®Ä„Åà„Çã„Åå"say me"„Å®„ÅØË®Ä„Åà„Å¨„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"common-mistake",message:'üòÉ„Äå"enjoy"„ÅÆÂæå„ÅØÂøÖ„Åö-ingÂΩ¢„Åß„Åô„ÇàÔºÅ"enjoy to study"„Åß„ÅØ„Å™„Åè"enjoy studying"„Åß„Åô„ÄÇ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'ü§ñ„Äå"remember to do"Ôºà„Åì„Çå„Åã„Çâ„Åô„Çã„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„Å®"remember doing"Ôºà„Åó„Åü„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:`„Äå"I'm agree"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"agree"„ÅØÂãïË©û„Å†„Åã„Çâ"I agree"„Å†ÔºÅÂü∫Êú¨„ÇíÂøò„Çå„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"}],rJ=[{type:"fun-fact",message:'üßô„ÄåÊé•È†≠Ëæû"re-"„ÅØ„ÄåÂÜç„Å≥„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇreturnÔºàÊàª„ÇãÔºâ„ÄÅreviewÔºàÂæ©ÁøíÔºâ„ÄÅrepeatÔºàÁπ∞„ÇäËøî„ÅôÔºâ„Å™„Å©„ÄÅË¶ö„Åà„ÇÑ„Åô„ÅÑ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÈï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑÔºöÊúÄÂàù„Å®ÊúÄÂæå„ÅÆÊÆµËêΩ„ÄÅÂêÑÊÆµËêΩ„ÅÆÊúÄÂàù„ÅÆÊñá„ÇíË™≠„ÇÅ„Å∞ÂÖ®‰Ωì„ÅÆÊµÅ„Çå„Åå„Å§„Åã„ÇÅ„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„Äå"however"Ôºà„Åó„Åã„ÅóÔºâ„ÄÅ"therefore"Ôºà„Åó„Åü„Åå„Å£„Å¶Ôºâ„ÄÅ"moreover"Ôºà„Åï„Çâ„Å´Ôºâ„Å™„Å©„ÅÆÊé•Á∂öË©û„ÇíË¶ö„Åà„Çã„Å®„ÄÅË´ñÁêÜÂ±ïÈñã„ÅåË¶ã„Åà„ÇÑ„Åô„Åè„Å™„Çä„Åæ„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-tion"„Çí„Å§„Åë„Çã„Å®ÂãïË©û„ÅåÂêçË©û„Å´„Å™„Çã„ÅûÔºÅeducate‚Üíeducation„ÄÅcommunicate‚Üícommunication„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"fun-fact",message:'üßô„Äå"compare A with B"ÔºàA„Å®B„ÇíÊØîËºÉ„Åô„ÇãÔºâ„Å®"compare A to B"ÔºàA„ÇíB„Å´‰æã„Åà„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÈÅï„ÅÜ„Åû„ÄÇË©¶È®ì„Åß„Çà„ÅèÂá∫„Çã„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÂêåÁæ©Ë™û„ÇíÂ¢ó„ÇÑ„Åô„Å®Ë°®ÁèæÂäõ„Åå‰∏ä„Åå„Çä„Åæ„Åô„ÄÇimportant=significant=crucial„ÄÅshow=demonstrate=illustrate „Å™„Å©„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„ÄåÊé•È†≠Ëæû"un-"„ÄÅ"in-"„ÄÅ"dis-"„ÅØÂê¶ÂÆö„ÅÆÊÑèÂë≥„ÄÇunhappy„ÄÅimpossible„ÄÅdisagree„Å™„Å©„ÄÅ„Éë„Çø„Éº„É≥„ÅßË¶ö„Åà„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'„Äå"not only A but also B"ÔºàA„Å†„Åë„Åß„Å™„ÅèB„ÇÇÔºâ„ÅØÈ†ªÂá∫ÊßãÊñá„Å†ÔºÅ„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„ÇçÔºÅ„Äç',teacher:"drill-sergeant"},{type:"fun-fact",message:'üßô„Äå"although"„Å®"though"„ÅØ„Åª„ÅºÂêå„ÅòÊÑèÂë≥Ôºà„Äú„Å†„Åë„Çå„Å©„ÇÇÔºâ„Åò„ÇÉ„Åå„ÄÅthough„ÅÆÊñπ„Åå„Ç´„Ç∏„É•„Ç¢„É´„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-able"„ÅØ„Äå„Äú„Åß„Åç„Çã„Äç„ÅÆÊÑèÂë≥„Å†ÔºÅreadableÔºàË™≠„ÇÅ„ÇãÔºâ„ÄÅcomfortableÔºàÂø´ÈÅ©„Å™Ôºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"}],oJ=[{type:"cultural",message:"üòÉ„ÄåËã±Êñá„Ç®„ÉÉ„Çª„Ç§„ÅØÁµêË´ñ„ÇíÊúÄÂàù„Å´Êõ∏„Åè„ÅÆ„ÅåÂü∫Êú¨„ÄÇIntroduction‚ÜíBody‚ÜíConclusion„ÅÆ3ÈÉ®ÊßãÊàê„Åß„Åô„Çà„ÄÇ„Äç",teacher:"kind-teacher"},{type:"cultural",message:'üßô„ÄåËã±Ë™û„ÅÆË´ñÁêÜÂ±ïÈñã„ÅØ"‰∏ªÂºµ‚ÜíÁêÜÁî±‚ÜíÂÖ∑‰Ωì‰æã"„ÅåÂü∫Êú¨„Åò„ÇÉ„ÄÇFor example, For instance „Çí‰Ωø„ÅÑ„Åì„Å™„Åù„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"cultural",message:"ü§ñ„ÄåÂ≠¶Ë°ìÁöÑ„Å™ÊñáÁ´†„Åß„ÅØ„ÄÅcontractionsÔºàÁü≠Á∏ÆÂΩ¢Ôºâ„ÅØ‰Ωø„ÅÑ„Åæ„Åõ„Çì„ÄÇdon't‚Üído not„ÄÅit's‚Üíit is „Å®Êõ∏„Åç„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"cultural",message:"üòº„ÄåÊÑèË¶ã„ÇíËø∞„Åπ„ÇãË°®ÁèæÔºÅI think, In my opinion, From my perspective „Å™„Å©„ÄÅ„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥„ÇíÂ¢ó„ÇÑ„Åù„ÅÜÔºÅ„Äç",teacher:"enthusiastic-coach"},{type:"cultural",message:'üòÉ„ÄåÁêÜÁî±„ÇíËø∞„Åπ„ÇãÊôÇ„ÅØ"because"„Å†„Åë„Åò„ÇÉ„Å™„Åè„ÄÅ"since"„ÄÅ"as"„ÄÅ"due to"„Å™„Å©„ÇÇ‰Ωø„Åà„Åæ„Åô„Çà„ÄÇ„Äç',teacher:"kind-teacher"},{type:"cultural",message:'„ÄåÂèóÂãïÊÖã„Çí‰Ωø„ÅÑ„Åì„Å™„ÅõÔºÅ"The experiment was conducted"„Å™„Å©„ÄÅÂÆ¢Ë¶≥ÁöÑ„Å™Ë°®Áèæ„Å´ÂøÖË¶Å„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"cultural",message:'üßô„ÄåÂØæÊØî„ÅÆË°®ÁèæÔºö"on the other hand"Ôºà‰∏ÄÊñπ„ÅßÔºâ„ÄÅ"in contrast"ÔºàÂØæÁÖßÁöÑ„Å´Ôºâ„ÅØË´ñËø∞ÂïèÈ°å„ÅßÈáçÂÆù„Åô„Çã„Åû„ÄÇ„Äç',teacher:"wise-sage"}],iJ=[{type:"etymology",message:'üßô„Äå"pre-"„ÅØ„ÄåÂâç„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇpreviewÔºà‰∫àÁøí„ÉªË©¶ÂÜôÔºâ„ÄÅpredictÔºà‰∫àÊ∏¨„Åô„ÇãÔºâ„ÄÅprepareÔºàÊ∫ñÂÇô„Åô„ÇãÔºâ„Å®Ë¶ö„Åà„Çà„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'ü§ñ„Äå"post-"„ÅØ„ÄåÂæå„Äç„ÄÇpostponeÔºàÂª∂Êúü„Åô„ÇãÔºâ„ÄÅpostwarÔºàÊà¶Âæå„ÅÆÔºâ„Å™„Å©„ÄÇpre-„Å®„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Çã„Å®ÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"tele-"„ÅØ„ÇÆ„É™„Ç∑„É£Ë™û„Åß„ÄåÈÅ†„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„ÄÇtelephoneÔºàÈõªË©±Ôºâ„ÄÅtelevisionÔºà„ÉÜ„É¨„ÉìÔºâ„ÄÅtelescopeÔºàÊúõÈÅ†Èè°Ôºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"bi-"„ÅØ„Äå2„Å§„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇbicycleÔºà‰∫åËº™ËªäÔºâ„ÄÅbilingualÔºà2Ë®ÄË™ûË©±„Åõ„ÇãÔºâ„ÄÅbiweeklyÔºàÈöîÈÄ±„ÅÆÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'üòº„Äå"auto-"„ÅØ„ÄåËá™Âãï„ÉªËá™Â∑±„Äç„Å†ÔºÅautomaticÔºàËá™Âãï„ÅÆÔºâ„ÄÅautobiographyÔºàËá™‰ºùÔºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"etymology",message:'ü§ñ„Äå"micro-"„ÅØ„ÄåÂ∞è„Åï„ÅÑ„Äç„ÄÅ"macro-"„ÅØ„ÄåÂ§ß„Åç„ÅÑ„Äç„ÄÇmicroscopeÔºàÈ°ïÂæÆÈè°Ôºâ„ÄÅmacroeconomicsÔºà„Éû„ÇØ„É≠ÁµåÊ∏àÂ≠¶Ôºâ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"sub-"„ÅØ„Äå‰∏ã„Äç„ÅÆÊÑèÂë≥„ÄÇsubwayÔºàÂú∞‰∏ãÈâÑÔºâ„ÄÅsubmarineÔºàÊΩúÊ∞¥Ëâ¶Ôºâ„ÄÅsubtitleÔºàÂ≠óÂπïÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"super-"„ÅØ„Äå‰∏ä„ÉªË∂Ö„Äç„Åò„ÇÉ„ÄÇsuperiorÔºàÂÑ™„Çå„ÅüÔºâ„ÄÅsupernaturalÔºàË∂ÖËá™ÁÑ∂ÁöÑ„Å™Ôºâ„ÄÅsuperviseÔºàÁõ£Áù£„Åô„ÇãÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"}],aJ=[{type:"grammar-tip",message:'üòÉ„Äå"a"„Å®"an"„ÅÆ‰Ωø„ÅÑÂàÜ„Åë„ÅØ„ÄÅÊ¨°„ÅÆÂçòË™û„ÅÆ„ÄåÈü≥„Äç„ÅßÊ±∫„Åæ„Çä„Åæ„Åô„ÄÇ"an hour"Ôºàhour„ÅÆh„ÅØÁô∫Èü≥„Åó„Å™„ÅÑÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„ÄåÁèæÂú®ÂÆå‰∫Ü„ÅØ„Äå‰ªä„Å´Èñ¢‰øÇ„Åå„ÅÇ„ÇãÈÅéÂéª„Äç„Å†ÔºÅ"I have lost my key"„ÅØ‰ªä„ÇÇË¶ã„Å§„Åã„Å£„Å¶„Å™„ÅÑ„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"grammar-tip",message:'ü§ñ„Äå"fewer"„ÅØÊï∞„Åà„Çâ„Çå„ÇãÂêçË©û„ÄÅ"less"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å´‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"fewer people"„ÄÅ"less water"„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"grammar-tip",message:'üßô„Äå"used to"„ÅØÈÅéÂéª„ÅÆÁøíÊÖ£„ÄÅ"be used to"„ÅØÊÖ£„Çå„Å¶„ÅÑ„Çã„ÄÅ"get used to"„ÅØÊÖ£„Çå„Çã„Åò„ÇÉ„ÄÇÂÖ®„Å¶ÈÅï„ÅÜ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"grammar-tip",message:'üòº„Äå"will"„ÅØÊÑèÂøó„ÄÅ"be going to"„ÅØ‰∫àÂÆö„ÇÑ‰∫àÊ∏¨„Å†ÔºÅ‰Ωø„ÅÑÂàÜ„Åë„Çâ„Çå„Çã„Å®Ëã±Ë™û„Å£„ÅΩ„Åè„Å™„Çã„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"grammar-tip",message:'üòÉ„Äå"some"„Å®"any"„ÄÅËÇØÂÆöÊñá„ÅØsome„ÄÅÁñëÂïèÊñá„ÉªÂê¶ÂÆöÊñá„ÅØany„ÅåÂü∫Êú¨„Åß„Åô„Åå„ÄÅ"Would you like some tea?"„ÅÆ„Çà„ÅÜ„Å´Âãß„ÇÅ„ÇãÊôÇ„ÅØsome„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„Äå‰∏âÂçòÁèæ„ÅÆsÔºÅÂøò„Çå„Çã„Å™ÔºÅ"He go"„Åß„ÅØ„Å™„Åè"He goes"„Å†ÔºÅÂü∫Êú¨‰∏≠„ÅÆÂü∫Êú¨„Å†„ÅûÔºÅ„Äç',teacher:"drill-sergeant"}];function cJ(n){if(Math.random()>.08)return null;if(n){const e=[...rJ,...iJ,...oJ];return e[Math.floor(Math.random()*e.length)].message}else{const e=[...sJ,...aJ];return e[Math.floor(Math.random()*e.length)].message}}function lJ(n,e){const t=e&&(e.includes(" ")||e.includes("-")),s=["üòÉüí° ÂèóÈ®ì„ÉÜ„ÇØÔºÅÂêå„ÅòÂçòË™û„ÅÆÁπ∞„ÇäËøî„Åó„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÄÅ‰ª£ÂêçË©ûÔºàit, they, thisÔºâ„ÇÑÂêåÁæ©Ë™û„Å´Ê≥®ÁõÆ„Åô„Çã„Å®Ë™≠Ëß£„ÅåÊ•Ω„Å´„Å™„Çä„Åæ„Åô„Çà„ÄÇ","üßôüí° Èï∑Êñá„ÅÆ„Ç≥„ÉÑÔºöË®≠Âïè„ÇíÂÖà„Å´Ë™≠„Çì„Åß„Åã„ÇâÊú¨Êñá„ÇíË™≠„ÇÄ„Å®„ÄÅ‰Ωï„ÇíÊé¢„Åõ„Å∞„ÅÑ„ÅÑ„ÅãÂàÜ„Åã„Å£„Å¶ÂäπÁéáÁöÑ„Åò„ÇÉ„ÄÇ","ü§ñüí° Áµ±Ë®à„Éá„Éº„ÇøÔºöÂàùÁ¥ö„ÅØÁ¥Ñ1,077Ë™û„ÄÅ‰∏≠Á¥ö„ÅØÁ¥Ñ1,616Ë™û„ÄÅ‰∏äÁ¥ö„ÅØÁ¥Ñ885Ë™û„Åß„Åô„ÄÇË®àÁîªÁöÑ„Å´Ë™ûÂΩô„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üí° ÊôÇÂà∂„ÅÆ‰∏ÄËá¥ÔºÅ‰∏ªÁØÄ„ÅåÈÅéÂéªÂΩ¢„Å™„ÇâÂæìÂ±ûÁØÄ„ÇÇÈÅéÂéªÂΩ¢„Å†ÔºÅ"He said that he was tired"„Å†„ÅûÔºÅ',"üòÉüí° Êï¥Â∫èÂïèÈ°å„ÅÆ„Ç≥„ÉÑÔºÅ„Åæ„Åö‰∏ªË™û„Å®ÂãïË©û„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ‰øÆÈ£æË™û„ÇíÂæå„Åã„Çâ‰ªò„ÅëË∂≥„Åô„Å®Ëß£„Åç„ÇÑ„Åô„ÅÑ„Åß„Åô„Çà„ÄÇ",'üßôüí° ÂÜ†Ë©û„ÅÆ‰Ωø„ÅÑÂàÜ„ÅëÔºö"a/an"„ÅØÂàù„ÇÅ„Å¶Âá∫„Çã„ÉªÁâπÂÆö„Åß„Åç„Å™„ÅÑ„ÇÇ„ÅÆ„ÄÅ"the"„ÅØÊó¢Âá∫„ÉªÁâπÂÆö„Åß„Åç„Çã„ÇÇ„ÅÆ„Åò„ÇÉ„ÄÇ',"üòºüí° „É™„Çπ„Éã„É≥„Ç∞ÂØæÁ≠ñÔºÅÊ∂àÂéªÊ≥ï„ÅåÊúâÂäπ„Å†ÔºÅÊòé„Çâ„Åã„Å´ÈÅï„ÅÜÈÅ∏ÊäûËÇ¢„ÇíÊ∂à„Åó„Å¶„ÅÑ„Åè„Å®Ê≠£Ëß£Áéá„Åå‰∏ä„Åå„Çã„ÅûÔºÅ","ü§ñüí° ÂäπÁéáÁöÑÂ≠¶ÁøíÊ≥ïÔºöÂçòË™û„ÅØÊñáËÑà„ÅÆ‰∏≠„ÅßË¶ö„Åà„Çã„Å®ÂÆöÁùÄÁéá„Åå3ÂÄç‰ª•‰∏äÈ´ò„Åæ„Çä„Åæ„Åô„ÄÇ‰æãÊñá„Åî„Å®Ë¶ö„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üòÉüí° ÊØîËºÉË°®ÁèæÔºö"as...as"ÔºàÂêåÁ≠âÔºâ„ÄÅ"-er than"ÔºàÊØîËºÉÁ¥öÔºâ„ÄÅ"the -est"ÔºàÊúÄ‰∏äÁ¥öÔºâ„ÅÆ3„Éë„Çø„Éº„É≥„Çí„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Çá„ÅÜÔºÅ'];return t&&s.push("üòºüí° Ë¶ö„ÅàÊñπÔºÅÁÜüË™û„ÅØÂãïË©û„Å®ÂâçÁΩÆË©û„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶Ë¶ö„Åà„Çã„Å®„ÅÑ„ÅÑ„ÅûÔºÅË¶ñË¶öÁöÑ„Å´„Ç§„É°„Éº„Ç∏„Åô„Çã„Å®Âøò„Çå„Å´„Åè„ÅÑ„ÅûÔºÅ"),s[Math.floor(Math.random()*s.length)]}function uJ(n){const{mode:e="translation",currentWord:t,wordProgress:s}=n,r={once:0,twice:0,three:0,four:0,five:0,sixOrMore:0};let o=!1;return Object.entries(s).forEach(([i,a])=>{if(!a)return;let c=0;e==="memorization"?c=a.memorizationAttempts||0:e==="translation"?c=a.translationAttempts??a.quizAttempts??0:e==="spelling"?c=a.spellingAttempts||0:e==="grammar"?c=a.grammarAttempts||0:c=a.totalAttempts||0,t&&i===t&&(o=!0),c===1?r.once++:c===2?r.twice++:c===3?r.three++:c===4?r.four++:c===5?r.five++:c>=6&&r.sixOrMore++}),t&&!o&&r.once++,r}function Hh({mode:n="translation",currentScore:e=0,totalAnswered:t=0,sessionCorrect:s=0,_sessionIncorrect:r=0,_sessionReview:o=0,isReviewFocusMode:i=!1,onReviewFocus:a,onShowSettings:c,currentWord:l,onAnswerTime:d,lastAnswerCorrect:h,lastAnswerWord:f,lastAnswerDifficulty:p,correctStreak:m=0,incorrectStreak:g=0,learningPhase:x,estimatedSpeed:y,forgettingRate:b,dataSource:v="",category:w="",difficulty:S="",wordPhraseFilter:I="",grammarUnit:C,sessionStats:k,_currentQuestionTimesShown:$,onResetProgress:N,onDebugRequeue:_,learningStatusTabPulseKey:P}){const[j,A]=T.useState("ai"),F=T.useMemo(()=>{try{return typeof window>"u"?null:qQ()}catch{return null}},[d]),[M,K]=T.useState(!1),D=T.useRef(null);T.useEffect(()=>{if(P)return K(!0),D.current&&window.clearTimeout(D.current),D.current=window.setTimeout(()=>{K(!1),D.current=null},1600),()=>{D.current&&(window.clearTimeout(D.current),D.current=null)}},[P]);const[G,te]=T.useState(()=>{const q=localStorage.getItem("aiPersonality")||"kind-teacher";return V9(q)||"„Åì„Çì„Å´„Å°„ÅØÔºÅ‰∏ÄÁ∑í„Å´Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),[W,de]=T.useState("");T.useEffect(()=>{if(l){const q=localStorage.getItem("aiPersonality")||"kind-teacher",re=sd(l);let ve="";if(re){const{totalCount:be,correctCount:ke}=re,Ie=be-ke,Re=be>0?Math.round(ke/be*100):0;if(be===0)switch(q){case"drill-sergeant":ve="Êñ∞„Åó„ÅÑÂçòË™û„Å†ÔºÅÊ∞óÂêà„ÇíÂÖ•„Çå„Å¶Ë¶ö„Åà„ÇçÔºÅ";break;case"kind-teacher":ve="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô„Å≠„ÄÇ„Åò„Å£„Åè„ÇäËÄÉ„Åà„Å¶„Åø„Åæ„Åó„Çá„ÅÜ";break;case"analyst":ve="Êñ∞Ë¶èÂçòË™û„ÄÇ„Éá„Éº„Çø„Å™„Åó„ÄÇÂàùÂõûÊ∏¨ÂÆö„ÇíÈñãÂßã„Åó„Åæ„Åô";break;case"enthusiastic-coach":ve="Êñ∞„Åó„ÅÑ„ÉÅ„É£„É¨„É≥„Ç∏„Å†ÔºÅÊÄù„ÅÑÂàá„Å£„Å¶Ë°å„Åì„ÅÜÔºÅ";break;case"wise-sage":ve="Âàù„ÇÅ„Å¶Âá∫‰ºö„ÅÜÂçòË™û„Åò„ÇÉ„Å™„ÄÇÁÑ¶„Çâ„ÅöÂêë„ÅçÂêà„Åä„ÅÜ";break;default:ve="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô"}else if(be===1){const we=ke===1;switch(q){case"drill-sergeant":ve=we?"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÊ≠£Ëß£„Åó„Åü„Åû„ÄÇ„Åæ„Åü„ÇÑ„ÇåÔºÅ":"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÈñìÈÅï„Åà„Åü„ÄÇ‰ªäÂ∫¶„Åì„ÅùÊ±∫„ÇÅ„ÇçÔºÅ";break;case"kind-teacher":ve=we?"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠":"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÈñìÈÅï„Åà„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅÂ§ß‰∏àÂ§´„Åß„Åô";break;case"analyst":ve=`2ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÂâçÂõû: ${we?"Ê≠£Ëß£":"‰∏çÊ≠£Ëß£"}`;break;case"enthusiastic-coach":ve=we?"2ÂõûÁõÆÔºÅÂâçÂõû„ÅØÂÆåÁíß„Å†„Å£„Åü„Å™ÔºÅ":"2ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É≥„ÇπÔºÅÂâçÂõû„ÅÆ„É™„Éô„É≥„Ç∏„Å†ÔºÅ";break;case"wise-sage":ve=we?"2Â∫¶ÁõÆ„ÅÆÂá∫‰ºö„ÅÑ„Åò„ÇÉ„ÄÇÂâçÂõû„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Å£„Åü„ÅÆ„ÅÜ":"2Â∫¶ÁõÆ„Åò„ÇÉ„Å™„ÄÇÂâçÂõû„ÅÆÁµåÈ®ì„ÇíÊ¥ª„Åã„Åù„ÅÜ";break;default:ve="2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô"}}else switch(q){case"drill-sergeant":Re>=80?ve=`${be}ÂõûÁõÆ„Å†„ÄÇÊ≠£Á≠îÁéá${Re}%ÔºÅ„ÅÑ„ÅÑË™øÂ≠ê„Å†ÔºÅ`:Re>=50?ve=`${be}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${Re}%„ÄÇ„ÇÇ„Å£„Å®‰∏ä„Åí„ÇçÔºÅ`:ve=`${be}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${Re}%ÔºÅË¶ö„Åà„ÅåÊÇ™„ÅÑ„ÅûÔºÅ`;break;case"kind-teacher":Re>=80?ve=`${be}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${Re}%„ÄÅ„Çà„ÅèË¶ö„Åà„Å¶„ÅÑ„Åæ„Åô„Å≠`:Re>=50?ve=`${be}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${Re}%„ÄÅÂ∞ë„Åó„Åö„Å§Ë¶ö„Åà„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô`:ve=`${be}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${Re}%„ÄÅÁπ∞„ÇäËøî„ÅóÁ∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ`;break;case"analyst":ve=`${be}ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÊ≠£Á≠îÁéá: ${Re}% (Ê≠£Ëß£${ke}/‰∏çÊ≠£Ëß£${Ie})`;break;case"enthusiastic-coach":Re>=80?ve=`${be}ÂõûÁõÆÔºÅÊ≠£Á≠îÁéá${Re}%ÔºÅÂÆåÁíß„Å´Ëøë„ÅÑ„ÅûÔºÅ`:ve=`${be}ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏ÔºÅÊ≠£Á≠îÁéá${Re}%„ÄÅ„Åæ„Å†‰º∏„Å≥„Çã„ÅûÔºÅ`;break;case"wise-sage":Re>=80?ve=`${be}ÂõûÁõÆ„Åò„ÇÉ„Å™„ÄÇÊ≠£Á≠îÁéá${Re}%„ÄÅ„Çà„ÅèÂÆöÁùÄ„Åó„Å¶„Åä„Çã`:ve=`${be}ÂõûÁõÆ„Åò„ÇÉ„ÄÇÊ≠£Á≠îÁéá${Re}%„ÄÅÁÑ¶„Çâ„ÅöÁùÄÂÆü„Å´„Å™`;break;default:ve=`${be}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${Re}%`}}else ve="Êñ∞„Åó„ÅÑÂïèÈ°å„Åß„Åô";te(ve),de("")}},[l]),T.useEffect(()=>{if(h===void 0||!f||!l||f!==l)return;const q=localStorage.getItem("aiPersonality")||"kind-teacher",re=Ju(n||"translation"),ve=re.todayTotalAnswered,be=re.todayAccuracy,ke=t>0?(s||0)/t*100:0,Re={isCorrect:h,word:f,difficulty:p||S||"intermediate",category:w||"ÂÖ®ÂàÜÈáé",attemptCount:1,responseTime:0,correctStreak:m,incorrectStreak:g,userAccuracy:ke,categoryAccuracy:ke,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:ve,todayAccuracy:be,planProgress:0,timeOfDay:X0(),learningPhase:x,estimatedSpeed:y,forgettingRate:b};let we=wk(q,Re);if(Math.random()<.15){const H=[];if(Math.random()<.33){const Te=lJ(q,l);Te&&H.push(Te)}else if(Math.random()<.5){const Te=nJ();Te&&H.push(Te)}else{const Te=eJ();Te&&H.push(Te)}H.length>0&&(we=`${we}

${H[0]}`)}de(we)},[d,h,f,p,m,g,n,t,s,w,S]);const le=T.useRef(null),oe=T.useRef(null),ge=T.useRef(null),[Ae,Ue]=T.useState(()=>{const q=localStorage.getItem(`learning-limit-${n}`);return q?parseInt(q):null}),[Pe,Ne]=T.useState(()=>{const q=localStorage.getItem(`review-limit-${n}`);return q?parseInt(q):null}),[Ye,at]=T.useState(()=>{const q=localStorage.getItem("memorization-still-learning-limit");return q?parseInt(q):null}),[mt,wt]=T.useState(()=>{const q=localStorage.getItem("memorization-incorrect-limit");return q?parseInt(q):null}),[kt,dt]=T.useState(!1);T.useEffect(()=>{if((n==="translation"||n==="spelling"||n==="grammar")&&k&&a){const{incorrect:q,review:re}=k,ve=q+re;(Ae!==null&&ve>=Ae||Pe!==null&&re>=Pe)&&(i||a())}},[k,Ae,Pe,i,n,a]);const[ue,xe]=T.useState(()=>{if(n==="grammar"){const{retentionRate:q,appearedCount:re}=id();return{retentionRate:q,appearedCount:re}}else{const{retentionRate:q,appearedCount:re}=nd();return{retentionRate:q,appearedCount:re}}}),[Q,fe]=T.useState(()=>n==="grammar"?Zu():n==="memorization"?ed():Yu()),[Z,Fe]=T.useState(null),Ge=T.useMemo(()=>{const re=rt().wordProgress||{};return uJ({mode:n,currentWord:l,wordProgress:re})},[n,l,d]),[Le,ut]=T.useState([]);T.useEffect(()=>{n==="grammar"&&G0().then(q=>{if(C){const re=C.match(/g(\d+)-(?:unit|u)(\d+)/);if(re){const ve=`‰∏≠${re[1]}_Unit${re[2]}`,be=q.filter(ke=>ke.unit===ve);ut(be)}else ut(q)}else ut(q)})},[n,d,C]),T.useEffect(()=>{if(n==="grammar"){const{retentionRate:q,appearedCount:re}=id();xe({retentionRate:q,appearedCount:re}),fe(Zu())}else if(n==="memorization"){const q=ed();fe(q),xe({retentionRate:q.basicRetentionRate,appearedCount:q.appearedWords})}else{const{retentionRate:q,appearedCount:re}=nd();xe({retentionRate:q,appearedCount:re}),fe(Yu())}},[d,n]),T.useEffect(()=>{Fe(l?sd(l):null)},[l,d]),T.useEffect(()=>{if(le.current){const q=Math.round(Q.masteredPercentage);le.current.style.setProperty("--segment-width",String(q)),le.current.setAttribute("data-width",String(q))}if(oe.current){const q=Math.round(Q.learningPercentage);oe.current.style.setProperty("--segment-width",String(q)),oe.current.setAttribute("data-width",String(q))}if(ge.current){const q=Math.round(Q.strugglingPercentage);ge.current.style.setProperty("--segment-width",String(q)),ge.current.setAttribute("data-width",String(q))}},[Q,j,n]);const{todayAccuracy:ye,todayTotalAnswered:Ve}=T.useMemo(()=>Ju(n),[n,d]),lt=n==="memorization"&&!i&&((Q==null?void 0:Q.learningCount)??0)>0&&((Q==null?void 0:Q.strugglingCount)??0)===0;T.useMemo(()=>j0(n),[n,d]),T.useMemo(()=>Uh(),[d]);const{retentionRate:B}=ue,L=80,U=ue.retentionRate,V=Math.min(100,Math.round(U/L*100)),ce=T.useMemo(()=>{if(!F||!w||w==="ÂÖ®ÂàÜÈáé")return null;const q=F.categoryEfficiencies.find(ve=>ve.category===w);if(!q)return null;const re=(q.retentionRate-F.overallMetrics.retentionRate)*100;return Number.isFinite(re)?Math.round(re):null},[F,w]),ie=T.useMemo(()=>{var re;if(!F||!((re=F.chainLearningEffect)!=null&&re.usedChainLearning))return null;const q=F.chainLearningEffect.effectDifference*100;return Number.isFinite(q)?Math.round(q):null},[F]),O=Q;return T.useMemo(()=>t>0?Math.round(e/t*100):0,[e,t]),u.jsxs("div",{className:"score-board-compact",children:[u.jsxs("div",{className:"score-board-tabs grid grid-cols-3 sm:grid-cols-5 gap-1 sm:gap-2",children:[u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="ai"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("ai"),title:"AI„Ç≥„É°„É≥„Éà",children:[u.jsx("span",{className:"hidden sm:inline",children:"ü§ñ AI"}),u.jsx("span",{className:"sm:hidden",children:"AI"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="plan"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("plan"),title:"Ë®àÁîª",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìã Ë®àÁîª"}),u.jsx("span",{className:"sm:hidden",children:"Ë®àÁîª"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="history"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("history"),title:"Â±•Ê≠¥",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìú Â±•Ê≠¥"}),u.jsx("span",{className:"sm:hidden",children:"Â±•Ê≠¥"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="breakdown"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("breakdown"),title:"ÂäπÁéá",children:[u.jsx("span",{className:`hidden sm:inline ${M?"animate-pulse drop-shadow-sm "+(j==="breakdown"?"":"text-primary"):""}`,children:"ÂäπÁéá"}),u.jsx("span",{className:`sm:hidden ${M?"animate-pulse drop-shadow-sm "+(j==="breakdown"?"":"text-primary"):""}`,children:"ÂäπÁéá"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="settings"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>{c?c():A("settings")},title:"Ë®≠ÂÆö",children:[u.jsx("span",{className:"hidden sm:inline",children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsx("span",{className:"sm:hidden",children:"Ë®≠ÂÆö"})]})]}),j==="ai"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"ai-comment-container",children:u.jsxs("div",{className:"flex items-center gap-2 w-full",children:[u.jsx("div",{className:"text-2xl flex-shrink-0",children:(()=>{const q=localStorage.getItem("aiPersonality")||"kind-teacher";return{"kind-teacher":"üòÉ","drill-sergeant":"üëπ","enthusiastic-coach":"üòº",analyst:"ü§ñ","wise-sage":"üßô"}[q]||"üòÉ"})()}),u.jsx("div",{className:"flex-1 min-w-0",children:u.jsx("div",{className:"text-sm text-gray-700 leading-snug break-words",children:(W||G).replace(/^[üòÉüëπüòºü§ñüßô]+„Äå?/gu,"").replace(/„Äç$/gu,"").replace(/[‚ú®üå∏üòäüå±üí™üî•üìäüèÜ]/gu,"").trim()})})]})})})}),j==="plan"&&u.jsx("div",{className:"score-board-content",children:u.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:[u.jsxs("div",{className:"plan-text-line",children:[u.jsxs("span",{className:"stat-text-label",children:["üìö ",v||"ÂÖ®ÂïèÈ°åÈõÜ"]}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:w||"ÂÖ®ÂàÜÈáé"}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:S==="all"?"ÂÖ®Èõ£ÊòìÂ∫¶":S==="basic"?"Âü∫Á§é":S==="standard"?"Ê®ôÊ∫ñ":S==="advanced"?"Áô∫Â±ï":S}),(n==="translation"||n==="spelling"||n==="memorization")&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("button",{onClick:()=>dt(!0),className:"stat-text-label cursor-pointer hover:text-primary transition-colors",title:"Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö",children:"‚öôÔ∏è ‰∏äÈôêË®≠ÂÆö"})]}),I&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:I==="all"?"ÂçòË™û„ÉªÁÜüË™û":I==="word"?"ÂçòË™û„ÅÆ„Åø":I==="phrase"?"ÁÜüË™û„ÅÆ„Åø":"ÂçòË™û„ÉªÁÜüË™û"})]})]}),u.jsxs("div",{className:"plan-text-line",children:[u.jsxs("span",{className:"stat-text-label",children:["üìà ÂÆöÁùÄÁéá: ",U,"%"]}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsxs("span",{className:"stat-text-label",children:[L,"%ÁõÆÊ®ô"]})]}),u.jsx("div",{className:"mt-1 mb-2",children:u.jsx("div",{className:"w-full bg-gray-200 rounded h-2",children:u.jsx("div",{className:"bg-primary h-2 rounded",style:{width:`${V}%`}})})}),u.jsxs("div",{className:"plan-text-line",children:[typeof ce=="number"&&u.jsxs("span",{className:"stat-text-label",children:["‚ú®Èñ¢ÈÄ£ÂàÜÈáéÂà•„ÅÆÂäπÊûú:",ce>=0?"+":"",ce,"%"]}),typeof ce=="number"&&typeof ie=="number"&&u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),typeof ie=="number"&&u.jsxs("span",{className:"stat-text-label",children:["„ÅÑ„ÇÇ„Å•„ÇãÂºèÂ≠¶Áøí„ÅÆÂäπÊûú:",ie>=0?"+":"",ie,"%"]})]}),u.jsxs("div",{className:"plan-text-line",children:[typeof y=="number"&&u.jsx(u.Fragment,{children:u.jsxs("span",{className:"stat-text-label",children:["Êé®ÂÆöÈÄüÂ∫¶: ",y.toFixed(2)]})}),typeof b=="number"&&u.jsxs(u.Fragment,{children:[typeof y=="number"&&u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsxs("span",{className:"stat-text-label",children:["ÂøòÂç¥Áéá: ",b.toFixed(2)]})]}),x&&u.jsxs(u.Fragment,{children:[(typeof y=="number"||typeof b=="number")&&u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsxs("span",{className:"stat-text-label",children:["„Éï„Çß„Éº„Ç∫: ",x]})]})]}),kt&&(n==="translation"||n==="spelling")&&u.jsx("div",{className:"plan-settings-modal",children:u.jsxs("div",{className:"plan-settings-content",children:[u.jsx("h4",{children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö"}),u.jsx("p",{className:"plan-settings-description",children:"0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"Â≠¶Áøí‰∏≠„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"Â≠¶Áøí‰∏≠„ÅÆË™ûÊï∞‰∏äÈôê",value:Ae||0,onChange:q=>{const re=parseInt(q.target.value),ve=re===0?null:re;Ue(ve),ve===null?localStorage.removeItem(`learning-limit-${n}`):localStorage.setItem(`learning-limit-${n}`,ve.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"Ë¶ÅÂæ©Áøí„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"Ë¶ÅÂæ©Áøí„ÅÆË™ûÊï∞‰∏äÈôê",value:Pe||0,onChange:q=>{const re=parseInt(q.target.value),ve=re===0?null:re;Ne(ve),ve===null?localStorage.removeItem(`review-limit-${n}`):localStorage.setItem(`review-limit-${n}`,ve.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsx("button",{className:"plan-settings-close",onClick:()=>dt(!1),children:"Èñâ„Åò„Çã"})]})}),kt&&n==="memorization"&&u.jsx("div",{className:"plan-settings-modal",children:u.jsxs("div",{className:"plan-settings-content",children:[u.jsx("h4",{children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö"}),u.jsx("p",{className:"plan-settings-description",children:"0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê",value:Ye||0,onChange:q=>{const re=parseInt(q.target.value),ve=re===0?null:re;at(ve),ve===null?localStorage.removeItem("memorization-still-learning-limit"):localStorage.setItem("memorization-still-learning-limit",ve.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê",value:mt||0,onChange:q=>{const re=parseInt(q.target.value),ve=re===0?null:re;wt(ve),ve===null?localStorage.removeItem("memorization-incorrect-limit"):localStorage.setItem("memorization-incorrect-limit",ve.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsx("button",{className:"plan-settings-close",onClick:()=>dt(!1),children:"Èñâ„Åò„Çã"})]})})]})}),j==="breakdown"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsxs("div",{className:"retention-breakdown-container",children:[u.jsxs("div",{className:"retention-breakdown-header",children:[u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsxs("div",{className:"attempt-counts-summary flex-1",children:["Âá∫È°åÊï∞Ôºö1Âõû ",Ge.once,"Âïè 2Âõû ",Ge.twice,"Âïè 3Âõû"," ",Ge.three,"Âïè 4Âõû ",Ge.four,"Âïè 5Âõû ",Ge.five,"Âïè 6Âõû‰ª•‰∏ä ",Ge.sixOrMore,"Âïè"]}),!1]}),O.appearedWords>0?u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?u.jsxs(u.Fragment,{children:[O.appearedWords,"Ë™ûÁ¢∫Ë™çÔºö üü¢Ë¶ö„Åà„Å¶„Çã"," ",O.masteredCount,"Ë™û"," ",u.jsxs("span",{className:"retention-label",title:i?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":lt?"üî• „Åæ„Å†„Åæ„Å†„Éñ„Éº„Çπ„Éà‰∏≠":void 0,children:["üü°„Åæ„Å†„Åæ„Å† ",O.learningCount,"Ë™û"]})," ",u.jsxs("span",{className:"retention-label",title:i?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":void 0,children:["üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ",O.strugglingCount,"Ë™û"]}),a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):n==="grammar"?u.jsxs(u.Fragment,{children:[O.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",O.masteredCount,"Âïè üü°Â≠¶Áøí‰∏≠ ",O.learningCount,"Âïè üî¥Ë¶ÅÂæ©Áøí"," ",O.strugglingCount,"Âïè",a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):u.jsxs(u.Fragment,{children:[O.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",O.masteredCount,"Ë™û üü°Â≠¶Áøí‰∏≠ ",O.learningCount,"Ë™û üî¥Ë¶ÅÂæ©Áøí"," ",O.strugglingCount,"Ë™û",(n==="translation"||n==="spelling")&&a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]})}):u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?"„Åæ„Å†Ë™ûÂè•„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì":"„Åæ„Å†ÂïèÈ°å„Å´Âèñ„ÇäÁµÑ„Çì„Åß„ÅÑ„Åæ„Åõ„Çì"})]}),O.appearedWords>0&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"retention-progress-bar",children:n==="memorization"?u.jsxs(u.Fragment,{children:[O.masteredPercentage>0&&u.jsx("div",{ref:le,className:"retention-segment retention-mastered","data-width":Math.round(O.masteredPercentage),title:`üü¢ Ë¶ö„Åà„Å¶„Çã: ${O.masteredCount}Ë™û (${Math.round(O.masteredPercentage)}%)`,children:O.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(O.masteredPercentage),"%"]})}),O.learningCount>0&&u.jsx("div",{ref:oe,className:`retention-segment retention-learning ${i||lt?"pulsing":""}`,"data-width":Math.round(O.learningPercentage),title:`üü° „Åæ„Å†„Åæ„Å†: ${O.learningCount}Ë™û (${Math.round(O.learningPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":lt?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":""}`,children:O.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(O.learningPercentage),"%"]})}),O.strugglingCount>0&&u.jsx("div",{ref:ge,className:`retention-segment retention-struggling ${i?"pulsing":""}`,"data-width":Math.round(O.strugglingPercentage),title:`üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${O.strugglingCount}Ë™û (${Math.round(O.strugglingPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":""}`,children:O.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(O.strugglingPercentage),"%"]})})]}):u.jsxs(u.Fragment,{children:[O.masteredPercentage>0&&u.jsx("div",{ref:le,className:"retention-segment retention-mastered","data-width":Math.round(O.masteredPercentage),title:`üü¢ ÂÆöÁùÄ: ${O.masteredCount}Ë™û (${Math.round(O.masteredPercentage)}%)`,children:O.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(O.masteredPercentage),"%"]})}),O.learningPercentage>0&&u.jsx("div",{ref:oe,className:`retention-segment retention-learning ${lt||i?"pulsing":""}`,"data-width":Math.round(O.learningPercentage),title:`üü° Â≠¶Áøí‰∏≠: ${O.learningCount}Ë™û (${Math.round(O.learningPercentage)}%) ${lt?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":i?"üìö Âæ©Áøí‰∏≠":""}`,children:O.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(O.learningPercentage),"%"]})}),O.strugglingPercentage>0&&u.jsx("div",{ref:ge,className:`retention-segment retention-struggling ${i?"pulsing":""}`,"data-width":Math.round(O.strugglingPercentage),title:`üî¥ Ë¶ÅÂæ©Áøí: ${O.strugglingCount}Ë™û (${Math.round(O.strugglingPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":""}`,children:O.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(O.strugglingPercentage),"%"]})})]})})})]})})}),j==="history"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"history-compact",children:n==="grammar"?u.jsx("div",{className:"word-detail-container",children:Le.length>0?u.jsx("div",{className:"grammar-units-list",children:Le.map(q=>{const re=(q.correctCount||0)+(q.incorrectCount||0),ve=q.masteredCount||0,be=q.answeredQuestions||0,ke=be>0?Math.round(ve/be*100):0,Ie=q.historyIcons||"";let Re="üü¢",we="ÂÆöÁùÄÊ∏à";ve===0&&be>0?(Re="üî¥",we="Ë¶ÅÂæ©Áøí"):ke<80&&be>0&&(Re="üü°",we="Â≠¶Áøí‰∏≠");const H=q.unit.match(/‰∏≠(\d+)/),Te=H?`${H[1]}Âπ¥`:q.unit,Me=q.unit.match(/Unit(\d+)/),Je=Me?`Unit${Me[1]}`:"",vt=Je?`${Te} ${Je}Ôºö${q.title}`:`${Te}Ôºö${q.title}`;return u.jsxs("div",{className:"grammar-unit-card",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",vt," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[Re," ",we]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[q.correctCount,"/",re,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),Ie&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:Ie}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[ke,"%"]})]})]},q.unit)})}):u.jsxs("div",{className:"word-detail-empty",children:[u.jsx("p",{children:"„Åæ„Å†ÊñáÊ≥ïÂïèÈ°å„ÅÆËß£Á≠î„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"stat-text-sub",children:"ÂïèÈ°å„ÇíËß£„Åè„Å®ÂçòÂÖÉ„Åî„Å®„ÅÆÊàêÁ∏æ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})}):l&&Z?u.jsxs("div",{className:"word-detail-container",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",l," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[Z.statusIcon," ",Z.statusLabel]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[Z.correctCount,"/",Z.totalCount,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),Z.accuracyHistory&&Z.accuracyHistory.length>0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:Z.accuracyHistory}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[Z.retentionRate,"%"]}),Z.position!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),u.jsx("span",{className:"word-stat-label",children:"Position:"}),u.jsx("strong",{className:"word-stat-value",children:Z.position.toFixed(0)})]})]}),(Z.memorizationPosition!==void 0||Z.translationPosition!==void 0||Z.spellingPosition!==void 0||Z.grammarPosition!==void 0)&&u.jsxs("div",{className:"word-detail-stats",children:[Z.memorizationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊöóË®ò:"}),u.jsx("strong",{className:"word-stat-value",children:Z.memorizationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),Z.translationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÂíåË®≥:"}),u.jsx("strong",{className:"word-stat-value",children:Z.translationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),Z.spellingPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"„Çπ„Éö„É´:"}),u.jsx("strong",{className:"word-stat-value",children:Z.spellingPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),Z.grammarPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊñáÊ≥ï:"}),u.jsx("strong",{className:"word-stat-value",children:Z.grammarPosition.toFixed(0)})]})]})]}):l&&!Z?u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì"})}):u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"ÂïèÈ°å„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅÁèæÂú®„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})})})})}),j==="settings"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"settings-tab-container",children:u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆ„Çø„Éñ„ÅÆË®≠ÂÆö„ÅØÂ≠¶ÁøíË®≠ÂÆö„Éë„Éç„É´„Åã„ÇâË°å„Åà„Åæ„Åô"})})})})})]})}const Tf=[{id:"beginner-basic",name:"ÂàùÁ¥öÂü∫Á§é",requiredWords:600,requiredAccuracy:70,description:"Âü∫Êú¨ÁöÑ„Å™ÂçòË™û",icon:"üå±"},{id:"beginner-complete",name:"ÂàùÁ¥öÂÆå‰∫Ü",requiredWords:1077,requiredAccuracy:70,description:"ÂàùÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üåø"},{id:"intermediate-half",name:"‰∏≠Á¥öÂçäÂàÜ",requiredWords:1900,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´50%",icon:"üå≥"},{id:"intermediate-complete",name:"‰∏≠Á¥öÂÆå‰∫Ü",requiredWords:2693,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üéì"},{id:"advanced-half",name:"‰∏äÁ¥öÂçäÂàÜ",requiredWords:3150,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´50%",icon:"üìö"},{id:"advanced-complete",name:"‰∏äÁ¥öÂÆå‰∫Ü",requiredWords:3578,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üöÄ"},{id:"master",name:"„Éû„Çπ„Çø„Éº",requiredWords:4e3,requiredAccuracy:85,description:"ÂÖ®„É¨„Éô„É´Âà∂Ë¶á",icon:"‚≠ê"}];function dJ(){const n=localStorage.getItem("user-goal-level");if(n){const e=JSON.parse(n),t=Tf.find(s=>s.id===e);if(t)return t}return Tf.find(e=>e.id==="intermediate-complete")||Tf[0]}function Sk(n){const e=n||dJ(),t=rt(),s=Uh();let r=0,o=0;Object.values(t.wordProgress).forEach(m=>{r+=m.correctCount,o+=m.correctCount+m.incorrectCount});const i=o>0?r/o*100:0,a=Math.min(100,s/e.requiredWords*100),c=Math.min(100,i/e.requiredAccuracy*100),l=(a+c)/2,d=s>=e.requiredWords&&i>=e.requiredAccuracy,h=hJ(s,e.requiredWords,i,e.requiredAccuracy),f=Math.max(0,e.requiredWords-s),p=h>0?Math.ceil(f/h):0;return{goal:e,currentWords:s,currentAccuracy:Math.round(i),wordsProgress:Math.round(a),accuracyProgress:Math.round(c),overallProgress:Math.round(l),isAchieved:d,estimatedDaysToAchieve:h,recommendedDailyWords:Math.min(50,p)}}function hJ(n,e,t,s){if(n>=e&&t>=s)return 0;const r=rt(),i=Date.now()-7*24*60*60*1e3;let a=0;Object.values(r.wordProgress).forEach(g=>{g.lastStudied>=i&&g.masteryLevel==="mastered"&&a++});const c=a/7,l=Math.max(5,c),h=Math.max(0,e-n)/l,p=Math.max(0,s-t)*2,m=Math.ceil(h+p);return Math.max(1,m)}function RZ(n=!0){const e=Sk();if(e.isAchieved)return`üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ${e.goal.name}„É¨„Éô„É´„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅ`;const t=[];if(t.push(`${e.goal.icon} ${e.goal.name}„Åæ„Åß ${e.overallProgress}%`),e.currentWords<e.goal.requiredWords){const s=e.goal.requiredWords-e.currentWords;t.push(`„ÅÇ„Å®${s}Ë™û`)}return e.estimatedDaysToAchieve>0&&(e.estimatedDaysToAchieve<=7?t.push(`„ÅÇ„Å®${e.estimatedDaysToAchieve}Êó•„ÅßÈÅîÊàêÔºÅ`):e.estimatedDaysToAchieve<=30?t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/7)}ÈÄ±Èñì„ÅßÈÅîÊàêË¶ãËæº„Åø`):t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/30)}„É∂Êúà„ÅßÈÅîÊàêË¶ãËæº„Åø`)),n&&(e.overallProgress>=80?t.push("„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÈÅîÊàê„Åß„ÅôÔºÅÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=50?t.push("È†ÜË™ø„Å´ÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=25&&t.push("ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ")),t.join(" ")}const fJ={accept:["except"],except:["accept"],affect:["effect"],effect:["affect"],dessert:["desert"],desert:["dessert"],quiet:["quite"],quite:["quiet"],lose:["loose"],loose:["lose"],advice:["advise"],advise:["advice"],breath:["breathe"],breathe:["breath"],cloth:["clothe","clothes"],clothe:["cloth","clothes"],clothes:["cloth","clothe"],borrow:["lend"],lend:["borrow"],teach:["learn"],learn:["teach"],speak:["talk","say","tell"],talk:["speak","say","tell"],say:["speak","talk","tell"],tell:["speak","talk","say"],see:["look","watch"],look:["see","watch"],watch:["see","look"],hear:["listen"],listen:["hear"],bring:["take"],take:["bring"],come:["go"],go:["come"],in:["on","at"],on:["in","at"],at:["in","on"],for:["to","of"],to:["for","of"],of:["for","to"],already:["all ready"],"all ready":["already"],altogether:["all together"],"all together":["altogether"],everyday:["every day"],"every day":["everyday"]};function Ck(n){const e=n.toLowerCase();return fJ[e]||[]}function pJ(){const n=rt(),e=[],t=new Set;return Object.entries(n.wordProgress).forEach(([s])=>{if(t.has(s.toLowerCase()))return;const r=Ck(s);if(r.length===0)return;const o=[s,...r].map(f=>f.toLowerCase()),i=Array.from(new Set(o));let a=0,c=0;i.forEach(f=>{const p=n.wordProgress[f];p&&(a+=p.incorrectCount,c+=p.correctCount+p.incorrectCount)});const l=c>0?a/c:0,d=Math.min(100,l*100*Math.log1p(c));let h="spelling";["speak","talk","say","tell","see","look","watch"].includes(s.toLowerCase())?h="meaning":["in","on","at","for","to","of"].includes(s.toLowerCase())&&(h="grammar"),e.push({words:i,type:h,description:mJ(i,h),confusionScore:Math.round(d),totalErrors:a,needsReview:d>30||l>.3}),i.forEach(f=>t.add(f))}),e.filter(s=>s.totalErrors>0).sort((s,r)=>r.confusionScore-s.confusionScore)}function mJ(n,e){return e==="spelling"?`„Çπ„Éö„É´„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:e==="meaning"?`ÊÑèÂë≥„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:`ÊñáÊ≥ïÁöÑ„Å´Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ: ${n.join(", ")}`}function gJ(n){const e=rt(),t={},s=[];n.words.forEach(i=>{const a=e.wordProgress[i];if(a){const c=a.correctCount+a.incorrectCount,l=c>0?a.correctCount/c*100:0;t[i]=l,s.push(l)}});const r=s.length>0?s.reduce((i,a)=>i+a,0)/s.length:0,o=s.length>0?s.reduce((i,a)=>i+Math.pow(a-r,2),0)/s.length:0;return{groupRetention:Math.round(r),individualRetentions:t,variance:Math.round(o)}}function xJ(n){const e=gJ(n);return e.groupRetention<50?`‚ö†Ô∏è ${n.words.join(", ")} „ÅÆÂå∫Âà•„ÅåÊõñÊòß„Åß„Åô„ÄÇÈõÜ‰∏≠ÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`:e.variance>500?`üìä ${n.words.join(", ")} „ÅßÂÆöÁùÄÂ∫¶„Å´„Å∞„Çâ„Å§„Åç„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂº±„ÅÑÂçòË™û„ÇíÈáçÁÇπÁöÑ„Å´„ÄÇ`:e.groupRetention<70?`üí™ ${n.words.join(", ")} „Çí„ÇÇ„ÅÜÂ∞ë„ÅóÁ∑¥Áøí„Åô„Çã„Å®ÂÆåÁíß„Åß„ÅôÔºÅ`:`‚úÖ ${n.words.join(", ")} „ÅÆÂå∫Âà•„Åå„Åó„Å£„Åã„Çä„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ`}function yJ(n){const e=/^[^:]+:\s*[""](.+?)[""]$/,t=n.match(e);if(t)return t[1].trim();const s=/^[^:]+:\s*(.+)$/,r=n.match(s);return r?r[1].trim():n}function As(n,e={}){if(!("speechSynthesis"in window)){E.warn("„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØWeb Speech API„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì");return}const t=yJ(n);if(window.speechSynthesis.speaking||window.speechSynthesis.pending){window.speechSynthesis.cancel(),setTimeout(()=>{nb(t,e)},50);return}nb(t,e)}function nb(n,e){const t=new SpeechSynthesisUtterance(n),s=localStorage.getItem("speechRate"),r=localStorage.getItem("voiceGender");t.lang=e.lang||"en-US",t.rate=e.rate||(s?parseFloat(s):.85),t.pitch=e.pitch||1,t.volume=e.volume||1;const i=window.speechSynthesis.getVoices().filter(c=>c.lang.startsWith("en-")),a=["Google US English","Google UK English Female","Google UK English Male","Samantha","Alex","Microsoft Aria Online","Microsoft Guy Online","Karen","Daniel"];if(r==="female"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("female")||l.name.toLowerCase().includes("woman")||l.name.toLowerCase().includes("samantha")||l.name.toLowerCase().includes("karen")||l.name.toLowerCase().includes("aria"));c&&(t.voice=c)}else if(r==="male"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("male")||l.name.toLowerCase().includes("man")||l.name.toLowerCase().includes("alex")||l.name.toLowerCase().includes("daniel")||l.name.toLowerCase().includes("guy"));c&&(t.voice=c)}else{const c=i.find(l=>a.some(d=>l.name.includes(d)));c&&(t.voice=c)}t.onerror=c=>{E.error("Èü≥Â£∞ÂêàÊàê„Ç®„É©„Éº:",c)},window.speechSynthesis.speak(t)}function xn(){return"speechSynthesis"in window}function bJ(){"speechSynthesis"in window&&window.speechSynthesis.cancel()}function wJ(){"speechSynthesis"in window&&window.speechSynthesis.speaking&&window.speechSynthesis.pause()}function vJ(){"speechSynthesis"in window&&window.speechSynthesis.paused&&window.speechSynthesis.resume()}function SJ(){return"speechSynthesis"in window&&window.speechSynthesis.speaking}function CJ(){return"speechSynthesis"in window&&window.speechSynthesis.paused}const ra=({word:n,sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:o="medium",variant:i="icon"})=>{const[a,c]=T.useState(!1),l=e.filter(g=>g.words.some(x=>x.word===n.word)),d=l.length>0,h={small:"text-sm px-2 py-1",medium:"text-base px-3 py-1.5",large:"text-lg px-4 py-2"},f={small:"text-base",medium:"text-lg",large:"text-xl"},p=g=>{if(g.stopPropagation(),e.length===0){r();return}if(e.length===1){const x=e[0];d?s(x.id,n):t(x.id,n)}else c(!a)},m=(g,x)=>{x?s(g,n):t(g,n)};return u.jsxs("div",{className:"relative inline-block",children:[u.jsxs("button",{onClick:p,className:`
          ${h[o]}
          ${d?"bg-green-500 hover:bg-green-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}
          rounded-md font-medium transition-colors duration-200
          flex items-center gap-1
        `,title:d?`${l.length}ÂÄã„ÅÆ„Çª„ÉÉ„Éà„Å´ËøΩÂä†Ê∏à„Åø`:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Å´ËøΩÂä†",children:[u.jsx("span",{className:f[o],children:d?"‚úì":"+"}),i!=="icon"&&u.jsx("span",{children:d?"ËøΩÂä†Ê∏à„Åø":"ËøΩÂä†"})]}),a&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),u.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-80 overflow-y-auto",children:[u.jsx("div",{className:"p-2 border-b border-gray-200",children:u.jsx("p",{className:"text-sm font-medium text-gray-700",children:"„Çª„ÉÉ„Éà„ÇíÈÅ∏Êäû"})}),u.jsx("div",{className:"p-2",children:e.map(g=>{const x=g.words.some(y=>y.word===n.word);return u.jsxs("button",{onClick:()=>{m(g.id,x),c(!1)},className:`
                      w-full text-left px-3 py-2 rounded-md mb-1
                      flex items-center justify-between
                      ${x?"bg-green-50 text-green-700":"hover:bg-gray-100:bg-gray-700 text-gray-700"}
                    `,children:[u.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[u.jsx("span",{children:g.icon||"üìñ"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("p",{className:"text-sm font-medium truncate",children:g.name}),u.jsxs("p",{className:"text-xs text-gray-500",children:[g.words.length,"Ë™û"]})]})]}),u.jsx("span",{className:"text-lg ml-2",children:x?"‚úì":"+"})]},g.id)})}),u.jsx("div",{className:"p-2 border-t border-gray-200",children:u.jsx("button",{onClick:()=>{c(!1),r()},className:"w-full text-left px-3 py-2 rounded-md hover:bg-gray-100:bg-gray-700 text-blue-600 text-sm font-medium",children:"‚ûï Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})})]})]})]})};var ps=(n=>(n.MEMORY_ACQUISITION="memory_acquisition",n.COGNITIVE_LOAD="cognitive_load",n.ERROR_PREDICTION="error_prediction",n.LEARNING_STYLE="learning_style",n.LINGUISTIC_RELATIONS="linguistic_relations",n.CONTEXTUAL_LEARNING="contextual_learning",n))(ps||{}),At=(n=>(n.IMMEDIATE_REPETITION="immediate_repetition",n.TAKE_BREAK="take_break",n.USE_CONFUSION_PAIRS="use_confusion_pairs",n.REDUCE_DIFFICULTY="reduce_difficulty",n.SPACED_REPETITION="spaced_repetition",n.CONTEXTUAL_LEARNING="contextual_learning",n.GROUP_BY_THEME="group_by_theme",n.ADJUST_SESSION_LENGTH="adjust_session_length",n.USE_ETYMOLOGY="use_etymology",n.TIME_OF_DAY_OPTIMIZATION="time_of_day_optimization",n.INCREASE_EXPOSURE="increase_exposure",n.CONTINUE_NORMAL="continue_normal",n))(At||{});const NJ={enabled:!1,minSignalStrength:.3,minConfidence:.5,maxActiveSignals:10,effectivenessWindowSize:50},Is={debug:(n,e)=>{},info:(n,e)=>console.info(`[SignalDetector] ${n}`,e),warn:(n,e)=>console.warn(`[SignalDetector] ${n}`,e),error:(n,e)=>console.error(`[SignalDetector] ${n}`,e)};class IJ{constructor(e){Ee(this,"config");Ee(this,"signalCache",new Map);Ee(this,"cacheTimeout",5e3);this.config=e}async initialize(){Is.info("SignalDetector initializing..."),Is.info("SignalDetector initialized")}async detectSignals(e,t,s){const r=Date.now(),o=[],i=[],a=`${e}-${t}-${s.attemptNumber}`,c=this.getCachedSignals(a);if(c)return c;const l=[this.detectMemoryAcquisitionSignals(e,t,s),this.detectCognitiveLoadSignals(s),this.detectErrorPredictionSignals(e,t),this.detectLearningStyleSignals(s),this.detectLinguisticRelationsSignals(e),this.detectContextualLearningSignals(e,t)];if((await Promise.allSettled(l)).forEach((p,m)=>{const g=this.getModuleName(m);p.status==="fulfilled"?(o.push(...p.value),Is.debug(`${g} signals detected`,{count:p.value.length})):(i.push({module:g,error:p.reason}),Is.warn(`${g} failed`,p.reason))}),o.length===0&&i.length>0)return Is.error("All AI modules failed",{errors:i}),[];i.length>0&&o.length>0&&Is.warn("Some AI modules failed",{failed:i.length,succeeded:o.length});const h=this.filterAndSortSignals(o);this.cacheSignals(a,h);const f=Date.now()-r;return Is.debug("Signal detection completed",{duration:f,signalCount:h.length}),h}async detectMemoryAcquisitionSignals(e,t,s){const r=[];try{const o=this.getAcquisitionProgress(e);if(!o)return r;t==="incorrect"&&this.shouldImmediateRepeat(o)&&r.push({source:ps.MEMORY_ACQUISITION,type:At.IMMEDIATE_REPETITION,strength:this.calculateImmediateRepeatStrength(o),confidence:.9,priority:9,timestamp:Date.now(),metadata:{currentExposure:o.totalAttempts,targetExposure:o.dynamicThreshold,consecutiveErrors:this.getConsecutiveErrors(o),acquisitionProgress:this.calculateAcquisitionProgress(o)}}),t==="correct"&&o.correctRate>=.5&&r.push({source:ps.MEMORY_ACQUISITION,type:At.SPACED_REPETITION,strength:Math.min(o.correctRate,.8),confidence:.85,priority:7,timestamp:Date.now(),metadata:{correctRate:o.correctRate,consecutiveCorrect:o.consecutiveCorrectStreak}}),t==="incorrect"&&o.totalAttempts<o.dynamicThreshold&&r.push({source:ps.MEMORY_ACQUISITION,type:At.INCREASE_EXPOSURE,strength:1-o.totalAttempts/o.dynamicThreshold,confidence:.8,priority:8,timestamp:Date.now(),metadata:{currentAttempts:o.totalAttempts,targetAttempts:o.dynamicThreshold}})}catch(o){Is.error("Memory Acquisition signal detection failed",o)}return r}async detectCognitiveLoadSignals(e){const t=[];try{const s=e.cognitiveLoad??this.estimateCognitiveLoad(e);s>.8&&t.push({source:ps.COGNITIVE_LOAD,type:At.TAKE_BREAK,strength:Math.min(s,1),confidence:.95,priority:10,timestamp:Date.now(),metadata:{cognitiveLoad:s,sessionDuration:e.sessionDuration,recommendedBreakDuration:this.calculateBreakDuration(s),fatigueLevel:this.getFatigueLevel(s)}}),s>.6&&e.recentErrors>=2&&t.push({source:ps.COGNITIVE_LOAD,type:At.REDUCE_DIFFICULTY,strength:(s+e.recentErrors/5)/2,confidence:.8,priority:8,timestamp:Date.now(),metadata:{cognitiveLoad:s,recentErrors:e.recentErrors}});const r=e.sessionDuration?e.sessionDuration/6e4:0;r>30&&t.push({source:ps.COGNITIVE_LOAD,type:At.ADJUST_SESSION_LENGTH,strength:Math.min(r/60,.6),confidence:.7,priority:6,timestamp:Date.now(),metadata:{sessionDuration:e.sessionDuration,sessionMinutes:r}})}catch(s){Is.error("Cognitive Load signal detection failed",s)}return t}async detectErrorPredictionSignals(e,t){const s=[];try{if(t==="incorrect"){const r=this.getConfusionPairs(e);r.length>0&&s.push({source:ps.ERROR_PREDICTION,type:At.USE_CONFUSION_PAIRS,strength:Math.min(.7+r.length*.1,.9),confidence:.85,priority:8,timestamp:Date.now(),metadata:{confusionPairs:r,errorType:this.detectErrorType(e)}}),this.needsContextualLearning(e)&&s.push({source:ps.ERROR_PREDICTION,type:At.CONTEXTUAL_LEARNING,strength:.6,confidence:.75,priority:7,timestamp:Date.now(),metadata:{reason:"context_insufficient"}})}}catch(r){Is.error("Error Prediction signal detection failed",r)}return s}async detectLearningStyleSignals(e){const t=[];try{const s=new Date().getHours(),r=this.getOptimalLearningHour(),o=Math.abs(s-r);o>3&&t.push({source:ps.LEARNING_STYLE,type:At.TIME_OF_DAY_OPTIMIZATION,strength:Math.min(o/12,.5),confidence:.6,priority:4,timestamp:Date.now(),metadata:{currentHour:s,optimalHour:r}});const i=25*60*1e3,a=Math.abs((e.sessionDuration??0)-i);a>10*60*1e3&&t.push({source:ps.LEARNING_STYLE,type:At.ADJUST_SESSION_LENGTH,strength:Math.min(a/(30*60*1e3),.6),confidence:.65,priority:5,timestamp:Date.now(),metadata:{currentSessionLength:e.sessionDuration,optimalSessionLength:i}})}catch(s){Is.error("Learning Style signal detection failed",s)}return t}async detectLinguisticRelationsSignals(e){const t=[];try{e.length>3&&t.push({source:ps.LINGUISTIC_RELATIONS,type:At.GROUP_BY_THEME,strength:.6,confidence:.5,priority:6,timestamp:Date.now(),metadata:{simplified:!0,reason:"Èñ¢ÈÄ£Ë™ûÂΩô„Å´„Çà„Çã„Ç∞„É´„Éº„ÉóÂ≠¶Áøí„ÇíÊé®Â•®"}}),e.length>=4&&t.push({source:ps.LINGUISTIC_RELATIONS,type:At.USE_ETYMOLOGY,strength:.4,confidence:.5,priority:5,timestamp:Date.now(),metadata:{simplified:!0,reason:"Ë™ûÊ∫êÊÉÖÂ†±„ÇíÊ¥ªÁî®„Åó„ÅüÂ≠¶Áøí„ÇíÊé®Â•®"}})}catch(s){Is.error("Linguistic Relations signal detection failed",s)}return t}async detectContextualLearningSignals(e,t){const s=[];try{if(t==="incorrect"){this.hasAvailableContexts(e)&&s.push({source:ps.CONTEXTUAL_LEARNING,type:At.CONTEXTUAL_LEARNING,strength:.75,confidence:.85,priority:7,timestamp:Date.now(),metadata:{availableContexts:this.getAvailableContextCount(e)}});const o=this.getThemeCategory(e);o&&s.push({source:ps.CONTEXTUAL_LEARNING,type:At.GROUP_BY_THEME,strength:.6,confidence:.75,priority:6,timestamp:Date.now(),metadata:{themeCategory:o}})}}catch(r){Is.error("Contextual Learning signal detection failed",r)}return s}filterAndSortSignals(e){const t=this.config.minSignalStrength??.3,s=e.filter(r=>r.strength>=t);return s.sort((r,o)=>o.priority-r.priority),s.slice(0,this.config.maxActiveSignals)}cacheSignals(e,t){this.signalCache.set(e,t),setTimeout(()=>{this.signalCache.delete(e)},this.cacheTimeout)}getCachedSignals(e){return this.signalCache.get(e)||null}getModuleName(e){return["MemoryAcquisition","CognitiveLoad","ErrorPrediction","LearningStyle","LinguisticRelations","ContextualLearning"][e]||"Unknown"}getAcquisitionProgress(e){try{const t=`acquisition_${e}`,s=localStorage.getItem(t);if(s)return JSON.parse(s)}catch(t){Is.warn("Failed to load acquisition progress",t)}return null}shouldImmediateRepeat(e){return this.getConsecutiveErrors(e)>=3}getConsecutiveErrors(e){let t=0;for(let s=e.todayReviews.length-1;s>=0&&!e.todayReviews[s].isCorrect;s--)t++;return t}calculateImmediateRepeatStrength(e){const t=this.getConsecutiveErrors(e);return Math.min(.8+t*.05,1)}calculateAcquisitionProgress(e){return Math.min(e.totalAttempts/e.dynamicThreshold*100,100)}estimateCognitiveLoad(e){const t=Math.min((e.sessionDuration??0)/36e5,1),s=Math.min(e.recentErrors/5,1);return(t+s)/2}calculateBreakDuration(e){return e>=.9?10*60*1e3:e>=.8?5*60*1e3:3*60*1e3}getFatigueLevel(e){return e>=.8?"high":e>=.5?"medium":"low"}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}detectErrorType(e){return"meaning"}needsContextualLearning(e){return["abstract","concept","theory","principle"].includes(e)}getOptimalLearningHour(){return 10}hasAvailableContexts(e){return!0}getAvailableContextCount(e){return 3}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const lr={debug:(n,e)=>{},info:(n,e)=>console.info(`[StrategyExecutor] ${n}`,e),warn:(n,e)=>console.warn(`[StrategyExecutor] ${n}`,e),error:(n,e)=>console.error(`[StrategyExecutor] ${n}`,e)};class kJ{constructor(e){Ee(this,"config");Ee(this,"strategyHistory",[]);Ee(this,"MAX_HISTORY",20);this.config=e}async initialize(){lr.info("StrategyExecutor initializing..."),this.loadHistory(),lr.info("StrategyExecutor initialized")}selectBestStrategy(e,t){try{if(!Array.isArray(e))throw new Error("Signals must be an array");if(e.length===0)return lr.info("No signals provided, using default strategy"),this.getDefaultRecommendation();const s=this.config.minConfidence??.5,r=e.filter(c=>c.confidence>=s);if(r.length===0)return lr.warn("No signals meet confidence threshold",{totalSignals:e.length,minConfidence:this.config.minConfidence}),this.getDefaultRecommendation();const o=r.find(c=>c.priority===10);if(o)return lr.info("Critical priority signal detected",{type:o.type}),this.createRecommendation(o,r,"critical_priority");const i=r.map(c=>({signal:c,score:this.calculateScore(c,t)}));i.forEach(c=>{const l=this.calculateDiversityPenalty(c.signal.type);c.score-=l}),i.sort((c,l)=>l.score-c.score);const a=i[0];return lr.debug("Strategy selected",{strategy:a.signal.type,score:a.score,totalSignals:r.length}),this.createRecommendation(a.signal,r,"score_based",a.score)}catch(s){return lr.error("Strategy selection failed",{signals:e,error:s}),this.getFallbackRecommendation(s)}}async executeStrategy(e,t,s){const r=Date.now();try{if(!Object.values(At).includes(e))throw new Error(`Invalid strategy type: ${e}`);const o=[];switch(e){case At.IMMEDIATE_REPETITION:o.push(await this.executeImmediateRepetition(t));break;case At.TAKE_BREAK:o.push(...await this.executeTakeBreak(s));break;case At.USE_CONFUSION_PAIRS:o.push(await this.executeConfusionPairs(t));break;case At.REDUCE_DIFFICULTY:o.push(await this.executeReduceDifficulty(t));break;case At.SPACED_REPETITION:o.push(await this.executeSpacedRepetition(t));break;case At.CONTEXTUAL_LEARNING:o.push(await this.executeContextualLearning(t));break;case At.GROUP_BY_THEME:o.push(await this.executeGroupByTheme(t));break;case At.ADJUST_SESSION_LENGTH:o.push(await this.executeAdjustSessionLength(s));break;case At.USE_ETYMOLOGY:o.push(await this.executeUseEtymology(t));break;case At.TIME_OF_DAY_OPTIMIZATION:o.push(await this.executeTimeOfDayOptimization());break;case At.INCREASE_EXPOSURE:o.push(await this.executeIncreaseExposure(t));break;case At.CONTINUE_NORMAL:break;default:lr.warn(`No execution logic for strategy: ${e}`)}return this.recordUsage(e),{success:!0,strategy:e,actions:o,duration:Date.now()-r}}catch(o){return lr.error("Strategy execution failed",{strategy:e,word:t,error:o}),{success:!1,strategy:e,actions:[],duration:Date.now()-r,error:o instanceof Error?o.message:String(o)}}}async executeImmediateRepetition(e){return{type:"QUEUE_FRONT",timestamp:Date.now(),metadata:{word:e,position:0,queueType:"immediate"}}}async executeTakeBreak(e){const t=this.calculateBreakDuration(e);return[{type:"PAUSE_SESSION",timestamp:Date.now(),metadata:{duration:t,reason:"cognitive_load"}},{type:"SHOW_BREAK_NOTIFICATION",timestamp:Date.now(),metadata:{message:`${t/6e4}ÂàÜÈñì„ÅÆ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô`}}]}async executeConfusionPairs(e){const t=this.getConfusionPairs(e);return{type:"LOAD_CONFUSION_PAIRS",timestamp:Date.now(),metadata:{word:e,pairs:t}}}async executeReduceDifficulty(e){return{type:"ADJUST_DIFFICULTY",timestamp:Date.now(),metadata:{word:e,direction:"decrease",amount:1}}}async executeSpacedRepetition(e){return{type:"SCHEDULE_SPACED_REVIEW",timestamp:Date.now(),metadata:{word:e,nextReviewTime:Date.now()+24*60*60*1e3}}}async executeContextualLearning(e){return{type:"SHOW_CONTEXT_EXAMPLES",timestamp:Date.now(),metadata:{word:e,exampleCount:3}}}async executeGroupByTheme(e){const t=this.getThemeCategory(e);return{type:"GROUP_WORDS_BY_THEME",timestamp:Date.now(),metadata:{word:e,theme:t}}}async executeAdjustSessionLength(e){return{type:"ADJUST_SESSION_LENGTH",timestamp:Date.now(),metadata:{currentLength:e.sessionDuration,recommendedLength:15e5}}}async executeUseEtymology(e){return{type:"SHOW_ETYMOLOGY",timestamp:Date.now(),metadata:{word:e}}}async executeTimeOfDayOptimization(){return{type:"SUGGEST_OPTIMAL_TIME",timestamp:Date.now(),metadata:{optimalHour:10,message:"Â≠¶ÁøíÂäπÊûú„ÅåÊúÄ„ÇÇÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÅØ10ÊôÇÈ†É„Åß„Åô"}}}async executeIncreaseExposure(e){return{type:"INCREASE_EXPOSURE_FREQUENCY",timestamp:Date.now(),metadata:{word:e,multiplier:1.5}}}calculateScore(e,t){const s=e.strength*e.priority,r=e.confidence*2;let o=0;const i=t.get(e.type);if(i){o=i.successRate*3;const a=Date.now()-i.lastUsed,c=Math.max(0,2-a/1e6);o-=c}return s+r+o}calculateDiversityPenalty(e){return this.strategyHistory.slice(-5).filter(s=>s.strategy===e).length*.5}createRecommendation(e,t,s,r){return{strategy:e.type,confidence:e.confidence,reason:this.generateReason(e),signals:t,metadata:{selectionMethod:s,score:r,signalSource:e.source}}}generateReason(e){return{[At.IMMEDIATE_REPETITION]:"ÈÄ£Á∂ö„Ç®„É©„Éº„ÅåÊ§úÂá∫„Åï„Çå„Åü„Åü„ÇÅ„ÄÅÂç≥Â∫ß„Å´Âæ©Áøí„Åó„Åæ„Åô",[At.TAKE_BREAK]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô",[At.USE_CONFUSION_PAIRS]:"Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑÂçòË™û„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü",[At.REDUCE_DIFFICULTY]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅÈõ£ÊòìÂ∫¶„Çí‰∏ã„Åí„Åæ„Åô",[At.SPACED_REPETITION]:"ÁøíÂæó„ÅåÈÄ≤„Çì„Åß„ÅÑ„Çã„Åü„ÇÅ„ÄÅÈñìÈöî„ÇíÁ©∫„Åë„Å¶Âæ©Áøí„Åó„Åæ„Åô",[At.CONTEXTUAL_LEARNING]:"ÊñáËÑà‰æãÊñá„ÅßÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô",[At.GROUP_BY_THEME]:"Èñ¢ÈÄ£Ë™ûÂΩô„Å®„Çª„ÉÉ„Éà„ÅßÂ≠¶Áøí„Åó„Åæ„Åô",[At.ADJUST_SESSION_LENGTH]:"„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑„ÇíÊúÄÈÅ©Âåñ„Åó„Åæ„Åô",[At.USE_ETYMOLOGY]:"Ë™ûÊ∫êÊÉÖÂ†±„ÅßË®òÊÜ∂„ÇíÂº∑Âåñ„Åó„Åæ„Åô",[At.TIME_OF_DAY_OPTIMIZATION]:"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø„ÇíÊèêÊ°à„Åó„Åæ„Åô",[At.INCREASE_EXPOSURE]:"Èú≤Âá∫ÂõûÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Å¶ÂÆöÁùÄ„Çí‰øÉÈÄ≤„Åó„Åæ„Åô",[At.CONTINUE_NORMAL]:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô"}[e.type]||"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊà¶Áï•„ÇíÈÅ©Áî®„Åó„Åæ„Åô"}getDefaultRecommendation(){return{strategy:At.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!1,default:!0}}}getFallbackRecommendation(e){return{strategy:At.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:e==null?void 0:e.message}}}recordUsage(e){this.strategyHistory.push({strategy:e,timestamp:Date.now()}),this.strategyHistory.length>this.MAX_HISTORY&&this.strategyHistory.shift(),this.saveHistory()}saveHistory(){try{localStorage.setItem("adaptive_strategy_history",JSON.stringify(this.strategyHistory))}catch(e){lr.warn("Failed to save strategy history",e)}}loadHistory(){try{const e=localStorage.getItem("adaptive_strategy_history");e&&(this.strategyHistory=JSON.parse(e))}catch(e){lr.warn("Failed to load strategy history",e)}}calculateBreakDuration(e){const t=e.cognitiveLoad??.5;return t>=.9?10*60*1e3:t>=.8?5*60*1e3:3*60*1e3}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const Ir={debug:(n,e)=>{},info:(n,e)=>console.info(`[EffectivenessTracker] ${n}`,e),warn:(n,e)=>console.warn(`[EffectivenessTracker] ${n}`,e),error:(n,e)=>console.error(`[EffectivenessTracker] ${n}`,e)},sb="adaptive_network_effectiveness";class $J{constructor(e){Ee(this,"effectiveness",new Map);Ee(this,"measurements",[]);Ee(this,"config");Ee(this,"saveTimer",null);this.config=e}async initialize(){Ir.info("EffectivenessTracker initializing..."),await this.loadHistory(),Ir.info("EffectivenessTracker initialized",{strategies:this.effectiveness.size,measurements:this.measurements.length})}recordOutcome(e,t){try{if(!Object.values(At).includes(e))throw new Error(`Invalid strategy: ${e}`);if(typeof t.success!="boolean")throw new Error("Outcome.success must be boolean");let s=this.effectiveness.get(e);s||(s=this.createDefaultEffectiveness(e),this.effectiveness.set(e,s)),s.totalUses++,t.success?s.successCount++:s.failureCount++,s.successRate=s.successCount/s.totalUses,s.lastUsed=t.timestamp,t.timeToMastery!==void 0&&this.updateAverage(s,"averageTimeToMastery",t.timeToMastery),t.retentionRate!==void 0&&this.updateAverage(s,"averageRetentionRate",t.retentionRate),s.confidence=this.calculateConfidence(s.totalUses),this.measurements.push({strategy:e,outcome:t,timestamp:Date.now()});const r=this.config.effectivenessWindowSize??50;this.measurements.length>r*2&&(this.measurements=this.measurements.slice(-r)),Ir.debug("Outcome recorded",{strategy:e,success:t.success,totalUses:s.totalUses,successRate:s.successRate}),this.debounceSave()}catch(s){Ir.error("Failed to record outcome",{strategy:e,outcome:t,error:s})}}getEffectiveness(e){return this.effectiveness.get(e)}getAllEffectiveness(){return new Map(this.effectiveness)}compareStrategies(e,t){const s=this.effectiveness.get(e),r=this.effectiveness.get(t);if(!s||!r)return{strategy1:e,strategy2:t,betterStrategy:null,successRateDiff:0,confidenceLevel:0,recommendation:"„Éá„Éº„Çø‰∏çË∂≥„ÅÆ„Åü„ÇÅÊØîËºÉ„Åß„Åç„Åæ„Åõ„Çì"};const o=s.successRate-r.successRate,i=this.calculateStatisticalSignificance(s,r);let a=null;Math.abs(o)>.05&&i>.8&&(a=o>0?e:t);let c="";return a?c=`${a}„ÅÆÊñπ„ÅåÂäπÊûúÁöÑ„Åß„ÅôÔºàÂ∑Æ: ${(Math.abs(o)*100).toFixed(1)}%Ôºâ`:i<.8?c="„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô":c="‰∏°Êà¶Áï•„ÅÆÂäπÊûú„ÅØÂêåÁ®ãÂ∫¶„Åß„Åô",{strategy1:e,strategy2:t,betterStrategy:a,successRateDiff:o,confidenceLevel:i,recommendation:c}}exportMetrics(){const e=Array.from(this.effectiveness.values()),t=e.filter(i=>i.totalUses>=10).sort((i,a)=>a.successRate-i.successRate).slice(0,3).map(i=>({strategy:i.strategyType,successRate:i.successRate,uses:i.totalUses})),s=[];t.length>0&&s.push(`ÊúÄ„ÇÇÂäπÊûúÁöÑ„Å™Êà¶Áï•: ${t[0].strategy}ÔºàÊàêÂäüÁéá: ${(t[0].successRate*100).toFixed(1)}%Ôºâ`);const r=e.filter(i=>i.totalUses>=10&&i.successRate<.5).map(i=>i.strategyType);r.length>0&&s.push(`ÊîπÂñÑ„ÅåÂøÖË¶Å„Å™Êà¶Áï•: ${r.join(", ")}`);const o=e.filter(i=>i.totalUses<10);return o.length>0&&s.push(`„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å: ${o.length}ÂÄã„ÅÆÊà¶Áï•`),{topPerformers:t,recommendations:s,timestamp:Date.now()}}reset(){Ir.info("Resetting effectiveness data"),this.effectiveness.clear(),this.measurements=[],this.saveToStorage()}createDefaultEffectiveness(e){return{strategyType:e,totalUses:0,successCount:0,failureCount:0,successRate:0,averageTimeToMastery:0,averageRetentionRate:0,lastUsed:0,confidence:0}}updateAverage(e,t,s){const r=e[t],o=e.totalUses;e[t]=(r*(o-1)+s)/o}calculateConfidence(e){return Math.min(1,e/(e+2+2))}calculateStatisticalSignificance(e,t){const s=e.totalUses,r=t.totalUses,o=Math.abs(e.successRate-t.successRate);return(Math.min(1,(s+r)/100)+o)/2}async loadHistory(){try{const e=localStorage.getItem(sb);if(!e){Ir.info("No stored effectiveness data found");return}const t=JSON.parse(e);t.strategies&&t.strategies.forEach(s=>{this.effectiveness.set(s.strategyType,s)}),Array.isArray(t.measurements)&&(this.measurements=t.measurements),Ir.info("Effectiveness data loaded",{strategies:this.effectiveness.size,measurements:this.measurements.length})}catch(e){Ir.error("Failed to load effectiveness data",e)}}saveToStorage(){try{const e={version:"1.0.0",strategies:Array.from(this.effectiveness.values()),measurements:this.measurements,lastUpdated:Date.now()};localStorage.setItem(sb,JSON.stringify(e)),Ir.debug("Effectiveness data saved")}catch(e){Ir.warn("Failed to save effectiveness data",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveToStorage(),this.saveTimer=null},500)}}const sn={debug:(n,e)=>{},info:(n,e)=>console.info(`[AdaptiveNetwork] ${n}`,e),warn:(n,e)=>console.warn(`[AdaptiveNetwork] ${n}`,e),error:(n,e)=>console.error(`[AdaptiveNetwork] ${n}`,e)},Af="adaptive_network_state",TJ="adaptive_network_config";class AJ{constructor(e){Ee(this,"signalDetector");Ee(this,"strategyExecutor");Ee(this,"effectivenessTracker");Ee(this,"state");Ee(this,"config");Ee(this,"saveTimer",null);this.config={...NJ,...e},this.state=this.createInitialState(),this.signalDetector=new IJ(this.config),this.strategyExecutor=new kJ(this.config),this.effectivenessTracker=new $J(this.config),this.loadState(),sn.info("AdaptiveEducationalAINetwork created",{enabled:this.config.enabled})}async initialize(){sn.info("Initializing AdaptiveEducationalAINetwork...");try{await Promise.all([this.signalDetector.initialize(),this.strategyExecutor.initialize(),this.effectivenessTracker.initialize()]),this.validateAndRepairState(),sn.info("AdaptiveEducationalAINetwork initialized successfully")}catch(e){sn.error("Initialization failed",e);try{this.initializeWithDefaults(),sn.info("Initialized with default configuration")}catch{throw new Error(`Failed to initialize Adaptive Network: ${e instanceof Error?e.message:String(e)}`)}}}async processQuestion(e,t,s){try{this.validateInput(e,t,s)}catch(r){return sn.error("Invalid input",{word:e,result:t,context:s,error:r}),this.getDefaultRecommendation()}if(!this.state.enabled)return this.getDefaultRecommendation();try{const r=await this.signalDetector.detectSignals(e,t,s);sn.debug("Signals detected",{word:e,result:t,signalCount:r.length});const o=this.strategyExecutor.selectBestStrategy(r,this.state.effectiveness);return sn.info("Strategy selected",{word:e,result:t,strategy:o.strategy,confidence:o.confidence}),this.executeStrategyAsync(o.strategy,e,s),this.updateState(o,r),this.updateSessionStats(t),this.debounceSave(),o}catch(r){return sn.error("Question processing failed",{word:e,result:t,context:s,error:r}),{strategy:At.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{error:!0,fallback:!0,errorMessage:r instanceof Error?r.message:String(r)}}}}getState(){return{...this.state}}updateConfig(e){this.config={...this.config,...e},e.enabled!==void 0&&(this.state.enabled=e.enabled),this.saveConfig(),sn.info("Configuration updated",e)}resetState(){sn.info("Resetting network state"),this.state=this.createInitialState(),this.effectivenessTracker.reset();try{localStorage.removeItem(Af)}catch(e){sn.warn("Failed to remove state from storage",e)}sn.info("Network state reset complete")}exportState(){const e={version:"1.0.0",state:this.state,config:this.config,effectiveness:Array.from(this.state.effectiveness.entries()),exportedAt:Date.now()};return JSON.stringify(e,null,2)}importState(e){try{const t=JSON.parse(e);t.version!=="1.0.0"&&sn.warn("Version mismatch, attempting migration",{expected:"1.0.0",actual:t.version}),t.state&&(this.state={...t.state,effectiveness:new Map(t.effectiveness||[])}),t.config&&(this.config=t.config),this.saveState(),this.saveConfig(),sn.info("State imported successfully")}catch(t){throw sn.error("Failed to import state",t),new Error(`Invalid state data: ${t instanceof Error?t.message:String(t)}`)}}createInitialState(){return{enabled:this.config.enabled,currentStrategy:null,activeSignals:[],effectiveness:new Map,sessionStats:{questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0},lastUpdated:Date.now()}}initializeWithDefaults(){this.state=this.createInitialState(),sn.info("Initialized with defaults")}validateInput(e,t,s){if(!e||typeof e!="string")throw new Error("Invalid word parameter");if(t!=="correct"&&t!=="incorrect")throw new Error('Result must be "correct" or "incorrect"');if(!s||typeof s!="object")throw new Error("Invalid context parameter")}getDefaultRecommendation(){return{strategy:At.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}async executeStrategyAsync(e,t,s){try{const r=await this.strategyExecutor.executeStrategy(e,t,s);r.success?sn.debug("Strategy executed",{strategy:e,actionCount:r.actions.length,duration:r.duration}):sn.warn("Strategy execution failed",{strategy:e,error:r.error})}catch(r){sn.error("Strategy execution error",{strategy:e,error:r})}}updateState(e,t){this.state.currentStrategy=e.strategy,this.state.activeSignals=t,this.state.lastUpdated=Date.now()}updateSessionStats(e){this.state.sessionStats.questionsAnswered++,e==="correct"?this.state.sessionStats.correctAnswers++:this.state.sessionStats.incorrectAnswers++,this.state.sessionStats.totalSessionTime=Date.now()-this.state.sessionStats.sessionStartTime}validateAndRepairState(){typeof this.state.enabled!="boolean"&&(sn.warn("Invalid enabled state, repairing"),this.state.enabled=!1),Array.isArray(this.state.activeSignals)||(sn.warn("Invalid activeSignals, repairing"),this.state.activeSignals=[]),this.state.effectiveness instanceof Map||(sn.warn("Invalid effectiveness map, repairing"),this.state.effectiveness=new Map),(!this.state.sessionStats||typeof this.state.sessionStats!="object")&&(sn.warn("Invalid sessionStats, repairing"),this.state.sessionStats={questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0})}loadState(){try{const e=localStorage.getItem(Af);if(!e){sn.info("No stored state found");return}const t=JSON.parse(e);t.effectiveness&&Array.isArray(t.effectiveness)&&(t.effectiveness=new Map(t.effectiveness)),this.state={...this.state,...t},sn.info("State loaded from storage")}catch(e){sn.error("Failed to load state",e)}}saveState(){try{const e={...this.state,effectiveness:Array.from(this.state.effectiveness.entries())};localStorage.setItem(Af,JSON.stringify(e)),sn.debug("State saved to storage")}catch(e){sn.warn("Failed to save state",e)}}saveConfig(){try{localStorage.setItem(TJ,JSON.stringify(this.config))}catch(e){sn.warn("Failed to save config",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveState(),this.saveTimer=null},500)}}function qh(){const n=T.useRef(null),[e,t]=T.useState(!0),[s,r]=T.useState(null),[o,i]=T.useState(new Map),[a,c]=T.useState(!1),[l,d]=T.useState(null),[h,f]=T.useState(!1);T.useEffect(()=>{(async()=>{try{if(!n.current){n.current=new AJ({enabled:!0}),await n.current.initialize();const b=n.current.getState();t(b.enabled),r(b.currentStrategy),i(b.effectiveness),f(!0),console.log("[useAdaptiveNetwork] Network initialized")}}catch(b){d(b instanceof Error?b:new Error(String(b))),console.error("[useAdaptiveNetwork] Initialization failed",b)}})()},[]);const p=T.useCallback(async(y,b,v)=>{if(!n.current)return console.warn("[useAdaptiveNetwork] Network not initialized"),EJ();c(!0),d(null);try{const w=await n.current.processQuestion(y,b,v);r(w.strategy);const S=n.current.getState();return i(S.effectiveness),w}catch(w){const S=w instanceof Error?w:new Error(String(w));return d(S),console.error("[useAdaptiveNetwork] Question processing failed",w),RJ(S)}finally{c(!1)}},[e]),m=T.useCallback(()=>{if(!n.current)return;const y=!e;n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`)},[e]),g=T.useCallback(y=>{n.current&&(n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`))},[]),x=T.useCallback(()=>{n.current&&(n.current.resetState(),r(null),i(new Map),d(null),console.log("[useAdaptiveNetwork] State reset"))},[]);return{enabled:e,currentStrategy:s,processQuestion:p,toggleEnabled:m,setEnabled:g,resetState:x,effectiveness:o,isLoading:a,error:l,isInitialized:h}}function EJ(){return{strategy:At.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}function RJ(n){return{strategy:At.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:n.message}}}function rb({question:n,allQuestions:e,currentIndex:t,answered:s,selectedAnswer:r,onAnswer:o,onNext:i,onPrevious:a,onDifficultyRate:c,customQuestionSets:l=[],onAddWordToCustomSet:d,onRemoveWordFromCustomSet:h,onOpenCustomSetManagement:f,onFullscreen:p}){const m=T.useMemo(()=>rk(n,e,t),[n.word,e,t]),[g,x]=T.useState(null),[y,b]=T.useState(new Set),[v,w]=T.useState(""),[S,I]=T.useState(0),[,C]=T.useState(()=>{const K=sessionStorage.getItem("currentCorrectStreak");return K?parseInt(K,10):0}),{processQuestion:k}=qh(),$=async(K,D)=>{try{const G=ge=>{const Ae=(ge.grade||1)/9;return Math.min(Math.max(Ae,0),1)},te=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(Ae=>!Ae.correct).length,W=()=>{const ge=sessionStorage.getItem("sessionStartTime");return ge?Math.floor((Date.now()-parseInt(ge))/6e4):0},de=()=>parseInt(sessionStorage.getItem("currentCorrectStreak")||"0"),le=()=>{const ge=new Date().getHours();return ge<12?"morning":ge<18?"afternoon":ge<22?"evening":"night"},oe=await k(K,D?"correct":"incorrect",{currentDifficulty:G(n),timeOfDay:le(),recentErrors:te(),sessionLength:W(),consecutiveCorrect:de()});console.log("[AdaptiveAI]",oe.reason,{strategy:oe.strategy,confidence:oe.confidence})}catch(G){console.error("[QuestionCard] Adaptive AI error:",G)}},N=T.useRef(0),_=T.useRef(0),P=T.useRef(null),j=T.useRef(!1);T.useEffect(()=>{x(null),b(new Set),w(""),I(0)},[t]);const A=K=>{b(D=>{const G=new Set(D);return s?G.size>0?new Set:new Set(m.map((te,W)=>W)):(G.has(K)?G.delete(K):G.add(K),G)})};T.useEffect(()=>{const K=localStorage.getItem("autoShowDetails")!=="false";s&&r&&r!==n.meaning&&K&&b(new Set(m.map((D,G)=>G)))},[s,r,n.meaning,m]),T.useEffect(()=>{if(s&&r){const K=localStorage.getItem("aiPersonality")||"kind-teacher",D=r===n.meaning,G=parseInt(sessionStorage.getItem("currentCorrectStreak")||"0",10);let te=wk(K,{isCorrect:D,word:n.word,difficulty:"intermediate",category:"",attemptCount:S+1,responseTime:0,correctStreak:0,incorrectStreak:0,userAccuracy:0,categoryAccuracy:0,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:0,todayAccuracy:0,planProgress:0,timeOfDay:X0()});const W=[];if(D&&Math.random()<.1){const oe=Sk();oe.estimatedDaysToAchieve>0&&oe.estimatedDaysToAchieve<=30&&(oe.overallProgress>=90?W.push(`üéØ ${oe.goal.name}„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ`):oe.overallProgress>=75&&W.push(`üìà „Åì„ÅÆ„Éö„Éº„Çπ„Å™„Çâ${oe.estimatedDaysToAchieve}Êó•„Åß${oe.goal.name}ÈÅîÊàê„Åß„ÅôÔºÅ`))}if(!D){const oe=Ck(n.word);oe.length>0&&W.push(`üí° „Äå${n.word}„Äç„Å®„Äå${oe.join(", ")}„Äç„ÇíÊ∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßÊ≥®ÊÑèÔºÅ`)}if(!D&&Math.random()<.05){const ge=pJ().find(Ae=>Ae.words.includes(n.word.toLowerCase())&&Ae.needsReview);ge&&W.push(xJ(ge))}const de=Y9(K,D,G);if(de&&W.push(de.message),D){const oe=tJ(G+1);oe&&W.push(oe)}const le=cJ(D);if(le&&W.push(le),D){const oe=G+1;C(oe),sessionStorage.setItem("currentCorrectStreak",String(oe))}else C(0),sessionStorage.setItem("currentCorrectStreak","0");W.length>0&&(te=`${te} ${W[0]}`),w(te)}else w("")},[s,r,n,S]);const F=()=>{b(new Set),I(0),i()};T.useEffect(()=>{const K=W=>{const de=W.target;de.closest(".choice-btn")||de.closest(".choice-wrapper")||de.closest(".toggle-details-btn")||de.closest(".rating-btn")||de.closest(".inline-nav-btn")||de.closest(".question-text")||(N.current=W.touches[0].clientX,_.current=N.current,j.current=!0)},D=W=>{N.current!==0&&(_.current=W.touches[0].clientX)},G=()=>{if(N.current===0){j.current=!1;return}_.current===0&&(_.current=N.current);const W=N.current-_.current;Math.abs(W)>80&&(W>0?s?F():i():t>0&&a()),N.current=0,_.current=0,setTimeout(()=>{j.current=!1},300)},te=P.current;if(te)return te.addEventListener("touchstart",K,{passive:!0}),te.addEventListener("touchmove",D,{passive:!0}),te.addEventListener("touchend",G),()=>{te.removeEventListener("touchstart",K),te.removeEventListener("touchmove",D),te.removeEventListener("touchend",G)}},[s,t,i,a]),T.useEffect(()=>{const K=D=>{if(!s&&["1","2","3","4"].includes(D.key)){const G=parseInt(D.key)-1;if(G<m.length){D.preventDefault();const te=m[G].text,W=m[G].question,de=te===n.meaning;de||I(le=>le+1),o(te,n.meaning,W),$(n.word,de)}}else!s&&D.key===" "?(D.preventDefault(),i()):D.key==="Enter"&&(D.preventDefault(),s?F():i())};return window.addEventListener("keydown",K),()=>{window.removeEventListener("keydown",K)}},[s,m,n,o,S]);const M=K=>{const D="w-full min-h-11 sm:min-h-14 p-2 sm:p-4 text-sm sm:text-base rounded-xl border-2 cursor-pointer transition-all duration-300 flex flex-col items-center text-center touch-manipulation select-none shadow-sm",G="hover:border-blue-600 hover:bg-gray-100:bg-gray-800 hover:-translate-y-1 hover:shadow-lg",te="active:bg-gray-200:bg-gray-700 active:translate-y-0";return K==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?s?K===r?`${D} bg-red-600 border-red-600 text-white`:`${D} bg-gray-100 text-gray-600 border-gray-400`:`${D} bg-gray-100 text-gray-600 border-gray-400 ${G} ${te}`:s?K===n.meaning?`${D} bg-green-600 border-green-600 text-white`:K===r&&K!==n.meaning?`${D} bg-red-600 border-red-600 text-white`:`${D} bg-gray-50 text-gray-900 border-gray-300`:`${D} bg-gray-50 text-gray-900 border-gray-300 ${G} ${te}`};return u.jsxs("div",{className:"question-card",ref:P,children:[p&&u.jsx("button",{onClick:p,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:a,disabled:t===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:`question-content-inline ${xn()?"clickable-pronunciation":""}`,onClick:K=>{xn()&&(K.preventDefault(),K.stopPropagation(),As(n.word,{rate:.85}))},onTouchEnd:K=>{xn()&&(K.preventDefault(),K.stopPropagation(),As(n.word,{rate:.85}))},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 break-words ${n.word.includes(" ")?"phrase-text":""} ${xn()?"clickable-word":""}`,children:[n.word,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),n.reading&&u.jsxs("div",{className:"question-reading text-sm sm:text-base text-gray-600 mt-1",children:["„Äê",n.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[n.difficulty&&u.jsx("div",{className:`difficulty-badge ${n.difficulty}`,children:n.difficulty==="beginner"?"ÂàùÁ¥ö":n.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),d&&h&&f&&l&&u.jsx(ra,{word:{word:n.word,meaning:n.meaning,katakana:n.reading,source:"translation"},sets:l,onAddWord:d,onRemoveWord:h,onOpenManagement:f,size:"medium",variant:"both"})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:F,title:"Ê¨°„Å∏",children:"‚Üí"})]}),u.jsx("div",{className:"choices",children:m.map((K,D)=>{const G=y.has(D),te=K.question;return u.jsxs("div",{className:"choice-wrapper",children:[u.jsx("button",{className:M(K.text),onClick:W=>{if(s){W.preventDefault(),W.stopPropagation(),te&&A(D);return}const de=K.text===n.meaning;de||I(le=>le+1),o(K.text,n.meaning,te),$(n.word,de)},disabled:!1,children:u.jsx("div",{className:"choice-content",children:u.jsx("div",{className:"choice-text",children:K.text})})}),s&&te&&G&&u.jsxs("div",{className:"choice-details",children:[u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™ûÂè•:"}),u.jsx("span",{className:"detail-text",children:te.word})]}),te.reading&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-text",children:te.reading})]}),te.meaning&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-text",children:te.meaning})]}),te.etymology&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠â:"}),u.jsx("span",{className:"detail-text",children:te.etymology})]}),te.relatedWords&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-text",children:te.relatedWords})]}),te.relatedFields&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è ÂàÜÈáé:"}),u.jsx("span",{className:"detail-text",children:te.relatedFields})]}),te.difficulty&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("span",{className:"detail-text",children:te.difficulty})]})]})]},D)})})]})}const J0="ab_session_logs_v1",ob=300;function DJ(n){try{const e=Y0();e.push(n),e.length>ob&&e.splice(0,e.length-ob),localStorage.setItem(J0,JSON.stringify(e))}catch(e){console.error("[AB Storage] Failed to append session log:",e)}}function Y0(){try{const n=localStorage.getItem(J0);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch(n){return console.error("[AB Storage] Failed to load session logs:",n),[]}}function _J(){const n=Y0();return JSON.stringify(n,null,2)}function PJ(){try{localStorage.removeItem(J0)}catch(n){console.error("[AB Storage] Failed to clear session logs:",n)}}function Ef(n){if(n.length===0)return 0;const e=[...n].sort((s,r)=>s-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}function nu(n){return n.length===0?0:n.reduce((e,t)=>e+t,0)/n.length}function Rf(n,e){const t=n.filter(a=>a.variant===e);if(t.length===0)return null;const s=t.map(a=>a.acquiredWordCount),r=t.map(a=>a.acquisitionRate),o=t.map(a=>a.vibrationScore),i=t.map(a=>a.durationSec);return{variant:e,sessionCount:t.length,avgAcquiredWords:nu(s),medianAcquiredWords:Ef(s),avgAcquisitionRate:nu(r),medianAcquisitionRate:Ef(r),avgVibrationScore:nu(o),medianVibrationScore:Ef(o),avgDurationSec:nu(i)}}function ib(){const n=Y0();return{totalSessions:n.length,byVariant:{A:Rf(n,"A"),B:Rf(n,"B"),C:Rf(n,"C")},lastUpdated:Date.now()}}function eo(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function jJ(n,e){if(!n)return null;switch(e){case"memorization":return n.memorizationPosition??null;case"translation":return n.translationPosition??null;case"spelling":return n.spellingPosition??null;case"grammar":return n.grammarPosition??null}}function Df(n,e){if(!n)return 0;switch(e){case"memorization":return eo(n.memorizationAttempts,0);case"translation":return eo(n.translationAttempts,0);case"spelling":return eo(n.spellingAttempts,0);case"grammar":return eo(n.grammarAttempts,0)}}function ab(n,e){if(!n)return 0;switch(e){case"memorization":return eo(n.memorizationCorrect,0);case"translation":return eo(n.translationCorrect,0);case"spelling":return eo(n.spellingCorrect,0);case"grammar":return eo(n.grammarCorrect,0)}}function cb(n,e){return!n||e!=="memorization"?0:eo(n.memorizationStillLearning,0)}function Wi(n){const{value:e}=Fb("debug_postProcess_output",{mode:n});return e?Array.isArray(e)?e:Array.isArray(e==null?void 0:e.top30)?e.top30:[]:[]}function MJ(n){return Fb("debug_postProcess_meta",{mode:n}).value}function Kh({mode:n,currentIndex:e,totalQuestions:t,questions:s,requeuedWords:r=[],initialExpanded:o=!0}){const[i,a]=T.useState(o),[c,l]=T.useState([]),[d,h]=T.useState(!1),[f,p]=T.useState([]),[m,g]=T.useState(null),[x,y]=T.useState([]),[b,v]=T.useState([]),[w,S]=T.useState(null);T.useEffect(()=>{const C=kf(n);p(C)},[e,n]),T.useEffect(()=>{if(i){const C=ib();S(C)}},[i,e]);const I=()=>{var Q,fe,Z,Fe,Ge,Le,ut,ye,Ve,lt;const C=new Date().toISOString(),k=rt(),$=Object.keys(k.wordProgress||{}).length,N=Object.values(k.wordProgress||{}),_=N.filter(B=>jJ(B,n)==null).length,P=N.filter(B=>(B==null?void 0:B.category)==null).length,j=N.filter(B=>(B==null?void 0:B.lastStudied)==null).length,A=N.filter(B=>(B==null?void 0:B.correctCount)==null||(B==null?void 0:B.incorrectCount)==null||(B==null?void 0:B.consecutiveCorrect)==null).length;let F=0,M=0,K=0,D=0,G=0,te=0,W=0;for(const B of N){const L=Df(B,n),U=ab(B,n),V=cb(B,n),ce=Ut(B,n);G+=L,te+=U,W+=V,L!==0&&(ce>=70?(K++,D++):ce>=40?(M++,D++):ce<20&&F++)}const de=Math.max(0,G-te-W),le=G>0?(te/G*100).toFixed(1):"0.0",oe=k.wordProgress||{},ge=B=>String(B??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),Ae=B=>ge(B).toLowerCase(),Ue=new Map;for(const B of Object.keys(oe)){const L=Ae(B);Ue.has(L)||Ue.set(L,B)}const Pe=B=>{const L=ge(B);if(!L)return null;const U=oe[L];if(U)return U;const V=oe[L.toLowerCase()];if(V)return V;const ce=Ue.get(Ae(L));return ce?oe[ce]??null:null},Ye=Wi(n).slice(0,10).map(B=>String((B==null?void 0:B.word)??"")).filter(Boolean),at=s.slice(e+1,e+11).map(B=>String(B.word??"")).filter(Boolean),mt=Ye.length>0?Ye:at,wt=Ye.length>0?"postProcess() TOP10":"propsÔºàÁèæÂú®‰ΩçÁΩÆ„ÅÆÊ¨°10ÂïèÔºâ",kt=B=>{const L=Pe(B),U=Ut(L,n),V=Df(L,n),ce=V===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":U>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":U>=40?"üü° „Åæ„Å†„Åæ„Å†":U>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return{position:U,attempts:V,status:ce}},dt=mt.length>0&&mt.every(B=>kt(B).position<40),ue=c.length===0?"_Ôºà„Éá„Éº„Çø„Å™„ÅóÔºâ_":`| ÂçòË™û | Position | Category | üß† Memory | üí§ CogLoad | üîÆ Error | üìö Linguistic | üåç Context | üéØ Style | üéÆ Gamify |
|------|----------|----------|-----------|-----------|----------|--------------|-----------|----------|----------|
`+c.map(B=>{const L=(()=>{switch(B.category){case"incorrect":return"‚ùå ÂàÜ„Åã„Çâ„Å™„ÅÑ";case"still_learning":return"üü° „Åæ„Å†„Åæ„Å†";case"mastered":return"‚úÖ ÂÆöÁùÄÊ∏à";case"new":return"‚ö™ Êñ∞Ë¶è";default:return"‚ö™ Êñ∞Ë¶è"}})(),U=(B.position??0).toFixed(0),V=B.aiProposals||{};return`| **${B.word}** | ${U} | ${L} | ${(V.memory??0).toFixed(0)} | ${(V.cognitiveLoad??0).toFixed(0)} | ${(V.errorPrediction??0).toFixed(0)} | ${(V.linguistic??0).toFixed(0)} | ${(V.contextual??0).toFixed(0)} | ${(V.learningStyle??0).toFixed(0)} | ${(V.gamification??0).toFixed(0)} |`}).join(`
`),xe=`# üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„É¨„Éù„Éº„ÉàÔºàË©≥Á¥∞ÁâàÔºâ

**ÁîüÊàêÊó•ÊôÇ**: ${C}
    **mode**: ${n}
**ÁèæÂú®‰ΩçÁΩÆ**: ${e+1} / ${t} ÂïèÁõÆ

---

${Hu.generateSummary(n)}

---

${(()=>{var B,L;try{const U=localStorage.getItem("debug_weak_words_detection");if(U){const V=JSON.parse(U),ce=(V.allWeakWordsInLS||0)-(((B=V.missingFromBase)==null?void 0:B.length)||0),ie=((L=V.missingFromBase)==null?void 0:L.length)||0;let O=`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

`;return O+=`**timestamp**: ${V.timestamp||"N/A"}

`,O+=`- üìä LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û: **${V.allWeakWordsInLS||0}Ë™û**
`,O+=`- ‚úÖ Ê§úÂá∫ÊàêÂäüÔºàbaseQuestions„Å´Â≠òÂú®Ôºâ: **${ce}Ë™û**
`,O+=`- ‚ùå „Éá„Éº„ÇøÊ¨†ÊêçÔºàbaseQuestions„Å´‰∏çÂú®Ôºâ: **${ie}Ë™û**
`,O+=`- üìÅ baseQuestionsÁ∑èÊï∞: ${V.baseQuestionsCount||0}Ë™û
`,O+=`- üîç filteredÁ∑èÊï∞: ${V.filteredCount||0}Ë™û

`,ie>0&&(O+=`### ‚ùå Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº: baseQuestions„Å´Â≠òÂú®„Åó„Å™„ÅÑ„Åæ„Å†„Åæ„Å†Ë™û

`,V.missingFromBase&&V.missingFromBase.length>0&&(O+="```\n",V.missingFromBase.forEach((q,re)=>{O+=`${re+1}. ${q}
`}),O+="```\n\n",O+=`**ÂéüÂõ†**: „Åì„Çå„Çâ„ÅÆÂçòË™û„ÅåÂÖÉ„ÅÆJSON„Éá„Éº„ÇøÔºàjuniorWords.jsonÁ≠âÔºâ„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
`,O+=`**ÂØæÁ≠ñ**: „Éá„Éº„Çø„ÇΩ„Éº„Çπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅ„Åì„Çå„Çâ„ÅÆÂçòË™û„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

`)),V.weakWordsList&&V.weakWordsList.length>0&&(O+=`### üìã LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û„É™„Çπ„Éà

`,O+=`| # | ÂçòË™û | Position | memPos | attempts |
`,O+=`|---|------|----------|--------|----------|
`,V.weakWordsList.slice(0,20).forEach((q,re)=>{O+=`| ${re+1} | **${q.word}** | ${q.position} | ${q.memPos??"-"} | ${q.attempts}Âõû |
`}),V.weakWordsList.length>20&&(O+=`
_‚Ä¶‰ªñ${V.weakWordsList.length-20}Ë™ûÁúÅÁï•_
`),O+=`
`),V.weakQuestionsWords&&V.weakQuestionsWords.length>0&&(O+=`### ‚úÖ Ê§úÂá∫„Åï„Çå„ÅüweakQuestions

`,O+="```\n",V.weakQuestionsWords.slice(0,10).forEach((q,re)=>{O+=`${re+1}. ${q}
`}),V.weakQuestionsWords.length>10&&(O+=`...‰ªñ${V.weakQuestionsWords.length-10}Ë™û
`),O+="```\n\n"),O+=`---

`,O}}catch(U){return`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

‚ö†Ô∏è Ê§úÂá∫„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${U}

---

`}return""})()}

## üìä „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ

**Á∑èÂêàÁµ±Ë®à**:
- üìö Á∑èÂçòË™ûÊï∞: ${$}Ë™û
- ‚úÖ ÁøíÂæóÊ∏à„Åø (Position < 20): ${F}Ë™û (${$>0?(F/$*100).toFixed(1):"0.0"}%)
- üü° „Åæ„Å†„Åæ„Å† (Position 40-70, attempts>0): ${M}Ë™û
- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${K}Ë™û
- ‚ö†Ô∏è Ëã¶ÊâãË™ûÂêàË®à (Position‚â•40): ${D}Ë™û

**Ëß£Á≠îÁµ±Ë®à**:
- Á∑èË©¶Ë°åÂõûÊï∞: ${G}Âõû
- Ê≠£Á≠î: ${te}Âõû
- Ë™§Á≠î: ${de}Âõû
- ÂÖ®‰ΩìÊ≠£Á≠îÁéá: ${le}%

**ÈÄ≤ÊçóÁéá**: ${(e/t*100).toFixed(1)}% (${e} / ${t}Âïè)

**progressCacheÂÅ•ÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ**:
- tabPosition Êú™Ë®≠ÂÆö: ${_} / ${$}
- category Êú™Ë®≠ÂÆö: ${P} / ${$}
- lastStudied Êú™Ë®≠ÂÆö: ${j} / ${$}
- ‰∏ªË¶Å„Ç´„Ç¶„É≥„ÉàÊ¨†ÊêçÔºàcorrect/incorrect/streakÔºâ: ${A} / ${$}

---

## üõ†Ô∏è Ëµ∑ÂãïÊôÇ‰øÆÂæ©„É≠„Ç∞Ôºà„Çµ„Éû„É™„ÉºÔºâ

${(()=>{const B=localStorage.getItem("debug_progress_repair_summary");if(!B)return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†loadProgress()„ÅåËµ∞„Å£„Å¶„ÅÑ„Å™„ÅÑ/‰øùÂ≠ò„Åß„Åç„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const L=JSON.parse(B),U=L.timestamp?String(L.timestamp):"-",V=Number(L.categoryAdded??0),ce=Number(L.memorizationPositionRepaired??0),ie=!!L.saved;return`**timestamp**: ${U}
**categoryAdded**: ${V}
**memorizationPositionRepaired**: ${ce}
**saved**: ${ie?"trueÔºà‰øÆÂæ©„Çí‰øùÂ≠òÔºâ":"falseÔºà‰øÆÂæ©„Å™„Åó or ‰øùÂ≠ò‰∏çË¶ÅÔºâ"}`}catch{return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"}})()}

---

## üéØ „Ç§„É≥„Çø„Éº„É™„Éº„ÉñË®∫Êñ≠

### PositionÂàÜÂ∏ÉÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ${f.length}Ë™ûÔºâ
${f.length===0?"_Ôºà„Å™„ÅóÔºâ_":`
- **Position 85-100**: ${f.filter(B=>B.position>=85).length}Ë™û
- **Position 70-84**: ${f.filter(B=>B.position>=70&&B.position<85).length}Ë™û
- **Position 40-69**: ${f.filter(B=>B.position>=40&&B.position<70).length}Ë™û

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÇíPosition +15
- ÁµêÊûú: Position 40-55„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰Ωç10Âïè‰∏≠„Å´Ê∑∑ÂÖ•„Åô„Çã„ÅØ„Åö
`}

### Ê¨°10Âïè„ÅÆPositionÂàÜÊûê
**ÂèÇÁÖß**: ${wt}

${mt.map((B,L)=>{const{position:U,attempts:V,status:ce}=kt(B);return`${L+1}. **${B}** - Position ${U.toFixed(0)} (${V}Âõû) ${ce}`}).join(`
`)}

**ÂïèÈ°åÊ§úÂá∫**:
${dt?"‚ùå **ÂÖ®„Å¶Êñ∞Ë¶èÔºàPosition < 40Ôºâ** ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß":"‚úÖ Êñ∞Ë¶è„Å®„Åæ„Å†„Åæ„Å†„ÅåÊ∑∑Âú® ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ‰∏≠"}

---

## üéÆ PositionÂàÜÊï£Ë®∫Êñ≠

${m?`**ÂàÜÊï£Ââç**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((Q=m.before)==null?void 0:Q.stillLearning)||0)+(((fe=m.before)==null?void 0:fe.incorrect)||0)}Ë™û
- Êñ∞Ë¶è: ${((Z=m.before)==null?void 0:Z.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((Fe=m.before)==null?void 0:Fe.boostable)||0}Ë™û

**ÂàÜÊï£Âæå**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((Ge=m.after)==null?void 0:Ge.stillLearning)||0)+(((Le=m.after)==null?void 0:Le.incorrect)||0)}Ë™û
- Êñ∞Ë¶è (PositionÂºï„Åç‰∏ä„ÅíÂæå): ${((ut=m.after)==null?void 0:ut.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((ye=m.after)==null?void 0:ye.boostable)||0}Ë™û

**PositionÂºï„Åç‰∏ä„Åí**: ${((Ve=m.summary)==null?void 0:Ve.newBoosted)||0}Ë™û ${((lt=m.summary)==null?void 0:lt.working)??!1?"‚úÖ":"‚ùå"}

<details>
<summary>Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${m.changed.slice(0,10).map(B=>"- **"+B.word+"**: "+B.before.toFixed(0)+" ‚Üí "+B.after.toFixed(0)+" (+"+(B.after-B.before).toFixed(0)+")").join(`
`)}

${m.changed.length>10?`
_‚Ä¶‰ªñ`+(m.changed.length-10)+"Ë™û_":""}
</details>`:"‚ö†Ô∏è PositionÂàÜÊï£Ë®∫Êñ≠ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàcalculatePriorities()„ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

### üéØ „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà

${(()=>{try{const B=localStorage.getItem("debug_still_learning_boost");if(!B)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const L=JSON.parse(B);return!L.working||L.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û (Position 40-70, attempts>0) „ÇíÂºï„Åç‰∏ä„Åí**: ${L.boosted}Ë™û ‚úÖ

<details>
<summary>„Éñ„Éº„Çπ„Éà„Åï„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${L.changes.slice(0,10).map(U=>{const V=Number(U.after)-Number(U.before);return"- **"+U.word+"**: "+U.before.toFixed(0)+" ‚Üí "+U.after.toFixed(0)+" (+"+(Number.isFinite(V)?V.toFixed(0):"0")+")"}).join(`
`)}

${L.boosted>10?`
_‚Ä¶‰ªñ`+(L.boosted-10)+"Ë™û_":""}
</details>`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

### üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ

${(()=>{const B=Wi(n).slice(0,30);if(B.length===0)return"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const L=B.map(O=>O.attempts>0&&O.position>=40&&O.position<70?"„Åæ„Å†„Åæ„Å†":O.attempts===0&&O.position>=40&&O.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":O.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":O.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),U={„Åæ„Å†„Åæ„Å†:L.filter(O=>O==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:L.filter(O=>O==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:L.filter(O=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(O)).length},V=L.slice(0,20).map(O=>{switch(O){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join(""),ce=B.slice(0,15).map((O,q)=>{const re=L[q],ve=re==="„Åæ„Å†„Åæ„Å†"?"üü°":re==="Êñ∞Ë¶è(Âºï‰∏ä)"?"üîµ":re==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"üî¥":re==="ÂÆöÁùÄÊ∏à"?"‚úÖ":"‚ö™";return`${q+1}. ${ve} **${O.word}** (Pos ${O.position.toFixed(0)}, ${O.attempts}Âõû) - ${re}`}).join(`
`);let ie=`**TOP30„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÂ∏É**:
- üü° „Åæ„Å†„Åæ„Å†: ${U.„Åæ„Å†„Åæ„Å†}Ë™û
- üîµ Êñ∞Ë¶è(PositionÂºï‰∏ä): ${U.Êñ∞Ë¶èÂºï‰∏ä}Ë™û
- „Åù„ÅÆ‰ªñ: ${U.„Åù„ÅÆ‰ªñ}Ë™û

**„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ** (TOP20):
${V}

**Âá°‰æã**: üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à

<details>
<summary>Ë©≥Á¥∞„É™„Çπ„Éà (TOP15)</summary>

${ce}
</details>

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆ„Çµ„Ç§„ÇØ„É´„Åß‰∫§‰∫íÈÖçÁΩÆ
- ‰æã: üü°üü°üîµüü°üü°üü°üîµüü°üü°üîµ...`;if(U.„Åæ„Å†„Åæ„Å†===0&&U.Êñ∞Ë¶èÂºï‰∏ä===0)ie+=`

‚ö†Ô∏è **„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„Åó**Ôºà„Åæ„Å†„Åæ„Å†Ë™û„ÉªPositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å®„ÇÇ„Å´0Ôºâ`;else if(U.„Åæ„Å†„Åæ„Å†>0&&U.Êñ∞Ë¶èÂºï‰∏ä===0)ie+=`

‚ö†Ô∏è **PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å™„Åó** ‚Üí „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else if(U.„Åæ„Å†„Åæ„Å†===0&&U.Êñ∞Ë¶èÂºï‰∏ä>0)ie+=`

‚ö†Ô∏è **„Åæ„Å†„Åæ„Å†Ë™û„Å™„Åó** ‚Üí PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else{let O=0;for(let q=0;q<L.length-1;q++){const re=L[q],ve=L[q+1];re==="„Åæ„Å†„Åæ„Å†"&&ve==="Êñ∞Ë¶è(Âºï‰∏ä)"&&O++,re==="Êñ∞Ë¶è(Âºï‰∏ä)"&&ve==="„Åæ„Å†„Åæ„Å†"&&O++}O>=3?ie+=`

‚úÖ **‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+O+"ÂõûÔºâ":ie+=`

‚ö†Ô∏è **‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑÂèØËÉΩÊÄß**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+O+"ÂõûÔºâ"}return ie}catch(L){return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº: "+L.message}})()}

---

## ÔøΩÔ∏è PositionÈöéÂ±§Ê§úË®ºÔºà„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÈò≤Ê≠¢Ôºâ

${(()=>{try{const B=localStorage.getItem("debug_position_hierarchy_validation"),L=localStorage.getItem("debug_position_hierarchy_still"),U=localStorage.getItem("debug_position_hierarchy_new");if(!B&&!L&&!U)return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";let V=`**PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂**:
`;V+="```\n",V+=`70-100: ÂàÜ„Åã„Çâ„Å™„ÅÑÔºàÁ¨¨1ÂÑ™ÂÖàÔºâ
`,V+=`60-69:  „Åæ„Å†„Åæ„Å†ÔºàÁ¨¨2ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ‚Üê üîí Âõ∫ÂÆö
`,V+=`40-59:  Êñ∞Ë¶èÔºàÁ¨¨3ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ    ‚Üê üîí Âõ∫ÂÆö
`,V+=`20-39:  Êñ∞Ë¶èÔºàÁ¨¨4ÂÑ™ÂÖà„ÉªÈÄöÂ∏∏Ôºâ
`,V+=`0-19:   ÂÆöÁùÄÊ∏àÔºàÁ¨¨5ÂÑ™ÂÖàÔºâ
`,V+="```\n\n";let ce=!1;const ie=[];if(B){const O=JSON.parse(B);O.isValid?(V+=`‚úÖ **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§„ÅåÊ≠£Â∏∏„Åß„Åô
`,V+="  - „Åæ„Å†„Åæ„Å†Ë™ûÔºà60-69ÁØÑÂõ≤ÂÜÖÔºâ: "+O.stillInBoostedZone+`Ë™û
`,V+="  - Êñ∞Ë¶èË™ûÔºà40-59ÁØÑÂõ≤ÂÜÖÔºâ: "+O.newInBoostedZone+`Ë™û

`):(ce=!0,V+=`‚ùå **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§ÈÅïÂèç„ÇíÊ§úÂá∫
`,V+="  - ÈÅïÂèç‰ª∂Êï∞: "+O.violationCount+`Ë™û
`,ie.push(...O.violations))}if(L){const O=JSON.parse(L);O.violationCount===0?V+="‚úÖ **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: ÂÖ®"+O.totalStill+`Ë™û„ÅåPosition 60-69ÁØÑÂõ≤ÂÜÖ

`:(ce=!0,V+=`‚ùå **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: Position 60-69ÁØÑÂõ≤Â§ñ„ÅÆË™û„ÇíÊ§úÂá∫
`,V+="  - ÈÅïÂèç‰ª∂Êï∞: "+O.violationCount+"Ë™ûÔºàÂÖ®"+O.totalStill+`Ë™û‰∏≠Ôºâ
`,ie.push(...O.violations))}if(U){const O=JSON.parse(U);O.violationCount===0?V+="‚úÖ **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: ÂÖ®"+O.totalNew+`Ë™û„ÅåPosition 60Êú™Ê∫Ä

`:(ce=!0,V+=`‚ùå **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: Position 60‰ª•‰∏ä„ÅÆË™û„ÇíÊ§úÂá∫
`,V+="  - ÈÅïÂèç‰ª∂Êï∞: "+O.violationCount+"Ë™ûÔºàÂÖ®"+O.totalNew+`Ë™û‰∏≠Ôºâ
`,ie.push(...O.violations))}return ce&&ie.length>0?(V+=`
**üö® ÈÅïÂèç„ÅÆË©≥Á¥∞**:
`,ie.slice(0,10).forEach((O,q)=>{const re=O.type==="new_exceeds_60"?"Êñ∞Ë¶èË™û„ÅåPosition 60‰ª•‰∏ä":O.type==="still_below_60"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 60Êú™Ê∫Ä":O.type==="still_above_70"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 70‰ª•‰∏ä":"‰∏çÊòé";V+=q+1+". **"+O.word+"**: Position "+O.position.toFixed(0)+" ‚Üê "+re+`
`}),ie.length>10&&(V+=`
_‚Ä¶‰ªñ`+(ie.length-10)+`‰ª∂_
`),V+=`
**üìñ ÂéüÂõ†„Å®ÂØæÁ≠ñ**:
`,V+=`- „Åì„Çå„ÅØ„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÂïèÈ°å„Åß„Åô
`,V+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÇíÂÑ™ÂÖà„Åï„Åõ„Çã„Åü„ÇÅ„Å´Êñ∞Ë¶èË™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,V+=`- Êñ∞Ë¶èË™û„ÇíÊ∑∑„Åú„Çã„Åü„ÇÅ„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,V+=`- PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂Ôºà60-69: „Åæ„Å†„Åæ„Å†„ÄÅ40-59: Êñ∞Ë¶èÔºâ„ÇíÂÆà„Å£„Å¶„Åè„Å†„Åï„ÅÑ
`):ce||(V+=`üéâ **PositionÈöéÂ±§„ÅØÂÆåÁíß„Å´ÂÆà„Çâ„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ**
`,V+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÅØÁ¢∫ÂÆü„Å´Êñ∞Ë¶èË™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Åæ„Åô
`,V+=`- Êñ∞Ë¶èË™û„ÅØ„Åæ„Å†„Åæ„Å†Ë™û„ÇíÈÇ™È≠î„Åó„Åæ„Åõ„Çì
`),V}catch(B){return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„ÅÆËß£Êûê„Ç®„É©„Éº: "+B.message}})()}

---

## ÔøΩüìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞30‰ª∂)

${b.length>0?b.slice(-10).reverse().map((B,L)=>L+1+". **"+B.function+"** "+JSON.stringify(B.params)+" - "+new Date(B.timestamp).toLocaleTimeString()).join(`
`):"‚ö†Ô∏è Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}

---

## üîç sortAndBalance() Âá∫ÂäõÊ§úË®º

**sortAndBalance()Âæå„ÅÆTOP30ÔºàPositionÈôçÈ†Ü„ÇΩ„Éº„ÉàÂæåÔºâ**:
${(()=>{const B=localStorage.getItem("debug_sortAndBalance_output");if(!B)return"‚ö†Ô∏è sortAndBalance()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{return JSON.parse(B).slice(0,30).map((U,V)=>{const ce=U.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":U.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":U.position>=40?"üü° „Åæ„Å†„Åæ„Å†":U.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return V+1+". **"+U.word+"** - Position "+(U.position??0).toFixed(0)+" ("+U.attempts+"Âõû) "+ce}).join(`
`)}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

**postProcess()Âæå„ÅÆTOP30ÔºàÂÆüÈöõ„ÅÆÂá∫È°å„Ç≠„É•„ÉºÔºâ**:
${(()=>{const B=MJ(n),L=Wi(n);return!L||L.length===0?"‚ö†Ô∏è postProcess()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì":(B?`
(„É°„Çø) action=${B.action}, interleavedAcrossBands=${!!B.isInterleavedAcrossBands}
`:"")+L.slice(0,30).map((V,ce)=>{const ie=V.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":V.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":V.position>=40?"üü° „Åæ„Å†„Åæ„Å†":V.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return ce+1+". **"+V.word+"** - Position "+(V.position??0).toFixed(0)+" ("+V.attempts+"Âõû) "+ie}).join(`
`)})()}

**üö® ÈáçË¶Å**: sortAndBalance()„Å®postProcess()„ÅÆÂá∫Âäõ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÄÅpostProcess()„ÅåÈ†ÜÂ∫è„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ

**üîç „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞ÂàÜÊûê**:
${(()=>{const B=n,L=t,U=we=>{if(!we)return null;try{return JSON.parse(we)}catch{return null}},V=(we,H=!1)=>{const Te=we.filter(Boolean);if(Te.length===0)return null;const Me=He=>{const yt=typeof He=="number"?He:Number(He);return Number.isFinite(yt)?yt:null},Je=He=>{const yt=Date.parse(String(He??""));return Number.isFinite(yt)?yt:0};if(H){const He=Te.filter(De=>String((De==null?void 0:De.mode)??"")===B);if(He.length===0)return null;const yt=He.filter(De=>Me(De==null?void 0:De.questionsCount)===L);return yt.length>0?(yt.sort((De,$t)=>Je($t==null?void 0:$t.timestamp)-Je(De==null?void 0:De.timestamp)),yt[0]):[...He].sort((De,$t)=>{const Pt=Me(De==null?void 0:De.questionsCount)??-1,Xt=Me($t==null?void 0:$t.questionsCount)??-1;return Xt!==Pt?Xt-Pt:Je($t==null?void 0:$t.timestamp)-Je(De==null?void 0:De.timestamp)})[0]}const vt=Te.filter(He=>Me(He==null?void 0:He.questionsCount)===L);return vt.length>0?(vt.sort((He,yt)=>Je(yt==null?void 0:yt.timestamp)-Je(He==null?void 0:He.timestamp)),vt[0]):[...Te].sort((He,yt)=>{const Gt=Me(He==null?void 0:He.questionsCount)??-1,De=Me(yt==null?void 0:yt.questionsCount)??-1;return De!==Gt?De-Gt:Je(yt==null?void 0:yt.timestamp)-Je(He==null?void 0:He.timestamp)})[0]},ce=`debug_sortAndBalance_top100_history_${B}`,ie=U(localStorage.getItem(ce)),O=Array.isArray(ie)?ie:[],q=V(O,!0),re=`debug_sortAndBalance_top100_${B}`,ve=U(localStorage.getItem(re)),be=ve&&String((ve==null?void 0:ve.mode)??"")===B?ve:null,ke=U(localStorage.getItem("debug_sortAndBalance_top100")),Ie=ke&&String((ke==null?void 0:ke.mode)??"")===B?ke:null,Re=q??be??Ie??ke;if(!Re)return"‚ö†Ô∏è TOP100„Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{const we=q?`history:${ce}`:be?`byMode:${re}`:"legacy:debug_sortAndBalance_top100",H=Array.isArray(Re==null?void 0:Re.top100)?Re.top100:[],Te=Array.isArray(Re==null?void 0:Re.top600)?Re.top600:[],Me=typeof(Re==null?void 0:Re.timestamp)=="string"?Re.timestamp:null,Je=typeof(Re==null?void 0:Re.mode)=="string"?Re.mode:null,vt=Number.isFinite(Number(Re==null?void 0:Re.questionsCount))?Number(Re.questionsCount):null,bt=Number.isFinite(Number(Re==null?void 0:Re.interleavedCount))?Number(Re.interleavedCount):null,He=Number.isFinite(Number(Re==null?void 0:Re.stillLearningInTop100))?Number(Re.stillLearningInTop100):null,yt=Number.isFinite(Number(Re==null?void 0:Re.stillLearningInTop600))?Number(Re.stillLearningInTop600):null,De=rt().wordProgress||{},$t=_e=>String(_e??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),Pt=_e=>$t(_e).toLowerCase(),Xt=new Map;for(const _e of Object.keys(De)){const Oe=Pt(_e);Xt.has(Oe)||Xt.set(Oe,_e)}const Zt=_e=>{const Oe=$t(_e);if(!Oe)return{key:null,wp:null,hit:"empty"};const ot=De[Oe];if(ot)return{key:Oe,wp:ot,hit:"direct"};const Dt=Oe.toLowerCase(),Rt=De[Dt];if(Rt)return{key:Dt,wp:Rt,hit:"lower"};const he=Pt(Oe),We=Xt.get(he)??null;return We?{key:We,wp:De[We]??null,hit:"normalized"}:{key:null,wp:null,hit:"miss"}},jt=_e=>Zt(_e).wp,Jt=(_e,Oe=0)=>{const ot=typeof _e=="number"?_e:Number(_e);return Number.isFinite(ot)?ot:Oe},St=(_e,Oe)=>{const ot=jt(_e);if(ot){const Dt=Jt(ot==null?void 0:ot.memorizationAttempts,NaN);if(Number.isFinite(Dt))return Dt}return Jt(Oe,0)},Vt=(_e,Oe)=>{const ot=jt(_e);if(ot){const Dt=Jt(Ut(ot,n),NaN);if(Number.isFinite(Dt))return Dt}return Jt(Oe,0)},tt=H.filter(_e=>{const Oe=String(_e.word??""),ot=Vt(Oe,_e.position),Dt=St(Oe,_e.attempts);return ot>=40&&ot<70&&Dt>0}),$e=Te.filter(_e=>{const Oe=String(_e.word??""),ot=Vt(Oe,_e.position),Dt=St(Oe,_e.attempts);return ot>=40&&ot<70&&Dt>0}),X=Te.filter(_e=>{const Oe=String(_e.word??""),ot=Vt(Oe,_e.position),Dt=St(Oe,_e.attempts);return ot===50&&Dt===0}).length;let me="";Me&&(me+=`üïí **snapshot timestamp**: ${Me}

`),me+=`üß≠ **snapshot selectedFrom**: ${we}

`,me+=`**üì¶ snapshot meta**
`,me+=`- mode: ${Je??"-"}
`,me+=`- questionsCount: ${vt??"-"}
`,me+=`- interleavedCount: ${bt??"-"}
`,me+=`- top100Count: ${H.length}
`,me+=`- top600Count: ${Te.length}
`,me+=`- stillLearningInTop100 (snapshot): ${He??"-"}
`,me+=`- stillLearningInTop600 (snapshot): ${yt??"-"}

`,Je&&Je!==B&&(me+=`‚ö†Ô∏è **„É¢„Éº„Éâ‰∏ç‰∏ÄËá¥**: „Åì„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅØ \`${Je}\` „Åß„Åô„ÄÇÊöóË®ò„Çø„Éñ„ÅÆÂàÜÊûê„Å´„ÅØ \`${B}\` „ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
‚Üí translation/spellingÁ≠â„ÅÆ„Äå30Âïè„ÉÜ„Çπ„ÉàÂÆüË°å„Äç„Åå‰∏äÊõ∏„Åç„Åó„Å¶„ÇÇÂ£ä„Çå„Å™„ÅÑ„Çà„ÅÜ„ÄÅmodeÂà•„Ç≠„Éº„ÇíË™≠„ÅøÂèñ„Çã„Çà„ÅÜ„Å´‰øÆÊ≠£Ê∏à„Åø„Åß„Åô„ÄÇ

`);const Be={direct:0,lower:0,normalized:0,miss:0,empty:0};for(const _e of H){const Oe=String((_e==null?void 0:_e.word)??""),ot=Zt(Oe);Be[ot.hit]=(Be[ot.hit]||0)+1}me+=`**üîë progressCacheÁÖßÂêàÔºàTOP100Ôºâ**
`,me+=`- direct: ${Be.direct}
`,me+=`- lower: ${Be.lower}
`,me+=`- normalized: ${Be.normalized}
`,me+=`- miss: ${Be.miss}

`;const nt=kf(n),Ct=new Set(nt.map(_e=>Pt(_e.word))),st=new Set(H.map(_e=>Pt(String((_e==null?void 0:_e.word)??"")))),ht=[];for(const _e of Ct)st.has(_e)&&ht.push(_e);if(me+=`**üü° Ëã¶ÊâãË™û√óTOP100ÔºàÊöóË®òSSOTÔºâ**
`,me+=`- strugglingWords: ${nt.length}
`,me+=`- inTop100: ${ht.length}

`,H.length===0&&(me+=`‚ö†Ô∏è TOP100ÈÖçÂàó„ÅåÁ©∫„Åß„ÅôÔºàÂè§„ÅÑ/Â£ä„Çå„Åü„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆÂèØËÉΩÊÄßÔºâ

`),X>0?me+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: ${X}Ë™ûÔºà„Åì„Çå„Åå„Åæ„Å†„Åæ„Å†Ë™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄßÔºâ

`:me+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: 0Ë™ûÔºàË©≤ÂΩì„Å™„ÅóÔºâ

`,tt.length===0){if(me+=`‚ùå **„Åæ„Å†„Åæ„Å†Ë™ûÔºàPosition 40-70, attempts>0Ôºâ„ÅåTOP100„Å´1„Å§„ÇÇÂÖ•„Å£„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ**
`,H.length>0){const _e=H.slice(0,10).map(Oe=>{const ot=String(Oe.word??""),Dt=Zt(ot),Rt=!!Dt.wp,he=St(ot,Oe.attempts),We=Vt(ot,Oe.position),Xe=Jt(Oe.attempts,0),Ot=Jt(Oe.position,0);return{word:ot,matchedKey:Dt.key,hitType:Dt.hit,cacheHit:Rt,usedPos:We,usedAttempts:he,snapshotPos:Ot,snapshotAttempts:Xe}});me+=`
**üß™ Âà§ÂÆö„Éá„Éê„ÉÉ„Ç∞ÔºàTOP10„Çµ„É≥„Éó„É´Ôºâ**
`+_e.map((Oe,ot)=>{const Dt=Oe.cacheHit?Oe.hitType:"miss",Rt=Oe.matchedKey?` key:${Oe.matchedKey}`:"";return`${ot+1}. ${Oe.word} | cache:${Dt}${Rt} | pos used:${Oe.usedPos} (snap:${Oe.snapshotPos}) | attempts used:${Oe.usedAttempts} (snap:${Oe.snapshotAttempts})`}).join(`
`)+`
`}}else me+="‚úÖ „Åæ„Å†„Åæ„Å†Ë™û„Åå**"+tt.length+`Ë™û**„ÄÅTOP100ÂÜÖ„Å´„ÅÇ„Çä„Åæ„Åô:
`+tt.slice(0,10).map(_e=>{const Oe=String(_e.word??""),ot=St(Oe,_e.attempts),Dt=Vt(Oe,_e.position);return`${_e.rank??""}‰Ωç: ${Oe} (Position ${Dt}, ${ot}Âõû)`}).join(`
`)+(tt.length>10?`
_‚Ä¶‰ªñ`+(tt.length-10)+"Ë™û_":"")+`

`;return Te.length===0?me+="‚ö†Ô∏è TOP600ÈÖçÂàó„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàÊúÄÊñ∞„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É©Âá∫ÂäõÂæÖ„Å°Ôºâ":$e.length>0?(me+="üìç **TOP600ÂÜÖ„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û**: "+$e.length+`Ë™û
`,me+=$e.slice(0,5).map(_e=>{const Oe=String(_e.word??""),ot=St(Oe,_e.attempts),Dt=Vt(Oe,_e.position);return`${_e.rank??""}‰Ωç: ${Oe} (Position ${Dt}, ${ot}Âõû)`}).join(`
`),$e.length>5&&(me+=`
_‚Ä¶‰ªñ`+($e.length-5)+"Ë™û_")):me+="‚ùå **TOP600ÂÜÖ„Å´„ÇÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì**",X>0&&tt.length===0&&(me+=`

**üö® ÁµêË´ñ**: Position 50„ÅÆÊñ∞Ë¶è`+X+`Ë™û„ÅåÂÖàË°å„Åó„ÄÅ„Åæ„Å†„Åæ„Å†Ë™û„ÅåÊäº„ÅóÂá∫„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô
`,me+="‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅßÊñ∞Ë¶è„ÅåÂÑ™ÂÖà„Åï„Çå„ÄÅ„Åæ„Å†„Åæ„Å†„Åå"+(X+1)+"‰Ωç‰ª•Èôç„Å´ËøΩ„ÅÑ„ÇÑ„Çâ„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß"),me}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

---

### üéØ ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÂÜÖPositionÂàÜÂ∏ÉÔºà„É™„Ç¢„É´„Çø„Ç§„É†Ôºâ

${(()=>{if(!s||s.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const B=s.slice(e);if(B.length===0)return"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ";const L=rt(),U=be=>{if(!be)return 0;switch(n){case"memorization":return be.memorizationAttempts??0;case"translation":return be.translationAttempts??0;case"spelling":return be.spellingAttempts??0;case"grammar":return be.grammarAttempts??0;default:return be.totalAttempts??0}},V=B.map(be=>{const ke=String(be.word??""),Ie=L.wordProgress[ke],Re=Number.isFinite(be.position)?be.position:null;if(Ie){const we=Ut(Ie,n);return{...be,position:we,_originalPosition:Re,_wpMissing:!1,_attempts:U(Ie)}}return{...be,position:35,_originalPosition:Re,_wpMissing:!0,_attempts:0}}),ce=V.filter(be=>{if(!Number.isFinite(be._originalPosition))return!1;const ke=be._originalPosition,Ie=be.position??0;return Math.abs(ke-Ie)>5}).slice(0,20);let ie="**üìä Êú™Âá∫È°å„Ç≠„É•„ÉºÂàÜÊûêÔºàÊÆã„Çä"+B.length+`ÂïèÔºâ**:

`;ce.length>0&&(ie+="üö® **Position‰∏çÊï¥ÂêàÊ§úÂá∫**: "+ce.length+`Ë™û
`,ie+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåLocalStorage„Å®‰∏ÄËá¥„Åó„Åæ„Åõ„ÇìÔºÅ

`,ie+=`**‰∏çÊï¥Âêà„É™„Çπ„ÉàÔºàÂ∑ÆÂàÜ‚â•5Ôºâ**:
`,ie+=ce.map(be=>{const ke=be._originalPosition??0,Ie=be.position??0,Re=Ie-ke,we=Ie>=70?"üî¥":Ie>=40?"üü°":"‚ö™",H=Re>0?"üî∫":Re<0?"üîª":"‚Üí";return"  "+we+" **"+be.word+"**: "+ke+" "+H+" "+Ie+" (Â∑ÆÂàÜ: "+(Re>0?"+":"")+Re+")"}).join(`
`),ie+=`

**ÂéüÂõ†ÂÄôË£ú**:
`,ie+=`- questionsÈÖçÂàó„ÅåÂè§„ÅÑ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åã„Çâ‰ΩúÊàê„Åï„Çå„Åü
`,ie+=`- Ëß£Á≠îÂæå„Å´Position„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„Åå„ÄÅ„Ç≠„É•„Éº„Å´ÂèçÊò†„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ
`,ie+=`- QuestionScheduler„ÅÆÂëº„Å≥Âá∫„Åó„Çø„Ç§„Éü„É≥„Ç∞„Åå‰∏çÈÅ©Âàá

`);const O={incorrect:V.filter(be=>(be.position??0)>=70),stillLearning:V.filter(be=>{const ke=be.position??0,Ie=be._attempts??0;return ke>=40&&ke<70&&Ie>0}),newBoosted:V.filter(be=>{const ke=be.position??0,Ie=be._attempts??0;return ke>=40&&ke<60&&Ie===0}),newNormal:V.filter(be=>{const ke=be.position??0;return ke>=20&&ke<40}),mastered:V.filter(be=>(be.position??0)<20)};ie+=`**PositionÂà•ÂÜÖË®≥**:
`,ie+="- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑÔºà70-100Ôºâ: "+O.incorrect.length+`Ë™û
`,ie+="- üü° „Åæ„Å†„Åæ„Å†Ôºà40-69, attempts>0Ôºâ: "+O.stillLearning.length+`Ë™û
`,ie+="- üîµ Êñ∞Ë¶èÂºï‰∏äÔºà40-59, attempts=0Ôºâ: "+O.newBoosted.length+`Ë™û
`,ie+="- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏Ôºà20-39Ôºâ: "+O.newNormal.length+`Ë™û
`,ie+="- ‚úÖ ÂÆöÁùÄÊ∏àÔºà0-19Ôºâ: "+O.mastered.length+`Ë™û

`;const q=V.slice(0,30),re=q.filter(be=>(be.position??0)>=40);ie+=`**Ê¨°„ÅÆ30Âïè„ÅÆÊßãÊàê**:
`,ie+="- È´òPositionË™ûÔºà‚â•40Ôºâ: "+re.length+"Ë™û / "+q.length+`Âïè
`,ie+="- Ââ≤Âêà: "+(re.length/q.length*100).toFixed(1)+`%

`,re.length>0?(ie+=`**Ê¨°„ÅÆ30ÂïèÂÜÖ„ÅÆÈ´òPositionË™û**ÔºàLocalStorageÂÜçË®àÁÆóÊ∏à„ÅøÔºâ:
`,ie+=re.slice(0,10).map((be,ke)=>{const Ie=be.position??0,Re=be._originalPosition,we=Ie>=70?"üî¥":"üü°",H=Ie>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":"„Åæ„Å†„Åæ„Å†",Te=be.reAddedCount>0?" üîÑ√ó"+be.reAddedCount:"",Me=Re!==void 0&&Re!==Ie?" (ÂÖÉ:"+Re+")":"";return"  "+we+" "+be.word+" (Pos "+Ie+Me+", "+H+")"+Te}).join(`
`),re.length>10&&(ie+=`
  _...‰ªñ`+(re.length-10)+"Ë™û_")):ie+="‚ö†Ô∏è Ê¨°„ÅÆ30Âïè„Å´È´òPositionË™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàLocalStorageÂÜçË®àÁÆóÂæåÔºâ„ÄÇ";const ve=O.incorrect.length+O.stillLearning.length;return ve>10&&re.length<5?(ie+=`

‚ùå **Ë≠¶Âëä**: È´òPositionË™û„Åå`+ve+"Ë™ûÂ≠òÂú®„Åó„Åæ„Åô„Åå„ÄÅÊ¨°„ÅÆ30Âïè„Å´„ÅØ"+re.length+"Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ",ie+=`
‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØ„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„Åå‰∏çÂçÅÂàÜ„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`):ve>0&&re.length>=Math.min(ve,15)&&(ie+=`

‚úÖ **ËâØÂ•Ω**: È´òPositionË™û„ÅåÈÅ©Âàá„Å´ÂâçÊñπ„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`),ie})()}

---

## üîÑ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Áä∂ÊÖãË®∫Êñ≠

${(()=>{var ke;rt();const B=JSON.parse(localStorage.getItem("debug_function_calls")||"[]"),L=JSON.parse(localStorage.getItem("debug_answer_logs")||"[]"),U=JSON.parse(localStorage.getItem("debug_reschedule_events")||"[]"),V=Ie=>{const Re=(Ie==null?void 0:Ie.function)??(Ie==null?void 0:Ie.name)??(Ie==null?void 0:Ie.functionName)??"unknown",we=(Ie==null?void 0:Ie.params)??(Ie==null?void 0:Ie.args)??(Ie==null?void 0:Ie.parameters)??null,H=(Ie==null?void 0:Ie.timestamp)??null;return{name:Re,params:we,ts:H}},ce=Array.isArray(B)?B.map(V):[],ie=Array.isArray(U)?U:[],O=ce.filter(Ie=>Ie.name==="sortAndBalance").slice(-1)[0],q=ie.filter(Ie=>(Ie==null?void 0:Ie.mode)===n&&(Ie==null?void 0:Ie.phase)==="triggered").slice(-1)[0],re=ie.filter(Ie=>(Ie==null?void 0:Ie.mode)===n&&(Ie==null?void 0:Ie.phase)==="applied").slice(-1)[0],ve=L.slice(-1)[0];let be=`**üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÁîüÊàêÊÉÖÂ†±**:
`;if(be+=`
**üîÑ ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºàdebug_reschedule_eventsÔºâ**:
`,re){const Ie=new Date(re.timestamp).toLocaleTimeString("ja-JP");if(be+=`- ÊúÄÂæå„ÅÆÈÅ©Áî®: ${Ie} (${re.reason||"ÁêÜÁî±„Å™„Åó"})
`,re.details){const Re=re.details.remainingBefore,we=re.details.remainingAfter;(Re!=null||we!=null)&&(be+=`- ÊÆã„Çä„Ç≠„É•„Éº: ${Re??"‰∏çÊòé"} ‚Üí ${we??"‰∏çÊòé"}
`)}}else be+=`- „Åæ„Å†ÈÅ©Áî®„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
`;if(q){const Ie=new Date(q.timestamp).toLocaleTimeString("ja-JP");be+=`- ÊúÄÂæå„ÅÆ„Éà„É™„Ç¨„Éº: ${Ie} (${q.reason||"ÁêÜÁî±„Å™„Åó"})
`}if(be+=`
`,O){const Ie=new Date(O.ts).toLocaleTimeString("ja-JP");be+="- ÊúÄÂæå„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞: "+Ie+`
`,be+="- ÂïèÈ°åÊï∞: "+(((ke=O.params)==null?void 0:ke.questionsCount)||"‰∏çÊòé")+`Âïè
`}else be+=`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Â±•Ê≠¥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
`;if(ve){const Ie=new Date(ve.timestamp).toLocaleTimeString("ja-JP");be+="- ÊúÄÂæå„ÅÆËß£Á≠î: "+Ie+" ("+ve.word+`)
`,be+="- PositionÂ§âÂåñ: "+ve.positionBefore+" ‚Üí "+ve.positionAfter+`
`}if(be+=`
`,O&&ve){const Ie=new Date(O.ts).getTime();if(new Date(ve.timestamp).getTime()>Ie){const we=L.filter(Te=>new Date(Te.timestamp).getTime()>Ie).length;be+="üö® **Ë≠¶Âëä**: „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´"+we+`ÂõûËß£Á≠î„Åï„Çå„Åæ„Åó„Åü
`,be+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåÂè§„Åè„Å™„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„ÅåÈ´ò„ÅÑ„Åß„ÅôÔºÅ

`;const H=L.filter(Te=>new Date(Te.timestamp).getTime()>Ie&&Math.abs(Te.positionAfter-Te.positionBefore)>=10).slice(-10);H.length>0&&(be+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÂ§ßÂπÖÂ§âÂåñÔºà¬±10‰ª•‰∏äÔºâ**:
`,be+=H.map(Te=>{const Me=Te.positionAfter-Te.positionBefore;return"  "+(Me>0?"üî∫":"üîª")+" "+Te.word+": "+Te.positionBefore+" ‚Üí "+Te.positionAfter+" ("+(Me>0?"+":"")+Me+")"}).join(`
`),be+=`

`),be+=`**Êé®Â•®ÂØæÂøú**:
`,be+=`- ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÇíÂÆüË°åÔºà„Éá„Éº„Çø„ÇΩ„Éº„ÇπÈÅ∏Êäû„Çí„ÇÑ„ÇäÁõ¥„ÅôÔºâ
`,be+=`- „Åæ„Åü„ÅØ„ÄÅuseQuestionRequeu„ÅÆPosition-awareÊ©üËÉΩ„ÅåËá™ÂãïË™øÊï¥„Åó„Åæ„Åô
`}else be+=`‚úÖ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÅØÊúÄÊñ∞„Åß„ÅôÔºàËß£Á≠îÂæå„Å´ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Ê∏à„ÅøÔºâ
`}return be})()}

---

## üß† finalPriority„É¢„Éº„ÉâÔºàvariant CÔºâ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà

${(()=>{const B=localStorage.getItem(`debug_finalPriority_output_${n}`)||localStorage.getItem("debug_finalPriority_output"),L=localStorage.getItem(`debug_finalPriority_sessionStats_${n}`)||localStorage.getItem("debug_finalPriority_sessionStats");if(!B&&!L)return"‚ö†Ô∏è finalPriority„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàfinalPriorityMode„ÅåÊú™‰ΩøÁî® or „Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÔºâ";let U="";if(L)try{const V=JSON.parse(L);U+=`**currentTab**: ${V.currentTab}
`,U+=`**allProgressCount**: ${V.allProgressCount}
`,U+=`**totalQuestions**: ${V.totalQuestions}
`,U+=`**timestamp**: ${V.timestamp}

`,U+=`**aiSessionStats**: ${JSON.stringify(V.aiSessionStats)}

`}catch{U+=`‚ö†Ô∏è sessionStatsËß£Êûê„Å´Â§±Êïó

`}if(!B)return U+"‚ö†Ô∏è debug_finalPriority_output „Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const V=JSON.parse(B);if(!Array.isArray(V)||V.length===0)return U+"‚ö†Ô∏è finalPriority TOP„ÅåÁ©∫„Åß„Åô";const ce=`| # | ÂçòË™û | finalPriority | position | attempts | category |
|---|------|--------------|----------|----------|----------|
`+V.slice(0,30).map(ie=>{const O=Number(ie.finalPriority??0),q=Number(ie.position??0),re=Number(ie.attempts??0),ve=ie.category??"";return`| ${ie.rank??""} | **${ie.word}** | ${O.toFixed(3)} | ${q.toFixed(0)} | ${re} | ${ve} |`}).join(`
`);return U+ce}catch{return U+"‚ö†Ô∏è finalPriorityËß£Êûê„Å´Â§±Êïó"}})()}

---

## üìù Ëß£Á≠îÂá¶ÁêÜ„É≠„Ç∞ (ÊúÄÊñ∞10‰ª∂)
${x.length>0?x.map((B,L)=>{var Te;const V=Math.abs(B.positionAfter-B.positionBefore)>1?B.positionAfter>B.positionBefore?"üî∫":"üîª":"‚Üí",ie=(Te=rt().wordProgress)==null?void 0:Te[B.word],O=(()=>{if(!ie)return{attempts:0,correct:0,stillLearning:0,incorrect:0};const Me=(()=>{switch(B.mode){case"memorization":return ie.memorizationAttempts??0;case"translation":return ie.translationAttempts??0;case"spelling":return ie.spellingAttempts??0;case"grammar":return ie.grammarAttempts??0;default:return ie.totalAttempts??0}})(),Je=(()=>{switch(B.mode){case"memorization":return ie.memorizationCorrect??0;case"translation":return ie.translationCorrect??0;case"spelling":return ie.spellingCorrect??0;case"grammar":return ie.grammarCorrect??0;default:return ie.correctCount??0}})(),vt=B.mode==="memorization"?ie.memorizationStillLearning??0:0,bt=Me-Je-vt;return{attempts:Me,correct:Je,stillLearning:vt,incorrect:bt}})(),q=(()=>{var He,yt,Gt;const Me=Number(((He=B.progress)==null?void 0:He.modeAttempts)??0),Je=Number(((yt=B.progress)==null?void 0:yt.modeCorrect)??0),vt=Number(((Gt=B.progress)==null?void 0:Gt.modeStillLearning)??0),bt=Me-Je-vt;return{attempts:Me,correct:Je,stillLearning:vt,incorrect:bt}})(),re=O.correct!==q.correct||O.stillLearning!==q.stillLearning||O.incorrect!==q.incorrect,ve=" | **ÂÆüÈöõ„ÅÆLS**: Ê≠£Ëß£"+O.correct+"/„Åæ„Å†„Åæ„Å†"+O.stillLearning+"/Ë™§Á≠î"+O.incorrect+" (Ë®à"+O.attempts+"Âõû)"+(re?" ‚ö†Ô∏è**‰∏ç‰∏ÄËá¥**":""),be=B.savedPositionDebug,ke=be==null?void 0:be.savedPosition,Ie=be==null?void 0:be.decision,Re=be==null?void 0:be.reason,we=B.positionWithSavedPosition,H=ke!==void 0||we!==void 0?" | **savedPosition**: "+(ke??"-")+" | **calc(savedÊúâ„Çä)**: "+(we??"-")+" | **calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå)**: "+(B.positionAfter??"-")+(Ie?" | **savedÂà§ÂÆö**: "+Ie+(Re?" ("+Re+")":""):""):"";return L+1+". **"+B.word+"**: Position "+B.positionBefore.toFixed(0)+" "+V+" "+B.positionAfter.toFixed(0)+" ("+B.category+") [„É≠„Ç∞(mode): Ê≠£Ëß£"+q.correct+"/„Åæ„Å†„Åæ„Å†"+q.stillLearning+"/Ë™§Á≠î"+q.incorrect+"]"+ve+H}).join(`
`):"‚ö†Ô∏è Ëß£Á≠î„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†Ëß£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

---

## üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (${f.length}Ë™û)

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„ÅÆË°®„ÅØ**LocalStorage„ÅÆÁîüPosition„Éá„Éº„Çø**„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
GamificationAI„Å´„Çà„Çã„Éñ„Éº„Çπ„ÉàÂæå„ÅÆPositionÔºà„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊôÇÔºâ„ÅØ„ÄÅÊ¨°„ÅÆ„Äå„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„Äç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

| # | ÂçòË™û | Position (LS) | Áä∂ÊÖã | Ë©¶Ë°åÂõûÊï∞ | ÊúÄÁµÇÂ≠¶Áøí | ÈÄ£Á∂öË™§Á≠î |
|---|------|---------------|------|----------|----------|----------|
${f.slice(0,30).map((B,L)=>{var q;const U=B.lastStudied?new Date(B.lastStudied).toLocaleDateString():"-",V=B.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†",ie=(q=rt().wordProgress)==null?void 0:q[B.word],O=(ie==null?void 0:ie.consecutiveIncorrect)??0;return`| ${L+1} | **${B.word}** | ${B.position.toFixed(0)} | ${V} | ${B.attempts}Âõû | ${U} | ${O}Âõû |`}).join(`
`)}

_‚Ä¶‰ªñ${Math.max(0,f.length-30)}Ë™ûÁúÅÁï•_

### üìä „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÔºà„Éñ„Éº„Çπ„ÉàÂæåÔºâ

${(()=>{try{const B=localStorage.getItem("debug_still_learning_boost");if(!B)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const L=JSON.parse(B);return!L.working||L.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÁµêÊûú**: ${L.boosted}Ë™û„Åå Position 60-69 „Å´Âºï„Åç‰∏ä„Åí ‚úÖ

| # | ÂçòË™û | Before | After | Â¢óÂä†Èáè |
|---|------|--------|-------|--------|
${L.changes.slice(0,20).map((U,V)=>`| ${V+1} | **${U.word}** | ${U.before.toFixed(0)} | ${U.after.toFixed(0)} | +${(U.after-U.before).toFixed(0)} |`).join(`
`)}

${L.changes.length>20?"_‚Ä¶‰ªñ"+(L.changes.length-20)+"Ë™û_":""}

**üéØ ÈáçË¶Å**: „Åì„ÅÆË°®„ÅÆ„ÄåAfter„Äç„Ç´„É©„É†„Åå„ÄÅÂÆüÈöõ„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Åß‰Ωø„Çè„Çå„ÇãPositionÂÄ§„Åß„Åô„ÄÇ`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

---

## üìã postProcess()Âæå„ÅÆTOP30Ôºà„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: **debug_postProcess_output** „ÅØ **postProcess()Âæå„ÅÆTOP30„ÅÆ„Åø**„Çí‰øùÂ≠ò„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÁèæÂú®‰ΩçÁΩÆÔºàcurrentIndexÔºâ„Å´ËøΩÂæì„Åô„Çã„ÄåÊ¨°„ÅÆ30Âïè„Äç„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ

${(()=>{const B=Wi(n);return!B||B.length===0?`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÁµêÊûú„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

**ÂÖÉ„ÅÆJSONÈ†ÜÂ∫èÔºàÂèÇËÄÉÊÉÖÂ†±„ÅÆ„ÅøÔºâ**:
`+s.slice(e+1,e+31).map((L,U)=>{var re;const ce=(re=rt().wordProgress)==null?void 0:re[L.word],ie=ce?Ut(ce,n):35,O=(()=>{if(!ce)return 0;switch(n){case"memorization":return ce.memorizationAttempts??0;case"translation":return ce.translationAttempts??0;case"spelling":return ce.spellingAttempts??0;case"grammar":return ce.grammarAttempts??0;default:return ce.totalAttempts??0}})(),q=O===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":ie>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ie>=40?"üü° „Åæ„Å†„Åæ„Å†":ie>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(U+1)+" | "+(e+U+2)+"ÂïèÁõÆ | **"+L.word+"** | "+ie.toFixed(0)+" | "+O+"Âõû | "+(L.difficulty||"unknown")+" | "+q+" |"}).join(`
`):`| # | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Áä∂ÊÖã |
|---|------|----------|----------|------|
`+B.map((L,U)=>{const V=L.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":L.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":L.position>=40?"üü° „Åæ„Å†„Åæ„Å†":L.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(U+1)+" | **"+L.word+"** | "+(L.position??0).toFixed(0)+" | "+L.attempts+"Âõû | "+V+" |"}).join(`
`)})()}

---

## üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÔºöÊ¨°„ÅÆÂá∫È°å‰∫àÂÆö (30ÂïèÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„Çå„ÅØ„Äå„ÅÑ„Åæ‰øùÊåÅ„Åó„Å¶„ÅÑ„Çã„Ç≠„É•„ÉºÔºàquestionsÔºâ„Äç„ÅÆ„ÄåcurrentIndex+1..+30„Äç„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ
Position„ÅØ LocalStorage „Åã„ÇâÂÜçË®àÁÆó„Åó„ÅüÂÄ§„Åß„ÅôÔºàdetermineWordPosition()Ôºâ„ÄÇ

${(()=>{if(!s||s.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const B=rt(),L=s.slice(e+1,e+31);return L.length===0?"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ":`| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
`+L.map((U,V)=>{var be;const ce=String((U==null?void 0:U.word)??""),ie=(be=B.wordProgress)==null?void 0:be[ce],O=ie?Ut(ie,n):35,q=(()=>{if(!ie)return 0;switch(n){case"memorization":return ie.memorizationAttempts??0;case"translation":return ie.translationAttempts??0;case"spelling":return ie.spellingAttempts??0;case"grammar":return ie.grammarAttempts??0;default:return ie.totalAttempts??0}})(),re=(U==null?void 0:U.difficulty)??"‰∏çÊòé",ve=q===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":O>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":O>=40?"üü° „Åæ„Å†„Åæ„Å†":O>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return`| ${V+1} | ${e+V+2}ÂïèÁõÆ | **${ce}** | ${O.toFixed(0)} | ${q}Âõû | ${re} | ${ve} |`}).join(`
`)})()}

**üîç ÂàÜÊûê**:
- „Åæ„Å†„Åæ„Å†(Position 45)„Åå‰∏ä‰Ωç„Å´Êù•„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 50„ÅÆÂºï„Åç‰∏ä„ÅíÂçòË™û„ÅåÊ∑∑ÂÖ•„Åó„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 0„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰ΩçÁã¨Âç†„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÔºü ‚Üí ‚ùå ÂïèÈ°å„ÅÇ„Çä

---

## üìã ÊÆã„Çä„Ç≠„É•„ÉºÔºàLocalStorage PositionÈôçÈ†Ü TOP30Ôºâ

„Åì„ÅÆË°®Á§∫„ÅØ„ÄÅÊÆã„ÇäÂïèÈ°å„Çí LocalStorage „ÅÆÁîüPosition„Åß **ÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„ÅüTOP30** „Åß„ÅôÔºàÂèÇËÄÉÔºâ„ÄÇ

| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
${(()=>{const B=rt();return s.slice(e+1).map(U=>{var ve;const V=U==null?void 0:U.word,ce=(ve=B.wordProgress)==null?void 0:ve[V],ie=ce?Ut(ce,n):35,O=(()=>{if(!ce)return 0;switch(n){case"memorization":return ce.memorizationAttempts??0;case"translation":return ce.translationAttempts??0;case"spelling":return ce.spellingAttempts??0;case"grammar":return ce.grammarAttempts??0;default:return ce.totalAttempts??0}})(),q=(U==null?void 0:U.difficulty)??"‰∏çÊòé",re=O===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":ie>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ie>=40?"üü° „Åæ„Å†„Åæ„Å†":ie>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return{word:V,position:ie,attempts:O,difficulty:q,status:re,originalQuestion:U}}).sort((U,V)=>V.position-U.position).slice(0,30).map((U,V)=>`| ${V+1} | - | **${U.word}** | ${U.position.toFixed(0)} | ${U.attempts}Âõû | ${U.difficulty} | ${U.status} |`).join(`
`)})()}

---

## ü§ñ AIË©ï‰æ°Â±•Ê≠¥ (ÊúÄÊñ∞${Math.max(c.length,20)}‰ª∂)

${ue}

---

## üìä Áµ±Ë®à„Çµ„Éû„É™„Éº

- **Á∑èÂïèÈ°åÊï∞**: ${t}Âïè
- **ÁèæÂú®ÈÄ≤Êçó**: ${((e+1)/t*100).toFixed(1)}%
- **LocalStorage‰øùÂ≠ò‰∏≠Ôºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÔºâ**: ${f.length}Ë™û
  - ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${f.filter(B=>B.position>=70).length}Ë™û
  - „Åæ„Å†„Åæ„Å† (Position‚â•40): ${f.filter(B=>B.position>=40&&B.position<70).length}Ë™û
- **Ê¨°30Âïè‰∏≠„ÅÆÁä∂ÊÖãÂà•**Ôºà„Ç≠„É•„ÉºÈ†ÜÔºèPosition„ÅØLocalStorage„Åã„ÇâÂÜçË®àÁÆóÔºâ:
  - üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(()=>{const B=rt();return s.slice(e+1,e+31).filter(U=>{var O;const V=String((U==null?void 0:U.word)??""),ce=(O=B.wordProgress)==null?void 0:O[V];return(ce?Ut(ce,n):35)>=70}).length})()}Âïè
  - üü° „Åæ„Å†„Åæ„Å†: ${(()=>{const B=rt();return s.slice(e+1,e+31).filter(U=>{var O;const V=String((U==null?void 0:U.word)??""),ce=(O=B.wordProgress)==null?void 0:O[V],ie=ce?Ut(ce,n):35;return ie>=40&&ie<70}).length})()}Âïè
  - ‚ö™ Êñ∞Ë¶è: ${(()=>{const B=rt();return s.slice(e+1,e+31).filter(U=>{var q;const V=String((U==null?void 0:U.word)??""),ce=(q=B.wordProgress)==null?void 0:q[V],ie=(()=>{if(!ce)return 0;switch(n){case"memorization":return ce.memorizationAttempts??0;case"translation":return ce.translationAttempts??0;case"spelling":return ce.spellingAttempts??0;case"grammar":return ce.grammarAttempts??0;default:return ce.totalAttempts??0}})(),O=ce?Ut(ce,n):35;return ie===0||O>=20&&O<40}).length})()}Âïè
  - ‚úÖ ÂÆöÁùÄÊ∏à: ${(()=>{const B=rt();return s.slice(e+1,e+31).filter(U=>{var q;const V=String((U==null?void 0:U.word)??""),ce=(q=B.wordProgress)==null?void 0:q[V],ie=(()=>{if(!ce)return 0;switch(n){case"memorization":return ce.memorizationAttempts??0;case"translation":return ce.translationAttempts??0;case"spelling":return ce.spellingAttempts??0;case"grammar":return ce.grammarAttempts??0;default:return ce.totalAttempts??0}})(),O=ce?Ut(ce,n):35;return ie>0&&O<20}).length})()}Âïè

## üîç „Éá„Éê„ÉÉ„Ç∞„Éí„É≥„Éà

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
1. „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÇíPositionÂºï„Åç‰∏ä„Åí
2. Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „Åå Position +15 ‚Üí 40-55„Çæ„Éº„É≥„Å´Ê∑∑ÂÖ•
3. PositionÈôçÈ†Ü„ÇΩ„Éº„Éà ‚Üí „Åæ„Å†„Åæ„Å†5Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆÊØîÁéá„ÅßÂá∫È°å

**Á¢∫Ë™ç„Éù„Ç§„É≥„Éà**:
- [ ] calculatePriorities() „ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] applyInterleavingAdjustment() „ÅåÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] Êñ∞Ë¶è„ÅÆPosition„Åå +15 „Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºüÔºà„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞Á¢∫Ë™çÔºâ
- [ ] sortAndBalance() „ÅåPositionÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„Å¶„ÅÑ„Çã„ÅãÔºü

---

## üéØ ÂÆü„Éá„Éº„ÇøÊ§úË®ºÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÂê∏ÂºïÁ¢∫Ë™çÔºâ

${(()=>{const B=Wi(n);if(!B||B.length===0)return"‚ö†Ô∏è postProcessÂá∫Âäõ„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´ÂÜçÂ∫¶Á¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";const L=kf(n),U=new Set(L.map(ve=>Ae(ve.word))),V=B.slice(0,30).map((ve,be)=>{const ke=String((ve==null?void 0:ve.word)??""),Ie=Ae(ke),Re=U.has(Ie),we=Number((ve==null?void 0:ve.position)??0),H=Number((ve==null?void 0:ve.attempts)??0);return{rank:be+1,word:ke,position:we,attempts:H,isStruggling:Re}}),ce=V.filter(ve=>ve.isStruggling).length,ie=V.slice(0,10).filter(ve=>ve.isStruggling).length,O=Math.min(L.length,30),q=L.length>0?(ce/L.length*100).toFixed(1):"0.0";let re=`**üìä ÂÆü„Éá„Éº„ÇøÂàÜÊûêÁµêÊûúÔºàpostProcessÂá∫ÂäõÔºâ**:
`;return re+="- ÂÖ®„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: "+L.length+`Ë™û
`,re+="- TOP30ÂÜÖ„Å´Â≠òÂú®: "+ce+"Ë™û / "+O+`Ë™ûÔºàÊúüÂæÖÂÄ§Ôºâ
`,re+="- TOP10ÂÜÖ„Å´Â≠òÂú®: "+ie+`Ë™û
`,re+="- „Ç´„Éê„ÉºÁéá: "+q+`%

`,L.length===0?re+=`‚úÖ **„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì** ‚Üí Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ
`:ce>=Math.min(L.length,20)?re+="‚úÖ **Âê∏ÂºïÊàêÂäü**: TOP30„Å´"+ce+`Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ¢∫ÂÆü„Å´ÂÑ™ÂÖàÂá∫È°å„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`:ce>=Math.ceil(L.length*.5)?re+="‚ö†Ô∏è **ÈÉ®ÂàÜÁöÑÂê∏Âºï**: TOP30„Å´"+ce+"Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÊúüÂæÖÂÄ§Ôºà"+O+`Ë™ûÔºâ„Çà„ÇäÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ
`:(re+="‚ùå **Âê∏ÂºïÂ§±Êïó**: TOP30„Å´"+ce+`Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,re+=`‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØPositionÂÄ§„Åå‰∏çÊ≠£Á¢∫„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),re+=`
**TOP10„ÅÆÂÜÖË®≥**:
`,re+=V.slice(0,10).map(ve=>{const be=ve.isStruggling?"üî¥":ve.position>=40?"üîµ":ve.position>=20?"‚ö™":"‚úÖ",ke=ve.isStruggling?"„Åæ„Å†„Åæ„Å†/ÂàÜ„Åã„Çâ„Å™„ÅÑ":ve.position>=40?"Êñ∞Ë¶è(Âºï‰∏ä)":ve.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";return ve.rank+". "+be+" **"+ve.word+"** (Pos "+ve.position+", "+ve.attempts+"Âõû) - "+ke}).join(`
`),re})()}

---

### üéØ Position-aware InsertionÔºà„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥ÔºâÊ§úË®º

${(()=>{const B=localStorage.getItem("debug_position_aware_insertions");if(!B)return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÂÜçÂá∫È°å„Åï„Çå„Çã„Å®Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ`;try{const L=JSON.parse(B);if(!Array.isArray(L)||L.length===0)return"‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåÁ©∫„Åß„Åô„ÄÇ";let U=`**üìä ÊåøÂÖ•Ë™øÊï¥„ÅÆÂÆüË°åÂ±•Ê≠¥ÔºàÊúÄÊñ∞${L.length}‰ª∂Ôºâ**:

`;L.slice(-10).forEach((O,q)=>{const re=new Date(O.timestamp).toLocaleTimeString("ja-JP"),ve=O.adjustedInsert!==O.originalInsert;if(U+=`${ve?"üéØ":"‚ö™"} **${O.word}** (Position ${O.position})
`,U+=`  - ÊôÇÂàª: ${re}
`,U+=`  - ÂÖÉ„ÅÆÊåøÂÖ•‰ΩçÁΩÆ: index ${O.originalInsert} (ÁèæÂú®‰ΩçÁΩÆ+${O.originalInsert-O.currentIndex})
`,ve){if(U+=`  - üéØ Ë™øÊï¥Âæå: index ${O.adjustedInsert} (ÁèæÂú®‰ΩçÁΩÆ+${O.adjustedInsert-O.currentIndex})
`,U+=`  - ÁêÜÁî±: È´òPositionÂçòË™ûÁæ§„Å´Ââ≤„ÇäËæº„Åø
`,O.nearbyHighPositions&&O.nearbyHighPositions.length>0){const ke=O.nearbyHighPositions.slice(0,3).map(Ie=>`${Ie.word}(${Ie.position})`).join(", ");U+=`  - ËøëÈö£„ÅÆÈ´òPositionË™û: ${ke}${O.nearbyHighPositions.length>3?"...":""}
`}}else U+=`  - Ë™øÊï¥„Å™„ÅóÔºàËøë„Åè„Å´È´òPositionË™û„ÅåË¶ã„Å§„Åã„Çâ„Å™„Åã„Å£„ÅüÔºâ
`;U+=`
`});const ce=L.filter(O=>O.adjustedInsert!==O.originalInsert).length,ie=(ce/L.length*100).toFixed(1);return U+=`**üìà Áµ±Ë®à„Çµ„Éû„É™**:
`,U+=`- Á∑èÊåøÂÖ•ÂõûÊï∞: ${L.length}Âõû
`,U+=`- Position-awareË™øÊï¥: ${ce}Âõû (${ie}%)
`,U+=`- ÈÄöÂ∏∏ÊåøÂÖ•: ${L.length-ce}Âõû

`,ce>0?(U+=`‚úÖ **„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**
`,U+=`‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÊó¢Â≠ò„ÅÆÈ´òPositionË™û„ÅÆËøë„Åè„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`):(U+=`‚ö†Ô∏è **Ë™øÊï¥„Åå1Â∫¶„ÇÇÁô∫Áîü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì**
`,U+=`‚Üí „Ç≠„É•„ÉºÂÜÖ„Å´È´òPositionË™û„ÅåÂ∞ë„Å™„ÅÑ„Åã„ÄÅÂÜçÂá∫È°å„Åå„Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),U}catch(L){return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅÆËß£Êûê„Å´Â§±Êïó: ${L}`}})()}

---

### üîÑ ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„É≠„Ç∞ÔºàuseQuestionRequeueÔºâ

${(()=>{const B=localStorage.getItem("debug_requeue_events");if(!B)return"‚ö†Ô∏è debug_requeue_events „Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const L=JSON.parse(B);if(!Array.isArray(L)||L.length===0)return"‚ö†Ô∏è debug_requeue_events „ÅåÁ©∫„Åß„Åô";const U=L.filter(q=>String((q==null?void 0:q.mode)??"")===n),V=(U.length>0?U:L).slice(-30),ce=V.filter(q=>(q==null?void 0:q.decision)==="inserted").length,ie=V.filter(q=>String((q==null?void 0:q.decision)??"").startsWith("skipped")).length;let O=`**üìä „Çµ„Éû„É™**: inserted=${ce}, skipped=${ie}ÔºàË°®Á§∫: ${U.length>0?n:"ÂÖ®„É¢„Éº„Éâ"} / ÊúÄÊñ∞${V.length}‰ª∂Ôºâ

`;return O+=V.map((q,re)=>{const ve=q!=null&&q.timestamp?new Date(q.timestamp).toLocaleTimeString("ja-JP"):"-",be=String((q==null?void 0:q.word)??(q==null?void 0:q.qid)??"(unknown)"),ke=String((q==null?void 0:q.decision)??"unknown"),Ie=String((q==null?void 0:q.reason)??""),Re=Number.isFinite(Number(q==null?void 0:q.plannedOffset))?Number(q.plannedOffset):null,we=Number.isFinite(Number(q==null?void 0:q.insertAt))?Number(q.insertAt):null,H=Number.isFinite(Number(q==null?void 0:q.currentIndex))?Number(q.currentIndex):null,Te=(q==null?void 0:q.questionPosition)??null,Me=(q==null?void 0:q.ssotPosition)??null,Je=(q==null?void 0:q.effectivePosition)??null,vt=`pos(q)=${Te??"-"}, pos(ssot)=${Me??"-"}, pos(used)=${Je??"-"}`,bt=ke==="inserted"&&we!=null&&H!=null?`insert@index ${we} (ÁèæÂú®‰ΩçÁΩÆ+${we-H})`:ke.startsWith("skipped")?`skip (windowEnd=${(q==null?void 0:q.windowEnd)??"-"})`:"",He=Re!=null?`offset=${Re}`:"";return`${re+1}. ${ve} [${ke}] **${be}** (${Ie}) ${He} ${bt} | ${vt}`}).join(`
`),O}catch(L){return`‚ö†Ô∏è debug_requeue_events „ÅÆËß£Êûê„Å´Â§±Êïó: ${String(L)}`}})()}

---

_„Åì„ÅÆ„É¨„Éù„Éº„Éà„Çí„Ç≥„Éî„Éº„Åó„Å¶GitHub Copilot Chat„ÅßÂàÜÊûê„Åß„Åç„Åæ„Åô_
`.trim();navigator.clipboard.writeText(xe).then(()=>{h(!0),setTimeout(()=>h(!1),2e3)})};return T.useEffect(()=>{const C=localStorage.getItem("debug_ai_evaluations");if(C)try{const N=JSON.parse(C);l(Object.values(N).slice(-10))}catch{}{const N="memorization",_=t,P=oe=>{if(!oe)return null;try{return JSON.parse(oe)}catch{return null}},j=oe=>{const ge=typeof oe=="number"?oe:Number(oe);return Number.isFinite(ge)?ge:null},A=oe=>{const ge=Date.parse(String(oe??""));return Number.isFinite(ge)?ge:0},F=oe=>{const ge=oe.filter(Boolean);if(ge.length===0)return null;const Ae=ge.filter(Pe=>j(Pe==null?void 0:Pe.questionsCount)===_);return Ae.length>0?(Ae.sort((Pe,Ne)=>A(Ne==null?void 0:Ne.timestamp)-A(Pe==null?void 0:Pe.timestamp)),Ae[0]):[...ge].sort((Pe,Ne)=>{const Ye=j(Pe==null?void 0:Pe.questionsCount)??-1,at=j(Ne==null?void 0:Ne.questionsCount)??-1;return at!==Ye?at-Ye:A(Ne==null?void 0:Ne.timestamp)-A(Pe==null?void 0:Pe.timestamp)})[0]},M=`debug_position_interleaving_history_${N}`,K=P(localStorage.getItem(M)),D=Array.isArray(K)?K:[],G=F(D),te=`debug_position_interleaving_${N}`,W=P(localStorage.getItem(te)),de=P(localStorage.getItem("debug_position_interleaving")),le=G??W??de;le&&g(le)}const k=localStorage.getItem("debug_answer_logs");if(k)try{y(JSON.parse(k))}catch{}const $=localStorage.getItem("debug_function_calls");if($)try{v(JSON.parse($))}catch{}localStorage.getItem("debug_position_hierarchy_validation"),localStorage.getItem("debug_position_hierarchy_still"),localStorage.getItem("debug_position_hierarchy_new")},[e]),i?u.jsxs("div",{className:"fixed bottom-4 right-4 w-96 max-h-96 bg-white rounded-lg shadow-2xl overflow-auto z-50 border-2 border-blue-500",children:[u.jsxs("div",{className:"sticky top-0 bg-blue-600 text-white p-3 flex justify-between items-center",children:[u.jsx("h3",{className:"font-bold",children:"üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„Éë„Éç„É´"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:I,className:`px-3 py-1 rounded ${d?"bg-green-500":"bg-blue-500 hover:bg-blue-700"}`,title:"„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„Åß„Ç≥„Éî„Éº",children:d?"‚úì „Ç≥„Éî„ÉºÂÆå‰∫Ü":"üìã „Ç≥„Éî„Éº"}),u.jsx("button",{onClick:()=>a(!1),className:"text-white hover:bg-blue-700 px-2 py-1 rounded",children:"‚úï"})]})]}),u.jsxs("div",{className:"p-4 space-y-4 text-sm",children:[(()=>{try{const C=localStorage.getItem("debug_ab_session_info");if(!C)return null;const k=JSON.parse(C),$=JSON.stringify(k,null,2);return u.jsxs("div",{className:"bg-orange-50 p-3 rounded border-2 border-orange-300",children:[u.jsx("p",{className:"font-semibold text-orange-800",children:"üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±Ôºà„Ç≥„Éî„ÉöÁî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„ÇØ„É™„ÉÉ„ÇØ„ÅßJSON„Çí„Ç≥„Éî„Éº"}),u.jsx("pre",{className:"mt-2 bg-white p-2 rounded text-xs cursor-pointer whitespace-pre-wrap break-words",onClick:()=>{navigator.clipboard.writeText($),h(!0),setTimeout(()=>h(!1),1500)},title:"„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Ç≥„Éî„Éº",children:$})]})}catch{return null}})(),(()=>{const C=Hu.generateSummary(n);if(C==="„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó"||C==="„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó")return u.jsxs("div",{className:"bg-gray-50 p-3 rounded border-2 border-gray-300",children:[u.jsx("p",{className:"font-semibold text-gray-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°"}),u.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„ÅóÔºàÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ"})]});const $=C.split(`
`).filter(F=>F.trim()).filter(F=>F.startsWith("|"));if($.length===0)return null;const[N,_,...P]=$,j=N.split("|").filter(F=>F.trim()).map(F=>F.trim()),A=P.map(F=>F.split("|").filter(M=>M.trim()).map(M=>M.trim()));return u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ"}),u.jsx("div",{className:"mt-2 overflow-x-auto",children:u.jsxs("table",{className:"min-w-full text-xs",children:[u.jsx("thead",{children:u.jsx("tr",{className:"bg-purple-100",children:j.map((F,M)=>u.jsx("th",{className:"px-2 py-1 text-left font-semibold",children:F},M))})}),u.jsx("tbody",{children:A.map((F,M)=>u.jsx("tr",{className:M%2===0?"bg-white":"bg-purple-50",children:F.map((K,D)=>u.jsx("td",{className:"px-2 py-1",children:K},D))},M))})]})})]})})(),(()=>{const C=rt(),k=Object.keys(C.wordProgress||{}).length,$=Object.values(C.wordProgress||{});let N=0,_=0,P=0,j=0,A=0,F=0;for(const G of $){const te=Df(G,n),W=ab(G,n),de=cb(G,n),le=Ut(G,n);j+=te,A+=W,F+=de,te!==0&&(le>=70?P++:le>=40?_++:le<20&&N++)}const M=Math.max(0,j-A-F),K=j>0?(A/j*100).toFixed(1):"0.0",D=k>0?(N/k*100).toFixed(1):"0.0";return u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsx("p",{className:"font-semibold text-green-800",children:"„Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"Á∑èÂçòË™ûÊï∞"}),u.jsxs("p",{className:"text-lg font-bold",children:[k,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÁøíÂæóÊ∏à„Åø"}),u.jsxs("p",{className:"text-lg font-bold text-green-600",children:[N,"Ë™û"]}),u.jsxs("p",{className:"text-xs text-gray-500",children:["(",D,"%)"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"„Åæ„Å†„Åæ„Å†"}),u.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:[_,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"}),u.jsxs("p",{className:"text-lg font-bold text-red-600",children:[P,"Ë™û"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÂÖ®‰ΩìÊ≠£Á≠îÁéá:"}),u.jsxs("span",{className:"font-bold",children:[K,"%"]})]}),u.jsxs("div",{className:"flex justify-between mt-1",children:[u.jsx("span",{className:"text-gray-600",children:"Á∑èË©¶Ë°åÂõûÊï∞:"}),u.jsxs("span",{children:[j,"Âõû"]})]}),u.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[u.jsxs("span",{className:"text-green-600",children:["Ê≠£Á≠î: ",A,"Âõû"]}),u.jsxs("span",{className:"text-red-600",children:["Ë™§Á≠î: ",M,"Âõû"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÈÄ≤ÊçóÁéá:"}),u.jsxs("span",{className:"font-bold",children:[(e/t*100).toFixed(1),"%"]})]}),u.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e," / ",t," ÂïèÁõÆ"]}),u.jsx("progress",{className:"w-full h-2 rounded-full mt-2 [&::-webkit-progress-bar]:bg-gray-200 [&::-webkit-progress-value]:bg-blue-600 [&::-moz-progress-bar]:bg-blue-600",value:e,max:Math.max(1,t)})]})]})]})})(),b.length>0&&u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsxs("p",{className:"font-semibold text-blue-800",children:["üìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞",b.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:b.slice().reverse().map((C,k)=>u.jsxs("div",{className:"text-xs bg-white p-2 rounded flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-mono font-bold text-blue-600",children:C.function}),u.jsx("span",{className:"ml-2 text-gray-600",children:JSON.stringify(C.params)})]}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})]},k))})]}),x.length>0&&u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsxs("p",{className:"font-semibold text-green-800",children:["üìù Ëß£Á≠îÁõ¥Âæå„ÅÆPositionË®àÁÆó (ÊúÄÊñ∞",x.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:x.slice().reverse().map((C,k)=>{const $=Math.abs(C.positionAfter-C.positionBefore)>1,N=C.positionAfter>C.positionBefore;return u.jsxs("div",{className:"text-xs bg-white p-2 rounded border",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:C.word}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})]}),u.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-600",children:"Position: "}),u.jsxs("span",{className:$?N?"text-red-600 font-bold":"text-green-600 font-bold":"",children:[C.positionBefore.toFixed(0)," ‚Üí ",C.positionAfter.toFixed(0)]}),$&&u.jsxs("span",{className:"ml-2",children:[N?"üî∫":"üîª",Math.abs(C.positionAfter-C.positionBefore).toFixed(0)]})]}),(()=>{const _=(()=>{switch(C.category){case"incorrect":return{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded text-xs",label:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs",label:"üü° „Åæ„Å†„Åæ„Å†"};case"new":return{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs",label:"‚ö™ Êñ∞Ë¶è"};case"mastered":return{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs",label:"‚úÖ ÂÆöÁùÄÊ∏à"};default:return{className:"bg-gray-100 text-gray-800 px-2 py-0.5 rounded text-xs",label:String(C.category??"")}}})();return u.jsx("span",{className:_.className,children:_.label})})()]}),u.jsxs("div",{className:"mt-1 flex gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["Ê≠£Á≠î: ",C.progress.correctCount]}),u.jsxs("span",{children:["Ë™§Á≠î: ",C.progress.incorrectCount]}),u.jsxs("span",{children:["ÈÄ£Á∂öÊ≠£Á≠î: ",C.progress.consecutiveCorrect]}),u.jsxs("span",{children:["ÈÄ£Á∂öË™§Á≠î: ",C.progress.consecutiveIncorrect]}),u.jsxs("span",{children:["Ê≠£Á≠îÁéá: ",(C.progress.accuracy*100).toFixed(0),"%"]})]}),(()=>{var M,K;const _=C.savedPositionDebug,P=_==null?void 0:_.savedPosition,j=_==null?void 0:_.decision,A=_==null?void 0:_.reason,F=C.positionWithSavedPosition;return P===void 0&&F===void 0&&!j?null:u.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["savedPosition: ",P??"-"]}),u.jsxs("span",{children:["calc(savedÊúâ„Çä): ",F??"-"]}),u.jsxs("span",{children:["calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå): ",((K=(M=C.positionAfter)==null?void 0:M.toFixed)==null?void 0:K.call(M,0))??"-"]}),j&&u.jsxs("span",{children:["savedÂà§ÂÆö: ",String(j),A?` (${String(A)})`:""]})]})})()]},k)})})]}),m&&u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üéÆ PositionÂàÜÊï£Ë®∫Êñ≠"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Ââç:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",m.before.struggling,"Ë™û / Êñ∞Ë¶è",m.before.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Âæå:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",m.after.struggling,"Ë™û / Êñ∞Ë¶è",m.after.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between font-bold",children:[u.jsx("span",{children:"PositionÂºï„Åç‰∏ä„Åí:"}),u.jsxs("span",{className:m.summary.working?"text-green-600":"text-red-600",children:[m.summary.boosted,"Ë™û",m.summary.working?" ‚úÖ":" ‚ùå"]})]}),m.changed.length>0&&u.jsxs("details",{className:"mt-2",children:[u.jsxs("summary",{className:"cursor-pointer text-purple-700",children:["Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û (",m.changed.length,"Ë™û)"]}),u.jsx("ul",{className:"mt-1 space-y-1 max-h-40 overflow-y-auto",children:m.changed.slice(0,10).map((C,k)=>u.jsxs("li",{className:"text-xs bg-white p-1 rounded",children:[u.jsx("span",{className:"font-mono",children:C.word}),":"," ",u.jsxs("span",{className:"text-gray-500",children:[C.before.toFixed(0)," ‚Üí ",C.after.toFixed(0)]})]},k))})]}),!m.summary.working&&u.jsx("div",{className:"text-red-600 font-bold mt-2",children:"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„Éñ„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ"})]})]}),(()=>{const C=Wi(n).slice(0,30);if(C.length===0)return null;try{const k=C.map(j=>j.attempts>0&&j.position>=40&&j.position<70?"„Åæ„Å†„Åæ„Å†":j.attempts===0&&j.position>=40&&j.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":j.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":j.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),$={„Åæ„Å†„Åæ„Å†:k.filter(j=>j==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:k.filter(j=>j==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:k.filter(j=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(j)).length},N=k.slice(0,20).map(j=>{switch(j){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join("");let _=0;for(let j=0;j<k.length-1;j++){const A=k[j],F=k[j+1];A==="„Åæ„Å†„Åæ„Å†"&&F==="Êñ∞Ë¶è(Âºï‰∏ä)"&&_++,A==="Êñ∞Ë¶è(Âºï‰∏ä)"&&F==="„Åæ„Å†„Åæ„Å†"&&_++}const P=_>=3;return u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üü° „Åæ„Å†„Åæ„Å†:"}),u.jsxs("span",{className:"font-bold",children:[$.„Åæ„Å†„Åæ„Å†,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üîµ Êñ∞Ë¶è(Âºï‰∏ä):"}),u.jsxs("span",{className:"font-bold",children:[$.Êñ∞Ë¶èÂºï‰∏ä,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"„Åù„ÅÆ‰ªñ:"}),u.jsxs("span",{children:[$.„Åù„ÅÆ‰ªñ,"Ë™û"]})]}),u.jsxs("div",{className:"mt-3 p-2 bg-white rounded",children:[u.jsx("p",{className:"text-xs font-semibold mb-1",children:"„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ (TOP20):"}),u.jsx("div",{className:"text-lg leading-relaxed break-all",children:N}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à"})]}),u.jsxs("div",{className:`mt-2 p-2 rounded ${P?"bg-green-100":"bg-yellow-100"}`,children:[u.jsx("p",{className:"font-semibold",children:P?"‚úÖ ‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ":"‚ö†Ô∏è ‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑ"}),u.jsxs("p",{className:"text-xs mt-1",children:["Âàá„ÇäÊõø„ÅàÂõûÊï∞: ",_,"Âõû",P?" (ÊúüÂæÖ: „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè)":""]})]}),$.„Åæ„Å†„Åæ„Å†===0&&$.Êñ∞Ë¶èÂºï‰∏ä===0&&u.jsx("div",{className:"text-gray-600 mt-2",children:"‚ÑπÔ∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„ÅóÔºàÊ≠£Â∏∏Âãï‰ΩúÔºâ"})]})]})}catch{return null}})(),u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsx("p",{className:"font-semibold",children:"üìç ÁèæÂú®‰ΩçÁΩÆ"}),u.jsxs("p",{className:"text-lg",children:[e+1," / ",t," ÂïèÁõÆ"]})]}),u.jsxs("div",{className:"bg-yellow-50 p-3 rounded",children:[u.jsxs("p",{className:"font-semibold text-yellow-800",children:["üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (",f.length,"Ë™û)"]}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"LocalStorage„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãËã¶ÊâãÂçòË™ûÔºàPosition ‚â• 40Ôºâ"}),f.length===0?u.jsx("p",{className:"text-gray-600 mt-2",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-1 max-h-60 overflow-y-auto",children:f.slice(0,20).map((C,k)=>u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:C.word}),u.jsx("span",{className:C.position>=70?"bg-red-100 text-red-800 px-2 py-0.5 rounded":"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:C.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-500",children:[u.jsxs("span",{children:["Position: ",C.position.toFixed(0)]}),u.jsxs("span",{children:["Ë©¶Ë°å: ",C.attempts,"Âõû"]}),u.jsxs("span",{children:["ÊúÄÁµÇ: ",new Date(C.lastStudied).toLocaleDateString()]})]})]},k))}),f.length>20&&u.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["‚Äª ÊúÄÂàù„ÅÆ20Ë™û„ÅÆ„ÅøË°®Á§∫ÔºàÂÖ®",f.length,"Ë™ûÔºâ"]})]}),u.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üìã Ê¨°„ÅÆ30ÂïèÔºàPositionÂàÜÊï£Ë®∫Êñ≠Áî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„Åæ„Å†„Åæ„Å†58Ë™û ‚Üí Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÅåPosition +15„Åï„Çå„Å¶„ÅÑ„Çã„ÅØ„Åö"}),u.jsx("ul",{className:"mt-2 space-y-1 max-h-80 overflow-y-auto",children:s.slice(e+1,e+31).map((C,k)=>{var K;const $=C==null?void 0:C.word,_=(K=rt().wordProgress)==null?void 0:K[$],P=(_==null?void 0:_.memorizationPosition)??0,j=(_==null?void 0:_.totalAttempts)??0,A=(C==null?void 0:C.difficulty)??"‰∏çÊòé",F=P>=40,M=P>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":P>=40?"üü° „Åæ„Å†„Åæ„Å†":P>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return u.jsxs("li",{className:`text-xs p-2 rounded ${F?"bg-yellow-200 font-bold":"bg-white"}`,children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"text-gray-500",children:[e+k+2,"ÂïèÁõÆ"]})," ",u.jsx("span",{className:"font-mono font-bold",children:$})]}),u.jsx("div",{className:"text-xs",children:M})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-600",children:[u.jsxs("span",{children:["Position: ",P.toFixed(0)]}),u.jsxs("span",{children:["Âá∫È°å: ",j,"Âõû"]}),u.jsx("span",{children:A}),F&&u.jsx("span",{className:"text-yellow-800 font-bold",children:P>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]})]},k)})})]}),u.jsxs("div",{className:"bg-purple-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"ü§ñ AIË©ï‰æ°ÔºàÊúÄÊñ∞10‰ª∂Ôºâ"}),c.length===0?u.jsx("p",{className:"text-gray-600",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-2",children:c.slice(-10).map((C,k)=>{const $=C.word||"(ÂçòË™ûÂêç„Å™„Åó)",N=(()=>{switch(C.category){case"incorrect":return{className:"bg-red-100 text-red-800",label:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800",label:"„Åæ„Å†„Åæ„Å†"};case"mastered":return{className:"bg-green-100 text-green-800",label:"ÂÆöÁùÄÊ∏à"};case"new":return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"};default:return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"}}})();return u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"text-gray-500",children:["#",k+1]}),u.jsx("span",{className:"font-mono font-bold text-base text-blue-600",children:$})]}),u.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${N.className}`,children:N.label})]}),u.jsxs("div",{className:"flex flex-col gap-1 text-gray-600",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"font-semibold",children:["Position: ",(C.position??0).toFixed(0)]}),u.jsxs("span",{className:"ml-2 text-xs",children:["(ÈÄ£Á∂öÊ≠£Ëß£: ",C.consecutiveCorrect??0,", ÈÄ£Á∂ö‰∏çÊ≠£Ëß£:"," ",C.consecutiveIncorrect??0,")"]})]}),u.jsxs("div",{className:"text-xs",children:[u.jsxs("span",{children:["Ê≠£Ëß£Áéá: ",((C.accuracy??0)*100).toFixed(0),"%"]}),u.jsxs("span",{className:"ml-2",children:["Ë©¶Ë°å: ",C.attempts??0,"Âõû"]}),u.jsxs("span",{className:"ml-2",children:["ÁµåÈÅé: ",C.daysSince??0,"Êó•"]})]}),C.aiProposals&&u.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[u.jsx("div",{className:"text-xs font-semibold mb-1",children:"ü§ñ 7„Å§„ÅÆAIÊèêÊ°à:"}),u.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[u.jsxs("span",{children:["üß† Memory: ",(C.aiProposals.memory??0).toFixed(0)]}),u.jsxs("span",{children:["üí§ CogLoad: ",(C.aiProposals.cognitiveLoad??0).toFixed(0)]}),u.jsxs("span",{children:["üîÆ Error: ",(C.aiProposals.errorPrediction??0).toFixed(0)]}),u.jsxs("span",{children:["üìö Linguistic: ",(C.aiProposals.linguistic??0).toFixed(0)]}),u.jsxs("span",{children:["üåç Context: ",(C.aiProposals.contextual??0).toFixed(0)]}),u.jsxs("span",{children:["üéØ Style: ",(C.aiProposals.learningStyle??0).toFixed(0)]}),u.jsxs("span",{className:"col-span-2",children:["üéÆ Gamify: ",(C.aiProposals.gamification??0).toFixed(0)]})]})]})]})]},k)})})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_ai_evaluations"),l([])},className:"flex-1 bg-red-100 text-red-800 px-3 py-2 rounded hover:bg-red-200",children:"üóëÔ∏è AIË©ï‰æ°„ÇØ„É™„Ç¢"}),u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_memorization_latest")},className:"flex-1 bg-gray-100 text-gray-800 px-3 py-2 rounded hover:bg-gray-200",children:"üóëÔ∏è „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞„ÇØ„É™„Ç¢"})]}),u.jsxs("div",{className:"mt-6 border-t-2 border-blue-300 pt-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"font-bold text-lg",children:"üìä A/B„ÉÜ„Çπ„ÉàÈõÜË®à"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{const C=ib();S(C)},className:"bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200",children:"üîÑ Êõ¥Êñ∞"}),u.jsx("button",{onClick:()=>{const C=_J(),k=new Blob([C],{type:"application/json"}),$=URL.createObjectURL(k),N=document.createElement("a");N.href=$,N.download=`ab-session-logs-${Date.now()}.json`,N.click(),URL.revokeObjectURL($)},className:"bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200",children:"üíæ JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà"}),u.jsx("button",{onClick:()=>{window.confirm("„Åô„Åπ„Å¶„ÅÆA/B„Çª„ÉÉ„Ç∑„Éß„É≥„É≠„Ç∞„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")&&(PJ(),S(null))},className:"bg-red-100 text-red-800 px-3 py-1 rounded text-sm hover:bg-red-200",children:"üóëÔ∏è „ÇØ„É™„Ç¢"})]})]}),w&&w.totalSessions>0?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsxs("div",{className:"text-sm",children:[u.jsx("strong",{children:"Á∑è„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞:"})," ",w.totalSessions]}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["ÊúÄÁµÇÊõ¥Êñ∞: ",new Date(w.lastUpdated).toLocaleString("ja-JP")]})]}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm border-collapse",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-gray-200",children:[u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"Variant"}),u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"N"}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(‰∏≠Â§ÆÂÄ§)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóÁéá",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊåØÂãï„Çπ„Ç≥„Ç¢",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊâÄË¶ÅÊôÇÈñì",u.jsx("br",{}),"(Âπ≥Âùá)"]})]})}),u.jsx("tbody",{children:["A","B","C"].map(C=>{const k=w.byVariant[C];return k?u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:C}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.sessionCount}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.avgAcquiredWords.toFixed(2)}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.medianAcquiredWords.toFixed(0)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[(k.avgAcquisitionRate*100).toFixed(1),"%"]}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.avgVibrationScore.toFixed(1)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[Math.round(k.avgDurationSec),"Áßí"]})]},C):u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:C}),u.jsx("td",{colSpan:6,className:"border border-gray-300 px-2 py-1 text-center text-gray-500",children:"„Éá„Éº„Çø„Å™„Åó"})]},C)})})]})}),(()=>{try{const k=JSON.parse(localStorage.getItem("ab_session_logs")||"[]").filter($=>$.mlEnabled===!0).length;if(k>0)return u.jsxs("div",{className:"bg-blue-50/20 p-3 rounded border border-blue-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"ü§ñ MLÁµ±Ë®à"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["ML ON„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞: ",k]}),u.jsx("div",{className:"text-gray-600",children:"‚Äª MLÊúâÂäπÂåñÂæå„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø„ÅØÂêÑvariant„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô"})]})]})}catch{}return null})(),w.byVariant.A&&u.jsxs("div",{className:"bg-yellow-50/20 p-3 rounded border border-yellow-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"üìà Âà§ÂÆöÂü∫Ê∫ñÔºàÊö´ÂÆöÔºâ"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["‚úÖ ",u.jsx("strong",{children:"ÂêàÊ†º:"})," B or C „Åå A „Å´ÂØæ„Åó„Å¶„ÄåÂèñÂæóË™ûÊï∞/„Çª„ÉÉ„Ç∑„Éß„É≥ +10%„Äç„Åã„Å§ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ„Å™„Åó"]}),u.jsxs("div",{children:["‚ùå ",u.jsx("strong",{children:"‰∏çÂêàÊ†º:"})," ÊîπÂñÑ„Å™„Åó or ÊåØÂãï„Çπ„Ç≥„Ç¢ > 50"]})]}),w.byVariant.B&&w.byVariant.A&&u.jsxs("div",{className:"mt-2 text-xs",children:[u.jsx("strong",{children:"B vs A:"})," ",w.byVariant.B.avgAcquiredWords>=w.byVariant.A.avgAcquiredWords*1.1&&w.byVariant.B.avgVibrationScore<=w.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]}),w.byVariant.C&&w.byVariant.A&&u.jsxs("div",{className:"mt-1 text-xs",children:[u.jsx("strong",{children:"C vs A:"})," ",w.byVariant.C.avgAcquiredWords>=w.byVariant.A.avgAcquiredWords*1.1&&w.byVariant.C.avgVibrationScore<=w.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]})]})]}):u.jsx("div",{className:"text-center text-gray-500 py-8",children:"„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})]})]}):null}const lb=[0,5,10,20,30,50,100,150,200];function Z0({learningLimit:n,reviewLimit:e,onLearningLimitChange:t,onReviewLimitChange:s,idPrefix:r=""}){return u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:`${r}learning-limit`,children:"üéØ Â≠¶Áøí‰∏≠„ÅÆ‰∏äÈôê:"}),u.jsx("select",{id:`${r}learning-limit`,value:n,onChange:o=>t(parseInt(o.target.value)),className:"select-input",children:lb.map(o=>u.jsx("option",{value:o,children:o===0?"Ë®≠ÂÆöÁÑ°„Åó":o},o))})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:`${r}review-limit`,children:"‚ö†Ô∏è Ë¶ÅÂæ©Áøí„ÅÆ‰∏äÈôê:"}),u.jsx("select",{id:`${r}review-limit`,value:e,onChange:o=>s(parseInt(o.target.value)),className:"select-input",children:lb.map(o=>u.jsx("option",{value:o,children:o===0?"Ë®≠ÂÆöÁÑ°„Åó":o},o))})]})]})}function ex(n){const[e,t]=T.useState(()=>{const a=localStorage.getItem(`learning-limit-${n}`);return a?parseInt(a):30}),[s,r]=T.useState(()=>{const a=localStorage.getItem(`review-limit-${n}`);return a?parseInt(a):10}),o=T.useCallback(a=>{const c=Math.max(0,a)||30;t(c),localStorage.setItem(`learning-limit-${n}`,c.toString())},[n]),i=T.useCallback(a=>{const c=Math.max(0,a)||10;r(c),localStorage.setItem(`review-limit-${n}`,c.toString())},[n]);return{learningLimit:e,reviewLimit:s,setLearningLimit:o,setReviewLimit:i}}var Ki=(n=>(n.ENCODING="encoding",n.INITIAL_CONSOLIDATION="initial",n.INTRADAY_REVIEW="intraday",n.SHORT_TERM="short_term",n.LONG_TERM="long_term",n))(Ki||{});const ub={encodingTime:3e4,initialConsolidation:36e5,intradayWindow:864e5,shortTermWindow:6048e5,longTermThreshold:6048e5,correctRateThreshold:.8,responseTimeThreshold:1500},FJ=1e3,OJ=100,LJ=100,zJ=0,WJ=6e4,BJ=1e3;class VJ{constructor(e,t){Ee(this,"thresholds");Ee(this,"cache");Ee(this,"CACHE_DURATION",5e3);const s={...ub,...t};e?this.thresholds=this.adjustThresholds(s,e):this.thresholds=s,this.cache=new Map}adjustThresholds(e,t){return{encodingTime:e.encodingTime,initialConsolidation:e.initialConsolidation/t.learningSpeed,intradayWindow:e.intradayWindow,shortTermWindow:e.shortTermWindow/t.learningSpeed,longTermThreshold:e.longTermThreshold/t.learningSpeed,correctRateThreshold:e.correctRateThreshold,responseTimeThreshold:e.responseTimeThreshold*t.learningSpeed}}detectPhase(e,t){const s=Date.now(),r=this.cache.get(e);if(r&&s-r.timestamp<this.CACHE_DURATION)return r.phase;const o=this.detectPhaseWithReason(e,t);return this.cache.set(e,{phase:o.phase,timestamp:s}),o.phase}detectPhaseWithReason(e,t){const s=Date.now(),r=this.sanitizeTimestamp(t.lastReviewTime,s),o=this.sanitizeTimestamp(t.lastCorrectTime,s),i=this.sanitizeResponseTime(t.averageResponseTime),a=s-r,c=a/864e5,l=t.reviewCount>0?t.correctCount/t.reviewCount:0,d={reviewCount:t.reviewCount,correctCount:t.correctCount,correctRate:l,daysSinceLastReview:c,timeSinceLastReview:a,averageResponseTime:i};if(t.reviewCount===0)return{phase:"encoding",reason:"ÂàùË¶ãÂçòË™ûÔºàreviewCount=0Ôºâ",matchedCondition:1,metrics:d};if(a<this.thresholds.encodingTime)return{phase:"encoding",reason:`‰ΩúÊ•≠Ë®òÊÜ∂ÊÆµÈöéÔºà${Math.round(a/1e3)}ÁßíÂâçÔºâ`,matchedCondition:2,metrics:d};if(t.correctCount===0)return{phase:"encoding",reason:"‰∏ÄÂ∫¶„ÇÇÊ≠£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑ",matchedCondition:3,metrics:d};if(c>FJ)return{phase:"encoding",reason:`Ë∂ÖÈï∑ÊúüÊîæÁΩÆÔºà${Math.round(c)}Êó•ÂâçÔºâ`,matchedCondition:101,metrics:d};if(t.consecutiveCorrect>=OJ)return{phase:"long_term",reason:`ÂÆåÂÖ®ÁøíÂæóÔºà${t.consecutiveCorrect}ÂõûÈÄ£Á∂öÊ≠£Á≠îÔºâ`,matchedCondition:102,metrics:d};if(t.consecutiveWrong>=LJ)return{phase:"encoding",reason:`Â≠¶ÁøíÊñπÊ≥ïË¶ÅË¶ãÁõ¥„ÅóÔºà${t.consecutiveWrong}ÂõûÈÄ£Á∂öË™§Á≠îÔºâ`,matchedCondition:103,metrics:d};const h=(s-o)/36e5;if(t.correctCount===1&&s-o<this.thresholds.initialConsolidation)return{phase:"initial",reason:`ÂàùÊúüÁµ±ÂêàÊÆµÈöéÔºàÂàùÂõûÊ≠£Á≠îÂæå${Math.round(h*60)}ÂàÜÔºâ`,matchedCondition:4,metrics:d};if(this.isSameDay(s,o)&&t.correctCount>=2)return{phase:"intraday",reason:`ÂêåÊó•Âæ©ÁøíÊÆµÈöéÔºà‰ªäÊó•${t.correctCount}ÂõûÊ≠£Á≠îÔºâ`,matchedCondition:5,metrics:d};if(c>=1&&c<=7){if(l>=.5&&l<this.thresholds.correctRateThreshold)return{phase:"short_term",reason:`Áü≠ÊúüË®òÊÜ∂ÊÆµÈöéÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d};if(l<.5)return{phase:"encoding",reason:`ÂøòÂç¥„Å´„Çà„Çä„É™„Çª„ÉÉ„ÉàÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d}}return c>7?l>=this.thresholds.correctRateThreshold&&i<this.thresholds.responseTimeThreshold?{phase:"long_term",reason:`Èï∑ÊúüË®òÊÜ∂Á¢∫Á´ãÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%„ÄÅÂøúÁ≠î${Math.round(i)}msÔºâ`,matchedCondition:7,metrics:d}:l>=.5&&l<this.thresholds.correctRateThreshold?{phase:"short_term",reason:`„Åæ„Å†‰∏çÂÆâÂÆöÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"encoding",reason:`ÂÆåÂÖ®ÂøòÂç¥ÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"short_term",reason:"„Éá„Éï„Ç©„É´„ÉàÂà§ÂÆö",matchedCondition:0,metrics:d}}canTransition(e,t,s){const r=this.detectPhase(e,t);if(r===s)return!0;const o=["encoding","initial","intraday","short_term","long_term"],i=o.indexOf(r),a=o.indexOf(s);return a>i?a-i===1:!0}isSameDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}sanitizeResponseTime(e){return e<=zJ||e>WJ||isNaN(e)?BJ:e}sanitizeTimestamp(e,t){return e>t?(console.warn(`Êú™Êù•„ÅÆ„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„ÇíÊ§úÂá∫: ${e}`),t):e<0||isNaN(e)?t:e}clearCache(){this.cache.clear()}updateThresholds(e){this.thresholds=this.adjustThresholds(ub,e),this.clearCache()}}var ec=(n=>(n.IMMEDIATE="immediate",n.EARLY="early",n.MID="mid",n.END="end",n))(ec||{}),Fa=(n=>(n.MEMORIZATION="memorization",n.TRANSLATION="translation",n.SPELLING="spelling",n.GRAMMAR="grammar",n))(Fa||{});const UJ={memorization:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5},translation:{consolidationThreshold:4,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.6},spelling:{consolidationThreshold:6,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.4},grammar:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5}},su={immediate:50,early:100,mid:150,end:200},GJ=72e5,db=3,HJ=1/0,qJ=2,KJ=1,hb=.85,Va=4;class QJ{constructor(e){Ee(this,"queues");Ee(this,"currentQuestionNumber",0);Ee(this,"sessionStartTime",Date.now());Ee(this,"wordAttempts",new Map);Ee(this,"acquisitionProgress",new Map);Ee(this,"tabConfigs");if(this.queues={immediate:[],early:[],mid:[],end:[]},this.tabConfigs={...UJ},e)for(const[t,s]of Object.entries(e))this.tabConfigs[t]={...this.tabConfigs[t],...s}}enqueueNewWord(e,t,s){const r=Date.now();this.currentQuestionNumber++;const o=this.tabConfigs[s];if(this.acquisitionProgress.has(e)||this.acquisitionProgress.set(e,{todayFirstSeen:r,todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:o.consolidationThreshold,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:r}),o.enableImmediateReview&&this.shouldEnqueueImmediate(t)){const i=this.calculateImmediateGap(t);this.enqueueToImmediate(e,t,s,i)}}enqueueToImmediate(e,t,s,r){const o=Date.now();if(this.isDuplicateInQueue(e,"immediate"))return;const i={word:e,queueType:"immediate",enqueuedAt:o,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+r,targetTime:o+6e4,priority:100,difficulty:t,category:s};this.enqueueWithLimit(this.queues.immediate,i,su.immediate);const a=this.acquisitionProgress.get(e);a.currentQueue="immediate",a.queuedAt=o}enqueueToEarly(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEarlyReview||this.isDuplicateInQueue(e,"early"))return;const i=this.calculateEarlyGap(t),a={word:e,queueType:"early",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+6e5,priority:80,difficulty:t,category:s};this.enqueueWithLimit(this.queues.early,a,su.early);const c=this.acquisitionProgress.get(e);c.currentQueue="early",c.queuedAt=r}enqueueToMid(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableMidReview||this.isDuplicateInQueue(e,"mid"))return;const i=this.calculateMidGap(t),a={word:e,queueType:"mid",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+36e5,priority:60,difficulty:t,category:s};this.enqueueWithLimit(this.queues.mid,a,su.mid);const c=this.acquisitionProgress.get(e);c.currentQueue="mid",c.queuedAt=r}enqueueToEnd(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEndReview||this.isDuplicateInQueue(e,"end"))return;const i={word:e,queueType:"end",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:1/0,targetTime:1/0,priority:40,difficulty:t,category:s};this.enqueueWithLimit(this.queues.end,i,su.end);const a=this.acquisitionProgress.get(e);a.currentQueue="end",a.queuedAt=r}getNextReviewQuestion(){this.cleanupExpiredEntries();const e=Date.now(),t=this.currentQuestionNumber,s=[];for(const r of this.queues.immediate)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.early)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.mid)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);if(s.sort((r,o)=>o.priority-r.priority),s.length>0){const r=s[0];return this.removeFromQueue(r),r}return null}handleCorrectAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayCorrectCount++,i.consecutiveCorrectStreak++,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!0,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.consecutiveCorrectStreak>=5&&i.dynamicThreshold>db&&(i.dynamicThreshold=Math.max(db,i.dynamicThreshold-KJ),i.lastThresholdAdjustment=Date.now(),console.log(`üìâ ÂãïÁöÑÈñæÂÄ§„Çí‰∏ã„Åí„Åæ„Åó„Åü: ${e} ‚Üí ${i.dynamicThreshold}Âõû`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),t==="immediate"&&this.shouldEnqueueEarly(e,i)?this.enqueueToEarly(e,a,c):t==="early"&&this.shouldEnqueueMid(e,i)?this.enqueueToMid(e,a,c):t==="mid"&&this.shouldEnqueueEnd(e,i)?this.enqueueToEnd(e,a,c):i.todayCorrectCount===1&&t==="immediate"&&this.enqueueToImmediate(e,a,c,1),this.isAcquisitionComplete(e,i)&&(i.isAcquisitionComplete=!0,console.log(`‚úÖ Ë®òÊÜ∂Áç≤ÂæóÂÆå‰∫Ü: ${e}`))}handleWrongAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayWrongCount++,i.consecutiveCorrectStreak=0,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!1,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.dynamicThreshold,i.dynamicThreshold=Math.min(HJ,i.dynamicThreshold+qJ),i.lastThresholdAdjustment=Date.now(),i.isAcquisitionComplete&&(i.isAcquisitionComplete=!1,console.log(`üîÑ Ë™§Á≠î„Å´„Çà„ÇäÂÆöÁùÄÂÆå‰∫Ü„Çí„É™„Çª„ÉÉ„Éà: ${e}`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),this.removeFromAllQueues(e),t!=="immediate"&&console.log(`‚ùå Ë™§Á≠î„Å´„Çà„ÇäÂç≥ÊôÇÂæ©Áøí„Ç≠„É•„Éº„Å´Êàª„Åó„Åæ„Åô: ${e}`),this.enqueueToImmediate(e,Math.min(a+1,5),c,1)}startSessionEndReview(){const e=[...this.queues.end];return e.length===0?(console.log("ÁµÇ‰∫ÜÊôÇÂæ©Áøí„Å™„Åó"),[]):(console.log(`ÁµÇ‰∫ÜÊôÇÂæ©Áøí„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºà${e.length}Ë™ûÔºâ`),e)}generateAcquisitionReport(){const e=Array.from(this.acquisitionProgress.keys()),t=[],s=[];for(const r of e)this.acquisitionProgress.get(r).isAcquisitionComplete?t.push(r):s.push(r);return{totalWords:e.length,completed:t.length,incomplete:s.length,completionRate:e.length>0?t.length/e.length:0,incompleteWords:s}}getQueueStatistics(){var e,t,s,r;return{immediate:{size:this.queues.immediate.length,oldestEntry:(e=this.queues.immediate[0])==null?void 0:e.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.immediate)},early:{size:this.queues.early.length,oldestEntry:(t=this.queues.early[0])==null?void 0:t.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.early)},mid:{size:this.queues.mid.length,oldestEntry:(s=this.queues.mid[0])==null?void 0:s.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.mid)},end:{size:this.queues.end.length,oldestEntry:(r=this.queues.end[0])==null?void 0:r.enqueuedAt,averageWaitTime:0}}}getAcquisitionProgress(e){if(!this.acquisitionProgress.has(e)){const t=this.findWordInQueues(e),s=(t==null?void 0:t.category)||"memorization",r=this.tabConfigs[s].consolidationThreshold;this.acquisitionProgress.set(e,{todayFirstSeen:Date.now(),todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:r,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:Date.now()})}return this.acquisitionProgress.get(e)}incrementQuestionNumber(){this.currentQuestionNumber++}reset(){this.queues={immediate:[],early:[],mid:[],end:[]},this.currentQuestionNumber=0,this.sessionStartTime=Date.now(),this.wordAttempts.clear(),this.acquisitionProgress.clear()}getQueueInfo(e){const t=this.findWordInQueues(e);return t?{queueType:t.queueType,questionNumber:t.targetQuestionNumber}:null}getQueueSizes(){return{immediate:this.queues.immediate.length,early:this.queues.early.length,mid:this.queues.mid.length,end:this.queues.end.length}}exportQueues(){return{immediate:[...this.queues.immediate],early:[...this.queues.early],mid:[...this.queues.mid],end:[...this.queues.end]}}clearQueues(){this.queues.immediate=[],this.queues.early=[],this.queues.mid=[],this.queues.end=[]}recordAnswer(e,t,s){const o=this.getAcquisitionProgress(e).currentQueue||"immediate";t?this.handleCorrectAnswer(e,o,s):this.handleWrongAnswer(e,o,s)}shouldEnqueueImmediate(e){return e>=3}shouldEnqueueEarly(e,t){return t.todayCorrectCount>=1}shouldEnqueueMid(e,t){return t.todayCorrectCount>=2}shouldEnqueueEnd(e,t){return t.todayCorrectCount>=3}calculateImmediateGap(e){return e>=4?1:e===3?2:3}calculateEarlyGap(e){return e>=4?5:e===3?7:10}calculateMidGap(e){return e>=4?20:e===3?25:30}isAcquisitionComplete(e,t){if(t.todayCorrectCount<t.dynamicThreshold)return!1;if(t.correctRate<hb)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}% < ${(hb*100).toFixed(0)}%`),!1;if(t.consecutiveCorrectStreak<Va)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): ÈÄ£Á∂öÊ≠£Á≠îÊï∞ ${t.consecutiveCorrectStreak} < ${Va}`),!1;const s=new Set(t.todayReviews.filter(i=>i.isCorrect).map(i=>i.queueType));if(s.size<3)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): „Ç≠„É•„ÉºÈÄöÈÅéÊï∞ ${s.size} < 3ÔºàÈñìÈöîÂèçÂæ©„Åå‰∏çË∂≥Ôºâ`),!1;if(t.totalAttempts<6)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Á∑èÂá∫È°åÂõûÊï∞ ${t.totalAttempts} < 6`),!1;const r=t.todayReviews.slice(-Va);return r.length>=Va&&r.every(i=>i.isCorrect)?(console.log(`‚úÖ ÂÆöÁùÄÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}%, ÈÄ£Á∂öÊ≠£Á≠î ${t.consecutiveCorrectStreak}, ÈñæÂÄ§ ${t.dynamicThreshold}, Á∑èÂá∫È°å ${t.totalAttempts}Âõû`),!0):(console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Áõ¥Ëøë${Va}Âõû„ÅåÂÖ®„Å¶Ê≠£Á≠î„Åß„ÅØ„Å™„ÅÑ`),!1)}isDuplicateInQueue(e,t){return this.queues[t].some(s=>s.word===e)}enqueueWithLimit(e,t,s){e.length>=s&&e.shift(),e.push(t)}removeFromQueue(e){const t=e.queueType,s=this.queues[t],r=s.findIndex(o=>o.word===e.word);r!==-1&&s.splice(r,1)}removeFromAllQueues(e){for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>s.word!==e)}findWordInQueues(e){for(const t of Object.keys(this.queues)){const s=this.queues[t].find(r=>r.word===e);if(s)return s}return null}cleanupExpiredEntries(){const e=Date.now();for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>e-s.enqueuedAt>GJ?(console.warn(`ÊúüÈôêÂàá„Çå„Ç®„É≥„Éà„É™„ÇíÂâäÈô§: ${s.word}`),!1):!0)}trackWordAttempts(e){this.wordAttempts.has(e)||this.wordAttempts.set(e,0);const t=this.wordAttempts.get(e)+1;this.wordAttempts.set(e,t);const s=this.getAcquisitionProgress(e);return t%50===0&&s.todayCorrectCount<s.dynamicThreshold&&(console.log(`üîÑ ÂçòË™û "${e}" „Çí${t}ÂõûÂá∫È°å„Åó„Åæ„Åó„ÅüÔºàÊ≠£Á≠îÁéá: ${(s.correctRate*100).toFixed(1)}%, ÈñæÂÄ§: ${s.dynamicThreshold}ÂõûÔºâ`),console.log("   ‚úÖ ÂÆöÁùÄ„Åæ„ÅßÁ∂ôÁ∂öÂá∫È°å„Åó„Åæ„ÅôÔºà‰∏çÊ≠£Ëß£„ÅåÁ∂ö„ÅèÈôê„ÇäÊ∞∏ÈÅ†„Å´Âá∫È°åÔºâ")),!0}calculateAverageWaitTime(e){if(e.length===0)return 0;const t=Date.now();return e.reduce((r,o)=>r+(t-o.enqueuedAt),0)/e.length}}const XJ={minEaseFactor:1.3,maxEaseFactor:2.5,easeFactorIncrement:.1,easeFactorDecrement:.2,initialInterval:1,forgettingCurveDecay:.5,confidenceWeight:.15};class JJ{constructor(e){Ee(this,"retentionData",new Map);Ee(this,"config");this.config={...XJ,...e}}getRetentionStatus(e){return this.retentionData.has(e)||this.retentionData.set(e,this.createInitialStatus()),this.retentionData.get(e)}recordReview(e,t){const s=this.getRetentionStatus(e);s.totalReviews++,s.lastReviewDate=t.timestamp,s.lastResponseTime=t.responseTime;const r=.3;return s.averageResponseTime=s.averageResponseTime*(1-r)+t.responseTime*r,t.isCorrect?(s.totalCorrect++,s.consecutiveCorrect++,s.consecutiveWrong=0,this.updateSM2OnCorrect(s,t.confidence)):(s.consecutiveCorrect=0,s.consecutiveWrong++,this.updateSM2OnWrong(s)),s.retentionRate=this.estimateRetentionRate(s),s.forgettingIndex=this.calculateForgettingIndex(s),s}getDueWords(e,t=Date.now()){const s=[];for(const r of e){const o=this.getRetentionStatus(r);if(t>=o.nextReviewDate){const a=(t-o.nextReviewDate)/864e5*o.forgettingIndex;s.push({word:r,priority:a})}}return s.sort((r,o)=>o.priority-r.priority),s.map(r=>r.word)}getReviewSchedule(e,t=7){const s=new Map,r=Date.now();for(const o of e){const i=this.getRetentionStatus(o),a=[];let c=i.nextReviewDate;const l=r+t*864e5;for(;c<=l;)a.push(new Date(c)),c+=i.sm2.interval*864e5;a.length>0&&s.set(o,a)}return s}getRetentionStatistics(e){const t=Date.now();let s=0,r=0,o=0,i=0,a=0,c=0;for(const d of e){const h=this.getRetentionStatus(d);s+=h.retentionRate,r+=h.sm2.easeFactor,o+=h.sm2.interval,t>=h.nextReviewDate&&(i++,(t-h.nextReviewDate)/864e5>1&&a++),h.consecutiveCorrect>=5&&h.sm2.interval>=30&&c++}const l=e.length||1;return{averageRetentionRate:s/l,averageEaseFactor:r/l,averageInterval:o/l,dueCount:i,overdueCount:a,wellLearnedCount:c}}estimateRetentionRate(e){const t=Date.now(),s=(t-e.lastReviewDate)/864e5,r=(e.nextReviewDate-t)/864e5;if(r>=0){const o=Math.exp(-this.config.forgettingCurveDecay*s/e.sm2.interval);return Math.max(.1,Math.min(1,o))}else{const o=-r,i=Math.exp(-this.config.forgettingCurveDecay*(s+o)/e.sm2.interval);return Math.max(.05,Math.min(.9,i))}}reset(){this.retentionData.clear()}importRetentionData(e){this.retentionData=new Map(e)}exportRetentionData(){return new Map(this.retentionData)}createInitialStatus(){return{lastReviewDate:Date.now(),nextReviewDate:Date.now()+this.config.initialInterval*864e5,sm2:{interval:this.config.initialInterval,repetition:0,easeFactor:2.5},retentionRate:1,forgettingIndex:1,totalReviews:0,totalCorrect:0,consecutiveCorrect:0,consecutiveWrong:0,averageResponseTime:0,lastResponseTime:0}}updateSM2OnCorrect(e,t){const s=e.sm2;s.repetition++;const r=this.mapConfidenceToQuality(t),o=s.easeFactor+(.1-(5-r)*(.08+(5-r)*.02));s.easeFactor=Math.max(this.config.minEaseFactor,Math.min(this.config.maxEaseFactor,o)),s.repetition===1?s.interval=1:s.repetition===2?s.interval=6:s.interval=Math.round(s.interval*s.easeFactor),e.lastResponseTime>3e3&&e.lastResponseTime>e.averageResponseTime*1.5&&(s.interval=Math.max(1,Math.round(s.interval*.8))),e.nextReviewDate=e.lastReviewDate+s.interval*864e5}updateSM2OnWrong(e){const t=e.sm2;t.repetition=0,t.easeFactor=Math.max(this.config.minEaseFactor,t.easeFactor-this.config.easeFactorDecrement),t.interval=1,e.nextReviewDate=e.lastReviewDate+t.interval*864e5}mapConfidenceToQuality(e){return Math.max(0,Math.min(5,e))}calculateForgettingIndex(e){const r=(e.totalReviews>0?1-e.totalCorrect/e.totalReviews:0)*2,o=e.averageResponseTime>2e3?(e.averageResponseTime-2e3)/5e3:0,i=Math.min(e.consecutiveWrong*.3,1.5),a=1+r+o+i;return Math.max(.5,Math.min(5,a))}}const YJ={minSampleSize:20,confidenceThreshold:.7,learningSpeedWindow:7,forgettingSpeedWindow:30},fb={learningSpeed:1,forgettingSpeed:1,consolidationThreshold:3,responseTimeProfile:{averageResponseTime:2e3,fastThreshold:1e3,slowThreshold:3e3,consistencyScore:.5},confidenceLevel:0,sampleSize:0,lastUpdated:Date.now()};class ZJ{constructor(e){Ee(this,"config");Ee(this,"parameters");Ee(this,"historyCache",[]);this.config={...YJ,...e},this.parameters={...fb}}addHistory(e){this.historyCache.push(e),this.historyCache.length>100&&this.historyCache.shift()}estimateParameters(e){const t=e||this.historyCache;return t.length<this.config.minSampleSize?(this.parameters.sampleSize=t.length,this.parameters.confidenceLevel=0,{...this.parameters}):(this.parameters.learningSpeed=this.estimateLearningSpeed(t),this.parameters.forgettingSpeed=this.estimateForgettingSpeed(t),this.parameters.consolidationThreshold=this.estimateConsolidationThreshold(t),this.parameters.responseTimeProfile=this.estimateResponseTimeProfile(t),this.parameters.confidenceLevel=this.calculateConfidenceLevel(t.length),this.parameters.sampleSize=t.length,this.parameters.lastUpdated=Date.now(),{...this.parameters})}getParameters(){return{...this.parameters}}importParameters(e){this.parameters={...e}}clearHistory(){this.historyCache=[]}estimateLearningSpeed(e){const t=new Map,s=new Map;for(const i of e){const a=i.word;t.has(a)||t.set(a,0),t.set(a,t.get(a)+1),i.isCorrect&&!s.has(a)&&s.set(a,t.get(a))}const r=Array.from(s.values());if(r.length===0)return 1;const o=r.reduce((i,a)=>i+a,0)/r.length;return o<=2?1.8:o<=2.5?1.5:o<=3.5?1:o<=5?.7:.5}estimateForgettingSpeed(e){const t=new Map,s=[];for(const o of e){const i=o.word;if(o.isCorrect)t.set(i,o.timestamp);else if(t.has(i)){const a=t.get(i),c=(o.timestamp-a)/864e5;s.push(c),t.delete(i)}}if(s.length===0)return 1;const r=s.reduce((o,i)=>o+i,0)/s.length;return r>=7?.6:r>=5?.8:r>=3?1:r>=1?1.5:2}estimateConsolidationThreshold(e){const t=new Map,s=new Map,r=[];for(const i of e){const a=i.word;if(t.has(a)||(t.set(a,0),s.set(a,0)),i.isCorrect){const c=t.get(a)+1;t.set(a,c);const l=Math.max(s.get(a),c);s.set(a,l),c===5&&r.push(this.getWordTotalReviews(a,e))}else t.set(a,0)}if(r.length===0)return 3;const o=r.reduce((i,a)=>i+a,0)/r.length;return Math.max(2,Math.min(5,Math.round(o*.6)))}estimateResponseTimeProfile(e){const t=e.map(d=>d.responseTime);if(t.length===0)return fb.responseTimeProfile;const s=t.reduce((d,h)=>d+h,0)/t.length,r=t.reduce((d,h)=>d+Math.pow(h-s,2),0)/t.length,o=Math.sqrt(r),i=Math.max(500,s-o),a=Math.min(5e3,s+o),c=o/s,l=Math.max(0,Math.min(1,1-c));return{averageResponseTime:Math.round(s),fastThreshold:Math.round(i),slowThreshold:Math.round(a),consistencyScore:Math.round(l*100)/100}}calculateConfidenceLevel(e){return e<this.config.minSampleSize?0:e<50?(e-this.config.minSampleSize)/(50-this.config.minSampleSize)*.7:e<100?.7+(e-50)/50*.2:.9+Math.min((e-100)/200*.1,.1)}getWordTotalReviews(e,t){return t.filter(s=>s.word===e).length}}const Nk={acquisitionRatio:.6,retentionRatio:.4,adaptiveAdjustment:!0,sessionQuestionNumber:0};class eY{constructor(e=Nk){Ee(this,"strategy");Ee(this,"personalParams",null);this.strategy={...e}}setPersonalParameters(e){this.personalParams=e}updateStrategy(e){this.strategy={...this.strategy,...e}}selectNextQuestion(e){if(e.length===0)return null;const t=e.map(r=>this.calculatePriority(r));t.sort((r,o)=>o.priority-r.priority);const s=t.find(r=>r.candidate.queueType!==void 0);return s?s.candidate:this.selectByStrategy(t)}calculatePriority(e){const t={queuePriority:this.calculateQueuePriority(e),phasePriority:this.calculatePhasePriority(e),timingPriority:this.calculateTimingPriority(e),personalPriority:this.calculatePersonalPriority(e)},s=Object.values(t).reduce((o,i)=>o+i,0),r=this.generatePriorityReason(e,t);return{candidate:e,priority:s,breakdown:t,reason:r}}calculateQueuePriority(e){if(!e.queueType)return 0;let s={[ec.IMMEDIATE]:40,[ec.EARLY]:30,[ec.MID]:20,[ec.END]:10}[e.queueType]||0;if(e.questionNumber!==void 0){const r=Math.max(0,5-e.questionNumber*.5);s+=r}return Math.min(40,s)}calculatePhasePriority(e){return{[Ki.ENCODING]:25,[Ki.INITIAL_CONSOLIDATION]:30,[Ki.INTRADAY_REVIEW]:20,[Ki.SHORT_TERM]:15,[Ki.LONG_TERM]:10}[e.phase]||0}calculateTimingPriority(e){const t=Date.now();if(e.reviewCount===0&&e.firstSeenTime){const o=(t-e.firstSeenTime)/1e3;return o>=600?15:o>=300?10:o>=120?7:o>=60?5:0}if(!e.nextReviewTime)return 15;const s=t-e.nextReviewTime;if(s>=0){const o=s/36e5;return Math.min(20,10+o*2)}const r=Math.abs(s)/(1e3*60*60);return r<=1?10-r*5:0}calculatePersonalPriority(e){if(!this.personalParams)return 5;let t=5;return e.reviewCount===0&&this.personalParams.learningSpeed<.8&&(t-=2),e.reviewCount===0&&this.personalParams.learningSpeed>1.2&&(t+=2),e.reviewCount>0&&this.personalParams.forgettingSpeed>1.2&&(t+=3),e.reviewCount>0&&this.personalParams.forgettingSpeed<.8&&(t-=2),Math.max(0,Math.min(10,t))}selectByStrategy(e){if(e.length===0)return null;const t=this.calculateAdaptiveBias(),s=e.map(c=>({...c,adjustedPriority:c.candidate.reviewCount===0?c.priority+t:c.priority})),r=s.filter(c=>c.adjustedPriority>=60),o=s.filter(c=>c.adjustedPriority>=30&&c.adjustedPriority<60),i=s.filter(c=>c.adjustedPriority<30),a=r.length>0?r:o.length>0?o:i;return a.length===0?null:(a.sort((c,l)=>{const d=l.adjustedPriority-c.adjustedPriority;if(Math.abs(d)>=5)return d;const h=c.candidate.lastReviewTime||c.candidate.firstSeenTime||0,f=l.candidate.lastReviewTime||l.candidate.firstSeenTime||0;return h===0&&f===0?c.candidate.word.localeCompare(l.candidate.word):h-f}),a[0].candidate)}hashString(e){let t=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}calculateAdaptiveBias(){if(!this.strategy.adaptiveAdjustment||this.strategy.sessionQuestionNumber===void 0)return 0;const e=this.strategy.sessionQuestionNumber;return e<=10?15:e<=20?10:e<=30?5:0}generatePriorityReason(e,t){const s=[];if(e.queueType&&s.push(`„Ç≠„É•„Éº: ${e.queueType}`),s.push(`„Éï„Çß„Éº„Ç∫: ${e.phase}`),e.nextReviewTime){const o=Date.now()-e.nextReviewTime,i=Math.abs(o/(1e3*60*60));o>=0?s.push(`ÈÅÖÂª∂: ${i.toFixed(1)}ÊôÇÈñì`):s.push(`‰∫àÂÆö„Åæ„Åß: ${i.toFixed(1)}ÊôÇÈñì`)}return e.reviewCount===0?s.push("Êñ∞Ë¶èÂçòË™û"):s.push(`Âæ©Áøí${e.reviewCount}ÂõûÁõÆ`),s.join(", ")}getAllPriorities(e){return e.map(t=>this.calculatePriority(t)).sort((t,s)=>s.priority-t.priority)}}function pb(n,e){return e?{word:n,reviewCount:e.correctCount+e.incorrectCount,correctCount:e.correctCount,wrongCount:e.incorrectCount,lastReviewTime:e.lastStudied||0,lastCorrectTime:e.consecutiveCorrect>0?e.lastStudied:0,averageResponseTime:e.averageResponseTime||0,consecutiveCorrect:e.consecutiveCorrect,consecutiveWrong:e.consecutiveIncorrect}:{word:n,reviewCount:0,correctCount:0,wrongCount:0,lastReviewTime:0,lastCorrectTime:0,averageResponseTime:0,consecutiveCorrect:0,consecutiveWrong:0}}function Qh(n=Fa.MEMORIZATION,e){const t=T.useRef(null),s=T.useRef(null),r=T.useRef(null),o=T.useRef(null),i=T.useRef(null),a=T.useRef(null),[c,l]=T.useState(0),[d,h]=T.useState({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}});T.useEffect(()=>{E.info("[useAdaptiveLearning] Initializing adaptive learning algorithms",{category:n,sessionId:e}),t.current=new VJ,s.current=new QJ,r.current=new JJ,o.current=new ZJ,i.current=new eY({...Nk,sessionQuestionNumber:0});try{localStorage.getItem(`adaptive-learning-queues-${n}`)&&s.current&&E.debug("[useAdaptiveLearning] Restored queues from localStorage")}catch(x){E.error("[useAdaptiveLearning] Failed to restore queues:",x)}try{if(o.current){const x=o.current.estimateParameters();h(y=>({...y,personalParams:x})),i.current&&i.current.setPersonalParameters(x),E.info("[useAdaptiveLearning] Personal parameters estimated:",x)}}catch(x){E.error("[useAdaptiveLearning] Failed to estimate personal parameters:",x)}return()=>{try{if(s.current){const x=s.current.exportQueues();localStorage.setItem(`adaptive-learning-queues-${n}`,JSON.stringify(x)),E.debug("[useAdaptiveLearning] Saved queues to localStorage")}}catch(x){E.error("[useAdaptiveLearning] Failed to save queues:",x)}}},[n,e]);const f=T.useCallback(x=>{if(!i.current||!t.current||!s.current)return E.warn("[useAdaptiveLearning] Algorithms not initialized"),x.length>0?x[0]:null;try{const y=x.map(v=>{const w=td(v.word),S=pb(v.word,w),I=t.current.detectPhase(v.word,S),C=s.current.getQueueInfo(v.word);return{id:v.word,word:v.word,category:n,phase:I,reviewCount:S.reviewCount,correctCount:S.correctCount,lastReviewTime:S.lastReviewTime||Date.now(),queueType:C==null?void 0:C.queueType,questionNumber:C==null?void 0:C.questionNumber,difficulty:parseInt(v.difficulty)||3}});i.current.updateStrategy({sessionQuestionNumber:c});const b=i.current.selectNextQuestion(y);if(b){const v=x.find(w=>w.word===b.word);return l(w=>w+1),h(w=>({...w,currentPhase:b.phase,sessionProgress:{totalQuestions:w.sessionProgress.totalQuestions+1,newWords:w.sessionProgress.newWords+(b.reviewCount===0?1:0),reviews:w.sessionProgress.reviews+(b.reviewCount>0?1:0)}})),E.debug("[useAdaptiveLearning] Selected question:",{word:b.word,phase:b.phase,queueType:b.queueType}),v||null}return null}catch(y){return E.error("[useAdaptiveLearning] Error selecting question:",y),x.length>0?x[0]:null}},[n,c]),p=T.useCallback((x,y,b)=>{try{const v=a.current??void 0;if(uX({word:x,previousWord:v,isCorrect:y}),a.current=x,t.current){const w=td(x),S=pb(x,w),I=t.current.detectPhase(x,S);h(C=>({...C,currentPhase:I}))}if(s.current){s.current.recordAnswer(x,y,b);const w=s.current.getQueueSizes();h(S=>({...S,queueSizes:w}))}if(r.current&&r.current.recordReview(x,{isCorrect:y,confidence:y?3:0,responseTime:b,timestamp:Date.now()}),o.current&&(o.current.addHistory({word:x,timestamp:Date.now(),isCorrect:y,responseTime:b,reviewNumber:1,daysSinceFirstSeen:0}),c>0&&c%20===0)){const w=o.current.estimateParameters();h(S=>({...S,personalParams:w})),i.current&&i.current.setPersonalParameters(w),E.info("[useAdaptiveLearning] Personal parameters updated:",w)}E.debug("[useAdaptiveLearning] Recorded answer:",{word:x,isCorrect:y,responseTime:b})}catch(v){E.error("[useAdaptiveLearning] Error recording answer:",v)}},[c]),m=T.useCallback(()=>{E.info("[useAdaptiveLearning] Resetting adaptive learning algorithms"),l(0),a.current=null,h({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}}),s.current&&s.current.clearQueues(),o.current&&o.current.clearHistory()},[]),g=T.useCallback(()=>{var x;return{sessionQuestionCount:c,state:d,queues:((x=s.current)==null?void 0:x.exportQueues())||null,personalParams:d.personalParams}},[c,d]);return{selectNextQuestion:f,recordAnswer:p,state:d,reset:m,getDebugInfo:g}}function tY({quizState:n,_categoryList:e,selectedCategory:t,onCategoryChange:s,selectedDifficulty:r,onDifficultyChange:o,selectedWordPhraseFilter:i="all",onWordPhraseFilterChange:a,selectedPhraseTypeFilter:c="all",onPhraseTypeFilterChange:l,selectedDataSource:d="all",onDataSourceChange:h,questionSets:f=[],onStartQuiz:p,onAnswer:m,onNext:g,onPrevious:x,onSkip:y,onDifficultyRate:b,onReviewFocus:v,sessionStats:w,isReviewFocusMode:S=!1,errorPrediction:I,customQuestionSets:C=[],onAddWordToCustomSet:k,onRemoveWordFromCustomSet:$,onOpenCustomSetManagement:N}){var O,q;const{questions:_,currentIndex:P,answered:j,selectedAnswer:A}=n,F=_.length>0,M=F?_[P]:null,[K,D]=T.useState(!1),[G,te]=T.useState(!1),[W,de]=T.useState(!1),[le,oe]=T.useState(Date.now()),[ge,Ae]=T.useState(void 0),[Ue,Pe]=T.useState(void 0),[Ne,Ye]=T.useState(0),[at,mt]=T.useState(0),wt=Qh(Fa.TRANSLATION),{learningLimit:kt,reviewLimit:dt,setLearningLimit:ue,setReviewLimit:xe}=ex("translation"),[Q,fe]=T.useState(()=>localStorage.getItem("autoNext")==="true"),[Z,Fe]=T.useState(()=>{const re=localStorage.getItem("autoNextDelay");return re?parseInt(re,10):1500}),[Ge,Le]=T.useState(()=>localStorage.getItem("autoShowDetails")!=="false"),ut=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:re}=await Yn(async()=>{const{resetAllProgress:ve}=await Promise.resolve().then(()=>ti);return{resetAllProgress:ve}},void 0);await re(),E.info("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(re){E.error("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",re),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},{getRequeuedWords:ye}=Ll(),Ve=()=>{de(!0)},lt=async(re,ve)=>{const be=re===ve;Ae(be),Pe(M==null?void 0:M.word),be?(Ye(ke=>ke+1),mt(0)):(mt(ke=>ke+1),Ye(0)),await m(re,ve),oe(Date.now()),M!=null&&M.word&&wt.recordAnswer(M.word,be,3e3),Q&&be&&setTimeout(()=>{Pe(void 0),g()},Z)},B=()=>{Pe(void 0),g()},L=async()=>{y&&(await y(),oe(Date.now()))},U=localStorage.getItem("learning-schedule-90days"),V=!!U;let ce=null;if(V)try{const re=JSON.parse(U),ve=Math.floor((Date.now()-re.startDate)/(1e3*60*60*24)),be=Math.min(ve+1,re.totalDays),ke=Math.round(be/re.totalDays*100);ce={currentDay:be,totalDays:re.totalDays,progressPercent:ke,phase:re.phase}}catch(re){E.error("Failed to parse learning plan:",re)}const ie=()=>{te(!G)};return G&&F&&M?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:ie,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4",children:u.jsx(rb,{question:M,questionNumber:P+1,allQuestions:_,currentIndex:P,answered:j,selectedAnswer:A,onAnswer:lt,onNext:y?j?B:L:B,onPrevious:x,onDifficultyRate:b,errorPrediction:I,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:$,onOpenCustomSetManagement:N,onFullscreen:ie})})]})}):u.jsxs("div",{className:"quiz-view",children:[V&&ce&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[ce.currentDay,"Êó•ÁõÆ / ",ce.totalDays,"Êó• (Phase ",ce.phase,") -"," ",ce.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),F&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Hh,{mode:"translation",currentScore:n.score,totalAnswered:n.totalAnswered,sessionCorrect:w==null?void 0:w.correct,sessionIncorrect:w==null?void 0:w.incorrect,sessionReview:w==null?void 0:w.review,sessionMastered:w==null?void 0:w.mastered,sessionStats:w,onReviewFocus:v,isReviewFocusMode:S,onShowSettings:()=>D(!0),currentWord:M==null?void 0:M.word,onAnswerTime:le,lastAnswerCorrect:ge,lastAnswerWord:Ue,lastAnswerDifficulty:M==null?void 0:M.difficulty,correctStreak:Ne,incorrectStreak:at,learningPhase:wt.state.currentPhase??void 0,estimatedSpeed:(O=wt.state.personalParams)==null?void 0:O.learningSpeed,dataSource:((q=f==null?void 0:f.find(re=>re.id===d))==null?void 0:q.name)||"ÂÖ®ÂïèÈ°åÈõÜ",onResetProgress:ut,onDebugRequeue:Ve,category:t==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":t,difficulty:r,wordPhraseFilter:i})})}),K&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),h&&f&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-quiz",children:"üìö Âá∫È°åÂÖÉ:"}),u.jsx("select",{id:"data-source-select-quiz",value:d,onChange:re=>h(re.target.value),className:"select-input",children:f.map(re=>u.jsx("option",{value:re.id,children:re.name},re.id))})]}),a&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-quiz",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-quiz",value:i,onChange:re=>a(re.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-quiz",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-quiz",value:t,onChange:re=>s(re.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),_k.map(re=>u.jsx("option",{value:re,children:re},re))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-quiz",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-quiz",value:r,onChange:re=>o(re.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),l&&i==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-quiz",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-quiz",value:c,onChange:re=>l(re.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsx(Z0,{learningLimit:kt,reviewLimit:dt,onLearningLimitChange:ue,onReviewLimitChange:xe,idPrefix:"quiz-"}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle",checked:Q,onChange:re=>{fe(re.target.checked),localStorage.setItem("autoNext",re.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",Q?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),Q&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay",min:"500",max:"3000",step:"100",value:Z,onChange:re=>{const ve=parseInt(re.target.value,10);Fe(ve),localStorage.setItem("autoNextDelay",ve.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(Z/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-toggle",checked:Ge,onChange:re=>{Le(re.target.checked),localStorage.setItem("autoShowDetails",re.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-show-details-toggle",className:"checkbox-label",children:["‰∏çÊ≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",Ge?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:ie,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),M&&u.jsx(u.Fragment,{children:u.jsx(rb,{question:M,questionNumber:P+1,allQuestions:_,currentIndex:P,answered:j,selectedAnswer:A,onAnswer:lt,onNext:y?j?B:L:B,onPrevious:x,onDifficultyRate:b,errorPrediction:I,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:$,onOpenCustomSetManagement:N})})]})})})]}),W&&u.jsx(Kh,{mode:"translation",currentIndex:P,totalQuestions:_.length,questions:_,requeuedWords:ye(_,P)})]})}function nY(n){const[e,t]=T.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""}),[s,r]=T.useState([]),[o,i]=T.useState([]),[a,c]=T.useState([]),[l,d]=T.useState(0),[h,f]=T.useState([]),p=T.useRef(0);return T.useEffect(()=>{n.length>0&&t({questions:n,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""})},[n]),T.useEffect(()=>{if(e.questions.length>0){const w=e.questions[e.currentIndex].word.toLowerCase();if(w.includes(" ")){const S=w.split(/\s+/);c(S),d(0),f([]);const C=[...S[0].split("")].sort(()=>Math.random()-.5);r(C),t(k=>({...k,correctWord:w.replace(/\s+/g,""),answered:!1}))}else{c([]),d(0),f([]);const I=[...w.split("")].sort(()=>Math.random()-.5);r(I),t(C=>({...C,correctWord:w,answered:!1}))}i([]),p.current=Date.now()}},[e.currentIndex,e.questions]),{spellingState:e,setSpellingState:t,shuffledLetters:s,selectedSequence:o,setSelectedSequence:i,phraseWords:a,currentWordIndex:l,completedWords:h,handleLetterClick:v=>{if(e.answered){if(o.includes(`${v}`))i(o.filter(S=>S!==`${v}`));else{const S=[...o,`${v}`];i(S)}return}if(o.includes(`${v}`))return;const w=[...o,`${v}`];return i(w),w.length===s.length?w:null},checkAnswer:v=>{const w=v.map(I=>s[parseInt(I)]).join(""),S=Date.now()-p.current;if(a.length>0){const I=a[l];if(w===I){const k=[...h,w];if(f(k),l<a.length-1){const $=l+1;d($);const _=[...a[$].split("")].sort(()=>Math.random()-.5);return r(_),i([]),{isPartialCorrect:!0,isComplete:!1,userWord:w,responseTime:S}}else{const $=k.join("");return{isPartialCorrect:!0,isComplete:!0,isCorrect:$===e.correctWord,userWord:$,responseTime:S}}}else return{isPartialCorrect:!1,isComplete:!0,isCorrect:!1,userWord:[...h,w].join(""),responseTime:S}}else return{isComplete:!0,isCorrect:w===e.correctWord,userWord:w,responseTime:S}},moveToNextQuestion:()=>{t(v=>({...v,currentIndex:v.currentIndex+1,answered:!1}))},updateScore:v=>{t(w=>({...w,score:v?w.score+1:w.score,totalAnswered:w.totalAnswered+1,answered:!0}))},resetAnswer:()=>{if(i([]),t(v=>({...v,answered:!1})),a.length>0){const w=[...a[l].split("")].sort(()=>Math.random()-.5);r(w)}else{const S=[...e.questions[e.currentIndex].word.toLowerCase().split("")].sort(()=>Math.random()-.5);r(S)}p.current=Date.now()}}}function sY(){const[n,e]=T.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0});return{sessionStats:n,setSessionStats:e,resetStats:()=>{e({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0})},updateStats:r=>{e(o=>({...o,correct:o.correct+(r==="correct"?1:0),incorrect:o.incorrect+(r==="incorrect"?1:0),review:o.review+(r==="review"?1:0),mastered:o.mastered+(r==="mastered"?1:0)}))}}}function rY({questions:n,questionSets:e,_categoryList:t,selectedCategory:s,onCategoryChange:r,selectedDifficulty:o,onDifficultyChange:i,selectedWordPhraseFilter:a="all",onWordPhraseFilterChange:c,selectedPhraseTypeFilter:l="all",onPhraseTypeFilterChange:d,selectedDataSource:h="all",onDataSourceChange:f,onStartQuiz:p,onReviewFocus:m,isReviewFocusMode:g=!1,customQuestionSets:x=[],onAddWordToCustomSet:y,onRemoveWordFromCustomSet:b,onOpenCustomSetManagement:v}){var Jt,St,Vt,tt;const{learningLimit:w,reviewLimit:S,setLearningLimit:I,setReviewLimit:C}=ex("spelling"),[k,$]=T.useState([]),{spellingState:N,setSpellingState:_,shuffledLetters:P,selectedSequence:j,setSelectedSequence:A,phraseWords:F,completedWords:M,handleLetterClick:K,checkAnswer:D,moveToNextQuestion:G,updateScore:te}=nY(k),{sessionStats:W,setSessionStats:de,resetStats:le,updateStats:oe}=sY(),ge=Qh(Fa.SPELLING),{processQuestion:Ae}=qh(),Ue=async($e,X)=>{try{const me=()=>{const _e=new Date().getHours();return _e<12?"morning":_e<18?"afternoon":_e<22?"evening":"night"},Be=()=>{const _e=N.questions[N.currentIndex];if(!_e)return .5;const Oe=(_e.grade||1)/9;return Math.min(Math.max(Oe,0),1)},nt=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(Oe=>!Oe.correct).length,Ct=()=>{const _e=sessionStorage.getItem("sessionStartTime");return _e?Math.floor((Date.now()-parseInt(_e))/6e4):0},st=()=>U,ht=await Ae($e,X?"correct":"incorrect",{currentDifficulty:Be(),timeOfDay:me(),recentErrors:nt(),sessionLength:Ct(),consecutiveCorrect:st()});console.log("[AdaptiveAI]",ht.reason,{strategy:ht.strategy,confidence:ht.confidence})}catch(me){console.error("[SpellingView] Adaptive AI error:",me)}},[Pe]=T.useState(()=>{const $e=new Ol;return localStorage.getItem("enable-ai-coordination")==="true"&&($e.enableAICoordination(!0),E.info("ü§ñ [SpellingView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),$e}),{reAddQuestion:Ne,clearExpiredFlags:Ye,updateRequeueStats:at,getRequeuedWords:mt,checkPositionMismatch:wt}=Ll(),[kt,dt]=T.useState(!1),[ue,xe]=T.useState(!1),[Q,fe]=T.useState(!1),[Z,Fe]=T.useState(Date.now()),[Ge,Le]=T.useState(0),[ut,ye]=T.useState(!1),[Ve,lt]=T.useState(void 0),[B,L]=T.useState(void 0),[U,V]=T.useState(0),[ce,ie]=T.useState(0),[O,q]=T.useState(()=>localStorage.getItem("autoNext")==="true"),[re,ve]=T.useState(()=>{const $e=localStorage.getItem("autoNextDelay");return $e?parseInt($e,10):1500}),be=T.useRef(null),ke=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:$e}=await Yn(async()=>{const{resetAllProgress:X}=await Promise.resolve().then(()=>ti);return{resetAllProgress:X}},void 0);await $e(),le(),V(0),ie(0),console.log("‚úÖ [„Çπ„Éö„É´„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch($e){console.error("‚ùå [„Çπ„Éö„É´„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",$e),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Ie=()=>{fe(!0)},Re=T.useRef(0),we=T.useRef(0),H=T.useRef([]);T.useEffect(()=>{(async()=>{if(n.length===0){$([]);return}Re.current=Date.now(),H.current=[],le();const X=await Pe.schedule({questions:n,mode:"spelling",limits:{learningLimit:w,reviewLimit:S},sessionStats:{correct:W.correct,incorrect:W.incorrect,still_learning:0,mastered:W.mastered||0,duration:Date.now()-Re.current},useMetaAI:!0,isReviewFocusMode:g||!1}),me=X.scheduledQuestions;X.vibrationScore>50&&E.warn("[SpellingView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:X.vibrationScore,processingTime:X.processingTime}),$(me),Le(0),ye(!1),E.log("[SpellingView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:me.length,vibrationScore:X.vibrationScore})})()},[n,w,S,g,Pe]),T.useEffect(()=>{if(!ut||N.questions.length===0)return;const $e=N.currentIndex;(async()=>{try{const me=N.questions.slice($e);if(me.length===0){ye(!1);return}E.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:Ge,currentIndex:$e,remaining:me.length});const Be=await Pe.schedule({questions:me,mode:"spelling",limits:{learningLimit:w,reviewLimit:S},sessionStats:{correct:W.correct,incorrect:W.incorrect,still_learning:0,mastered:W.mastered||0,duration:Date.now()-Re.current},useMetaAI:!0,isReviewFocusMode:g||!1});_(nt=>nt.currentIndex!==$e?nt:{...nt,questions:[...nt.questions.slice(0,$e),...Be.scheduledQuestions]}),Le(0),ye(!1),E.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:Be.scheduledQuestions.length})}catch(me){E.error("[SpellingView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",me),ye(!1)}})()},[ut,N.currentIndex,N.questions,Pe,w,S,W,g,Ge]),T.useEffect(()=>{if(!N.answered&&be.current){const $e=setTimeout(()=>{var X;(X=be.current)==null||X.focus()},100);return()=>clearTimeout($e)}},[N.answered,N.currentIndex,N.questions.length]);const Te=($e,X)=>{const me=K(X);me&&me.length===P.length&&setTimeout(()=>Me(me),300)},Me=async $e=>{const X=D($e);X&&(X.isPartialCorrect&&!X.isComplete||X.isComplete&&await Je(X.userWord,X.isCorrect||!1,X.responseTime))},Je=async($e,X,me)=>{var st;const Be=N.questions[N.currentIndex];lt(X),L(Be.word),X?(V(ht=>ht+1),ie(0)):(ie(ht=>ht+1),V(0));const nt=X?0:ce+1;if(!ut&&nt>=5&&ye(!0),Be){await No(Be.word,X,me,void 0,"spelling"),Fe(Date.now()),ge.recordAnswer(Be.word,X,me),await Ue(Be.word,X);const _e=(st=(await cs()).wordProgress)==null?void 0:st[Be.word];let Oe=X?"correct":"incorrect";_e&&_e.masteryLevel==="mastered"?Oe="mastered":!X&&_e&&_e.incorrectCount>=2&&(Oe="review"),oe(Oe),ba({status:Oe,word:Be.word,timestamp:Date.now()},"spelling"),_e&&_e.skippedCount&&_e.skippedCount>0&&(X?mk(Be.word):pk(Be.word))}!X&&Be&&H.current.push(Be.word);let Ct=N.questions;if(!X&&Be){const ht=Ne(Be,N.questions,N.currentIndex,"spelling");Ct=ht,ht!==N.questions&&_(_e=>({..._e,questions:ht}))}if(Le(ht=>{const _e=ht+1;return _e>=50?(ye(!0),0):(_e%10===0&&wt(Ct,"spelling").needsRescheduling&&ye(!0),_e)}),Be){const ht=String(Be.word);Br.onShown(ht),Br.onAnswer(ht,X),at(Be,W,de)}te(X),Be&&xc({id:yc(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:X?1:0,total:1,percentage:X?100:0,date:Date.now(),timeSpent:Math.floor(me/1e3),incorrectWords:X?[]:[Be.word],mode:"spelling"})},vt=()=>{const $e=N.currentIndex+1;if($e<N.questions.length){const X=Ye(N.questions,$e-1);X!==N.questions&&_(me=>({...me,questions:X}))}if($e>=N.questions.length&&!window.location.hostname.includes("github.io"))try{const X=Br.summarize();E.log("üß™ KPI Summary (spelling):",X)}catch{}L(void 0),$e<N.questions.length?G():_(X=>({...X,answered:!1}))},bt=async()=>{const $e=N.questions[N.currentIndex];if(!$e)return;if(N.answered){vt();return}const X=Date.now()-we.current;console.log("[SpellingView] SkipÂá¶ÁêÜÈñãÂßã:",{word:$e.word,responseTime:X,currentScore:N.score,totalAnswered:N.totalAnswered}),lt(!0),L($e.word),V(me=>me+1),ie(0),Vh($e.word,30),fk($e.word),await No($e.word,!0,X,void 0,"spelling"),Fe(Date.now()),A([]),_(me=>({...me,totalAnswered:me.totalAnswered+1,score:me.score+1,answered:!1})),oe("correct"),oe("mastered"),ba({status:"correct",word:$e.word,timestamp:Date.now()},"spelling"),console.log("[SpellingView] SkipÂá¶ÁêÜÂÆå‰∫Ü:",{word:$e.word,newScore:N.score+1,newTotalAnswered:N.totalAnswered+1}),xc({id:yc(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:1,total:1,percentage:100,date:Date.now(),timeSpent:Math.floor(X/1e3),incorrectWords:[],mode:"spelling",difficulty:$e.difficulty}),vt(),Le(me=>{const Be=me+1;return Be>=50?(ye(!0),0):(Be%10===0&&wt(N.questions,"spelling").needsRescheduling&&ye(!0),Be)})},He=()=>{A([]),_($e=>({...$e,currentIndex:$e.currentIndex>0?$e.currentIndex-1:0,answered:!1})),we.current=Date.now()},yt=()=>{if(j.length>0){const $e=j.slice(0,-1);A($e)}},Gt=N.questions.length>0,De=Gt?N.questions[N.currentIndex]:null,$t=j.map($e=>P[parseInt($e)]).join(""),Pt=De?{word:De.word,meaning:De.meaning,katakana:De.reading,source:"spelling"}:null,Xt=localStorage.getItem("learning-schedule-90days"),Zt=!!Xt;let jt=null;if(Zt)try{const $e=JSON.parse(Xt),X=Math.floor((Date.now()-$e.startDate)/(1e3*60*60*24)),me=Math.min(X+1,$e.totalDays),Be=Math.round(me/$e.totalDays*100);jt={currentDay:me,totalDays:$e.totalDays,progressPercent:Be,phase:$e.phase}}catch($e){E.error("Failed to parse learning plan:",$e)}return u.jsxs("div",{className:"spelling-view",children:[Zt&&jt&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[jt.currentDay,"Êó•ÁõÆ / ",jt.totalDays,"Êó• (Phase ",jt.phase,") -"," ",jt.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),!Gt&&u.jsx("div",{className:"quiz-controls",children:u.jsx("button",{onClick:p,className:"w-64 px-8 py-4 text-lg font-bold bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-xl:bg-primary-hover",children:"üéØ „ÇØ„Ç§„Ç∫ÈñãÂßã"})}),Gt?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Hh,{mode:"spelling",currentScore:N.score,totalAnswered:N.totalAnswered,sessionCorrect:W.correct,sessionIncorrect:W.incorrect,sessionReview:W.review,sessionMastered:W.mastered,sessionStats:W,onReviewFocus:m,isReviewFocusMode:g,onShowSettings:()=>dt(!0),onResetProgress:ke,onDebugRequeue:Ie,currentWord:(Jt=N.questions[N.currentIndex])==null?void 0:Jt.word,onAnswerTime:Z,lastAnswerCorrect:Ve,lastAnswerWord:B,lastAnswerDifficulty:(St=N.questions[N.currentIndex])==null?void 0:St.difficulty,correctStreak:U,incorrectStreak:ce,learningPhase:ge.state.currentPhase??void 0,estimatedSpeed:(Vt=ge.state.personalParams)==null?void 0:Vt.learningSpeed,dataSource:((tt=e==null?void 0:e.find($e=>$e.id===h))==null?void 0:tt.name)||"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà",category:s==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":s,difficulty:o,wordPhraseFilter:a})})}),kt&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>dt(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 text-sm shadow-sm:bg-gray-600:border-gray-500",children:"‚úï Èñâ„Åò„Çã"})]}),f&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-spelling",children:"üìö ÂïèÈ°åÈõÜ:"}),u.jsx("select",{id:"data-source-select-spelling",value:h,onChange:$e=>f($e.target.value),className:"select-input",children:e&&e.length>0?e.map($e=>u.jsx("option",{value:$e.id,children:$e.name},$e.id)):u.jsxs(u.Fragment,{children:[u.jsx("option",{value:"all",children:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà"}),u.jsx("option",{value:"intermediate",children:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ"}),u.jsx("option",{value:"junior",children:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö"})]})})]}),c&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-spelling",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-spelling",value:a,onChange:$e=>c($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-spelling",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-spelling",value:s,onChange:$e=>r($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),_k.map($e=>u.jsx("option",{value:$e,children:$e},$e))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-spelling",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-spelling",value:o,onChange:$e=>i($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),d&&a==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-spelling",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-spelling",value:l,onChange:$e=>{d&&d($e.target.value)},className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsx(Z0,{learningLimit:w,reviewLimit:S,onLearningLimitChange:I,onReviewLimitChange:C,idPrefix:"spelling-quiz-"})]}),De&&u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>xe(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row meaning-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:He,disabled:N.currentIndex===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"meaning-display",children:[u.jsxs("div",{className:"meaning-line",children:[u.jsx("span",{className:"text-xl text-gray-600",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"text-4xl font-bold text-gray-900 ml-2",children:De.meaning})]}),u.jsxs("div",{className:"meaning-meta",children:[De.difficulty&&u.jsx("div",{className:`difficulty-badge ${De.difficulty}`,children:De.difficulty==="beginner"?"ÂàùÁ¥ö":De.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),Pt&&y&&b&&v&&x&&u.jsx("div",{className:"mt-3 flex justify-center",children:u.jsx(ra,{word:Pt,sets:x,onAddWord:y,onRemoveWord:b,onOpenManagement:v,size:"medium",variant:"both"})}),De.word.includes(" ")&&u.jsxs("div",{className:"phrase-hint",children:["üí° ÁÜüË™û(",F.length,"Ë™û): ÂçòË™û„Åî„Å®„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",M.length>0&&u.jsxs("span",{className:"phrase-progress",children:[" ","(ÂÆåÊàê: ",M.join(" "),")"]})]})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:N.answered?vt:bt,disabled:N.currentIndex>=N.questions.length-1,title:N.answered?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó",children:"‚Üí"})]}),u.jsx("div",{className:"question-content-inline",children:u.jsxs("div",{className:"user-word-display",children:[u.jsx("div",{className:"user-word-label",children:"„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà:"}),u.jsx("div",{className:"user-word-text",children:F.length>0?u.jsxs(u.Fragment,{children:[M.join(" "),M.length>0&&" ",$t||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"]}):$t||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"})]})}),u.jsx("div",{className:"letter-cards",ref:be,tabIndex:0,onKeyDown:$e=>{if(N.answered)$e.key==="Enter"&&($e.preventDefault(),vt());else{const X=$e.key.toLowerCase();if(X.length===1&&X>="a"&&X<="z"){$e.preventDefault();const me=P.findIndex((Be,nt)=>Be===X&&!j.includes(`${nt}`));me!==-1&&Te(X,me)}else $e.key==="Backspace"?($e.preventDefault(),yt()):($e.key===" "||$e.key==="Enter")&&($e.preventDefault(),bt())}},children:P.map(($e,X)=>{const me=j.includes(`${X}`),Be=j.indexOf(`${X}`)+1;let nt="";return N.answered&&me&&(nt=j.map(ht=>P[parseInt(ht)]).join("")===N.correctWord?"correct":"incorrect"),u.jsxs("button",{className:`letter-card ${me?"selected":""} ${N.answered?"practice-mode":""} ${nt}`,onClick:()=>Te($e,X),children:[$e,me&&u.jsx("span",{className:"selection-number",children:Be})]},X)})}),!N.answered&&u.jsxs("div",{className:"spelling-reset-button-container",children:[j.length>0&&u.jsx("button",{className:"btn-reset-selection",onClick:yt,children:"‚å´ 1ÊñáÂ≠óÊàª„Åô"}),u.jsx("button",{className:"btn-skip-word",onClick:bt,children:"‚è≠Ô∏è ÂàÜ„Åã„Çâ„Å™„ÅÑ („Çπ„Éö„Éº„Çπ„Ç≠„Éº)"})]}),N.answered&&u.jsxs("div",{className:"result-display",children:[u.jsxs("div",{className:"correct-answer",children:[$t===N.correctWord?"‚úÖ Ê≠£Ëß£: ":$t===""?"‚è≠Ô∏è „Çπ„Ç≠„ÉÉ„Éó - Ê≠£Ëß£: ":"‚ùå ‰∏çÊ≠£Ëß£ - Ê≠£Ëß£: ",u.jsxs("strong",{className:xn()?"clickable-word":"",onClick:$e=>{$e.stopPropagation(),xn()&&De&&As(De.word,{rate:.85})},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":void 0,children:[(De==null?void 0:De.word)||N.correctWord,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"}),(De==null?void 0:De.reading)&&u.jsxs("span",{className:"pronunciation-hint",children:["(",De.reading,")"]})]})]}),u.jsxs("div",{className:"question-details-spelling",children:[De.reading&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>xn()&&As(De.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-content",children:De.reading})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-content",children:De.meaning})]}),De.etymology&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠âËß£Ë™¨:"}),u.jsx("span",{className:"detail-content",children:De.etymology})]}),De.relatedWords&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-content",children:De.relatedWords})]}),De.relatedFields&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsx("span",{className:"detail-content",children:De.relatedFields})]}),De.difficulty&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>xn()&&As(De.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("div",{className:`difficulty-badge ${De.difficulty}`,children:De.difficulty==="beginner"?"ÂàùÁ¥ö":De.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]})]})]})]})]}):u.jsx("div",{className:"empty-state",children:u.jsx("p",{children:"üìñ Êù°‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Äå„ÇØ„Ç§„Ç∫ÈñãÂßã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})}),Q&&u.jsx(Kh,{mode:"spelling",currentIndex:N.currentIndex,totalQuestions:N.questions.length,questions:N.questions,requeuedWords:mt(N.questions,N.currentIndex)})]})}function oY(n){const e=n.split("/").pop()||"",s=e.replace(/\.txt$/,"").split("_");return s.length>=3?s.slice(2).join("_"):e}const iY=[{id:"beginner-morning-routine",level:"beginner",topic:"daily-life",wordCount:50,filePath:"/data/passages-for-phrase-work/beginner_50_Morning-Routine.txt"},{id:"beginner-supermarket-shopping",level:"beginner",topic:"daily-life",wordCount:1910,filePath:"/data/passages-for-phrase-work/beginner_1910_Shopping-at-the-Supermarket.txt"},{id:"beginner-cafe-day",level:"beginner",topic:"food-culture",wordCount:1380,filePath:"/data/passages-for-phrase-work/beginner_1380_A-Day-at-the-Cafe.txt"},{id:"beginner-conversation-daily",level:"beginner",topic:"communication",wordCount:3018,filePath:"/data/passages-for-phrase-work/beginner_3018_Daily-Conversations.txt"},{id:"beginner-weather-seasons",level:"beginner",topic:"nature",wordCount:2111,filePath:"/data/passages-for-phrase-work/beginner_2111_Weather-and-Seasons.txt"},{id:"beginner-wildlife-park-guide",level:"beginner",topic:"animals",wordCount:2097,filePath:"/data/passages-for-phrase-work/beginner_2097_Wildlife-Park-Guide.txt"},{id:"intermediate-exchange-student-australia",level:"intermediate",topic:"culture-exchange",wordCount:3199,filePath:"/data/passages-for-phrase-work/intermediate_3199_Exchange-Student-in-Australia.txt"},{id:"intermediate-homestay-america",level:"intermediate",topic:"culture-exchange",wordCount:3148,filePath:"/data/passages-for-phrase-work/intermediate_3148_Homestay-in-America.txt"},{id:"intermediate-career-day",level:"intermediate",topic:"education-career",wordCount:2895,filePath:"/data/passages-for-phrase-work/intermediate_2895_Career-Day-at-School.txt"},{id:"intermediate-hospital-visit",level:"intermediate",topic:"health",wordCount:2721,filePath:"/data/passages-for-phrase-work/intermediate_2721_A-Visit-to-the-Hospital.txt"},{id:"intermediate-science-museum",level:"intermediate",topic:"science-education",wordCount:3265,filePath:"/data/passages-for-phrase-work/intermediate_3265_Science-Museum-Experience.txt"},{id:"intermediate-community-events",level:"intermediate",topic:"community",wordCount:2216,filePath:"/data/passages-for-phrase-work/intermediate_2216_Community-Events.txt"},{id:"intermediate-school-events-year",level:"intermediate",topic:"school-life",wordCount:2558,filePath:"/data/passages-for-phrase-work/intermediate_2558_A-Year-of-School-Events.txt"},{id:"intermediate-school-news",level:"intermediate",topic:"school-life",wordCount:1937,filePath:"/data/passages-for-phrase-work/intermediate_1937_School-News.txt"},{id:"advanced-environmental-issues",level:"advanced",topic:"environment",wordCount:4263,filePath:"/data/passages-for-phrase-work/advanced_4263_Environmental-Issues-and-Solutions.txt"},{id:"advanced-family-gathering",level:"advanced",topic:"culture-family",wordCount:4493,filePath:"/data/passages-for-phrase-work/advanced_4493_Family-Gathering-Traditions.txt"},{id:"advanced-health-statistics",level:"advanced",topic:"health-data",wordCount:3422,filePath:"/data/passages-for-phrase-work/advanced_3422_Health-Statistics-Analysis.txt"},{id:"advanced-historical-figures",level:"advanced",topic:"history",wordCount:3115,filePath:"/data/passages-for-phrase-work/advanced_3115_Historical-Figures-Study.txt"},{id:"advanced-international-exchange",level:"advanced",topic:"culture-global",wordCount:3813,filePath:"/data/passages-for-phrase-work/advanced_3813_Cultural-Exchange-Insights.txt"},{id:"advanced-school-festival",level:"advanced",topic:"school-events",wordCount:4419,filePath:"/data/passages-for-phrase-work/advanced_4419_School-Festival-Planning.txt"},{id:"advanced-summer-vacation-stories",level:"advanced",topic:"personal-growth",wordCount:3255,filePath:"/data/passages-for-phrase-work/advanced_3255_Summer-Vacation-Stories.txt"},{id:"advanced-technology-future",level:"advanced",topic:"technology-innovation",wordCount:3161,filePath:"/data/passages-for-phrase-work/advanced_3161_Technology-and-Future.txt"}],tx=iY.map(n=>({...n,title:oY(n.filePath),level:n.level}));function Ik(){return tx}async function kk(n){try{const e=tx.find(i=>i.id===n);if(!e)return E.error(`Passage not found: ${n}`),"";const s=`/data/passages-original/${e.filePath.split("/").pop()||""}`,r=await fetch(s);return r.ok?await r.text():(E.log(`Original file not found: ${s}`),"")}catch(e){return E.error(`Error loading original passage ${n}:`,e),""}}async function aY(n){const e=tx.find(t=>t.id===n);if(!e)return E.error(`Passage not found: ${n}`),null;try{const t=await fetch(e.filePath);if(!t.ok)throw new Error(`Failed to fetch: ${t.statusText}`);const s=await t.text(),r=cY(s);return{...e,content:s,sections:r}}catch(t){return E.error(`Error loading passage ${n}:`,t),null}}function cY(n){const e=n.split(`
`),t=[];let s=null;for(const r of e){const o=r.trim();o&&(!r.startsWith("    ")&&o.length>0&&o.length<80?(s&&t.push(s),s={title:o,paragraphs:[]}):r.startsWith("    ")&&s&&s.paragraphs.push(o))}return s&&t.push(s),t}function Bi(n){const e=n.toLowerCase().trim();if(e.endsWith("ing")&&e.length>4){const t=e.slice(0,-3);return t.endsWith("n")||t.endsWith("m")||t.endsWith("t")?t.slice(0,-1):t+"e"}if(e.endsWith("ed")&&e.length>3){const t=e.slice(0,-2);return t.endsWith("i")?t.slice(0,-1)+"y":t}return e.endsWith("es")&&e.length>3?e.slice(0,-2):e.endsWith("s")&&e.length>2&&!e.endsWith("ss")?e.slice(0,-1):e}async function $k(n){try{let e=`/data/passages/passages-translations/${n}-ja.txt`;console.log(`[ÂÖ®Ë®≥] Attempting to load: ${e} for passageId: ${n}`);let t=await fetch(e);if(t.ok||(e=`/data/passages-translations/${n}-ja.txt`,console.log(`[ÂÖ®Ë®≥] Trying old path: ${e}`),t=await fetch(e)),!t.ok)return console.log(`[ÂÖ®Ë®≥] File not found (${t.status}): ${e}`),"";const s=await t.text();return console.log(`[ÂÖ®Ë®≥] Successfully loaded ${s.length} characters from ${e}`),s}catch(e){return console.error(`[ÂÖ®Ë®≥] Error loading full translation for ${n}:`,e),""}}async function lY(n){try{const e=Ik().find(a=>a.id===n);if(!e)return[];const s=`/data/passages-for-phrase-work-ja/${(e.filePath.split("/").pop()||"").replace(/\.txt$/,"-ja.txt")}`,r=await fetch(s);if(!r.ok)return E.log(`No Japanese phrase file found: ${s}`),[];const i=(await r.text()).split(`
`).map(a=>a.trim()).filter(a=>a.length>0);return E.log(`Loaded ${i.length} Japanese phrases from ${s}`),i}catch(e){return E.error(`Error loading Japanese phrases for ${n}:`,e),[]}}async function uY(n,e){const t=await aY(n);if(!t)return null;const[s,r,o]=await Promise.all([lY(n),$k(n),kk(n)]);let i=0;const a=[];return t.sections.forEach(l=>{l.paragraphs.forEach(d=>{if(d.match(/^([^:]+):\s*"([^"]+)"$/)){const f=d.trim(),p=f.split(/\s+/),m=p.map(x=>{let y=x,b="";if(y.startsWith('"')&&(b='"',y=y.substring(1)),/^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\.$|^[A-Z]\.$|^vs\.$|^e\.g\.$|^i\.e\.$/.test(y)){const S=Bi(y.replace(/\.$/,"")),I=e.get(S),C=(I==null?void 0:I.meaning)||"",k=[];return b&&k.push({word:b,meaning:"",isUnknown:!1}),k.push({word:y,meaning:C==="-"?"":C,isUnknown:!1}),k}const w=y.match(/([.,!?;:‚Äî"])$/);if(w){const S=y.replace(/[.,!?;:‚Äî"]$/,""),I=w[1];if(!S){const _=[];return b&&_.push({word:b,meaning:"",isUnknown:!1}),_.push({word:I,meaning:"",isUnknown:!1}),_}const C=Bi(S),k=e.get(C),$=(k==null?void 0:k.meaning)||"",N=[];return b&&N.push({word:b,meaning:"",isUnknown:!1}),N.push({word:S,meaning:$==="-"?"":$,isUnknown:!1}),N.push({word:I,meaning:"",isUnknown:!1}),N}else{const S=Bi(y),I=e.get(S),C=(I==null?void 0:I.meaning)||"",k=[];return b&&k.push({word:b,meaning:"",isUnknown:!1}),k.push({word:y,meaning:C==="-"?"":C,isUnknown:!1}),k}}).flat(),g=s[i]||"";i++,a.push({english:f,japanese:g,phraseMeaning:g,words:p,segments:m})}else{const f=d.trim(),p=f.split(/\s+/),m=p.map(x=>{if(/^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\.$|^[A-Z]\.$|^vs\.$|^e\.g\.$|^i\.e\.$/.test(x)){const v=Bi(x.replace(/\.$/,"")),w=e.get(v),S=(w==null?void 0:w.meaning)||"";return{word:x,meaning:S==="-"?"":S,isUnknown:!1}}const b=x.match(/([.,!?;:‚Äî])$/);if(b){const v=x.replace(/[.,!?;:‚Äî]$/,""),w=b[1];if(!v)return{word:w,meaning:"",isUnknown:!1};const S=Bi(v),I=e.get(S),C=(I==null?void 0:I.meaning)||"";return[{word:v,meaning:C==="-"?"":C,isUnknown:!1},{word:w,meaning:"",isUnknown:!1}]}else{const v=Bi(x),w=e.get(v),S=(w==null?void 0:w.meaning)||"";return{word:x,meaning:S==="-"?"":S,isUnknown:!1}}}).flat(),g=s[i]||"";i++,a.push({english:f,japanese:g,phraseMeaning:g,words:p,segments:m})}})}),{id:t.id,title:t.title,level:t.level,actualWordCount:t.wordCount,phrases:a,translation:r,originalText:o}}async function dY(n){var e;try{const t=await fetch(`/data/passages-phrase-learning/${n}.json`);if(!t.ok)return E.log(`No phrase learning JSON found for ${n}, will use .txt conversion`),null;const s=await t.json();E.log(`Loaded phrase learning JSON for ${n}, phrases: ${((e=s.phrases)==null?void 0:e.length)||0}`);const[r,o]=await Promise.all([$k(n),kk(n)]);return{...s,phrases:s.phrases||[],translation:r,originalText:o}}catch{return E.log(`Skipping phrase learning JSON for ${n} (file may be old or moved), will use .txt conversion`),null}}async function hY(n){var s;const e=Ik(),t=[];E.log(`Loading ${e.length} passages...`);for(const r of e){let o=await dY(r.id);o||(o=await uY(r.id,n)),o?(E.log(`‚úì Loaded passage: ${r.id} (${((s=o.phrases)==null?void 0:s.length)||0} phrases)`),t.push(o)):E.error(`‚úó Failed to load passage: ${r.id}`)}return E.log(`Total passages loaded: ${t.length}`),t}const mb=new Set(["be","am","is","are","was","were","been","being","have","has","had","having","do","does","did","done","doing","can","could","will","would","shall","should","may","might","must","go","goes","went","gone","going","get","gets","got","gotten","getting","make","makes","made","making","take","takes","took","taken","taking","see","sees","saw","seen","seeing","come","comes","came","coming","want","wants","wanted","wanting","use","uses","used","using","find","finds","found","finding","give","gives","gave","given","giving","tell","tells","told","telling","work","works","worked","working","call","calls","called","calling","try","tries","tried","trying","ask","asks","asked","asking","need","needs","needed","needing","feel","feels","felt","feeling","become","becomes","became","becoming","leave","leaves","left","leaving","put","puts","putting","mean","means","meant","meaning","keep","keeps","kept","keeping","let","lets","letting","begin","begins","began","begun","beginning","seem","seems","seemed","seeming","help","helps","helped","helping","talk","talks","talked","talking","turn","turns","turned","turning","start","starts","started","starting","show","shows","showed","shown","showing","hear","hears","heard","hearing","play","plays","played","playing","run","runs","ran","running","move","moves","moved","moving","like","likes","liked","liking","live","lives","lived","living","believe","believes","believed","believing","bring","brings","brought","bringing","happen","happens","happened","happening","write","writes","wrote","written","writing","sit","sits","sat","sitting","stand","stands","stood","standing","lose","loses","lost","losing","pay","pays","paid","paying","meet","meets","met","meeting","include","includes","included","including","continue","continues","continued","continuing","set","sets","setting","learn","learns","learned","learning","change","changes","changed","changing","lead","leads","led","leading","understand","understands","understood","understanding","watch","watches","watched","watching","follow","follows","followed","following","stop","stops","stopped","stopping","create","creates","created","creating","speak","speaks","spoke","spoken","speaking","read","reads","reading","spend","spends","spent","spending","grow","grows","grew","grown","growing","open","opens","opened","opening","walk","walks","walked","walking","win","wins","won","winning","teach","teaches","taught","teaching","offer","offers","offered","offering","remember","remembers","remembered","remembering","consider","considers","considered","considering","appear","appears","appeared","appearing","buy","buys","bought","buying","serve","serves","served","serving","die","dies","died","dying","send","sends","sent","sending","build","builds","built","building","stay","stays","stayed","staying","fall","falls","fell","fallen","falling","cut","cuts","cutting","reach","reaches","reached","reaching","kill","kills","killed","killing","raise","raises","raised","raising","pass","passes","passed","passing","sell","sells","sold","selling","decide","decides","decided","deciding","return","returns","returned","returning","explain","explains","explained","explaining","hope","hopes","hoped","hoping","develop","develops","developed","developing","carry","carries","carried","carrying","break","breaks","broke","broken","breaking","receive","receives","received","receiving","agree","agrees","agreed","agreeing","support","supports","supported","supporting","hit","hits","hitting","produce","produces","produced","producing","eat","eats","ate","eaten","eating","cover","covers","covered","covering","catch","catches","caught","catching","draw","draws","drew","drawn","drawing","wake","wakes","woke","woken","waking","brush","brushes","brushed","brushing","wash","washes","washed","washing","prepare","prepares","prepared","preparing","check","checks","checked","checking"]),Ip=new Set(["in","on","at","to","for","with","from","by","about","as","into","like","through","after","over","between","out","against","during","without","before","under","around","among","of","up"]),fY=new Set(["and","but","or","so","yet","for","nor","because","although","if","when","while","since","unless","that","which","who","whom","whose","where"]),pY=new Set(["the","a","an","this","that","these","those","my","your","his","her","its","our","their","some","any","no","every","each","either","neither","much","many","more","most","few","little","several"]),gb=new Set(["i","you","he","she","it","we","they","me","him","her","us","them","myself","yourself","himself","herself","itself","ourselves","themselves"]),mY=new Set(["good","new","first","last","long","great","little","own","other","old","right","big","high","different","small","large","next","early","young","important","few","public","bad","same","able","ready","usual"]),gY=new Set(["not","so","up","out","just","now","how","then","more","also","here","well","only","very","even","back","there","down","still","in","as","too","when","never","really","usually","finally","first","after","before"]);function xY(n){return{S:"#3b82f6",V:"#ef4444",O:"#10b981",C:"#f59e0b",M:"#8b5cf6",Prep:"#6366f1",Conj:"#ec4899",Det:"#14b8a6",Adj:"#f97316",Adv:"#a855f7",Unknown:"#6b7280"}[n]}function yY(n){return{S:"‰∏ªË™û",V:"ÂãïË©û",O:"ÁõÆÁöÑË™û",C:"Ë£úË™û",M:"‰øÆÈ£æË™û",Prep:"ÂâçÁΩÆË©û",Conj:"Êé•Á∂öË©û",Det:"ÂÜ†Ë©û„ÉªÈôêÂÆöË©û",Adj:"ÂΩ¢ÂÆπË©û",Adv:"ÂâØË©û",Unknown:"‰∏çÊòé"}[n]}function bY(n,e,t){var r,o;const s=n.toLowerCase();if(/^[.,!?;:]$/.test(n))return"Unknown";if(mb.has(s))return"V";if(Ip.has(s))return"Prep";if(fY.has(s))return"Conj";if(pY.has(s))return"Det";if((s==="first"||s==="then"||s==="finally")&&e===0){let i=e+1;for(;i<t.length&&/^[.,!?;:]$/.test(t[i]);)i++;const a=(r=t[i])==null?void 0:r.toLowerCase();if(a&&gb.has(a))return"Adv"}return mY.has(s)?"Adj":gY.has(s)?"Adv":gb.has(s)?e===0||e>0&&mb.has((o=t[e+1])==null?void 0:o.toLowerCase())?"S":"O":"Unknown"}function wY(n){return{".":"Êñá„ÅÆÁµÇ„Çè„Çä",",":"Âå∫Âàá„Çä„ÉªÂàóÊåô","!":"ÊÑüÂòÜ„ÉªÂº∑Ë™ø","?":"ÁñëÂïè",";":"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",":":"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•","-":"Ë£úË∂≥Ë™¨Êòé„ÉªË®Ä„ÅÑÊèõ„Åà","‚Äî":"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•","‚Äì":"ÁØÑÂõ≤„ÉªÈñ¢‰øÇ",'"':"ÂºïÁî®","'":"ÂºïÁî®„ÉªÊâÄÊúâÊ†º","(":"Ë£úË∂≥ÊÉÖÂ†±„ÅÆÈñãÂßã",")":"Ë£úË∂≥ÊÉÖÂ†±„ÅÆÁµÇ‰∫Ü"}[n]||"Âè•Ë™≠ÁÇπ"}function ru(n){const e=n.match(/\b[\w']+\b|[.,!?;:\-‚Äî‚Äì"'()]/g)||[],t=[];let s=!1,r=!1,o=!1,i=null;const a=new Set(["be","am","is","are","was","were","been","being"]);for(let c=0;c<e.length;c++){const l=e[c];if(/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(l)){t.push({word:l,tag:"Unknown",color:"#6b7280",description:wY(l)});continue}let d=bY(l,c,e);d==="Unknown"&&(c===0&&/^[A-Z]/.test(l)&&!r?(d="S",r=!0):s&&r&&!o&&!(c>0&&Ip.has(e[c-1].toLowerCase()))?(d=i&&a.has(i)?"C":"O",o=!0):s&&r&&o&&c>0&&(e[c-1].toLowerCase()==="and"||e[c-1].toLowerCase()==="or")?d=i&&a.has(i)?"C":"O":(c>0&&Ip.has(e[c-1].toLowerCase()),d="M")),d==="V"&&(s=!0,i=l.toLowerCase(),o=!1),d==="S"&&(r=!0),(d==="O"||d==="C")&&(o=!0),t.push({word:l,tag:d,color:xY(d),description:yY(d)})}return t}const vY=[{words:["wake","up"],meaning:"Ëµ∑„Åç„Çã",type:"phrasal-verb"},{words:["get","up"],meaning:"Ëµ∑Â∫ä„Åô„Çã",type:"phrasal-verb"},{words:["brush","my","teeth"],meaning:"Ê≠Ø„ÇíÁ£®„Åè",type:"phrasal-verb"},{words:["wash","my","face"],meaning:"È°î„ÇíÊ¥ó„ÅÜ",type:"phrasal-verb"},{words:["have","breakfast"],meaning:"ÊúùÈ£ü„ÇíÈ£ü„Åπ„Çã",type:"phrasal-verb"},{words:["go","to","school"],meaning:"Â≠¶Ê†°„Å´Ë°å„Åè",type:"phrasal-verb"},{words:["come","back"],meaning:"Â∏∞„Å£„Å¶„Åè„Çã",type:"phrasal-verb"},{words:["come","home"],meaning:"Â∏∞ÂÆÖ„Åô„Çã",type:"phrasal-verb"},{words:["do","homework"],meaning:"ÂÆøÈ°å„Çí„Åô„Çã",type:"phrasal-verb"},{words:["go","to","bed"],meaning:"ÂØù„Çã",type:"phrasal-verb"},{words:["at","seven"],meaning:"7ÊôÇ„Å´",type:"time-expression"},{words:["in","the","morning"],meaning:"Êúù„Å´",type:"time-expression"},{words:["in","the","afternoon"],meaning:"ÂçàÂæå„Å´",type:"time-expression"},{words:["in","the","evening"],meaning:"Â§ïÊñπ„Å´",type:"time-expression"},{words:["at","night"],meaning:"Â§ú„Å´",type:"time-expression"},{words:["every","morning"],meaning:"ÊØéÊúù",type:"determiner-noun"},{words:["every","day"],meaning:"ÊØéÊó•",type:"determiner-noun"},{words:["every","night"],meaning:"ÊØéÊô©",type:"determiner-noun"},{words:["every","week"],meaning:"ÊØéÈÄ±",type:"determiner-noun"}];function ou(n){const e=[],t=n.map(s=>s.toLowerCase());for(const s of vY){const r=s.words.map(o=>o.toLowerCase());for(let o=0;o<=t.length-r.length;o++){let i=!0;for(let a=0;a<r.length;a++)if(t[o+a]!==r[a]){i=!1;break}i&&e.push({...s,words:n.slice(o,o+r.length)})}}return e}const SY=[{name:"too ~ to ...",meaning:"„Äú„Åô„Åé„Å¶...„Åß„Åç„Å™„ÅÑ",pattern:/\btoo\s+\w+\s+to\s+\w+/i,explanation:"„Äåtoo + ÂΩ¢ÂÆπË©û/ÂâØË©û + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Åé„Å¶...„Åß„Åç„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"so ~ that ...",meaning:"„Å®„Å¶„ÇÇ„Äú„Å™„ÅÆ„Åß...",pattern:/\bso\s+\w+\s+that\b/i,explanation:"„Äåso + ÂΩ¢ÂÆπË©û/ÂâØË©û + that ~„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Å®„Å¶„ÇÇ„Äú„Å™„ÅÆ„Åß...„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"so that ...",meaning:"„Äú„Åô„Çã„Åü„ÇÅ„Å´",pattern:/\bso\s+that\b/i,explanation:"„Äåso that ~„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åü„ÇÅ„Å´„Äç„Å®„ÅÑ„ÅÜÁõÆÁöÑ„ÇíË°®„Åô"},{name:"It is ~ for ... to",meaning:"...„Åå„Äú„Åô„Çã„ÅÆ„ÅØ",pattern:/\bit\s+is\s+\w+\s+for\s+\w+\s+to\b/i,explanation:"„ÄåIt is + ÂΩ¢ÂÆπË©û + for + ‰∫∫ + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå(‰∫∫)„Åå„Äú„Åô„Çã„ÅÆ„ÅØ...„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"It is ~ to ...",meaning:"„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†",pattern:/\bit\s+is\s+\w+\s+to\s+\w+/i,explanation:"„ÄåIt is + ÂΩ¢ÂÆπË©û + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"It is ~ that ...",meaning:"...„Å™„ÅÆ„ÅØ„Äú„Å† (Âº∑Ë™ø)",pattern:/\bit\s+is\s+\w+\s+that\b/i,explanation:"Âº∑Ë™øÊßãÊñá„ÄÇ„ÄåIt is ~ that ...„Äç„ÅÆÂΩ¢„Åß„ÄÅÁâπÂÆö„ÅÆÈÉ®ÂàÜ„ÇíÂº∑Ë™ø„Åô„Çã"},{name:"not only ~ but also ...",meaning:"„Äú„Å†„Åë„Åß„Å™„Åè...„ÇÇ",pattern:/\bnot\s+only\s+.+\s+but\s+also\b/i,explanation:"„Äånot only A but also B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„Å†„Åë„Åß„Å™„ÅèB„ÇÇ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"either ~ or ...",meaning:"„Äú„Åã...„Åã„Å©„Å°„Çâ„Åã",pattern:/\beither\s+.+\s+or\b/i,explanation:"„Äåeither A or B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÅãB„Åã„Å©„Å°„Çâ„Åã„Äç„Å®„ÅÑ„ÅÜÈÅ∏Êäû„ÇíË°®„Åô"},{name:"neither ~ nor ...",meaning:"„Äú„ÇÇ...„ÇÇ„Å™„ÅÑ",pattern:/\bneither\s+.+\s+nor\b/i,explanation:"„Äåneither A nor B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÇÇB„ÇÇ„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÂê¶ÂÆö„ÇíË°®„Åô"},{name:"both ~ and ...",meaning:"„Äú„ÇÇ...„ÇÇ‰∏°Êñπ",pattern:/\bboth\s+.+\s+and\b/i,explanation:"„Äåboth A and B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÇÇB„ÇÇ‰∏°Êñπ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"as ~ as ...",meaning:"...„Å®Âêå„Åò„Åè„Çâ„ÅÑ„Äú",pattern:/\bas\s+\w+\s+as\b/i,explanation:"„Äåas + ÂΩ¢ÂÆπË©û/ÂâØË©û + as ...„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå...„Å®Âêå„Åò„Åè„Çâ„ÅÑ„Äú„Äç„Å®„ÅÑ„ÅÜÂêåÁ≠âÊØîËºÉ"},{name:"not as ~ as ...",meaning:"...„Åª„Å©„Äú„Å™„ÅÑ",pattern:/\bnot\s+as\s+\w+\s+as\b/i,explanation:"„Äånot as + ÂΩ¢ÂÆπË©û/ÂâØË©û + as ...„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå...„Åª„Å©„Äú„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"one of the ~est",meaning:"ÊúÄ„ÇÇ„Äú„Å™„ÇÇ„ÅÆ„ÅÆ1„Å§",pattern:/\bone\s+of\s+the\s+\w+est\b/i,explanation:"„Äåone of the + ÊúÄ‰∏äÁ¥ö + Ë§áÊï∞ÂêçË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåÊúÄ„ÇÇ„Äú„Å™„ÇÇ„ÅÆ„ÅÆ1„Å§„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"make/let/have + ‰∫∫ + ÂãïË©û",meaning:"‰∫∫„Å´„Äú„Åï„Åõ„Çã",pattern:/\b(make|let|have|help)\s+\w+\s+\w+/i,explanation:"‰ΩøÂΩπÂãïË©û„ÅÆÊßãÊñá„ÄÇ„Äåmake/let/have + ‰∫∫ + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„Åß„Äå‰∫∫„Å´„Äú„Åï„Åõ„Çã„Äç"},{name:"be used to ~ing",meaning:"„Äú„Åô„Çã„Åì„Å®„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã",pattern:/\b(am|is|are|was|were)\s+used\s+to\s+\w+ing\b/i,explanation:"„Äåbe used to + ÂãïÂêçË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"used to + ÂãïË©û",meaning:"Êòî„ÅØ„Äú„Åó„Åü„ÇÇ„ÅÆ„Å†",pattern:/\bused\s+to\s+\w+/i,explanation:"„Äåused to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåÊòî„ÅØ„Äú„Åó„Åü„ÇÇ„ÅÆ„Å†„Äç„Å®„ÅÑ„ÅÜÈÅéÂéª„ÅÆÁøíÊÖ£„ÇíË°®„Åô"}];function CY(n){const e=[];for(const t of SY)t.pattern.test(n)&&e.push(t);return e}function xb(n){return{beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö",Advanced:"‰∏äÁ¥ö",ÂàùÁ¥ö:"ÂàùÁ¥ö",‰∏≠Á¥ö:"‰∏≠Á¥ö",‰∏äÁ¥ö:"‰∏äÁ¥ö"}[n]||n}function _f(n){return n.toLowerCase().replace(/[\s.,?!]+/g," ").trim()}function Ua(n){return/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(n)}function Vi(n){switch(n){case"S":return{text:"text-red-600",underline:"border-red-500"};case"V":return{text:"text-blue-600",underline:"border-blue-500"};case"O":return{text:"text-yellow-600",underline:"border-yellow-500"};case"C":return{text:"text-green-600",underline:"border-green-500"};case"M":default:return{text:"text-gray-400",underline:"border-gray-300"}}}function yb(n){return n?n.includes("‰∏ªË™û")?"S":n.includes("ÂãïË©û")?"V":n.includes("ÁõÆÁöÑË™û")?"O":n.includes("Ë£úË™û")?"C":"M":"M"}function bb(n){return n==="S"||n==="V"||n==="O"||n==="C"||n==="M"?n:"M"}const wb={"first i brush my teeth and wash my face":[{text:"First",label:"ÂâØË©û",underline:"word"},{text:"I",label:"‰∏ªË™û",underline:"word"},{text:"brush my teeth",label:"ÂãïË©ûÂè•",underline:"phrase"},{text:"and",label:"Êé•Á∂öË©û",underline:"word"},{text:"wash my face",label:"ÂãïË©ûÂè•",underline:"phrase"}]},NY={"i wake up at seven every morning":"ÁßÅ„ÅØÊØéÊúù7ÊôÇ„Å´Ëµ∑„Åç„Åæ„Åô„ÄÇ","first i brush my teeth and wash my face":"„Åæ„Åö„ÄÅÊ≠Ø„ÇíÁ£®„ÅÑ„Å¶È°î„ÇíÊ¥ó„ÅÑ„Åæ„Åô„ÄÇ","i check homework and put books inside":"ÁßÅ„ÅØÂÆøÈ°å„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÄÅÊú¨„Çí„Åã„Å∞„Çì„ÅÆ‰∏≠„Å´ÂÖ•„Çå„Åæ„Åô„ÄÇ"};function IY(n,e){const t=new Map,s=new Set,r=new Set;return e.forEach(o=>{var a,c;const i=o.words.length;if(!(i<=1))for(let l=0;l<=n.length-i;l++){if(r.has(l))continue;let d=!0;for(let h=0;h<i;h++)if(((a=n[l+h])==null?void 0:a.toLowerCase())!==((c=o.words[h])==null?void 0:c.toLowerCase())){d=!1;break}if(d){t.set(l,o);for(let h=0;h<i;h++)s.add(l+h);r.add(l);break}}}),{phrasalMap:t,phrasalWordIndices:s}}function Tk({onSaveUnknownWords:n,customQuestionSets:e=[],onAddWordToCustomSet:t,onRemoveWordFromCustomSet:s,onOpenCustomSetManagement:r}){var dt;const[o,i]=T.useState([]),[a,c]=T.useState(null),[l,d]=T.useState([]),[h,f]=T.useState([]),[p,m]=T.useState("all"),[g,x]=T.useState(null),[y,b]=T.useState(new Map),[v,w]=T.useState(new Map),[S,I]=T.useState(null),[C,k]=T.useState(!1),[$,N]=T.useState(!0),[_,P]=T.useState("reading"),[j,A]=T.useState(0),[F,M]=T.useState(!1),[K,D]=T.useState(!1),[G,te]=T.useState(null),[W,de]=T.useState(null),[le,oe]=T.useState(!1),[ge,Ae]=T.useState(!0);T.useEffect(()=>{if(o.length>0){const ue="reading-unknown-words-state";try{const xe=o.map(Q=>({id:Q.id,unknownWords:Q.phrases.flatMap((fe,Z)=>fe.segments.map((Fe,Ge)=>Fe.isUnknown?`${Z}-${Ge}`:null).filter(Boolean))}));localStorage.setItem(ue,JSON.stringify(xe))}catch(xe){E.warn("ÂàÜ„Åã„Çâ„Å™„ÅÑÂçòË™û„ÅÆÁä∂ÊÖã‰øùÂ≠ò„Å´Â§±Êïó:",xe)}}},[o]),T.useEffect(()=>{E.log("[Èï∑Êñá] ËæûÊõ∏„ÅÆË™≠„ÅøËæº„Åø„ÇíÈñãÂßã..."),fetch("/data/vocabulary/high-school-entrance-words.csv").then(ue=>{if(!ue.ok)throw new Error(`CSVË™≠„ÅøËæº„ÅøÂ§±Êïó: ${ue.status}`);return ue.text()}).then(ue=>{const xe=ue.split(`
`),Q=new Map;xe.slice(1).forEach(fe=>{if(!fe.trim())return;const Z=fe.split(",").map(Fe=>Fe.trim());if(Z.length>=7){const Fe=Z[0].toLowerCase().trim();Q.set(Fe,{word:Z[0],reading:Z[1],meaning:Z[2],etymology:Z[3],relatedWords:Z[4],relatedFields:Z[5],difficulty:Z[6]})}}),E.log(`[Èï∑Êñá] „É°„Ç§„É≥ËæûÊõ∏: ${Q.size}ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`),b(Q)}).catch(ue=>{}),fetch("/data/dictionaries/reading-passages-dictionary.json").then(ue=>{if(!ue.ok)throw new Error(`JSONË™≠„ÅøËæº„ÅøÂ§±Êïó: ${ue.status}`);return ue.json()}).then(ue=>{const xe=new Map;Object.entries(ue).forEach(([Q,fe])=>{xe.set(Q.toLowerCase(),fe)}),w(xe),E.log(`[Èï∑Êñá] Èï∑ÊñáË™≠Ëß£ËæûÊõ∏: ${xe.size}ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`)}).catch(ue=>{E.error("[Èï∑Êñá] Error loading reading dictionary:",ue)})},[]);const Ue=T.useCallback(ue=>{const xe=ue.toLowerCase().replace(/[.,!?;:"']/g,"").trim();if(y.has(xe)||v.has(xe))return xe;if(xe.endsWith("es")){const Q=xe.slice(0,-2);if(y.has(Q)||v.has(Q))return Q}if(xe.endsWith("s")){const Q=xe.slice(0,-1);if(y.has(Q)||v.has(Q))return Q}if(xe.endsWith("ed")){const Q=xe.slice(0,-2);if(y.has(Q)||v.has(Q))return Q;if(y.has(Q+"e")||v.has(Q+"e"))return Q+"e";if(Q.length>2&&Q[Q.length-1]===Q[Q.length-2]){const fe=Q.slice(0,-1);if(y.has(fe)||v.has(fe))return fe}}if(xe.endsWith("ing")){const Q=xe.slice(0,-3);if(y.has(Q)||v.has(Q))return Q;if(y.has(Q+"e")||v.has(Q+"e"))return Q+"e";if(Q.length>2&&Q[Q.length-1]===Q[Q.length-2]){const fe=Q.slice(0,-1);if(y.has(fe)||v.has(fe))return fe}}if(xe.endsWith("ly")){const Q=xe.slice(0,-2);if(y.has(Q)||v.has(Q))return Q}if(xe.endsWith("er")){const Q=xe.slice(0,-2);if(y.has(Q)||v.has(Q))return Q}if(xe.endsWith("est")){const Q=xe.slice(0,-3);if(y.has(Q)||v.has(Q))return Q}return xe},[y,v]),Pe=T.useCallback((ue,xe)=>{if(xe&&typeof xe=="string"&&xe.trim()&&xe!=="-")return xe;if(xe&&typeof xe=="object"&&"meaning"in xe&&typeof xe.meaning=="string")return xe.meaning;const Q=ue.toLowerCase();if(Q==="who")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„ÅØ";if(Q==="whom")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„Çí";if(Q==="which")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆÁâ©Á≠â„ÅØ„Éª„Çí";if(Q==="that")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„ÉªÁâ©Á≠â„ÅØ„Éª„Çí";const fe=Ue(ue),Z=y.get(fe),Fe=v.get(fe);return(Z==null?void 0:Z.meaning)||(Fe==null?void 0:Fe.meaning)||""},[Ue,y,v]);T.useEffect(()=>{const ue=setInterval(()=>{F&&!SJ()&&!CJ()&&(M(!1),D(!1))},500);return()=>clearInterval(ue)},[F]),T.useEffect(()=>{if(y.size===0){E.log("[Èï∑Êñá] ËæûÊõ∏„ÅÆË™≠„ÅøËæº„Åø„ÇíÂæÖÊ©ü‰∏≠...");return}E.log(`[Èï∑Êñá] „Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„ÇíÈñãÂßã... (ËæûÊõ∏: ${y.size}ÂçòË™û)`);try{localStorage.removeItem("reading-passages-data")}catch{}const ue="reading-unknown-words-state";let xe=[];try{const Q=localStorage.getItem(ue);Q&&(xe=JSON.parse(Q))}catch(Q){E.warn("[Èï∑Êñá] ‰øùÂ≠òÊ∏à„ÅøÈÄ≤Êçó„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Q)}Ae(!0),hY(y).then(Q=>{var fe,Z;if(Q&&Q.length>0){E.log(`[Èï∑Êñá] ${Q.length}‰ª∂„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);const Fe=Q.map(ut=>{const ye=xe.find(Ve=>Ve.id===ut.id);return ye!=null&&ye.unknownWords&&ye.unknownWords.length>0?{...ut,phrases:ut.phrases.map((Ve,lt)=>({...Ve,segments:Ve.segments.map((B,L)=>{var U;return{...B,isUnknown:((U=ye.unknownWords)==null?void 0:U.includes(`${lt}-${L}`))??!1}})}))}:ut}),Ge={ÂàùÁ¥ö:1,beginner:1,‰∏≠Á¥ö:2,intermediate:2,‰∏äÁ¥ö:3,advanced:3,Advanced:3},Le=Fe.sort((ut,ye)=>{const Ve=Ge[ut.level||""]||999,lt=Ge[ye.level||""]||999;if(Ve!==lt)return Ve-lt;const B=ut.actualWordCount||0,L=ye.actualWordCount||0;return B-L});i(Le),E.log(`[Èï∑Êñá] „Éë„ÉÉ„Çª„Éº„Ç∏„ÇíË®≠ÂÆöÂÆå‰∫Ü: ${Le.length}‰ª∂`),Le.length>0&&(c(Le[0].id),d(new Array(((fe=Le[0].phrases)==null?void 0:fe.length)||0).fill(!1)),f(new Array(((Z=Le[0].phrases)==null?void 0:Z.length)||0).fill(!1)),E.log(`[Èï∑Êñá] ÂàùÊúü„Éë„ÉÉ„Çª„Éº„Ç∏„ÇíÈÅ∏Êäû: ${Le[0].id}`)),Ae(!1)}else E.error("[Èï∑Êñá] loadAllPassagesAsReadingFormat„ÅåÁ©∫„ÅÆÈÖçÂàó„ÇíËøî„Åó„Åæ„Åó„Åü"),x("„Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºà„Éá„Éº„Çø„ÅåÁ©∫„Åß„ÅôÔºâ"),Ae(!1)}).catch(Q=>{E.error("[Èï∑Êñá] Error loading passages:",Q),x("„Éë„ÉÉ„Çª„Éº„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+Q.message),Ae(!1)})},[y]);const Ne=T.useMemo(()=>o.find(ue=>ue.id===a),[o,a]),Ye=T.useMemo(()=>{const ue=p==="all"?o:o.filter(Q=>Q.level===p),xe={ÂàùÁ¥ö:1,beginner:1,‰∏≠Á¥ö:2,intermediate:2,‰∏äÁ¥ö:3,advanced:3,Advanced:3};return ue.sort((Q,fe)=>{const Z=xe[Q.level||""]||999,Fe=xe[fe.level||""]||999;if(Z!==Fe)return Z-Fe;const Ge=Q.actualWordCount||0,Le=fe.actualWordCount||0;return Ge-Le})},[o,p]),at=T.useCallback(ue=>{var Q,fe;c(ue);const xe=o.find(Z=>Z.id===ue);xe&&(d(new Array(((Q=xe.phrases)==null?void 0:Q.length)||0).fill(!1)),f(new Array(((fe=xe.phrases)==null?void 0:fe.length)||0).fill(!1)),A(0))},[o]);T.useCallback((ue,xe)=>{if(xe.preventDefault(),xe.stopPropagation(),!Ne||!xn())return;const fe=Ne.phrases[ue].segments.filter(Fe=>Fe.word&&Fe.word.trim()!=="").map(Fe=>Fe.word).join(" ");As(fe,{rate:.85});const Z=xe.currentTarget;Z.classList.add("speaking"),setTimeout(()=>{Z.classList.remove("speaking")},600)},[Ne]);const mt=()=>{if(!Ne)return;const ue=[];if(Ne.phrases.forEach(xe=>{xe.segments.forEach(Q=>{Q.isUnknown&&Q.word.trim()!==""&&(ue.some(fe=>fe.word.toLowerCase()===Q.word.toLowerCase())||ue.push({word:Q.word,meaning:Q.meaning,reading:Q.reading||"",etymology:Q.etymology||"",relatedWords:Q.relatedWords||"",relatedFields:Q.relatedFields||"",difficulty:Q.difficulty||"intermediate"}))})}),ue.length===0){alert(`ÂàÜ„Åã„Çâ„Å™„ÅÑÂçòË™û„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
ÂçòË™û„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Éû„Éº„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);return}n&&n(ue),i(xe=>xe.map(Q=>Q.id===Ne.id?{...Q,phrases:Q.phrases.map(fe=>({...fe,segments:fe.segments.map(Z=>({...Z,isUnknown:!1}))}))}:Q)),alert(`${ue.length}ÂÄã„ÅÆÂçòË™û„Çí„Äå${Ne.title}„Äç„Åã„Çâ‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ`)},wt=()=>{Ne&&(i(ue=>ue.map(xe=>xe.id===Ne.id?{...xe,phrases:xe.phrases.map(Q=>({...Q,segments:Q.segments.map(fe=>({...fe,isUnknown:!1}))}))}:xe)),d(new Array(Ne.phrases.length).fill(!1)),f(new Array(Ne.phrases.length).fill(!1)))};if(g)return u.jsx("div",{className:"error-message",children:g});if(ge)return u.jsx("div",{className:"empty-container",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."});if(o.length===0)return u.jsx("div",{className:"empty-container",children:"„Éë„ÉÉ„Çª„Éº„Ç∏„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"});if(Ye.length===0)return u.jsxs("div",{className:"comprehensive-reading-view",children:[u.jsx("div",{className:"reading-header",children:u.jsxs("div",{className:"filter-controls",children:[u.jsx("label",{htmlFor:"difficulty-filter",children:"Èõ£ÊòìÂ∫¶: "}),u.jsxs("select",{id:"difficulty-filter",value:p,onChange:ue=>m(ue.target.value),title:"Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]})}),u.jsx("div",{className:"empty-container",children:"ÈÅ∏Êäû„Åó„ÅüÈõ£ÊòìÂ∫¶„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂà•„ÅÆÈõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]});const kt=((dt=Ne==null?void 0:Ne.phrases)==null?void 0:dt.reduce((ue,xe)=>ue+xe.segments.filter(Q=>Q.isUnknown).length,0))||0;return u.jsxs("div",{className:"comprehensive-reading-view",children:[!$&&C&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-filter",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-filter",value:p,onChange:ue=>m(ue.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"passage-select",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏:"}),u.jsx("select",{id:"passage-select",value:a||"",onChange:ue=>at(ue.target.value),className:"select-input",children:Ye.map(ue=>u.jsxs("option",{value:ue.id,children:[xb(ue.level||"beginner"),"_",ue.actualWordCount,"Ë™û_",ue.title]},ue.id))})]})]}),$&&u.jsxs("div",{className:"reading-sub-tabs grid grid-cols-6 gap-1 sm:gap-2",children:[u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${_==="reading"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("reading"),children:"üìñ Ë™≠Ëß£"}),u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${_==="fullText"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("fullText"),children:"üìÑ ÂÖ®Êñá"}),u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${_==="fullTranslation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("fullTranslation"),children:"üìù ÂÖ®Ë®≥"}),u.jsxs("button",{onClick:mt,className:"px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium bg-success text-white rounded-t-lg border-b-2 border-success transition-all duration-200 hover:bg-success-hover disabled:opacity-50 disabled:cursor-not-allowed:bg-success-hover",disabled:kt===0,title:"Êú™Áü•Ë™û„Çí‰øùÂ≠ò",children:["üíæ ‰øùÂ≠ò (",kt,")"]}),u.jsx("button",{onClick:wt,className:"px-4 py-2 text-sm font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md:bg-warning-hover",title:"„É™„Çª„ÉÉ„Éà",children:"üîÑ „É™„Çª„ÉÉ„Éà"}),u.jsx("button",{className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",onClick:()=>k(!C),title:"Â≠¶ÁøíË®≠ÂÆö„ÇíÈñã„Åè",children:"‚öôÔ∏è Â≠¶ÁøíË®≠ÂÆö"})]}),$&&C&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-filter-reading",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-filter-reading",value:p,onChange:ue=>m(ue.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"passage-select-reading",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏:"}),u.jsx("select",{id:"passage-select-reading",value:a||"",onChange:ue=>at(ue.target.value),className:"select-input",children:Ye.map(ue=>u.jsxs("option",{value:ue.id,children:[xb(ue.level||"beginner"),"_",ue.actualWordCount,"Ë™û_",ue.title]},ue.id))})]})]}),S&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"word-popup-overlay",onClick:()=>I(null)}),u.jsxs("div",{className:"word-popup","data-popup-x":S.x,"data-popup-y":S.y,children:[u.jsx("button",{className:"popup-close",onClick:()=>I(null),title:"Èñâ„Åò„Çã",children:"‚úï"}),u.jsx("div",{className:"popup-word",children:S.word}),S.reading&&u.jsx("div",{className:"popup-reading",children:S.reading}),u.jsx("div",{className:"popup-meaning",children:S.meaning}),S.etymology&&u.jsxs("div",{className:"popup-etymology",children:[u.jsx("strong",{children:"Ë™ûÊ∫ê:"})," ",S.etymology]}),S.relatedWords&&u.jsxs("div",{className:"popup-related",children:[u.jsx("strong",{children:"Èñ¢ÈÄ£Ë™û:"})," ",S.relatedWords]})]})]}),$&&Ne&&Ne.phrases&&Ne.phrases.length>0&&u.jsxs("div",{className:"passage-content",children:[u.jsx("h3",{className:"passage-title",children:Ne.title}),_==="reading"&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"reading-full-text-area",children:[u.jsx("h4",{className:"text-lg font-semibold mb-3",children:"üìñ ÂÖ®Êñá"}),u.jsx("div",{className:"full-text-content",children:(()=>{if(Ne.originalText){const xe=Ne.originalText.split(/([.!?])\s+/).filter(fe=>fe.trim()),Q=[];for(let fe=0;fe<xe.length;fe+=2){const Z=xe[fe],Fe=xe[fe+1]||"";Q.push((Z+Fe).trim())}return u.jsx("div",{className:"sentences-container",children:Q.map((fe,Z)=>u.jsxs("span",{className:`sentence-clickable ${G===Z?"selected-reading":""}`,onClick:()=>{te(Z);const Fe=ru(fe);de({text:fe,grammarAnalysis:Fe,showMeanings:!1})},children:[fe," "]},Z))})}if(Ne.title.toLowerCase().includes("conversation")){const xe=[];return Ne.phrases.forEach(Q=>{let fe=Q.segments.map(Z=>Z.word).join(" ").trim();!fe||fe==="-"||(fe=fe.replace(/\s+([.,!?;:"])/g,"$1"),xe.push(fe))}),u.jsx("div",{className:"sentences-container",children:xe.map((Q,fe)=>u.jsxs("span",{className:`sentence-clickable ${G===fe?"selected-reading":""}`,onClick:()=>{te(fe);const Z=ru(Q);de({text:Q,grammarAnalysis:Z,showMeanings:!1})},children:[Q," "]},fe))})}else{let xe="",Q=!0;Ne.phrases.forEach(Fe=>{Fe.segments.forEach(Ge=>{let Le=Ge.word.trim();Le&&Le!=="-"&&(/^[.,!?;:]$/.test(Le)?(xe+=Le,Q=/^[.!?]$/.test(Le)):(Le==='"'||Le==="'"||(Q&&Le.length>0&&(Le=Le.charAt(0).toUpperCase()+Le.slice(1),Q=!1),xe.length>0&&!xe.endsWith(" ")&&!xe.endsWith('"')&&!xe.endsWith("'")&&(xe+=" ")),xe+=Le))})}),xe=xe.replace(/\s+"/g,'"').replace(/\s+'/g,"'");const fe=xe.split(/([.!?])\s+/).filter(Fe=>Fe.trim()),Z=[];for(let Fe=0;Fe<fe.length;Fe+=2){const Ge=fe[Fe],Le=fe[Fe+1]||"";Z.push((Ge+Le).trim())}return u.jsx("div",{className:"sentences-container",children:Z.map((Fe,Ge)=>u.jsxs("span",{className:`sentence-clickable ${G===Ge?"selected-reading":""}`,onClick:()=>{te(Ge);const Le=ru(Fe);de({text:Fe,grammarAnalysis:Le,showMeanings:!1})},children:[Fe," "]},Ge))})}})()})]}),G!==null&&W&&u.jsxs("div",{className:"selected-sentence-analysis mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("h4",{className:"m-0 text-base font-semibold text-blue-700",children:"üìú Êñá„ÅÆË™≠Ëß£"}),u.jsxs("div",{className:"flex gap-1",children:[u.jsx("button",{className:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>As(W.text),title:"Áô∫Èü≥",children:"üîä"}),!1,u.jsx("button",{className:"px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",onClick:()=>de({...W,showMeanings:!W.showMeanings}),children:W.showMeanings?"ÊÑèÂë≥„ÇíÈö†„Åô":"ÊÑèÂë≥„ÇíË°®Á§∫"})]})]}),u.jsxs("div",{className:"grammar-structure mb-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üî§ ÊñáÊ≥ïÊßãÈÄ†"}),u.jsx("div",{className:"flex flex-wrap gap-1.5 text-sm",children:(()=>{const ue=_f(W.text),xe=wb[ue];if(xe)return xe.map((ye,Ve)=>u.jsx("div",{className:"inline-flex flex-col items-center",children:(()=>{const lt=yb(ye.label),B=Vi(lt);return u.jsxs(u.Fragment,{children:[u.jsx("span",{className:`font-medium text-base text-gray-900 border-b-2 ${B.underline}`,children:ye.text}),u.jsx("span",{className:`text-xs font-semibold mt-0.5 ${B.text}`,title:ye.label,children:lt})]})})()},Ve));const Q=W.grammarAnalysis,fe=Q.some(ye=>ye.word==="."),Z=Q.filter(ye=>!Ua(ye.word)),Fe=Z.map(ye=>bb(ye.tag));for(let ye=1;ye+1<Z.length;ye++){if(Z[ye].tag!=="Conj")continue;const Ve=Fe[ye-1],lt=Fe[ye+1];Ve===lt&&(Fe[ye]=Ve)}const Ge=Z.findIndex(ye=>ye.tag==="S");if(Ge>0)for(let ye=Ge-1;ye>=0;ye--){const Ve=Z[ye].tag;if(Ve==="Det"||Ve==="Adj")Fe[ye]="S";else break}const Le=Z.findIndex(ye=>ye.tag==="V");if(Le>=0){const ye=Z.findIndex((Ve,lt)=>lt>Le&&(Ve.tag==="O"||Ve.tag==="C"));if(ye>Le+1){const Ve=Z[ye].tag==="C"?"C":"O";for(let lt=ye-1;lt>Le;lt--){const B=Z[lt].tag;if(B==="Det"||B==="Adj")Fe[lt]=Ve;else break}}}const ut=[];for(let ye=0;ye<Z.length;ye++){const Ve=Fe[ye],lt=ye,B=[Z[ye].word];for(;ye+1<Z.length&&Fe[ye+1]===Ve;)B.push(Z[ye+1].word),ye++;const L=Vi(Ve),U=B.join(" ");ut.push(u.jsxs("div",{className:"inline-flex flex-col items-center",title:Ve==="S"?"‰∏ªË™û":Ve==="V"?"ÂãïË©û":Ve==="O"?"ÁõÆÁöÑË™û":Ve==="C"?"Ë£úË™û":"‰øÆÈ£æË™û",children:[u.jsx("span",{className:`font-medium text-base text-gray-900 border-b-2 ${L.underline}`,children:U}),u.jsx("span",{className:`text-xs font-semibold mt-0.5 ${L.text}`,children:Ve})]},`${lt}-${ye}-${Ve}`))}if(fe){const ye=Vi("M");ut.push(u.jsxs("div",{className:"inline-flex flex-col items-center",title:"„Éî„É™„Ç™„Éâ",children:[u.jsx("span",{className:`font-medium text-base text-gray-900 border-b-2 ${ye.underline}`,children:"."}),u.jsx("span",{className:`text-xs font-semibold mt-0.5 ${ye.text}`,children:"¬†"})]},"__period__"))}return ut})()})]}),W.showMeanings&&(()=>{var B;const ue=W.grammarAnalysis.filter(L=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(L.word)),xe={one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10",eleven:"11",twelve:"12"},Q=L=>{const U=L.join(" ").toLowerCase(),ce=ou(L).find(ie=>ie.words.length===L.length&&ie.words.every((O,q)=>{var re;return O.toLowerCase()===((re=L[q])==null?void 0:re.toLowerCase())}));if(ce!=null&&ce.meaning)return ce.meaning;if(U==="i")return"ÁßÅ„ÅØ";if(U==="wake up")return"Ëµ∑„Åç„Çã";if(U==="first")return"ÊúÄÂàù„Å´";if(U==="then")return"„Åù„Çå„Åã„Çâ";if(U==="finally")return"ÊúÄÂæå„Å´";if(L.length===2&&L[0].toLowerCase()==="at"){const ie=L[1].toLowerCase(),O=xe[ie]||(ie.match(/^\d+$/)?ie:"");if(O)return`${O}ÊôÇ„Å´`}return L.length===2&&L[0].toLowerCase()==="every"&&L[1].toLowerCase()==="morning"?"ÊØéÊúù":L.map(ie=>Pe(ie,void 0)).filter(ie=>ie&&ie!=="-").join(" ")},fe=ue.map(L=>L.word),Z=ou(fe),Fe=new Map,Ge=new Set;Z.forEach(L=>{let U=0;for(;U<fe.length;){const V=fe.slice(U).findIndex((ce,ie)=>L.words.every((O,q)=>{var re;return((re=fe[U+ie+q])==null?void 0:re.toLowerCase())===O.toLowerCase()}));if(V!==-1){const ce=U+V;Fe.set(ce,L),L.words.forEach((ie,O)=>Ge.add(ce+O));break}U++}});const Le=[];for(let L=0;L<ue.length;L++){if(Ge.has(L)&&!Fe.has(L))continue;const U=Fe.get(L);if(U){Le.push({words:U.words,meaning:((B=y.get(U.words.join(" ").toLowerCase()))==null?void 0:B.meaning)||Q(U.words)}),L+=U.words.length-1;continue}const V=ue[L].tag,ce=ue[L].word.toLowerCase();if(V==="Prep"&&L+1<ue.length){const ie=L+2<ue.length&&ue[L+1].tag==="Det"&&!Ua(ue[L+2].word)?[ue[L].word,ue[L+1].word,ue[L+2].word]:[ue[L].word,ue[L+1].word];Le.push({words:ie,meaning:Q(ie)}),L+=ie.length-1;continue}if(V==="Det"&&ce==="every"&&L+1<ue.length){const ie=[ue[L].word,ue[L+1].word];Le.push({words:ie,meaning:Q(ie)}),L+=1;continue}Le.push({words:[ue[L].word],meaning:Q([ue[L].word])})}const ut=W.text?_f(W.text):"",Ve={...NY}[ut]||(Le.every(L=>L.meaning&&L.meaning!=="-")?Le.map(L=>L.meaning).join(" "):"");return u.jsxs("div",{className:"mt-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üìù Áõ¥Ë®≥„Å®Êó•Êú¨Ë™ûË®≥"}),u.jsxs("div",{className:"flex items-start gap-2",children:[u.jsx("span",{"data-testid":"literal-translation-badge",className:"inline-flex items-center rounded bg-gray-200 text-gray-800 px-2 py-0.5 text-[10px] font-semibold whitespace-nowrap",children:"Áõ¥Ë®≥"}),u.jsx("div",{className:"flex flex-wrap gap-2 text-sm text-gray-800",children:Le.map((L,U)=>u.jsxs("div",{className:"inline-flex flex-col items-center",children:[u.jsx("span",{className:"font-medium border-b-2 border-gray-600",children:L.words.join(" ")}),L.meaning&&L.meaning!=="-"&&u.jsx("span",{className:"text-xs text-gray-700 mt-0.5",children:L.meaning})]},U))})]}),u.jsxs("div",{className:"mt-2 flex items-start gap-2",children:[u.jsx("span",{"data-testid":"japanese-translation-badge",className:"inline-flex items-center rounded bg-gray-200 text-gray-800 px-2 py-0.5 text-[10px] font-semibold whitespace-nowrap",children:"Êó•Êú¨Ë™ûË®≥"}),u.jsx("div",{className:"text-sm text-gray-800",children:Ve})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-600",children:"Ë®≥„ÅÆÂìÅË≥™: Áõ¥Ë®≥„ÅØË™ûÈ†ÜÂØæÂøú„ÇíÂÑ™ÂÖà„Åó„Å¶ÊÑèÂë≥„ÅÆÈ™®Ê†º„ÇíÊé¥„ÇÅ„Çã„Çà„ÅÜ„Å´„Åó„ÄÅÊó•Êú¨Ë™ûË®≥„ÅØËã±Ë™û„ÅÆ„Éã„É•„Ç¢„É≥„ÇπÔºàËá™ÁÑ∂„Å™ÊµÅ„Çå„ÉªÂê´ÊÑèÔºâ„Çí„Åß„Åç„Çã„Å†„ÅëÊ≠£Á¢∫„Å´‰øù„Å£„ÅüËá™ÁÑ∂„Å™Êó•Êú¨Ë™û„ÇíÂÑ™ÂÖà„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"})]})})(),W.showMeanings&&(()=>{const ue=W.grammarAnalysis.filter(ye=>!Ua(ye.word)),xe=ue.map(ye=>ye.word),Q=ou(xe),{phrasalMap:fe,phrasalWordIndices:Z}=IY(xe,Q),Fe={one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10",eleven:"11",twelve:"12"},Ge=ye=>{const Ve=ye.join(" ").toLowerCase(),B=ou(ye).find(L=>L.words.length===ye.length&&L.words.every((U,V)=>{var ce;return U.toLowerCase()===((ce=ye[V])==null?void 0:ce.toLowerCase())}));if(B!=null&&B.meaning)return B.meaning;if(Ve==="i")return"ÁßÅ„ÅØ";if(Ve==="wake up")return"Ëµ∑„Åç„Çã";if(Ve==="first")return"ÊúÄÂàù„Å´";if(Ve==="then")return"„Åù„Çå„Åã„Çâ";if(Ve==="finally")return"ÊúÄÂæå„Å´";if(ye.length===2&&ye[0].toLowerCase()==="at"){const L=ye[1].toLowerCase(),U=Fe[L]||(L.match(/^\d+$/)?L:"");if(U)return`${U}ÊôÇ„Å´`}return ye.length===2&&ye[0].toLowerCase()==="every"&&ye[1].toLowerCase()==="morning"?"ÊØéÊúù":ye.map(L=>Pe(L,void 0)).filter(L=>L&&L!=="-").join(" ")},Le=[];for(let ye=0;ye<ue.length;ye++){const Ve=ue[ye];if(Z.has(ye)&&!fe.has(ye))continue;const lt=fe.get(ye);if(lt){const L=lt.meaning||Ge(lt.words);Le.push({english:lt.words.join(" "),meaning:L,isPhrase:!0}),ye+=lt.words.length-1;continue}if(Ve.tag==="Prep"&&ye+1<ue.length){const L=ye+2<ue.length&&ue[ye+1].tag==="Det"&&!Ua(ue[ye+2].word)?[Ve.word,ue[ye+1].word,ue[ye+2].word]:[Ve.word,ue[ye+1].word];Le.push({english:L.join(" "),meaning:Ge(L),isPhrase:!0}),ye+=L.length-1;continue}if(Ve.tag==="Det"&&Ve.word.toLowerCase()==="every"&&ye+1<ue.length){const L=[Ve.word,ue[ye+1].word];Le.push({english:L.join(" "),meaning:Ge(L),isPhrase:!0}),ye+=1;continue}const B=Ge([Ve.word]);Le.push({english:Ve.word,meaning:B,isPhrase:!1})}const ut=Le.map((ye,Ve)=>u.jsxs("span",{className:"inline-flex items-baseline gap-2 whitespace-nowrap",children:[t&&s&&r?u.jsx(ra,{word:{word:ye.english,meaning:ye.meaning,source:"reading",sourceDetail:Ne==null?void 0:Ne.title},sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:"small",variant:"icon"}):u.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 bg-blue-500 text-white rounded-md text-base leading-none","aria-hidden":"true",title:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„ÉàÊ©üËÉΩ„ÅåÊú™Êé•Á∂ö„Åß„Åô",children:"+"}),u.jsx("span",{className:"font-medium text-gray-900",children:ye.english}),u.jsx("span",{className:"text-gray-800",children:ye.meaning})]},Ve));return u.jsxs("div",{className:"mt-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üìö ÂçòË™û„Å®ÁÜüË™û"}),u.jsx("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-sm",children:ut})]})})(),(()=>{const ue=CY(W.text);return ue.length===0?null:u.jsxs("div",{className:"mt-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üìê ÈáçË¶ÅÊßãÊñá"}),u.jsx("div",{className:"space-y-1",children:ue.map((xe,Q)=>u.jsxs("div",{className:"bg-green-50 p-2 rounded border border-green-200",children:[u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsx("span",{className:"font-semibold text-green-700",children:xe.name}),u.jsx("span",{className:"text-xs text-gray-600",children:xe.meaning})]}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["üí° ",xe.explanation]})]},Q))})]})})(),!1]})]}),_==="fullText"&&u.jsxs("div",{className:"full-text-display",children:[u.jsx("h3",{children:"üìÑ ÂÖ®Êñá"}),u.jsxs("div",{className:"full-text-controls",children:[u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-primary text-white border-2 border-primary rounded-lg transition-all duration-200 hover:bg-primary-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-primary-hover",onClick:()=>{const ue=Ne.phrases.map(xe=>xe.segments.map(fe=>fe.word).join(" ").replace(/^[A-Z][a-z]*(?:\s+\d+)?:\s*/,"").replace(/"/g,"")).join(" ").replace(/\s+([.,!?;:])/g,"$1");As(ue),M(!0),D(!1)},disabled:F&&!K,title:"ÂÖ®Êñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-warning-hover",onClick:()=>{K?(vJ(),D(!1)):(wJ(),D(!0))},disabled:!F,title:K?"Áô∫Èü≥„ÇíÂÜçÈñã":"Áô∫Èü≥„Çí‰∏ÄÊôÇÂÅúÊ≠¢",children:K?"‚ñ∂Ô∏è ÂÜçÈñã":"‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢"}),u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-error text-white border-2 border-error rounded-lg transition-all duration-200 hover:bg-error-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-error-hover",onClick:()=>{bJ(),M(!1),D(!1)},disabled:!F,title:"Áô∫Èü≥„ÇíÂÅúÊ≠¢",children:"‚èπÔ∏è ÂÅúÊ≠¢"})]}),u.jsx("div",{className:"full-text-content",children:(()=>{if(Ne.originalText)return u.jsx("div",{className:"paragraph-en",children:Ne.originalText});if(Ne.title.toLowerCase().includes("conversation")){const xe=[];return Ne.phrases.forEach(Q=>{let fe=Q.segments.map(Z=>Z.word).join(" ").trim();!fe||fe==="-"||(fe=fe.replace(/\s+([.,!?;:"])/g,"$1"),xe.push(fe))}),u.jsx("div",{children:xe.map((Q,fe)=>u.jsx("p",{className:"paragraph-en conversation-line",children:Q},fe))})}else{const Q=Ne.phrases[0].segments.map(U=>U.word).join(" ").trim(),fe=Q.length<100&&!/[.!?]$/.test(Q);let Z="",Fe=!0;Ne.phrases.forEach((U,V)=>{V===0&&fe||U.segments.forEach(ce=>{let ie=ce.word.trim();ie&&ie!=="-"&&(/^[.,!?;:]$/.test(ie)?(Z+=ie,Fe=/^[.!?]$/.test(ie)):(ie==='"'||ie==="'"||(Fe&&ie.length>0&&(ie=ie.charAt(0).toUpperCase()+ie.slice(1),Fe=!1),Z.length>0&&!Z.endsWith(" ")&&!Z.endsWith('"')&&!Z.endsWith("'")&&(Z+=" ")),Z+=ie))})}),Z=Z.replace(/\s+"/g,'"').replace(/\s+'/g,"'");const Ge=Z.split(/([.!?])\s+/).filter(U=>U.trim()),Le=[];for(let U=0;U<Ge.length;U+=2){const V=Ge[U],ce=Ge[U+1]||"";Le.push((V+ce).trim())}const ut=[];let ye=[],Ve=0;const lt=60;Le.forEach((U,V)=>{const ce=U.split(/\s+/).length;ye.push(U),Ve+=ce,(Ve>=lt||V===Le.length-1)&&(ut.push(ye.join(" ")),ye=[],Ve=0)}),ye.length>0&&ut.push(ye.join(" "));const B=Le,L=U=>{te(U);const V=B[U],ce=ru(V);de({text:V,grammarAnalysis:ce,showMeanings:!1})};return u.jsxs("div",{children:[u.jsx("div",{className:"sentences-container",children:B.map((U,V)=>u.jsxs("span",{className:`sentence-clickable ${G===V?"selected":""}`,onClick:()=>L(V),children:[U," "]},V))}),G!==null&&W&&u.jsxs("div",{className:"selected-sentence-analysis",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h4",{className:"m-0",children:"üìñ ÈÅ∏Êäû„Åó„ÅüÊñá„ÅÆË™≠Ëß£"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"px-3 py-1 text-sm bg-primary text-white rounded hover:bg-primary-hover",onClick:()=>As(W.text),title:"„Åì„ÅÆÊñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-3 py-1 text-sm bg-info text-white rounded hover:bg-info-hover",onClick:()=>de({...W,showMeanings:!W.showMeanings}),children:W.showMeanings?"ÊÑèÂë≥„ÇíÈö†„Åô":"ÊÑèÂë≥„ÇíË°®Á§∫"})]})]}),u.jsx("div",{className:"selected-sentence-text text-gray-900",children:W.text}),u.jsxs("div",{className:"grammar-structure mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üî§ ÊñáÊ≥ïÊßãÈÄ†:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{const U=_f(W.text),V=wb[U];if(V)return V.map((ke,Ie)=>u.jsx("div",{className:"inline-flex flex-col items-center",children:(()=>{const Re=yb(ke.label),we=Vi(Re);return u.jsxs(u.Fragment,{children:[u.jsx("span",{className:`font-medium text-base text-gray-900 border-b-2 ${we.underline}`,children:ke.text}),u.jsx("span",{className:`text-xs font-semibold mt-0.5 ${we.text}`,title:ke.label,children:Re})]})})()},Ie));const ce=W.grammarAnalysis,ie=ce.some(ke=>ke.word==="."),O=ce.filter(ke=>!Ua(ke.word)),q=O.map(ke=>bb(ke.tag));for(let ke=1;ke+1<O.length;ke++){if(O[ke].tag!=="Conj")continue;const Ie=q[ke-1],Re=q[ke+1];Ie===Re&&(q[ke]=Ie)}const re=O.findIndex(ke=>ke.tag==="S");if(re>0)for(let ke=re-1;ke>=0;ke--){const Ie=O[ke].tag;if(Ie==="Det"||Ie==="Adj")q[ke]="S";else break}const ve=O.findIndex(ke=>ke.tag==="V");if(ve>=0){const ke=O.findIndex((Ie,Re)=>Re>ve&&(Ie.tag==="O"||Ie.tag==="C"));if(ke>ve+1){const Ie=O[ke].tag==="C"?"C":"O";for(let Re=ke-1;Re>ve;Re--){const we=O[Re].tag;if(we==="Det"||we==="Adj")q[Re]=Ie;else break}}}const be=[];for(let ke=0;ke<O.length;ke++){const Ie=q[ke],Re=ke,we=[O[ke].word];for(;ke+1<O.length&&q[ke+1]===Ie;)we.push(O[ke+1].word),ke++;const H=Vi(Ie),Te=we.join(" ");be.push(u.jsxs("div",{className:"inline-flex flex-col items-center",title:Ie==="S"?"‰∏ªË™û":Ie==="V"?"ÂãïË©û":Ie==="O"?"ÁõÆÁöÑË™û":Ie==="C"?"Ë£úË™û":"‰øÆÈ£æË™û",children:[u.jsx("span",{className:`font-medium text-base text-gray-900 border-b-2 ${H.underline}`,children:Te}),u.jsx("span",{className:`text-xs font-semibold mt-0.5 ${H.text}`,children:Ie})]},`${Re}-${ke}-${Ie}`))}if(ie){const ke=Vi("M");be.push(u.jsxs("div",{className:"inline-flex flex-col items-center",title:"„Éî„É™„Ç™„Éâ",children:[u.jsx("span",{className:`font-medium text-base text-gray-900 border-b-2 ${ke.underline}`,children:"."}),u.jsx("span",{className:`text-xs font-semibold mt-0.5 ${ke.text}`,children:"¬†"})]},"__period__"))}return be})()})]})]})]})}})()})]}),_==="fullTranslation"&&u.jsx("div",{className:"full-translation-display",children:u.jsx("div",{className:"full-translation-content",children:(()=>{var xe;if(console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.id:",Ne.id),console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.translation exists:",!!Ne.translation),console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.translation length:",((xe=Ne.translation)==null?void 0:xe.length)||0),Ne.translation){const Q=Ne.translation.split(/\n+/).map(fe=>fe.trim()).filter(fe=>fe.length>0);return u.jsx("div",{className:"full-translation-text",children:Q.map((fe,Z)=>u.jsx("p",{className:"paragraph-ja",children:fe},Z))})}if(Ne.title.toLowerCase().includes("conversation")){const Q=[];return Ne.phrases.forEach(fe=>{let Z=fe.phraseMeaning||"";Z=Z.replace(/\[Ë¶Å‰øÆÊ≠£\]/g,"").trim(),!(!Z||Z==="-")&&Q.push(Z)}),Q.map((fe,Z)=>u.jsx("p",{className:"paragraph-ja conversation-line",children:fe},Z))}else{const Q=[];let fe="";Ne.phrases.forEach(Ge=>{let Le=Ge.phraseMeaning||"";if(Le){if(Le=Le.replace(/\[Ë¶Å‰øÆÊ≠£\]/g,"").trim(),!Le)return;const ut=Ge.segments.map(Ve=>Ve.word).join(" ").trim(),ye=/[.!?]$/.test(ut);/[„ÄÇÔºÅÔºü]$/.test(Le)?(fe+=Le,ye&&(Q.push(fe.trim()),fe="")):ye?(fe+=Le+"„ÄÇ",Q.push(fe.trim()),fe=""):fe+=Le+"„ÄÅ"}}),fe.trim()&&Q.push(fe.trim()+"„ÄÇ");const Z=[],Fe=4;for(let Ge=0;Ge<Q.length;Ge+=Fe){const Le=Q.slice(Ge,Ge+Fe);Z.push(Le.join(""))}return Z.map((Ge,Le)=>u.jsx("p",{className:"paragraph-ja",children:Ge},Le))}})()})})]}),u.jsx("style",{children:`
        .comprehensive-reading-view {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
          width: 100%;
        }

        @media (max-width: 768px) {
          .comprehensive-reading-view {
            max-width: 100%;
            margin: 0;
            padding: 8px;
          }
        }

        .reading-header {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-bottom: 20px;
        }

        .dark-mode .reading-header {
          background: var(--gray-800);
        }

        .reading-header h2 {
          margin: 0 0 20px 0;
        }

        .filter-controls, .passage-selector {
          margin-bottom: 15px;
        }

        .filter-controls label, .passage-selector label {
          font-weight: bold;
          margin-right: 10px;
          color: #333;
        }

        .dark-mode .filter-controls label,
        .dark-mode .passage-selector label {
          color: var(--gray-200);
        }

        .filter-controls select, .passage-selector select {
          padding: 8px 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
          background: white;
          color: #333;
        }

        .dark-mode .filter-controls select,
        .dark-mode .passage-selector select {
          background: var(--gray-700);
          border-color: var(--gray-600);
          color: var(--gray-200);
        }

        .passage-stats {
          display: flex;
          gap: 10px;
          margin: 15px 0;
          flex-wrap: wrap;
        }

        .stat-badge {
          display: inline-block;
          padding: 6px 12px;
          background: #f0f0f0;
          border-radius: 4px;
          font-size: 14px;
          color: #333;
        }

        .dark-mode .stat-badge {
          background: var(--gray-700);
          color: var(--gray-200);
        }

        .stat-badge.unknown-count {
          background: #fff3cd;
          color: #856404;
          font-weight: bold;
        }

        .dark-mode .stat-badge.unknown-count {
          background: var(--yellow-500);
          color: var(--black);
        }

        .action-buttons {
          display: flex;
          gap: 10px;
          margin-top: 15px;
        }

        .action-buttons button {
          padding: 10px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: bold;
          transition: all 0.3s;
        }

        .btn-primary {
          background: #007bff;
          color: white;
        }

        .btn-primary:hover {
          background: #0056b3;
        }

        .btn-info {
          background: #17a2b8;
          color: white;
        }

        .btn-info:hover {
          background: #138496;
        }

        .btn-success {
          background: #28a745;
          color: white;
        }

        .btn-success:hover {
          background: #218838;
        }

        .btn-success:disabled {
          background: #ccc;
          cursor: not-allowed;
        }

        .btn-secondary {
          background: #6c757d;
          color: white;
        }

        .btn-secondary:hover {
          background: #545b62;
        }

        .passage-content {
          background: white;
          padding: 30px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dark-mode .passage-content {
          background: var(--gray-800);
          color: var(--gray-100);
        }

        .passage-title {
          text-align: center;
          color: #333;
          margin-bottom: 30px;
          font-size: 24px;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .passage-title {
          color: var(--white);
        }

        .passage-body {
          line-height: 1.5;
          font-family: 'Times New Roman', Georgia, serif;
          color: #333;
        }

        .dark-mode .passage-body {
          color: var(--gray-200);
        }

        .phrase-block {
          margin-bottom: 8px;
          padding: 8px 12px;
          background: #ffffff;
          border-left: 3px solid #007bff;
          border-radius: 2px;
        }

        .dark-mode .phrase-block {
          background: var(--gray-700);
          border-left-color: var(--blue-400);
        }

        .phrase-english {
          font-size: 16px;
          line-height: 1.6;
          margin-bottom: 6px;
          font-family: 'Times New Roman', 'Georgia', serif;
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          align-items: flex-start;
        }

        .word-card {
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          padding: 2px 5px;
          margin: 1px;
          background: #f8f9fa;
          border: 1px solid #dee2e6;
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s;
          min-width: 60px;
        }

        .dark-mode .word-card {
          background: var(--gray-700);
          border-color: var(--gray-600);
        }

        .word-card:hover {
          background: #e7f3ff;
          border-color: #007bff;
        }

        .dark-mode .word-card:hover {
          background: var(--gray-600);
          border-color: var(--blue-400);
        }

        .word-card.unknown {
          background: #ffc107;
          color: #000;
          border-color: #ff9800;
          font-weight: bold;
        }

        .word-card.phrase-card {
          background: #e8f5e9;
          border-color: #4caf50;
        }

        .dark-mode .word-card.phrase-card {
          background: var(--gray-700);
          border-color: var(--green-400);
        }

        .word-card.phrase-card:hover {
          background: #c8e6c9;
        }

        .dark-mode .word-card.phrase-card:hover {
          background: var(--gray-600);
        }

        .word-card.punctuation-card {
          min-width: 20px;
          background: transparent;
          border: none;
          cursor: default;
          padding: 2px 4px;
        }

        .word-card.punctuation-card:hover {
          background: transparent;
          border: none;
        }

        .word-card-word {
          font-size: 16px;
          font-weight: 500;
          color: #333;
          text-align: center;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .word-card-word {
          color: var(--gray-200);
        }

        .phrase-card .word-card-word {
          font-size: 15px;
          color: #2e7d32;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .phrase-card .word-card-word {
          color: var(--green-400);
        }

        .word-card-meaning {
          font-size: 12px;
          color: #666;
          margin-top: 1px;
          text-align: center;
          padding: 1px 3px;
          background: rgba(255, 255, 255, 0.8);
          border-radius: 2px;
          min-height: 14px;
        }

        .dark-mode .word-card-meaning {
          color: var(--gray-300);
          background: rgba(48, 48, 48, 0.8);
        }

        .word-segment {
          display: inline-block;
          padding: 2px 4px;
          margin: 0 2px;
          cursor: pointer;
          border-radius: 3px;
          transition: all 0.2s;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .word-segment:hover {
          background: #e7f3ff;
        }

        .word-segment.unknown {
          background: #ffc107;
          color: #000;
          font-weight: bold;
        }

        .show-translation-btn {
          background: #f8f9fa;
          border: 1px solid #ddd;
          padding: 8px 16px;
          border-radius: 4px;
          cursor: pointer;
          color: #666;
          font-size: 14px;
        }

        .show-translation-btn:hover {
          background: #e9ecef;
        }

        .phrase-translation {
          margin-top: 10px;
          padding: 15px;
          background: white;
          border-radius: 4px;
          border: 1px solid #dee2e6;
        }

        .dark-mode .phrase-translation {
          background: var(--gray-800);
          border-color: var(--gray-600);
        }

        .translation-text {
          font-size: 16px;
          color: #333;
          margin-bottom: 10px;
          font-weight: 500;
        }

        .dark-mode .translation-text {
          color: var(--gray-200);
        }

        .word-meanings {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          font-size: 14px;
          color: #666;
        }

        .dark-mode .word-meanings {
          color: var(--gray-300);
        }

        .word-meaning-pair {
          background: #e7f3ff;
          padding: 4px 8px;
          border-radius: 3px;
        }

        .dark-mode .word-meaning-pair {
          background: var(--gray-700);
          color: var(--gray-200);
        }

        .error-message, .empty-container {
          text-align: center;
          padding: 50px;
          font-size: 18px;
          color: #666;
        }

        .dark-mode .error-message,
        .dark-mode .empty-container {
          color: var(--gray-300);
        }

        .error-message {
          color: #dc3545;
        }

        .dark-mode .error-message {
          color: var(--red-400);
        }

        /* ÂçòË™û„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Çπ„Çø„Ç§„É´ */
        .word-popup-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: transparent;
          z-index: 999;
        }

        .word-popup {
          position: absolute;
          left: var(--popup-x, 0);
          top: var(--popup-y, 0);
          background: white;
          border: 2px solid #007bff;
          border-radius: 8px;
          padding: 16px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          z-index: 1000;
          max-width: 400px;
          min-width: 250px;
        }

        .dark-mode .word-popup {
          background: var(--gray-800);
          border-color: var(--blue-400);
          color: var(--gray-200);
        }

        .popup-close {
          position: absolute;
          top: 8px;
          right: 8px;
          background: #f8f9fa;
          border: none;
          border-radius: 4px;
          width: 24px;
          height: 24px;
          cursor: pointer;
          font-size: 16px;
          line-height: 1;
          color: #666;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .popup-close:hover {
          background: #e9ecef;
          color: #000;
        }

        .popup-word {
          font-size: 20px;
          font-weight: bold;
          color: #007bff;
          margin-bottom: 4px;
          padding-right: 30px;
        }

        .popup-reading {
          font-size: 14px;
          color: #666;
          margin-bottom: 8px;
        }

        .popup-meaning {
          font-size: 16px;
          color: #333;
          margin-bottom: 12px;
          padding: 8px;
          background: #f0f8ff;
          border-radius: 4px;
        }

        .popup-etymology {
          font-size: 13px;
          color: #555;
          margin-bottom: 8px;
          padding: 6px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .popup-related {
          font-size: 13px;
          color: #555;
          padding: 6px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .popup-etymology strong,
        .popup-related strong {
          color: #007bff;
        }

        .full-text-display, .full-translation-display {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-top: 20px;
        }

        .dark-mode .full-text-display,
        .dark-mode .full-translation-display {
          background: var(--gray-800);
          color: var(--gray-100);
        }

        .full-text-display h3, .full-translation-display h3 {
          margin: 0 0 15px 0;
          color: #667eea;
        }

        .dark-mode .full-text-display h3,
        .dark-mode .full-translation-display h3 {
          color: var(--blue-400);
        }

        .full-text-content {
          font-size: 1.1em;
          line-height: 1.8;
          color: #333;
          font-family: 'Times New Roman', 'Georgia', serif;
        }

        .full-text-content .paragraph-en {
          margin-bottom: 1.5em;
          text-indent: 2em;
          text-align: left;
        }

        .full-text-content .paragraph-en:first-child {
          margin-top: 0;
        }

        /* ‰ºöË©±ÂΩ¢Âºè„ÅÆË°å„Çπ„Çø„Ç§„É´ */
        .full-text-content .conversation-line {
          text-indent: 0;
          margin-bottom: 1em;
          padding-left: 1em;
          border-left: 3px solid #667eea;
        }

        .full-translation-content {
          font-size: 1.05em;
          line-height: 2;
          color: #333;
        }

        .full-translation-text {
          white-space: pre-wrap;
          line-height: 2;
        }

        .full-translation-content .paragraph-ja {
          margin-bottom: 1.5em;
          text-indent: 1em;
          text-align: left;
        }

        .full-translation-content .paragraph-ja:first-child {
          margin-top: 0;
        }

        /* ‰ºöË©±ÂΩ¢Âºè„ÅÆÊó•Êú¨Ë™ûË®≥„Çπ„Çø„Ç§„É´ */
        .full-translation-content .conversation-line {
          text-indent: 0;
          margin-bottom: 1em;
          padding-left: 1em;
          border-left: 3px solid #667eea;
        }

        .translation-line {
          margin-bottom: 10px;
          padding: 8px;
          background: #f8f9fa;
          border-radius: 4px;
        }
      `})]})}const kY=Object.freeze(Object.defineProperty({__proto__:null,default:Tk},Symbol.toStringTag,{value:"Module"}));function $Y(n){if(!n)return null;const e=n.match(/[A-Za-z0-9]+(?:[‚Äô'][A-Za-z0-9]+)*(?:-[A-Za-z0-9]+(?:[‚Äô'][A-Za-z0-9]+)*)*|[.,!?;:()]/g);if(!e||e.length===0)return null;const t=[];for(const s of e){if(/[A-Za-z0-9]/.test(s)){t.push("____");continue}if(/^[.,!?;:]$/.test(s)){t.length===0?t.push(`____${s}`):t[t.length-1]=`${t[t.length-1]}${s}`;continue}if(s==="("){t.push("(");continue}if(s===")"){t.length===0?t.push(")"):t[t.length-1]=`${t[t.length-1]})`;continue}}return t.join(" ").replace(/\(\s+/g,"(").replace(/\s+\)/g,")").replace(/\s+([.,!?;:])/g,"$1").trim()}function Ak(n){var St,Vt,tt,$e;const[e,t]=T.useState(()=>localStorage.getItem("grammar-quiz-type")||"verb-form"),[s,r]=T.useState(()=>localStorage.getItem("grammar-grade")||"all"),[o,i]=T.useState([]),[a,c]=T.useState(!1),[l,d]=T.useState(!1),[h,f]=T.useState(!1),p=Qh(Fa.GRAMMAR),{processQuestion:m}=qh(),[g]=T.useState(()=>{const X=new Ol;return localStorage.getItem("enable-ai-coordination")==="true"&&(X.enableAICoordination(!0),E.info("ü§ñ [GrammarQuizView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),X}),{reAddQuestion:x,clearExpiredFlags:y,updateRequeueStats:b,getRequeuedWords:v,checkPositionMismatch:w}=Ll(),[S,I]=T.useState(Date.now()),[C,k]=T.useState(void 0),[$,N]=T.useState(void 0),[_,P]=T.useState(0),[j,A]=T.useState(0),{learningLimit:F,reviewLimit:M,setLearningLimit:K,setReviewLimit:D}=ex("grammar"),[G,te]=T.useState(!1),[W,de]=T.useState(0),[le,oe]=T.useState(!1),ge=()=>{te(!G)},Ae=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:X}=await Yn(async()=>{const{resetAllProgress:me}=await Promise.resolve().then(()=>ti);return{resetAllProgress:me}},void 0);await X(),ue(!1),Z([]),Ge(0),ut(null),Ve([]),B([]),U(""),ce(!1),O(!1),re(0),be(0),Ie({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),P(0),A(0),console.log("‚úÖ [ÊñáÊ≥ï„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(X){console.error("‚ùå [ÊñáÊ≥ï„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",X),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Ue=()=>{f(!0)},Pe=async(X,me)=>{try{const Be=Ct=>Ct.difficulty==="beginner"?.3:Ct.difficulty==="intermediate"?.6:Ct.difficulty==="advanced"?.9:.5,nt=()=>{const Ct=new Date().getHours();return Ct<12?"morning":Ct<18?"afternoon":Ct<22?"evening":"night"};await m(X,me?"correct":"incorrect",{currentDifficulty:Be(H),timeOfDay:nt(),recentErrors:ke.incorrect,sessionLength:Math.floor((Date.now()-yt.current)/6e4),consecutiveCorrect:_})}catch(Be){console.error("[GrammarQuizView] Adaptive AI error:",Be)}},[Ne,Ye]=T.useState(()=>localStorage.getItem("autoNext-grammar")==="true"),[at,mt]=T.useState(()=>{const X=localStorage.getItem("autoNextDelay-grammar");return X?parseInt(X,10):1500}),[wt,kt]=T.useState(()=>localStorage.getItem("autoReadAloud-grammar")==="true"),[dt,ue]=T.useState(!1),[xe,Q]=T.useState(!1),[fe,Z]=T.useState([]),[Fe,Ge]=T.useState(0),[Le,ut]=T.useState(null),[ye,Ve]=T.useState([]),[lt,B]=T.useState([]),[L,U]=T.useState(""),[V,ce]=T.useState(!1),[ie,O]=T.useState(!1),[q,re]=T.useState(0),[ve,be]=T.useState(0),[ke,Ie]=T.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[Re,we]=T.useState(null),H=fe[Fe],Te=(H==null?void 0:H.type)==="sentenceOrdering"||e==="sentence-ordering",Me=Te?(H==null?void 0:H.correctAnswer)||(H==null?void 0:H.correctOrder):void 0,Je=Te?$Y(Me):null,vt=Te&&typeof Me=="string"&&/[.,!?;:]/.test(Me)&&!!Je,bt=H!=null&&H.id?(()=>{const X=H.id.match(/^g(\d+)-u(\d+)/);if(X)return`g${X[1]}-unit${X[2]}`})():void 0,He=T.useRef({quizType:e,grade:s}),yt=T.useRef(Date.now()),Gt=T.useCallback(()=>{if(Fe<fe.length-1){const X=Fe+1,me=y(fe,X-1);me!==fe&&Z(me),Ge(X),ut(null),Ve([]),ce(!1),O(!1),yt.current=Date.now(),N(void 0)}},[Fe,fe]),De=T.useCallback(async()=>{var X,me;if(!xe){Q(!0),we(null);try{let Be=[],nt=null;if(s==="all")Be=["1","2","3"];else if(s.match(/^[123]$/))Be=[s];else if(s.endsWith("-all"))Be=[s.charAt(0)];else if(s.match(/^g\d+-unit\d+$/)){const Rt=(X=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:X[1],he=(me=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:me[2];Rt&&he!==void 0&&(Be=[Rt],nt=parseInt(he))}const Ct=[];for(const Rt of Be)for(let he=0;he<10;he++)if(!(nt!==null&&he!==nt))try{const We=await fetch(`/data/grammar/grammar_grade${Rt}_unit${he}.json`);if(We.ok){const Xe=await We.json();if(Xe.enabled===!1){E.log(`grammar_grade${Rt}_unit${he}.json is disabled: ${Xe.disabledReason||"No reason provided"}`);continue}Ct.push(Xe)}else E.log(`grammar_grade${Rt}_unit${he}.json returned status ${We.status}, skipping...`)}catch(We){E.log(`Failed to fetch grammar_grade${Rt}_unit${he}.json:`,We)}if(Ct.length===0)throw new Error(`ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºàÂ≠¶Âπ¥: ${s}, ÂΩ¢Âºè: ${e}Ôºâ`);const st=[];if(Ct.forEach(Rt=>{const he=Rt.questions||[],We={"verb-form":"verbForm","fill-in-blank":"fillInBlank","sentence-ordering":"sentenceOrdering"};if(e==="all"||e==="random")st.push(...he);else{const Xe=We[e]||e,Ot=he.filter(Ke=>Ke.type===Xe);st.push(...Ot)}}),st.length===0)throw new Error("ÈÅ∏Êäû„Åï„Çå„ÅüÊù°‰ª∂„Å´Ë©≤ÂΩì„Åô„ÇãÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");if(E.log(`Total questions: ${st.length}`),st.length===0)throw new Error("ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");const ht=Rt=>{if(Rt.word)return Rt.word;if(Rt.id)return`grammar_${Rt.id}`;if(Rt.question)return`grammar_${Rt.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const he=Rt.japanese||Rt.sentence||"unknown";return`grammar_${String(he).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`},_e=st.map(Rt=>({word:ht(Rt),meaning:Rt.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:Rt.difficulty||"beginner"})),Oe=await g.schedule({questions:_e,mode:"grammar",limits:{learningLimit:F,reviewLimit:M},sessionStats:{correct:ke.correct,incorrect:ke.incorrect,still_learning:ke.review||0,mastered:ke.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:G}),ot=new Map(st.map(Rt=>[ht(Rt),Rt])),Dt=Oe.scheduledQuestions.map(Rt=>{const he=ot.get(Rt.word);if(he)return{...he,word:Rt.word,position:Rt.position,finalPriority:Rt.finalPriority}}).filter(Rt=>Rt!==void 0);Oe.vibrationScore>50&&E.warn("[GrammarQuizView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:Oe.vibrationScore,processingTime:Oe.processingTime}),E.log("[GrammarQuizView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:Dt.length,vibrationScore:Oe.vibrationScore}),Z(Dt),Ge(0),ut(null),Ve([]),B([]),ce(!1),O(!1),re(0),be(0),Ie({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),de(0),oe(!1),ue(!0),Q(!1)}catch(Be){E.error("„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Be),we(Be instanceof Error?Be.message:String(Be)),Q(!1)}}},[e,s]);T.useEffect(()=>{if(!le||fe.length===0)return;const X=Fe,me=nt=>{if(nt.word)return nt.word;if(nt.id)return`grammar_${nt.id}`;if(nt.question)return`grammar_${nt.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const Ct=nt.japanese||nt.sentence||"unknown";return`grammar_${String(Ct).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`};(async()=>{try{const nt=fe.slice(X);if(nt.length===0){oe(!1);return}const Ct=nt.map(Oe=>({word:me(Oe),meaning:Oe.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:Oe.difficulty||"beginner"})),st=new Map(nt.map(Oe=>[me(Oe),Oe]));E.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:W,currentIndex:X,remaining:nt.length});const _e=(await g.schedule({questions:Ct,mode:"grammar",limits:{learningLimit:F,reviewLimit:M},sessionStats:{correct:ke.correct,incorrect:ke.incorrect,still_learning:ke.review||0,mastered:ke.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:G})).scheduledQuestions.map(Oe=>{const ot=st.get(Oe.word);if(ot)return{...ot,word:Oe.word,position:Oe.position,finalPriority:Oe.finalPriority}}).filter(Oe=>Oe!==void 0);Z(Oe=>Oe.length===0||Fe!==X?Oe:[...Oe.slice(0,X),..._e]),de(0),oe(!1),E.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:_e.length})}catch(nt){E.error("[GrammarQuizView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",nt),oe(!1)}})()},[le,fe,Fe,g,F,M,ke,G,W]);const $t=T.useCallback(async()=>{if(V)Gt();else{re(st=>st+1),be(st=>st+1),Ie(st=>({...st,correct:st.correct+1,mastered:st.mastered+1}));const X=Date.now()-yt.current,{updateWordProgress:me,addSessionHistory:Be}=await Yn(async()=>{const{updateWordProgress:st,addSessionHistory:ht}=await Promise.resolve().then(()=>ti);return{updateWordProgress:st,addSessionHistory:ht}},void 0),nt=H.id?`grammar_${H.id}`:H.question?`grammar_${H.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;if(await me(nt,!0,X,void 0,"grammar"),Be({status:"correct",word:nt,timestamp:Date.now()},"grammar"),I(Date.now()),Fe<fe.length-1)Ge(st=>st+1),ut(null),Ve([]),ce(!1),O(!1),yt.current=Date.now();else{if(!window.location.hostname.includes("github.io"))try{const st=Br.summarize();E.log("üß™ KPI Summary (grammar):",st)}catch{}ce(!1)}de(st=>{const ht=st+1;return ht>=50?(oe(!0),0):(ht%10===0&&w(fe,"grammar").needsRescheduling&&oe(!0),ht)})}},[V,Fe,fe,H,Gt,w]);T.useEffect(()=>{localStorage.setItem("grammar-quiz-type",e)},[e]),T.useEffect(()=>{localStorage.setItem("grammar-grade",s)},[s]),T.useEffect(()=>{(async()=>{const me=[],Be=s.match(/^g?(\d+)/),nt=Be?Be[1]:null;if(!nt||s==="all"){i([]);return}for(let Ct=0;Ct<10;Ct++)try{const st=await fetch(`/data/grammar/grammar_grade${nt}_unit${Ct}.json`);if(st.ok){const ht=await st.json();if(ht.enabled===!1)continue;me.push({value:`g${nt}-unit${Ct}`,label:`‰∏≠${nt}_Unit${Ct}_${ht.title}`})}}catch{}i(me)})()},[s,e]),T.useEffect(()=>{const X=He.current,me=X.quizType!==e||X.grade!==s;dt&&me&&De(),He.current={quizType:e,grade:s}},[e,s,dt,De]),T.useEffect(()=>{if(Te&&H&&H.words){const X=[...H.words].sort(()=>Math.random()-.5);B(X),Ve([]),ce(!1),O(!1)}},[Fe,fe,Te,H]),T.useEffect(()=>{ut(null),U(""),ce(!1),O(!1)},[Fe]),T.useEffect(()=>{const X=me=>{dt&&!V&&me.key==="Enter"&&(me.preventDefault(),$t())};return window.addEventListener("keydown",X),()=>{window.removeEventListener("keydown",X)}},[dt,V,$t]);const Pt=async X=>{var Ot;if(V||Te)return;ut(X),ce(!0);const me=X===H.correctAnswer,Be=X==="ÂàÜ„Åã„Çâ„Å™„ÅÑ";k(me),N(H.question||H.sentence),me?(P(Ke=>Ke+1),A(0)):(A(Ke=>Ke+1),P(0));const nt=me?0:j+1;!le&&nt>=5&&oe(!0),wt&&H.sentence&&setTimeout(()=>{const Ke=new SpeechSynthesisUtterance(H.sentence);Ke.lang="en-US",Ke.rate=.9,window.speechSynthesis.speak(Ke)},300),be(Ke=>Ke+1);const Ct=Date.now()-yt.current;if(me){re(Et=>Et+1);const Ke=H&&q>=2;Ie(Et=>({...Et,correct:Et.correct+1,mastered:Ke?Et.mastered+1:Et.mastered}))}else Ie(Be?Ke=>({...Ke,incorrect:Ke.incorrect+1,review:Ke.review+1}):Ke=>({...Ke,incorrect:Ke.incorrect+1}));const{updateWordProgress:st,loadProgress:ht,addSessionHistory:_e,addQuizResult:Oe}=await Yn(async()=>{const{updateWordProgress:Ke,loadProgress:Et,addSessionHistory:Cn,addQuizResult:Vs}=await Promise.resolve().then(()=>ti);return{updateWordProgress:Ke,loadProgress:Et,addSessionHistory:Cn,addQuizResult:Vs}},void 0),ot=H.id?`grammar_${H.id}`:H.question?`grammar_${H.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`,{generateId:Dt}=await Yn(async()=>{const{generateId:Ke}=await Promise.resolve().then(()=>EX);return{generateId:Ke}},void 0);await Oe({id:Dt(),questionSetId:"grammar-set",questionSetName:"ÊñáÊ≥ïÂïèÈ°å",score:me?1:0,total:1,percentage:me?100:0,date:Date.now(),timeSpent:Math.floor(Ct/1e3),incorrectWords:me?[]:[ot],mode:"grammar",category:void 0,difficulty:H.difficulty}),await st(ot,me,Ct,void 0,"grammar"),p.recordAnswer(ot,me,Ct),await Pe(ot,me);const he=(Ot=(await ht()).wordProgress)==null?void 0:Ot[ot];let We=me?"correct":"incorrect";he&&he.masteryLevel==="mastered"?We="mastered":!me&&he&&he.incorrectCount>=2&&(We="review"),_e({status:We,word:ot,timestamp:Date.now()},"grammar"),I(Date.now());let Xe=fe;if(!me&&H){const Ke=x(H,fe,Fe,"grammar");Xe=Ke,Ke!==fe&&Z(Ke)}de(Ke=>{const Et=Ke+1;return Et>=50?(oe(!0),0):(Et%10===0&&w(Xe,"grammar").needsRescheduling&&oe(!0),Et)});{const Ke=String(H.word);Br.onShown(Ke),Br.onAnswer(Ke,me)}b(H,ke,Ie)},Xt=(X,me)=>{V||!Te||(me?(B(Be=>Be.filter(nt=>nt!==X)),Ve(Be=>{var Ct;const nt=[...Be,X];return nt.length===((Ct=H.words)==null?void 0:Ct.length)&&!V&&setTimeout(async()=>{var Ke;ce(!0);const st=nt.join(" "),ht=(H.correctAnswer||H.correctOrder||H.sentence||"").replace(/[.!?]/g,"").trim(),_e=st.toLowerCase()===ht.toLowerCase();be(Et=>Et+1);const Oe=Date.now()-yt.current;if(wt&&setTimeout(()=>{const Et=new SpeechSynthesisUtterance(ht);Et.lang="en-US",Et.rate=.9,window.speechSynthesis.speak(Et)},300),_e){re(Cn=>Cn+1);const Et=q>=2;Ie(Cn=>({...Cn,correct:Cn.correct+1,mastered:Et?Cn.mastered+1:Cn.mastered}))}else Ie(Et=>({...Et,incorrect:Et.incorrect+1}));const{updateWordProgress:ot,loadProgress:Dt,addSessionHistory:Rt}=await Yn(async()=>{const{updateWordProgress:Et,loadProgress:Cn,addSessionHistory:Vs}=await Promise.resolve().then(()=>ti);return{updateWordProgress:Et,loadProgress:Cn,addSessionHistory:Vs}},void 0),he=H.id?`grammar_${H.id}`:H.question?`grammar_${H.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;await ot(he,_e,Oe,void 0,"grammar");const Xe=(Ke=(await Dt()).wordProgress)==null?void 0:Ke[he];let Ot=_e?"correct":"incorrect";Xe&&Xe.masteryLevel==="mastered"?Ot="mastered":!_e&&Xe&&Xe.incorrectCount>=2&&(Ot="review"),Rt({status:Ot,word:he,timestamp:Date.now()},"grammar"),await Pe(he,_e),I(Date.now())},100),nt})):(Ve(Be=>Be.filter(nt=>nt!==X)),B(Be=>[...Be,X])))},Zt=()=>{O(!ie)},jt=()=>{Fe>0&&(Ge(X=>X-1),ut(null),Ve([]),ce(!1),O(!1),yt.current=Date.now())},Jt=()=>{var X;return!H||!V?!1:Te?ye.join(" ")===((X=H.words)==null?void 0:X.join(" ")):Le===H.correctAnswer};return T.useEffect(()=>{dt||De()},[dt,De]),u.jsxs("div",{className:"quiz-view",children:[Re&&u.jsxs("div",{className:"error-message",children:[u.jsxs("p",{children:["‚ùå ",Re]}),u.jsx("button",{onClick:De,className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"ÂÜçË©¶Ë°å"})]}),!Re&&dt&&H&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Hh,{mode:"grammar",currentScore:q,totalAnswered:ve,sessionCorrect:ke.correct,sessionIncorrect:ke.incorrect,sessionReview:ke.review,sessionMastered:ke.mastered,sessionStats:ke,onReviewFocus:ge,isReviewFocusMode:G,onShowSettings:()=>c(!0),onResetProgress:Ae,onDebugRequeue:Ue,currentWord:H!=null&&H.id?`grammar_${H.id}`:H!=null&&H.question?`grammar_${H.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:void 0,onAnswerTime:S,lastAnswerCorrect:C,lastAnswerWord:$,lastAnswerDifficulty:H==null?void 0:H.difficulty,correctStreak:_,incorrectStreak:j,learningPhase:p.state.currentPhase??void 0,estimatedSpeed:(St=p.state.personalParams)==null?void 0:St.learningSpeed,dataSource:s.startsWith("g")&&s.includes("-unit")?`ÊñáÊ≥ïÂïèÈ°åÈõÜÔΩú${s.replace("g","").replace("-unit","-unit")}`:s==="all"?"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ":`${s}Âπ¥„ÅÆÂÜÖÂÆπ`,category:e==="all"?"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û":e==="verb-form"?"ÂãïË©ûÂ§âÂåñ":e==="fill-in-blank"?"Á©¥Âüã„ÇÅ":e==="sentence-ordering"?"‰∏¶„Å≥Êõø„Åà":"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û",difficulty:"",wordPhraseFilter:"all",grammarUnit:bt})})}),a&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"grade-select-active",children:"üìö Â≠¶Âπ¥„ÉªÂçòÂÖÉ:"}),u.jsxs("select",{id:"grade-select-active",value:s,onChange:X=>r(X.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ"}),u.jsx("option",{value:"1",children:"1Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(X=>X.value.startsWith("g1-")).map(X=>u.jsxs("option",{value:X.value,children:["1Âπ¥_",X.label.replace(/^‰∏≠\d+_/,"")]},X.value)),u.jsx("option",{value:"2",children:"2Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(X=>X.value.startsWith("g2-")).map(X=>u.jsxs("option",{value:X.value,children:["2Âπ¥_",X.label.replace(/^‰∏≠\d+_/,"")]},X.value)),u.jsx("option",{value:"3",children:"3Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(X=>X.value.startsWith("g3-")).map(X=>u.jsxs("option",{value:X.value,children:["3Âπ¥_",X.label.replace(/^‰∏≠\d+_/,"")]},X.value))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"quiz-type-select-active",children:"üìù ÂïèÈ°å„ÅÆÁ®ÆÈ°û:"}),u.jsxs("select",{id:"quiz-type-select-active",value:e,onChange:X=>t(X.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û"}),u.jsx("option",{value:"verb-form",children:"ÂãïË©ûÂ§âÂåñ"}),u.jsx("option",{value:"fill-in-blank",children:"Á©¥Âüã„ÇÅ"}),u.jsx("option",{value:"sentence-ordering",children:"‰∏¶„Å≥Êõø„Åà"})]})]}),u.jsx(Z0,{learningLimit:F,reviewLimit:M,onLearningLimitChange:K,onReviewLimitChange:D,idPrefix:"grammar-quiz-"}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle-grammar-quiz",checked:Ne,onChange:X=>{Ye(X.target.checked),localStorage.setItem("autoNext-grammar",X.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle-grammar-quiz",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",Ne?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),Ne&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay-grammar-quiz",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay-grammar-quiz",min:"500",max:"3000",step:"100",value:at,onChange:X=>{const me=parseInt(X.target.value,10);mt(me),localStorage.setItem("autoNextDelay-grammar",me.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(at/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-read-aloud-toggle-grammar-quiz",checked:wt,onChange:X=>{kt(X.target.checked),localStorage.setItem("autoReadAloud-grammar",X.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-read-aloud-toggle-grammar-quiz",className:"checkbox-label",children:["ÂõûÁ≠îÊôÇËá™Âãï„ÅßË™≠„Åø‰∏ä„ÅíÔºö",wt?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>d(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:jt,disabled:Fe===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"question-content-inline",children:[u.jsxs("div",{className:`question-text ${ie?"hint-active":""} ${V?"":"clickable"}`,onClick:V?void 0:Zt,title:V?"":"„Çø„ÉÉ„Éó„Åó„Å¶„Éí„É≥„Éà„ÇíË°®Á§∫ üí°",children:[H.japanese,!V&&u.jsx("span",{className:"hint-icon",children:"üí°"})]}),H.difficulty&&u.jsx("div",{className:`difficulty-badge ${H.difficulty}`,children:H.difficulty==="beginner"?"ÂàùÁ¥ö":H.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:$t,disabled:Fe>=fe.length-1,title:V?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó (Enter)",children:"‚Üí"})]}),ie&&!V&&u.jsx("div",{className:"hint-box",children:H.hint}),H.passage&&u.jsxs("div",{className:"passage-context",children:[u.jsx("div",{className:"passage-label",children:"üìñ ÊñáËÑà"}),u.jsxs("div",{className:"passage-content",children:[u.jsx("div",{className:"passage-english",children:H.passage}),H.passageJapanese&&u.jsx("div",{className:"passage-japanese",children:H.passageJapanese})]})]}),Te?u.jsxs("div",{className:"word-area",children:[vt&&u.jsxs("div",{className:"selected-words-area",children:[u.jsx("div",{className:"area-label",children:"Êñá„ÅÆÂΩ¢ÔºàÂè•Ë™≠ÁÇπ„Å§„ÅçÔºâ"}),u.jsx("div",{className:"sentence-display",children:Je})]}),u.jsxs("div",{className:"selected-words-area",children:[u.jsxs("div",{className:"area-label-with-reset",children:[u.jsxs("span",{className:"area-label",children:["ÈÅ∏Êäû„Åó„ÅüÂçòË™û (",ye.length,"Ë™û)"]}),!V&&u.jsx("button",{className:`reset-ordering-button ${ye.length===0?"disabled":""}`,onClick:()=>{if(ye.length>0){const X=ye[ye.length-1];Ve(me=>me.slice(0,-1)),B(me=>[...me,X])}},disabled:ye.length===0,title:ye.length===0?"ÂçòË™û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ":"ÊúÄÂæå„ÅÆÂçòË™û„ÇíÊàª„Åô",children:"‚Ü∂ 1„Å§Êàª„Çã"})]}),u.jsxs("div",{className:"word-container",children:[ye.map((X,me)=>u.jsx("button",{className:"word-button selected",onClick:()=>Xt(X,!1),disabled:V,children:X},`selected-${me}`)),ye.length===0&&u.jsx("div",{className:"placeholder",children:"„Åì„Åì„Å´ÂçòË™û„Çí‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑ"})]})]}),u.jsxs("div",{className:"remaining-words-area",children:[u.jsxs("div",{className:"area-label",children:["‰Ωø„Åà„ÇãÂçòË™û (",lt.length,"Ë™û)"]}),u.jsx("div",{className:"word-container",children:lt.map((X,me)=>u.jsx("button",{className:"word-button remaining",onClick:()=>Xt(X,!0),disabled:V,children:X},`remaining-${me}`))})]})]}):u.jsxs("div",{className:"choices-area",children:[H.conversation?u.jsxs(u.Fragment,{children:[H.japanese&&H.japanese.includes("A:")&&H.japanese.includes("B:")&&u.jsx("div",{className:"japanese-conversation",children:H.japanese.split(/([AB]:)/).map((X,me)=>X==="A:"||X==="B:"?u.jsx("span",{className:"conversation-speaker",children:X},me):X.trim()?u.jsx("span",{className:"conversation-text",children:X.trim()},me):null)}),u.jsx("div",{className:"conversation-display",children:(H.conversation||((Vt=H.dialogue)==null?void 0:Vt.map(X=>`${X.speaker}: ${X.text}`))||[]).map((X,me)=>u.jsx("div",{className:"conversation-line",children:X.split("____").map((Be,nt,Ct)=>u.jsxs("span",{children:[Be,nt<Ct.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},nt))},me))})]}):H.originalSentence||H.targetSentence?u.jsxs("div",{className:"paraphrase-display",children:[u.jsx("div",{className:"paraphrase-label",children:"üìù ÂÖÉ„ÅÆÊñá:"}),u.jsx("div",{className:"sentence-display original",children:H.originalSentence||H.sentence}),u.jsx("div",{className:"paraphrase-arrow",children:"‚Üì Ë®Ä„ÅÑÊèõ„Åà"}),u.jsx("div",{className:"paraphrase-label",children:"‚úèÔ∏è Êõ∏„ÅçÊèõ„ÅàÂæå:"}),u.jsx("div",{className:"sentence-display target",children:(tt=H.question||H.targetSentence)==null?void 0:tt.split("____").map((X,me,Be)=>u.jsxs("span",{children:[X,me<Be.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},me))})]}):u.jsx("div",{className:"sentence-display",children:($e=H.sentence)==null?void 0:$e.split("____").map((X,me,Be)=>u.jsxs("span",{children:[X,me<Be.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},me))}),H.choices&&H.choices.length>0?u.jsxs("div",{className:"choices-grid",children:[H.choices.map((X,me)=>{const Be=Le===X,nt=X===H.correctAnswer,Ct=V&&nt,st=V&&Be&&!nt;return u.jsxs("button",{className:`choice-button ${Be?"selected":""} ${Ct?"correct":""} ${st?"incorrect":""}`,onClick:()=>Pt(X),disabled:V,children:[X,Ct&&" ‚úì",st&&" ‚úó"]},me)}),u.jsxs("button",{className:`choice-button dont-know ${Le==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""} ${V&&Le==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"incorrect":""}`,onClick:()=>Pt("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:V,children:["ÂàÜ„Åã„Çâ„Å™„ÅÑ",V&&Le==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"&&" ‚úó"]})]}):u.jsxs("div",{className:"text-input-container",children:[u.jsx("input",{type:"text",className:"text-answer-input",value:L,onChange:X=>U(X.target.value),onKeyPress:X=>{X.key==="Enter"&&L.trim()&&Pt(L.trim())},placeholder:"Á≠î„Åà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",disabled:V,autoFocus:!0}),u.jsx("button",{className:"submit-answer-button",onClick:()=>Pt(L.trim()),disabled:V||!L.trim(),children:"ÂõûÁ≠î„Åô„Çã"}),u.jsx("button",{className:`choice-button dont-know ${Le==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""}`,onClick:()=>Pt("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:V,children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]})]}),V&&u.jsx(u.Fragment,{children:Te?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:`result-box ${Jt()?"correct":"incorrect"}`,children:[u.jsx("div",{className:"result-header",children:Jt()?"‚úÖ Ê≠£Ëß£ÔºÅ":"‚ùå ‰∏çÊ≠£Ëß£"}),u.jsx("div",{className:"result-content",children:u.jsxs("div",{className:"answer-comparison",children:[u.jsxs("div",{className:"user-answer",children:[u.jsx("strong",{children:"„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î:"}),u.jsx("br",{}),ye.join(" ")]}),!Jt()&&u.jsxs("div",{className:"correct-answer",children:[u.jsx("strong",{children:"Ê≠£Ëß£:"}),u.jsx("br",{}),H.correctAnswer||H.correctOrder||H.sentence||""]})]})})]}),H.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),H.explanation]})})]}):u.jsx(u.Fragment,{children:H.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),H.explanation]})})})})]})})]}),h&&u.jsx(Kh,{mode:"grammar",currentIndex:Fe,totalQuestions:fe.length,questions:fe.map(X=>({word:X.id,difficulty:X.difficulty})),requeuedWords:v(fe,Fe)})]})}const TY=Object.freeze(Object.defineProperty({__proto__:null,default:Ak},Symbol.toStringTag,{value:"Module"}));class jr{static recordDataSave(e,t,s){this.enabled&&this.addEvent({type:"data-save",success:e,duration:t,errorMessage:s,timestamp:Date.now()})}static recordAIAnalysis(e,t,s,r){this.enabled&&this.addEvent({type:"ai-analysis",category:e,confidence:t,actualResult:s,errorMessage:r,timestamp:Date.now()})}static recordCategoryDetermination(e,t,s,r){this.enabled&&this.addEvent({type:"category-determination",category:e,confidence:t,duration:s,actualResult:r,timestamp:Date.now()})}static recordPriorityCalculation(e,t=!0){this.enabled&&this.addEvent({type:"priority-calculation",duration:e,success:t,timestamp:Date.now()})}static addEvent(e){this.events.push(e),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}static getMetrics(){const e=this.events.filter(o=>o.type==="data-save"),t=this.events.filter(o=>o.type==="ai-analysis"),s=this.events.filter(o=>o.type==="category-determination"),r=this.events.filter(o=>o.type==="priority-calculation");return{dataSave:{totalAttempts:e.length,successRate:e.length>0?e.filter(o=>o.success).length/e.length:0,avgDuration:e.length>0?e.reduce((o,i)=>o+(i.duration||0),0)/e.length:0,errorRate:e.length>0?e.filter(o=>!o.success).length/e.length:0},aiAnalysis:{totalAnalyses:t.length,avgConfidence:t.length>0?t.reduce((o,i)=>o+(i.confidence||0),0)/t.length:0,accuracy:t.filter(o=>o.actualResult).length>0?t.filter(o=>o.actualResult&&o.category===o.actualResult).length/t.filter(o=>o.actualResult).length:0,lowConfidenceRate:t.length>0?t.filter(o=>(o.confidence||0)<.7).length/t.length:0},categoryDetermination:{total:s.length,avgConfidence:s.length>0?s.reduce((o,i)=>o+(i.confidence||0),0)/s.length:0,accuracy:s.filter(o=>o.actualResult).length>0?s.filter(o=>o.actualResult&&o.category===o.actualResult).length/s.filter(o=>o.actualResult).length:0},priorityCalculation:{total:r.length,avgDuration:r.length>0?r.reduce((o,i)=>o+(i.duration||0),0)/r.length:0}}}static report(){if(!this.enabled)return;const e=this.getMetrics();console.group("üìà Quality Report"),console.group("üíæ Data Save"),console.log(`Total Attempts: ${e.dataSave.totalAttempts}`),console.log(`Success Rate: ${(e.dataSave.successRate*100).toFixed(2)}%`),console.log(`Avg Duration: ${e.dataSave.avgDuration.toFixed(2)}ms`),console.log(`Error Rate: ${(e.dataSave.errorRate*100).toFixed(2)}%`),console.groupEnd(),console.group("ü§ñ AI Analysis"),console.log(`Total Analyses: ${e.aiAnalysis.totalAnalyses}`),console.log(`Avg Confidence: ${(e.aiAnalysis.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),console.log(`Low Confidence Rate: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`),console.groupEnd(),console.group("üè∑Ô∏è Category Determination"),console.log(`Total: ${e.categoryDetermination.total}`),console.log(`Avg Confidence: ${(e.categoryDetermination.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.categoryDetermination.accuracy*100).toFixed(2)}%`),console.groupEnd(),console.group("‚öñÔ∏è Priority Calculation"),console.log(`Total: ${e.priorityCalculation.total}`),console.log(`Avg Duration: ${e.priorityCalculation.avgDuration.toFixed(2)}ms`),console.groupEnd(),console.groupEnd()}static export(){return JSON.stringify({timestamp:new Date().toISOString(),events:this.events,metrics:this.getMetrics()},null,2)}static saveToStorage(){try{localStorage.setItem("quality-monitor-data",this.export()),console.log("‚úÖ Quality data saved to localStorage")}catch(e){console.error("‚ùå Failed to save quality data:",e)}}static loadFromStorage(){try{const e=localStorage.getItem("quality-monitor-data");if(e){const t=JSON.parse(e);this.events=t.events||[],console.log(`‚úÖ Loaded ${this.events.length} quality events from localStorage`)}}catch(e){console.error("‚ùå Failed to load quality data:",e)}}static clear(){this.events=[],localStorage.removeItem("quality-monitor-data")}static checkThresholds(){if(!this.enabled)return;const e=this.getMetrics();e.dataSave.successRate<.99&&e.dataSave.totalAttempts>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] Data save success rate is low: ${(e.dataSave.successRate*100).toFixed(2)}%`),e.aiAnalysis.accuracy<.9&&e.aiAnalysis.totalAnalyses>=20&&console.warn(`‚ö†Ô∏è [QualityMonitor] AI analysis accuracy is low: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),e.aiAnalysis.lowConfidenceRate>.3&&e.aiAnalysis.totalAnalyses>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] High rate of low-confidence analyses: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`)}static startPeriodicCheck(e=6e4){return setInterval(()=>{this.checkThresholds()},e)}}Ee(jr,"events",[]),Ee(jr,"maxEvents",1e3),Ee(jr,"enabled",!1);jr.enabled&&(jr.loadFromStorage(),window.addEventListener("beforeunload",()=>{jr.saveToStorage()}),jr.startPeriodicCheck(6e4));const vb="ab_anonymous_user_id_v1";function Ek(){try{const n=localStorage.getItem(vb);if(n)return n;const e=`anon_${Date.now()}_${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem(vb,e),e}catch{return console.warn("[AB Identity] localStorage not available, using session-only ID"),`temp_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}}function AY(){const n=Ek(),e=Date.now(),t=Math.random().toString(36).substring(2,11);return`${n}-${e}-${t}`}function EY(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}function RY(n){switch(EY(n)%3){case 0:return"A";case 1:return"B";case 2:return"C";default:return"A"}}function DY(n){var e;try{const s=(e=rt().wordProgress)==null?void 0:e[n];if(!s)return!1;const r=s.memorizationPosition??50;return r>=0&&r<20}catch(t){return console.warn(`[AB Snapshot] Failed to check mastered status for "${n}":`,t),!1}}function Sb(n){const e=[];for(const t of n)DY(t)&&e.push(t);return e}function _Y(n,e){const t=new Set(n),s=new Set(e);let r=0;for(const o of s)t.has(o)||r++;return r}function PY(n,e){return e===0?0:n/e}function jY(n){return new Set(n).size}function MY(n){return n.map(e=>e.word)}const FY={targetScore:30,warningScore:40,criticalScore:50,fallbackQuestionCount:20};function OY(n,e=0,t=FY){let s="good",r=!1,o=!1,i="";return n<=t.targetScore?(s="good",i="ÊåØÂãï„Çπ„Ç≥„Ç¢ËâØÂ•Ω"):n<=t.warningScore?(s="warning",i="ÊåØÂãï„Çπ„Ç≥„Ç¢Ê≥®ÊÑè„É¨„Éô„É´"):n<=t.criticalScore?(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®"):(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®",e>=2&&(o=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™ÂåñÁ∂ôÁ∂ö: variant=A„Å∏ÂàáÊàª„ÅóÊé®Â•®")),{level:s,shouldFallback:r,shouldSwitchToA:o,score:n,message:i}}function LY(n,e,t){try{const s=`ab_consecutive_critical_${n}_${e}`,r=parseInt(localStorage.getItem(s)||"0",10),o=t?r+1:0;return localStorage.setItem(s,String(o)),o}catch{return 0}}function zY(n,e,t,s,r){try{const o={sessionId:n,variant:e,timestamp:Date.now(),score:t,level:s,fallbackApplied:r},i=JSON.parse(localStorage.getItem("ab_vibration_history")||"[]");i.push(o),i.length>300&&i.splice(0,i.length-300),localStorage.setItem("ab_vibration_history",JSON.stringify(i))}catch{}}function WY({allQuestions:n,questionSets:e,customQuestionSets:t=[],onAddWordToCustomSet:s,onRemoveWordFromCustomSet:r,onOpenCustomSetManagement:o}){var Rt;const[i,a]=T.useState(!1),[c,l]=T.useState("all"),[d,h]=T.useState("all"),[f,p]=T.useState("all"),[m,g]=T.useState("all"),[x,y]=T.useState(()=>{const he=localStorage.getItem("memorization-still-learning-limit");return he?parseInt(he):null}),[b,v]=T.useState(()=>{const he=localStorage.getItem("memorization-incorrect-limit");return he?parseInt(he):null}),[w,S]=T.useState({showWord:!0,showMeaning:!0,showPronunciation:!1,showExample:!1,showEtymology:!1,showRelated:!1}),[I,C]=T.useState(!1),[k,$]=T.useState(!0),[N,_]=T.useState(!1),[P,j]=T.useState(1.5),[A,F]=T.useState(null),[M,K]=T.useState(0),[D,G]=T.useState([]),[te]=T.useState(()=>`session-${Date.now()}`),[W,de]=T.useState(0),[le]=T.useState(()=>AY()),[oe]=T.useState(()=>RY(le)),[ge]=T.useState(()=>Date.now()),[Ae,Ue]=T.useState([]),[Pe,Ne]=T.useState([]),[Ye,at]=T.useState(0),[mt,wt]=T.useState(0),[kt,dt]=T.useState(!1),[ue,xe]=T.useState(0),[Q,fe]=T.useState(!1),[Z,Fe]=T.useState({correct:0,still_learning:0,incorrect:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[Ge,Le]=T.useState(0),[ut,ye]=T.useState(0),[Ve,lt]=T.useState(0),[B,L]=T.useState(!1),[U,V]=T.useState(null),[ce,ie]=T.useState(0),O=(he,We,Xe)=>{try{const Ot=localStorage.getItem("debug_reschedule_events"),Ke=Ot?JSON.parse(Ot):[];Ke.push({timestamp:new Date().toISOString(),mode:"memorization",phase:he,reason:We,details:Xe??{}}),Ke.length>30&&Ke.shift(),localStorage.setItem("debug_reschedule_events",JSON.stringify(Ke))}catch{}},[q,re]=T.useState(void 0),[ve,be]=T.useState(void 0),[ke,Ie]=T.useState(0),[Re,we]=T.useState(0),[H,Te]=T.useState(null),Me=T.useRef(0),[Je,vt]=T.useState(!0),bt=T.useRef(0),He=T.useRef(null),yt=T.useRef(null),[Gt,De]=T.useState(!1),[$t,Pt]=T.useState(!1),Xt=Qh(Fa.MEMORIZATION),{processQuestion:Zt}=qh(),[jt]=T.useState(()=>{const he=new Ol;return he.enableAICoordination(!0),E.info("ü§ñ [MemorizationView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü"),he}),Jt=T.useRef(0),St=T.useRef(null);T.useEffect(()=>{Jt.current=M,St.current=(A==null?void 0:A.word)??null},[M,A==null?void 0:A.word]),T.useEffect(()=>{const he=We=>{const Xe=We,{word:Ot,position:Ke,mode:Et}=Xe.detail;Et==="memorization"&&(L(!0),V(`Âº±ÁÇπË™ûÊ§úÂá∫: ${Ot} (Position=${Ke})`))};return window.addEventListener("weak-word-detected",he),()=>{window.removeEventListener("weak-word-detected",he)}},[]);const{reAddQuestion:Vt,clearExpiredFlags:tt,updateRequeueStats:$e,getRequeuedWords:X,checkPositionMismatch:me}=Ll();T.useMemo(()=>{Lt.start("calculate-category-stats");const he={incorrect:Z.incorrect,still_learning:Z.still_learning,correct:Z.correct,mastered:Z.mastered,total:Z.total,incorrectRate:Z.total>0?Z.incorrect/Z.total:0,correctRate:Z.total>0?Z.correct/Z.total:0};return Lt.end("calculate-category-stats"),he},[Z.incorrect,Z.still_learning,Z.correct,Z.mastered,Z.total]),T.useMemo(()=>{Lt.start("get-available-categories");const he=new Set;n.forEach(Xe=>{Xe.relatedFields&&Array.isArray(Xe.relatedFields)&&Xe.relatedFields.forEach(Ot=>he.add(Ot))});const We=Array.from(he).sort();return Lt.end("get-available-categories"),We},[n]),T.useMemo(()=>{Lt.start("filter-questions");let he=n;if(c!=="all"){const We=e.find(Xe=>Xe.id===c);We?he=We.questions:he=he.filter(Xe=>Xe.source===c)}return f!=="all"&&(he=he.filter(We=>We.difficulty===f)),d!=="all"&&(he=he.filter(We=>We.relatedFields&&Array.isArray(We.relatedFields)&&We.relatedFields.includes(d))),m==="words"?he=he.filter(We=>!We.word.includes(" ")||We.word.split(" ").length<=2):m==="phrases"&&(he=he.filter(We=>We.word.includes(" ")&&We.word.split(" ").length>2)),Lt.end("filter-questions"),he},[n,e,c,f,d,m]),T.useEffect(()=>{(async()=>{try{const We=await W0();We&&S(We);const Xe=await V0();Xe&&(C(Xe.autoVoice||!1),$(Xe.voiceWord!==void 0?Xe.voiceWord:!0),_(Xe.voiceMeaning||!1),j(Xe.voiceDelay!==void 0?Xe.voiceDelay:1.5)),vt(!1)}catch(We){E.error("Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",We),vt(!1)}})()},[]);const Be=()=>{const he=new Set;return n.forEach(We=>{We.relatedFields&&Array.isArray(We.relatedFields)&&We.relatedFields.forEach(Xe=>he.add(Xe))}),Array.from(he).sort()};T.useEffect(()=>{if(Je)return;(async()=>{try{let We=n;if(c!=="all"){const Tt=e.find(Ht=>Ht.id===c);Tt?We=Tt.questions:We=n.filter(Ht=>Ht.source===c)}if(We.length===0){E.warn("[MemorizationView] ÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}let Xe=We;if(f!=="all"&&(Xe=Xe.filter(Tt=>Tt.difficulty===f)),d!=="all"&&(Xe=Xe.filter(Tt=>Tt.relatedFields&&Array.isArray(Tt.relatedFields)&&Tt.relatedFields.includes(d))),m==="words"?Xe=Xe.filter(Tt=>!Tt.word.includes(" ")||Tt.word.split(" ").length<=2):m==="phrases"&&(Xe=Xe.filter(Tt=>Tt.word.includes(" ")&&Tt.word.split(" ").length>2)),Xe.length===0){E.warn("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂïèÈ°å„Åå0‰ª∂„Åß„Åô");return}E.info("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂçòË™ûÊï∞",{totalFiltered:Xe.length,sessionStats:{correct:Z.correct,incorrect:Z.incorrect,still_learning:Z.still_learning||0}}),oe==="B"||oe==="C"?jt.enableAICoordination(!0):jt.enableAICoordination(!1),await cs();const Ke=rt().wordProgress||{},Et=[],Cn=Object.entries(Ke).filter(([Tt,Ht])=>(Ht.memorizationAttempts??Ht.totalAttempts??0)<=0?!1:Ut(Ht,"memorization")>=40).map(([Tt,Ht])=>({word:Tt,position:Ut(Ht,"memorization"),memPos:Ht.memorizationPosition,attempts:Ht.memorizationAttempts??Ht.totalAttempts??0})),Vs=new Set(We.map(Tt=>Tt.word)),Vo=Cn.filter(Tt=>!Vs.has(Tt.word));try{localStorage.setItem("debug_weak_words_detection",JSON.stringify({timestamp:new Date().toISOString(),allWeakWordsInLS:Cn.length,weakWordsList:Cn,missingFromBase:Vo.map(Tt=>Tt.word),baseQuestionsCount:We.length,filteredCount:Xe.length}))}catch{}for(const Tt of We){const Ht=Ke[Tt.word];if(!Ht||(Ht.memorizationAttempts??Ht.totalAttempts??0)<=0)continue;Ut(Ht,"memorization")>=40&&Et.push(Tt)}try{const Tt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");localStorage.setItem("debug_weak_words_detection",JSON.stringify({...Tt,weakQuestionsCount:Et.length,weakQuestionsWords:Et.map(Ht=>Ht.word)}))}catch{}try{const Tt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");Tt.weakQuestionsDetected=Et.length,Tt.weakQuestionsWords=Et.map(Ht=>Ht.word),Tt.dataMissing=Cn.length-Et.length,localStorage.setItem("debug_weak_words_detection",JSON.stringify(Tt))}catch{}let uo=Xe;if(Et.length>0){const Tt=new Map;for(const Ht of Xe)Tt.set(Ht.word,Ht);for(const Ht of Et)Tt.set(Ht.word,Ht);uo=Array.from(Tt.values())}let Ss;const ln=await jt.schedule({questions:uo,mode:"memorization",limits:{learningLimit:x,reviewLimit:b},sessionStats:{correct:Z.correct,incorrect:Z.incorrect,still_learning:Z.still_learning||0,mastered:Z.mastered||0,duration:Date.now()-Me.current},useMetaAI:!0,isReviewFocusMode:Q,hybridMode:oe==="B",finalPriorityMode:oe==="C"});if(!ln||!ln.scheduledQuestions){E.error("[MemorizationView] „Çπ„Ç±„Ç∏„É•„Éº„É´ÁµêÊûú„ÅåÁÑ°Âäπ„Åß„Åô",{scheduleResult:ln});return}const Ms=ln.scheduledQuestions,ir={totalScheduled:Ms.length,top10Words:Ms.slice(0,10).map(Tt=>Tt.word),timestamp:new Date().toISOString()};try{localStorage.setItem("debug_memorization_latest",JSON.stringify(ir))}catch{}const is=ln.vibrationScore,Xh=Ek(),Qr=OY(is,mt),ji=LY(Xh,oe,Qr.level==="critical");if(wt(ji),zY(le,oe,is,Qr.level,Qr.shouldFallback),Qr.shouldFallback&&!kt&&(oe==="B"||oe==="C")&&(E.warn("[MemorizationView] ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈÅ©Áî®",{score:is,variant:oe,consecutiveCritical:ji}),dt(!0),Ms.splice(20)),Qr.shouldSwitchToA&&E.error("[MemorizationView] variant=AÂàáÊàª„ÅóÊé®Â•®",{score:is,variant:oe,consecutiveCritical:ji,message:Qr.message}),ln.vibrationScore>50&&E.warn("[MemorizationView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:ln.vibrationScore,processingTime:ln.processingTime}),G(Ms),Ms.length>0&&M===0&&!A){const Tt=MY(Ms);Ne(Tt),at(ln.vibrationScore);const Ht=Sb(Tt);Ue(Ht)}if(Ms.length>0&&M===0&&!A){const Tt=Ms[0];F(Tt),K(0),Me.current=Date.now(),Fe(Ht=>({...Ht,total:Ht.total+1}))}}catch(We){E.error("[MemorizationView] ÂïèÈ°åÈÅ∏Êäû„Ç®„É©„Éº:",We),vt(!1)}})()},[c,f,d,m,n,Je,Q]);const nt=()=>{fe(!Q)},Ct=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:he}=await Yn(async()=>{const{resetAllProgress:We}=await Promise.resolve().then(()=>ti);return{resetAllProgress:We}},void 0);await he(),Fe({correct:0,still_learning:0,incorrect:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),Ie(0),we(0),K(0),at(0),wt(0),xe(0),E.info("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(he){E.error("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",he),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},st=()=>{Pt(!0)},ht=async(he,We)=>{try{const Xe=Ke=>{const Et=(Ke.grade||1)/9;return Math.min(Math.max(Et,0),1)},Ot=()=>{const Ke=new Date().getHours();return Ke<12?"morning":Ke<18?"afternoon":Ke<22?"evening":"night"};A&&await Zt(he,We?"correct":"incorrect",{currentDifficulty:Xe(A),timeOfDay:Ot(),recentErrors:Z.incorrect,sessionLength:Math.floor((Date.now()-Me.current)/6e4),consecutiveCorrect:ke})}catch(Xe){console.error("[MemorizationView] Adaptive AI error:",Xe)}};T.useEffect(()=>{(x!==null&&Z.still_learning>=x||b!==null&&Z.incorrect>=b)&&(Q||fe(!0))},[Z,x,b,Q]),T.useEffect(()=>{Ge!==0&&D.length!==0&&setTimeout(()=>{const he=H0(D,"memorization");Fe(We=>({...We,incorrect:he.incorrect,still_learning:he.still_learning,mastered:he.mastered}))},100)},[Ge,D]),T.useEffect(()=>{if(!B||Je||D.length===0)return;(async()=>{try{E.info("[MemorizationView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:Ve,reason:U});const We=Jt.current,Xe=St.current,Ot=Math.min(We+1,D.length),Ke=D.slice(Ot),Cn=rt().wordProgress||{},Vs=[];for(const Ss of n){const ln=Cn[Ss.word];if(!ln||(ln.memorizationAttempts??ln.totalAttempts??0)<=0)continue;Ut(ln,"memorization")>=40&&(Ke.find(is=>is.word===Ss.word)||Vs.push(Ss))}let Vo=Ke;if(Vs.length>0){const Ss=new Map;for(const ln of Ke)Ss.set(ln.word,ln);for(const ln of Vs)Ss.set(ln.word,ln);Vo=Array.from(Ss.values())}if(Vo.length===0){E.warn("[MemorizationView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂØæË±°„Å™„Åó"),lt(0),L(!1),V(null),O("skipped","ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂØæË±°„Å™„Åó",{lockedPrefixCount:Ot,total:D.length});return}const uo=await jt.schedule({questions:Vo,mode:"memorization",limits:{learningLimit:x??null,reviewLimit:b??null},sessionStats:{correct:Z.correct,incorrect:Z.incorrect,still_learning:Z.still_learning,mastered:Z.mastered,duration:0},useMetaAI:!0,isReviewFocusMode:Q,hybridMode:oe==="A"||oe==="B",finalPriorityMode:oe==="C"});G(Ss=>Jt.current!==We||St.current!==Xe?Ss:[...Ss.slice(0,Ot),...uo.scheduledQuestions]),ie(Date.now()),O("applied",U??"Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞",{lockedPrefixCount:Ot,remainingBefore:Vo.length,remainingAfter:uo.scheduledQuestions.length}),lt(0),L(!1),V(null),E.info("[MemorizationView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newLength:uo.scheduledQuestions.length})}catch(We){E.error("[MemorizationView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",We),L(!1),V(null),O("error","ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº",{error:String(We)})}})()},[B,Je,D,x,b,Z,oe,jt,Ve,U]),T.useEffect(()=>{if(!A||!I||yt.current===A.word)return;yt.current=A.word,(async()=>{if(k&&As(A.word,{rate:.85}),N&&A.meaning){await new Promise(Xe=>setTimeout(Xe,P*1e3));const We=new SpeechSynthesisUtterance(A.meaning);We.lang="ja-JP",We.rate=.85,window.speechSynthesis.speak(We)}})()},[A,I,k,N,P]);const _e=()=>{De(!Gt)},Oe=async he=>{if(he==="showWord")return;const We={...w,[he]:!w[he]};S(We),await z0(We)},ot=async(he,We,Xe,Ot)=>{C(he),$(We),_(Xe),Ot!==void 0&&j(Ot),await B0({autoVoice:he,voiceWord:We,voiceMeaning:Xe,voiceDelay:Ot!==void 0?Ot:P,interleavingMode:"off",cardDisplaySettings:w})},Dt=T.useCallback(async he=>{var Qr,ji,Tt,Ht;if(!A)return;const We=(Date.now()-Me.current)/1e3,Xe=he==="right",Ot=he==="center",Ke=A,Et=We,Cn=M;re(Xe),be(A.word);const Vs=!Xe&&!Ot?Re+1:0;!B&&Vs>=5&&(L(!0),V("‰∏çÊ≠£Ëß£ÈÄ£Êâì„ÅßÊñ∞Ë¶èÊûØÊ∏á„ÇíÂõûÈÅø"),O("triggered","‰∏çÊ≠£Ëß£ÈÄ£Êâì„ÅßÊñ∞Ë¶èÊûØÊ∏á„ÇíÂõûÈÅø",{word:A.word,incorrectStreak:Vs})),Xe?(Ie(ft=>ft+1),we(0)):Ot?(Ie(0),we(0)):(we(ft=>ft+1),Ie(0)),Fe(ft=>{const un=A.reAddedCount&&A.reAddedCount>0;let Nn=ft.incorrect,Cs=ft.still_learning;return Xe&&un&&(Nn>0?Nn=Math.max(0,Nn-1):Cs>0&&(Cs=Math.max(0,Cs-1))),{correct:Xe?ft.correct+1:ft.correct,still_learning:Ot?Cs+1:Cs,incorrect:!Xe&&!Ot?Nn+1:Nn,mastered:Xe?ft.mastered+1:ft.mastered,total:ft.total,newQuestions:ft.newQuestions,reviewQuestions:ft.reviewQuestions,consecutiveNew:ft.consecutiveNew,consecutiveReview:ft.consecutiveReview}}),Lt.start("quick-category-determination");const uo=(Qr=rt().wordProgress)==null?void 0:Qr[Ke.word],Ss=Ut(uo,"memorization"),ln=Yr(Ss),Ms=Lt.end("quick-category-determination");if(Ms>50&&Lt.warnIfSlow("quick-category-determination",Ms,50),jr.recordCategoryDetermination(ln,1,Ms),Et<16){Lt.start("data-save");try{await No(Ke.word,Xe,Et*1e3,void 0,"memorization",Ot);try{const Nn=(ji=rt().wordProgress)==null?void 0:ji[Ke.word],Cs=Ut(Nn,"memorization"),Us=Yr(Cs);WI(Us)&&Us!==ln&&(L(!0),V(`Â≠¶ÁøíÁä∂ÊÖãÂ§âÂåñ: ${ln}‚Üí${Us}`),O("triggered",`Â≠¶ÁøíÁä∂ÊÖãÂ§âÂåñ: ${ln}‚Üí${Us}`,{word:Ke.word,categoryBefore:ln,categoryAfter:Us,posAfter:Cs}))}catch(un){E.error("[MemorizationView] „Ç´„ÉÜ„Ç¥„É™Â§âÂåñÊ§úÁü•„Ç®„É©„Éº:",un)}if(Xe)try{const Nn=(Tt=rt().wordProgress)==null?void 0:Tt[Ke.word];Ut(Nn,"memorization")<40&&G(ar=>{if(!Array.isArray(ar)||ar.length===0)return ar;const Mi=Math.min(Cn,ar.length-1);return ar.filter((Jh,Yh)=>Yh<=Mi||Jh.word!==Ke.word?!0:!((Jh.reAddedCount||0)>0))})}catch{}const ft=Lt.end("data-save");jr.recordDataSave(!0,ft)}catch(ft){const un=Lt.end("data-save");jr.recordDataSave(!1,un,String(ft)),E.error("[MemorizationView] Â≠¶Áøí„Éá„Éº„ÇøË®òÈå≤„Ç®„É©„Éº:",ft)}finally{Le(Date.now())}Promise.all([(async()=>{try{const ft={word:Ke.word,timestamp:Date.now(),viewDuration:Et,swipeDirection:he==="center"?"left":he,sessionId:te,consecutiveViews:W+1};await U0(ft),de(un=>un+1)}catch(ft){E.error("[MemorizationView] Ë°åÂãïË®òÈå≤„Ç®„É©„Éº:",ft)}})(),(async()=>{try{Xt.recordAnswer(Ke.word,Xe,Et*1e3)}catch(ft){E.error("[MemorizationView] Áµ±Ë®àË®òÈå≤„Ç®„É©„Éº:",ft)}})(),(async()=>{await new Promise(ft=>setTimeout(ft,1e3)),Lt.start("ai-detailed-analysis");try{await ht(Ke.word,Xe);const ft=Lt.end("ai-detailed-analysis")}catch(ft){Lt.end("ai-detailed-analysis"),E.error("[MemorizationView] AIÂàÜÊûê„Ç®„É©„Éº:",ft)}})()]).catch(ft=>{E.error("[MemorizationView] „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂá¶ÁêÜ„Ç®„É©„Éº:",ft)})}if($e(A,Z,Fe),Te(A.word),lt(ft=>{const un=ft+1;if(un>=50)return L(!0),V("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),O("triggered","50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü",{answerCountSinceSchedule:un}),un;if(un%10===0)try{const Nn=me(D,"memorization");Nn.needsRescheduling&&(L(!0),V(Nn.reason),O("triggered",Nn.reason,{answerCountSinceSchedule:un}))}catch(Nn){E.error("[MemorizationView] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",Nn)}return un}),jt.aiCoordinator)try{const ft=rt(),un=(ft==null?void 0:ft.wordProgress)??{},Nn=un[A.word]??((Ht=ft==null?void 0:ft.wordProgress)==null?void 0:Ht[A.word])??null;let Cs=0,Us=0,ar=0,Mi=0;for(const Zh of Object.values(un)){const ef=Ut(Zh,"memorization");ef>=70?ar++:ef>=40?Us++:ef>=20?Mi++:Cs++}const Yh={totalAttempts:(Z.correct||0)+(Z.incorrect||0)+(Z.still_learning||0)+(Z.mastered||0),correctAnswers:Z.correct||0,incorrectAnswers:Z.incorrect||0,stillLearningAnswers:Z.still_learning||0,sessionStartTime:ge,sessionDuration:Date.now()-ge,consecutiveIncorrect:0,masteredCount:Cs,stillLearningCount:Us,incorrectCount:ar,newCount:Mi,consecutiveCorrect:Z.consecutiveCorrect||0},Pk={word:{word:A.word,meaning:A.meaning,reading:A.reading,difficulty:A.difficulty,category:A.category,source:A.source,type:A.type,isPhraseOnly:A.isPhraseOnly},progress:Nn,sessionStats:Yh,currentTab:"memorization",allProgress:un},jk={wasCorrect:Xe,responseTime:Math.round(Et*1e3),timestamp:Date.now(),features:[]};jt.aiCoordinator.learn(Pk,jk).catch(Zh=>{console.warn("[ML] learn() failed",Zh)})}catch(ft){console.warn("[ML] learn() error",ft)}let ir=D;if(!Xe||Ot){const ft=Vt(A,D,M,"memorization");ft!==D&&(ir=ft,G(ft))}let is=M+1;const Xh=Math.min(is+5,ir.length);for(;is<Xh&&ir[is].word===A.word;)E.warn("[MemorizationView] ÈÄ£Á∂öÂá∫È°å„ÇíÊ§úÂá∫„ÄÅ„Çπ„Ç≠„ÉÉ„Éó",{word:ir[is].word,nextIndex:is}),is++;if(is<ir.length){const ft=tt(ir,M);ft!==ir&&G(ft);const un=ir[is];F(un),K(is),Me.current=Date.now(),Fe(Nn=>({...Nn,total:Nn.total+1})),be(void 0)}else{if(Pe.length>0)try{const ft=Sb(Pe),un=_Y(Ae,ft),Nn=jY(Pe),Cs=PY(un,Nn),Us=Date.now(),ar=Math.round((Us-ge)/1e3),Mi={sessionId:le,variant:oe,mode:"memorization",sessionLength:Pe.length,questionWords:Pe,uniqueWordCount:Nn,startMasteredWords:Ae,endMasteredWords:ft,acquiredWordCount:un,acquisitionRate:Cs,vibrationScore:Ye,startedAt:ge,endedAt:Us,durationSec:ar,mlEnabled:!0};DJ(Mi)}catch(ft){console.error("[AB Session End] Failed to save log:",ft)}F(null),be(void 0)}},[A,M,D,te,W,Z,x,b]);return T.useEffect(()=>{const he=He.current;if(!he)return;const We=Ke=>{bt.current=Ke.touches[0].clientX},Xe=Ke=>{const Cn=Ke.changedTouches[0].clientX-bt.current;Math.abs(Cn)>100&&(Cn>0?Dt("right"):Dt("left"))},Ot=Ke=>{Ke.key==="ArrowLeft"||Ke.key==="1"?(Ke.preventDefault(),Dt("left")):Ke.key==="ArrowDown"||Ke.key==="2"?(Ke.preventDefault(),Dt("center")):(Ke.key==="ArrowRight"||Ke.key==="3")&&(Ke.preventDefault(),Dt("right"))};return he.addEventListener("touchstart",We),he.addEventListener("touchend",Xe),document.addEventListener("keydown",Ot),()=>{he.removeEventListener("touchstart",We),he.removeEventListener("touchend",Xe),document.removeEventListener("keydown",Ot)}},[Dt]),Je?u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})}):A?u.jsxs("div",{className:"quiz-view",children:[Gt?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:_e,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4 h-[90vh] flex items-center",children:u.jsxs("div",{ref:He,className:"question-card h-[600px] sm:h-[650px] md:h-[700px] flex flex-col w-full",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${xn()?"clickable-pronunciation":""}`,onClick:he=>{xn()&&(he.preventDefault(),he.stopPropagation(),As(A.word,{rate:.85}))},onTouchEnd:he=>{xn()&&(he.preventDefault(),he.stopPropagation(),As(A.word,{rate:.85}))},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${A.word.includes(" ")?"phrase-text":""} ${xn()?"clickable-word":""}`,children:[A.word,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),A.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",A.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[A.difficulty&&u.jsx("div",{className:`difficulty-badge ${A.difficulty}`,children:A.difficulty==="beginner"?"ÂàùÁ¥ö":A.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),s&&r&&o&&u.jsx(ra,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4 flex-shrink-0",children:[u.jsxs("button",{onClick:()=>Dt("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>Dt("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>Dt("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),s&&r&&o&&u.jsx("div",{className:"mb-2 flex justify-center flex-shrink-0",children:u.jsx(ra,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})}),u.jsxs("div",{className:"space-y-3 overflow-y-auto flex-1 min-h-0",children:[u.jsx("button",{onClick:()=>Oe("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showMeaning?"‚ñº":"‚ñ∂"})]}),w.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words",children:A.meaning})]})}),A.etymology&&A.etymology.trim()!==""&&A.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>Oe("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showEtymology?"‚ñº":"‚ñ∂"})]}),w.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.etymology})]})}),A.relatedWords&&A.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>Oe("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showRelated?"‚ñº":"‚ñ∂"})]}),w.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.relatedWords})]})})]})]})})]})}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(Hh,{mode:"memorization",sessionCorrect:Z.correct,sessionReview:Z.still_learning,sessionIncorrect:Z.incorrect,totalAnswered:Z.total,currentWord:A==null?void 0:A.word,onAnswerTime:Ge,learningStatusTabPulseKey:ce,lastAnswerCorrect:q,lastAnswerWord:ve,lastAnswerDifficulty:A==null?void 0:A.difficulty,correctStreak:ke,incorrectStreak:Re,learningPhase:Xt.state.currentPhase??void 0,estimatedSpeed:(Rt=Xt.state.personalParams)==null?void 0:Rt.learningSpeed,onShowSettings:()=>a(!0),dataSource:c,category:d==="all"?"ÂÖ®ÂàÜÈáé":d,difficulty:f,wordPhraseFilter:m,onReviewFocus:nt,isReviewFocusMode:Q,onResetProgress:Ct,onDebugRequeue:st})})}),i&&u.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-lg p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold",children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-datasource",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsxs("select",{id:"memorization-datasource",value:c,onChange:he=>l(he.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà"}),e.filter(he=>he.id!=="all").map(he=>u.jsx("option",{value:he.id,children:he.name},he.id))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-filter",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìù ÂçòË™û„ÉªÁÜüË™û:"}),u.jsxs("select",{id:"memorization-filter",value:m,onChange:he=>g(he.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂçòË™ûÔºãÁÜüË™û"}),u.jsx("option",{value:"words",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-category",className:"block text-sm font-medium mb-2 text-gray-700",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"memorization-category",value:d,onChange:he=>h(he.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂàÜÈáé"}),Be().map(he=>u.jsx("option",{value:he,children:he},he))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-difficulty",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìä Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"memorization-difficulty",value:f,onChange:he=>p(he.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®Èõ£ÊòìÂ∫¶"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö:"}),u.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Êú™ÂÖ•Âäõ„ÅÆÂ†¥Âêà„ÅØÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center mb-2",children:[u.jsx("input",{type:"checkbox",checked:x!==null,onChange:he=>{he.target.checked?(y(50),localStorage.setItem("memorization-still-learning-limit","50")):(y(null),localStorage.removeItem("memorization-still-learning-limit"))},className:"mr-2 w-4 h-4"}),u.jsx("span",{className:"text-sm",children:"üü° „Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê„ÇíË®≠ÂÆö"})]}),x!==null&&u.jsxs("div",{className:"ml-6",children:[u.jsx("select",{value:x,title:"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê",onChange:he=>{const We=parseInt(he.target.value);y(We),localStorage.setItem("memorization-still-learning-limit",We.toString())},className:"w-full px-3 py-2 border rounded-lg bg-white",children:[5,10,20,30,50,100,150,200].map(he=>u.jsx("option",{value:he,children:he},he))}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„Çâ„ÄÅÂæ©Áøí„É¢„Éº„Éâ„Å´Ëá™Âãï„ÅßÂàá„ÇäÊõø„Çè„Çä„Åæ„Åô"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center mb-2",children:[u.jsx("input",{type:"checkbox",checked:b!==null,onChange:he=>{he.target.checked?(v(30),localStorage.setItem("memorization-incorrect-limit","30")):(v(null),localStorage.removeItem("memorization-incorrect-limit"))},className:"mr-2 w-4 h-4"}),u.jsx("span",{className:"text-sm",children:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê„ÇíË®≠ÂÆö"})]}),b!==null&&u.jsxs("div",{className:"ml-6",children:[u.jsx("select",{value:b,title:"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê",onChange:he=>{const We=parseInt(he.target.value);v(We),localStorage.setItem("memorization-incorrect-limit",We.toString())},className:"w-full px-3 py-2 border rounded-lg bg-white",children:[5,10,20,30,50,100,150,200].map(he=>u.jsx("option",{value:he,children:he},he))}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„Çâ„ÄÅÂæ©Áøí„É¢„Éº„Éâ„Å´Ëá™Âãï„ÅßÂàá„ÇäÊõø„Çè„Çä„Åæ„Åô"})]})]})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üîä Ëá™ÂãïÁô∫Èü≥Ë®≠ÂÆö:"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:I,onChange:he=>ot(he.target.checked,k,N),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ëá™Âãï„ÅßÁô∫Èü≥„Åô„Çã"})]}),I&&u.jsxs("div",{className:"ml-6 space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:k,onChange:he=>ot(I,he.target.checked,N),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ë™ûÂè•„ÇíË™≠„Åø‰∏ä„Åí"})]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:N,onChange:he=>ot(I,k,he.target.checked),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"ÊÑèÂë≥„ÇíË™≠„Åø‰∏ä„Åí"})]}),N&&u.jsxs("div",{className:"ml-6 mt-2",children:[u.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["‚è±Ô∏è Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî: ",P.toFixed(1),"Áßí"]}),u.jsx("input",{type:"range",min:"0.5",max:"5.0",step:"0.5",value:P,onChange:he=>{const We=parseFloat(he.target.value);j(We),ot(I,k,N,We)},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer","aria-label":"Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî"}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0.5Áßí"}),u.jsx("span",{children:"5.0Áßí"})]})]})]})]})]})]})]}),u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:_e,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{ref:He,className:"question-card w-full h-[600px] sm:h-[650px] md:h-[700px] flex flex-col",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${xn()?"clickable-pronunciation":""}`,onClick:he=>{xn()&&(he.preventDefault(),he.stopPropagation(),As(A.word,{rate:.85}))},onTouchEnd:he=>{xn()&&(he.preventDefault(),he.stopPropagation(),As(A.word,{rate:.85}))},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${A.word.includes(" ")?"phrase-text":""} ${xn()?"clickable-word":""}`,children:[A.word,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),A.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",A.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[A.difficulty&&u.jsx("div",{className:`difficulty-badge ${A.difficulty}`,children:A.difficulty==="beginner"?"ÂàùÁ¥ö":A.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),s&&r&&o&&u.jsx(ra,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[u.jsxs("button",{onClick:()=>Dt("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>Dt("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>Dt("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("button",{onClick:()=>Oe("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showMeaning?"‚ñº":"‚ñ∂"})]}),w.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words",children:A.meaning})]})}),A.etymology&&A.etymology.trim()!==""&&A.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>Oe("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showEtymology?"‚ñº":"‚ñ∂"})]}),w.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.etymology})]})}),A.relatedWords&&A.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>Oe("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showRelated?"‚ñº":"‚ñ∂"})]}),w.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.relatedWords})]})})]})]})]})})]}),$t&&u.jsx(Kh,{mode:"memorization",currentIndex:M,totalQuestions:D.length,questions:D,requeuedWords:X(D,M)})]}):u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})})}const BY=({isOpen:n,onClose:e,sets:t,onCreateSet:s,onDeleteSet:r,onEditSet:o,onRemoveWord:i})=>{const[a,c]=T.useState("manage"),[l,d]=T.useState(""),[h,f]=T.useState(""),[p,m]=T.useState(null),[g,x]=T.useState(null),[y,b]=T.useState(""),[v,w]=T.useState("");if(!n)return null;const S=()=>{l.trim()&&(s(l.trim(),h.trim()||void 0),d(""),f(""),c("manage"))},I=$=>{x($.id),b($.name),w($.description||"")},C=()=>{g&&y.trim()&&(o(g,y.trim(),v.trim()||void 0),x(null))},k=()=>{x(null),b(""),w("")};return u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl sm:max-w-4xl w-full mx-auto max-h-[90vh] flex flex-col",children:[u.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"üìö „Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÁÆ°ÁêÜ"}),u.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700:text-gray-200 text-2xl","aria-label":"Èñâ„Åò„Çã",children:"‚úï"})]}),u.jsxs("div",{className:"flex border-b border-gray-200",children:[u.jsxs("button",{onClick:()=>c("manage"),className:`flex-1 px-6 py-3 font-medium ${a==="manage"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:["üìã „Çª„ÉÉ„ÉàÁÆ°ÁêÜ (",t.length,")"]}),u.jsx("button",{onClick:()=>c("create"),className:`flex-1 px-6 py-3 font-medium ${a==="create"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:"‚ûï Êñ∞Ë¶è‰ΩúÊàê"})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a==="manage"?u.jsx("div",{className:"space-y-4",children:t.length===0?u.jsxs("div",{className:"text-center py-12 text-gray-500",children:[u.jsx("p",{className:"text-lg mb-2",children:"üìù „Åæ„Å†„Çª„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-sm",children:"„ÄåÊñ∞Ë¶è‰ΩúÊàê„Äç„Çø„Éñ„Åã„ÇâÊúÄÂàù„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Çä„Åæ„Åó„Çá„ÅÜ"})]}):t.map($=>u.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[u.jsx("div",{className:"bg-gray-50 p-4",children:g===$.id?u.jsxs("div",{className:"space-y-2",children:[u.jsx("input",{type:"text",value:y,onChange:N=>b(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"„Çª„ÉÉ„ÉàÂêç"}),u.jsx("textarea",{value:v,onChange:N=>w(N.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ",rows:2}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"‰øùÂ≠ò"}),u.jsx("button",{onClick:k,className:"px-4 py-2 bg-gray-300 text-gray-900 rounded-md hover:bg-gray-400:bg-gray-500",children:"„Ç≠„É£„É≥„Çª„É´"})]})]}):u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-2xl",children:$.icon||"üìñ"}),u.jsx("h3",{className:"text-lg font-bold text-gray-900",children:$.name}),u.jsxs("span",{className:"text-sm text-gray-500",children:["(",$.words.length,"Ë™û)"]})]}),$.description&&u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:$.description}),u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["‰ΩúÊàê: ",new Date($.createdAt).toLocaleDateString("ja-JP")]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>I($),className:"text-blue-600 hover:text-blue-700:text-blue-300 text-sm","aria-label":"Á∑®ÈõÜ",children:"‚úèÔ∏è"}),u.jsx("button",{onClick:()=>m(p===$.id?null:$.id),className:"text-gray-600 hover:text-gray-700:text-gray-300 text-sm","aria-label":p===$.id?"Êäò„Çä„Åü„Åü„ÇÄ":"Â±ïÈñã",children:p===$.id?"‚ñ≤":"‚ñº"}),u.jsx("button",{onClick:()=>{confirm(`„Äå${$.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)&&r($.id)},className:"text-red-600 hover:text-red-700:text-red-300 text-sm","aria-label":"ÂâäÈô§",children:"üóëÔ∏è"})]})]})}),p===$.id&&u.jsx("div",{className:"p-4 bg-white",children:$.words.length===0?u.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"„Åæ„Å†ÂçòË™û„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):u.jsx("div",{className:"space-y-2",children:$.words.map((N,_)=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-semibold text-gray-900",children:N.word}),N.ipa&&u.jsxs("span",{className:"text-sm text-blue-600",children:["/",N.ipa,"/"]})]}),u.jsx("p",{className:"text-sm text-gray-700 mt-1",children:N.meaning}),N.source&&u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Âá∫ÂÖ∏: ",N.source,N.sourceDetail&&` (${N.sourceDetail})`]})]}),u.jsx("button",{onClick:()=>i($.id,N),className:"ml-4 text-red-600 hover:text-red-700:text-red-300","aria-label":"ÂâäÈô§",children:"‚ûñ"})]},`${N.word}-${_}`))})})]},$.id))}):u.jsxs("div",{className:"max-w-2xl mx-auto",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["„Çª„ÉÉ„ÉàÂêç ",u.jsx("span",{className:"text-red-500",children:"*"})]}),u.jsx("input",{type:"text",value:l,onChange:$=>d($.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: Ëã¶Êâã„Å™ÂâçÁΩÆË©û"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ"}),u.jsx("textarea",{value:h,onChange:$=>f($.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: È´òÊ†°ÂÖ•Ë©¶„Åß„Çà„ÅèÂá∫„ÇãÂâçÁΩÆË©û„Çí„Åæ„Å®„ÇÅ„Åü„Çª„ÉÉ„Éà",rows:3})]}),u.jsx("button",{onClick:S,disabled:!l.trim(),className:"w-full px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300:bg-gray-600 disabled:cursor-not-allowed font-medium",children:"‚ûï „Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})]}),u.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[u.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"üí° „Éí„É≥„Éà"}),u.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„Éà„Çí‰ΩúÊàêÂæå„ÄÅÂêÑ„Çø„Éñ„ÅÆ+„Éú„Çø„É≥„ÅßÂçòË™û„ÇíËøΩÂä†„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„ÉàÂêç„ÅØÂæå„Åã„ÇâÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ Ë§áÊï∞„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Å£„Å¶„ÄÅ„ÉÜ„Éº„Éû„Åî„Å®„Å´Êï¥ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ"})]})]})]})})]})})};function VY({allQuestions:n,onStartSession:e}){const[t,s]=T.useState(null),[r,o]=T.useState(null),[i]=T.useState(3),[a,c]=T.useState({totalLearned:0,totalReviewed:0,averageAccuracy:0,estimatedCompletion:90});if(T.useEffect(()=>{const g=localStorage.getItem("learning-schedule-90days");if(g)try{const x=JSON.parse(g),y=Math.floor((Date.now()-x.startDate)/(1e3*60*60*24)),b=x.totalDays;x.currentDay=Math.min(y+1,b);const v=Math.floor(b/3),w=Math.floor(b*2/3);x.phase=x.currentDay<=v?1:x.currentDay<=w?2:3,s(x),o(ck(x,n))}catch(x){E.error("Failed to load schedule:",x)}},[n]),T.useEffect(()=>{if(t){c(lk(t));const g=document.querySelector(".progress-bar");if(g){const x=t.currentDay,y=t.totalDays,b=x/y*100;g.style.width=`${b}%`}}},[t]),!t)return null;const l=["Âü∫Á§éÂõ∫„ÇÅÊúü","ÂøúÁî®Êã°Â§ßÊúü","ÂÆåÊàê„ÉªÂÆöÁùÄÊúü"],d=t.phase,h=t.currentDay,f=t.totalDays,p=h/f*100,m=uk(t);return u.jsxs("div",{className:"learning-plan-dashboard",children:[u.jsxs("div",{className:"dashboard-header",children:[u.jsxs("div",{className:"day-counter",children:[u.jsx("span",{className:"day-number",children:h}),u.jsxs("span",{className:"day-label",children:["/ ",f,"Êó•ÁõÆ"]})]}),u.jsxs("div",{className:"phase-indicator",children:[u.jsxs("span",{className:`phase-badge phase-${d}`,children:["Phase ",d]}),u.jsx("span",{className:"phase-name",children:l[d-1]})]}),u.jsxs("div",{className:"progress-bar-container",children:[u.jsx("div",{className:`progress-bar phase-${d}`}),u.jsxs("span",{className:"progress-label",children:[p.toFixed(1),"%"]})]})]}),u.jsxs("div",{className:"stats-summary",children:[u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üìö"}),u.jsx("div",{className:"stat-value",children:a.totalLearned}),u.jsx("div",{className:"stat-label",children:"Â≠¶ÁøíÊ∏à„ÅøÂçòË™û"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚úÖ"}),u.jsxs("div",{className:"stat-value",children:[a.averageAccuracy.toFixed(1),"%"]}),u.jsx("div",{className:"stat-label",children:"Âπ≥ÂùáÊ≠£Á≠îÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üéØ"}),u.jsxs("div",{className:"stat-value",children:[m>0?m.toFixed(0):0,"%"]}),u.jsx("div",{className:"stat-label",children:"‰ªäÈÄ±„ÅÆÈÅîÊàêÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚è±Ô∏è"}),u.jsx("div",{className:"stat-value",children:a.estimatedCompletion}),u.jsx("div",{className:"stat-label",children:"ÂÆå‰∫Ü„Åæ„ÅßÔºàÊó•Ôºâ"})]})]}),r&&u.jsxs("div",{className:"today-plan",children:[u.jsxs("h2",{children:["üìñ ‰ªäÊó•„ÅÆÂ≠¶Áøí„Éó„É©„É≥ÔºàDay ",h,"Ôºâ"]}),u.jsxs("div",{className:"session-cards",children:[u.jsxs("div",{className:"session-card morning",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåÖ"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊúùÔºöÊñ∞Ë¶èÂ≠¶Áøí"}),u.jsxs("p",{children:[r.morning.newWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("morning",r.morning.newWords),className:"btn-start-session",disabled:r.morning.newWords.length===0,children:r.morning.newWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card afternoon",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"‚òÄÔ∏è"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊòºÔºöÂº±ÁÇπÂæ©Áøí"}),u.jsxs("p",{children:[r.afternoon.reviewWords.length,"Ë™û ¬∑ 15ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("afternoon",r.afternoon.reviewWords),className:"btn-start-session",disabled:r.afternoon.reviewWords.length===0,children:r.afternoon.reviewWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card evening",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåô"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"Â§úÔºöÁ∑èÂêàÊºîÁøí"}),u.jsxs("p",{children:[r.evening.mixedWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("evening",r.evening.mixedWords),className:"btn-start-session",disabled:r.evening.mixedWords.length===0,children:r.evening.mixedWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]})]})]}),u.jsxs("div",{className:"milestones",children:[u.jsx("h2",{children:"üèÜ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥"}),u.jsx("div",{className:"milestone-list",children:t.milestones.map((g,x)=>{const y=h>g.day,b=h===g.day,v=a.totalLearned>=g.wordsTarget;return u.jsxs("div",{className:`milestone-item ${v?"achieved":""} ${b?"current":""} ${y?"passed":""}`,children:[u.jsxs("div",{className:"milestone-day",children:["Day ",g.day]}),u.jsx("div",{className:"milestone-title",children:g.title}),u.jsxs("div",{className:"milestone-target",children:[g.wordsTarget,"Ë™û"]}),v&&u.jsx("span",{className:"check-mark",children:"‚úì"})]},x)})})]})]})}const UY=()=>{const[n,e]=T.useState("prepositions");return u.jsxs("div",{className:"grammar-guide-view p-4 max-w-app mx-auto",children:[u.jsxs("div",{className:"grammar-guide-tabs grid grid-cols-3 gap-1 sm:gap-2 mb-4",children:[u.jsxs("button",{onClick:()=>e("prepositions"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="prepositions"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üìç ÂâçÁΩÆË©û"}),u.jsx("span",{className:"sm:hidden",children:"ÂâçÁΩÆË©û"})]}),u.jsxs("button",{onClick:()=>e("punctuation"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="punctuation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"‚úèÔ∏è Ë®òÂè∑"}),u.jsx("span",{className:"sm:hidden",children:"Ë®òÂè∑"})]}),u.jsxs("button",{onClick:()=>e("tips"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="tips"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° Ë™≠Ëß£„Ç≥„ÉÑ"}),u.jsx("span",{className:"sm:hidden",children:"Ë™≠Ëß£„Ç≥„ÉÑ"})]})]}),u.jsxs("div",{className:"content-area bg-white rounded-lg p-4 shadow-md border border-gray-200",children:[n==="prepositions"&&u.jsx(GY,{}),n==="punctuation"&&u.jsx(HY,{}),n==="tips"&&u.jsx(qY,{})]})]})},GY=()=>u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"ÂâçÁΩÆË©û„ÅÆ„Éã„É•„Ç¢„É≥„Çπ„Å®‰Ωø„ÅÑÂàÜ„Åë"}),u.jsx("p",{className:"text-text-secondary mb-6",children:"Ëã±Ë™û„ÅßÊúÄ„ÇÇÈ†ªÁπÅ„Å´‰Ωø„ÅÜÂâçÁΩÆË©û„ÇíÈáçË¶ÅÂ∫¶È†Ü„Å´Á¥π‰ªã„Åó„Åæ„Åô„ÄÇ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Ç¢„Ç§„É°„Éº„Ç∏„ÇíÁêÜËß£„Åô„Çã„Åì„Å®„Åß„ÄÅËá™ÁÑ∂„Å™Ëã±Ë™ûË°®Áèæ„ÅåË∫´„Å´„Å§„Åç„Åæ„Åô„ÄÇ"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üåü ÊúÄÈáçË¶ÅÔºöÊôÇÈñì„ÉªÂ†¥ÊâÄ„ÅÆÂü∫Êú¨3„Å§"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚û°Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"TO"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„ÄåÊñπÂêë„ÉªÂà∞ÈÅîÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß≠"})," ÊñπÂêë„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üè´ ",u.jsx("strong",{children:"to school"})," ‚Üí Â≠¶Ê†°„Å∏ÔºàÊñπÂêëÔºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üóº ",u.jsx("strong",{children:"to Tokyo"})," ‚Üí Êù±‰∫¨„Å∏ÔºàÁõÆÁöÑÂú∞Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üîÑ"})," ÁØÑÂõ≤„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üìä ",u.jsx("strong",{children:"from A to B"})," ‚Üí A„Åã„ÇâB„Åæ„ÅßÔºàÁØÑÂõ≤Ôºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üïê ",u.jsx("strong",{children:"from 9 to 5"})," ‚Üí 9ÊôÇ„Åã„Çâ5ÊôÇ„Åæ„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üéØ"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"FOR"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„ÄåÁõÆÁöÑ„ÉªÂØæË±°„ÉªÊúüÈñì„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üíù"})," ÁõÆÁöÑ„ÉªÂØæË±°„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üë§ ",u.jsx("strong",{children:"for you"})," ‚Üí „ÅÇ„Å™„Åü„ÅÆ„Åü„ÇÅ„Å´ÔºàÂØæË±°Ôºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üç≥ ",u.jsx("strong",{children:"for breakfast"})," ‚Üí ÊúùÈ£ü„Å®„Åó„Å¶ÔºàÁõÆÁöÑÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"})," ÊúüÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["‚è∞ ",u.jsx("strong",{children:"for 3 hours"})," ‚Üí 3ÊôÇÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üìÖ ",u.jsx("strong",{children:"for a week"})," ‚Üí 1ÈÄ±ÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]})]})]})]})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üé¨"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"FROM"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„ÄåËµ∑ÁÇπ„ÉªÂá∫Áô∫ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," Ëµ∑ÁÇπ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üè† ",u.jsx("strong",{children:"from home"})," ‚Üí ÂÆ∂„Åã„ÇâÔºàÂá∫Áô∫ÁÇπÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üáØüáµ ",u.jsx("strong",{children:"from Japan"})," ‚Üí Êó•Êú¨„Åã„ÇâÔºàÂá∫Ë∫´Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," ÊôÇÈñì„ÅÆËµ∑ÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["‚è∞ ",u.jsx("strong",{children:"from 9 am"})," ‚Üí 9ÊôÇ„Åã„ÇâÔºàÈñãÂßãÊôÇÂàªÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"from Monday"})," ‚Üí ÊúàÊõúÊó•„Åã„Çâ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üìå „Çà„Åè‰Ωø„ÅÜÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"ü§ù"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"WITH"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå‰∏ÄÁ∑í„Å´„Éª‰Ωø„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë•"})," ‰º¥„ÅÜÁõ∏ÊâãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üë®‚Äçüë©‚Äçüëß ",u.jsx("strong",{children:"with my family"})," ‚Üí ÂÆ∂Êóè„Å®‰∏ÄÁ∑í„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üßë‚Äçü§ù‚Äçüßë ",u.jsx("strong",{children:"with friends"})," ‚Üí ÂèãÈÅî„Å®"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üõ†Ô∏è"})," ‰Ωø„ÅÜÈÅìÂÖ∑Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["‚úèÔ∏è ",u.jsx("strong",{children:"with a pen"})," ‚Üí „Éö„É≥„ÅßÔºàÈÅìÂÖ∑Ôºâ"]}),u.jsxs("div",{className:"text-indigo-600",children:["üç¥ ",u.jsx("strong",{children:"with chopsticks"})," ‚Üí ÁÆ∏„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-amber-50/20 rounded-lg p-5 border-2 border-amber-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöó"}),u.jsx("div",{className:"text-2xl font-bold text-amber-600 mt-2",children:"BY"}),u.jsx("div",{className:"text-sm text-amber-700 mt-1",children:"„Äå„Äú„ÅÆ„Åù„Å∞„Å´„ÉªÊâãÊÆµ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üöå"})," ÊâãÊÆµ„ÉªÊñπÊ≥ïÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üöÜ ",u.jsx("strong",{children:"by train"})," ‚Üí ÈõªËªä„ÅßÔºà‰∫§ÈÄöÊâãÊÆµÔºâ"]}),u.jsxs("div",{className:"text-amber-600",children:["‚úâÔ∏è ",u.jsx("strong",{children:"by email"})," ‚Üí „É°„Éº„É´„ÅßÔºàÈÄö‰ø°ÊâãÊÆµÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," „Åù„Å∞„Å´Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üåä ",u.jsx("strong",{children:"by the sea"})," ‚Üí Êµ∑„ÅÆ„Åù„Å∞„Å´"]}),u.jsxs("div",{className:"text-amber-600",children:["ü™ü ",u.jsx("strong",{children:"by the window"})," ‚Üí Á™ì„ÅÆ„Åù„Å∞„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-rose-50/20 rounded-lg p-5 border-2 border-rose-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üîó"}),u.jsx("div",{className:"text-2xl font-bold text-rose-600 mt-2",children:"OF"}),u.jsx("div",{className:"text-sm text-rose-700 mt-1",children:"„Äå„Äú„ÅÆÔºàÊâÄÂ±û„ÉªÈÉ®ÂàÜÔºâ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üëë"})," ÊâÄÂ±û„ÉªÊâÄÊúâÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üìö ",u.jsx("strong",{children:"the book of mine"})," ‚Üí ÁßÅ„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-rose-600",children:["üèõÔ∏è ",u.jsx("strong",{children:"the capital of Japan"})," ‚Üí Êó•Êú¨„ÅÆÈ¶ñÈÉΩ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß©"})," ÈÉ®ÂàÜÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üç∞ ",u.jsx("strong",{children:"a piece of cake"})," ‚Üí „Ç±„Éº„Ç≠‰∏ÄÂàá„Çå"]}),u.jsxs("div",{className:"text-rose-600",children:["üíß ",u.jsx("strong",{children:"a glass of water"})," ‚Üí „Ç≥„ÉÉ„Éó‰∏ÄÊùØ„ÅÆÊ∞¥"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üí´ ‰∏≠È†ªÂ∫¶„ÅÆÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üí≠"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"ABOUT"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„Å´„Å§„ÅÑ„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"})," Ë©±È°å„ÉªÂÜÖÂÆπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üìö ",u.jsx("strong",{children:"a book about history"})," ‚Üí Ê≠¥Âè≤„Å´„Å§„ÅÑ„Å¶„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-cyan-600",children:["üí¨ ",u.jsx("strong",{children:"talk about sports"})," ‚Üí „Çπ„Éù„Éº„ÉÑ„Å´„Å§„ÅÑ„Å¶Ë©±„Åô"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," „Åä„Åä„Çà„Åù„ÅÆÊï∞Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["‚è∞ ",u.jsx("strong",{children:"about 10 minutes"})," ‚Üí Á¥Ñ10ÂàÜ"]}),u.jsxs("div",{className:"text-cyan-600",children:["üë• ",u.jsx("strong",{children:"about 50 people"})," ‚Üí Á¥Ñ50‰∫∫"]})]})]})]})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≠Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"AFTER"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂæåÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"after dinner"})," ‚Üí Â§ïÈ£ü„ÅÆÂæå"]}),u.jsxs("div",{className:"text-lime-600",children:["üè´ ",u.jsx("strong",{children:"after school"})," ‚Üí ÊîæË™≤Âæå"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫èÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üî§ ",u.jsx("strong",{children:"after you"})," ‚Üí „ÅäÂÖà„Å´„Å©„ÅÜ„Åû"]}),u.jsxs("div",{className:"text-lime-600",children:["üìù ",u.jsx("strong",{children:"one after another"})," ‚Üí Ê¨°„ÄÖ„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-sky-50/20 rounded-lg p-5 border-2 border-sky-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚èÆÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-sky-600 mt-2",children:"BEFORE"}),u.jsx("div",{className:"text-sm text-sky-700 mt-1",children:"„Äå„Äú„ÅÆÂâç„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂâçÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"before breakfast"})," ‚Üí ÊúùÈ£üÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üéÑ ",u.jsx("strong",{children:"before Christmas"})," ‚Üí „ÇØ„É™„Çπ„Éû„Çπ„ÅÆÂâç"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫è„Éª‰ΩçÁΩÆÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üö™ ",u.jsx("strong",{children:"before the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üë• ",u.jsx("strong",{children:"before everyone"})," ‚Üí „Åø„Çì„Å™„ÅÆÂâç„Åß"]})]})]})]})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-violet-50/20 rounded-lg p-5 border-2 border-violet-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-violet-600 mt-2",children:"OVER"}),u.jsx("div",{className:"text-sm text-violet-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ä„ÇíË∂ä„Åà„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"ü¶Ö"})," ‰∏äÊñπ„ÉªË∂ä„Åà„ÇãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üåâ ",u.jsx("strong",{children:"over the bridge"})," ‚Üí Ê©ã„ÇíË∂ä„Åà„Å¶"]}),u.jsxs("div",{className:"text-violet-600",children:["üèîÔ∏è ",u.jsx("strong",{children:"over the mountain"})," ‚Üí Â±±„ÇíË∂ä„Åà„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," ‰ª•‰∏ä„ÉªË∂ÖÈÅéÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üë• ",u.jsx("strong",{children:"over 100 people"})," ‚Üí 100‰∫∫‰ª•‰∏ä"]}),u.jsxs("div",{className:"text-violet-600",children:["üí∞ ",u.jsx("strong",{children:"over $50"})," ‚Üí 50„Éâ„É´‰ª•‰∏ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-slate-50/20 rounded-lg p-5 border-2 border-slate-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚¨áÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-slate-600 mt-2",children:"UNDER"}),u.jsx("div",{className:"text-sm text-slate-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ã„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨áÔ∏è"})," ‰∏ãÊñπ„Éª‰∏ãÂÅ¥Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üå≥ ",u.jsx("strong",{children:"under the tree"})," ‚Üí Êú®„ÅÆ‰∏ã„Å´"]}),u.jsxs("div",{className:"text-slate-600",children:["üåâ ",u.jsx("strong",{children:"under the bridge"})," ‚Üí Ê©ã„ÅÆ‰∏ã„Å´"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," Êú™Ê∫ÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üë∂ ",u.jsx("strong",{children:"under 18"})," ‚Üí 18Ê≠≥Êú™Ê∫Ä"]}),u.jsxs("div",{className:"text-slate-600",children:["üí∞ ",u.jsx("strong",{children:"under $10"})," ‚Üí 10„Éâ„É´Êú™Ê∫Ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-fuchsia-50/20 rounded-lg p-5 border-2 border-fuchsia-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöá"}),u.jsx("div",{className:"text-2xl font-bold text-fuchsia-600 mt-2",children:"THROUGH"}),u.jsx("div",{className:"text-sm text-fuchsia-700 mt-1",children:"„Äå„Äú„ÇíÈÄö„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üö™"})," ÈÄöÈÅé„ÉªË≤´ÈÄöÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["ü™ü ",u.jsx("strong",{children:"through the window"})," ‚Üí Á™ì„ÇíÈÄö„Å£„Å¶"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üå≤ ",u.jsx("strong",{children:"through the forest"})," ‚Üí Ê£Æ„ÇíÊäú„Åë„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊúüÈñìÂÖ®‰ΩìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["üåô ",u.jsx("strong",{children:"through the night"})," ‚Üí ‰∏ÄÊô©‰∏≠"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üåßÔ∏è ",u.jsx("strong",{children:"through the winter"})," ‚Üí ÂÜ¨„ÅÆÈñì„Åö„Å£„Å®"]})]})]})]})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚ú® Áü•„Å£„Å¶„Åä„Åè„Å®‰æøÂà©„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-emerald-50/20 rounded-lg p-5 border-2 border-emerald-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚ÜîÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-emerald-600 mt-2",children:"BETWEEN"}),u.jsx("div",{className:"text-sm text-emerald-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà2„Å§Ôºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-emerald-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," 2„Å§„ÅÆÈñìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-emerald-600",children:["üè´üè• ",u.jsx("strong",{children:"between the school and hospital"})," ‚Üí Â≠¶Ê†°„Å®ÁóÖÈô¢„ÅÆÈñì"]}),u.jsxs("div",{className:"text-emerald-600",children:["üë• ",u.jsx("strong",{children:"between you and me"})," ‚Üí „ÅÇ„Å™„Åü„Å®ÁßÅ„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë•"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AMONG"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà3„Å§‰ª•‰∏äÔºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶"})," Ë§áÊï∞„ÅÆ‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üå∏ ",u.jsx("strong",{children:"among the flowers"})," ‚Üí Ëä±„ÄÖ„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-orange-600",children:["üë• ",u.jsx("strong",{children:"among friends"})," ‚Üí Âèã‰∫∫„Åü„Å°„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-red-50/20 rounded-lg p-5 border-2 border-red-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üö´"}),u.jsx("div",{className:"text-2xl font-bold text-red-600 mt-2",children:"WITHOUT"}),u.jsx("div",{className:"text-sm text-red-700 mt-1",children:"„Äå„Äú„Å™„Åó„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-red-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ùå"})," Ê¨†Â¶Ç„Éª‰∏çÂú®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-red-600",children:["üíß ",u.jsx("strong",{children:"without water"})," ‚Üí Ê∞¥„Å™„Åó„Åß"]}),u.jsxs("div",{className:"text-red-600",children:["üë§ ",u.jsx("strong",{children:"without you"})," ‚Üí „ÅÇ„Å™„Åü„Å™„Åó„Åß"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-yellow-50/20 rounded-lg p-5 border-2 border-yellow-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≥"}),u.jsx("div",{className:"text-2xl font-bold text-yellow-600 mt-2",children:"DURING"}),u.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-yellow-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," ÊúüÈñì‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-yellow-600",children:["üå¥ ",u.jsx("strong",{children:"during summer vacation"})," ‚Üí Â§è‰ºë„Åø„ÅÆÈñì"]}),u.jsxs("div",{className:"text-yellow-600",children:["üé• ",u.jsx("strong",{children:"during the movie"})," ‚Üí Êò†Áîª„ÅÆÈñì"]})]})]})})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è∞"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"UNTIL/TILL"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„Äå„Äú„Åæ„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," Á∂ôÁ∂ö„ÅÆÁµÇÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üåô ",u.jsx("strong",{children:"until midnight"})," ‚Üí ÁúüÂ§ú‰∏≠„Åæ„Åß"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"until next week"})," ‚Üí Êù•ÈÄ±„Åæ„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÜ"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"SINCE"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„Äå„Äú‰ª•Êù•„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," Ëµ∑ÁÇπ„Åã„ÇâÁ∂ôÁ∂öÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üéÇ ",u.jsx("strong",{children:"since last year"})," ‚Üí ÂéªÂπ¥„Åã„ÇâÔºà„Åö„Å£„Å®Ôºâ"]}),u.jsxs("div",{className:"text-blue-600",children:["üë∂ ",u.jsx("strong",{children:"since childhood"})," ‚Üí Â≠ê‰æõ„ÅÆÈ†É„Åã„Çâ"]})]})]})})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üè† Â†¥ÊâÄ„ÇíË°®„ÅôÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üè¢"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"INSIDE"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„Äå„Äú„ÅÆÂÜÖÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üì¶"})," ÂÜÖÂÅ¥„ÉªÂÜÖÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üè† ",u.jsx("strong",{children:"inside the house"})," ‚Üí ÂÆ∂„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-purple-600",children:["üì¶ ",u.jsx("strong",{children:"inside the box"})," ‚Üí ÁÆ±„ÅÆ‰∏≠„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üå≥"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"OUTSIDE"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„Äå„Äú„ÅÆÂ§ñÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üå≤"})," Â§ñÂÅ¥„ÉªÂ§ñÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üè° ",u.jsx("strong",{children:"outside the house"})," ‚Üí ÂÆ∂„ÅÆÂ§ñ„Å´"]}),u.jsxs("div",{className:"text-green-600",children:["üè´ ",u.jsx("strong",{children:"outside the school"})," ‚Üí Â≠¶Ê†°„ÅÆÂ§ñ„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"NEAR"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„ÅÆËøë„Åè„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üéØ"})," ËøëÊé•Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üöâ ",u.jsx("strong",{children:"near the station"})," ‚Üí ÈßÖ„ÅÆËøë„Åè„Å´"]}),u.jsxs("div",{className:"text-cyan-600",children:["üåä ",u.jsx("strong",{children:"near the sea"})," ‚Üí Êµ∑„ÅÆËøë„Åè„Å´"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë§"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"BEHIND"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Çç„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨ÖÔ∏è"})," ÂæåÊñπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üö™ ",u.jsx("strong",{children:"behind the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂæå„Çç„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üè† ",u.jsx("strong",{children:"behind the house"})," ‚Üí ÂÆ∂„ÅÆË£è„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"ACROSS"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„Äå„Äú„ÇíÊ®™Âàá„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ÜîÔ∏è"})," Ê®™Êñ≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"across the street"})," ‚Üí ÈÄö„Çä„ÇíÊ®™Âàá„Å£„Å¶"]}),u.jsxs("div",{className:"text-pink-600",children:["üåä ",u.jsx("strong",{children:"across the river"})," ‚Üí Â∑ù„ÇíÊ∏°„Å£„Å¶"]})]})]})})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üõ§Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"ALONG"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„Å´Ê≤ø„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚û°Ô∏è"})," Ê≤ø„Å£„Å¶ÈÄ≤„ÇÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"along the street"})," ‚Üí ÈÄö„Çä„Å´Ê≤ø„Å£„Å¶"]}),u.jsxs("div",{className:"text-lime-600",children:["üåä ",u.jsx("strong",{children:"along the river"})," ‚Üí Â∑ùÊ≤ø„ÅÑ„Å´"]})]})]})})]})]})})]}),HY=()=>{const n=[{symbol:".",name:"Period („Éî„É™„Ç™„Éâ)",usage:"Êñá„ÅÆÁµÇ„Çè„Çä",example:"I like cats.",explanation:"Âπ≥ÂèôÊñá„ÉªÂëΩ‰ª§Êñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:",",name:"Comma („Ç≥„É≥„Éû)",usage:"Âå∫Âàá„Çä„ÉªÂàóÊåô",example:"I bought apples, oranges, and bananas.",explanation:"ÂçòË™û„ÇÑÂè•„ÇíÂå∫Âàá„Çã„ÄÇÊé•Á∂öË©û„ÅÆÂâç„Å´„ÇÇ‰ΩøÁî®"},{symbol:"!",name:"Exclamation Mark (ÊÑüÂòÜÁ¨¶)",usage:"ÊÑüÂòÜ„ÉªÂº∑Ë™ø",example:"What a beautiful day!",explanation:"È©ö„Åç„ÉªÂñú„Å≥„ÉªÂº∑„ÅÑÊÑüÊÉÖ„ÇíË°®„Åô"},{symbol:"?",name:"Question Mark (ÁñëÂïèÁ¨¶)",usage:"ÁñëÂïè",example:"Do you like music?",explanation:"ÁñëÂïèÊñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:":",name:"Colon („Ç≥„É≠„É≥)",usage:"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•",example:"I have three pets: a dog, a cat, and a bird.",explanation:"Âæå„Çç„Å´Ë™¨Êòé„ÇÑÂàóÊåô„ÅåÁ∂ö„Åè„Åì„Å®„ÇíÁ§∫„Åô"},{symbol:";",name:"Semicolon („Çª„Éü„Ç≥„É≠„É≥)",usage:"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",example:"I love reading; my sister prefers sports.",explanation:"„Éî„É™„Ç™„Éâ„Çà„ÇäÂº±„Åè„ÄÅ„Ç≥„É≥„Éû„Çà„ÇäÂº∑„ÅÑÂå∫Âàá„Çä"},{symbol:"-",name:"Hyphen („Éè„Ç§„Éï„É≥)",usage:"Ë§áÂêàË™û„ÉªË£úË∂≥",example:"a well-known writer",explanation:"2„Å§‰ª•‰∏ä„ÅÆÂçòË™û„ÇíÁπã„Åí„Çã"},{symbol:"‚Äî",name:"Em Dash („ÉÄ„ÉÉ„Ç∑„É•)",usage:"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•",example:"My friends‚ÄîJohn and Mary‚Äîare coming.",explanation:"Ë£úË∂≥ÊÉÖÂ†±„ÇíÊåøÂÖ•„Åô„Çã"}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Ëã±ÊñáË®òÂè∑„ÅÆÊÑèÂë≥„Å®‰Ωø„ÅÑÊñπ"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-5 hover:shadow-lg transition-shadow border border-border-color",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[u.jsx("div",{className:"text-5xl font-bold text-primary flex-shrink-0",children:e.symbol}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-lg font-bold text-text-color",children:e.name}),u.jsx("p",{className:"text-sm text-primary font-semibold",children:e.usage})]})]}),u.jsx("div",{className:"bg-blue-50/20 rounded p-3 mb-3",children:u.jsx("div",{className:"font-mono text-sm text-blue-600",children:e.example})}),u.jsx("p",{className:"text-sm text-text-secondary",children:e.explanation})]},t))})]})},qY=()=>{const n=[{icon:"üìù",title:"ÊúÄÂàù„Å´Ê≥®Èáà„Å®Ë®≠Âïè„ÇíÁ¢∫Ë™ç",description:"Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´„ÄÅÊ≥®Èáà„Å®ÂïèÈ°å„Åã„ÇâÈáçË¶Å„Å™Êâã„Åå„Åã„Çä„ÇíÂæó„Çã",details:["Ê≥®Èáà„ÅØÂçò„Å´Èõ£„Åó„ÅÑÂçòË™û„ÅÆÊÑèÂë≥„Åß„ÅØ„Å™„Åè„ÄÅÂÜÖÂÆπÁêÜËß£„ÅÆ„Ç´„ÇÆ","Ê≥®Èáà„ÅÆÂçòË™û„ÇíÈÄ£ÊÉ≥„Åô„Çã„Å®Èï∑Êñá„ÅÆ„ÅÇ„Çâ„Åô„Åò„ÅåË¶ã„Åà„Å¶„Åè„Çã","Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ„ÇÑÂ§ßÊÑè„ÇíÂïè„ÅÜË®≠Âïè„Åã„Çâ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÊãæ„ÅÜ","ÈÉ®ÂàÜÁöÑ„Å™ÈÅ∏ÊäûÂïèÈ°å„ÅÆÈÅ∏ÊäûËÇ¢„Å´„ÇÇÂÖ±ÈÄö„Ç≠„Éº„ÉØ„Éº„Éâ„ÅåÈö†„Çå„Å¶„ÅÑ„Çã"]},{icon:"üéØ",title:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÅßÂÖ®‰ΩìÂÉè„ÇíÊé¥„ÇÄ",description:"Ëã±Ë™û„ÅÆÊñáÁ´†„ÅØ„ÄåÁµêË´ñÂÖàÂá∫„Åó„Äç„ÅåÂü∫Êú¨„ÄÇÊúÄÂàù„Å´ÂÖ®‰Ωì„ÅÆÊñπÂêëÊÄß„ÅåÁ§∫„Åï„Çå„Çã",example:{title:"The Importance of Reading Books",para1:"Reading books is one of the best ways to improve your knowledge and imagination. Many people think that reading is boring, but it actually helps you learn new things and understand the world better.",explanation:`„Çø„Ç§„Éà„É´: „ÄåÊú¨„ÇíË™≠„ÇÄÈáçË¶ÅÊÄß„Äç‚Üí „ÉÜ„Éº„ÉûÁ¢∫ÂÆö
Á¨¨1ÊÆµËêΩ: „ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅØÁü•Ë≠ò„Å®ÊÉ≥ÂÉèÂäõ„ÇíÈ´ò„ÇÅ„ÇãÊúÄËâØ„ÅÆÊñπÊ≥ï„ÅÆ1„Å§„Äç‚Üí Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ
‚Üí „Åì„ÅÆÊôÇÁÇπ„Åß„ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅÆËâØ„ÅÑÁÇπ„Å´„Å§„ÅÑ„Å¶Ëø∞„Åπ„ÇãÊñáÁ´†„Äç„Å†„Å®ÂàÜ„Åã„Çã`},details:["„Çø„Ç§„Éà„É´ ‚Üí Ë©±È°åÔºà„Éà„Éî„ÉÉ„ÇØÔºâ„ÇíÁ§∫„Åô","Á¨¨1ÊÆµËêΩ ‚Üí Á≠ÜËÄÖ„ÅÆÁ´ãÂ†¥„Éª‰∏ªÂºµ„ÇíÊòéÁ¢∫„Å´„Åô„Çã","„Äå‰Ωï„Å´„Å§„ÅÑ„Å¶„Äç„Äå„Å©„ÅÜËÄÉ„Åà„Å¶„ÅÑ„Çã„Åã„Äç„Çí„É°„É¢„Åô„Çã„Å®Êï¥ÁêÜ„Åó„ÇÑ„Åô„ÅÑ","ÂïèÈ°åÊèêËµ∑ÔºàÁñëÂïèÔºâ‚Üí Êú¨Êñá„ÅßÁ≠î„Åà„ÇíÊé¢„Åô„Éë„Çø„Éº„É≥„ÇÇÂ§ö„ÅÑ"]},{icon:"üìç",title:"ÊÆµËêΩ„ÅÆÊúÄÂàù„Å®ÊúÄÂæå„Å´Ê≥®ÁõÆ",description:"Ëã±Ë™û„ÅØ„Äå„Éë„É©„Ç∞„É©„Éï„Éª„É™„Éº„Éá„Ç£„É≥„Ç∞„Äç„ÄÇ1ÊÆµËêΩ = 1„Å§„ÅÆ‰∏ªÂºµ",example:{structure:`„ÄêÂÖ∏ÂûãÁöÑ„Å™ÊÆµËêΩÊßãÈÄ†„Äë
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ
„ÄåÈÅãÂãï„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Äç‚Üê ÊÆµËêΩ„ÅÆ‰∏ªÂºµ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‰∏≠ÈñìÈÉ®Ôºà„Çµ„Éù„Éº„ÉàÔºâ
ÁêÜÁî±1: ‰Ωì„ÅåÂº∑„Åè„Å™„Çã
ÁêÜÁî±2: „Çπ„Éà„É¨„ÇπËß£Ê∂à„Å´„Å™„Çã
ÂÖ∑‰Ωì‰æã: ÊØéÊó•30ÂàÜÊ≠©„Åè„Å†„Åë„ÅßÂäπÊûú
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ÊúÄÁµÇÊñáÔºà„Åæ„Å®„ÇÅÔºâ
„Äå„Å†„Åã„ÇâÈÅãÂãï„ÇíÁøíÊÖ£„Å´„Åô„Åπ„Åç„Äç‚Üê ÁµêË´ñ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`,tips:"Á¨¨1Êñá„Å®ÊúÄÁµÇÊñá„Å†„ÅëË™≠„ÇÅ„Å∞„ÄÅ„Åù„ÅÆÊÆµËêΩ„Åß‰Ωï„ÇíË®Ä„ÅÑ„Åü„ÅÑ„Åã„ÅåÂàÜ„Åã„ÇãÔºÅ"},details:["Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ: „Åù„ÅÆÊÆµËêΩ„ÅßÊúÄ„ÇÇË®Ä„ÅÑ„Åü„ÅÑ„Åì„Å®","‰∏≠ÈñìÈÉ®: ÁêÜÁî±„ÉªÂÖ∑‰Ωì‰æã„Éª„Éá„Éº„ÇøÔºàÈ£õ„Å∞„ÅóË™≠„ÅøOKÔºâ","ÊúÄÁµÇÊñá: „Åæ„Å®„ÇÅ„ÉªÁµêË´ñ„ÉªÊ¨°„ÅÆÊÆµËêΩ„Å∏„ÅÆÊ©ãÊ∏°„Åó","ÊÄ•„ÅÑ„Åß„ÅÑ„ÇãÊôÇ„ÅØÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å†„ÅëË™≠„ÇÄ„ÅÆ„ÇÇÊúâÂäπ"]},{icon:"üîó",title:"„Éá„Ç£„Çπ„Ç≥„Éº„Çπ„Éû„Éº„Ç´„Éº„ÇíË¶ãÈÄÉ„Åï„Å™„ÅÑ",description:"ÊñáÁ´†„ÅÆÊµÅ„Çå„ÇíÁ§∫„Åô„Å§„Å™„ÅéË®ÄËëâ„ÅåË´ñÁêÜÂ±ïÈñã„ÅÆ„Ç´„ÇÆ",details:["ÈÄÜÊé•: However, But, Yet, On the other hand","Âõ†Êûú: Therefore, So, Thus, As a result","‰æãÁ§∫: For example, For instance, Such as","ËøΩÂä†: In addition, Moreover, Furthermore","Ë®Ä„ÅÑÊèõ„Åà: In other words, That is, Namely"]},{icon:"üîç",title:"Ë®≠Âïè„ÅÆÁ®ÆÈ°ûÂà•„ÅÆÊîªÁï•Ê≥ï",description:"ÂïèÈ°å„ÅÆ„Çø„Ç§„Éó„Å´Âøú„Åò„ÅüË™≠„ÅøÊñπ„Çí‰Ωø„ÅÑÂàÜ„Åë„Çã",details:["‰∏ªÊó®ÂïèÈ°å: ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å®ÊúÄÁµÇÊÆµËêΩ„ÇíÈáçÁÇπÁöÑ„Å´","Ë©≥Á¥∞ÂïèÈ°å: „Ç≠„Éº„ÉØ„Éº„Éâ„ÅßË©≤ÂΩìÁÆáÊâÄ„ÇíÁâπÂÆö„Åó„Å¶Á≤æË™≠","Ë™ûÂΩôÂïèÈ°å: ÂâçÂæå„ÅÆÊñáËÑà„Åã„ÇâÊÑèÂë≥„ÇíÊé®Ê∏¨","ÊåáÁ§∫Ë™ûÂïèÈ°å: Áõ¥Ââç„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç","NOTÂïèÈ°å: Êú¨Êñá„Å´Êõ∏„Åã„Çå„Å¶„ÅÑ„Å™„ÅÑÈÅ∏ÊäûËÇ¢„ÇíÊé¢„Åô"]},{icon:"‚è±Ô∏è",title:"ÊôÇÈñìÈÖçÂàÜ„Å®ÂÑ™ÂÖàÈ†Ü‰Ωç",description:"ÂÖ®ÂïèËß£„Åè„Åü„ÇÅ„ÅÆÊà¶Áï•ÁöÑ„Å™ÊôÇÈñìÁÆ°ÁêÜ",details:["1Âïè„ÅÇ„Åü„Çä„ÅÆÁõÆÂÆâÊôÇÈñì„ÇíÊ±∫„ÇÅ„ÇãÔºà‰æã: 3ÂàÜ/ÂïèÔºâ","Êòì„Åó„ÅÑÂïèÈ°å„Åã„ÇâËß£„ÅÑ„Å¶ÂæóÁÇπ„ÇíÁ¢∫‰øù","Èõ£Âïè„ÅØÂæåÂõû„Åó„ÄÅÊúÄÂæå„Å´Êàª„Çã","ÊúÄ‰Ωé5ÂàÜ„ÅØË¶ãÁõ¥„ÅóÊôÇÈñì„ÇíÁ¢∫‰øù"]},{icon:"‚ùì",title:"ÂàÜ„Åã„Çâ„Å™„ÅÑÈÉ®ÂàÜ„ÅÆÂØæÂá¶Ê≥ï",description:"ÂÆåÁíß„ÇíÁõÆÊåá„Åï„Åö„ÄÅÂäπÁéáÁöÑ„Å´ÂæóÁÇπ„Åô„Çã",details:["Áü•„Çâ„Å™„ÅÑÂçòË™û„ÅØÂâçÂæå„Åã„ÇâÊé®Ê∏¨ÔºàÂìÅË©û„ÉªËÇØÂÆöÂê¶ÂÆö„ÇíÂà§Êñ≠Ôºâ","‰∏ÄÊñá„ÅåÂàÜ„Åã„Çâ„Å™„Åè„Å¶„ÇÇÊÆµËêΩÂÖ®‰Ωì„Åã„ÇâÊÑèÂë≥„ÇíÊé¥„ÇÄ","Á¥∞ÈÉ®„Çà„ÇäÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÂÑ™ÂÖà","Ê∂àÂéªÊ≥ï„ÅßÈÅ∏ÊäûËÇ¢„ÇíÁµû„ÇãÔºàÊòé„Çâ„Åã„Å´ÈÅï„ÅÜ„ÇÇ„ÅÆ„ÇíÈô§Â§ñÔºâ"]}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Èï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑ"}),u.jsx("div",{className:"bg-yellow-50/20 rounded-lg p-6 border-l-4 border-yellow-500 mb-6",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl",children:"üí°"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-lg text-yellow-800 mb-2",children:"Âü∫Êú¨Êà¶Áï•"}),u.jsx("p",{className:"text-yellow-700 mb-3",children:"Èï∑ÊñáË™≠Ëß£„ÅØ„ÄåÂÆåÁíß„Å´ÁêÜËß£„Åô„Çã„Äç„ÅÆ„Åß„ÅØ„Å™„Åè„ÄåÂøÖË¶Å„Å™ÊÉÖÂ†±„ÇíÂäπÁéáÁöÑ„Å´Ë¶ã„Å§„Åë„Çã„Äç‰ΩúÊ•≠„Åß„Åô„ÄÇ Ê≥®Èáà„Å®Ë®≠Âïè„Åã„ÇâÊâã„Åå„Åã„Çä„ÇíÂæó„Å¶„ÄÅÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÊé¥„Åø„Å™„Åå„Çâ„ÄÅËß£Á≠î„Å´ÂøÖË¶Å„Å™ÈÉ®ÂàÜ„ÇíÊé¢„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),u.jsxs("div",{className:"bg-yellow-100/30 rounded p-3 text-sm",children:[u.jsx("p",{className:"font-semibold text-yellow-900 mb-1",children:"‚ö° ÊúÄÈáçË¶Å„Éù„Ç§„É≥„Éà"}),u.jsx("p",{className:"text-yellow-800",children:"Ë™≠„ÇÄÈ†ÜÁï™: ‚ë† Ê≥®Èáà ‚Üí ‚ë° Ë®≠Âïè„ÉªÈÅ∏ÊäûËÇ¢ ‚Üí ‚ë¢ „Çø„Ç§„Éà„É´„ÉªÁ¨¨1ÊÆµËêΩ ‚Üí ‚ë£ ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá ‚Üí ‚ë§ ÂøÖË¶ÅÁÆáÊâÄ„ÇíÁ≤æË™≠"})]})]})]})}),u.jsx("div",{className:"space-y-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6 hover:shadow-lg transition-shadow border-l-4 border-primary/30",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[u.jsx("span",{className:"text-4xl",children:e.icon}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-text-color mb-2",children:e.title}),u.jsx("p",{className:"text-text-secondary",children:e.description})]})]}),e.example&&u.jsx("div",{className:"ml-14 mb-4 bg-blue-50/20 rounded-lg p-4 border border-blue-200",children:u.jsxs("div",{className:"space-y-3",children:[e.example.title&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìå „Çø„Ç§„Éà„É´‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 font-mono text-sm text-blue-700",children:e.example.title})]}),e.example.para1&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìÑ Á¨¨1ÊÆµËêΩ‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 text-sm text-gray-700 leading-relaxed",children:e.example.para1})]}),e.example.structure&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìä ÊÆµËêΩ„ÅÆÊßãÈÄ†"}),u.jsx("div",{className:"bg-white rounded p-3 text-sm font-mono whitespace-pre-line text-gray-700",children:e.example.structure})]}),e.example.explanation&&u.jsxs("div",{className:"bg-yellow-50/30 rounded p-3 border-l-2 border-yellow-500",children:[u.jsx("div",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"üí° Ë™≠„ÅøÂèñ„Çå„Çã„Åì„Å®"}),u.jsx("div",{className:"text-sm text-yellow-700 whitespace-pre-line",children:e.example.explanation})]}),e.example.tips&&u.jsx("div",{className:"bg-green-50/30 rounded p-3 border-l-2 border-green-500",children:u.jsxs("div",{className:"text-sm font-semibold text-green-700",children:["‚ú® ",e.example.tips]})})]})}),u.jsx("ul",{className:"space-y-2 ml-14",children:e.details.map((s,r)=>u.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[u.jsx("span",{className:"text-primary mt-1",children:"‚úì"}),u.jsx("span",{className:"text-text-color",children:s})]},r))})]},t))}),u.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50/20/20 rounded-lg p-6 mt-8 border-2 border-blue-300",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"}),u.jsx("span",{children:"ÂÆüË∑µÔºÅÂäπÁéáÁöÑ„Å™Ë™≠Ëß£ÊâãÈ†Ü"})]}),u.jsx("ol",{className:"space-y-3",children:[{step:"Ê≥®Èáà„ÇíË™≠„ÇÄ",detail:"‚Üí ÈáçË¶ÅÂçòË™û„Åã„ÇâÂÜÖÂÆπ„Çí‰∫àÊÉ≥"},{step:"Ë®≠Âïè„Å®ÈÅ∏ÊäûËÇ¢„ÇíË™≠„ÇÄ",detail:"‚Üí ‰Ωï„ÇíËÅû„Åã„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ"},{step:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÇíË™≠„ÇÄ",detail:"‚Üí „ÉÜ„Éº„Éû„Å®Ë´ñÁÇπ„ÇíÊääÊè°"},{step:"ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„ÇíÊµÅ„ÅóË™≠„Åø",detail:"‚Üí ÂÖ®‰ΩìÊßãÊàê„ÇíÁêÜËß£"},{step:"Ë®≠Âïè„Å´Èñ¢ÈÄ£„Åô„ÇãÊÆµËêΩ„ÇíÁ≤æË™≠",detail:"‚Üí Á≠î„Åà„ÅÆÊ†πÊã†„ÇíÊé¢„Åô"},{step:"ÈÅ∏ÊäûËÇ¢„ÇíÊú¨Êñá„Å®ÁÖß„Çâ„ÅóÂêà„Çè„Åõ„Çã",detail:"‚Üí Ê†πÊã†„Åå„ÅÇ„ÇãÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏„Å∂"},{step:"Ë¶ãÁõ¥„Åó",detail:"‚Üí ÈÅ∏„Çì„Å†Á≠î„Åà„ÅåÊú¨Êñá„ÅÆÂÜÖÂÆπ„Å®ÁüõÁõæ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç"}].map((e,t)=>u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:t+1}),u.jsxs("div",{children:[u.jsx("span",{className:"text-text-color font-semibold",children:e.step}),u.jsx("span",{className:"text-text-secondary text-sm ml-2",children:e.detail})]})]},t))})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-6 border-l-4 border-green-500",children:[u.jsxs("h3",{className:"text-lg font-bold text-green-800 mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üìå"}),u.jsx("span",{children:"Ê≥®Èáà„ÅÆÂäπÊûúÁöÑ„Å™Ê¥ªÁî®Ê≥ï"})]}),u.jsxs("div",{className:"space-y-2 text-sm text-green-700",children:[u.jsxs("p",{children:["‚úì ",u.jsx("strong",{children:"Ê≥®Èáà„Åå„ÅÇ„Çã = „Åù„ÅÆÂçòË™û„ÅåÂÜÖÂÆπÁêÜËß£„Å´ÂøÖÈ†à"}),"„Å®„ÅÑ„ÅÜÂá∫È°åËÄÖ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏"]}),u.jsx("p",{children:"‚úì Ê≥®Èáà„ÅÆÂçòË™û„Çí‰∏¶„Åπ„Çã„Å®„ÄÅÈï∑Êñá„ÅÆ„ÉÜ„Éº„Éû„ÇÑ„Çπ„Éà„Éº„É™„Éº„ÅåÊµÆ„Åã„Å≥‰∏ä„Åå„Çã"}),u.jsx("p",{children:"‚úì ‰æã: „ÄåÁí∞Â¢É„Äç„ÄåÊ±öÊüì„Äç„ÄåÂØæÁ≠ñ„Äç‚Üí Áí∞Â¢ÉÂïèÈ°å„Å´„Å§„ÅÑ„Å¶„ÅÆÊñáÁ´†„Å†„Å®‰∫àÊ∏¨„Åß„Åç„Çã"}),u.jsx("p",{className:"pt-2 italic",children:"üí° Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´Ê≥®Èáà„Å†„Åë„ÅßÂÜÖÂÆπ„Çí‰∫àÊÉ≥„Åô„ÇãÁ∑¥Áøí„Çí„Åô„Çã„Å®ÂäπÊûúÁöÑÔºÅ"})]})]})]})},KY=()=>u.jsx("div",{className:"dictionary-view",children:u.jsxs("div",{className:"dictionary-container",children:[u.jsx("h2",{children:"üìö Ëã±ÂçòË™ûËæûÊõ∏"}),u.jsx("p",{className:"coming-soon",children:"ËæûÊõ∏Ê©üËÉΩ„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô"})]})}),Cb="ai_predictions_log",Nb=1e4;class kp{constructor(e){Ee(this,"cache",null);Ee(this,"storage");this.storage=e||QY()}async logPrediction(e,t,s){const r={predicted:t,actual:s,word:e,timestamp:Date.now()};if(this.cache===null&&await this.loadCache(),this.cache.push(r),this.cache.length>Nb){const o=this.cache.length-Nb;this.cache.splice(0,o)}await this.saveCache()}async getRecentPredictions(e=1e3){this.cache===null&&await this.loadCache();const t=Math.max(0,this.cache.length-e);return this.cache.slice(t).reverse()}async getAllPredictions(){return this.cache===null&&await this.loadCache(),[...this.cache]}async getPredictionsByTimeRange(e,t=Date.now()){return this.cache===null&&await this.loadCache(),this.cache.filter(s=>s.timestamp&&s.timestamp>=e&&s.timestamp<=t)}async getPredictionsByWord(e){return this.cache===null&&await this.loadCache(),this.cache.filter(t=>t.word===e)}async getStats(){this.cache===null&&await this.loadCache();const e=this.cache.map(s=>s.timestamp).filter(s=>s!==void 0),t=new Set(this.cache.map(s=>s.word)).size;return{total:this.cache.length,oldest:e.length>0?Math.min(...e):null,newest:e.length>0?Math.max(...e):null,uniqueWords:t}}async clearLogs(){this.cache=[],await this.saveCache()}async loadCache(){try{const e=await this.storage.getItem(Cb);e&&Array.isArray(e)?this.cache=e:this.cache=[]}catch(e){console.error("Failed to load prediction logs:",e),this.cache=[]}}async saveCache(){try{await this.storage.setItem(Cb,this.cache)}catch(e){console.error("Failed to save prediction logs:",e)}}}function QY(){const n=new Map;return{async getItem(e){return n.get(e)},async setItem(e,t){n.set(e,t)}}}let iu=null;function Rk(){return iu||(typeof window<"u"&&Yn(async()=>{const{loadSetting:n,saveSetting:e}=await Promise.resolve().then(()=>a$);return{loadSetting:n,saveSetting:e}},void 0).then(({loadSetting:n,saveSetting:e})=>{const t={async getItem(s){return n(s)},async setItem(s,r){await e(s,r)}};iu=new kp(t)}),iu=new kp),iu}const XY=Object.freeze(Object.defineProperty({__proto__:null,PredictionLogger:kp,getPredictionLogger:Rk},Symbol.toStringTag,{value:"Module"}));function JY(n){return n.length===0?0:n.reduce((t,s)=>t+Math.abs(s.predicted-s.actual),0)/n.length*100}function YY(n,e=10){if(n.length===0)return{ece:0,mae:0,count:0,bins:[],overallAccuracy:0,averagePrediction:0};const t=ZY(n,e),s=t.reduce((l,d)=>l+d.weight*d.error,0),r=JY(n),i=n.filter(l=>l.actual===1).length/n.length,c=n.reduce((l,d)=>l+d.predicted,0)/n.length;return{ece:s,mae:r,count:n.length,bins:t,overallAccuracy:i,averagePrediction:c}}function ZY(n,e){const t=1/e,s=[];for(let r=0;r<e;r++){const o=r*t,i=(r+1)*t,a=n.filter(g=>r===e-1?g.predicted>=o&&g.predicted<=i:g.predicted>=o&&g.predicted<i);if(a.length===0){s.push({range:[o,i],midpoint:(o+i)/2,count:0,averagePrediction:0,actualAccuracy:0,weight:0,error:0});continue}const c=a.length,l=c/n.length,h=a.reduce((g,x)=>g+x.predicted,0)/c,p=a.filter(g=>g.actual===1).length/c,m=Math.abs(h-p);s.push({range:[o,i],midpoint:(o+i)/2,count:c,averagePrediction:h,actualAccuracy:p,weight:l,error:m})}return s}function eZ(n){return n<=.05?"excellent":n<=.1?"good":n<=.15?"fair":"poor"}function tZ(n){return n<=10?"excellent":n<=20?"good":n<=30?"fair":"poor"}const nZ=({minPredictions:n=100})=>{const[e,t]=T.useState(null),[s,r]=T.useState(!0),[o,i]=T.useState(null),a=async()=>{r(!0),i(null);try{const m=await Rk().getAllPredictions();if(m.length===0){i("‰∫àÊ∏¨„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),t(null);return}const g=YY(m,10);t(g)}catch(p){console.error("Failed to load calibration data:",p),i("„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}finally{r(!1)}};if(T.useEffect(()=>{a()},[]),s)return u.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:u.jsxs("div",{className:"animate-pulse",children:[u.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})});if(o||!e)return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",children:[u.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsx("p",{className:"text-yellow-800",children:o||"‰∫àÊ∏¨„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})})]});const c=eZ(e.ece),l=tZ(e.mae),d={excellent:"text-green-600",good:"text-blue-600",fair:"text-yellow-600",poor:"text-red-600"},h={excellent:"üåü",good:"üëç",fair:"‚ö†Ô∏è",poor:"‚ùå"},f=e.count<n;return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"üîÑ Êõ¥Êñ∞"})]}),f&&u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsxs("p",{className:"text-yellow-800",children:["‚ö†Ô∏è ‰∫àÊ∏¨Êï∞„Åå",n,"‰ª∂Êú™Ê∫Ä„Åß„ÅôÔºàÁèæÂú®",e.count,"‰ª∂Ôºâ„ÄÇ „Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Å´„ÅØ",n,"‰ª∂‰ª•‰∏ä„ÅÆ‰∫àÊ∏¨„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô„ÄÇ"]})}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ECEÔºàExpected Calibration ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.ece*100).toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[c]}`,children:[h[c]," ",c]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"‰∫àÊ∏¨Á¢∫Áéá„Å®ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá„ÅÆÂ∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"MAEÔºàMean Absolute ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[e.mae.toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[l]}`,children:[h[l]," ",l]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Âπ≥ÂùáÁµ∂ÂØæË™§Â∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ÂÖ®‰ΩìÊ≠£Ëß£Áéá"}),u.jsx("div",{className:"flex items-baseline gap-2",children:u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})}),u.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["‰∫àÊ∏¨Êï∞: ",e.count,"‰ª∂"]})]})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:"„Éì„É≥Âà•„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥"}),u.jsx("div",{className:"space-y-2",children:e.bins.filter(p=>p.count>0).map((p,m)=>u.jsx(sZ,{bin:p},m))}),u.jsx("div",{className:"mt-4 text-xs text-gray-500",children:"ÁêÜÊÉ≥ÁöÑ„Å™‰∫àÊ∏¨„Åß„ÅØ„ÄÅÂêÑ„Éì„É≥„ÅÆ„Äå‰∫àÊ∏¨„Äç„Å®„ÄåÂÆüÈöõ„Äç„Åå‰∏ÄËá¥„Åó„Åæ„Åô„ÄÇ „Éì„É≥„ÅØ‰∫àÊ∏¨Á¢∫Áéá„Çí10ÂàÜÂâ≤„Åó„Åü„Ç∞„É´„Éº„Éó„Åß„Åô„ÄÇ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-800",children:"‰∫àÊ∏¨„ÅÆÂÇæÂêë"}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"Âπ≥Âùá‰∫àÊ∏¨Á¢∫Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.averagePrediction*100).toFixed(1),"%"]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})]}),u.jsx("div",{className:"ml-auto",children:e.averagePrediction>e.overallAccuracy+.05?u.jsx("span",{className:"px-3 py-1 bg-red-100/30 text-red-700 rounded-full text-sm",children:"ÈÅé‰ø°ÂÇæÂêë"}):e.averagePrediction<e.overallAccuracy-.05?u.jsx("span",{className:"px-3 py-1 bg-blue-100/30 text-blue-700 rounded-full text-sm",children:"ÈÅéÂ∞èË©ï‰æ°ÂÇæÂêë"}):u.jsx("span",{className:"px-3 py-1 bg-green-100/30 text-green-700 rounded-full text-sm",children:"„Éê„É©„É≥„ÇπËâØÂ•Ω"})})]})]})]})},sZ=({bin:n})=>{const[e,t]=n.range,s=n.averagePrediction*100,r=n.actualAccuracy*100,o=Math.abs(s-r),i=o<5?"bg-green-500":o<10?"bg-blue-500":o<15?"bg-yellow-500":"bg-red-500";return u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[u.jsxs("span",{children:[(e*100).toFixed(0),"%-",(t*100).toFixed(0),"% Ôºà",n.count,"‰ª∂Ôºâ"]}),u.jsxs("span",{children:["Ë™§Â∑Æ: ",o.toFixed(1),"%"]})]}),u.jsxs("div",{className:"relative h-6 bg-gray-200 rounded",children:[u.jsx("div",{className:"absolute h-full bg-blue-300 rounded opacity-50",style:{width:`${s}%`}}),u.jsx("div",{className:`absolute h-full ${i} rounded`,style:{width:`${r}%`}}),u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800",children:["‰∫àÊ∏¨ ",s.toFixed(0),"% / ÂÆüÈöõ ",r.toFixed(0),"%"]})]})]})};async function rZ(){try{const n=i$(),e=await cs(),t={version:"1.0",exportDate:Date.now(),progress:e,sessionHistory:[],dailyStats:[],settings:{}};if(n.completed&&n.indexedDBSupported)try{t.sessionHistory=await ox(wn.SESSION_HISTORY),t.dailyStats=await ox(wn.DAILY_STATS);const s=["user-goal-level","lastLoginDate","loginStreak","radar-improvement-progress","skip-exclude-groups"];for(const r of s){const o=localStorage.getItem(r);o&&(t.settings[r]=o)}}catch{E.warn("IndexedDB„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„ÄÅLocalStorage„Åã„ÇâÂèñÂæó„Åó„Åæ„Åô:")}if(Object.keys(t.settings).length===0){const s=["user-goal-level","lastLoginDate","loginStreak","radar-improvement-progress","skip-exclude-groups","daily-plan-target-translation","daily-plan-target-spelling","daily-plan-target-reading"];for(const r of s){const o=localStorage.getItem(r);o&&(t.settings[r]=o)}}return JSON.stringify(t,null,2)}catch(n){throw E.error("„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:",n),new Error("„Éá„Éº„Çø„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}async function oZ(){try{const n=await rZ(),e=new Blob([n],{type:"application/json"}),t=URL.createObjectURL(e),s=new Date,r=`quiz-app-backup-${s.getFullYear()}${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}.json`,o=document.createElement("a");o.href=t,o.download=r,o.click(),URL.revokeObjectURL(t),E.log(`‚úÖ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü: ${r}`)}catch(n){E.error("„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç®„É©„Éº:",n),alert("„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}async function iZ(n){try{const e=JSON.parse(n);if(!e.version||!e.progress)throw new Error("ÁÑ°Âäπ„Å™„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„Åß„Åô");if(!confirm(`„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô„ÅãÔºü

„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊó•ÊôÇ: ${new Date(e.exportDate).toLocaleString()}
ÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ

Âæ©ÂÖÉÂâç„Å´ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`))return!1;if(await Nr(e.progress),e.settings)for(const[s,r]of Object.entries(e.settings))localStorage.setItem(s,r);return E.log("‚úÖ „Éá„Éº„ÇøÂæ©ÂÖÉÂÆå‰∫Ü"),alert("„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),!0}catch(e){return E.error("„Éá„Éº„Çø„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:",e),alert("„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éï„Ç°„Ç§„É´„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ"),!1}}async function aZ(n){return new Promise((e,t)=>{const s=new FileReader;s.onload=async r=>{var o;try{const i=(o=r.target)==null?void 0:o.result,a=await iZ(i);e(a)}catch(i){t(i)}},s.onerror=()=>t(new Error("„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")),s.readAsText(n)})}function cZ({onResetComplete:n,allQuestions:e,onQuestionSetsUpdated:t}){const[s,r]=T.useState(!1),[o,i]=T.useState(null),[a,c]=T.useState(!1),[l,d]=T.useState(null),[h,f]=T.useState(null),[p,m]=T.useState([]),[g,x]=T.useState(null),[y,b]=T.useState([]),[v,w]=T.useState([]),[S,I]=T.useState([]),[C,k]=T.useState(0),$=()=>{try{let P=0;const j=[];for(let A=0;A<localStorage.length;A++){const F=localStorage.key(A);if(F){const M=localStorage.getItem(F);if(M){const K=new Blob([M]).size;P+=K,j.push({key:F,sizeMB:K/(1024*1024)})}}}j.sort((A,F)=>F.sizeMB-A.sizeMB),i({totalMB:P/(1024*1024),details:j.slice(0,5)})}catch(P){E.error("„Çπ„Éà„É¨„Éº„Ç∏„Çµ„Ç§„Ç∫„ÅÆÂèñÂæó„Ç®„É©„Éº:",P)}},N=T.useCallback(()=>{d(N0()),f(I0()),m(O0(12)),x(L0());const j=Bh(10).map(F=>{const M=e.find(K=>K.word&&F.word&&K.word.toLowerCase()===F.word.toLowerCase());return{...F,etymology:M==null?void 0:M.etymology,relatedWords:M==null?void 0:M.relatedWords,difficulty:M==null?void 0:M.difficulty}});b(j),w(A0(10)),I(k0(7,5));const A=rt();k(A.statistics.streakDays),$()},[e]);T.useEffect(()=>{N();const P=async()=>{const F=(await Gh()).some(M=>M.source==="weak-words");c(F)};P();const j=()=>{N(),P()};if(typeof window<"u"&&window.addEventListener(sa,j),s){const A=setInterval(()=>{N(),P()},1e3);return()=>{clearInterval(A),typeof window<"u"&&window.removeEventListener(sa,j)}}return()=>{typeof window<"u"&&window.removeEventListener(sa,j)}},[s,N]);const _=()=>{confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ")&&(M0(),d(null),f(null),m([]),x(null),b([]),w([]),I([]),k(0),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),N(),n&&n())};return u.jsxs("div",{className:"stats-view",children:[u.jsx("div",{className:"w-full mb-4 px-2",children:u.jsx(nZ,{minPredictions:50})}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üìÜ Â≠¶Áøí„Ç´„É¨„É≥„ÉÄ„Éº",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàÈÅéÂéª7Êó•ÈñìÔºâ"})]}),u.jsx(lZ,{streakDays:C})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üò∞ Ëã¶ÊâãÂçòË™û„Éà„ÉÉ„Éó10",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàË¶ÅÂæ©ÁøíÔºâ"})]}),y.length>0?u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-orange-200 p-6",children:[u.jsx("ul",{className:"space-y-3",children:y.map((P,j)=>u.jsx("li",{className:"p-4 bg-gradient-to-r from-orange-50 to-red-50/30/30 rounded-lg border border-orange-200 hover:shadow-md hover:scale-[1.02] transition-all duration-200",children:u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[u.jsx("span",{className:"flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full text-sm",children:j+1}),u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:P.word}),P.meaning&&u.jsx("span",{className:"text-sm text-gray-600 mt-1",children:P.meaning}),P.reading&&u.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:P.reading}),P.etymology&&u.jsxs("span",{className:"text-xs text-blue-600 mt-1",children:["üìñ ",P.etymology]}),P.relatedWords&&u.jsxs("span",{className:"text-xs text-purple-600 mt-0.5",children:["üîó ",P.relatedWords]})]})]}),u.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[u.jsxs("span",{className:"px-3 py-1 bg-red-100/50 text-red-700 rounded-full font-medium",children:["‚ùå ",P.mistakes,"Âõû"]}),P.recentAccuracy>0&&u.jsxs("span",{className:"px-3 py-1 bg-blue-100/50 text-blue-700 rounded-full font-medium",children:["Ê≠£Ëß£Áéá ",P.recentAccuracy,"%"]})]})]})},j))}),u.jsxs("div",{className:"mt-6 flex gap-3",children:[u.jsxs("button",{onClick:async()=>{try{const P=await od(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")}`,20,3,60,e);await rd(P),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${P.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(P){E.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",P),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2",children:["üìö ÂïèÈ°å„Çª„ÉÉ„Éà„Çí",a?"Êõ¥Êñ∞":"‰ΩúÊàê",u.jsx("span",{className:"text-xs opacity-90",children:"(‰∏ä‰Ωç20Ë™û)"})]}),u.jsx("button",{onClick:async()=>{const P=prompt("ÂèñÂæó„Åô„ÇãËã¶ÊâãË™ûÂè•„ÅÆÊï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1-100Ôºâ","30");if(!P)return;const j=parseInt(P);if(isNaN(j)||j<1||j>100){alert("1„Åã„Çâ100„Åæ„Åß„ÅÆÊï∞ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}try{const A=await od(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")} (${j}Ë™û)`,j,3,60,e);await rd(A),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${A.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(A){E.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",A),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚öôÔ∏è „Ç´„Çπ„Çø„É†"})]})]}):u.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50/20/20 rounded-xl border-2 border-dashed border-green-300 p-8 text-center",children:[u.jsx("p",{className:"text-xl font-semibold text-green-700",children:"Ëã¶Êâã„Å™ÂçòË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅüéâ"}),u.jsx("p",{className:"text-sm text-green-600 mt-2",children:"È†ÜË™ø„Å´Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô"})]})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-blue-200 p-6 mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó"}),u.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Â≠¶Áøí„Éá„Éº„Çø„ÇíJSON„Åß‰øùÂ≠ò/Âæ©ÂÖÉ„Åß„Åç„Åæ„Åô„ÄÇ„Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„ÉàÂâç„Å´„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÊé®Â•®„ÄÇ"}),u.jsx("button",{onClick:()=>{oZ()},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚¨áÔ∏è „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ"}),u.jsx("span",{className:"mx-2"}),u.jsx("input",{type:"file",accept:"application/json","aria-label":"„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû",onChange:async P=>{var F;const j=(F=P.target.files)==null?void 0:F[0];if(P.target.value="",!j)return;await aZ(j)&&window.location.reload()}})]}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg border-2 border-red-200 p-6",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"‚ö†Ô∏è „Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„Éà"}),u.jsx("p",{className:"text-sm text-gray-600",children:"„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"})]}),u.jsx("button",{onClick:_,className:"px-8 py-3 bg-red-600 hover:bg-red-700:bg-red-800 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2",children:"üóëÔ∏è „É™„Çª„ÉÉ„ÉàÂÆüË°å"})]})})]}),o&&u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"üíæ „Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè"}),u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-purple-200 p-6",children:[u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"ÂêàË®à‰ΩøÁî®Èáè"}),u.jsxs("span",{className:`text-xl font-bold ${o.totalMB>4?"text-red-600":"text-green-600"}`,children:[o.totalMB.toFixed(2)," MB"," ",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/ Á¥Ñ 5-10 MB"})]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden relative",children:u.jsx("div",{className:`h-full rounded-full transition-all duration-500 absolute left-0 top-0 ${o.totalMB>8?"bg-red-600 w-full":o.totalMB>4?"bg-yellow-500":"bg-green-500"}`,"data-progress":Math.min(o.totalMB/10*100,100)})}),o.totalMB>4&&u.jsx("p",{className:"mt-2 text-sm font-medium text-red-600 flex items-center gap-1",children:"‚ö†Ô∏è ÂÆπÈáè„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})]}),u.jsxs("details",{className:"mt-4",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-700:text-blue-300 font-medium flex items-center gap-2",children:"üìä Ë©≥Á¥∞„ÇíË°®Á§∫"}),u.jsx("ul",{className:"mt-4 space-y-2",children:o.details.map((P,j)=>u.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[u.jsx("code",{className:"text-sm text-gray-700 font-mono",children:P.key}),u.jsxs("span",{className:"text-sm font-semibold text-gray-800",children:[P.sizeMB.toFixed(2)," MB"]})]},j))}),u.jsx("div",{className:"mt-4 p-4 bg-blue-50/20 rounded-lg border border-blue-200",children:u.jsxs("p",{className:"text-sm text-blue-700 flex items-start gap-2",children:[u.jsx("span",{className:"text-lg",children:"üí°"}),u.jsx("span",{children:"„Éí„É≥„Éà: „Éá„Éº„Çø„ÅåÂ§ß„Åç„Åè„Å™„Çä„Åô„Åé„ÅüÂ†¥Âêà„ÅØ„ÄÅÂè§„ÅÑÊàêÁ∏æ„ÇíÂâäÈô§„Åô„Çã„Å®ÂÆπÈáè„ÇíÁØÄÁ¥Ñ„Åß„Åç„Åæ„Åô„ÄÇ"})]})})]})]})]})]})}function lZ({streakDays:n}){const[e,t]=T.useState([]);if(T.useEffect(()=>{const o=F0(14);t(o)},[]),e.length===0)return u.jsxs("div",{className:"w-full p-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center",children:[u.jsx("p",{className:"text-gray-500 text-lg",children:"üìä „Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Â≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„Å®ÈÄ≤Êçó„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]});const s=e.slice(-7),r={memorization:{bg:"bg-green-500",text:"üü¢ ÊöóË®ò"},translation:{bg:"bg-blue-500",text:"üîµ ÂíåË®≥"},spelling:{bg:"bg-yellow-500",text:"üü° „Çπ„Éö„É´"},grammar:{bg:"bg-red-500",text:"üî¥ ÊñáÊ≥ï"}};return u.jsxs("div",{className:"w-full p-3 sm:p-6 bg-white rounded-xl shadow-lg border-2 border-blue-200",children:[u.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-gradient-to-r from-orange-100 to-yellow-100 rounded-lg border-2 border-orange-300 text-center",children:[u.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u.jsx("span",{className:"text-2xl sm:text-3xl",children:"üî•"}),u.jsxs("span",{className:"text-lg sm:text-2xl font-bold text-orange-600",children:[n,"Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ"]})]}),n>0&&u.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1 sm:mt-2",children:"„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ"})]}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2",children:s.map((o,i)=>{const c=new Date(o.date).getDay(),d=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"][c];return u.jsx("div",{className:"text-center",children:u.jsx("div",{className:"text-xs sm:text-sm font-bold text-gray-700 mb-1",children:d})},i)})}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:s.map((o,i)=>{const a=[{key:"memorization",data:o.memorization},{key:"translation",data:o.translation},{key:"spelling",data:o.spelling},{key:"grammar",data:o.grammar}],c=a.reduce((m,g)=>m+g.data.correct,0),l=a.reduce((m,g)=>m+g.data.count,0),d=new Date(o.date),h=`${d.getMonth()+1}/${d.getDate()}`,f=o.date===q0(new Date),p=a.filter(m=>m.data.count>0).map(m=>{const g=m.data.count>0?Math.round(m.data.correct/m.data.count*100):0;return`${r[m.key].text}: ${m.data.correct}/${m.data.count}Âïè (${g}%)`}).join(`
`);return u.jsxs("div",{className:"flex flex-col items-center group",children:[u.jsx("div",{className:`relative w-full h-24 sm:h-32 bg-gray-200 rounded-lg overflow-hidden flex flex-col-reverse border-2 shadow-sm hover:shadow-xl hover:scale-105 transition-all duration-300 ${f?"border-orange-400 ring-2 ring-orange-300 ring-offset-1":"border-gray-300"}`,title:l>0?`${o.date}${f?" [‰ªäÊó•]":""}
${p}`:`${o.date}: Êú™Â≠¶Áøí`,children:c===0?u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Êú™Â≠¶Áøí"}):u.jsxs(u.Fragment,{children:[a.map(m=>m.data.correct>0&&u.jsx("div",{className:`mode-progress-bar w-full ${r[m.key].bg} flex items-center justify-center text-white text-xs font-bold transition-all duration-500 ease-out hover:brightness-110`,style:{"--height-percent":m.data.correct/c*100,"--animation-delay":i*.1},children:u.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:m.data.correct})},m.key)),u.jsx("div",{className:"hidden sm:flex absolute inset-0 bg-black/80 text-white p-2 text-[10px] leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none flex-col justify-center",children:a.filter(m=>m.data.count>0).map(m=>{const g=Math.round(m.data.correct/m.data.count*100);return u.jsxs("div",{className:"mb-1",children:[u.jsx("div",{className:"font-bold",children:r[m.key].text}),u.jsxs("div",{children:[m.data.correct,"/",m.data.count,"Âïè (",g,"%)"]})]},m.key)})})]})}),u.jsxs("div",{className:"mt-1 sm:mt-2 text-center",children:[u.jsxs("div",{className:`text-[10px] sm:text-xs ${f?"text-orange-600 font-bold":"text-gray-500"}`,children:[h,f&&" üéØ"]}),u.jsxs("div",{className:"text-xs sm:text-sm font-bold text-gray-800",children:[c,"Âïè"]})]})]},i)})}),u.jsx("style",{children:`
        @keyframes slideUp {
          from {
            height: 0%;
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        .mode-progress-bar {
          height: calc(var(--height-percent, 0) * 1%);
          animation: slideUp 0.6s ease-out calc(var(--animation-delay, 0) * 1s) both;
        }
      `}),u.jsx("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t-2 border-gray-200",children:u.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-4 text-xs sm:text-sm",children:Object.entries(r).map(([o,i])=>u.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[u.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 ${i.bg} rounded`}),u.jsx("span",{className:"text-gray-700",children:i.text})]},o))})})]})}function uZ({allQuestions:n,onStartSession:e,_selectedDataSource:t="all",_onDataSourceChange:s,customQuestionSets:r,onOpenCustomSetManagement:o,questionSets:i=[],categoryList:a=[],onResetComplete:c,onQuestionSetsUpdated:l}){const[d,h]=T.useState("settings"),[f,p]=T.useState(()=>{const N=localStorage.getItem("batchSize");return N?parseInt(N,10):20}),[m,g]=T.useState(()=>localStorage.getItem("aiPersonality")||"kind-teacher"),x=N=>{g(N),localStorage.setItem("aiPersonality",N)},[y,b]=T.useState(()=>{const N=localStorage.getItem("voiceGender");return N==="female"||N==="male"?N:"female"}),[v,w]=T.useState(()=>{const N=localStorage.getItem("speechRate");return N?parseFloat(N):.9}),S=N=>{b(N),localStorage.setItem("voiceGender",N)},I=N=>{w(N),localStorage.setItem("speechRate",N.toString())},[C,k]=T.useState(()=>{const N=localStorage.getItem("darkMode");return N==="system"||N==="light"||N==="dark"?N:N==="true"?"dark":N==="false"?"light":"system"}),$=N=>{let _=!1;N==="system"?_=window.matchMedia("(prefers-color-scheme: dark)").matches:_=N==="dark",document.documentElement.classList.toggle("dark",_)};return T.useEffect(()=>{if($(C),C==="system"){const N=window.matchMedia("(prefers-color-scheme: dark)"),_=()=>{$("system")};return N.addEventListener("change",_),()=>N.removeEventListener("change",_)}},[C]),n.length,u.jsxs("div",{className:"w-full",children:[u.jsxs("div",{className:"flex gap-2 mb-6 border-b-2 border-gray-200",children:[u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="settings"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("settings"),children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="reference"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("reference"),children:"üîñ ÂèÇËÄÉ"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="dictionary"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("dictionary"),children:"üìï ËæûÊõ∏"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="stats"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("stats"),children:"üìä ÊàêÁ∏æ"})]}),d==="reference"?u.jsx(UY,{}):d==="dictionary"?u.jsx(KY,{}):d==="stats"?u.jsx(cZ,{questionSets:i,allQuestions:n,categoryList:a,onResetComplete:c||(()=>h("stats")),onQuestionSetsUpdated:l||(async()=>{})}):u.jsxs("div",{className:"px-4 py-6 space-y-6",children:[u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà"}),u.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:["(",r.length,"ÂÄã)"]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("button",{onClick:o,className:"w-full px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all shadow-md flex items-center justify-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÁÆ°ÁêÜ"})]}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg",children:"üí° Ëá™ÂàÜ„Å†„Åë„ÅÆ„Ç™„É™„Ç∏„Éä„É´ÂïèÈ°å„Çª„ÉÉ„Éà„Çí‰ΩúÊàê„ÉªÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇÂ≠¶Áøí„Åó„Åü„ÅÑÂçòË™û„ÇíËá™Áî±„Å´ËøΩÂä†„Åó„Å¶„ÄÅÂäπÁéáÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]})]}),u.jsx(VY,{allQuestions:n,onStartSession:e}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üé≠"}),u.jsx("span",{children:"AI„ÅÆ‰∫∫Ê†º"})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(L9).map(([N,_])=>u.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all duration-200 ${m===N?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md hover:scale-102"}`,onClick:()=>x(N),children:[u.jsx("div",{className:"text-3xl",children:_.avatar}),u.jsx("div",{className:"font-semibold text-sm",children:_.name}),u.jsx("div",{className:"text-xs opacity-80 text-center",children:_.description})]},N))})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üîä"}),u.jsx("span",{children:"Èü≥Â£∞Ë®≠ÂÆö"})]}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üé§"}),u.jsx("span",{children:"Â£∞„ÅÆÁ®ÆÈ°û"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${y==="female"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>S("female"),children:[u.jsx("div",{className:"text-3xl",children:"üë©"}),u.jsx("div",{className:"text-sm font-semibold",children:"Â•≥ÊÄß"})]}),u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${y==="male"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>S("male"),children:[u.jsx("div",{className:"text-3xl",children:"üë®"}),u.jsx("div",{className:"text-sm font-semibold",children:"Áî∑ÊÄß"})]})]})]}),u.jsxs("div",{children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"}),u.jsx("span",{children:"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsx("span",{className:"text-xs font-normal text-text-secondary",children:"(WPM: Words Per Minute)"})]}),u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6",children:[u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("div",{className:"font-bold text-primary text-4xl mb-1",children:Math.round(v*150)}),u.jsx("div",{className:"text-sm text-text-secondary",children:"WPM"}),u.jsx("div",{className:"text-xs text-text-secondary mt-2",children:v<.75?"üê¢ „ÇÜ„Å£„Åè„Çä„Å®Áô∫Èü≥":v>=.95?"üöÄ „Éç„Ç§„ÉÜ„Ç£„Éñ‰∏¶„ÅÆÈÄüÂ∫¶":"üéØ È´òÊ†°ÂÖ•Ë©¶„É™„Çπ„Éã„É≥„Ç∞Áõ∏ÂΩì"})]}),u.jsxs("div",{className:"relative mb-8",children:[u.jsx("input",{type:"range",min:"0.6",max:"1.0",step:"0.05",value:v,onChange:N=>I(parseFloat(N.target.value)),className:"w-full h-3 bg-border-color rounded-lg appearance-none cursor-pointer accent-primary","aria-label":"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsxs("div",{className:"absolute top-0 left-0 w-full h-3 pointer-events-none",children:[u.jsx("div",{className:"absolute top-1/2 left-0 -translate-y-1/2 w-0.5 h-5 bg-gray-400"}),u.jsx("div",{className:"absolute top-1/2 left-[37.5%] -translate-y-1/2 w-0.5 h-5 bg-blue-500"}),u.jsx("div",{className:"absolute top-1/2 left-[75%] -translate-y-1/2 w-0.5 h-5 bg-green-500"}),u.jsx("div",{className:"absolute top-1/2 left-full -translate-y-1/2 -translate-x-0.5 w-0.5 h-5 bg-orange-500"})]})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs",children:[u.jsxs("button",{onClick:()=>I(.6),className:"bg-gray-50/50 rounded-lg p-3 border border-gray-200 hover:bg-gray-100:bg-gray-700/50 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-gray-600",children:"90 WPM"}),u.jsx("div",{className:"text-gray-500 mt-1",children:"ÊúÄ‰ΩéÈÄüÂ∫¶"})]}),u.jsxs("button",{onClick:()=>I(.75),className:"bg-blue-50/20 rounded-lg p-3 border border-blue-200 hover:bg-blue-100:bg-blue-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-blue-600",children:"113 WPM"}),u.jsx("div",{className:"text-blue-500 mt-1",children:"ÂàùÂ≠¶ËÄÖÂêë„Åë"})]}),u.jsxs("button",{onClick:()=>I(.9),className:"bg-green-50/20 rounded-lg p-3 border border-green-200 hover:bg-green-100:bg-green-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-green-600",children:"135 WPM"}),u.jsx("div",{className:"text-green-500 mt-1",children:"È´òÊ†°ÂÖ•Ë©¶"})]}),u.jsxs("button",{onClick:()=>I(1),className:"bg-orange-50/20 rounded-lg p-3 border border-orange-200 hover:bg-orange-100:bg-orange-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-orange-600",children:"150 WPM"}),u.jsx("div",{className:"text-orange-500 mt-1",children:"„Éç„Ç§„ÉÜ„Ç£„Éñ"})]})]})]})]})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìã"}),u.jsx("span",{children:"„Éó„É©„Ç§„Éê„Ç∑„Éº"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("a",{href:"/privacy.html",target:"_blank",rel:"noopener noreferrer",className:"block w-full px-4 py-3 bg-primary text-white text-center rounded-lg font-semibold hover:bg-btn-primary-hover transition-colors shadow-md",children:"üìÑ „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg text-center",children:"Êú¨„Ç¢„Éó„É™„ÅØÂÄã‰∫∫ÊÉÖÂ†±„ÇíÂèéÈõÜ„Åõ„Åö„ÄÅÂ≠¶Áøí„Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂ÂÜÖ„Å´„ÅÆ„Åø‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ"})]})]})]})]})}const Dk="social-studies-progress";function Ib(){return{termProgress:{},lastUpdated:Date.now(),version:1}}function dZ(n,e){return{term:n,position:35,correctCount:0,incorrectCount:0,lastAnswered:new Date,nextReviewDate:new Date(Date.now()+24*60*60*1e3),field:e}}function nx(){try{const n=localStorage.getItem(Dk);if(!n)return Ib();const e=JSON.parse(n);return Object.values(e.termProgress).forEach(t=>{t.lastAnswered=new Date(t.lastAnswered),t.nextReviewDate=new Date(t.nextReviewDate)}),e}catch(n){return E.error("Á§æ‰ºöÁßëÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n),Ib()}}function hZ(n){try{n.lastUpdated=Date.now(),localStorage.setItem(Dk,JSON.stringify(n))}catch(e){E.error("Á§æ‰ºöÁßëÈÄ≤Êçó„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}function kb(n,e,t,s=!1){const r=nx();let o=r.termProgress[n];o||(o=dZ(n,e),r.termProgress[n]=o),t?o.correctCount++:o.incorrectCount++;const i=o.position;let a=i;if(t){const l=Math.min(o.correctCount*2,10);a=Math.max(0,i-(5+l))}else{const l=Math.min(o.incorrectCount*2,10);a=Math.min(100,i+((s?15:10)+l))}o.position=a,o.lastAnswered=new Date;const c=fZ(o.position,o.correctCount);o.nextReviewDate=new Date(Date.now()+c),hZ(r),E.log(`Á§æ‰ºöÁßëÈÄ≤ÊçóÊõ¥Êñ∞: ${n}`,{field:e,isCorrect:t,isDontKnow:s,oldPosition:i,newPosition:a,correctCount:o.correctCount,incorrectCount:o.incorrectCount})}function fZ(n,e){const t={mastered:6048e5,learning:2592e5,stillLearning:864e5,incorrect:216e5};let s;n<=20?s=t.mastered:n<=40?s=t.learning:n<=70?s=t.stillLearning:s=t.incorrect;const r=Math.min(2,1+e*.1);return s*r}function pu(n){return nx().termProgress[n]||null}const pZ={cause:100,effect:90,chronological_before:80,chronological_after:70,person_achievement:60,location_event:55,related:50};let tc=[],$b="";async function mZ(n){if(!($b===n&&tc.length>0))try{const e=await fetch(`/data/social-studies/${n}-relationships.json`);if(!e.ok)throw new Error(`Èñ¢ÈÄ£ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó: ${e.statusText}`);tc=await e.json(),$b=n,E.log(`Èñ¢ÈÄ£ÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${tc.length}‰ª∂`)}catch(e){E.error("Èñ¢ÈÄ£ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",e),tc=[]}}function Tb(n,e=5){const s=tc.filter(r=>r.sourceTerm===n).map(r=>{const o=pZ[r.relationType],i=r.strength*.5,a=pu(r.targetTerm),l=((a==null?void 0:a.position)??35)*.3,d=o+i+l;let h="";return r.relationType==="cause"?h=`${r.targetTerm}„ÅÆÂéüÂõ†„Å®„Å™„Å£„ÅüÂá∫Êù•‰∫ã`:r.relationType==="effect"?h=`${r.targetTerm}„ÅÆÁµêÊûú„Å®„Åó„Å¶Ëµ∑„Åì„Å£„ÅüÂá∫Êù•‰∫ã`:r.relationType==="chronological_before"?h=`${r.targetTerm}„ÅÆÂâç„Å´Ëµ∑„Åì„Å£„ÅüÂá∫Êù•‰∫ã`:r.relationType==="chronological_after"?h=`${r.targetTerm}„ÅÆÂæå„Å´Ëµ∑„Åì„Å£„ÅüÂá∫Êù•‰∫ã`:r.relationType==="person_achievement"?h=`${r.targetTerm}„ÅÆÊ•≠Á∏æ„ÉªÂäüÁ∏æ`:r.relationType==="location_event"?h=`${r.targetTerm}„ÅßËµ∑„Åì„Å£„ÅüÂá∫Êù•‰∫ã`:h=`${r.targetTerm}„Å´Èñ¢ÈÄ£„Åô„Çã‰∫ãÈ†Ö`,{term:r.targetTerm,relationType:r.relationType,priority:d,reason:h}});return s.sort((r,o)=>o.priority-r.priority),s.slice(0,e)}class gZ{calculateOverallMetrics(e){const t=Object.values(e.termProgress),s=t.filter(g=>g.position<=20),r=t.filter(g=>g.correctCount+g.incorrectCount>0),o=r.length>0?s.length/r.length:0,a=Date.now()-24*60*60*1e3,l=t.filter(g=>g.position<=20&&g.lastAnswered.getTime()>a).length,d=t.filter(g=>g.position>20&&g.correctCount>3&&g.incorrectCount>0),h=s.length>0?d.length/s.length:0,f=t.reduce((g,x)=>g+x.correctCount+x.incorrectCount,0),p=s.length>0?f/s.length:0,m=this.calculateEfficiencyScore({retentionRate:o,learningSpeed:l,forgettingRate:h,averageAttempts:p});return{retentionRate:o,learningSpeed:l,forgettingRate:h,averageAttempts:p,efficiencyScore:m,measuredAt:Date.now()}}calculateEfficiencyScore(e){const t=e.retentionRate*40,s=Math.min(e.learningSpeed/10*30,30),r=(1-e.forgettingRate)*20,o=Math.max(0,(1-(e.averageAttempts-4)/8)*10);return Math.min(100,t+s+r+o)}analyzeFieldEfficiency(e){const t=new Map;Object.values(e.termProgress).forEach(r=>{const o=r.field||"„Åù„ÅÆ‰ªñ";t.has(o)||t.set(o,[]),t.get(o).push(r)});const s=[];return t.forEach((r,o)=>{const i=r.filter(f=>f.correctCount+f.incorrectCount>0),a=r.filter(f=>f.position<=20),c=i.length>0?a.length/i.length:0,l=r.reduce((f,p)=>f+p.correctCount+p.incorrectCount,0),d=a.length>0?a.length/(l/10):0,h=(c*60+Math.min(d/2,1)*40)*100;s.push({field:o,retentionRate:c,learningSpeed:d,masteredCount:a.length,totalAttempts:l,proficiency:Math.round(h)})}),s.sort((r,o)=>o.proficiency-r.proficiency)}measureChainLearningEffect(e,t){const s=Object.values(e.termProgress),r=s.filter(a=>a.position<=20),o=s.filter(a=>a.correctCount+a.incorrectCount>0),i=o.length>0?r.length/o.length:0;return{usedChainLearning:!0,causalRetentionRate:i,chronologicalRetentionRate:i,randomRetentionRate:i*.9,causalEffect:i*.1,chronologicalEffect:i*.1,periodStart:Date.now()-30*24*60*60*1e3,periodEnd:Date.now()}}analyzeEfficiency(e,t,s,r){const o=[],i=[],a=[];if(r){const f=e.efficiencyScore-r.efficiencyScore;f>5?o.push(`Â≠¶ÁøíÂäπÁéá„Åå${Math.round(f)}„Éù„Ç§„É≥„ÉàÂêë‰∏ä„Åó„Å¶„ÅÑ„Åæ„Åô`):f<-5&&i.push(`Â≠¶ÁøíÂäπÁéá„Åå${Math.round(Math.abs(f))}„Éù„Ç§„É≥„Éà‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Åæ„Åô`)}e.retentionRate>=.8?o.push("ÂÆöÁùÄÁéá„ÅåÈùûÂ∏∏„Å´È´ò„ÅÑ„Åß„ÅôÔºà80%‰ª•‰∏äÔºâ"):e.retentionRate<.5&&(i.push("ÂÆöÁùÄÁéá„Åå‰Ωé„ÇÅ„Åß„ÅôÔºà50%Êú™Ê∫ÄÔºâ"),a.push("Âæ©Áøí„ÅÆÈ†ªÂ∫¶„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ")),e.learningSpeed<3&&(i.push("Â≠¶ÁøíÈÄüÂ∫¶„ÅåÈÅÖ„ÇÅ„Åß„ÅôÔºà1Êó•3Ë™ûÂè•Êú™Ê∫ÄÔºâ"),a.push("Â≠¶ÁøíÊôÇÈñì„ÇíÂ¢ó„ÇÑ„Åô„Åã„ÄÅ1„Çª„ÉÉ„Ç∑„Éß„É≥„ÅÆÂïèÈ°åÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ")),e.forgettingRate>.3&&(i.push("ÂøòÂç¥Áéá„ÅåÈ´ò„ÇÅ„Åß„ÅôÔºà30%‰ª•‰∏äÔºâ"),a.push("ÂÆöÊúüÁöÑ„Å™Âæ©Áøí„ÇíÂèñ„ÇäÂÖ•„Çå„Åæ„Åó„Çá„ÅÜ"));const c=t.slice(0,3),l=t.slice(-3).reverse(),d=c.map(f=>`${f.field}Ôºà${Math.round(f.proficiency)}ÁÇπÔºâ`),h=l.filter(f=>f.proficiency<60).map(f=>`${f.field}Ôºà${Math.round(f.proficiency)}ÁÇπÔºâ`);return h.length>0&&a.push(`Ëã¶ÊâãÂàÜÈáéÔºà${h.join("„ÄÅ")}Ôºâ„ÅÆÈõÜ‰∏≠Â≠¶Áøí„ÇíÊ§úË®é„Åó„Åæ„Åó„Çá„ÅÜ`),s.usedChainLearning&&(s.causalEffect>.1&&(o.push("Âõ†ÊûúÈñ¢‰øÇÂ≠¶Áøí„ÅåÂäπÊûúÁöÑ„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô"),a.push("Âõ†ÊûúÈñ¢‰øÇ„ÇíÊÑèË≠ò„Åó„ÅüÂ≠¶Áøí„ÇíÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ")),s.chronologicalEffect>.1&&(o.push("ÊôÇÁ≥ªÂàóÂ≠¶Áøí„ÅåÂäπÊûúÁöÑ„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô"),a.push("Ê≠¥Âè≤„ÅÆÊµÅ„Çå„ÇíÈáçË¶ñ„Åó„ÅüÂ≠¶Áøí„ÇíÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ"))),E.info("[SocialStudiesEfficiencyAI] Â≠¶ÁøíÂäπÁéáÂàÜÊûêÁµêÊûú",{metrics:e,improvements:o.length,concerns:i.length,recommendations:a.length,strengths:d.length,weaknesses:h.length}),{improvements:o,concerns:i,recommendations:a,strengths:d,weaknesses:h}}}const xZ=new gZ;function yZ({dataSource:n="social-studies-sample"}){const[e,t]=T.useState([]),[s,r]=T.useState(0),[o,i]=T.useState([]),[a,c]=T.useState(null),[l,d]=T.useState(!1),[h,f]=T.useState(0),[p,m]=T.useState(0),[g,x]=T.useState(!0),[y,b]=T.useState(null),[v,w]=T.useState([]),[S,I]=T.useState("all"),[C,k]=T.useState("priority");T.useEffect(()=>{$()},[n]);const $=async()=>{try{x(!0),b(null);const D=await fetch(`/data/social-studies/${n}.json`);if(!D.ok)throw new Error(`„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${D.statusText}`);const G=await D.json();t(G),await mZ(n),x(!1)}catch(D){console.error("Á§æ‰ºöÁßë„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",D),b(D instanceof Error?D.message:"‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü"),x(!1)}},N=T.useMemo(()=>{let D=e;return S!=="all"&&(D=D.filter(G=>G.relatedFields.includes(S))),C==="priority"?D=[...D].sort((G,te)=>{const W=pu(G.term),de=pu(te.term),le=(W==null?void 0:W.position)??35;return((de==null?void 0:de.position)??35)-le}):C==="chronological-asc"?D=[...D].sort((G,te)=>(G.year||9999)-(te.year||9999)):C==="chronological-desc"?D=[...D].sort((G,te)=>(te.year||0)-(G.year||0)):D=[...D].sort(()=>Math.random()-.5),D},[e,S,C]);T.useEffect(()=>{N.length!==0&&_()},[s,N]);const _=()=>{if(N.length===0)return;const D=N[s],G=D.term,W=D.choiceHints.split("|").map(le=>le.trim()).slice(0,2),de=[{text:G,isCorrect:!0},...W.map(le=>({text:le,isCorrect:!1}))];de.sort(()=>Math.random()-.5),i(de)},P=D=>{if(l)return;c(D),d(!0),m(p+1);const G=N[s],te=D===G.term;te&&f(h+1),kb(G.term,G.relatedFields.split("|")[0].trim(),te,!1);const W=Tb(G.term,3);w(W)},j=()=>{if(l)return;c("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),d(!0),m(p+1);const D=N[s];kb(D.term,D.relatedFields.split("|")[0].trim(),!1,!0);const G=Tb(D.term,3);w(G)},A=()=>{c(null),d(!1),w([]),r((s+1)%N.length)},F=T.useMemo(()=>{try{const D=nx();return xZ.calculateOverallMetrics(D)}catch(D){return console.error("ÂäπÁéá„É°„Éà„É™„ÇØ„ÇπË®àÁÆó„Ç®„É©„Éº:",D),null}},[p]);if(g)return u.jsx("div",{className:"flex items-center justify-center h-64",children:u.jsx("div",{className:"text-lg text-gray-600",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})});if(y)return u.jsx("div",{className:"flex items-center justify-center h-64",children:u.jsxs("div",{className:"text-lg text-red-600",children:["„Ç®„É©„Éº: ",y]})});if(N.length===0)return u.jsx("div",{className:"flex items-center justify-center h-64",children:u.jsx("div",{className:"text-lg text-gray-600",children:"ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"})});const M=N[s],K=p>0?Math.round(h/p*100):0;return u.jsxs("div",{className:"social-studies-view max-w-4xl mx-auto p-4",children:[u.jsx("div",{className:"mb-6 bg-white rounded-lg shadow-md p-4",children:u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{className:"text-lg font-bold",children:["Ê≠£Ëß£Áéá: ",u.jsxs("span",{className:"text-blue-600",children:[K,"%"]})]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h," / ",p,"ÂïèÊ≠£Ëß£"]})]}),F&&p>0&&u.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("span",{className:"text-gray-600",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("span",{className:"font-medium text-green-600",children:[Math.round(F.retentionRate*100),"%"]})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("span",{className:"text-gray-600",children:"Â≠¶ÁøíÈÄüÂ∫¶:"}),u.jsxs("span",{className:"font-medium text-purple-600",children:[F.learningSpeed,"Ë™û/Êó•"]})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("span",{className:"text-gray-600",children:"ÂäπÁéá:"}),u.jsxs("span",{className:"font-medium text-orange-600",children:[Math.round(F.efficiencyScore),"ÁÇπ"]})]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("select",{title:"ÂàÜÈáé„ÅßÁµû„ÇäËæº„ÇÄ","aria-label":"ÂàÜÈáé„ÅßÁµû„ÇäËæº„ÇÄ",value:S,onChange:D=>I(D.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂàÜÈáé"}),u.jsxs("optgroup",{label:"Ê≠¥Âè≤",children:[u.jsx("option",{value:"Ê≠¥Âè≤-Âè§‰ª£",children:"Âè§‰ª£"}),u.jsx("option",{value:"Ê≠¥Âè≤-‰∏≠‰∏ñ",children:"‰∏≠‰∏ñ"}),u.jsx("option",{value:"Ê≠¥Âè≤-Ëøë‰∏ñ",children:"Ëøë‰∏ñ"}),u.jsx("option",{value:"Ê≠¥Âè≤-Ëøë‰ª£",children:"Ëøë‰ª£"}),u.jsx("option",{value:"Ê≠¥Âè≤-Áèæ‰ª£",children:"Áèæ‰ª£"})]}),u.jsxs("optgroup",{label:"Âú∞ÁêÜ",children:[u.jsx("option",{value:"Âú∞ÁêÜ-Êó•Êú¨",children:"Êó•Êú¨"}),u.jsx("option",{value:"Âú∞ÁêÜ-‰∏ñÁïå",children:"‰∏ñÁïå"}),u.jsx("option",{value:"Âú∞ÁêÜ-Áî£Ê•≠",children:"Áî£Ê•≠"}),u.jsx("option",{value:"Âú∞ÁêÜ-Áí∞Â¢É",children:"Áí∞Â¢É"})]}),u.jsxs("optgroup",{label:"ÂÖ¨Ê∞ë",children:[u.jsx("option",{value:"ÂÖ¨Ê∞ë-ÊîøÊ≤ª",children:"ÊîøÊ≤ª"}),u.jsx("option",{value:"ÂÖ¨Ê∞ë-ÁµåÊ∏à",children:"ÁµåÊ∏à"}),u.jsx("option",{value:"ÂÖ¨Ê∞ë-ÂõΩÈöõ",children:"ÂõΩÈöõ"}),u.jsx("option",{value:"ÂÖ¨Ê∞ë-‰∫∫Ê®©",children:"‰∫∫Ê®©"})]})]}),u.jsxs("select",{title:"‰∏¶„Å≥È†Ü","aria-label":"‰∏¶„Å≥È†Ü",value:C,onChange:D=>k(D.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm",children:[u.jsx("option",{value:"random",children:"„É©„É≥„ÉÄ„É†"}),u.jsx("option",{value:"chronological-asc",children:"ÊôÇÁ≥ªÂàóÔºàÂè§‚ÜíÊñ∞Ôºâ"}),u.jsx("option",{value:"chronological-desc",children:"ÊôÇÁ≥ªÂàóÔºàÊñ∞‚ÜíÂè§Ôºâ"})]})]})]})}),u.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsxs("div",{className:"text-sm text-gray-500",children:["ÂïèÈ°å ",s+1," / ",N.length]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full",children:M.relatedFields}),M.year&&u.jsxs("span",{className:"px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full",children:[M.year,"Âπ¥"]})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("p",{className:"text-xl font-bold text-gray-800 mb-2",children:M.question}),M.matter&&u.jsxs("p",{className:"text-sm text-gray-600",children:["Ôºà",M.matter,"Ôºâ"]})]}),u.jsx("div",{className:"space-y-3 mb-6",children:o.map((D,G)=>{const te=a===D.text,W=D.isCorrect,de=l;let le="w-full p-4 text-left border-2 rounded-lg transition-all duration-200 ";return de?te&&W?le+="border-green-500 bg-green-50":te&&!W?le+="border-red-500 bg-red-50":W?le+="border-green-500 bg-green-50":le+="border-gray-300 bg-gray-50":le+="border-gray-300 hover:border-blue-500 hover:bg-blue-50",u.jsx("button",{onClick:()=>P(D.text),disabled:l,className:le,children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("span",{className:"text-lg font-medium",children:D.text}),de&&W&&u.jsx("span",{className:"text-green-600",children:"‚úì Ê≠£Ëß£"}),de&&te&&!W&&u.jsx("span",{className:"text-red-600",children:"‚úó ‰∏çÊ≠£Ëß£"})]})},G)})}),!l&&u.jsx("button",{onClick:j,className:"w-full p-3 border-2 border-gray-400 rounded-lg text-gray-700 hover:bg-gray-100 transition-all duration-200",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"}),l&&u.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[u.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-800",children:"üìù Ëß£Ë™¨"}),u.jsx("p",{className:"text-gray-700 mb-4",children:M.explanation}),M.relatedMatters&&u.jsxs("div",{className:"mt-4",children:[u.jsx("h4",{className:"text-sm font-bold text-gray-700 mb-2",children:"üîó Èñ¢ÈÄ£‰∫ãÈ†Ö"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:M.relatedMatters.split("|").map((D,G)=>u.jsx("span",{className:"px-3 py-1 bg-blue-50 text-blue-700 text-sm rounded-full border border-blue-200",children:D.trim()},G))})]}),v.length>0&&u.jsxs("div",{className:"mt-4 p-3 bg-purple-50 rounded-lg border border-purple-200",children:[u.jsx("h4",{className:"text-sm font-bold text-purple-800 mb-2",children:"üîç Ê¨°„Å´Â≠¶„Å∂„Å®„Çà„ÅÑË™ûÂè•"}),u.jsx("div",{className:"space-y-2",children:v.map((D,G)=>{const te=pu(D.term),W=te?te.position<=20?"‚úÖ ÁøíÂæóÊ∏à„Åø":te.position<=40?"üìö ÂÆöÁùÄ‰∏≠":te.position<=70?"üìñ Â≠¶Áøí‰∏≠":"‚ùì Ëã¶Êâã":"üÜï Êú™Â≠¶Áøí";return u.jsx("div",{className:"flex items-start justify-between p-2 bg-white rounded border border-purple-100",children:u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-medium text-purple-900",children:D.term}),u.jsx("span",{className:"text-xs text-purple-600",children:W})]}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:D.reason})]})},G)})}),u.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"üí° „Éí„É≥„Éà: „Åì„Çå„Çâ„ÅÆË™ûÂè•„ÇíÂ≠¶Áøí„Åô„Çã„Å®„ÄÅÁêÜËß£„ÅåÊ∑±„Åæ„Çä„Åæ„Åô"})]})]}),u.jsx("button",{onClick:A,className:"mt-6 w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all duration-200",children:"Ê¨°„ÅÆÂïèÈ°å„Å∏ ‚Üí"})]})]})}const bZ=({isVisible:n,message:e="Ë™≠„ÅøËæº„Åø‰∏≠..."})=>n?u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 pointer-events-auto",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-6 animate-in fade-in duration-300",children:[u.jsxs("div",{className:"relative w-16 h-16",children:[u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-gray-200"}),u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-600 animate-spin"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:e}),u.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Ê∫ñÂÇô‰∏≠„Åß„Åô..."})]})]})}):null;let au=null,cu=null;async function Ab(){return au||(au=(await Yn(()=>Promise.resolve().then(()=>TY),void 0)).default,au)}async function Eb(){return cu||(cu=(await Yn(()=>Promise.resolve().then(()=>kY),void 0)).default,cu)}function Rb(){typeof requestIdleCallback<"u"?requestIdleCallback(()=>{Ab(),Eb()}):setTimeout(()=>{Ab(),Eb()},2e3)}const _k=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function wZ(){try{let n=0;const e=[];for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r){const o=localStorage.getItem(r);if(o){const i=new Blob([o]).size;n+=i,e.push({key:r,size:i})}}}const t=n/(1024*1024);E.log(`üìä LocalStorage‰ΩøÁî®Èáè: ${t.toFixed(2)}MB`),e.sort((s,r)=>r.size-s.size),e.slice(0,5).forEach(s=>{const r=s.size/1048576;E.log(`  - ${s.key}: ${r.toFixed(2)}MB`)}),t>4&&(E.warn("‚ö†Ô∏è LocalStorage„ÅÆ‰ΩøÁî®Èáè„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂè§„ÅÑ„Éá„Éº„Çø„ÇíËá™ÂãïÂâäÈô§„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"),cs(),E.log("Ëá™ÂãïÂúßÁ∏Æ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ"))}catch(n){E.error("LocalStorage„Çµ„Ç§„Ç∫„ÅÆÁ¢∫Ë™ç„Ç®„É©„Éº:",n)}}function vZ(){const[n,e]=T.useState("translation"),[t,s]=T.useState(!1),[r,o]=T.useState([]),[i,a]=T.useState(()=>PX()),[c,l]=T.useState(!1);T.useEffect(()=>{jX(i)},[i]),T.useEffect(()=>{!window.location.hostname.includes("github.io")&&Yn(()=>import("./scoreBoardTests-CdBC1UKO.js"),__vite__mapDeps([0,1,2])).then(()=>{E.log("‚úÖ „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü"),E.log("   ‰Ωø„ÅÑÊñπ: window.runScoreBoardTests()"),E.log('   „Åæ„Åü„ÅØ: window.checkCurrentScoreBoardDisplay("translation")')}).catch(H=>{E.error("„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",H)})},[]);const{categoryList:d,setCategoryList:h,selectedCategory:f,setSelectedCategory:p,selectedDifficulty:m,setSelectedDifficulty:g,selectedWordPhraseFilter:x,setSelectedWordPhraseFilter:y,selectedPhraseTypeFilter:b,setSelectedPhraseTypeFilter:v}=DX(),[w,S]=T.useState(()=>{const we=localStorage.getItem("selectedDataSource-translation");if(we)try{return JSON.parse(we)}catch{return"all"}return"all"}),[I,C]=T.useState(()=>{const we=localStorage.getItem("selectedDataSource-spelling");if(we)try{return JSON.parse(we)}catch{return"all"}return"all"}),[k,$]=T.useState([]),[N,_]=T.useState(!1),P=T.useRef(!1);T.useEffect(()=>{P.current=!1},[n]),T.useEffect(()=>{N&&(n==="translation"||n==="spelling")&&!P.current&&M.questions.length===0&&(P.current=!0,ce())},[N,n]);const[j]=T.useState(()=>{const we=localStorage.getItem("quiz-adaptive-mode");return we?JSON.parse(we):!1}),{sessionStats:A,setSessionStats:F,quizState:M,setQuizState:K,reviewFocusMode:D,setReviewFocusMode:G,reviewQuestionPool:te,setReviewQuestionPool:W,reviewCorrectStreak:de,setReviewCorrectStreak:le}=_X(),[oe]=T.useState(()=>new Ol),{reAddQuestion:ge,clearExpiredFlags:Ae,updateRequeueStats:Ue,checkPositionMismatch:Pe}=Ll(),[Ne,Ye]=T.useState(0),[at,mt]=T.useState(!1),[wt,kt]=T.useState(null),dt=T.useRef(0),ue=T.useRef(0),xe=T.useRef([]),Q=T.useRef(0),fe=T.useRef([]),Z=T.useRef(null),Fe=T.useRef(null),Ge=T.useRef(new Map),Le=T.useRef([]),ut=T.useRef([]);T.useEffect(()=>{if(n!=="translation"||!at||M.questions.length===0)return;const we=M.currentIndex,H=M.answered?we+1:we;(async()=>{try{const Me=M.questions.slice(H);if(Me.length===0){mt(!1),kt(null),Ye(0);return}E.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:Ne,reason:wt,currentIndex:we,startIndex:H,remaining:Me.length});const Je=await oe.schedule({questions:Me,mode:"translation",limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:A.correct,incorrect:A.incorrect,still_learning:A.review||0,mastered:A.mastered||0,duration:Date.now()-dt.current},useMetaAI:!0,isReviewFocusMode:D,hybridMode:!0});K(vt=>{if(vt.currentIndex!==we)return vt;const bt=vt.questions.slice(0,H);return{...vt,questions:[...bt,...Je.scheduledQuestions]}}),Ye(0),mt(!1),kt(null),E.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:Je.scheduledQuestions.length})}catch(Me){E.error("[Translation] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",Me),mt(!1),kt(null)}})()},[n,at,Ne,wt,M.questions,M.currentIndex,M.answered,oe,A,D]),RX(),T.useEffect(()=>{const we=vt=>{const bt=vt==="dark"||vt==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark-mode",bt)},Te=localStorage.getItem("darkMode")||"system";we(Te);const Me=window.matchMedia("(prefers-color-scheme: dark)"),Je=()=>{const vt=localStorage.getItem("darkMode");(!vt||vt==="system")&&we("system")};return Me.addEventListener("change",Je),()=>Me.removeEventListener("change",Je)},[]),T.useEffect(()=>{(async()=>{try{E.log("üîÑ „Éá„Éº„ÇøÁßªË°å„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...");try{await o$()}catch(De){E.error("Migration error (continuing):",De)}Pb();let H=!1;try{const De=await cs();De&&De.wordProgress&&De.statistics&&De.questionSetStats?(Pr(De),E.log("‚úÖ Progress data loaded successfully"),H=!0):E.warn("‚ö†Ô∏è Progress data incomplete, reinitializing")}catch(De){E.error("Progress load error:",De)}if(!H){E.log("üîß Initializing fresh progress data");const De={results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},wordProgress:{},categoryStats:{},difficultyStats:{}};Pr(De);try{localStorage.setItem("progress-data",JSON.stringify(De))}catch($t){E.warn("Failed to save initial progress:",$t)}}wZ();const Me=await(await fetch("/data/vocabulary/high-school-entrance-words.csv")).text(),Je=Za(Me).map(De=>({...De,source:"junior"}));let vt=[];try{const $t=await(await fetch("/data/vocabulary/high-school-entrance-phrases.csv")).text();vt=Za($t).map(Pt=>({...Pt,source:"junior"})),E.log(`üìö È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${vt.length}ÂÄã`)}catch(De){E.warn("È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",De)}let bt=[];try{const $t=await(await fetch("/data/vocabulary/junior-high-intermediate-words.csv")).text();bt=Za($t).map(Pt=>({...Pt,source:"intermediate"})),E.log(`üìö ‰∏≠Â≠¶Â±•‰øÆÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${bt.length}ÂÄã`)}catch(De){E.warn("‰∏≠Â≠¶Â±•‰øÆÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",De)}let He=[];try{const $t=await(await fetch("/data/vocabulary/junior-high-intermediate-phrases.csv")).text();He=Za($t).map(Pt=>({...Pt,source:"intermediate"})),E.log(`üìö ‰∏≠Â≠¶Â±•‰øÆÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${He.length}ÂÄã`)}catch(De){E.warn("‰∏≠Â≠¶Â±•‰øÆÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",De)}const yt=new Map;try{for(const De of[1,2,3])try{const Pt=await(await fetch(`/data/sentence-ordering-grade${De}.json`)).json();Pt.units&&Pt.units.forEach(Xt=>{const Zt=`${De}Âπ¥ ${Xt.unit}`;yt.set(Xt.unit,`${Xt.unit}: ${Xt.title}`),yt.set(Zt,`${De}Âπ¥ ${Xt.unit}: ${Xt.title}`)})}catch($t){E.warn(`Grade ${De} sentence ordering data not found:`,$t)}}catch(De){E.warn("Unit title mapping failed:",De)}const Gt=[...Je,...vt,...bt,...He];if(Gt.length>0){o(Gt);try{const tt=Gt.map($e=>({word:$e.word,difficulty:$e.difficulty||"beginner"}));localStorage.setItem("all-questions-cache",JSON.stringify(tt))}catch(tt){E.warn("Questions cache save failed:",tt)}const Pt=Array.from(new Set(Gt.map(tt=>tt.category||"").filter(tt=>tt))).map(tt=>yt.has(tt)?yt.get(tt):tt).sort((tt,$e)=>{const X=/(\d+)Âπ¥\s+Unit\s+(\d+)/i,me=tt.match(X),Be=$e.match(X);if(me&&Be){const ht=parseInt(me[1],10),_e=parseInt(Be[1],10);if(ht!==_e)return ht-_e;const Oe=parseInt(me[2],10),ot=parseInt(Be[2],10);return Oe-ot}const nt=/Unit\s+(\d+)/i,Ct=tt.match(nt),st=$e.match(nt);if(Ct&&st){const ht=parseInt(Ct[1],10),_e=parseInt(st[1],10);return ht-_e}return tt.localeCompare($e,"ja")});h(Pt);const Xt={id:"all",name:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà",questions:Gt,createdAt:Date.now(),isBuiltIn:!0,source:"È´òÊ†°ÂèóÈ®ì2758Ë™û + È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ1791Ë™û"},Zt={id:"junior",name:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö",questions:Gt.filter(tt=>tt.source==="junior"),createdAt:Date.now(),isBuiltIn:!0,source:"high-school-entrance (ÂçòË™û2662 + ÁÜüË™û96)"},jt={id:"intermediate",name:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ",questions:Gt.filter(tt=>tt.source==="intermediate"),createdAt:Date.now(),isBuiltIn:!0,source:"junior-high-intermediate (ÂçòË™û1579 + ÁÜüË™û212)"},{getCustomQuestionSets:Jt}=await Yn(async()=>{const{getCustomQuestionSets:tt}=await Promise.resolve().then(()=>eb);return{getCustomQuestionSets:tt}},void 0),Vt=(await Jt()).map(tt=>{const $e=new Date(tt.createdAt),X=`${$e.getMonth()+1}/${$e.getDate()}`,me=tt.source==="reading"?"Èï∑Êñá":tt.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï";return{id:tt.id,name:`„Ç´„Çπ„Çø„É†ÂïèÈ°åÔºà${me}_${X}Ôºâ`,questions:tt.questions,createdAt:tt.createdAt,isBuiltIn:!1,source:tt.source==="reading"?"Èï∑ÊñáË™≠Ëß£":tt.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}});$([Xt,Zt,jt,...Vt]),_(!0)}}catch(H){E.error("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",H),alert("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}})()},[]);const ye=async()=>{try{const{getCustomQuestionSets:we}=await Yn(async()=>{const{getCustomQuestionSets:Je}=await Promise.resolve().then(()=>eb);return{getCustomQuestionSets:Je}},void 0),H=await we(),Te=k.filter(Je=>Je.isBuiltIn),Me=H.map(Je=>({id:Je.id,name:Je.name,questions:Je.questions,createdAt:Je.createdAt,isBuiltIn:!1,source:Je.source==="reading"?"Èï∑ÊñáË™≠Ëß£":Je.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}));Te.length>0&&$([...Te,...Me])}catch(we){E.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆÂÜçË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",we)}};T.useEffect(()=>{localStorage.setItem("quiz-adaptive-mode",JSON.stringify(j))},[j]),T.useEffect(()=>{localStorage.setItem("selectedDataSource-translation",JSON.stringify(w))},[w]),T.useEffect(()=>{localStorage.setItem("selectedDataSource-spelling",JSON.stringify(I))},[I]),T.useEffect(()=>{M.questions.length>0&&ce()},[n,w,I,f,m,x,b]),T.useEffect(()=>{if(!N)return;const we=H=>H==="all"||k.some(Te=>Te.id===H);we(w)||S("all"),we(I)||C("all")},[N,k,w,I,S,C]);const Ve=we=>{let H=r;if(we!=="all"){const Te=k.find(Me=>Me.id===we);Te?H=Te.questions:H=H.filter(Me=>Me.source===we)}if(f!=="all"&&(H=H.filter(Te=>Te.category===f)),m!=="all"){const Te={all:"",beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö"};H=H.filter(Me=>Me.difficulty===Te[m])}return x==="words-only"?H=H.filter(Te=>!Te.word.includes(" ")):x==="phrases-only"&&(H=H.filter(Te=>Te.word.includes(" ")),b!=="all"&&(H=H.filter(Te=>ak(Te.word)===b))),H=D0(H),H},lt=(we,H)=>{const Te=MX(we,H);a(Me=>({...Me,sets:[...Me.sets,Te]})),E.log(`‚úÖ „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${we}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü`)},B=we=>{a(H=>LX(H,we)),E.log("üóëÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü")},L=(we,H,Te)=>{a(Me=>zX(Me,we,{name:H,description:Te})),E.log(`‚úèÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${H}„Äç„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`)},U=(we,H)=>{a(Te=>FX(Te,we,H)),E.log(`‚ûï „Äå${H.word}„Äç„Çí„Çª„ÉÉ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`)},V=(we,H)=>{a(Te=>OX(Te,we,H)),E.log(`‚ûñ „Äå${H.word}„Äç„Çí„Çª„ÉÉ„Éà„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü`)},ce=async()=>{var Jt;const we=D9();E.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥:",we);const H=C0();let Me=Ve(n==="spelling"?I:w);if(Me.length===0){alert("ÊåáÂÆö„Åï„Çå„ÅüÊù°‰ª∂„ÅÆÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}if(D){const St=Xu();if(Me=Me.filter(Vt=>St.some(tt=>tt&&Vt.word&&tt.toLowerCase()===Vt.word.toLowerCase())),Me.length===0){alert("Ë¶ÅÂæ©ÁøíÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"),G(!1),W([]);return}W([...Me]),E.log(`üéØ Ë£ú‰øÆ„É¢„Éº„ÉâÈñãÂßã: ${Me.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å`)}const Je=UX(r,d),vt=gk();vt?(XX(Je),E.log(`üìä ÊîπÂñÑÈÄ≤Êçó: ${vt.currentDay}Êó•ÁõÆ - ÂÖ®‰ΩìÈÄ≤Êçó${vt.overallProgress.toFixed(1)}%`)):Je.weakCategories.length>0&&(QX(Je),E.log("üéØ „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÊîπÂñÑ„Éó„É©„É≥„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü")),Je.aiRecommendations.length>0&&(E.log("üß† AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà „Åã„Çâ„ÅÆÊé®Â•®:"),Je.aiRecommendations.forEach(St=>E.log(`  ${St}`))),Je.weakCategories.length>0&&f==="all"&&(Me=KX(Me,Je.weakCategories,Math.min(30,Me.length)),E.log(`üí° Âº±ÁÇπÂàÜÈáé„ÇíÂÑ™ÂÖàÂá∫È°å: ${Je.weakCategories.slice(0,3).map(St=>St.category).join(", ")}`));const bt=Xu(),yt=P0(10).map(St=>St.word);let Gt=[];if(bt.length>0){const St=Me.filter(tt=>bt.some($e=>$e&&tt.word&&$e.toLowerCase()===tt.word.toLowerCase()));Gt=H.maxReviewCount>0?St.slice(0,H.maxReviewCount):[];const Vt=Me.filter(tt=>!bt.some($e=>$e&&tt.word&&$e.toLowerCase()===tt.word.toLowerCase()));Me=[...Gt,...Vt],Gt.length>0&&E.log(`üîÑ Ë¶ÅÂæ©ÁøíÂïèÈ°å: ${Gt.length}ÂïèÔºà‰∏äÈôê: ${H.maxReviewCount}ÂïèÔºâ`)}if(yt.length>0){const St=Me.filter(Vt=>yt.some(tt=>tt&&Vt.word&&tt.toLowerCase()===Vt.word.toLowerCase()));if(St.length>0){const Vt=Me.filter(tt=>!yt.some($e=>$e&&tt.word&&$e.toLowerCase()===tt.word.toLowerCase()));Me=[...St,...Vt],E.log(`üîó Ê∑∑ÂêåÂ±•Ê≠¥: ${St.length}Âïè„ÇíÂÑ™ÂÖàÂá∫È°å`)}}if(!D&&Me.length>0){const St=await cs(),Vt=new Map;Me.forEach(st=>{const ht=St.wordProgress[st.word];if(ht&&ht.learningHistory&&ht.learningHistory.length>0){const _e=ht.learningHistory.map(ot=>({timestamp:ot.timestamp,wasCorrect:ot.wasCorrect,responseTime:ot.responseTime,userAnswer:ot.userAnswer,confidenceLevel:ot.responseTime<2e3?"instant":ot.responseTime<5e3?"hesitant":"guessed",sessionContext:{questionIndex:ot.sessionIndex||0,previousQuestions:[],sessionFatigue:0}})),Oe=JX(st.word,ht,_e);Vt.set(st.word,Oe)}});const tt=t9(Me,St.wordProgress,Vt),$e=s9(tt,Me.length),X=tb(fe.current,dt.current);Z.current=X;const me=i9($e,X),Be=new Map(me.map(st=>[st.word,st]));if(Me=Me.filter(st=>Be.has(st.word)).sort((st,ht)=>{const _e=Be.get(st.word).priority;return Be.get(ht.word).priority-_e}),E.log("üß† Â≠¶ÁøíÊõ≤Á∑öAI: ÊúÄÈÅ©„Å™Âá∫È°åÈ†ÜÂ∫è„ÇíÊ±∫ÂÆö"),E.log("  Âá∫È°åÊà¶Áï•:",me.slice(0,5).map(st=>`${st.word}(${st.strategy}, ÊàêÂäüÁéá${st.estimatedSuccessRate.toFixed(0)}%)`).join(", ")),X.fatigueLevel>40){const st=c9(X);E.log(`‚ö° Ë™çÁü•Ë≤†Ëç∑: ${X.fatigueLevel.toFixed(0)}% - ${st}`)}const nt=zI(Me,St.wordProgress,ut.current),Ct=new Map;if(nt.sequence.forEach((st,ht)=>{Ct.set(st,ht)}),Me=Me.sort((st,ht)=>{const _e=Ct.get(st.word)??999,Oe=Ct.get(ht.word)??999;return _e-Oe}),E.log("üîó ÊñáËÑàÂ≠¶ÁøíAI: ÊÑèÂë≥ÁöÑ„ÇØ„É©„Çπ„Çø„É™„É≥„Ç∞ÂÆå‰∫Ü"),E.log(`  „ÇØ„É©„Çπ„Çø„ÉºÊï∞: ${nt.clusters.length}`),nt.transitions.length>0){const st=nt.transitions[0];E.log(`  ‰æã: ${st.from} ‚Üí ${st.to} (${st.reason})`)}}if(n==="translation"&&Me.length>0){await cs();const St=await oe.schedule({questions:Me,mode:"translation",limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:A.correct,incorrect:A.incorrect,still_learning:A.review||0,mastered:A.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:D,hybridMode:!0});Me=St.scheduledQuestions,St.vibrationScore>50&&E.warn("[Translation Hybrid] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:St.vibrationScore,processingTime:St.processingTime}),E.log("üß† „É°„ÇøAIÁµ±ÂêàÂ±§: „Éè„Ç§„Éñ„É™„ÉÉ„ÉâË™øÊï¥ÂÆå‰∫Ü",{total:Me.length,vibrationScore:St.vibrationScore,adjustmentRange:"¬±20%"})}D?E.log(`üéØ Ë£ú‰øÆ„É¢„Éº„Éâ: ${Me.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å‰∏≠`):E.log(`üìö Â≠¶ÁøíÊï∞: ${Me.length}Âïè`),K({questions:Me,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),Ye(0),mt(!1),kt(null),F({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),dt.current=Date.now(),ue.current=Date.now(),xe.current=[],fe.current=[],Z.current=null;const De=await cs(),$t=l9(De.wordProgress,Le.current);Fe.current=$t;const Pt=Me.map(St=>St.word),Xt=((Jt=Z.current)==null?void 0:Jt.fatigueLevel)??0,Zt=m9(Pt,De.wordProgress,$t,Xt);Ge.current=Zt,E.log("üîÆ „Ç®„É©„Éº‰∫àÊ∏¨AI: Ë™§Á≠î„É™„Çπ„ÇØÂàÜÊûêÂÆå‰∫Ü");const jt=Array.from(Zt.values()).filter(St=>St.warningLevel==="high"||St.warningLevel==="critical").sort((St,Vt)=>Vt.errorRisk-St.errorRisk);jt.length>0&&(E.log(`  È´ò„É™„Çπ„ÇØÂïèÈ°å: ${jt.length}Âïè`),E.log(`  ÊúÄÈ´ò„É™„Çπ„ÇØ: ${jt[0].word} (${jt[0].errorRisk.toFixed(0)}% - ${jt[0].primaryPattern})`))},ie=()=>{D?(G(!1),W([]),le(new Map)):(G(!0),le(new Map))},O=()=>{D?(G(!1),W([]),le(new Map)):(G(!0),le(new Map))},q=we=>{p(we),G(!1),W([]),M.questions.length>0&&ce()},re=we=>{g(we),G(!1),W([]),M.questions.length>0&&ce()},ve=async(we,H,Te)=>{var De,$t,Pt,Xt;if(M.answered)return;const Me=we==="ÂàÜ„Åã„Çâ„Å™„ÅÑ",Je=we.trim(),vt=H.trim(),bt=!Me&&Je===vt,He=M.questions[M.currentIndex];!bt&&Te&&Te.word&&(await _0(Te.word,He.word),E.log(`üîó Ê∑∑Âêå„ÇíË®òÈå≤: ${Te.word} ‚Üê ${He.word}`));const yt=Date.now()-ue.current;if(He){const jt=(De=(await cs()).wordProgress)==null?void 0:De[He.word],St=1-(jt?jt.correctCount/(jt.correctCount+jt.incorrectCount):.5);fe.current.push({timestamp:Date.now(),wasCorrect:bt,responseTime:yt,questionDifficulty:St});const Vt=tb(fe.current,dt.current);Z.current=Vt,($t=Vt.breakRecommendation)!=null&&$t.shouldBreak&&E.log(`üí§ ‰ºëÊÜ©Êé®Â•®: ${Vt.breakRecommendation.reason}`),Le.current.push({word:He.word,wasCorrect:bt,userAnswer:Je}),Le.current.length>50&&(Le.current=Le.current.slice(-50))}if(He){await No(He.word,bt,yt,void 0,"translation");const jt=(Pt=(await cs()).wordProgress)==null?void 0:Pt[He.word];let Jt=bt?"correct":"incorrect";jt&&jt.masteryLevel==="mastered"?Jt="mastered":!bt&&jt&&jt.incorrectCount>=2&&(Jt="review"),F(tt=>({...tt,correct:tt.correct+(Jt==="correct"?1:0),incorrect:tt.incorrect+(Jt==="incorrect"?1:0),review:tt.review+(Jt==="review"?1:0),mastered:tt.mastered+(Jt==="mastered"?1:0)})),ba({status:Jt,word:He.word,timestamp:Date.now()},"translation"),ut.current.push(He.word),ut.current.length>10&&(ut.current=ut.current.slice(-10)),Q.current++;const Vt=(Xt=(await cs()).wordProgress)==null?void 0:Xt[He.word];if(Vt&&Vt.skippedCount&&Vt.skippedCount>0&&(bt?mk(He.word):(pk(He.word),E.log("ü§î AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Çπ„Ç≠„ÉÉ„Éó„Åó„ÅüÂçòË™û„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„ÅÆÂçòË™û„ÇíÂÜçÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ"))),xc({id:yc(),questionSetId:"main-set-single",questionSetName:"È´òÊ†°ÂèóÈ®ìËã±ÂçòË™û",score:bt?1:0,total:1,percentage:bt?100:0,date:Date.now(),timeSpent:Math.floor(yt/1e3),incorrectWords:bt?[]:[He.word],mode:"translation",category:f!=="all"?f:void 0,difficulty:m!=="all"?m:void 0}),bt||xe.current.push(He.word),D){const tt=new Map(de);if(bt){const $e=tt.get(He.word)||0;if(tt.set(He.word,$e+1),$e+1>=2){const X=te.filter(me=>me.word!==He.word);W(X),E.log(`‚úÖ ${He.word} „ÇíË£ú‰øÆÂØæË±°„Åã„ÇâÈô§Â§ñ (2ÂõûÈÄ£Á∂öÊ≠£Ëß£)`),X.length===0&&(alert("üéâ „Åô„Åπ„Å¶„ÅÆË¶ÅÂæ©ÁøíÂïèÈ°å„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„ÅüÔºÅ"),G(!1),le(new Map))}}else tt.set(He.word,0);le(tt)}}if(He){const Zt=String(He.word);Br.onShown(Zt),Br.onAnswer(Zt,bt),Ue(He,A,F)}let Gt=M.questions;!D&&He&&!bt&&(Gt=ge(He,M.questions,M.currentIndex,"translation")),D||Ye(Zt=>{const jt=Zt+1;if(jt>=50)return mt(!0),kt("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(jt%10===0){const Jt=Pe(Gt,"translation");Jt.needsRescheduling&&(mt(!0),kt(Jt.reason))}return jt}),K(Zt=>({...Zt,questions:Gt,answered:!0,selectedAnswer:we,score:bt?Zt.score+1:Zt.score,totalAnswered:Zt.totalAnswered+1}))},be=()=>{K(we=>{var Me;const H=D?te:we.questions,Te=we.currentIndex+1;if(!D&&Te<H.length){const Je=Ae(H,Te-1);if(Je!==H)return{...we,questions:Je,currentIndex:Te,answered:!1,selectedAnswer:null}}if(!D&&Te>=H.length){if(!window.location.hostname.includes("github.io"))try{const Pt=Br.summarize();E.log("üß™ KPI Summary (translation):",Pt)}catch{}const Je=Date.now(),vt=fe.current.reduce((Pt,Xt)=>Pt+Xt.responseTime,0),bt=fe.current.length>0?vt/fe.current.length:0,He=((Me=Z.current)==null?void 0:Me.fatigueLevel)??0,yt=g9(dt.current,Je,we.totalAnswered,we.score,bt,He,A.correct+A.mastered,A.review);v9(yt);const Gt=S9();if(Gt.length>=3){const Pt=w9("user",Gt),Xt=xk(),Zt=C9(Pt,Xt);E.log("üìä Â≠¶Áøí„Çπ„Çø„Ç§„É´AI:",Zt)}const De=(Je-dt.current)/(1e3*60),$t=R9(we.score,we.totalAnswered,bt,De,A.correct+A.mastered,He);E.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥ÁµêÊûú:"),E.log(`  Áç≤ÂæóXP: ${$t.xpGained}`),$t.leveledUp&&E.log(`  üéâ „É¨„Éô„É´„Ç¢„ÉÉ„Éó! Lv.${$t.newLevel}`),$t.feedback.forEach(Pt=>{E.log(`  ${Pt.icon} ${Pt.message}`)})}return D&&Te>=H.length?(E.log("üîÑ Ë£ú‰øÆ„É¢„Éº„Éâ: ÂïèÈ°å„ÇíÁπ∞„ÇäËøî„Åó„Åæ„Åô"),{...we,questions:H,currentIndex:0,answered:!1,selectedAnswer:null}):{...we,questions:H,currentIndex:Te%H.length,answered:!1,selectedAnswer:null}}),ue.current=Date.now()},ke=()=>{K(we=>({...we,currentIndex:we.currentIndex>0?we.currentIndex-1:0,answered:!1,selectedAnswer:null}))},Ie=async()=>{const we=M.questions[M.currentIndex];if(we){const H=Date.now()-ue.current;await Vh(we.word,30),fk(we.word),await No(we.word,!0,H,void 0,"translation"),K(Te=>({...Te,score:Te.score+1,totalAnswered:Te.totalAnswered+1,currentIndex:(Te.currentIndex+1)%Te.questions.length,answered:!1,selectedAnswer:null})),F(Te=>({...Te,correct:Te.correct+1,mastered:Te.mastered+1})),ba({status:"correct",word:we.word,timestamp:Date.now()},"translation")}else K(H=>({...H,currentIndex:(H.currentIndex+1)%H.questions.length,answered:!1,selectedAnswer:null}));ue.current=Date.now(),!D&&n==="translation"&&Ye(H=>{const Te=H+1;if(Te>=50)return mt(!0),kt("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(Te%10===0){const Me=Pe(M.questions,"translation");Me.needsRescheduling&&(mt(!0),kt(Me.reason))}return Te})},Re=we=>{const H=M.questions[M.currentIndex];if(H){const Te=Date.now()-ue.current;No(H.word,M.selectedAnswer===H.meaning,Te,we,"translation")}};return u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx(bZ,{isVisible:t,message:"Ë™≠„ÅøËæº„Åø‰∏≠..."}),u.jsxs("div",{className:"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2",children:[u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="memorization"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("memorization"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° ÊöóË®ò"}),u.jsx("span",{className:"sm:hidden",children:"ÊöóË®ò"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="translation"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("translation"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üìù ÂíåË®≥"}),u.jsx("span",{className:"sm:hidden",children:"ÂíåË®≥"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="spelling"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("spelling"),children:[u.jsx("span",{className:"hidden sm:inline",children:"‚úèÔ∏è „Çπ„Éö„É´"}),u.jsx("span",{className:"sm:hidden",children:"„Çπ„Éö„É´"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="grammar"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>{e("grammar"),s(!0),setTimeout(()=>s(!1),1500),Rb()},children:[u.jsx("span",{className:"hidden sm:inline",children:"üìö ÊñáÊ≥ï"}),u.jsx("span",{className:"sm:hidden",children:"ÊñáÊ≥ï"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="reading"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>{e("reading"),s(!0),setTimeout(()=>s(!1),1500),Rb()},children:[u.jsx("span",{className:"hidden sm:inline",children:"üìñ Èï∑Êñá"}),u.jsx("span",{className:"sm:hidden",children:"Èï∑Êñá"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="social-studies"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("social-studies"),children:[u.jsx("span",{className:"hidden sm:inline",children:"üåè Á§æ‰ºö"}),u.jsx("span",{className:"sm:hidden",children:"Á§æ‰ºö"})]}),u.jsxs("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="settings"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("settings"),children:[u.jsx("span",{className:"hidden sm:inline",children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsx("span",{className:"sm:hidden",children:"Ë®≠ÂÆö"})]})]}),u.jsx(BY,{isOpen:c,onClose:()=>l(!1),sets:i.sets,onCreateSet:lt,onDeleteSet:B,onEditSet:L,onRemoveWord:V}),u.jsx("div",{className:"p-2 md:p-6 bg-gray-50",children:u.jsx("div",{className:"max-w-app mx-auto",children:n==="memorization"?u.jsx(WY,{allQuestions:r,questionSets:k,customQuestionSets:i.sets,onAddWordToCustomSet:U,onRemoveWordFromCustomSet:V,onOpenCustomSetManagement:()=>l(!0)}):n==="translation"?u.jsx(tY,{quizState:M,_categoryList:d,selectedCategory:f,onCategoryChange:q,selectedDifficulty:m,onDifficultyChange:re,selectedWordPhraseFilter:x,onWordPhraseFilterChange:y,selectedPhraseTypeFilter:b,onPhraseTypeFilterChange:v,selectedDataSource:w,onDataSourceChange:S,questionSets:k,onStartQuiz:ce,onAnswer:ve,onNext:be,onPrevious:ke,onSkip:Ie,onDifficultyRate:Re,onReviewFocus:ie,sessionStats:A,isReviewFocusMode:D,errorPrediction:M.questions.length>0&&M.currentIndex<M.questions.length?Ge.current.get(M.questions[M.currentIndex].word):void 0,customQuestionSets:i.sets,onAddWordToCustomSet:U,onRemoveWordFromCustomSet:V,onOpenCustomSetManagement:()=>l(!0)}):n==="spelling"?u.jsx(rY,{questions:M.questions,questionSets:k,_categoryList:d,selectedCategory:f,onCategoryChange:q,selectedDifficulty:m,onDifficultyChange:re,selectedWordPhraseFilter:x,onWordPhraseFilterChange:y,selectedPhraseTypeFilter:b,onPhraseTypeFilterChange:v,selectedDataSource:I,onDataSourceChange:C,onStartQuiz:ce,onReviewFocus:O,isReviewFocusMode:D,customQuestionSets:i.sets,onAddWordToCustomSet:U,onRemoveWordFromCustomSet:V,onOpenCustomSetManagement:()=>l(!0)}):n==="social-studies"?u.jsx(yZ,{dataSource:"social-studies-sample"}):n==="reading"?u.jsx(Tk,{customQuestionSets:i.sets,onAddWordToCustomSet:U,onRemoveWordFromCustomSet:V,onOpenCustomSetManagement:()=>l(!0),onSaveUnknownWords:async we=>{if(we.length===0)return;const H=new Date,Me=`Èï∑ÊñáÂçòË™ûÈõÜ (${`${H.getMonth()+1}/${H.getDate()}`})`,Je=prompt(`${we.length}ÂÄã„ÅÆÂçòË™û„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÂïèÈ°åÈõÜ„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`,Me);if(!Je)return;const vt={id:yc(),name:Je,questions:we.map(He=>({word:He.word,reading:He.reading||"",meaning:He.meaning,etymology:He.etymology||"",relatedWords:He.relatedWords||"",relatedFields:He.relatedFields||"",difficulty:He.difficulty||"intermediate"})),createdAt:Date.now(),isBuiltIn:!1,source:"Èï∑ÊñáË™≠Ëß£"},bt=[...k,vt];$(bt),ok(bt),alert(`‚úÖ ÂïèÈ°åÈõÜ„Äå${Je}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºà${we.length}Ë™ûÔºâ`)}}):n==="grammar"?u.jsx(Ak,{}):u.jsx(uZ,{allQuestions:r,customQuestionSets:i.sets,questionSets:k,categoryList:d,onResetComplete:()=>e("settings"),onQuestionSetsUpdated:ye,onOpenCustomSetManagement:()=>l(!0),onStartSession:(we,H)=>{K({questions:H,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),dt.current=Date.now(),ue.current=Date.now(),xe.current=[],e("translation")}})})})]})}const SZ=()=>{const n=localStorage.getItem("darkMode");let e="system";n==="system"||n==="light"||n==="dark"?e=n:n==="true"?(e="dark",localStorage.setItem("darkMode","dark")):n==="false"&&(e="light",localStorage.setItem("darkMode","light"));let t=!1;e==="system"?t=window.matchMedia("(prefers-color-scheme: dark)").matches:t=e==="dark",document.documentElement.classList.toggle("dark",t)};SZ();Pf.createRoot(document.getElementById("root")).render(u.jsx(Wk.StrictMode,{children:u.jsx(vZ,{})}));export{pJ as a,E as b,j0 as c,Uh as d,nd as e,Yu as f,Ju as g,ek as h,Sk as i,nk as j,RZ as k,rt as l};
//# sourceMappingURL=index-0jeQuMXc.js.map
