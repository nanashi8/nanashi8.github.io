{"version":3,"file":"ScheduleStrategy-BFw-1z1Q.js","sources":["../../src/ai/scheduler/strategies/ScheduleStrategy.ts"],"sourcesContent":["/**\n * ScheduleStrategy - Strategy Patternインターフェース\n *\n * QuestionSchedulerのモード切り替えロジックを個別Strategyクラスへ分離\n *\n * 【設計方針】\n * - Open/Closed Principle: 新モード追加時は既存コード変更不要\n * - Single Responsibility: 各Strategyは1つのスケジューリング戦略に専念\n * - Dependency Injection: 依存関係を明示的に注入\n *\n * 【使用例】\n * ```typescript\n * const strategy = new HybridScheduleStrategy(dependencies);\n * const result = await strategy.schedule(context);\n * ```\n */\n\nimport type { PrioritizedQuestion, ScheduleResult, ScheduleParams } from '../types';\nimport type { AntiVibrationFilter } from '../AntiVibrationFilter';\nimport type { AICoordinator } from '@/ai/AICoordinator';\nimport type { SlotAllocator } from '../SlotAllocator';\nimport type { BatchManager } from '../BatchManager';\n\n/**\n * スケジューリング戦略の共通インターフェース\n */\nexport interface ScheduleStrategy {\n  /**\n   * 問題をスケジューリング\n   *\n   * @param context - スケジューリングコンテキスト\n   * @returns スケジューリング結果\n   */\n  schedule(context: ScheduleContext): Promise<ScheduleResult>;\n}\n\n/**\n * スケジューリングコンテキスト\n *\n * Strategy実行に必要な全情報を集約\n */\nexport interface ScheduleContext {\n  /** スケジューリングパラメータ */\n  params: ScheduleParams;\n\n  /** スケジューリング開始時刻（performance.now()） */\n  startTime: number;\n\n  /** 依存関係 */\n  dependencies: SchedulerDependencies;\n\n  /** 進捗データ（wordProgress） */\n  progressData: Record<string, any>;\n}\n\n/**\n * Schedulerの依存関係\n *\n * Dependency Injectionで注入される外部コンポーネント\n */\nexport interface SchedulerDependencies {\n  /** 振動防止フィルタ */\n  antiVibration: AntiVibrationFilter;\n\n  /** AIコーディネーター（7AI統合） */\n  aiCoordinator: AICoordinator;\n\n  /** スロット割り当て管理 */\n  slotAllocator: SlotAllocator;\n\n  /** バッチ管理（nullの場合はバッチモード無効） */\n  batchManager: BatchManager | null;\n\n  /**\n   * QuestionSchedulerインスタンス（Context）\n   *\n   * Strategy PatternにおけるContextとして機能。\n   * Strategyから共通処理（buildContext, detectSignals等）を呼び出すために必要。\n   *\n   * TODO: 工程6で共通ヘルパーに抽出し、この依存を削除\n   */\n  scheduler: any; // QuestionScheduler型（循環参照回避のためany）\n}\n\n/**\n * ベース戦略クラス\n *\n * 共通処理を実装し、各Strategy実装の重複を削減\n */\nexport abstract class BaseScheduleStrategy implements ScheduleStrategy {\n  protected deps: SchedulerDependencies;\n\n  constructor(deps: SchedulerDependencies) {\n    this.deps = deps;\n  }\n\n  /**\n   * スケジューリング実行（抽象メソッド）\n   *\n   * 各Strategy実装で具体的なロジックを定義\n   */\n  abstract schedule(context: ScheduleContext): Promise<ScheduleResult>;\n\n  /**\n   * 結果を構築（共通処理）\n   *\n   * @param questions - 優先度付き問題リスト\n   * @param meta - メタ情報\n   * @returns スケジューリング結果\n   */\n  protected buildResult(\n    questions: PrioritizedQuestion[],\n    meta: {\n      source: string;\n      elapsed: number;\n      vibrationScore?: number;\n      signalCount?: number;\n      debugInfo?: any;\n    }\n  ): ScheduleResult {\n    return {\n      scheduledQuestions: questions.map((pq) => pq.question),\n      vibrationScore: meta.vibrationScore ?? 0,\n      processingTime: meta.elapsed,\n      signalCount: meta.signalCount ?? 0,\n      debug: {\n        dtaApplied: 0, // Strategyで計算して設定\n        antiVibrationApplied: 0, // Strategyで計算して設定\n        signalsDetected: [],\n        ...meta.debugInfo,\n      },\n    };\n  }\n\n  /**\n   * デバッグログ出力（共通処理）\n   *\n   * @param message - ログメッセージ\n   * @param data - ログデータ\n   */\n  protected log(message: string, data?: any): void {\n    if (import.meta.env.DEV && localStorage.getItem('debug-scheduler-verbose') === 'true') {\n      console.log(`[${this.constructor.name}] ${message}`, data || '');\n    }\n  }\n\n  /**\n   * エラーログ出力（共通処理）\n   *\n   * @param message - エラーメッセージ\n   * @param error - エラーオブジェクト\n   */\n  protected logError(message: string, error?: any): void {\n    console.error(`[${this.constructor.name}] ${message}`, error || '');\n  }\n}\n"],"names":["BaseScheduleStrategy","deps","__publicField","questions","meta","pq","message","data","error"],"mappings":"oKAyFO,MAAeA,CAAiD,CAGrE,YAAYC,EAA6B,CAF/BC,EAAA,aAGR,KAAK,KAAOD,CACd,CAgBU,YACRE,EACAC,EAOgB,CAChB,MAAO,CACL,mBAAoBD,EAAU,IAAKE,GAAOA,EAAG,QAAQ,EACrD,eAAgBD,EAAK,gBAAkB,EACvC,eAAgBA,EAAK,QACrB,YAAaA,EAAK,aAAe,EACjC,MAAO,CACL,WAAY,EACZ,qBAAsB,EACtB,gBAAiB,CAAA,EACjB,GAAGA,EAAK,SAAA,CACV,CAEJ,CAQU,IAAIE,EAAiBC,EAAkB,CAIjD,CAQU,SAASD,EAAiBE,EAAmB,CACrD,QAAQ,MAAM,IAAI,KAAK,YAAY,IAAI,KAAKF,CAAO,GAAIE,GAAS,EAAE,CACpE,CACF"}