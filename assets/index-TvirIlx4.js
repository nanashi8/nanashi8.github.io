const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/scoreBoardTests-Brf3ccKG.js","assets/chart-vendor-Eu4deRvW.js","assets/react-vendor-C14am9Lm.js"])))=>i.map(i=>d[i]);
var GI=Object.defineProperty;var HI=(n,e,t)=>e in n?GI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ee=(n,e,t)=>HI(n,typeof e!="symbol"?e+"":e,t);import{j as u}from"./chart-vendor-Eu4deRvW.js";import{a as qI,g as KI,c as vi,b as XI,r as T,R as QI}from"./react-vendor-C14am9Lm.js";function YI(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var mp={},j0=qI;mp.createRoot=j0.createRoot,mp.hydrateRoot=j0.hydrateRoot;const JI="modulepreload",ZI=function(n){return"/"+n},M0={},gs=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=ZI(c),c in M0)return;M0[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":JI,l||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return r.then(i=>{for(const a of i||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},Jy=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function ek(n){return Jy.includes(n)}const Ml=typeof window<"u"&&new URLSearchParams(window.location.search).get("debug")==="true",_={log:(...n)=>{Ml&&console.log(...n)},warn:(...n)=>{Ml&&console.warn(...n)},error:(...n)=>{console.error(...n)},debug:(...n)=>{Ml&&console.debug(...n)},info:(...n)=>{Ml&&console.info(...n)}};class zt{static start(e){this.enabled&&performance.mark(`${e}-start`)}static end(e){if(!this.enabled)return 0;try{if(performance.getEntriesByName(`${e}-start`,"mark").length===0)return 0;performance.mark(`${e}-end`),performance.measure(e,`${e}-start`,`${e}-end`);const s=performance.getEntriesByName(e),r=s[s.length-1],o=(r==null?void 0:r.duration)||0;return this.measurements.has(e)||this.measurements.set(e,[]),this.measurements.get(e).push(o),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e),o}catch{return 0}}static getStats(e){const t=this.measurements.get(e);return!t||t.length===0?null:{count:t.length,avg:t.reduce((s,r)=>s+r,0)/t.length,min:Math.min(...t),max:Math.max(...t),p50:this.percentile(t,.5),p95:this.percentile(t,.95),p99:this.percentile(t,.99)}}static percentile(e,t){if(e.length===0)return 0;const s=[...e].sort((o,i)=>o-i),r=Math.ceil(s.length*t)-1;return s[Math.max(0,r)]}static report(){if(!this.enabled)return;const e=Array.from(this.measurements.keys()).map(t=>{const s=this.getStats(t);return s?{label:t,count:s.count,avg:`${s.avg.toFixed(2)}ms`,min:`${s.min.toFixed(2)}ms`,max:`${s.max.toFixed(2)}ms`,p50:`${s.p50.toFixed(2)}ms`,p95:`${s.p95.toFixed(2)}ms`,p99:`${s.p99.toFixed(2)}ms`}:null}).filter(Boolean);console.group("üìä Performance Report"),console.table(e),console.groupEnd()}static export(){const e=Array.from(this.measurements.keys()).reduce((t,s)=>{const r=this.getStats(s);return r&&(t[s]=r),t},{});return JSON.stringify({timestamp:new Date().toISOString(),measurements:e},null,2)}static clear(){this.measurements.clear(),performance.clearMarks(),performance.clearMeasures()}static clearLabel(e){this.measurements.delete(e),performance.clearMarks(`${e}-start`),performance.clearMarks(`${e}-end`),performance.clearMeasures(e)}static warnIfSlow(e,t,s){this.enabled&&t>s&&console.warn(`‚ö†Ô∏è [PerformanceMonitor] ${e} took ${t.toFixed(2)}ms (threshold: ${s}ms)`)}static logWithStats(e,t){if(!this.enabled)return;const s=this.getStats(e);s&&s.count>=5?console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms (avg: ${s.avg.toFixed(2)}ms, p95: ${s.p95.toFixed(2)}ms)`):console.log(`‚è±Ô∏è ${e}: ${t.toFixed(2)}ms`)}}Ee(zt,"measurements",new Map),Ee(zt,"enabled",!1);const tk="QuizAppDB",nk=1,vn={PROGRESS:"progress",SESSION_HISTORY:"sessionHistory",DAILY_STATS:"dailyStats",SETTINGS:"settings"},Qo=class Qo{constructor(){Ee(this,"connections",[]);Ee(this,"pendingConnectionCreations",0);Ee(this,"config",{maxConnections:5,connectionTimeout:5e3,idleTimeout:6e4});Ee(this,"initializationPromise",null);Ee(this,"cleanupInterval",null);this.startCleanupTimer()}static getInstance(){return Qo.instance||(Qo.instance=new Qo),Qo.instance}async initialize(){return this.initializationPromise?this.initializationPromise:(this.initializationPromise=this.performInitialization(),this.initializationPromise)}async performInitialization(){zt.start("db-pool-init");try{this.pendingConnectionCreations++;const e=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:e,lastUsed:Date.now(),inUse:!1});const t=zt.end("db-pool-init");_.log(`üèä [DBConnectionPool] ÂàùÊúüÂåñÂÆå‰∫Ü (${t.toFixed(2)}ms)`)}catch(e){throw _.error("‚ùå [DBConnectionPool] ÂàùÊúüÂåñÂ§±Êïó:",e),e}}createNewConnection(){return new Promise((e,t)=>{zt.start("db-connection-open");const s=indexedDB.open(tk,nk),r=setTimeout(()=>{t(new Error("IndexedDB open timeout"))},this.config.connectionTimeout);s.onerror=()=>{clearTimeout(r),zt.end("db-connection-open"),_.error("‚ùå IndexedDB open error:",s.error),t(s.error)},s.onsuccess=()=>{clearTimeout(r),zt.end("db-connection-open"),e(s.result)},s.onupgradeneeded=o=>{const i=o.target.result;if(i.objectStoreNames.contains(vn.PROGRESS)||i.createObjectStore(vn.PROGRESS),!i.objectStoreNames.contains(vn.SESSION_HISTORY)){const a=i.createObjectStore(vn.SESSION_HISTORY,{keyPath:"id",autoIncrement:!0});a.createIndex("mode","mode",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("modeTimestamp",["mode","timestamp"],{unique:!1})}i.objectStoreNames.contains(vn.DAILY_STATS)||i.createObjectStore(vn.DAILY_STATS,{keyPath:"date"}).createIndex("date","date",{unique:!0}),i.objectStoreNames.contains(vn.SETTINGS)||i.createObjectStore(vn.SETTINGS),_.log("üì¶ [DBConnectionPool] Stores created")}})}async getConnection(){zt.start("db-pool-get-connection"),await this.initialize();const e=this.connections.find(t=>!t.inUse);if(e)return e.inUse=!0,e.lastUsed=Date.now(),zt.end("db-pool-get-connection"),e.db;if(this.connections.length+this.pendingConnectionCreations<this.config.maxConnections){this.pendingConnectionCreations++;const t=await this.createNewConnection().finally(()=>{this.pendingConnectionCreations--});this.connections.push({db:t,lastUsed:Date.now(),inUse:!0});const s=zt.end("db-pool-get-connection");return _.log(`‚ûï [DBConnectionPool] Êñ∞Ë¶èÊé•Á∂ö‰ΩúÊàê (${this.connections.length}/${this.config.maxConnections}) (${s.toFixed(2)}ms)`),t}return _.warn("‚ö†Ô∏è [DBConnectionPool] Êé•Á∂ö„Éó„Éº„É´Ê∫ÄÊùØ„ÄÅÂæÖÊ©ü‰∏≠..."),new Promise(t=>{const s=setInterval(()=>{const r=this.connections.find(o=>!o.inUse);if(r){clearInterval(s),r.inUse=!0,r.lastUsed=Date.now();const o=zt.end("db-pool-get-connection");_.log(`‚úÖ [DBConnectionPool] ÂæÖÊ©üÂæåÊé•Á∂öÂèñÂæó (${o.toFixed(2)}ms)`),t(r.db)}},10)})}releaseConnection(e){const t=this.connections.find(s=>s.db===e);t&&(t.inUse=!1,t.lastUsed=Date.now())}cleanupIdleConnections(){const t=Date.now()-this.config.idleTimeout,s=this.connections.filter(r=>!r.inUse&&r.lastUsed<t);s.length>0&&(s.forEach(r=>{r.db.close();const o=this.connections.indexOf(r);o!==-1&&this.connections.splice(o,1)}),_.log(`üßπ [DBConnectionPool] „Ç¢„Ç§„Éâ„É´Êé•Á∂öÂâäÈô§: ${s.length}ÂÄã`))}startCleanupTimer(){this.cleanupInterval=window.setInterval(()=>{this.cleanupIdleConnections()},3e4)}async closeAll(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.connections.forEach(e=>{try{e.db.close()}catch(t){_.error("‚ùå [DBConnectionPool] Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫„Ç®„É©„Éº:",t)}}),this.connections=[],this.initializationPromise=null,_.log("üîí [DBConnectionPool] ÂÖ®Êé•Á∂ö„ÇØ„É≠„Éº„Ç∫ÂÆå‰∫Ü")}getStats(){return{totalConnections:this.connections.length,inUseConnections:this.connections.filter(e=>e.inUse).length,availableConnections:this.connections.filter(e=>!e.inUse).length,maxConnections:this.config.maxConnections,oldestConnectionAge:this.connections.length>0?Math.min(...this.connections.map(e=>Date.now()-e.lastUsed)):0}}};Ee(Qo,"instance",null);let gp=Qo;const ec=gp.getInstance();async function sk(){return await ec.initialize(),ec.getConnection()}async function af(n,e,t){zt.start("db-transaction");const s=await ec.getConnection();try{const r=s.transaction(n,e),o=await t(r),i=zt.end("db-transaction");return o}finally{ec.releaseConnection(s)}}async function rk(){return ec.closeAll()}const ok="QuizAppDB";function Xu(){try{return"indexedDB"in window&&indexedDB!==null}catch{return!1}}function ik(){return zt.start("db-init-legacy"),sk().then(n=>(zt.end("db-init-legacy"),n)).catch(n=>{throw zt.end("db-init-legacy"),_.error("‚ùå IndexedDB initialization failed:",n),n})}async function cf(n,e){try{zt.start("db-get");const t=await af(n,"readonly",async r=>new Promise((o,i)=>{const c=r.objectStore(n).get(e);c.onsuccess=()=>o(c.result||null),c.onerror=()=>i(c.error)})),s=zt.end("db-get");return t}catch(t){return zt.end("db-get"),_.error("getFromDB error:",t),null}}async function pr(n,e,t){try{zt.start("db-put");const s=await af(n,"readwrite",async o=>new Promise((i,a)=>{const c=o.objectStore(n),l=t!==void 0?c.put(e,t):c.put(e);l.onsuccess=()=>i(!0),l.onerror=()=>a(l.error)})),r=zt.end("db-put");return s}catch(s){return zt.end("db-put"),_.error("putToDB error:",s),!1}}async function F0(n){try{zt.start("db-get-all");const e=await af(n,"readonly",async s=>new Promise((r,o)=>{const a=s.objectStore(n).getAll();a.onsuccess=()=>r(a.result||[]),a.onerror=()=>o(a.error)})),t=zt.end("db-get-all");return e}catch(e){return zt.end("db-get-all"),_.error("getAllFromDB error:",e),[]}}async function ak(){try{await rk(),_.log("üîí Connection pool closed before DB deletion")}catch(n){_.error("‚ö†Ô∏è Pool close error:",n)}return new Promise(n=>{const e=indexedDB.deleteDatabase(ok);e.onsuccess=()=>{_.log("üóëÔ∏è Database deleted"),n(!0)},e.onerror=()=>{_.error("Database delete error"),n(!1)}})}const Zy="indexeddb-migration-completed",lf="1.1";function Qu(){try{return localStorage.getItem(Zy)===lf}catch{return!1}}function Bh(){try{localStorage.setItem(Zy,lf),_.log("‚úÖ Migration flag set")}catch(n){_.error("Failed to set migration flag:",n)}}function Yu(n){try{const e=localStorage.getItem(n);return!e||n.includes("lastLogin")||n.includes("Date")||n.includes("daily-plan")||n.includes("score-board")?null:JSON.parse(e)}catch{return _.warn(`${n} is not valid JSON (skipping)`),null}}function ck(n){try{return localStorage.getItem(n)}catch(e){return _.error(`Failed to get ${n} from localStorage:`,e),null}}async function lk(){try{const n=Yu("progress-data");if(n)return n.wordProgress||(n.wordProgress={}),n.results||(n.results=[]),n.statistics||(n.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),n.questionSetStats||(n.questionSetStats={}),await pr(vn.PROGRESS,n,"main"),_.log("üì¶ Progress data migrated:",Object.keys(n.wordProgress||{}).length,"words"),!0;_.log("‚ÑπÔ∏è No progress data to migrate, creating initial data");const e={wordProgress:{},results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{}};return await pr(vn.PROGRESS,e,"main"),!0}catch(n){return _.error("Progress data migration error:",n),!1}}async function uk(){try{const n=["translation","spelling"];let e=0;for(const t of n){const s=`session-history-${t}`,r=Yu(s);if(r&&Array.isArray(r))for(const o of r)await pr(vn.SESSION_HISTORY,{mode:t,status:o.status,word:o.word,timestamp:o.timestamp}),e++}return e>0&&_.log("üìú Session history migrated:",e,"items"),!0}catch(n){return _.error("Session history migration error:",n),!1}}async function dk(){try{const n=new Date,e=new Date(n.getTime()-90*24*60*60*1e3);let t=0,s=0;for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.startsWith("studyStats-")){const i=o.replace("studyStats-","");if(new Date(i)>=e){const c=Yu(o);c&&(await pr(vn.DAILY_STATS,{date:i,...c}),t++)}else localStorage.removeItem(o),s++}}return(t>0||s>0)&&_.log(`üìä Daily stats: migrated ${t}, cleaned ${s}`),!0}catch(n){return _.error("Daily stats migration error:",n),!1}}async function hk(){try{const n=["user-goal-level","loginStreak","radar-improvement-progress","skip-exclude-groups"],e=["lastLoginDate","lastLoginData"];let t=0;for(const r of n)try{if(r.includes("lastLogin")){_.warn(`Skipping ${r} from JSON migration`);continue}const o=Yu(r);o!==null&&(await pr(vn.SETTINGS,o,r),t++)}catch(o){_.warn(`Failed to migrate ${r}:`,o)}for(const r of e)try{const o=ck(r);o!==null&&(await pr(vn.SETTINGS,o,r),t++)}catch(o){_.warn(`Failed to migrate ${r}:`,o)}const s=["translation","spelling","reading"];for(const r of s){const o=`daily-plan-target-${r}`,i=`score-board-goal-${r}`;try{const a=localStorage.getItem(o);a&&(await pr(vn.SETTINGS,a,o),t++)}catch(a){_.warn(`Failed to migrate ${o}:`,a)}try{const a=localStorage.getItem(i);a&&(await pr(vn.SETTINGS,a,i),t++)}catch(a){_.warn(`Failed to migrate ${i}:`,a)}}return t>0&&_.log("‚öôÔ∏è Settings migrated:",t,"items"),!0}catch(n){return _.error("Settings migration error:",n),!1}}async function pk(){try{const n=await cf(vn.PROGRESS,"main");return n?!n.wordProgress||typeof n.wordProgress!="object"?(_.warn("‚ö†Ô∏è Progress data verification failed - invalid wordProgress"),!1):(_.log("‚úÖ Migration verification passed"),!0):(_.warn("‚ö†Ô∏è Progress data verification failed - no data found"),!1)}catch(n){return _.error("Migration verification error:",n),!1}}async function fk(){if(Qu())return _.log("‚ÑπÔ∏è Migration already completed"),!0;if(!Xu())return _.warn("‚ö†Ô∏è IndexedDB not supported, using localStorage"),!1;_.log("üöÄ Starting data migration to IndexedDB...");try{await ik();const n=await Promise.all([lk(),uk(),dk(),hk()]),e=["Progress","SessionHistory","DailyStats","Settings"];return n.forEach((s,r)=>{s||_.warn(`‚ö†Ô∏è ${e[r]} migration incomplete (may be empty)`)}),n[0]||n.some(s=>s)?await pk()?(Bh(),_.log("üéâ Migration completed successfully!"),!0):(_.warn("‚ö†Ô∏è Migration verification failed, but marking as complete"),Bh(),!0):(_.warn("‚ö†Ô∏è All migrations returned false, marking as complete anyway"),Bh(),!0)}catch(n){return _.error("‚ùå Migration failed:",n),!1}}function mk(){return{completed:Qu(),indexedDBSupported:Xu(),version:lf}}let sa=!1;function eb(){sa=Xu()&&Qu(),_.log(`üì¶ Storage strategy: ${sa?"IndexedDB":"localStorage"}`)}async function tb(n){try{return sa?await pr(vn.PROGRESS,n,"main"):(localStorage.setItem("progress-data",JSON.stringify(n)),!0)}catch(e){_.error("saveProgressData error:",e);try{return localStorage.setItem("progress-data",JSON.stringify(n)),!0}catch(t){return _.error("localStorage fallback failed:",t),!1}}}async function nb(){try{if(sa){const n=await cf(vn.PROGRESS,"main");if(n)return n;const e=localStorage.getItem("progress-data");return e?JSON.parse(e):null}else{const n=localStorage.getItem("progress-data");return n?JSON.parse(n):null}}catch(n){return _.error("loadProgressData error:",n),null}}async function ya(n,e){try{return sa?await pr(vn.SETTINGS,e,n):(localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0)}catch(t){_.error(`saveSetting(${n}) error:`,t);try{return localStorage.setItem(n,typeof e=="string"?e:JSON.stringify(e)),!0}catch{return!1}}}async function mc(n){try{if(sa){const e=await cf(vn.SETTINGS,n);return e!==null?e:localStorage.getItem(n)||null}else return localStorage.getItem(n)||null}catch(e){return _.error(`loadSetting(${n}) error:`,e),null}}const gk=Object.freeze(Object.defineProperty({__proto__:null,initStorageStrategy:eb,loadProgressData:nb,loadSetting:mc,saveProgressData:tb,saveSetting:ya},Symbol.toStringTag,{value:"Module"}));class xk{filter(e,t){if(e.length===0)return e;const s=Date.now();let r=0;const o=e.map(i=>{if(i.position>=40)return i;const a=this.findRecentAnswer(i.question.word,t.recentAnswers);if(!a)return i;const c=s-a.timestamp;let l=!1,d=i.position;return c<3e4?(d-=100,l=!0,_.debug(`[AntiVibration] Âç≥Â∫ßÂÜçÂá∫È°åÈò≤Ê≠¢: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-100})):c<t.minInterval&&a.correct?(d-=5,l=!0,_.debug(`[AntiVibration] Áü≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-5})):c<t.minInterval*5&&a.correct&&(d-=2,l=!0,_.debug(`[AntiVibration] ‰∏≠ÊôÇÈñìÂÜçÂá∫È°å„Éö„Éä„É´„ÉÜ„Ç£: ${i.question.word}`,{timeSinceAnswer:Math.round(c/1e3)+"s",penalty:-2})),a.consecutiveCorrect>=t.consecutiveThreshold&&(d-=2,l=!0,_.debug(`[AntiVibration] ÈÄ£Á∂öÊ≠£Ëß£È†ªÂ∫¶‰ΩéÊ∏õ: ${i.question.word}`,{consecutiveCorrect:a.consecutiveCorrect,penalty:-2})),l?(r++,{...i,position:d,antiVibrationApplied:!0}):i});return r>0&&_.info(`[AntiVibration] „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®: ${r}Âïè„Å´ÊåØÂãïÈò≤Ê≠¢„Éö„Éä„É´„ÉÜ„Ç£`),o}findRecentAnswer(e,t){return t.find(s=>s.word===e)||null}calculateVibrationScore(e,t,s=20){if(e.length===0)return 0;const r=Date.now();let o=0;const i=e.slice(0,Math.min(s,e.length));i.forEach(c=>{const l=this.findRecentAnswer(c.question.word,t);if(!l)return;const d=r-l.timestamp;d<6e4?o+=10:d<3e5?o+=5:d<6e5&&(o+=2),l.consecutiveCorrect>=3&&(o+=5)});const a=Math.min(o,100);return a>50&&_.warn(`[AntiVibration] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫: ${a}`,{topQuestions:i.slice(0,5).map(c=>c.question.word)}),a}extractSessionPriorityQuestions(e){return e.filter(t=>t.question.sessionPriority!==void 0)}extractNormalQuestions(e){return e.filter(t=>t.question.sessionPriority===void 0)}}function yk(n,e){const t=e!=null&&e.mode?String(e.mode):"";return t?[`${n}_${t}`,n]:[n]}function su(n,e){if(typeof localStorage>"u")return{raw:null,key:null};const t=yk(n,e);for(const s of t)try{const r=localStorage.getItem(s);if(r!=null)return{raw:r,key:s}}catch{}return{raw:null,key:null}}function sb(n,e){const{raw:t,key:s}=su(n,e);if(!t)return{value:null,key:null};try{return{value:JSON.parse(t),key:s}}catch{return{value:null,key:null}}}function Fi(n,e,t,s){if(typeof localStorage>"u")return;const r=t!=null&&t.mode?String(t.mode):"",o=(s==null?void 0:s.writeLegacy)!==!1;try{const i=JSON.stringify(e);r&&localStorage.setItem(`${n}_${r}`,i),o&&localStorage.setItem(n,i)}catch{}}const Vh={weights:{memory:1,cognitiveLoad:.8,errorPrediction:.7,learningStyle:.5,linguistic:.4,contextual:.6,gamification:.3},emergencyThresholds:{forgettingRisk:150,cognitiveOverload:!0,consecutiveErrors:5},debugMode:!1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bk=1e-7,wk=1e-4;class rb{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class uf{refCount(e){return Cs("refCount")}incRef(e){return Cs("incRef")}timerAvailable(){return!0}time(e){return Cs("time")}read(e){return Cs("read")}readSync(e){return Cs("readSync")}readToGPU(e,t){return Cs("readToGPU")}numDataIds(){return Cs("numDataIds")}disposeData(e,t){return Cs("disposeData")}write(e,t,s){return Cs("write")}move(e,t,s,r,o){return Cs("move")}createTensorFromGPUData(e,t,s){return Cs("createTensorFromGPUData")}memory(){return Cs("memory")}floatPrecision(){return Cs("floatPrecision")}epsilon(){return this.floatPrecision()===32?bk:wk}dispose(){return Cs("dispose")}}function Cs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vk(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Vi(n,e,t)}function ii(n,e,t){return Math.max(n,Math.min(e,t))}function df(n){return n%2===0?n:n+1}function Vi(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function Sk(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function E(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function hf(n,e,t=""){E(en(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function ob(n){E(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function we(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function en(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ra(n){return n%1===0}function xp(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Xi(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function O0(n,e=r=>0,t,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const c=e(i);if(t!=null&&i>=t){o();return}s!=null?s(a,c):setTimeout(a,c)};a()})}function ib(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Bt(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),E(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),E(n.every(s=>ra(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function Ro(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Bt(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function Jn(n,e){return In(n,e)}function In(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function Ck(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function Nk(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function ab(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function iu(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function Ik(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function gc(n){return typeof n=="string"||n instanceof String}function kk(n){return typeof n=="boolean"}function yp(n){return typeof n=="number"}function ba(n){return Array.isArray(n)?ba(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":yp(n)?"float32":gc(n)?"string":kk(n)?"bool":"float32"}function bp(n){return!!(n&&n.constructor&&n.call&&n.apply)}function wp(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function xt(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function cb(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((c,l)=>c*l)*(s?2:1);for(let c=0;c<o;c++)r[c]=cb(n+c*a,i,t,s)}return r}function mr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return cb(0,n,e,t)}function $k(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function pf(n,e){const t=Zn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Zn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function lb(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return mr(n,new Float32Array(t));if(e==="int32")return mr(n,new Int32Array(t));if(e==="bool")return mr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function oo(n){n.forEach(e=>{E(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function jr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function wa(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function ff(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L0="tfjsflags";class Tk{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ak,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(fe().getBool("IS_TEST")||fe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];fe().getBool("IS_TEST")||fe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(ff(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);L0 in e&&e[L0].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=Rk(r,o)})}}function Ak(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(Ek(e,s[0],s[1]),s.join("="))),e}function Ek(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Rk(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function fe(){return ub}let ub=null;function Dk(n){ub=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Uh;function db(){if(Uh==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Uh=n}return Uh}function _k(){const n=db();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function mf(n,e){const t=_k();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const Ju="Abs",xc="Acos",yc="Acosh",va="Add",gf="AddN",xf="All",yf="Any",Zu="ArgMax",ed="ArgMin",bc="Asin",wc="Asinh",vc="Atan",Sc="Atanh",Cc="Atan2",td="AvgPool",bf="AvgPoolGrad",nd="AvgPool3D",wf="AvgPool3DGrad",sd="BatchMatMul",rd="BatchToSpaceND",vf="Bincount",Sf="BitwiseAnd",Pk="BroadcastTo",hb="BroadcastArgs",Nc="Cast",Ic="Ceil",kc="ClipByValue",Cf="Complex",od="ComplexAbs",id="Concat",ad="Conv2D",Nf="Conv2DBackpropFilter",cd="Conv2DBackpropInput",ld="Conv3D",If="Conv3DBackpropFilterV2",kf="Conv3DBackpropInputV2",$c="Cos",Tc="Cosh",$f="Cumprod",ud="Cumsum",Tf="CropAndResize",Af="DenseBincount",Ef="DepthToSpace",dd="DepthwiseConv2dNative",Rf="DepthwiseConv2dNativeBackpropFilter",Df="DepthwiseConv2dNativeBackpropInput",pb="Diag",hd="Dilation2D",vp="Dilation2DBackpropInput",Sp="Dilation2DBackpropFilter",jk="Draw",Ac="RealDiv",_f="Einsum",Ec="Elu",Pf="EluGrad",Rc="Erf",pd="Equal",Dc="Exp",fd="ExpandDims",_c="Expm1",jf="FFT",Mf="Fill",Ff="FlipLeftRight",Pc="Floor",jc="FloorDiv",md="FusedBatchNorm",gd="GatherV2",fb="GatherNd",xd="Greater",Mc="GreaterEqual",Fc="Identity",Of="IFFT",Lf="Imag",Oc="IsFinite",Lc="IsInf",zc="IsNan",yd="LeakyRelu",bd="Less",wd="LessEqual",mb="LinSpace",Wc="Log",Bc="Log1p",vd="LogicalAnd",Sd="LogicalNot",Cd="LogicalOr",Mk="LogSoftmax",Nd="LRN",zf="LRNGrad",Id="Max",Vc="Maximum",kd="MaxPool",Wf="MaxPoolGrad",$d="MaxPool3D",Bf="MaxPool3DGrad",gb="MaxPoolWithArgmax",Td="Mean",Ad="Min",Uc="Minimum",Ed="MirrorPad",Gc="Mod",xb="Multinomial",Hc="Multiply",Rd="Neg",Dd="NotEqual",Vf="NonMaxSuppressionV3",Uf="NonMaxSuppressionV4",Gf="NonMaxSuppressionV5",_d="OnesLike",Pd="OneHot",jd="Pack",Md="PadV2",qc="Pow",Fd="Prelu",Od="Prod",yb="RaggedGather",bb="RaggedRange",wb="RaggedTensorToTensor",Hf="Range",qf="Real",Kc="Reciprocal",Xc="Relu",Ld="Reshape",zd="ResizeNearestNeighbor",Kf="ResizeNearestNeighborGrad",Wd="ResizeBilinear",Xf="ResizeBilinearGrad",Qc="Relu6",Bd="Reverse",Yc="Round",Jc="Rsqrt",vb="ScatterNd",Sb="TensorScatterUpdate",Cb="SearchSorted",Vd="Select",Zc="Selu",Ud="Slice",el="Sin",tl="Sinh",nl="Sign",sl="Sigmoid",rl="Softplus",ol="Sqrt",Gd="Sum",Hd="SpaceToBatchND",qd="SplitV",Kd="Softmax",Nb="SparseFillEmptyRows",Ib="SparseReshape",kb="SparseSegmentMean",$b="SparseSegmentSum",Tb="SparseToDense",il="SquaredDifference",Qf="Square",Yf="StaticRegexReplace",Jf="StridedSlice",Ab="StringNGrams",Eb="StringSplit",Rb="StringToHashBucketFast",al="Sub",cl="Tan",ll="Tanh",ul="Tile",Zf="TopK",em="Transform",Qi="Transpose",tm="Unique",Xd="Unpack",Qd="UnsortedSegmentSum",Yd="ZerosLike",dl="Step",Fk="FromPixels",nm="RotateWithOffset",au="_FusedMatMul",cu="FusedConv2D",Db="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ms(...n){fe().getBool("IS_TEST")||fe().getBool("PROD")||console.warn(...n)}function Ok(...n){fe().getBool("IS_TEST")||fe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lu=mf("kernelRegistry",()=>new Map),Cp=mf("gradRegistry",()=>new Map);function z0(n,e){const t=Pb(n,e);return lu.get(t)}function W0(n){return Cp.get(n)}function B0(n){const e=lu.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&t.push(i)}return t}function _b(n){const{kernelName:e,backendName:t}=n,s=Pb(e,t);lu.has(s)&&Ms(`The kernel '${e}' for backend '${t}' is already registered`),lu.set(s,n)}function Lk(n){const{kernelName:e}=n;Cp.has(e)&&fe().getBool("DEBUG")&&Ms(`Overriding the gradient for '${e}'`),Cp.set(e,n)}function Pb(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jb(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var Mb=mn,Ks=null;try{Ks=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function mn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}mn.prototype.__isLong__;Object.defineProperty(mn.prototype,"__isLong__",{value:!0});function Ps(n){return(n&&n.__isLong__)===!0}mn.isLong=Ps;var V0={},U0={};function Si(n,e){var t,s,r;return e?(n>>>=0,(r=0<=n&&n<256)&&(s=U0[n],s)?s:(t=gn(n,(n|0)<0?-1:0,!0),r&&(U0[n]=t),t)):(n|=0,(r=-128<=n&&n<128)&&(s=V0[n],s)?s:(t=gn(n,n<0?-1:0,!1),r&&(V0[n]=t),t))}mn.fromInt=Si;function Xs(n,e){if(isNaN(n))return e?Yo:Qs;if(e){if(n<0)return Yo;if(n>=Fb)return zb}else{if(n<=-H0)return As;if(n+1>=H0)return Lb}return n<0?Xs(-n,e).neg():gn(n%oa|0,n/oa|0,e)}mn.fromNumber=Xs;function gn(n,e,t){return new mn(n,e,t)}mn.fromBits=gn;var uu=Math.pow;function sm(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Qs;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var s;if((s=n.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return sm(n.substring(1),e,t).neg();for(var r=Xs(uu(t,8)),o=Qs,i=0;i<n.length;i+=8){var a=Math.min(8,n.length-i),c=parseInt(n.substring(i,i+a),t);if(a<8){var l=Xs(uu(t,a));o=o.mul(l).add(Xs(c))}else o=o.mul(r),o=o.add(Xs(c))}return o.unsigned=e,o}mn.fromString=sm;function vr(n,e){return typeof n=="number"?Xs(n,e):typeof n=="string"?sm(n,e):gn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}mn.fromValue=vr;var G0=65536,zk=1<<24,oa=G0*G0,Fb=oa*oa,H0=Fb/2,q0=Si(zk),Qs=Si(0);mn.ZERO=Qs;var Yo=Si(0,!0);mn.UZERO=Yo;var Ki=Si(1);mn.ONE=Ki;var Ob=Si(1,!0);mn.UONE=Ob;var Np=Si(-1);mn.NEG_ONE=Np;var Lb=gn(-1,2147483647,!1);mn.MAX_VALUE=Lb;var zb=gn(-1,-1,!0);mn.MAX_UNSIGNED_VALUE=zb;var As=gn(0,-2147483648,!1);mn.MIN_VALUE=As;var qe=mn.prototype;qe.toInt=function(){return this.unsigned?this.low>>>0:this.low};qe.toNumber=function(){return this.unsigned?(this.high>>>0)*oa+(this.low>>>0):this.high*oa+(this.low>>>0)};qe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(As)){var t=Xs(e),s=this.div(t),r=s.mul(t).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Xs(uu(e,6),this.unsigned),i=this,a="";;){var c=i.div(o),l=i.sub(c.mul(o)).toInt()>>>0,d=l.toString(e);if(i=c,i.isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}};qe.getHighBits=function(){return this.high};qe.getHighBitsUnsigned=function(){return this.high>>>0};qe.getLowBits=function(){return this.low};qe.getLowBitsUnsigned=function(){return this.low>>>0};qe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(As)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};qe.isZero=function(){return this.high===0&&this.low===0};qe.eqz=qe.isZero;qe.isNegative=function(){return!this.unsigned&&this.high<0};qe.isPositive=function(){return this.unsigned||this.high>=0};qe.isOdd=function(){return(this.low&1)===1};qe.isEven=function(){return(this.low&1)===0};qe.equals=function(e){return Ps(e)||(e=vr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};qe.eq=qe.equals;qe.notEquals=function(e){return!this.eq(e)};qe.neq=qe.notEquals;qe.ne=qe.notEquals;qe.lessThan=function(e){return this.comp(e)<0};qe.lt=qe.lessThan;qe.lessThanOrEqual=function(e){return this.comp(e)<=0};qe.lte=qe.lessThanOrEqual;qe.le=qe.lessThanOrEqual;qe.greaterThan=function(e){return this.comp(e)>0};qe.gt=qe.greaterThan;qe.greaterThanOrEqual=function(e){return this.comp(e)>=0};qe.gte=qe.greaterThanOrEqual;qe.ge=qe.greaterThanOrEqual;qe.compare=function(e){if(Ps(e)||(e=vr(e)),this.eq(e))return 0;var t=this.isNegative(),s=e.isNegative();return t&&!s?-1:!t&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};qe.comp=qe.compare;qe.negate=function(){return!this.unsigned&&this.eq(As)?As:this.not().add(Ki)};qe.neg=qe.negate;qe.add=function(e){Ps(e)||(e=vr(e));var t=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,d=0,h=0,p=0,f=0;return f+=o+l,p+=f>>>16,f&=65535,p+=r+c,h+=p>>>16,p&=65535,h+=s+a,d+=h>>>16,h&=65535,d+=t+i,d&=65535,gn(p<<16|f,d<<16|h,this.unsigned)};qe.subtract=function(e){return Ps(e)||(e=vr(e)),this.add(e.neg())};qe.sub=qe.subtract;qe.multiply=function(e){if(this.isZero())return Qs;if(Ps(e)||(e=vr(e)),Ks){var t=Ks.mul(this.low,this.high,e.low,e.high);return gn(t,Ks.get_high(),this.unsigned)}if(e.isZero())return Qs;if(this.eq(As))return e.isOdd()?As:Qs;if(e.eq(As))return this.isOdd()?As:Qs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(q0)&&e.lt(q0))return Xs(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,d=e.low&65535,h=0,p=0,f=0,m=0;return m+=i*d,f+=m>>>16,m&=65535,f+=o*d,p+=f>>>16,f&=65535,f+=i*l,p+=f>>>16,f&=65535,p+=r*d,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,p+=i*c,h+=p>>>16,p&=65535,h+=s*d+r*l+o*c+i*a,h&=65535,gn(f<<16|m,h<<16|p,this.unsigned)};qe.mul=qe.multiply;qe.divide=function(e){if(Ps(e)||(e=vr(e)),e.isZero())throw Error("division by zero");if(Ks){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ks.div_u:Ks.div_s)(this.low,this.high,e.low,e.high);return gn(t,Ks.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Yo:Qs;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Yo;if(e.gt(this.shru(1)))return Ob;o=Yo}else{if(this.eq(As)){if(e.eq(Ki)||e.eq(Np))return As;if(e.eq(As))return Ki;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(Qs)?e.isNegative()?Ki:Np:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(As))return this.unsigned?Yo:Qs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Qs}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:uu(2,a-48),l=Xs(s),d=l.mul(e);d.isNegative()||d.gt(r);)s-=c,l=Xs(s,this.unsigned),d=l.mul(e);l.isZero()&&(l=Ki),o=o.add(l),r=r.sub(d)}return o};qe.div=qe.divide;qe.modulo=function(e){if(Ps(e)||(e=vr(e)),Ks){var t=(this.unsigned?Ks.rem_u:Ks.rem_s)(this.low,this.high,e.low,e.high);return gn(t,Ks.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};qe.mod=qe.modulo;qe.rem=qe.modulo;qe.not=function(){return gn(~this.low,~this.high,this.unsigned)};qe.and=function(e){return Ps(e)||(e=vr(e)),gn(this.low&e.low,this.high&e.high,this.unsigned)};qe.or=function(e){return Ps(e)||(e=vr(e)),gn(this.low|e.low,this.high|e.high,this.unsigned)};qe.xor=function(e){return Ps(e)||(e=vr(e)),gn(this.low^e.low,this.high^e.high,this.unsigned)};qe.shiftLeft=function(e){return Ps(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):gn(0,this.low<<e-32,this.unsigned)};qe.shl=qe.shiftLeft;qe.shiftRight=function(e){return Ps(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):gn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};qe.shr=qe.shiftRight;qe.shiftRightUnsigned=function(e){if(Ps(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var s=this.low;return gn(s>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?gn(t,0,this.unsigned):gn(t>>>e-32,0,this.unsigned)};qe.shru=qe.shiftRightUnsigned;qe.shr_u=qe.shiftRightUnsigned;qe.toSigned=function(){return this.unsigned?gn(this.low,this.high,!1):this};qe.toUnsigned=function(){return this.unsigned?this:gn(this.low,this.high,!0)};qe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};qe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};qe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};mn.fromBytes=function(e,t,s){return s?mn.fromBytesLE(e,t):mn.fromBytesBE(e,t)};mn.fromBytesLE=function(e,t){return new mn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};mn.fromBytesBE=function(e,t){return new mn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Wb=KI(Mb),Wk=YI({__proto__:null,default:Wb},[Mb]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qo=Wb||Wk;function Jd(n){return qo.fromString(n,!0,16)}const Bb=Jd("c3a5c85c97cb3127"),Go=Jd("b492b66fbe98f273"),as=Jd("9ae16a3b2f90404f");function Ip(n){return n.xor(n.shru(47))}function Vb(n,e,t){const s=n.slice(e,e+t);return qo.fromBytes(Array.from(s),!0,!0)}function dn(n,e){return Vb(n,e,8)}function K0(n,e){return Vb(n,e,4)}function Vn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function bo(n,e,t=Jd("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function Bk(n,e,t,s,r,o){r=r.add(n),o=Vn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(Vn(r,44)),[r.add(s),o.add(i)]}function Fl(n,e,t,s){return Bk(dn(n,e),dn(n,e+8),dn(n,e+16),dn(n,e+24),t,s)}function Vk(n,e=n.length){if(e>=8){const t=as.add(e*2),s=dn(n,0).add(as),r=dn(n,e-8),o=Vn(r,37).mul(t).add(s),i=Vn(s,25).add(r).mul(t);return bo(o,i,t)}if(e>=4){const t=as.add(e*2),s=K0(n,0);return bo(s.shl(3).add(e),K0(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return Ip(as.mul(o).xor(Bb.mul(i))).mul(as)}return as}function Uk(n,e=n.length){const t=as.add(e*2),s=dn(n,0).mul(Go),r=dn(n,8),o=dn(n,e-8).mul(t),i=dn(n,e-16).mul(as);return bo(Vn(s.add(r),43).add(Vn(o,30)).add(i),s.add(Vn(r.add(as),18)).add(o),t)}function Gk(n,e=n.length){const t=as.add(e*2),s=dn(n,0).mul(as),r=dn(n,8),o=dn(n,e-8).mul(t),i=dn(n,e-16).mul(as),a=Vn(s.add(r),43).add(Vn(o,30)).add(i),c=bo(a,s.add(Vn(r.add(as),18)).add(o),t),l=dn(n,16).mul(t),d=dn(n,24),h=a.add(dn(n,e-32)).mul(t),p=c.add(dn(n,e-24)).mul(t);return bo(Vn(l.add(d),43).add(Vn(h,30)).add(p),l.add(Vn(d.add(s),18)).add(h),t)}function Hk(n,e=n.length){const t=qo.fromNumber(81,!0);if(e<=32)return e<=16?Vk(n,e):Uk(n,e);if(e<=64)return Gk(n,e);let s=t,r=t.mul(Go).add(113),o=Ip(r.mul(as).add(113)).mul(as),i=[qo.UZERO,qo.UZERO],a=[qo.UZERO,qo.UZERO];s=s.mul(as).add(dn(n,0));let c=0;const l=(e-1>>6)*64,d=l+(e-1&63)-63;do s=Vn(s.add(r).add(i[0]).add(dn(n,c+8)),37).mul(Go),r=Vn(r.add(i[1]).add(dn(n,c+48)),42).mul(Go),s=s.xor(a[1]),r=r.add(i[0]).add(dn(n,c+40)),o=Vn(o.add(a[0]),33).mul(Go),i=Fl(n,c,i[1].mul(Go),s.add(a[0])),a=Fl(n,c+32,o.add(a[1]),r.add(dn(n,c+16))),[o,s]=[s,o],c+=64;while(c!==l);const h=Go.add(o.and(255).shl(1));return c=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Vn(s.add(r).add(i[0]).add(dn(n,c+8)),37).mul(h),r=Vn(r.add(i[1]).add(dn(n,c+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(dn(n,c+40))),o=Vn(o.add(a[0]),33).mul(h),i=Fl(n,c,i[1].mul(h),s.add(a[0])),a=Fl(n,c+32,o.add(a[1]),r.add(dn(n,c+16))),[o,s]=[s,o],bo(bo(i[0],a[0],h).add(Ip(r).mul(Bb)).add(o),bo(i[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Do(n,e){return e==="string"?wo(n):Ci([n],e)}function qk(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function Ci(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=ai(n)),fe().getBool("DEBUG")&&Ck(n,e),qk(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function ps(){return fe().platform.now()}function wo(n,e="utf-8"){return e=e||"utf-8",fe().platform.encode(n,e)}function Io(n,e="utf-8"){return e=e||"utf-8",fe().platform.decode(n,e)}function Zs(n){return fe().platform.isTypedArray!=null?fe().platform.isTypedArray(n):jb(n)}function ai(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||ff(n)||n==null||Zs(n)&&t)e.push(n);else if(Array.isArray(n)||Zs(n))for(let s=0;s<n.length;++s)ai(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)ai(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kk{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Qk)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const a=ps();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const l of r)l.dataSync();i=Promise.resolve({kernelMs:ps()-a})}if(fe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){const d=r[l];d.data().then(h=>{Xk(h,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(c=>{this.logger.logKernelProfile(t,a,c[0],c[1],o,c[2])})})}}function Xk(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class Qk{logKernelProfile(e,t,s,r,o,i){const a=typeof r=="number"?Xi(`${r}ms`,9):r.error,c=Xi(e,25),l=t.rank,d=t.size,h=Xi(t.shape.toString(),14);let p="";for(const f in o){const m=o[f];if(m!=null){const g=m.shape||t.shape,x=g.length;p+=`${f}: ${x}D ${x>0?g:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${h}	%c${d}	%c${p}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yk(n,e,t){const s={},r={};for(let c=0;c<e.length;c++)s[e[c].id]=!0;for(let c=0;c<n.length;c++){const l=n[c],d=l.inputs;for(const h in d){const p=d[h];let f=!1;for(let m=0;m<e.length;m++)if(s[p.id]){l.outputs.forEach(g=>s[g.id]=!0),f=!0,r[l.id]=!0;break}if(f)break}}const o={};o[t.id]=!0;const i={};for(let c=n.length-1;c>=0;c--){const l=n[c],d=l.inputs;for(let h=0;h<l.outputs.length;h++)if(o[l.outputs[h].id]){for(const p in d)o[d[p].id]=!0,i[l.id]=!0;break}}const a=[];for(let c=0;c<n.length;c++){const l=n[c];if(r[l.id]&&i[l.id]){const d={};for(const p in l.inputs){const f=l.inputs[p];s[f.id]&&(d[p]=f)}const h=Object.assign({},l);h.inputs=d,h.outputs=l.outputs,a.push(h)}}return a}function Jk(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(c=>{const l=n[c.id];l!=null?i.push(l):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const c in o.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);const l=t(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);const d=o.inputs[c];if(!en(l.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=l;else{const h=n[d.id];n[d.id]=s(h,l),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X0=20,Ma=3,Gh=7;function Zk(n,e,t,s){const r=xt(e),o=e$(n,e,t,r),i=e.length,a=ru(n,e,t,r,o),c=["Tensor"];return s&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${i}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function e$(n,e,t,s){const r=we(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,c=t==="complex64"?Va(n):n;if(a>1)for(let l=0;l<r/o;l++){const d=l*o;for(let h=0;h<o;h++)i[h]=Math.max(i[h],Ba(c[d+h],0,t).length)}return i}function Ba(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Gh))} + ${parseFloat(n[1].toFixed(Gh))}j`:gc(n)?s=`'${n}'`:t==="bool"?s=Ub(n):s=parseFloat(n.toFixed(Gh)).toString(),Xi(s,e)}function Ub(n){return n===0?"false":"true"}function ru(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,a=e[0],c=e.length;if(c===0){if(t==="complex64"){const g=Va(n);return[Ba(g[0],0,t)]}return t==="bool"?[Ub(n[0])]:[n[0].toString()]}if(c===1){if(a>X0){const x=Ma*i;let y=Array.from(n.slice(0,x)),b=Array.from(n.slice((a-Ma)*i,a*i));return t==="complex64"&&(y=Va(y),b=Va(b)),["["+y.map((v,w)=>Ba(v,r[w],t)).join(", ")+", ..., "+b.map((v,w)=>Ba(v,r[a-Ma+w],t)).join(", ")+"]"]}return["["+(t==="complex64"?Va(n):Array.from(n)).map((x,y)=>Ba(x,r[y],t)).join(", ")+"]"]}const l=e.slice(1),d=s.slice(1),h=s[0]*i,p=[];if(a>X0){for(let g=0;g<Ma;g++){const x=g*h,y=x+h;p.push(...ru(n.slice(x,y),l,t,d,r,!1))}p.push("...");for(let g=a-Ma;g<a;g++){const x=g*h,y=x+h;p.push(...ru(n.slice(x,y),l,t,d,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*h,y=x+h;p.push(...ru(n.slice(x,y),l,t,d,r,g===a-1))}const f=c===2?",":"";p[0]="["+(a>0?p[0]+f:"");for(let g=1;g<p.length-1;g++)p[g]=" "+p[g]+f;let m=`,
`;for(let g=2;g<c;g++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":m),p}function Va(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=we(e),s!=null){const r=s.length;E(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||In(t,this.size),this.strides=xt(e)}set(e,...t){t.length===0&&(t=[0]),E(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return dr().makeTensor(this.values,this.shape,this.dtype)}}let dr=null,Ui=null;function t$(n){dr=n}function n$(n){Ui=n}class jn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=we(e),this.strides=xt(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Ui.buffer(this.shape,this.dtype,e)}bufferSync(){return Ui.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return mr(this.shape,e,this.dtype==="complex64")}arraySync(){return mr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=dr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Io(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),dr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=dr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Io(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await dr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),dr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Ui.print(this,e)}clone(){return this.throwIfDisposed(),Ui.clone(this)}toString(e=!1){const t=this.dataSync();return Zk(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Ui.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),dr().makeVariable(this,e,t,s)}}Object.defineProperty(jn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function be(){return mf("Tensor",()=>jn)}be();class du extends jn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!en(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);dr().disposeTensor(this),this.dataId=e.dataId,dr().incRef(this,null)}dispose(){dr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(du,Symbol.hasInstance,{value:n=>n instanceof jn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Q0;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Q0||(Q0={}));var kp;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(kp||(kp={}));var $p;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})($p||($p={}));var Tp;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Tp||(Tp={}));var Ap;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Ap||(Ap={}));const s$={float32:Tp,int32:kp,bool:$p,complex64:Ap};function Rs(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return s$[n][e]}function rm(n){return Rs(n,"int32")}function Gb(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function Hb(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(n,e){if(n.dtype===e.dtype)return[n,e];const t=Rs(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function qb(n){const e=[];return Kb(n,e,new Set),e}function Kb(n,e,t){if(n==null)return;if(n instanceof jn){e.push(n);return}if(!r$(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),Kb(o,e,t))}}function r$(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hh(n){return n.kernelName!=null}class Y0{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ia{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Y0}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Ms(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Kk(this.backendInstance),!0}setupRegisteredKernels(){B0(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){B0(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof uf)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Ms(`Initialization of backend ${e} failed`),Ms(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Ms(`Initialization of backend ${e} failed`),Ms(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return ia.nextTensorId++}nextVariableId(){return ia.nextVariableId++}clone(e){const t=Q.runKernel(Fc,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",c={x:i},l={dtype:a};return Q.runKernel(Nc,c,l)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(z0(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(c=>{o+=c.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let c;const l=Hh(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Hh(e)){const{kernelName:m,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const y=z0(m,this.backendName);E(y!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();c=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});const v=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,b,v);const w=v.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(m,g,w);s=this.saveTensorsForBackwardMode(S)}return w}}else{const{forwardFunc:m}=e,g=x=>{r&&(s=x.map(y=>this.keep(this.clone(y))))};a=()=>{const x=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,g));const y=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,x,y),y}}const{inputs:d,attrs:h}=e,p=Hh(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(f=this.profiler.profileKernel(l,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),t=f.outputs)}),r&&this.addTapeNode(l,d,t,p,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(m=>d[m]!=null?d[m].shape:null),outputShapes:t.map(m=>m.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(c)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=W0(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(E(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(l=>t[l])):a=o.map(l=>t[l]);const c=s.filter((l,d)=>i[d]);return a.concat(c)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&gc(e[0])&&(o=e.map(c=>wo(c)));const i=r.write(o,t,s),a=new jn(t,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const c=this.state.tensorInfo.get(i),l=Ik(o);this.state.numBytes+=l-c.bytes,c.bytes=l}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new jn(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new du(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*iu(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof du||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*iu(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},c=W0(e);c!=null&&(r=c.gradFunc),r!=null&&(a.gradient=l=>(l=l.map((d,h)=>{if(d==null){const p=s[h],f=Zn(p.size,p.dtype);return this.makeTensor(f,p.shape,p.dtype)}return d}),r(l.length>1?l:l[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=qb(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(E(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));E(o instanceof jn,()=>"The result y returned by f() must be a tensor.");const i=Yk(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??o$(o.shape),Jk(a,i,l=>this.tidy(l),i$);const c=t.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const d of l.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:c}})}customGrad(e){return E(bp(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{E(t.every(a=>a instanceof jn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,c)=>{r[c]=a});const o=(a,c)=>(s=e(...t,c),E(s.value instanceof jn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),E(bp(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,c)=>{const l=s.gradFunc(a,c),d=Array.isArray(l)?l:[l];E(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),E(d.every(p=>p instanceof jn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return d.forEach((p,f)=>{h[f]=()=>p}),h};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=ps(),s=await this.backend.time(e);return s.wallMs=ps()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Y0;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ia.nextTensorId=0;ia.nextVariableId=0;function o$(n){const e=pf(we(n),"float32");return Q.makeTensor(e,n,"float32")}function Xb(){const n=db();if(n._tfengine==null){const e=new Tk(n);n._tfengine=new ia(e)}return Dk(n._tfengine.ENV),t$(()=>n._tfengine),n._tfengine}const Q=Xb();function i$(n,e){const t={a:n,b:e};return Q.runKernel(va,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$(){return typeof navigator<"u"&&navigator!=null}function Qb(n){if(n||a$()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Yb(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ys=fe();ys.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ys.registerFlag("IS_BROWSER",()=>Yb());ys.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ys.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ys.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ys.registerFlag("PROD",()=>!1);ys.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ys.getBool("DEBUG"));ys.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ys.registerFlag("IS_TEST",()=>!1);ys.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ys.getBool("DEBUG"));ys.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ys.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ys.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zd(n,e){let t=n;if(Zs(n))return e==="string"?[]:[n.length];if(Gb(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(Hb(n))return[n.buffer.size/(e==null?4:iu(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Zs(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&fe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Jb(n,s,[]),s}function Jb(n,e,t){if(t=t||[],!Array.isArray(n)&&!Zs(n)){E(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}E(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),E(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)Jb(n[r],s,t.concat(r))}function J0(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function W(n,e,t,s="numeric"){if(n instanceof be())return J0(s,n.dtype,e,t),n;let r=ba(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),J0(s,r,e,t),n==null||!Zs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const c=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}const o=Zd(n,r);!Zs(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?Ci(n,r):ai(n,[],!0);return Q.makeTensor(a,o,r)}function Zb(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>W(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c$="__op";function ne(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+c$;const r=(...o)=>{Q.startScope(t);try{const i=s(...o);return ff(i)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(i),i}catch(i){throw Q.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l$(n,e){const t=W(n,"real","complex"),s=W(e,"imag","complex");hf(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return Q.runKernel(Cf,r)}const ci=ne({complex_:l$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eh(n,e,t,s){if(s==null)s=ba(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Hb(n)||Gb(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return Q.backend.createTensorFromGPUData(n,e||t,s)}if(!Zs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){oo(e);const r=we(e),o=we(t);E(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],c=i===t.length-1?a!==we(e.slice(i)):!0;E(t[i]===e[i]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Zs(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?Ci(n,s):ai(n,[],!0),Q.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(n,e,t){const s=Zd(n,t);return eh(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class _o{static join(e){return new _o(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Zs(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let c=s;c<this.shards.length;c++){const l=this.shards[c],h=e+a-l.start,p=a,m=Math.min(t,l.end)-l.start,g=new Uint8Array(l.buffer,h,m-h);if(i.set(g,p),a+=g.length,t<l.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=u$(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function u$(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kr(){return Q}function Ep(){return Q.memory()}function ce(n,e){return Q.tidy(n,e)}function Lt(n){qb(n).forEach(t=>t.dispose())}function Mr(n){return Q.keep(n)}function ew(n,e,t=1){return Q.registerBackend(n,e,t)}function d$(){return Q.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa=4;async function Z0(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],c=Array.isArray(n)?n[i].tensor:n[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);const l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const d=new Promise(async h=>{const p=await c.bytes(),f=p.reduce((x,y)=>x+y.length,0)+aa*p.length,m=new Uint8Array(f);let g=0;for(let x=0;x<p.length;x++){const y=p[x],b=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(b,g),g+=aa,m.set(y,g),g+=y.length}h(m)});s.push(d)}else s.push(c.data());e!=null&&(l.group=e),t.push(l)}const o=await Promise.all(s);return{data:m$(o),specs:t}}function h$(n,e){const t=new _o(n),s={};let r=0;for(const o of e){const i=p$(o,(a,c)=>t.slice(r+a,r+c));s[o.name]=f$(o,t.slice(r,r+i)),r+=i}return s}function p$(n,e){const t=we(n.shape);let s;if("quantization"in n){const r=n.quantization;s=hu[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=aa+new Uint32Array(e(r,r+aa))[0];return r}else s=hu[n.dtype];return t*s}function f$(n,e){const t=n.name,s=n.dtype,r=n.shape,o=we(r);let i,a=0;if("quantization"in n){const c=n.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${n.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const l=hu[c.dtype],d=c.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){i=new Float32Array(d.length);for(let h=0;h<d.length;h++){const p=d[h];i[h]=p*c.scale+c.min}}else if(c.dtype==="float16")i=I$()(d);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(s==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let h=0;h<d.length;h++){const p=d[h];i[h]=Math.round(p*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*l}else if(s==="string"){const c=we(n.shape);i=[];for(let l=0;l<c;l++){const d=new Uint32Array(e.slice(a,a+aa))[0];a+=aa;const h=new Uint8Array(e.slice(a,a+d));i.push(h),a+=d}}else{const c=hu[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const l=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let m=0;m<l.length;m++)l[m]=i[m*2],d[m]=i[m*2+1];const h=Yi(l,r,"float32"),p=Yi(d,r,"float32"),f=ci(h,p);return h.dispose(),p.dispose(),f}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*c}return Yi(i,r,s)}function m$(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const om=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ex(n){return om?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function g$(n){if(om)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function x$(n){if(om){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function y$(n){return _o.join(n)}function b$(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function w$(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function v$(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),w$(n,t,s)}function im(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:ex(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:ex(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new _o(n.weightData).byteLength}}function tx(n){const e=[];for(const t of n)e.push(...t.weights);return e}function S$(){const n=t=>{let s=t<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function C$(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function N$(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function I$(){const n=S$(),e=C$(),t=N$();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],c=n[t[a>>10]+(a&1023)]+e[a>>10];o[i]=c}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Bn.instance==null&&(Bn.instance=new Bn),Bn.instance}static registerSaveRouter(e){Bn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Bn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Bn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Bn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Bn.getInstance().loadRouters:Bn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const k$=n=>Bn.getSaveHandlers(n),$$=(n,e)=>Bn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rp="tensorflowjs",Dp=1,Jo="models_store",go="model_info_store";function tw(){if(!fe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function _p(n){const e=n.result;e.createObjectStore(Jo,{keyPath:"modelPath"}),e.createObjectStore(go,{keyPath:"modelPath"})}class li{constructor(e){if(this.indexedDB=tw(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(Rp,Dp);o.onupgradeneeded=()=>_p(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(Jo,"readonly"),l=a.objectStore(Jo).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(l.result.modelArtifacts)},l.onerror=d=>(i.close(),r(l.error)),a.oncomplete=()=>i.close()}else{t.weightData=_o.join(t.weightData);const a=im(t),c=i.transaction(go,"readwrite");let l=c.objectStore(go),d;try{d=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let h;d.onsuccess=()=>{h=i.transaction(Jo,"readwrite");const p=h.objectStore(Jo);let f;try{f=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(m){return r(m)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=m=>{l=c.objectStore(go);const g=l.delete(this.modelPath);g.onsuccess=()=>(i.close(),r(f.error)),g.onerror=x=>(i.close(),r(f.error))}},d.onerror=p=>(i.close(),r(d.error)),c.oncomplete=()=>{h==null?i.close():h.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}li.URL_SCHEME="indexeddb://";const nw=n=>fe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(li.URL_SCHEME)?T$(n.slice(li.URL_SCHEME.length)):null;Bn.registerSaveRouter(nw);Bn.registerLoadRouter(nw);function T$(n){return new li(n)}function A$(n){return n.startsWith(li.URL_SCHEME)?n.slice(li.URL_SCHEME.length):n}class E${constructor(){this.indexedDB=tw()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(Rp,Dp);s.onupgradeneeded=()=>_p(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(go,"readonly"),a=o.objectStore(go).getAll();a.onsuccess=()=>{const c={};for(const l of a.result)c[l.modelPath]=l.modelArtifactsInfo;e(c)},a.onerror=c=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=A$(e),new Promise((t,s)=>{const r=this.indexedDB.open(Rp,Dp);r.onupgradeneeded=()=>_p(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(go,"readwrite"),a=i.objectStore(go),c=a.get(e);let l;c.onsuccess=()=>{if(c.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),h=()=>{l=o.transaction(Jo,"readwrite");const f=l.objectStore(Jo).delete(e);f.onsuccess=()=>t(c.result.modelArtifactsInfo),f.onerror=m=>s(c.error)};d.onsuccess=h,d.onerror=p=>(h(),o.close(),s(c.error))}},c.onerror=d=>(o.close(),s(c.error)),i.oncomplete=()=>{l==null?o.close():l.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qr="/",Gi="tensorflowjs_models",sw="info",R$="model_topology",D$="weight_specs",_$="weight_data",P$="model_metadata";function rw(n){return{info:[Gi,n,sw].join(Qr),topology:[Gi,n,R$].join(Qr),weightSpecs:[Gi,n,D$].join(Qr),weightData:[Gi,n,_$].join(Qr),modelMetadata:[Gi,n,P$].join(Qr)}}function ow(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function j$(n){const e=n.split(Qr);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Qr)}function M$(n){return n.startsWith(ui.URL_SCHEME)?n.slice(ui.URL_SCHEME.length):n}class ui{constructor(e){if(!fe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=rw(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=im(e),o=_o.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,g$(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw ow(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=x$(i),t}}ui.URL_SCHEME="localstorage://";const iw=n=>fe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ui.URL_SCHEME)?F$(n.slice(ui.URL_SCHEME.length)):null;Bn.registerSaveRouter(iw);Bn.registerLoadRouter(iw);function F$(n){return new ui(n)}class O${constructor(){E(fe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),E(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Gi+Qr,s=Qr+sw;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=j$(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=M$(e);const t=rw(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return ow(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nx="://";class Tr{constructor(){this.managers={}}static getInstance(){return Tr.instance==null&&(Tr.instance=new Tr),Tr.instance}static registerManager(e,t){E(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(nx)&&(e=e.slice(0,e.indexOf(nx))),E(e.length>0,()=>"scheme must not be an empty string.");const s=Tr.getInstance();E(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Tr.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Tr.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L${constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!fe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return jb(e)}}if(fe().get("IS_BROWSER")){fe().setPlatform("browser",new L$);try{Tr.registerManager(ui.URL_SCHEME,new O$)}catch{}try{Tr.registerManager(li.URL_SCHEME,new E$)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z$={importFetch:()=>require("node-fetch")};let qh;class W${constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return fe().global.fetch!=null?fe().global.fetch(e,t):(qh==null&&(qh=z$.importFetch()),qh(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}fe().get("IS_NODE")&&!fe().get("IS_BROWSER")&&fe().setPlatform("node",new W$);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wt(n,e="float32",t){return e=e||"float32",oo(n),new Kn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$(n,e){const t=W(n,"x","cast");if(!Nk(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return Q.runKernel(Nc,s,r)}const Je=ne({cast_:B$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V$(n){const t={x:W(n,"x","clone","string_or_numeric")};return Q.runKernel(Fc,t)}const ti=ne({clone_:V$});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Xb();const G$={buffer:Wt,cast:Je,clone:ti,print:U$};n$(G$);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H$(n,e){let t=W(n,"a","add"),s=W(e,"b","add");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(va,r)}const Pe=ne({add_:H$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(n,e){let t=W(n,"a","floorDiv"),s=W(e,"b","floorDiv");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(jc,r)}const aw=ne({floorDiv_:q$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(n,e){let t=W(n,"a","div"),s=W(e,"b","div");if([t,s]=$n(t,s),t.dtype==="int32"&&s.dtype==="int32")return aw(t,s);const r={a:t,b:s},o={};return Q.runKernel(Ac,r,o)}const Nt=ne({div_:K$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$(n,e){let t=W(n,"a","mul"),s=W(e,"b","mul");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(Hc,r)}const q=ne({mul_:X$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$(n){const e=W(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Q.runKernel(od,t)}else{const t={x:e};return Q.runKernel(Ju,t)}}const os=ne({abs_:Q$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$(n){const t={x:W(n,"x","acos")};return Q.runKernel(xc,t)}const J$=ne({acos_:Y$});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$(n){const t={x:W(n,"x","acosh")};return Q.runKernel(yc,t)}const e2=ne({acosh_:Z$});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t2(n,e=null,t=!1){const r={x:W(n,"x","all","bool")},o={axis:e,keepDims:t};return Q.runKernel(xf,r,o)}const cw=ne({all_:t2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2(n,e=null,t=!1){const r={x:W(n,"x","any","bool")},o={axis:e,keepDims:t};return Q.runKernel(yf,r,o)}const Pp=ne({any_:n2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2(n,e=0){const s={x:W(n,"x","argMax")},r={axis:e};return Q.runKernel(Zu,s,r)}const tc=ne({argMax_:s2});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2(n,e=0){const s={x:W(n,"x","argMin")},r={axis:e};return Q.runKernel(ed,s,r)}const o2=ne({argMin_:r2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i2(n){const t={x:W(n,"x","asin")};return Q.runKernel(bc,t)}const a2=ne({asin_:i2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c2(n){const t={x:W(n,"x","asinh")};return Q.runKernel(wc,t)}const l2=ne({asinh_:c2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u2(n){const t={x:W(n,"x","atan")};return Q.runKernel(vc,t)}const d2=ne({atan_:u2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2(n,e){let t=W(n,"a","atan2"),s=W(e,"b","atan2");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(Cc,r)}const p2=ne({atan2_:h2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2(n){const t={x:W(n,"x","atanh")};return Q.runKernel(Sc,t)}const m2=ne({atanh_:f2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hl(n,e,t,s,r="NHWC",o){const i=n[3],a=[...e,i],c=ao(r);return Xn(n,a,t,o,s,null,null,c)}function tr(n,e,t,s,r,o,i="channelsLast"){const[a,c]=nc(e);let l;if(i==="channelsLast")l=[a,c,n[3],n[3]];else if(i==="channelsFirst")l=[a,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Xn(n,l,t,s,r,o,!1,i)}function io(n,e,t,s,r,o,i="NDHWC"){const[a,c,l]=jp(e);let d,h;if(i==="NDHWC")h="channelsLast",d=[a,c,l,n[4],n[4]];else if(i==="NCDHW")h="channelsFirst",d=[a,c,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Po(n,d,t,s,r,!1,h,o)}function Xn(n,e,t,s,r,o,i=!1,a="channelsLast"){let[c,l,d,h]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,d,h]=n;else if(a==="channelsFirst")[c,h,l,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,f,,m]=e,[g,x]=nc(t),[y,b]=nc(s),v=Ji(p,y),w=Ji(f,b),{padInfo:S,outHeight:N,outWidth:C}=y2(r,l,d,g,x,v,w,o,a),k=i?m*h:m;let I;return a==="channelsFirst"?I=[c,k,N,C]:a==="channelsLast"&&(I=[c,N,C,k]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:d,inChannels:h,outHeight:N,outWidth:C,outChannels:k,padInfo:S,strideHeight:g,strideWidth:x,filterHeight:p,filterWidth:f,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:n,outShape:I,filterShape:e}}function Po(n,e,t,s,r,o=!1,i="channelsLast",a){let[c,l,d,h,p]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[c,l,d,h,p]=n;else if(i==="channelsFirst")[c,p,l,d,h]=n;else throw new Error(`Unknown dataFormat ${i}`);const[f,m,g,,x]=e,[y,b,v]=jp(t),[w,S,N]=jp(s),C=Ji(f,w),k=Ji(m,S),I=Ji(g,N),{padInfo:$,outDepth:j,outHeight:P,outWidth:O}=b2(r,l,d,h,y,b,v,C,k,I,a),A=o?x*p:x;let z;return i==="channelsFirst"?z=[c,A,j,P,O]:i==="channelsLast"&&(z=[c,j,P,O,A]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:d,inWidth:h,inChannels:p,outDepth:j,outHeight:P,outWidth:O,outChannels:A,padInfo:$,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:f,filterHeight:m,filterWidth:g,effectiveFilterDepth:C,effectiveFilterHeight:k,effectiveFilterWidth:I,dilationDepth:w,dilationHeight:S,dilationWidth:N,inShape:n,outShape:z,filterShape:e}}function g2(n,e,t,s,r){s==null&&(s=am(n,e,t));const o=n[0],i=n[1],a=sc((o-e+2*s)/t+1,r),c=sc((i-e+2*s)/t+1,r);return[a,c]}function x2(n,e,t,s,r,o){r==null&&(r=am(n,e[0],s[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(i[a]=sc((n[a]-e[a]+2*r)/s[a]+1,o));return i}function am(n,e,t,s=1){const r=Ji(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function nc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function jp(n){return typeof n=="number"?[n,n,n]:n}function Ji(n,e){return e<=1?n:n+(n-1)*(e-1)}function y2(n,e,t,s,r,o,i,a,c){let l,d,h;if(typeof n=="number"){l={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const f=g2([e,t],o,s,n,a);d=f[0],h=f[1]}else if(n==="same"){d=Math.ceil(e/s),h=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+o-e),f=Math.max(0,(h-1)*r+i-t),m=Math.floor(p/2),g=p-m,x=Math.floor(f/2),y=f-x;l={top:m,bottom:g,left:x,right:y,type:"SAME"}}else if(n==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),h=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const p=c==="channelsLast"?n[1][0]:n[2][0],f=c==="channelsLast"?n[1][1]:n[2][1],m=c==="channelsLast"?n[2][0]:n[3][0],g=c==="channelsLast"?n[2][1]:n[3][1];l={top:p,bottom:f,left:m,right:g,type:p===0&&f===0&&m===0&&g===0?"VALID":"EXPLICIT"},d=sc((e-o+p+f)/s+1,a),h=sc((t-i+m+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:l,outHeight:d,outWidth:h}}function b2(n,e,t,s,r,o,i,a,c,l,d){let h,p,f,m;if(n==="valid"&&(n=0),typeof n=="number"){h={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=x2([e,t,s,1],[a,c,l],1,[r,o,i],n,d);p=x[0],f=x[1],m=x[2]}else if(n==="same"){p=Math.ceil(e/r),f=Math.ceil(t/o),m=Math.ceil(s/i);const g=(p-1)*r+a-e,x=(f-1)*o+c-t,y=(m-1)*i+l-s,b=Math.floor(g/2),v=g-b,w=Math.floor(x/2),S=x-w,N=Math.floor(y/2),C=y-N;h={top:w,bottom:S,left:N,right:C,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:h,outDepth:p,outHeight:f,outWidth:m}}function sc(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function di(n){const[e,t,s]=nc(n);return e===1&&t===1&&s===1}function ts(n,e){return di(n)||di(e)}function hi(n){return nc(n).every(e=>e>0)}function ao(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function ws(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")E(ra(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{E(ra(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2(n,e){const s={x:W(n,"x","reshape","string_or_numeric")},r={shape:e};return Q.runKernel(Ld,s,r)}const ee=ne({reshape_:w2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2(n,e,t,s,r){const o=W(n,"x","avgPool","float32"),i=1;E(ts(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,c=!1;o.rank===3&&(c=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]])),E(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),ws("avgPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let h=Q.runKernel(td,l,d);return h=Je(h,o.dtype),c?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const cm=ne({avgPool_:v2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(n,e,t,s,r,o="NDHWC"){const i=W(n,"x","avgPool3d","float32");let a=i,c=!1;i.rank===4&&(c=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),E(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),E(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),E(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),ws("avgPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let h=Q.runKernel(nd,l,d);return h=Je(h,a.dtype),c?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const C2=ne({avgPool3d_:S2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N2(n,e=0){E(n.length>=1,()=>"Pass at least one tensor to concat");const t=Zb(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return ti(t[0]);const s=t,r={axis:e};return Q.runKernel(id,s,r)}const xs=ne({concat_:N2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2(n,e,t=!1,s=!1){let r=W(n,"a","matMul"),o=W(e,"b","matMul");[r,o]=$n(r,o);const i={a:r,b:o},a={transposeA:t,transposeB:s};return Q.runKernel(sd,i,a)}const Jt=ne({matMul_:I2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k2(n){const t={x:W(n,"x","sigmoid","float32")};return Q.runKernel(sl,t)}const Sa=ne({sigmoid_:k2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2(n,e,t){const s=W(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return Q.runKernel(Ud,r,o)}const hn=ne({slice_:$2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T2(n){const t={x:W(n,"x","tanh","float32")};return Q.runKernel(ll,t)}const th=ne({tanh_:T2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A2(n,e,t){const s=W(n,"x","batchToSpaceND"),r=e.reduce((a,c)=>a*c);E(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),E(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),E(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return Q.runKernel(rd,o,i)}const lm=ne({batchToSpaceND_:A2});function E2(n){let e;return n.rank===0||n.rank===1?e=ee(n,[1,1,1,n.size]):n.rank===2?e=ee(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R2(n,e,t,s,r,o){o==null&&(o=.001);const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;s!=null&&(d=W(s,"offset","batchNorm")),E(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:E2(i),scale:l,offset:d,mean:a,variance:c},f={varianceEpsilon:o},m=Q.runKernel(md,p,f);return ee(m,i.shape)}const nh=ne({batchNorm_:R2});function D2(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),E(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),E(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),E(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&E(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),d!=null&&E(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),nh(i,a,c,d,l,o)}const _2=ne({batchNorm2d_:D2});function P2(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),E(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),E(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),E(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&E(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),d!=null&&E(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),nh(i,a,c,d,l,o)}const j2=ne({batchNorm3d_:P2});function M2(n,e,t,s,r,o){const i=W(n,"x","batchNorm"),a=W(e,"mean","batchNorm"),c=W(t,"variance","batchNorm");let l;r!=null&&(l=W(r,"scale","batchNorm"));let d;return s!=null&&(d=W(s,"offset","batchNorm")),E(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),E(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),E(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&E(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),d!=null&&E(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),nh(i,a,c,d,l,o)}const F2=ne({batchNorm4d_:M2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2(n,e,t){const s=W(n,"x","bincount"),r=W(e,"weights","bincount");E(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),E(t>=0,()=>`size must be non-negative, but got ${t}.`),E(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return Q.runKernel(vf,o,i)}const L2=ne({bincount_:O2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2(n,e){let t=W(n,"broadcastTo","x");const s=t.shape;if(oo(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=ee(t,l)}const r=t.shape,o=Array.from(e);for(let l=e.length-1;l>=0;l--)if(r[l]===e[l])o[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((l,d)=>l>1?d:-1).filter(l=>l>=0).length===0)return ti(t);const a={x:t},c={reps:o};return Q.runKernel(ul,a,c)}const Ja=ne({broadcastTo_:z2});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2(n){const t={x:W(n,"x","ceil","float32")};return Q.runKernel(Ic,t)}const B2=ne({ceil_:W2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sh(n,e,t){oo(n),t=t||ba(e);const s={shape:n,value:e,dtype:t};return Q.runKernel(Mf,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V2(n,e,t){const s=W(n,"x","clipByValue");if(E(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return sh(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return Q.runKernel(kc,r,o)}const Ls=ne({clipByValue_:V2});function U2(n){return xs(n,0)}const G2=ne({concat1d_:U2});function H2(n,e){return xs(n,e)}const q2=ne({concat2d_:H2});function K2(n,e){return xs(n,e)}const X2=ne({concat3d_:K2});function Q2(n,e){return xs(n,e)}const Y2=ne({concat4d_:Q2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2(n,e,t,s,r="NHWC",o=[1,1],i){const a=W(n,"x","conv2d","float32"),c=W(e,"filter","conv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),E(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),ws("conv2d",s,i);const h=r==="NHWC"?l.shape[3]:l.shape[1];E(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),E(ts(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),E(hi(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),E(hi(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:l,filter:c},f={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=Q.runKernel(ad,p,f);return d?ee(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const pi=ne({conv2d_:J2});function Z2(n,e,t,s,r="NWC",o=1,i){const a=W(n,"x","conv1d"),c=W(e,"filter","conv1d");let l=a,d=!1;a.rank===2&&(d=!0,l=ee(a,[1,a.shape[0],a.shape[1]])),E(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),E(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),ws("conv1d",s,i),E(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),E(ts(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),E(hi(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),E(hi(t),()=>"Error in conv1D: Stride should be larger than 0."),E(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=ee(c,[1,c.shape[0],c.shape[1],c.shape[2]]),p=ee(l,[l.shape[0],1,l.shape[1],l.shape[2]]),x=pi(p,h,[1,t],s,"NHWC",[1,o],i);return d?ee(x,[x.shape[2],x.shape[3]]):ee(x,[x.shape[0],x.shape[2],x.shape[3]])}const lw=ne({conv1d_:Z2});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eT(n,e,t,s,r,o="NHWC",i){E(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,c=e,l=!1;e.rank===3&&(l=!0,c=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),E(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),E(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),E(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?c.shape[3]:c.shape[1];E(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),E(h===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${t.shape[3]}.`),ws("conv2dDerInput",r,i);const p={dy:c,filter:t},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},m=Q.runKernel(cd,p,f);return l?ee(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const um=ne({conv2DBackpropInput_:eT});function tT(n,e,t,s,r,o){const i=W(n,"x","conv2dTranspose"),a=W(e,"filter","conv2dTranspose");return um(t,i,a,s,r,"NHWC",o)}const uw=ne({conv2dTranspose_:tT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nT(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=W(n,"x","conv3d"),a=W(e,"filter","conv3d");let c=i,l=!1;i.rank===4&&(l=!0,c=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),E(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),E(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),E(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),E(ts(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),E(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),E(hi(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),E(hi(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:c,filter:a},h={strides:t,pad:s,dataFormat:r,dilations:o},p=Q.runKernel(ld,d,h);return l?ee(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const sT=ne({conv3d_:nT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rT(n,e,t,s,r){E(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const c=o[4],l=i.shape[4];E(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),E(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),E(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),E(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),E(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},h={pad:r,strides:s,inputShape:o},p=Q.runKernel(kf,d,h);return a?ee(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const dw=ne({conv3DBackpropInput_:rT});function oT(n,e,t,s,r){const o=W(n,"x","conv3dTranspose"),i=W(e,"filter","conv3dTranspose");return dw(t,o,i,s,r)}const iT=ne({conv3dTranspose_:oT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aT(n){const t={x:W(n,"x","cos","float32")};return Q.runKernel($c,t)}const dm=ne({cos_:aT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cT(n){const t={x:W(n,"x","cosh","float32")};return Q.runKernel(Tc,t)}const hw=ne({cosh_:cT});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lT(n,e=0,t=!1,s=!1){const o={x:W(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return Q.runKernel($f,o,i)}const Mp=ne({cumprod_:lT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uT(n,e=0,t=!1,s=!1){const o={x:W(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return Q.runKernel(ud,o,i)}const pw=ne({cumsum_:uT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dT(n,e,t,s=!1){const r=W(n,"x","denseBincount"),o=W(e,"weights","denseBincount");E(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),E(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),E(t>=0,()=>`size must be non-negative, but got ${t}.`),E(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:t,binaryOutput:s};return Q.runKernel(Af,i,a)}const sx=ne({denseBincount_:dT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hT(n,e,t="NHWC"){const s=W(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];E(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),E(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),E(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),E(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},c={blockSize:e,dataFormat:t};return Q.runKernel(Ef,a,c)}const pT=ne({depthToSpace_:hT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(n,e,t,s,r="NHWC",o=[1,1],i){const a=W(n,"x","depthwiseConv2d","float32"),c=W(e,"filter","depthwiseConv2d","float32");let l=a,d=!1;a.rank===3&&(d=!0,l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),E(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=r==="NHWC"?l.shape[3]:l.shape[1];E(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),ws("depthwiseConv2d",s,i);const p={x:l,filter:c},f={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},m=Q.runKernel(dd,p,f);return d?ee(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const hm=ne({depthwiseConv2d_:fT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mT(n,e,t,s,r=[1,1],o="NHWC"){const i=W(n,"x","dilation2d"),a=W(e,"filter","dilation2d");E(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),E(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),E(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let c=i,l=!1;i.rank===3&&(c=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),E(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);const d={x:c,filter:a},h={strides:t,pad:s,dilations:r},p=Q.runKernel(hd,d,h);return l?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const gT=ne({dilation2d_:mT});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ca(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function zn(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function _t(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[t-r-1]=i;else if(i===1)s[t-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(n,e){let t=W(n,"a","equal","string_or_numeric"),s=W(e,"b","equal","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(pd,r)}const Br=ne({equal_:xT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(n,e,t){const s=W(e,"a","where"),r=W(t,"b","where"),o=W(n,"condition","where","bool"),i=_t(_t(o.shape,s.shape),r.shape),a=Ja(o,i),c=Ja(s,i),l=Ja(r,i),d={condition:a,t:c,e:l};return Q.runKernel(Vd,d)}const ls=ne({where_:yT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(n){const t={x:W(n,"x","zerosLike")};return Q.runKernel(Yd,t)}const qt=ne({zerosLike_:bT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wT(n,e){let t=W(n,"a","div"),s=W(e,"b","div");[t,s]=$n(t,s);const r=Nt(t,s),o=qt(r),i=Br(s,o);return ls(i,o,r)}const vT=ne({divNoNan_:wT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ST(n,e){const t=W(n,"t1","dot"),s=W(e,"t2","dot");E((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(E(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=ee(t,[1,-1]),a=ee(s,[-1,1]),c=Jt(i,a);return ee(c,[])}else if(t.rank===1&&s.rank===2){const i=ee(t,[1,-1]),a=ee(s,[s.shape[0],s.shape[1]]),c=Jt(i,a);return ee(c,[c.size])}else if(t.rank===2&&s.rank===1){const i=ee(s,[-1,1]),a=Jt(t,i);return ee(a,[a.size])}else{const i=ee(s,[s.shape[0],s.shape[1]]);return Jt(t,i)}}const CT=ne({dot_:ST});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(n,...e){const t=e.map((r,o)=>W(r,`tensors${o}`,"einsum")),s={equation:n};return Q.runKernel(_f,t,s)}const Fa=ne({einsum_:NT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IT(n){const t={x:W(n,"x","elu","float32")};return Q.runKernel(Ec,t)}const rh=ne({elu_:IT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kT(n){let e=W(n,"x","erf");E(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Je(e,"float32"));const t={x:e};return Q.runKernel(Rc,t)}const fw=ne({erf_:kT});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pm(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function mw(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[i++]);return r}function Hn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function _n(n,e){const t=e.map(s=>1);return mw(n,t,e)}function Qn(n,e,t){E(pm(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Cn(n,e){if(pm(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function jo(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Tn(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $T(n,e=null,t=!1){const r={x:W(n,"x","max")},o={reductionIndices:e,keepDims:t};return Q.runKernel(Id,r,o)}const gr=ne({max_:$T});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TT(n,e=null,t=!1){const r={x:W(n,"x","min")},o={axis:e,keepDims:t};return Q.runKernel(Ad,r,o)}const pu=ne({min_:TT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AT(n,e){let t=W(n,"base","pow"),s=W(e,"exp","pow");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(qc,r)}const fi=ne({pow_:AT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zt(n,e){if((Zs(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Zs(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eh(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ET(n){const t={x:W(n,"x","sqrt","float32")};return Q.runKernel(ol,t)}const es=ne({sqrt_:ET});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RT(n){const e=W(n,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}const fn=ne({square_:RT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DT(n,e=null,t=!1){let s=W(n,"x","sum");s.dtype==="bool"&&(s=Je(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Q.runKernel(Gd,r,o)}const wt=ne({sum_:DT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _T(n,e="euclidean",t=null,s=!1){n=W(n,"x","norm");const r=gw(n,e,t);let o=r.shape;if(s){const i=Bt(t,n.shape);o=_n(r.shape,i)}return ee(r,o)}function gw(n,e,t=null){if(n.rank===0)return os(n);if(n.rank!==1&&t===null)return gw(ee(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return wt(os(n),t);if(e===1/0)return gr(os(n),t);if(e===-1/0)return pu(os(n),t);if(e==="euclidean"||e===2)return es(wt(fi(os(n),Zt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return gr(wt(os(n),t[0]),t[1]-1);if(e===1/0)return gr(wt(os(n),t[1]),t[0]);if(e===-1/0)return pu(wt(os(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return es(wt(fn(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const oh=ne({norm_:_T});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PT(n,e=null,t=!1){return oh(n,"euclidean",e,t)}const jT=ne({euclideanNorm_:PT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MT(n){const t={x:W(n,"x","exp")};return Q.runKernel(Dc,t)}const Vr=ne({exp_:MT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FT(n,e=0){const t=W(n,"x","expandDims","string_or_numeric");E(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return Q.runKernel(fd,s,r)}const fs=ne({expandDims_:FT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OT(n){const t={x:W(n,"x","expm1")};return Q.runKernel(_c,t)}const LT=ne({expm1_:OT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zT(n,e){const t=W(n,"x","tile","string_or_numeric");E(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return Q.runKernel(ul,s,r)}const fr=ne({tile_:zT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WT(n,e,t,s="float32"){e==null&&(e=n);const r=Wt([n,e],s),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=ee(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return fr(fs(i,0),[t[0],1,1]);if(t.length===2)return fr(fs(fs(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return fr(fs(fs(fs(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const xw=ne({eye_:WT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BT(n){const t={x:W(n,"x","floor","float32")};return Q.runKernel(Pc,t)}const ih=ne({floor_:BT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VT(n,e,t=0,s=0){const r=W(n,"x","gather"),o=W(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:t,batchDims:s};return Q.runKernel(gd,i,a)}const fm=ne({gather_:VT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(n,e){let t=W(n,"a","greater","string_or_numeric"),s=W(e,"b","greater","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(xd,r)}const zs=ne({greater_:UT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GT(n,e){let t=W(n,"a","greaterEqual","string_or_numeric"),s=W(e,"b","greaterEqual","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Mc,r)}const Ni=ne({greaterEqual_:GT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HT(n){const t={input:W(n,"input","imag")};return Q.runKernel(Lf,t)}const mm=ne({imag_:HT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qT(n){const t={x:W(n,"x","isFinite")};return Q.runKernel(Oc,t)}const KT=ne({isFinite_:qT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XT(n){const t={x:W(n,"x","isInf")};return Q.runKernel(Lc,t)}const QT=ne({isInf_:XT});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(n){const t={x:W(n,"x","isNaN")};return Q.runKernel(zc,t)}const JT=ne({isNaN_:YT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(n,e=.2){const s={x:W(n,"x","leakyRelu")},r={alpha:e};return Q.runKernel(yd,s,r)}const gm=ne({leakyRelu_:ZT});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eA(n,e){let t=W(n,"a","less","string_or_numeric"),s=W(e,"b","less","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(bd,r)}const fu=ne({less_:eA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(n,e){let t=W(n,"a","lessEqual","string_or_numeric"),s=W(e,"b","lessEqual","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(wd,r)}const Ca=ne({lessEqual_:tA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nA(n,e=5,t=1,s=1,r=.5){const o=W(n,"x","localResponseNormalization");E(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),E(ra(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const c={x:i},l={depthRadius:e,bias:t,alpha:s,beta:r},d=Q.runKernel(Nd,c,l);return a?ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const sA=ne({localResponseNormalization_:nA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(n){const t={x:W(n,"x","log","float32")};return Q.runKernel(Wc,t)}const Ur=ne({log_:rA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oA(n){const t={x:W(n,"x","log1p")};return Q.runKernel(Bc,t)}const yw=ne({log1p_:oA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(n,e){E(bp(n),()=>"The f passed in variableGrads(f) must be a function"),E(e==null||Array.isArray(e)&&e.every(l=>l instanceof du),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const l in Q.registeredVariables)e.push(Q.registeredVariables[l])}const s=t?e.filter(l=>!l.trainable):null,r=e.length;e=e.filter(l=>l.trainable),E(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=Q.gradients(n,e,null,o);E(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),E(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const c={};return e.forEach((l,d)=>{a[d]!=null&&(c[l.name]=a[d])}),s!=null&&s.forEach(l=>c[l.name]=null),{value:i,grads:c}}function la(n){return Q.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aA(n){const t={x:W(n,"x","neg")};return Q.runKernel(Rd,t)}const kn=ne({neg_:aA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cA(n){const t={x:W(n,"x","softplus")};return Q.runKernel(rl,t)}const pl=ne({softplus_:cA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lA(n){const e=W(n,"x","logSigmoid");return la(s=>({value:kn(pl(kn(s))),gradFunc:i=>q(i,Sa(kn(s)))}))(e)}const uA=ne({logSigmoid_:lA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dA(n,e){let t=W(n,"a","sub"),s=W(e,"b","sub");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(al,r)}const kt=ne({sub_:dA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hA(n,e=-1){const t=W(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return la((r,o)=>{const a=gr(r,e,!0),c=kt(r,a),l=kt(Je(c,"float32"),Ur(wt(Vr(c),e,!0)));return o([l]),{value:l,gradFunc:(h,p)=>{const[f]=p,m=!0,g=Vr(f);return kt(h,q(wt(h,e,m),g))}}})(t)}const bw=ne({logSoftmax_:hA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n,e=null,t=!1){const s=W(n,"x","logSumExp"),r=Bt(e,s.shape),o=gr(s,r,!0),i=kt(s,o),a=Vr(i),c=wt(a,r),l=Ur(c),d=Pe(ee(o,l.shape),l);if(t){const h=_n(d.shape,r);return ee(d,h)}return d}const ww=ne({logSumExp_:pA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(n,e){const t=W(n,"a","logicalAnd","bool"),s=W(e,"b","logicalAnd","bool");_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(vd,r)}const eo=ne({logicalAnd_:fA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n){const t={x:W(n,"x","logicalNot","bool")};return Q.runKernel(Sd,t)}const xm=ne({logicalNot_:mA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gA(n,e){const t=W(n,"a","logicalOr","bool"),s=W(e,"b","logicalOr","bool");_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Cd,r)}const vw=ne({logicalOr_:gA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xA(n,e){const t=W(n,"a","logicalXor","bool"),s=W(e,"b","logicalXor","bool");return _t(t.shape,s.shape),eo(vw(n,e),xm(eo(n,e)))}const yA=ne({logicalXor_:xA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(n,e,t,s,r){const o=W(n,"x","maxPool"),i=1;let a=o,c=!1;o.rank===3&&(c=!0,a=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]])),E(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),E(ts(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ws("maxPool",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},h=Q.runKernel(kd,l,d);return c?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const ym=ne({maxPool_:bA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=W(n,"x","maxPool3d");let a=i,c=!1;i.rank===4&&(c=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),E(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),E(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),ws("maxPool3d",s,r);const l={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},h=Q.runKernel($d,l,d);return c?ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const vA=ne({maxPool3d_:wA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SA(n,e){let t=W(n,"a","maximum"),s=W(e,"b","maximum");[t,s]=$n(t,s),t.dtype==="bool"&&(t=Je(t,"int32"),s=Je(s,"int32")),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Vc,r)}const Mo=ne({maximum_:SA});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CA(n,e=null,t=!1){const r={x:W(n,"x","mean")},o={axis:e,keepDims:t};return Q.runKernel(Td,r,o)}const Dn=ne({mean_:CA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(n,e="float32"){if(oo(n),e==="complex64"){const s=Un(n,"float32"),r=Un(n,"float32");return ci(s,r)}const t=Zn(we(n),e);return Q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fo(n,e="float32"){if(oo(n),e==="complex64"){const s=Fo(n,"float32"),r=Un(n,"float32");return ci(s,r)}const t=pf(we(n),e);return Q.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n,e){let t=W(n,"a","minimum"),s=W(e,"b","minimum");[t,s]=$n(t,s),t.dtype==="bool"&&(t=Je(t,"int32"),s=Je(s,"int32")),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Uc,r)}const rc=ne({minimum_:NA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IA(n,e,t){E(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=W(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");E(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)E(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),E(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return Q.runKernel(Ed,i,o)}const kA=ne({mirrorPad_:IA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(n,e){let t=W(n,"a","mod"),s=W(e,"b","mod");[t,s]=$n(t,s);const r={a:t,b:s};return Q.runKernel(Gc,r)}const TA=ne({mod_:$A});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AA(n,e=null,t=!1){n=W(n,"x","moments");const s=Bt(e,n.shape),r=Dn(n,s,t);let o=r.shape;t||(o=_n(r.shape,s));const i=fn(kt(Je(n,"float32"),ee(r,o))),a=Dn(i,s,t);return{mean:r,variance:a}}const bm=ne({moments_:AA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n,e){let t=W(n,"a","notEqual","string_or_numeric"),s=W(e,"b","notEqual","string_or_numeric");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s};return Q.runKernel(Dd,r)}const mu=ne({notEqual_:EA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RA(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:W(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return Q.runKernel(Pd,i,a)}const Sw=ne({oneHot_:RA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n){const t={x:W(n,"x","onesLike")};return Q.runKernel(_d,t)}const er=ne({onesLike_:DA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n,e,t=0){const s=W(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return Q.runKernel(Md,o,r)}const wm=ne({pad_:_A});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PA(n,e,t){const s=W(n,"x","spaceToBatchND");E(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),E(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),E(s.shape.reduce((i,a,c)=>c>0&&c<=e.length?i&&(a+t[c-1][0]+t[c-1][1])%e[c-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return Q.runKernel(Hd,r,o)}const vm=ne({spaceToBatchND_:PA});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jA(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=W(n,"x","maxPool");let c=a,l=!1;a.rank===3&&(l=!0,c=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(ts(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=tr(c.shape,e,o,r,s),h=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=FA([d.filterHeight,d.filterWidth],h):p=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[m,g]=MA([d.inHeight,d.inWidth],h,p),x=f?s:"valid",y=f?c:vm(c,h,m),v=(t==="avg"?()=>cm(y,e,o,x,i):()=>ym(y,e,o,x,i))(),w=f?v:lm(v,h,g);return l?ee(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function MA(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,h)=>(d-o[h]%d)%d),a=r.map((d,h)=>d+i[h]),c=e.map((d,h)=>[s[h],a[h]]),l=e.map((d,h)=>[0,i[h]]);return[c,l]}function FA(n,e){const s=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const OA=ne({pool_:jA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n,e){const t=W(n,"x","prelu"),s=W(e,"alpha","prelu"),r={x:t,alpha:s};return Q.runKernel(Fd,r)}const Sm=ne({prelu_:LA});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n,e=null,t=!1){let s=W(n,"x","prod");s.dtype==="bool"&&(s=Je(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Q.runKernel(Od,r,o)}const WA=ne({prod_:zA});var Cm={exports:{}};Cm.exports;(function(n){(function(e,t,s){function r(c){var l=this,d=a();l.next=function(){var h=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=h|0)},l.c=1,l.s0=d(" "),l.s1=d(" "),l.s2=d(" "),l.s0-=d(c),l.s0<0&&(l.s0+=1),l.s1-=d(c),l.s1<0&&(l.s1+=1),l.s2-=d(c),l.s2<0&&(l.s2+=1),d=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function i(c,l){var d=new r(c),h=l&&l.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,h&&(typeof h=="object"&&o(h,d),p.state=function(){return o(d,{})}),p}function a(){var c=4022871197,l=function(d){d=String(d);for(var h=0;h<d.length;h++){c+=d.charCodeAt(h);var p=.02519603282416938*c;c=p>>>0,p-=c,p*=c,c=p>>>0,p-=c,c+=p*4294967296}return(c>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=i:this.alea=i})(vi,n)})(Cm);var BA=Cm.exports,Nm={exports:{}};Nm.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor128=i})(vi,n)})(Nm);var VA=Nm.exports,Im={exports:{}};Im.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var d=0;d<l.length+64;d++)c.x^=l.charCodeAt(d)|0,d==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorwow=i})(vi,n)})(Im);var UA=Im.exports,km={exports:{}};km.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.x,h=c.i,p,f;return p=d[h],p^=p>>>7,f=p^p<<24,p=d[h+1&7],f^=p^p>>>10,p=d[h+3&7],f^=p^p>>>3,p=d[h+4&7],f^=p^p<<7,p=d[h+7&7],p=p^p<<13,f^=p^p<<9,d[h]=f,c.i=h+1&7,f};function l(d,h){var p,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,p=0;p<h.length;++p)f[p&7]=f[p&7]<<15^h.charCodeAt(p)+f[p+1&7]<<13;for(;f.length<8;)f.push(0);for(p=0;p<8&&f[p]===0;++p);for(p==8?f[7]=-1:f[p],d.x=f,d.i=0,p=256;p>0;--p)d.next()}l(c,a)}function o(a,c){return c.x=a.x.slice(),c.i=a.i,c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.x&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xorshift7=i})(vi,n)})(km);var GA=km.exports,$m={exports:{}};$m.exports;(function(n){(function(e,t,s){function r(a){var c=this;c.next=function(){var d=c.w,h=c.X,p=c.i,f,m;return c.w=d=d+1640531527|0,m=h[p+34&127],f=h[p=p+1&127],m^=m<<13,f^=f<<17,m^=m>>>15,f^=f>>>12,m=h[p]=m^f,c.i=p,m+(d^d>>>16)|0};function l(d,h){var p,f,m,g,x,y=[],b=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,b=Math.max(b,h.length)),m=0,g=-32;g<b;++g)h&&(f^=h.charCodeAt((g+32)%h.length)),g===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(x=x+1640531527|0,p=y[g&127]^=f+x,m=p==0?m+1:0);for(m>=128&&(y[(h&&h.length||0)&127]=-1),m=127,g=4*128;g>0;--g)f=y[m+34&127],p=y[m=m+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,y[m]=f^p;d.w=x,d.X=y,d.i=m}l(c,a)}function o(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function i(a,c){a==null&&(a=+new Date);var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(d.X&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.xor4096=i})(vi,n)})($m);var HA=$m.exports,Tm={exports:{}};Tm.exports;(function(n){(function(e,t,s){function r(a){var c=this,l="";c.next=function(){var h=c.b,p=c.c,f=c.d,m=c.a;return h=h<<25^h>>>7^p,p=p-f|0,f=f<<24^f>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^p,c.c=p=p-f|0,c.d=f<<16^p>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var d=0;d<l.length+20;d++)c.b^=l.charCodeAt(d)|0,c.next()}function o(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function i(a,c){var l=new r(a),d=c&&c.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=l.next,h.quick=h,d&&(typeof d=="object"&&o(d,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=i:this.tychei=i})(vi,n)})(Tm);var qA=Tm.exports,Cw={exports:{}};const KA={},XA=Object.freeze(Object.defineProperty({__proto__:null,default:KA},Symbol.toStringTag,{value:"Module"})),QA=XI(XA);(function(n){(function(e,t,s){var r=256,o=6,i=52,a="random",c=s.pow(r,o),l=s.pow(2,i),d=l*2,h=r-1,p;function f(w,S,N){var C=[];S=S==!0?{entropy:!0}:S||{};var k=y(x(S.entropy?[w,v(t)]:w??b(),3),C),I=new m(C),$=function(){for(var j=I.g(o),P=c,O=0;j<l;)j=(j+O)*r,P*=r,O=I.g(1);for(;j>=d;)j/=2,P/=2,O>>>=1;return(j+O)/P};return $.int32=function(){return I.g(4)|0},$.quick=function(){return I.g(4)/4294967296},$.double=$,y(v(I.S),t),(S.pass||N||function(j,P,O,A){return A&&(A.S&&g(A,I),j.state=function(){return g(I,{})}),O?(s[a]=j,P):j})($,k,"global"in S?S.global:this==s,S.state)}function m(w){var S,N=w.length,C=this,k=0,I=C.i=C.j=0,$=C.S=[];for(N||(w=[N++]);k<r;)$[k]=k++;for(k=0;k<r;k++)$[k]=$[I=h&I+w[k%N]+(S=$[k])],$[I]=S;(C.g=function(j){for(var P,O=0,A=C.i,z=C.j,L=C.S;j--;)P=L[A=h&A+1],O=O*r+L[h&(L[A]=L[z=h&z+P])+(L[z]=P)];return C.i=A,C.j=z,O})(r)}function g(w,S){return S.i=w.i,S.j=w.j,S.S=w.S.slice(),S}function x(w,S){var N=[],C=typeof w,k;if(S&&C=="object")for(k in w)try{N.push(x(w[k],S-1))}catch{}return N.length?N:C=="string"?w:w+"\0"}function y(w,S){for(var N=w+"",C,k=0;k<N.length;)S[h&k]=h&(C^=S[h&k]*19)+N.charCodeAt(k++);return v(S)}function b(){try{var w;return p&&(w=p.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),v(w)}catch{var S=e.navigator,N=S&&S.plugins;return[+new Date,e,N,e.screen,v(t)]}}function v(w){return String.fromCharCode.apply(0,w)}if(y(s.random(),t),n.exports){n.exports=f;try{p=QA}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:vi,[],Math)})(Cw);var YA=Cw.exports,JA=BA,ZA=VA,eE=UA,tE=GA,nE=HA,sE=qA,Ii=YA;Ii.alea=JA;Ii.xor128=ZA;Ii.xorwow=eE;Ii.xorshift7=tE;Ii.xor4096=nE;Ii.tychei=sE;var Am=Ii;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nw{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Am.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class rE{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Am.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oE(n,e=0,t=1,s,r){if(oo(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new Nw(e,t,s,!1,r),i=Wt(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const iE=ne({randomNormal_:oE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(n,e=0,t=1,s="float32",r){oo(n);const o=Wt(n,s),i=new rE(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const fl=ne({randomUniform_:aE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oc(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return Q.runKernel(Hf,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cE(n){const t={input:W(n,"input","real")};return Q.runKernel(qf,t)}const gu=ne({real_:cE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lE(n){const t={x:W(n,"x","reciprocal")};return Q.runKernel(Kc,t)}const uE=ne({reciprocal_:lE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dE(n){const t={x:W(n,"x","relu")};return Q.runKernel(Xc,t)}const ki=ne({relu_:dE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hE(n){const t={x:W(n,"x","relu6")};return Q.runKernel(Qc,t)}const Iw=ne({relu6_:hE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pE(n,e){const s={x:W(n,"x","reverse")},r={dims:e};return Q.runKernel(Bd,s,r)}const mi=ne({reverse_:pE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fE(n){const t={x:W(n,"x","round")};return Q.runKernel(Yc,t)}const kw=ne({round_:fE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mE(n){const t={x:W(n,"x","rsqrt","float32")};return Q.runKernel(Jc,t)}const $w=ne({rsqrt_:mE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gE(n){const t={x:W(n,"x","selu")};return Q.runKernel(Zc,t)}const Tw=ne({selu_:gE});function xE(n,e,t,s,r,o=[1,1],i="NHWC"){const a=W(n,"x","separableConv2d"),c=W(e,"depthwiseFilter","separableConv2d"),l=W(t,"pointwiseFilter","separableConv2d");let d=a,h=!1;if(a.rank===3&&(h=!0,d=ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),E(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),E(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),E(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),E(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const p=c.shape[2],f=c.shape[3];E(l.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${l.shape[2]}.`);const m=hm(d,c,s,r,i,o),x=pi(m,l,1,"valid",i);return h?ee(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Aw=ne({separableConv2d_:xE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(n){const t={x:W(n,"x","sign")};return Q.runKernel(nl,t)}const bE=ne({sign_:yE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wE(n){const t={x:W(n,"x","sin","float32")};return Q.runKernel(el,t)}const Ew=ne({sin_:wE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(n){const t={x:W(n,"x","sinh")};return Q.runKernel(tl,t)}const Rw=ne({sinh_:vE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SE(n,e,t){const s=W(n,"x","slice1d");return E(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),hn(s,[e],[t])}const Em=ne({slice1d_:SE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CE(n,e,t){const s=W(n,"x","slice2d");return E(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const Dw=ne({slice2d_:CE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(n,e,t){const s=W(n,"x","slice3d");return E(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const Rm=ne({slice3d_:NE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IE(n,e,t){const s=W(n,"x","slice4d");return E(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),hn(s,e,t)}const xu=ne({slice4d_:IE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kE(n,e=-1){const t=W(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return Q.runKernel(Kd,s,r)}const Dm=ne({softmax_:kE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(n){E(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Q.runKernel(jf,e)}const _w=ne({fft_:$E});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TE(n){E(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Q.runKernel(Of,e)}const Fp=ne({ifft_:TE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=ee(n,[t,e]);s=Fp(r)}else{const r=[t,2*(e-1)],o=ee(gu(n),[t,e]),i=ee(mm(n),[t,e]),a=mi(hn(o,[0,1],[t,e-2]),1),c=q(mi(hn(i,[0,1],[t,e-2]),1),Zt(-1)),l=xs([o,a],1),d=xs([i,c],1),h=ee(ci(l,d),[r[0],r[1]]);s=Fp(h)}if(s=gu(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=ee(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const EE=ne({irfft_:AE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RE(n,e,t=0){const r={x:W(n,"x","split")},o={numOrSizeSplits:e,axis:t};return Q.runKernel(qd,r,o)}const Os=ne({split_:RE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DE(n,e){E(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const m=n.shape.map(x=>0),g=n.shape.map(x=>x);g[n.shape.length-1]=e,r=hn(n,m,g),t=e}else if(e!=null&&e>t){const m=n.shape.map(g=>g);m[n.shape.length-1]=e-t,r=xs([n,Un(m)],n.shape.length-1),t=e}else r=n;const o=qt(r),i=ee(ci(r,o),[s,t]),a=_w(i),c=Math.floor(t/2)+1,l=gu(a),d=mm(a),h=Os(l,[c,t-c],l.shape.length-1),p=Os(d,[c,t-c],d.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=c,ee(ci(h[0],p[0]),f)}const _E=ne({rfft_:DE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(n,e){let t=W(n,"a","squaredDifference"),s=W(e,"b","squaredDifference");[t,s]=$n(t,s),_t(t.shape,s.shape);const r={a:t,b:s},o={};return Q.runKernel(il,r,o)}const jE=ne({squaredDifference_:PE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ME(n,e){const t=W(n,"x","squeeze","string_or_numeric");return ee(t,Ro(t.shape,e).newShape)}const ml=ne({squeeze_:ME});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FE(n,e=0){const t=Zb(n,"tensors","stack","string_or_numeric");E(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&E(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return Q.runKernel(jd,s,r)}const to=ne({stack_:FE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OE(n,e=0){const s={x:W(n,"x","step")},r={alpha:e};return Q.runKernel(dl,s,r)}const gl=ne({step_:OE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LE(n,e,t,s,r=0,o=0,i=0,a=0,c=0){const d={x:W(n,"x","stridedSlice","string_or_numeric")},h={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};return Q.runKernel(Jf,d,h)}const zE=ne({stridedSlice_:LE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WE(n){const t={x:W(n,"x","tan","float32")};return Q.runKernel(cl,t)}const BE=ne({tan_:WE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Es(n,e){ob(n);const t=Zd(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eh(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zi(n,e,t){if(ob(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Zd(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eh(n,e,s,t)}function Pw(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function VE(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}Pw(t,e,n)}function $i(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let h=r;h<o;++h)i*=t[h];const a=r<1?1:r,c=we(e.shape)/a,l=[...xt(t.slice(0,r)),1],d=we(t);return{sliceRank:r,numUpdates:c,sliceSize:i,strides:l,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UE(n,e=1,t=!0){const s=W(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[a,c]=Q.runKernel(Zf,o,i);return{values:a,indices:c}}const GE=ne({topk_:UE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(n,e=0,t=1,s,r){if(oo(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new Nw(e,t,s,!0,r),i=Wt(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const jw=ne({truncatedNormal_:HE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(n,e=0){const t=W(n,"x","unique","string_or_numeric");E(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=Q.runKernel(tm,s,r);return{values:o,indices:i}}const KE=ne({unique_:qE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(n,e,t){const s=W(n,"x","unsortedSegmentSum"),r=W(e,"segmentIds","unsortedSegmentSum","int32");E(ra(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return Q.runKernel(Qd,o,i)}const Mw=ne({unsortedSegmentSum_:XE});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(n,e=0){const t=W(n,"x","unstack","string_or_numeric");E(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return Q.runKernel(Xd,s,r)}const gi=ne({unstack_:QE});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(n,e=!0,t,s){return Q.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fw(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=Wt(n,"int32"),r=Wt([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(n,e,t){const s=W(n,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),E(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{E(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?ce(()=>{let i=gu(s),a=mm(s);return i=Q.runKernel(Qi,{x:i},o),a=Q.runKernel(Qi,{x:a},o),t&&(a=kn(a)),ci(i,a)}):Q.runKernel(Qi,r,o)}const Ht=ne({transpose_:JE});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(n,e){if(e==null)return n.shape.slice();if(en(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eR(n,e,t,s){const r=W(n,"x","dropout");if(E(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),E(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof jn?r.clone():r;const o=ZE(r,t),i=1-e,a=Nt(ih(Pe(fl(o,0,1,"float32",s),i)),i);return q(r,a)}const tR=ne({dropout_:eR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n,e,t,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]])),E(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),E(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),E(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const l=o==="NHWC"?a.shape[3]:a.shape[1],d=o==="NHWC"?c.shape[3]:c.shape[1];E(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),E(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),ws("conv2dDerFilter",r,i);const h={x:a,dy:c},p={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return Q.runKernel(Nf,h,p)}const _m=ne({conv2DBackpropFilter_:nR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pm(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return q(n,gl(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function jm(n,e){let t=e;const s=zn(n.shape,e.shape);return s.length>0&&(t=wt(t,s)),ee(t,n.shape)}function Mm(n,e,t,s){if(e==="linear")return n;if(e==="relu")return ki(n);if(e==="elu")return rh(n);if(e==="relu6")return Iw(n);if(e==="prelu")return Sm(n,t);if(e==="leakyrelu")return gm(n,s);if(e==="sigmoid")return Sa(n);throw new Error(`Unknown fused activation ${e}.`)}const Fm=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sR({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:d}){if(c=c||"linear",Fm(Q.state.gradientDepth,c)===!1){E(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=pi(n,e,t,s,r,o,i);return a!=null&&(N=Pe(N,a)),Mm(N,c,l,d)}const h=W(n,"x","conv2d","float32"),p=W(e,"filter","conv2d","float32");let f=h,m=!1;h.rank===3&&(m=!0,f=ee(h,[1,h.shape[0],h.shape[1],h.shape[2]])),E(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),E(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),ws("fused conv2d",s,i);const g=r==="NHWC"?f.shape[3]:f.shape[1];E(p.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${p.shape[2]}.`),E(ts(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const x=Xn(f.shape,p.shape,t,o,s,i);let y;a!=null&&(y=W(a,"bias","fused conv2d"),[y]=$n(y,h),r==="NHWC"?_t(x.outShape,y.shape):(E(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),E(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let b;if(l!=null){const N=l.shape;if(E(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)E(N[0]===1||N[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${x.outChannels}).`);else if(N.length===3)try{_t(N,x.outShape)}catch{const k=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(k)}b=W(l,"prelu weights","fused conv2d")}const v=(N,C)=>{E(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[k,I,$,j]=C,P=Pm(N,$,c);E(di(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const O=um(I.shape,P,k,t,s),A=_m(I,P,k.shape,t,s),z=[O,A];if(j!=null){const L=jm(j,P);z.push(L)}return z},w={x:f,filter:p,bias:y,preluActivationWeights:b},S={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:c,leakyreluAlpha:d};return a==null?la((C,k,I)=>{let $=Q.runKernel(cu,w,S);return I([k,C,$]),m&&($=ee($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:v}})(f,p):la((C,k,I,$)=>{let j=Q.runKernel(cu,w,S);return $([k,C,j,I]),m&&(j=ee(j,[j.shape[1],j.shape[2],j.shape[3]])),{value:j,gradFunc:v}})(f,p,y)}const rR=ne({fusedConv2d_:sR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(n,e,t,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=ee(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c=e;c.rank===3&&(c=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:a,dy:c},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return Q.runKernel(Rf,l,d)}const iR=ne({depthwiseConv2dNativeBackpropFilter_:oR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n,e,t,s,r,o=[1,1],i){let a=e,c=!1;e.rank===3&&(c=!0,a=ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},h=Q.runKernel(Df,l,d);return c?ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const cR=ne({depthwiseConv2dNativeBackpropInput_:aR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lR({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Fm(Q.state.gradientDepth,o)===!1){let j=Jt(n,e,t,s);return r!=null&&(j=Pe(j,r)),Mm(j,o,i,a)}let c=W(n,"a","fused matMul"),l=W(e,"b","fused matMul");[c,l]=$n(c,l);const d=t?c.shape[c.rank-2]:c.shape[c.rank-1],h=s?l.shape[l.rank-1]:l.shape[l.rank-2],p=t?c.shape[c.rank-1]:c.shape[c.rank-2],f=s?l.shape[l.rank-2]:l.shape[l.rank-1],m=c.shape.slice(0,-2),g=l.shape.slice(0,-2),x=we(m),y=we(g);E(d===h,()=>`Error in fused matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${t} and transposeB=${s} must match.`);const v=_t(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([p,f]),w=t?ee(c,[x,d,p]):ee(c,[x,p,d]),S=s?ee(l,[y,f,h]):ee(l,[y,h,f]);let N;r!=null&&(N=W(r,"bias","fused matMul"),[N]=$n(N,c),_t(v,N.shape));let C;i!=null&&(C=W(i,"prelu weights","fused matMul"));const k=(j,P)=>{const[O,A,z,L]=P,U=Pm(ee(j,z.shape),z,o);let V,B;if(!t&&!s?(V=Jt(U,A,!1,!0),B=Jt(O,U,!0,!1)):!t&&s?(V=Jt(U,A,!1,!1),B=Jt(U,O,!0,!1)):t&&!s?(V=Jt(A,U,!1,!0),B=Jt(O,U,!1,!1)):(V=Jt(A,U,!0,!0),B=Jt(U,O,!0,!0)),r!=null){const Y=jm(L,U);return[V,B,Y]}else return[V,B]},I={a:w,b:S,bias:N,preluActivationWeights:C},$={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?la((P,O,A)=>{const z=Q.runKernel(au,I,$);return A([P,O,z]),{value:ee(z,v),gradFunc:k}})(w,S):la((P,O,A,z)=>{const L=Q.runKernel(au,I,$);return z([P,O,L,A]),{value:ee(L,v),gradFunc:k}})(w,S,N)}const rx=ne({fusedMatMul_:lR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uR(n,e,t,s,r="bilinear",o=0){const i=W(n,"image","cropAndResize"),a=W(e,"boxes","cropAndResize","float32"),c=W(t,"boxInd","cropAndResize","int32"),l=a.shape[0];E(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),E(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),E(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),E(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),E(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),E(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:a,boxInd:c},h={method:r,extrapolationValue:o,cropSize:s};return Q.runKernel(Tf,d,h)}const dR=ne({cropAndResize_:uR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hR(n){const e=W(n,"image","flipLeftRight","float32");E(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Q.runKernel(Ff,t,{})}const pR=ne({flipLeftRight_:hR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n){const e=W(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];E(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),E(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,fr(e,r)}const mR=ne({grayscaleToRGB_:fR});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gR(n){const e=W(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];E(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),E(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=Je(e,"float32"),i=Es([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Fa("ij,j->i",o,i);break;case 3:a=Fa("ijk,k->ij",o,i);break;case 4:a=Fa("ijkl,l->ijk",o,i);break;case 5:a=Fa("ijklm,m->ijkl",o,i);break;case 6:a=Fa("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=fs(a,-1),Je(a,r)}const xR=ne({rgbToGrayscale_:gR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(n,e,t=0,s=.5){const r=W(n,"image","rotateWithOffset","float32");E(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return Q.runKernel(nm,o,i)}const bR=ne({rotateWithOffset_:yR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Na(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),E(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),E(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),E(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),E(e.rank===1,()=>"scores must be a 1D tensor"),E(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),E(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=W(n,"boxes","nonMaxSuppression","float32"),i=W(e,"scores","nonMaxSuppression","float32"),a=Na(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return Q.runKernel(Vf,{boxes:o,scores:i},c)}const vR=ne({nonMaxSuppression_:wR});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SR(n,e,t){const s=CR(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function CR(n,e,t){return IR(n,e,t||NR)}function NR(n,e){return n>e?1:n<e?-1:0}function IR(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=t(e,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Om(n,e,t,s,r){return Wm(n,e,t,s,r,0)}function Lm(n,e,t,s,r,o){return Wm(n,e,t,s,r,0,!1,o,!0)}function zm(n,e,t,s,r,o){return Wm(n,e,t,s,r,o,!0)}function Wm(n,e,t,s,r,o,i=!1,a=!1,c=!1){const l=[];for(let x=0;x<e.length;x++)e[x]>r&&l.push({score:e[x],boxIndex:x,suppressBeginIndex:0});l.sort(ox);const d=o>0?-.5/o:0,h=[],p=[];for(;h.length<t&&l.length>0;){const x=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=x;if(y<r)break;let w=!1;for(let S=h.length-1;S>=v;--S){const N=kR(n,b,h[S]);if(N>=s){w=!0;break}if(x.score=x.score*$R(s,d,N),x.score<=r)break}x.suppressBeginIndex=h.length,w||(x.score===y?(h.push(b),p.push(x.score)):x.score>r&&SR(l,x,ox))}const f=h.length,m=t-f;a&&m>0&&(h.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));const g={selectedIndices:h};return i&&(g.selectedScores=p),c&&(g.validOutputs=f),g}function kR(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),c=Math.max(s[1],s[3]),l=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),f=(a-o)*(c-i),m=(h-l)*(p-d);if(f<=0||m<=0)return 0;const g=Math.max(o,l),x=Math.max(i,d),y=Math.min(a,h),b=Math.min(c,p),v=Math.max(y-g,0)*Math.max(b-x,0);return v/(f+m-v)}function $R(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function ox(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function TR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=W(n,"boxes","nonMaxSuppressionAsync"),i=W(e,"scores","nonMaxSuppressionAsync"),a=Na(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const c=await Promise.all([o.data(),i.data()]),l=c[0],d=c[1],{selectedIndices:h}=Om(l,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),Es(h,"int32")}const AR=TR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),c=Na(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l={boxes:i,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},h=Q.runKernel(Gf,l,d);return{selectedIndices:h[0],selectedScores:h[1]}}const RR=ne({nonMaxSuppressionWithScore_:ER});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function DR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),c=Na(i,a,t,s,r,o);t=c.maxOutputSize,s=c.iouThreshold,r=c.scoreThreshold,o=c.softNmsSigma;const l=await Promise.all([i.data(),a.data()]),d=l[0],h=l[1],{selectedIndices:p,selectedScores:f}=zm(d,h,t,s,r,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Es(p,"int32"),selectedScores:Es(f)}}const _R=DR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=W(n,"boxes","nonMaxSuppression"),a=W(e,"scores","nonMaxSuppression"),c=Na(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,p={boxes:i,scores:a},f={maxOutputSize:l,iouThreshold:d,scoreThreshold:h,padToMaxOutputSize:o},m=Q.runKernel(Uf,p,f);return{selectedIndices:m[0],validOutputs:m[1]}}const jR=ne({nonMaxSuppressionPadded_:PR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function MR(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=W(n,"boxes","nonMaxSuppressionAsync"),a=W(e,"scores","nonMaxSuppressionAsync"),c=Na(i,a,t,s,r,null),l=c.maxOutputSize,d=c.iouThreshold,h=c.scoreThreshold,[p,f]=await Promise.all([i.data(),a.data()]),{selectedIndices:m,validOutputs:g}=Lm(p,f,l,d,h,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Es(m,"int32"),validOutputs:Zt(g,"int32")}}const FR=MR;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(n,e,t=!1,s=!1){const r=W(n,"images","resizeBilinear");E(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),E(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),E(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=Q.runKernel(Wd,a,c);return i?ee(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Ow=ne({resizeBilinear_:OR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(n,e,t=!1,s=!1){const r=W(n,"images","resizeNearestNeighbor");E(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),E(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),E(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),E(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},c={alignCorners:t,halfPixelCenters:s,size:e},l=Q.runKernel(zd,a,c);return i?ee(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const Lw=ne({resizeNearestNeighbor_:LR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zR(n,e="binary",t=!1,s=.5){const r=W(n,"image","threshold"),o=.2989,i=.587,a=.114,c=r.shape[0]*r.shape[1];let l=q(Es([s]),255),d,h,p,f;if(E(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),E(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),E(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),E(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,h,p]=Os(r,[1,1,1],-1);const x=q(d,o),y=q(h,i),b=q(p,a);f=Pe(Pe(x,y),b)}else f=n;if(e==="otsu"){const x=L2(Je(kw(f),"int32"),Yi([]),256);l=WR(x,c)}const m=t?Ca(f,l):zs(f,l);return Je(q(m,255),"int32")}function WR(n,e){let t=Es([-1]),s=Es([0]),r=Es([0]),o,i,a,c,l,d;for(let h=0;h<n.size-1;h++){o=hn(n,0,h+1),i=hn(n,h+1),l=Nt(wt(o),e),d=Nt(wt(i),e);const p=wt(q(o,oc(0,o.size)));a=Nt(p,wt(o));const f=sh(i.shape,o.size),m=Pe(oc(0,i.size),f),g=q(i,m);c=Nt(wt(g),wt(i));const x=kt(a,c),y=kt(a,c),b=q(l,d);r=q(q(b,x),y);const v=zs(r,s);s=ls(v,r,s),t=ls(v,Es([h]),t)}return t}const BR=ne({threshold_:zR});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VR(n,e,t="nearest",s="constant",r=0,o){const i=W(n,"image","transform","float32"),a=W(e,"transforms","transform","float32");E(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),E(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),E(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const c={image:i,transforms:a},l={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return Q.runKernel(em,c,l)}const UR=ne({transform_:VR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n,e,t){const s=W(n,"a","bandPart");E(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,c;typeof e=="number"?(E(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),E(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=W(e<0?o:e,"numLower","bandPart")):(E(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ls(fu(e,0),o,rc(e,o))),typeof t=="number"?(E(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),E(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),c=W(t<0?i:t,"numUpper","bandPart")):(E(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=ls(fu(t,0),i,rc(t,i)));const l=ee(oc(0,o,1,"int32"),[-1,1]),d=oc(0,i,1,"int32"),h=kt(l,d),p=eo(Ca(h,a),Ni(h,kn(c))),f=Un([o,i],s.dtype);return ee(to(gi(ee(s,[-1,o,i])).map(m=>ls(p,m,f))),r)}const HR=ne({bandPart_:GR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qR(n){let e;if(Array.isArray(n)){e=!1,E(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)E(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Os(n,n.shape[0],0).map(r=>ml(r,[0]));E(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(Q.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=q(wt(q(t[i],o)),t[i]);o=kt(o,a)}return Nt(o,oh(o,"euclidean"))}));return e?to(t,0):t}const KR=ne({gramSchmidt_:qR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(n,e=!1){if(E(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return ix(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((c,l)=>c*l),s=gi(ee(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(c=>{const[l,d]=ix(c,e);r.push(l),o.push(d)});const i=ee(to(r,0),n.shape),a=ee(to(o,0),n.shape);return[i,a]}}function ix(n,e=!1){return Q.tidy(()=>{E(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=xw(t),o=ti(n);const i=Zi([[1]],[1,1]);let a=ti(i);const c=t>=s?s:t;for(let l=0;l<c;++l){const d=o,h=a,p=r;[a,o,r]=Q.tidy(()=>{const f=hn(o,[l,l],[t-l,1]),m=oh(f),g=hn(o,[l,l],[1,1]),x=ls(zs(g,0),Zi([[-1]]),Zi([[1]])),y=kt(g,q(x,m)),b=Nt(f,y);b.shape[0]===1?a=ti(i):a=xs([i,hn(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const v=kn(Nt(Jt(x,y),m)),w=hn(o,[l,0],[t-l,s]),S=q(v,a),N=Ht(a);if(l===0)o=kt(w,Jt(S,Jt(N,w)));else{const I=kt(w,Jt(S,Jt(N,w)));o=xs([hn(o,[0,0],[l,s]),I],0)}const C=Ht(S),k=hn(r,[0,l],[t,r.shape[1]-l]);if(l===0)r=kt(k,Jt(Jt(k,a),C));else{const I=kt(k,Jt(Jt(k,a),C));r=xs([hn(r,[0,0],[t,l]),I],1)}return[a,o,r]}),Lt([d,h,p])}return!e&&t>s&&(r=hn(r,[0,0],[t,s]),o=hn(o,[0,0],[s,s])),[r,o]})}const QR=ne({qr_:XR});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jr={flipLeftRight:pR,grayscaleToRGB:mR,resizeNearestNeighbor:Lw,resizeBilinear:Ow,rgbToGrayscale:xR,rotateWithOffset:bR,cropAndResize:dR,nonMaxSuppression:vR,nonMaxSuppressionAsync:AR,nonMaxSuppressionWithScore:RR,nonMaxSuppressionWithScoreAsync:_R,nonMaxSuppressionPadded:jR,nonMaxSuppressionPaddedAsync:FR,threshold:BR,transform:UR},YR={bandPart:HR,gramSchmidt:KR,qr:QR};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JR=new Map,ZR=new Map;class Ia{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class qs{constructor(){this.classNameMap={}}static getMap(){return qs.instance==null&&(qs.instance=new qs),qs.instance}static register(e){qs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Re(n,e,t){E(n.className!=null,()=>"Class being registered does not have the static className property defined."),E(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),E(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return qs.register(n),JR.set(r,n),ZR.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oo extends Ia{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Lt(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return iA(e,t)}dispose(){this.iterations_!=null&&Lt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Zt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Oo,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zw extends Oo{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ce(()=>qt(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ce(()=>qt(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedGrads[r].variable,l=this.accumulatedUpdates[r].variable;ce(()=>{const d=Pe(q(c,this.rho),q(fn(a),1-this.rho)),h=q(Nt(es(Pe(l,this.epsilon)),es(Pe(c,this.epsilon))),a),p=Pe(q(l,this.rho),q(fn(h),1-this.rho));c.assign(d),l.assign(p);const f=Pe(q(h,-this.learningRate),o);o.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Lt(this.accumulatedGrads.map(e=>e.variable)),Lt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ww extends Oo{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ce(()=>sh(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;ce(()=>{const c=Pe(a,fn(i));a.assign(c);const l=Pe(q(Nt(i,es(Pe(c,Q.backend.epsilon()))),-this.learningRate),o);o.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Lt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bw extends Oo{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ce(()=>{this.accBeta1=Zt(t).variable(),this.accBeta2=Zt(s).variable()}),r==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ce(()=>{const s=kt(1,this.accBeta1),r=kt(1,this.accBeta2);t.forEach((o,i)=>{const a=Q.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ce(()=>qt(a).variable(c))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:ce(()=>qt(a).variable(c))});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedSecondMoment[i].variable,p=Pe(q(d,this.beta1),q(l,1-this.beta1)),f=Pe(q(h,this.beta2),q(fn(l),1-this.beta2)),m=Nt(p,s),g=Nt(f,r);d.assign(p),h.assign(f);const x=Pe(q(Nt(m,Pe(es(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(q(this.accBeta1,this.beta1)),this.accBeta2.assign(q(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Lt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Lt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ce(()=>{this.accBeta1.assign(fi(this.beta1,this.iterations_+1)),this.accBeta2.assign(fi(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vw extends Oo{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ce(()=>{this.iteration=Zt(0).variable(),this.accBeta1=Zt(t).variable()}),r==null&&(this.epsilon=Q.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ce(()=>{const s=kt(1,this.accBeta1),r=Nt(-this.learningRate,Pe(q(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=Q.registeredVariables[o],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:qt(a).variable(c)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:qt(a).variable(c)});const l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;const d=this.accumulatedFirstMoment[i].variable,h=this.accumulatedWeightedInfNorm[i].variable,p=Pe(q(d,this.beta1),q(l,1-this.beta1)),f=q(h,this.beta2),m=os(l),g=Mo(f,m);d.assign(p),h.assign(g);const x=Pe(q(Nt(r,s),Nt(p,Pe(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(Pe(this.iteration,1)),this.accBeta1.assign(q(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Lt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Lt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bm extends Oo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=Q.registeredVariables[s];ce(()=>{const a=Pe(q(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Mr(Zt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uw extends Bm{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Zt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ce(()=>qt(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ce(()=>{let c;const l=Pe(q(this.m,i),a);this.useNesterov?c=Pe(q(this.c,Pe(a,q(l,this.m))),o):c=Pe(q(this.c,l),o),i.assign(l),o.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Lt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gw extends Oo{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=Q.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Q.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ce(()=>qt(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ce(()=>qt(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ce(()=>qt(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const c=this.accumulatedMeanSquares[r].variable,l=this.accumulatedMoments[r].variable;ce(()=>{const d=Pe(q(c,this.decay),q(fn(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,p=Pe(q(h,this.decay),q(a,1-this.decay)),f=Nt(q(a,this.learningRate),es(kt(d,Pe(fn(p),this.epsilon)))),m=Pe(q(l,this.momentum),f);c.assign(d),h.assign(p),l.assign(m);const g=kt(o,m);o.assign(g)}else{const h=Pe(q(c,this.decay),q(fn(a),1-this.decay)),p=Pe(q(l,this.momentum),Nt(q(a,this.learningRate),es(Pe(h,this.epsilon))));c.assign(h),l.assign(p);const f=kt(o,p);o.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Lt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Lt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Lt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eD=[zw,Ww,Bw,Vw,Uw,Gw,Bm];function tD(){for(const n of eD)Re(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ax(n,e,t,s){i(n),t=t??0,s=s??1,a(t,s);let r=0;const o=c=>(c.then(l=>{const d=t+ ++r/n.length*(s-t);return e(d),l}),c);function i(c){E(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function a(c,l){E(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),E(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),E(l>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${l}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function nD(n,e){e==null&&(e={});const t=e.fetchFunc==null?fe().platform.fetch:e.fetchFunc,s=n.map(h=>t(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await ax(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await ax(a,e.onProgress,.5,1)}function sD(n,e){var t;const s=e.fetchFunc==null?fe().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:c,value:l}=await o.read();if(c){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}i.enqueue(l);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rD="application/octet-stream",oD="application/json";class Vm{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(E(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=fe().platform.fetch,E(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&E(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=b$(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:oD}),"model.json"),e.weightData!=null){const i=_o.join(e.weightData);t.body.append("model.weights.bin",new Blob([i],{type:rD}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:im(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return v$(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=tx(e.weightsManifest),r=()=>sD(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=iD(t),o=this.weightPathPrefix||s,i=[],a=[];for(const c of e)for(const l of c.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(l)):i.push(o+l+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const t=await this.getWeightUrls(e),s=tx(e),r=await nD(t,this.loadOptions);return[s,r]}}Vm.URL_SCHEME_REGEX=/^https?:\/\//;function iD(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function cx(n){return n.match(Vm.URL_SCHEME_REGEX)!=null}const Hw=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>cx(s)):t=cx(n),t)return qw(n,e)}return null};Bn.registerSaveRouter(Hw);Bn.registerLoadRouter(Hw);function qw(n,e){return new Vm(n,e)}function aD(n,e){return qw(n,e)}function Um(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(we(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let h=0;h<r.length-1;++h)i*=r[h];const a=n.shape,c=r.slice();c.pop();let l=1;for(let h=o;h<t;++h)l*=a[h],c.push(a[h]);const d=[...xt(n.shape).map(h=>h/l),1].slice(0,o);return[c,i,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Op=-2,cD=-1;function Gm(n,e,t){const s=n.shape.length;E(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),E(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)E(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function lD(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Hm(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function Kw(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Xw(n,e,t){return t<=n?t:t-(e-1)}function Qw(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function uD(n,e,t,s,r,o,i,a,c){const l=n.length;let d=new Array(l),h=new Array(l),p=new Array(l);if(e.length&&t>0){const f=e[0],m=t+1;d=Yw(i,f,m,s,n),h=Jw(a,f,m,r,n),p=Kw(o,f,m,n)}else for(let f=0;f<l;f++)d[f]=ev(i,s,o,n,f,c),h[f]=tv(a,r,o,n,f,c),p[f]=Zw(o,f,c);return{begin:d,end:h,strides:p}}function Yw(n,e,t,s,r){const o=[...r],i=Qw(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const c=Xw(e,t,a);let l=s[c];n&1<<c&&(l=0),o[a]=l}return o}function Jw(n,e,t,s,r){const o=[...r],i=Qw(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const c=Xw(e,t,a);let l=s[c];n&1<<c&&(l=Number.MAX_SAFE_INTEGER),o[a]=l}for(let a=0;a<o.length;a++){const c=r[a];o[a]<0&&(o[a]+=c),o[a]=ii(0,o[a],r[a])}return o}function Zw(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function ev(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),i=ii(0,i,c-1),i}function tv(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const c=s[r];return i<0&&(i+=c),a>0?i=ii(0,i,c):i=ii(-1,i,c-1),i}function qm(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function Km(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function ah(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{E(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(E(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function Xm(n,e,t,s,r,o,i,a,c){let l;if(s==null?(l=new Array(e.length),l.fill(1)):l=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const h={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};for(let v=0;v<h.dims;v++)d&&1<<v&a&&h.numAddAxisAfterEllipsis++,1<<v&i&&(d=!0);d||(h.ellipsisMask|=1<<h.dims,h.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};dD(h,p);let f=!0,m=!0,g=!0;const x=[],y=[];for(let v=0;v<n.length;++v){if(p.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const w=!!(p.shrinkAxisMask&1<<v),S=n[v];if(S===-1){x.push(w?1:-1);continue}const N=[p.beginMask&1<<v,p.endMask&1<<v],C=[p.strides[v]>0?0:-1,p.strides[v]>0?S:S-1];if(w&&p.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&p.strides[v]===1;const k=!!(p.beginMask&1<<v&&p.endMask&1<<v);if(p.beginValid&&p.endValid){if(w){const P=p.begin[v]<0?S+p.begin[v]:p.begin[v];if(p.begin[v]=P,p.end[v]=p.begin[v]+1,P<0||P>=S)throw Error(`slice index ${p.begin[v]} of dimension ${v} out of bounds.`)}else p.begin[v]=lx(p.begin[v],0,p.strides[v],S,N,C),p.end[v]=lx(p.end[v],1,p.strides[v],S,N,C);const j=p.strides[v]===1&&p.begin[v]===0&&p.end[v]===S;f=f&&j,m=m&&(v===0&&p.strides[v]===1||j)}else f=f&&p.strides[v]===1&&k,m=m&&(v===0&&p.strides[v]===1||k);let I,$=!1;if(p.beginValid&&p.endValid?(I=p.end[v]-p.begin[v],$=!0):w?(I=1,$=!0):k&&S>=0&&(p.strides[v]<0?I=-S:I=S,$=!0),$){let j;I===0||I<0!=p.strides[v]<0?j=0:j=Math.trunc(I/p.strides[v])+(I%p.strides[v]!==0?1:0),x.push(j)}else x.push(-1)}for(let v=0;v<p.finalShapeGatherIndices.length;++v){const w=p.finalShapeGatherIndices[v];w>=0?y.push(x[w]):w===Op&&y.push(1)}return{finalShapeSparse:y.filter((v,w)=>p.finalShapeGatherIndices[w]!==Op),finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:g,begin:p.begin,end:p.end,strides:p.strides}}function dD(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Op),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(cD),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function lx(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const hD=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Gm,computeFlatOffset:Km,computeOutShape:Hm,getNormalizedAxes:uD,isSliceContinous:qm,maskToAxes:lD,parseSliceParams:ah,sliceInfo:Xm,startForAxis:ev,startIndicesWithElidedDims:Yw,stopForAxis:tv,stopIndicesWithElidedDims:Jw,stridesForAxis:Zw,stridesWithElidedDims:Kw},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pD{static sgd(e){return new Bm(e)}static momentum(e,t,s=!1){return new Uw(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new Gw(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new Bw(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new zw(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new Vw(e,t,s,r,o)}static adagrad(e,t=.1){return new Ww(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ho=pD;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fD=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function nv(){return new Promise(n=>fD(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qm(n,e){const t=n[0].length;n.forEach((r,o)=>{E(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),E(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)E(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Fr(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(hr||(hr={}));function sv(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function rv(n){const e={FIRST_DIM_SIZE:hr.FIRST_DIM_SIZE,VALUE_ROWIDS:hr.VALUE_ROWIDS,ROW_LENGTHS:hr.ROW_LENGTHS,ROW_SPLITS:hr.ROW_SPLITS,ROW_LIMITS:hr.ROW_LIMITS,ROW_STARTS:hr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function ov(n){return n.length===0?0:n[0]===hr.FIRST_DIM_SIZE?n.length-1:n.length}function iv(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ym=30;function ch(n){return n<=Ym?n:wp(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jm(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xl(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function yl(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function bl(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function Zm(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function eg(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lh=1.7580993408473768,uh=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tg=.3275911,ng=.254829592,sg=-.284496736,rg=1.421413741,og=-1.453152027,ig=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function av(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function cv(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function lv(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function ag(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function uv(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function dv(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function hv(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kh="->",mD=/->/g,ux=",",dx="...";function cg(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(mD,"").length)/Kh.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Kh}").`);const[s,r]=n.split(Kh);E(s.indexOf(dx)===-1,()=>`The ellipsis notation ("${dx}") is not supported yet.`);const o=s.split(ux),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const f=r[p];if(!o.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<s.length;++p){const f=s[p];a.indexOf(f)===-1&&f!==ux&&a.push(f)}const c=new Array(o.length);for(let p=0;p<i;++p){if(new Set(o[p].split("")).size!==o[p].length)throw new Error(`Found duplicate axes in input component ${o[p]}. Support for duplicate axes in input is not implemented yet.`);c[p]=[];for(let f=0;f<o[p].length;++f)c[p].push(a.indexOf(o[p][f]))}const l=a.length,d=r.length,h=[];for(let p=d;p<l;++p)h.push(p);return{allDims:a,summedDims:h,idDims:c}}function lg(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function ug(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:E(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function dg(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],c=gD(e,a);for(const l of c)o.indexOf(l)===-1&&(s[i].push(l),o.push(l))}return{path:t,steps:s}}function hg(n){return n.every((e,t)=>e===t)}function gD(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function pg(n,e,t=0){let s=[];if(typeof e=="number")E(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);E(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,c)=>c>0?a+c:a);e[o]=n.shape[t]-i}E(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pv(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function fv(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function mv(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gv(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function xv(n,e){return`size ${n} must be non-negative, not ${e}`}function yv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function bv(n,e){const t=we(n),s=we(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function wv(n,e){const t=we(n),s=we(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lp(){return"segment ids must be >= 0"}function vv(){return"segment ids are not increasing"}function Sv(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Cv(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nv(n,e){let t=!1,s;for(n<=Ym?(s=n,t=!0):s=wp(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=wp(n,s+1);return s}function Iv(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function fg(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let h=0;h<s;++h)if(n.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${n.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const i=n.shape[t],a=[];let c=1,l=1,d=1;for(let h=0;h<s;++h)a.push(n.shape[h]),c*=n.shape[h];for(let h=s;h<t;h++)a.push(n.shape[h]),l*=n.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=t+1;h<o;h++)a.push(n.shape[h]),d*=n.shape[h];return{batchSize:c,sliceSize:d,outerSize:l,dimSize:i,outputShape:a}}const xD=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:fg,computeOutShape:Iv,segOpComputeOptimalWindowSize:Nv},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(n){try{return n.map(e=>Io(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function kv(n){return n.map(e=>wo(e))}const yD=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:ng,ERF_A2:sg,ERF_A3:rg,ERF_A4:og,ERF_A5:ig,ERF_P:tg,PARALLELIZE_THRESHOLD:Ym,get RowPartitionType(){return hr},SELU_SCALE:uh,SELU_SCALEALPHA:lh,applyActivation:Mm,assertAndGetBroadcastShape:_t,assertAxesAreInnerMostDims:Qn,assertParamsConsistent:Qm,assignToTypedArray:uv,axesAreInnerMostDims:pm,calculateShapes:$i,checkEinsumDimSizes:ug,checkPadOnDimRoundingMode:ws,combineLocations:mw,combineRaggedTensorToTensorShapes:sv,complexWithEvenIndex:cv,complexWithOddIndex:lv,computeConv2DInfo:Xn,computeConv3DInfo:Po,computeDefaultPad:am,computeDilation2DInfo:hl,computeOptimalWindowSize:ch,computeOutAndReduceShapes:Hn,computeOutShape:Fr,computePool2DInfo:tr,computePool3DInfo:io,convertConv2DDataFormat:ao,decodeEinsumEquation:cg,eitherStridesOrDilationsAreOne:ts,expandShapeToKeepDim:_n,exponent:hv,exponents:dv,fromStringArrayToUint8:kv,fromUint8ToStringArray:so,getAxesPermutation:Cn,getBroadcastDims:ca,getComplexWithIndex:ag,getEinsumComputePath:dg,getEinsumPermutation:lg,getFusedBiasGradient:jm,getFusedDyActivation:Pm,getImageCenter:Jm,getInnerMostAxes:Tn,getPermuted:yl,getRaggedRank:ov,getReductionAxes:zn,getReshaped:xl,getReshapedPermuted:bl,getRowPartitionTypesHelper:rv,getSliceBeginCoords:Zm,getSliceSize:eg,getSparseFillEmptyRowsIndicesDenseShapeMismatch:pv,getSparseFillEmptyRowsNegativeIndexErrorMessage:fv,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:mv,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:yv,getSparseReshapeInputOutputMismatchErrorMessage:wv,getSparseReshapeInputOutputMultipleErrorMessage:bv,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:gv,getSparseReshapeNegativeOutputDimErrorMessage:xv,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Cv,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Lp,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:vv,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Sv,getUndoAxesPermutation:jo,isIdentityPermutation:hg,log:Ok,mergeRealAndImagArrays:no,prepareAndValidate:Um,prepareSplitSize:pg,segment_util:xD,shouldFuse:Fm,slice_util:hD,splitRealAndImagArrays:av,stridesOrDilationsArePositive:hi,tupleValuesAreOne:di,upcastType:Rs,validateDefaultValueShape:iv,validateInput:VE,validateUpdateShape:Pw,warn:Ms},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */tD();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $v={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,gl(Je(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bD={kernelName:xc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=fn(Je(t,"float32")),r=es(kt(Zt(1),s));return kn(Nt(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wD={kernelName:yc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=es(kt(fn(Je(t,"float32")),1));return Nt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vD={kernelName:va,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{let a=n;const c=zn(t.shape,r);return c.length>0&&(a=wt(a,c)),ee(a,t.shape)},b:()=>{let a=n;const c=zn(s.shape,r);return c.length>0&&(a=wt(a,c)),ee(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SD={kernelName:gf,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CD={kernelName:Zu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qt(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ND={kernelName:ed,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>qt(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ID={kernelName:bc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,es(kt(Zt(1),fn(Je(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kD={kernelName:wc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=es(Pe(Zt(1),fn(Je(t,"float32"))));return Nt(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $D={kernelName:Cc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=Pe(fn(t),fn(s));let c=q(n,Nt(s,a));const l=zn(t.shape,r);return l.length>0&&(c=wt(c,l)),ee(c,t.shape)},b:()=>{const a=Pe(fn(t),fn(s));let c=kn(q(n,Nt(t,a)));const l=zn(s.shape,r);return l.length>0&&(c=wt(c,l)),ee(c,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TD={kernelName:vc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,Pe(fn(Je(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AD={kernelName:Sc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,kt(Zt(1),fn(Je(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(n,e,t,s,r,o){const i=W(n,"dy","avgPool3dGrad"),a=W(e,"input","avgPool3dGrad");let c=i,l=a,d=!1;a.rank===4&&(d=!0,c=ee(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),E(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),E(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),ws("avgPool3dGrad",r,o);const h={dy:c,input:l},p={filterSize:t,strides:s,pad:r,dimRoundingMode:o},f=Q.runKernel(wf,h,p);return d?ee(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const RD=ne({avgPool3dGrad_:ED});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD={kernelName:nd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>RD(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(n,e,t,s,r){const o=W(n,"dy","avgPoolGrad"),i=W(e,"input","avgPoolGrad");E(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,c=o,l=!1;i.rank===3&&(l=!0,a=ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=ee(o,[1,o.shape[0],o.shape[1],o.shape[2]])),E(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),E(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:c,input:a},h={filterSize:t,strides:s,pad:r},p=Q.runKernel(bf,d,h);return l?ee(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const PD=ne({avgPoolGrad_:_D});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jD={kernelName:td,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>PD(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MD={kernelName:sd,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>Jt(n,r,!1,!0),b:()=>Jt(s,n,!0,!1)}:!o&&i?{a:()=>Jt(n,r,!1,!1),b:()=>Jt(n,s,!0,!1)}:o&&!i?{a:()=>Jt(r,n,!1,!0),b:()=>Jt(s,n,!1,!1)}:{a:()=>Jt(r,n,!0,!0),b:()=>Jt(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FD={kernelName:rd,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>vm(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OD={kernelName:Pk,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let c=r.length-1;c>=0;c--)if(r[c]===o[c])i[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let c=0;c<i.length;c++)i[c]>1&&a.push(c);return{x:()=>wt(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LD={kernelName:Nc,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zD={kernelName:Ic,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD={kernelName:kc,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>ls(eo(Ni(s,r),Ca(s,o)),n,qt(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD={kernelName:od,inputsToSave:["x"],gradFunc:$v.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD={kernelName:id,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(c=>c.shape),{axis:r}=t,o=Bt(r,e[0].shape)[0],i=s.map(c=>c[o]);return Os(n,i,o).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UD={kernelName:ad,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:c}=t;return E(di(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>um(s.shape,n,r,i,a,c),filter:()=>_m(s,n,r.shape,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD={kernelName:cd,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:c}=t;return{dy:()=>pi(n,r,o,i,a,1,c),filter:()=>_m(n,s,r.shape,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(n,e,t,s,r){let o=n;n.rank===4&&(o=ee(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),E(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),E(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),E(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),E(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),E(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},c={strides:s,pad:r,filterShape:t};return Q.runKernel(If,a,c)}const qD=ne({conv3DBackpropFilter_:HD});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KD={kernelName:ld,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;E(di(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>dw(i.shape,n,a,r,o),filter:()=>qD(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XD={kernelName:$c,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(kn(Ew(Je(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD={kernelName:Tc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(Rw(Je(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YD={kernelName:ud,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const a=Cn([r],s.rank);let c=pw(n,r,o,!i);return a!=null&&(c=Ht(c,a)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JD={kernelName:dd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,a=s??[1,1];E(di(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[c,l]=e;return E(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),E(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),E(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),E(ts(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),ws("depthwiseConv2d",o,i),{x:()=>cR(c.shape,n,l,r,o,a,i),filter:()=>iR(c,n,l.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZD={kernelName:hd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>Q.runKernel(vp,o,t),filter:()=>Q.runKernel(Sp,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e_={kernelName:Ec,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>Q.runKernel(Pf,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_={kernelName:Rc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=q(Vr(kn(fn(t))),2/Math.sqrt(Math.PI));return{x:()=>q(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n_={kernelName:Dc,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s_={kernelName:fd,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_={kernelName:_c,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,Vr(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o_={kernelName:Pc,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i_={kernelName:jc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=Nt(n,Je(s,"float32")),c=zn(t.shape,r);return c.length>0?ee(wt(a,c),t.shape):a},b:()=>{let a=q(n,Je(t,"float32"));const c=zn(s.shape,r);c.length>0&&(a=ee(wt(a,c),s.shape));const l=fn(s);return kn(Nt(a,Je(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_={kernelName:md,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,a]=e,c=a??Zt(1),l=zn(o.shape,r.shape),d=[];if(o.rank===1){for(let w=0;w<r.shape.length-1;++w)d.push(r.shape[w]);d.push(1)}const h=kt(r,o),p=q(n,c),f=$w(Pe(i,Zt(s))),m=q(q(q(f,f),f),Zt(-.5));return{x:()=>o.rank===1?ee(q(q(n,fr(ee(f,[1,1,1,o.shape[0]]),d)),c),r.shape):ee(q(q(n,f),c),r.shape),mean:()=>{let w=q(q(f,Zt(-1)),p);return o.rank===1&&(w=wt(w,l)),ee(w,o.shape)},variance:()=>{let w=q(q(m,h),p);return o.rank===1&&(w=wt(w,l)),ee(w,o.shape)},scale:()=>{const w=q(h,f);let S=q(n,w);return o.rank===1&&(S=wt(S,l)),ee(S,o.shape)},offset:()=>{let w=n;return o.rank===1&&(w=wt(w,l)),ee(w,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c_={kernelName:gd,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:i}=t,a=Bt(o,s.shape)[0],c=(l,d,h)=>()=>{const p=l.shape,f=d.size,m=p.slice(0,a),g=m.length,x=p.slice(o,p.length).slice(1),y=x.length,b=hx(0,g),v=hx(g+1,g+1+y),w=px([m,[f],x]),S=ee(h,w),N=ee(d,[f]),C=px([[g],b,v]),k=Ht(S,C);let I=Mw(k,N,l.shape[a]);const $=jo(C);return I=Ht(I,$),I};if(i===1){const l=s.shape[0],d=s.split(l,0);return{x:()=>to(d.map((f,m)=>c(f,r.slice(m,1),n.slice(m,1))())).reshape(s.shape),indices:()=>r}}else return{x:c(s,r,n),indices:()=>r}}};function hx(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function px(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l_={kernelName:Mc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>qt(t),b:()=>qt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_={kernelName:Fc,gradFunc:n=>({x:()=>Je(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_={kernelName:Oc,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_={kernelName:Lc,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_={kernelName:zc,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f_={kernelName:yd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=zs(s,0);return{x:()=>ls(o,n,q(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_={kernelName:Bc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,Pe(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g_={kernelName:Wc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,Je(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_={kernelName:Mk,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=Vr(s);return kt(n,q(wt(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y_(n,e,t,s=5,r=1,o=1,i=.5){const a={x:n,y:e,dy:t},c={depthRadius:s,bias:r,alpha:o,beta:i};return Q.runKernel(zf,a,c)}const b_=ne({localResponseNormalizationBackprop_:y_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w_={kernelName:Nd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:c}=t;return{x:()=>b_(s,r,n,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tv(n,e,t,s){return e.rank<t.rank&&(e=ee(e,_n(e.shape,s))),n.rank<t.rank&&(n=ee(n,_n(n.shape,s))),{x:()=>q(n,Je(Br(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fx={kernelName:Id,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],a=Bt(r,o.shape),c=Tv(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v_={kernelName:Vc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>q(n,Je(Ni(t,s),"float32")),b:()=>q(n,Je(fu(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_(n,e,t,s,r,o,i){const a=W(n,"dy","maxPool3dGrad"),c=W(e,"input","maxPool3dGrad"),l=W(t,"output","maxPool3dGrad");let d=a,h=c,p=l,f=!1;c.rank===4&&(f=!0,d=ee(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),h=ee(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),p=ee(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),E(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),E(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),E(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),ws("maxPool3dGrad",o,i);const m={dy:d,input:h,output:p},g={filterSize:s,strides:r,pad:o,dimRoundingMode:i},x=Q.runKernel(Bf,m,g);return f?ee(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const C_=ne({maxPool3dGrad_:S_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N_={kernelName:$d,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=t;return{x:()=>C_(n,s,r,o,i,a,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_(n,e,t,s,r,o,i){const a=W(n,"dy","maxPoolGrad"),c=W(e,"input","maxPoolGrad"),l=W(t,"output","maxPoolGrad");E(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),E(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),E(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),ws("maxPoolGrad",o,i);const d={dy:a,input:c,output:l},h={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return Q.runKernel(Wf,d,h)}const k_=ne({maxPoolGrad_:I_});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $_={kernelName:kd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>k_(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_={kernelName:Td,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=Bt(r,s.shape),a=Hn(s.shape,o)[1],c=we(a);return{x:()=>{const d=s.shape.slice();o.forEach(f=>{d[f]=1});const h=ee(n,d);return Nt(q(h,Fo(s.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A_={kernelName:Ad,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,a=Bt(r,o.shape),c=Tv(n,i,o,a);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_={kernelName:Uc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>q(n,Je(Ca(t,s),"float32")),b:()=>q(n,Je(zs(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R_={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>hn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_={kernelName:Gc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=zn(t.shape,r);return a.length>0?ee(wt(n,a),t.shape):n},b:()=>{const a=q(n,kn(ih(Nt(t,s)))),c=zn(s.shape,r);return c.length>0?ee(wt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __={kernelName:Hc,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=q(n,Je(s,"float32")),c=zn(t.shape,r);return c.length>0?ee(wt(a,c),t.shape):a},b:()=>{const a=q(n,Je(t,"float32")),c=zn(s.shape,r);return c.length>0?ee(wt(a,c),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P_={kernelName:Rd,gradFunc:n=>({x:()=>kn(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j_={kernelName:Pd,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Un(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M_={kernelName:_d,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F_={kernelName:jd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return gi(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mx={kernelName:Md,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>hn(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O_={kernelName:qc,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,a=_t(o.shape,i.shape);return{a:()=>{const d=Je(i,"float32");let h=q(n,q(d,fi(o,kt(d,Zt(1)))));const p=zn(o.shape,a);return p.length>0&&(h=wt(h,p)),ee(h,o.shape)},b:()=>{const d=zs(o,0),h=ls(d,Ur(o),qt(o));let p=q(n,q(r,h));const f=zn(i.shape,a);return f.length>0&&(p=wt(p,f)),ee(p,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L_={kernelName:Fd,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=zs(t,0);return{x:()=>ls(r,n,q(n,s)),alpha:()=>{let o=ls(r,qt(n),q(n,t));const i=zn(s.shape,n.shape);return i.length>0&&(o=wt(o,i)),ee(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z_(n,e,t){const s=n.shape.slice();s[t]=1;const r=ee(e,s),o=Mp(n,t,!0,!1),i=Mp(n,t,!0,!0),a=q(o,i);return q(r,a)}function W_(n,e,t){const s=n.shape.length,r=s-t.length,o=Cn(t,s);let i=n;o!=null&&(i=Ht(n,o));const a=i.shape.slice(),l=a.splice(s-t.length,t.length).reduce((p,f)=>p*f,1);a.push(l);const d=i.reshape(a);let h=z_(d,e,r);if(h=h.reshape(i.shape),o!=null){const p=jo(o);h=Ht(h,p)}return h}const B_={kernelName:Od,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>W_(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V_={kernelName:Ac,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{const a=Nt(n,Je(s,"float32")),c=zn(t.shape,r);return c.length>0?ee(wt(a,c),t.shape):a},b:()=>{let a=q(n,Je(t,"float32"));const c=zn(s.shape,r);c.length>0&&(a=ee(wt(a,c),s.shape));const l=fn(s);return kn(Nt(a,Je(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_={kernelName:Kc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,kn(fn(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_={kernelName:Qc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=q(Ca(t,6),gl(t));return{x:()=>q(n,Je(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_={kernelName:Xc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,Je(gl(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_={kernelName:Ld,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ee(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K_={kernelName:Wd,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Q.runKernel(Xf,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X_={kernelName:zd,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Q.runKernel(Kf,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_={kernelName:Bd,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Bt(s,n.shape);return{x:()=>mi(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y_={kernelName:Yc,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J_={kernelName:Jc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>kn(Nt(n,q(fi(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z_={kernelName:Vd,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Je(qt(t),"float32"),t:()=>q(n,Je(t,n.dtype)),e:()=>q(n,Je(xm(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eP={kernelName:Zc,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=zs(t,Zt(0)),r=Zt(lh),o=Zt(uh),i=q(n,o),a=q(q(n,r),Vr(Je(t,"float32")));return ls(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tP={kernelName:sl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,q(t,kt(Zt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nP={kernelName:nl,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sP={kernelName:el,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(dm(Je(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP={kernelName:tl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(hw(Je(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={kernelName:Ud,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[a,c]=ah(s,r,o),l=[];for(let d=0;d<n.rank;d++)l.push([a[d],i[d]-a[d]-c[d]]);return{x:()=>wm(n,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iP={kernelName:Kd,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=q(n,s);return{logits:()=>kt(i,q(wt(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aP={kernelName:rl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,Sa(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gx={kernelName:Hd,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>lm(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xx={kernelName:qd,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>xs(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cP={kernelName:ol,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,q(es(Je(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lP={kernelName:Qf,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,q(Je(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uP={kernelName:il,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Zt(2);return{a:()=>q(n,q(r,kt(t,s))),b:()=>q(n,q(r,kt(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dP={kernelName:dl,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hP={kernelName:al,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=_t(t.shape,s.shape);return{a:()=>{let a=n;const c=zn(t.shape,r);return c.length>0&&(a=wt(a,c)),ee(a,t.shape)},b:()=>{let a=n;const c=zn(s.shape,r);return c.length>0&&(a=wt(a,c)),ee(kn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pP={kernelName:Gd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;Bt(o,s.shape).forEach(l=>{r[l]=1});const a=ee(n,r),c=q(a,Fo(s.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP={kernelName:cl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Nt(n,fn(dm(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mP={kernelName:ll,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(kt(Zt(1),fn(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gP={kernelName:ul,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=qt(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=Pe(i,hn(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)i=Pe(i,hn(n,[a*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)i=Pe(i,hn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let c=0;c<r[1];++c)for(let l=0;l<r[2];++l)for(let d=0;d<r[3];++d)i=Pe(i,hn(n,[a*s.shape[0],c*s.shape[1],l*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xP={kernelName:Qi,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=jo(r);return{x:()=>Ht(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yP={kernelName:Xd,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>to(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bP={kernelName:Qd,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>wP(n,t)}}};function wP(n,e){const t=Mo(e,qt(e)),s=fm(n,t);let r=Ni(e,Zt(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=fs(r,a+1);r=eo(r,Fo(s.shape,"bool"));const i=qt(s);return ls(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vP={kernelName:Yd,gradFunc:n=>({x:()=>qt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SP=[$v,bD,wD,vD,SD,CD,ND,ID,kD,$D,TD,AD,DD,jD,MD,FD,OD,LD,zD,WD,BD,VD,GD,UD,KD,XD,QD,YD,JD,ZD,V_,e_,t_,n_,s_,r_,i_,o_,a_,c_,l_,u_,d_,h_,p_,f_,m_,g_,x_,w_,fx,fx,v_,N_,$_,T_,A_,E_,R_,D_,__,P_,j_,M_,F_,mx,mx,O_,L_,B_,U_,G_,H_,q_,K_,X_,Q_,Y_,J_,Z_,eP,tP,nP,sP,rP,oP,iP,aP,gx,gx,xx,xx,cP,uP,lP,dP,hP,pP,fP,mP,gP,xP,yP,bP,vP];for(const n of SP)Lk(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.abs=function(){return this.throwIfDisposed(),os(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.acos=function(){return this.throwIfDisposed(),J$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.acosh=function(){return this.throwIfDisposed(),e2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.add=function(n){return this.throwIfDisposed(),Pe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.all=function(n,e){return this.throwIfDisposed(),cw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.any=function(n,e){return this.throwIfDisposed(),Pp(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.argMax=function(n){return this.throwIfDisposed(),tc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.argMin=function(n){return this.throwIfDisposed(),o2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.asScalar=function(){return this.throwIfDisposed(),E(this.size===1,()=>"The array must have only 1 element."),ee(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.asType=function(n){return this.throwIfDisposed(),Je(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.as1D=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.as2D=function(n,e){return this.throwIfDisposed(),ee(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ee(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),ee(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),ee(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.asin=function(){return this.throwIfDisposed(),a2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.asinh=function(){return this.throwIfDisposed(),l2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.atan=function(){return this.throwIfDisposed(),d2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.atan2=function(n){return this.throwIfDisposed(),p2(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.atanh=function(){return this.throwIfDisposed(),m2(this)};be().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),cm(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),lm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),nh(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Ja(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.cast=function(n){return this.throwIfDisposed(),Je(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.ceil=function(){return this.throwIfDisposed(),B2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Ls(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof jn&&(n=[n]),xs([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),lw(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),uw(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),pi(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.cos=function(){return this.throwIfDisposed(),dm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.cosh=function(){return this.throwIfDisposed(),hw(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Mp(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),pw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),pT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),hm(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),gT(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.divNoNan=function(n){return this.throwIfDisposed(),vT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.div=function(n){return this.throwIfDisposed(),Nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.dot=function(n){return this.throwIfDisposed(),CT(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.elu=function(){return this.throwIfDisposed(),rh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.equal=function(n){return this.throwIfDisposed(),Br(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.erf=function(){return this.throwIfDisposed(),fw(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),jT(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.exp=function(){return this.throwIfDisposed(),Vr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.expandDims=function(n){return this.throwIfDisposed(),fs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.expm1=function(){return this.throwIfDisposed(),LT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.fft=function(){return this.throwIfDisposed(),_w(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.flatten=function(){return this.throwIfDisposed(),ee(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.floor=function(){return this.throwIfDisposed(),ih(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.floorDiv=function(n){return this.throwIfDisposed(),aw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.gather=function(n,e,t){return this.throwIfDisposed(),fm(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Ni(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.greater=function(n){return this.throwIfDisposed(),zs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.ifft=function(){return this.throwIfDisposed(),Fp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.irfft=function(){return this.throwIfDisposed(),EE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.isFinite=function(){return this.throwIfDisposed(),KT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.isInf=function(){return this.throwIfDisposed(),QT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.isNaN=function(){return this.throwIfDisposed(),JT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.leakyRelu=function(n){return this.throwIfDisposed(),gm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.lessEqual=function(n){return this.throwIfDisposed(),Ca(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.less=function(n){return this.throwIfDisposed(),fu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),sA(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logSigmoid=function(){return this.throwIfDisposed(),uA(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logSoftmax=function(n){return this.throwIfDisposed(),bw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),ww(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.log=function(){return this.throwIfDisposed(),Ur(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.log1p=function(){return this.throwIfDisposed(),yw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logicalAnd=function(n){return this.throwIfDisposed(),eo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logicalNot=function(){return this.throwIfDisposed(),xm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logicalOr=function(n){return this.throwIfDisposed(),vw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.logicalXor=function(n){return this.throwIfDisposed(),yA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Jt(this,n,e,t)};be().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),ym(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.max=function(n,e){return this.throwIfDisposed(),gr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.maximum=function(n){return this.throwIfDisposed(),Mo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.mean=function(n,e){return this.throwIfDisposed(),Dn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.min=function(n,e){return this.throwIfDisposed(),pu(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.minimum=function(n){return this.throwIfDisposed(),rc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),kA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.mod=function(n){return this.throwIfDisposed(),TA(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.mul=function(n){return this.throwIfDisposed(),q(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.neg=function(){return this.throwIfDisposed(),kn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.norm=function(n,e,t){return this.throwIfDisposed(),oh(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.notEqual=function(n){return this.throwIfDisposed(),mu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),Sw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.onesLike=function(){return this.throwIfDisposed(),er(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.pad=function(n,e){return this.throwIfDisposed(),wm(this,n,e)};be().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),OA(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.pow=function(n){return this.throwIfDisposed(),fi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.prelu=function(n){return this.throwIfDisposed(),Sm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.prod=function(n,e){return this.throwIfDisposed(),WA(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.reciprocal=function(){return this.throwIfDisposed(),uE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.relu=function(){return this.throwIfDisposed(),ki(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.relu6=function(){return this.throwIfDisposed(),Iw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ee(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.reshape=function(n){return this.throwIfDisposed(),ee(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),Ow(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),Lw(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.reverse=function(n){return this.throwIfDisposed(),mi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.rfft=function(){return this.throwIfDisposed(),_E(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.round=function(){return this.throwIfDisposed(),kw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.rsqrt=function(){return this.throwIfDisposed(),$w(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.selu=function(){return this.throwIfDisposed(),Tw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Aw(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sigmoid=function(){return this.throwIfDisposed(),Sa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sign=function(){return this.throwIfDisposed(),bE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sin=function(){return this.throwIfDisposed(),Ew(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sinh=function(){return this.throwIfDisposed(),Rw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.slice=function(n,e){return this.throwIfDisposed(),hn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.softmax=function(n){return this.throwIfDisposed(),Dm(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.softplus=function(){return this.throwIfDisposed(),pl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),vm(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.split=function(n,e){return this.throwIfDisposed(),Os(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sqrt=function(){return this.throwIfDisposed(),es(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.square=function(){return this.throwIfDisposed(),fn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.squaredDifference=function(n){return this.throwIfDisposed(),jE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.squeeze=function(n){return this.throwIfDisposed(),ml(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof jn?[this,n]:[this,...n];return to(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.step=function(n){return this.throwIfDisposed(),gl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.stridedSlice=function(n,e,t,s,r,o,i,a){return this.throwIfDisposed(),zE(this,n,e,t,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sub=function(n){return this.throwIfDisposed(),kt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.sum=function(n,e){return this.throwIfDisposed(),wt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.tan=function(){return this.throwIfDisposed(),BE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.tanh=function(){return this.throwIfDisposed(),th(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.tile=function(n){return this.throwIfDisposed(),fr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.toBool=function(){return this.throwIfDisposed(),Je(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.toFloat=function(){return this.throwIfDisposed(),Je(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.toInt=function(){return this.throwIfDisposed(),Je(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.topk=function(n,e){return this.throwIfDisposed(),GE(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.transpose=function(n){return this.throwIfDisposed(),Ht(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.unique=function(n){return this.throwIfDisposed(),KE(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),Mw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.unstack=function(n){return this.throwIfDisposed(),gi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.where=function(n,e){return this.throwIfDisposed(),ls(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */be().prototype.zerosLike=function(){return this.throwIfDisposed(),qt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ar extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ar.prototype)}}class Ys extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ys.prototype)}}class H extends Error{constructor(e){super(e),Object.setPrototypeOf(this,H.prototype)}}class Ot extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ot.prototype)}}class mg extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mg.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Av{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xi(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Er(n,e){if(!n)throw new mg(e)}function yx(n,e){let t=0;for(const s of n)s===e&&t++;return t}function ms(n){return n.length===1?n[0]:n}function rn(n){return Array.isArray(n)?n:[n]}function Xr(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ko(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Vs={};function gg(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function zp(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>zp(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:zp(s))}}}function wl(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in Vs)i=Vs[o];else if(i=e[o],i==null)throw new H(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new H(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,c;if(i in t?[a,c]=t[i]:i in Vs?[a,c]=Vs.className:i in e&&([a,c]=e[i]),a==null)throw new H(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const l={};for(const f of Object.keys(Vs))l[f]=Vs[f];for(const f of Object.keys(t))l[f]=t[f];const d=o.config;d.customObjects=l;const h=Object.assign({},Vs);for(const f of Object.keys(t))Vs[f]=t[f];zp(o.config);const p=c(a,o.config,t,r);return Vs=Object.assign({},h),p}else{const l=Object.assign({},Vs);for(const h of Object.keys(t))Vs[h]=t[h];const d=new a(o.config);return Vs=Object.assign({},l),d}}}function CP(n,e){return n<e?-1:n>e?1:0}function Ol(n,e){return-1*CP(n,e)}function vo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function NP(n){if(n==null)throw new H(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Ti(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new H(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function xg(n,e,t=0,s=1/0){return Er(t>=0),Er(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function Gn(n,e){Array.isArray(n)?(E(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>Gn(t,`element ${s+1} of ${e}`))):E(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${Ev(n)}.`)}function Ev(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>Ev(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function IP(n,e,t){let s=t!=null?t():ps(),r;return(...i)=>{const a=t!=null?t():ps();return a-s<e||(s=a,r=n(...i)),r}}function Rv(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let kP=0;function Dv(){return kP++}const Ll={};function dh(n=""){return n in Ll||(Ll[n]=0),Ll[n]+=1,n+Ll[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $P=["channelsFirst","channelsLast"],TP=["nearest","bilinear"],AP=["valid","same","causal"],EP=["max","avg"],RP=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Oi=new Map;function An(n){Ti($P,"DataFormat",n)}function DP(n){Ti(TP,"InterpolationFormat",n)}function Ws(n){Ti(AP,"PaddingMode",n)}function _v(n){Ti(EP,"PoolMode",n)}const Za=[],bx="/";function ni(n,e){Za.push(n);try{const t=e();return Za.pop(),t}catch(t){throw Za.pop(),t}}function _P(){return Za.length===0?"":Za.join(bx)+bx}function Pv(n){if(!Mv(n))throw new Error("Not a valid tensor name: '"+n+"'");return _P()+n}function jv(n){if(!Mv(n))throw new Error("Not a valid tensor name: '"+n+"'");Oi.has(n)||Oi.set(n,0);const e=Oi.get(n);if(Oi.set(n,Oi.get(n)+1),e>0){const t=`${n}_${e}`;return Oi.set(t,1),t}else return n}const PP=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Mv(n){return!!n.match(PP)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jP(n){return n===parseInt(n.toString(),10)}function So(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function ua(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function ko(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function yr(n,e){if(e<n)throw new H(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Xh;function Mn(){return Xh==null&&(Xh=d$().epsilon()),Xh}function br(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Or(n,e){return Je(n,e)}function vl(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ee(n,t)}function MP(n,e){return ce(()=>{if(n.shape.length!==2)throw new H(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=vl(n,1);return Wp(t,[1,e,1])})}function FP(n){const e=[So(n.shape)];return ee(n,e)}function OP(n){if(n.rank<=1)throw new H(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],So(n.shape,1)];return ee(n,e)}function si(n,e,t){return ce(()=>{switch(n.rank){case 1:return Em(n,e,t);case 2:return Dw(n,[e,0],[t,n.shape[1]]);case 3:return Rm(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return xu(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return hn(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return hn(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new H(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Qh(n,e,t){return ce(()=>{switch(n.rank){case 1:return Em(n,e,t);case 2:return Dw(n,[0,e],[n.shape[0],t]);case 3:return Rm(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return xu(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function zl(n,e,t,s){return ce(()=>{switch(n.rank){case 1:return Em(n,e,t);case 2:switch(s){case 1:return si(n,e,t);case 2:return Qh(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return si(n,e,t);case 2:return Rm(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Qh(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return si(n,e,t);case 2:return xu(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return xu(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Qh(n,e,t);default:throw new H(`The axis is not within the rank of the tensor ${s}`)}default:throw new H(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function yg(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),xs(n,e)}function wx(n,e){switch(n.rank){case 1:return G2([n,e]);case 2:return q2([n,e],0);case 3:return X2([n,e],0);case 4:return Y2([n,e],0);default:throw new H(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Wp(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new H(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return fr(n,e)}function hh(n,e=0,t=1,s,r){return iE(n,e,t,s,r)}function Lr(n,e,t,s){if(n.rank<2||e.rank<2)throw new Ot(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new Ot(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return rx({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Bp(n.rank,s,br()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=ee(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),c=i.pop(),l=[...i,a],d=Array.from({length:e.rank},(m,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=ee(Ht(e,d),[c,-1]);const h=[...r,...l];return ee(rx({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Bp(n.rank,s,br()):null,activation:t}),h)}}function Fv(n,e,t){return ce(()=>(Array.isArray(e)?e=Es(e,"int32"):e=Je(e,"int32"),fm(n,e,t)))}function Sl(n){return q(n,n)}function Bp(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new H(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?ee(e,[1,s[0],1,1,1]):ee(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?ee(e,[1,1,1,1,s[0]]):ee(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?ee(e,[1,s[0],1,1]):ee(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?ee(e,[1,1,1,s[0]]):ee(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?ee(e,[1,s[0],1]):ee(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?ee(e,[1,1,s[0]]):ee(e,[1].concat(s))}else if(n<3)return e;throw new H(`Unsupported input rank by biasAdd: ${e.rank}`)}function Sr(n,e,t){return ce(()=>(t==null&&(t=br()),An(t),Pe(n,Bp(n.rank,e,t))))}function LP(n,e=1){if(e!==1)throw new Ot(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return rh(n)}function zP(n){return ce(()=>Nt(n,Pe(os(n),1)))}function Ov(n,e,t,s){return ce(()=>tR(n,e,t,s))}function WP(n){return ce(()=>{const e=Pe(.5,q(.2,n));return Ls(e,0,1)})}function Cl(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const BP=["fanIn","fanOut","fanAvg"],VP=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UP(n){Ti(BP,"FanMode",n)}function GP(n){Ti(VP,"Distribution",n)}class nr extends Ia{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class Lv extends nr{apply(e,t){return Un(e,t)}}Lv.className="Zeros";Re(Lv);class bg extends nr{apply(e,t){return Fo(e,t)}}bg.className="Ones";Re(bg);class zv extends nr{constructor(e){if(super(),typeof e!="object")throw new H(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new H(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ce(()=>q(Zt(this.value),Fo(e,t)))}getConfig(){return{value:this.value}}}zv.className="Constant";Re(zv);class Wv extends nr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return fl(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}Wv.className="RandomUniform";Re(Wv);class Bv extends nr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`randomNormal does not support dType ${t}.`);return hh(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Bv.className="RandomNormal";Re(Bv);class Vv extends nr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`truncatedNormal does not support dType ${t}.`);return jw(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Vv.className="TruncatedNormal";Re(Vv);class Uv extends nr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ce(()=>{if(e.length!==2||e[0]!==e[1])throw new H("Identity matrix initializer can only be used for 2D square matrices.");return q(this.gain,xw(e[0]))})}getConfig(){return{gain:this.gain}}}Uv.className="Identity";Re(Uv);function HP(n,e="channelsLast"){let t,s;if(An(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=So(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=So(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=So(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class Ds extends nr{constructor(e){if(super(),e.scale<0)throw new H(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,UP(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,GP(this.distribution),this.seed=e.seed}apply(e,t){const s=HP(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ot(`${this.getClassName()} does not support dType ${t}.`);return jw(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return fl(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ds.className="VarianceScaling";Re(Ds);class wg extends Ds{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}wg.className="GlorotUniform";Re(wg);class vg extends Ds{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}vg.className="GlorotNormal";Re(vg);class Sg extends Ds{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Sg.className="HeNormal";Re(Sg);class Cg extends Ds{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Cg.className="HeUniform";Re(Cg);class Ng extends Ds{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Ng.className="LeCunNormal";Re(Ng);class Ig extends Ds{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ds.className}}Ig.className="LeCunUniform";Re(Ig);class Gv extends nr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ce(()=>{if(e.length<2)throw new Ot("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=we(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=hh(i,0,1,t,this.seed),c=YR.qr(a,!1);let l=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return l=q(l,h.sign()),s<r&&(l=l.transpose()),q(Zt(this.gain),l.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}Gv.className="Orthogonal";Re(Gv);const vx={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Sx(n,e={}){return wl(n,qs.getMap().classNameMap,e,"initializer")}function Sn(n){return gg(n)}function yn(n){if(typeof n=="string"){const e=n in vx?vx[n]:n;if(e==="GlorotNormal")return new vg;if(e==="GlorotUniform")return new wg;if(e==="HeNormal")return new Sg;if(e==="HeUniform")return new Cg;if(e==="LeCunNormal")return new Ng;if(e==="LeCunUniform")return new Ig;{const t={};return t.className=e,t.config={},Sx(t)}}else return n instanceof nr?n:Sx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vp(n){return Array.isArray(n)&&Array.isArray(n[0])}function yu(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Tt(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new H(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Qt(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new H(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bu(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Cx="Variable";class qP{constructor(e,t="float32",s=Cx,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=Dv(),s=s??Cx,this.originalName=Pv(s),this.name=jv(this.originalName),this.trainable_=r,this.constraint=o,this.val=YE(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),KP(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function KP(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Up(n){return n.map(e=>e.read())}function kg(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Fn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Gr{constructor(e,t,s,r,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=Dv(),i!=null&&(this.originalName=Pv(i),this.name=jv(this.originalName)),this.rank=t.length}}let XP=0;class ph{constructor(e,t){this.callArgs=t,this.id=XP++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let QP=0;class Vt extends Ia{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=QP++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=Xr(s)+"_"+dh(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ys(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new H(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return ms(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ms(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ar(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ar(`Layer ${this.name} is not connected, no input to return.`);return ms(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ar(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ar(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return ms(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=rn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=rn(this.inputSpec);if(t.length!==s.length)throw new H(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new H(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const c=o.shape;for(const l in i.axes){const d=Number(l),h=i.axes[l],p=d>=0?c[d]:c[c.length+d];if(h!=null&&[h,null].indexOf(p)===-1)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${h} but got shape ${c}.`)}}if(i.shape!=null)for(let c=0;c<i.shape.length;++c){const l=i.shape[c],d=o.shape[c];if(l!=null&&d!=null&&l!==d)throw new H(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=rn(e),r=ZP(e),o=ej(e);if(r===o)throw new H("Arguments to apply() must be all SymbolicTensors or all Tensors");return ni(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of rn(e))i.push(a.shape);this.build(ms(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=rn(i),c=[];for(let l of a)s.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(i=ms(c),this.activityRegularizer!=null)throw new Ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=YP(e),a=this.computeOutputShape(i);let c;const l=JP(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((d,h)=>new Gr(l,d,this,rn(e),t,this.name,h)):c=new Gr(l,a,this,rn(e),t,this.name),this.addInboundNode(e,c,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new Ot("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ar(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Ar(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ys(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return bu(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Up(e?this.trainableWeights:this.weights)}setWeights(e){ce(()=>{const t=this.weights;if(t.length!==e.length)throw new H(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Up(t);for(let o=0;o<r.length;++o){const i=r[o],a=t[o],c=e[o];if(!en(i.shape,c.shape))throw new H(`Layer weight shape ${i.shape} not compatible with provided weight shape ${c.shape}`);s.push([a,c])}kg(s)})}addWeight(e,t,s,r,o,i,a,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new H(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():yn("zeros"));const l=r.apply(t,s),d=new qP(l,s,e,i,a);return l.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=rn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=rn(t),i=rn(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,s,r,o,i,a=null){const c=rn(e);t=rn(t),s=rn(s),r=rn(r),o=yu(o),i=yu(i);const l=[],d=[],h=[];for(const p of c)l.push(p.sourceLayer),d.push(p.nodeIndex),h.push(p.tensorIndex);new ph({outboundLayer:this,inboundLayers:l,nodeIndices:d,tensorIndices:h,inputTensors:c,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function YP(n){n=rn(n);const e=[];for(const t of n)e.push(t.shape);return ms(e)}function JP(n){return"float32"}function Hv(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],c=s.nodeIndices[o],l=Hv(i,a,c);for(const d of l)r.indexOf(d)===-1&&r.push(d)}return r}}}function ZP(n){let e=!0;for(const t of rn(n))if(!(t instanceof Gr)){e=!1;break}return e}function ej(n){let e=!0;for(const t of rn(n))if(t instanceof Gr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Nl extends Vt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:dh("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new H("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new H("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new H("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Gr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new ph({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new H(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Nl.className="InputLayer";Re(Nl);function tj(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new H("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new Nl({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nj(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Je(e,n.dtype)}catch{throw new H(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class xo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof xo)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=nj(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new H(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Gr){if(this.id2Value[e.id]==null)throw new H(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new H(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Gr){if(this.id2Value[e.id]==null)throw new H(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new H(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Lt(this.id2Mask)}}const wu=new Av,vu=new Av;function sj(n){wu!=null&&wu.setMaxEntries(n),vu!=null&&vu.setMaxEntries(n)}function Ua(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(m=>m.name),c=[],l=e.names();for(const m of a)l.indexOf(m)!==-1?c.push(e.getValue(m)):c.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let h=wu.get(d),p;if(h==null){const m=rj(i,e);h=m.sorted,p=m.recipientCounts,wu.put(d,h),vu.put(d,p)}p={},r||Object.assign(p,vu.get(d));const f=new xo(e);for(let m=0;m<h.length;++m){const g=h[m],x=g.sourceLayer;if(x instanceof Nl)continue;const y=[],b=[],v=[];let w=!1;for(const I of g.inputs){const $=f.getValue(I),j=f.getMask(I);y.push($),b.push(j),j!=null&&(w=!0),r||(p[I.name]--,p[I.name]===0&&!e.hasKey(I)&&a.indexOf(I.name)===-1&&!$.isDisposed&&I.sourceLayer.stateful!==!0&&v.push($))}w&&(t=t||{},t.mask=b[0]);const S=rn(x.apply(y,t));let N=null;x.supportsMasking&&(N=x.computeMask(y,b));const C=ij(g),k=Array.isArray(C)?C:[C];for(let I=0;I<k.length;++I){f.hasKey(k[I])||f.add(k[I],S[I],Array.isArray(N)?N[0]:N);const $=a.indexOf(k[I].name);$!==-1&&(c[$]=S[I])}r||Lt(v)}return f.disposeMasks(),o?c:c[0]}function rj(n,e){E(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=Nx(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=Nx(o,e);for(const c of i)r.has(c.name)||(t.push(c),r.add(c.name));for(const c in a)s[c]==null&&(s[c]=new Set),a[c].forEach(l=>s[c].add(l))}}return{sorted:t,recipientCounts:oj(s)}}function oj(n){const e={};for(const t in n)e[t]=n[t].size;return e}function Nx(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const c=i[i.length-1]===o.length-1;if(a.inputs.length===0||c)o.pop(),s.push(a),t.add(a.name),c&&i.pop();else{i.push(o.length-1);for(const l of a.inputs)r[l.name]==null&&(r[l.name]=new Set),r[l.name].add(a.name),!t.has(l.name)&&o.push(l)}}return{sorted:s,recipientMap:r}}function ij(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aj=fe();aj.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,sj);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $g(n,e){return ce(()=>es(wt(q(n,n),e,!0)))}class Il extends Ia{getConfig(){return{}}}class qv extends Il{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ce(()=>{const t=$g(e,this.axis),s=Ls(t,0,this.maxValue);return q(e,Nt(s,Pe(Mn(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}qv.className="MaxNorm";Re(qv);class Kv extends Il{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ce(()=>Nt(e,Pe(Mn(),$g(e,this.axis))))}getConfig(){return{axis:this.axis}}}Kv.className="UnitNorm";Re(Kv);class Xv extends Il{apply(e){return ki(e)}}Xv.className="NonNeg";Re(Xv);class Qv extends Il{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ce(()=>{const t=$g(e,this.axis),s=Pe(q(this.rate,Ls(t,this.minValue,this.maxValue)),q(1-this.rate,t));return q(e,Nt(s,Pe(Mn(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}Qv.className="MinMaxNorm";Re(Qv);const Ix={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function On(n){return gg(n)}function kx(n,e={}){return wl(n,qs.getMap().classNameMap,e,"constraint")}function Ln(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in Ix?Ix[n]:n,config:{}};return kx(t)}else return n instanceof Il?n:kx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Vo(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Lt(s)}}function Yv(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var $x;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})($x||($x={}));const cj=125;class ic{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class lj{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class uj extends ic{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=ce(()=>Pe(this.totals[r],q(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:ce(()=>{const r=q(Nt(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Mr(t[s])}))}}class dj extends ic{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const c=i[a];e.push(c.data()),t.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class hj extends ic{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||nv,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=cj),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");yp(this.yieldEvery)&&(this.maybeWait=IP(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Vo(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Vo(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Vo(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Vo(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Vo(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):yp(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Vo(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Vo(e),await this.trainEnd(e))}}function Jv(n,e){return n==null&&(n={}),n instanceof ic?[n]:Array.isArray(n)&&n[0]instanceof ic?n:rn(n).map(s=>new hj(s,e))}class Hs{constructor(){}static registerCallbackConstructor(e,t){E(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Hs.checkForDuplicate(t),Hs.constructors[e]==null&&(Hs.constructors[e]=[]),Hs.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Hs.constructors)Hs.constructors[+t].forEach(r=>{if(r===e)throw new H("Duplicate callback constructor.")})}static clear(){Hs.constructors={}}static createCallbacks(e){const t=[];for(const s in Hs.constructors){const r=+s;e>=r&&t.push(...Hs.constructors[r])}return t.map(s=>new s)}}Hs.constructors={};function Zv(n,e,t,s,r,o,i,a,c){const l=new dj,d=[new uj,...Hs.createCallbacks(e)];n!=null&&d.push(...n),d.push(l);const h=new lj(d);return h.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:c}),{callbackList:h,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zr(n,e={},t=!1){return wl(n,qs.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Su(n,e){return ce(()=>{n.dtype!=="float32"&&(n=Je(n,"float32"));const t=wt(Sl(n),e,!0),s=sh(t.shape,Mn()),r=es(Mo(t,s));return Nt(n,r)})}function fh(n,e){return ce(()=>Dn(Sl(kt(e,n)),-1))}function Tg(n,e){return ce(()=>Dn(os(kt(e,n)),-1))}function Ag(n,e){return ce(()=>{const t=kt(n,e),s=Ls(os(n),Mn(),Number.MAX_VALUE),r=os(Nt(t,s));return q(100,Dn(r,-1))})}function pj(n,e){return ce(()=>{const t=Ls(e,Mn(),Number.MAX_VALUE),s=Ur(Pe(1,t)),r=Ls(n,Mn(),Number.MAX_VALUE),o=Ur(Pe(1,r));return Dn(Sl(kt(s,o)),-1)})}function fj(n,e){return ce(()=>{const t=Mo(0,kt(1,q(n,e)));return Dn(Sl(t),-1)})}function mj(n,e){return ce(()=>{const t=Mo(0,kt(1,q(n,e)));return Dn(t,-1)})}function gj(n,e){return ce(()=>{const t=wt(q(n,e),-1),s=gr(q(kt(1,n),e),-1);return Mo(0,Pe(1,kt(s,t)))})}function xj(n,e){return ce(()=>{const t=Math.log(2),s=kt(e,n),r=kt(Pe(s,pl(q(-2,s))),t);return Dn(r,-1)})}function ac(n,e,t=!1){return ce(()=>{if(t)e=Dm(e);else{const s=wt(e,e.shape.length-1,!0);e=Nt(e,s)}return e=Ls(e,Mn(),1-Mn()),kn(wt(q(Je(n,"float32"),Ur(e)),e.shape.length-1))})}function Cu(n,e,t=!1){return ce(()=>{const s=Je(ih(FP(n)),"int32");e=Ls(e,Mn(),1-Mn());const r=e.shape,o=ee(Sw(s,r[r.length-1]),r);return ac(o,e,t)})}function yj(n,e){if(!en(n.shape,e.shape))throw new H(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return ce(()=>{const t=ki(e),s=kn(os(e));return Pe(kt(t,q(e,n)),yw(Vr(s)))})}function mh(n,e){return ce(()=>{let t;return t=Ls(e,Mn(),1-Mn()),t=Ur(Nt(t,kt(1,t))),Dn(yj(n,t),-1)})}function bj(n,e){return ce(()=>{const t=Ls(n,Mn(),1),s=Ls(e,Mn(),1);return wt(q(n,Ur(Nt(t,s))),-1)})}function wj(n,e){return ce(()=>{const t=Ur(Pe(Mn(),e));return Dn(kt(e,q(n,t)),-1)})}function e1(n,e){return ce(()=>{const t=Su(n,-1),s=Su(e,-1),r=q(t,s);return kn(wt(r,-1))})}const Nu={meanSquaredError:fh,meanAbsoluteError:Tg,meanAbsolutePercentageError:Ag,meanSquaredLogarithmicError:pj,squaredHinge:fj,hinge:mj,categoricalHinge:gj,logcosh:xj,categoricalCrossentropy:ac,sparseCategoricalCrossentropy:Cu,binaryCrossentropy:mh,kullbackLeiblerDivergence:bj,poisson:wj,cosineProximity:e1};function Yh(n){if(typeof n=="string"){if(n in Nu)return Nu[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new H(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function t1(n,e){return ce(()=>{const t=q(.5,er(e)),s=Or(zs(e,t),n.dtype);return Dn(Br(n,s),-1)})}function n1(n,e){return ce(()=>Or(Br(tc(n,-1),tc(e,-1)),"float32"))}function vj(n,e){return ce(()=>Je(wt(eo(Br(n,1),Br(e,1))),"float32"))}function Sj(n,e){return ce(()=>Je(wt(eo(Br(n,0),Br(e,1))),"float32"))}function Cj(n,e){return ce(()=>{const t=vj(n,e),s=Sj(n,e),r=Pe(t,s);return Je(ls(zs(r,0),Nt(t,r),0),"float32")})}function Nj(n,e){return mh(n,e)}function Ij(n,e){return n.rank===e.rank&&(n=ml(n,[n.rank-1])),e=tc(e,-1),e.dtype!==n.dtype&&(e=Je(e,n.dtype)),Je(Br(n,e),"float32")}const kj=fh,$j=fh,Tj=Tg,Aj=Tg,Ej=Ag,Rj=Ag,s1=ac,Dj=e1,r1=Cu,Iu={binaryAccuracy:t1,categoricalAccuracy:n1,precision:Cj,categoricalCrossentropy:s1,sparseCategoricalCrossentropy:r1,mse:kj,MSE:$j,mae:Tj,MAE:Aj,mape:Ej,MAPE:Rj,cosine:Dj};function _j(n){if(typeof n=="string"&&n in Iu)return Iu[n];if(typeof n!="string"&&n!=null)return n;throw new H(`Unknown metric ${n}`)}function Wl(n){if(Er(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Nu))if(Nu[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Iu))if(Iu[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pj(n){const e={Adagrad:()=>Ho.adagrad(.01),Adadelta:()=>Ho.adadelta(1,.95,Mn()),Adam:()=>Ho.adam(.001,.9,.999,Mn()),Adamax:()=>Ho.adamax(.002,.9,.999,Mn(),0),RMSProp:()=>Ho.rmsprop(.001,.9,0,Mn()),SGD:()=>Ho.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new H(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Tx=1*1024*1024;function Ax(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Gp(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>Tx&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Tx}.`)}}function Gp(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Gp(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Gp(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jj(n,e,t,s=console.log){const r=Fj(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),ku(o,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?Oj(a[d],t,s):Lj(a[d],t,i,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const c=Mj(n),l=bu(n.nonTrainableWeights);s(`Total params: ${c+l}`),s(`Trainable params: ${c}`),s(`Non-trainable params: ${l}`),s("_".repeat(e))}function Mj(n){let e;return n.collectedTrainableWeights!=null?e=bu(n.collectedTrainableWeights):e=bu(n.trainableWeights),e}function Fj(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function ku(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function Oj(n,e,t){let s,r;try{r=n.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];ku(a,e,t)}function Lj(n,e,t,s){let r,o;try{o=n.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const h of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(h)===-1))for(let p=0;p<h.inboundLayers.length;++p){const f=h.inboundLayers[p].name,m=h.nodeIndices[p],g=h.tensorIndices[p];i.push(`${f}[${m}][${g}]`)}const a=n.name,c=n.getClassName(),l=i.length===0?"":i[0],d=[`${a} (${c})`,o,r,n.countParams().toString(),l];ku(d,e,s);for(let h=1;h<i.length;++h)ku(["","","","",i[h]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function o1(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function $u(n,e){if(n===null)return null;if(typeof n=="string")return Ko(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];o1(e,r,o)?t.push(o):t.push($u(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=Ko(s);t[o]=$u(r,o)}}return t}}function Hp(n,e){if(n==null)return null;if(typeof n=="string")return Xr(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];o1(e,r,o)?t.push(o):t.push(Hp(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=Xr(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=Hp(r,s)}return t}}/** @license See the LICENSE file. */const i1="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zj=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class lr extends Vt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=dh(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],vo(this.inputs).length!==this.inputs.length)throw new H(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);vo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const v=b.sourceLayer,w=b.nodeIndex,S=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(S)}for(const b of this.inputs){const v=b.sourceLayer,w=b.nodeIndex,S=b.tensorIndex;Er(w===0,"input layer has >1 nodes"),Er(S===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const v=this.inputLayers[b];if(!(v instanceof Nl))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const t={},s={},r={},o={},i={},a=[],c=(b,v,w,S,N,C)=>{(S==null||N==null||C==null)&&(S=b.sourceLayer,N=b.nodeIndex,C=b.tensorIndex);const k=S.inboundNodes[N];if(w.indexOf(k)!==-1)throw new Ys(`The tensor ${b.name} at layer "${S.name}" is part of a cycle.`);if(v.indexOf(k)!==-1)return;this.containerNodes.add(lr.nodeKey(S,N)),S.id in i||(i[S.id]=Object.keys(i).length),w.indexOf(k)===-1&&w.push(k);const I=k.inboundLayers.length;for(let $=0;$<I;$++){const j=k.inputTensors[$],P=k.inboundLayers[$],O=k.nodeIndices[$],A=k.tensorIndices[$];c(j,v,w,P,O,A)}for(v.push(k);w.indexOf(k)>=0;)w.splice(w.indexOf(k),1);a.push(k)},l=[],d=[];for(const b of this.outputs)c(b,l,d);const h=a.slice().reverse();for(const b of h){s[b.id]=b,b.id in t||(t[b.id]=0);let v=t[b.id];const w=r[b.outboundLayer.id]==null?0:r[b.outboundLayer.id];v=Math.max(v,w),r[b.outboundLayer.id]=v,o[b.outboundLayer.id]=b.outboundLayer,t[b.id]=v;for(let S=0;S<b.inboundLayers.length;S++){const N=b.inboundLayers[S],C=b.nodeIndices[S],k=N.inboundNodes[C],I=t[k.id]==null?0:t[k.id];t[k.id]=Math.max(v+1,I),s[k.id]=k}}const p={};for(const b in t){const v=t[b];v in p||(p[v]=[]),p[v].push(s[b])}const f={};for(const b in r){const v=r[b];v in f||(f[v]=[]),f[v].push(o[b])}let m=Object.keys(f).map(b=>parseInt(b,10)).sort(Ol);this.layers=[];for(const b of m){const v=f[b];v.sort((w,S)=>{const N=i[w.id],C=i[S.id];return N<C?-1:N>C?1:0});for(const w of v)w instanceof lr&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=f,m=Object.keys(p).map(b=>parseInt(b,10)).sort(Ol);const g=this.inputs.slice(),x=[];for(const b of m)for(const v of p[b]){const w=v.outboundLayer;if(w!=null){for(const S of v.inputTensors)if(g.indexOf(S)===-1)throw new Ys(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${w.name}". The following previous layers were accessed without issue: ${x}`);for(const S of v.outputTensors)g.push(S);x.push(w.name)}}this.nodesByDepth=p;const y=this.layers.map(b=>b.name);for(const b of y){const v=y.filter(w=>w===b).length;if(v!==1)throw new Ys(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new ph({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new H("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=zj(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[c,l]of a.weights.entries()){const d=o?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(s[d]!=null)throw new H(`Duplicate weight name: ${d}`);s[d]=l,r++}const i=[];for(const a in e){let c=a;if(s[a]==null){const l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(s[c]!=null)i.push([s[c],e[a]]);else if(t)throw new H(`Provided weight data has no target variable: ${a}`);delete s[c]}if(t){const a=[];for(const c in s)a.push(c);if(a.length>0)throw new H(`${a.length} of ${r} weights are not set: ${a}`)}kg(i)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${i1}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Hp(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return ce(()=>{e=rn(e);const s=new xo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Ua(this.outputs,s,t)})}computeMask(e,t){return ce(()=>{e=rn(e);let s;return t==null?s=xi(null,e.length):s=rn(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=yu(e);if(t.length!==this.inputLayers.length)throw new H(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const c=this.inputLayers[a],l=t[a],d=c.name+"_0_0";s[d]=l}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Ol);if(r.length>1)for(const a of r){const c=this.nodesByDepth[a];for(const l of c){const d=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(d.id)!==-1)continue;const h=[];for(let g=0;g<l.inboundLayers.length;g++){const x=l.inboundLayers[g],y=l.nodeIndices[g],b=l.tensorIndices[g],v=`${x.name}_${y}_${b}`,w=s[v];h.push(w)}const p=d.computeOutputShape(ms(h)),f=yu(p),m=d.inboundNodes.indexOf(l);for(let g=0;g<f.length;g++){const x=`${d.name}_${m}_${g}`;s[x]=f[g]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],h=`${c.name}_${l}_${d}`;i.push(h)}for(let a=0;a<i.length;a++){const c=i[a];Er(c in s),o.push(s[c])}return ms(o)}runInternalGraph(e,t){t==null&&(t=xi(null,e.length));const s={};for(let c=0;c<this.inputs.length;++c){const l=this.inputs[c],d=e[c],h=t[c];s[l.id]=[d,h]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Ol);for(const c of r){const l=this.nodesByDepth[c];for(const d of l){const h=d.outboundLayer,p=d.inputTensors,f=d.outputTensors,m=new Array;for(const g of p)g.id in s&&m.push(s[g.id]);if(m.length===p.length){let g={},x,y,b,v;if(d.callArgs!=null&&(g=d.callArgs),m.length===1){const[w,S]=m[0];g.mask==null&&(g.mask=S),b=rn(h.call(w,g)),v=rn(h.computeMask(w,S)),x=[w],y=[S]}else x=m.map(w=>w[0]),y=m.map(w=>w[1]),g.mask==null&&(g.mask=y),b=rn(h.call(x,g)),v=rn(h.computeMask(x,y));if(h.activityRegularizer)throw new Ot("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<f.length;++w){const S=f[w],N=b[w],C=v[w];s[S.id]=[N,C]}}}}const o=[],i=[],a=[];for(const c of this.outputs){Er(c.id in s,`Could not compute output ${c.name} : ${c.id}`);const[l,d]=s[c.id];a.push(l.shape),o.push(l),i.push(d)}return[o,i,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof lr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=lr.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new H("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new H(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new H(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ce(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=lr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),c=i.getConfig(),l=[];for(let h=0;h<i.inboundNodes.length;h++){const p=i.inboundNodes[h],f=lr.nodeKey(i,h);let m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){const g=[];for(let x=0;x<p.inboundLayers.length;x++){const y=p.inboundLayers[x],b=p.nodeIndices[x],v=p.tensorIndices[x],w=lr.nodeKey(y,b);let S=t[w];S==null&&(S=0),g.push([y.name,S,v,m])}l.push(g)}}}const d={};d.name=i.name,d.className=a,d.config=c,d.inboundNodes=l,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],c=this.inputLayersNodeIndices[i],l=lr.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.inputLayersTensorIndices[i];r.push([a.name,d,h])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],c=this.outputLayersNodeIndices[i],l=lr.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let d=t[l];d==null&&(d=0);const h=this.outputLayersTensorIndices[i];o.push([a.name,d,h])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function a(x,y){x.name in i?i[x.name].push(y):i[x.name]=[y]}function c(x,y){const b=[];let v;for(const w of y){const S=w[0],N=w[1],C=w[2];if(v=w[3]==null?{}:w[3],!(S in o)){a(x,y);return}const k=o[S];if(k.inboundNodes.length<=N){a(x,y);return}const I=k.inboundNodes[N];b.push(I.outputTensors[C])}b.length>0&&x.apply(ms(b),v)}function l(x){const y=x.name,b=zr(x,t.customObjects!=null?t.customObjects:{});b.setFastWeightInitDuringBuild(r),o[y]=b,x.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new H(`Corrupted configuration, expected array for nodeData: ${w}`);a(b,w)})}const d=t.name,h=t.layers;for(const x of h)l(x);for(;!NP(i);)for(const x of h){const y=o[x.name];if(y.name in i){const b=i[y.name];delete i[y.name];for(const v of b)c(y,v)}}const p=[],f=[],m=t.inputLayers;for(const x of m){const y=x[0],b=x[1],v=x[2];Er(y in o);const S=o[y].inboundNodes[b].outputTensors;p.push(S[v])}const g=t.outputLayers;for(const x of g){const y=x[0],b=x[1],v=x[2];Er(y in o);const S=o[y].inboundNodes[b].outputTensors;f.push(S[v])}return new e({inputs:p,outputs:f,name:d})}get stateful(){if(this._stateful)throw new H("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ce(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wj(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function a1(n,e){return Wj(n,e,"classWeight")}async function c1(n,e,t,s){if(t!=null){const r=ce(()=>{if(n.shape.length===1)return ti(n);if(n.shape.length===2){if(n.shape[1]>1)return tc(n,1);if(n.shape[1]===1)return ee(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Lt(r);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Es(i,"float32")}else return null}function Bj(n,e){return q(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Vj=32;function l1(n,e){let t,s;const r=e;t=r.xs,s=r.ys,E(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=Ex("input",n.inputNames,t),i=Ex("output",n.outputNames,s),a=o[0].shape[0];E(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),E(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let c=0;c<o.length;c++)E(o[c].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[c]} has ${o[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let c=0;c<i.length;c++)E(i[c].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[c]} has ${i[c].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function Ex(n,e,t){if(t instanceof jn)return[t];if(Array.isArray(t))return E(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new H(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function Uj(n){if(n.length===3)throw new Ot("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function Gj(n,e,t){const s=t.batchesPerEpoch!=null;if(E(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),E(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),E(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),E(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),E(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(Rx(t.validationData))E(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=Uj(t.validationData);o=x.xs,i=x.ys}const a=n.makeTrainFunction(),c=n.getDedupedMetricsNames();let l;r?l=c.slice().concat(c.map(x=>"val_"+x)):l=c.slice();const d=Jv(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,{callbackList:p,history:f}=Zv(d,h,t.epochs,null,null,Hj(e,t),null,r,l);p.setModel(n),n.history=f,await p.onTrainBegin(),n.stopTraining_=!1;let m=t.initialEpoch==null?0:t.initialEpoch,g=await e.iterator();for(;m<t.epochs;){const x={};await p.onEpochBegin(m);let y=0,b=0;for(s||(g=await e.iterator());!s||y<t.batchesPerEpoch;){const v=await g.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:w,ys:S}=l1(n,v.value),N={};N.batch=b,N.size=w[0].shape[0],await p.onBatchBegin(b,N);const C=[];if(t.classWeight!=null){const $=a1(t.classWeight,n.outputNames);for(let j=0;j<$.length;++j)C.push(await c1(S[j],null,$[j]))}const k=w.concat(S).concat(C),I=a(k);Lt(k);for(let $=0;$<c.length;++$){const j=c[$],P=I[$];N[j]=P,Mr(P)}await p.onBatchEnd(b,N),Yv(N),b++,y++}if(s?y>=t.batchesPerEpoch:v.done){if(r){let w;Rx(t.validationData)?w=rn(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):w=rn(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?Vj:t.validationBatchSize,verbose:0}));for(let S=0;S<n.metricsNames.length;++S)x[`val_${n.metricsNames[S]}`]=w[S]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(m,x),m++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function Hj(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function Rx(n){return typeof n.iterator=="function"}function qj(n){return typeof n.next=="function"}async function Kj(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new Ot("Verbose mode is not implemented yet.");E(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=qj(e)?e:await e.iterator();let a=0,c=0;for(;!s||c<t.batches;){const l=await i.next();if(o=ce(()=>{if(l.value){const{xs:d,ys:h}=l1(n,l.value),p=d.concat(h),f=ce(()=>r(p));if(Lt(p),c===0)for(let g=0;g<f.length;++g)o.push(Zt(0));const m=p[0].shape[0];for(let g=0;g<f.length;++g){const x=f[g],y=o[g];o[g]=ce(()=>Pe(o[g],q(m,x))),c>0&&Lt(y)}Lt(f),a+=m,++c}return o}),l.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<o.length;++l){const d=o[l];o[l]=Nt(o[l],a),Lt(d)}return ms(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jh(n){E(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Oa(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>si(s,e,t-e)):si(n,e,t-e)}function qp(n,e){return ce(()=>n==null?null:Array.isArray(n)?n.map(t=>qp(t,e)):Fv(n,e.dtype==="int32"?e:Je(e,"int32")))}function Zh(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function u1(n){const e=[];n instanceof jn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(vl(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function ar(n,e){if(n==null)return;const t=[];if(e instanceof jn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof jn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xj(n){return n instanceof jn}function Kp(n){return Array.isArray(n)}function Dx(n){return!Xj(n)&&!Kp(n)}function _x(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(Kp(n)&&n.length>0)i=!0;else if(Dx(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new H(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(Dx(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new H(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(Kp(n)){if(n=n,n.length!==e.length)throw new H(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new H(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=u1(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new H(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d>=0&&l!==d)throw new H(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function Qj(n,e,t){const s=vo(n.map(o=>o.shape[0]));s.sort();const r=vo(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new H(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new H(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!en(s,r))throw new H(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function Yj(n,e,t){const s=[fh,mh,ac];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],a=t[r];if(i!=null){if(i===ac&&o.shape[o.shape.length-1]===1)throw new H(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const c=o.shape.slice(1),l=a.slice(1);for(let d=0;d<c.length;++d){const h=c[d],p=l[d];if(p!=null&&h!==p)throw new H(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Px(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new H(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new H(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new H(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<t[i].length;++c){if(c===0&&!s)continue;const l=a.shape[c],d=t[i][c];if(d!=null&&d!==l)throw new H(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Jj(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const Zj="layers-model";class ea extends lr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new H("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");jj(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Pj(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Oo))throw new H("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new H(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(Yh(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new H(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>Yh(a))}else{const i=Yh(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],c=this.outputNames[i];this.feedOutputNames.push(c),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ni("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=Jj(e.metrics,this.outputNames),o=(i,a,c)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([c,i])};ni("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(l=>{const d="";let h,p,f;for(const m of l){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===mh?["accuracy","acc"].indexOf(m)!==-1?p=t1:["crossentropy","ce"].indexOf(m)!==-1&&(p=Nj):this.lossFunctions[i]===Cu?["accuracy","acc"].indexOf(m)!==-1?p=Ij:["crossentropy","ce"].indexOf(m)!==-1&&(p=r1):["accuracy","acc"].indexOf(m)!==-1?p=n1:["crossentropy","ce"].indexOf(m)!==-1&&(p=s1);let y;["accuracy","acc"].indexOf(m)!==-1?y="acc":["crossentropy","ce"].indexOf(m)!==-1&&(y="ce"),f=p,h=d+y}else f=_j(m),h=d+Wl(m);let g;ni(h,()=>{g=f}),o(i,h,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;Jh(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const c=this.testFunction,l=this.testLoop(c,a,r,s.verbose,s.steps);return ms(l)}finally{ar(i[0],e),ar(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),Kj(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new H(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new H(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new H("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new xo;if(e instanceof jn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new H(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)i.add(this.inputs[c],e[c])}else for(const c of this.inputs){const l=e[c.name];if(l==null)throw new H(`No value is provided for the model's input ${c.name}`);i.add(c,l)}const a=Ua(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const t=xi(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const c=i.indexOf(e[a]);if(c!==-1&&(t[a]=o[c],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new H(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return ce(()=>{const r=this.checkNumSamples(e);if(s)throw new Ot("Verbose predictLoop() is not implemented yet.");const o=Zh(r,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ce(()=>{const l=o[a][0],d=o[a][1],h=Oa(e,l,d),p=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)p.push({key:this.inputs[m],value:h[m]});else p.push({key:this.inputs[0],value:h});const f=new xo(p);return Ua(this.outputs,f)}).forEach((l,d)=>i[d].push(l));return ms(i.map(a=>xs(a,0)))})}predict(e,t={}){const s=u1(e);Px(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return Jh(r),this.predictLoop(s,r)}finally{ar(s,e)}}predictOnBatch(e){Px(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Ys("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Cu?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=_x(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=_x(t,this.feedOutputNames,o,!1,"target"),Qj(e,t),Yj(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new H(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[a,c]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let l=null;if(r!=null){const d=a1(r,this.outputNames);l=[];for(let h=0;h<d.length;++h)l.push(await c1(c[h],null,d[h]))}return[a,c,l]}testLoop(e,t,s,r=0,o){return ce(()=>{const i=this.checkNumSamples(t,s,o,"steps"),a=[];if(r>0)throw new Ot("Verbose mode is not implemented yet.");if(o!=null)throw new Ot("steps mode in testLoop() is not implemented yet");{const c=Zh(i,s),l=Es(yr(0,i));for(let d=0;d<c.length;++d){const h=c[d][0],p=c[d][1],f=si(l,h,p-h),m=qp(t,f),g=e(m);if(d===0)for(let x=0;x<g.length;++x)a.push(Zt(0));for(let x=0;x<g.length;++x){const y=g[x];a[x]=Pe(a[x],q(p-h,y))}}for(let d=0;d<a.length;++d)a[d]=Nt(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(yx(e,r)>1){const i=yx(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const h=[];for(let g=0;g<this.inputs.length;++g)h.push({key:this.inputs[g],value:s[g]});const p=new xo(h),f=Ua(this.outputs,p,{training:!0});let m;for(let g=0;g<this.lossFunctions.length;++g){const x=this.lossFunctions[g];let y=x(r[g],f[g]);o[g]!=null&&(y=Bj(y,o[g]));const b=Dn(y);t.push(b),g===0?m=y:m=Pe(m,y)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=t[g];else{const y=this.metricsTensors[g][0],b=this.metricsTensors[g][1];x=Dn(y(r[b],f[b]))}Mr(x),i.push(x)}return m=Dn(m),this.calculateLosses().forEach(g=>{m=Pe(m,g)}),m},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(a,!0,c)].concat(i)}}makeTestFunction(){this.testFunction=e=>ce(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let l=0;l<this.inputs.length;++l)i.push({key:this.inputs[l],value:r[l]});const a=new xo(i),c=Ua(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const d=this.lossFunctions[l],h=Dn(d(o[l],c[l]));l===0?s=h:s=Pe(s,h),t.push(s)}for(let l=0;l<this.metricsTensors.length;++l){const d=this.metricsTensors[l][0],h=this.metricsTensors[l][1],p=Dn(d(o[h],c[h]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,c,l,d,h,p;try{const f=s.batchSize==null?32:s.batchSize;Jh(f);const g=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,f);r=g[0],o=g[1],p=g[2];let x=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)c=s.validationData[0],l=s.validationData[1];else throw s.validationData.length===3?new Ot("validationData including sample weights is not supported yet."):new H(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const $=await this.standardizeUserData(c,l,null,null,!0,f);d=$[0],h=$[1],y=d.concat(h)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const I=Math.floor(r[0].shape[0]*(1-s.validationSplit)),$=r[0].shape[0];d=Oa(r,I,$),i=r,r=Oa(r,0,I),h=Oa(o,I,$),a=o,o=Oa(o,0,I),y=d.concat(h)}else s.validationSteps!=null&&(x=!0);const b=r.concat(o).concat(p);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let S,N;x?(this.makeTestFunction(),S=this.testFunction,N=w.slice().concat(w.map(I=>"val_"+I))):(S=null,y=[],N=w.slice());const C=Jv(s.callbacks,s.yieldEvery);return await this.fitLoop(v,b,w,f,s.epochs,s.verbose,C,S,y,s.shuffle,N,s.initialEpoch,null,null)}finally{this.isTraining=!1,ar(r,e),ar(o,t),ar(i,e),ar(a,t),ar(d,c),ar(h,l),p!=null&&Lt(p)}}async fitLoop(e,t,s,r,o,i,a,c,l,d,h,p,f,m){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),p==null&&(p=0);let g=!1;if(c!=null&&l!=null&&(g=!0),m!=null&&(g=!0,f==null))throw new H("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,r,f,"steps_per_epoch");let y;x!=null&&(y=yr(0,x)),i==null&&(i=1);const{callbackList:b,history:v}=Zv(a,i,o,p,x,f,r,g,h);b.setModel(this),this.history=v,await b.onTrainBegin(),this.stopTraining_=!1;for(let w=p;w<o;++w){await b.onEpochBegin(w);const S={};if(f!=null)throw new Ot("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new Ot("batch shuffling is not implemneted yet");d&&vk(y);const N=Es(y),C=Zh(x,r);for(let k=0;k<C.length;++k){const I={};if(await b.onBatchBegin(k,I),ce(()=>{const $=C[k][0],j=C[k][1],P=si(N,$,j-$);I.batch=k,I.size=j-$;const O=qp(t,P),A=e(O);for(let z=0;z<s.length;++z){const L=s[z],U=A[z];I[L]=U,Mr(U)}if(k===C.length-1&&g){const z=this.testLoop(c,l,r);for(let L=0;L<s.length;++L){const U=s[L],V=z[L];Mr(V),S["val_"+U]=V}}}),await b.onBatchEnd(k,I),Yv(I),this.stopTraining_)break}N.dispose()}if(await b.onEpochEnd(w,S),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return Gj(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),c=[];for(const l of a){const d=await l.data();c.push(d[0])}return Lt(a),ar(s[0],e),ar(s[1],t),ms(c)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=Ep().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Ep().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Xr(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Xr(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=Xr(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Xr(Wl(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Xr(Wl(e)));{const e={};for(const t in this.metrics)e[t]=Xr(Wl(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=$u(e.optimizer_config),s=zr(t);let r;if(typeof e.loss=="string")r=Ko(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>Ko(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=Ko(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>Ko(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=Ko(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const l=k$(e);if(l.length===0)throw new H(`Cannot find any save handlers for URL '${e}'`);if(l.length>1)throw new H(`Found more than one (${l.length}) save handlers for URL '${e}'`);e=l[0]}if(e.save==null)throw new H("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Z0(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:Zj,generatedBy:`TensorFlow.js tfjs-layers v${i1}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:d,specs:h}=await Z0(await this.optimizer.getWeights(),l);s.specs.push(...h),s.data=y$([s.data,d])}return this.userDefinedMetadata!=null&&(Ax(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){Ax(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ea.className="Model";Re(ea);class d1 extends ea{}d1.className="Functional";Re(d1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function eM(n,e){if(e==null&&(e={}),typeof n=="string"){const t=$$(n,e);if(t.length===0)t.push(aD(n,e));else if(t.length>1)throw new H(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return tM(n,void 0,e)}async function tM(n,e,t){if(t==null&&(t={}),n.load==null)throw new H("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=zr($u(r),e,i),c=s.trainingConfig;if(c!=null&&a.loadTrainingConfig(c),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new H("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:l,optimizerWeights:d}=nM(s.weightData,s.weightSpecs);a.loadWeights(l,o),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),Lt(l),Lt(d.map(h=>h.tensor))}return a}function nM(n,e){const t=h$(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class da extends ea{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:dh("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new H(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof da||e instanceof ea;let s;if(t){if(s=e,s.outputs.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new H("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new H("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=tj({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new H(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new H("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Hv(this.outputs[0])}this.inboundNodes=[],new ph({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:xi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Qt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ea({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new H("Legacy serialization format not supported yet.");o=t}else E(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof da))throw new Ot(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const c of o){const d=zr(c,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new H("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new H("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}da.className="Sequential";Re(da);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sM(n){return new da(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ns=class extends Ia{getConfig(){return{}}};class h1 extends ns{apply(e,t=1){return LP(e,t)}}h1.className="elu";Re(h1);class p1 extends ns{apply(e){return Tw(e)}}p1.className="selu";Re(p1);class f1 extends ns{apply(e){return ki(e)}}f1.className="relu";Re(f1);class m1 extends ns{apply(e){return ce(()=>rc(6,ki(e)))}}m1.className="relu6";Re(m1);class g1 extends ns{apply(e){return e}}g1.className="linear";Re(g1);class x1 extends ns{apply(e){return Sa(e)}}x1.className="sigmoid";Re(x1);class y1 extends ns{apply(e){return WP(e)}}y1.className="hardSigmoid";Re(y1);class b1 extends ns{apply(e){return pl(e)}}b1.className="softplus";Re(b1);class w1 extends ns{apply(e){return zP(e)}}w1.className="softsign";Re(w1);class v1 extends ns{apply(e){return th(e)}}v1.className="tanh";Re(v1);let Eg=class extends ns{apply(e,t=-1){return Dm(e,t)}};Eg.className="softmax";Re(Eg);class S1 extends ns{apply(e,t=-1){return bw(e,t)}}S1.className="logSoftmax";Re(S1);class C1 extends ns{apply(e){return ce(()=>ce(()=>{const t=Math.sqrt(2),s=q(.5,Pe(1,fw(Nt(e,t))));return q(e,s)}))}}C1.className="gelu";Re(C1);class N1 extends ns{apply(e){return ce(()=>q(.5,q(e,Pe(1,th(q(es(Nt(2,Math.PI)),Pe(e,q(.044715,fi(e,3)))))))))}}N1.className="gelu_new";Re(N1);class I1 extends ns{apply(e){return ce(()=>q(e,th(pl(e))))}}I1.className="mish";Re(I1);class k1 extends ns{apply(e,t=1){return ce(()=>q(Sa(q(e,t)),e))}}k1.className="swish";Re(k1);function $o(n){return n.getClassName()}function ep(n,e={}){return wl(n,qs.getMap().classNameMap,e,"activation")}function To(n){if(n==null){const e={};return e.className="linear",e.config={},ep(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},ep(e)}else return n instanceof ns?n:ep(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rM(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class $1 extends Ia{}class T1 extends $1{constructor(e){super(),rM(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ce(()=>{let t=Un([1]);return this.hasL1&&(t=Pe(t,wt(q(this.l1,os(e))))),this.hasL2&&(t=Pe(t,wt(q(this.l2,Sl(e))))),ee(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}T1.className="L1L2";Re(T1);const jx={l1l2:"L1L2"};function cn(n){return gg(n)}function Mx(n,e={}){return wl(n,qs.getMap().classNameMap,e,"regularizer")}function bn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in jx?jx[n]:n,config:{}};return Mx(t)}else return n instanceof $1?n:Mx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class A1 extends Vt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Tt(e);let s=ki(e);return this.maxValue!=null&&(s=Ls(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}A1.className="ReLU";Re(A1);class E1 extends Vt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Tt(e);return gm(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}E1.className="LeakyReLU";Re(E1);class R1 extends Vt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=yn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=bn(e.alphaRegularizer),this.alphaConstraint=Ln(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new H(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Qt(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Fn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Tt(e),Sm(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Sn(this.alphaInitializer),alphaRegularizer:cn(this.alphaRegularizer),alphaConstraint:On(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}R1.className="PReLU";Re(R1);let D1=class extends Vt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ot(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Tt(e);return rh(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};D1.className="ELU";Re(D1);class _1 extends Vt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Tt(e);return q(s,Je(zs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}_1.className="ThresholdedReLU";Re(_1);class P1 extends Vt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Eg().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ce(()=>{let s=Tt(e);const r=t.mask;if(r!=null){const o=q(kt(Fo(s.shape),Je(r,s.dtype)),Zt(-1e9));s=Pe(s,o)}return this.axis instanceof Array?this.axis.length>1?Vr(kt(s,ww(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}P1.className="Softmax";Re(P1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ta(n,e,t){if(typeof n=="number")return xi(n,e);if(n.length!==e)throw new H(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!jP(r))throw new H(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function xr(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Rr(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+ko([t-e,0]);else if(s==="same")n=n*e;else throw new H(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rg(n,e){return ce(()=>(An(e),e==="channelsFirst"?Ht(n,[0,2,3,1]):n))}function j1(n,e){return ce(()=>(An(e),e==="channelsFirst"?Ht(n,[0,2,3,4,1]):n))}function oM(n,e,t,s=1,r="valid",o,i=1){return ce(()=>{if(o==null&&(o=br()),An(o),n.shape.length!==3)throw new H(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new H(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new H(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=Ht(n,[0,2,1])),r==="causal")throw new Ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=lw(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(a=Sr(a,t)),a})}function Fx(n,e,t,s=[1,1],r="valid",o,i,a=null){return ce(()=>{if(o==null&&(o=br()),An(o),n.rank!==3&&n.rank!==4)throw new H(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new H(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let c=Rg(n,o);if(r==="causal")throw new Ot("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=rR({x:c,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(c=Ht(c,[0,3,1,2])),c})}function iM(n,e,t,s=[1,1,1],r="valid",o,i){return ce(()=>{if(o==null&&(o=br()),An(o),n.rank!==4&&n.rank!==5)throw new H(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new H(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=j1(n,o);if(r==="causal")throw new Ot("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=sT(a,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(a=Sr(a,t)),o==="channelsFirst"&&(a=Ht(a,[0,4,1,2,3])),a})}class gh extends Vt{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",gh.verifyArgs(t),this.rank=e,Gn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ot(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ta(t.kernelSize,e,"kernelSize"),this.strides=ta(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ws(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,An(this.dataFormat),this.activation=To(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=yn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ln(t.biasConstraint),this.biasRegularizer=bn(t.biasRegularizer),this.activityRegularizer=bn(t.activityRegularizer),this.dilationRate=ta(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new H(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new H(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new H(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Er("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!xg(e.kernelSize,"number",1,3))throw new H(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:$o(this.activation),useBias:this.useBias,biasInitializer:Sn(this.biasInitializer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),biasConstraint:On(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class ka extends gh{constructor(e,t){super(e,t),this.kernel=null,ka.verifyArgs(t),this.filters=t.filters,Gn(this.filters,"filters"),this.kernelInitializer=yn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ln(t.kernelConstraint),this.kernelRegularizer=bn(t.kernelRegularizer)}build(e){e=Qt(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return ce(()=>{e=Tt(e);let s;const r=this.bias==null?null:this.bias.read(),o=Rv(this.activation.getClassName());if(o!=null&&this.rank===2)s=Fx(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=oM(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Fx(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=iM(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ot("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Qt(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=xr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Sn(this.kernelInitializer),kernelRegularizer:cn(this.kernelRegularizer),kernelConstraint:On(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new H(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class kl extends ka{constructor(e){super(2,e),kl.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xg(e.kernelSize,"number",1,2))throw new H(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}kl.className="Conv2D";Re(kl);class $l extends ka{constructor(e){super(3,e),$l.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new H(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}$l.className="Conv3D";Re($l);class M1 extends kl{constructor(e){if(super(e),this.inputSpec=[new Fn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qt(e),e.length!==4)throw new H("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Fn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return ce(()=>{let s=Tt(e);if(s.shape.length!==4)throw new H(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const c=r[i],l=r[a],d=this.kernelSize[0],h=this.kernelSize[1],p=this.strides[0],f=this.strides[1],m=Rr(c,p,d,this.padding),g=Rr(l,f,h,this.padding),x=[o,m,g,this.filters];this.dataFormat!=="channelsLast"&&(s=Ht(s,[0,2,3,1]));let y=uw(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Ht(y,[0,3,1,2])),this.bias!=null&&(y=Sr(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Qt(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return t[s]=this.filters,t[r]=Rr(t[r],c,i,this.padding),t[o]=Rr(t[o],l,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}M1.className="Conv2DTranspose";Re(M1);class F1 extends $l{constructor(e){if(super(e),this.inputSpec=[new Fn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new H(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qt(e),e.length!==5)throw new H("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new H("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Fn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return ce(()=>{let s=Tt(e);if(s.shape.length!==5)throw new H(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,c;this.dataFormat==="channelsFirst"?(c=2,i=3,a=4):(c=1,i=2,a=3);const l=r[c],d=r[i],h=r[a],p=this.kernelSize[0],f=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],x=this.strides[1],y=this.strides[2],b=Rr(l,g,p,this.padding),v=Rr(d,x,f,this.padding),w=Rr(h,y,m,this.padding),S=[o,b,v,w,this.filters];this.dataFormat!=="channelsLast"&&(s=Ht(s,[0,2,3,4,1]));let N=iT(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=Ht(N,[0,4,1,2,3])),this.bias!==null&&(N=Sr(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(e){e=Qt(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],d=this.strides[0],h=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=Rr(t[r],d,a,this.padding),t[o]=Rr(t[o],h,c,this.padding),t[i]=Rr(t[i],p,l,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}F1.className="Conv3DTranspose";Re(F1);class O1 extends ka{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new H("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new H("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new H(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=yn(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=bn(t.depthwiseRegularizer),this.depthwiseConstraint=Ln(t.depthwiseConstraint),this.pointwiseInitializer=yn(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=bn(t.pointwiseRegularizer),this.pointwiseConstraint=Ln(t.pointwiseConstraint)}build(e){if(e=Qt(e),e.length<this.rank+2)throw new H(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new H(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Fn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return ce(()=>{e=Tt(e);let s;if(this.rank===1)throw new Ot("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Ht(e,[0,2,3,1])),s=Aw(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Sr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Ht(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Sn(this.depthwiseInitializer),e.pointwiseInitializer=Sn(this.pointwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.pointwiseRegularizer=cn(this.pointwiseRegularizer),e.depthwiseConstraint=On(this.depthwiseConstraint),e.pointwiseConstraint=On(this.pointwiseConstraint),e}}O1.className="SeparableConv";class L1 extends O1{constructor(e){super(2,e)}}L1.className="SeparableConv2D";Re(L1);class xh extends ka{constructor(e){super(1,e),xh.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!xg(e.kernelSize,"number",1,1))throw new H(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}xh.className="Conv1D";Re(xh);class z1 extends Vt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ce(()=>{if(e=Tt(e),this.dataFormat==="channelsLast"){const s=zl(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return zl(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=zl(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return zl(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}z1.className="Cropping2D";Re(z1);class W1 extends Vt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,DP(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return ce(()=>{let s=Tt(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Ht(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?Jr.resizeNearestNeighbor(s,[o,i]):Jr.resizeBilinear(s,[o,i]);return Ht(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?Jr.resizeNearestNeighbor(s,[o,i]):Jr.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}W1.className="UpSampling2D";Re(W1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aM(n,e,t=[1,1],s="valid",r,o){return ce(()=>{r==null&&(r=br()),An(r);let i=Rg(n,r);if(n.rank!==4)throw new H(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new H(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=hm(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=Ht(i,[0,3,1,2])),i})}class B1 extends gh{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=yn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ln(e.depthwiseConstraint),this.depthwiseRegularizer=bn(e.depthwiseRegularizer)}build(e){if(e=Qt(e),e.length<4)throw new H(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new H(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ce(()=>{e=Tt(e);let s=aM(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Sr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Qt(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=xr(t,this.kernelSize[0],this.padding,this.strides[0]),i=xr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Sn(this.depthwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.depthwiseConstraint=On(this.depthwiseRegularizer),e}}B1.className="DepthwiseConv2D";Re(B1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function V1(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new H("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function U1(n,e,t,s=!1,r,o,i=!1,a=!1){return ce(()=>{const c=e.shape.length;if(c<3)throw new H(`Input should be at least 3D, but is ${c}D.`);const l=[1,0].concat(yr(2,c));e=Ht(e,l),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Je(Je(r,"bool"),"float32"),r.rank===c-1&&(r=fs(r,-1)),r=Ht(r,l)),s&&(e=mi(e,0),r!=null&&(r=mi(r,0)));const d=[];let h,p=t;const f=e.shape[0],m=gi(e);let g;r!=null&&(g=gi(r));for(let y=0;y<f;++y){const b=m[y],v=ce(()=>n(b,p));if(r==null)h=v[0],p=v[1];else{const w=ce(()=>{const S=g[y],N=kt(er(S),S),C=Pe(q(v[0],S),q(p[0],N)),k=p.map((I,$)=>Pe(q(v[1][$],S),q(I,N)));return{output:C,newStates:k}});h=w.output,p=w.newStates}a&&d.push(h)}let x;return a&&(x=to(d,1)),[h,x,p]})}class Lo extends Vt{constructor(e){super(e);let t;if(e.cell==null)throw new H("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Pg({cells:e.cell}):t=e.cell,t.stateSize==null)throw new H("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Fn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return yr(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Vp(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return ce(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ot("Constants support is not implemented in RNN yet.");Vp(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Fn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!en(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new H(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Fn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){ce(()=>{if(!this.stateful)throw new Ar("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Un([s,r])):this.states_=[Un([s,this.cell.stateSize])];else if(e==null)Lt(this.states_),this.keptStates!=null&&(Lt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Un([s,r])):this.states_[0]=Un([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Lt(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!en(o.shape,a))throw new H(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>Mr(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=V1(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const l of s)this.stateSpec.push(new Fn({shape:l.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Gr){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const p=super.apply(l,t);return this.inputSpec=h,p}else return super.apply(e,t)}call(e,t){return ce(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=Tt(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new H(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},l=U1((m,g)=>{const x=this.cell.call([m].concat(g),a);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=l[0],h=l[1],p=l[2];this.stateful&&this.resetStates(p,r);const f=this.returnSequences?h:d;return this.returnState?[f].concat(p):f})}getInitialState(e){return ce(()=>{let t=Un(e.shape);return t=wt(t,[1,2]),t=vl(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Wp(t,[1,s]):t):this.cell.stateSize>1?[Wp(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Lo.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=zr(r,s);return new e(Object.assign(t,{cell:o}))}}Lo.className="RNN";Re(Lo);class yh extends Vt{}class Dg extends yh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=To(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=bn(e.kernelRegularizer),this.recurrentRegularizer=bn(e.recurrentRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=ua([1,ko([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ua([1,ko([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ce(()=>{if(e=e,e.length!==2)throw new H(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ao({ones:()=>er(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ao({ones:()=>er(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Lr(q(e,i),this.kernel.read()):o=Lr(e,this.kernel.read()),this.bias!=null&&(o=Sr(o,this.bias.read())),a!=null&&(s=q(s,a));let c=Pe(o,Lr(s,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$o(this.activation),useBias:this.useBias,kernelInitializer:Sn(this.kernelInitializer),recurrentInitializer:Sn(this.recurrentInitializer),biasInitializer:Sn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),recurrentConstraint:On(this.recurrentConstraint),biasConstraint:On(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Dg.className="SimpleRNNCell";Re(Dg);class G1 extends Lo{constructor(e){e.cell=new Dg(e),super(e)}call(e,t){return ce(()=>{this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}G1.className="SimpleRNN";Re(G1);class _g extends yh{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new H("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Gn(this.units,"units"),this.activation=To(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=To(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=bn(e.kernelRegularizer),this.recurrentRegularizer=bn(e.recurrentRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=ua([1,ko([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ua([1,ko([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qt(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ce(()=>{if(e=e,e.length!==2)throw new H(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ao({ones:()=>er(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ao({ones:()=>er(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,c,l;0<this.dropout&&this.dropout<1&&(e=q(e,o[0]));let d=Lr(e,this.kernel.read());this.useBias&&(d=Sr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=q(r,i[0]));const h=this.recurrentKernel.read(),[p,f]=Os(h,[2*this.units,this.units],h.rank-1),m=Lr(r,p),[g,x,y]=Os(d,3,d.rank-1),[b,v]=Os(m,2,m.rank-1);a=this.recurrentActivation.apply(Pe(g,b)),c=this.recurrentActivation.apply(Pe(x,v));const w=Lr(q(c,r),f);l=this.activation.apply(Pe(y,w));const S=Pe(q(a,r),q(Pe(1,kn(a)),l));return[S,S]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$o(this.activation),recurrentActivation:$o(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sn(this.kernelInitializer),recurrentInitializer:Sn(this.recurrentInitializer),biasInitializer:Sn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),recurrentConstraint:On(this.recurrentConstraint),biasConstraint:On(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}_g.className="GRUCell";Re(_g);class H1 extends Lo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new _g(e),super(e)}call(e,t){return ce(()=>{this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}H1.className="GRU";Re(H1);class bh extends yh{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Gn(this.units,"units"),this.activation=To(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=To(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=bn(e.kernelRegularizer),this.recurrentRegularizer=bn(e.recurrentRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.kernelConstraint=Ln(e.kernelConstraint),this.recurrentConstraint=Ln(e.recurrentConstraint),this.biasConstraint=Ln(e.biasConstraint),this.dropout=ua([1,ko([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ua([1,ko([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Qt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends nr{apply(c,l){const d=o.apply([i]),h=new bg().apply([i]),p=o.apply([i*2]);return wx(wx(d,h),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ce(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new H(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ao({ones:()=>er(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ao({ones:()=>er(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let c,l,d,h;0<this.dropout&&this.dropout<1&&(e=q(e,i[0]));let p=Lr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=q(r,a[0])),p=Pe(p,Lr(r,this.recurrentKernel.read())),this.useBias&&(p=Sr(p,this.bias.read()));const[f,m,g,x]=Os(p,4,p.rank-1);c=this.recurrentActivation.apply(f),l=this.recurrentActivation.apply(m),d=Pe(q(l,o),q(c,this.activation.apply(g))),h=this.recurrentActivation.apply(x);const y=q(h,this.activation.apply(d));return[y,y,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:$o(this.activation),recurrentActivation:$o(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sn(this.kernelInitializer),recurrentInitializer:Sn(this.recurrentInitializer),biasInitializer:Sn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),recurrentConstraint:On(this.recurrentConstraint),biasConstraint:On(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}bh.className="LSTMCell";Re(bh);class q1 extends Lo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new bh(e),super(e)}call(e,t){return ce(()=>{this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}q1.className="LSTM";Re(q1);class Pg extends yh{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ce(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const c=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=c.call(i,t),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){Vp(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{ni(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(zr(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Up(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}kg(t)}}Pg.className="StackedRNNCells";Re(Pg);function Ao(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):Ov(e(),t),a=()=>Cl(i,e,s);return!r||r<=1?Mr(a().clone()):Array(r).fill(void 0).map(a).map(l=>Mr(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var cM=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class K1 extends Lo{constructor(e){if(e.unroll)throw new Ot("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ot("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Fn({ndim:5})]}call(e,t){return ce(()=>{if(this.cell.dropoutMask!=null&&(Lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new H("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ce(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Un(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){ce(()=>{if(!this.stateful)throw new Ar("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new H("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Un(o)):this.states_=[Un(o)];else if(e==null)Lt(this.states_),this.keptStates!=null&&(Lt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Un(o)):this.states_[0]=Un(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new H(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Lt(this.states_);for(let a=0;a<this.states_.length;++a){const c=e[a],l=o;if(!en(c.shape,l))throw new H(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${c.shape}`);this.states_[a]=c}}this.states_=this.states_.map(a=>Mr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,c=t==="channelsFirst",l=e[c?3:2],d=e[c?4:3],h=xr(l,r[0],o,i[0],a[0]),p=xr(d,r[1],o,i[1],a[1]);return[...e.slice(0,2),...c?[s,h,p]:[h,p,s]]}}K1.className="ConvRNN2D";class jg extends bh{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Gn(this.filters,"filters"),this.kernelSize=ta(s,2,"kernelSize"),this.kernelSize.forEach(c=>Gn(c,"kernelSize")),this.strides=ta(r||1,2,"strides"),this.strides.forEach(c=>Gn(c,"strides")),this.padding=o||"valid",Ws(this.padding),this.dataFormat=i||"channelsLast",An(this.dataFormat),this.dilationRate=ta(a||1,2,"dilationRate"),this.dilationRate.forEach(c=>Gn(c,"dilationRate"))}build(e){var t;e=Qt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new H(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const l=this.biasInitializer,d=this.filters;c=new(t=class extends nr{apply(p,f){const m=l.apply([d]),g=Fo([d]),x=l.apply([d*2]);return yg([m,g,x])}},t.className="CustomInit",t)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ce(()=>{if(e.length!==3)throw new H(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ao({ones:()=>er(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,l=(Y,K,pe)=>!K||!K[pe]?Y:q(K[pe],Y);let d=l(r,c,0),h=l(r,c,1),p=l(r,c,2),f=l(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ao({ones:()=>er(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let g=l(o,m,0),x=l(o,m,1),y=l(o,m,2),b=l(o,m,3);const v=3,[w,S,N,C]=Os(this.kernel.read(),a,v),[k,I,$,j]=this.useBias?Os(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,w,k,this.padding),h=this.inputConv(h,S,I,this.padding),p=this.inputConv(p,N,$,this.padding),f=this.inputConv(f,C,j,this.padding);const[P,O,A,z]=Os(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,P),x=this.recurrentConv(x,O),y=this.recurrentConv(y,A),b=this.recurrentConv(b,z);const L=this.recurrentActivation.apply(Pe(d,g)),U=this.recurrentActivation.apply(Pe(h,x)),V=Pe(q(U,i),q(L,this.activation.apply(Pe(p,y)))),B=q(this.recurrentActivation.apply(Pe(f,b)),this.activation.apply(V));return[B,B,V]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=cM(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=pi(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Sr(o,s,this.dataFormat):o}recurrentConv(e,t){return pi(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}jg.className="ConvLSTM2DCell";Re(jg);class X1 extends K1{constructor(e){const t=new jg(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}X1.className="ConvLSTM2D";Re(X1);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class wh extends Vt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Cl(()=>Ov(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}wh.className="Dropout";Re(wh);class Q1 extends wh{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}Q1.className="SpatialDropout1D";Re(Q1);class Mg extends Vt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Gn(this.units,"units"),this.activation=To(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=yn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=yn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ln(e.kernelConstraint),this.biasConstraint=Ln(e.biasConstraint),this.kernelRegularizer=bn(e.kernelRegularizer),this.biasRegularizer=bn(e.biasRegularizer),this.activityRegularizer=bn(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Qt(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Qt(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e),r=Rv(this.activation.getClassName());let o;return r!=null?o=Lr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Lr(s,this.kernel.read()),this.bias!=null&&(o=Sr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:$o(this.activation),useBias:this.useBias,kernelInitializer:Sn(this.kernelInitializer),biasInitializer:Sn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:On(this.kernelConstraint),biasConstraint:On(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Mg.className="Dense";Re(Mg);class Y1 extends Vt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Qt(e);for(const t of e.slice(1))if(t==null)throw new H(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],So(e,1)]}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let s=Tt(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=Ht(s,r)}return OP(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Y1.className="Flatten";Re(Y1);class J1 extends Vt{constructor(e){super(e),this.supportsMasking=!0,this.activation=To(e.activation)}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e);return this.activation.apply(s)})}getConfig(){const e={activation:$o(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}J1.className="Activation";Re(J1);class Z1 extends Vt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ce(()=>(e=Tt(e),MP(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}Z1.className="RepeatVector";Re(Z1);class eS extends Vt{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let c=0;c<r.length;++c){const l=r[c];if(this.isUnknown(l))if(i===null)i=c;else throw new H("Can only specifiy one unknown dimension.");else o*=l}const a=So(e);if(i!==null){if(o===0||a%o!==0)throw new H(s);r[i]=a/o}else if(a!==o)throw new H(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ee(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}eS.className="Reshape";Re(eS);class tS extends Vt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=yr(1,e.dims.length+1);if(!en(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Fn({ndim:this.dims.length+1})]}computeOutputShape(e){e=Qt(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return Ht(Tt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}tS.className="Permute";Re(tS);class nS extends Vt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Tt(e);return Pp(mu(s,this.maskValue),-1)}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e),i=Pp(mu(s,this.maskValue),-1,!0);return q(s,Je(i,s.dtype))})}}nS.className="Masking";Re(nS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sS extends Vt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(rn(e.inputLength))}this.inputDim=e.inputDim,Gn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Gn(this.outputDim,"outputDim"),this.embeddingsInitializer=yn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=bn(e.embeddingsRegularizer),this.activityRegularizer=bn(e.activityRegularizer),this.embeddingsConstraint=Ln(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ce(()=>this.maskZero?(e=Tt(e),mu(e,qt(e))):null)}computeOutputShape(e){if(e=Qt(e),this.inputLength==null)return[...e,this.outputDim];const t=rn(this.inputLength);if(t.length!==e.length-1)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new H(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let s=Tt(e);s.dtype!=="int32"&&(s=Or(s,"int32"));const r=Fv(this.embeddings.read(),ee(s,[s.size]));return ee(r,Qt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Sn(this.embeddingsInitializer),embeddingsRegularizer:cn(this.embeddingsRegularizer),activityRegularizer:cn(this.activityRegularizer),embeddingsConstraint:On(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}sS.className="Embedding";Re(sS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ai extends Vt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ot}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new H("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Qt(e)]),e=e,e.length<2)throw new H(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=vo(t),t.length>1)throw new H(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&vo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ce(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=ko(r);for(let i of e){const a=i.rank;for(let c=0;c<o-a;++c)i=vl(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const c of e){const l=c.rank;if(l==null){const d=c.shape,h=d[0],p=d.slice(1).concat([h]);let f=ee(c,[h].concat(So(d.slice(1))));f=Ht(f,[1,0]),f=ee(f,p),s.push(f),o=!0}else if(l>1){const d=yr(1,l).concat([0]);s.push(Ht(c,d)),o=!0}else s.push(c)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const c=i.shape,l=c.length,d=c[l-1],h=[d].concat(c.slice(0,c.length-1));i=ee(Ht(ee(i,[-1,d]),[1,0]),h)}else if(a>1){const c=[a-1].concat(yr(0,a-1));i=Ht(i,c)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=vo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return ce(()=>{if(t==null)return null;if(!Array.isArray(t))throw new H("`mask` should be an Array");if(!Array.isArray(e))throw new H("`inputs` should be an Array");if(t.length!==e.length)throw new H(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:fs(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=eo(s,t[r]);return s})}}class rS extends Ai{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Pe(t,e[s]);return t})}}rS.className="Add";Re(rS);class oS extends Ai{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=q(t,e[s]);return t})}}oS.className="Multiply";Re(oS);class iS extends Ai{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=Pe(t,e[s]);return q(1/e.length,t)})}}iS.className="Average";Re(iS);class aS extends Ai{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Mo(t,e[s]);return t})}}aS.className="Maximum";Re(aS);class cS extends Ai{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=rc(t,e[s]);return t})}}cS.className="Minimum";Re(cS);class lS extends Ai{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new H("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(en(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new H("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ce(()=>yg(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new H("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new H("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new H("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new H(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ce(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(Je(er(e[i]),"bool")):t[i].rank<e[i].rank?r.push(fs(t[i],-1)):r.push(t[i]);const o=xs(r,this.axis);return cw(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}lS.className="Concatenate";Re(lS);function La(n,e){for(;n<0;)n+=e;return n}function lM(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Ot("batchDot is not implemented for tensors of 4D or higher rank yet");if(E(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),E(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Ot("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return ce(()=>{let i;if(s>r){i=s-r;const c=[];for(let l=0;l<i;++l)c.push(1);e=ee(e,e.shape.concat(c))}else if(r>s){i=r-s;const c=[];for(let l=0;l<i;++l)c.push(1);n=ee(n,n.shape.concat(c))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=wt(q(n,e),o[0]):a=wt(q(Ht(n,[1,0]),e),o[1]);else{const c=o[0]!==n.shape.length-1,l=o[1]===e.shape.length-1;a=Jt(n,e,c,l)}if(i>0){let c;s>r?c=s+r-3:c=s-1;const l=[];for(let d=c;d<c+i;++d)l.push(d);a=ml(a,l)}return a.shape.length===1&&(a=fs(a,1)),a})}class uS extends Ai{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){E(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new Ot("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new H(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new H(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>La(o,e[i].shape.length)):r=[La(this.axes,t.shape.length),La(this.axes,s.shape.length)],this.normalize&&(t=Su(t,r[0]),s=Su(s,r[1])),lM(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[La(this.axes,e.length),La(this.axes,t.length)],s}computeOutputShape(e){E(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new Ot("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}uS.className="Dot";Re(uS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dS extends Vt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e);return Cl(()=>Pe(hh(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}dS.className="GaussianNoise";Re(dS);class hS extends Vt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ce(()=>{this.invokeCallHook(e,t);const s=Tt(e);return this.rate>0&&this.rate<1?Cl(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return q(s,hh(s.shape,1,o))},()=>s,t.training||!1):s})}}hS.className="GaussianDropout";Re(hS);class pS extends Vt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Tt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ce(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Cl(()=>{const o=Tt(e),a=-1.6732632423543772*1.0507009873554805;let c=Ni(fl(s),this.rate);c=Or(c,"float32");const l=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-l*a*this.rate,h=Pe(q(o,c),q(Pe(c,-1),a));return Pe(q(h,l),d)},()=>Tt(e),t.training||!1)}return e})}}pS.className="AlphaDropout";Re(pS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cc(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=_2(n,e,t,s,r,o);else if(n.rank===3)i=j2(n,e,t,s,r,o);else if(n.rank===4)i=F2(n,e,t,s,r,o);else throw new Ot(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function uM(n,e,t,s,r=.001){return ce(()=>{const o=bm(n,s),i=o.mean,a=o.variance;return[cc(n,i,a,t,e,r),i,a]})}function dM(n,e,t,s,r=.001){return ce(()=>{const o=bm(n,s),i=o.mean,a=o.variance,c=[];for(const m of yr(0,n.rank))s.indexOf(m)!==-1?c.push(1):c.push(n.shape[m]);const l=ee(i,c),d=ee(a,c),h=e==null?null:ee(e,c),p=t==null?null:ee(t,c);return[cc(n,l,d,p,h,r),i,a]})}function hM(n,e,t,s,r=.001){return en(s.slice().sort(),yr(0,n.rank-1))?uM(n,e,t,s,r):dM(n,e,t,s,r)}class fS extends Vt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=yn(e.betaInitializer||"zeros"),this.gammaInitializer=yn(e.gammaInitializer||"ones"),this.movingMeanInitializer=yn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=yn(e.movingVarianceInitializer||"ones"),this.betaConstraint=Ln(e.betaConstraint),this.gammaConstraint=Ln(e.gammaConstraint),this.betaRegularizer=bn(e.betaRegularizer),this.gammaRegularizer=bn(e.gammaRegularizer)}build(e){e=Qt(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new H(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Fn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ce(()=>{const s=t.training==null?!1:t.training,r=Tt(e),o=r.shape,i=o.length,a=yr(0,i),c=this.axis>=0?this.axis:this.axis+i;a.splice(c,1);const l=xi(1,i);l[c]=o[c];const d=a.slice();d.sort();const h=!en(d,yr(0,i).slice(0,i-1)),p=()=>{if(h){const b=ee(this.movingMean.read(),l),v=ee(this.movingVariance.read(),l),w=this.center?ee(this.beta.read(),l):null,S=this.scale?ee(this.gamma.read(),l):null;return cc(r,b,v,w,S,this.epsilon)}else return cc(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[f,m,g]=hM(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(b,v,w)=>{ce(()=>{const S=1-w,N=b.read(),C=q(kt(N,v),S);b.write(kt(N,C))})};return(()=>{x(this.movingMean,m,this.momentum),x(this.movingVariance,g,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sn(this.betaInitializer),gammaInitializer:Sn(this.gammaInitializer),movingMeanInitializer:Sn(this.movingMeanInitializer),movingVarianceInitializer:Sn(this.movingVarianceInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer),betaConstraint:On(this.betaConstraint),gammaConstraint:On(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}fS.className="BatchNormalization";Re(fS);class mS extends Vt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=yn(e.betaInitializer||"zeros"),this.gammaInitializer=yn(e.gammaInitializer||"ones"),this.betaRegularizer=bn(e.betaRegularizer),this.gammaRegularizer=bn(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Qt(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==vo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=Tt(e),r=s.shape,o=r.length;return ce(()=>{let{mean:a,variance:c}=bm(s,this.axis,!0);const l=xi(1,o);for(const g of this.axis)l[g]=r[g];const d=g=>g!=null&&g.shape.length!==o?ee(g,l):g;let h=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const f=[],m=[];for(let g=0;g<o;++g)this.axis.indexOf(g)!==-1?(f.push(r[g]),m.push(1)):(f.push(1),m.push(r[g]));return a=fr(a,f),c=fr(c,f),h!=null&&(h=fr(h,m)),p!=null&&(p=fr(p,m)),cc(s,a,c,p,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sn(this.betaInitializer),gammaInitializer:Sn(this.gammaInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}mS.className="LayerNormalization";Re(mS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pM(n,e,t){return ce(()=>{if(n.rank!==4)throw new H(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new H("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=br()),t!=="channelsLast"&&t!=="channelsFirst")throw new H(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],wm(n,s)})}class gS extends Vt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?br():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new H(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new H(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new H(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new Fn({ndim:4})]}computeOutputShape(e){e=Qt(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return ce(()=>pM(Tt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}gS.className="ZeroPadding2D";Re(gS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vh(n,e,t,s,r,o){return ce(()=>{An(r),_v(o),Ws(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=br()),o==null&&(o="max"),n=Rg(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=ym(n,e,t,a):i=cm(n,e,t,a),r==="channelsFirst"&&(i=Ht(i,[0,3,1,2])),i})}function xS(n,e,t,s,r,o){return ce(()=>{An(r),_v(o),Ws(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=br()),o==null&&(o="max"),n=j1(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=vA(n,e,t,a):i=C2(n,e,t,a),r==="channelsFirst"&&(i=Ht(i,[0,4,1,2,3])),i})}class yS extends Vt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new H(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Gn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new H(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ws(this.padding),this.inputSpec=[new Fn({ndim:3})]}computeOutputShape(e){e=Qt(e);const t=xr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ce(()=>{this.invokeCallHook(e,t),e=vl(Tt(e),2);const s=this.poolingFunction(Tt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ml(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class bS extends yS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),vh(e,t,s,r,o,"max")}}bS.className="MaxPooling1D";Re(bS);class wS extends yS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),vh(e,t,s,r,o,"avg")}}wS.className="AveragePooling1D";Re(wS);class vS extends Vt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new H(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),Ws(this.padding),this.inputSpec=[new Fn({ndim:4})]}computeOutputShape(e){e=Qt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=xr(t,this.poolSize[0],this.padding,this.strides[0]),s=xr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return ce(()=>(this.invokeCallHook(e,t),this.poolingFunction(Tt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class SS extends vS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),vh(e,t,s,r,o,"max")}}SS.className="MaxPooling2D";Re(SS);class CS extends vS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),vh(e,t,s,r,o,"avg")}}CS.className="AveragePooling2D";Re(CS);class NS extends Vt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new H(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Gn(this.poolSize,"poolSize"),Gn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),Ws(this.padding),this.inputSpec=[new Fn({ndim:5})]}computeOutputShape(e){e=Qt(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=xr(t,this.poolSize[0],this.padding,this.strides[0]),s=xr(s,this.poolSize[1],this.padding,this.strides[1]),r=xr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return ce(()=>(this.invokeCallHook(e,t),this.poolingFunction(Tt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class IS extends NS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),xS(e,t,s,r,o,"max")}}IS.className="MaxPooling3D";Re(IS);class kS extends NS{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return An(o),Ws(r),xS(e,t,s,r,o,"avg")}}kS.className="AveragePooling3D";Re(kS);class $S extends Vt{constructor(e){super(e),this.inputSpec=[new Fn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Ot}}class TS extends $S{constructor(e){super(e||{})}call(e,t){return ce(()=>{const s=Tt(e);return Dn(s,1)})}}TS.className="GlobalAveragePooling1D";Re(TS);class AS extends $S{constructor(e){super(e||{})}call(e,t){return ce(()=>{const s=Tt(e);return gr(s,1)})}}AS.className="GlobalMaxPooling1D";Re(AS);class ES extends Vt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,An(this.dataFormat),this.inputSpec=[new Fn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Ot}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class RS extends ES{call(e,t){return ce(()=>{const s=Tt(e);return this.dataFormat==="channelsLast"?Dn(s,[1,2]):Dn(s,[2,3])})}}RS.className="GlobalAveragePooling2D";Re(RS);class DS extends ES{call(e,t){return ce(()=>{const s=Tt(e);return this.dataFormat==="channelsLast"?gr(s,[1,2]):gr(s,[2,3])})}}DS.className="GlobalMaxPooling2D";Re(DS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _S extends Vt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=zr(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class PS extends _S{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Qt(e),e.length<3)throw new H(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Qt(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return ce(()=>(e=Tt(e),U1((i,a)=>[Tt(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}PS.className="TimeDistributed";Re(PS);function fM(n){Ti(RP,"BidirectionalMergeMode",n)}const mM="concat";class jS extends _S{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=zr(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=zr(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?mM:e.mergeMode,fM(this.mergeMode),e.weights)throw new Ot("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):ms(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=V1(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],a=[];if(s!=null){const l=s.length;if(l%2>0)throw new H("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(h=>new Fn({shape:h.shape}));this.forwardLayer.stateSpec=d.slice(0,l/2),this.backwardLayer.stateSpec=d.slice(l/2),a.push(...d)}if(r!=null)throw new Ot("Support for constants in Bidirectional layers is not implemented yet.");const c=i[0]instanceof Gr;for(const l of i)if(l instanceof Gr!==c)throw new H("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const l=[e].concat(i),d=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=d;const p=super.apply(l,t);return this.inputSpec=h,p}else return super.apply(e,t)}call(e,t){return ce(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const c=s.slice(0,s.length/2),l=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:c})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:l}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=mi(o,1));let a;return this.mergeMode==="concat"?a=yg([r,o]):this.mergeMode==="sum"?a=Pe(r,o):this.mergeMode==="ave"?a=q(.5,Pe(r,o)):this.mergeMode==="mul"?a=q(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ni(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ni(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=zr(t.layer);if(delete t.layer,t.numConstants!=null)throw new Ot("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}jS.className="Bidirectional";Re(jS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class MS extends Vt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ce(()=>(e=Tt(e),e.dtype!=="float32"&&(e=Or(e,"float32")),Pe(q(e,this.scale),this.offset)))}}MS.className="Rescaling";Re(MS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:gM,cropAndResize:xM}=Jr;class FS extends Vt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,i,a,c){return ce(()=>{let l,d=!1;const h=t/i,p=s/a,f=(r+t)/i,m=(o+s)/a,g=[h,p,f,m],x=[];e.rank===3?(d=!0,l=to([e])):l=e;for(let S=0;S<l.shape[0];S++)x.push(g);const y=Yi(x,[x.length,4]),b=oc(0,x.length,1,"int32"),w=xM(l,y,b,[r,o],"nearest");return Or(d?Tt(gi(w)):w,c)})}upsize(e,t,s,r){return ce(()=>{const o=gM(e,[t,s]);return Or(o,r)})}call(e,t){return ce(()=>{const s=Tt(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let c=0;i!==this.height&&(c=Math.floor((i-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),c>=0&&l>=0?this.centerCrop(s,c,l,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Qt(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}FS.className="CenterCrop";Re(FS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yM(n,e,t,s){let r=Tt(n);if(r.dtype!=="int32"&&(r=Or(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=fs(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=fs(r,-1)),r.rank>2)throw new H(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let c;if(typeof s<"u"&&e==="count"?c=sx(a,s,t,i):c=sx(a,[],t,i),e!=="tfIdf")return c;if(s)return q(c,s);throw new H("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class OS extends Vt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Qt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ce(()=>{e=Tt(e),e.dtype!=="int32"&&(e=Or(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new H(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=Tt(t.countWeights)}const r=gr(e),o=pu(e),i=zs(this.numTokens,r).bufferSync().get(0),a=Ni(o,0).bufferSync().get(0);if(!(i&&a))throw new H(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return yM(e,this.outputMode,this.numTokens,s)})}}OS.className="CategoryEncoding";Re(OS);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bM=["bilinear","nearest"],Ox=new Set(bM);class LS extends Vt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(Ox.has(e.interpolation))this.interpolation=e.interpolation;else throw new H(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Qt(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ce(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Jr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Jr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...Ox]} are supported`)})}}LS.className="Resizing";Re(LS);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zS{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}zS.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class WS extends Vt{constructor(e){super(e),this.randomGenerator=new zS(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}WS.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wM=["bilinear","nearest"],Lx=new Set(wM);class BS extends WS{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new H(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new H(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new H(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(Lx.has(s))this.interpolation=s;else throw new H(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Qt(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ce(()=>{const s=Tt(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=fl([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Jr.resizeBilinear(e,i);case"nearest":return Jr.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...Lx]} are supported`)}})}}BS.className="RandomWidth";Re(BS);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tp(n){return new Mg(n)}function vM(n){return new wh(n)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM=fe();SM.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var zx;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(zx||(zx={}));var Wx;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(Wx||(Wx={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Bx;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Bx||(Bx={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ct(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&E(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CM=Fw;class Sh extends uf{nextDataId(){return Sh.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new rb(this,kr())}write(e,t,s){this.firstUse&&(this.firstUse=!1,fe().get("IS_NODE")&&Ms(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&gc(s[0])){const o=s.map(i=>wo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return no(r,o)}return $k(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Io(r));return Wt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Wt(e.shape,e.dtype,t)}makeOutput(e,t,s){return kr().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=ps();return e(),{kernelMs:ps()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ct([e],"where");const t=this.readSync(e.dataId);return CM(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Sh.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VS(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const NM=n=>{const{x:e}=n.inputs,t=n.backend;ct(e,"abs");let s=new Float32Array(we(e.shape));const r=t.data.get(e.dataId).values;return s=VS(r),t.makeOutput(s,e.shape,e.dtype)},IM={kernelName:Ju,backendName:"cpu",kernelFunc:NM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function En(n){return(e,t,s,r,o)=>{const i=_t(e,t),a=i.length,c=xt(i),l=we(i),d=Jn(o,l),h=e.length,p=t.length,f=xt(e),m=xt(t),g=ca(e,i),x=ca(t,i);if(g.length+x.length===0)for(let y=0;y<d.length;++y)d[y]=n(s[y%s.length],r[y%r.length]);else for(let y=0;y<d.length;++y){const b=wa(y,a,c),v=b.slice(-h);g.forEach(C=>v[C]=0);const w=jr(v,h,f),S=b.slice(-p);x.forEach(C=>S[C]=0);const N=jr(S,p,m);d[y]=n(s[w],r[N])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $s(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),c=t.data.get(a.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},a}const kM={kernelName:Cf,backendName:"cpu",kernelFunc:$s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tu(n,e,t="float32"){if(t==="complex64"){const r=Tu(n,e,"float32"),o=Tu(n,e,"float32");return $s({inputs:{real:r,imag:o},backend:n})}const s=Zn(we(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const $M={kernelName:Fc,backendName:"cpu",kernelFunc:Hr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yi(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const TM={kernelName:qf,backendName:"cpu",kernelFunc:yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=Ci([0],t),[o,i]=En((a,c)=>a!==c?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function Eo(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Hr({inputs:{x:r},backend:t});const d=Tu(t,r.shape,r.dtype),h=Eo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=$s({inputs:{real:h,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),p}if(r.dtype==="complex64"){const d=yi({inputs:{input:r},backend:t}),h=Eo({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),h}if(!ab(r.dtype,o)){const d=Hr({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[a,c,l]=US(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}const AM={kernelName:Nc,backendName:"cpu",kernelFunc:Eo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;ct([i,a],n);const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=i.dtype==="string"?so(l):l,p=i.dtype==="string"?so(d):d,f=s||i.dtype,[m,g]=e(i.shape,a.shape,h,p,f);return c.makeTensorInfo(g,f,m)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,c=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const l=Eo({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),d=c.data.get(l.dataId),h=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,f=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,g=Eo({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),x=c.data.get(g.dataId),y=x.complexTensorInfos.real,b=x.complexTensorInfos.imag,v=c.data.get(y.dataId).values,w=c.data.get(b.dataId).values,[S,N,C]=t(i.shape,a.shape,f,m,v,w),k=c.makeTensorInfo(C,"float32",S),I=c.makeTensorInfo(C,"float32",N),$=$s({inputs:{real:k,imag:I},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(k),c.disposeIntermediateTensorInfo(I),$}else{const l=c.data.get(i.dataId).values,d=c.data.get(a.dataId).values,h=s||i.dtype,[p,f]=e(i.shape,a.shape,l,d,h);return c.makeTensorInfo(f,h,p)}}}function Fg(n){return(e,t,s,r,o,i)=>{const a=_t(e,t),c=we(a),l=a.length,d=xt(a),h=Jn("float32",c),p=Jn("float32",c),f=ca(e,a),m=ca(t,a),g=no(s,r),x=no(o,i),y=e.length,b=xt(e),v=t.length,w=xt(t);if(f.length+m.length===0)for(let S=0;S<h.length;S++){const N=S%g.length,C=S%x.length,k=n(g[N*2],g[N*2+1],x[C*2],x[C*2+1]);h[S]=k.real,p[S]=k.imag}else for(let S=0;S<h.length;S++){const N=wa(S,l,d),C=N.slice(-y);f.forEach(P=>C[P]=0);const k=jr(C,y,b),I=N.slice(-v);m.forEach(P=>I[P]=0);const $=jr(I,v,w),j=n(g[k*2],g[k*2+1],x[$*2],x[$*2+1]);h[S]=j.real,p[S]=j.imag}return[h,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GS=En((n,e)=>n+e),EM=Fg((n,e,t,s)=>({real:n+t,imag:e+s})),ha=Wn(va,GS,EM),RM={kernelName:va,backendName:"cpu",kernelFunc:ha};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Og(n,e,t,s,r){const o=we(s),i=Zn(r,t);for(let a=0;a<n.length;a++){const c=n[a];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(o>0?i[c]+=e[a]:i[c]+=1)}return i}function HS(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=Wt([r,t],e.dtype);for(let a=0;a<r;a++)for(let c=0;c<o;c++){const l=n.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(s?i.set(1,a,l):e.size>0?i.set(i.get(a,l)+e.get(a,c),a,l):i.set(i.get(a,l)+1,a,l))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qS=En((n,e)=>n&e),DM=Wn(Sf,qS),_M={kernelName:Sf,backendName:"cpu",kernelFunc:DM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qr(n){return(e,t,s)=>{const r=In(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(n,e,t){const s=qr(e);return zo(n,s,t)}function zo(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;ct(i,n);const a=o,c=a.data.get(i.dataId).values;let l;if(i.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=so(c)}else l=c;const d=t||i.dtype,h=e(l,d,r);return a.makeTensorInfo(i.shape,d,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KS=qr(n=>Math.ceil(n)),PM=zo(Ic,KS),jM={kernelName:Ic,backendName:"cpu",kernelFunc:PM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XS(n,e,t,s){const r=In(t,we(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const a=we(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?so(i.vals):i.vals;let c=0;for(let l=0;l<i.shape[0];++l){const d=l*e[1]+o;for(let h=0;h<i.shape[1];++h)r[d+h]=a[c++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS=En((n,e)=>n===e?1:0),YS=Wn(pd,QS,null,"bool"),MM={kernelName:pd,backendName:"cpu",kernelFunc:YS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JS=qr(n=>Math.exp(n)),ZS=zo(Dc,JS,"float32"),FM={kernelName:Dc,backendName:"cpu",kernelFunc:ZS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eC=qr(n=>Math.expm1(n)),OM=zo(_c,eC),LM={kernelName:_c,backendName:"cpu",kernelFunc:OM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tC=qr(n=>Math.floor(n)),zM=zo(Pc,tC),WM={kernelName:Pc,backendName:"cpu",kernelFunc:zM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nC=En((n,e)=>Math.floor(n/e)),BM=Wn(jc,nC,null,"int32"),VM={kernelName:jc,backendName:"cpu",kernelFunc:BM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sC(n,e,t,s,r,o,i,a,c){const l=Wt([s,o],t);for(let d=0;d<s;d++){const h=[];let p=0;for(let f=0;f<r;f++){const m=n[d*r+f];p+=m*i[f],h.push(m)}if(p<0||p>=c/o)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let f=0;f<o;f++)l.values[d*o+f]=e.get(...e.indexToLoc(p*o+f))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rC(n,e,t){const s=Wt(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],c=i[2],l=e.locToIndex([a,c]);i[2]=e.values[l];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oC=En((n,e)=>n>e?1:0),UM=Wn(xd,oC,null,"bool"),GM={kernelName:xd,backendName:"cpu",kernelFunc:UM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iC=En((n,e)=>n>=e?1:0),HM=Wn(Mc,iC,null,"bool"),qM={kernelName:Mc,backendName:"cpu",kernelFunc:HM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aC=En((n,e)=>n<e?1:0),KM=Wn(bd,aC,null,"bool"),XM={kernelName:bd,backendName:"cpu",kernelFunc:KM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cC=En((n,e)=>n<=e?1:0),QM=Wn(wd,cC,null,"bool"),YM={kernelName:wd,backendName:"cpu",kernelFunc:QM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lC(n,e,t){const s=(e-n)/(t-1),r=Zn(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC=qr(n=>Math.log(n)),JM=zo(Wc,uC),ZM={kernelName:Wc,backendName:"cpu",kernelFunc:JM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dC(n,e,t,s){const r=Jn(s,we(t));for(let o=0;o<r.length;++o){const i=o*e;let a=n[i];for(let c=0;c<e;++c){const l=n[i+c];(Number.isNaN(l)||l>a)&&(a=l)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hC=En((n,e)=>Math.max(n,e)),eF=Wn(Vc,hC),tF={kernelName:Vc,backendName:"cpu",kernelFunc:eF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pC=En((n,e)=>Math.min(n,e)),nF=Wn(Uc,pC),sF={kernelName:Uc,backendName:"cpu",kernelFunc:nF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lg=En((n,e)=>n*e),rF=Fg((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),Ch=Wn(Hc,Lg,rF),oF={kernelName:Hc,backendName:"cpu",kernelFunc:Ch};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fC(n,e,t){const s=Do(-1,t);return Lg([],e,s,n,t)}function iF(n){const{inputs:e,backend:t}=n,{x:s}=e;ct(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=fC(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const aF={kernelName:Rd,backendName:"cpu",kernelFunc:iF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mC=En((n,e)=>n!==e?1:0),cF=Wn(Dd,mC,null,"bool"),lF={kernelName:Dd,backendName:"cpu",kernelFunc:cF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zg(n,e,t,s,r){const o=e.length,i=we(e),a=xt(e),c=xt(r),l=Jn(t,we(r));for(let d=0;d<i;++d){const h=wa(d,o,a),p=new Array(h.length);for(let m=0;m<p.length;m++)p[m]=h[s[m]];const f=jr(p,o,c);l[f]=n[d]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bs(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;ct(r,"transpose");const i=r.shape.length,a=new Array(i);for(let h=0;h<a.length;h++)a[h]=r.shape[o[h]];const c=s.data.get(r.dataId).values,l=zg(c,r.shape,r.dtype,o,a);return{dataId:s.write(l,a,r.dtype),shape:a,dtype:r.dtype}}const uF={kernelName:Qi,backendName:"cpu",kernelFunc:bs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gC(n,e,t,s){const[r,o]=Hn(n,s),i=Rs(e,"int32"),a=Zn(we(r),i),c=we(o);for(let l=0;l<a.length;++l){const d=l*c;let h=1;for(let p=0;p<c;++p)h*=t[d+p];a[l]=h}return{outVals:a,outShape:r,outDtype:i}}function dF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"prod");const a=r.shape.length,c=Bt(o,r.shape),l=Cn(c,a);let d=c,h=r;const p=[];l!=null&&(h=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),p.push(h),d=Tn(d.length,a));const f=t.data.get(h.dataId).values,{outVals:m,outShape:g,outDtype:x}=gC(h.shape,h.dtype,f,d);let y=g;return i&&(y=_n(g,c)),p.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.makeTensorInfo(y,x,m)}const hF={kernelName:Od,backendName:"cpu",kernelFunc:dF};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pF(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=wa(r,e.length,xt(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function fF(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function mF(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);fF(t,s);let c=1;for(let l=0;l<e.length-1;++l){c*=e[l];const d=e[l+1];for(let h=1;h<c+1;++h)a[l].push(h*d)}for(let l=0;l<n.length;++l){let d=n[l],h=n[l]+1;for(let p=0;p<t.length;++p){const f=t[p],m=p+e.length-1;if(m>=0){const g=a[m],x=g[g.length-1]-f[d];for(let y=d;y<h;++y)a[m].push(f[y+1]+x)}d=f[d],h=f[h]}h!==d&&(r.push([d,h]),o+=h-d)}return{outSplits:a,valueSlices:r,numValues:o}}function gF(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=In("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function Vx(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function xF(n,e,t,s,r,o){const i=Vx(e,2)[1],a=Vx(o,2)[1];let c=0;for(const l of t)for(let d=l[0];d<l[1];++d){for(let h=0;h<s;++h)r[c*a+h]=n[d*i+h];++c}}function yF(n,e,t,s,r){const o=e.slice();o[0]=r;const i=In(t,we(o)),a=n.length,c=a===0?0:a/e[0];return xF(n,e,s,c,i,o),[i,o]}function xC(n,e,t,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(pF(o,i,c),s.length===0)throw new Error("params.rank must be nonzero");const l=s[0],{outSplits:d,valueSlices:h,numValues:p}=mF(o,i,n,l),f=gF(d),m=yF(t,s,r,h,p);return[f,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ux=2147483647;function yC(n,e,t,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,c=r.length===0,l=i.length===0,d=[];a||d.push(e[0]),c||d.push(r[0]),l||d.push(i[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const h=d.length===0?1:d[0],p=In("int32",h+1);p[0]=0;for(let x=0;x<h;++x){const y=a?n[0]:n[x],b=c?s[0]:s[x],v=l?o[0]:o[x];if(v===0)throw new Error("Requires delta != 0");let w;if(v>0&&b<y||v<0&&b>y)w=0;else if(w=Math.ceil(Math.abs((b-y)/v)),w>Ux)throw new Error(`Requires ((limit - start) / delta) <= ${Ux}`);p[x+1]=p[x]+w}const f=p[h],m=In(t,f);let g=0;for(let x=0;x<h;++x){const y=p[x+1]-p[x];let b=a?n[0]:n[x];const v=l?o[0]:o[x];for(let w=0;w<y;++w)m[g++]=b,b+=v}return[p,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Us=hr;class Au{constructor(e,t,s,r,o,i,a,c,l,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=rv(d),this.raggedRank=ov(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Us.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Us.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Us.VALUE_ROWIDS:return Au.getMaxWidthValueRowID(t);case Us.ROW_SPLITS:return Au.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Us[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Hx(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;iv(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=sv(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=t)o.push(i);for(let a=r;a<e;++a)o.push(-1);return E(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const c=e[a+1]-e[a];let l=Math.min(r,c),d=t[a];d===-1&&(l=0);for(let h=0;h<l;++h)i.push(d),d+=s;for(let h=0;h<c-l;++h)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let l=t[c];i.push(l);for(let d=1;d<o;++d){const h=e[d];if(h===c)l>=0&&(++a,a<r?l+=s:l=-1);else{if(a=0,c=h,h>=t.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${t.length}`);l=t[h]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Us.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case Us.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${Us[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Us.FIRST_DIM_SIZE:return e[0];case Us.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Us.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Us[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*s[c+1];const o=Hx(s,!1),i=In(this.valuesDType,we(o));if(r[0]*s[0]>0){let c=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,r[l],s[l]);this.setOutput(this.raggedRank,c,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const c=we(a),l=t.length;let d=this.defaultValue;if(d.length!==c&&d.length!==1){const m=this.defaultValueShape;ce(()=>{const g=ee(d,m);d=Ja(g,a).dataSync()})}let h=0,p=0,f=0;for(let m=0;m<=l;++m){let g=m<l?t[m]:-1;if(g===f){++f;continue}if(p<f){const x=o.subarray(h*c),y=i.subarray(p*c),b=(f-p)*c;Gx(y,x,b)}if(m>=l){const x=s.length;g=Math.floor(x/c)}if(g>f)if(this.defaultValue.length===1)i.subarray(f*c,g*c).fill(this.defaultValue[0]),f=g;else for(;g>f;){const x=i.slice(f*c);Gx(x,d,c),++f}g<0?(h=m+1,p=f):(h=m,p=f,f=p+1)}}}function Gx(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function Hx(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function bC(n,e,t,s,r,o,i,a,c,l){return new Au(n,e,t,s,r,o,i,a,c,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wC(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return Zn(0,s);const a=Math.abs(Math.ceil((e-n)/t)),c=Zn(a,s);e<n&&t===1&&(t=-1),c[0]=n;for(let l=1;l<c.length;l++)c[l]=c[l-1]+t;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vC=qr(n=>1/Math.sqrt(n)),bF=zo(Jc,vC),wF={kernelName:Jc,backendName:"cpu",kernelFunc:bF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zo(n,e,t,s,r,o,i,a,c,l){const d=[s/r,r],h=n.values,p=e.values;if(s===0)return Wt(t,e.dtype);const f=c instanceof Kn?c:Wt(d,e.dtype);typeof c=="string"||typeof c=="number"?f.values.fill(c):typeof c=="boolean"&&f.values.fill(+c);for(let m=0;m<o;m++){const g=[];let x=0;for(let y=0;y<i;y++){const b=h[m*i+y];g.push(b),x+=b*a[y]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${t}`);for(let y=0;y<r;y++)l?f.values[x*r+y]+=p[m*r+y]:f.values[x*r+y]=e.rank===0?p[0]:p[m*r+y]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vF=qr(n=>1/(1+Math.exp(-n))),SC=on(sl,n=>1/(1+Math.exp(-n))),SF={kernelName:sl,backendName:"cpu",kernelFunc:SC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CC(n,e,t,s,r){const o=qm(s,e,t),i=we(t),a=xt(s);if(o){const h=Km(e,a);return r==="string"?n.slice(h,h+i):n.subarray(h,h+i)}const c=r==="string"?so(n):n,l=Wt(s,r,c),d=Wt(t,r);for(let h=0;h<d.size;++h){const p=d.indexToLoc(h),f=p.map((m,g)=>m+e[g]);d.set(l.get(...f),...p)}return r==="string"?kv(d.values):d.values}function bi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;ct(r,"slice");const[a,c]=ah(r,o,i);Gm(r,a,c);const l=t.data.get(r.dataId).values,d=CC(l,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,d)}const CF={kernelName:Ud,backendName:"cpu",kernelFunc:bi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NC(n,e,t,s,r,o,i){const a=e[0],c=o[0],l=new Array(c),d=new Array(a),h=e[1];if(c===0){if(a!==0)throw new Error(pv(a));const x=In(t,0),y=In(r,0);return[x,[0,h],y,l,d]}let p=!0,f=0;const m=new Array(c).fill(0);for(let x=0;x<a;++x){const y=n[x*h];if(y<0)throw new Error(fv(x,y));if(y>=c)throw new Error(mv(x,y,c));++m[y],p=p&&y>=f,f=y}let g=!0;for(let x=0;x<c;++x){const y=m[x]===0;l[x]=y,g=g&&!y,m[x]=Math.max(m[x],1),x>0&&(m[x]+=m[x-1])}if(g&&p){const x=n,y=s;for(let b=0;b<a;++b)d[b]=b;return[x,[a,h],y,l,d]}else{const x=m[c-1],y=In(t,x*h),b=In(r,x),v=new Array(c).fill(0);for(let w=0;w<a;++w){const S=n[w*h],N=v[S],C=(S===0?0:m[S-1])+N;v[S]++;for(let k=0;k<h;++k)y[C*h+k]=n[w*h+k];b[C]=s[w],d[w]=C}for(let w=0;w<c;++w)if(v[w]===0){const N=w===0?0:m[w-1];y[N*h+0]=w;for(let C=1;C<h;++C)y[N*h+C]=0;b[N]=i}return[y,[x,h],b,l,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IC(n,e,t,s,r){const o=we(s),i=e[0],a=r.length,c=[];let l=1,d=-1;for(let x=0;x<a;++x){const y=r[x];if(y===-1){if(d!==-1)throw new Error(gv(d,x));d=x,c.push(1)}else{if(y<0)throw new Error(xv(x,y));l*=y,c.push(y)}}if(d!==-1){if(l<=0)throw new Error(yv());const x=Math.trunc(o/l);if(l*x!==o)throw new Error(bv(s,c));c[d]=x}if(we(c)!==o)throw new Error(wv(s,c));const p=s.length,f=[];if(p>0){f[p-1]=1;for(let x=p-2;x>=0;--x)f[x]=f[x+1]*s[x+1]}const m=[];if(a>0){m[a-1]=1;for(let x=a-2;x>=0;--x)m[x]=m[x+1]*c[x+1]}const g=In(t,i*a);for(let x=0;x<i;++x){let y=0;for(let b=0;b<p;++b)y+=n[x*p+b]*f[b];for(let b=0;b<a;++b)g[x*a+b]=Math.trunc(y/m[b]),y%=m[b]}return[g,[i,a],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wg(n,e,t,s,r,o=!1,i=0){const a=s.length,c=[e[0],n.length/e[0]],l=c[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(Lp());const p=e.slice();p[0]=h;const f=p.reduce((v,w)=>v*w,1),m=In(t,f);if(a===0)return h>0&&m.fill(i),[m,p];if(h<=0)throw new Error(Lp());let g=0,x=1,y=0,b=r[g];for(;;){let v=0;if(x<a){if(v=r[x],b===v){++x;continue}if(b>=v)throw new Error(vv())}if(b<0||b>=h)throw new Error(Sv(b,h));b>y&&m.fill(i,y*l,b*l);for(let w=g;w<x;++w){const S=s[w];if(S<0||S>=c[0])throw new Error(Cv(w,s[w],c[0]));for(let N=0;N<l;N++)m[b*l+N]+=n[S*l+N]}if(o)for(let w=0;w<l;w++)m[b*l+w]/=x-g;if(g=x,++x,y=b+1,b=v,x>a)break}return y<h&&m.fill(i,y*l,h*l),[m,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NF=qr(n=>Math.sqrt(n)),IF=on(ol,n=>Math.sqrt(n)),kF={kernelName:ol,backendName:"cpu",kernelFunc:IF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kC=En((n,e)=>{const t=n-e;return t*t}),$F=Wn(il,kC),TF={kernelName:il,backendName:"cpu",kernelFunc:$F};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $C=qr((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),AF=zo(Yf,$C),EF={kernelName:Yf,backendName:"cpu",kernelFunc:AF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TC(n,e,t,s){const r=Wt(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let c=0;c<a.length;c++)a[c]=i[c]*t[c]+s[c];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RF{constructor(e,t,s,r,o,i){this.separator=wo(e),this.nGramWidths=t,this.leftPad=wo(s),this.rightPad=wo(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let a=0;a<o;++a){const c=this.getPadWidth(i),l=Math.max(0,c-a),d=Math.max(0,c-(o-(a+1))),h=i-(l+d),p=t+(l>0?0:a-c);let f=0;f+=l*this.leftPad.length;for(let b=0;b<h;++b)f+=e[p+b].length;f+=d*this.rightPad.length;const m=l+d+h-1;f+=m*this.separator.length,s[r+a]=new Uint8Array(f);const g=s[r+a];let x=0;const y=b=>b.forEach(v=>g[x++]=v);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<h-1;++b)y(e[p+b]),y(this.separator);if(h>0){y(e[p+h-1]);for(let b=0;b<d;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<d-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<r;++l){let d=t[l]>=c;if(d=d&&t[l]<=s,!d)throw new Error(`Invalid split value ${t[l]}, must be in [${c}, ${s}]`);c=t[l]}if(c!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${c}`)}const o=r-1,i=In("int32",r);if(s===0||r===0){const c=new Array(s);for(let l=0;l<=o;++l)i[l]=0;return[c,i]}i[0]=0;for(let c=1;c<=o;++c){const l=t[c]-t[c-1];let d=0;this.nGramWidths.forEach(h=>{d+=this.getNumNGrams(l,h)}),this.preserveShort&&l>0&&d===0&&(d=1),i[c]=i[c-1]+d}const a=new Array(i[o]);for(let c=0;c<o;++c){const l=t[c];let d=i[c];if(this.nGramWidths.forEach(h=>{const p=t[c+1]-t[c],f=this.getNumNGrams(p,h);this.createNGrams(e,l,a,d,f,h),d+=f}),this.preserveShort&&d===i[c]){const h=t[c+1]-t[c];if(h===0)continue;const p=h+2*this.padWidth;this.createNGrams(e,l,a,d,1,p)}}return[a,i]}}function AC(n,e,t,s,r,o,i,a){return new RF(t,s,r,o,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DF(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function EC(n,e,t){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let p=0;p<s;++p){const f=r.length;DF(n[p],e,t,r);const m=r.length-f;a[p]=m,o+=m,i=Math.max(i,m)}const c=In("int32",o*2),l=new Array(o),d=[s,i];let h=0;for(let p=0;p<s;++p)for(let f=0;f<a[p];++f)c[h*2]=p,c[h*2+1]=f,l[h]=r[h],++h;return[c,l,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RC(n,e){const t=In("int32",n.length);for(let s=0;s<n.length;++s)t[s]=Hk(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DC=En((n,e)=>n-e),_F=Fg((n,e,t,s)=>({real:n-t,imag:e-s})),Bg=Wn(al,DC,_F),PF={kernelName:al,backendName:"cpu",kernelFunc:Bg};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _C(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=Wt(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let c=0;c<i.length;c++)i[c]=o[c]%n.shape[c];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ga=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function PC(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,c=e-t+1,l=Math.log(a),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(a-d)/a)*Math.sign(c-a/2),p=Math.max(t,Math.floor(e-c*d/a+h)),f=Math.min(s,Math.floor(e+(a-c)*d/a+h));PC(n,e,p,f)}const r=n[e];let o=t,i=s;for(Vi(n,t,e),Ga(n[s],r)>0&&Vi(n,t,s);o<i;){for(Vi(n,o,i),o++,i--;Ga(n[o],r)<0;)o=o+1;for(;Ga(n[i],r)>0;)i=i-1}Ga(n[t],r)===0?Vi(n,t,i):(i=i+1,Vi(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function jC(n,e,t,s,r){const o=e[e.length-1],[i,a]=[n.length/o,o],c=Jn(t,i*s),l=Jn("int32",i*s);for(let h=0;h<i;h++){const p=h*a,f=n.subarray(p,p+a);let m=new Array(f.length);f.forEach((b,v)=>m[v]={value:b,index:v}),s<m.length&&(PC(m,s),m=m.slice(0,s)),r&&m.sort(Ga);const g=h*s,x=c.subarray(g,g+s),y=l.subarray(g,g+s);for(let b=0;b<s;b++)x[b]=m[b].value,y[b]=m[b].index}const d=e.slice();return d[d.length-1]=s,[Wt(d,t,c),Wt(d,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MC(n,e,t,s){const r=Bt(e,t)[0],o=[1,t[0],1];for(let m=0;m<r;m++)o[0]*=t[m];o[1]=t[r];for(let m=r+1;m<t.length;m++)o[2]*=t[m];const i=new Map,a=new Int32Array(t[r]),c=new Kn(o,s,n),l=[],d=o[0]===1&&o[2]===1;for(let m=0;m<t[r];m++){let g;if(d)g=n[m].toString();else{const y=[];for(let b=0;b<o[0];b++)for(let v=0;v<o[2];v++)y.push(c.get(b,m,v));g=y.join(",")}const x=i.get(g);if(x!=null)a[m]=x;else{const y=i.size;i.set(g,y),a[m]=y,l.push(m)}}const h=o.slice();h[1]=i.size;const p=new Kn(h,s);l.forEach((m,g)=>{for(let x=0;x<o[0];x++)for(let y=0;y<o[2];y++)p.set(c.get(x,m,y),x,g,y)});const f=t.slice();return f[r]=h[1],{outputValues:p.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jF=Object.freeze(Object.defineProperty({__proto__:null,addImpl:GS,bincountImpl:Og,bincountReduceImpl:HS,bitwiseAndImpl:qS,castImpl:US,ceilImpl:KS,concatImpl:XS,equalImpl:QS,expImpl:JS,expm1Impl:eC,floorDivImpl:nC,floorImpl:tC,gatherNdImpl:sC,gatherV2Impl:rC,greaterEqualImpl:iC,greaterImpl:oC,lessEqualImpl:cC,lessImpl:aC,linSpaceImpl:lC,logImpl:uC,maxImpl:dC,maximumImpl:hC,minimumImpl:pC,multiplyImpl:Lg,negImpl:fC,notEqualImpl:mC,prodImpl:gC,raggedGatherImpl:xC,raggedRangeImpl:yC,raggedTensorToTensorImpl:bC,rangeImpl:wC,rsqrtImpl:vC,scatterImpl:Zo,sigmoidImpl:vF,simpleAbsImpl:VS,sliceImpl:CC,sparseFillEmptyRowsImpl:NC,sparseReshapeImpl:IC,sparseSegmentReductionImpl:Wg,sqrtImpl:NF,squaredDifferenceImpl:kC,staticRegexReplaceImpl:$C,stridedSliceImpl:TC,stringNGramsImpl:AC,stringSplitImpl:EC,stringToHashBucketFastImpl:RC,subImpl:DC,tileImpl:_C,topKImpl:jC,transposeImpl:zg,uniqueImpl:MC},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ew("cpu",()=>new Sh,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FC=on(Ec,n=>n>=0?n:Math.exp(n)-1),MF={kernelName:Ec,backendName:"cpu",kernelFunc:FC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;ct([r],"leakyRelu");const i=we(r.shape),a=t.data.get(r.dataId).values,c=Jn("float32",i);for(let l=0;l<a.length;l++)c[l]=a[l]<0?o*a[l]:a[l];return t.makeTensorInfo(r.shape,"float32",c)}const FF={kernelName:yd,backendName:"cpu",kernelFunc:OC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OF=En((n,e)=>n<0?e*n:n);function LC(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;ct([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[a,c]=OF(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(c,"float32",a)}const LF={kernelName:Fd,backendName:"cpu",kernelFunc:LC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zC=on(Xc,n=>Math.max(0,n)),zF={kernelName:Xc,backendName:"cpu",kernelFunc:zC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WC=on(Qc,n=>Math.min(Math.max(0,n),6)),WF={kernelName:Qc,backendName:"cpu",kernelFunc:WC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eu(n,e,t,s,r){if(t==="linear")return Hr({inputs:{x:e},backend:n});if(t==="relu")return zC({inputs:{x:e},backend:n});if(t==="elu")return FC({inputs:{x:e},backend:n});if(t==="relu6")return WC({inputs:{x:e},backend:n});if(t==="prelu")return LC({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return OC({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return SC({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=we(r.shape),a=ib(o,i),c=we(a);E(i===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const l=t.data.get(r.dataId);if(l.complexTensorInfos!=null){const d=l.complexTensorInfos.real,h=l.complexTensorInfos.imag;d.shape=a,h.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const BF={kernelName:Ld,backendName:"cpu",kernelFunc:pn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BC(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;ct([r,o],"matMul");const c=r.shape.length,l=o.shape.length,d=i?r.shape[c-2]:r.shape[c-1],h=a?o.shape[l-1]:o.shape[l-2],p=i?r.shape[c-1]:r.shape[c-2],f=a?o.shape[l-2]:o.shape[l-1],m=r.shape.slice(0,-2),g=o.shape.slice(0,-2),x=we(m),y=we(g),v=_t(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([p,f]);E(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const w=i?[x,d,p]:[x,p,d],S=a?[y,f,h]:[y,h,f],N=pn({inputs:{x:r},backend:t,attrs:{shape:w}}),C=pn({inputs:{x:o},backend:t,attrs:{shape:S}}),k=i?N.shape[1]:N.shape[2],I=i?N.shape[2]:N.shape[1],$=a?C.shape[1]:C.shape[2],j=Math.max(x,y),P=t.data.get(N.dataId).values,O=t.data.get(C.dataId).values,A=xt(N.shape),z=xt(C.shape),[L,U,V]=i?[A[0],1,A[1]]:[A[0],A[1],1],[B,Y,K]=a?[1,z[1],z[0]]:[z[1],1,z[0]],pe=I*$,ge=Wt([j,I,$],N.dtype),re=ge.values,ye=t.blockSize;for(let Ae=0;Ae<j;Ae++){const ve=Ae%x,_e=Ae%y;for(let ze=0;ze<I;ze+=ye){const et=Math.min(ze+ye,I);for(let ut=0;ut<$;ut+=ye){const yt=Math.min(ut+ye,$);for(let bt=0;bt<k;bt+=ye){const $t=Math.min(bt+ye,k);for(let ae=ze;ae<et;ae++)for(let le=ut;le<yt;le++){let G=0;for(let oe=bt;oe<$t;oe++){const he=P[ve*L+ae*U+oe*V],Te=O[oe*B+le*Y+_e*K];G+=he*Te}re[Ae*pe+(ae*$+le)]+=G}}}}}return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(C),t.makeTensorInfo(v,ge.dtype,ge.values)}const VF={kernelName:sd,backendName:"cpu",kernelFunc:BC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UF(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;let p,f,m;const g=[];p=BC({inputs:{a:r,b:o},attrs:{transposeA:c,transposeB:l},backend:t}),i&&(f=ha({inputs:{a:p,b:i},backend:t}),g.push(p),p=f),d&&(m=Eu(t,p,d,a,h),g.push(p),p=m);for(const y of g)t.disposeIntermediateTensorInfo(y);return p}const GF={kernelName:au,backendName:"cpu",kernelFunc:UF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HF=on(xc,n=>Math.acos(n)),qF={kernelName:xc,backendName:"cpu",kernelFunc:HF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KF=on(yc,n=>Math.acosh(n)),XF={kernelName:yc,backendName:"cpu",kernelFunc:KF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QF(n){const{inputs:e,backend:t}=n,s=e;ct(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),o=Wt(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const c=r[a];for(let l=0;l<i.length;l++)i[l]+=c[l]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const YF={kernelName:gf,backendName:"cpu",kernelFunc:QF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JF(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"all");const a=Bt(o,r.shape);let c=a;const l=Cn(c,r.shape.length);let d=r;l!=null&&(d=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Qn("all",c,d.shape.length);const[h,p]=Hn(d.shape,c),f=we(p),m=Zn(we(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*f;let v=g[b];for(let w=0;w<f;++w){const S=g[b+w];v=v&&S}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=_n(h,a),b=pn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const ZF={kernelName:xf,backendName:"cpu",kernelFunc:JF};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"any");const a=Bt(o,r.shape);let c=a;const l=Cn(c,r.shape.length);let d=r;l!=null&&(d=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Qn("any",c,d.shape.length);const[h,p]=Hn(d.shape,c),f=we(p),m=Zn(we(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*f;let v=g[b];for(let w=0;w<f;++w){const S=g[b+w];v=v||S}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=_n(h,a),b=pn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const tO={kernelName:yf,backendName:"cpu",kernelFunc:eO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;ct(r,"argMax");let i=Bt(o,r.shape);const a=Cn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=bs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),i=[i[0]],Qn("argMax",i,c.shape.length);const[d,h]=Hn(c.shape,i),p=we(d),f=Zn(p,"int32"),m=we(h),g=t.data.get(c.dataId).values;for(let x=0;x<f.length;++x){const y=x*m;let b=g[y],v=0;for(let w=0;w<m;++w){const S=g[y+w];S>b&&(b=S,v=w)}f[x]=v}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",f)}const sO={kernelName:Zu,backendName:"cpu",kernelFunc:nO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;ct(r,"argMin");let i=Bt(o,r.shape);const a=Cn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=bs({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),i=[i[0]],Qn("argMin",i,c.shape.length);const[d,h]=Hn(c.shape,i),p=we(d),f=Zn(p,"int32"),m=we(h),g=t.data.get(c.dataId).values;for(let x=0;x<f.length;++x){const y=x*m;let b=g[y],v=0;for(let w=0;w<m;++w){const S=g[y+w];S<b&&(b=S,v=w)}f[x]=v}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(d,"int32",f)}const oO={kernelName:ed,backendName:"cpu",kernelFunc:rO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iO=on(bc,n=>Math.asin(n)),aO={kernelName:bc,backendName:"cpu",kernelFunc:iO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cO=on(wc,n=>Math.asinh(n)),lO={kernelName:wc,backendName:"cpu",kernelFunc:cO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uO=on(vc,n=>Math.atan(n)),dO={kernelName:vc,backendName:"cpu",kernelFunc:uO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hO=En((n,e)=>Math.atan2(n,e)),pO=Wn(Cc,hO),fO={kernelName:Cc,backendName:"cpu",kernelFunc:pO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mO=on(Sc,n=>Math.atanh(n)),gO={kernelName:Sc,backendName:"cpu",kernelFunc:mO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vg(n,e,t,s,r,o){const i=r.strideHeight,a=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Wt(r.outShape,t),x=g.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let w=0;w<r.batchSize;++w){const S=w*y,N=w*s[0];for(let C=0;C<r.inChannels;++C)for(let k=0;k<r.outHeight;++k){const I=k*i-p,$=Math.max(0,I),j=Math.min(r.inHeight,d+I),P=S+k*b;for(let O=0;O<r.outWidth;++O){const A=O*a-f,z=Math.max(0,A),L=Math.min(r.inWidth,h+A);let U=m,V=0,B=0;for(let K=$;K<j;K+=c){const pe=N+K*s[1];for(let ge=z;ge<L;ge+=l){const re=pe+ge*s[2],ye=n[re+C];o==="max"&&ye>U?U=ye:o==="avg"&&(V+=ye,B++)}if(isNaN(U))break}const Y=P+O*v+C;x[Y]=o==="avg"?V/B:U}}}return g}function VC(n,e,t,s,r=!1,o=!1){const i=Wt(s.outShape,"int32"),a=s.strideHeight,c=s.strideWidth,l=s.dilationHeight,d=s.dilationWidth,h=s.effectiveFilterHeight,p=s.effectiveFilterWidth,f=s.padInfo.top,m=s.padInfo.left,g=Wt(e,t,n);for(let x=0;x<s.batchSize;++x)for(let y=0;y<s.inChannels;++y)for(let b=0;b<s.outHeight;++b){const v=b*a-f;let w=v;for(;w<0;)w+=l;const S=Math.min(s.inHeight,h+v);for(let N=0;N<s.outWidth;++N){const C=N*c-m;let k=C;for(;k<0;)k+=d;const I=Math.min(s.inWidth,p+C);let $=Number.NEGATIVE_INFINITY,j=-1;for(let P=w;P<S;P+=l){const O=P-v;for(let A=k;A<I;A+=d){const z=A-C,L=g.get(x,P,A,y);L>$&&($=L,r?j=o?((x*s.inHeight+P)*s.inWidth+A)*s.inChannels+y:(P*s.inWidth+A)*s.inChannels+y:j=O*p+z)}}i.set(j,x,b,N,y)}}return i}function UC(n,e,t,s,r,o){const i=r.strideDepth,a=r.strideHeight,c=r.strideWidth,l=r.dilationDepth,d=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,f=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,y=r.padInfo.left,b=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Wt(r.outShape,t),w=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],N=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],k=r.outShape[4];for(let I=0;I<r.batchSize;++I){const $=I*S,j=I*s[0];for(let P=0;P<r.inChannels;++P)for(let O=0;O<r.outDepth;++O){const A=O*i-g;let z=A;for(;z<0;)z+=l;const L=Math.min(r.inDepth,p+A),U=$+O*N;for(let V=0;V<r.outHeight;++V){const B=V*a-x;let Y=B;for(;Y<0;)Y+=d;const K=Math.min(r.inHeight,f+B),pe=U+V*C;for(let ge=0;ge<r.outWidth;++ge){const re=ge*c-y;let ye=re;for(;ye<0;)ye+=h;const Ae=Math.min(r.inWidth,m+re),ve=pe+ge*k;let _e=b,ze=0,et=0;for(let yt=z;yt<L;yt+=l){const bt=j+yt*s[1];for(let $t=Y;$t<K;$t+=d){const ae=bt+$t*s[2];for(let le=ye;le<Ae;le+=h){const G=ae+le*s[3],oe=n[G+P];if(o==="max"&&oe>_e?_e=oe:o==="avg"&&(ze+=oe,et++),isNaN(_e))break}if(isNaN(_e))break}if(isNaN(_e))break}const ut=ve+P;w[ut]=o==="avg"?ze/Math.max(et,1):_e}}}}return v}function xO(n,e){const t=Wt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.front,f=e.padInfo.top,m=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let x=0;x<e.inChannels;++x)for(let y=0;y<e.outDepth;++y){const b=y*s-p;let v=b;for(;v<0;)v+=i;const w=Math.min(e.inDepth,l+b);for(let S=0;S<e.outHeight;++S){const N=S*r-f;let C=N;for(;C<0;)C+=a;const k=Math.min(e.inHeight,d+N);for(let I=0;I<e.outWidth;++I){const $=I*o-m;let j=$;for(;j<0;)j+=c;const P=Math.min(e.inWidth,h+$);let O=Number.NEGATIVE_INFINITY,A=-1;for(let z=v;z<w;z+=i){const L=z-b;for(let U=C;U<k;U+=a){const V=U-N;for(let B=j;B<P;B+=c){const Y=B-$,K=n.get(g,z,U,B,x);K>=O&&(O=K,A=L*d*h+V*d+Y)}}}t.set(A,g,y,S,I,x)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;ct(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&en(d.inShape,d.outShape))h=Hr({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,f=xt(r.shape),m=Vg(p,r.shape,r.dtype,f,d,"avg");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const bO={kernelName:td,backendName:"cpu",kernelFunc:yO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;ct(r,"avgPool3d");const d=io(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,p=UC(h,r.shape,r.dtype,xt(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const vO={kernelName:nd,backendName:"cpu",kernelFunc:wO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;ct([r,o],"avgPool3DGrad");const d=io(o.shape,i,a,1,c,l),h=d.strideDepth,p=d.strideHeight,f=d.strideWidth,m=d.filterDepth,g=d.filterHeight,x=d.filterWidth,y=d.dilationDepth,b=d.dilationHeight,v=d.dilationWidth,w=d.effectiveFilterDepth,S=d.effectiveFilterHeight,N=d.effectiveFilterWidth,C=w-1-d.padInfo.front,k=N-1-d.padInfo.left,I=S-1-d.padInfo.top,$=Wt(o.shape,"float32"),j=1/(m*g*x),P=t.bufferSync(r);for(let O=0;O<d.batchSize;++O)for(let A=0;A<d.inChannels;++A)for(let z=0;z<d.inDepth;++z)for(let L=0;L<d.inHeight;++L)for(let U=0;U<d.inWidth;++U){const V=z-C,B=L-I,Y=U-k;let K=0;for(let pe=0;pe<w;pe+=y){const ge=(V+pe)/h;if(!(ge<0||ge>=d.outDepth||Math.floor(ge)!==ge))for(let re=0;re<S;re+=b){const ye=(B+re)/p;if(!(ye<0||ye>=d.outHeight||Math.floor(ye)!==ye))for(let Ae=0;Ae<N;Ae+=v){const ve=(Y+Ae)/f;if(ve<0||ve>=d.outWidth||Math.floor(ve)!==ve)continue;const _e=P.get(O,ge,ye,ve,A);K+=_e}}}$.set(K*j,O,z,L,U,A)}return t.makeTensorInfo($.shape,$.dtype,$.values)}const CO={kernelName:wf,backendName:"cpu",kernelFunc:SO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;ct([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=tr(i.shape,a,c,1,l),h=d.strideHeight,p=d.strideWidth,f=d.filterHeight,m=d.filterWidth,g=d.dilationHeight,x=d.dilationWidth,y=d.effectiveFilterHeight,b=d.effectiveFilterWidth,v=b-1-d.padInfo.left,w=y-1-d.padInfo.top,S=Wt(i.shape,"float32"),N=1/(f*m),C=t.data.get(r.dataId).values,k=Wt(r.shape,"float32",C);for(let I=0;I<d.batchSize;++I)for(let $=0;$<d.inChannels;++$)for(let j=0;j<d.inHeight;++j)for(let P=0;P<d.inWidth;++P){const O=j-w,A=P-v;let z=0;for(let L=0;L<y;L+=g){const U=(O+L)/h;if(!(U<0||U>=d.outHeight||Math.floor(U)!==U))for(let V=0;V<b;V+=x){const B=(A+V)/p;if(B<0||B>=d.outWidth||Math.floor(B)!==B)continue;const Y=k.get(I,U,B,$);z+=Y}}S.set(z*N,I,j,P,$)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const IO={kernelName:bf,backendName:"cpu",kernelFunc:NO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:c}=e;E(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ct([r,a,c,o,i],"batchNorm");let{varianceEpsilon:l}=s;l==null&&(l=.001);const d=t.data.get(r.dataId).values,h=t.data.get(a.dataId).values,p=t.data.get(c.dataId).values,f=o?t.data.get(o.dataId).values:new Float32Array([1]),m=i?t.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(d.length),x=m.length,y=f.length,b=p.length,v=h.length;let w=0,S=0,N=0,C=0;for(let k=0;k<d.length;++k)g[k]=m[w++]+(d[k]-h[S++])*f[N++]/Math.sqrt(p[C++]+l),w>=x&&(w=0),S>=v&&(S=0),N>=y&&(N=0),C>=b&&(C=0);return t.makeTensorInfo(r.shape,r.dtype,g)}const $O={kernelName:md,backendName:"cpu",kernelFunc:kO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;ct([r],"batchToSpaceND");const a=o.reduce((y,b)=>y*b),c=xl(r.shape,o,a),l=yl(c.length,o.length),d=bl(r.shape,o,a),h=Zm(i,o.length),p=eg(d,i,o.length),f=pn({inputs:{x:r},backend:t,attrs:{shape:c}}),m=bs({inputs:{x:f},backend:t,attrs:{perm:l}}),g=pn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=bi({inputs:{x:g},backend:t,attrs:{begin:h,size:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const AO={kernelName:rd,backendName:"cpu",kernelFunc:TO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=Og(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const RO={kernelName:vf,backendName:"cpu",kernelFunc:EO};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DO(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=_t(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const _O={kernelName:hb,backendName:"cpu",kernelFunc:DO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PO=on(kc,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),jO={kernelName:kc,backendName:"cpu",kernelFunc:PO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MO=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(we(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values;for(let l=0;l<a.length;l++){const d=a[l],h=c[l];s[l]=Math.hypot(d,h)}return t.makeOutput(s,e.shape,"float32")},FO={kernelName:od,backendName:"cpu",kernelFunc:MO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pa(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const OO={kernelName:Lf,backendName:"cpu",kernelFunc:pa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fa(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Bt(r,e[0].shape)[0],i=e.map(g=>g.shape);Qm(i,o);let a=Fr(e.map(g=>g.shape),o);if(we(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(g=>we(g.shape)>0);if(c.length===1)return Hr({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){const g=c.map(w=>yi({inputs:{input:w},backend:t})),x=c.map(w=>pa({inputs:{input:w},backend:t})),y=fa({inputs:g,backend:t,attrs:{axis:o}}),b=fa({inputs:x,backend:t,attrs:{axis:o}}),v=$s({inputs:{real:y,imag:b},backend:t});return g.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),v}const l=c.map(g=>{const y=[-1,we(g.shape.slice(o))];return pn({inputs:{x:g},backend:t,attrs:{shape:y}})}),d=l.map(g=>({vals:t.data.get(g.dataId).values,shape:g.shape}));a=Fr(l.map(g=>g.shape),1);const h=l[0].shape[0]===1,p=XS(d,a,e[0].dtype,h),f=Fr(c.map(g=>g.shape),o),m=t.makeTensorInfo(f,e[0].dtype,p);return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const LO={kernelName:id,backendName:"cpu",kernelFunc:fa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s;ct([r,o],"conv2d");const h=ao(c),p=Xn(r.shape,o.shape,i,l,a,d,!1,h),f=p.filterHeight,m=p.filterWidth,g=p.dilationHeight,x=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v=p.dataFormat==="channelsLast",w=new Kn(p.outShape,r.dtype),S=xt(r.shape),N=xt(o.shape),C=S[0],k=v?S[1]:S[2],I=v?S[2]:1,$=v?1:S[1],j=w.strides[0],P=v?w.strides[1]:w.strides[2],O=v?w.strides[2]:1,A=v?1:w.strides[1],z=t.data.get(r.dataId).values,L=t.data.get(o.dataId).values,U=w.values;for(let V=0;V<p.batchSize;++V){const B=V*C,Y=V*j;for(let K=0;K<p.outHeight;++K){const pe=Y+K*P,ge=K*p.strideHeight-b;for(let re=0;re<f;++re){const ye=ge+re*g;if(ye<0||ye>=p.inHeight)continue;const Ae=re*N[0],ve=B+ye*k;for(let _e=0;_e<p.outWidth;++_e){const ze=pe+_e*O,et=_e*p.strideWidth-y;for(let ut=0;ut<m;++ut){const yt=et+ut*x;if(yt<0||yt>=p.inWidth)continue;const bt=Ae+ut*N[1],$t=ve+yt*I;let ae=bt;for(let le=0;le<p.inChannels;++le){const G=z[$t+le*$];for(let oe=0;oe<p.outChannels;++oe)U[ze+oe*A]+=G*L[ae+oe];ae+=p.outChannels}}}}}}return t.makeTensorInfo(w.shape,w.dtype,U)}const zO={kernelName:ad,backendName:"cpu",kernelFunc:GC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s;ct([r,o],"conv2dBackpropFilter");const h=ao(c),p=Xn(r.shape,d,i,1,a,l,!1,h),{strideHeight:f,strideWidth:m,filterHeight:g,filterWidth:x}=p,y=p.dataFormat==="channelsLast",b=new Kn(p.filterShape,"float32"),v=p.padInfo.left,w=p.padInfo.top,S=t.data.get(r.dataId).values,N=t.data.get(o.dataId).values,C=new Kn(r.shape,r.dtype,S),k=new Kn(o.shape,o.dtype,N);for(let I=0;I<g;++I){const $=Math.max(0,Math.ceil((w-I)/f)),j=Math.min(p.outHeight,(p.inHeight+w-I)/f);for(let P=0;P<x;++P){const O=Math.max(0,Math.ceil((v-P)/m)),A=Math.min(p.outWidth,(p.inWidth+v-P)/m);for(let z=0;z<p.inChannels;++z)for(let L=0;L<p.outChannels;++L){let U=0;for(let V=0;V<p.batchSize;++V)for(let B=$;B<j;++B){const Y=I+B*f-w;for(let K=O;K<A;++K){const pe=P+K*m-v;y?U+=C.get(V,Y,pe,z)*k.get(V,B,K,L):U+=C.get(V,z,Y,pe)*k.get(V,L,B,K)}}b.set(U,I,P,z,L)}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const BO={kernelName:Nf,backendName:"cpu",kernelFunc:WO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s;ct([r,o],"conv2dBackpropInput");const h=xt(o.shape),p=xt(r.shape);let f=ao(l);const m=Xn(i,o.shape,a,1,c,d,!1,f),g=new Kn(m.inShape,"float32"),x=g.values,y=t.data.get(r.dataId).values,b=t.data.get(o.dataId).values,[v,w,S]=h,{batchSize:N,filterHeight:C,filterWidth:k,inChannels:I,inHeight:$,inWidth:j,outChannels:P,outHeight:O,outWidth:A,strideHeight:z,strideWidth:L}=m;f=m.dataFormat;const U=C-1-m.padInfo.top,V=k-1-m.padInfo.left,B=f==="channelsLast",Y=g.strides[0],K=B?g.strides[1]:g.strides[2],pe=B?g.strides[2]:1,ge=B?1:g.strides[1],re=p[0],ye=B?p[1]:p[2],Ae=B?p[2]:1,ve=B?1:p[1];for(let _e=0;_e<N;++_e)for(let ze=0;ze<I;++ze)for(let et=0;et<$;++et){const ut=et-U,yt=Math.max(0,Math.ceil(ut/z)),bt=Math.min(O,(C+ut)/z);for(let $t=0;$t<j;++$t){const ae=$t-V,le=Math.max(0,Math.ceil(ae/L)),G=Math.min(A,(k+ae)/L);let oe=0;for(let Te=yt;Te<bt;++Te){const Se=Te*z-ut;for(let te=le;te<G;++te){const Fe=te*L-ae,Le=re*_e+ye*Te+Ae*te,De=v*(C-1-Se)+w*(k-1-Fe)+S*ze;for(let Ke=0;Ke<P;++Ke){const pt=y[Le+ve*Ke],R=b[De+Ke];oe+=pt*R}}}const he=Y*_e+K*et+pe*$t+ge*ze;x[he]=oe}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}const UO={kernelName:cd,backendName:"cpu",kernelFunc:VO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s;ct([r,o],"conv3d");const l=Po(r.shape,o.shape,i,c,a),{filterDepth:d,filterHeight:h,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:g,padInfo:x}=l,y=x.front,b=x.left,v=x.top,w=new Kn(l.outShape,r.dtype),S=t.data.get(r.dataId).values,N=t.data.get(o.dataId).values,C=w.values,k=xt(r.shape),I=xt(o.shape);for(let $=0;$<l.batchSize;++$){const j=$*k[0],P=$*w.strides[0];for(let O=0;O<l.outDepth;++O){const A=P+O*w.strides[1],z=O*l.strideDepth-y;for(let L=0;L<d;++L){const U=z+L*f;if(U<0||U>=l.inDepth)continue;const V=L*I[0],B=j+U*k[1];for(let Y=0;Y<l.outHeight;++Y){const K=A+Y*w.strides[2],pe=Y*l.strideHeight-v;for(let ge=0;ge<h;++ge){const re=pe+ge*m;if(re<0||re>=l.inHeight)continue;const ye=V+ge*I[1],Ae=B+re*k[2];for(let ve=0;ve<l.outWidth;++ve){const _e=K+ve*l.outChannels,ze=ve*l.strideWidth-b;for(let et=0;et<p;++et){const ut=ze+et*g;if(ut<0||ut>=l.inWidth)continue;const yt=ye+et*I[2],bt=Ae+ut*l.inChannels;let $t=yt;for(let ae=0;ae<l.inChannels;++ae){const le=S[bt+ae];for(let G=0;G<l.outChannels;++G)C[_e+G]+=le*N[$t+G];$t+=l.outChannels}}}}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const HO={kernelName:ld,backendName:"cpu",kernelFunc:GO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qO(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s;ct([r,o],"conv3dBackpropFilterV2");const l=xt(r.shape),d=xt(o.shape),h=Po(r.shape,c,i,1,a),p=h.strideDepth,f=h.strideHeight,m=h.strideWidth,g=h.filterDepth,x=h.filterHeight,y=h.filterWidth,b=new Kn(h.filterShape,"float32"),v=b.values,[w,S,N,C]=b.strides,k=t.data.get(o.dataId).values,[I,$,j,P]=d,O=t.data.get(r.dataId).values,[A,z,L,U]=l,V=h.padInfo.front,B=h.padInfo.left,Y=h.padInfo.top;for(let K=0;K<g;++K){const pe=Math.max(0,Math.ceil((V-K)/p)),ge=Math.min(h.outDepth,(h.inDepth+V-K)/p),re=K*w;for(let ye=0;ye<x;++ye){const Ae=Math.max(0,Math.ceil((Y-ye)/f)),ve=Math.min(h.outHeight,(h.inHeight+Y-ye)/f),_e=ye*S+re;for(let ze=0;ze<y;++ze){const et=Math.max(0,Math.ceil((B-ze)/m)),ut=Math.min(h.outWidth,(h.inWidth+B-ze)/m),yt=ze*N+_e;for(let bt=0;bt<h.inChannels;++bt){const $t=bt*C+yt;for(let ae=0;ae<h.outChannels;++ae){let le=0;for(let G=0;G<h.batchSize;++G){const oe=G*A,he=G*I;for(let Te=pe;Te<ge;++Te){const te=(K+Te*p-V)*z+oe,Fe=Te*$+he;for(let Le=Ae;Le<ve;++Le){const Ke=(ye+Le*f-Y)*L+te,pt=Le*j+Fe;for(let R=et;R<ut;++R){const F=(ze+R*m-B)*U+Ke,M=R*P+pt;le+=O[F+bt]*k[M+ae]}}}}v[$t+ae]=le}}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const KO={kernelName:If,backendName:"cpu",kernelFunc:qO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XO(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s;ct([r],"conv3dBackpropInputV2");const l=xt(r.shape),d=xt(o.shape),h=Po(c,o.shape,a,1,i),p=new Kn(h.inShape,"float32"),f=p.values,[m,g,x,y]=p.strides,b=t.data.get(r.dataId).values,[v,w,S,N]=l,C=t.data.get(o.dataId).values,[k,I,$,j]=d,{batchSize:P,filterDepth:O,filterHeight:A,filterWidth:z,inChannels:L,inDepth:U,inHeight:V,inWidth:B,outChannels:Y,outDepth:K,outHeight:pe,outWidth:ge,strideDepth:re,strideHeight:ye,strideWidth:Ae}=h,ve=O-1-h.padInfo.front,_e=A-1-h.padInfo.top,ze=z-1-h.padInfo.left;for(let et=0;et<P;++et)for(let ut=0;ut<L;++ut)for(let yt=0;yt<U;++yt){const bt=yt-ve,$t=Math.max(0,Math.ceil(bt/re)),ae=Math.min(K,(O+bt)/re);for(let le=0;le<V;++le){const G=le-_e,oe=Math.max(0,Math.ceil(G/ye)),he=Math.min(pe,(A+G)/ye);for(let Te=0;Te<B;++Te){const Se=Te-ze,te=Math.max(0,Math.ceil(Se/Ae)),Fe=Math.min(ge,(z+Se)/Ae);let Le=0;for(let De=$t;De<ae;++De){const Ke=De*re-bt;for(let pt=oe;pt<he;++pt){const R=pt*ye-G;for(let D=te;D<Fe;++D){const F=D*Ae-Se,M=v*et+w*De+S*pt+N*D,X=k*(O-1-Ke)+I*(A-1-R)+$*(z-1-F)+j*ut;for(let ue=0;ue<Y;++ue){const J=b[M+ue],de=C[X+ue];Le+=J*de}}}}f[m*et+g*yt+x*le+y*Te+ut]=Le}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const QO={kernelName:kf,backendName:"cpu",kernelFunc:XO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YO=on($c,n=>Math.cos(n)),JO={kernelName:$c,backendName:"cpu",kernelFunc:YO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZO=on(Tc,n=>Math.cosh(n)),eL={kernelName:Tc,backendName:"cpu",kernelFunc:ZO};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,[d,h,p,f]=r.shape,m=o.shape[0],[g,x]=a,y=Wt([m,g,x,f],"float32"),b=t.data.get(o.dataId).values,v=t.data.get(i.dataId).values,w=t.data.get(r.dataId).values,S=xt(r.shape),N=xt(y.shape);for(let C=0;C<m;C++){const k=C*4,I=b[k],$=b[k+1],j=b[k+2],P=b[k+3],O=v[C];if(O>=d)continue;const A=g>1?(j-I)*(h-1)/(g-1):0,z=x>1?(P-$)*(p-1)/(x-1):0;for(let L=0;L<g;L++){const U=g>1?I*(h-1)+L*A:.5*(I+j)*(h-1);if(U<0||U>h-1){for(let V=0;V<x;V++)for(let B=0;B<f;B++){const Y=B+V*N[2]+L*N[1]+C*N[0];y.values[Y]=l}continue}if(c==="bilinear"){const V=Math.floor(U),B=Math.ceil(U),Y=U-V;for(let K=0;K<x;K++){const pe=x>1?$*(p-1)+K*z:.5*($+P)*(p-1);if(pe<0||pe>p-1){for(let Ae=0;Ae<f;Ae++){const ve=Ae+K*N[2]+L*N[1]+C*N[0];y.values[ve]=l}continue}const ge=Math.floor(pe),re=Math.ceil(pe),ye=pe-ge;for(let Ae=0;Ae<f;Ae++){let ve=Ae+ge*S[2]+V*S[1]+O*S[0];const _e=w[ve];ve=Ae+re*S[2]+V*S[1]+O*S[0];const ze=w[ve];ve=Ae+ge*S[2]+B*S[1]+O*S[0];const et=w[ve];ve=Ae+re*S[2]+B*S[1]+O*S[0];const ut=w[ve],yt=_e+(ze-_e)*ye,bt=et+(ut-et)*ye;ve=Ae+K*N[2]+L*N[1]+C*N[0],y.values[ve]=yt+(bt-yt)*Y}}}else for(let V=0;V<x;++V){const B=x>1?$*(p-1)+V*z:.5*($+P)*(p-1);if(B<0||B>p-1){for(let pe=0;pe<f;pe++){const ge=pe+V*N[2]+L*N[1]+C*N[0];y.values[ge]=l}continue}const Y=Math.round(B),K=Math.round(U);for(let pe=0;pe<f;pe++){const ge=pe+Y*S[2]+K*S[1]+O*S[0],re=pe+V*N[2]+L*N[1]+C*N[0];y.values[re]=w[ge]}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const nL={kernelName:Tf,backendName:"cpu",kernelFunc:tL};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;ct(r,"cumprod");const c=Cn([o],r.shape.length);let l=r;c!=null&&(l=bs({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Tn(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Rs(l.dtype,"int32"),p=pf(we(l.shape),h),f=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<f.length;y+=m)for(let b=0;b<m;b++){const v=g(y,b);if(b===0)p[v]=i?1:f[v];else{const w=g(y,b-1);p[v]=i?f[w]*p[w]:f[v]*p[w]}}const x=t.makeTensorInfo(l.shape,h,p);if(c!=null){const y=jo(c),b=bs({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const rL={kernelName:$f,backendName:"cpu",kernelFunc:sL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;ct(r,"cumsum");const c=Cn([o],r.shape.length);let l=r;c!=null&&(l=bs({inputs:{x:r},backend:t,attrs:{perm:c}}));const d=Tn(1,r.shape.length)[0];if(d!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${d}`);const h=Rs(l.dtype,"int32"),p=Zn(we(l.shape),h),f=t.data.get(l.dataId).values,m=l.shape[l.shape.length-1],g=a?(y,b)=>y+m-b-1:(y,b)=>y+b;for(let y=0;y<f.length;y+=m)for(let b=0;b<m;b++){const v=g(y,b);if(b===0)p[v]=i?0:f[v];else{const w=g(y,b-1);p[v]=i?f[w]+p[w]:f[v]+p[w]}}const x=t.makeTensorInfo(l.shape,h,p);if(c!=null){const y=jo(c),b=bs({inputs:{x},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(l),b}return x}const iL={kernelName:ud,backendName:"cpu",kernelFunc:oL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=Og(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=HS(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const cL={kernelName:Af,backendName:"cpu",kernelFunc:aL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;E(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],c=r.shape[1],l=r.shape[2],d=r.shape[3],h=c*o,p=l*o,f=d/(o*o),m=t.data.get(r.dataId).values,g=new Float32Array(a*h*p*f);let x=0;for(let y=0;y<a;++y)for(let b=0;b<h;++b){const v=Math.floor(b/o),w=b%o;for(let S=0;S<p;++S){const N=Math.floor(S/o),C=S%o,k=(w*o+C)*f;for(let I=0;I<f;++I){const j=I+k+d*(N+l*(v+c*y));g[x++]=m[j]}}}return t.makeTensorInfo([a,h,p,f],r.dtype,g)}const uL={kernelName:Ef,backendName:"cpu",kernelFunc:lL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;ct([r,o],"depthwiseConv2DNative");const d=xt(r.shape),h=xt(o.shape);let p=c;p==null&&(p=[1,1]),E(ts(i,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${p}'`);const f=Xn(r.shape,o.shape,i,p,a,l,!0),{filterHeight:m,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=f,v=b.left,w=b.top,S=f.outChannels/f.inChannels,N=new Kn(f.outShape,r.dtype),C=t.data.get(r.dataId).values,k=t.data.get(o.dataId).values,I=N.values;for(let $=0;$<f.batchSize;++$){const j=$*d[0],P=$*N.strides[0];for(let O=0;O<f.outHeight;++O){const A=P+O*N.strides[1],z=O*f.strideHeight-w;for(let L=0;L<m;++L){const U=z+L*x;if(U<0||U>=f.inHeight)continue;const V=L*h[0],B=j+U*d[1];for(let Y=0;Y<f.outWidth;++Y){const K=A+Y*N.strides[2],pe=Y*f.strideWidth-v;for(let ge=0;ge<g;++ge){const re=pe+ge*y;if(re<0||re>=f.inWidth)continue;const ye=V+ge*h[1],Ae=B+re*f.inChannels;let ve=K,_e=ye;for(let ze=0;ze<f.inChannels;++ze){const et=C[Ae+ze];for(let ut=0;ut<S;++ut)I[ve+ut]+=et*k[_e+ut];ve+=S,_e+=S}}}}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const dL={kernelName:dd,backendName:"cpu",kernelFunc:HC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s;ct([r,o],"depthwiseConv2dNativeBackpropFilter");const h=Xn(r.shape,d,i,a,c,l,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=h,x=new Kn(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=t.data.get(r.dataId).values,S=new Kn(r.shape,r.dtype,w),N=t.data.get(o.dataId).values,C=new Kn(o.shape,o.dtype,N);for(let k=0;k<m;++k){const I=Math.max(0,Math.ceil((b-k)/p)),$=Math.min(h.outHeight,(h.inHeight+b-k)/p);for(let j=0;j<g;++j){const P=Math.max(0,Math.ceil((y-j)/f)),O=Math.min(h.outWidth,(h.inWidth+y-j)/f);for(let A=0;A<h.outChannels;++A){const z=Math.trunc(A/v),L=A%v;let U=0;for(let V=0;V<h.batchSize;++V)for(let B=I;B<$;++B){const Y=k+B*p-b;for(let K=P;K<O;++K){const pe=j+K*f-y;U+=S.get(V,Y,pe,z)*C.get(V,B,K,A)}}x.set(U,k,j,z,L)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const pL={kernelName:Rf,backendName:"cpu",kernelFunc:hL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s;ct([r,o],"depthwiseConv2DNativeBackpropInput");const h=xt(r.shape),p=xt(o.shape),f=Xn(d,o.shape,i,a,c,l,!0),m=new Kn(f.inShape,"float32"),g=m.values,[x,y,b]=m.strides,v=t.data.get(r.dataId).values,[w,S,N]=h,C=t.data.get(o.dataId).values,[k,I,$]=p,{batchSize:j,filterHeight:P,filterWidth:O,inChannels:A,inHeight:z,inWidth:L,outChannels:U,outHeight:V,outWidth:B,strideHeight:Y,strideWidth:K}=f,pe=P-1-f.padInfo.top,ge=O-1-f.padInfo.left,re=U/A;for(let ye=0;ye<j;++ye)for(let Ae=0;Ae<A;++Ae)for(let ve=0;ve<z;++ve){const _e=ve-pe,ze=Math.max(0,Math.ceil(_e/Y)),et=Math.min(V,(P+_e)/Y);for(let ut=0;ut<L;++ut){const yt=ut-ge,bt=Math.max(0,Math.ceil(yt/K)),$t=Math.min(B,(O+yt)/K);let ae=0;for(let le=ze;le<et;++le){const G=le*Y-_e;for(let oe=bt;oe<$t;++oe){const he=oe*K-yt,Te=w*ye+S*le+N*oe,Se=k*(P-1-G)+I*(O-1-he)+$*Ae;for(let te=0;te<re;++te){const Fe=Ae*re+te,Le=v[Te+Fe],De=C[Se+te];ae+=Le*De}}}g[x*ye+y*ve+b*ut+Ae]=ae}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}const mL={kernelName:Df,backendName:"cpu",kernelFunc:fL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(n){const{inputs:e,backend:t}=n,{x:s}=e,r=we(s.shape),o=t.data.get(s.dataId).values,i=Wt([r,r],s.dtype),a=i.values;for(let l=0;l<o.length;l++)a[l*r+l]=o[l];const c=[...s.shape,...s.shape];return t.makeTensorInfo(c,i.dtype,i.values)}const xL={kernelName:pb,backendName:"cpu",kernelFunc:gL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yL={kernelName:hd,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=t,c=e,l=c.data.get(s.dataId).values,d=s.shape.length,h=c.data.get(r.dataId).values,p=r.shape.length,{batchSize:f,inHeight:m,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:S,filterHeight:N,filterWidth:C,dilationHeight:k,dilationWidth:I,outShape:$}=hl(s.shape,r.shape,o,i,"NHWC",a),j=we($),P=$.length,O=In(s.dtype,j);for(let z=0;z<f;++z)for(let L=0;L<y;++L){const U=L*w-v.top;for(let V=0;V<b;++V){const B=V*S-v.left;for(let Y=0;Y<x;++Y){let K=Number.MIN_SAFE_INTEGER;for(let ge=0;ge<N;++ge){const re=U+ge*k;if(re>=0&&re<m)for(let ye=0;ye<C;++ye){const Ae=B+ye*I;if(Ae>=0&&Ae<g){const ve=jr([z,re,Ae,Y],d,xt(s.shape)),_e=jr([ge,ye,Y],p,xt(r.shape)),ze=l[ve]+h[_e];ze>K&&(K=ze)}}}const pe=jr([z,L,V,Y],P,xt($));O[pe]=K}}}return{dataId:c.write(Ci(O,s.dtype),$,s.dtype),shape:$,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bL={kernelName:Sp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=mr(s.shape,l.data.get(s.dataId).values),h=mr(r.shape,l.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:N,dilationHeight:C,dilationWidth:k,outShape:I}=hl(s.shape,r.shape,i,a,"NHWC",c);E(o.rank===I.length,()=>`Error in ${Sp}, dy must have the same rank as output ${I.length}, but got ${o.rank}`);const $=mr(I,l.data.get(o.dataId).values),j=lb(r.shape,r.dtype);for(let O=0;O<p;++O)for(let A=0;A<x;++A){const z=A*v-b.top;for(let L=0;L<y;++L){const U=L*w-b.left;for(let V=0;V<g;++V){let B=Number.MIN_SAFE_INTEGER,Y=0,K=0;for(let pe=0;pe<S;++pe){const ge=z+pe*C;if(ge>=0&&ge<f)for(let re=0;re<N;++re){const ye=U+re*k;if(ye>=0&&ye<m){const Ae=d[O][ge][ye][V]+h[pe][re][V];Ae>B&&(B=Ae,Y=pe,K=re)}}}j[Y][K][V]+=$[O][A][L][V]}}}return{dataId:l.write(Ci(j,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wL={kernelName:vp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:c}=t,l=e,d=mr(s.shape,l.data.get(s.dataId).values),h=mr(r.shape,l.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:N,dilationHeight:C,dilationWidth:k,outShape:I}=hl(s.shape,r.shape,i,a,"NHWC",c);E(o.rank===I.length,()=>`Error in ${vp}, dy must have the same rank as output ${I.length}, but got ${o.rank}`);const $=mr(I,l.data.get(o.dataId).values),j=lb(s.shape,s.dtype);for(let O=0;O<p;++O)for(let A=0;A<x;++A){const z=A*v-b.top;for(let L=0;L<y;++L){const U=L*w-b.left;for(let V=0;V<g;++V){let B=Number.MIN_SAFE_INTEGER,Y=z<0?0:z,K=U<0?0:U;for(let pe=0;pe<S;++pe){const ge=z+pe*C;if(ge>=0&&ge<f)for(let re=0;re<N;++re){const ye=U+re*k;if(ye>=0&&ye<m){const Ae=d[O][ge][ye][V]+h[pe][re][V];Ae>B&&(B=Ae,Y=ge,K=ye)}}}j[O][Y][K][V]+=$[O][A][L][V]}}}return{dataId:l.write(Ci(j,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vL(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:c}=i||{},l=(c==null?void 0:c.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const h=o.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${d} type.`);const[p,f]=r.shape.slice(0,2),m=r.shape.length===2?1:r.shape[2],g=t.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(f*p*4);for(let v=0;v<p*f;++v){const w=[0,0,0,255*l];for(let N=0;N<m;N++){const C=g[v*m+N];if(r.dtype==="float32"){if(C<0||C>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${C}.`)}else if(r.dtype==="int32"&&(C<0||C>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${C}.`);m===1?(w[0]=C*x,w[1]=C*x,w[2]=C*x):w[N]=C*x}const S=v*4;y[S+0]=Math.round(w[0]),y[S+1]=Math.round(w[1]),y[S+2]=Math.round(w[2]),y[S+3]=Math.round(w[3])}o.width=f,o.height=p;const b=new ImageData(y,f,p);return h.putImageData(b,0,0),r}const SL={kernelName:jk,backendName:"cpu",kernelFunc:vL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"sum");let a;r.dtype==="bool"?a=Eo({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Hr({inputs:{x:r},backend:t});const c=a.shape.length,l=Bt(o,a.shape),d=Cn(l,c);let h=l,p=a;d!=null&&(p=bs({inputs:{x:a},backend:t,attrs:{perm:d}}),h=Tn(h.length,c)),Qn("sum",h,p.shape.length);const[f,m]=Hn(p.shape,h),g=Rs(p.dtype,"int32");let x=Tu(t,f,g);const y=we(m),b=t.data.get(x.dataId).values,v=t.data.get(p.dataId).values;for(let w=0;w<b.length;++w){const S=w*y;let N=0;for(let C=0;C<y;++C)N+=v[S+C];b[w]=N}if(i){const w=_n(x.shape,l),S=x;x=pn({inputs:{x},backend:t,attrs:{shape:w}}),t.disposeIntermediateTensorInfo(S)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),x}const CL={kernelName:Gd,backendName:"cpu",kernelFunc:Tl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=cg(r,o.length);ug(i.length,c,o);const{path:l,steps:d}=dg(a,c),h=d.length;let p=null,f=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=lg(f,c[x]);let v;hg(y)?v=o[x]:(v=bs({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(v));const w=v.shape.slice();for(let S=0;S<b.length;++S)w.splice(b[S],0,1);en(v.shape,w)||(v=pn({inputs:{x:v},backend:t,attrs:{shape:w}}),m.push(v)),p===null?p=v:(p=Ch({inputs:{a:v,b:p},backend:t}),m.push(p))}g<h-1&&(l[g]>=0&&(p=Tl({inputs:{x:p},backend:t,attrs:{axis:l[g]-(i.length-f),keepDims:!1}}),m.push(p)),f--)}for(const g of m)g!==p&&t.disposeIntermediateTensorInfo(g);return p}const IL={kernelName:_f,backendName:"cpu",kernelFunc:NL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;ct([s,r],"eluGrad");const o=new Float32Array(we(r.shape)),i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let c=0;c<i.length;++c){const l=i[c];l>=0?o[c]=a[c]:o[c]=a[c]*(l+1)}return t.makeTensorInfo(r.shape,"float32",o)}const $L={kernelName:Pf,backendName:"cpu",kernelFunc:kL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TL=tg,AL=ng,EL=sg,RL=rg,DL=og,_L=ig,PL=on(Rc,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+TL*t);return e*(1-((((_L*s+DL)*s+RL)*s+EL)*s+AL)*s*Math.exp(-t*t))}),jL={kernelName:Rc,backendName:"cpu",kernelFunc:PL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ru(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let c=o;return o<0&&(E(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),pn({inputs:{x:r},backend:t,attrs:{shape:a}})}const ML={kernelName:fd,backendName:"cpu",kernelFunc:Ru};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FL=En((n,e)=>n/e),Ug=Wn(Ac,FL),Xp={kernelName:Ac,backendName:"cpu",kernelFunc:Ug};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qC(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,l=[r,o],d=we(l),h=Jn("float32",d),p=Jn("float32",d);for(let x=0;x<r;x++){const y=bi({inputs:{x:a},backend:t,attrs:{begin:[x,0],size:[1,o]}}),b=bi({inputs:{x:c},backend:t,attrs:{begin:[x,0],size:[1,o]}}),v=$s({inputs:{real:y,imag:b},backend:t}),{real:w,imag:S}=OL(v,e,t),N=no(w,S);for(let C=0;C<o;C++){const k=ag(N,C);h[x*o+C]=k.real,p[x*o+C]=k.imag}t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v)}const f=t.makeTensorInfo(l,"float32",h),m=t.makeTensorInfo(l,"float32",p),g=$s({inputs:{real:f,imag:m},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),g}function OL(n,e,t){const s=we(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(LL(s)){const a=Qp(o,i,s,e,t),c=[n.shape[0],n.shape[1]];if(e){const l=t.makeTensorInfo(c,"float32",a.real),d=t.makeTensorInfo(c,"float32",a.imag),h=t.makeTensorInfo([],"float32",Do(s,"float32")),p=Hr({inputs:{x:h},backend:t}),f=Xp.kernelFunc({inputs:{a:l,b:h},backend:t}),m=Xp.kernelFunc({inputs:{a:d,b:p},backend:t}),g=t.data.get(f.dataId).values,x=t.data.get(m.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),{real:g,imag:x}}return a}else{const a=no(o,i),c=zL(a,s,e);return av(c)}}function LL(n){return(n&n-1)===0}function Qp(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=no(n,e),i=t/2,a=cv(o),c=a.real,l=a.imag,d=[c.length],h=r.makeTensorInfo(d,"float32",c),p=r.makeTensorInfo(d,"float32",l),f=$s({inputs:{real:h,imag:p},backend:r}),m=lv(o),g=m.real,x=m.imag,y=[g.length],b=r.makeTensorInfo(y,"float32",g),v=r.makeTensorInfo(y,"float32",x),w=$s({inputs:{real:b,imag:v},backend:r}),S=Qp(c,l,i,s,r),N=S.real,C=S.imag,k=[N.length],I=r.makeTensorInfo(k,"float32",N),$=r.makeTensorInfo(k,"float32",C),j=$s({inputs:{real:I,imag:$},backend:r}),P=Qp(g,x,i,s,r),O=P.real,A=P.imag,z=[O.length],L=r.makeTensorInfo(z,"float32",O),U=r.makeTensorInfo(z,"float32",A),V=$s({inputs:{real:L,imag:U},backend:r}),B=dv(t,s),Y=[B.real.length],K=r.makeTensorInfo(Y,"float32",B.real),pe=r.makeTensorInfo(Y,"float32",B.imag),ge=$s({inputs:{real:K,imag:pe},backend:r}),re=Ch({inputs:{a:ge,b:V},backend:r}),ye=ha({inputs:{a:j,b:re},backend:r}),Ae=Bg({inputs:{a:j,b:re},backend:r}),ve=yi({inputs:{input:ye},backend:r}),_e=yi({inputs:{input:Ae},backend:r}),ze=pa({inputs:{input:ye},backend:r}),et=pa({inputs:{input:Ae},backend:r}),ut=fa({inputs:[ve,_e],backend:r,attrs:{axis:0}}),yt=fa({inputs:[ze,et],backend:r,attrs:{axis:0}}),bt=r.data.get(ut.dataId).values,$t=r.data.get(yt.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(re),r.disposeIntermediateTensorInfo(ye),r.disposeIntermediateTensorInfo(Ae),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(ze),r.disposeIntermediateTensorInfo(_e),r.disposeIntermediateTensorInfo(et),r.disposeIntermediateTensorInfo(ut),r.disposeIntermediateTensorInfo(yt),{real:bt,imag:$t}}function zL(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const c=hv(r*a,e,t),l=ag(n,a);o+=l.real*c.real-l.imag*c.imag,i+=l.real*c.imag+l.imag*c.real}t&&(o/=e,i/=e),uv(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(n){const{inputs:e,backend:t}=n,{input:s}=e,r=we(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=pn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=qC(a,!1,t),l=pn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const BL={kernelName:jf,backendName:"cpu",kernelFunc:WL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gg(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||ba(r),a=In(i,we(s));return UL(a,r,i),e.makeTensorInfo(s,i,a)}const VL={kernelName:Mf,backendName:"cpu",kernelFunc:Gg};function UL(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GL={kernelName:Ff,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=Jn(s.dtype,we(s.shape)),[i,a,c,l]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<i;p++){const f=p*c*a*l;for(let m=0;m<a;m++){const g=m*(c*l);for(let x=0;x<c;x++){const y=x*l;for(let b=0;b<l;b++){const v=Math.round(c-x-1),w=f+g+y+b;let S=d[w];if(v>=0&&v<c){const N=v*l,C=f+g+N+b;S=d[C]}o[w]=S}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=s;let g=GC({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p}});if(i){const x=g;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const y=pn({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});g=ha({inputs:{a:g,b:y},backend:t}),t.disposeIntermediateTensorInfo(y)}else g=ha({inputs:{a:g,b:i},backend:t});t.disposeIntermediateTensorInfo(x)}if(f){const x=g;if(d==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=pn({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});g=Eu(t,g,f,y,m),t.disposeIntermediateTensorInfo(y)}else g=Eu(t,g,f,a,m);t.disposeIntermediateTensorInfo(x)}return g}const qL={kernelName:cu,backendName:"cpu",kernelFunc:HL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=s;let g=HC({inputs:{x:r,filter:o},backend:t,attrs:{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p}});if(i){const x=g;g=ha({inputs:{a:g,b:i},backend:t}),t.disposeIntermediateTensorInfo(x)}if(f){const x=g;g=Eu(t,g,f,a,m),t.disposeIntermediateTensorInfo(x)}return g}const XL={kernelName:Db,backendName:"cpu",kernelFunc:KL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=we(s.shape),i=r.shape,a=i[i.length-1],[c,l,d,h]=Um(s,r);if(l===0)return t.makeTensorInfo(c,s.dtype,[]);const p=t.data.get(r.dataId).values,f=t.bufferSync(s),m=sC(p,f,s.dtype,l,a,d,h,s.shape,o);return t.makeTensorInfo(c,s.dtype,m.values)}const YL={kernelName:fb,backendName:"cpu",kernelFunc:QL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;ct([r,o],"gatherV2");const c=Bt(i,r.shape)[0],l=t.data.get(o.dataId).values,d=r.shape[c];for(let w=0;w<l.length;++w){const S=l[w];E(S<=d-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${d-1}]`)}let h=a;a==null&&(h=0);const p=we(o.shape),f=fg(r,o,c,h),m=pn({inputs:{x:r},backend:t,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),g=pn({inputs:{x:o},backend:t,attrs:{shape:[f.batchSize,p/f.batchSize]}}),x=[f.batchSize,f.outerSize,p/f.batchSize,f.sliceSize],y=t.bufferSync(g),b=t.bufferSync(m),v=rC(b,y,x);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(f.outputShape,v.dtype,v.values)}const ZL={kernelName:gd,backendName:"cpu",kernelFunc:JL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3(n){const{inputs:e,backend:t}=n,{input:s}=e,r=we(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=pn({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),c=qC(a,!0,t),l=pn({inputs:{x:c},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}const t3={kernelName:Of,backendName:"cpu",kernelFunc:e3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n3=on(Oc,n=>Number.isFinite(n)?1:0,"bool"),s3={kernelName:Oc,backendName:"cpu",kernelFunc:n3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3=on(Lc,n=>Math.abs(n)===1/0?1:0,"bool"),o3={kernelName:Lc,backendName:"cpu",kernelFunc:r3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i3=on(zc,n=>Number.isNaN(n)?1:0,"bool"),a3={kernelName:zc,backendName:"cpu",kernelFunc:i3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c3(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=lC(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const l3={kernelName:mb,backendName:"cpu",kernelFunc:c3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3=on(Bc,n=>Math.log1p(n)),d3={kernelName:Bc,backendName:"cpu",kernelFunc:u3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h3=En((n,e)=>n&&e),p3=Wn(vd,h3,null,"bool"),f3={kernelName:vd,backendName:"cpu",kernelFunc:p3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m3=on(Sd,n=>n?0:1,"bool"),g3={kernelName:Sd,backendName:"cpu",kernelFunc:m3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x3=En((n,e)=>n||e),y3=Wn(Cd,x3,null,"bool"),b3={kernelName:Cd,backendName:"cpu",kernelFunc:y3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s;ct(r,"LRN");const l=r.shape[3],d=l-1,h=t.data.get(r.dataId).values,p=we(r.shape),f=new Float32Array(p);function m(g){const x=g%l;let y=g-x+Math.max(0,x-o);const b=g-x+Math.min(x+o,d);let v=0;for(;y<=b;y++){const w=h[y];v+=w*w}return v}for(let g=0;g<p;g++){const x=m(g),y=h[g]*Math.pow(i+a*x,-c);f[g]=y}return t.makeTensorInfo(r.shape,r.dtype,f)}const v3={kernelName:Nd,backendName:"cpu",kernelFunc:w3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s;ct(i,"LRNGrad");const h=we(i.shape),p=i.shape[3],f=t.data.get(i.dataId).values,m=t.data.get(r.dataId).values,g=t.data.get(o.dataId).values,x=new Float32Array(h),y=h;for(let b=0;b<y;b++){const v=b%p,w=b-v+Math.max(0,v-a),S=b-v+Math.min(p,v+a+1);let N=0;for(let C=w;C<S;C++)N+=Math.pow(m[C],2);N=l*N+c;for(let C=w;C<S;C++){let k=-2*l*d*m[C]*g[b]/N;b===C&&(k+=Math.pow(N,-d)),k*=f[b],x[C]+=k}}return t.makeTensorInfo(i.shape,r.dtype,x)}const C3={kernelName:zf,backendName:"cpu",kernelFunc:S3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KC(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=t;let c=r.shape;const l=c.length,d=Bt(o,c);let h=d;const p=Cn(h,l);let f=a.data.get(r.dataId).values;if(p!=null){const w=new Array(l);for(let S=0;S<w.length;S++)w[S]=c[p[S]];f=zg(f,c,r.dtype,p,w),h=Tn(h.length,l),c=w}ct(r,"max"),Qn("max",h,l);const[m,g]=Hn(c,h),x=we(g),y=dC(f,x,m,r.dtype),b=a.write(y,m,r.dtype);let v=m;return i&&(v=_n(m,d)),{dataId:b,shape:v,dtype:r.dtype}}const N3={kernelName:Id,backendName:"cpu",kernelFunc:KC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;ct(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);let h;if(d.filterWidth===1&&d.filterHeight===1&&en(d.inShape,d.outShape))h=Hr({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,f=xt(r.shape),m=Vg(p,r.shape,r.dtype,f,d,"max");h=t.makeTensorInfo(d.outShape,r.dtype,m.values)}return h}const k3={kernelName:kd,backendName:"cpu",kernelFunc:I3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s;ct(r,"maxPool3d");const d=io(r.shape,o,i,1,a,c,l),h=t.data.get(r.dataId).values,p=UC(h,r.shape,r.dtype,xt(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const T3={kernelName:$d,backendName:"cpu",kernelFunc:$3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=s;ct([r,o],"maxPool3DGrad");const d=io(o.shape,i,a,1,c,l),h=t.bufferSync(o),p=xO(h,d),f=d.strideDepth,m=d.strideHeight,g=d.strideWidth,x=d.dilationDepth,y=d.dilationHeight,b=d.dilationWidth,v=d.effectiveFilterDepth,w=d.effectiveFilterHeight,S=d.effectiveFilterWidth,N=v-1-d.padInfo.front,C=S-1-d.padInfo.left,k=w-1-d.padInfo.top,I=Wt(o.shape,"float32"),$=t.bufferSync(r);for(let j=0;j<d.batchSize;++j)for(let P=0;P<d.inChannels;++P)for(let O=0;O<d.inDepth;++O)for(let A=0;A<d.inHeight;++A)for(let z=0;z<d.inWidth;++z){const L=O-N,U=A-k,V=z-C;let B=0;for(let Y=0;Y<v;Y+=x){const K=(L+Y)/f;if(!(K<0||K>=d.outDepth||Math.floor(K)!==K))for(let pe=0;pe<w;pe+=y){const ge=(U+pe)/m;if(!(ge<0||ge>=d.outHeight||Math.floor(ge)!==ge))for(let re=0;re<S;re+=b){const ye=(V+re)/g;if(ye<0||ye>=d.outWidth||Math.floor(ye)!==ye)continue;const Ae=v*w*S-1-p.get(j,K,ge,ye,P),ve=Y*w*S+pe*S+re,_e=Ae===ve?1:0;if(_e===0)continue;const ze=$.get(j,K,ge,ye,P);B+=ze*_e}}}I.set(B,j,O,A,z,P)}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const E3={kernelName:Bf,backendName:"cpu",kernelFunc:A3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R3(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;ct([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,p=tr(a.shape,c,l,1,d,h),f=t.data.get(a.dataId).values,m=Wt(p.outShape,a.dtype,VC(f,a.shape,a.dtype,p).values),g=p.strideHeight,x=p.strideWidth,y=p.dilationHeight,b=p.dilationWidth,v=p.effectiveFilterHeight,w=p.effectiveFilterWidth,S=w-1-p.padInfo.left,N=v-1-p.padInfo.top,C=Wt(a.shape,"float32"),k=t.data.get(r.dataId).values,I=Wt(r.shape,"float32",k);for(let $=0;$<p.batchSize;++$)for(let j=0;j<p.inChannels;++j)for(let P=0;P<p.inHeight;++P)for(let O=0;O<p.inWidth;++O){const A=P-N,z=O-S;let L=0;for(let U=0;U<v;U+=y){const V=(A+U)/g;if(!(V<0||V>=p.outHeight||Math.floor(V)!==V))for(let B=0;B<w;B+=b){const Y=(z+B)/x;if(Y<0||Y>=p.outWidth||Math.floor(Y)!==Y)continue;const K=v*w-1-m.get($,V,Y,j),pe=U*w+B,ge=K===pe?1:0;if(ge===0)continue;const re=I.get($,V,Y,j);L+=re*ge}}C.set(L,$,P,O,j)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const D3={kernelName:Wf,backendName:"cpu",kernelFunc:R3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _3(n,e,t,s,r){const o=xt(e),i=Vg(n,e,t,o,r,"max"),a=VC(n,e,t,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P3={kernelName:gb,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;ct(s,"MaxPoolWithArgmax");const l=c.data.get(s.dataId).values,d=tr(s.shape,r,o,[1,1],i),[h,p]=_3(l,s.shape,s.dtype,a,d),f=c.write(h,d.outShape,s.dtype),m=c.write(p,d.outShape,s.dtype);return[{dataId:f,shape:d.outShape,dtype:s.dtype},{dataId:m,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=Bt(o,r.shape),l=Hn(r.shape,a)[1],d=we(l),h=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));h.push(p);const f=Eo({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});h.push(f);const m=Ug({inputs:{a:f,b:p},backend:t});h.push(m);const g=Tl({inputs:{x:m},backend:t,attrs:{axis:o,keepDims:i}});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const M3={kernelName:Td,backendName:"cpu",kernelFunc:j3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;ct(r,"min");const a=Bt(o,r.shape);let c=a;const l=Cn(c,r.shape.length);let d=r;l!=null&&(d=bs({inputs:{x:r},backend:t,attrs:{perm:l}}),c=Tn(c.length,r.shape.length)),Qn("min",c,d.shape.length);const[h,p]=Hn(d.shape,c),f=we(p),m=Zn(we(h),d.dtype),g=t.data.get(d.dataId).values;for(let y=0;y<m.length;++y){const b=y*f;let v=g[b];for(let w=0;w<f;++w){const S=g[b+w];(Number.isNaN(S)||S<v)&&(v=S)}m[y]=v}l!=null&&t.disposeIntermediateTensorInfo(d);const x=t.makeTensorInfo(h,d.dtype,m);if(i){const y=_n(h,a),b=pn({inputs:{x},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(x),b}return x}const O3={kernelName:Ad,backendName:"cpu",kernelFunc:F3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;ct(r,"mirrorPad");const a=o.map((v,w)=>v[0]+r.shape[w]+v[1]),c=o.map(v=>v[0]),l=o.map((v,w)=>v[0]+r.shape[w]),d=i==="reflect"?0:1,h=t.data.get(r.dataId).values,p=r.shape.length,f=xt(r.shape),m=we(a),g=a.length,x=xt(a),y=Jn(r.dtype,m);for(let v=0;v<m;v++){let w=wa(v,g,x);for(let N=0;N<g;N++)w[N]<c[N]?w[N]=c[N]*2-w[N]-d:w[N]>=l[N]&&(w[N]=(l[N]-1)*2-w[N]+d);w=w.map((N,C)=>N-c[C]);const S=jr(w,p,f);y[v]=h[S]}return{dataId:t.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const z3={kernelName:Ed,backendName:"cpu",kernelFunc:L3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W3=En((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),B3=Wn(Gc,W3),V3={kernelName:Gc,backendName:"cpu",kernelFunc:B3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XC(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const c=Bt([a],r.shape),l=KC({inputs:{x:r},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),d=_n(l.shape,c),h=pn({inputs:{x:l},backend:t,attrs:{shape:d}}),p=Bg({inputs:{a:r,b:h},backend:t}),f=ZS({inputs:{x:p},backend:t}),m=Tl({inputs:{x:f},backend:t,attrs:{axis:c,keepDims:!1}}),g=pn({inputs:{x:m},backend:t,attrs:{shape:d}}),x=Ug({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),x}const U3={kernelName:Kd,backendName:"cpu",kernelFunc:XC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;ct(r,"multinomial");const c=a?r:XC({inputs:{logits:r},backend:t,attrs:{dim:-1}}),l=c.shape[0],d=c.shape[1],h=t.data.get(c.dataId).values,p=[l,o],f=Zn(we(p),"int32");for(let m=0;m<l;++m){const g=m*d,x=new Float32Array(d-1);x[0]=h[g];for(let v=1;v<x.length;++v)x[v]=x[v-1]+h[g+v];const y=Am.alea(i.toString()),b=m*o;for(let v=0;v<o;++v){const w=y();f[b+v]=x.length;for(let S=0;S<x.length;S++)if(w<x[S]){f[b+v]=S;break}}}return a||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(p,"int32",f)}const H3={kernelName:xb,backendName:"cpu",kernelFunc:G3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q3=Om;function K3(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s;ct(r,"NonMaxSuppression");const l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:h}=q3(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const X3={kernelName:Vf,backendName:"cpu",kernelFunc:K3};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q3=Lm;function Y3(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s;ct(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,{selectedIndices:p,validOutputs:f}=Q3(d,h,i,a,c,l);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([f]))]}const J3={kernelName:Uf,backendName:"cpu",kernelFunc:Y3};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z3=zm;function ez(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s;ct(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,p=i,f=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=Z3(d,h,p,f,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const tz={kernelName:Gf,backendName:"cpu",kernelFunc:ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s;ct(r,"oneHot");const l=we(r.shape),d=new Float32Array(l*i);d.fill(c);const h=t.data.get(r.dataId).values;for(let p=0;p<l;++p)h[p]>=0&&h[p]<i&&(d[p*i+h[p]]=a);return t.makeTensorInfo([...r.shape,i],o,d)}const sz={kernelName:Pd,backendName:"cpu",kernelFunc:nz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Du(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=yi({inputs:{input:s},backend:t}),o=Du({inputs:{x:r},backend:t}),i=pa({inputs:{input:s},backend:t}),a=Du({inputs:{x:i},backend:t}),c=$s({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Gg({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const rz={kernelName:Yd,backendName:"cpu",kernelFunc:Du};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QC(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=yi({inputs:{input:s},backend:t}),o=QC({inputs:{x:r},backend:t}),i=pa({inputs:{input:s},backend:t}),a=Du({inputs:{x:i},backend:t}),c=$s({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Gg({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const oz={kernelName:_d,backendName:"cpu",kernelFunc:QC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YC(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Ru({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{hf(o,d.shape,"All tensors passed to stack must have matching shapes"),E(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=Ru({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=fa({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const iz={kernelName:jd,backendName:"cpu",kernelFunc:YC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;ct(r,"pad");const a=o.map((b,v)=>b[0]+r.shape[v]+b[1]),c=o.map(b=>b[0]),l=t.data.get(r.dataId).values,d=we(r.shape),h=r.shape.length,p=xt(r.shape),f=we(a),m=a.length,g=xt(a),x=Jn(r.dtype,f);i!==0&&x.fill(i);for(let b=0;b<d;b++){const w=wa(b,h,p).map((N,C)=>N+c[C]),S=jr(w,m,g);x[S]=l[b]}return{dataId:t.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const JC={kernelName:Md,backendName:"cpu",kernelFunc:az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cz=En((n,e)=>Math.pow(n,e)),lz=Wn(qc,cz),uz={kernelName:qc,backendName:"cpu",kernelFunc:lz};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dz(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.data.get(y.dataId).values),l=r.map(y=>y.shape),d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,[p,f,m]=xC(c,l,d,o.shape,o.dtype,h,i.shape),g=p.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,f);return g.concat([x])}const hz={kernelName:yb,backendName:"cpu",kernelFunc:dz};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pz(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=yC(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([d.length],s.dtype,d);return[h,p]}const fz={kernelName:bb,backendName:"cpu",kernelFunc:pz};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mz(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,h=t.data.get(i.dataId).values,p=a.map(x=>t.data.get(x.dataId).values),f=a.map(x=>x.shape),[m,g]=bC(l,r.shape,d,o.shape,o.dtype,h,i.shape,p,f,c);return t.makeTensorInfo(m,o.dtype,g)}const gz={kernelName:wb,backendName:"cpu",kernelFunc:mz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,a=wC(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const yz={kernelName:Hf,backendName:"cpu",kernelFunc:xz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bz=on(Kc,n=>1/n),wz={kernelName:Kc,backendName:"cpu",kernelFunc:bz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;ct(r,"resizeBilinear");const c=xt(r.shape),[l,d]=a,[h,p,f,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(we([h,l,d,m])),y=[o&&l>1?p-1:p,o&&d>1?f-1:f],b=[o&&l>1?l-1:l,o&&d>1?d-1:d];let v=0;const w=y[0]/b[0],S=y[1]/b[1];for(let N=0;N<h;N++)for(let C=0;C<l;C++){let k;i?k=w*(C+.5)-.5:k=w*C;const I=Math.max(0,Math.floor(k)),$=k-I,j=Math.min(p-1,Math.ceil(k)),P=N*c[0]+I*c[1],O=N*c[0]+j*c[1];for(let A=0;A<d;A++){let z;i?z=S*(A+.5)-.5:z=S*A;const L=Math.max(0,Math.floor(z)),U=z-L,V=Math.min(f-1,Math.ceil(z)),B=P+L*c[2],Y=O+L*c[2],K=P+V*c[2],pe=O+V*c[2];for(let ge=0;ge<m;ge++){const re=g[B+ge],ye=g[Y+ge],Ae=g[K+ge],ve=g[pe+ge],_e=re+(Ae-re)*U,ze=ye+(ve-ye)*U,et=_e+(ze-_e)*$;x[v++]=et}}}return t.makeTensorInfo([h,l,d,m],"float32",x)}const Sz={kernelName:Wd,backendName:"cpu",kernelFunc:vz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;ct([o,r],"resizeBilinearGrad");const a=xt(r.shape),[c,l,d,h]=r.shape,[,p,f]=o.shape,m=new Float32Array(c*l*d*h),g=[i&&p>1?l-1:l,i&&f>1?d-1:d],x=[i&&p>1?p-1:p,i&&f>1?f-1:f],y=g[0]/x[0],b=g[1]/x[1],v=t.data.get(o.dataId).values;let w=0;for(let S=0;S<c;S++){const N=S*a[0];for(let C=0;C<p;C++){const k=C*y,I=Math.floor(k),$=Math.min(Math.ceil(k),l-1),j=N+I*a[1],P=N+$*a[1],O=k-I,A=1-O;for(let z=0;z<f;z++){const L=z*b,U=Math.floor(L),V=Math.min(Math.ceil(L),d-1),B=L-U,Y=1-B,K=j+U*a[2],pe=j+V*a[2],ge=P+U*a[2],re=P+V*a[2],ye=A*Y,Ae=A*B,ve=O*Y,_e=O*B;for(let ze=0;ze<h;ze++){const et=v[w++];m[K+ze]+=et*ye,m[pe+ze]+=et*Ae,m[ge+ze]+=et*ve,m[re+ze]+=et*_e}}}}return t.makeTensorInfo([c,d,l,h],"float32",m)}const Nz={kernelName:Xf,backendName:"cpu",kernelFunc:Cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iz(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;ct(r,"resizeNearestNeighbor");const c=xt(r.shape),[l,d]=a,[h,p,f,m]=r.shape,g=t.data.get(r.dataId).values,x=new Float32Array(h*l*d*m),y=[o&&l>1?p-1:p,o&&d>1?f-1:f],b=[o&&l>1?l-1:l,o&&d>1?d-1:d],v=y[0]/b[0],w=y[1]/b[1];let S=0;for(let N=0;N<h;N++){const C=N*c[0];for(let k=0;k<l;k++){const I=i?v*(k+.5):v*k;let $=Math.min(p-1,o?Math.round(I):Math.floor(I));i&&($=Math.max(0,$));const j=C+$*c[1];for(let P=0;P<d;P++){const O=i?w*(P+.5):w*P;let A=Math.min(f-1,o?Math.round(O):Math.floor(O));i&&(A=Math.max(0,A));const z=j+A*c[2];for(let L=0;L<m;L++){const U=g[z+L];x[S++]=U}}}}return t.makeTensorInfo([h,l,d,m],r.dtype,x)}const kz={kernelName:zd,backendName:"cpu",kernelFunc:Iz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;ct([o,r],"resizeNearestNeighborGrad");const a=xt(r.shape),c=xt(o.shape),[l,d,h,p]=r.shape,[,f,m]=o.shape,g=new Float32Array(l*d*h*p),x=t.data.get(o.dataId).values,y=[i&&f>1?d-1:d,i&&m>1?h-1:h],b=[i&&f>1?f-1:f,i&&m>1?m-1:m],v=y[0]/b[0],w=y[1]/b[1],S=1/v,N=1/w,C=Math.ceil(S)*2+2,k=Math.ceil(N)*2+2;for(let I=0;I<l;I++){const $=I*a[0];for(let j=0;j<d;j++){const P=$+j*a[1],O=Math.floor(j*S),A=Math.floor(O-C/2);for(let z=0;z<h;z++){const L=P+z*a[2],U=Math.floor(z*N),V=Math.floor(U-k/2);for(let B=0;B<p;B++){let Y=0;for(let K=0;K<C;K++){const pe=K+A;if(pe<0||pe>=f)continue;const ge=$+pe*c[1],re=pe*v,ye=Math.min(d-1,i?Math.round(re):Math.floor(re));if(j===ye)for(let Ae=0;Ae<k;Ae++){const ve=Ae+V;if(ve<0||ve>=m)continue;const _e=ge+ve*c[2],ze=ve*w,et=Math.min(h-1,i?Math.round(ze):Math.floor(ze));z===et&&(Y+=x[_e+B])}}g[L+B]=Y}}}}return t.makeTensorInfo(r.shape,r.dtype,g)}const Tz={kernelName:Kf,backendName:"cpu",kernelFunc:$z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;ct(r,"reverse");const i=r.shape.length,a=Bt(o,r.shape);if(i===0)return Hr({inputs:{x:r},backend:t});const c=new Kn(r.shape,r.dtype),l=t.bufferSync(r);for(let d=0;d<c.size;d++){const h=c.indexToLoc(d),p=h.slice();a.forEach(f=>p[f]=r.shape[f]-1-p[f]),c.set(l.get(...p),...h)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}const Ez={kernelName:Bd,backendName:"cpu",kernelFunc:Az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rz={kernelName:nm,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=Jn(s.dtype,we(s.shape)),[l,d,h,p]=s.shape,[f,m]=Jm(i,d,h),g=255,x=Math.sin(r),y=Math.cos(r),b=a.data.get(s.dataId).values;for(let w=0;w<l;w++){const S=w*h*d*p;for(let N=0;N<d;N++){const C=N*(h*p);for(let k=0;k<h;k++){const I=k*p;for(let $=0;$<p;$++){const j=[l,N,k,$],P=j[2],O=j[1];let A=(P-f)*y-(O-m)*x,z=(P-f)*x+(O-m)*y;A=Math.round(A+f),z=Math.round(z+m);let L=o;if(typeof o!="number"&&($===3?L=g:L=o[$]),A>=0&&A<h&&z>=0&&z<d){const V=z*(h*p),B=A*p,Y=S+V+B+$;L=b[Y]}const U=S+C+I+$;c[U]=L}}}}return{dataId:a.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dz=on(Yc,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),_z={kernelName:Yc,backendName:"cpu",kernelFunc:Dz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=$i(o,r,i),p=!0,f=t.bufferSync(r),m=t.bufferSync(o),g=Zo(f,m,i,h,l,c,a,d,0,p);return t.makeTensorInfo(i,g.dtype,g.values)}const jz={kernelName:vb,backendName:"cpu",kernelFunc:Pz};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mz(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function Fz(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function Oz(n,e,t,s,r,o){const i=In("int32",t*r);for(let a=0;a<t;++a){const c=n.slice(a*s,(a+1)*s),l=a*r;for(let d=0;d<r;++d)i[l+d]=o==="left"?Mz(c,e[d+l]):Fz(c,e[d+l])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,l=Oz(a,c,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",l)}const zz={kernelName:Cb,backendName:"cpu",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wz(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;ct([s,r,o],"select");const i=s.shape.length,a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=Rs(r.dtype,o.dtype),h=Zn(we(r.shape),d);let p=0;const f=i===0||i>1||r.shape.length===1?1:we(r.shape.slice(1));for(let m=0;m<a.length;m++)for(let g=0;g<f;g++)a[m]===1?h[p++]=c[m]:h[p++]=l[m];return t.makeTensorInfo(r.shape,d,h)}const Bz={kernelName:Vd,backendName:"cpu",kernelFunc:Wz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vz=lh,Uz=uh,Gz=on(Zc,n=>n>=0?Uz*n:Vz*(Math.exp(n)-1)),Hz={kernelName:Zc,backendName:"cpu",kernelFunc:Gz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qz=on(nl,n=>n<0?-1:n>0?1:0),Kz={kernelName:nl,backendName:"cpu",kernelFunc:qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xz=on(el,n=>Math.sin(n)),Qz={kernelName:el,backendName:"cpu",kernelFunc:Xz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yz=on(tl,n=>Math.sinh(n)),Jz={kernelName:tl,backendName:"cpu",kernelFunc:Yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zz=11920928955078125e-23,qx=Math.log(Zz)+2,eW=on(rl,n=>{const e=n>-qx,t=n<qx,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),tW={kernelName:rl,backendName:"cpu",kernelFunc:eW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;ct([r],"spaceToBatchND");const a=we(o),c=[[0,0]];c.push(...i);for(let N=1+o.length;N<r.shape.length;++N)c.push([0,0]);const l=JC.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),d=xl(l.shape,o,a,!1),h=yl(d.length,o.length,!1),p=bl(l.shape,o,a,!1),g=pn({inputs:{x:l},backend:t,attrs:{shape:d}}),b=bs({inputs:{x:g},backend:t,attrs:{perm:h}}),S=pn({inputs:{x:b},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(b),S}const sW={kernelName:Hd,backendName:"cpu",kernelFunc:nW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(s.dataId).values,c=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[h,p,f,m,g]=NC(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(p,s.dtype,h),t.makeTensorInfo([p[0]],r.dtype,f),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const oW={kernelName:Nb,backendName:"cpu",kernelFunc:rW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,c=Array.from(t.data.get(o.dataId).values),[l,d,h]=IC(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const aW={kernelName:Ib,backendName:"cpu",kernelFunc:iW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=Wg(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const lW={kernelName:kb,backendName:"cpu",kernelFunc:cW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,[l,d]=Wg(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const dW={kernelName:$b,backendName:"cpu",kernelFunc:uW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:p}=$i(o,r,a),f=!1,m=t.bufferSync(r);let g;switch(o.dtype){case"bool":{const x=t.bufferSync(o),y=!!t.data.get(i.dataId).values[0];g=Zo(m,x,a,p,d,l,c,h,y,f);break}case"float32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=Zo(m,x,a,p,d,l,c,h,y,f);break}case"int32":{const x=t.bufferSync(o),y=t.data.get(i.dataId).values[0];g=Zo(m,x,a,p,d,l,c,h,y,f);break}case"string":{const x=t.bufferSync(o),y=Io(t.data.get(i.dataId).values[0]);g=Zo(m,x,a,p,d,l,c,h,y,f);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,g.dtype,g.values)}const pW={kernelName:Tb,backendName:"cpu",kernelFunc:hW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Bt(i,r.shape)[0],c=pg(r,o,a),l=new Array(r.shape.length).fill(0),d=r.shape.slice();return c.map(h=>{const p=[...d];p[a]=h;const f=bi({inputs:{x:r},backend:t,attrs:{begin:l,size:p}});return l[a]+=h,f})}const mW={kernelName:qd,backendName:"cpu",kernelFunc:fW};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gW={kernelName:Qf,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;ct(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const c=r[a];o[a]=c*c}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xW=on(dl,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),yW={kernelName:dl,backendName:"cpu",kernelFunc:xW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:p}=s;ct(r,"stridedSlice");const{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=Xm(r.shape,o,i,a,c,l,d,h,p);let S;if(g)S=pn({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){E(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const N=Hm(b,v,w),C=bi({inputs:{x:r},backend:t,attrs:{begin:b,size:N}});S=pn({inputs:{x:C},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(C)}else{const N=t.bufferSync(r),C=TC(f,N,w,b);S=t.makeTensorInfo(m,C.dtype,C.values)}return S}const wW={kernelName:Jf,backendName:"cpu",kernelFunc:bW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,p=t.data.get(d.dataId).values,f=t.data.get(h.dataId).values,[m,g]=AC(p,f,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const SW={kernelName:Ab,backendName:"cpu",kernelFunc:vW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CW(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,c=t.data.get(i.dataId).values[0],[l,d,h]=EC(a,c,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const NW={kernelName:Eb,backendName:"cpu",kernelFunc:CW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=RC(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const kW={kernelName:Rb,backendName:"cpu",kernelFunc:IW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $W=on(cl,n=>Math.tan(n)),TW={kernelName:cl,backendName:"cpu",kernelFunc:$W};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AW=on(ll,n=>Math.tanh(n)),EW={kernelName:ll,backendName:"cpu",kernelFunc:AW};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RW(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:c,strides:l,outputSize:d}=$i(o,r,s.shape),h=!1,p=t.bufferSync(r),f=t.bufferSync(o),m=t.bufferSync(s),g=Zo(p,f,s.shape,d,c,a,i,l,m,h);return t.makeTensorInfo(s.shape,g.dtype,g.values)}const DW={kernelName:Sb,backendName:"cpu",kernelFunc:RW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;ct(r,"tile");const i=_C(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const PW={kernelName:ul,backendName:"cpu",kernelFunc:_W};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;ct(r,"topk");const a=t.data.get(r.dataId).values,[c,l]=jC(a,r.shape,r.dtype,o,i);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}const MW={kernelName:Zf,backendName:"cpu",kernelFunc:jW};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=t,[d,h,p,f]=r.shape,[m,g]=l??[h,p],x=[d,m,g,f],y=xt(r.shape),b=y[0],v=y[1],w=y[2],S=xt(x),N=S[0],C=S[1],k=S[2],I=Jn(r.dtype,we(x));I.fill(c);const $=s.data.get(r.dataId).values,j=s.data.get(o.dataId).values;for(let O=0;O<d;++O){const A=o.shape[0]===1?j:j.subarray(O*8,O*8+8);for(let z=0;z<m;++z)for(let L=0;L<g;++L)for(let U=0;U<f;++U){let V;const B=A[6]*L+A[7]*z+1;if(B===0)continue;const Y=(A[0]*L+A[1]*z+A[2])/B,K=(A[3]*L+A[4]*z+A[5])/B,pe=Kx(Y,p,a),ge=Kx(K,h,a);switch(i){case"nearest":V=VW($,h,p,b,v,w,O,ge,pe,U,c);break;case"bilinear":V=UW($,h,p,b,v,w,O,ge,pe,U,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const re=O*N+z*C+L*k+U;I[re]=V}return s.makeTensorInfo(x,r.dtype,I)}return{dataId:s.write(I,x,r.dtype),shape:r.shape,dtype:r.dtype}}const OW={kernelName:em,backendName:"cpu",kernelFunc:FW};function Kx(n,e,t){switch(t){case"reflect":return LW(n,e);case"wrap":return zW(n,e);case"nearest":return BW(n,e);case"constant":default:return WW(n)}}function LW(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return ii(0,t,e-1)}function zW(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return ii(0,t,e-1)}function WW(n,e){return n}function BW(n,e){return ii(0,n,e-1)}function Ha(n,e,t,s,r,o,i,a,c,l,d){const h=i*s+a*r+c*o+l;return 0<=a&&a<e&&0<=c&&c<t?n[h]:d}function VW(n,e,t,s,r,o,i,a,c,l,d){const h=Math.round(a),p=Math.round(c);return Ha(n,e,t,s,r,o,i,h,p,l,d)}function UW(n,e,t,s,r,o,i,a,c,l,d){const h=Math.floor(a),p=Math.floor(c),f=h+1,m=p+1,g=(m-c)*Ha(n,e,t,s,r,o,i,h,p,l,d)+(c-p)*Ha(n,e,t,s,r,o,i,h,m,l,d),x=(m-c)*Ha(n,e,t,s,r,o,i,f,p,l,d)+(c-p)*Ha(n,e,t,s,r,o,i,f,m,l,d);return(f-a)*g+(a-h)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;ct(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:c,indices:l}=MC(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const HW={kernelName:tm,backendName:"cpu",kernelFunc:GW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],c=new Array(i-1);let l=0;for(let f=0;f<i;f++)f!==o&&(c[l++]=r.shape[f]);const d=new Array(i).fill(0),h=r.shape.slice();h[o]=1;const p=new Array(a);for(let f=0;f<p.length;f++){d[o]=f;const m=bi({inputs:{x:r},backend:t,attrs:{begin:d,size:h}});p[f]=pn({inputs:{x:m},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(m)}return p}const KW={kernelName:Xd,backendName:"cpu",kernelFunc:qW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XW(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;ct(r,"unsortedSegmentSum");const a=r.shape.length,c=o.shape.length,l=[],d=[],h=a-c;let p=o;for(let m=0;m<h;++m){const g=Ru({inputs:{input:p},backend:t,attrs:{dim:m+1}});p=g,d.push(g)}for(let m=0;m<i;++m){const g=Do(m,"int32"),x=t.makeTensorInfo([],"int32",g),y=YS({inputs:{a:x,b:p},backend:t}),b=Eo({inputs:{x:y},backend:t,attrs:{dtype:"float32"}}),v=Ch({inputs:{a:b,b:r},backend:t}),w=Tl({inputs:{x:v},backend:t,attrs:{axis:0,keepDims:!1}});l.push(w),d.push(x),d.push(y),d.push(b),d.push(v),d.push(w)}const f=YC({inputs:l,backend:t,attrs:{axis:0}});return d.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}const QW={kernelName:Qd,backendName:"cpu",kernelFunc:XW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW=[GF,IM,qF,XF,RM,YF,ZF,tO,sO,oO,aO,lO,dO,fO,gO,bO,vO,CO,IO,VF,$O,AO,RO,_M,_O,AM,jM,jO,kM,FO,LO,zO,BO,UO,HO,KO,QO,JO,eL,nL,rL,iL,cL,uL,dL,pL,mL,xL,yL,bL,wL,SL,IL,MF,$L,MM,jL,FM,ML,LM,BL,VL,GL,WM,VM,qL,XL,YL,ZL,GM,qM,$M,t3,OO,s3,o3,a3,FF,XM,YM,l3,ZM,d3,f3,g3,b3,v3,C3,N3,tF,k3,T3,E3,D3,P3,M3,O3,sF,z3,V3,H3,oF,aF,X3,J3,tz,lF,sz,oz,iz,JC,uz,LF,hF,hz,fz,gz,yz,TM,Xp,wz,zF,WF,BF,Sz,Nz,kz,Tz,Ez,Rz,_z,wF,jz,zz,Bz,Hz,SF,Kz,Qz,Jz,CF,U3,tW,sW,oW,aW,lW,dW,pW,mW,kF,gW,TF,EF,yW,wW,SW,NW,kW,PF,CL,TW,EW,DW,PW,MW,OW,uF,HW,KW,QW,rz];for(const n of YW)_b(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xo={},Bl={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function JW(n,e){Xo[n]=e}function wr(n,e){if(!(n in Xo)||e!=null){const s=e4(n,e);if(s!==null)Xo[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Xo[n];return t==null||t.isContextLost()?(delete Xo[n],wr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Xo[n])}function ZW(n){if(!fe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function e4(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??ZW(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Xo[n]},!1),fe().getBool("SOFTWARE_WEBGL_ENABLED")&&(Bl.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Bl)||t.getContext("experimental-webgl",Bl):t.getContext("webgl2",Bl)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var lc;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(lc||(lc={}));var Fs;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Fs||(Fs={}));var qn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qn||(qn={}));function Al(n,e){return[e,n]}function t4(n,e){return n*e}function Vl(n){const e=we(n),t=Math.ceil(e/4);return xp(t)}function $a(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function n4(n,e){const[t,s]=$a(n,e);return t*s*4}function Hg(n,e){const t=n;let s,r,o,i,a,c,l,d,h,p;return fe().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,l=4,d=1,h=t.HALF_FLOAT,p=t.FLOAT,c=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,l=4,d=4,h=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,c=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(n,e){const t=e();return fe().getBool("DEBUG")&&s4(n),t}function s4(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+a4(n,e))}const r4=596e-10,o4=65504;function i4(n){return!!(fe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||r4<Math.abs(n)&&Math.abs(n)<o4)}function a4(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Ul(n,e){return co(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function c4(n,e){const t=co(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ye(n,()=>n.shaderSource(t,e)),Ye(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function l4(n,e){const t=co(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ye(n,()=>n.shaderSource(t,e)),Ye(n,()=>n.compileShader(t)),fe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw ZC(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const u4=/ERROR: [0-9]+:([0-9]+):/g;function ZC(n,e){const t=u4.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((h,p)=>Xi((p+1).toString(),o)+h);let a=0;for(let h=0;h<i.length;h++)a=Math.max(i[h].length,a);const c=i.slice(0,s-1),l=i.slice(s-1,s),d=i.slice(s);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Xi(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function d4(n){return co(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function h4(n,e){if(Ye(n,()=>n.linkProgram(e)),!fe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function np(n,e){if(Ye(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function p4(n,e){const t=co(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ye(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Ye(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function f4(n,e){const t=co(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Ye(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Ye(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function m4(n){return co(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function g4(n,e){const t=fe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function x4(n){return co(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Xx(n,e,t,s,r,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Ye(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Ye(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Ye(n,()=>n.enableVertexAttribArray(a)),!0)}function y4(n,e,t){C4(n,t),Ye(n,()=>n.activeTexture(n.TEXTURE0+t)),Ye(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function b4(n,e,t){return co(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function w4(n,e,t){return n.getUniformLocation(e,t)}function v4(n,e,t,s){Ye(n,()=>y4(n,e,s)),Ye(n,()=>n.uniform1i(t,s))}function sp(n,e,t){Ye(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Ye(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function Qx(n,e){Ye(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Ye(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function Gl(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+S4(n,e))}function S4(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function co(n,e,t){const s=Ye(n,()=>e());if(s==null)throw new Error(t);return s}function C4(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function ma(n,e=2){return we(n.slice(0,n.length-e))}function ga(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Hl(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[ma(n),...ga(n)]),e}function N4(n,e=!1){let t=fe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=fe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&fe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,c)=>c>=n.length-2?df(n[c]):n[c]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=Ro(n).newShape);let r=we(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=ma(n);let c=2,l=2;n.length&&([c,l]=ga(n)),r=a*(c/2)*(l/2),o=xp(r).map(d=>d*2)}else o=xp(r);return o}function ql(n){return n%2===0}function _u(n,e){if(n=n.slice(-2),e=e.slice(-2),en(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||ql(t)&&ql(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&ql(n[0])&&ql(e[0])}let rp,op;function I4(n){if(rp==null){const e=wr(n);rp=e.getParameter(e.MAX_TEXTURE_SIZE)}return rp}function k4(n){if(op==null){const e=wr(n);op=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,op)}function $4(n){if(n===0)return 0;let e;const t=wr(n);return Js(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Js(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Js(n,e){return n.getExtension(e)!=null}function Yx(n){try{if(wr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function T4(n){if(n===0)return!1;const e=wr(n);if(n===1){if(!Js(e,"OES_texture_float"))return!1}else if(!Js(e,"EXT_color_buffer_float"))return!1;return Yp(e)}function A4(n){if(n===0)return!1;const e=wr(n);if(n===1){if(!Js(e,"OES_texture_float")||!Js(e,"WEBGL_color_buffer_float"))return!1}else{if(Js(e,"EXT_color_buffer_float"))return Yp(e);const s="EXT_color_buffer_half_float";if(Js(e,s)){const r=e.getExtension(s);return E4(e,r)}return!1}return Yp(e)}function Yp(n){const e=Hg(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function E4(n,e){const t=Hg(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function R4(n){return n!==2?!1:wr(n).fenceSync!=null}function El(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&E(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lt=fe();lt.registerFlag("HAS_WEBGL",()=>lt.getNumber("WEBGL_VERSION")>0);lt.registerFlag("WEBGL_VERSION",()=>Yx(2)?2:Yx(1)?1:0);lt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);lt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>lt.get("WEBGL_VERSION")===2);lt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);lt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);lt.registerFlag("WEBGL_PACK",()=>lt.getBool("HAS_WEBGL"));lt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_CLIP",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_REDUCE",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_LAZILY_UNPACK",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_CONV_IM2COL",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>lt.getBool("WEBGL_PACK"));lt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>I4(lt.getNumber("WEBGL_VERSION")));lt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>k4(lt.getNumber("WEBGL_VERSION")));lt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=lt.getNumber("WEBGL_VERSION");return n===0?0:$4(n)});lt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>lt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Qb());lt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>T4(lt.getNumber("WEBGL_VERSION")));lt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>lt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:lt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));lt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>A4(lt.getNumber("WEBGL_VERSION")));lt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>R4(lt.getNumber("WEBGL_VERSION")));lt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>lt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);lt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});lt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Qb()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});lt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);lt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);lt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);lt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);lt.registerFlag("WEBGL_EXP_CONV",()=>!1);lt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>lt.getBool("IS_TEST"));lt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);lt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);lt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);lt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(){let n,e,t,s,r,o,i,a,c,l;return fe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=fe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ei(n,e,t="index"){const s=xt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function Nh(n,e,t="index"){const s=xt(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function D4(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function _4(n,e,t="index"){const s=n.map((o,i)=>i),r=D4(s,e);return r.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${r[i]}`,c=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${c};`}).join("")}function qg(n){const e=xt(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Kg(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const eN=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:tN}=yD;function P4(n,e,t){const s=[];if(n.forEach(f=>{const m=we(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${m>1?`[${m}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),t.enableShapeUniforms){const{uniformShape:g}=Xg(t.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(f=>j4(f,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=ds(),c=O4(a);let l,d,h=W4(a);return e.isPacked?(l=M4(e.logicalShape,i,t.enableShapeUniforms),d=z4(a)):(l=F4(e.logicalShape,i,t.enableShapeUniforms),d=L4(a)),t.packedInputs&&(h+=G4),[h,c,d,r,l,o,t.userCode].join(`
`)}function Ta(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return sB(n,e);case 1:return oB(n,e);case 2:return aB(n,e);case 3:return lB(n,e);case 4:return dB(n,e);case 5:return hB(n);case 6:return pB(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function nN(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return nB(n);case 1:return rB(n,e);case 2:return iB(n,e);case 3:return cB(n,e);default:return uB(n,e)}}function j4(n,e,t=!1,s){let r="";t?r+=nN(n,s):r+=Ta(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=fB(n,e):r+=mB(n,e)),r}function M4(n,e,t){switch(n.length){case 0:return sN();case 1:return H4(n,e,t);case 2:return eB(n,e,t);case 3:return K4(n,e,t);default:return Q4(n,e,t)}}function F4(n,e,t){switch(n.length){case 0:return sN();case 1:return q4(n,e,t);case 2:return tB(n,e,t);case 3:return X4(n,e,t);case 4:return Y4(n,e,t);case 5:return J4(n,e);case 6:return Z4(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function O4(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function L4(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function z4(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function W4(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${B4}
    ${V4}
    ${U4}
  `}const B4=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,V4=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,U4=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,G4=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function sN(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function H4(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function q4(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function K4(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function X4(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Nh(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Ei(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Q4(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",c="b, r, c";for(let l=2;l<n.length-1;l++)i*=n[n.length-l-1],a=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+a,c=`b${l}, `+c;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${c});
    }
  `}function Y4(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Nh(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Ei(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function J4(n,e){const t=Ei(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Z4(n,e){const t=Ei(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function eB(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(en(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function tB(n,e,t){return en(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Ri(n){return`offset${n}`}function nB(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=ds();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function sB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Ri(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,c]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function rB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=ds();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function oB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Aa(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Ri(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function iB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],c=ds();if(o!=null&&en(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${c.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${c.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `;const l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${s}, uv);
    }
  `}function aB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&en(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=o[0],f=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Ro(t),c=i;if(c.length<t.length){const p=Ea(n,c),f=["row","col"];return`
      ${Ta(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ra(f,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Aa(n)}
      }
    `;const l=o[0],d=o[1],h=Ri(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${s}, uv);
    }
  `:l===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${h};
    vec2 uv = uvFromFlat(${l}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function cB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const p=t.slice(1),f=[1,2],m=Ea(n,p),g=["b","row","col"];return`
        ${nN(m,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ra(g,f)});
        }
      `}const a=ds();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const c=i[0],l=i[1],d=Math.ceil(t[2]/2),h=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${h}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function lB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:c}=Ro(t),l=a;if(l.length<t.length){const g=Ea(n,l),x=["row","col","depth"];return`
        ${Ta(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ra(x,c)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Aa(n)}
      }
    `;const d=n.shapeInfo.texShape,h=d[0],p=d[1],f=n.shapeInfo.flatOffset;if(p===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const m=Ri(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function uB(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ds();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],d=c[1],h=Math.ceil(o[i-1]/2);let p=h*Math.ceil(o[i-2]/2),f="int b, int row, int col",m=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<i-1;g++)f=`int b${g}, `+f,p*=o[i-g-1],m=`b${g} * ${p} + `+m;return`
    vec4 ${s}(${f}) {
      int index = ${m};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${l});
      return ${r.texture2D}(${t}, uv);
    }
  `}function dB(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:c,keptDims:l}=Ro(t);if(c.length<t.length){const b=Ea(n,c),v=["row","col","depth","depth2"];return`
      ${Ta(b,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ra(v,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Aa(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,p=h[0],f=h[1],m=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${m}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Ri(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${p}, ${f}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function hB(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:c,keptDims:l}=Ro(e);if(c.length<e.length){const g=Ea(n,c),x=["row","col","depth","depth2","depth3"];return`
      ${Ta(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Ra(x,l)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Aa(n)}
      }
    `;const d=n.shapeInfo.flatOffset,h=n.shapeInfo.texShape,p=h[0],f=h[1];if(f===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(f===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const m=Ri(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${t}, uv);
    }
  `}function pB(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=Ro(e);if(r.length<e.length){const x=Ea(n,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Ta(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Ra(y,o)});
      }
    `}const i=e[5],a=e[4]*i,c=e[3]*a,l=e[2]*c,d=e[1]*l;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Aa(n)}
      }
    `;const h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,f=p[0],m=p[1];if(m===d&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(m===i&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const g=Ri(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Aa(n){const e=n.name,t=we(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function fB(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=tN(n.shapeInfo.logicalShape,e.logicalShape),c=an(i),l=i-o;let d;const h=["x","y","z","w","u","v"];o===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(b=>`coords.${h[b+l]} = 0;`).join(`
`);let p="";i<2&&o>0?p="coords":p=n.shapeInfo.logicalShape.map((b,v)=>`coords.${h[v+l]}`).join(", ");let f="return outputValue;";const g=we(n.shapeInfo.logicalShape)===1,y=we(e.logicalShape)===1;if(o===1&&!g&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)i===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=o-2,v=o-1;a.indexOf(b)>-1&&a.indexOf(v)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${f}
    }
  `}function mB(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===c&&n.shapeInfo.flatOffset==null&&en(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const l=an(c),d=tN(n.shapeInfo.logicalShape,e.logicalShape),h=c-a;let p;const f=["x","y","z","w","u","v"];a===0?p="":c<2&&d.length>=1?p="coords = 0;":p=d.map(g=>`coords.${f[g+h]} = 0;`).join(`
`);let m="";return c<2&&a>0?m="coords":m=n.shapeInfo.logicalShape.map((g,x)=>`coords.${f[x+h]}`).join(", "),`
    float ${r}() {
      ${l} coords = getOutputCoords();
      ${p}
      return get${s}(${m});
    }
  `}function an(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Xg(n,e,t){const{newShape:s,keptDims:r}=Ro(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):s,c=!n&&o>1&&!en(e,t)&&s.length<o||i;return{useSqueezeShape:c,uniformShape:c?a:e,keptDims:r}}function Ea(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Ra(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n,e,t,s){const r=t.map((d,h)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:p}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=P4(r,i,e),c=l4(n.gl,a),l=n.createProgram(c);return fe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(l),Object.assign({program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:o,outShapeInfo:i},rN(n,e,l)))}function rN(n,e,t){const s=[],r=[];let o,i,a,c=null,l=null;l=n.getUniformLocation(t,"NAN",!1),fe().getNumber("WEBGL_VERSION")===1&&(c=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const h of e.variableNames){const p={name:h,uniform:n.getUniformLocation(t,h,d),offset:n.getUniformLocation(t,`offset${h}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${h}Shape`,d),p.texShape=n.getUniformLocation(t,`${h}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),i=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const h of e.customUniforms)r.push(n.getUniformLocation(t,h.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:c,nanLoc:l,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function Jx(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!en(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,c=o.isUniform?null:o.texData.texShape;if(!en(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function xB(n,e,t,s,r){e.program.enableShapeUniforms||(Jx(e.inShapeInfos,t),Jx([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),fe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){const l=t[c],{uniform:d,offset:h,shape:p,texShape:f}=e.variablesLocations[c];if(p){const{uniformShape:m}=Xg(e.program.packedInputs,l.shape,l.texData.texShape);switch(m.length){case 1:n.gl.uniform1iv(p,new Int32Array(m));break;case 2:n.gl.uniform2iv(p,new Int32Array(m));break;case 3:n.gl.uniform3iv(p,new Int32Array(m));break;case 4:n.gl.uniform4iv(p,new Int32Array(m));break}}if(f&&n.gl.uniform2i(f,l.texData.texShape[0],l.texData.texShape[1]),d!=null){if(l.isUniform){if(we(l.shape)<2)n.gl.uniform1f(d,l.uniformValues[0]);else{let m=l.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),n.gl.uniform1fv(d,m)}continue}l.texData.slice!=null&&h!=null&&n.gl.uniform1i(h,l.texData.slice.flatOffset),n.setInputMatrixTexture(l.texData.texture.texture,d,c)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const c=xt(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const l=e.program.customUniforms[c],d=e.customUniformLocations[c],h=r[c];if(l.type==="float")n.gl.uniform1fv(d,h);else if(l.type==="vec2")n.gl.uniform2fv(d,h);else if(l.type==="vec3")n.gl.uniform3fv(d,h);else if(l.type==="vec4")n.gl.uniform4fv(d,h);else if(l.type==="int")n.gl.uniform1iv(d,h);else if(l.type==="ivec2")n.gl.uniform2iv(d,h);else if(l.type==="ivec3")n.gl.uniform3iv(d,h);else if(l.type==="ivec4")n.gl.uniform4iv(d,h);else throw Error(`uniform type ${l.type} is not supported yet.`)}n.executeProgram()}function yB(n,e,t){let s="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const c=i.texData.texShape,{useSqueezeShape:l,uniformShape:d,keptDims:h}=Xg(n.packedInputs,i.shape,c);let p="",f="",m="";if(d.length===1&&n.packedInputs){const S=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];p=`${S[0]>1}_${S[1]>1}`}else if(d.length===2&&!n.packedInputs)f=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const S=xt(d);m=`${S[0]===c[1]}_${S[S.length-1]===c[1]}`}const g=i.shape.length,x=d.length===2&&en(i.shape,c),y=we(i.shape)===1,b=ca(i.shape,t.shape),v=!n.packedInputs&&g===t.shape.length&&en(c,t.texData.texShape),w=n.packedInputs||d.length>2?"":`${c[0]>1}_${c[1]>1}`;s+=`${g}_${v}_${l?h:""}_${d.length}_${y}_${b}_${x}_${p}_${f}_${m}_${w}_${a}`}else{const c=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${c}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${fe().getNumber("WEBGL_VERSION")}`,o}function ss(n){return fe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bB{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=lc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ds();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Nh(["r","c","d"],e):Ei(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wB{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=lc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=ds();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Nh(["r","c","d"],e):Ei(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vB{constructor(e){this.variableNames=["A"],this.outTexUsage=Fs.DOWNLOAD;const t=ds();this.outputShape=e,this.userCode=`
      ${eN}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SB{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Fs.DOWNLOAD;const t=ds();this.outputShape=e,this.userCode=`
      ${eN}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CB={R:0,G:1,B:2,A:3};class Zx{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ds();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const c=s[a];i+=`
          if(offset == ${a}) {
            result = values[${CB[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Kg():qg(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NB{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ds();this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const c=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Kg():qg(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(n){const e=ds(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return c4(n,t)}function kB(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return p4(n,e)}function $B(n){const e=new Uint16Array([0,1,2,2,1,3]);return f4(n,e)}function Rl(n,e,t,s,r,o){g4(e,t);const i=m4(n),a=n.TEXTURE_2D;return Ye(n,()=>n.bindTexture(a,i)),Ye(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Ye(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Ye(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Ye(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),fe().getNumber("WEBGL_VERSION")===1?Ye(n,()=>n.texImage2D(a,0,s,e,t,0,r,o,null)):Ye(n,()=>n.texStorage2D(a,1,s,e,t)),Ye(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function oN(n){return n.internalFormatFloat}function TB(n,e,t,s){const[r,o]=Al(e,t);return Rl(n,r,o,oN(s),s.textureFormatFloat,n.FLOAT)}function iN(n){return n.internalFormatHalfFloat}function AB(n,e,t,s){const[r,o]=Al(e,t);return Rl(n,r,o,iN(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function aN(n){return n.downloadTextureFormat}function EB(n,e,t,s){const[r,o]=Al(e,t);return Rl(n,r,o,aN(s),n.RGBA,n.UNSIGNED_BYTE)}function cN(n){return n.internalFormatPackedFloat}function RB(n,e,t,s){const[r,o]=$a(e,t);return Rl(n,r,o,cN(s),n.RGBA,n.FLOAT)}function lN(n){return n.internalFormatPackedHalfFloat}function DB(n,e,t,s){const[r,o]=$a(e,t);return Rl(n,r,o,lN(s),n.RGBA,s.textureTypeHalfFloat)}function _B(n,e,t){return Ye(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Xx(n,e,"clipSpacePos",t,3,20,0)&&Xx(n,e,"uv",t,2,20,12)}function PB(n,e,t,s,r,o){Ye(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,c;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,c=n.RGBA):(i=new Float32Array(t*s*4),a=n.FLOAT,c=o.internalFormatPackedFloat),i.set(r),fe().getNumber("WEBGL_VERSION")===2?Ye(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,i)):Ye(n,()=>n.texImage2D(n.TEXTURE_2D,0,c,t,s,0,n.RGBA,a,i)),Ye(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function jB(n,e,t){Ye(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?fe().getNumber("WEBGL_VERSION")===2?Ye(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Ye(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):fe().getNumber("WEBGL_VERSION")===2?Ye(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Ye(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Ye(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function MB(n,e,t,s){const r=n.createBuffer();Ye(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Ye(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Ye(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Ye(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function FB(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function OB(n,e,t,s){const[r,o]=Al(e,t),i=4,a=new Uint8Array(t4(e*t,i));return Ye(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function LB(n,e,t,s,r,o,i,a){const c=n,l=new Float32Array(n4(o,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function zB(n,e,t){const s=new Float32Array(e*t*4);return Ye(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ip{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=fe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,JW(t,e)):this.gl=wr(t),e=this.gl,fe().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Ye(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Ye(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Ye(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Ye(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ye(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Ye(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Ye(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Ye(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),fe().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Ul(this.gl,o),Js(this.gl,i))this.textureHalfFloatExtension=Ul(this.gl,i);else if(fe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Js(this.gl,r))this.colorBufferHalfFloatExtension=Ul(this.gl,r);else if(fe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Js(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Js(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=kB(this.gl),this.indexBuffer=$B(this.gl),this.framebuffer=x4(this.gl),this.textureConfig=Hg(this.gl,this.textureHalfFloatExtension)}get debug(){return fe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ye(e,()=>e.finish()),Ye(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ye(e,()=>e.deleteFramebuffer(this.framebuffer)),Ye(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ye(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ye(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),TB(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),AB(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),EB(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),jB(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),PB(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),DB(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),RB(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Qx(this.gl,this.framebuffer),this.outputTexture=null),Ye(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>OB(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return LB(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return FB(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=MB(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(fe().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>zB(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=IB(t));const s=d4(t);Ye(t,()=>t.attachShader(s,this.vertexShader)),Ye(t,()=>t.attachShader(s,e)),h4(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&np(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Ye(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),_B(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ye(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&np(this.gl,this.program),Ye(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?b4(this.gl,e,t):w4(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Ye(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),v4(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=$a(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&np(this.gl,this.program),Gl(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ye(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ye(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ul(this.gl,fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await O0(()=>this.disposed||this.isQueryAvailable(e,fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=WB(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in fe().platform&&(s=fe().platform.setTimeoutCustom.bind(fe().platform)),O0(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),sp(this.gl,e,this.framebuffer),this.debug&&Gl(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(sp(this.gl,this.outputTexture,this.framebuffer),this.debug&&Gl(this.gl)):Qx(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;sp(r,e,this.framebuffer),this.debug&&Gl(r),this.outputTexture=e,Ye(r,()=>r.viewport(0,0,t,s)),Ye(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Ye(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function WB(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:BB,bincountImpl:uN,bincountReduceImpl:VB,bitwiseAndImpl:UB,castImpl:GB,ceilImpl:HB,concatImpl:qB,equalImpl:KB,expImpl:XB,expm1Impl:QB,floorImpl:YB,gatherNdImpl:JB,gatherV2Impl:ZB,greaterImpl:e5,greaterEqualImpl:t5,lessImpl:n5,lessEqualImpl:s5,linSpaceImpl:r5,logImpl:o5,maxImpl:i5,maximumImpl:a5,minimumImpl:c5,multiplyImpl:l5,negImpl:u5,notEqualImpl:d5,prodImpl:h5,raggedGatherImpl:p5,raggedRangeImpl:f5,raggedTensorToTensorImpl:m5,rangeImpl:g5,rsqrtImpl:x5,scatterImpl:y5,sigmoidImpl:b5,simpleAbsImpl:dN,sliceImpl:w5,sparseFillEmptyRowsImpl:v5,sparseReshapeImpl:S5,sparseSegmentReductionImpl:hN,sqrtImpl:C5,staticRegexReplaceImpl:N5,stridedSliceImpl:I5,stringNGramsImpl:k5,stringSplitImpl:$5,stringToHashBucketFastImpl:T5,subImpl:A5,tileImpl:E5,topKImpl:R5,transposeImpl:Qg,uniqueImpl:D5}=jF;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pN(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function cs(n,e){return e===1?[n]:pN(n,e)}function _5(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P5{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ss(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=cs("rc",this.rank),s=an(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fN{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${j5(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Kg():qg(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function j5(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?_4(["r","c","d"],"inputShape"):Ei(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M5{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=ty(t,s),o=ny(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=ey(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const c=this.freeTextures[o].pop();return this.usedTextures[o].push(c),c}let a;return r===qn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===qn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===qn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===qn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=ty(s,r),i=ny(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=ey(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=fe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[i],d=l&&l.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[d]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function F5(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function ey(n,e,t,s,r){const o=O5(e,s);let i;if(r){const[c,l]=$a(n[0],n[1]);i=c*l}else{const[c,l]=Al(n[0],n[1]);i=c*l}const a=F5(t,o);return i*a}function O5(n,e){switch(n){case qn.PACKED_2X2_FLOAT32:return cN(e);case qn.PACKED_2X2_FLOAT16:return lN(e);case qn.UNPACKED_FLOAT32:return oN(e);case qn.UNPACKED_FLOAT16:return iN(e);case qn.PACKED_4X1_UNSIGNED_BYTE:return aN(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function L5(n){return fe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?qn.PACKED_2X2_FLOAT32:qn.UNPACKED_FLOAT32:n?qn.PACKED_2X2_FLOAT16:qn.UNPACKED_FLOAT16}function ty(n,e){if(n===Fs.UPLOAD)return qn.PACKED_2X2_FLOAT32;if(n===Fs.RENDER||n==null)return L5(e);if(n===Fs.DOWNLOAD||n===Fs.PIXELS)return qn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function ny(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const sr="if (isnan(x)) return x;",z5="return x;",sy="return abs(x);",W5="return (x >= 0.0) ? x : (exp(x) - 1.0);",B5=sr+`
  return (x < 0.0) ? 0.0 : x;
`,V5=sr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,fo="return x;",U5="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G5="return x;",H5=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,q5=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,K5=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,X5="return 1.0 / (1.0 + exp(-1.0 * x));";class yo{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q5{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);const t=e.length,s=cs("rc",t),r=an(t),o=_5(t,s),i=s.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y5=Fw,J5=1e-7,Z5=1e-4,Kl={};function eV(n){return n in Kl||(Kl[n]={}),Kl[n]}const tV=fe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),nV=600;function sV(){return fe().global.screen==null?1024:fe().global.screen.height*fe().global.screen.width*window.devicePixelRatio*nV/1024/1024}class Ih extends uf{nextDataId(){return Ih.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!fe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof ip)t=e;else{const s=wr(fe().getNumber("WEBGL_VERSION"),e);t=new ip(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=wr(fe().getNumber("WEBGL_VERSION"));t=new ip(s),this.binaryCache=eV(fe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new M5(this.gpgpu),this.numMBBeforeWarning=sV(),this.texData=new rb(this,kr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,i){const a=this.makeTensorInfo(t,s),c=this.texData.get(a.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,o]},c.texShape=[r,o];const l=Hl(t),d=new Zx(l,!1,i),h=this.runWebGLProgram(d,[a],s,[[r,o]]);return h.shape=t,c.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,t,s){if((fe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||fe().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Fs.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(fe().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Fs.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:c}=t;if(i!=null){let p;c?p=new yo(a,fo):p=new Dr(a,fo);const f=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),m=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),m}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const l=this.activeTimers!=null;let d;l&&(d=ps());let h;if(r==="complex64"){const p=this.readSync(o.real.dataId),f=this.readSync(o.imag.dataId);h=no(p,f)}else h=this.getValuesFromTexture(e);return l&&(this.downloadWaitMs+=ps()-d),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:c}=t;if(o!=null){let m;c?m=new yo(r,fo):m=new Dr(r,fo);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:i}],i),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(fe().getBool("DEBUG")&&!fe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&fe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,d;if(i!=="complex64"&&fe().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const m=this.texData.get(d.dataId);l=this.gpgpu.createBufferFromTexture(m.texture.texture,...Vl(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){const m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=m[0],x=m[1];h=no(g,x)}else if(l==null)h=this.getValuesFromTexture(e);else{const m=we(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(l,m)}if(d!=null&&this.disposeIntermediateTensorInfo(d),l!=null){const m=this.gpgpu.gl;Ye(m,()=>m.deleteBuffer(l))}const p=this.convertAndCacheOnCPU(e,h),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(m=>m(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&kr().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:c,texture:l}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let f;c?f=new yo(o,fo):f=new Dr(o,fo);const m=this.runWebGLProgram(f,[{dataId:e,shape:o,dtype:a}],a),g=this.readToGPU(m,t);return this.disposeIntermediateTensorInfo(m),g}if(l==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),h=kr().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:h},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Io(r));return Wt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Wt(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!i4(s))throw fe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=we(t);if(fe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),f=this.texData.get(p.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...Vl(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(p),m}const i=fe().getBool("WEBGL_PACK")&&r===!0,a=i?Hl(t):t,c=i?new SB(a):new vB(a),l=this.runWebGLProgram(c,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(l.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(l),h}timerAvailable(){return fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=ai(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),i=ai(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(o);a.kernelMs=Sk(c),a.getExtraProfileInfo=()=>c.map((l,d)=>({name:i[d],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ps(),endMs:null}}endTimer(e){return fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=ps(),e)}async getQueryTime(e){if(fe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),c=a&&a.origDataId||e,l=this.dataRefCount.get(c);l>1?this.dataRefCount.set(c,l-1):(this.dataRefCount.delete(c),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=tV){return fe().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&we(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Ms("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return Y5(e.shape,t)}packedUnaryOp(e,t,s){const r=new yo(e.shape,t),o=this.compileAndRun(r,[e],s);return kr().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=dN(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(fe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sy,e.dtype);const t=new Dr(e.shape,sy),s=this.compileAndRun(t,[e]);return kr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&gc(s[0])){const o=s.map(i=>wo(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return kr().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new Q5(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new P5(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[ma(e.shape),...ga(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[ma(t),...ga(t)],i=new fN(o,s),a=!0,c=[s],l=this.runWebGLProgram(i,[r],e.dtype,c,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const p=we(o),f=t[0]*t[1]*4;E(p<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Hl(o);let c;r?c=new wB(a):c=new bB(a);const l=!0,d=[t??Vl(a)],h=this.runWebGLProgram(c,[{shape:a,dtype:i,dataId:e}],i,d,l,t);return{dtype:i,shape:o,dataId:h.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),c=this.texData.get(a.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===lc.DENSE){const y=i??Vl(e.outputShape);c.texShape=y.map(b=>b*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),we(a.shape)===0)return c.values=Jn(a.dtype,0),a;const l=[],d=t.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!e.packedInputs&&we(y.shape)<=fe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!e.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!_u(b.shape,y.shape)){const v=y,w=y.shape;y.shape=b.shape,y=this.packedReshape(y,w),l.push(y),b=this.texData.get(y.dataId),v.shape=w}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:c,isUniform:!1},p=yB(e,d,h),f=this.getAndSaveBinary(p,()=>gB(this.gpgpu,e,d,h)),m=this.activeTimers!=null;let g;m&&(g=this.startTimer()),fe().get("ENGINE_COMPILE_ONLY")||xB(this.gpgpu,f,d,h,r),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=fe().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const y=ps();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!fe().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(fe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ce(()=>{if(!fe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=fe().getBool("DEBUG");fe().set("DEBUG",!1);const t=this.abs(Zt(1e-8)).dataSync()[0];if(fe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?J5:Z5}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:c}=t;if(i!=null)return;const l=this.activeTimers!=null;let d;l&&(d=ps());let h=t.texShape;if(h==null&&(h=N4(s,c),t.texShape=h),o!=null){const p=Hl(s);let f,m=h[1],g=h[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(c||!x)&&([m,g]=$a(h[0],h[1])),c?f=new NB(p,x):f=new Zx(p,x);const y=x?[g,m]:h,b=this.makeTensorInfo(y,r),v=this.texData.get(b.dataId);x?v.usage=Fs.PIXELS:v.usage=Fs.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,g,o);const w=[[g,m]],N=this.runWebGLProgram(f,[b],r,w,!0),C=this.texData.get(N.dataId);t.texShape=C.texShape,t.isPacked=C.isPacked,t.usage=C.usage,fe().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(t.texture=C.texture,t.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=ps()-d)}else{const p=this.acquireTexture(h,a,r,c);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=rV(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*iu(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await nv(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(ZC(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:c}=rN(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=c}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,c=kr().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=c.writeTexture(r,t,s,o,i,a);return kr().makeTensorFromDataId(l,t,s,c)}}Ih.nextDataId=0;function rV(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Yb()&&ew("webgl",()=>new Ih,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yg=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class wi{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=_t(t,s),this.enableShapeUniforms=ss(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Di=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Da{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_t(t,s);const o=this.outputShape.length;this.enableShapeUniforms=ss(o);let i="";if(r)if(o===0||we(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${an(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=cs("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${c[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${c[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const oV={kernelName:Fc,backendName:"webgl",kernelFunc:_s};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wo(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),a=_s({inputs:{x:s},backend:t}),c=_s({inputs:{x:r},backend:t});return i.complexTensorInfos={real:a,imag:c},o}const iV={kernelName:Cf,backendName:"webgl",kernelFunc:Wo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mN="return (a < 0.) ? b * a : a;",gN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function aV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",Do(o,"float32")),a=fe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da(gN,r.shape,i.shape):new wi(mN,r.shape,i.shape),c=t.runWebGLProgram(a,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),c}const cV={kernelName:yd,backendName:"webgl",kernelFunc:aV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xN="return (a < 0.) ? b * a : a;",yN=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function lV(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=fe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da(yN,s.shape,r.shape):new wi(xN,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const uV={kernelName:Fd,backendName:"webgl",kernelFunc:lV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _a="if (isnan(x)) return x;";function Kt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,c=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const h=a.texData.get(i.dataId),p=t(h.values,c);return a.makeTensorInfo(i.shape,c,p)}const l=fe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return l?d=new yo(i.shape,e):d=new Dr(i.shape,n),a.runWebGLProgram(d,[i],c)}}function Yn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:c,b:l}=i,d=a;if(s&&c.dtype==="complex64"){const m=d.texData.get(c.dataId),g=d.texData.get(l.dataId),[x,y]=[[m.complexTensorInfos.real,g.complexTensorInfos.real],[m.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[w,S]=v,N={dataId:w.dataId,dtype:w.dtype,shape:c.shape},C={dataId:S.dataId,dtype:S.dtype,shape:l.shape},k=new wi(n,c.shape,l.shape);return d.runWebGLProgram(k,[N,C],Rs(w.dtype,S.dtype))}),b=Wo({inputs:{real:x,imag:y},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(y),b}const h=o||Rs(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||d.shouldExecuteOnCPU([c,l]))&&r!=null){const m=d.texData.get(c.dataId).values,g=d.texData.get(l.dataId).values,x=c.dtype==="string"?so(m):m,y=c.dtype==="string"?so(g):g,[b,v]=r(c.shape,l.shape,x,y,h),w=d.makeTensorInfo(v,h),S=d.texData.get(w.dataId);return S.values=b,w}const p=fe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return p?f=new Da(e,c.shape,l.shape,t):f=new wi(n,c.shape,l.shape),d.runWebGLProgram(f,[c,l],h)}}function uc(n,e=!1){if(n==="linear")return e?G5:z5;if(n==="relu")return e?q5:B5;if(n==="elu")return e?H5:W5;if(n==="relu6")return e?K5:V5;if(n==="prelu")return e?yN:xN;if(n==="leakyrelu")return e?gN:mN;if(n==="sigmoid")return e?X5:U5;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bN{constructor(e,t,s,r=!1,o=!1,i=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ss(this.outputShape.length);const d=r?e[1]:e[2],h=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",f=o?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",y="";a&&(c?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",w="rc.x";e[0]<t[0]?v=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(w=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${w};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${g[0]});
          result += (${m[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ry={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class oy{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=_t(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iy="return a * b;";function Jg(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=Rs(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),l=new oy(ry.REAL,s.shape,r.shape),d=new oy(ry.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(l,h,"float32"),f=t.runWebGLProgram(d,h,"float32"),m=Wo({inputs:{real:p,imag:f},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),m}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),c=t.texData.get(r.dataId),[l,d]=l5(s.shape,r.shape,a.values,c.values,o),h=t.makeTensorInfo(d,o),p=t.texData.get(h.dataId);return p.values=l,h}let i;return fe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Da(iy,s.shape,r.shape):i=new wi(iy,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const dV={kernelName:Hc,backendName:"webgl",kernelFunc:Jg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e,t){const s=[ma(n.shape),...ga(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[ma(e),...ga(e)],i=new fN(o,s),a=!0,c=[s],l=t.runWebGLProgram(i,[r],n.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ue(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,a=we(r.shape),c=ib(o,a),l=we(c);E(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!_u(r.shape,c)&&!(d.texture!==null&&_u(d.shape,c))?hV(r,c,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const pV={kernelName:Ld,backendName:"webgl",kernelFunc:Ue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ay{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,c=s%4;let l="sumValue += dot(values, ones);";if(t!=null){const h=1/t;l=`sumValue += dot(values * ${ra(h)?h.toPrecision(2):h}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fV{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",c="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",c="min"):t==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");const d=Math.floor(s/4)*4,h=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=ch(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function _i(n,e,t,s){const r=mV(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:c,outSize:l}=r[i];let d,h;t==="mean"?d=i===0?new ay({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},a):new ay({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l}):d=new fV({windowSize:c,inSize:a,batchSize:n.shape[0],outSize:l},t),h=o,o=s.runWebGLProgram(d,[o],e),h.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(h)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gV{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=an(this.rank),o=xV(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function xV(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yV{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=an(this.rank),o=pN("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const a=`vec2(${i.slice(-2).join()})`,c=`++${o[this.rank-1]} < ${s[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kh(n,e,t){const s=fe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yV(n.shape,e):new gV(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e,t,s){const r=e,o=n.shape.length,i=Bt(r,n.shape);let a=i;const c=Cn(a,o),l=c!=null;let d=n;l&&(d=kh(n,c,s),a=Tn(a.length,o)),Qn("sum",a,o);const[h,p]=Hn(d.shape,a);let f=h;t&&(f=_n(h,i));const m=we(p),x=we(n.shape)/m,y=Ue({inputs:{x:d},attrs:{shape:[x,m]},backend:s}),b=rm(n.dtype),v=_i(y,b,"sum",s),w=Ue({inputs:{x:v},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),l&&s.disposeIntermediateTensorInfo(d),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $h(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return bV(r,o,i,t)}const wV={kernelName:Gd,backendName:"webgl",kernelFunc:$h};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function us(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,a=r.shape.length,c=new Array(a);for(let d=0;d<c.length;d++)c[d]=r.shape[o[d]];let l;if(i.shouldExecuteOnCPU([r])){const h=i.texData.get(r.dataId).values,p=Qg(h,r.shape,r.dtype,o,c);l=i.makeTensorInfo(c,r.dtype);const f=i.texData.get(l.dataId);f.values=p}else l=kh(r,o,i);return l}const vV={kernelName:Qi,backendName:"webgl",kernelFunc:us};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wN=1e3;function Pu({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){const l=n.shape.length,d=e.shape.length,h=t?n.shape[l-2]:n.shape[l-1],p=s?e.shape[d-1]:e.shape[d-2],f=t?n.shape[l-1]:n.shape[l-2],m=s?e.shape[d-2]:e.shape[d-1],g=n.shape.slice(0,-2),x=e.shape.slice(0,-2),y=we(g),b=we(x),w=_t(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,m]);E(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const S=t?[y,h,f]:[y,f,h],N=s?[b,m,p]:[b,p,m],C=Ue({inputs:{x:n},backend:r,attrs:{shape:S}}),k=Ue({inputs:{x:e},backend:r,attrs:{shape:N}}),I=[C,k],$=Math.max(y,b),j=t?C.shape[1]:C.shape[2],P=o!=null,O=i!=null,A=c==="leakyrelu",z=c!=null?uc(c,!0):null,L=P||O||A||z!=null;let U;if((f===1||m===1)&&j>wN&&L===!1){let B=C,Y=k;t&&(B=us({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),I.push(B)),s&&(Y=us({inputs:{x:k},backend:r,attrs:{perm:[0,2,1]}}),I.push(Y));const K=m!==1,pe=m===1;let ge=B;K&&(ge=Ue({inputs:{x:B},backend:r,attrs:{shape:[$,j,1]}}),I.push(ge));const re=m===1?2:1;let ye=Y;pe&&(ye=Ue({inputs:{x:Y},backend:r,attrs:{shape:[$,1,j]}}),I.push(ye));const Ae=Jg({inputs:{a:ge,b:ye},backend:r});U=$h({inputs:{x:Ae},backend:r,attrs:{axis:re,keepDims:!0}}),I.push(Ae)}else{const B=Rs(n.dtype,e.dtype),Y=new bN(S,N,[$,f,m],t,s,P,z,O,A),K=[C,k];if(o!=null&&K.push(o),O&&K.push(i),A){const pe=r.makeTensorInfo([],"float32",Do(a,"float32"));K.push(pe),I.push(pe)}U=r.runWebGLProgram(Y,K,B)}const V=Ue({inputs:{x:U},backend:r,attrs:{shape:w}});I.push(U);for(const B of I)r.disposeIntermediateTensorInfo(B);return V}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:d,leakyreluAlpha:h}=s;return Pu({a:r,b:o,transposeA:c,transposeB:l,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const CV={kernelName:au,backendName:"webgl",kernelFunc:SV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cy="return abs(x);";function NV(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=dN(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return fe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new yo(s.shape,cy):r=new Dr(s.shape,cy),t.runWebGLProgram(r,[s],s.dtype)}const IV={kernelName:Ju,backendName:"webgl",kernelFunc:NV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kV=sr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,$V=Kt({opSnippet:kV}),TV={kernelName:xc,backendName:"webgl",kernelFunc:$V};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AV=sr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,EV=Kt({opSnippet:AV}),RV={kernelName:yc,backendName:"webgl",kernelFunc:EV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ly="return a + b;",DV=Yn({opSnippet:ly,packedOpSnippet:ly,supportsComplex:!0,cpuKernelImpl:BB}),_V={kernelName:va,backendName:"webgl",kernelFunc:DV};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PV{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jV{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ou(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return _s({inputs:{x:s[0]},backend:t});if(s.length>fe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(s.length/2),l=ou({inputs:s.slice(0,c),backend:t}),d=ou({inputs:s.slice(c),backend:t});return ou({inputs:[l,d],backend:t})}const r=s.map(c=>c.dtype).reduce((c,l)=>Rs(c,l)),o=s.map(c=>c.shape),a=fe().getBool("WEBGL_PACK")?new jV(s[0].shape,o):new PV(s[0].shape,o);return t.runWebGLProgram(a,s,r)}const MV={kernelName:gf,backendName:"webgl",kernelFunc:ou};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Bt(o,r.shape);let l=c;const d=Cn(l,a);let h=r;d!=null&&(h=us({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,a)),Qn("all",l,a);const[p,f]=Hn(h.shape,l),m=we(f),g=Ue({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=_i(g,g.dtype,"all",t);let y;if(i){const b=_n(p,c);y=Ue({inputs:{x},backend:t,attrs:{shape:b}})}else y=Ue({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const OV={kernelName:xf,backendName:"webgl",kernelFunc:FV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Bt(o,r.shape);let l=c;const d=Cn(l,a);let h=r;d!=null&&(h=us({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,a)),Qn("any",l,a);const[p,f]=Hn(h.shape,l),m=we(f),g=Ue({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=_i(g,g.dtype,"any",t);let y;if(i){const b=_n(p,c);y=Ue({inputs:{x},backend:t,attrs:{shape:b}})}else y=Ue({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const zV={kernelName:yf,backendName:"webgl",kernelFunc:LV};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WV{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",c=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BV{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,c=a.length,l=an(c),d=cs("coords",c);let h,p;if(i===1){p=c+1;const k=an(p);h=`
        ${k} sourceLocR = ${k}(${d.join()}, 0);
        ++${d[c-1]};
        ${k} sourceLocG = ${k}(${d.join()}, 0);
        ++${d[c-2]};
        ${k} sourceLocA = ${k}(${d.join()}, 0);
        --${d[c-1]};
        ${k} sourceLocB = ${k}(${d.join()}, 0);
        --${d[c-2]};`}else p=c,h=`
        ${l} sourceLocR = coords;
        ++${d[c-1]};
        ${l} sourceLocG = coords;
        ++${d[c-2]};
        ${l} sourceLocA = coords;
        --${d[c-1]};
        ${l} sourceLocB = coords;
        --${d[c-2]};`;const f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],g=f.map(k=>"int "+k),x=cs("sourceLocR",p-1).concat("inIdx.r"),y=cs("sourceLocG",p-1).concat("inIdx.g"),b=cs("sourceLocB",p-1).concat("inIdx.b"),v=cs("sourceLocA",p-1).concat("inIdx.a"),w=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${v.join()})));`,N=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,C=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${C}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${d[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${d[c-2]} < ${a[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vN(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=ch(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},c=new WV(a,t,s==null),l=[e];s!=null&&l.push(s);const d=n.runWebGLProgram(c,l,"int32");if(d.shape[1]===1)return d;const h=vN(n,e,t,d);return n.disposeIntermediateTensorInfo(d),h}function SN(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=ch(o),a=new BV(r,i,t,s==null),c=s==null?[e]:[e,s],l=n.runWebGLProgram(a,c,"int32");if(l.shape.length===e.shape.length){const d=SN(n,e,t,l);return n.disposeIntermediateTensorInfo(l),d}return l}function CN(n,e,t,s){const r=[t];if(Qn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!fe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let c=e;a&&(c=n.unpackTensor(e),o.push(c));const[l,d]=Hn(c.shape,r),h=we(d),p=Ue({inputs:{x:c},backend:n,attrs:{shape:[-1,h]}});o.push(p);const f=vN(n,p,s);o.push(f);const m=Ue({inputs:{x:f},backend:n,attrs:{shape:l}});return o.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}return SN(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Bt(o,r.shape);const a=Cn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=us({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),Qn("argMax",[i[0]],c.shape.length);const d=CN(t,c,i[0],"max");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const UV={kernelName:Zu,backendName:"webgl",kernelFunc:VV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Bt(o,r.shape);const a=Cn(i,r.shape.length);let c=r;const l=[];a!=null&&(c=us({inputs:{x:r},backend:t,attrs:{perm:a}}),l.push(c),i=Tn(i.length,c.shape.length)),Qn("argMin",[i[0]],c.shape.length);const d=CN(t,c,i[0],"min");return l.forEach(h=>t.disposeIntermediateTensorInfo(h)),d}const HV={kernelName:ed,backendName:"webgl",kernelFunc:GV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qV=sr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,KV=Kt({opSnippet:qV}),XV={kernelName:bc,backendName:"webgl",kernelFunc:KV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QV=sr+"return log(x + sqrt(x * x + 1.0));",YV=Kt({opSnippet:QV}),JV={kernelName:wc,backendName:"webgl",kernelFunc:YV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZV=sr+`
  return atan(x);
`,eU=Kt({opSnippet:ZV}),tU={kernelName:vc,backendName:"webgl",kernelFunc:eU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU=Yg+`
  return atan(a, b);
`,sU=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Di+`
  return result;
`,rU=Yn({opSnippet:nU,packedOpSnippet:sU}),oU={kernelName:Cc,backendName:"webgl",kernelFunc:rU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iU=sr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,aU=Kt({opSnippet:iU}),cU={kernelName:Sc,backendName:"webgl",kernelFunc:aU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dc{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const g=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),s){const k=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:y:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let w=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(w="avgValue / max(count, 1.0)");const S=Math.floor(i/4)*4,N=i%4,C=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${C}
          }

          int xC = xCCorner + ${S};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${C}
          }
        }
        setOutput(${w});
      }
    `}}class Zg{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,c=e.strideHeight,l=e.strideWidth,d=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,y=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg";let w="0.0";if(v||(w="-1.0 / 1e-20"),s){const $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${x}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let N=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(N="avgValue / max(count, 1.0)");const C=Math.floor(i/4)*4,k=i%4,I=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${x}, ${y}, ${b});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${I}
            }

            int xC = xCCorner + ${C};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${I}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${I}
            }
          }
        }
        setOutput(${N});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;El(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&en(d.inShape,d.outShape))return _s({inputs:{x:r},backend:t});const h=new dc(d,"avg",!1);return t.runWebGLProgram(h,[r],"float32")}const uU={kernelName:td,backendName:"webgl",kernelFunc:lU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=s,d=[1,1,1],h=io(r.shape,o,i,d,a,c,l),p=new Zg(h,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const hU={kernelName:nd,backendName:"webgl",kernelFunc:dU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pU{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=c-1-e.padInfo.top,h=l-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${h});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class fU{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=h-1-e.padInfo.front,g=p-1-e.padInfo.top,x=f-1-e.padInfo.left,y=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${g}, ${x});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mU(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],p=io(i.shape,a,c,h,l,d),f=new fU(p);return t.runWebGLProgram(f,[r],i.dtype)}const gU={kernelName:wf,backendName:"webgl",kernelFunc:mU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xU(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;El([r,o],"avgPoolGrad");const{filterSize:a,strides:c,pad:l}=s,d=tr(i.shape,a,c,1,l),h=new pU(d);return t.runWebGLProgram(h,[r],i.dtype)}const yU={kernelName:bf,backendName:"webgl",kernelFunc:xU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bU(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return Pu({a:r,b:o,transposeA:i,transposeB:a,backend:t})}const wU={kernelName:sd,backendName:"webgl",kernelFunc:bU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vU{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],_t(e,t),_t(e,s);let a="0.0";r!=null&&(_t(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";o!=null&&(_t(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SU{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],_t(e,t),_t(e,s);let a="vec4(0.0)";r!=null&&(_t(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";o!=null&&(_t(e,o),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;E(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);const l=[s,r,o];let d=null;i!=null&&(d=i.shape,l.push(i));let h=null;a!=null&&(h=a.shape,l.push(a));const p=fe().getBool("WEBGL_PACK_NORMALIZATION")?new SU(s.shape,r.shape,o.shape,d,h,c):new vU(s.shape,r.shape,o.shape,d,h,c);return e.runWebGLProgram(p,l,l[0].dtype)},NU={kernelName:md,backendName:"webgl",kernelFunc:CU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IU{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=an(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=kU(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${Jp[a]} = start[${a}] + coords.${Jp[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const Jp=["x","y","z","w","u","v"];function kU(n){if(n===1)return"sourceLoc";if(n<=6)return Jp.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $U{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=an(this.rank),s=cs("coords",this.rank),r=cs("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,h)=>`start[${h}]`).join()});`:e.map((d,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=Km(e,xt(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const c=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,c+1),o}function Pa(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[a,c]=ah(r,o,i);if(Gm(r,a,c),we(c)===0)return t.makeTensorInfo(c,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=t.texData.get(r.dataId),p=w5(h.values,a,c,r.shape,r.dtype);return t.makeTensorInfo(c,r.dtype,p)}const{isPacked:l}=t.texData.get(r.dataId),d=qm(r.shape,a,c);if(l||!d){const h=fe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $U(c):new IU(c),p=[a];return t.runWebGLProgram(h,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),TU(r,a,c,t)}const AU={kernelName:Ud,backendName:"webgl",kernelFunc:Pa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;E(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,v)=>b*v),c=xl(r.shape,o,a),l=yl(c.length,o.length),d=bl(r.shape,o,a),h=Zm(i,o.length),p=eg(d,i,o.length),f=[],m=Ue({inputs:{x:r},backend:t,attrs:{shape:c}}),g=us({inputs:{x:m},backend:t,attrs:{perm:l}}),x=Ue({inputs:{x:g},backend:t,attrs:{shape:d}}),y=Pa({inputs:{x},backend:t,attrs:{begin:h,size:p}});return f.push(m),f.push(g),f.push(x),f.forEach(b=>t.disposeIntermediateTensorInfo(b)),y},RU={kernelName:rd,backendName:"webgl",kernelFunc:EU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.readSync(r.dataId),c=t.readSync(o.dataId),l=uN(a,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,l)}const _U={kernelName:vf,backendName:"webgl",kernelFunc:DU};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,jU=`
  return float(int(a.r) & int(b.r));
`;function MU(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=fe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=fe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||i===1){const c=t.texData.get(s.dataId).values,l=t.texData.get(r.dataId).values,[d,h]=UB(s.shape,r.shape,c,l,s.dtype),p=t.makeTensorInfo(h,s.dtype),f=t.texData.get(p.dataId);return f.values=d,p}let a;return o?a=new Da(PU,s.shape,r.shape,!1):a=new wi(jU,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const FU={kernelName:Sf,backendName:"webgl",kernelFunc:MU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OU(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),a=_t(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const LU={kernelName:hb,backendName:"webgl",kernelFunc:OU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU="return float(a != b);",NN=Yn({opSnippet:zU,cpuKernelImpl:d5,dtype:"bool"}),WU={kernelName:Dd,backendName:"webgl",kernelFunc:NN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dl(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return _s({inputs:{x:r.complexTensorInfos.real},backend:t})}const BU={kernelName:qf,backendName:"webgl",kernelFunc:Dl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU="return float(int(x));";function UU(n,e){const t=new Dr(n.shape,VU),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zp(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return _s({inputs:{x:r},backend:t});const i=Un(r.shape),a=Zp({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),c=Wo({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),c}if(r.dtype==="complex64"){const i=Dl({inputs:{input:r},backend:t}),a=Zp({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!ab(r.dtype,o)){const i=_s({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[a,c,l]=GB(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,c,l)}if(o==="int32")return UU(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",Jn("bool",1)),c=NN({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const GU={kernelName:Nc,backendName:"webgl",kernelFunc:Zp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uy="return ceil(x);",HU=Kt({opSnippet:uy,packedOpSnippet:uy,cpuKernelImpl:HB}),qU={kernelName:Ic,backendName:"webgl",kernelFunc:HU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KU{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XU{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QU(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;fe().getBool("WEBGL_PACK_CLIP")?a=new XU(r.shape):a=new KU(r.shape);const c=[[o],[i]];return t.runWebGLProgram(a,[r],r.dtype,c)}const YU={kernelName:kc,backendName:"webgl",kernelFunc:QU};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JU{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dy(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function ZU(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new JU(s.shape),i=[dy(s,r.complexTensorInfos.real),dy(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const e6={kernelName:od,backendName:"webgl",kernelFunc:ZU};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t6{constructor(e){this.outputShape=[],this.outputShape=Fr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n6{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Fr(e,t);const s=this.outputShape,r=s.length,o=an(r),i=cs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const c=new Array(e.length-1);c[0]=e[0][t];for(let g=1;g<c.length;g++)c[g]=c[g-1]+e[g][t];const l=a[t],d=a.slice(-2),h=a.join();let p=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${d.join()}));
        }`;for(let g=1;g<c.length;g++){const x=c[g-1];p+=`
        if (${l} < ${c[g]}  && ${l} >= ${c[g-1]}) {
          return getChannel(
            getT${g}(${Xl(a,l,x)}),
            vec2(${Xl(d,l,x)}));
        }`}const f=c.length,m=c[c.length-1];p+=`
        return getChannel(
          getT${f}(${Xl(a,l,m)}),
          vec2(${Xl(d,l,m)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${p}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Xl(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Th(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return _s({inputs:{x:r.complexTensorInfos.imag},backend:t})}const s6={kernelName:Lf,backendName:"webgl",kernelFunc:Th};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qa(n,e,t){const s=n[0].dtype;if(s==="complex64"){const f=n.map(b=>Dl({inputs:{input:b},backend:t})),m=n.map(b=>Th({inputs:{input:b},backend:t})),g=qa(f,e,t),x=qa(m,e,t),y=Wo({inputs:{real:g,imag:x},backend:t});return f.forEach(b=>t.disposeIntermediateTensorInfo(b)),m.forEach(b=>t.disposeIntermediateTensorInfo(b)),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),y}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const f=n.map(w=>{const N=[-1,we(w.shape.slice(e))];return Ue({inputs:{x:w},backend:t,attrs:{shape:N}})}),m=f.map(w=>({vals:t.readSync(w.dataId),shape:w.shape})),g=Fr(f.map(w=>w.shape),1),x=f[0].shape[0]===1,y=qB(m,g,s,x),b=Fr(n.map(w=>w.shape),e),v=t.makeTensorInfo(b,s,y);return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const o=n.filter(f=>we(f.shape)>0),i=fe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const f=i?new Dr(n[0].shape,fo):new yo(n[0].shape,fo);return t.runWebGLProgram(f,n,s)}const a=fe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const f=[];for(let g=0;g<o.length;g+=a){const x=o.slice(g,g+a);f.push(qa(x,e,t))}const m=qa(f,e,t);for(const g of f)t.disposeIntermediateTensorInfo(g);return m}if(i){const f=new n6(o.map(m=>m.shape),e);return t.runWebGLProgram(f,o,s)}const{tensors2D:c,outShape:l}=r6(o,e,t),d=new t6(c.map(f=>f.shape)),h=t.runWebGLProgram(d,c,s);c.forEach(f=>t.disposeIntermediateTensorInfo(f));const p=Ue({inputs:{x:h},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(h),p}function r6(n,e,t){const s=Fr(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>Ue({inputs:{x:o},attrs:{shape:[-1,we(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IN(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Bt(r,e[0].shape)[0],i=e.map(l=>l.shape);Qm(i,o);const a=Fr(e.map(l=>l.shape),o);if(we(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const c=e.filter(l=>we(l.shape)>0);return c.length===1?_s({inputs:{x:c[0]},backend:t}):qa(c,o,t)}const o6={kernelName:id,backendName:"webgl",kernelFunc:IN};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",y=x?1:2,b=x?2:3,v=x?3:1;let w="",S="";s&&(r?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:w=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${S}
        setOutput(result);
      }
    `}}class i6{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,h=e.filterDepth,p=e.filterHeight,f=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $N{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ss(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,h=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)p+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;p+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)p+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(h+1)/2;x++){const y=x*2;if(p+=`
           xC = xCCorner + ${y*c};
           `,a===1){if(y<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,c===1&&y>0?p+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<d)){const b=i%2===0?df(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,c>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:p+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?p+=`
                     xC${y+1} = xTexelC${y};
                     `:p+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<d&&(p+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<d&&(p+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<d&&(p+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let f="",m="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,m="result = activation(result);");const g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a6{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ss(this.outputShape.length);const{dataFormat:s}=t,r=ds(),o=s==="channelsLast",i=o?1:2,a=o?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let l="";for(let d=0;d<=1;d++)for(let h=0;h<=1;h++)l+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${d};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ju(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function TN({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const c=n.shape,l=s.texData.get(n.dataId),d=t.inChannels,h=c[0]*c[1]*c[2],p=t.outChannels,f=t.dataFormat==="channelsLast",m=!1,g=!1;let x;const y=[];if(o!=null){const w=ju(o.shape,f);w!=null&&(o=Ue({inputs:{x:o},backend:s,attrs:{shape:w}}),y.push(o))}if(r!=null){const w=ju(r.shape,f);w!=null&&(r=Ue({inputs:{x:r},backend:s,attrs:{shape:w}}),y.push(r))}if(!((h===1||p===1)&&d>wN)&&l.isPacked&&f&&l.texture!=null&&c[2]%2!==0&&en(l.shape.slice(-3),c.slice(-3))){const w=c[0]*c[1]*(c[2]+1),S={dataId:n.dataId,shape:[1,w,t.inChannels],dtype:n.dtype},N=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,E(_u(l.shape,S.shape),()=>`packed reshape ${l.shape} to ${S.shape} isn't free`);const C=Ue({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});y.push(C);const k=Pu({a:S,b:C,backend:s,transposeA:m,transposeB:g,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),I=s.texData.get(k.dataId);E(I.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=N,I.shape=t.outShape,x=_s({inputs:{x:k},backend:s}),x.shape=t.outShape,y.push(k)}else{const w=t.outHeight*t.outWidth,S=Ue({inputs:{x:n},backend:s,attrs:{shape:f?[t.batchSize,w,t.inChannels]:[t.batchSize,t.inChannels,w]}}),N=Ue({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),C=Pu({a:f?S:N,b:f?N:S,transposeA:!f,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});x=Ue({inputs:{x:C},backend:s,attrs:{shape:t.outShape}}),y.push(S),y.push(N),y.push(C)}for(const w of y)s.disposeIntermediateTensorInfo(w);return x}function AN({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:c,filterHeight:l,inChannels:d,outWidth:h,outHeight:p,dataFormat:f}=t,m=f==="channelsLast",g=c*l*d,x=p*h,y=[t.batchSize,g,x],b=!0,v=!1,w=[];if(o!=null){const V=ju(o.shape,m);V!=null&&(o=Ue({inputs:{x:o},backend:s,attrs:{shape:V}}),w.push(o))}if(r!=null){const V=ju(r.shape,m);V!=null&&(r=Ue({inputs:{x:r},backend:s,attrs:{shape:V}}),w.push(r))}const S=Ue({inputs:{x:e},backend:s,attrs:{shape:[1,g,we(e.shape)/g]}});w.push(S);const N=new a6(y,t),C=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],k=s.runWebGLProgram(N,[n],"float32",C),I=Ue({inputs:{x:k},backend:s,attrs:{shape:y}});w.push(k),w.push(I);const $=r!=null,j=o!=null,P=a==="leakyrelu",O=a?uc(a,!0):null,A=new bN(m?I.shape:S.shape,m?S.shape:I.shape,m?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],b,v,$,O,j,P),z=m?[I,S]:[S,I];if(r&&z.push(r),j&&z.push(o),P){const V=s.makeTensorInfo([],"float32",Do(i,"float32"));z.push(V),w.push(V)}const L=s.runWebGLProgram(A,z,"float32"),U=Ue({inputs:{x:L},backend:s,attrs:{shape:t.outShape}});w.push(L);for(const V of w)s.disposeIntermediateTensorInfo(V);return U}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:d}=s,h=ao(c),p=Xn(r.shape,o.shape,i,l,a,d,!1,h);let f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=TN({x:r,filter:o,convInfo:p,backend:t});else if(p.strideWidth<=2&&h==="channelsLast"&&fe().getBool("WEBGL_EXP_CONV")){const g=new $N(p),x=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];f=t.runWebGLProgram(g,[r,o],"float32",x)}else if(fe().getBool("WEBGL_CONV_IM2COL"))f=AN({x:r,filter:o,convInfo:p,backend:t});else{const g=new kN(p);f=t.runWebGLProgram(g,[r,o],"float32")}const m=Ue({inputs:{x:f},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(f),m}const l6={kernelName:ad,backendName:"webgl",kernelFunc:c6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class d6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,c=s-1-e.padInfo.left,l=i?1:2,d=i?2:3,h=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class h6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class p6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=t-1-e.padInfo.front,l=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:d}=s,h=ao(c),p=Xn(r.shape,d,i,1,a,l,!1,h),f=new u6(p);return t.runWebGLProgram(f,[r,o],"float32")}const m6={kernelName:Nf,backendName:"webgl",kernelFunc:f6};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g6{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ss(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:d}=s,h=ao(l),p=Xn(i,o.shape,a,1,c,d,!1,h);if(fe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const f=[[p.strideHeight,p.strideWidth]],m=new g6(p);return t.runWebGLProgram(m,[r,o],"float32",f)}else{const f=new d6(p);return t.runWebGLProgram(f,[r,o],"float32")}}const y6={kernelName:cd,backendName:"webgl",kernelFunc:x6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=Po(r.shape,o.shape,i,c,a),d=new i6(l);return t.runWebGLProgram(d,[r,o],"float32")}const w6={kernelName:ld,backendName:"webgl",kernelFunc:b6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:c}=s,l=Po(r.shape,c,i,1,a),d=new h6(l);return t.runWebGLProgram(d,[r,o],"float32")}const S6={kernelName:If,backendName:"webgl",kernelFunc:v6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:c}=s,l=Po(c,o.shape,a,1,i),d=new p6(l);return t.runWebGLProgram(d,[r,o],"float32")}const N6={kernelName:kf,backendName:"webgl",kernelFunc:C6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I6=_a+`
  return cos(x);
`,k6=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Di}
  return result;
`,$6=Kt({opSnippet:I6,packedOpSnippet:k6}),T6={kernelName:$c,backendName:"webgl",kernelFunc:$6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A6=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,E6=Kt({opSnippet:A6}),R6={kernelName:Tc,backendName:"webgl",kernelFunc:E6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D6{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,c,l]=e,[d]=t,[h,p]=s;this.outputShape=[d,h,p,l];const f=r==="bilinear"?1:0,[m,g]=[`${a-1}.0`,`${c-1}.0`],[x,y,b]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[v,w,S]=p>1?[`${(c-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=s,d=new D6(r.shape,o.shape,a,c,l);return t.runWebGLProgram(d,[r,o,i],"float32")},P6={kernelName:Tf,backendName:"webgl",kernelFunc:_6};var hc;(function(n){n.Prod="*",n.Sum="+"})(hc||(hc={}));class hy{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===hc.Prod?"1.0":"0.0",a=s?i:`getX(${py(o,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let l="",d="";s?(l=r?`end != ${c-1}`:"end != 0",d=r?"end + 1":"end - 1"):(l=r?`end + pow2 < ${c}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${an(o)} coords = getOutputCoords();
        int end = ${fy(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${d};
          ${fy(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${py(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function py(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function fy(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EN(n,e,t,s,r,o){const i=e.shape.length,a=Cn([s],i);let c=e;a!=null&&(c=us({inputs:{x:e},backend:t,attrs:{perm:a}}));const l=Tn(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=c.shape[l];let h=_s({inputs:{x:c},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const f=new hy(n,c.shape,!1,o),m=[[p]],g=h;h=t.runWebGLProgram(f,[h],h.dtype,m),t.disposeIntermediateTensorInfo(g)}if(r){const p=new hy(n,c.shape,r,o),f=h;h=t.runWebGLProgram(p,[h],h.dtype),t.disposeIntermediateTensorInfo(f)}if(a!=null){const p=jo(a),f=us({inputs:{x:h},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(c),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return EN(hc.Prod,r,t,o,i,a)}const M6={kernelName:$f,backendName:"webgl",kernelFunc:j6};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return EN(hc.Sum,r,t,o,i,a)}const O6={kernelName:ud,backendName:"webgl",kernelFunc:F6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=uN(c,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const c=t.bufferSync(r),l=t.bufferSync(o),d=VB(c,l,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const z6={kernelName:Af,backendName:"webgl",kernelFunc:L6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W6{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],c=i==="NHWC"?r.shape[1]:r.shape[2],l=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],h=c*o,p=l*o,f=d/(o*o),m=i==="NHWC"?[a,h,p,f]:[a,f,h,p],g=new W6(m,o,i);return t.runWebGLProgram(g,[r],r.dtype)}const V6={kernelName:Ef,backendName:"webgl",kernelFunc:B6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ss(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,c=e.outChannels/e.inChannels;let l="",d="";s&&(r?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:l=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const h=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DN{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ss(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,c=e.strideWidth,l=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)f+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;f+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let y=0;y<h;y++)f+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(p+1)/2;y++){const b=y*2;if(f+=`
          xC = xCCorner + ${b*l};
          `,c===1){if(b<h&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?f+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<h)){const v=a%2===0?df(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:f+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):v===1?f+=`
                    xC${b+1} = xTexelC${b};
                    `:f+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<h&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<h&&(f+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<h&&(f+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<h&&(f+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let m="",g="";s&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:m=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=s;let d=c;d==null&&(d=[1,1]),E(ts(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const h=Xn(r.shape,o.shape,i,d,a,l,!0);let p;fe().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?p=new DN(h):p=new RN(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return t.runWebGLProgram(p,[r,o],"float32",f)}const G6={kernelName:dd,backendName:"webgl",kernelFunc:U6};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H6{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class q6{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=s-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:d}=s,h=Xn(r.shape,d,i,a,c,l,!0),p=new H6(h);return t.runWebGLProgram(p,[r,o],"float32")}const X6={kernelName:Rf,backendName:"webgl",kernelFunc:K6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:d}=s,h=Xn(d,o.shape,i,a,c,l,!0),p=new q6(h);return t.runWebGLProgram(p,[r,o],"float32")}const Y6={kernelName:Df,backendName:"webgl",kernelFunc:Q6};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J6{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=we(s.shape),i=Ue({inputs:{x:s},backend:t,attrs:{shape:[o]}}),a=new J6(o),c=t.runWebGLProgram(a,[i],i.dtype),l=Ue({inputs:{x:c},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(c),l}const eG={kernelName:pb,backendName:"webgl",kernelFunc:Z6};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tG{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:d}=e,{top:h,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${h}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:c}=s,l=hl(r.shape,o.shape,i,a,"NHWC",c);let d;const h=new tG(l);d=t.runWebGLProgram(h,[r,o],"float32");const p=Ue({inputs:{x:d},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(d),p}const sG={kernelName:hd,backendName:"webgl",kernelFunc:nG};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:c}=cg(r,o.length);ug(i.length,c,o);const{path:l,steps:d}=dg(a,c),h=d.length;let p=null,f=i.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:b}=lg(f,c[x]);let v;hg(y)?v=o[x]:(v=us({inputs:{x:o[x]},backend:t,attrs:{perm:y}}),m.push(v));const w=v.shape.slice();for(let S=0;S<b.length;++S)w.splice(b[S],0,1);en(v.shape,w)||(v=Ue({inputs:{x:v},backend:t,attrs:{shape:w}}),m.push(v)),p===null?p=v:(p=Jg({inputs:{a:v,b:p},backend:t}),m.push(p))}g<h-1&&(l[g]>=0&&(p=$h({inputs:{x:p},backend:t,attrs:{axis:l[g]-(i.length-f),keepDims:!1}}),m.push(p)),f--)}for(const g of m)g!==p&&t.disposeIntermediateTensorInfo(g);return p}const oG={kernelName:_f,backendName:"webgl",kernelFunc:rG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG="return (x >= 0.0) ? x : (exp(x) - 1.0);",aG=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,cG=Kt({opSnippet:iG,packedOpSnippet:aG}),lG={kernelName:Ec,backendName:"webgl",kernelFunc:cG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG="return (b >= 0.0) ? a : a * (b + 1.0);",dG=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,hG=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=fe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Da(dG,s.shape,r.shape):new wi(uG,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},pG={kernelName:Pf,backendName:"webgl",kernelFunc:hG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG=`
  return vec4(equal(a, b));
`,mG="return float(a == b);",gG=Yn({opSnippet:mG,packedOpSnippet:fG,dtype:"bool",cpuKernelImpl:KB}),xG={kernelName:pd,backendName:"webgl",kernelFunc:gG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${tg};
  float a1 = ${ng};
  float a2 = ${sg};
  float a3 = ${rg};
  float a4 = ${og};
  float a5 = ${ig};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,bG=Kt({opSnippet:yG}),wG={kernelName:Rc,backendName:"webgl",kernelFunc:bG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG=_a+`
  return exp(x);
`,SG=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_N=Kt({opSnippet:vG,packedOpSnippet:SG,cpuKernelImpl:XB,dtype:"float32"}),CG={kernelName:Dc,backendName:"webgl",kernelFunc:_N};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ef(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let c=r;return r<0&&(E(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+r+1),a.splice(c,0,1),Ue({inputs:{x:o},backend:s,attrs:{shape:a}})}const NG={kernelName:fd,backendName:"webgl",kernelFunc:ef};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const my="return exp(x) - 1.0;",IG=Kt({opSnippet:my,packedOpSnippet:my,cpuKernelImpl:QB}),kG={kernelName:_c,backendName:"webgl",kernelFunc:IG};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gy{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PN(n,e,t){const s=t.texData.get(n.dataId),r=we(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=Ue({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),c=a.shape,l=new gy("real",c,e),d=new gy("imag",c,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],p=t.runWebGLProgram(l,h,"float32"),f=t.runWebGLProgram(d,h,"float32"),m=Wo({inputs:{real:p,imag:f},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f);const g=Ue({inputs:{x:m},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(m),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $G(n){const{inputs:e,backend:t}=n,{input:s}=e;return PN(s,!1,t)}const TG={kernelName:jf,backendName:"webgl",kernelFunc:$G};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AG{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _l(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||ba(r),o==="string"){const i=In(o,we(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new AG(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const EG={kernelName:Mf,backendName:"webgl",kernelFunc:_l};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RG{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:Ff,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new RG(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xy="return floor(x);",_G=Kt({opSnippet:xy,packedOpSnippet:xy,cpuKernelImpl:YB}),PG={kernelName:Pc,backendName:"webgl",kernelFunc:_G};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,MG=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,FG=Yn({opSnippet:jG,packedOpSnippet:MG,dtype:"int32"}),OG={kernelName:jc,backendName:"webgl",kernelFunc:FG};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LG{constructor(e){this.variableNames=["A"];const t=ds(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zG{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=ds(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:Fk,backendName:"webgl",kernelFunc:BG};let Li,ap=fe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function BG(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,l]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[l,c],h=[l,c,o];if(a||i){const g=fe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Li==null||g!==ap)&&(ap=g,Li=document.createElement("canvas").getContext("2d",{willReadFrequently:ap})),Li.canvas.width=c,Li.canvas.height=l,Li.drawImage(r,0,0,c,l),r=Li.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=Fs.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const f=fe().getBool("WEBGL_PACK")?new zG(h):new LG(h),m=t.runWebGLProgram(f,[p],"int32");return t.disposeData(p.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:d,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=s,g=ao(d),x=Xn(r.shape,o.shape,c,h,l,p,!1,g);let y;const b=[],v=i!=null,w=a!=null,S=f==="leakyrelu",N=()=>{const k=[r,o],I=($,j)=>{if(j==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){const P=Ue({inputs:{x:$},backend:t,attrs:{shape:[$.shape[0],1,1]}});return b.push(P),P}return $};if(v&&k.push(I(i,d)),w&&k.push(I(a,d)),S){const $=t.makeTensorInfo([],"float32",Do(m,"float32"));k.push($),b.push($)}return k};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=TN({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(x.strideWidth<=2&&g==="channelsLast"&&fe().getBool("WEBGL_EXP_CONV")){const k=f?uc(f,!0):null,I=new $N(x,v,k,w,S),$=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],j=N();y=t.runWebGLProgram(I,j,"float32",$)}else if(fe().getBool("WEBGL_CONV_IM2COL"))y=AN({x:r,filter:o,convInfo:x,backend:t,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{const k=f?uc(f,!1):null,I=new kN(x,v,k,w,S),$=N();y=t.runWebGLProgram(I,$,"float32")}const C=Ue({inputs:{x:y},backend:t,attrs:{shape:x.outShape}});return b.push(y),b.forEach(k=>t.disposeIntermediateTensorInfo(k)),C}const UG={kernelName:cu,backendName:"webgl",kernelFunc:VG};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GG(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s,m=[];let g=d;g==null&&(g=[1,1]),E(ts(c,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);const x=Xn(r.shape,o.shape,c,g,l,h,!0),y=fe().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,b=p?uc(p,y):null,v=[r,o],w=i!=null,S=a!=null,N=p==="leakyrelu";if(w&&v.push(i),S&&v.push(a),N){const $=t.makeTensorInfo([],"float32",Do(f,"float32"));v.push($),m.push($)}let C;y?C=new DN(x,w,b,S,N):C=new RN(x,w,b,S,N);const k=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],I=t.runWebGLProgram(C,v,"float32",k);return m.forEach($=>t.disposeIntermediateTensorInfo($)),I}const HG={kernelName:Db,backendName:"webgl",kernelFunc:GG};class qG{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=an(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=we(s.shape),[c,l,d,h]=Um(s,r),p=Ue({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),f=Ue({inputs:{x:s},backend:t,attrs:{shape:[we(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=t.readSync(r.dataId),b=t.bufferSync(s),v=JB(y,b,s.dtype,l,i,d,h,s.shape,a);return t.makeTensorInfo(c,s.dtype,v.values)}const m=new qG(i,h,[l,d],s.shape),g=t.runWebGLProgram(m,[f,p],f.dtype),x=Ue({inputs:{x:g},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),x}const XG={kernelName:fb,backendName:"webgl",kernelFunc:KG};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QG{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=an(this.rank),r=YG(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function YG(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,c=Bt(i,r.shape)[0];if(fe().get("DEBUG")){const b=t.readSync(o.dataId),v=r.shape[c];for(let w=0;w<b.length;++w){const S=b[w];E(S<=v-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${v-1}]`)}}const l=fg(r,o,c,a),d=we(o.shape),h=[],p=Ue({inputs:{x:r},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=Ue({inputs:{x:o},backend:t,attrs:{shape:[l.batchSize,d/l.batchSize]}});h.push(p),h.push(f);const m=[l.batchSize,l.outerSize,d/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const b=t.bufferSync(f),v=t.bufferSync(p),w=ZB(v,b,m);return h.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.makeTensorInfo(l.outputShape,w.dtype,w.values)}const g=new QG(p.shape,m),x=t.runWebGLProgram(g,[p,f],p.dtype);h.push(x);const y=Ue({inputs:{x},backend:t,attrs:{shape:l.outputShape}});return h.forEach(b=>t.disposeIntermediateTensorInfo(b)),y}const JG={kernelName:gd,backendName:"webgl",kernelFunc:jN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG="return float(a > b);",eH=`
  return vec4(greaterThan(a, b));
`,tH=Yn({opSnippet:ZG,packedOpSnippet:eH,cpuKernelImpl:e5,dtype:"bool"}),nH={kernelName:xd,backendName:"webgl",kernelFunc:tH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH="return float(a >= b);",rH=`
  return vec4(greaterThanEqual(a, b));
`,oH=Yn({opSnippet:sH,packedOpSnippet:rH,dtype:"bool",cpuKernelImpl:t5}),iH={kernelName:Mc,backendName:"webgl",kernelFunc:oH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aH(n){const{inputs:e,backend:t}=n,{input:s}=e;return PN(s,!0,t)}const cH={kernelName:Of,backendName:"webgl",kernelFunc:aH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lH="return float(!isnan(x) && !isinf(x));",uH=Kt({opSnippet:lH,dtype:"bool"}),dH={kernelName:Oc,backendName:"webgl",kernelFunc:uH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hH="return float(isinf(x));",pH=Kt({opSnippet:hH,dtype:"bool"}),fH={kernelName:Lc,backendName:"webgl",kernelFunc:pH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mH="return float(isnan(x));",gH=Kt({opSnippet:mH,dtype:"bool"}),xH={kernelName:zc,backendName:"webgl",kernelFunc:gH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yH="return float(a < b);",bH=`
  return vec4(lessThan(a, b));
`,wH=Yn({opSnippet:yH,packedOpSnippet:bH,cpuKernelImpl:n5,dtype:"bool"}),vH={kernelName:bd,backendName:"webgl",kernelFunc:wH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SH="return float(a <= b);",CH=`
  return vec4(lessThanEqual(a, b));
`,NH=Yn({opSnippet:SH,packedOpSnippet:CH,cpuKernelImpl:s5,dtype:"bool"}),IH={kernelName:wd,backendName:"webgl",kernelFunc:NH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=r5(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const $H={kernelName:mb,backendName:"webgl",kernelFunc:kH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TH=_a+`
  return x < 0.0 ? 0./0. : log(x);
`,AH=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,EH=Kt({opSnippet:TH,packedOpSnippet:AH,cpuKernelImpl:o5}),RH={kernelName:Wc,backendName:"webgl",kernelFunc:EH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DH=_a+`
  return log(1.0 + x);
`,_H=Kt({opSnippet:DH}),PH={kernelName:Bc,backendName:"webgl",kernelFunc:_H};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jH="return float(a >= 1.0 && b >= 1.0);",MH=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,FH=Yn({opSnippet:jH,packedOpSnippet:MH,dtype:"bool"}),OH={kernelName:vd,backendName:"webgl",kernelFunc:FH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LH="return float(!(x >= 1.0));",zH=Kt({opSnippet:LH}),WH={kernelName:Sd,backendName:"webgl",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BH="return float(a >= 1.0 || b >= 1.0);",VH=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,UH=Yn({opSnippet:BH,packedOpSnippet:VH,dtype:"bool"}),GH={kernelName:Cd,backendName:"webgl",kernelFunc:UH};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HH{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qH{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let c;const l=`float(${s}) + float(${r}) * sum`;o===.5?c=`inversesqrt(${l})`:o===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KH=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:c}=s,l=fe().getBool("WEBGL_PACK_NORMALIZATION")?new qH(r.shape,o,i,a,c):new HH(r.shape,o,i,a,c);return t.runWebGLProgram(l,[r],r.dtype)},XH={kernelName:Nd,backendName:"webgl",kernelFunc:KH};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QH{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YH=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:d}=s,h=new QH(r.shape,a,c,l,d);return t.runWebGLProgram(h,[r,o,i],r.dtype)},JH={kernelName:zf,backendName:"webgl",kernelFunc:YH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZH(n,e,t,s){const r=we(e),i=we(n.shape)/r,a=Ue({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=_i(a,n.dtype,"max",s),l=Ue({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,c=Bt(o,r.shape);let l=c;const d=Cn(l,a),h=d!=null,p=t.shouldExecuteOnCPU([r]);let f=r;if(h){if(p){const v=t.texData.get(f.dataId).values,w=new Array(a);for(let C=0;C<w.length;C++)w[C]=r.shape[d[C]];const S=Qg(v,r.shape,r.dtype,d,w);f=t.makeTensorInfo(w,r.dtype);const N=t.texData.get(f.dataId);N.values=S}else f=kh(r,d,t);l=Tn(l.length,a)}Qn("max",l,a);const[m,g]=Hn(f.shape,l);let x=m;i&&(x=_n(m,c));let y;if(p){const v=t.texData.get(f.dataId).values,w=i5(v,we(g),x,r.dtype);y=t.makeTensorInfo(x,r.dtype);const S=t.texData.get(y.dataId);S.values=w}else y=ZH(f,g,x,t);return h&&t.disposeIntermediateTensorInfo(f),y}const eq={kernelName:Id,backendName:"webgl",kernelFunc:MN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tq=Yg+`
  return max(a, b);
`,nq=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Di+`
  return result;
`,sq=Yn({opSnippet:tq,packedOpSnippet:nq,cpuKernelImpl:a5}),rq={kernelName:Vc,backendName:"webgl",kernelFunc:sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;El(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:c}=s,l=1;E(ts(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);const d=tr(r.shape,o,i,l,a,c);if(d.filterWidth===1&&d.filterHeight===1&&en(d.inShape,d.outShape))return _s({inputs:{x:r},backend:t});const h=new dc(d,"max",!1);return t.runWebGLProgram(h,[r],r.dtype)}const iq={kernelName:kd,backendName:"webgl",kernelFunc:oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=s,d=[1,1,1],h=io(r.shape,o,i,d,a,l,c),p=new Zg(h,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const cq={kernelName:$d,backendName:"webgl",kernelFunc:aq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lq{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,c=i-1-e.padInfo.left,l=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class uq{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=c-1-e.padInfo.front,p=l-1-e.padInfo.top,f=d-1-e.padInfo.left,m=c*l*d-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:c,pad:l,dimRoundingMode:d}=s,h=[1,1,1],p=io(i.shape,a,c,h,l,d),f=new Zg(p,"max",!0),m=t.runWebGLProgram(f,[i],i.dtype),g=new uq(p),x=t.runWebGLProgram(g,[r,m],i.dtype);return t.disposeIntermediateTensorInfo(m),x}const hq={kernelName:Bf,backendName:"webgl",kernelFunc:dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;El([o,i],"maxPoolGrad");const{filterSize:c,strides:l,pad:d,dimRoundingMode:h}=s,p=tr(a.shape,c,l,1,d,h),f=!0,m=new dc(p,"max",f),g=t.runWebGLProgram(m,[a],a.dtype),x=new lq(p),y=t.runWebGLProgram(x,[r,g],a.dtype);return t.disposeIntermediateTensorInfo(g),y}const fq={kernelName:Wf,backendName:"webgl",kernelFunc:pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mq(n,e,t,s){let r=new dc(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new dc(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gq={kernelName:gb,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,c=t;E(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const l=[1,1];E(ts(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const d=tr(s.shape,r,o,l,i),[h,p]=mq(s,a,d,c);return[h,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(n,e,t,s){const r=we(e),i=we(n.shape)/r,a=Ue({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),c=_i(a,"float32","mean",s),l=Ue({inputs:{x:c},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(c),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yq={kernelName:Td,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,a=s.shape.length,c=Bt(o,s.shape);let l=c;const d=Cn(l,a),h=d!=null,p=i.shouldExecuteOnCPU([s]),f=[];let m=s;if(h){if(p){const w=i.texData.get(m.dataId).values,S=new Array(a);for(let k=0;k<S.length;k++)S[k]=s.shape[d[k]];const N=Qg(w,s.shape,s.dtype,d,S);m=i.makeTensorInfo(S,s.dtype);const C=i.texData.get(m.dataId);C.values=N}else m=kh(s,d,i);f.push(m),l=Tn(l.length,a)}Qn("sum",l,a);const[g,x]=Hn(m.shape,l);let y=g;r&&(y=_n(g,c));const b=xq(m,x,y,i);for(const v of f)i.disposeIntermediateTensorInfo(v);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=Bt(o,r.shape);let l=c;const d=Cn(l,a);let h=r;d!=null&&(h=us({inputs:{x:r},backend:t,attrs:{perm:d}}),l=Tn(l.length,r.shape.length)),Qn("min",l,a);const[p,f]=Hn(h.shape,l),m=we(f),g=Ue({inputs:{x:h},backend:t,attrs:{shape:[-1,m]}}),x=_i(g,g.dtype,"min",t);let y;if(i){const b=_n(p,c);y=Ue({inputs:{x},backend:t,attrs:{shape:b}})}else y=Ue({inputs:{x},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),d!=null&&t.disposeIntermediateTensorInfo(h),y}const wq={kernelName:Ad,backendName:"webgl",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vq=Yg+`
  return min(a, b);
`,Sq=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Di+`
  return result;
`,Cq=Yn({opSnippet:vq,packedOpSnippet:Sq,cpuKernelImpl:c5}),Nq={kernelName:Uc,backendName:"webgl",kernelFunc:Cq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iq{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,h)=>d[0]+e[h]+d[1]);const r=e.length,o=an(r),i=t.map(d=>d[0]).join(","),a=t.map((d,h)=>d[0]+e[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),l=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kq{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,o=an(r),i=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),c=cs("rc",r),l=cs("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,p=s==="reflect"?0:1;let f="";if(r===1){const m=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
      `}else{const m=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${l.join()}), ${h});
        ${c[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${l.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${l.join()}), ${h});
          ${c[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${l.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $q=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=fe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kq(s.shape,r,o):new Iq(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},Tq={kernelName:Ed,backendName:"webgl",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aq=`if (b == 0.0) return NAN;
  return mod(a, b);`,Eq=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Di+`
  return result;
`,Rq=Yn({opSnippet:Aq,packedOpSnippet:Eq}),Dq={kernelName:Gc,backendName:"webgl",kernelFunc:Rq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _q{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pq=`
if (a == b) {
  return 1.0;
};
return a / b;`,jq=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,FN=Yn({opSnippet:Pq,packedOpSnippet:jq,checkOutOfBounds:!0}),Mq={kernelName:Ac,backendName:"webgl",kernelFunc:FN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yy="return a - b;",ON=Yn({opSnippet:yy,packedOpSnippet:yy,supportsComplex:!0,cpuKernelImpl:A5}),Fq={kernelName:al,backendName:"webgl",kernelFunc:ON};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LN(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=Bt([o],r.shape),a=MN({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),c=_n(a.shape,i),l=Ue({inputs:{x:a},backend:t,attrs:{shape:c}}),d=ON({inputs:{a:r,b:l},backend:t}),h=_N({inputs:{x:d},backend:t}),p=$h({inputs:{x:h},backend:t,attrs:{axis:i,keepDims:!1}}),f=Ue({inputs:{x:p},backend:t,attrs:{shape:c}}),m=FN({inputs:{a:h,b:f},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),m}const Oq={kernelName:Kd,backendName:"webgl",kernelFunc:LN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lq(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,c=a?r:LN({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),l=c.shape[0],d=c.shape[1],h=new _q(l,d,o),p=[[i]],f=t.runWebGLProgram(h,[c],"int32",p);return a||t.disposeIntermediateTensorInfo(c),f}const zq={kernelName:xb,backendName:"webgl",kernelFunc:Lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wq=sr+`
  return -x;
`,Bq=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Vq(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,a]=u5(o.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}let r;return fe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new yo(s.shape,Bq):r=new Dr(s.shape,Wq),t.runWebGLProgram(r,[s],s.dtype)}const Uq={kernelName:Rd,backendName:"webgl",kernelFunc:Vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq=Om;function Hq(n){Ms("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:h}=Gq(l,d,i,a,c);return t.makeTensorInfo([h.length],"int32",new Int32Array(h))}const qq={kernelName:Vf,backendName:"webgl",kernelFunc:Hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=Lm;function Xq(n){Ms("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),{selectedIndices:p,validOutputs:f}=Kq(d,h,i,a,c,l);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([f]))]}const Qq={kernelName:Uf,backendName:"webgl",kernelFunc:Xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yq=zm;function Jq(n){Ms("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=s,d=t.readSync(r.dataId),h=t.readSync(o.dataId),p=i,f=a,m=c,g=l,{selectedIndices:x,selectedScores:y}=Yq(d,h,p,f,m,g);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Zq={kernelName:Gf,backendName:"webgl",kernelFunc:Jq};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e8{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:c}=s,l=we(r.shape),d=new e8(l,i,a,c),h=Ue({inputs:{x:r},backend:t,attrs:{shape:[l]}}),p=t.runWebGLProgram(d,[h],o);t.disposeIntermediateTensorInfo(h);const f=[...r.shape,i],m=Ue({inputs:{x:p},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(p),m},n8={kernelName:Pd,backendName:"webgl",kernelFunc:t8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mu(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Dl({inputs:{input:s},backend:t}),o=Mu({inputs:{x:r},backend:t}),i=Th({inputs:{input:s},backend:t}),a=Mu({inputs:{x:i},backend:t}),c=Wo({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return _l({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const s8={kernelName:Yd,backendName:"webgl",kernelFunc:Mu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zN(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Dl({inputs:{input:s},backend:t}),o=zN({inputs:{x:r},backend:t}),i=Th({inputs:{input:s},backend:t}),a=Mu({inputs:{x:i},backend:t}),c=Wo({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return _l({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const r8={kernelName:_d,backendName:"webgl",kernelFunc:zN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return ef({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{hf(o,d.shape,"All tensors passed to stack must have matching shapes"),E(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],c=e.map(d=>{const h=ef({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(h),h}),l=IN({inputs:c,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),l}const i8={kernelName:jd,backendName:"webgl",kernelFunc:o8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a8{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,d)=>l[0]+e[d]+l[1]);const r=e.length,o=an(r),i=t.map(l=>l[0]).join(","),a=t.map((l,d)=>l[0]+e[d]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c8{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,o=an(r),i=t.map(g=>g[0]).join(","),a=t.map((g,x)=>g[0]+e[x]).join(","),c=cs("rc",r),l=cs("source",r),d=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${l.slice(-2).join()})`,p=[`${o} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${d}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let g=0,x=r===1?2:4;g<x;g++)m+=`
        ${p[g]}
        if (${f}) {
          result[${g}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${h});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WN=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(we(r.shape)===0){const l=o.map((d,h)=>d[0]+r.shape[h]+d[1]);return _l({backend:t,attrs:{shape:l,value:i,dtype:r.dtype}})}const a=fe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new c8(r.shape,o,i):new a8(r.shape,o,i),c=[[i]];return t.runWebGLProgram(a,[r],r.dtype,c)},l8={kernelName:Md,backendName:"webgl",kernelFunc:WN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,d8=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Di+`
  return result;
`,h8=Yn({opSnippet:u8,packedOpSnippet:d8}),p8={kernelName:qc,backendName:"webgl",kernelFunc:h8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,c=[],l=Bt(o,r.shape);let d=l;const h=Cn(d,a);let p=r;h!=null&&(p=us({inputs:{x:r},backend:t,attrs:{perm:h}}),d=Tn(d.length,a),c.push(p)),Qn("prod",d,a);let f;if(t.shouldExecuteOnCPU([p])){const m=t.texData.get(p.dataId).values,{outVals:g,outShape:x,outDtype:y}=h5(p.shape,p.dtype,m,d);f=t.makeTensorInfo(x,y,g)}else{const[m,g]=Hn(p.shape,d),x=we(g),y=Ue({inputs:{x:p},backend:t,attrs:{shape:[-1,x]}}),b=rm(r.dtype),v=_i(y,b,"prod",t);f=Ue({inputs:{x:v},backend:t,attrs:{shape:m}}),c.push(y),c.push(v)}if(i){c.push(f);const m=_n(f.shape,l);f=Ue({inputs:{x:f},backend:t,attrs:{shape:m}})}return c.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}const m8={kernelName:Od,backendName:"webgl",kernelFunc:f8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,c=r.map(y=>t.readSync(y.dataId)),l=r.map(y=>y.shape),d=t.readSync(o.dataId),h=t.readSync(i.dataId),[p,f,m]=p5(c,l,d,o.shape,o.dtype,h,i.shape,a),g=p.map(y=>t.makeTensorInfo([y.length],"int32",y)),x=t.makeTensorInfo(m,o.dtype,f);return g.concat([x])}const x8={kernelName:yb,backendName:"webgl",kernelFunc:g8};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y8(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=f5(i,s.shape,s.dtype,a,r.shape,c,o.shape),h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([d.length],s.dtype,d);return[h,p]}const b8={kernelName:bb,backendName:"webgl",kernelFunc:y8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w8(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=s,l=t.readSync(r.dataId),d=t.readSync(o.dataId),h=t.readSync(i.dataId),p=a.map(x=>t.readSync(x.dataId)),f=a.map(x=>x.shape),[m,g]=m5(l,r.shape,d,o.shape,o.dtype,h,i.shape,p,f,c);return t.makeTensorInfo(m,o.dtype,g)}const v8={kernelName:wb,backendName:"webgl",kernelFunc:w8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BN=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,a=g5(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},S8={kernelName:Hf,backendName:"webgl",kernelFunc:BN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C8="return 1.0 / x;",N8=Kt({opSnippet:C8}),I8={kernelName:Kc,backendName:"webgl",kernelFunc:N8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8=sr+`
  return (x < 0.0) ? 0.0 : x;
`,$8=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,T8=Kt({opSnippet:k8,packedOpSnippet:$8}),A8={kernelName:Xc,backendName:"webgl",kernelFunc:T8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8=sr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,R8=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,D8=Kt({opSnippet:E8,packedOpSnippet:R8}),_8={kernelName:Qc,backendName:"webgl",kernelFunc:D8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P8{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;o?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j8{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;o?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=fe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new j8(r.shape,c,l,o,i):new P8(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],"float32")}const F8={kernelName:Wd,backendName:"webgl",kernelFunc:M8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O8{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],p=1/d,f=1/h,m=Math.ceil(p)*2+2,g=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new O8(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const z8={kernelName:Xf,backendName:"webgl",kernelFunc:L8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W8{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let f;o?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B8{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,c,l]=e;this.outputShape=[i,t,s,l];const d=[r&&t>1?a-1:a,r&&s>1?c-1:c],h=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let f;o?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[c,l]=a,d=fe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new B8(r.shape,c,l,o,i):new W8(r.shape,c,l,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const U8={kernelName:zd,backendName:"webgl",kernelFunc:V8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G8{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,c=[s&&i>1?r-1:r,s&&a>1?o-1:o],l=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=c[0]/l[0],h=c[1]/l[1],p=1/d,f=1/h,m=Math.ceil(p)*2+2,g=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H8(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new G8(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const q8={kernelName:Kf,backendName:"webgl",kernelFunc:H8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K8{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,c)=>r(c)).join(","),i=an(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X8{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=cs("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=an(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${o}){
            result.g = ${l(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(m){return p(m)}function l(m){return m[s-1]="("+m[s-1]+" + 1)",p(m)}function d(m){return m[s-2]="("+m[s-2]+" + 1)",p(m)}function h(m){return m[s-1]="("+m[s-1]+" + 1)",m[s-2]="("+m[s-2]+" + 1)",p(m)}function p(m){const g=e.map((b,v)=>f(v,m)),x=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${y}))`}function f(m,g){return t.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${g[m]} - 1`:`${g[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,a=Bt(o,r.shape);if(i===0)return _s({inputs:{x:r},backend:t});const c=fe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new X8(r.shape,a):new K8(r.shape,a);return t.runWebGLProgram(c,[r],r.dtype)}const Y8={kernelName:Bd,backendName:"webgl",kernelFunc:Q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J8{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z8={kernelName:nm,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,c=new J8(s.shape,o),[l,d]=Jm(i,s.shape[1],s.shape[2]),h=[[l,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(c,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e7=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,t7=Kt({opSnippet:e7}),n7={kernelName:Yc,backendName:"webgl",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7="return inversesqrt(x);",r7=Kt({opSnippet:s7,cpuKernelImpl:x5}),o7={kernelName:Jc,backendName:"webgl",kernelFunc:r7};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e0{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const l=an(o.length),d=an(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const p=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const m=`getUpdates(${f})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i7{constructor(e,t,s,r,o,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const l=an(o.length),d=an(i.length);let h="";s===1?h="i":s===2&&(h="i, j");const p=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const m=`getUpdates(${f})`;let g="";c&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=t>1?"strides[j]":"strides",b=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=$i(o,r,i),p=[h/l,l];if(h===0)return t.makeTensorInfo(i,r.dtype);const f=Ue({inputs:{x:r},backend:t,attrs:{shape:[c,a]}}),m=Ue({inputs:{x:o},backend:t,attrs:{shape:[c,l]}}),g=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;fe().getBool("WEBGL_PACK")?x=new i7(c,a,f.shape.length,m.shape.length,d,p):x=new e0(c,a,f.shape.length,m.shape.length,d,p);const y=t.runWebGLProgram(x,[m,f,g],m.dtype),b=Ue({inputs:{x:y},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(g),b}const c7={kernelName:vb,backendName:"webgl",kernelFunc:a7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l7{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=fe().getNumber("WEBGL_VERSION")===2?o:i,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=new l7(r.shape[0],r.shape[1],o.shape[1],i),c=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",c)}const d7={kernelName:Cb,backendName:"webgl",kernelFunc:u7};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h7{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let d=0;d<t.length;d++)l.push(`${a[d]}`),d<e&&c.push(`${a[d]}`);r=c.join(),o=l.join()}const i=an(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new h7(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],Rs(r.dtype,o.dtype))}const f7={kernelName:Vd,backendName:"webgl",kernelFunc:p7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${lh};
  float scale = ${uh};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,g7=Kt({opSnippet:m7}),x7={kernelName:Zc,backendName:"webgl",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7=_a+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,b7=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,w7=Kt({opSnippet:y7,packedOpSnippet:b7,cpuKernelImpl:b5}),v7={kernelName:sl,backendName:"webgl",kernelFunc:w7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,C7=Kt({opSnippet:S7}),N7={kernelName:nl,backendName:"webgl",kernelFunc:C7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7=_a+`
  return sin(x);
`,k7=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Di}
  return result;
`,$7=Kt({opSnippet:I7,packedOpSnippet:k7}),T7={kernelName:el,backendName:"webgl",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,E7=Kt({opSnippet:A7}),R7={kernelName:tl,backendName:"webgl",kernelFunc:E7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,_7=Kt({opSnippet:D7}),P7={kernelName:rl,backendName:"webgl",kernelFunc:_7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;E(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,b)=>y*b),c=[[0,0]];c.push(...i);for(let y=1+o.length;y<r.shape.length;++y)c.push([0,0]);const l=[],d=WN({inputs:{x:r},backend:t,attrs:{paddings:c,constantValue:0}}),h=xl(d.shape,o,a,!1),p=yl(h.length,o.length,!1),f=bl(d.shape,o,a,!1),m=Ue({inputs:{x:d},backend:t,attrs:{shape:h}}),g=us({inputs:{x:m},backend:t,attrs:{perm:p}}),x=Ue({inputs:{x:g},backend:t,attrs:{shape:f}});return l.push(d),l.push(m),l.push(g),l.forEach(y=>t.disposeIntermediateTensorInfo(y)),x},M7={kernelName:Hd,backendName:"webgl",kernelFunc:j7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F7(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(s.dataId),c=t.readSync(r.dataId),l=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[h,p,f,m,g]=v5(a,s.shape,s.dtype,c,r.dtype,l,d);return[t.makeTensorInfo(p,s.dtype,h),t.makeTensorInfo([p[0]],r.dtype,f),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),t.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const O7={kernelName:Nb,backendName:"webgl",kernelFunc:F7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),c=Array.from(t.readSync(o.dataId)),[l,d,h]=S5(a,s.shape,s.dtype,i,c);return[t.makeTensorInfo(d,s.dtype,l),t.makeTensorInfo([h.length],o.dtype,new Int32Array(h))]}const z7={kernelName:Ib,backendName:"webgl",kernelFunc:L7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=hN(i,s.shape,s.dtype,a,c,!0);return t.makeTensorInfo(d,s.dtype,l)}const B7={kernelName:kb,backendName:"webgl",kernelFunc:W7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),c=t.readSync(o.dataId),[l,d]=hN(i,s.shape,s.dtype,a,c);return t.makeTensorInfo(d,s.dtype,l)}const U7={kernelName:$b,backendName:"webgl",kernelFunc:V7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G7(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:c,numUpdates:l,sliceSize:d,strides:h,outputSize:p}=$i(o,r,a),f=!1;if(o.dtype==="string"){const y=t.bufferSync(r),b=t.bufferSync(o),v=Io(t.readSync(i.dataId)[0]),w=y5(y,b,a,p,d,l,c,h,v,f);return t.makeTensorInfo(a,w.dtype,w.values)}const m=new e0(l,c,r.shape.length,o.shape.length,h,[p,1],f),g=t.runWebGLProgram(m,[o,r,i],o.dtype),x=Ue({inputs:{x:g},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(g),x}const H7={kernelName:Tb,backendName:"webgl",kernelFunc:G7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Bt(i,r.shape)[0],c=pg(r,o,a),l=r.shape.length,d=new Array(l).fill(0),h=r.shape.slice();return c.map(p=>{const f=[...h];f[a]=p;const m=Pa({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});return d[a]+=p,m})}const K7={kernelName:qd,backendName:"webgl",kernelFunc:q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const by="return sqrt(x);",X7=Kt({opSnippet:by,packedOpSnippet:by,cpuKernelImpl:C5}),Q7={kernelName:ol,backendName:"webgl",kernelFunc:X7};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7="return x * x;",J7=Kt({opSnippet:Y7}),Z7={kernelName:Qf,backendName:"webgl",kernelFunc:J7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wy="return (a - b) * (a - b);",eK=Yn({opSnippet:wy,packedOpSnippet:wy}),tK={kernelName:il,backendName:"webgl",kernelFunc:eK};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),i=so(o),a=N5(i,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const sK={kernelName:Yf,backendName:"webgl",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=sr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Dr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const oK={kernelName:dl,backendName:"webgl",kernelFunc:rK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iK{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=an(s.length),i=an(s.length);let a="";if(r===1)a="coords * strides + begin";else{let c=0;a=s.map((l,d)=>(c++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${c-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:p}=s,{finalShapeSparse:f,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=Xm(r.shape,o,i,a,c,l,d,h,p);let S;if(g)S=Ue({inputs:{x:r},backend:t,attrs:{shape:m}});else if(x||y){E(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=Hm(b,v,w),k=Pa({inputs:{x:r},backend:t,attrs:{begin:b,size:C}});S=Ue({inputs:{x:k},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(k)}else if(t.shouldExecuteOnCPU([r])){const k=t.readSync(r.dataId),I=Wt(r.shape,r.dtype,k),$=I5(f,I,w,b);S=t.makeTensorInfo(m,r.dtype,$.values)}else{const k=new iK(b,w,f);S=t.runWebGLProgram(k,[r],r.dtype)}const N=Ue({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),N}const cK={kernelName:Jf,backendName:"webgl",kernelFunc:aK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=s,{data:d,dataSplits:h}=e,p=t.readSync(d.dataId),f=t.readSync(h.dataId),[m,g]=k5(p,f,r,o,i,a,c,l);return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(h.shape,"int32",g)]}const uK={kernelName:Ab,backendName:"webgl",kernelFunc:lK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),c=t.readSync(i.dataId)[0],[l,d,h]=$5(a,c,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(h))]}const hK={kernelName:Eb,backendName:"webgl",kernelFunc:dK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=T5(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const fK={kernelName:Rb,backendName:"webgl",kernelFunc:pK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mK="return tan(x);",gK=Kt({opSnippet:mK}),xK={kernelName:cl,backendName:"webgl",kernelFunc:gK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yK=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,bK=Kt({opSnippet:yK}),wK={kernelName:ll,backendName:"webgl",kernelFunc:bK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:c,sliceSize:l,strides:d,outputSize:h}=$i(i,o,r.shape),p=[h/l,l];if(h===0)return t.makeTensorInfo(r.shape,o.dtype);const f=Ue({inputs:{x:o},backend:t,attrs:{shape:[c,a]}}),m=Ue({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),g=Ue({inputs:{x:r},backend:t,attrs:{shape:p}}),x=new e0(c,a,f.shape.length,m.shape.length,d,p,!1,!0),y=t.runWebGLProgram(x,[m,f,g],g.dtype),b=Ue({inputs:{x:y},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),b}const SK={kernelName:Sb,backendName:"webgl",kernelFunc:vK};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CK{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=an(this.rank),o=NK(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function NK(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VN(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const c=t.readSync(r.dataId),l=r.dtype==="string"?c.map(p=>Io(p)):c,d=Wt(r.shape,r.dtype,l),h=E5(d,o);return t.makeTensorInfo(h.shape,h.dtype,h.values)}const i=new CK(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const IK={kernelName:ul,backendName:"webgl",kernelFunc:VN};class kK{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class $K{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uo(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function vy(n){let e=1;for(;e<n;)e*=2;return e}function TK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,a=fe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=fe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=r.shape,d=l[l.length-1];if(t.shouldExecuteOnCPU([r])||d<a||o>c){const $=t.readSync(r.dataId),[j,P]=R5($,l,r.dtype,o,i);return[t.makeTensorInfo(j.shape,j.dtype,j.values),t.makeTensorInfo(P.shape,P.dtype,P.values)]}if(o===0)return l[l.length-1]=0,[t.makeTensorInfo(l,r.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(d===1)return[r,_l({attrs:{shape:l,dtype:"int32",value:0},backend:t})];const h=t.texData.get(r.dataId),p=h!==null&&h.isPacked,f=p?t.unpackTensor(r):r,g=we(l)/d,x=Ue({inputs:{x:f},attrs:{shape:[g,d]},backend:t});p&&Uo(t,f);const y=vy(o),b=vy(d);let v=null;const w=()=>v===null?[x,x]:[x,v],S=($,j,P)=>{const O=w(),A=new kK(P),L=[[d],[v===null?1:0],[Number.NEGATIVE_INFINITY],[$],[j]],U=v;v=t.runWebGLProgram(A,O,"int32",L),Uo(t,U)};for(let $=1;$<y;$*=2){const j=$*2;for(let P=$;P>=1;P/=2)S(j,P,[g,b])}for(let $=b;$>y;$/=2){const j=w(),P=new $K([g,$/2]),A=[[d],[v===null?1:0],[y]],z=v;v=t.runWebGLProgram(P,j,"int32",A),Uo(t,z);const L=y/2,U=L*2;for(let V=L;V>=1;V/=2)S(U,V,v.shape)}let N=v;v=Pa({inputs:{x:v},backend:t,attrs:{begin:0,size:[g,o]}}),Uo(t,N);let C=jN({inputs:{x,indices:v},backend:t,attrs:{axis:1,batchDims:1}});Uo(t,x);const k=l.slice(0,-1);k.push(o),N=v,v=Ue({inputs:{x:v},attrs:{shape:k},backend:t}),Uo(t,N);const I=C;return C=Ue({inputs:{x:C},attrs:{shape:k},backend:t}),Uo(t,I),[C,v]}const AK={kernelName:Zf,backendName:"webgl",kernelFunc:TK};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EK{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=s,[d,h,p,f]=r.shape,[m,g]=l??[h,p],x=[d,m,g,f],y=new EK(h,p,i,a,c,x);return t.runWebGLProgram(y,[r,o],"float32")}const DK={kernelName:em,backendName:"webgl",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;El(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:c,indices:l}=D5(i,r,o.shape,o.dtype);return[s.makeTensorInfo(c,o.dtype,a),s.makeTensorInfo([l.length],"int32",l)]}const PK={kernelName:tm,backendName:"webgl",kernelFunc:_K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,c=r.shape[o],l=new Array(a-1);let d=0;for(let g=0;g<a;g++)g!==o&&(l[d++]=i.shape[g]);const h=[],p=new Array(a).fill(0),f=i.shape.slice();f[o]=1;const m=new Array(c);for(let g=0;g<m.length;g++){p[o]=g;const x=Pa({inputs:{x:i},backend:t,attrs:{begin:p,size:f}}),y=Ue({inputs:{x},backend:t,attrs:{shape:l}});m[g]=y,h.push(x)}return h.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}const MK={kernelName:Xd,backendName:"webgl",kernelFunc:jK};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FK{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const c="0.0",l="sumValue",d=Math.floor(s/4)*4,h=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let f="";o%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let m="";o%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,c=[];let l=0;const d=Cn([l],a);let h=r;d!=null&&(h=us({inputs:{x:r},backend:t,attrs:{perm:d}}),c.push(h),l=Tn(1,a)[0]);const p=Iv(h.shape,l,i),f=we([h.shape[l]]),m=Ue({inputs:{x:h},backend:t,attrs:{shape:[-1,f]}});c.push(m);const g=rm(r.dtype),x=(w,S,N,C,k)=>{const I=w.shape[0],$=w.shape[1],j=Nv($,k),P={windowSize:j,inSize:$,batchSize:I,numSegments:k},O=new FK(P,S),A=t.compileAndRun(O,[w,N],C);if(c.push(A),A.shape[1]===k)return A;const z=BN({backend:t,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),L=VN({inputs:{x:z},backend:t,attrs:{reps:[$/j]}});return c.push(z),c.push(L),x(A,S,L,C,k)},y=x(m,"unsortedSegmentSum",o,g,i),b=Ue({inputs:{x:y},backend:t,attrs:{shape:p}});let v=b;if(d!=null){c.push(b);const w=jo(d);v=us({inputs:{x:v},backend:t,attrs:{perm:w}})}return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),v}const LK={kernelName:Qd,backendName:"webgl",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=[CV,IV,TV,RV,_V,MV,OV,zV,UV,HV,XV,JV,tU,oU,cU,uU,hU,gU,yU,wU,NU,RU,_U,FU,LU,GU,qU,YU,iV,e6,o6,l6,m6,y6,w6,S6,N6,T6,R6,P6,M6,O6,z6,V6,G6,X6,Y6,eG,sG,oG,lG,pG,xG,wG,CG,NG,kG,TG,EG,DG,PG,OG,WG,UG,HG,XG,JG,nH,iH,oV,cH,s6,dH,fH,xH,cV,vH,IH,$H,RH,PH,OH,WH,GH,XH,JH,eq,rq,iq,cq,hq,fq,gq,yq,wq,Nq,Tq,Dq,zq,dV,Uq,qq,Qq,Zq,WU,n8,r8,i8,l8,p8,uV,m8,x8,b8,v8,S8,BU,Mq,I8,A8,_8,pV,F8,z8,U8,q8,Y8,Z8,n7,o7,c7,d7,f7,x7,v7,N7,T7,R7,AU,Oq,P7,M7,O7,z7,B7,U7,H7,K7,Q7,Z7,tK,sK,oK,cK,uK,hK,fK,Fq,wV,xK,wK,SK,IK,AK,DK,vV,PK,MK,LK,s8];for(const n of zK)_b(n);const Is=class Is{constructor(){Ee(this,"mlModel",null);Ee(this,"mlEnabled",!1);Ee(this,"mlState",{initialized:!1,ready:!1,trainingCount:0,lastTrainedAt:null,accuracy:null})}async analyze(e){const t=this.analyzeByRules(e);if(this.canUseML(e))try{const s=await this.analyzeByML(e);return this.mergeSignals(t,s,e)}catch(s){_.warn(`[${this.name}] ML analysis failed, using rules only`,s)}return t}async initializeML(e){if(this.mlState.initialized){_.info(`[${this.name}] ML already initialized`);return}try{const t=e||`/models/${this.id}/model.json`,s=`${this.id}_${t}`,r=Is.modelCache.get(s);if(r){this.mlModel=r,await this.loadPersonalWeights(),this.mlState.initialized=!0,this.mlState.ready=!0,_.info(`[${this.name}] ‚úÖ ML model loaded from cache (weights reloaded)`);return}_.info(`[${this.name}] Loading ML model from ${t}`),this.mlModel=await eM(t),await this.loadPersonalWeights(),Is.modelCache.set(s,this.mlModel),this.updateMemoryUsage(),this.mlState.initialized=!0,this.mlState.ready=!0,_.info(`[${this.name}] ‚úÖ ML initialized successfully`)}catch{this.mlState.initialized=!1,this.mlState.ready=!1,await this.createFallbackModel()}}async createFallbackModel(){try{const e=this.getFeatureDimension();this.mlModel=sM({layers:[tp({inputShape:[e],units:Math.ceil(e*.7),activation:"relu",kernelInitializer:"glorotUniform"}),vM({rate:.2}),tp({units:Math.ceil(e*.5),activation:"relu"}),tp({units:this.getOutputDimension(),activation:"sigmoid"})]}),this.mlModel.compile({optimizer:Ho.adam(.001),loss:"binaryCrossentropy",metrics:["accuracy"]}),this.mlState.initialized=!0,this.mlState.ready=!0,_.info(`[${this.name}] ‚úÖ Fallback model created`)}catch(e){_.error(`[${this.name}] Failed to create fallback model`,e)}}async learn(e,t){if(!(!this.mlEnabled||!this.mlState.ready||!this.mlModel))try{const s=this.extractFeatures(e),r=this.outcomeToLabel(t),o=await this.mlModel.fit(Zi([s]),Zi([r]),{epochs:1,verbose:0,shuffle:!1});this.mlState.trainingCount++,this.mlState.lastTrainedAt=Date.now(),o.history.acc&&(this.mlState.accuracy=o.history.acc[0]),this.mlState.trainingCount%10===0&&(await this.savePersonalWeights(),_.debug(`[${this.name}] Weights saved (${this.mlState.trainingCount} trainings)`))}catch(s){_.error(`[${this.name}] Learning failed`,s)}}async predict(e){if(!this.mlModel)throw new Error("ML model not initialized");const t=performance.now(),s=Zi([e]),r=this.mlModel.predict(s),o=await r.data();return s.dispose(),r.dispose(),performance.now()-t,{values:Array.from(o),confidence:this.calculatePredictionConfidence(Array.from(o)),timestamp:Date.now()}}canUseML(e){return this.mlEnabled&&this.mlState.ready&&this.mlModel!==null&&this.hasEnoughData(e)}hasEnoughData(e){const t=e.progress;return t?(t.memorizationAttempts??0)>=10:!1}outcomeToLabel(e){return[e.wasCorrect?0:1]}calculatePredictionConfidence(e){return 1-Array.from(e).reduce((s,r)=>r>0&&r<1?s-(r*Math.log2(r)+(1-r)*Math.log2(1-r)):s,0)/e.length}async savePersonalWeights(){if(this.mlModel)try{const e=this.mlModel.getWeights(),t=await this.serializeWeights(e),s={version:"1.0",timestamp:Date.now(),weights:t,metadata:{trainingCount:this.mlState.trainingCount,accuracy:this.mlState.accuracy}};localStorage.setItem(`ml-weights-${this.id}`,JSON.stringify(s))}catch(e){_.error(`[${this.name}] Failed to save weights`,e)}}async loadPersonalWeights(){try{const e=localStorage.getItem(`ml-weights-${this.id}`);if(!e||!this.mlModel)return;const t=JSON.parse(e),s=await this.deserializeWeights(t.weights);this.mlModel.setWeights(s),this.mlState.trainingCount=t.metadata.trainingCount,this.mlState.accuracy=t.metadata.accuracy,_.info(`[${this.name}] Personal weights loaded (${t.metadata.trainingCount} trainings)`)}catch(e){_.warn(`[${this.name}] Failed to load personal weights`,e)}}async serializeWeights(e){const t=await Promise.all(e.map(async s=>Array.from(await s.data())));return btoa(JSON.stringify(t))}async deserializeWeights(e){return JSON.parse(atob(e)).map(s=>Yi(s))}enableML(){this.mlEnabled=!0,_.info(`[${this.name}] ML enabled`)}disableML(){this.mlEnabled=!1,_.info(`[${this.name}] ML disabled`)}getMLState(){return{...this.mlState}}updateMemoryUsage(){try{const t=Ep().numBytes/(1024*1024);Is.memoryUsage.current=t,Is.memoryUsage.peak=Math.max(Is.memoryUsage.peak,t),Is.memoryUsage.lastCheck=Date.now(),t>100}catch(e){_.warn(`[${this.name}] Memory check failed`,e)}}static getMemoryUsage(){return{...Is.memoryUsage}}static clearModelCache(){Is.modelCache.forEach(e=>{try{e.dispose()}catch(t){_.warn("Failed to dispose model",t)}}),Is.modelCache.clear(),_.info("ML model cache cleared")}};Ee(Is,"modelCache",new Map),Ee(Is,"memoryUsage",{current:0,peak:0,lastCheck:Date.now()}),Ee(Is,"initWarningShown",new Set);let ro=Is;const Ir={MASTERED:3,LEARNING:2,STRUGGLING:1,INCORRECT:3,HIGH_PRIORITY:2},Hi={EXCELLENT:.9,GOOD:.8,FAIR:.6,POOR:.5},Pn={MASTERED_PERFECT:10,MASTERED_ALMOST:15,ONE_SHOT_CORRECT:18,NEAR_MASTERY:25,NEW_NEAR_MASTERY:30,NEW_DEFAULT:35,STILL_LEARNING_LOW:45,STILL_LEARNING_DEFAULT:50,INCORRECT_LIGHT:55,INCORRECT_MEDIUM:70,INCORRECT_HIGH:75,INCORRECT_URGENT:85},zi={STILL_LEARNING_MAX:15,STILL_LEARNING_MULTIPLIER:5,TIME_DECAY_MAX:15,TIME_DECAY_MULTIPLIER:1.5},WK={QUICK_LEARNER:2};function BK(n){return Math.max(0,Math.min(100,n))}function UN(n,e){switch(e){case"memorization":return n.memorizationPosition;case"translation":return n.translationPosition;case"spelling":return n.spellingPosition;case"grammar":return n.grammarPosition}}function GN(n,e){switch(e){case"memorization":return{attempts:n.memorizationAttempts||0,correct:n.memorizationCorrect||0,stillLearning:n.memorizationStillLearning||0};case"translation":return{attempts:n.translationAttempts||0,correct:n.translationCorrect||0,stillLearning:0};case"spelling":return{attempts:n.spellingAttempts||0,correct:n.spellingCorrect||0,stillLearning:0};case"grammar":return{attempts:n.grammarAttempts||0,correct:n.grammarCorrect||0,stillLearning:0}}}function HN(n){const{mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}=n,c=s>0?(r+o*.5)/s:0,l=t>=40&&t<70;return e==="memorization"&&o===0&&l&&i===Ir.STRUGGLING&&a===0&&c>=Hi.FAIR?{decision:"ignore_saved_position",reason:"auto_promoted_still_learning_progress",accuracyForOverride:c}:{decision:"use_saved_position",reason:"other",accuracyForOverride:c}}function VK(n,e="memorization"){if(!n)return null;const t=UN(n,e);if(t==null)return null;const{attempts:s,correct:r,stillLearning:o}=GN(n,e),i=n.consecutiveCorrect||0,a=n.consecutiveIncorrect||0,c=HN({mode:e,savedPosition:t,attempts:s,correct:r,stillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a});return{mode:e,savedPosition:t,decision:c.decision,reason:c.reason,accuracyForOverride:c.accuracyForOverride,modeAttempts:s,modeCorrect:r,modeStillLearning:o,consecutiveCorrect:i,consecutiveIncorrect:a}}function Ut(n,e="memorization"){if(!n)return Pn.NEW_DEFAULT;const t=UN(n,e),s=GN(n,e),r=s.attempts,o=s.correct,i=s.stillLearning,a=n.consecutiveCorrect||0,c=n.consecutiveIncorrect||0,l=n.lastStudied||Date.now();if(t!=null){if(a>=Ir.MASTERED)return Pn.MASTERED_PERFECT;if(a>=Ir.LEARNING)return(r>0?(o+i*.5)/r:0)>=Hi.GOOD?Pn.MASTERED_ALMOST:Pn.NEAR_MASTERY;if(HN({mode:e,savedPosition:t,attempts:r,correct:o,stillLearning:i,consecutiveCorrect:a,consecutiveIncorrect:c}).decision!=="ignore_saved_position")return t}const d=(Date.now()-l)/(1e3*60*60*24),h=o+i*.5,p=r>0?h/r:0;if(r===0)return Pn.NEW_DEFAULT;if(a>=Ir.MASTERED)return Pn.MASTERED_PERFECT;if(a>=Ir.LEARNING)return p>=Hi.GOOD?Pn.MASTERED_ALMOST:Pn.NEAR_MASTERY;if(e==="memorization"&&i>0&&c===0&&a<Ir.LEARNING){const y=Math.min(i*zi.STILL_LEARNING_MULTIPLIER,zi.STILL_LEARNING_MAX);return Math.min(Pn.STILL_LEARNING_LOW+y,Pn.STILL_LEARNING_DEFAULT)}if(a===Ir.STRUGGLING)return p>=Hi.EXCELLENT&&r<=WK.QUICK_LEARNER?Pn.ONE_SHOT_CORRECT:p>=Hi.FAIR?Pn.NEW_NEAR_MASTERY:Pn.STILL_LEARNING_LOW;if(c>=Ir.INCORRECT)return Pn.INCORRECT_URGENT;if(c>=Ir.HIGH_PRIORITY)return Pn.INCORRECT_HIGH;if(c>=Ir.STRUGGLING)return p>=Hi.POOR?Pn.INCORRECT_LIGHT:Pn.INCORRECT_MEDIUM;if(i>0&&a===0&&c===0){const y=Math.min(i*zi.STILL_LEARNING_MULTIPLIER,zi.STILL_LEARNING_MAX);return Math.min(Pn.STILL_LEARNING_LOW+y,Pn.STILL_LEARNING_DEFAULT)}const f=Pn.STILL_LEARNING_DEFAULT-p*30+c*10,m=Math.min(d*zi.TIME_DECAY_MULTIPLIER,zi.TIME_DECAY_MAX),g=f+m;return BK(g)}function Yr(n){return n>=70?"incorrect":n>=40?"still_learning":n>=20?"new":"mastered"}const Gs=class Gs{calculateNextReview(e,t=Gs.DEFAULT_EASE_FACTOR,s=Gs.FIRST_INTERVAL,r=0){const o=this.updateEaseFactor(t,e),i=this.updateRepetitions(r,e),a=this.calculateInterval(i,s,o,e),c=new Date(Date.now()+a*24*60*60*1e3);return{nextInterval:a,easeFactor:o,repetitions:i,nextReviewDate:c}}updateEaseFactor(e,t){const s=e+(.1-(5-t)*(.08+(5-t)*.02));return Math.max(Gs.MIN_EASE_FACTOR,s)}updateRepetitions(e,t){return t<3?0:e+1}calculateInterval(e,t,s,r){if(r<3)return Gs.FIRST_INTERVAL;switch(e){case 1:return Gs.FIRST_INTERVAL;case 2:return Gs.SECOND_INTERVAL;default:return Math.round(t*s)}}determineQuality(e,t,s=!1,r=1){return e?t<3e3&&!s?5:t<5e3&&!s?4:t<1e4?3:2:r>2?0:1}getQualityDescription(e){return{0:"ÂÆåÂÖ®Â§±Êïó - ÂÖ®„ÅèÊÄù„ÅÑÂá∫„Åõ„Å™„ÅÑ",1:"Â§±Êïó - ÊÄù„ÅÑÂá∫„Åõ„Å™„Åã„Å£„Åü„Åå„ÄÅÁ≠î„Åà„ÇíË¶ã„Å¶Á¥çÂæó",2:"Èï∑ËÄÉÊ≠£Ëß£ - „Åã„Å™„ÇäËÄÉ„Åà„Å¶Ê≠£Ëß£",3:"Ê≠£Ëß£ÔºàËø∑„ÅÑÊúâÔºâ - Â∞ë„ÅóËÄÉ„Åà„Å¶Ê≠£Ëß£",4:"Ê≠£Ëß£ÔºàËø∑„ÅÑÁÑ°Ôºâ - „Åô„Åê„Å´Ê≠£Ëß£",5:"ÂÆåÁíß - Áû¨ÊôÇ„Å´Ê≠£Ëß£"}[e]}logCalculation(e,t,s,r,o){}};Ee(Gs,"MIN_EASE_FACTOR",1.3),Ee(Gs,"DEFAULT_EASE_FACTOR",2.5),Ee(Gs,"FIRST_INTERVAL",1),Ee(Gs,"SECOND_INTERVAL",6);let tf=Gs;const ks=class ks{calculateRetention(e,t){const r=1/Math.max(ks.MIN_STRENGTH,Math.min(ks.MAX_STRENGTH,t)),o=Math.exp(-e*r);return Math.max(0,Math.min(1,o))}calculateMemoryStrength(e){const t=ks.MIN_STRENGTH,s=(e.consecutiveCorrect||0)*1.5,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0,a=(r>0?o/r:0)*3,c=Math.min(r*.2,2),d=(e.memorizationStillLearning||0)*.5,p=(e.consecutiveIncorrect||0)*1,f=t+s+a+c-d-p;return Math.max(ks.MIN_STRENGTH,Math.min(ks.MAX_STRENGTH,f))}suggestReviewTiming(e,t=ks.TARGET_RETENTION){return e<t-.2?"now":e<t-.1?"soon":e<t+.1?"scheduled":"later"}analyzeRetention(e,t,s=ks.TARGET_RETENTION){const r=this.calculateMemoryStrength(e),o=this.calculateRetention(t,r),i=this.suggestReviewTiming(o,s);return{retention:o,memoryStrength:r,daysSince:t,reviewUrgency:i}}predictDecayDays(e,t=ks.TARGET_RETENTION){const s=-e*Math.log(t);return Math.max(0,s)}calculateNextReviewDate(e,t=ks.TARGET_RETENTION){const s=this.calculateMemoryStrength(e),r=this.predictDecayDays(s,t),o=Date.now()+r*24*60*60*1e3;return new Date(o)}logAnalysis(e,t){}getReviewUrgencyLabel(e){return{now:"‰ªä„Åô„ÅêÂæ©Áøí",soon:"ËøëÊó•‰∏≠„Å´Âæ©Áøí",scheduled:"„Çπ„Ç±„Ç∏„É•„Éº„É´ÈÄö„Çä",later:"ÂæåÂõû„Åó„ÅßOK"}[e]}getStrengthDescription(e){return e>=9?"Ë∂ÖÂº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂ÂÆåÂÖ®ÂÆöÁùÄÔºâ":e>=7?"Âº∑Âõ∫ÔºàÈï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠Ôºâ":e>=5?"‰∏≠Á®ãÂ∫¶ÔºàÁü≠ÊúüË®òÊÜ∂„Åã„ÇâÁßªË°å‰∏≠Ôºâ":e>=3?"Âº±„ÅÑÔºà„Åæ„Å†Áü≠ÊúüË®òÊÜ∂Ôºâ":"ÈùûÂ∏∏„Å´Âº±„ÅÑÔºà‰ΩúÊ•≠Ë®òÊÜ∂„É¨„Éô„É´Ôºâ"}};Ee(ks,"TARGET_RETENTION",.9),Ee(ks,"MIN_STRENGTH",1),Ee(ks,"MAX_STRENGTH",10);let nf=ks;var Ka=(n=>(n.WORKING_MEMORY="working",n.SHORT_TERM="short",n.CONSOLIDATING="consolidating",n.LONG_TERM="long",n))(Ka||{});const $r=class $r{determineMemoryStage(e){const t=this.getDaysSinceFirstAttempt(e),s=e.consecutiveCorrect||0,r=e.memorizationAttempts||0,o=e.memorizationCorrect||0;if(t>=30&&s>=3&&r>=10)return"long";const i=r>0?o/r:0;return t>=7&&s>=2&&i>=.7?"consolidating":t>=1&&o>0?"short":"working"}getDaysSinceFirstAttempt(e){const t=e.firstAttempted||Date.now(),s=(Date.now()-t)/(1e3*60*60*24);return Math.max(0,s)}getReviewIntervals(e){return{working:$r.WORKING_MEMORY_INTERVALS,short:$r.SHORT_TERM_INTERVALS,consolidating:$r.CONSOLIDATING_INTERVALS,long:$r.LONG_TERM_INTERVALS}[e]}calculateNextReviewInterval(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s),o=t.repetitions,i=r[Math.min(o,r.length-1)],a=t.nextInterval,c=(i+a)/2;return Math.max(.01,c)}analyzeMemoryStage(e,t){const s=this.determineMemoryStage(e),r=this.getReviewIntervals(s);let o;t?o=this.calculateNextReviewInterval(e,t):o=r[0];const i=this.getStageDescription(s);return{stage:s,recommendedIntervals:r,nextInterval:o,description:i}}getStageDescription(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂ - ÂàùÂõûÂ≠¶ÁøíÁõ¥Âæå„ÄÅÁü≠ÊúüÈñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å",short:"Áü≠ÊúüË®òÊÜ∂ - 1-2ÈÄ±Èñì„ÅßÂæ©Áøí„ÅåÂøÖË¶Å„ÄÅÂÆöÁùÄ„Å´„ÅØÊôÇÈñì„Åå„Åã„Åã„Çã",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠ - Èï∑ÊúüË®òÊÜ∂„Å∏„ÅÆÁßªË°åÈÅéÁ®ã„ÄÅÊúàÂçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅåÊé®Â•®",long:"Èï∑ÊúüË®òÊÜ∂ - ÂÆåÂÖ®„Å´ÂÆöÁùÄ„ÄÅÂçäÂπ¥ÔΩûÂπ¥Âçò‰Ωç„Åß„ÅÆÂæ©Áøí„ÅßÂçÅÂàÜ"}[e]}suggestPriorityAdjustment(e,t){const r=this.getReviewIntervals(e)[0];return t>r*1.5?20:t>r?10:t<r*.5?-10:0}logAnalysis(e,t){}getStageLabel(e){return{working:"‰ΩúÊ•≠Ë®òÊÜ∂",short:"Áü≠ÊúüË®òÊÜ∂",consolidating:"Âõ∫ÂÆöÂåñ‰∏≠",long:"Èï∑ÊúüË®òÊÜ∂"}[e]}};Ee($r,"WORKING_MEMORY_INTERVALS",[1/1440,10/1440,1/24,.5]),Ee($r,"SHORT_TERM_INTERVALS",[1,3,7,14]),Ee($r,"CONSOLIDATING_INTERVALS",[14,30,60,90]),Ee($r,"LONG_TERM_INTERVALS",[180,365,730]);let sf=$r;class qN extends ro{constructor(){super();Ee(this,"id","memory");Ee(this,"name","Memory AI");Ee(this,"icon","üß†");Ee(this,"sm2");Ee(this,"forgettingCurve");Ee(this,"longTermStrategy");this.sm2=new tf,this.forgettingCurve=new nf,this.longTermStrategy=new sf}proposePosition(t,s,r,o,i){if(i===0)return 35;let a=50;const c=this.longTermStrategy.determineMemoryStage(t),l=this.longTermStrategy.suggestPriorityAdjustment(c,r);a+=l;const d=this.determineQuality(t),h=this.sm2.calculateNextReview(d,t.easeFactor||2.5,t.lastInterval||1,t.repetitions||0),p=new Date,f=Math.floor((h.nextReviewDate.getTime()-p.getTime())/(1e3*60*60*24));f<=0?a+=30:f<=2?a+=15:f>=7&&(a-=20);const m=this.forgettingCurve.analyzeRetention(t,r);m.retention<.5?a+=25:m.retention>.8&&(a-=15);const g=o*30;a-=g;const x=Math.min(r*5,40);return a+=x,Math.max(0,Math.min(100,a))}analyzeByRules(t){const{word:s,progress:r,currentTab:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"";if(!r||!r.memorizationAttempts)return this.createNewWordSignal(i);const a=this.determineCategory(r),c=this.calculateForgettingRisk(r),l=this.calculateTimeBoost(r,o),d=this.calculateRetentionStrength(r),h=this.getDaysSinceLastStudy(r),p=this.determineQuality(r),f=this.sm2.calculateNextReview(p,r.easeFactor||2.5,r.lastInterval||1,r.repetitions||0),m=this.forgettingCurve.analyzeRetention(r,h),g=this.longTermStrategy.analyzeMemoryStage(r,f),x={[Ka.WORKING_MEMORY]:"WORKING_MEMORY",[Ka.SHORT_TERM]:"SHORT_TERM",[Ka.CONSOLIDATING]:"CONSOLIDATING",[Ka.LONG_TERM]:"LONG_TERM"};return{aiId:"memory",confidence:this.calculateConfidence(r),timestamp:Date.now(),forgettingRisk:c,timeBoost:l,category:a,retentionStrength:d,sm2Data:{quality:p,easeFactor:f.easeFactor,interval:f.nextInterval,repetitions:f.repetitions,nextReviewDate:f.nextReviewDate},retention:m.retention,memoryStage:x[g.stage],recommendedNextReview:f.nextReviewDate}}determineCategory(t){return Yr(Ut(t))}calculateForgettingRisk(t){const s=t.lastStudied||0,r=t.reviewInterval||1;if(s===0)return 0;const i=(Date.now()-s)/(1e3*60*60*24),a=t.memorizationAttempts||0,c=t.memorizationCorrect||0,l=t.memorizationStillLearning||0,d=c+l*.5,h=a>0?d/a*100:0;let p=i/r*100;return h<50?p*=1.5:h<70&&(p*=1.2),Math.min(p,200)}calculateTimeBoost(t,s){const r=t.lastStudied||0;if(r===0)return 0;const o=Date.now()-r,i=o/(1e3*60);if(s==="memorization")return i>=30?.6:i>=15?.5:i>=5?.3:i>=2?.15:0;const a=o/(1e3*60*60*24);return a>=7?.5:a>=3?.3:a>=1?.15:0}calculateRetentionStrength(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0,i=t.memorizationStreak||0;if(s===0)return 0;const c=(r+o*.5)/s,l=Math.min(i*.1,.3);return Math.min(c+l,1)}calculateConfidence(t){const s=t.memorizationAttempts||0;return s>=10?1:s>=5?.8:s>=3?.6:s>=1?.4:.2}createNewWordSignal(t){return{aiId:"memory",confidence:.1,timestamp:Date.now(),forgettingRisk:0,timeBoost:0,category:"new",retentionStrength:0}}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}determineQuality(t){const s=t.memorizationAttempts||0,r=t.memorizationCorrect||0,o=t.memorizationStillLearning||0;if(s===0)return 3;const a=(r+o*.5)/s,c=Ut(t,"memorization");switch(Yr(c)){case"incorrect":return c>=90?0:c>=80?1:2;case"still_learning":return a>=.9?4:a>=.7?3:2;case"new":return a>=.9?5:a>=.7?4:3;case"mastered":return a>=.9?5:(a>=.7,4);default:return 3}}logEnhancedAnalysis(t,s,r,o,i){console.log("[MemoryAI Phase 4 ÂàÜÊûê]",{word:t.word,sm2:{quality:i,easeFactor:s.easeFactor,interval:s.nextInterval,nextReview:s.nextReviewDate},retention:{retention:r.retention,memoryStrength:r.memoryStrength,reviewUrgency:r.reviewUrgency},memoryStage:{stage:o.stage,nextReview:o.nextInterval,description:o.description}})}validateSignal(t){return!(!t.aiId||t.aiId!=="memory"||t.confidence<0||t.confidence>1||t.forgettingRisk<0||t.forgettingRisk>200||t.timeBoost<0||t.timeBoost>1||t.retentionStrength<0||t.retentionStrength>1||!["new","incorrect","still_learning","mastered"].includes(t.category))}calculateOptimalInterval(t,s=2.5){if(t===0)return 0;if(t===1)return 1;if(t===2)return 6;const r=this.calculateOptimalInterval(t-1,s);return Math.round(r*s)}updateEasinessFactor(t,s){const r=t+(.1-(5-s)*(.08+(5-s)*.02));return Math.max(r,1.3)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"memory",confidence:r.confidence,timestamp:Date.now(),forgettingRisk:r.values[0]*100,timeBoost:r.values[1],category:this.predictCategory(r.values[2]),retentionStrength:r.values[3]}}mergeSignals(t,s,r){var c;const o=((c=r.progress)==null?void 0:c.memorizationAttempts)||0,i=Math.min(Math.max((o-10)/20,0),.7),a=1-i;return{aiId:"memory",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),forgettingRisk:t.forgettingRisk*a+s.forgettingRisk*i,timeBoost:t.timeBoost*a+s.timeBoost*i,category:o>30?s.category:t.category,retentionStrength:t.retentionStrength*a+s.retentionStrength*i,sm2Data:t.sm2Data,retention:t.retention,memoryStage:t.memoryStage,recommendedNextReview:t.recommendedNextReview}}extractFeatures(t){const{word:s,progress:r}=t;if(!r)return Array(15).fill(0);const o=r.memorizationAttempts||0,i=r.memorizationCorrect||0,a=r.consecutiveCorrect||0,c=r.consecutiveIncorrect||0;return[s.word.length/15,s.meaning.split(",").length/5,o/20,o>0?i/o:0,a/10,c/5,this.getDaysSinceLastStudy(r)/30,new Date().getHours()/24,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,t.sessionStats.questionsAnswered||t.sessionStats.totalAttempts/50,t.sessionStats.currentAccuracy||(t.sessionStats.totalAttempts>0?t.sessionStats.correctAnswers/t.sessionStats.totalAttempts:0),r.easeFactor||r.easinessFactor||2.5,this.forgettingCurve.analyzeRetention(r,this.getDaysSinceLastStudy(r)).retention]}predictCategory(t){return t<.25?"new":t<.5?"incorrect":t<.75?"still_learning":"mastered"}getFeatureDimension(){return 15}getOutputDimension(){return 4}}class KN extends ro{constructor(){super(...arguments);Ee(this,"id","cognitiveLoad");Ee(this,"name","Cognitive Load AI");Ee(this,"icon","üí§")}proposePosition(t,s){const i=50+s*15;return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{sessionStats:s}=t,r=this.determineLoadLevel(s),o=this.calculateFatigueScore(s),i=this.shouldRecommendBreak(r,o,s),a=this.calculateDifficultyAdjustment(r,s);return{aiId:"cognitiveLoad",confidence:this.calculateConfidence(s),timestamp:Date.now(),loadLevel:r,fatigueScore:o,recommendedBreak:i,difficultyAdjustment:a}}determineLoadLevel(t){const s=t.totalAttempts,r=s>0?t.correctAnswers/s:1,o=t.consecutiveIncorrect;return o>=5||r<.3&&s>=10?"overload":o>=3||r<.5&&s>=5?"high":r<.7?"medium":"low"}calculateFatigueScore(t){const s=t.sessionDuration/6e4,r=t.totalAttempts,o=t.avgResponseTime||0;let i=0;return s>45?i+=.5:s>30?i+=.3:s>15&&(i+=.1),r>50?i+=.3:r>30&&(i+=.2),o>5e3?i+=.2:o>4e3&&(i+=.1),Math.min(i,1)}shouldRecommendBreak(t,s,r){return t==="overload"||s>=.7||r.consecutiveIncorrect>=4||r.sessionDuration/(1e3*60)>=45}calculateDifficultyAdjustment(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return t==="overload"?-.2:t==="high"?-.15:t==="low"&&o>=.85&&r>=10?.15:t==="low"&&o>=.75?.1:0}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.3;return s>=20?o+=.3:s>=10?o+=.2:s>=5&&(o+=.1),r>=15?o+=.3:r>=5?o+=.2:r>=2&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="cognitiveLoad"||t.confidence<0||t.confidence>1||t.fatigueScore<0||t.fatigueScore>1||t.difficultyAdjustment<-.2||t.difficultyAdjustment>.2||!["low","medium","high","overload"].includes(t.loadLevel))}logAnalysis(t,s){}getRecommendedActions(t){const s=[];return t.loadLevel==="overload"?(s.push("5-10ÂàÜ„ÅÆ‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Á∞°Âçò„Å™ÂïèÈ°å„Åã„ÇâÂÜçÈñã„Åó„Åæ„Åó„Çá„ÅÜ"),s.push("Ê∞¥ÂàÜË£úÁµ¶„Çí„Åó„Åæ„Åó„Çá„ÅÜ")):t.loadLevel==="high"?(s.push("2-3ÂàÜ„ÅÆÂ∞è‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ"),s.push("Â∞ë„ÅóÁ∞°Âçò„Å™ÂïèÈ°å„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô")):t.recommendedBreak&&s.push("„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅÂ∞ë„Åó‰ºëÊÜ©„Åó„Åæ„Åó„Çá„ÅÜ"),t.fatigueScore>=.7&&s.push("ÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ"),s}isInFlowState(t,s){if(t.loadLevel!=="medium"&&t.loadLevel!=="low"||t.fatigueScore>.5)return!1;const r=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0;if(r<.6||r>.85)return!1;const o=s.sessionDuration/(1e3*60);return!(o<5||o>45)}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="low":o<.5?i="medium":o<.75?i="high":i="overload";const a=r.values[1],c=r.values[2],l=(r.values[3]-.5)*.4;return{aiId:"cognitiveLoad",confidence:r.confidence,timestamp:Date.now(),loadLevel:i,fatigueScore:a,recommendedBreak:c>.5,difficultyAdjustment:l}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.floor(o/20),a=Math.min(Math.max((i-3)/10,0),.7),c=1-a;return{aiId:"cognitiveLoad",confidence:t.confidence*c+s.confidence*a,timestamp:Date.now(),loadLevel:i>10?s.loadLevel:t.loadLevel,fatigueScore:t.fatigueScore*c+s.fatigueScore*a,recommendedBreak:t.recommendedBreak||s.recommendedBreak,difficultyAdjustment:t.difficultyAdjustment*c+s.difficultyAdjustment*a}}extractFeatures(t){const{sessionStats:s,progress:r}=t,o=s.sessionDuration/(1e3*60),i=r&&r.memorizationAttempts||0,a=r&&r.memorizationCorrect||0,c=r&&r.consecutiveIncorrect||0;return[o/60,s.totalAttempts/50,s.questionsAnswered||s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveIncorrect/5,s.consecutiveCorrect||0,(s.averageResponseTime||s.avgResponseTime||0)/1e4,s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0,new Date().getHours()/24,new Date().getDay()/7,s.sessionStartTime?(Date.now()-s.sessionStartTime)/(1e3*60*60):0,i/20,i>0?a/i:.5,c/5,s.responseTimeVariance||0,s.slowResponseCount||0,s.fastResponseCount||0,s.timeoutCount||0]}getFeatureDimension(){return 18}getOutputDimension(){return 4}}class XN extends ro{constructor(){super(...arguments);Ee(this,"id","errorPrediction");Ee(this,"name","Error Prediction AI");Ee(this,"icon","üîÆ")}proposePosition(t,s,r){const o=(1-s)*40,i=r>5&&s<.5?20:0,c=50+o+i;return Math.max(0,Math.min(100,c))}analyzeByRules(t){const{word:s,progress:r,allProgress:o}=t,i=typeof s=="string"?s:(s==null?void 0:s.word)||"",a=this.identifyWeaknessAreas(r,o),c=this.findConfusionPairs(i,o),l=this.recommendPreemptiveReview(i,o),d=this.calculatePatternConfidence(r);return{aiId:"errorPrediction",confidence:this.calculateConfidence(r),timestamp:Date.now(),weaknessAreas:a,confusionPairs:c,preemptiveReview:l,patternConfidence:d}}identifyWeaknessAreas(t,s){const r=[],o={};return Object.values(s).forEach(i=>{const a=i.errorHistory;a==null||a.forEach(c=>{c.grammarPoint&&(o[c.grammarPoint]=(o[c.grammarPoint]||0)+1)})}),Object.entries(o).forEach(([i,a])=>{a>=3&&r.push(i)}),r}findConfusionPairs(t,s){const r=[],o=s[t],i=o==null?void 0:o.errorHistory;if(!i)return[];const a={};return i.forEach(c=>{c.userAnswer&&(a[c.userAnswer]=(a[c.userAnswer]||0)+1)}),Object.entries(a).forEach(([c,l])=>{l>=2&&r.push([t,c])}),r}recommendPreemptiveReview(t,s){const r=[];return Object.keys(s).forEach(o=>{if(o!==t&&o.substring(0,3)===t.substring(0,3)){const i=s[o],a=i.memorizationAttempts||0,c=i.memorizationCorrect||0;(a>0?c/a:0)<.6&&a>=2&&r.push(o)}}),r.slice(0,5)}calculatePatternConfidence(t){const s=t==null?void 0:t.errorHistory;if(!s)return 0;const r=s.length;return r>=5?.9:r>=3?.7:r>=2?.5:r>=1?.3:.1}calculateConfidence(t){const s=t==null?void 0:t.errorHistory,r=(s==null?void 0:s.length)||0,o=(t==null?void 0:t.memorizationAttempts)||0,i=Math.min(o/10,.5),a=Math.min(r/5,.5);return i+a}validateSignal(t){return!(!t.aiId||t.aiId!=="errorPrediction"||t.confidence<0||t.confidence>1||t.patternConfidence<0||t.patternConfidence>1||!Array.isArray(t.weaknessAreas)||!Array.isArray(t.confusionPairs)||!Array.isArray(t.preemptiveReview))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0],i=r.values[1],a=r.values[2];return{aiId:"errorPrediction",confidence:r.confidence,timestamp:Date.now(),weaknessAreas:i>.7?["predicted_weakness"]:[],confusionPairs:a>.7?[["predicted","confusion"]]:[],preemptiveReview:o>.6?["predicted_review"]:[],patternConfidence:r.confidence,errorProbability:o,weaknessLevel:i,confusionScore:a}}mergeSignals(t,s,r){var h,p;const o=r.progress,i=((h=o==null?void 0:o.errorHistory)==null?void 0:h.length)||0,a=((p=r.progress)==null?void 0:p.memorizationAttempts)||0,c=i+a;let l=Math.min(Math.max((c-10)/15,0),.8);c>50&&(l=.9);const d=1-l;return{aiId:"errorPrediction",confidence:t.confidence*d+s.confidence*l,timestamp:Date.now(),weaknessAreas:t.weaknessAreas,confusionPairs:t.confusionPairs,preemptiveReview:t.preemptiveReview,patternConfidence:t.patternConfidence*d+s.patternConfidence*l,errorProbability:s.errorProbability,weaknessLevel:s.weaknessLevel,confusionScore:s.confusionScore}}extractFeatures(t){var p;const{word:s,progress:r,allProgress:o,sessionStats:i}=t;if(!r)return Array(20).fill(0);Object.keys(o).length;const a=r,c=((p=a.errorHistory)==null?void 0:p.length)||0,l=r.memorizationAttempts||0,d=r.memorizationCorrect||0,h=l>0?d/l:0;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?1:0,s.katakana?1:0,c/10,(r.consecutiveIncorrect||0)/5,l>0?1-h:.5,0,a.lastErrorType==="spelling"?1:0,a.lastErrorType==="meaning"?1:0,l/20,(r.consecutiveCorrect||0)/10,this.getDaysSinceLastStudy(r)/30,(r.memorizationStreak||0)/10,(r.translationAttempts||0)/20,(r.spellingAttempts||0)/20,(r.grammarAttempts||0)/20,i.questionsAnswered||i.totalAttempts/50,i.currentAccuracy||(i.totalAttempts>0?i.correctAnswers/i.totalAttempts:0),(i.averageResponseTime||i.avgResponseTime||0)/1e4]}getDaysSinceLastStudy(t){const s=t.lastStudied||0;return s===0?0:(Date.now()-s)/(1e3*60*60*24)}getFeatureDimension(){return 20}getOutputDimension(){return 3}}class QN extends ro{constructor(){super(...arguments);Ee(this,"id","learningStyle");Ee(this,"name","Learning Style AI");Ee(this,"icon","üéØ")}proposePosition(t,s,r){const a=50+(r>10&&s<.6?25:0);return Math.max(0,Math.min(100,a))}analyzeByRules(t){const{progress:s,allProgress:r,sessionStats:o}=t,i=this.determineStyleProfile(s,r),a=this.calculateOptimalSessionLength(r,o),c=this.inferDifficultyPreference(r,o),l=this.inferMotivationType(r);return{aiId:"learningStyle",confidence:this.calculateConfidence(r),timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:c,motivationType:l}}determineStyleProfile(t,s){var i;const r={};Object.values(s).forEach(a=>{var c;(c=a.preferredQuestionTypes)==null||c.forEach(l=>{r[l]=(r[l]||0)+1})});const o=(i=Object.entries(r).sort((a,c)=>c[1]-a[1])[0])==null?void 0:i[0];return o!=null&&o.includes("audio")||o!=null&&o.includes("pronunciation")?"auditory":o!=null&&o.includes("image")||o!=null&&o.includes("visual")?"visual":o!=null&&o.includes("writing")||o!=null&&o.includes("typing")?"kinesthetic":"reading"}calculateOptimalSessionLength(t,s){const r=[];if(Object.values(t).forEach(a=>{const c=a.studyTimePatterns;c&&r.push(...c)}),r.length===0)return 20;r.sort((a,c)=>a-c);const o=[];for(let a=1;a<r.length;a++){const l=(r[a]-r[a-1])/(1e3*60);l>=5&&l<=60&&o.push(l)}if(o.length===0)return 20;o.sort((a,c)=>a-c);const i=o[Math.floor(o.length/2)];return Math.round(i)}inferDifficultyPreference(t,s){const r=s.totalAttempts,o=r>0?s.correctAnswers/r:.5;return o>=.8&&r>=20?"challenge":o<.6?"gradual":"mixed"}inferMotivationType(t){const s=Object.keys(t).length,r=Object.values(t).filter(i=>(i.memorizationStreak||0)>=3).length,o=s>0?r/s:0;return o>=.7?"mastery":o>=.4?"performance":"social"}calculateConfidence(t){const s=Object.keys(t).length,r=Object.values(t).reduce((i,a)=>i+(a.memorizationAttempts||0),0);let o=.3;return s>=50?o+=.3:s>=20?o+=.2:s>=10&&(o+=.1),r>=100?o+=.4:r>=50?o+=.2:r>=20&&(o+=.1),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="learningStyle"||t.confidence<0||t.confidence>1||t.optimalSessionLength<5||t.optimalSessionLength>120||!["visual","auditory","kinesthetic","reading"].includes(t.styleProfile)||!["gradual","challenge","mixed"].includes(t.preferredDifficulty)||!["mastery","performance","social"].includes(t.motivationType))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[0];let i;o<.25?i="visual":o<.5?i="auditory":o<.75?i="kinesthetic":i="reading";const a=Math.round(r.values[1]*60+10),c=r.values[2];let l;c<.33?l="gradual":c<.67?l="mixed":l="challenge";const d=r.values[3];let h;return d<.33?h="mastery":d<.67?h="performance":h="social",{aiId:"learningStyle",confidence:r.confidence,timestamp:Date.now(),styleProfile:i,optimalSessionLength:a,preferredDifficulty:l,motivationType:h}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"learningStyle",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),styleProfile:o>50?s.styleProfile:t.styleProfile,optimalSessionLength:Math.round(t.optimalSessionLength*a+s.optimalSessionLength*i),preferredDifficulty:o>50?s.preferredDifficulty:t.preferredDifficulty,motivationType:o>50?s.motivationType:t.motivationType}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=Object.values(r).reduce((a,c)=>a+(c.memorizationAttempts||0),0);return[s.sessionDuration/(1e3*60*60),s.totalAttempts/50,s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,o/100,i/200,s.questionsAnswered||s.totalAttempts/50,(s.averageResponseTime||s.avgResponseTime||0)/1e4,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 4}}class YN extends ro{constructor(){super(...arguments);Ee(this,"id","linguistic");Ee(this,"name","Linguistic AI");Ee(this,"icon","üìö")}proposePosition(t,s){const r=t.word||"",o=Math.min(r.length*2,20),i=this.calculateIrregularity(r),a=(1-s)*30,l=40+o+i+a;return Math.max(0,Math.min(100,l))}calculateIrregularity(t){const s=/([bcdfghjklmnpqrstvwxyz])\1/.test(t),r=/([qx]|[^aeiou]{4})/.test(t);return(s?5:0)+(r?10:0)}analyzeByRules(t){const{word:s,allProgress:r}=t,o=typeof s=="string"?s:(s==null?void 0:s.word)||"",i=this.calculateInherentDifficulty(o),a=this.findPhoneticallySimilarWords(o,r),c=this.findSemanticCluster(o,r),l=this.assessGrammarComplexity(o);return{aiId:"linguistic",confidence:.8,timestamp:Date.now(),inherentDifficulty:i,phoneticSimilarity:a,semanticCluster:c,grammarComplexity:l}}calculateInherentDifficulty(t){let s=0;t.length>12?s+=.3:t.length>8?s+=.2:t.length>5&&(s+=.1);const r=t.match(/[aeiou]/gi),o=r?r.length:1;return o>4?s+=.2:o>3&&(s+=.1),/[bcdfghjklmnpqrstvwxyz]{3,}/i.test(t)&&(s+=.2),/gh|ph|th|ough|augh/i.test(t)&&(s+=.1),Math.min(s,1)}findPhoneticallySimilarWords(t,s){const r=[];return Object.keys(s).forEach(o=>{o!==t&&(o.substring(0,3)===t.substring(0,3)||o.substring(o.length-3)===t.substring(t.length-3))&&r.push(o)}),r.slice(0,5)}findSemanticCluster(t,s){const r=[],o=this.extractWordRoot(t);return Object.keys(s).forEach(i=>{if(i===t)return;const a=this.extractWordRoot(i);o&&a&&o===a&&r.push(i)}),r.slice(0,5)}extractWordRoot(t){const s=["ing","ed","er","est","ly","s","es","tion","ment"];for(const r of s)if(t.endsWith(r))return t.substring(0,t.length-r.length);return t}assessGrammarComplexity(t){let s=0;return["be","have","do","go","take","get","make","know","think","see","come","want","use","find","give"].some(o=>t.includes(o))&&(s+=.3),(t.includes("-")||t.includes(" "))&&(s+=.2),(t.endsWith("tion")||t.endsWith("ment")||t.endsWith("ness"))&&(s+=.2),Math.min(s,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="linguistic"||t.confidence<0||t.confidence>1||t.inherentDifficulty<0||t.inherentDifficulty>1||t.grammarComplexity<0||t.grammarComplexity>1||!Array.isArray(t.phoneticSimilarity)||!Array.isArray(t.semanticCluster))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"linguistic",confidence:r.confidence,timestamp:Date.now(),inherentDifficulty:r.values[0],phoneticSimilarity:[],semanticCluster:[],grammarComplexity:r.values[1]}}mergeSignals(t,s,r){const o=Object.keys(r.allProgress).length,i=Math.min(Math.max((o-30)/50,0),.5),a=1-i;return{aiId:"linguistic",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),inherentDifficulty:t.inherentDifficulty*a+s.inherentDifficulty*i,phoneticSimilarity:t.phoneticSimilarity,semanticCluster:t.semanticCluster,grammarComplexity:t.grammarComplexity*a+s.grammarComplexity*i}}extractFeatures(t){var r;const{word:s}=t;return[s.word.length/15,s.meaning.split(",").length/5,s.ipa?s.ipa.length/20:0,s.katakana?s.katakana.length/20:0,/[^aeiou]{3}/.test(s.word)?1:0,/([bcdfghjklmnpqrstvwxyz])\1/.test(s.word)?1:0,s.word.split("-").length/3,s.word.includes(" ")?1:0,((r=s.word.match(/[A-Z]/g))==null?void 0:r.length)||0,/(tion|ment|ness|ing|ed)$/.test(s.word)?1:0]}getFeatureDimension(){return 10}getOutputDimension(){return 2}}class JN extends ro{constructor(){super(...arguments);Ee(this,"id","contextual");Ee(this,"name","Contextual AI");Ee(this,"icon","üåç")}proposePosition(t,s){const i=50+Math.min(s*3,30);return Math.max(0,Math.min(100,i))}analyzeByRules(t){const{word:s,currentTab:r,allProgress:o,sessionStats:i}=t,a=typeof s=="string"?s:(s==null?void 0:s.word)||"",c=this.calculateContextRelevance(a,r),l=this.evaluateTopicContinuity(a,o,i),d=this.assessEnvironmentFit(r,i),h=this.identifyCrossTabSynergy(a,r,o);return{aiId:"contextual",confidence:this.calculateConfidence(i),timestamp:Date.now(),contextRelevance:c,topicContinuity:l,environmentFit:d,crossTabSynergy:h}}calculateContextRelevance(t,s){let r=.5;return s==="memorization"&&(r+=.2),s==="grammar"&&(r+=.3),s==="comprehensive"&&(r+=.1),Math.min(r,1)}evaluateTopicContinuity(t,s,r){return r.totalAttempts>=5}assessEnvironmentFit(t,s){let r=.5;const o=s.sessionDuration/(1e3*60),i=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5,a=new Date().getHours();return a>=6&&a<12&&t==="memorization"&&(r+=.2),a>=12&&a<18&&t==="grammar"&&(r+=.2),a>=18&&t==="memorization"&&i>=.7&&(r+=.2),o<15&&t==="memorization"&&(r+=.1),Math.min(r,1)}identifyCrossTabSynergy(t,s,r){const o=[];if(s==="memorization"){const i=r[t];i!=null&&i.grammarAttempts&&i.grammarAttempts>0&&o.push("grammar-memorization-link")}if(s==="grammar"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&o.push("memorization-grammar-link")}if(s==="comprehensive"){const i=r[t];i!=null&&i.memorizationAttempts&&i.memorizationAttempts>0&&(i!=null&&i.grammarAttempts)&&i.grammarAttempts>0&&o.push("comprehensive-integration")}return o}calculateConfidence(t){const s=t.totalAttempts,r=t.sessionDuration/(1e3*60);let o=.4;return s>=10?o+=.3:s>=5&&(o+=.2),r>=10?o+=.3:r>=5&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="contextual"||t.confidence<0||t.confidence>1||t.contextRelevance<0||t.contextRelevance>1||t.environmentFit<0||t.environmentFit>1||typeof t.topicContinuity!="boolean"||!Array.isArray(t.crossTabSynergy))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s);return{aiId:"contextual",confidence:r.confidence,timestamp:Date.now(),contextRelevance:r.values[0],topicContinuity:r.values[1]>.5,environmentFit:r.values[2],crossTabSynergy:[]}}mergeSignals(t,s,r){const o=r.sessionStats.totalAttempts,i=Math.min(Math.max((o-20)/50,0),.6),a=1-i;return{aiId:"contextual",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),contextRelevance:t.contextRelevance*a+s.contextRelevance*i,topicContinuity:t.topicContinuity||s.topicContinuity,environmentFit:t.environmentFit*a+s.environmentFit*i,crossTabSynergy:t.crossTabSynergy}}extractFeatures(t){const{currentTab:s,sessionStats:r,progress:o}=t;return[s==="memorization"?1:0,s==="grammar"?1:0,s==="comprehensive"?1:0,r.sessionDuration/(1e3*60*60),r.totalAttempts/50,r.currentAccuracy||(r.totalAttempts>0?r.correctAnswers/r.totalAttempts:0),o?(o.memorizationAttempts||0)/20:0,o?(o.grammarAttempts||0)/20:0,new Date().getHours()/24,new Date().getDay()/7]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class Xa extends ro{constructor(){super(...arguments);Ee(this,"id","gamification");Ee(this,"name","Gamification AI");Ee(this,"icon","üéÆ")}proposePosition(t,s,r){const o=s>=3?-15:0,i=r>=.8?-10:0,c=50+o+i;return Math.max(0,Math.min(100,c))}adjustPositionForInterleaving(t){var l;const s=t.filter(d=>d.position>=40),r=t.filter(d=>d.position<40);t.filter(d=>d.position>=25&&d.position<40);const o=!1;if(s.length===0)return{result:t,changed:[]};if(r.length===0)return{result:t,changed:[]};let i=0,a=0;s.length>=50?(i=.17,a=10):s.length>=20?(i=.25,a=8):s.length>=5?(i=.33,a=8):s.length>=1&&(i=.5,a=15);const c=[];if(i>0&&r.length>0){const d=Math.floor(r.length*i),h=[...r].filter(m=>m.position>=20).sort((m,g)=>g.position-m.position),p=Math.min(d,h.length);for(let m=0;m<p;m++){const g=h[m].position;h[m].position=Math.min(h[m].position+a,59);const x=((l=h[m].question)==null?void 0:l.word)||"(unknown)";c.push({word:x,before:g,after:h[m].position})}const f=t.filter(m=>{const g=(m.attempts??0)===0,x=m.position>=40;return g&&x&&m.position>=60});f.length>0;try{localStorage.setItem("debug_position_hierarchy_new",JSON.stringify({violations:f.map(m=>{var g;return{word:((g=m.question)==null?void 0:g.word)||"(unknown)",position:m.position,type:"new_exceeds_60"}}),totalNew:t.filter(m=>(m.attempts??0)===0&&m.position>=40).length,violationCount:f.length,timestamp:new Date().toISOString()}))}catch{}}return{result:t,changed:c}}boostStillLearningQuestions(t){var h;const s=t.filter(p=>p.position>=40&&p.position<70&&(p.attempts??0)>0),r=t.filter(p=>p.position>=70&&(p.attempts??0)>0),o=!1,i=r.length===0&&s.length>0;if(s.length===0)return{result:t,changed:[]};const a=[];for(const p of s){const f=p.position;let m;if(i){const x=f<50?25:f<60?15:8;m=Math.min(f+x,69),m=Math.max(m,68)}else{const x=f<50?20:f<60?10:5;m=Math.min(f+x,69),m=Math.max(m,60)}p.position=m;const g=((h=p.question)==null?void 0:h.word)||"(unknown)";a.push({word:g,before:f,after:p.position})}const c=i?68:60,l=69,d=s.filter(p=>p.position<c||p.position>l);d.length>0;try{localStorage.setItem("debug_position_hierarchy_still",JSON.stringify({mode:i?"focus":"normal",targetRange:`${c}-${l}`,violations:d.map(p=>{var f;return{word:((f=p.question)==null?void 0:f.word)||"(unknown)",position:p.position,type:p.position<c?`still_below_${c}`:`still_above_${l}`}}),totalStill:s.length,violationCount:d.length,timestamp:new Date().toISOString()})),localStorage.setItem("debug_still_learning_boost",JSON.stringify({boosted:a.length,changes:a,working:a.length>0,timestamp:new Date().toISOString()}))}catch{}return{result:t,changed:a}}interleaveByCategory(t){const r=Math.max(1,Math.round(4)),o=t.filter(p=>p.position>=40&&(p.attempts??0)>0),i=t.filter(p=>p.position>=40&&p.position<70&&(p.attempts??0)===0),a=t.filter(p=>p.position<40);if(o.length===0&&i.length===0)return t;if(i.length===0)return[...o,...a];if(o.length===0)return[...i,...a];const c=[];let l=0,d=0;for(;l<o.length||d<i.length;){const p=Math.min(r,o.length-l);for(let f=0;f<p;f++)c.push(o[l++]);d<i.length&&c.push(i[d++])}return[...c,...a]}analyzeByRules(t){const{allProgress:s,sessionStats:r}=t,o=this.calculateMotivationLevel(s,r),i=this.shouldTriggerReward(s,r),a=this.determineChallengeLevel(r),c=this.generateSocialFeedback(s,r);return{aiId:"gamification",confidence:this.calculateConfidence(s),timestamp:Date.now(),motivationLevel:o,rewardTiming:i,challengeLevel:a,socialFeedback:c}}calculateMotivationLevel(t,s){let r=.5;const o=s.totalAttempts>0?s.correctAnswers/s.totalAttempts:.5;o>=.8?r+=.3:o>=.6?r+=.2:o>=.4?r+=.1:r-=.2,s.consecutiveIncorrect===0&&s.totalAttempts>=5&&(r+=.2);const i=s.masteredCount||0,a=Object.keys(t).length,c=a>0?i/a:0;c>=.7?r+=.2:c>=.5&&(r+=.1);const l=s.sessionDuration/(1e3*60);return l>45?r-=.2:l>30&&(r-=.1),Math.max(0,Math.min(r,1))}shouldTriggerReward(t,s){const r=s.masteredCount||0;if(r>0&&r%10===0||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0)>=.9&&s.totalAttempts>=10)return!0;const i=new Set;return Object.values(t).forEach(a=>{if(a.lastStudied){const c=new Date(a.lastStudied).toDateString();i.add(c)}}),i.size>=7}determineChallengeLevel(t){const s=t.totalAttempts>0?t.correctAnswers/t.totalAttempts:.5;return s>=.85?"hard":s>=.6?"medium":"easy"}generateSocialFeedback(t,s){const r=s.masteredCount||0,o=s.totalAttempts,i=o>0?s.correctAnswers/o:0;if(r>=100)return"üéâ 100Ë™û‰ª•‰∏ä„Éû„Çπ„Çø„ÉºÔºÅËã±Ë™ûÂ≠¶Áøí„ÇíÁ∂ö„Åë„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö„ÅØÂäõ„Å™„Çä";if(r>=50)return"üåü 50Ë™û„Éû„Çπ„Çø„ÉºÈÅîÊàêÔºÅÁùÄÂÆü„Å´ÊàêÈï∑‰∏≠ÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁõÆÊ®ôÈÅîÊàê";if(r>=10)return"üìö 10Ë™û„Éû„Çπ„Çø„ÉºÔºÅ„Ç≥„ÉÑ„Ç≥„ÉÑÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÂàùÂøÉËÄÖ";if(i>=.9&&o>=10)return"üíØ Ê≠£Á≠îÁéá90%‰ª•‰∏äÔºÅË™øÂ≠ê„Åå„ÅÑ„ÅÑ„Åß„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Â•ΩË™ø";const a=this.calculateStudyDays(t);return a>=30?"üî• 30Êó•ÈÄ£Á∂öÂ≠¶ÁøíÈÅîÊàêÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„ÇäÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #ÁøíÊÖ£Âåñ":a>=7?"‚ú® 1ÈÄ±ÈñìÈÄ£Á∂öÂ≠¶ÁøíÔºÅÁøíÊÖ£Âåñ„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ #Ëã±Ë™ûÂ≠¶Áøí #Á∂ôÁ∂ö‰∏≠":""}calculateStudyDays(t){const s=new Set;return Object.values(t).forEach(r=>{if(r.lastStudied){const o=new Date(r.lastStudied).toDateString();s.add(o)}}),s.size}calculateConfidence(t){const s=Object.keys(t).length,r=this.calculateStudyDays(t);let o=.3;return s>=50?o+=.3:s>=20&&(o+=.2),r>=7?o+=.4:r>=3&&(o+=.2),Math.min(o,1)}validateSignal(t){return!(!t.aiId||t.aiId!=="gamification"||t.confidence<0||t.confidence>1||t.motivationLevel<0||t.motivationLevel>1||typeof t.rewardTiming!="boolean"||typeof t.socialFeedback!="string"||!["easy","medium","hard"].includes(t.challengeLevel))}async analyzeByML(t){const s=this.extractFeatures(t),r=await this.predict(s),o=r.values[1];let i;return o<.33?i="easy":o<.67?i="medium":i="hard",{aiId:"gamification",confidence:r.confidence,timestamp:Date.now(),motivationLevel:r.values[0],rewardTiming:r.values[2]>.5,challengeLevel:i,socialFeedback:""}}mergeSignals(t,s,r){Object.keys(r.allProgress).length;const o=this.calculateStudyDays(r.allProgress),i=Math.min(Math.max((o-3)/10,0),.6),a=1-i;return{aiId:"gamification",confidence:t.confidence*a+s.confidence*i,timestamp:Date.now(),motivationLevel:t.motivationLevel*a+s.motivationLevel*i,rewardTiming:t.rewardTiming||s.rewardTiming,challengeLevel:o>7?s.challengeLevel:t.challengeLevel,socialFeedback:t.socialFeedback}}extractFeatures(t){const{sessionStats:s,allProgress:r}=t,o=Object.keys(r).length,i=this.calculateStudyDays(r),a=s.masteredCount||0;return[s.currentAccuracy||(s.totalAttempts>0?s.correctAnswers/s.totalAttempts:0),s.consecutiveCorrect||0,s.consecutiveIncorrect/5,s.sessionDuration/(1e3*60*60),s.totalAttempts/50,o/100,i/30,a/o||0,s.questionsAnswered||s.totalAttempts/50,new Date().getHours()/24]}getFeatureDimension(){return 10}getOutputDimension(){return 3}}class UK{constructor(e={}){Ee(this,"memoryAI");Ee(this,"cognitiveLoadAI");Ee(this,"errorPredictionAI");Ee(this,"learningStyleAI");Ee(this,"linguisticAI");Ee(this,"contextualAI");Ee(this,"gamificationAI");Ee(this,"config");this.memoryAI=new qN,this.cognitiveLoadAI=new KN,this.errorPredictionAI=new XN,this.learningStyleAI=new QN,this.linguisticAI=new YN,this.contextualAI=new JN,this.gamificationAI=new Xa,this.config={...Vh,...e,weights:{...Vh.weights,...e.weights||{}},emergencyThresholds:{...Vh.emergencyThresholds,...e.emergencyThresholds||{}}},this.initializeMLModels().catch(t=>{console.warn("[AICoordinator] ML initialization failed, using rules only",t)}),this.checkAndEnableML()}checkAndEnableML(){try{if(typeof localStorage>"u"){console.warn("[AICoordinator] localStorage not available");return}localStorage.getItem("ab_ml_enabled")==="true"?(console.log("‚úÖ [AICoordinator] ML enabled by user setting"),this.enableML()):console.log("‚ÑπÔ∏è [AICoordinator] ML disabled by user setting")}catch(e){console.warn("[AICoordinator] Failed to check ML setting",e)}}enableML(){var e,t,s,r,o,i,a,c,l,d,h,p,f,m;try{(t=(e=this.memoryAI).enableML)==null||t.call(e),(r=(s=this.cognitiveLoadAI).enableML)==null||r.call(s),(i=(o=this.errorPredictionAI).enableML)==null||i.call(o),(c=(a=this.learningStyleAI).enableML)==null||c.call(a),(d=(l=this.linguisticAI).enableML)==null||d.call(l),(p=(h=this.contextualAI).enableML)==null||p.call(h),(m=(f=this.gamificationAI).enableML)==null||m.call(f),console.log("‚úÖ [AICoordinator] ML enabled for all specialists")}catch(g){console.warn("[AICoordinator] Failed to enable ML",g)}}async initializeMLModels(){var e,t,s,r,o,i,a,c,l,d,h,p,f,m;try{await Promise.all([(t=(e=this.memoryAI).initializeML)==null?void 0:t.call(e),(r=(s=this.cognitiveLoadAI).initializeML)==null?void 0:r.call(s),(i=(o=this.errorPredictionAI).initializeML)==null?void 0:i.call(o),(c=(a=this.learningStyleAI).initializeML)==null?void 0:c.call(a),(d=(l=this.linguisticAI).initializeML)==null?void 0:d.call(l),(p=(h=this.contextualAI).initializeML)==null?void 0:p.call(h),(m=(f=this.gamificationAI).initializeML)==null?void 0:m.call(f)]),console.log("‚úÖ [AICoordinator] ML models initialized")}catch(g){console.warn("‚ö†Ô∏è [AICoordinator] ML initialization partial failure",g)}}async learn(e,t){var s,r,o,i,a,c,l,d,h,p,f,m,g,x;try{await Promise.all([(r=(s=this.memoryAI).learn)==null?void 0:r.call(s,e,t),(i=(o=this.cognitiveLoadAI).learn)==null?void 0:i.call(o,e,t),(c=(a=this.errorPredictionAI).learn)==null?void 0:c.call(a,e,t),(d=(l=this.learningStyleAI).learn)==null?void 0:d.call(l,e,t),(p=(h=this.linguisticAI).learn)==null?void 0:p.call(h,e,t),(m=(f=this.contextualAI).learn)==null?void 0:m.call(f,e,t),(x=(g=this.gamificationAI).learn)==null?void 0:x.call(g,e,t)]),this.config.debugMode&&console.log("‚úÖ [AICoordinator] learn() completed",{word:e.word,outcome:t})}catch(y){console.warn("‚ö†Ô∏è [AICoordinator] learn() partial failure",y)}}async analyzeAndCoordinate(e,t){const[s,r,o,i,a,c,l]=await Promise.all([Promise.resolve(this.memoryAI.analyze(e)),Promise.resolve(this.cognitiveLoadAI.analyze(e)),Promise.resolve(this.errorPredictionAI.analyze(e)),Promise.resolve(this.learningStyleAI.analyze(e)),Promise.resolve(this.linguisticAI.analyze(e)),Promise.resolve(this.contextualAI.analyze(e)),Promise.resolve(this.gamificationAI.analyze(e))]);this.memoryAI.validateSignal(s)||console.warn("‚ùå Invalid MemorySignal"),this.cognitiveLoadAI.validateSignal(r)||console.warn("‚ùå Invalid CognitiveLoadSignal");const d=this.checkEmergencyConditions(s,r,e.sessionStats),h=this.calculateFinalPriority(t,s,r,o,i,a,c,l),p=this.generateRecommendedAction(s,r,l),f=this.config.debugMode?this.generateDebugInfo(t,h,s,r,o):void 0;return{finalPriority:d?.1:h,signals:{memory:s,cognitiveLoad:r,errorPrediction:o,learningStyle:i,linguistic:a,contextual:c,gamification:l},urgentFlag:d,recommendedAction:p,debug:f}}checkEmergencyConditions(e,t,s){return!!(e.forgettingRisk>=this.config.emergencyThresholds.forgettingRisk||this.config.emergencyThresholds.cognitiveOverload&&t.loadLevel==="overload"||s.consecutiveIncorrect>=this.config.emergencyThresholds.consecutiveErrors)}calculateFinalPriority(e,t,s,r,o,i,a,c){let l=e;return l*=1-t.timeBoost*this.config.weights.memory,l*=1+s.difficultyAdjustment*this.config.weights.cognitiveLoad,r.weaknessAreas.length>0&&(l*=1-r.patternConfidence*.3*this.config.weights.errorPrediction),l*=1+i.inherentDifficulty*.2*this.config.weights.linguistic,l*=1-(a.contextRelevance-.5)*.3*this.config.weights.contextual,c.motivationLevel<.3&&(l*=1-.2*this.config.weights.gamification),Math.max(.1,Math.min(l,10))}generateRecommendedAction(e,t,s){if(t.recommendedBreak)return"‰ºëÊÜ©„ÇíÂèñ„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ5-10ÂàÜ„ÅÆ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";if(s.rewardTiming)return`üéâ ${s.socialFeedback}`;if(e.forgettingRisk>=100)return"Âæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇË®òÊÜ∂„ÅåËñÑ„Çå„ÇãÂâç„Å´Á¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}generateDebugInfo(e,t,s,r,o){const i={timeBoost:-s.timeBoost*this.config.weights.memory,difficultyAdjustment:r.difficultyAdjustment*this.config.weights.cognitiveLoad,weaknessPenalty:o.weaknessAreas.length>0?-o.patternConfidence*.3*this.config.weights.errorPrediction:0},a=`
      Base Priority: ${e.toFixed(2)}
      Time Boost: ${(i.timeBoost*100).toFixed(1)}%
      Difficulty Adjustment: ${(i.difficultyAdjustment*100).toFixed(1)}%
      Weakness Penalty: ${(i.weaknessPenalty*100).toFixed(1)}%
      Final Priority: ${t.toFixed(2)}
    `.trim();return{basePriority:e,adjustments:i,reasoning:a}}logCoordinationResult(e){}updateConfig(e){this.config={...this.config,...e,weights:{...this.config.weights,...e.weights||{}},emergencyThresholds:{...this.config.emergencyThresholds,...e.emergencyThresholds||{}}}}getConfig(){return{...this.config}}}const GK=[{prefix:"un-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["unhappy","unable","unfair"]},{prefix:"re-",meaning:"ÂÜç„Å≥„ÉªÂÖÉ„Å´",examples:["return","rebuild","review"]},{prefix:"dis-",meaning:"Âê¶ÂÆö„ÉªÂèçÂØæ",examples:["disagree","dislike","disappear"]},{prefix:"in-/im-",meaning:"Âê¶ÂÆö",examples:["impossible","inactive","impolite"]},{prefix:"pre-",meaning:"Ââç„Å´",examples:["preview","predict","prepare"]},{prefix:"post-",meaning:"Âæå„Å´",examples:["postwar","postpone","postgraduate"]},{prefix:"mis-",meaning:"Ë™§„Å£„Å¶",examples:["mistake","misunderstand","mislead"]},{prefix:"over-",meaning:"ÈÅéÂ∫¶„Å´",examples:["overwork","overlook","overcome"]},{prefix:"under-",meaning:"‰∏çË∂≥„Éª‰∏ã„Å´",examples:["understand","underground","underline"]},{prefix:"sub-",meaning:"‰∏ã„Å´„ÉªÂâØ„ÅÆ",examples:["subway","submarine","subtitle"]}],ZN=[{suffix:"-tion/-sion",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁä∂ÊÖã",examples:["action","decision","confusion"]},{suffix:"-ment",pos:"noun",meaning:"Âãï‰Ωú„ÉªÁµêÊûú",examples:["development","movement","agreement"]},{suffix:"-ness",pos:"noun",meaning:"ÊÄßË≥™„ÉªÁä∂ÊÖã",examples:["happiness","kindness","darkness"]},{suffix:"-ly",pos:"adverb",meaning:"ÊßòÊÖã",examples:["quickly","slowly","carefully"]},{suffix:"-ful",pos:"adjective",meaning:"ÔΩû„Å´Ê∫Ä„Å°„Åü",examples:["beautiful","careful","wonderful"]},{suffix:"-less",pos:"adjective",meaning:"ÔΩû„ÅÆ„Å™„ÅÑ",examples:["hopeless","careless","endless"]},{suffix:"-able/-ible",pos:"adjective",meaning:"ÔΩû„Åß„Åç„Çã",examples:["readable","possible","comfortable"]},{suffix:"-er/-or",pos:"noun",meaning:"‰∫∫„Éª„ÇÇ„ÅÆ",examples:["teacher","actor","writer"]},{suffix:"-ist",pos:"noun",meaning:"ÔΩû„Åô„Çã‰∫∫",examples:["artist","scientist","pianist"]},{suffix:"-ize",pos:"verb",meaning:"ÔΩûÂåñ„Åô„Çã",examples:["realize","organize","modernize"]},{suffix:"-ing",pos:"noun/adjective",meaning:"ÂãïÂêçË©û„ÉªÁèæÂú®ÂàÜË©û",examples:["running","interesting","learning"]},{suffix:"-ed",pos:"adjective",meaning:"ÈÅéÂéªÂàÜË©û„ÉªÂΩ¢ÂÆπË©û",examples:["tired","excited","surprised"]}],HK=[{root:"act",meaning:"Ë°åÂãï",words:["action","react","actor","activity","actual"]},{root:"struct",meaning:"Âª∫„Å¶„Çã",words:["structure","construct","destruction","instruct"]},{root:"dict",meaning:"Ë®Ä„ÅÜ",words:["dictionary","predict","contradict","dictate"]},{root:"port",meaning:"ÈÅã„Å∂",words:["transport","import","export","portable","report"]},{root:"duct",meaning:"Â∞é„Åè",words:["conduct","produce","reduce","introduce"]},{root:"scrib/script",meaning:"Êõ∏„Åè",words:["describe","script","prescription","manuscript"]},{root:"spect",meaning:"Ë¶ã„Çã",words:["inspect","respect","expect","spectator"]},{root:"form",meaning:"ÂΩ¢",words:["reform","inform","transform","uniform"]},{root:"ject",meaning:"Êäï„Åí„Çã",words:["project","reject","subject","object"]},{root:"miss/mit",meaning:"ÈÄÅ„Çã",words:["mission","permit","submit","transmit"]}];function qK(n){const e=n.toLowerCase();return["in the","at the","on the","to the","for the","with the","by the"].some(r=>e.startsWith(r))?"preposition_phrase":["take a","make a","have a","get a","give a","do a"].some(r=>e.startsWith(r))?"verb_phrase":n.includes(" ")?"idiom":"none"}function eI(n){const e=n.toLowerCase();for(const{prefix:t}of GK){const s=t.replace(/-/g,""),r=[s];(s==="in"||s==="im")&&r.push("in","im","il","ir");for(const o of r)if(e.startsWith(o)&&n.length>o.length+2)return o}}function tI(n){const e=n.toLowerCase();for(const{suffix:t}of ZN){const s=t.split("/")[0].replace(/-/g,"");if(e.endsWith(s)&&n.length>s.length+2)return s}}function KK(n){const e=n.toLowerCase();for(const{root:o,words:i}of HK)if(i.some(a=>a===e)||e.includes(o))return o;let t=e;const s=eI(n);s&&(t=t.substring(s.length));const r=tI(n);if(r&&(t=t.substring(0,t.length-r.length)),!(t.length<3))return t!==e?t:void 0}function XK(n,e){const t=n.toLowerCase();if(n.includes(" "))return"phrase";for(const{suffix:s,pos:r}of ZN){const o=s.split("/")[0].replace(/-/g,"");if(t.endsWith(o))return r.split("/")[0]}if(e){if(e.includes("„Åô„Çã")||e.includes("„Åï„Çå„Çã"))return"verb";if(e.includes("ÁöÑ„Å™")||e.includes("„ÅÑÔºàÂΩ¢ÂÆπË©ûË™ûÂ∞æÔºâ"))return"adjective";if(e.includes("„Å´")||e.includes("„ÅßÔºàÂâØË©ûÔºâ"))return"adverb"}return"other"}function QK(n,e){const t=eI(n),s=tI(n),r=KK(n),o=t||s||r?{prefix:t,suffix:s,root:r}:void 0,i=XK(n,e),a=qK(n);return{word:n,family:o,pos:i,phrasePattern:a!=="none"?a:void 0}}class YK{constructor(){Ee(this,"cache",new Map);Ee(this,"ttl",24*60*60*1e3)}getMetadata(e,t){const s=this.getCacheKey(e,t),r=this.cache.get(s);if(r&&Date.now()-r.timestamp<this.ttl)return r.metadata;const o=QK(e,t);return this.cache.set(s,{word:e,metadata:o,timestamp:Date.now()}),o}getMetadataFromQuestion(e){return this.getMetadata(e.word,e.meaning)}getBulkMetadata(e){const t=new Map;return e.forEach(s=>{t.set(s,this.getMetadata(s))}),t}getBulkMetadataFromQuestions(e){const t=new Map;return e.forEach(s=>{t.set(s.word,this.getMetadataFromQuestion(s))}),t}clear(){this.cache.clear()}purgeExpired(){const e=Date.now();let t=0;for(const[s,r]of this.cache.entries())e-r.timestamp>=this.ttl&&(this.cache.delete(s),t++);return t}getStats(){const e=Date.now();let t=0,s=1/0;for(const r of this.cache.values()){const o=e-r.timestamp;o>t&&(t=o),o<s&&(s=o)}return{size:this.cache.size,ttl:this.ttl,oldestEntryAge:t,newestEntryAge:s===1/0?0:s}}getCacheKey(e,t){return t?`${e}::${t}`:e}setTTL(e){this.ttl=e}}const nI=new YK;function Sy(n,e){return nI.getMetadata(n,e)}function Cy(n){return nI.getMetadataFromQuestion(n)}const sI={emotions:{name:"ÊÑüÊÉÖ",keywords:["happy","sad","angry","excited","worried","nervous","calm","joy","fear","love","hate","surprise"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},movement:{name:"Âãï‰Ωú„ÉªÁßªÂãï",keywords:["walk","run","jump","fly","swim","climb","move","go","come","enter","leave","return"],relatedCategories:["ÂãïË©û"]},time:{name:"ÊôÇÈñì",keywords:["day","night","morning","evening","week","month","year","today","tomorrow","yesterday","always","never","sometimes"],relatedCategories:["ÂêçË©û","ÂâØË©û"]},weather:{name:"Â§©Ê∞ó",keywords:["sunny","rainy","cloudy","windy","snowy","hot","cold","warm","cool","weather","temperature"],relatedCategories:["ÂΩ¢ÂÆπË©û","ÂêçË©û"]},food:{name:"È£ü„ÅπÁâ©",keywords:["food","eat","drink","cook","meal","breakfast","lunch","dinner","hungry","thirsty","delicious"],relatedCategories:["ÂêçË©û","ÂãïË©û","ÂΩ¢ÂÆπË©û"]},nature:{name:"Ëá™ÁÑ∂",keywords:["tree","flower","mountain","river","sea","sky","sun","moon","star","nature","plant","animal"],relatedCategories:["ÂêçË©û"]},family:{name:"ÂÆ∂Êóè„Éª‰∫∫ÈñìÈñ¢‰øÇ",keywords:["family","father","mother","brother","sister","parent","child","friend","teacher","student"],relatedCategories:["ÂêçË©û"]},size:{name:"Â§ß„Åç„Åï„ÉªÁ®ãÂ∫¶",keywords:["big","small","large","tiny","huge","long","short","tall","high","low","wide","narrow"],relatedCategories:["ÂΩ¢ÂÆπË©û"]},communication:{name:"„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥",keywords:["say","speak","talk","tell","ask","answer","listen","hear","write","read","call","email"],relatedCategories:["ÂãïË©û"]},learning:{name:"Â≠¶Áøí",keywords:["learn","study","teach","understand","know","remember","forget","practice","improve","test","exam"],relatedCategories:["ÂãïË©û","ÂêçË©û"]}},rI=[["big","small"],["large","small"],["long","short"],["tall","short"],["high","low"],["wide","narrow"],["deep","shallow"],["heavy","light"],["strong","weak"],["hard","soft"],["hot","cold"],["warm","cool"],["fast","slow"],["quick","slow"],["early","late"],["young","old"],["new","old"],["happy","sad"],["good","bad"],["right","wrong"],["easy","difficult"],["simple","complex"],["start","end"],["begin","finish"],["open","close"],["love","hate"],["day","night"],["morning","evening"],["always","never"],["often","rarely"],["many","few"],["much","little"],["more","less"],["increase","decrease"],["rise","fall"],["up","down"],["front","back"],["before","after"],["first","last"],["enter","leave"],["come","go"],["push","pull"],["give","take"],["buy","sell"],["win","lose"],["remember","forget"],["find","lose"]],oI=[["big","large","huge","enormous"],["small","little","tiny"],["happy","glad","joyful","pleased"],["sad","unhappy","sorrowful"],["angry","mad","furious"],["beautiful","pretty","lovely"],["ugly","unattractive"],["important","significant","essential"],["difficult","hard","tough","challenging"],["easy","simple"],["fast","quick","rapid","swift"],["slow","sluggish"],["smart","intelligent","clever","bright"],["stupid","foolish","dumb"],["funny","amusing","humorous"],["boring","dull","tedious"],["interesting","fascinating","engaging"],["tired","exhausted","weary"],["afraid","scared","frightened","terrified"],["brave","courageous","bold"],["kind","nice","gentle","friendly"],["mean","cruel","unkind"],["rich","wealthy","affluent"],["poor","needy"],["famous","well-known","renowned"],["strange","odd","weird","unusual"],["normal","ordinary","common","typical"]];function JK(n,e){const t=[],s=new Set;Object.entries(sI).forEach(([o,i])=>{const a=n.filter(c=>{const l=c.word.toLowerCase(),d=c.meaning.toLowerCase();return i.keywords.some(h=>l.includes(h)||d.includes(h))&&!s.has(c.word)}).map(c=>c.word);if(a.length>=2){a.forEach(d=>s.add(d));const l=50+a.filter(d=>{const h=e[d];return h&&h.incorrectCount>h.correctCount}).length/a.length*50;t.push({id:`theme_${o}`,name:i.name,theme:o,words:a,relationType:"theme",priority:l})}}),rI.forEach((o,i)=>{const[a,c]=o,l=n.filter(d=>{const h=d.word.toLowerCase();return(h===a||h===c)&&!s.has(d.word)}).map(d=>d.word);l.length===2&&(l.forEach(d=>s.add(d)),t.push({id:`antonym_${i}`,name:`ÂØæÁæ©Ë™û: ${a} ‚áî ${c}`,theme:"antonyms",words:l,relationType:"antonym",priority:70}))}),oI.forEach((o,i)=>{const a=n.filter(c=>{const l=c.word.toLowerCase();return o.includes(l)&&!s.has(c.word)}).map(c=>c.word);a.length>=2&&(a.forEach(c=>s.add(c)),t.push({id:`synonym_${i}`,name:`È°ûÁæ©Ë™û: ${o.join(", ")}`,theme:"synonyms",words:a,relationType:"synonym",priority:60}))});const r=new Map;return n.forEach(o=>{if(!s.has(o.word)&&o.category){const i=r.get(o.category)||[];i.push(o.word),r.set(o.category,i)}}),r.forEach((o,i)=>{o.length>=3&&(o.forEach(a=>s.add(a)),t.push({id:`category_${i}`,name:`„Ç´„ÉÜ„Ç¥„É™„Éº: ${i}`,theme:i,words:o,relationType:"category",priority:40}))}),t.sort((o,i)=>i.priority-o.priority)}function ZK(n,e,t,s){var c,l,d,h,p,f;const r=n.toLowerCase(),o=e.toLowerCase(),i=t?Cy(t):Sy(n),a=s?Cy(s):Sy(e);if((c=i.family)!=null&&c.root&&((l=a.family)!=null&&l.root)&&i.family.root===a.family.root)return{word1:n,word2:e,relationType:"word_family",strength:.95,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòË™ûÊ†πÔºà${i.family.root}Ôºâ`};if((d=i.family)!=null&&d.prefix&&((h=a.family)!=null&&h.prefix)&&i.family.prefix===a.family.prefix)return{word1:n,word2:e,relationType:"word_family",strength:.7,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•È†≠ËæûÔºà${i.family.prefix}-Ôºâ`};if((p=i.family)!=null&&p.suffix&&((f=a.family)!=null&&f.suffix)&&i.family.suffix===a.family.suffix&&i.pos===a.pos)return{word1:n,word2:e,relationType:"word_family",strength:.65,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÊé•Â∞æËæûÔºà-${i.family.suffix}Ôºâ`};if(i.phrasePattern&&a.phrasePattern&&i.phrasePattern===a.phrasePattern&&i.phrasePattern!=="none")return{word1:n,word2:e,relationType:"collocation",strength:.75,description:`"${n}"„Å®"${e}"„ÅØÂêå„ÅòÁÜüË™û„Éë„Çø„Éº„É≥`};for(const m of rI)if(m[0]===r&&m[1]===o||m[0]===o&&m[1]===r)return{word1:n,word2:e,relationType:"antonym",strength:.9,description:`"${n}"„Å®"${e}"„ÅØÂØæÁæ©Ë™û`};for(const m of oI)if(m.includes(r)&&m.includes(o))return{word1:n,word2:e,relationType:"synonym",strength:.8,description:`"${n}"„Å®"${e}"„ÅØÈ°ûÁæ©Ë™û`};for(const[,m]of Object.entries(sI)){const g=m.keywords.some(y=>r.includes(y)||y.includes(r)),x=m.keywords.some(y=>o.includes(y)||y.includes(o));if(g&&x)return{word1:n,word2:e,relationType:"theme",strength:.6,description:`"${n}"„Å®"${e}"„ÅØÂêå„Åò„ÉÜ„Éº„ÉûÔºà${m.name}Ôºâ`}}return null}function iI(n,e,t=[]){const s=JK(n,e),r=[],o=[],i=new Set;return t.forEach(a=>i.add(a)),s.forEach(a=>{const c=a.words.filter(d=>!i.has(d));if(c.length===0)return;c.sort((d,h)=>{const p=e[d],f=e[h];if(!p&&!f)return 0;if(!p)return-1;if(!f)return 1;const m=p.incorrectCount/(p.correctCount+p.incorrectCount||1);return f.incorrectCount/(f.correctCount+f.incorrectCount||1)-m}).forEach(d=>{if(i.has(d))return;const h=r[r.length-1];if(h){const p=n.find(g=>g.word===h),f=n.find(g=>g.word===d),m=ZK(h,d,p,f);o.push({from:h,to:d,reason:m?m.description:`Âêå„Åò„ÇØ„É©„Çπ„Çø„ÉºÔºà${a.name}Ôºâ`})}r.push(d),i.add(d)})}),n.forEach(a=>{i.has(a.word)||(r.push(a.word),i.add(a.word))}),{clusters:s,sequence:r,transitions:o}}function eX(n){switch(n){case"incorrect":return!0;default:return!1}}function aI(n){switch(n){case"incorrect":case"still_learning":return!0;default:return!1}}class Fu{static startTrace(e="weak-words-flow"){return""}static startSpan(e,t,s){return""}static endSpan(e,t){}static addEvent(e,t,s){}static endTrace(){return""}static detectLostWords(e){if(e.length===0)return[];const t=[],s=new Map;for(const r of e){const o=r.attributes.weakWords||[];for(const i of o)s.set(i,{span:r.name,count:r.attributes.weakWordsCount})}if(e.length>=2){const r=new Set(e[0].attributes.weakWords||[]),o=new Set(e[e.length-1].attributes.weakWords||[]);for(const i of r)if(!o.has(i)){const a=s.get(i);a&&t.push({word:i,lastSeenSpan:a.span,lastSeenCount:a.count})}}return t}static generateSummary(e){if(!this.currentContext)return"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó";const t=Array.from(this.currentContext.spans.values()).sort((l,d)=>l.startTime-d.startTime);if(t.length===0)return"„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó";let s="";try{const l=localStorage.getItem("debug_ab_session_info");if(l){const d=JSON.parse(l);s+=`## üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±

`,s+=`**ÁèæÂú®„ÅÆVariant**: ${d.variant}
`,s+=`- **A**: ÈÄöÂ∏∏„É¢„Éº„ÉâÔºàcalculatePrioritiesÔºâ
`,s+=`- **B**: „Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„ÉâÔºàPosition‰∏ªËª∏+AIÂ∞èË£úÊ≠£Ôºâ
`,s+=`- **C**: AI‰∏ªËª∏„É¢„Éº„ÉâÔºàfinalPriorityMode„ÄÅGamificationAI„Éñ„Éº„Çπ„ÉàÔºâ

`,d.variant==="A"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant A„Åß„Åô„ÄÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„ÅØÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):d.variant==="B"?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: ÁèæÂú®„ÅØVariant B„Åß„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅØÈÉ®ÂàÜÁöÑ„Å´„Åó„ÅãÈÅ©Áî®„Åï„Çå„Åæ„Åõ„Çì„ÄÇ
`,s+=`‚Üí Variant C„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Å´„ÅØ„ÄÅLocalStorage„Çí„ÇØ„É™„Ç¢„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà3ÂàÜ„ÅÆ1„ÅÆÁ¢∫Áéá„ÅßVariant C„Å´„Å™„Çä„Åæ„ÅôÔºâ„ÄÇ

`):d.variant==="C"&&(s+=`‚úÖ **Ê≠£Â∏∏**: Variant C„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇGamificationAI„Éñ„Éº„Çπ„Éà„ÅåÊúâÂäπ„Åß„Åô„ÄÇ

`)}}catch{}s+=`## üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ

`,s+=`| „Çπ„Éë„É≥ | ÈñãÂßãÊôÇÂàª | ÊâÄË¶ÅÊôÇÈñì | „Åæ„Å†„Åæ„Å†Ë™û | Á∑èÂçòË™ûÊï∞ | Áä∂ÊÖã |
`,s+=`|---|---|---|---|---|---|
`;const r=30,o=t.length>r?t.slice(-r):t;t.length>r&&(s+=`> ‚ÑπÔ∏è „Çπ„Éë„É≥„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂÖ®${t.length}‰ª∂‰∏≠„ÄÅÊú´Â∞æ${r}‰ª∂„ÅÆ„ÅøË°®Á§∫„Åó„Åæ„Åô

`);let i=-1;for(const l of o){const d=l.endTime?`${(l.endTime-l.startTime).toFixed(2)}ms`:"ÂÆüË°å‰∏≠",h=new Date(Date.now()-performance.now()+l.startTime).toISOString().split("T")[1],p=l.attributes.weakWordsCount??l.attributes.weakWordsCountAfter??0,f=l.attributes.totalCount??l.attributes.totalCountAfter??0;let m="‚úÖ Ê≠£Â∏∏",g="";if(i!==-1){const x=p-i;p===0&&i>0?(m="‚ùå Ê∂àÂ§±",g=` (-${i}Ë™û)`):x<0?(m="‚ö†Ô∏è Ê∏õÂ∞ë",g=` (${x}Ë™û)`):x>0&&(m="üìà Â¢óÂä†",g=` (+${x}Ë™û)`)}i=p,s+=`| ${l.name} | ${h} | ${d} | ${p}Ë™û${g} | ${f}Ë™û | ${m} |
`}const a=t.find(l=>l.name==="MemorizationView.prepareScheduling");if(a){const l=a.attributes.weakWordsCount??0,d=a.attributes.weakWordsCountAfter??0,h=a.attributes.totalCount??0,p=a.attributes.totalCountAfter??0;if(s+=`
### üìä „Çπ„Ç±„Ç∏„É•„Éº„É´ÂâçÂæå„ÅÆÊØîËºÉ

`,s+=`**MemorizationView.prepareScheduling**:
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Ââç: ${l}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${h}Ë™û„ÅÆÂÄôË£ú
`,s+=`- „Çπ„Ç±„Ç∏„É•„Éº„É´Âæå: ${d}Ë™û„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û / ${p}Ë™û„ÅÆÁµêÊûú
`,l>d){const y=l-d,b=(y/l*100).toFixed(1);s+=`- **Â§âÂåñ**: ${y}Ë™ûÊ∏õÂ∞ëÔºà${b}%Ê∂àÂ§±Ôºâ ‚ö†Ô∏è
`}else if(l<d){const y=d-l;s+=`- **Â§âÂåñ**: ${y}Ë™ûÂ¢óÂä† üìà
`}else s+=`- **Â§âÂåñ**: Â§âÂåñ„Å™„Åó ‚úÖ
`;const f=new Set(a.attributes.weakWords||[]),m=new Set(a.attributes.weakWordsAfter||[]),g=[...f].filter(y=>!m.has(y)),x=[...m].filter(y=>!f.has(y));g.length>0&&(s+=`
**Ê∂àÂ§±„Åó„ÅüÂçòË™ûÔºà${g.length}Ë™ûÔºâ**:
`,s+=`- ${g.slice(0,10).join(", ")}`,g.length>10&&(s+=` (+${g.length-10}Ë™û)`),s+=`
`),x.length>0&&(s+=`
**Êñ∞„Åü„Å´ËøΩÂä†„Åï„Çå„ÅüÂçòË™ûÔºà${x.length}Ë™ûÔºâ**:
`,s+=`- ${x.slice(0,10).join(", ")}`,x.length>10&&(s+=` (+${x.length-10}Ë™û)`),s+=`
`)}const c=this.detectLostWords(t);c.length>0?(s+=`
### ‚ùå Ê∂àÂ§±„Åó„ÅüÂçòË™û

`,c.slice(0,10).forEach(l=>{s+=`- **${l.word}**: ÊúÄÂæå„Å´Á¢∫Ë™ç ‚Üí ${l.lastSeenSpan}
`}),c.length>10&&(s+=`
_...‰ªñ${c.length-10}Ë™û_
`)):s+=`
### ‚úÖ Ê∂àÂ§±„Åó„ÅüÂçòË™û„Å™„Åó

`,s+=`
### üìä „Çπ„Éë„É≥„Åî„Å®„ÅÆÂçòË™û„É™„Çπ„ÉàÂ§âÂåñ

`;for(const l of t){const d=l.attributes.weakWords||[];if(d.length>0){const h=d.slice(0,5).join(", "),p=d.length>5?` (+${d.length-5}Ë™û)`:"";s+=`- **${l.name}**: ${d.length}Ë™û ‚Üí [${h}${p}]
`}else s+=`- **${l.name}**: 0Ë™û
`}if(c.length>0){s+=`
### üîç Ê∂àÂ§±„ÅÆË©≥Á¥∞ÂàÜÊûê

`,s+=`**Á∑èÊ∂àÂ§±Êï∞**: ${c.length}Ë™û

`;for(let l=0;l<t.length-1;l++){const d=new Set(t[l].attributes.weakWords||t[l].attributes.weakWordsAfter||[]),h=new Set(t[l+1].attributes.weakWords||[]),p=[...d].filter(m=>!h.has(m)),f=[...h].filter(m=>!d.has(m));if(p.length>0||f.length>0){const m=d.size,g=h.size,x=g-m,y=m>0?(Math.abs(x)/m*100).toFixed(1):"0.0";s+=`
**${t[l].name} ‚Üí ${t[l+1].name}**:
`,s+=`- ÂçòË™ûÊï∞Â§âÂåñ: ${m}Ë™û ‚Üí ${g}Ë™û`,x<0?s+=` (${x}Ë™û„ÄÅ-${y}%) ‚ö†Ô∏è`:x>0&&(s+=` (+${x}Ë™û„ÄÅ+${y}%) üìà`),s+=`
`,p.length>0&&(s+=`- Ê∂àÂ§±Ôºà${p.length}Ë™ûÔºâ: ${p.slice(0,5).join(", ")}`,p.length>5&&(s+=` (+${p.length-5}Ë™û)`),s+=`
`),f.length>0&&(s+=`- ËøΩÂä†Ôºà${f.length}Ë™ûÔºâ: ${f.slice(0,5).join(", ")}`,f.length>5&&(s+=` (+${f.length-5}Ë™û)`),s+=`
`)}}}try{const l=su("debug_finalPriority_output",{mode:e}).raw,d=su("debug_finalPriority_sessionStats",{mode:e}).raw;if(l&&d){const h=JSON.parse(l),p=JSON.parse(d);s+=`
### üß† finalPriority„É¢„Éº„ÉâÔºàAI‰∏ªËª∏Ôºâ„ÅÆË©≥Á¥∞

`,s+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊÉÖÂ†±**:
`,s+=`- „Çø„Éñ: ${p.currentTab}
`,s+=`- Á∑èÂïèÈ°åÊï∞: ${p.totalQuestions}Âïè
`,s+=`- ÈÄ≤Êçó„Éá„Éº„Çø: ${p.allProgressCount}Ë™û
`,s+=`- „Çø„Ç§„É†„Çπ„Çø„É≥„Éó: ${p.timestamp}

`,s+=`**TOP10„ÅÆÂïèÈ°åÔºàfinalPriorityÈôçÈ†ÜÔºâ**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | finalPriority | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|---|
`,h.slice(0,10).forEach(m=>{const g=m.position>=70?"üî¥":m.position>=40?"üü°":m.position>=20?"‚ö™":"‚úÖ";s+=`| ${m.rank} | **${m.word}** | ${m.position} ${g} | ${m.finalPriority.toFixed(3)} | ${m.category||"-"} | ${m.attempts}Âõû |
`});const f=h.filter(m=>m.position>=40&&m.attempts>0);s+=`
**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞**:
`,s+=`- TOP10„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${f.slice(0,10).length}Ë™û
`,s+=`- TOP30„Å´Âê´„Åæ„Çå„Çã„Åæ„Å†„Åæ„Å†Ë™û: ${f.length}Ë™û
`,f.length>0?(s+=`
**„Åæ„Å†„Åæ„Å†Ë™ûTOP5**:
`,f.slice(0,5).forEach(m=>{s+=`- **${m.word}** („É©„É≥„ÇØ${m.rank}, Position ${m.position}, finalPriority ${m.finalPriority.toFixed(3)})
`})):(s+=`
‚ö†Ô∏è **Ë≠¶Âëä**: TOP30„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,s+=`‚Üí GamificationAI„ÅÆ„Éñ„Éº„Çπ„ÉàÂá¶ÁêÜ„ÅåÈÅ©Áî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`)}else s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì

`,s+=`finalPriorityMode„Åå‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÄÅ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`}catch(l){s+=`
### ‚ö†Ô∏è finalPriority„É¢„Éº„Éâ„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${l}
`}try{const l=su("debug_postProcess_output",{mode:e}).raw,d=localStorage.getItem("debug_sortAndBalance_output");if(l||d){if(s+=`
### üîç sortAndBalance ‚Üí postProcess „ÅÆÈ†ÜÂ∫èÊ§úË®º

`,d){const h=JSON.parse(d);s+=`**sortAndBalanceÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | „Ç´„ÉÜ„Ç¥„É™ | Âá∫È°åÂõûÊï∞ |
`,s+=`|---|---|---|---|---|
`,h.slice(0,10).forEach((f,m)=>{const g=f.position>=70?"üî¥":f.position>=60?"üü°":f.position>=40?"üîµ":f.position>=20?"‚ö™":"‚úÖ";s+=`| ${m+1} | **${f.word}** | ${f.position} ${g} | ${f.category||"-"} | ${f.attempts}Âõû |
`});const p={incorrect:h.filter(f=>f.position>=70).length,stillLearning:h.filter(f=>f.position>=60&&f.position<70&&f.attempts>0).length,newBoosted:h.filter(f=>f.position>=40&&f.position<60&&f.attempts===0).length,newNormal:h.filter(f=>f.position>=20&&f.position<40).length,mastered:h.filter(f=>f.position<20).length};s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${p.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å† (Position 60-69, attempts>0): ${p.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà (Position 40-59, attempts=0): ${p.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏ (Position 20-39): ${p.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à (Position <20): ${p.mastered}Ë™û

`}if(l){const h=JSON.parse(l),f=(Array.isArray(h)?h:Array.isArray(h==null?void 0:h.top30)?h.top30:[]).slice(0,30).map((g,x)=>({rank:Number(g==null?void 0:g.rank)||x+1,word:String((g==null?void 0:g.word)??""),position:Number((g==null?void 0:g.position)??0),attempts:Number((g==null?void 0:g.attempts)??0)})),m={incorrect:f.filter(g=>g.position>=70).length,stillLearning:f.filter(g=>g.position>=60&&g.position<70&&g.attempts>0).length,newBoosted:f.filter(g=>g.position>=40&&g.position<60&&g.attempts===0).length,newNormal:f.filter(g=>g.position>=20&&g.position<40).length,mastered:f.filter(g=>g.position<20).length};if(s+=`**postProcessÂæå„ÅÆTOP10**:

`,s+=`| „É©„É≥„ÇØ | ÂçòË™û | Position | Áä∂ÊÖã |
`,s+=`|---|---|---|---|
`,f.slice(0,10).forEach(g=>{const x=g.position>=70?"üî¥":g.position>=60?"üü°":g.position>=40?"üîµ":g.position>=20?"‚ö™":"‚úÖ",y=g.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":g.position>=60?"„Åæ„Å†„Åæ„Å†":g.position>=40?"Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà":g.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";s+=`| ${g.rank} | **${g.word}** | ${g.position} ${x} | ${y} |
`}),s+=`
**PositionÂàÜÂ∏ÉÔºàTOP30Ôºâ**:
`,s+=`- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${m.incorrect}Ë™û
`,s+=`- üü° „Åæ„Å†„Åæ„Å†: ${m.stillLearning}Ë™û
`,s+=`- üîµ Êñ∞Ë¶è„Éñ„Éº„Çπ„Éà: ${m.newBoosted}Ë™û
`,s+=`- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏: ${m.newNormal}Ë™û
`,s+=`- ‚úÖ ÂÆöÁùÄÊ∏à: ${m.mastered}Ë™û

`,d){const x=JSON.parse(d).slice(0,10).map(v=>v.word),y=f.slice(0,10).map(v=>v.word);x.some((v,w)=>v!==y[w])?(s+=`‚ö†Ô∏è **Ë≠¶Âëä**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„ÅåÂ§â„Çè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`,s+=`‚Üí postProcess()„ÅÆÈñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„ÅåPositionÈöéÂ±§„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

`):s+=`‚úÖ **È†ÜÂ∫è‰øùÊåÅ**: sortAndBalance„Å®postProcess„ÅßTOP10„ÅÆÈ†ÜÂ∫è„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

`}}else s+=`‚ö†Ô∏è postProcessÂæå„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
`}}catch(l){s+=`
### ‚ö†Ô∏è postProcessÊÉÖÂ†±„ÅÆË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº

`,s+=`„Ç®„É©„Éº: ${l}
`}return s}static saveContext(){if(this.currentContext)try{const e={traceId:this.currentContext.traceId,spans:Array.from(this.currentContext.spans.entries()),activeSpanId:this.currentContext.activeSpanId};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch{}}static restoreContext(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;const t=JSON.parse(e);return this.currentContext={traceId:t.traceId,spans:new Map(t.spans),activeSpanId:t.activeSpanId},this.currentContext}catch{return null}}static clearTrace(){this.currentContext=null;try{localStorage.removeItem(this.STORAGE_KEY)}catch{}}}Ee(Fu,"STORAGE_KEY","debug_trace_context"),Ee(Fu,"currentContext",null);class Pl{constructor(){Ee(this,"antiVibration");Ee(this,"recentAnswersCache",new Map);Ee(this,"aiCoordinator",null);Ee(this,"useAICoordinator",!1);Ee(this,"incorrectSkipQueue",[]);Ee(this,"skipCounter",0);Ee(this,"skipTarget",0);this.antiVibration=new xk}getRandomSkipCount(){const e=Math.random();return e<.4?2:e<.7?3:e<.9?4:5}enableAICoordination(e=!0){this.useAICoordinator=e,e&&!this.aiCoordinator&&(this.aiCoordinator=new UK({debugMode:!1}))}async schedule(e){const t=performance.now(),s={timestamp:new Date().toISOString(),mode:e.mode,questionCount:e.questions.length,useMetaAI:e.useMetaAI,hybridMode:e.hybridMode||!1,firstQuestions:e.questions.slice(0,10).map(f=>f.word)};try{const f=JSON.parse(localStorage.getItem("debug_scheduler_calls")||"[]");f.push(s),f.length>10&&f.shift(),localStorage.setItem("debug_scheduler_calls",JSON.stringify(f))}catch{}if(this.skipCounter>=this.skipTarget&&this.incorrectSkipQueue.length>0){const f=this.incorrectSkipQueue.shift();this.skipCounter=0,this.skipTarget=0;const m=e.questions.filter(g=>g.word!==f.question.word);return this.schedule({...e,questions:[f.question,...m]})}if(this.skipTarget>0&&this.skipCounter++,e.hybridMode)return this.scheduleHybridMode(e,t);if(e.finalPriorityMode)return this.scheduleFinalPriorityMode(e,t);const r=this.buildContext(e),o=e.useMetaAI?this.detectSignals(r):[],i=this.calculatePriorities(e.questions,r,o,!1),a=this.applyAntiVibration(i,r),c=this.sortAndBalance(a,e,r),l=this.postProcess(c,r);try{const f=l.slice(0,30).map((g,x)=>{var b,v;const y=c.find(w=>w.question.word===g.word);return{word:g.word,position:(y==null?void 0:y.position)||0,category:(b=y==null?void 0:y.status)==null?void 0:b.category,attempts:((v=y==null?void 0:y.status)==null?void 0:v.attempts)||0}}),m={timestamp:new Date().toISOString(),mode:r.mode,source:"schedule",top30:f};Fi("debug_postProcess_output",m,{mode:r.mode})}catch{}const d=this.antiVibration.calculateVibrationScore(c,r.recentAnswers,20),h=performance.now()-t,p={top10Words:l.slice(0,10).map(f=>f.word),top10Positions:c.slice(0,10).map(f=>({word:f.question.word,position:f.position}))};_.info("[QuestionScheduler] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(h)+"ms",vibrationScore:d,signalCount:o.length,resultDebug:p});try{const f=JSON.parse(localStorage.getItem("debug_scheduler_results")||"[]");f.push({timestamp:new Date().toISOString(),...p}),f.length>10&&f.shift(),localStorage.setItem("debug_scheduler_results",JSON.stringify(f))}catch{}if(c.length>0&&r.recentAnswers.length>0){const f=c[0],m=r.recentAnswers.find(g=>g.word===f.question.word);if(m&&!m.correct&&!this.incorrectSkipQueue.some(x=>x.question.word===f.question.word)){this.incorrectSkipQueue.push(f),this.skipTarget=this.getRandomSkipCount(),this.skipCounter=0;const x=l.slice(1);if(x.length>0)return{scheduledQuestions:x,vibrationScore:d,processingTime:h,signalCount:o.length,debug:{dtaApplied:c.filter(y=>{var b;return(((b=y.status)==null?void 0:b.position)??50)<20}).length,antiVibrationApplied:c.filter(y=>y.antiVibrationApplied).length,signalsDetected:o,randomSkipApplied:!0}}}}return{scheduledQuestions:l,vibrationScore:d,processingTime:h,signalCount:o.length,debug:{dtaApplied:c.filter(f=>{var m;return(((m=f.status)==null?void 0:m.position)??50)<20}).length,antiVibrationApplied:c.filter(f=>f.antiVibrationApplied).length,signalsDetected:o}}}buildContext(e){const s=new Date().getHours(),r=s<12?"morning":s<17?"afternoon":s<21?"evening":"night",o=this.calculateCognitiveLoad(e.sessionStats),i=this.getRecentAnswers(e.mode),a=it(),c={};if(a&&a.wordProgress)for(const l of e.questions){const d=a.wordProgress[l.word];d&&(c[l.word]=d)}return{mode:e.mode,sessionStats:e.sessionStats,recentAnswers:i,timeOfDay:r,cognitiveLoad:o,useMetaAI:e.useMetaAI||!1,isReviewFocusMode:e.isReviewFocusMode||!1,sessionStartTime:Date.now()-(e.sessionStats.duration||0),wordProgress:c}}calculateCognitiveLoad(e){const t=e.correct+e.incorrect>0?e.incorrect/(e.correct+e.incorrect):0,s=(e.duration||0)/6e4,r=Math.min(s/30,1);return Math.min(t*.7+r*.3,1)}getRecentAnswers(e){if(this.recentAnswersCache.has(e))return this.recentAnswersCache.get(e);try{const t=it(),s=[];Object.entries(t.wordProgress||{}).forEach(([o,i])=>{if(i.lastStudied>0){const a=Yr(Ut(i,e));s.push({word:o,correct:!eX(a),timestamp:i.lastStudied,consecutiveCorrect:i.streak||0})}}),s.sort((o,i)=>i.timestamp-o.timestamp);const r=s.slice(0,100);return this.recentAnswersCache.set(e,r),r}catch(t){return _.error("[QuestionScheduler] Ëß£Á≠îÂ±•Ê≠¥„ÅÆÂèñÂæó„Å´Â§±Êïó",t),[]}}detectSignals(e){try{const t=[],s=e.sessionStats,r=s.correct+s.incorrect+s.still_learning,o=r>0?s.incorrect/r:0,i=(s.duration||0)/6e4;if(i>20||e.cognitiveLoad>.7){const c=Math.min(i/30*.5+e.cognitiveLoad*.5,1);t.push({type:"fatigue",confidence:c,action:"easier"}),_.debug(`[Signal] Áñ≤Âä¥Ê§úÂá∫: ${(c*100).toFixed(0)}%`)}if(o>.4&&r>=5){const c=Math.min(o,.9);t.push({type:"struggling",confidence:c,action:"review"}),_.debug(`[Signal] Ëã¶Êà¶Ê§úÂá∫: ${(c*100).toFixed(0)}% („Ç®„É©„ÉºÁéá${(o*100).toFixed(0)}%)`)}const a=s.consecutiveCorrect||0;if(a>10){const c=Math.min(a/15,.9);t.push({type:"overlearning",confidence:c,action:"harder"}),_.debug(`[Signal] ÈÅéÂ≠¶ÁøíÊ§úÂá∫: ${(c*100).toFixed(0)}% (ÈÄ£Á∂ö${a}ÂõûÊ≠£Ëß£)`)}return o>=.2&&o<=.35&&a<8&&(t.push({type:"optimal",confidence:.8,action:"continue"}),_.debug("[Signal] ÊúÄÈÅ©Â≠¶ÁøíÁä∂ÊÖãÊ§úÂá∫")),t.length===0&&_.debug("[Signal] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Å™„Åó - ÈÄöÂ∏∏„É¢„Éº„Éâ"),t}catch(t){return _.error("[QuestionScheduler] „Ç∑„Ç∞„Éä„É´Ê§úÂá∫„Ç®„É©„Éº",t),[]}}calculatePriorities(e,t,s,r=!1){this.recordFunctionCall("calculatePriorities",{questionsCount:e.length,hybridMode:r});const o=this.loadProgressCache(),i=this.calculateDifficultyAdaptation(o),a=e.map((l,d)=>{const h=this.getWordStatusFromCache(l.word,t.mode,o);if(r){const f=d/e.length*100;return{question:l,position:f,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}}let p=(h==null?void 0:h.position)||35;return p=this.applyDifficultyAdaptation(p,l,i),{question:l,position:p,status:h,signals:[],originalIndex:d,attempts:(h==null?void 0:h.attempts)||0}});return this.applyInterleavingAdjustment(a,t.mode,e.length)}applyInterleavingAdjustment(e,t,s){this.recordFunctionCall("applyInterleavingAdjustment",{prioritizedCount:e.length,mode:t,questionsCount:s});const r=new Xa,o={stillLearning:e.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0).length,incorrect:e.filter(x=>x.position>=70).length,new:e.filter(x=>x.position<40).length,boostable:e.filter(x=>x.position>=25&&x.position<40&&(x.attempts??0)===0).length},{result:i,changed:a}=r.boostStillLearningQuestions(e),{result:c,changed:l}=r.adjustPositionForInterleaving(i),d={stillLearning:c.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0).length,incorrect:c.filter(x=>x.position>=70).length,new:c.filter(x=>x.position<40).length,boostable:c.filter(x=>x.position>=25&&x.position<40&&(x.attempts??0)===0).length},h=c.filter(x=>x.position>=40&&x.position<70&&(x.attempts??0)>0&&x.position>=60&&x.position<70).length,p=c.filter(x=>x.position>=40&&(x.attempts??0)===0&&x.position>=40&&x.position<60).length,f=c.filter(x=>{const y=(x.attempts??0)===0,b=(x.attempts??0)>0&&x.position>=40&&x.position<70;return y&&x.position>=60||b&&x.position<60});try{const x={mode:t,questionsCount:s,stillInBoostedZone:h,newInBoostedZone:p,violations:f.map(y=>({word:y.question.word,position:y.position,attempts:y.attempts??0,type:(y.attempts??0)===0?"new_exceeds_60":"still_below_60"})),violationCount:f.length,isValid:f.length===0,timestamp:new Date().toISOString()};localStorage.setItem("debug_position_hierarchy_validation",JSON.stringify(x)),localStorage.setItem(`debug_position_hierarchy_validation_${t}`,JSON.stringify(x))}catch{}try{const x={mode:t,questionsCount:s,timestamp:new Date().toISOString(),before:o,after:d,stillChanged:a,changed:l,summary:{stillBoosted:a.length,newBoosted:l.length,working:a.length>0||l.length>0}};localStorage.setItem("debug_position_interleaving",JSON.stringify(x));const y=`debug_position_interleaving_${t}`;localStorage.setItem(y,JSON.stringify(x));const b=`debug_position_interleaving_history_${t}`;try{const v=localStorage.getItem(b),w=JSON.parse(v||"[]"),S=Array.isArray(w)?w:[];for(S.push(x);S.length>5;)S.shift();localStorage.setItem(b,JSON.stringify(S))}catch{}}catch{}const{result:m,changed:g}=r.boostStillLearningQuestions(c);try{const x={mode:t,questionsCount:s,timestamp:new Date().toISOString(),boosted:g.length,changes:g,working:g.length>0};localStorage.setItem("debug_still_learning_boost",JSON.stringify(x)),localStorage.setItem(`debug_still_learning_boost_${t}`,JSON.stringify(x))}catch{}return m}recordFunctionCall(e,t){try{const s=localStorage.getItem("debug_function_calls"),r=s?JSON.parse(s):[];r.push({timestamp:new Date().toISOString(),function:e,params:t}),r.length>30&&r.shift(),localStorage.setItem("debug_function_calls",JSON.stringify(r))}catch{}}calculateForgettingRisk(e){if(e.lastStudied===0)return 0;const t=(Date.now()-e.lastStudied)/(1e3*60*60*24);let r=(e.reviewInterval>0?t/e.reviewInterval:0)*100;return e.accuracy<50?r*=1.5:e.accuracy>=80&&(r*=.7),Math.round(Math.min(r,200))}applySignals(e,t,s){if(t.length===0)return e;let r=e;for(const o of t)switch(o.type){case"fatigue":e>8&&(r*=1-o.confidence*.2);break;case"struggling":e<2&&(r*=1-o.confidence*.3);break;case"overlearning":e>=3&&e<=5&&(r*=1-o.confidence*.15);break}return r}loadProgressCache(){try{return it()}catch{return null}}getWordStatusFromCache(e,t,s){if(!s||!s.wordProgress)return null;const r=s.wordProgress[e];if(!r)return null;const o=Ut(r,t),i=Yr(o);let a=0,c=0;switch(t){case"memorization":a=r.memorizationAttempts||0,c=r.memorizationCorrect||0;break;case"translation":a=r.translationAttempts||0,c=r.translationCorrect||0;break;case"spelling":a=r.spellingAttempts||0,c=r.spellingCorrect||0;break;case"grammar":a=r.grammarAttempts||0,c=r.grammarCorrect||0;break;default:a=(r.correctCount||0)+(r.incorrectCount||0),c=r.correctCount||0}return{category:i,position:o,lastStudied:r.lastStudied||0,attempts:a,correct:c,streak:r.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1}}getWordStatus(e,t){var s;try{const o=(s=it().wordProgress)==null?void 0:s[e];if(!o)return null;const i=Ut(o,t),a=Yr(i);let c=0,l=0;switch(t){case"memorization":c=o.memorizationAttempts||0,l=o.memorizationCorrect||0;break;case"translation":c=o.translationAttempts||0,l=o.translationCorrect||0;break;case"spelling":c=o.spellingAttempts||0,l=o.spellingCorrect||0;break;case"grammar":c=o.grammarAttempts||0,l=o.grammarCorrect||0;break;default:c=(o.correctCount||0)+(o.incorrectCount||0),l=o.correctCount||0}const d={category:a,position:i,lastStudied:o.lastStudied||0,attempts:c,correct:l,streak:o.consecutiveCorrect||0,forgettingRisk:0,reviewInterval:1};return aI(a)&&_.debug(`[WordStatus] ${e}: ${a} (position=${i}, attempts=${d.attempts}, consecutiveIncorrect=${o.consecutiveIncorrect||0})`),d}catch(r){return _.error("[QuestionScheduler] Â≠¶ÁøíÁä∂Ê≥Å„ÅÆÂèñÂæó„Å´Â§±Êïó",r),null}}applyAntiVibration(e,t){return this.antiVibration.filter(e,{recentAnswers:t.recentAnswers,minInterval:6e4,consecutiveThreshold:3})}sortAndBalance(e,t,s){this.recordFunctionCall("sortAndBalance",{questionsCount:e.length});const r=e.filter(p=>p.position>=70),o=e.filter(p=>p.position>=40&&p.position<70),i=e.filter(p=>p.position<40);e.reduce((p,f)=>{var g;const m=((g=f.status)==null?void 0:g.category)||"null";return p[m]=(p[m]||0)+1,p},{}).null,e.length;const c=(p,f)=>p.position!==f.position?f.position-p.position:(p.originalIndex||0)-(f.originalIndex||0);r.sort(c),o.sort(c),i.sort(c);const l=[...e].sort((p,f)=>p.position!==f.position?f.position-p.position:(p.originalIndex||0)-(f.originalIndex||0)),h=new Xa().interleaveByCategory(l);try{const p=h.slice(0,30).map(w=>{var S,N;return{word:w.question.word,position:w.position,category:(S=w.status)==null?void 0:S.category,attempts:w.attempts??((N=w.status)==null?void 0:N.attempts)??0}});localStorage.setItem("debug_sortAndBalance_output",JSON.stringify(p));const f=h.slice(0,100).map((w,S)=>{var N,C;return{rank:S+1,word:w.question.word,position:w.position,category:(N=w.status)==null?void 0:N.category,attempts:w.attempts??((C=w.status)==null?void 0:C.attempts)??0}}),m=f.filter(w=>w.position>=40&&w.position<70&&w.attempts>0),g=h.slice(0,600).map((w,S)=>{var N;return{rank:S+1,word:w.question.word,position:w.position,attempts:w.attempts??((N=w.status)==null?void 0:N.attempts)??0}}),x=g.filter(w=>w.position>=40&&w.position<70&&w.attempts>0),y={timestamp:new Date().toISOString(),mode:t.mode,questionsCount:e.length,interleavedCount:h.length,top100:f,top600:g,top600Count:g.length,stillLearningInTop100:m.length,stillLearningInTop600:x.length,stillLearningWordsInTop100:m.map(w=>`${w.rank}‰Ωç: ${w.word} (Position ${w.position}, ${w.attempts}Âõû)`),stillLearningWordsInTop600:x.slice(0,20).map(w=>`${w.rank}‰Ωç: ${w.word} (Position ${w.position}, ${w.attempts}Âõû)`),position50Count:g.filter(w=>w.position===50&&w.attempts===0).length};localStorage.setItem("debug_sortAndBalance_top100",JSON.stringify(y));const b=`debug_sortAndBalance_top100_${t.mode}`;localStorage.setItem(b,JSON.stringify(y));const v=`debug_sortAndBalance_top100_history_${t.mode}`;try{const w=localStorage.getItem(v),S=JSON.parse(w||"[]"),N=Array.isArray(S)?S:[];for(N.push(y);N.length>5;)N.shift();localStorage.setItem(v,JSON.stringify(N))}catch{}}catch{}return h}scheduleHybridMode(e,t){const s=this.buildContext(e),r=e.useMetaAI?this.detectSignals(s):[],o=this.calculatePriorities(e.questions,s,r,!1),i=this.applyAntiVibration(o,s),a=this.sortAndBalance(i,e,s),c=a.filter(g=>g.position>=70),l=a.filter(g=>g.position>=40&&g.position<70),d=c.length+l.length,h=a.length;_.info("[QuestionScheduler Hybrid] ÂÑ™ÂÖàÂçòË™ûÈÖçÁΩÆÂÆå‰∫Ü",{incorrectWords:c.slice(0,5).map(g=>g.question.word),stillLearningWords:l.slice(0,5).map(g=>g.question.word),incorrectCount:c.length,stillLearningCount:l.length,otherCount:h-d,reviewRatio:h>0?`${(d/h*100).toFixed(0)}%`:"0%",top5:a.slice(0,5).map(g=>{var x;return`${g.question.word}(${(x=g.status)==null?void 0:x.category})`})});const p=this.postProcess(a,s);try{const g=p.slice(0,30).map((x,y)=>{var v,w;const b=a.find(S=>S.question.word===x.word);return{word:x.word,position:(b==null?void 0:b.position)||0,category:(v=b==null?void 0:b.status)==null?void 0:v.category,attempts:((w=b==null?void 0:b.status)==null?void 0:w.attempts)||0}});localStorage.setItem("debug_postProcess_output",JSON.stringify({timestamp:new Date().toISOString(),mode:s.mode,source:"scheduleHybridMode",top30:g}))}catch{}const f=this.antiVibration.calculateVibrationScore(a,s.recentAnswers,20),m=performance.now()-t;return _.info("[QuestionScheduler Hybrid] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(m)+"ms",vibrationScore:f,incorrectCount:c.length,stillLearningCount:l.length,aiEnabled:this.useAICoordinator,totalCount:p.length}),{scheduledQuestions:p,vibrationScore:f,processingTime:m,signalCount:r.length}}async scheduleFinalPriorityMode(e,t){var k;const s=this.buildContext(e),r=e.useMetaAI?this.detectSignals(s):[],o=this.loadProgressCache(),i=(o==null?void 0:o.wordProgress)??{},a=e.mode==="grammar"?"grammar":e.mode==="memorization"?"memorization":"comprehensive",c=(e.sessionStats.correct||0)+(e.sessionStats.incorrect||0)+(e.sessionStats.still_learning||0)+(e.sessionStats.mastered||0);let l=0,d=0,h=0,p=0;for(const I of Object.values(i)){const $=Ut(I,e.mode);$>=70?h++:$>=40?d++:$>=20?p++:l++}const f={totalAttempts:c,correctAnswers:e.sessionStats.correct||0,incorrectAnswers:e.sessionStats.incorrect||0,stillLearningAnswers:e.sessionStats.still_learning||0,sessionStartTime:s.sessionStartTime,sessionDuration:e.sessionStats.duration||0,consecutiveIncorrect:0,masteredCount:l,stillLearningCount:d,incorrectCount:h,newCount:p,consecutiveCorrect:e.sessionStats.consecutiveCorrect||0};if(!this.useAICoordinator||!this.aiCoordinator)return _.warn("[QuestionScheduler FinalPriority] AICoordinator„ÅåÊú™ÂàùÊúüÂåñ„ÄÅ„Éè„Ç§„Éñ„É™„ÉÉ„Éâ„É¢„Éº„Éâ„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ"),this.scheduleHybridMode(e,t);const m=[];for(const I of e.questions){const $=i[I.word]??s.wordProgress[I.word]??null,j=this.getWordStatusFromCache(I.word,s.mode,o),P=(j==null?void 0:j.position)??Ut($,e.mode);let O=0,A=0;if($)switch(e.mode){case"memorization":O=$.memorizationAttempts||0,A=$.memorizationCorrect||0;break;case"translation":O=$.translationAttempts||0,A=$.translationCorrect||0;break;case"spelling":O=$.spellingAttempts||0,A=$.spellingCorrect||0;break;case"grammar":O=$.grammarAttempts||0,A=$.grammarCorrect||0;break}const z=j??{category:Yr(P),position:P,lastStudied:($==null?void 0:$.lastStudied)||0,attempts:O,correct:A,streak:($==null?void 0:$.consecutiveCorrect)||0,forgettingRisk:0,reviewInterval:1},L=await this.aiCoordinator.analyzeAndCoordinate({word:{word:I.word,meaning:I.meaning,reading:I.reading,difficulty:I.difficulty,category:I.category,source:I.source,type:I.type,isPhraseOnly:I.isPhraseOnly},progress:$,sessionStats:f,currentTab:a,allProgress:i},P/100);m.push({question:I,position:P,finalPriority:L.finalPriority,status:z,attempts:(z==null?void 0:z.attempts)??0,timeBoost:1})}const g=new Xa,y=g.boostStillLearningQuestions(m).result;for(const I of y)I.position>=60&&I.position<70&&(((k=I.status)==null?void 0:k.attempts)??0)>0&&(I.finalPriority=(I.finalPriority??0)+100);const{result:b}=g.adjustPositionForInterleaving(y),v=[...b].sort((I,$)=>($.finalPriority??0)-(I.finalPriority??0)),w=g.interleaveByCategory(v);try{const I=w.slice(0,30).map((j,P)=>{var O,A;return{rank:P+1,word:j.question.word,position:j.position,finalPriority:j.finalPriority??0,category:(O=j.status)==null?void 0:O.category,attempts:((A=j.status)==null?void 0:A.attempts)??0}});Fi("debug_finalPriority_output",I,{mode:s.mode});const $={currentTab:a,totalQuestions:e.questions.length,allProgressCount:Object.keys(i||{}).length,aiSessionStats:f,timestamp:new Date().toISOString(),mode:s.mode};Fi("debug_finalPriority_sessionStats",$,{mode:s.mode})}catch{}const S=this.postProcess(w,s);try{const I=S.slice(0,30).map(j=>{var O,A;const P=w.find(z=>z.question.word===j.word);return{word:j.word,position:(P==null?void 0:P.position)||j.position||0,category:(O=P==null?void 0:P.status)==null?void 0:O.category,attempts:((A=P==null?void 0:P.status)==null?void 0:A.attempts)||0,finalPriority:(P==null?void 0:P.finalPriority)??j.finalPriority??0}}),$={timestamp:new Date().toISOString(),mode:s.mode,source:"scheduleFinalPriorityMode",top30:I};Fi("debug_postProcess_output",$,{mode:s.mode})}catch{}const N=this.antiVibration.calculateVibrationScore(w,s.recentAnswers,20),C=performance.now()-t;return _.info("[QuestionScheduler FinalPriority] „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{processingTime:Math.round(C)+"ms",vibrationScore:N,aiEnabled:!0,totalCount:S.length,top5FinalPriority:w.slice(0,5).map(I=>({word:I.question.word,finalPriority:(I.finalPriority??0).toFixed(3),position:I.position}))}),{scheduledQuestions:S,vibrationScore:N,processingTime:C,signalCount:r.length}}postProcess(e,t){const s=e.map(a=>({...a.question,position:a.position,finalPriority:a.finalPriority})),r=a=>a>=70?0:a>=60?1:a>=40?2:a>=20?3:4;let o=!1,i=-1;for(const a of e){const c=r(a.position);if(i!==-1&&c<i){o=!0;break}i=c}try{const a=e.slice(0,30).map(l=>{var d;return{word:l.question.word,position:l.position??0,attempts:((d=l.status)==null?void 0:d.attempts)??0}}),c={timestamp:new Date().toISOString(),mode:t.mode,isInterleavedAcrossBands:o,action:o?"skipped_contextual_reorder":"applied_contextual_reorder",top30:a};Fi("debug_postProcess_meta",c,{mode:t.mode})}catch{}if(o)return s;try{const a=this.getAllProgress(),c=this.getRecentlyStudiedWords(t),l=this.splitByPositionBands(e,t),d=[];let h=0,p=0;for(const f of l){if(f.questions.length===0)continue;const m=f.questions.map(b=>({...b.question,position:b.position,finalPriority:b.finalPriority})),g=iI(m,a,[]),x=new Map(m.map(b=>[b.word,b])),y=g.sequence.map(b=>x.get(b)).filter(b=>b!==void 0);d.push(...y),h+=g.clusters.length,p+=g.transitions.length}try{const f=d.slice(0,30).map((x,y)=>({rank:y+1,word:x.word,position:x.position??0,attempts:x.attempts??0})),m={incorrect:f.filter(x=>x.position>=70).length,stillLearning:f.filter(x=>x.position>=60&&x.position<70).length,newBoosted:f.filter(x=>x.position>=40&&x.position<60).length,newNormal:f.filter(x=>x.position>=20&&x.position<40).length,mastered:f.filter(x=>x.position<20).length},g={timestamp:new Date().toISOString(),mode:t.mode,source:"postProcess",top30:f,positionDistribution:m,totalQuestions:d.length};Fi("debug_postProcess_output",g,{mode:t.mode})}catch{}return d}catch(a){return _.warn("[postProcess] Èñ¢ÈÄ£Ë™û„Ç∞„É´„Éº„ÉóÂåñ„Åß„Ç®„É©„Éº„ÄÅÂü∫Êú¨È†ÜÂ∫è„Çí‰ΩøÁî®:",a),s}}splitByPositionBands(e,t){const s=[{range:"70-100 (incorrect)",min:70,max:100,questions:[]},{range:"60-69 (still_learning)",min:60,max:69,questions:[]},{range:"40-59 (new boosted)",min:40,max:59,questions:[]},{range:"20-39 (new normal)",min:20,max:39,questions:[]},{range:"0-19 (mastered)",min:0,max:19,questions:[]}];return e.forEach(r=>{const o=r.position;for(const i of s)if(o>=i.min&&o<=i.max){i.questions.push(r);break}}),s.filter(r=>r.questions.length>0)}getRecentlyStudiedWords(e){const t=[],s=Date.now(),r=5*60*1e3;for(const[o,i]of Object.entries(e.wordProgress)){const a=i==null?void 0:i.lastStudied;a&&s-new Date(a).getTime()<r&&t.push(o)}return t.slice(-20)}clearCache(){this.recentAnswersCache.clear(),_.info("[QuestionScheduler] „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü")}getWordProgress(e){var t;try{return((t=it().wordProgress)==null?void 0:t[e])||null}catch{return null}}getAllProgress(){try{return it().wordProgress||{}}catch{return{}}}convertToAISessionStats(e){return{totalAttempts:e.correct+e.incorrect+e.still_learning,correctAnswers:e.correct||0,incorrectAnswers:e.incorrect||0,stillLearningAnswers:e.still_learning||0,sessionStartTime:Date.now()-(e.duration||0),sessionDuration:e.duration||0,avgResponseTime:e.avgResponseTime,consecutiveIncorrect:e.consecutiveIncorrect||0,masteredCount:e.masteredCount||0,stillLearningCount:e.still_learningCount||0,incorrectCount:e.incorrectCount||0,newCount:e.newCount||0}}recalculatePriorityAfterAnswer(e,t,s="memorization"){const r=(()=>{switch(s){case"memorization":return t.memorizationPosition??50;case"translation":return t.translationPosition??50;case"spelling":return t.spellingPosition??50;case"grammar":return t.grammarPosition??50;default:return 50}})(),o=this.determinePositionAfterAnswer(t,s),i=Ut(t,s),a=VK(t,s);(Date.now()-(t.lastStudied||Date.now()))/(1e3*60*60*24);const c=Yr(o),l=t.correctCount+t.incorrectCount;t.accuracyRate=l>0?t.correctCount/l:0;let d=0,h=0,p=0;switch(s){case"memorization":d=t.memorizationAttempts||0,h=t.memorizationCorrect||0,p=t.memorizationStillLearning||0;break;case"translation":d=t.translationAttempts||0,h=t.translationCorrect||0;break;case"spelling":d=t.spellingAttempts||0,h=t.spellingCorrect||0;break;case"grammar":d=t.grammarAttempts||0,h=t.grammarCorrect||0;break}try{const f={timestamp:new Date().toISOString(),word:e,mode:s,positionBefore:r,positionAfter:o,positionWithSavedPosition:i,category:c,savedPositionDebug:a,progress:{correctCount:t.correctCount,incorrectCount:t.incorrectCount,consecutiveCorrect:t.consecutiveCorrect||0,consecutiveIncorrect:t.consecutiveIncorrect||0,accuracy:t.accuracyRate||0,modeAttempts:d,modeCorrect:h,modeStillLearning:p}},m=localStorage.getItem("debug_answer_logs"),g=m?JSON.parse(m):[];g.push(f),g.length>20&&g.shift(),localStorage.setItem("debug_answer_logs",JSON.stringify(g))}catch{}return o}calculateAIEvaluations(e,t,s){const r=e.correctCount+e.incorrectCount,o=r>0?e.correctCount/r:0,i=e.consecutiveCorrect||0,a=e.consecutiveIncorrect||0,c=new qN,l=new KN,d=new XN,h=new YN,p=new JN,f=new QN,m=new Xa;return{memory:c.proposePosition(e,"",s,o,r),cognitiveLoad:l.proposePosition(e,a),errorPrediction:d.proposePosition(e,o,r),linguistic:h.proposePosition(e,o),contextual:p.proposePosition(e,s),learningStyle:f.proposePosition(e,o,r),gamification:m.proposePosition(e,i,o)}}recordAIEvaluation(e,t){try{const s="debug_ai_evaluations",r=localStorage.getItem(s),o=r?JSON.parse(r):{};o[e]={...t,word:e};const i=Object.entries(o);if(i.length>100){const d=Object.fromEntries(i.slice(-100));localStorage.setItem(s,JSON.stringify(d))}else localStorage.setItem(s,JSON.stringify(o));const a=(t==null?void 0:t.aiEvaluations)??(t==null?void 0:t.aiProposals)??{},c=Object.values(a).map(d=>Number(d).toFixed(1)).join("/"),l=Number((t==null?void 0:t.finalPriority)??(t==null?void 0:t.position)??0);console.log(`ü§ñ [AIË©ï‰æ°] ${e}: ${l.toFixed(1)}[${c}] (${(t==null?void 0:t.category)??"n/a"})`)}catch{}}determinePosition(e,t="memorization"){return Ut(e,t)}determinePositionAfterAnswer(e,t="memorization"){const s={...e};switch(t){case"memorization":s.memorizationPosition=void 0;break;case"translation":s.translationPosition=void 0;break;case"spelling":s.spellingPosition=void 0;break;case"grammar":s.grammarPosition=void 0;break}return Ut(s,t)}enforceCompletionRequirement(e){return e>=70?100:e>=40?75:e<20?10:50}calculateDifficultyAdaptation(e){if(!e||!e.wordProgress)return{beginner:70,intermediate:60,advanced:50,shouldPrioritizeBeginner:!1,priorityBoost:0};const t=Object.values(e.wordProgress||{}),s={beginner:{correct:0,total:0},intermediate:{correct:0,total:0},advanced:{correct:0,total:0}};t.forEach(a=>{const l={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[a.difficulty];if(l&&s[l]){const d=(a.correctCount||0)+(a.incorrectCount||0);s[l].total+=d,s[l].correct+=a.correctCount||0}});const r={beginner:s.beginner.total>0?s.beginner.correct/s.beginner.total*100:70,intermediate:s.intermediate.total>0?s.intermediate.correct/s.intermediate.total*100:60,advanced:s.advanced.total>0?s.advanced.correct/s.advanced.total*100:50},o=r.intermediate<60||r.advanced<50;let i=0;if(o){const a=Math.max(0,60-r.intermediate),c=Math.max(0,50-r.advanced);i=Math.min(20,(a+c)/2)}return{...r,shouldPrioritizeBeginner:o,priorityBoost:i}}applyDifficultyAdaptation(e,t,s){if(!s.shouldPrioritizeBeginner)return e;const o={ÂàùÁ¥ö:"beginner",‰∏≠Á¥ö:"intermediate",‰∏äÁ¥ö:"advanced"}[t.difficulty];return o?o==="beginner"?Math.max(0,e-s.priorityBoost):o==="intermediate"||o==="advanced"?Math.min(100,e+Math.min(10,s.priorityBoost/2)):e:e}}const mo=1;function t0(n){return typeof n!="number"||!Number.isFinite(n)?null:n}function cI(n,e){const t=e??t0(n.schemaVersion)??0;if(t>mo)return{status:"too_new",storedVersion:t,supportedVersion:mo,notes:["Stored progress schema is newer than this app supports; skipping migration/save"],progress:n};let s=!1;const r=[];return t<1&&r.push("Set schemaVersion (v0 -> v1)"),n.schemaVersion!==mo&&(n.schemaVersion=mo,s=!0),(!n.wordProgress||typeof n.wordProgress!="object")&&(n.wordProgress={},s=!0,r.push("Initialize missing wordProgress")),(!n.results||!Array.isArray(n.results))&&(n.results=[],s=!0,r.push("Initialize missing results")),(!n.questionSetStats||typeof n.questionSetStats!="object")&&(n.questionSetStats={},s=!0,r.push("Initialize missing questionSetStats")),{status:"ok",fromVersion:t,toVersion:mo,didMigrate:s,notes:r,progress:n}}const Ny={maxReviewCount:10};function n0(){try{const n=localStorage.getItem("study-settings");if(n)return{maxReviewCount:JSON.parse(n).maxReviewCount??Ny.maxReviewCount}}catch(n){_.error("Â≠¶ÁøíË®≠ÂÆö„ÅÆÂèñÂæó„Ç®„É©„Éº:",n)}return{...Ny}}const tX="session-history",nX=50;async function xa(n,e){const t=Xu()&&Qu();try{if(t)await pr(vn.SESSION_HISTORY,{mode:e,status:n.status,word:n.word,timestamp:n.timestamp});else{const s=`${tX}-${e}`,r=localStorage.getItem(s),o=r?JSON.parse(r):[];o.push(n),o.length>nX&&o.shift(),localStorage.setItem(s,JSON.stringify(o))}}catch(s){_.error("„Çª„ÉÉ„Ç∑„Éß„É≥Â±•Ê≠¥„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",s)}}function Ou(){const n=it(),e=new Date().toLocaleDateString("ja-JP"),t=new Set;return n.results.forEach(s=>{new Date(s.date).toLocaleDateString("ja-JP")===e&&s.incorrectWords.forEach(r=>t.add(r))}),Array.from(t)}function Lu(n){const e=it(),t=new Date().setHours(0,0,0,0),s=t+24*60*60*1e3;let r=e.results.filter(c=>c.date>=t&&c.date<s);n&&(r=r.filter(c=>c.mode===n));const o=r.reduce((c,l)=>c+l.score,0),i=r.reduce((c,l)=>c+l.total,0),a=i>0?Math.round(o/i*100):0;return{todayCorrectCount:o,todayTotalAnswered:i,todayAccuracy:a}}function s0(){const n=it(),e=new Date,t=e.getDay(),s=t===0?-6:1-t,r=new Date(e);r.setDate(e.getDate()+s),r.setHours(0,0,0,0);const o=new Date(r);o.setDate(r.getDate()+7);const i=new Date(r);i.setDate(r.getDate()-7);const a=new Date(r),c=n.results.filter(b=>b.date>=r.getTime()&&b.date<o.getTime()),l=n.results.filter(b=>b.date>=i.getTime()&&b.date<a.getTime()),d=new Set;c.forEach(b=>{const v=new Date(b.date).toISOString().split("T")[0];d.add(v)});const h=c.reduce((b,v)=>b+v.total,0),p=c.reduce((b,v)=>b+v.score,0),f=h>0?p/h*100:0,m=l.reduce((b,v)=>b+v.total,0),g=l.reduce((b,v)=>b+v.score,0),x=m>0?g/m*100:0;let y=0;return Object.values(n.wordProgress).forEach(b=>{b.masteryLevel==="mastered"&&b.lastStudied>=r.getTime()&&y++}),{studyDays:d.size,totalDays:7,totalAnswered:h,accuracy:f,newMastered:y,previousWeekAccuracy:x}}function r0(){const n=it(),e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1);t.setHours(0,0,0,0);const s=new Date(e.getFullYear(),e.getMonth()+1,0);s.setHours(23,59,59,999);const r=n.results.filter(h=>h.date>=t.getTime()&&h.date<=s.getTime()),o=new Set;r.forEach(h=>{const p=new Date(h.date).toISOString().split("T")[0];o.add(p)});const i=r.reduce((h,p)=>h+p.total,0),a=r.reduce((h,p)=>h+p.score,0),c=i>0?a/i*100:0;let l=0;Object.values(n.wordProgress).forEach(h=>{h.masteryLevel==="mastered"&&h.lastStudied>=t.getTime()&&l++});const d=s.getDate();return{studyDays:o.size,totalDays:d,totalAnswered:i,accuracy:c,newMastered:l}}function zu(){const n=it(),e=Object.values(n.wordProgress),t=e.filter(d=>(d.totalAttempts||0)>0);let s=0,r=0,o=0;const i=t.slice(0,Math.min(500,t.length)),a=t.length/i.length;i.forEach(d=>{const h=Ut(d);h<40?s++:h>=40&&h<70?r++:h>=70&&o++}),s=Math.round(s*a),r=Math.round(r*a),o=Math.round(o*a);const c=t.length,l=s*1+r*.5;return{totalWords:e.length,appearedWords:c,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:c>0?Math.round(s/c*100):0,weightedRetentionRate:c>0?Math.round(l/c*100):0,masteredPercentage:c>0?Math.round(s/c*100):0,learningPercentage:c>0?Math.round(r/c*100):0,strugglingPercentage:c>0?Math.round(o/c*100):0,masteredWords:s,learningWords:r,newWords:e.length-c,retentionRate:c>0?Math.round(s/c*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function lI(){const n=it();let e=0,t=0,s=0,r=0,o=0;return Object.values(n.wordProgress).forEach(i=>{const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=Ut(i);if(c<20){i.consecutiveCorrect>=7?o++:i.consecutiveCorrect>=5&&r++;return}if(c>=40){t++;const{consecutiveCorrect:l}=i,d=i.correctCount/a;l===2||d>=.9&&l===1&&a>=2||a>=4&&d>=.75?(e++,s+=1):s+=Math.max(1,3-l)}}),{nearMasteryCount:e,learningCount:t,averageRemainingAnswers:t>0?Math.round(s/t*10)/10:0,longTermMemoryCount:r,superMemoryCount:o}}function o0(n=7,e=10){const t=it(),s=Date.now()-n*24*60*60*1e3;return Object.entries(t.wordProgress).filter(([o,i])=>i.masteryLevel==="mastered"&&i.lastStudied>=s).map(([o,i])=>({word:o,masteredDate:i.lastStudied,totalAttempts:i.correctCount+i.incorrectCount})).sort((o,i)=>i.masteredDate-o.masteredDate).slice(0,e)}function Wu(){const n=it(),t=Object.values(n.wordProgress).filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.word.startsWith("grammar_")||l.word.includes("_g")),s=t.filter(l=>l.grammarAttempts&&l.grammarAttempts>0||l.correctCount+l.incorrectCount>0);let r=0,o=0,i=0;s.forEach(l=>{const d=l.grammarAttempts||l.correctCount+l.incorrectCount,h=l.grammarCorrect||l.correctCount,p=l.grammarStreak||l.consecutiveCorrect,f=d>0?h/d*100:0;d===1&&h===1||p>=3||p>=2&&f>=80?r++:f>=50?o++:i++});const a=s.length,c=r*1+o*.5;return{totalWords:t.length,appearedWords:a,masteredCount:r,learningCount:o,strugglingCount:i,basicRetentionRate:a>0?Math.round(r/a*100):0,weightedRetentionRate:a>0?Math.round(c/a*100):0,masteredPercentage:a>0?Math.round(r/a*100):0,learningPercentage:a>0?Math.round(o/a*100):0,strugglingPercentage:a>0?Math.round(i/a*100):0,masteredWords:r,learningWords:o,newWords:t.length-a,retentionRate:a>0?Math.round(r/a*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function Bu(){const n=it(),e=Object.values(n.wordProgress),t=e.filter(c=>c.memorizationAttempts&&c.memorizationAttempts>0);let s=0,r=0,o=0;t.forEach(c=>{c.category}),t.forEach(c=>{const l=Ut(c,"memorization");l<40?s++:l>=40&&l<70?r++:l>=70&&o++});const i=t.length,a=s*1+r*.5;return{totalWords:e.length,appearedWords:i,masteredCount:s,learningCount:r,strugglingCount:o,basicRetentionRate:i>0?Math.round(s/i*100):0,weightedRetentionRate:i>0?Math.round(a/i*100):0,masteredPercentage:i>0?Math.round(s/i*100):0,learningPercentage:i>0?Math.round(r/i*100):0,strugglingPercentage:i>0?Math.round(o/i*100):0,masteredWords:s,learningWords:r,newWords:e.length-i,retentionRate:i>0?Math.round(s/i*100):0,averageAttempts:0,categoryBreakdown:{},difficultyBreakdown:{}}}function i0(){const n=it(),e=Object.entries(n.wordProgress).filter(([r,o])=>r.startsWith("grammar_")),t=new Map;e.forEach(([r,o])=>{const i=r.match(/grammar_(?:\w+-)?g(\d+)-u(\d+)/);if(!i){r.startsWith("grammar_")&&!r.includes("unknown")&&console.warn(`‚ö†Ô∏è ÊñáÊ≥ïÂïèÈ°åID„Åå„Éë„Çø„Éº„É≥„Å´„Éû„ÉÉ„ÉÅ„Åó„Åæ„Åõ„Çì: ${r}`);return}const a=i[1],c=i[2],l=`‰∏≠${a}_Unit${c}`;t.has(l)||t.set(l,{questions:[],answered:[],correct:0,incorrect:0,mastered:0,allHistory:[]});const d=t.get(l);d.questions.push([r,o]);const h=o.grammarAttempts||o.correctCount+o.incorrectCount;if(h>0){d.answered.push([r,o]);const p=o.grammarCorrect||o.correctCount||0,f=h-p;if(d.correct+=p,d.incorrect+=f,o.learningHistory&&o.learningHistory.length>0){const v=o.learningHistory.slice(-10);d.allHistory.push(...v)}const m=o.grammarStreak||o.consecutiveCorrect||0,g=h>0?p/h*100:0,x=o.masteryLevel==="mastered",y=h===1&&p===1,b=h>=3&&g>=85;(x||y||b||m>=3)&&d.mastered++}});const s=Array.from(t.entries()).map(([r,o])=>{const i=o.correct+o.incorrect,a=i>0?o.correct/i*100:0,c=o.questions.length>0?o.answered.length/o.questions.length*100:0,d=o.allHistory.sort((h,p)=>h.timestamp-p.timestamp).slice(-10).map(h=>h.wasCorrect?"üü©":"üü•").join("");return{unit:r,totalQuestions:o.questions.length,answeredQuestions:o.answered.length,correctCount:o.correct,incorrectCount:o.incorrect,masteredCount:o.mastered,accuracy:Math.round(a),progress:Math.round(c),historyIcons:d}});return s.sort((r,o)=>r.unit.localeCompare(o.unit)),s}function cp(n){const e=it(),s=Object.entries(e.wordProgress).map(([r,o])=>{let i=0;if(n){switch(n){case"memorization":i=o.memorizationAttempts||0;break;case"translation":i=o.translationAttempts||0;break;case"spelling":i=o.spellingAttempts||0;break;case"grammar":i=o.grammarAttempts||0;break}if(i===0)return null}else if(i=o.totalAttempts||0,i===0)return null;const a=n?Ut(o,n):Ut(o);if(a<40)return null;const c=a>=70?"incorrect":"still_learning";return{word:r,position:a,category:c,attempts:i,correctCount:o.correctCount||0,incorrectCount:o.incorrectCount||0,lastStudied:o.lastStudied||0}}).filter(r=>r!==null);return s.sort((r,o)=>o.position-r.position),s}const rf="english-progress",Iy=9999,ky=3,sX="backup_progress_before_migration";async function rX(n){try{await ya(sX,{createdAt:new Date().toISOString(),fromVersion:n.fromVersion,toVersion:n.toVersion,storedData:n.storedData})}catch(e){_.warn("Failed to backup progress before migration:",e)}}function ri(){return{schemaVersion:mo,results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},categoryStats:{},difficultyStats:{},wordProgress:{}}}async function is(){try{const n=await nb();if(!n){const l=ri();return _r(l),l}const e=t0(n==null?void 0:n.schemaVersion),t=n,s={results:t.results||[],statistics:t.statistics||{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:t.questionSetStats||{},categoryStats:{},difficultyStats:{},wordProgress:t.wordProgress||{}};s.statistics||(s.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),s.questionSetStats||(s.questionSetStats={}),s.wordProgress||(s.wordProgress={}),s.results||(s.results=[]),a0(s);const r=cI(s,e);if(r.status==="too_new"){try{localStorage.setItem("debug_progress_schema_too_new",JSON.stringify({timestamp:new Date().toISOString(),storedVersion:r.storedVersion,supportedVersion:r.supportedVersion,notes:r.notes}))}catch{}return _r(s),s}let o=0,i=0,a=!1;Object.values(s.wordProgress).forEach(l=>{l.category||(l.category="Êú™ÂàÜÈ°û",o++,a=!0);const d=l.memorizationAttempts||0,h=l.memorizationStillLearning||0,p=l.consecutiveIncorrect||0,f=l.memorizationPosition;if(d>0&&(h>0||p>0)){const m=typeof f=="number"?f:-1;if(m<40){const g=Ut({...l,memorizationPosition:void 0},"memorization");typeof g=="number"&&g>=40&&g>m&&(l.memorizationPosition=g,i++,a=!0)}}}),a&&(o>0&&_.info(`[Category Repair] ${o}ÂÄã„ÅÆÂçòË™û„Å´category„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`),i>0&&_.info(`[Position Repair] memorizationPosition„ÇíÂÜçË®àÁÆó„Åó„Å¶Ë£úÊ≠£: ${i}Ë™û`));try{localStorage.setItem("debug_progress_repair_summary",JSON.stringify({timestamp:new Date().toISOString(),categoryAdded:o,memorizationPositionRepaired:i,saved:a}))}catch{}const c=a||r.didMigrate;if(r.didMigrate){await rX({fromVersion:r.fromVersion,toVersion:r.toVersion,storedData:n});try{localStorage.setItem("debug_progress_migration_summary",JSON.stringify({timestamp:new Date().toISOString(),fromVersion:r.fromVersion,toVersion:r.toVersion,didMigrate:r.didMigrate,notes:r.notes}))}catch{}}return c&&await Cr(s),_r(s),s}catch(n){_.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=ri();return _r(e),e}}let ur=null;function oX(){return ur||(ur=ri(),_.log("üì¶ Progress cache initialized with default data")),ur}function it(){if(ur)return ur.statistics||(_.warn("‚ö†Ô∏è Cache missing statistics, reinitializing"),ur=ri()),ur;oX();try{const n=localStorage.getItem(rf);if(!n){const s=ri();return ur=s,s}const e=JSON.parse(n),t=cI(e,t0(e==null?void 0:e.schemaVersion));if(t.status==="ok"&&t.didMigrate)try{localStorage.setItem(rf,JSON.stringify(e))}catch{}return e.statistics||(e.statistics={totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]}),e.questionSetStats||(e.questionSetStats={}),e.wordProgress||(e.wordProgress={}),e.results||(e.results=[]),e.results||(e.results=[]),a0(e),ur=e,e}catch(n){_.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=ri();return ur=e,e}}function _r(n){ur=n,_.log("üîÑ progressCacheÊõ¥Êñ∞ - results‰ª∂Êï∞:",n.results.length)}async function Cr(n){try{n.schemaVersion=mo,a0(n),_r(n);try{localStorage.setItem(rf,JSON.stringify(n))}catch(s){_.warn("LocalStorage‰øùÂ≠òÂ§±ÊïóÔºàÂÆπÈáè‰∏çË∂≥„ÅÆÂèØËÉΩÊÄßÔºâ:",s)}const e={schemaVersion:mo,quizzes:{},lastUpdated:Date.now(),totalAnswered:{},totalMastered:{},results:n.results,statistics:n.statistics,questionSetStats:n.questionSetStats,wordProgress:n.wordProgress};await tb(e)||_.error("„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}catch(e){_.error("ÈÄ≤Êçó„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:",e)}}function a0(n){n.results.length>Iy&&(n.results.sort((e,t)=>t.date-e.date),n.results=n.results.slice(0,Iy)),Object.values(n.wordProgress).forEach(e=>{e.responseTimes&&e.responseTimes.length>ky&&(e.responseTimes=e.responseTimes.slice(-ky))})}async function pc(n){const e=await is();e.results.push(n),_.log("‚úÖ addQuizResultÂëº„Å≥Âá∫„Åó:",{mode:n.mode,score:n.score,total:n.total,date:new Date(n.date).toISOString(),resultsCount:e.results.length}),iX(e,n),await Cr(e),_.log("üíæ saveProgressÂÆå‰∫Ü - results‰ª∂Êï∞:",e.results.length);try{if(typeof window<"u"){const t=new CustomEvent(na,{detail:{result:n}});window.dispatchEvent(t)}}catch{}}function iX(n,e){const t=n.statistics;t.totalQuizzes++,t.totalQuestions+=e.total,t.totalCorrect+=e.score,t.averageScore=t.totalQuestions>0?t.totalCorrect/t.totalQuestions*100:0,t.bestScore=Math.max(t.bestScore,e.percentage),t.lastStudyDate=e.date;const s=new Date(e.date).setHours(0,0,0,0);t.studyDates.includes(s)||(t.studyDates.push(s),t.studyDates.sort((a,c)=>c-a)),t.streakDays=aX(t.studyDates),n.questionSetStats[e.questionSetId]||(n.questionSetStats[e.questionSetId]={attempts:0,bestScore:0,averageScore:0,lastAttempt:0,totalTimeSpent:0});const r=n.questionSetStats[e.questionSetId];r.attempts++,r.bestScore=Math.max(r.bestScore,e.percentage),r.lastAttempt=e.date,r.totalTimeSpent+=e.timeSpent;const o=n.results.filter(a=>a.questionSetId===e.questionSetId),i=o.reduce((a,c)=>a+c.percentage,0);r.averageScore=i/o.length}function aX(n){if(n.length===0)return 0;const e=new Date().setHours(0,0,0,0),t=e-24*60*60*1e3,s=n[0];if(s!==e&&s!==t)return 0;let r=1;for(let o=1;o<n.length&&(n[o-1]-n[o])/(24*60*60*1e3)===1;o++)r++;return r}function c0(n=10){const e=it(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{if(r<5)return;const i=e.wordProgress[o];if(!i)return;const a=i.correctCount+i.incorrectCount;if(a===0)return;const c=i.correctCount/a*100,l=c>=80,h=a===1&&i.correctCount===1||i.consecutiveCorrect>=3||c>=85;if(l&&h){const p=r*c;s.push({word:o,totalMistakes:r,recentAccuracy:Math.round(c),overcomeScore:p})}}),s.sort((r,o)=>o.overcomeScore-r.overcomeScore).slice(0,n)}function Ah(n=10){const e=it(),t=new Map;e.results.forEach(r=>{r.incorrectWords.forEach(o=>{t.set(o,(t.get(o)||0)+1)})});const s=[];return t.forEach((r,o)=>{const i=e.wordProgress[o];if(!i){s.push({word:o,mistakes:r,recentAccuracy:0,meaning:void 0,reading:void 0});return}const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=a===1&&i.correctCount===1;r>=5&&c>=80&&(l||i.consecutiveCorrect>=3||c>=85)||s.push({word:o,mistakes:r,recentAccuracy:Math.round(c),meaning:i.meaning,reading:i.reading})}),s.sort((r,o)=>o.mistakes-r.mistakes).slice(0,n)}function uI(n){return{word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,firstAttempted:Date.now(),lastStudied:0,totalResponseTime:0,averageResponseTime:0,difficultyScore:50,masteryLevel:"new",responseTimes:[],category:"new"}}function cX(n){const e=n.correctCount+n.incorrectCount;if(e===0)return 50;const s=(1-n.correctCount/e)*100,r=Math.min(n.consecutiveIncorrect*5,20),o=n.averageResponseTime/1e3,i=Math.min(o>5?(o-5)*3:0,15),a=n.userDifficultyRating?(n.userDifficultyRating-5.5)*5:0,c=s+r+i+a;return Math.max(0,Math.min(100,c))}function ho(n){const e=[1,1,3,7,14,30,90,180,365];return n>=e.length?365:e[n]||1}function l0(n,e){const t=n.correctCount+n.incorrectCount,s=t>0?n.correctCount/t:0,{consecutiveCorrect:r,lastStudied:o}=n,a=(Date.now()-o)/(1e3*60*60)/24;if(t===1&&e){const c=ho(1);return{isMastered:!0,excludeDays:c,reason:`1Áô∫Ê≠£Ëß£Ôºà${c}Êó•Âæå„Å´ÂÜçÁ¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:1}}if(r>=2&&e){const c=ho(r),l=Math.min(7,Math.floor(r/1));let d="";return r>=7?d=`Ë∂ÖÈï∑ÊúüË®òÊÜ∂ÈÅîÊàêÔºÅÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âπ¥Ê¨°Á¢∫Ë™çÔºâ`:r>=5?d=`Èï∑ÊúüË®òÊÜ∂ÂÆöÁùÄÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:r>=3?d=`Áü≠Êúü‚ÜíÈï∑ÊúüË®òÊÜ∂ÁßªË°åÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`:d=`Â≠¶Áøí‰∏≠ÔºàÈÄ£Á∂ö${r}ÂõûÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Âæ©ÁøíÔºâ`,{isMastered:!0,excludeDays:c,reason:d,confidence:Math.min(.99,.75+r*.05),masteryLevel:l}}if(t>=3&&s>=.9&&r>=2){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`È´òÁ≤æÂ∫¶ÂÆâÂÆöÂûãÔºàÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.88,masteryLevel:2}}if(r>=2&&a>=7&&e){const c=ho(r),l=Math.floor(c*1.5);return{isMastered:!0,excludeDays:l,reason:`Èï∑ÊúüË®òÊÜ∂ÂûãÔºà7Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.92,masteryLevel:3}}if(r>=2&&a>=3&&e){const c=ho(r),l=Math.floor(c*1.2);return{isMastered:!0,excludeDays:l,reason:`‰∏≠ÊúüË®òÊÜ∂ÂûãÔºà3Êó•ÈñìÈöî„ÅßÊ≠£Ëß£„ÄÅ${l}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.85,masteryLevel:2}}if(r>=2&&a<=1&&s>=.85&&t>=4){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`Áü≠ÊúüÂÆåÁíßÂûãÔºà24ÊôÇÈñìÂÜÖ„Å´ÈÄ£Á∂öÊ≠£Ëß£„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.8,masteryLevel:1}}if(t>=5&&s>=.8&&e){const c=Math.max(7,ho(2));return{isMastered:!0,excludeDays:c,reason:`È´òÂõûÊï∞ÂÆâÂÆöÂûãÔºà${t}ÂõûÊåëÊà¶„ÉªÊ≠£Á≠îÁéá${Math.round(s*100)}%„ÄÅ${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.83,masteryLevel:2}}if(r>=2&&s>=.75&&t>=3&&e){const c=ho(r);return{isMastered:!0,excludeDays:c,reason:`Ê¨°ÂõûÂÆöÁùÄÈÅîÊàêÔºà${c}Êó•Âæå„Å´Á¢∫Ë™çÔºâ`,confidence:.78,masteryLevel:1}}return{isMastered:!1,excludeDays:0,reason:"Êú™ÂÆöÁùÄ",confidence:1,masteryLevel:0}}function lX(n){const e=n.correctCount+n.incorrectCount;if(e===0)return"new";const t=n.correctCount/e,s=e===1&&n.correctCount===1,r=e===2&&t===1,o=e>=5&&t>=.85,i=e>=3&&t>=.9,a=n.consecutiveCorrect>=5,c=e>=10&&t>=.75&&n.consecutiveCorrect>=2;return s||r||o||i||a||c?"mastered":"learning"}async function Co(n,e,t,s,r,o){const i=await is();let a=i.wordProgress[n];if(a||(a=uI(n),i.wordProgress[n]=a),a.lastRetentionRate!==void 0){const m=a.lastRetentionRate,g=e?1:o?.5:0;gs(async()=>{const{getPredictionLogger:x}=await Promise.resolve().then(()=>jY);return{getPredictionLogger:x}},void 0).then(({getPredictionLogger:x})=>{x().logPrediction(n,m,g).catch(y=>{console.warn("Failed to log prediction:",y)})})}e?(a.correctCount++,a.consecutiveCorrect++,a.consecutiveIncorrect=0):o?(a.consecutiveCorrect=0,a.consecutiveIncorrect=0):(a.incorrectCount++,a.consecutiveIncorrect++,a.consecutiveCorrect=0);const c=r;c==="translation"?(a.translationAttempts=(a.translationAttempts||0)+1,e?(a.translationCorrect=(a.translationCorrect||0)+1,a.translationStreak=(a.translationStreak||0)+1):a.translationStreak=0):c==="spelling"?(a.spellingAttempts=(a.spellingAttempts||0)+1,e?(a.spellingCorrect=(a.spellingCorrect||0)+1,a.spellingStreak=(a.spellingStreak||0)+1):a.spellingStreak=0):c==="grammar"?(a.grammarAttempts=(a.grammarAttempts||0)+1,e?(a.grammarCorrect=(a.grammarCorrect||0)+1,a.grammarStreak=(a.grammarStreak||0)+1):a.grammarStreak=0):c==="memorization"&&(a.memorizationAttempts=(a.memorizationAttempts||0)+1,e?(a.memorizationCorrect=(a.memorizationCorrect||0)+1,a.memorizationStreak=(a.memorizationStreak||0)+1):o?a.memorizationStillLearning=(a.memorizationStillLearning||0)+1:a.memorizationStreak=0),a.totalAttempts=(a.translationAttempts||0)+(a.spellingAttempts||0)+(a.grammarAttempts||0)+(a.memorizationAttempts||0),a.totalResponseTime+=t;const l=a.correctCount+a.incorrectCount;if(l>0&&(a.averageResponseTime=a.totalResponseTime/l),s!==void 0&&(a.userDifficultyRating=s),a.lastStudied=Date.now(),c==="memorization"){a.easinessFactor===void 0&&(a.easinessFactor=2.5),e?a.easinessFactor=Math.min(2.5,a.easinessFactor+.1):o||(a.easinessFactor=Math.max(1.3,a.easinessFactor-.2));const m=a.memorizationStreak||0,g=a.easinessFactor;let x=0;if(m===0)x=0;else if(m===1)x=1;else if(m===2)x=3;else if(m===3)x=7;else{const y=a.reviewInterval||7;x=Math.round(y*g)}a.reviewInterval=x,a.lastReviewDate=Date.now(),a.totalReviews=(a.totalReviews||0)+1,a.avgResponseSpeed?a.avgResponseSpeed=a.avgResponseSpeed*.8+t*.2:a.avgResponseSpeed=t,t<2e3&&e&&(a.easinessFactor=Math.min(2.5,a.easinessFactor+.05))}a.learningHistory||(a.learningHistory=[]),a.learningHistory.push({timestamp:Date.now(),wasCorrect:e,responseTime:t,sessionIndex:0}),o||(a.responseTimes||(a.responseTimes=[]),a.responseTimes.push(t),a.responseTimes.length>10&&(a.responseTimes=a.responseTimes.slice(-10))),a.learningHistory.length>20&&(a.learningHistory=a.learningHistory.slice(-20)),a.difficultyScore=cX(a);const d=a.masteryLevel;a.masteryLevel=lX(a),d!==a.masteryLevel&&_.log(`üîÑ ${n}: ${d} ‚Üí ${a.masteryLevel} (Ê≠£Ëß£: ${a.correctCount}, ‰∏çÊ≠£Ëß£: ${a.incorrectCount}, ÈÄ£Á∂ö: ${a.consecutiveCorrect})`);const h=l0(a,e);h.isMastered&&(a.skipExcludeUntil=Date.now()+h.excludeDays*24*60*60*1e3,uX(n),h.reason!=="Êú™ÂÆöÁùÄ"&&_.log(`‚úÖ ${n} „ÅåÂÆöÁùÄ: ${h.reason} (Èô§Â§ñÊúüÈñì: ${h.excludeDays}Êó•)`));const f=new Pl().recalculatePriorityAfterAnswer(n,a,c);if(c==="memorization"?a.memorizationPosition=f:c==="translation"?a.translationPosition=f:c==="spelling"?a.spellingPosition=f:c==="grammar"&&(a.grammarPosition=f),a.position=f,c){const m=c==="translation"?"ÂíåË®≥":c==="spelling"?"„Çπ„Éö„É´":c==="grammar"?"ÊñáÊ≥ï":c==="memorization"?"ÊöóË®ò":"Ë™≠Ëß£";i.results.push({id:`word-${n}-${Date.now()}`,questionSetId:"individual-word",questionSetName:m,score:e?1:0,total:1,percentage:e?100:0,date:Date.now(),timeSpent:t/1e3,incorrectWords:e?[]:[n],mode:c,difficulty:a.difficultyScore>.7?"advanced":a.difficultyScore>.4?"intermediate":"beginner"})}await Cr(i);try{if(typeof window<"u"){const m=new CustomEvent(na,{detail:{word:n,isCorrect:e,responseTime:t,mode:c}});window.dispatchEvent(m)}}catch{}try{if(typeof window<"u"&&f>=60){const m=new CustomEvent("weak-word-detected",{detail:{word:n,position:f,mode:c,isIncorrect:!e,timestamp:Date.now()}});window.dispatchEvent(m)}}catch{}}function uX(n){const e="reading-passages-data",t=localStorage.getItem(e);if(t)try{const s=JSON.parse(t);let r=!1;if(s.forEach(o=>{o.phrases&&o.phrases.forEach(i=>{i.segments&&i.segments.forEach(a=>{a.word.toLowerCase()===n.toLowerCase()&&a.isUnknown&&(a.isUnknown=!1,r=!0)})})}),r)try{localStorage.setItem(e,JSON.stringify(s))}catch(o){if(o instanceof DOMException&&o.name==="QuotaExceededError")_.warn("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±ÊïóÔºàÂÆπÈáèË∂ÖÈÅéÔºâ„ÄÇ„Éá„Éº„Çø„ÇíÂúßÁ∏Æ„Åó„Åæ„Åô„ÄÇ"),localStorage.removeItem(e),_.log("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇÊ¨°ÂõûË™≠„ÅøËæº„ÅøÊôÇ„Å´ÂÜçÂèñÂæó„Åï„Çå„Åæ„Åô„ÄÇ");else throw o}}catch(s){_.error("Èï∑ÊñáË™≠Ëß£„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞„Ç®„É©„Éº:",s)}}function Eh(n,e=30){const t=it();t.wordProgress[n]||(t.wordProgress[n]=uI(n));const s=t.wordProgress[n];s.skippedCount=(s.skippedCount||0)+1,s.lastSkipped=Date.now(),s.skipExcludeUntil=Date.now()+e*24*60*60*1e3,Cr(t)}function u0(n){const t=it().wordProgress[n];return t?!!(t.skipExcludeUntil&&Date.now()<t.skipExcludeUntil||t.masteryLevel==="mastered"&&t.nextReviewDate&&Date.now()<t.nextReviewDate):!1}function d0(n){return n.filter(e=>!u0(e.word))}function Vu(n){return it().wordProgress[n]||null}function Pi(){const n=it();return Object.values(n.wordProgress)}async function h0(n,e){const t=await is();t.wordProgress[n]||(t.wordProgress[n]={word:n,correctCount:0,incorrectCount:0,consecutiveCorrect:0,consecutiveIncorrect:0,lastStudied:Date.now(),totalResponseTime:0,averageResponseTime:0,difficultyScore:0,masteryLevel:"new",responseTimes:[],confusedWith:[],confusionCount:0,lastConfused:Date.now()});const s=t.wordProgress[n];s.confusedWith||(s.confusedWith=[]),s.confusedWith.push({word:e,timestamp:Date.now()}),s.confusedWith.length>10&&(s.confusedWith=s.confusedWith.slice(-10)),s.confusionCount=(s.confusionCount||0)+1,s.lastConfused=Date.now(),s.difficultyScore=Math.min(100,(s.difficultyScore||0)+5),await Cr(t),_r(t)}function p0(n=20){return Pi().filter(t=>(t.confusionCount||0)>0).sort((t,s)=>{const r=(s.confusionCount||0)-(t.confusionCount||0);return r!==0?r:(s.lastConfused||0)-(t.lastConfused||0)}).slice(0,n)}function f0(n){let t=it().results;return n&&(t=t.filter(s=>s.mode===n)),t.reduce((s,r)=>s+r.total,0)}function dI(n){const e=it(),t=new Set;for(const[s,r]of Object.entries(e.wordProgress)){const o=r.correctCount>0||r.incorrectCount>0,i=r.skippedCount&&r.skippedCount>0;(o||i)&&t.add(s)}return t.size}function Rh(){const n=it();let e=0;for(const t of Object.values(n.wordProgress)){const r=t.correctCount+t.incorrectCount===1&&t.correctCount===1,o=t.consecutiveCorrect>=3,i=t.skippedCount&&t.skippedCount>0;(r||o||i)&&e++}return e}function Uu(){const n=it(),t=Object.values(n.wordProgress).filter(i=>i.correctCount+i.incorrectCount>0);let s=0;t.forEach(i=>{const a=i.correctCount+i.incorrectCount,c=a>0?i.correctCount/a*100:0,l=i.masteryLevel==="mastered",d=a===1&&i.correctCount===1,h=a>=5&&c>=85,p=a>=3&&c>=90,f=i.consecutiveCorrect>=5,m=a>=10&&c>=75;(l||d||h||p||f||m)&&s++});const r=t.length>0?s/t.length*100:0,o=Math.min(100,Math.max(0,r));return{retentionRate:Math.round(o),masteredCount:s,appearedCount:t.length}}async function m0(){try{await ak(),_.log("‚úÖ IndexedDBÂâäÈô§ÂÆå‰∫Ü")}catch(t){_.error("IndexedDBÂâäÈô§„Ç®„É©„Éº:",t)}const n=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&(s.startsWith("quiz-result-")||s==="quiz-app-user-progress"||s==="progress-data"||s.startsWith("session-history-")||s==="session-history"||s==="skipped-words"||s==="skip-groups"||s==="improvement-progress"||s==="study-settings"||s==="reading-passages-data"||s==="all-questions-cache")&&n.push(s)}n.forEach(t=>{try{localStorage.removeItem(t)}catch(s){_.error(`Failed to remove ${t}:`,s)}});const e=ri();Cr(e),_.log(`‚úÖ „É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü: LocalStorage ${n.length}ÂÄã„ÅÆ„Ç≠„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`),window.location.reload()}function g0(n=14){const e=it(),t=new Date,s=[];_.log("üìä getStudyCalendarByModeÂëº„Å≥Âá∫„Åó - progress.results‰ª∂Êï∞:",e.results.length);for(let r=n-1;r>=0;r--){const o=new Date(t);o.setDate(o.getDate()-r);const i=k0(o),a=new Date(o).setHours(0,0,0,0),c=new Date(o).setHours(23,59,59,999),l=e.results.filter(g=>g.date>=a&&g.date<=c),d={count:0,correct:0},h={count:0,correct:0},p={count:0,correct:0},f={count:0,correct:0};l.forEach(g=>{var y;const x=((y=g.mode)==null?void 0:y.toLowerCase())||"";x.includes("memorization")||x.includes("ÊöóË®ò")?(d.count+=g.total,d.correct+=g.score):x.includes("translation")||x.includes("ÂíåË®≥")?(h.count+=g.total,h.correct+=g.score):x.includes("spelling")||x.includes("„Çπ„Éö„É´")?(p.count+=g.total,p.correct+=g.score):(x.includes("grammar")||x.includes("ÊñáÊ≥ï"))&&(f.count+=g.total,f.correct+=g.score)});const m=d.count+h.count+p.count+f.count;s.push({date:i,memorization:d,translation:h,spelling:p,grammar:f,total:m})}return s}function x0(n=12){const e=it(),t=new Date,s=[];let r=0,o=0;for(let i=n-1;i>=0;i--){const a=new Date(t);a.setDate(t.getDate()-i*7),a.setHours(23,59,59,999);const c=new Date(a);c.setDate(a.getDate()-6),c.setHours(0,0,0,0);const d=e.results.filter(f=>f.date>=c.getTime()&&f.date<=a.getTime()).reduce((f,m)=>f+m.total,0);o+=d;let h=0;Object.values(e.wordProgress).forEach(f=>{f.masteryLevel==="mastered"&&f.lastStudied>=c.getTime()&&f.lastStudied<=a.getTime()&&h++}),r+=h;const p=`${c.getMonth()+1}/${c.getDate()}`;s.push({weekLabel:p,cumulativeMastered:r,weeklyMastered:h,cumulativeAnswered:o,weeklyAnswered:d})}return s}function y0(){const n=it(),e=Date.now(),t=e-7*24*60*60*1e3,s=e-30*24*60*60*1e3,r=new Set,o=new Set,i=new Set,a=new Set,c=new Set,l=new Set;return n.results.forEach(d=>{d.incorrectWords.forEach(h=>{c.add(h),d.date>=s&&i.add(h),d.date>=t&&r.add(h)})}),Object.entries(n.wordProgress).forEach(([d,h])=>{h.masteryLevel==="mastered"&&(l.add(d),h.lastStudied>=s&&a.add(d),h.lastStudied>=t&&o.add(d))}),{last7Days:Math.min(100,Math.max(0,r.size>0?o.size/r.size*100:0)),last30Days:Math.min(100,Math.max(0,i.size>0?a.size/i.size*100:0)),allTime:Math.min(100,Math.max(0,c.size>0?l.size/c.size*100:0))}}function Gu(n){const t=it().wordProgress[n];if(!t)return null;const s=t.correctCount,r=t.correctCount+t.incorrectCount,a=(t.learningHistory||[]).slice(-10).map(p=>p.wasCorrect?"üü©":"üü•").join("");let c=0;if(r===0)c=0;else{const p=s/r*70,f=Math.min(20,(t.consecutiveCorrect||0)*5),m=(Date.now()-t.lastStudied)/(24*60*60*1e3),g=Math.min(10,Math.max(0,(m-1)*2));c=Math.min(100,Math.max(0,p+f-g)),t.masteryLevel==="mastered"&&(c=Math.max(90,c))}let l="new",d="Êú™Â≠¶Áøí",h="‚ö™";return r===0?(l="new",d="Êú™Â≠¶Áøí",h="‚ö™"):t.masteryLevel==="mastered"||c>=80?(l="mastered",d="ÂÆöÁùÄÊ∏à",h="üü¢"):c>=50?(l="learning",d="Â≠¶Áøí‰∏≠",h="üü°"):(l="struggling",d="Ë¶ÅÂæ©Áøí",h="üî¥"),{correctCount:s,totalCount:r,accuracyHistory:a,retentionRate:Math.round(c),status:l,statusLabel:d,statusIcon:h,position:t.position,memorizationPosition:t.memorizationPosition,translationPosition:t.translationPosition,spellingPosition:t.spellingPosition,grammarPosition:t.grammarPosition}}async function b0(n){try{await ya("memorization-card-settings",n)}catch(e){_.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-card-settings",JSON.stringify(n))}}async function w0(){try{const n=await mc("memorization-card-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"showFurigana"in n?n:null:null}catch(n){_.error("„Ç´„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-card-settings");return e?JSON.parse(e):null}}async function v0(n){try{await ya("memorization-settings",n)}catch(e){_.error("ÊöóË®òË®≠ÂÆö„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e),localStorage.setItem("memorization-settings",JSON.stringify(n))}}async function S0(){try{const n=await mc("memorization-settings");return n?typeof n=="string"?JSON.parse(n):typeof n=="object"&&"shuffleOrder"in n?n:null:null}catch(n){_.error("ÊöóË®òË®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n);const e=localStorage.getItem("memorization-settings");return e?JSON.parse(e):null}}async function C0(n){try{const e=await mc("memorization-behaviors"),s=[...e?typeof e=="string"?JSON.parse(e):e:[],n].slice(-1e3);await ya("memorization-behaviors",s)}catch(e){_.error("ÊöóË®òË°åÂãïË®òÈå≤„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}const hI="custom-question-sets";async function Dh(){try{const n=await mc(hI);return n?typeof n=="string"?JSON.parse(n):Array.isArray(n)?n:[]:[]}catch(n){return _.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÂèñÂæó„Ç®„É©„Éº:",n),[]}}async function Hu(n){try{const e=await Dh(),t=e.findIndex(s=>s.id===n.id);t>=0?e[t]={...n,updatedAt:Date.now()}:e.push(n),await ya(hI,e)}catch(e){throw _.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà‰øùÂ≠ò„Ç®„É©„Éº:",e),e}}async function qu(n,e=20,t=3,s=60,r){const a=Ah(100).filter(l=>l.mistakes>=t&&l.recentAccuracy<=s).slice(0,e).map(l=>{const d=r.find(h=>h.word.toLowerCase()===l.word.toLowerCase());return d||{word:l.word,reading:l.reading||"",meaning:l.meaning||"",etymology:"",relatedWords:"",relatedFields:"",difficulty:"intermediate"}});return{id:`weak-words-${Date.now()}`,name:n,source:"weak-words",questions:a,createdAt:Date.now(),updatedAt:Date.now(),isAutoUpdate:!0,autoUpdateConfig:{limit:e,minMistakes:t,maxAccuracy:s},metadata:{description:`Ëã¶ÊâãË™ûÂè•„Åã„ÇâËá™ÂãïÁîüÊàêÔºàÈñìÈÅï„ÅÑ${t}Âõû‰ª•‰∏ä„ÄÅÊ≠£Á≠îÁéá${s}%‰ª•‰∏ãÔºâ`,totalWords:a.length}}}function Ku(){const n=it(),s=Object.values(n.wordProgress).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.word.startsWith("grammar_")||a.word.includes("_g")).filter(a=>a.grammarAttempts&&a.grammarAttempts>0||a.correctCount+a.incorrectCount>0);let r=0;s.forEach(a=>{const c=a.grammarAttempts||a.correctCount+a.incorrectCount,l=a.grammarCorrect||a.correctCount,d=a.grammarStreak||a.consecutiveCorrect,h=c>0?l/c*100:0,p=a.masteryLevel==="mastered",f=c===1&&l===1,m=c>=5&&h>=85,g=c>=3&&h>=90,x=d>=5,y=c>=10&&h>=75;(p||f||m||g||x||y)&&r++});const o=s.length>0?r/s.length*100:0,i=Math.min(100,Math.max(0,o));return{retentionRate:Math.round(i),masteredCount:r,appearedCount:s.length}}async function N0(){const n=i0();return(await Promise.all(n.map(async t=>{const s=t.unit.match(/‰∏≠(\d+)_Unit(\d+)/);if(!s)return null;const r=s[1],o=s[2];try{const i=await fetch(`/data/grammar/grammar_grade${r}_unit${o}.json`);if(i.ok){const a=await i.json();return a.enabled===!1?null:{...t,title:a.title||""}}}catch{return null}return null}))).filter(t=>t!==null)}function I0(n,e="memorization"){const t=it(),s={incorrect:0,still_learning:0,mastered:0,new:0,total:n.length};return n.forEach(r=>{const o=t.wordProgress[r.word];if(!o){s.new++;return}const i=Ut(o,e);i>=70?s.incorrect++:i>=40?s.still_learning++:i>=20?s.new++:s.mastered++}),s}const $y=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:pc,addSessionHistory:xa,calculateSessionStats:I0,checkFlexibleMastery:l0,createWeakWordsQuestionSet:qu,filterSkippedWords:d0,getAllWordProgress:Pi,getConfusedWords:p0,getCumulativeProgressData:x0,getCurrentWeakWords:Ah,getCustomQuestionSets:Dh,getDetailedRetentionStats:zu,getGrammarDetailedRetentionStats:Wu,getGrammarRetentionRateWithAI:Ku,getGrammarUnitStats:i0,getGrammarUnitStatsWithTitles:N0,getMemorizationCardSettings:w0,getMemorizationDetailedRetentionStats:Bu,getMemorizationSettings:S0,getMonthlyStats:r0,getNearMasteryStats:lI,getOvercomeWeakWords:c0,getRecentlyMasteredWords:o0,getRetentionRateWithAI:Uu,getRetentionTrend:y0,getStudyCalendarByMode:g0,getStudySettings:n0,getTodayIncorrectWords:Ou,getTodayStats:Lu,getTotalAnsweredCount:f0,getTotalMasteredWordsCount:Rh,getUniqueQuestionedWordsCount:dI,getWeeklyStats:s0,getWordDetailedData:Gu,getWordProgress:Vu,isWordSkipExcluded:u0,loadProgress:is,loadProgressSync:it,recordConfusion:h0,recordMemorizationBehavior:C0,recordWordSkip:Eh,resetAllProgress:m0,saveCustomQuestionSet:Hu,saveMemorizationCardSettings:b0,saveMemorizationSettings:v0,saveProgress:Cr,updateProgressCache:_r,updateWordProgress:Co},Symbol.toStringTag,{value:"Module"}));function Qa(n){const e=n.trim().split(`
`);if(e.length===0)return[];function t(i){const a=[];let c="",l=!1;for(let d=0;d<i.length;d++){const h=i[d],p=i[d+1];h==='"'?l&&p==='"'?(c+='"',d++):l=!l:h===","&&!l?(a.push(c.trim()),c=""):c+=h}return a.push(c.trim()),a}let s=0;const r=e[0].trim();(r.includes("Ë™ûÂè•")||r.includes("term")||r.includes("Ë™≠„Åø")||r.includes("reading")||r.includes("ÊÑèÂë≥")||r.includes("meaning"))&&(s=1);const o=[];for(let i=s;i<e.length;i++){const a=e[i].trim();if(!a||a.startsWith("//")||a.startsWith("#"))continue;const c=t(a);if(c.length>=3){const l=c[0]||"",d=c[1]||"",h=c[2]||"",p=c[3]||"";let f="",m="",g="";c.length>=8?(f=(c[4]||"")+(c[5]||""),m=c[6]||"",g=c[7]||""):(f=c[4]||"",m=c[5]||"",g=c[6]||"");let x="";g.includes("ÂàùÁ¥ö")||g==="beginner"?x="beginner":g.includes("‰∏≠Á¥ö")||g==="intermediate"?x="intermediate":(g.includes("‰∏äÁ¥ö")||g==="advanced")&&(x="advanced"),m&&!ek(m)&&_.warn(`[„Éá„Éº„ÇøÊï¥ÂêàÊÄßË≠¶Âëä] ‰∏çÊ≠£„Å™„Ç´„ÉÜ„Ç¥„É™: "${m}" (ÂçòË™û: "${l}")
ÊúâÂäπ„Å™„Ç´„ÉÜ„Ç¥„É™: ${Jy.join(", ")}
ÂèÇÁÖß: docs/specifications/19-junior-high-vocabulary.md`),l&&h&&o.push({word:l,reading:d,meaning:h,etymology:p,relatedWords:f,relatedFields:m,category:m,difficulty:x})}}return o}function No(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function pI(n,e,t){const s=[],r=e.filter((a,c)=>c!==t),o=No(r);for(let a=0;a<o.length&&s.length<2;a++){const c=o[a];c.meaning!==n.meaning&&!s.some(l=>l.meaning===c.meaning)&&s.push(c)}for(;s.length<2;)s.push({word:`„ÉÄ„Éü„Éº${s.length+1}`,meaning:`ÈÅ∏ÊäûËÇ¢${s.length+1}`,reading:"",etymology:"",relatedWords:"",relatedFields:"",category:"",difficulty:""});return[...No([{text:n.meaning,question:n},...s.map(a=>({text:a.meaning,question:a}))]),{text:"ÂàÜ„Åã„Çâ„Å™„ÅÑ",question:null}]}const dX="quizApp_questionSets";function fI(n){try{localStorage.setItem(dX,JSON.stringify(n))}catch(e){_.error("Failed to save question sets:",e)}}function k0(n){const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${s}`}const na="quiz-result-added";function fc(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function mI(n,e=10){const s=Pi().filter(o=>o.difficultyScore>=50).sort((o,i)=>i.difficultyScore-o.difficultyScore).map(o=>o.word.toLowerCase()),r=n.filter(o=>s.includes(o.word.toLowerCase()));return No(r).slice(0,Math.min(e,r.length))}function gI(n){if(!n.includes(" "))return"word";const e=n.toLowerCase(),t=e.split(" "),s=["get","go","come","take","make","put","look","turn","break","bring","call","carry","check","figure","fill","find","give","hand","hang","hold","keep","knock","lay","let","pass","pick","pull","push","run","set","show","shut","sit","stand","stay","stick","take","talk","think","throw","try","work","write"],r=["up","down","in","out","on","off","away","back","over","through","around","across","along","about","after","for","from","into","to","with"];return t.length>=2&&s.includes(t[0])&&t.slice(1).some(d=>r.includes(d))?"phrasal-verb":[/^a .+ of$/,/^the .+ (of|in)$/,/^(break|beat|hit|kick) (the|a)/,/^(catch|have|take|make) (a|an|the)/,/(eye|eyes|face|hand|tongue|ear|nose|heart|mind|bone)/i,/^once in a/,/^(cost|pay|worth) (an|a)/,/^at .+ (heart|first|last|once)/].some(l=>l.test(e))?"idiom":[/^(in|on|at|by|with|from|to) (the|a|an) /,/^(make|take|do|have|get) (a|an|the) /,/(strong|weak|heavy|light|high|low|good|bad|big|small) /i].some(l=>l.test(e))?"collocation":"other"}function hX(n,e=90){const t=Math.floor(e/3),s=Math.floor(e*2/3);return n<=t?1:n<=s?2:3}function pX(n){const e=Pi(),t=new Map;return e.forEach(s=>{t.set(s.word.toLowerCase(),s)}),n.filter(s=>{const r=t.get(s.word.toLowerCase());return!r||r.masteryLevel==="new"})}function fX(n){const e=Date.now(),t=Pi(),s=new Map;return t.forEach(r=>{s.set(r.word.toLowerCase(),r)}),n.filter(r=>{const o=s.get(r.word.toLowerCase());if(!o)return!1;const i=(e-o.lastStudied)/(1e3*60*60*24);let a;switch(o.masteryLevel){case"new":a=1;break;case"learning":a=Math.min(7,o.consecutiveCorrect+1);break;case"mastered":a=Math.min(30,o.consecutiveCorrect*2);break;default:a=1}return i>=a})}function mX(n,e,t){let s;switch(e){case 1:s=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),s.length<t&&(s=[...s,...n.filter(c=>c.difficulty==="‰∏≠Á¥ö")]);break;case 2:const r=n.filter(c=>c.difficulty==="ÂàùÁ¥ö"),o=n.filter(c=>c.difficulty==="‰∏≠Á¥ö");s=[...r,...o];break;case 3:const i=n.filter(c=>c.difficulty==="‰∏≠Á¥ö"),a=n.filter(c=>c.difficulty==="‰∏äÁ¥ö");s=[...i,...a];break}return No(s).slice(0,t)}function xI(n,e){const t=n.currentDay,s=hX(t,n.totalDays),r=pX(e),o=fX(e),i=Math.ceil(n.dailyGoals.newWords*.3),a=mX(r,s,i),c=Math.ceil(n.dailyGoals.reviewWords*.4),l=mI(o.length>0?o:e,c),d=Math.floor(i*.3),h=Math.ceil(n.dailyGoals.reviewWords*.3),p=[...No(a).slice(0,d),...No(o.length>0?o:e).slice(0,h)];return{date:n.startDate+(t-1)*24*60*60*1e3,dayNumber:t,phase:s,morning:{newWords:a,duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"discovery"},afternoon:{reviewWords:l,duration:Math.ceil(n.dailyGoals.timeMinutes*.3),mode:"weakness"},evening:{mixedWords:No(p),duration:Math.ceil(n.dailyGoals.timeMinutes*.35),mode:"mixed"},completed:!1,actualAccuracy:0}}function yI(n){const e=Pi(),t=e.filter(l=>l.masteryLevel!=="new").length,s=e.reduce((l,d)=>l+d.correctCount+d.incorrectCount,0),r=e.reduce((l,d)=>l+d.correctCount,0),o=s>0?r/s*100:0,i=t/n.currentDay,c=(4700-t)/(i||50);return{totalLearned:t,totalReviewed:s,averageAccuracy:o,estimatedCompletion:Math.ceil(c)}}function bI(n){const e=Math.ceil(n.currentDay/7),t=n.dailyGoals.newWords*7,s=n.weeklyProgress.find(r=>r.week===e);return s?s.wordsLearned/t*100:0}const gX=Object.freeze(Object.defineProperty({__proto__:null,QUIZ_RESULT_EVENT:na,calculateProgress:yI,calculateWeeklyAchievement:bI,classifyPhraseType:gI,formatLocalYYYYMMDD:k0,generateChoicesWithQuestions:pI,generateDailyPlan:xI,generateId:fc,parseCSV:Qa,saveQuestionSets:fI,selectWeakQuestions:mI,shuffle:No},Symbol.toStringTag,{value:"Module"}));function xX(){const[n]=T.useState(()=>{const t=localStorage.getItem("autoAdvance");return t?JSON.parse(t):!1}),[e]=T.useState(()=>{const t=localStorage.getItem("autoAdvanceDelay");return t?parseInt(t,10):1500});return{autoAdvance:n,autoAdvanceDelay:e}}function yX(){const[n,e]=T.useState([]),[t,s]=T.useState("all"),[r,o]=T.useState("all"),[i,a]=T.useState("all"),[c,l]=T.useState("all"),[d,h]=T.useState(()=>{const p=localStorage.getItem("selectedDataSource");if(p)try{return JSON.parse(p)}catch{return"all"}return"all"});return{categoryList:n,setCategoryList:e,selectedCategory:t,setSelectedCategory:s,selectedDifficulty:r,setSelectedDifficulty:o,selectedWordPhraseFilter:i,setSelectedWordPhraseFilter:a,selectedPhraseTypeFilter:c,setSelectedPhraseTypeFilter:l,selectedDataSource:d,setSelectedDataSource:h}}function bX(){const[n,e]=T.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[t,s]=T.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),[r,o]=T.useState(!1),[i,a]=T.useState([]),[c,l]=T.useState(new Map);return{sessionStats:n,setSessionStats:e,quizState:t,setQuizState:s,reviewFocusMode:r,setReviewFocusMode:o,reviewQuestionPool:i,setReviewQuestionPool:a,reviewCorrectStreak:c,setReviewCorrectStreak:l}}const wI="customQuestionSets";function wX(){try{const n=localStorage.getItem(wI);if(n){const e=JSON.parse(n);return{sets:e.sets||[],activeSetId:e.activeSetId||null,recentSetIds:e.recentSetIds||[]}}}catch(n){console.error("Failed to load custom question state:",n)}return{sets:[],activeSetId:null,recentSetIds:[]}}function vX(n){try{localStorage.setItem(wI,JSON.stringify(n))}catch(e){console.error("Failed to save custom question state:",e)}}function SX(n,e,t,s){const r=new Date().toISOString();return{id:`set_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:n,description:e,words:[],createdAt:r,updatedAt:r,icon:t,color:s}}function CX(n,e,t){const s=n.sets.map(r=>r.id!==e||r.words.some(o=>o.word===t.word)?r:{...r,words:[...r.words,{...t,addedAt:new Date().toISOString()}],updatedAt:new Date().toISOString()});return{...n,sets:s,recentSetIds:$X(n.recentSetIds,e)}}function NX(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,words:r.words.filter(o=>o.word!==t.word),updatedAt:new Date().toISOString()});return{...n,sets:s}}function IX(n,e){return{...n,sets:n.sets.filter(t=>t.id!==e),activeSetId:n.activeSetId===e?null:n.activeSetId,recentSetIds:n.recentSetIds.filter(t=>t!==e)}}function kX(n,e,t){const s=n.sets.map(r=>r.id!==e?r:{...r,...t,updatedAt:new Date().toISOString()});return{...n,sets:s}}function $X(n,e){const t=n.filter(r=>r!==e);return[e,...t].slice(0,5)}class TX{constructor(){Ee(this,"map",new Map);Ee(this,"seqIndex",0);Ee(this,"startedAt",Date.now())}reset(){this.map.clear(),this.seqIndex=0,this.startedAt=Date.now()}onShown(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.timesShown+=1,this.map.set(e,t),this.seqIndex+=1}onAnswer(e,t){const s=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};if(!t)s.timesWrong+=1,s.lastWrongIndex=this.seqIndex;else if(s.lastWrongIndex!==void 0){const r=Math.max(0,this.seqIndex-s.lastWrongIndex);s.lags.push(r),s.lastWrongIndex=void 0}this.map.set(e,s)}onReAdd(e){const t=this.map.get(e)||{timesShown:0,timesWrong:0,lags:[],readds:0};t.readds+=1,this.map.set(e,t)}summarize(){const e=Array.from(this.map.values()),t=e.length,s=e.filter(c=>c.timesShown>=2).length,r=t>0?s/t:0,o=e.flatMap(c=>c.lags),i=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length/2)]:0,a=o.length?[...o].sort((c,l)=>c-l)[Math.floor(o.length*.9)]:0;return{totalItems:t,reappearanceRate:r,medianLag:i,p90Lag:a,durationSec:Math.round((Date.now()-this.startedAt)/1e3)}}}const Wr=new TX;function jl(){const n=T.useCallback((i,a,c,l)=>{if(!a||!Array.isArray(a))return console.warn("[useQuestionRequeue] questions is null or not an array"),[];const d=i.id??i.word??String(i.japanese??""),h=i.position,p=Number.isFinite(h)?Number(h):void 0,f=(()=>{var B;if(l)try{const Y=it(),K=String(i.word??d??""),pe=(B=Y==null?void 0:Y.wordProgress)==null?void 0:B[K];return pe?Ut(pe,l):35}catch{return}})(),m=f??p,g={...i,sessionPriority:Date.now(),reAddedCount:(i.reAddedCount||0)+1},x=i.reAddedCount||0,y=m!==void 0&&m>=70,b=y?1+Math.floor(Math.random()*2):3+Math.floor(Math.random()*3),v=y?Math.min(x*3,18):Math.min(x*2,12),S=Math.min(c+1+12,a.length),C=a.slice(c+1,S).filter(B=>!!(B!=null&&B.sessionPriority)).length,k=y?Math.min(C*2,12):Math.min(C,8),I=b+v+k,$=B=>{try{const Y="debug_requeue_events",K=localStorage.getItem(Y),pe=K?JSON.parse(K):[];pe.push(B),pe.length>30&&pe.shift(),localStorage.setItem(Y,JSON.stringify(pe))}catch{}},j=Math.min(30,Math.max(10,I+5)),P=Math.min(c+j+1,a.length),A=a.slice(c+1,P).findIndex(B=>((B==null?void 0:B.id)??(B==null?void 0:B.word)??String((B==null?void 0:B.japanese)??""))===d);if(A>=0){const B=c+1+A;if(y){const Y=Math.min(c+I,a.length);if(B<=Y)return $({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"skipped_exists_nearby",reason:"incorrect_like",currentIndex:c,windowEnd:P,baseOffset:b,extraDelay:v,plannedOffset:I,questionPosition:p??null,ssotPosition:f??null,effectivePosition:m??null,reAddedCountBefore:x,note:"already_scheduled_soon",existingNearbyAbsIndex:B}),a;const K=a[B],pe=((K==null?void 0:K.reAddedCount)||0)+1,ge={...K,sessionPriority:Date.now(),reAddedCount:pe},re=[...a.slice(0,B),...a.slice(B+1)],ye=Math.min(Y,re.length),Ae=[...re.slice(0,ye),ge,...re.slice(ye)];return $({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"inserted",reason:"incorrect_like",currentIndex:c,baseOffset:b,extraDelay:v,plannedOffset:I,insertAt:ye,originalInsertAt:B,movedExisting:!0,questionPosition:p??null,ssotPosition:f??null,effectivePosition:m??null,reAddedCountBefore:(K==null?void 0:K.reAddedCount)??null,reAddedCountAfter:pe}),Ae}return $({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"skipped_exists_nearby",reason:y?"incorrect_like":"still_learning_like",currentIndex:c,windowEnd:P,baseOffset:b,extraDelay:v,plannedOffset:I,questionPosition:p??null,ssotPosition:f??null,effectivePosition:m??null,reAddedCountBefore:x}),a}let L=Math.min(c+I,a.length);const U=L;let V=!1;if(m!==void 0&&m>=40){const B=Math.max(L,c+1),K=Math.min(B+(y?10:30),a.length);let pe=-1;for(let ge=B;ge<K;ge++){const re=a[ge].position;re!==void 0&&re>=40&&(pe=ge)}if(pe>=0){const ge=L;L=pe+1,V=L!==ge;try{const re={timestamp:new Date().toISOString(),word:String(d),position:m,baseOffset:b,extraDelay:v,originalInsert:ge,adjustedInsert:L,currentIndex:c,nearbyHighPositions:a.slice(B,K).filter(ve=>{const _e=ve.position;return _e!==void 0&&_e>=40}).map(ve=>({word:ve.word||ve.id,position:ve.position}))},ye=localStorage.getItem("debug_position_aware_insertions"),Ae=ye?JSON.parse(ye):[];Ae.push(re),Ae.length>30&&Ae.shift(),localStorage.setItem("debug_position_aware_insertions",JSON.stringify(Ae))}catch{}}}try{Wr.onReAdd(String(d))}catch{}return $({timestamp:new Date().toISOString(),mode:l??"unknown",word:String(i.word??d),qid:String(d),decision:"inserted",reason:y?"incorrect_like":"still_learning_like",currentIndex:c,baseOffset:b,extraDelay:v,plannedOffset:I,insertAt:L,originalInsertAt:U,positionAwareAdjusted:V,questionPosition:p??null,ssotPosition:f??null,effectivePosition:m??null,reAddedCountBefore:x,reAddedCountAfter:x+1}),[...a.slice(0,L),g,...a.slice(L)]},[]),e=T.useCallback((i,a)=>a>=i.length-1?i:i.map((c,l)=>{if(c.sessionPriority&&l>a&&l-a>5){const{sessionPriority:d,...h}=c;return h}return c}),[]),t=T.useCallback(i=>(i.reAddedCount||0)>0,[]),s=T.useCallback((i,a,c)=>{const l=(i.reAddedCount||0)>0;c(d=>({...d,newQuestions:l?d.newQuestions:(d.newQuestions||0)+1,reviewQuestions:l?(d.reviewQuestions||0)+1:d.reviewQuestions||0,consecutiveNew:l?0:(d.consecutiveNew||0)+1,consecutiveReview:l?(d.consecutiveReview||0)+1:0}))},[]),r=T.useCallback((i,a)=>{const c=[];return i.forEach((l,d)=>{if(d>a&&l.sessionPriority){const h=String(l.word||l.japanese||"(unknown)");c.push({word:h,reason:"still_learning",insertAt:d+1,timestamp:l.sessionPriority})}}),c},[]),o=T.useCallback((i,a)=>{try{const c=it();if(!(c!=null&&c.wordProgress))return{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"LocalStorageÊú™ÂàùÊúüÂåñ"};let l=0,d=0;for(const p of i){const f=p.word;if(!f)continue;const m=p.position,g=Number.isFinite(m)?Number(m):null;if(g===null)continue;const x=c.wordProgress[f];if(!x)continue;const y=Ut(x,a),b=Math.abs(y-g);b>=5&&(l++,d+=b)}const h=l>=10&&d>=200;return{needsRescheduling:h,mismatchCount:l,totalDiff:d,reason:h?`‰∏çÊï¥Âêà${l}Ë™ûÔºàÂ∑ÆÂàÜÂêàË®à: ${d}Ôºâ`:"Ê≠£Â∏∏ÁØÑÂõ≤ÂÜÖ"}}catch(c){return console.error("[useQuestionRequeue] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",c),{needsRescheduling:!1,mismatchCount:0,totalDiff:0,reason:"„ÉÅ„Çß„ÉÉ„ÇØÂ§±Êïó"}}},[]);return{reAddQuestion:n,clearExpiredFlags:e,isReviewQuestion:t,updateRequeueStats:s,getRequeuedWords:r,checkPositionMismatch:o}}const vI="learning-assistant-skip-groups",AX=5*60*1e3;function $0(){try{const n=localStorage.getItem(vI);return n?JSON.parse(n):[]}catch(n){return _.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",n),[]}}function T0(n){try{localStorage.setItem(vI,JSON.stringify(n))}catch(e){_.error("„Çπ„Ç≠„ÉÉ„Éó„Ç∞„É´„Éº„Éó„ÅÆ‰øùÂ≠ò„Ç®„É©„Éº:",e)}}function SI(n){const e=$0(),t=Date.now(),s=e.find(r=>r.verificationStatus==="pending"&&t-r.timestamp<AX);s?s.words.includes(n)||s.words.push(n):e.push({timestamp:t,words:[n],verificationStatus:"pending",suspiciousWords:[]}),T0(e)}function CI(n){const e=$0(),t=it(),s=e.find(r=>r.words.includes(n));s&&s.verificationStatus==="pending"&&(s.verificationStatus="suspicious",s.suspiciousWords=s.words.filter(r=>r!==n),s.suspiciousWords.forEach(r=>{if(t.wordProgress[r]){const o=t.wordProgress[r];delete o.skipExcludeUntil,o.masteryLevel="learning",o.consecutiveCorrect=0,o.needsVerification=!0,o.verificationReason=`ÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü„Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Å†„Å£„Åü„Åü„ÇÅ`}}),Cr(t),T0(e),_.log(`AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Äå${n}„Äç„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„Å´„Çπ„Ç≠„ÉÉ„Éó„Åó„Åü${s.suspiciousWords.length}ÂÄã„ÅÆÂçòË™û„ÇíÂÜçÂá∫È°åÂØæË±°„Å´„Åó„Åæ„Åô„ÄÇ`))}function NI(n){const e=$0(),t=it(),s=e.find(r=>r.words.includes(n));s&&(s.suspiciousWords=s.suspiciousWords.filter(o=>o!==n),s.words.every(o=>{const i=t.wordProgress[o];return i&&(i.correctCount>0||i.incorrectCount>0)})&&s.suspiciousWords.length===0&&(s.verificationStatus="verified"),t.wordProgress[n]&&(delete t.wordProgress[n].needsVerification,delete t.wordProgress[n].verificationReason),Cr(t),T0(e))}function EX(n,e){const t=it(),s=new Map;e.forEach(l=>{s.set(l,{correct:0,total:0,mastered:0,wordCount:0})}),t.results.forEach(l=>{if(l.category&&s.has(l.category)){const d=s.get(l.category);d.correct+=l.score,d.total+=l.total}}),n.forEach(l=>{const d=l.category;if(!d||!s.has(d))return;const h=s.get(d);h.wordCount++;const p=t.wordProgress[l.word];if(p){const f=p.correctCount+p.incorrectCount,m=f===1&&p.correctCount===1||p.consecutiveCorrect>=3||p.skippedCount&&p.skippedCount>0,g=f>=3&&p.correctCount/f>=.8&&p.consecutiveCorrect>=2;(m||g)&&h.mastered++}});const r=[],o=[];s.forEach((l,d)=>{if(l.total===0&&l.wordCount===0)return;const h=l.total>0?l.correct/l.total*100:0,p=l.wordCount>0?l.mastered/l.wordCount*100:0,f=h*.6+p*.4;if(f<60){let m,g,x;f<40?(m="critical",g=100,x=14):f<50?(m="moderate",g=70,x=10):(m="minor",g=40,x=7),l.total<10&&(g+=20),r.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,weaknessLevel:m,priorityScore:g,estimatedImprovementDays:x})}else if(f>=75){let m;f>=90?m="expert":f>=80?m="proficient":m="good",o.push({category:d,accuracy:h,totalAttempts:l.total,masteredWords:l.mastered,totalWords:l.wordCount,strengthLevel:m})}}),r.sort((l,d)=>d.priorityScore-l.priorityScore),o.sort((l,d)=>d.accuracy-l.accuracy);const i=RX(s),a=DX(r),c=_X(r,o,i);return{weakCategories:r,strongCategories:o,balanceScore:i,improvementPlan:a,aiRecommendations:c}}function RX(n){const e=[];if(n.forEach(i=>{if(i.total>0){const a=i.correct/i.total*100;e.push(a)}}),e.length===0)return 50;const t=e.reduce((i,a)=>i+a,0)/e.length,s=e.reduce((i,a)=>i+Math.pow(a-t,2),0)/e.length,r=Math.sqrt(s),o=Math.max(0,Math.min(100,100-r*2));return Math.round(o)}function DX(n){const e=[],t={},s=[],r=n.slice(0,3);r.forEach(i=>{e.push(i.category);let a;i.weaknessLevel==="critical"?a=15:i.weaknessLevel==="moderate"?a=10:a=5,t[i.category]=a;const c={day:Math.ceil(i.estimatedImprovementDays/2),category:i.category,targetAccuracy:Math.min(i.accuracy+20,80),description:`${i.category}„ÅÆÊ≠£Á≠îÁéá„Çí${Math.round(i.accuracy)}%„Åã„Çâ${Math.min(i.accuracy+20,80)}%„Å´ÊîπÂñÑ`};s.push(c)});const o=r.length>0?Math.max(...r.map(i=>i.estimatedImprovementDays)):0;return{targetCategories:e,dailyQuestions:t,estimatedCompletionDays:o,milestones:s}}function _X(n,e,t){const s=[];if(n.length>0){const o=n[0];s.push(`üéØ ÊúÄÂÑ™ÂÖà: „Äå${o.category}„Äç„ÇíÈáçÁÇπÂ≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºàÁèæÂú®${Math.round(o.accuracy)}% ‚Üí ÁõÆÊ®ô80%Ôºâ`),o.weaknessLevel==="critical"&&s.push(`‚ö†Ô∏è „Äå${o.category}„Äç„ÅØÈáçË¶Å„Å™Âº±ÁÇπ„Åß„Åô„ÄÇÊØéÊó•15Âïè‰ª•‰∏äÂèñ„ÇäÁµÑ„ÇÄ„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô`),n.length>=3&&s.push(`üìö ${n.length}ÂÄã„ÅÆÂº±ÁÇπÂàÜÈáé„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ1„Å§„Åö„Å§ÈõÜ‰∏≠„Åó„Å¶ÊîπÂñÑ„Åó„Åæ„Åó„Çá„ÅÜ`)}if(t<50?s.push(`‚öñÔ∏è Â≠¶Áøí„Éê„É©„É≥„Çπ„ÅåÂÅè„Å£„Å¶„ÅÑ„Åæ„ÅôÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„ÄÇÂº±ÁÇπÂàÜÈáé„Å´ÊôÇÈñì„ÇíÈÖçÂàÜ„Åó„Åæ„Åó„Çá„ÅÜ`):t>=80&&s.push(`‚ú® Á¥†Êô¥„Çâ„Åó„ÅÑ„Éê„É©„É≥„Çπ„Åß„ÅôÔºÅÔºà„Éê„É©„É≥„Çπ„Çπ„Ç≥„Ç¢: ${t}%Ôºâ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ôÁ∂ö„Åó„Åæ„Åó„Çá„ÅÜ`),e.length>0&&n.length>0){const o=e[0];s.push(`üí™ „Äå${o.category}„Äç„ÅØÂæóÊÑèÂàÜÈáé„Åß„ÅôÔºà${Math.round(o.accuracy)}%Ôºâ„ÄÇ„Åì„ÅÆÂ≠¶ÁøíÊñπÊ≥ï„Çí‰ªñ„ÅÆÂàÜÈáé„Å´„ÇÇÂøúÁî®„Åó„Åæ„Åó„Çá„ÅÜ`)}return n.length>0&&s.push("üß† AIÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅåÂº±ÁÇπÂàÜÈáé„ÅÆÂïèÈ°å„ÇíËá™ÂãïÁöÑ„Å´ÂÑ™ÂÖàÂá∫È°å„Åó„Åæ„Åô"),[...n,...e].reduce((o,i)=>o+i.totalAttempts,0)<50&&s.push("üìà „Åæ„Å†Â≠¶Áøí„Éá„Éº„Çø„ÅåÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ50Âïè‰ª•‰∏äËß£„Åè„Å®„Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Åå„Åß„Åç„Åæ„Åô"),s}function PX(n,e,t=30){if(e.length===0)return n.slice(0,t);const s=[],r=new Map,o=e.slice(0,3).reduce((h,p)=>h+p.priorityScore,0);e.slice(0,3).forEach(h=>{const p=Math.ceil(h.priorityScore/o*t*.7);r.set(h.category,p)}),e.slice(0,3).forEach(h=>{const p=r.get(h.category)||0,f=n.filter(y=>y.category===h.category),m=it(),g=f.filter(y=>{const b=m.wordProgress[y.word];return b?b.consecutiveCorrect<3:!0}),x=lp(g).slice(0,p);s.push(...x)});const i=t-s.length,a=new Set(e.slice(0,3).map(h=>h.category)),c=n.filter(h=>!a.has(h.category||"")),l=new Set(s.map(h=>h.word)),d=c.filter(h=>!l.has(h.word));return s.push(...lp(d).slice(0,i)),lp(s)}function lp(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function jX(n){const e={startDate:Date.now(),currentDay:1,targetCategories:n.improvementPlan.targetCategories,initialAccuracies:{},currentAccuracies:{},improvements:{},overallProgress:0,isCompleted:!1};n.weakCategories.forEach(t=>{n.improvementPlan.targetCategories.includes(t.category)&&(e.initialAccuracies[t.category]=t.accuracy,e.currentAccuracies[t.category]=t.accuracy,e.improvements[t.category]=0)}),localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function II(){const n=localStorage.getItem("radar-improvement-progress");if(!n)return null;try{return JSON.parse(n)}catch{return null}}function MX(n){const e=II();if(!e)return;const t=Math.floor((Date.now()-e.startDate)/(1e3*60*60*24));e.currentDay=t+1;let s=0;e.targetCategories.forEach(r=>{const o=n.weakCategories.find(c=>c.category===r),i=(o==null?void 0:o.accuracy)||80;e.currentAccuracies[r]=i;const a=i-e.initialAccuracies[r];e.improvements[r]=a,i>=80&&s++}),e.overallProgress=s/e.targetCategories.length*100,e.isCompleted=s===e.targetCategories.length,localStorage.setItem("radar-improvement-progress",JSON.stringify(e))}function FX(n,e,t){const s=OX(t),r=LX(t),o=zX(e,t,s);return{word:n,attempts:t,confusedWith:r,learningCurve:s,predictionModel:o}}function OX(n){if(n.length===0)return{accuracyHistory:[],stabilityScore:0,stage:"initial",forgettingPattern:{typicalDecayDays:7,forgettingCount:0},efficiency:{attemptsToMastery:10,currentProgress:0,estimatedDaysToMastery:30}};const e=[],t=5;for(let y=0;y<n.length;y++){const b=Math.max(0,y-t+1),v=n.slice(b,y+1),w=v.filter(S=>S.wasCorrect).length/v.length*100;e.push({timestamp:n[y].timestamp,accuracy:w})}const s=n.slice(-10),r=s.map((y,b)=>{const v=Math.max(0,s.length-5),w=s.slice(v,b+1);return w.filter(S=>S.wasCorrect).length/w.length*100}),o=r.reduce((y,b)=>y+b,0)/r.length,i=r.reduce((y,b)=>y+Math.pow(b-o,2),0)/r.length,a=Math.sqrt(i),c=Math.max(0,Math.min(100,100-a/30*100)),l=s.filter(y=>y.wasCorrect).length/s.length;let d;n.length<3?d="initial":l<.3?d="struggling":l<.7&&c<50?d="improving":l>=.7&&c>=50?d="consolidating":l>=.9&&c>=80?d="mastered":d="improving";const h=n.filter(y=>!y.wasCorrect),p=h.length;let f=7;if(h.length>=2){const y=[];for(let b=1;b<h.length;b++){const v=(h[b].timestamp-h[b-1].timestamp)/864e5;y.push(v)}f=y.reduce((b,v)=>b+v,0)/y.length}const m=Math.min(100,(l*100+c)/2),g=n.length<5?10:Math.ceil(10/(m/100)),x=Math.max(1,Math.ceil((100-m)/5));return{accuracyHistory:e,stabilityScore:c,stage:d,forgettingPattern:{typicalDecayDays:f,lastForgetDate:h.length>0?h[h.length-1].timestamp:void 0,forgettingCount:p},efficiency:{attemptsToMastery:g,currentProgress:m,estimatedDaysToMastery:x}}}function LX(n){const e=new Map;return n.forEach(t=>{if(!t.wasCorrect&&t.userAnswer){const s=t.userAnswer;if(e.has(s)){const r=e.get(s);r.frequency++,r.lastConfusion=t.timestamp}else e.set(s,{confusedWord:t.userAnswer,frequency:1,lastConfusion:t.timestamp,confusionType:"meaning",similarity:.7})}}),Array.from(e.values()).sort((t,s)=>s.frequency-t.frequency).slice(0,5)}function zX(n,e,t){const s=e.slice(-5),r=s.length>0?s.filter(p=>p.wasCorrect).length/s.length*100:50,o=t.stabilityScore/100,i=e.length>0?(Date.now()-e[e.length-1].timestamp)/(1e3*60*60*24):0,a=e.slice(-10).filter(p=>!p.wasCorrect&&p.userAnswer),c=Math.min(1,a.length/5);let l=r;l+=o*20;const d=Math.exp(-i/t.forgettingPattern.typicalDecayDays);l*=d,l-=c*30,l=Math.max(0,Math.min(100,l));const h=Math.min(1,e.length/10);return{nextCorrectProbability:l,predictors:{recentAccuracy:r,stabilityFactor:o,timeSinceLastStudy:i,confusionRisk:c},confidence:h}}function WX(n,e,t){const s=[];return n.forEach(r=>{const o=e[r.word],i=t.get(r.word),a=BX(r,o,i);s.push(a)}),s.sort((r,o)=>o.priority-r.priority)}function BX(n,e,t){if(!e||!t)return{word:n.word,priority:50,reason:"Êñ∞Ë¶èÂçòË™û",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60};const s=t.learningCurve,r=t.predictionModel;switch(s.stage){case"struggling":return{word:n.word,priority:90,reason:`Ëã¶Êà¶‰∏≠ÔºàÊ≠£Á≠îÁéá${r.predictors.recentAccuracy.toFixed(0)}%Ôºâ`,strategy:"immediate_review",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:80};case"improving":{const o=r.predictors.timeSinceLastStudy,i=o>=1&&o<=3;return{word:n.word,priority:i?85:70,reason:`ÊîπÂñÑ‰∏≠Ôºà${o.toFixed(1)}Êó•ÁµåÈÅé„ÄÅÊàêÂäüÁéá${r.nextCorrectProbability.toFixed(0)}%Ôºâ`,strategy:i?"consolidation":"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:75}}case"consolidating":{const o=s.forgettingPattern.typicalDecayDays*.7,i=r.predictors.timeSinceLastStudy,a=Math.abs(i-o)<2;return{word:n.word,priority:a?60:40,reason:`ÂÆöÁùÄÂåñ‰∏≠ÔºàÊ¨°ÂõûÂæ©Áøí„Åæ„Åß${Math.max(0,o-i).toFixed(1)}Êó•Ôºâ`,strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:50}}case"mastered":return{word:n.word,priority:20,reason:"ÁøíÂæóÊ∏à„ÅøÔºàÈï∑ÊúüË®òÊÜ∂Á¢∫Ë™çÔºâ",strategy:"spaced_repetition",estimatedSuccessRate:r.nextCorrectProbability,learningImpact:20};default:return{word:n.word,priority:50,reason:"ÂàùÊúüÊÆµÈöé",strategy:"new_learning",estimatedSuccessRate:50,learningImpact:60}}}function VX(n,e){const t=n.filter(a=>a.strategy==="immediate_review");if(t.length===0)return n;const s=[],r=t.slice(0,3);s.push(...r);const o=n.filter(a=>a.strategy==="consolidation");o.length>0&&s.push(o[0]),r.length>0&&e>=10&&s.push(r[0]);const i=n.filter(a=>!s.includes(a));return s.push(...i),s.slice(0,e)}function Ty(n,e){const s=(Date.now()-e)/(1e3*60),r=n.slice(-5),o=n.slice(-10),i=r.length>0?r.filter(b=>b.wasCorrect).length/r.length*100:100,a=o.length>0?o.filter(b=>b.wasCorrect).length/o.length*100:100,c=a-i>10,l=n.length>0?n.reduce((b,v)=>b+v.responseTime,0)/n.length:3e3,d=n.slice(-5).map(b=>b.responseTime),h=UX(d);let p=0;p+=Math.min(40,s*2),c&&(p+=25),h>1.3&&(p+=20),n.slice(-3).filter(b=>!b.wasCorrect).length>=2&&(p+=15),p=Math.min(100,Math.max(0,p));const m=100-p,g=new Date().getHours();let x;g>=6&&g<12?x="morning":g>=12&&g<18?x="afternoon":g>=18&&g<22?x="evening":x="night";const y=GX(p,s,c);return{fatigueLevel:p,concentrationLevel:m,recentPerformance:{last5Accuracy:i,last10Accuracy:a,isDecreasing:c,averageResponseTime:l},sessionStats:{duration:s,questionsAnswered:n.length,correctCount:n.filter(b=>b.wasCorrect).length,startTime:e},breakRecommendation:y,timeOfDay:x}}function UX(n){if(n.length<2)return 1;const e=n.slice(-3),t=n.slice(0,Math.max(1,n.length-3)),s=e.reduce((o,i)=>o+i,0)/e.length,r=t.reduce((o,i)=>o+i,0)/t.length;return r>0?s/r:1}function GX(n,e,t){if(n>=70)return{shouldBreak:!0,reason:"Áñ≤Âä¥„ÅåËìÑÁ©ç„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ5ÂàÜ‰ºëÊÜ©„Åó„Å¶ÈõÜ‰∏≠Âäõ„ÇíÂõûÂæ©„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:5};if(e>=25&&n>=50)return{shouldBreak:!0,reason:"25ÂàÜÁµåÈÅé„Åó„Åæ„Åó„Åü„ÄÇÁü≠„ÅÑ‰ºëÊÜ©„ÅßÂäπÁéá„Åå„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÄÇ",suggestedDuration:5};if(t&&n>=40)return{shouldBreak:!0,reason:"Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ÄÂ∫¶„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",suggestedDuration:3}}function HX(n,e){const{fatigueLevel:t,concentrationLevel:s,timeOfDay:r,sessionStats:o}=e;return _.log(`üß† Ë™çÁü•Ë≤†Ëç∑AI: Áñ≤Âä¥Â∫¶${t}%, ÈõÜ‰∏≠Âäõ${s}%, ÊôÇÈñìÂ∏Ø: ${r}`),t>=70?(_.log("  üí§ Áñ≤Âä¥Â∫¶È´ò: Á∞°Âçò„Å™Âæ©ÁøíÂïèÈ°å„ÇíÂÑ™ÂÖà"),n.filter(i=>i.estimatedSuccessRate>=70||i.strategy==="spaced_repetition").map(i=>({...i,priority:i.priority+(i.estimatedSuccessRate>=80?20:0),reason:i.reason+" (Áñ≤Âä¥ÊôÇ„ÉªÊòìÂïèÂÑ™ÂÖà)"}))):t>=40?(_.log("  üòê Áñ≤Âä¥Â∫¶‰∏≠: „Éê„É©„É≥„ÇπÈáçË¶ñ"),n.map(i=>i.estimatedSuccessRate<40?{...i,priority:i.priority-20}:i)):s>=70&&o.duration<15?(_.log("  ‚ö° ÈõÜ‰∏≠ÂäõÈ´ò: Êñ∞Ë¶èÂçòË™û„ÉªÈõ£Âïè„ÇíÂÑ™ÂÖà"),n.map(i=>i.strategy==="new_learning"?{...i,priority:i.priority+30,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÊñ∞Ë¶èÂÑ™ÂÖà)"}:i.strategy==="immediate_review"&&i.estimatedSuccessRate<60?{...i,priority:i.priority+20,reason:i.reason+" (ÈõÜ‰∏≠ÊôÇ„ÉªÈõ£ÂïèÊåëÊà¶)"}:i)):qX(n,r)}function qX(n,e){switch(e){case"morning":return _.log("  üåÖ Êúù: Êñ∞Ë¶èÂ≠¶Áøí„ÇíÂÑ™ÂÖà"),n.map(t=>t.strategy==="new_learning"?{...t,priority:t.priority+15,reason:t.reason+" (Êúù„ÉªÊñ∞Ë¶èÊúÄÈÅ©)"}:t);case"afternoon":return _.log("  ‚òÄÔ∏è ÂçàÂæå: „Éê„É©„É≥„ÇπÂûã"),n;case"evening":return _.log("  üåÜ Â§ïÊñπ: Âæ©Áøí‰∏≠ÂøÉ"),n.map(t=>t.strategy==="spaced_repetition"||t.strategy==="consolidation"?{...t,priority:t.priority+10,reason:t.reason+" (Â§ïÊñπ„ÉªÂæ©ÁøíÊúÄÈÅ©)"}:t);case"night":return _.log("  üåô Â§ú: ËªΩ„ÅÑÂæ©Áøí„ÅÆ„Åø"),n.filter(t=>t.strategy!=="new_learning"||t.estimatedSuccessRate>=60).map(t=>t.estimatedSuccessRate>=70?{...t,priority:t.priority+15,reason:t.reason+" (Â§ú„ÉªÂæ©ÁøíÊé®Â•®)"}:t);default:return n}}function KX(n){const{fatigueLevel:e,breakRecommendation:t}=n;return t!=null&&t.shouldBreak?`üí° ${t.reason}`:e>=60?"üòå Â∞ë„ÅóÁñ≤„Çå„Å¶„Åç„Åü„Åã„ÇÇ„ÄÇÁÑ°ÁêÜ„Åõ„Åö„Éû„Ç§„Éö„Éº„Çπ„ÅßÔºÅ":e<=20?"‚ú® ÈõÜ‰∏≠Âäõ„Éê„ÉÉ„ÉÅ„É™ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ":""}function XX(n,e){const t=new Map,s=[],r=[];let o=0;const i=e.slice(-10),a=i.length>0?i.filter(h=>!h.wasCorrect).length/i.length*100:0;Object.entries(n).forEach(([h,p])=>{o+=p.incorrectCount,p.learningHistory&&p.learningHistory.filter(m=>!m.wasCorrect).forEach(m=>{if(m.userAnswer&&ZX(h,m.userAnswer)&&t.set("similar_spelling",(t.get("similar_spelling")||0)+1),m.userAnswer){const g=s.find(x=>x.word1===h&&x.word2===m.userAnswer||x.word2===h&&x.word1===m.userAnswer);g?(g.confusionCount++,g.lastConfusion=m.timestamp):m.userAnswer!==h&&s.push({word1:h,word2:m.userAnswer,confusionCount:1,lastConfusion:m.timestamp,pattern:"confusion_pair"})}})});const c=e.slice(-5),l=c.length>0?c.filter(h=>!h.wasCorrect).length/c.length*100:0,d=l<a-10?"improving":l>a+10?"declining":"stable";return{totalErrors:o,errorsByPattern:t,confusionPairs:s.sort((h,p)=>p.confusionCount-h.confusionCount),weakCategories:r,recentErrorRate:a,errorTrend:d}}function QX(n,e,t,s,r){const o=[];let i=30;if(e){const p=e.correctCount+e.incorrectCount;if(p>0){const f=e.incorrectCount/p*100;f>50&&(i+=30,o.push({type:"category_weakness",weight:.3,description:"„Åì„ÅÆÂçòË™û„ÅÆÈÅéÂéª„ÅÆË™§Á≠îÁéá„ÅåÈ´ò„ÅÑ",evidence:[`Ë™§Á≠îÁéá: ${f.toFixed(0)}%`]}))}if(e.learningHistory&&e.learningHistory.length>0){const f=e.learningHistory.slice(-3),m=f.filter(g=>!g.wasCorrect).length/f.length*100;m>66&&(i+=25,o.push({type:"timing_based",weight:.25,description:"ÊúÄËøë3Âõû„ÅÆ„ÅÜ„Å°2Âõû‰ª•‰∏äÈñìÈÅï„Åà„Å¶„ÅÑ„Çã",evidence:[`Áõ¥Ëøë3Âõû„ÅÆË™§Á≠îÁéá: ${m.toFixed(0)}%`]}))}if(e.lastStudied){const f=(Date.now()-e.lastStudied)/864e5;if(f>7){const m=Math.min(20,f*2);i+=m,o.push({type:"timing_based",weight:m/100,description:"ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµåÈÅé„Åó„Å¶„ÅÑ„Çã",evidence:[`${f.toFixed(1)}Êó•Ââç„Å´Âæ©Áøí`]})}}}else i+=20,o.push({type:"category_weakness",weight:.2,description:"„Åæ„Å†Â≠¶Áøí„Åó„Åü„Åì„Å®„Åå„Å™„ÅÑÂçòË™û",evidence:["ÂàùË¶ã"]});const a=t.confusionPairs.find(p=>p.word1===n||p.word2===n);if(a&&a.confusionCount>=2){i+=15;const p=a.word1===n?a.word2:a.word1;o.push({type:"confusion_pair",weight:.15,description:`"${p}"„Å®Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ`,evidence:[`${a.confusionCount}ÂõûÊ∑∑Âêå`]})}if(s>60){const p=(s-60)/2;i+=p,o.push({type:"timing_based",weight:p/100,description:"Áñ≤Âä¥„Å´„Çà„ÇäÈõÜ‰∏≠Âäõ„Åå‰Ωé‰∏ã„Åó„Å¶„ÅÑ„Çã",evidence:[`Áñ≤Âä¥Â∫¶: ${s.toFixed(0)}%`]})}t.errorTrend==="declining"&&(i+=10,o.push({type:"category_weakness",weight:.1,description:"ÂÖ®‰ΩìÁöÑ„Å´Ë™§Á≠îÁéá„Åå‰∏äÊòáÂÇæÂêë",evidence:[`ÊúÄËøë10Âïè„ÅÆË™§Á≠îÁéá: ${t.recentErrorRate.toFixed(0)}%`]}));const c=Math.min(100,Math.max(0,i)),l=c>=80?"critical":c>=60?"high":c>=40?"medium":"low",d=YX(n,c,l,o,a),h=JX(e,o.length);return{word:n,errorRisk:c,confidence:h,primaryPattern:o.length>0?o[0].type:"category_weakness",riskFactors:o,warningLevel:l,suggestedSupport:d}}function YX(n,e,t,s,r){const o=[],i=[];let a="",c="";return t==="critical"?(a=`‚ö†Ô∏è Ê≥®ÊÑè: „Åì„ÅÆÂïèÈ°å„ÅØÈñìÈÅï„Åà„ÇÑ„Åô„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„ÅôÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÅ„Åó„Å£„Åã„ÇäËÄÉ„Åà„Å¶„Åã„ÇâÁ≠î„Åà„Åæ„Åó„Çá„ÅÜÔºÅ"):t==="high"?(a=`üîî „Åì„ÅÆÂïèÈ°å„ÅØÂ∞ë„ÅóÈõ£„Åó„ÅÑ„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„ÇìÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Çå„Å∞Â§ß‰∏àÂ§´„Åß„ÅôÔºÅ"):t==="medium"&&(a=`üí° ÊÖéÈáç„Å´Á≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºà„É™„Çπ„ÇØ: ${e.toFixed(0)}%Ôºâ`,c="ËêΩ„Å°ÁùÄ„ÅÑ„Å¶Âèñ„ÇäÁµÑ„Åø„Åæ„Åó„Çá„ÅÜÔºÅ"),s.forEach(l=>{switch(l.type){case"confusion_pair":if(r){const d=r.word1===n?r.word2:r.word1;o.push(`"${d}"„Å®Ê∑∑Âêå„Åó„Å™„ÅÑ„Çà„ÅÜ„Å´Ê≥®ÊÑè`),i.push(d)}break;case"similar_spelling":o.push("Á∂¥„Çä„Çí„Çà„ÅèÁ¢∫Ë™ç„Åó„Åæ„Åó„Çá„ÅÜ");break;case"timing_based":l.description.includes("ÊôÇÈñì„ÅåÁµåÈÅé")?o.push("ÂâçÂõû„ÅÆÂæ©Áøí„Åã„ÇâÊôÇÈñì„ÅåÁµå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÑèÂë≥„ÇíÊÄù„ÅÑÂá∫„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"):l.description.includes("Áñ≤Âä¥")&&o.push("Áñ≤„Çå„Å¶„ÅÑ„Çã„Å®„Åç„ÅØÁÑ¶„Çâ„Åö„ÄÅ„ÇÜ„Å£„Åè„ÇäËÄÉ„Åà„Åæ„Åó„Çá„ÅÜ");break;case"category_weakness":o.push("„Åì„ÅÆÂçòË™û„ÅØÈÅéÂéª„Å´ÈñìÈÅï„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇÊÖéÈáç„Å´ÔºÅ");break}}),{showWarning:t!=="low",warningMessage:a,hints:o.slice(0,2),reviewWords:i,confidenceBooster:c}}function JX(n,e){let t=50;if(n){const s=n.correctCount+n.incorrectCount;t+=Math.min(30,s*5),n.learningHistory&&n.learningHistory.length>=3&&(t+=10)}return t+=Math.min(10,e*3),Math.min(100,t)}function ZX(n,e){const t=eQ(n.toLowerCase(),e.toLowerCase());return t>0&&t<=2}function eQ(n,e){const t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=n.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let r=1;r<=n.length;r++)e.charAt(s-1)===n.charAt(r-1)?t[s][r]=t[s-1][r-1]:t[s][r]=Math.min(t[s-1][r-1]+1,t[s][r-1]+1,t[s-1][r]+1);return t[e.length][n.length]}function tQ(n,e,t,s,r){const o=new Map;return n.forEach(i=>{const a=QX(i,e[i],t,s);o.set(i,a)}),o}function kI(n=Date.now()){const e=new Date(n).getHours();return e>=5&&e<12?"morning":e>=12&&e<17?"afternoon":e>=17&&e<21?"evening":"night"}function nQ(n,e,t,s,r,o,i,a){const c=(e-n)/6e4,l=t>0?s/t*100:0;return{sessionId:`session_${n}`,startTime:n,endTime:e,duration:c,timeOfDay:kI(n),questionsAnswered:t,correctAnswers:s,accuracy:l,averageResponseTime:r,fatigueLevel:o,newWordsLearned:i,reviewedWords:a}}function sQ(n){return["morning","afternoon","evening","night"].map(t=>{const s=n.filter(g=>g.timeOfDay===t);if(s.length===0)return{timeOfDay:t,sessionCount:0,totalQuestions:0,averageAccuracy:0,averageResponseTime:0,averageFatigue:0,efficiencyScore:0,bestForNewLearning:!1,bestForReview:!1};const r=s.reduce((g,x)=>g+x.questionsAnswered,0),i=s.reduce((g,x)=>g+x.correctAnswers,0)/r*100,a=s.reduce((g,x)=>g+x.averageResponseTime,0)/s.length,c=s.reduce((g,x)=>g+x.fatigueLevel,0)/s.length,l=s.reduce((g,x)=>g+x.newWordsLearned,0),d=s.reduce((g,x)=>g+x.reviewedWords,0),h=i,p=Math.max(0,100-a/50),f=100-c,m=h*.4+p*.3+f*.3;return{timeOfDay:t,sessionCount:s.length,totalQuestions:r,averageAccuracy:i,averageResponseTime:a,averageFatigue:c,efficiencyScore:m,bestForNewLearning:l>d,bestForReview:d>=l}}).sort((t,s)=>s.efficiencyScore-t.efficiencyScore)}function rQ(n){if(n.length===0)return{optimalDuration:15,currentAverageDuration:0,performanceByDuration:[],recommendation:"Â≠¶Áøí„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åæ„Åö„ÅØ15ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂßã„ÇÅ„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ"};const e=n.reduce((a,c)=>a+c.duration,0)/n.length,s=[{min:0,max:5,label:"0-5ÂàÜ"},{min:5,max:10,label:"5-10ÂàÜ"},{min:10,max:15,label:"10-15ÂàÜ"},{min:15,max:20,label:"15-20ÂàÜ"},{min:20,max:30,label:"20-30ÂàÜ"},{min:30,max:999,label:"30ÂàÜ‰ª•‰∏ä"}].map(a=>{const c=n.filter(p=>p.duration>=a.min&&p.duration<a.max);if(c.length===0)return{durationRange:a.label,accuracy:0,efficiency:0};const l=c.reduce((p,f)=>p+f.accuracy,0)/c.length,d=c.reduce((p,f)=>p+f.fatigueLevel,0)/c.length,h=l-d*.5;return{durationRange:a.label,accuracy:l,efficiency:h}}).filter(a=>a.efficiency>0),r=s.reduce((a,c)=>c.efficiency>a.efficiency?c:a,s[0]||{durationRange:"10-15ÂàÜ",efficiency:0}),o=r?parseInt(r.durationRange.split("-")[0])+5:15;let i="";return o<10?i=`Áü≠ÊúüÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆÁü≠„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥„Çí1Êó•Ë§áÊï∞ÂõûË°å„ÅÜ„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:o<20?i=`${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Åì„ÅÆÈï∑„Åï„ÇíÁõÆÂÆâ„Å´Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`:i=`Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Å™„Çà„ÅÜ„Åß„Åô„ÄÇ${o}ÂàÜÁ®ãÂ∫¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅßÊ∑±„ÅÑÂ≠¶Áøí„Åå„Åß„Åç„Åæ„Åô„ÄÇ„Åü„Å†„Åó„ÄÅÁñ≤Âä¥„Å´Ê≥®ÊÑè„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,{optimalDuration:o,currentAverageDuration:e,performanceByDuration:s,recommendation:i}}function oQ(n){if(n.length<5)return"moderate";const e=n.reduce((r,o)=>r+o.duration,0)/n.length,t=new Set(n.map(r=>new Date(r.startTime).toDateString())),s=n.length/t.size;return e<10&&s>=2?"distributed":e<10?"short_burst":e<20?"moderate":"extended"}function iQ(n,e){var p,f,m;const t=oQ(e),s=sQ(e),r=rQ(e),o=((p=s[0])==null?void 0:p.timeOfDay)||"morning",i=r.optimalDuration;let a=1;t==="distributed"||t==="short_burst"?a=3:t==="moderate"&&(a=2);const c=[],l=[];((f=s[0])==null?void 0:f.averageAccuracy)>80&&c.push(`${s[0].timeOfDay}„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑèÔºàÊ≠£Á≠îÁéá${s[0].averageAccuracy.toFixed(0)}%Ôºâ`),t==="distributed"?c.push("ÂàÜÊï£Â≠¶Áøí„Å´„Çà„ÇäË®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåËâØÂ•Ω"):t==="extended"&&c.push("Èï∑ÊôÇÈñì„ÅÆÈõÜ‰∏≠Â≠¶Áøí„ÅåÂèØËÉΩ"),e.reduce((g,x)=>g+x.fatigueLevel,0)/e.length>60&&l.push("Áñ≤Âä¥„É¨„Éô„É´„ÅåÈ´ò„ÇÅ„ÄÇ‰ºëÊÜ©„ÇíÂ¢ó„ÇÑ„Åô„Åã„ÄÅ„Çª„ÉÉ„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÁü≠Á∏Æ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ"),((m=s[s.length-1])==null?void 0:m.averageAccuracy)<60&&l.push(`${s[s.length-1].timeOfDay}„ÅÆÂ≠¶ÁøíÂäπÁéá„Åå‰Ωé„ÅÑ„Åü„ÇÅ„ÄÅÈÅø„Åë„Çã„Åì„Å®„ÇíÊé®Â•®`);const h=[];return h.push(`ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø: ${o==="morning"?"Êúù":o==="afternoon"?"ÂçàÂæå":o==="evening"?"Â§ïÊñπ":"Â§ú"}`),h.push(`Êé®Â•®„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑: ${i}ÂàÜ`),h.push(`1Êó•„ÅÆÊé®Â•®Â≠¶ÁøíÂõûÊï∞: ${a}Âõû`),t==="distributed"?h.push("Áü≠„ÅÑÂ≠¶Áøí„ÇíË§áÊï∞ÂõûË°å„ÅÜ„Çπ„Çø„Ç§„É´„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇÊúù„ÉªÊòº„ÉªÂ§ú„Å´ÂàÜ„Åë„Å¶Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ"):t==="extended"&&h.push("Èï∑ÊôÇÈñì„ÅÆÂ≠¶Áøí„ÅåÂæóÊÑè„Åß„Åô„ÄÇÈÄ±Êú´„Å™„Å©„Å´„Åæ„Å®„ÇÅ„Å¶Â≠¶Áøí„Åô„ÇãÊñπÊ≥ï„ÇÇÊúâÂäπ„Åß„Åô"),{userId:n,primaryStyle:t,bestTimeOfDay:o,optimalSessionLength:i,optimalDailyFrequency:a,strengths:c,improvements:l,personalizedRecommendations:h}}function aQ(n){try{const e="learning-style-sessions",t=localStorage.getItem(e),s=t?JSON.parse(t):[];s.push(n);const r=s.slice(-100);localStorage.setItem(e,JSON.stringify(r))}catch(e){_.error("Failed to save session history:",e)}}function cQ(){try{const e=localStorage.getItem("learning-style-sessions");return e?JSON.parse(e):[]}catch(n){return _.error("Failed to load session history:",n),[]}}function lQ(n,e){const t=e===n.bestTimeOfDay,s={morning:"Êúù",afternoon:"ÂçàÂæå",evening:"Â§ïÊñπ",night:"Â§ú"};return t?`‚ú® ‰ªä„ÅØ${s[e]}„Åß„Åô„ÄÇ„ÅÇ„Å™„Åü„ÅÆÊúÄ„ÇÇÂ≠¶ÁøíÂäπÁéá„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„Åß„ÅôÔºÅ${n.optimalSessionLength}ÂàÜÁ®ãÂ∫¶„ÅÆÂ≠¶Áøí„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ`:`üí° ${s[n.bestTimeOfDay]}„ÅÆÂ≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÊûúÁöÑ„Åß„Åô„ÄÇÁèæÂú®„ÅØ${s[e]}„Å™„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåËâØ„ÅÑ„Åß„Åó„Çá„ÅÜ„ÄÇ`}const uQ={first_session:{type:"first_session",name:"Â≠¶ÁøíÈñãÂßã",description:"Âàù„ÇÅ„Å¶„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÂÆå‰∫Ü",icon:"üéì",rarity:"common"},streak_3_days:{type:"streak_3_days",name:"‰∏âÊó•Âùä‰∏ªÂÖãÊúç",description:"3Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üî•",rarity:"common"},streak_7_days:{type:"streak_7_days",name:"‰∏ÄÈÄ±Èñì„ÅÆÁøíÊÖ£",description:"7Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"‚≠ê",rarity:"rare"},streak_30_days:{type:"streak_30_days",name:"ÁøíÊÖ£„ÅÆÈÅî‰∫∫",description:"30Êó•ÈÄ£Á∂ö„ÅßÂ≠¶Áøí",icon:"üèÜ",rarity:"epic"},total_100_words:{type:"total_100_words",name:"ÁôæÂçòË™û",description:"Á¥ØË®à100ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìö",rarity:"common"},total_500_words:{type:"total_500_words",name:"‰∫îÁôæÂçòË™û",description:"Á¥ØË®à500ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üìñ",rarity:"rare"},total_1000_words:{type:"total_1000_words",name:"ÂçÉÂçòË™û„Éû„Çπ„Çø„Éº",description:"Á¥ØË®à1000ÂçòË™û„ÇíÂ≠¶Áøí",icon:"üéñÔ∏è",rarity:"epic"},perfect_session:{type:"perfect_session",name:"„Éë„Éº„Éï„Çß„ÇØ„Éà",description:"1„Çª„ÉÉ„Ç∑„Éß„É≥ÂÖ®ÂïèÊ≠£Ëß£",icon:"üíØ",rarity:"rare"},accuracy_90:{type:"accuracy_90",name:"È´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá90%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üéØ",rarity:"rare"},accuracy_95:{type:"accuracy_95",name:"Ë∂ÖÈ´òÁ≤æÂ∫¶",description:"Ê≠£Á≠îÁéá95%‰ª•‰∏ä„Çí10ÂõûÈÅîÊàê",icon:"üíé",rarity:"epic"},early_bird:{type:"early_bird",name:"Êó©Ëµ∑„ÅçÈ≥•",description:"ÊúùÔºà6-9ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåÖ",rarity:"common"},night_owl:{type:"night_owl",name:"Â§úÂûãÂ≠¶Áøí",description:"Â§úÔºà21-24ÊôÇÔºâ„Å´5ÂõûÂ≠¶Áøí",icon:"üåô",rarity:"common"},speed_master:{type:"speed_master",name:"„Çπ„Éî„Éº„Éâ„Éû„Çπ„Çø„Éº",description:"Âπ≥ÂùáÂøúÁ≠îÊôÇÈñì2Áßí‰ª•‰∏ã„Çí10ÂõûÈÅîÊàê",icon:"‚ö°",rarity:"rare"},review_champion:{type:"review_champion",name:"Âæ©Áøí„ÉÅ„É£„É≥„Éî„Ç™„É≥",description:"Ë¶ÅÂæ©ÁøíÂçòË™û50ÂÄã„Çí„Éû„Çπ„Çø„Éº",icon:"‚ôªÔ∏è",rarity:"rare"},master_100:{type:"master_100",name:"ÁôæÂçòË™û„Éû„Çπ„Çø„Éº",description:"100ÂçòË™û„ÇíÂÆåÂÖ®ÁøíÂæó",icon:"üëë",rarity:"epic"},comeback:{type:"comeback",name:"„Ç´„É†„Éê„ÉÉ„ÇØ",description:"1ÈÄ±Èñì‰ª•‰∏ä„ÅÆ‰∏≠Êñ≠Âæå„Å´ÂÜçÈñã",icon:"üí™",rarity:"common"},marathon:{type:"marathon",name:"„Éû„É©„ÇΩ„É≥„É©„É≥„Éä„Éº",description:"1ÊôÇÈñì‰ª•‰∏ä„ÅÆÂ≠¶Áøí„Çª„ÉÉ„Ç∑„Éß„É≥",icon:"üèÉ",rarity:"rare"},focused:{type:"focused",name:"ÈõÜ‰∏≠Âäõ„ÅÆÊ•µ„Åø",description:"ÈõÜ‰∏≠Âäõ„ÅÆÈ´ò„ÅÑÂ≠¶Áøí„Çí10Âõû",icon:"üßò",rarity:"rare"}},$I=n=>Math.floor(100*Math.pow(1.15,n-1)),za={CORRECT_ANSWER:10,PERFECT_SESSION:100,STREAK_BONUS_PER_DAY:5,SESSION_COMPLETION:50,BADGE_EARNED:200},TI=()=>{const n=localStorage.getItem("gamificationStats");if(n){const e=JSON.parse(n);return e.lastSessionDate&&(e.lastSessionDate=new Date(e.lastSessionDate)),e.badges=e.badges.map(t=>({...t,earnedAt:t.earnedAt?new Date(t.earnedAt):void 0})),e.milestones=e.milestones.map(t=>({...t,completedAt:t.completedAt?new Date(t.completedAt):void 0})),e.challenges=e.challenges.map(t=>({...t,startDate:new Date(t.startDate),endDate:new Date(t.endDate)})),e}return{level:{level:1,currentXP:0,requiredXP:$I(1),totalXP:0},badges:[],streak:{current:0,longest:0,lastStudyDate:""},milestones:hQ(),challenges:[],totalSessions:0,totalWordsLearned:0,totalCorrectAnswers:0,averageAccuracy:0}},dQ=n=>{localStorage.setItem("gamificationStats",JSON.stringify(n))},hQ=()=>[{id:"first_10_words",title:"ÊúÄÂàù„ÅÆ10ÂçòË™û",description:"10ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:10,current:0,reward:{xp:100},completed:!1},{id:"first_50_words",title:"50ÂçòË™ûÈÅîÊàê",description:"50ÂçòË™û„ÇíÂ≠¶Áøí„Åô„Çã",target:50,current:0,reward:{xp:300,badge:"total_100_words"},completed:!1},{id:"accuracy_80",title:"Ê≠£Á≠îÁéá80%",description:"Ê≠£Á≠îÁéá80%‰ª•‰∏ä„ÇíÈÅîÊàê",target:80,current:0,reward:{xp:200},completed:!1}],pQ=(n,e)=>{const t={...n};t.level.currentXP+=e,t.level.totalXP+=e;let s=!1,r;for(;t.level.currentXP>=t.level.requiredXP;)t.level.currentXP-=t.level.requiredXP,t.level.level+=1,t.level.requiredXP=$I(t.level.level),s=!0,r=t.level.level;return{stats:t,leveledUp:s,newLevel:r}},fQ=n=>{const e=new Date().toISOString().split("T")[0],t=n.streak.lastStudyDate;if(!t)return{...n,streak:{current:1,longest:1,lastStudyDate:e}};if(t===e)return n;const s=new Date;s.setDate(s.getDate()-1);const r=s.toISOString().split("T")[0];if(t===r){const o=n.streak.current+1;return{...n,streak:{current:o,longest:Math.max(o,n.streak.longest),lastStudyDate:e}}}else return{...n,streak:{current:1,longest:n.streak.longest,lastStudyDate:e}}},mQ=(n,e)=>{const t=[],s=new Set(n.badges.map(a=>a.type)),r=a=>{if(!s.has(a)){const c={...uQ[a],earnedAt:new Date};t.push(c),s.add(a)}};n.totalSessions===1&&!s.has("first_session")&&r("first_session"),n.streak.current>=3&&r("streak_3_days"),n.streak.current>=7&&r("streak_7_days"),n.streak.current>=30&&r("streak_30_days"),n.totalWordsLearned>=100&&r("total_100_words"),n.totalWordsLearned>=500&&r("total_500_words"),n.totalWordsLearned>=1e3&&r("total_1000_words"),e.perfectScore&&r("perfect_session");const o=n.totalSessions;return e.accuracy>=90&&o>=10&&r("accuracy_90"),e.accuracy>=95&&o>=10&&r("accuracy_95"),e.timeOfDay==="morning"&&n.totalSessions>=5&&r("early_bird"),e.timeOfDay==="night"&&n.totalSessions>=5&&r("night_owl"),e.avgResponseTime<=2e3&&n.totalSessions>=10&&r("speed_master"),e.sessionDuration>=60&&r("marathon"),e.focused&&n.totalSessions>=10&&r("focused"),n.lastSessionDate&&(new Date().getTime()-n.lastSessionDate.getTime())/864e5>=7&&r("comeback"),{stats:{...n,badges:[...n.badges,...t]},newBadges:t}},gQ=n=>{const e=[],t=n.milestones.map(s=>{if(s.completed)return s;let r=s.current;if(s.id.includes("words")?r=n.totalWordsLearned:s.id.includes("accuracy")&&(r=n.averageAccuracy),r>=s.target&&!s.completed){const i={...s,current:r,completed:!0,completedAt:new Date};return e.push(i),i}return{...s,current:r}});return{stats:{...n,milestones:t},completedMilestones:e}},xQ=(n,e,t,s,r,o)=>{let i=TI();const a=[];let c=0;i.totalSessions+=1,i.totalWordsLearned+=r,i.totalCorrectAnswers+=n,i.averageAccuracy=(i.averageAccuracy*(i.totalSessions-1)+n/e*100)/i.totalSessions,i.lastSessionDate=new Date;const l=i.streak.current;i=fQ(i),i.streak.current>l&&(a.push({type:"streak",message:`üî• ${i.streak.current}Êó•ÈÄ£Á∂öÂ≠¶ÁøíÔºÅ`,icon:"üî•",priority:4}),c+=za.STREAK_BONUS_PER_DAY*i.streak.current);const d=n/e*100,h=n===e;c+=n*za.CORRECT_ANSWER,c+=za.SESSION_COMPLETION,h&&(c+=za.PERFECT_SESSION,a.push({type:"praise",message:"üíØ „Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅÂÖ®ÂïèÊ≠£Ëß£„Åß„ÅôÔºÅ",icon:"üíØ",priority:5}));const p=new Date().getHours();let f;p>=6&&p<12?f="morning":p>=12&&p<18?f="afternoon":p>=18&&p<21?f="evening":f="night";const m=o<.3,g=mQ(i,{accuracy:d,avgResponseTime:t,perfectScore:h,timeOfDay:f,sessionDuration:s,focused:m});i=g.stats,g.newBadges.length>0&&g.newBadges.forEach(b=>{a.push({type:"milestone",message:`üéñÔ∏è „Éê„ÉÉ„Ç∏Áç≤Âæó: ${b.name}`,icon:b.icon,priority:5}),c+=za.BADGE_EARNED});const x=gQ(i);i=x.stats,x.completedMilestones.length>0&&x.completedMilestones.forEach(b=>{a.push({type:"milestone",message:`üéØ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥ÈÅîÊàê: ${b.title}`,icon:"üéØ",priority:4}),c+=b.reward.xp});const y=pQ(i,c);return i=y.stats,y.leveledUp&&y.newLevel&&a.push({type:"level_up",message:`‚≠ê „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ Lv.${y.newLevel}`,icon:"‚≠ê",priority:5}),d<50?a.push({type:"encouragement",message:"üí™ ÁÑ¶„Çâ„ÅöÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜÔºÅÁ∂ôÁ∂ö„ÅåÂ§ßÂàá„Åß„Åô",icon:"üí™",priority:2}):d>=50&&d<80?a.push({type:"encouragement",message:"üëç ËâØ„ÅÑ„Éö„Éº„Çπ„Åß„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÔºÅ",icon:"üëç",priority:2}):d>=80&&d<95&&a.push({type:"praise",message:"üåü Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÈ´ò„ÅÑÊ≠£Á≠îÁéá„Åß„Åô",icon:"üåü",priority:3}),dQ(i),{stats:i,feedback:a.sort((b,v)=>v.priority-b.priority),xpGained:c,leveledUp:y.leveledUp,newLevel:y.newLevel}},yQ=()=>{const n=TI(),e=[];return n.streak.current>0&&e.push(`üî• ${n.streak.current}Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ`),n.level.level>1&&e.push(`‚≠ê „É¨„Éô„É´ ${n.level.level}`),n.level.currentXP/n.level.requiredXP*100>80&&e.push("Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ"),e.length===0&&e.push("‰ªäÊó•„ÇÇÂ≠¶Áøí„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜÔºÅ"),e.join(" | ")},ei=Object.freeze(Object.defineProperty({__proto__:null,addQuizResult:pc,addSessionHistory:xa,calculateSessionStats:I0,checkFlexibleMastery:l0,createWeakWordsQuestionSet:qu,filterSkippedWords:d0,getAllWordProgress:Pi,getConfusedWords:p0,getCumulativeProgressData:x0,getCurrentWeakWords:Ah,getCustomQuestionSets:Dh,getDetailedRetentionStats:zu,getGrammarDetailedRetentionStats:Wu,getGrammarRetentionRateWithAI:Ku,getGrammarUnitStats:i0,getGrammarUnitStatsWithTitles:N0,getMemorizationCardSettings:w0,getMemorizationDetailedRetentionStats:Bu,getMemorizationSettings:S0,getMonthlyStats:r0,getNearMasteryStats:lI,getOvercomeWeakWords:c0,getRecentlyMasteredWords:o0,getRetentionRateWithAI:Uu,getRetentionTrend:y0,getStudyCalendarByMode:g0,getStudySettings:n0,getTodayIncorrectWords:Ou,getTodayStats:Lu,getTotalAnsweredCount:f0,getTotalMasteredWordsCount:Rh,getUniqueQuestionedWordsCount:dI,getWeeklyStats:s0,getWordDetailedData:Gu,getWordProgress:Vu,isWordSkipExcluded:u0,loadProgress:is,loadProgressSync:it,recordConfusion:h0,recordMemorizationBehavior:C0,recordWordSkip:Eh,resetAllProgress:m0,saveCustomQuestionSet:Hu,saveMemorizationCardSettings:b0,saveMemorizationSettings:v0,saveProgress:Cr,updateProgressCache:_r,updateWordProgress:Co},Symbol.toStringTag,{value:"Module"}));function po(n){return n[Math.floor(Math.random()*n.length)]}function bQ(){const n=localStorage.getItem("progress-data");if(!n)return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0};try{const t=JSON.parse(n).results||[],s=t.slice(-10),r=s.length>0?s.reduce((g,x)=>g+x.score/x.total*100,0)/s.length:0,o=new Map;t.forEach(g=>{if(g.category){const x=o.get(g.category)||{correct:0,total:0};x.correct+=g.score,x.total+=g.total,o.set(g.category,x)}});const i=[],a=[];o.forEach((g,x)=>{const y=g.total>0?g.correct/g.total*100:0;y>=80&&i.push(x),y<60&&a.push(x)});const c=s.slice(0,5),l=s.slice(-5),d=c.length>0?c.reduce((g,x)=>g+x.score/x.total*100,0)/c.length:0,p=(l.length>0?l.reduce((g,x)=>g+x.score/x.total*100,0)/l.length:0)>d+5,f=new Set(t.map(g=>new Date(g.date).toDateString())),m=Math.min(100,f.size*5);return{totalSessions:t.length,averageAccuracy:r,strongCategories:i,weakCategories:a,recentImprovement:p,consistencyScore:m}}catch{return{totalSessions:0,averageAccuracy:0,strongCategories:[],weakCategories:[],recentImprovement:!1,consistencyScore:0}}}function A0(){const n=new Date().getHours();return n>=5&&n<12?"morning":n>=12&&n<17?"afternoon":n>=17&&n<21?"evening":"night"}class wQ{generateCorrectComment(e){const t=[],s=bQ();return e.attemptCount===1?(e.responseTime<3e3&&t.push(po(["ÈÄü„ÅÑÔºÅ","ÂèçÂøú„ÅåÈã≠„ÅÑ„ÅûÔºÅ","Âç≥Á≠î„Å†„Å™ÔºÅ"])),t.push(po(["„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","Ê≠£Ëß£„Å†ÔºÅ"]))):e.attemptCount===2?t.push(po(["2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ","„ÇÑ„Å£„Å®Ê≠£Ëß£„Åó„Åü„Å™„ÄÇ"])):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åã„ÄÇ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèÊ±∫„ÇÅ„ÇçÔºÅ")),e.difficulty==="advanced"&&e.attemptCount===1?t.push(po(["‰∏äÁ¥öÂçòË™û„Çí‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ","Èõ£„Åó„ÅÑÂçòË™û„ÇÇ„ÇØ„É™„Ç¢„Å†„Å™ÔºÅ"])):e.difficulty==="beginner"&&e.attemptCount>1&&t.push("ÂàùÁ¥ö„Åß„ÇÇ„Åü„Å§„Åè„Å™ÔºÅ"),e.correctStreak>=10?(t.push(`È©öÁï∞„ÅÆ${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(po(["ÂÆåÂÖ®„Å´Ê≥¢„Å´‰πó„Å£„Å¶„Çã„Å™ÔºÅ","„Åì„ÅÆ„Åæ„ÅæÁ™Å„Å£Ëµ∞„ÇåÔºÅ"]))):e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÊ≠£Ëß£ÔºÅ`),t.push(po(["Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åü„Å™ÔºÅ","„ÅÑ„ÅÑÊµÅ„Çå„Å†ÔºÅ"]))):e.correctStreak>=3&&t.push("3ÈÄ£Á∂ö„Å†„ÄÇ"),s.recentImprovement&&s.totalSessions>=10&&t.push(po(["ÊúÄËøë„ÅÆÊàêÈï∑„ÅåËëó„Åó„ÅÑ„ÅûÔºÅ","Ââç„Çà„ÇäÁ¢∫ÂÆü„Å´Âº∑„Åè„Å™„Å£„Å¶„ÇãÔºÅ"])),e.isWeakCategory&&e.isCorrect&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push(po(["ÊàêÈï∑„ÇíÊÑü„Åò„Çã„ÅûÔºÅ","Âº±ÁÇπ„ÇíÊΩ∞„Åó„Åü„Å™ÔºÅ"]))),e.todayQuestions>=50&&e.todayAccuracy>=80&&t.push("‰ªäÊó•„ÅØÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ"),e.timeOfDay==="night"&&e.todayQuestions>=30&&t.push("Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÇãÔºÅ"),e.hasSeenBefore&&e.previousAttempts>2&&(t.push(`Ââç„ÅØ${e.previousAttempts}Âõû„ÇÇ„Åã„Åã„Å£„ÅüÂçòË™û„Å†„ÅûÔºÅ`),t.push("„Çà„ÅÜ„ÇÑ„ÅèË¶ö„Åà„Åü„Å™ÔºÅ")),e.learningPhase==="ENCODING"?t.push("Êñ∞Ë¶èË®òÊÜ∂„ÇíËÑ≥„Å´Âàª„ÅøËæº„Çì„Åß„Çã„ÅûÔºÅ"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„Çã„Å™ÔºÅ"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å‰∏≠„Å†ÔºÅ"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åü„Å™ÔºÅ"),t.push("„Åì„ÅÆË™øÂ≠ê„Å†ÔºÅüí™"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÈÅï„ÅÜÔºÅ"):t.push("„Åæ„ÅüÈñìÈÅï„Åà„ÅüÔºÅ"),e.difficulty==="beginner"&&(t.push("ÂàùÁ¥ö„ÅßÈñìÈÅï„Åà„Çã„Å®„ÅØ‚Ä¶"),t.push("Âü∫Á§é„Åã„Çâ„ÇÑ„ÇäÁõ¥„ÅõÔºÅ")),e.incorrectStreak>=3&&(t.push(`${e.incorrectStreak}ÈÄ£Á∂ö„Éü„ÇπÔºÅ`),t.push("„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ")),e.hasSeenBefore&&(t.push(`Ââç„Å´„ÇÇÈñìÈÅï„Åà„Åü${e.word}„Å†„ÅûÔºÅ`),t.push("‰ΩïÂ∫¶„ÇÑ„Çâ„Åõ„ÇãÊ∞ó„Å†ÔºÅ")),e.todayAccuracy<60&&(t.push("‰ªäÊó•„ÅÆÊ≠£Á≠îÁéá„Åå‰Ωé„ÅÑÔºÅ"),t.push("ÈõÜ‰∏≠„Åó„ÇçÔºÅ")),e.timeOfDay==="night"&&e.todayQuestions>=40?(t.push("Áñ≤„Çå„Å¶„Çã„Å™„Çâ‰ºë„ÇÅÔºÅ"),t.push("„Å†„ÅåÊòéÊó•„ÅØÂÄç„ÇÑ„Çã„Çì„Å†„ÅûÔºÅ")):t.push("Ê∞óÂêà„ÇíÂÖ•„Çå„ÇçÔºÅüî•"),t.join(" ")}}class vQ{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„ÅôÔºÅ"),e.attemptCount===1?e.responseTime<3e3?t.push("Á¥†Êó©„ÅÑÂà§Êñ≠„Åß„Åó„Åü„Å≠ ‚ú®"):t.push("„Åó„Å£„Åã„ÇäËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠"):e.attemptCount===2?(t.push("2ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü"),t.push("ËêΩ„Å°ÁùÄ„ÅÑ„Å¶ËÄÉ„Åà„Çâ„Çå„Åæ„Åó„Åü„Å≠")):e.attemptCount>=3&&(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü`),t.push("Á≤ò„ÇäÂº∑„ÅèÂèñ„ÇäÁµÑ„ÇÅ„Åæ„Åó„Åü„Å≠")),e.difficulty==="advanced"&&(t.push(`${e.word}„ÅØÈõ£„Åó„ÅÑÂçòË™û„Åß„Åó„Åü„Åå„ÄÅ`),t.push("Ë¶ã‰∫ã„Å´Ê≠£Ëß£„Åó„Åæ„Åó„ÅüÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„Åß„ÅôÔºÅ`),t.push("Á¥†Êô¥„Çâ„Åó„ÅÑÈõÜ‰∏≠Âäõ„Åß„Åô„Å≠ üå∏")):e.correctStreak>=3&&t.push("Ë™øÂ≠ê„ÅåÂá∫„Å¶„Åç„Åæ„Åó„Åü„Å≠"),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÅßÊ≠£Ëß£ÔºÅ`),t.push("Â∞ë„Åó„Åö„Å§ÂæóÊÑè„Å´„Å™„Å£„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Çà üòä")),e.hasSeenBefore&&e.previousAttempts>2&&(t.push("ÂâçÂõû„Çà„ÇäÊó©„ÅèÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠"),t.push("Á¢∫ÂÆü„Å´ÊàêÈï∑„Åó„Å¶„ÅÑ„Åæ„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ„ÇÇ„ÅÜ${e.todayQuestions}Âïè„ÇÇÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠`),t.push("ÁÑ°ÁêÜ„Åó„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„Å≠")),e.learningPhase==="ENCODING"?t.push("Ë®òÊÜ∂„ÅÆÁ¨¶Âè∑Âåñ„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô üìù"):e.learningPhase==="INITIAL_CONSOLIDATION"?t.push("Ë®òÊÜ∂„ÅåÂÆöÁùÄ„Åó„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô„Å≠ ‚ú®"):e.learningPhase==="LONG_TERM_RETENTION"?t.push("Èï∑ÊúüË®òÊÜ∂„Å´ÁßªË°å„Åß„Åç„Å¶„ÅÑ„Åæ„Åô üåü"):e.learningPhase==="MASTERED"&&t.push("ÂÆåÂÖ®„Å´„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Åü„Å≠ üéâ"),t.join(" ")}generateIncorrectComment(e){const t=[];return e.attemptCount===1?t.push("ÊÉú„Åó„ÅÑ„Åß„Åô"):t.push("Èõ£„Åó„Åã„Å£„Åü„Åß„Åô„Å≠"),t.push("„Åß„ÇÇÂ§ß‰∏àÂ§´„Åß„Åô"),e.difficulty==="advanced"?(t.push(`${e.word}„ÅØ‰∏äÁ¥öÂçòË™û„Å™„ÅÆ„Åß`),t.push("‰ΩïÂ∫¶„ÅãÂæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ")):e.difficulty==="beginner"&&(t.push("Âü∫Á§éÁöÑ„Å™ÂçòË™û„Å™„ÅÆ„Åß"),t.push("„ÇÜ„Å£„Åè„ÇäË¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.incorrectStreak>=3&&(t.push("Â∞ë„ÅóÁñ≤„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü"),t.push("Ê∑±ÂëºÂê∏„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ üå±")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØË¶ÅÊ≥®ÊÑè„ÅÆÂçòË™û„Åß„Åô„Å≠`),t.push("‰∏ÄÁ∑í„Å´Ë¶ö„ÅàÁõ¥„Åó„Åæ„Åó„Çá„ÅÜ")),e.timeOfDay==="night"&&(t.push("Â§ú„ÅØÈõÜ‰∏≠„Åó„Å•„Çâ„ÅÑ„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô"),t.push("ÁÑ°ÁêÜ„Åõ„Åö‰ºëÊÜ©„ÇÇÂ§ßÂàá„Åß„Åô„Çà")),t.push("Ê¨°„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åô„Çà üòä"),t.join(" ")}}class SQ{generateCorrectComment(e){const t=[];if(t.push("Ê≠£Ëß£„ÄÇ"),t.push(`ÂøúÁ≠îÊôÇÈñì: ${(e.responseTime/1e3).toFixed(1)}Áßí`),e.attemptCount>1&&t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.correctStreak>0){t.push(`ÈÄ£Á∂öÊ≠£Ëß£: ${e.correctStreak}`);const s=Math.min(100,e.userAccuracy+2);t.push(`Ê≠£Á≠îÁéá: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}if(e.difficulty==="advanced"&&(t.push("Èõ£ÊòìÂ∫¶: ‰∏äÁ¥ö"),t.push("ÊúüÂæÖÊ≠£Á≠îÁéá„Çí‰∏äÂõû„Çã„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ")),e.isWeakCategory){t.push(`Ëã¶Êâã„Ç´„ÉÜ„Ç¥„É™„Éº(${e.category})„ÅßÊ≠£Ëß£`);const s=Math.min(100,e.categoryAccuracy+3);t.push(`„Ç´„ÉÜ„Ç¥„É™„ÉºÊ≠£Á≠îÁéá: ${e.categoryAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return t.push("üìä"),t.join(" ")}generateIncorrectComment(e){const t=[];if(t.push("‰∏çÊ≠£Ëß£„ÄÇ"),t.push(`Ë©¶Ë°åÂõûÊï∞: ${e.attemptCount}`),e.incorrectStreak>0){t.push(`ÈÄ£Á∂ö‰∏çÊ≠£Ëß£: ${e.incorrectStreak}`);const s=Math.max(0,e.userAccuracy-2);t.push(`Ê≠£Á≠îÁéáÂΩ±Èüø: ${e.userAccuracy.toFixed(0)}% ‚Üí ${s.toFixed(0)}%`)}return e.difficulty==="beginner"&&(t.push("Âü∫Á§é„É¨„Éô„É´‰∏çÊ≠£Ëß£Ê§úÂá∫"),t.push("ÂÑ™ÂÖàÂæ©ÁøíÂØæË±°„Å´ËøΩÂä†")),e.hasSeenBefore&&(t.push(`Êó¢Âá∫ÂçòË™û: ${e.previousAttempts+1}ÂõûÁõÆ„ÅÆ‰∏çÊ≠£Ëß£`),t.push("ÁøíÂæóÈõ£ÊòìÂ∫¶„Çπ„Ç≥„Ç¢: È´ò")),t.push("Ê¨°ÂõûÂá∫È°åÁ¢∫Áéá: 80%"),t.join(" ")}}class CQ{generateCorrectComment(e){const t=[],s=["„Éä„Ç§„ÇπÔºÅ","„Çà„ÅóÔºÅ","„ÅÑ„ÅÑ„ÅûÔºÅ","„ÇÑ„Å£„ÅüÔºÅ"];return t.push(s[Math.floor(Math.random()*s.length)]),e.attemptCount===1?t.push("‰∏ÄÁô∫„ÅßÊ±∫„ÇÅ„ÅüÔºÅ"):e.attemptCount===2?t.push("Á´ã„Å¶Áõ¥„Åó„Åü„Å™ÔºÅ"):(t.push(`${e.attemptCount}ÂõûÁõÆ„ÅßÊ±∫„ÇÅ„ÅüÔºÅ`),t.push("„ÇÇ„Å£„Å®Êó©„ÅèË°å„Åì„ÅÜÔºÅ")),e.correctStreak>=5?(t.push(`${e.correctStreak}ÈÄ£Á∂öÔºÅ`),t.push("„ÅäÂâç„ÅØÁÑ°Êïµ„Å†ÔºÅüî•")):e.correctStreak>=3&&t.push("Ê≥¢„Å´‰πó„Å£„Å¶„Åç„Åü„ÅûÔºÅ"),e.difficulty==="advanced"&&(t.push(`${e.word}„ÇíÂÄí„Åó„ÅüÔºÅ`),t.push("„ÅäÂâç„ÅØÂº∑„ÅÑÔºÅüí™")),e.isWeakCategory&&(t.push(`Ëã¶Êâã„Å™${e.category}„ÇíÂÖãÊúçÔºÅ`),t.push("„Åì„Çå„ÅåÊàêÈï∑„Å†ÔºÅ")),e.todayQuestions>=50&&e.todayAccuracy>=80&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÇØ„É™„Ç¢ÔºÅ`),t.push("Áµ∂Â•ΩË™ø„Å†ÔºÅüèÜ")),t.push("„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ"),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÊÉú„Åó„ÅÑÔºÅ"),e.incorrectStreak<3?(t.push("„Å†„Åå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑÔºÅ"),t.push("„ÇÇ„ÅÜ‰∏Ä‰∏ÅÔºÅ")):(t.push("ÈÄ£Á∂ö„Éü„ÇπÔºÅ"),t.push("„Å†„ÅåÂãùË≤†„ÅØ„Åì„Çå„Åã„Çâ„Å†ÔºÅ")),e.difficulty==="beginner"&&(t.push("ÁÑ¶„Å£„Åü„Å™ÔºÅ"),t.push("ËêΩ„Å°ÁùÄ„ÅëÔºÅ")),e.hasSeenBefore&&(t.push(`„Åæ„Åü${e.word}„ÅãÔºÅ`),t.push("‰ªäÂ∫¶„Åì„Åù„É™„Éô„É≥„Ç∏„Å†ÔºÅüí™")),e.todayAccuracy<60?(t.push("Ë™øÂ≠ê„ÅåÊÇ™„ÅÑ„Å™ÔºÅ"),t.push("„Å†„ÅåË≤†„Åë„Çã„Å™ÔºÅ"),t.push("„Åì„Åì„Åã„ÇâÈÄÜËª¢„Å†ÔºÅüî•")):t.push("„ÅäÂâç„Å™„Çâ„Åß„Åç„ÇãÔºÅ"),t.join(" ")}}class NQ{generateCorrectComment(e){const t=[];return t.push("Ê≠£Ëß£„Åß„Åô„ÄÇ"),t.push(`${e.word}„Å®„ÅÑ„ÅÜË®ÄËëâ„Åå„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‰∏ÄÈÉ®„Å´„Å™„Çä„Åæ„Åó„Åü`),e.attemptCount>1&&t.push("Ëø∑„ÅÑ„ÅåÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô"),e.correctStreak>=5?(t.push(`${e.correctStreak}ÂïèÈÄ£Á∂öÊ≠£Ëß£„ÄÇ`),t.push("Ë®òÊÜ∂„ÅÆÂÆöÁùÄ„ÅåÁ¢∫ÂÆü„Å´„Å™„Çä„Åæ„Åó„Åü üåô")):e.correctStreak>=3&&t.push("Áü•Ë≠ò„ÅåÊ†π„ÇíÂºµ„ÇäÂßã„ÇÅ„Å¶„ÅÑ„Åæ„Åô üå±"),e.difficulty==="advanced"&&(t.push("Èõ£„Åó„ÅÑË®ÄËëâ„ÇíÁêÜËß£„Åó„Åæ„Åó„Åü„Å≠"),t.push("Áü•ÊÅµ„ÅåÊ∑±„Åæ„Çä„Åæ„Åô")),e.isWeakCategory&&(t.push("Ëã¶Êâã„ÇíÂÖãÊúç„Åó„Åæ„Åó„Åü"),t.push("ÊàêÈï∑„Å®„ÅØÂ§âÂåñ„ÇíÂèó„ÅëÂÖ•„Çå„Çã„Åì„Å®„Åß„Åô")),e.todayQuestions>=50&&(t.push(`‰ªäÊó•„ÅØ${e.todayQuestions}Âïè„ÅÆÁµåÈ®ì„ÇíÁ©ç„Åø„Åæ„Åó„Åü`),t.push("‰∏ÄÊó•‰∏ÄÊó•„ÅåÊú™Êù•„Å∏„ÅÆÊäïË≥á„Åß„Åô üìñ")),t.join(" ")}generateIncorrectComment(e){const t=[];return t.push("ÈñìÈÅï„ÅÑ„ÅØÂ≠¶„Å≥„ÅÆÂßã„Åæ„Çä„Åß„Åô„ÄÇ"),e.attemptCount===1?t.push("ÂÜçÂ∫¶ÊåëÊà¶„Åó„Åæ„Åó„Çá„ÅÜ"):(t.push("„Åæ„Å†ÁêÜËß£„ÅÆÈÄî‰∏≠„Åß„Åô"),t.push("ÁÑ¶„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì üå±")),e.difficulty==="beginner"&&t.push("Âü∫Á§é„Å´Êàª„Çã„Åì„Å®„ÅØÊÅ•„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì"),e.incorrectStreak>=3&&(t.push("ÈÄ£Á∂ö„ÅßÈñìÈÅï„Åà„Åæ„Åó„Åü"),t.push("‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åß„Åô")),e.hasSeenBefore&&(t.push(`${e.word}„ÅØ„ÅÇ„Å™„Åü„ÅÆË™≤È°å„Åß„Åô`),t.push("‰ΩïÂ∫¶„Åß„ÇÇÂêë„ÅçÂêà„ÅÑ„Åæ„Åó„Çá„ÅÜ")),e.todayAccuracy<60&&(t.push("Ê≠£Á≠îÁéá„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô"),t.push("„Åó„Åã„ÅóÈÅì„ÅØÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô")),t.push("Ë®òÊÜ∂„Å®„ÅØÁπ∞„ÇäËøî„Åó„ÅÆËä∏Ë°ì„Åß„Åô üìñ"),t.join(" ")}}function AI(n,e){let t;switch(n){case"drill-sergeant":t=new wQ;break;case"kind-teacher":t=new vQ;break;case"analyst":t=new SQ;break;case"enthusiastic-coach":t=new CQ;break;case"wise-sage":t=new NQ;break}return e.isCorrect?t.generateCorrectComment(e):t.generateIncorrectComment(e)}const IQ={"drill-sergeant":{avatar:"üëπ",name:"È¨ºËªçÊõπ",description:"Âé≥„Åó„ÅèÈçõ„Åà„Çã",tone:"Âé≥„Åó„Åè„ÄÅÂ¶•Âçî„Å™„Åó„ÄÅÁµêÊûúÈáçË¶ñ"},"kind-teacher":{avatar:"üòä",name:"ÂÑ™„Åó„ÅÑÂÖàÁîü",description:"‰∏ÅÂØß„Å´„Çµ„Éù„Éº„Éà",tone:"ÂÑ™„Åó„Åè„ÄÅ‰∏ÅÂØß„ÄÅ„Åß„ÇÇÊ≠£Á¢∫"},analyst:{avatar:"ü§ñ",name:"ÂÜ∑Èùô„Å™ÂàÜÊûêÂÆò",description:"„Éá„Éº„Çø„ÅßÂà§Êñ≠",tone:"ÊÑüÊÉÖ„Å™„Åó„ÄÅ‰∫ãÂÆü„ÅÆ„Åø„ÄÅÁµ±Ë®àÈáçË¶ñ"},"enthusiastic-coach":{avatar:"üòº",name:"ÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ",description:"ÁÜ±„ÅèÂøúÊè¥",tone:"ÁÜ±„Åè„ÄÅ„Éù„Ç∏„ÉÜ„Ç£„Éñ„ÄÅÊåëÊà¶ÁöÑ"},"wise-sage":{avatar:"üßô",name:"Ë≥¢ËÄÖ",description:"Èï∑ÊúüË¶ñÁÇπ„ÅßÂ∞é„Åè",tone:"ËêΩ„Å°ÁùÄ„Åç„ÄÅÈï∑ÊúüË¶ñÁÇπ„ÄÅÊú¨Ë≥™ÈáçË¶ñ"}};function EI(){return localStorage.getItem("lastLoginDate")}function kQ(){const n=localStorage.getItem("loginStreak");return n?parseInt(n,10):0}function $Q(){const n=EI();if(!n)return 0;const e=new Date().toISOString().split("T")[0],t=new Date(n),r=new Date(e).getTime()-t.getTime();return Math.floor(r/(1e3*60*60*24))}function TQ(){const n=new Date().toISOString().split("T")[0],e=localStorage.getItem(`studyStats-${n}`);if(!e)return{count:0,accuracy:0};const t=JSON.parse(e);return{count:t.count||0,accuracy:t.correct&&t.count?t.correct/t.count*100:0}}function AQ(n){const e=A0(),t=$Q(),s=kQ(),{count:r,accuracy:o}=TQ(),i={lastLoginDate:EI(),todayStudyCount:r,todayAccuracy:o};return t>=3?EQ(n,t):s>=7&&r===0?RQ(n,s):DQ(n,e,i)}function EQ(n,e){switch(n){case"drill-sergeant":return e>=7?`${e}Êó•„ÇÇÁ©∫„Åë„Çã„Å®„ÅØ‰Ωï‰∫ã„Å†ÔºÅ‰ªä„Åô„ÅêÂæ©Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ`:`${e}Êó•„Å∂„Çä„Åã„ÄÇÈÅÖ„Çå„ÇíÂèñ„ÇäÊàª„Åô„ÅûÔºÅ`;case"kind-teacher":return e>=7?`üòÉ „Åä‰πÖ„Åó„Å∂„Çä„Åß„ÅôÔºÅ${e}Êó•Áµå„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÁÑ¶„Çâ„ÅöÂ∞ë„Åó„Åö„Å§ÊÄù„ÅÑÂá∫„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`:`üòÉ ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ„ÇÜ„Å£„Åè„ÇäÂæ©Áøí„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`;case"analyst":return e>=7?`ü§ñ ÂâçÂõû„Åã„Çâ${e}Êó•ÁµåÈÅé„ÄÇË®òÊÜ∂ÂÆöÁùÄÁéá„ÅØÊé®ÂÆö40-60%„ÄÇ‰ΩìÁ≥ªÁöÑ„Å™Âæ©Áøí„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`:`ü§ñ ${e}Êó•„ÅÆÈñìÈöî„ÄÇÂøòÂç¥Êõ≤Á∑ö„ÇíËÄÉÊÖÆ„Åó„ÅüÂæ©Áøí„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;case"enthusiastic-coach":return e>=7?`üòº ${e}Êó•„Å∂„Çä„ÅÆ„Ç´„É†„Éê„ÉÉ„ÇØÔºÅ‰ªäÊó•„Åã„ÇâÂÜç„Çπ„Çø„Éº„Éà„Å†ÔºÅÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ`:`üòº ÂæÖ„Å£„Å¶„Åü„ÅúÔºÅ${e}Êó•„ÅÆÈÅÖ„Çå„ÅØ‰ªäÊó•Âèñ„ÇäÊàª„Åù„ÅÜÔºÅ`;case"wise-sage":return e>=7?`üßô ${e}Êó•„ÅÆ‰ºëÊÅØ„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ`:`üßô ${e}Êó•„ÅÆÁ©∫ÁôΩ„ÇÇ„ÄÅ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅÆÊôÇÈñì„Å†„Å£„Åü„ÅÆ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ„Åï„ÅÇ„ÄÅ„ÇÜ„Å£„Åè„ÇäÂÜçÈñã„Åò„ÇÉ„ÄÇ`;default:return`„ÅäÂ∏∞„Çä„Å™„Åï„ÅÑÔºÅ${e}Êó•„Å∂„Çä„Åß„Åô„Å≠„ÄÇ`}}function RQ(n,e){switch(n){case"drill-sergeant":return`${e}Êó•ÈÄ£Á∂öÔºÅÁ¥†Êô¥„Çâ„Åó„ÅÑÁ∂ôÁ∂öÂäõ„Å†ÔºÅ‰ªäÊó•„ÇÇÊ≤πÊñ≠„Åô„Çã„Å™ÔºÅ`;case"kind-teacher":return`üòÉ ${e}Êó•ÈÄ£Á∂ö„É≠„Ç∞„Ç§„É≥„ÄÅÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅÁ∂ôÁ∂ö„ÅØÂäõ„Å™„Çä„Åß„Åô„ÄÇ`;case"analyst":return`ü§ñ ${e}Êó•ÈÄ£Á∂ö„ÄÇÁ∂ôÁ∂öÁéá100%„ÄÇÁµ±Ë®àÁöÑ„Å´Â≠¶ÁøíÂäπÊûú„ÅØÊúÄÂ§ßÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;case"enthusiastic-coach":return`üòº ${e}Êó•ÈÄ£Á∂öÈÅîÊàêÔºÅ„Åì„ÅÆÂã¢„ÅÑ„ÅßÁ™Å„ÅçÈÄ≤„ÇÅÔºÅË®òÈå≤Êõ¥Êñ∞„Å†ÔºÅ`;case"wise-sage":return`üßô ${e}Êó•„ÅÆÁ∂ôÁ∂ö„ÄÅË¶ã‰∫ã„Åò„ÇÉ„ÄÇÂçÉÈáå„ÅÆÈÅì„ÇÇ‰∏ÄÊ≠©„Åã„Çâ„ÄÅ„Åò„ÇÉ„Å™„ÄÇ`;default:return""}}function DQ(n,e,t){const{todayStudyCount:s,todayAccuracy:r}=t;switch(n){case"drill-sergeant":return _Q(e,s);case"kind-teacher":return PQ(e,s);case"analyst":return jQ(e,s,r);case"enthusiastic-coach":return MQ(e,s);case"wise-sage":return FQ(e,s);default:return null}}function _Q(n,e,t){switch(n){case"morning":return e===0?"Êúù„Å†„ÅûÔºÅËÑ≥„Åå‰∏ÄÁï™ÂÜ¥„Åà„Å¶„ÇãÊôÇÈñì„Å†ÔºÅ‰ªä„Åô„ÅêÂ≠¶Áøí„ÇíÈñãÂßã„Åó„ÇçÔºÅ":e>=20?"Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÇíÁ∂≠ÊåÅ„Åó„ÇçÔºÅ":"Êúù„ÅÆÂ≠¶Áøí„ÅØÂäπÊûúÁöÑ„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÑ„Çå„Çã„ÅØ„Åö„Å†ÔºÅ";case"afternoon":return e===0?"ÂçàÂæå„Å´„Å™„Å£„Åü„ÅûÔºÅ‰ªäÊó•„ÅØ„Åæ„Å†‰Ωï„ÇÇ„ÇÑ„Å£„Å¶„Å™„ÅÑ„ÅÆ„ÅãÔºü„Åï„Å£„Åï„Å®Âßã„ÇÅ„ÇçÔºÅ":e>=20?"ÂçàÂæå„ÇÇÈ†ÜË™ø„Å†„Å™ÔºÅÂçàÂâç‰∏≠„ÅÆÂã¢„ÅÑ„ÇíËêΩ„Å®„Åô„Å™ÔºÅ":"ÂçàÂæå„ÅØÈõÜ‰∏≠Âäõ„ÅåËêΩ„Å°„ÇÑ„Åô„ÅÑ„ÄÇÊ∞óÂêà„ÇíÂÖ•„ÇåÁõ¥„ÅõÔºÅ";case"evening":return e===0?"„ÇÇ„ÅÜÂ§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÂàÜ„ÅØ‰ªäÊó•‰∏≠„Å´ÁµÇ„Çè„Çâ„Åõ„ÇçÔºÅ":e>=30?"‰ªäÊó•„ÅØ„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅ„ÅÇ„Å®Â∞ë„Åó„ÅßÂÆåÁíß„Å†ÔºÅ":"Â§ïÊñπ„ÅØÂæ©Áøí„ÅÆ„Ç¥„Éº„É´„Éá„É≥„Çø„Ç§„É†„Å†ÔºÅËøΩ„ÅÑËæº„Åø„Çí„Åã„Åë„ÇçÔºÅ";case"night":return e===0?"Â§ú„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„Åü„ÅûÔºÅÂ∞ë„Åó„Åß„ÇÇ„ÅÑ„ÅÑ„Åã„ÇâÂ≠¶Áøí„Åó„ÇçÔºÅ0„Çà„Çä1„Å†ÔºÅ":e>=30?"Â§úÈÅÖ„Åè„Åæ„Åß„Çà„ÅèÈ†ëÂºµ„Å£„ÅüÔºÅÊó©„Åè‰ºë„Çì„ÅßÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ":"Â§ú„ÅØËªΩ„ÇÅ„ÅÆÂæ©Áøí„ÅåÂäπÊûúÁöÑ„Å†ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™ÔºÅ";default:return"„Åï„ÅÇ„ÄÅÂ≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„ÅûÔºÅ"}}function PQ(n,e,t){switch(n){case"morning":return e===0?"üòÉ „Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅÊúù„ÅØË®òÊÜ∂Âäõ„ÅåÈ´ò„Åæ„ÇãÊôÇÈñì„Åß„Åô„Çà„ÄÇ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ":e>=20?"üòÉ Êúù„Åã„ÇâÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Åß„ÇÇÁÑ°ÁêÜ„ÅØ„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åß„Åô„Å≠ÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"afternoon":return e===0?"üòÉ „Åì„Çì„Å´„Å°„ÅØÔºÅÂçàÂæå„ÅØÂ∞ë„ÅóÁú†„Åè„Å™„Çä„ÇÑ„Åô„ÅÑ„ÅÆ„Åß„ÄÅËªΩ„ÇÅ„ÅÆÂæ©Áøí„Åå„Åä„Åô„Åô„ÇÅ„Åß„Åô„Çà„ÄÇ":e>=20?"üòÉ ÂçàÂæå„ÇÇ„Çà„ÅèÈ†ëÂºµ„Å£„Å¶„ÅÑ„Åæ„Åô„Å≠ÔºÅ‰ºëÊÜ©„ÇÇÂøò„Çå„Åö„Å´Âèñ„Å£„Å¶„Åè„Å†„Åï„ÅÑ„Å≠„ÄÇ":"üòÉ ÂçàÂæå„ÇÇÈ†ÜË™ø„Åß„Åô„Å≠„ÄÇ„Éû„Ç§„Éö„Éº„Çπ„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ";case"evening":return e===0?"üòÉ „Åì„Çì„Å∞„Çì„ÅØ„ÄÇÂ§ïÊñπ„ÅØÂæ©Áøí„Å´ÊúÄÈÅ©„Å™ÊôÇÈñì„Åß„Åô„ÄÇ‰ªäÊó•Â≠¶„Çì„Å†„Åì„Å®„ÇíËªΩ„ÅèË¶ãÁõ¥„Åó„Å¶„Åø„Åæ„Åõ„Çì„ÅãÔºü":e>=30?"üòÉ ‰ªäÊó•„ÅØÊú¨ÂΩì„Å´„Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠ÔºÅ„ÇÇ„ÅÜÂçÅÂàÜ„Åß„Åô„Çà„ÄÇ":"üòÉ Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑ„Åß„Åô„Å≠ÔºÅÁÑ¶„Çâ„Åö„ÇÜ„Å£„Åè„ÇäÈÄ≤„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ";case"night":return e===0?"üòÉ Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßò„Åß„Åô„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅ„Åß„Åç„ÇãÁØÑÂõ≤„ÅßÂ§ß‰∏àÂ§´„Åß„Åô„Çà„ÄÇ":e>=30?"üòÉ ‰ªäÊó•„ÅØÂçÅÂàÜÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅ„Åù„Çç„Åù„Çç‰ºë„Çì„Åß„ÄÅÊòéÊó•„Å´ÂÇô„Åà„Åæ„Åó„Çá„ÅÜ„Å≠„ÄÇ":"üòÉ Â§ú„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åß„Åô„Åå„ÄÅÁù°Áú†„ÇÇÂêå„Åò„Åè„Çâ„ÅÑÂ§ßÂàá„Åß„Åô„Çà„ÄÇ";default:return"üòÉ ‰∏ÄÁ∑í„Å´È†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Å≠ÔºÅ"}}function jQ(n,e,t){switch(n){case"morning":return e===0?"ü§ñ ÁèæÂú®ÊôÇÂàªÔºöÊúù„ÄÇËÑ≥„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÔºöÊúÄÈÅ©„ÄÇÊñ∞Ë¶èÂ≠¶ÁøíÂäπÁéáÔºö+30%„ÄÇÂ≠¶ÁøíÈñãÂßã„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êúù„ÅÆÂ≠¶Áøí${e}ÂïèÂÆå‰∫Ü„ÄÇÊ≠£Á≠îÁéá${t.toFixed(1)}%„ÄÇËâØÂ•Ω„Å™„Éö„Éº„Çπ„ÄÇ`:"ü§ñ Êúù„ÅÆÂ≠¶ÁøíÈÄ≤Ë°å‰∏≠„ÄÇË™çÁü•Ê©üËÉΩ„ÅåÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÇíÊ¥ªÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";case"afternoon":return e===0?"ü§ñ ÂçàÂæå„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÈõÜ‰∏≠ÂäõÔºö„ÇÑ„ÇÑ‰Ωé‰∏ãÂÇæÂêë„ÄÇÁü≠ÊôÇÈñìÈõÜ‰∏≠Âûã„ÅÆÂ≠¶Áøí„ÇíÊé®Â•®„ÄÇ":e>=20?`ü§ñ Êú¨Êó•${e}ÂïèÂ≠¶ÁøíÊ∏à„Åø„ÄÇÂçàÂæå„ÅÆÁîüÁî£ÊÄßÔºöÁ∂≠ÊåÅ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`:"ü§ñ ÂçàÂæå„ÅÆÂ≠¶ÁøíÁ∂ôÁ∂ö‰∏≠„ÄÇ15ÂàÜ√ó3„Çª„ÉÉ„Éà„ÅÆÂàÜÂâ≤Â≠¶Áøí„ÅåÂäπÊûúÁöÑ„Åß„Åô„ÄÇ";case"evening":return e===0?"ü§ñ Â§ïÊñπ„ÅÆÊôÇÈñìÂ∏Ø„ÄÇÂæ©ÁøíÂäπÁéáÔºöÊúÄÈ´ò„É¨„Éô„É´„ÄÇ‰ªäÊó•„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÆöÁùÄ„Å´ÊúÄÈÅ©„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÈÅîÊàê„ÄÇÂçÅÂàÜ„Å™Â≠¶ÁøíÈáè„Åß„Åô„ÄÇ‰ºëÊÅØ„ÇíÊé®Â•®„ÄÇ`:"ü§ñ Â§ïÊñπ„ÅÆÂæ©Áøí„Çø„Ç§„É†„ÄÇÊúù„ÅÆÂ≠¶ÁøíÂÜÖÂÆπ„ÅÆÂÜçÁ¢∫Ë™ç„ÅåË®òÊÜ∂ÂÆöÁùÄÁéá„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ";case"night":return e===0?"ü§ñ Â§úÈñì„ÄÇÊñ∞Ë¶èÂ≠¶Áøí„Çà„ÇäÂæ©Áøí„ÇíÊé®Â•®„ÄÇÁù°Áú†Ââç„ÅÆËªΩ„ÅÑÂæ©Áøí„ÅØË®òÊÜ∂„ÅÆÂõ∫ÂÆöÂåñ„Å´ÊúâÂäπ„ÄÇ":e>=30?`ü§ñ Êú¨Êó•${e}ÂïèÂÆå‰∫Ü„ÄÇÂ≠¶ÁøíÁõÆÊ®ôÈÅîÊàê„ÄÇ22-23ÊôÇ„ÅÆÂ∞±ÂØù„ÅßË®òÊÜ∂ÂÆöÁùÄÁéá„ÅåÂêë‰∏ä„Åó„Åæ„Åô„ÄÇ`:"ü§ñ Â§úÈñìÂ≠¶Áøí‰∏≠„ÄÇÈÅéÂ∫¶„Å™Â≠¶Áøí„ÅØÁù°Áú†„ÅÆË≥™„Çí‰Ωé‰∏ã„Åï„Åõ„Åæ„Åô„ÄÇÈÅ©Â∫¶„Å™Â≠¶Áøí„ÇíÊé®Â•®„ÄÇ";default:return"ü§ñ Â≠¶Áøí„Éá„Éº„Çø„ÇíË®òÈå≤‰∏≠„ÄÇÁ∂ôÁ∂öÁöÑ„Å™Â≠¶Áøí„ÅåÊúÄ„ÇÇÂäπÁéáÁöÑ„Åß„Åô„ÄÇ"}}function MQ(n,e,t){switch(n){case"morning":return e===0?"üòº Êúù„Å†ÔºÅÊñ∞„Åó„ÅÑ‰∏ÄÊó•„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ‰ªäÊó•„ÇÇÊúÄÈ´ò„ÅÆÂ≠¶Áøí„Çí„Åó„Çà„ÅÜÔºÅ":e>=20?"üòº Êúù„Åã„ÇâÁµ∂Â•ΩË™ø„Å†„Å™ÔºÅ„Åì„ÅÆÂã¢„ÅÑ„Åß‰ªäÊó•„ÇÇÂÆåÁíß„Å´„ÇÑ„ÇäÈÅÇ„Åí„Çà„ÅÜÔºÅ":"üòº Êúù„ÅÆÂ≠¶Áøí„ÄÅÊúÄÈ´ò„Å†ÔºÅ„ÇÇ„Å£„Å®„ÇÇ„Å£„Å®Ë°å„Åë„Çã„ÅûÔºÅ";case"afternoon":return e===0?"üòº ÂçàÂæå„ÇÇÂÖÉÊ∞óÂá∫„Åó„Å¶„ÅÑ„Åì„ÅÜÔºÅ‰ªä„Åã„Çâ„Åß„ÇÇÈÅÖ„Åè„Å™„ÅÑ„ÅûÔºÅÂÖ®Âäõ„ÅßË°å„ÅëÔºÅ":e>=20?"üòº ÂçàÂæå„ÇÇÁ¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Å†ÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ":"üòº ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÊ∞óÂêàÂçÅÂàÜ„Å†„Å™ÔºÅ„Åì„ÅÆË™øÂ≠ê„Åì„ÅÆË™øÂ≠êÔºÅ";case"evening":return e===0?"üòº Â§ïÊñπ„Å†„ÅûÔºÅ‰ªäÊó•„ÅÆÁõÆÊ®ô„ÅØ„Åæ„Å†ÈÅîÊàê„Åó„Å¶„Å™„ÅÑ„Å†„ÇçÔºü„Åï„ÅÇ„ÄÅ„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº ‰ªäÊó•„ÅØÂÆåÁíß„Å†ÔºÅ„ÅäÂâç„ÅÆÂä™Âäõ„ÅØÂøÖ„ÅöÂ†±„Çè„Çå„ÇãÔºÅË™á„Çä„Å´ÊÄù„ÅàÔºÅ":"üòº Â§ïÊñπ„ÅÆËøΩ„ÅÑËæº„Åø„ÄÅËâØ„ÅÑ„ÅûÔºÅ„É©„Çπ„Éà„Çπ„Éë„Éº„Éà„Å†ÔºÅ";case"night":return e===0?"üòº Â§ú„Å†„Åë„Å©Ë´¶„ÇÅ„Çã„Å™ÔºÅ„Åü„Å£„Åü10ÂàÜ„Åß„ÇÇ„ÅÑ„ÅÑ„ÄÅ‰ªäÊó•„ÅÆÂàÜ„Çí„ÇÑ„Çç„ÅÜÔºÅ":e>=30?"üòº Â§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÊßòÔºÅ‰ªäÊó•„ÅÆ„ÅäÂâç„ÅØÊúÄÈ´ò„Å†„Å£„ÅüÔºÅ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÅÔºÅ":"üòº Â§ú„ÅÆÂ≠¶Áøí„ÇÇÈ†ëÂºµ„Å£„Å¶„Çã„Å™ÔºÅÁÑ°ÁêÜ„ÅØ„Åô„Çã„Å™„Çà„ÄÅ„Åß„ÇÇÈ†ëÂºµ„ÇåÔºÅ";default:return"üòº „Åï„ÅÇ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„ÅßË°å„Åè„ÅûÔºÅ„ÅäÂâç„Å™„ÇâÁµ∂ÂØæ„Åß„Åç„ÇãÔºÅ"}}function FQ(n,e,t){switch(n){case"morning":return e===0?"üßô Êúù„ÅÆÈùô„Åë„Åï„ÅØÂ≠¶„Å≥„Å´ÊúÄÈÅ©„Åò„ÇÉ„ÄÇÂøÉ„ÇíËêΩ„Å°ÁùÄ„Åë„Å¶„ÄÅ„ÇÜ„Å£„Åè„ÇäÂßã„ÇÅ„Çã„Åå„Çà„ÅÑ„ÄÇ":e>=20?"üßô Êúù„Åã„ÇâËâØ„ÅÑ„Éö„Éº„Çπ„Åò„ÇÉ„ÅÆ„ÅÜ„ÄÇÁÑ¶„Çâ„Åö„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ":"üßô Êúù„ÅÆÂ≠¶Áøí„ÄÅÈ†ÜË™ø„Åò„ÇÉ„Å™„ÄÇÁÑ°ÁêÜ„Åõ„Åö„ÄÅËá™ÂàÜ„ÅÆ„Éö„Éº„Çπ„ÅßÈÄ≤„ÇÄ„ÅÆ„Åò„ÇÉ„ÄÇ";case"afternoon":return e===0?"üßô ÂçàÂæå„ÅØÂ∞ë„Åó‰ºë„Çì„Åß„Åã„ÇâÂßã„ÇÅ„Çã„ÅÆ„ÇÇËâØ„ÅÑ„Åû„ÄÇÁÑ¶„ÇãÂøÖË¶Å„ÅØ„Å™„ÅÑ„ÄÇ":e>=20?"üßô ÂçàÂæå„ÇÇÁùÄÂÆü„Å´ÈÄ≤„Çì„Åß„Åä„Çã„ÅÆ„ÅÜ„ÄÇÁ∂ôÁ∂ö„Åì„Åù„ÅåÂäõ„Åò„ÇÉ„ÄÇ":"üßô ÂçàÂæå„ÅÆÂ≠¶Áøí„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åå„ÄÅ‰ºëÊÅØ„ÇÇÂøò„Çå„Å¨„Çà„ÅÜ„Å´„Å™„ÄÇ";case"evening":return e===0?"üßô Â§ïÊöÆ„ÇåÊôÇ„ÅØ‰∏ÄÊó•„ÇíÊåØ„ÇäËøî„ÇãÊôÇÈñì„Åò„ÇÉ„ÄÇÂ≠¶„Å≥„ÇÇÂêå„Åò„Åè„ÄÅÂæ©Áøí„ÅåÂ§ßÂàá„Åò„ÇÉ„Åû„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅØ„Çà„ÅèÂä±„Çì„Å†„ÅÆ„ÅÜ„ÄÇÂ≠¶„Å≥„ÅØÈáè„Çà„ÇäË≥™„Åò„ÇÉ„ÄÇÂçÅÂàÜ„Åò„ÇÉ„Çç„ÅÜ„ÄÇ":"üßô Â§ïÊñπ„ÅÆÂæ©Áøí„ÄÅËâØ„ÅÑÁøíÊÖ£„Åò„ÇÉ„ÄÇÊÄ•„Åå„Åö„ÄÅÁ¢∫ÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ";case"night":return e===0?"üßô Â§ú„ÅØÂøÉÁ©è„ÇÑ„Åã„Å´ÈÅé„Åî„Åô„ÅåËâØ„ÅÑ„ÄÇËªΩ„ÅÑÂæ©Áøí„Å†„Åë„Åß„ÇÇÂçÅÂàÜ„Åò„ÇÉ„ÄÇ":e>=30?"üßô ‰ªäÊó•„ÅÆÂ≠¶„Å≥„ÅØÂçÅÂàÜ„Åò„ÇÉ„ÄÇËâØ„ÅçÁù°Áú†„ÅåÊòéÊó•„Å∏„ÅÆÂäõ„Å®„Å™„Çã„ÄÇ„ÇÜ„Å£„Åè„Çä‰ºë„ÇÄ„Åå„Çà„ÅÑ„ÄÇ":"üßô Â§úÊõ¥„Åã„Åó„ÅØ„Åª„Å©„Åª„Å©„Å´„Å™„ÄÇÁù°Áú†„ÇÇÂ≠¶„Å≥„ÅÆ‰∏ÄÈÉ®„Åò„ÇÉ„Åû„ÄÇ";default:return"üßô Â≠¶„Å≥„Å®„ÅØÈï∑„ÅÑÊóÖ„Åò„ÇÉ„ÄÇ‰∏ÄÊ≠©„Åö„Å§„ÄÅÁùÄÂÆü„Å´ÈÄ≤„ÇÅ„Å∞ËâØ„ÅÑ„ÄÇ"}}function OQ(n,e,t){if(Math.random()>.1)return null;const s=LQ(n,e,t);return s.length===0?null:s[Math.floor(Math.random()*s.length)]}function LQ(n,e,t){const s=[];n==="drill-sergeant"&&(e&&t>=5&&(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå„Çà„ÅóÔºÅ„Åù„ÅÆË™øÂ≠ê„Å†ÔºÅ„Äç üòÉ„Äå„Å°„Çá„ÄÅ„Å°„Çá„Å£„Å®Ë§í„ÇÅ„Åô„Åé„Åß„ÅØ...„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅËâØ„ÅÑ„ÇÇ„ÅÆ„ÅØËâØ„ÅÑ„Çì„Å†ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"wise-sage",message:"üòà„ÄåÂÆåÁíß„Å†ÔºÅ„Äç üßô„Äå„Åµ„ÇÄ„ÄÅÈ¨ºËªçÊõπÊÆø„ÇÇÂ¨â„Åó„Åù„ÅÜ„Åò„ÇÉ„ÅÆ„ÅÜ„Äç üòà„Äå„Åπ„ÄÅÂà•„Å´...„Äç",type:"banter"})),e||(s.push({mainTeacher:"drill-sergeant",otherTeacher:"kind-teacher",message:"üòà„Äå‰ΩïÂ∫¶Âêå„ÅòÈñìÈÅï„ÅÑ„Çí...ÔºÅ„Äç üòÉ„Äå„Åæ„ÅÇ„Åæ„ÅÇ„ÄÅËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÄÇË™∞„Å´„Åß„ÇÇËã¶Êâã„ÅØ„ÅÇ„Çä„Åæ„Åô„Åã„Çâ„Äç üòà„ÄåÁîò„ÇÑ„Åã„Åô„Å™ÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"drill-sergeant",otherTeacher:"analyst",message:"üòà„Äå„Åü„Çã„Çì„Åß„Çã„ÅûÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´„ÅØË®±ÂÆπÁØÑÂõ≤ÂÜÖ„ÅÆ„Éü„Çπ„Åß„Åô„Äç üòà„Äå„Éá„Éº„Çø„Åò„ÇÉ„Å™„ÅÑ„ÄÅÊ∞óÊåÅ„Å°„ÅÆÂïèÈ°å„Å†ÔºÅ„Äç",type:"argument"})),s.push({mainTeacher:"drill-sergeant",otherTeacher:"enthusiastic-coach",message:"üòºÔºàÈÄö„Çä„Åô„Åå„ÇäÔºâ„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„ÅÆÁâπË®ì„ÅãÔºÅÈ†ëÂºµ„Çå„ÇàÔºÅ„Äç üòà„Äå...‰ΩôË®à„Å™Âè£Âá∫„Åó„Åô„Çã„Å™„Äç",type:"passerby"})),n==="kind-teacher"&&(e&&(s.push({mainTeacher:"kind-teacher",otherTeacher:"drill-sergeant",message:"üòÉ„ÄåÁ¥†Êô¥„Çâ„Åó„ÅÑ„Åß„Åô„Å≠ÔºÅ„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå„Åæ„Å†„Åæ„Å†Ê≤πÊñ≠„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå...ËÅû„Åì„Åà„Å¶„Åæ„ÅôÔºü„Äç",type:"passerby"}),s.push({mainTeacher:"kind-teacher",otherTeacher:"wise-sage",message:"üòÉ„Äå„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ„Äç üßô„Äå„ÅÜ„ÇÄ„ÄÅÁùÄÂÆü„Å™ÊàêÈï∑„Åò„ÇÉ„Äç üòÉ„ÄåË≥¢ËÄÖÂÖàÁîü„ÇÇ„Åù„ÅÜÊÄù„Çè„Çå„Åæ„Åô„Çà„Å≠„Äç",type:"support"})),e||s.push({mainTeacher:"kind-teacher",otherTeacher:"enthusiastic-coach",message:"üòÉ„ÄåÂ§ß‰∏àÂ§´„ÄÅÊ¨°„ÅØÂøÖ„Åö„Åß„Åç„Åæ„Åô„Çà„Äç üòº„Äå„Åù„ÅÜ„Åù„ÅÜÔºÅÂ§±Êïó„ÅØÊàêÂäü„ÅÆÊØç„Å†ÔºÅ„Äç üòÉ„ÄåÁÜ±Ë°Ä„Ç≥„Éº„ÉÅ„ÇÇÂøúÊè¥„Åó„Å¶„Åæ„Åô„Çà„Äç",type:"support"}),s.push({mainTeacher:"kind-teacher",message:"üòÉ„Äå„ÅÇ„ÄÅ„ÅäËå∂„ÇíÂÖ•„ÇåÂøò„Çå„Å¶...„Äç üòàÔºàÈÅ†„Åè„Åã„ÇâÔºâ„Äå‰ªï‰∫ã‰∏≠„Å´‰Ωï„Åó„Å¶„ÇãÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„ÇìÔºÅ„Äç",type:"joke"})),n==="analyst"&&(t>=10&&s.push({mainTeacher:"analyst",otherTeacher:"enthusiastic-coach",message:"ü§ñ„Äå10ÈÄ£Á∂öÊ≠£Ëß£„ÄÇÁµ±Ë®àÁöÑ„Å´ÊúâÊÑè„Åß„Åô„Äç üòº„Äå„Åô„Åí„ÉºÔºÅÊúÄÈ´ò„Å†ÔºÅ„Äç ü§ñ„Äå...ÊÑüÊÉÖË°®Áèæ„ÅØ‰∏çË¶Å„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",otherTeacher:"drill-sergeant",message:"ü§ñ„Äå„Éá„Éº„Çø„Å´Âü∫„Å•„Åè„Å®...„Äç üòà„ÄåÁêÜÂ±à„ÅØ„ÅÑ„ÅÑÔºÅÊ∞óÂêà„Å†ÔºÅ„Äç ü§ñ„ÄåÈùûÁßëÂ≠¶ÁöÑ„Åß„Åô„Äç üòà„Äå„ÅÜ„Çã„Åï„ÅÑÔºÅ„Äç",type:"argument"}),s.push({mainTeacher:"analyst",otherTeacher:"kind-teacher",message:"ü§ñ„ÄåÊ≠£Á≠îÁéá73.4%„Äç üòÉ„Äå„ÅÇ„ÅÆ...„ÇÇ„ÅÜÂ∞ë„ÅóÂÑ™„Åó„Åè‰ºù„Åà„Çâ„Çå„Åæ„Åõ„Çì„ÅãÔºü„Äç ü§ñ„Äå‰∫ãÂÆü„ÇíËø∞„Åπ„Å¶„ÅÑ„Çã„Å†„Åë„Åß„Åô„Äç",type:"banter"}),s.push({mainTeacher:"analyst",message:"ü§ñ„Äå...„Ç≥„Éº„Éí„Éº„ÅÆ„Ç´„Éï„Çß„Ç§„É≥Âê´ÊúâÈáè„ÅØ...„Äç üòÉ„ÄåÂàÜÊûêÂÆòÂÖàÁîü„ÄÅ‰ªä„ÅØÊéàÊ•≠‰∏≠„Åß„Åô„Çà„Äç ü§ñ„ÄåÂ§±Á§º„Åó„Åæ„Åó„Åü„Äç",type:"joke"})),n==="enthusiastic-coach"&&(e&&t>=5&&(s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"wise-sage",message:"üòº„ÄåÊúÄ„Å£È´ò„Å†„ÅÅ„ÅÅÔºÅÔºÅ„Äç üßô„Äå...Â∞ë„ÅóÂ£∞„ÅåÂ§ß„Åç„ÅÑ„Åã„ÅÆ„ÅÜ„Äç üòº„Äå„ÅÜ„Çã„Åï„Åè„Å¶ÊÇ™„Åã„Å£„Åü„Å™ÔºÅ„Äç",type:"banter"}),s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"drill-sergeant",message:"üòº„Äå„Çà„Å£„Åó„ÇÉ„ÉºÔºÅ„Äç üòà„ÄåÈ®í„Åå„Åó„ÅÑ...„Å†„Åå„ÄÅÊÇ™„Åè„Å™„ÅÑ„Å™„Äç üòº„Äå„Åä„Å£„ÄÅÈ¨ºËªçÊõπ„Å´Ë§í„ÇÅ„Çâ„Çå„ÅüÔºÅ„Äç",type:"support"})),e||s.push({mainTeacher:"enthusiastic-coach",otherTeacher:"kind-teacher",message:"üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅÊ¨°„Å†Ê¨°ÔºÅ„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÁÑ¶„Çâ„Åö„Å´„Äç üòº„Äå‰∫å‰∫∫„ÅßÂøúÊè¥„Åó„Å¶„Çã„ÅûÔºÅ„Äç",type:"support"}),s.push({mainTeacher:"enthusiastic-coach",message:"üòº„Äå‰ªäÊó•„ÅÆÁ≠ã„Éà„É¨„ÅØ...„Äç ü§ñ„Äå„Åù„Çå„ÅØËã±Ë™ûÂ≠¶Áøí„Å®ÁÑ°Èñ¢‰øÇ„Åß„Åô„Äç üòº„Äå‰Ωì„ÅåË≥áÊú¨„Å†„ÇçÔºÅÔºü„Äç",type:"joke"})),n==="wise-sage"&&(e&&s.push({mainTeacher:"wise-sage",otherTeacher:"drill-sergeant",message:"üßô„ÄåËâØ„ÅçÊàêÈï∑„Åò„ÇÉ„Äç üòà„ÄåÂΩì„Åü„ÇäÂâç„Å†„ÄÅ‰ø∫„ÅÆÊïô„ÅàÂ≠ê„Å†„Åã„Çâ„Å™„Äç üßô„Äå...„Åä‰∏ª„ÇÇÊïô„Åà„Å¶„Åä„Å£„Åü„ÅÆ„ÅãÔºü„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",otherTeacher:"analyst",message:"üßô„ÄåÊôÇ„Å´„ÅØÊÑüË¶ö„ÇÇÂ§ß‰∫ã„Åò„ÇÉ„Åû„Äç ü§ñ„ÄåÊÑüË¶ö„ÅØÊ∏¨ÂÆö‰∏çÂèØËÉΩ„Åß„Åô„Äç üßô„Äå...Ëã•„ÅÑ„ÅÆ„ÅÜ„Äç",type:"argument"}),s.push({mainTeacher:"wise-sage",otherTeacher:"enthusiastic-coach",message:"üßô„ÄåÁÑ¶„Çâ„Åö„ÄÅ„Åò„Å£„Åè„Çä„Å®...„Äç üòº„Äå„Åü„Åæ„Å´„ÅØÂÖ®ÂäõÁñæËµ∞„ÇÇÂ§ß‰∫ã„Å£„Åô„ÇàÔºÅ„Äç üßô„Äå...„Åù„Çå„ÇÇ‰∏ÄÁêÜ„ÅÇ„Çã„Åã„Äç",type:"banter"}),s.push({mainTeacher:"wise-sage",message:"üßô„ÄåÊòî„ÅØ„ÅÆ„ÅÜ...„Äç üòÉüòàüòºü§ñ„Äå„Äå„Äå„Äå„Åæ„ÅüÊòîË©±ÔºÅÔºü„Äç„Äç„Äç„Äç üßô„Äå...ÊúÄËøë„ÅÆËã•ËÄÖ„ÅØ„Äç",type:"joke"}));const r=[{mainTeacher:n,message:"üòÉ„Äå„ÅäÊòº„ÅØ‰ΩïÈ£ü„Åπ„Åæ„ÅôÔºü„Äç üòà„ÄåÊôÇÈñì„ÅÆÁÑ°ÈßÑ„Å†„Äç üòº„Äå‰ø∫„ÅØ„Ç´„ÉÑ‰∏ºÔºÅ„Äç ü§ñ„ÄåÊ†ÑÈ§ä„Éê„É©„É≥„Çπ„ÇíËÄÉÊÖÆ„Åô„Åπ„Åç„Åß„Åô„Äç üßô„Äå...„Çè„Åó„ÅØËïéÈ∫¶„Åå„ÅÑ„ÅÑ„ÅÆ„ÅÜ„Äç",type:"joke"},{mainTeacher:n,message:"üòà„Äå...Ë™∞„Å†„ÄÅËÅ∑Âì°ÂÆ§„Åß„Ç≥„Éº„Éí„Éº„Åì„Åº„Åó„Åü„ÅÆ„ÅØÔºÅ„Äç üòÉ„Äå„Åô„ÄÅ„Åô„Åø„Åæ„Åõ„Çì...„Äç üòº„Äå„Éâ„É≥„Éû„Ç§ÔºÅ„Äç ü§ñ„ÄåÊ∏ÖÊéÉÊñπÊ≥ï„ÇíÊèêÁ§∫„Åó„Åæ„Åô„Äç",type:"joke"},{mainTeacher:n,message:"üßô„Äå...Âç∞Âà∑Ê©ü„ÅåÂãï„Åã„Çì„ÅÆ„Åò„ÇÉ„Åå„Äç ü§ñ„ÄåITÊãÖÂΩì„ÇíÂëº„Å≥„Åæ„Åô„Äç üòÉ„ÄåÁßÅ„ÅåË¶ã„Å¶„Åø„Åæ„Åô„Å≠„Äç üòà„Äå„Åï„Å£„Åï„Å®Áõ¥„ÅõÔºÅ„Äç üòº„Äå„Åø„Çì„Å™„ÅßÂçîÂäõ„Å†ÔºÅ„Äç",type:"joke"},{mainTeacher:n,message:"üòº„Äå‰ªäÊó•„ÅÆÊéàÊ•≠„Å©„ÅÜ„Å†„Å£„ÅüÔºü„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Å£„Å¶„Åæ„Åó„Åü„Çà„Äç üòà„Äå„Åæ„Å†„Åæ„Å†„Å†„Äç ü§ñ„Äå„Éá„Éº„Çø„ÅßË¶ã„Çã„Å®ÊîπÂñÑÂÇæÂêë„Åß„Åô„Äç üßô„Äå„Åù„Çå„Åû„Çå„ÅÆÊàêÈï∑„Åå„ÅÇ„Çã„ÅÆ„ÅÜ„Äç",type:"banter"}];return Math.random()<.05&&s.push(...r),s}function zQ(){const n=new Date().getHours();if(Math.random()>.05)return null;if(n>=6&&n<9){const e=["üòÉ„Äå„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç üòà„ÄåÊúù„Åã„ÇâÂÖÉÊ∞ó„Å†„Å™„Äç üòº„Äå„Çà„Å£„Åó„ÇÉ„ÄÅ‰ªäÊó•„ÇÇÂÖ®Âäõ„Å†ÔºÅ„Äç","üßô„Äå„ÅÜ„ÇÄ„ÄÅËâØ„ÅÑÊúù„Åò„ÇÉ„ÅÆ„ÅÜ„Äç ü§ñ„ÄåÊ∞óÊ∏©18Â∫¶„ÄÅÂ≠¶Áøí„Å´ÊúÄÈÅ©„Åß„Åô„Äç üòÉ„ÄåÂ§©Ê∞ó„ÇÇËâØ„ÅÑ„Åß„Åô„Å≠„Äç","üòà„ÄåÈÅÖÂàª„Åô„Çã„Å™ÔºÅ„Äç üòÉ„Äå„Åæ„ÄÅ„Åæ„Å†ÈñãÂßã10ÂàÜÂâç„Åß„Åô„Çà...„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=12&&n<13){const e=["üòº„ÄåËÖπÊ∏õ„Å£„Åü„ÄúÔºÅ„Äç üòÉ„Äå„ÅäÂºÅÂΩìË≤∑„Å£„Å¶„Åç„Åæ„Åó„Åü„Çà„Äç üòà„ÄåÊòº‰ºë„Åø„ÅØ30ÂàÜ„Å†„Åû„Äç","üßô„Äå‰ªäÊó•„ÅÆÂÆöÈ£ü„ÅØ‰Ωï„Åã„ÅÆ„ÅÜ„Äç ü§ñ„Äå„Ç´„É≠„É™„ÉºË®àÁÆó„ÅåÂøÖË¶Å„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™„ÅßÈ£ü„Åπ„Åæ„Åó„Çá„ÅÜ„Äç","üòà„ÄåÈ£üÂæå„ÅØ‰ºë„ÇÄ„Å™ÔºÅ„Äç üòÉ„ÄåÊ∂àÂåñ„Å´ÊÇ™„ÅÑ„Åß„Åô„Çà...„Äç üòº„ÄåÂ∞ë„Åó„ÅØ‰ºë„ÇÇ„ÅÜ„ÅúÔºÅ„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=17&&n<19){const e=["üòÉ„Äå‰ªäÊó•„ÇÇ„ÅäÁñ≤„ÇåÊßò„Åß„Åó„Åü„Äç üòà„Äå„Åæ„Å†ÁµÇ„Çè„Å£„Å¶„Å™„ÅÑ„Äç üòº„Äå„ÅÑ„ÇÑ„ÄÅÂçÅÂàÜÈ†ëÂºµ„Å£„Åü„Å£„Å¶ÔºÅ„Äç","üßô„ÄåÊó•„ÅåÊöÆ„Çå„Å¶„Åç„Åü„ÅÆ„ÅÜ„Äç ü§ñ„Äå17ÊôÇ32ÂàÜ„ÄÅÂÆöÂàª„Åß„Åô„Äç üòÉ„Äå„Åø„Çì„Å™È†ëÂºµ„Çä„Åæ„Åó„Åü„Å≠„Äç","üòº„Äå‰ªäÊó•„ÅÆÂèçÁúÅ‰ºö„Åô„ÇãÔºü„Äç üòÉ„Äå„ÅÑ„ÅÑ„Åß„Åô„Å≠„Äç üòà„ÄåÁÑ°ÈßÑË©±„ÅØ„Åô„Çã„Å™„Äç üßô„Äå„Åù„Çå„ÇÇÂ§ßÂàá„Åò„ÇÉ„Åû„Äç"];return e[Math.floor(Math.random()*e.length)]}if(n>=22){const e=["üòÉ„Äå„ÇÇ„ÅÜÈÅÖ„ÅÑ„Åß„Åô„Å≠...„Äç üòà„ÄåÂ∏∞„ÇåÔºÅÊòéÊó•„Å´ÂÇô„Åà„ÇçÔºÅ„Äç üßô„ÄåÁÑ°ÁêÜ„ÅØ„ÅÑ„Åã„Çì„Åû„Äç","ü§ñ„Äå22ÊôÇ„ÇíË∂ÖÈÅé„ÄÇÁù°Áú†ÊôÇÈñìÁ¢∫‰øù„ÇíÊé®Â•®„Äç üòÉ„Äå„Åù„ÅÜ„Åß„Åô„Å≠„ÄÅÂ∏∞„Çä„Åæ„Åó„Çá„ÅÜ„Äç","üòº„ÄåÂ§úÈÅÖ„Åè„Åæ„Åß„ÅäÁñ≤„ÇåÔºÅ„Äç üòÉ„ÄåÊòéÊó•„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„Äå...Êó©„ÅèÂØù„Çç„Äç"];return e[Math.floor(Math.random()*e.length)]}return null}function WQ(n){return n===10?"üòº„Äå10ÈÄ£Á∂öÔºÅÔºÅ„Äç üòà„Äå„Çà„ÅóÔºÅ„Äç üòÉ„Äå„Åô„Åî„ÅÑÔºÅ„Äç ü§ñ„ÄåÁµ±Ë®àÁöÑ„Å´ÂÑ™ÁßÄ„Äç üßô„ÄåË¶ã‰∫ã„Åò„ÇÉ„Äç":n===20?"üòà„Äå20ÈÄ£Á∂ö„Å†„Å®...ÔºÅÔºü„Äç üòÉ„Äå‰ø°„Åò„Çâ„Çå„Åæ„Åõ„ÇìÔºÅ„Äç üòº„ÄåÊúÄ„Å£È´ò„Å†ÔºÅ„Äç ü§ñ„ÄåÁï∞Â∏∏ÂÄ§„Åß„ÅôÔºàË§í„ÇÅË®ÄËëâÔºâ„Äç üßô„ÄåÂ§©Êâç„Åã...„Äç":n===50?"üòàüòÉüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå50ÈÄ£Á∂öÔºÅÔºÅÔºÅÔºÅÔºÅ„Äç„Äç„Äç„Äç„ÄçÔºàÂÖ®Âì°„Çπ„Çø„É≥„Éá„Ç£„É≥„Ç∞„Ç™„Éô„Éº„Ç∑„Éß„É≥Ôºâ":null}function BQ(){const n=new Date,e=n.getMonth()+1,t=n.getDate(),s=n.getDay();return s===1?"üòÉ„Äå‰ªäÈÄ±„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜ„Äç üòà„ÄåÊúàÊõú„Åã„ÇâÈ£õ„Å∞„ÅõÔºÅ„Äç üòº„ÄåÈÄ±„ÅÆÂßã„Åæ„Çä„Å†ÔºÅ„Äç":s===5?"üòº„ÄåÈáëÊõú„Å†ÔºÅ„ÅÇ„Å®Â∞ë„ÅóÔºÅ„Äç üòÉ„Äå„Åß„ÇÇÊ∞ó„ÇíÊäú„Åã„Åö„Å´„Äç üòà„ÄåÊúÄÂæå„Åæ„ÅßÊ∞óÂêà„Å†ÔºÅ„Äç":e===12&&t===25?"üòÉ„Äå„É°„É™„Éº„ÇØ„É™„Çπ„Éû„ÇπÔºÅ„Äç üòà„ÄåÊµÆ„Åã„Çå„Çã„Å™„Äç üòº„Äå„Åü„Åæ„Å´„ÅØ„ÅÑ„ÅÑ„Å†„ÇçÔºÅ„Äç üßô„Äå„Åª„Å£„Åª„Å£„Åª„Äç":e===1&&t===1?"üòÉüòàüòºü§ñüßô„Äå„Äå„Äå„Äå„Äå„ÅÇ„Åë„Åæ„Åó„Å¶„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„Äç„Äç„Äç„Äç„Äç":null}const VQ=[{type:"common-mistake",message:`üòÉ„Äå"I'm exciting"„Å£„Å¶Ë®Ä„Å£„Å¶„Åæ„Åõ„Çì„ÅãÔºüÊ≠£„Åó„Åè„ÅØ"I'm excited"„Åß„Åô„Çà„ÄÇËá™ÂàÜ„Åå„ÉØ„ÇØ„ÉØ„ÇØ„Åó„Å¶„ÇãÊôÇ„ÅØedÂΩ¢„Åß„ÅôÔºÅ„Äç`,teacher:"kind-teacher"},{type:"common-mistake",message:`„Äå"I'm boring"„ÅØ„ÄåÁßÅ„ÅØÈÄÄÂ±à„Å™‰∫∫Èñì„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†„ÅûÔºÅ"I'm bored"„ÅåÊ≠£Ëß£„Å†ÔºÅÈñìÈÅï„Åà„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"},{type:"common-mistake",message:'ü§ñ„Äå"funny"„Å®"fun"„ÅØÁï∞„Å™„Çä„Åæ„Åô„ÄÇ"funny"„ÅØ„ÄåÈù¢ÁôΩ„ÅÑÔºàÁ¨ë„Åà„ÇãÔºâ„Äç„ÄÅ"fun"„ÅØ„ÄåÊ•Ω„Åó„ÅÑ„Äç„ÄÇ‰Ωø„ÅÑÂàÜ„Åë„ÅåÈáçË¶Å„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:'üòÉ„Äå"advice"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å™„ÅÆ„Åß„ÄÅ"an advice"„Å®„ÅØË®Ä„Åà„Åæ„Åõ„Çì„ÄÇ"a piece of advice"„Å®Ë®Ä„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'„Äå"How do you think?"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"What do you think?"„ÅåÊ≠£Ëß£ÔºÅ‰ΩïÂ∫¶Ë®Ä„Çè„Åõ„ÇãÔºÅ„Äç',teacher:"drill-sergeant"},{type:"common-mistake",message:'üòº„Äå"see a dream"„Åò„ÇÉ„Å™„ÅÑ„ÅûÔºÅ"have a dream"„Å†ÔºÅÂ§¢„ÅØË¶ã„Çã„Çì„Åò„ÇÉ„Å™„Åè„Å¶ÊåÅ„Å§„Çì„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"common-mistake",message:'üßô„Äå"say"„Å®"tell"„ÅÆÈÅï„ÅÑ„Åò„ÇÉ„Åå..."say"„ÅØÂÜÖÂÆπ„Çí„ÄÅ"tell"„ÅØÁõ∏Êâã„ÇíÂº∑Ë™ø„Åô„Çã„ÅÆ„Åò„ÇÉ„ÄÇ"tell me"„Å®„ÅØË®Ä„Åà„Çã„Åå"say me"„Å®„ÅØË®Ä„Åà„Å¨„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"common-mistake",message:'üòÉ„Äå"enjoy"„ÅÆÂæå„ÅØÂøÖ„Åö-ingÂΩ¢„Åß„Åô„ÇàÔºÅ"enjoy to study"„Åß„ÅØ„Å™„Åè"enjoy studying"„Åß„Åô„ÄÇ„Äç',teacher:"kind-teacher"},{type:"common-mistake",message:'ü§ñ„Äå"remember to do"Ôºà„Åì„Çå„Åã„Çâ„Åô„Çã„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„Å®"remember doing"Ôºà„Åó„Åü„Åì„Å®„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÁï∞„Å™„Çä„Åæ„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"common-mistake",message:`„Äå"I'm agree"„ÅØÈñìÈÅï„ÅÑ„Å†ÔºÅ"agree"„ÅØÂãïË©û„Å†„Åã„Çâ"I agree"„Å†ÔºÅÂü∫Êú¨„ÇíÂøò„Çå„Çã„Å™ÔºÅ„Äç`,teacher:"drill-sergeant"}],UQ=[{type:"fun-fact",message:'üßô„ÄåÊé•È†≠Ëæû"re-"„ÅØ„ÄåÂÜç„Å≥„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇreturnÔºàÊàª„ÇãÔºâ„ÄÅreviewÔºàÂæ©ÁøíÔºâ„ÄÅrepeatÔºàÁπ∞„ÇäËøî„ÅôÔºâ„Å™„Å©„ÄÅË¶ö„Åà„ÇÑ„Åô„ÅÑ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÈï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑÔºöÊúÄÂàù„Å®ÊúÄÂæå„ÅÆÊÆµËêΩ„ÄÅÂêÑÊÆµËêΩ„ÅÆÊúÄÂàù„ÅÆÊñá„ÇíË™≠„ÇÅ„Å∞ÂÖ®‰Ωì„ÅÆÊµÅ„Çå„Åå„Å§„Åã„ÇÅ„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„Äå"however"Ôºà„Åó„Åã„ÅóÔºâ„ÄÅ"therefore"Ôºà„Åó„Åü„Åå„Å£„Å¶Ôºâ„ÄÅ"moreover"Ôºà„Åï„Çâ„Å´Ôºâ„Å™„Å©„ÅÆÊé•Á∂öË©û„ÇíË¶ö„Åà„Çã„Å®„ÄÅË´ñÁêÜÂ±ïÈñã„ÅåË¶ã„Åà„ÇÑ„Åô„Åè„Å™„Çä„Åæ„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-tion"„Çí„Å§„Åë„Çã„Å®ÂãïË©û„ÅåÂêçË©û„Å´„Å™„Çã„ÅûÔºÅeducate‚Üíeducation„ÄÅcommunicate‚Üícommunication„Å†ÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"fun-fact",message:'üßô„Äå"compare A with B"ÔºàA„Å®B„ÇíÊØîËºÉ„Åô„ÇãÔºâ„Å®"compare A to B"ÔºàA„ÇíB„Å´‰æã„Åà„ÇãÔºâ„ÅØÊÑèÂë≥„ÅåÈÅï„ÅÜ„Åû„ÄÇË©¶È®ì„Åß„Çà„ÅèÂá∫„Çã„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:"ü§ñ„ÄåÂêåÁæ©Ë™û„ÇíÂ¢ó„ÇÑ„Åô„Å®Ë°®ÁèæÂäõ„Åå‰∏ä„Åå„Çä„Åæ„Åô„ÄÇimportant=significant=crucial„ÄÅshow=demonstrate=illustrate „Å™„Å©„ÄÇ„Äç",teacher:"analyst"},{type:"fun-fact",message:'üòÉ„ÄåÊé•È†≠Ëæû"un-"„ÄÅ"in-"„ÄÅ"dis-"„ÅØÂê¶ÂÆö„ÅÆÊÑèÂë≥„ÄÇunhappy„ÄÅimpossible„ÄÅdisagree„Å™„Å©„ÄÅ„Éë„Çø„Éº„É≥„ÅßË¶ö„Åà„Åæ„Åó„Çá„ÅÜÔºÅ„Äç',teacher:"kind-teacher"},{type:"fun-fact",message:'„Äå"not only A but also B"ÔºàA„Å†„Åë„Åß„Å™„ÅèB„ÇÇÔºâ„ÅØÈ†ªÂá∫ÊßãÊñá„Å†ÔºÅ„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„ÇçÔºÅ„Äç',teacher:"drill-sergeant"},{type:"fun-fact",message:'üßô„Äå"although"„Å®"though"„ÅØ„Åª„ÅºÂêå„ÅòÊÑèÂë≥Ôºà„Äú„Å†„Åë„Çå„Å©„ÇÇÔºâ„Åò„ÇÉ„Åå„ÄÅthough„ÅÆÊñπ„Åå„Ç´„Ç∏„É•„Ç¢„É´„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"fun-fact",message:'üòº„ÄåÊé•Â∞æËæû"-able"„ÅØ„Äå„Äú„Åß„Åç„Çã„Äç„ÅÆÊÑèÂë≥„Å†ÔºÅreadableÔºàË™≠„ÇÅ„ÇãÔºâ„ÄÅcomfortableÔºàÂø´ÈÅ©„Å™Ôºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"}],GQ=[{type:"cultural",message:"üòÉ„ÄåËã±Êñá„Ç®„ÉÉ„Çª„Ç§„ÅØÁµêË´ñ„ÇíÊúÄÂàù„Å´Êõ∏„Åè„ÅÆ„ÅåÂü∫Êú¨„ÄÇIntroduction‚ÜíBody‚ÜíConclusion„ÅÆ3ÈÉ®ÊßãÊàê„Åß„Åô„Çà„ÄÇ„Äç",teacher:"kind-teacher"},{type:"cultural",message:'üßô„ÄåËã±Ë™û„ÅÆË´ñÁêÜÂ±ïÈñã„ÅØ"‰∏ªÂºµ‚ÜíÁêÜÁî±‚ÜíÂÖ∑‰Ωì‰æã"„ÅåÂü∫Êú¨„Åò„ÇÉ„ÄÇFor example, For instance „Çí‰Ωø„ÅÑ„Åì„Å™„Åù„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"cultural",message:"ü§ñ„ÄåÂ≠¶Ë°ìÁöÑ„Å™ÊñáÁ´†„Åß„ÅØ„ÄÅcontractionsÔºàÁü≠Á∏ÆÂΩ¢Ôºâ„ÅØ‰Ωø„ÅÑ„Åæ„Åõ„Çì„ÄÇdon't‚Üído not„ÄÅit's‚Üíit is „Å®Êõ∏„Åç„Åæ„Åô„ÄÇ„Äç",teacher:"analyst"},{type:"cultural",message:"üòº„ÄåÊÑèË¶ã„ÇíËø∞„Åπ„ÇãË°®ÁèæÔºÅI think, In my opinion, From my perspective „Å™„Å©„ÄÅ„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥„ÇíÂ¢ó„ÇÑ„Åù„ÅÜÔºÅ„Äç",teacher:"enthusiastic-coach"},{type:"cultural",message:'üòÉ„ÄåÁêÜÁî±„ÇíËø∞„Åπ„ÇãÊôÇ„ÅØ"because"„Å†„Åë„Åò„ÇÉ„Å™„Åè„ÄÅ"since"„ÄÅ"as"„ÄÅ"due to"„Å™„Å©„ÇÇ‰Ωø„Åà„Åæ„Åô„Çà„ÄÇ„Äç',teacher:"kind-teacher"},{type:"cultural",message:'„ÄåÂèóÂãïÊÖã„Çí‰Ωø„ÅÑ„Åì„Å™„ÅõÔºÅ"The experiment was conducted"„Å™„Å©„ÄÅÂÆ¢Ë¶≥ÁöÑ„Å™Ë°®Áèæ„Å´ÂøÖË¶Å„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"cultural",message:'üßô„ÄåÂØæÊØî„ÅÆË°®ÁèæÔºö"on the other hand"Ôºà‰∏ÄÊñπ„ÅßÔºâ„ÄÅ"in contrast"ÔºàÂØæÁÖßÁöÑ„Å´Ôºâ„ÅØË´ñËø∞ÂïèÈ°å„ÅßÈáçÂÆù„Åô„Çã„Åû„ÄÇ„Äç',teacher:"wise-sage"}],HQ=[{type:"etymology",message:'üßô„Äå"pre-"„ÅØ„ÄåÂâç„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇpreviewÔºà‰∫àÁøí„ÉªË©¶ÂÜôÔºâ„ÄÅpredictÔºà‰∫àÊ∏¨„Åô„ÇãÔºâ„ÄÅprepareÔºàÊ∫ñÂÇô„Åô„ÇãÔºâ„Å®Ë¶ö„Åà„Çà„ÅÜ„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'ü§ñ„Äå"post-"„ÅØ„ÄåÂæå„Äç„ÄÇpostponeÔºàÂª∂Êúü„Åô„ÇãÔºâ„ÄÅpostwarÔºàÊà¶Âæå„ÅÆÔºâ„Å™„Å©„ÄÇpre-„Å®„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Çã„Å®ÂäπÁéáÁöÑ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"tele-"„ÅØ„ÇÆ„É™„Ç∑„É£Ë™û„Åß„ÄåÈÅ†„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„ÄÇtelephoneÔºàÈõªË©±Ôºâ„ÄÅtelevisionÔºà„ÉÜ„É¨„ÉìÔºâ„ÄÅtelescopeÔºàÊúõÈÅ†Èè°Ôºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"bi-"„ÅØ„Äå2„Å§„Äç„ÅÆÊÑèÂë≥„Åò„ÇÉ„ÄÇbicycleÔºà‰∫åËº™ËªäÔºâ„ÄÅbilingualÔºà2Ë®ÄË™ûË©±„Åõ„ÇãÔºâ„ÄÅbiweeklyÔºàÈöîÈÄ±„ÅÆÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"},{type:"etymology",message:'üòº„Äå"auto-"„ÅØ„ÄåËá™Âãï„ÉªËá™Â∑±„Äç„Å†ÔºÅautomaticÔºàËá™Âãï„ÅÆÔºâ„ÄÅautobiographyÔºàËá™‰ºùÔºâ„Å£„Å¶ÊÑü„Åò„Å†„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"etymology",message:'ü§ñ„Äå"micro-"„ÅØ„ÄåÂ∞è„Åï„ÅÑ„Äç„ÄÅ"macro-"„ÅØ„ÄåÂ§ß„Åç„ÅÑ„Äç„ÄÇmicroscopeÔºàÈ°ïÂæÆÈè°Ôºâ„ÄÅmacroeconomicsÔºà„Éû„ÇØ„É≠ÁµåÊ∏àÂ≠¶Ôºâ„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"etymology",message:'üòÉ„Äå"sub-"„ÅØ„Äå‰∏ã„Äç„ÅÆÊÑèÂë≥„ÄÇsubwayÔºàÂú∞‰∏ãÈâÑÔºâ„ÄÅsubmarineÔºàÊΩúÊ∞¥Ëâ¶Ôºâ„ÄÅsubtitleÔºàÂ≠óÂπïÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"etymology",message:'üßô„Äå"super-"„ÅØ„Äå‰∏ä„ÉªË∂Ö„Äç„Åò„ÇÉ„ÄÇsuperiorÔºàÂÑ™„Çå„ÅüÔºâ„ÄÅsupernaturalÔºàË∂ÖËá™ÁÑ∂ÁöÑ„Å™Ôºâ„ÄÅsuperviseÔºàÁõ£Áù£„Åô„ÇãÔºâ„Åò„ÇÉ„Å™„ÄÇ„Äç',teacher:"wise-sage"}],qQ=[{type:"grammar-tip",message:'üòÉ„Äå"a"„Å®"an"„ÅÆ‰Ωø„ÅÑÂàÜ„Åë„ÅØ„ÄÅÊ¨°„ÅÆÂçòË™û„ÅÆ„ÄåÈü≥„Äç„ÅßÊ±∫„Åæ„Çä„Åæ„Åô„ÄÇ"an hour"Ôºàhour„ÅÆh„ÅØÁô∫Èü≥„Åó„Å™„ÅÑÔºâ„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„ÄåÁèæÂú®ÂÆå‰∫Ü„ÅØ„Äå‰ªä„Å´Èñ¢‰øÇ„Åå„ÅÇ„ÇãÈÅéÂéª„Äç„Å†ÔºÅ"I have lost my key"„ÅØ‰ªä„ÇÇË¶ã„Å§„Åã„Å£„Å¶„Å™„ÅÑ„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å†ÔºÅ„Äç',teacher:"drill-sergeant"},{type:"grammar-tip",message:'ü§ñ„Äå"fewer"„ÅØÊï∞„Åà„Çâ„Çå„ÇãÂêçË©û„ÄÅ"less"„ÅØÊï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û„Å´‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"fewer people"„ÄÅ"less water"„Åß„Åô„ÄÇ„Äç',teacher:"analyst"},{type:"grammar-tip",message:'üßô„Äå"used to"„ÅØÈÅéÂéª„ÅÆÁøíÊÖ£„ÄÅ"be used to"„ÅØÊÖ£„Çå„Å¶„ÅÑ„Çã„ÄÅ"get used to"„ÅØÊÖ£„Çå„Çã„Åò„ÇÉ„ÄÇÂÖ®„Å¶ÈÅï„ÅÜ„Åû„ÄÇ„Äç',teacher:"wise-sage"},{type:"grammar-tip",message:'üòº„Äå"will"„ÅØÊÑèÂøó„ÄÅ"be going to"„ÅØ‰∫àÂÆö„ÇÑ‰∫àÊ∏¨„Å†ÔºÅ‰Ωø„ÅÑÂàÜ„Åë„Çâ„Çå„Çã„Å®Ëã±Ë™û„Å£„ÅΩ„Åè„Å™„Çã„ÅûÔºÅ„Äç',teacher:"enthusiastic-coach"},{type:"grammar-tip",message:'üòÉ„Äå"some"„Å®"any"„ÄÅËÇØÂÆöÊñá„ÅØsome„ÄÅÁñëÂïèÊñá„ÉªÂê¶ÂÆöÊñá„ÅØany„ÅåÂü∫Êú¨„Åß„Åô„Åå„ÄÅ"Would you like some tea?"„ÅÆ„Çà„ÅÜ„Å´Âãß„ÇÅ„ÇãÊôÇ„ÅØsome„Åß„Åô„ÇàÔºÅ„Äç',teacher:"kind-teacher"},{type:"grammar-tip",message:'„Äå‰∏âÂçòÁèæ„ÅÆsÔºÅÂøò„Çå„Çã„Å™ÔºÅ"He go"„Åß„ÅØ„Å™„Åè"He goes"„Å†ÔºÅÂü∫Êú¨‰∏≠„ÅÆÂü∫Êú¨„Å†„ÅûÔºÅ„Äç',teacher:"drill-sergeant"}];function KQ(n){if(Math.random()>.08)return null;if(n){const e=[...UQ,...HQ,...GQ];return e[Math.floor(Math.random()*e.length)].message}else{const e=[...VQ,...qQ];return e[Math.floor(Math.random()*e.length)].message}}function XQ(n,e){const t=e&&(e.includes(" ")||e.includes("-")),s=["üòÉüí° ÂèóÈ®ì„ÉÜ„ÇØÔºÅÂêå„ÅòÂçòË™û„ÅÆÁπ∞„ÇäËøî„Åó„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÄÅ‰ª£ÂêçË©ûÔºàit, they, thisÔºâ„ÇÑÂêåÁæ©Ë™û„Å´Ê≥®ÁõÆ„Åô„Çã„Å®Ë™≠Ëß£„ÅåÊ•Ω„Å´„Å™„Çä„Åæ„Åô„Çà„ÄÇ","üßôüí° Èï∑Êñá„ÅÆ„Ç≥„ÉÑÔºöË®≠Âïè„ÇíÂÖà„Å´Ë™≠„Çì„Åß„Åã„ÇâÊú¨Êñá„ÇíË™≠„ÇÄ„Å®„ÄÅ‰Ωï„ÇíÊé¢„Åõ„Å∞„ÅÑ„ÅÑ„ÅãÂàÜ„Åã„Å£„Å¶ÂäπÁéáÁöÑ„Åò„ÇÉ„ÄÇ","ü§ñüí° Áµ±Ë®à„Éá„Éº„ÇøÔºöÂàùÁ¥ö„ÅØÁ¥Ñ1,077Ë™û„ÄÅ‰∏≠Á¥ö„ÅØÁ¥Ñ1,616Ë™û„ÄÅ‰∏äÁ¥ö„ÅØÁ¥Ñ885Ë™û„Åß„Åô„ÄÇË®àÁîªÁöÑ„Å´Ë™ûÂΩô„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üí° ÊôÇÂà∂„ÅÆ‰∏ÄËá¥ÔºÅ‰∏ªÁØÄ„ÅåÈÅéÂéªÂΩ¢„Å™„ÇâÂæìÂ±ûÁØÄ„ÇÇÈÅéÂéªÂΩ¢„Å†ÔºÅ"He said that he was tired"„Å†„ÅûÔºÅ',"üòÉüí° Êï¥Â∫èÂïèÈ°å„ÅÆ„Ç≥„ÉÑÔºÅ„Åæ„Åö‰∏ªË™û„Å®ÂãïË©û„ÇíË¶ã„Å§„Åë„Å¶„ÄÅ‰øÆÈ£æË™û„ÇíÂæå„Åã„Çâ‰ªò„ÅëË∂≥„Åô„Å®Ëß£„Åç„ÇÑ„Åô„ÅÑ„Åß„Åô„Çà„ÄÇ",'üßôüí° ÂÜ†Ë©û„ÅÆ‰Ωø„ÅÑÂàÜ„ÅëÔºö"a/an"„ÅØÂàù„ÇÅ„Å¶Âá∫„Çã„ÉªÁâπÂÆö„Åß„Åç„Å™„ÅÑ„ÇÇ„ÅÆ„ÄÅ"the"„ÅØÊó¢Âá∫„ÉªÁâπÂÆö„Åß„Åç„Çã„ÇÇ„ÅÆ„Åò„ÇÉ„ÄÇ',"üòºüí° „É™„Çπ„Éã„É≥„Ç∞ÂØæÁ≠ñÔºÅÊ∂àÂéªÊ≥ï„ÅåÊúâÂäπ„Å†ÔºÅÊòé„Çâ„Åã„Å´ÈÅï„ÅÜÈÅ∏ÊäûËÇ¢„ÇíÊ∂à„Åó„Å¶„ÅÑ„Åè„Å®Ê≠£Ëß£Áéá„Åå‰∏ä„Åå„Çã„ÅûÔºÅ","ü§ñüí° ÂäπÁéáÁöÑÂ≠¶ÁøíÊ≥ïÔºöÂçòË™û„ÅØÊñáËÑà„ÅÆ‰∏≠„ÅßË¶ö„Åà„Çã„Å®ÂÆöÁùÄÁéá„Åå3ÂÄç‰ª•‰∏äÈ´ò„Åæ„Çä„Åæ„Åô„ÄÇ‰æãÊñá„Åî„Å®Ë¶ö„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ",'üòÉüí° ÊØîËºÉË°®ÁèæÔºö"as...as"ÔºàÂêåÁ≠âÔºâ„ÄÅ"-er than"ÔºàÊØîËºÉÁ¥öÔºâ„ÄÅ"the -est"ÔºàÊúÄ‰∏äÁ¥öÔºâ„ÅÆ3„Éë„Çø„Éº„É≥„Çí„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Çá„ÅÜÔºÅ'];return t&&s.push("üòºüí° Ë¶ö„ÅàÊñπÔºÅÁÜüË™û„ÅØÂãïË©û„Å®ÂâçÁΩÆË©û„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶Ë¶ö„Åà„Çã„Å®„ÅÑ„ÅÑ„ÅûÔºÅË¶ñË¶öÁöÑ„Å´„Ç§„É°„Éº„Ç∏„Åô„Çã„Å®Âøò„Çå„Å´„Åè„ÅÑ„ÅûÔºÅ"),s[Math.floor(Math.random()*s.length)]}function QQ(n){const{mode:e="translation",currentWord:t,wordProgress:s}=n,r={once:0,twice:0,three:0,four:0,five:0,sixOrMore:0};let o=!1;return Object.entries(s).forEach(([i,a])=>{if(!a)return;let c=0;e==="memorization"?c=a.memorizationAttempts||0:e==="translation"?c=a.translationAttempts??a.quizAttempts??0:e==="spelling"?c=a.spellingAttempts||0:e==="grammar"?c=a.grammarAttempts||0:c=a.totalAttempts||0,t&&i===t&&(o=!0),c===1?r.once++:c===2?r.twice++:c===3?r.three++:c===4?r.four++:c===5?r.five++:c>=6&&r.sixOrMore++}),t&&!o&&r.once++,r}function _h({mode:n="translation",currentScore:e=0,totalAnswered:t=0,sessionCorrect:s=0,_sessionIncorrect:r=0,_sessionReview:o=0,isReviewFocusMode:i=!1,onReviewFocus:a,onShowSettings:c,currentWord:l,onAnswerTime:d,lastAnswerCorrect:h,lastAnswerWord:p,lastAnswerDifficulty:f,correctStreak:m=0,incorrectStreak:g=0,learningPhase:x,estimatedSpeed:y,forgettingRate:b,dataSource:v="",category:w="",difficulty:S="",wordPhraseFilter:N="",grammarUnit:C,sessionStats:k,_currentQuestionTimesShown:I,onResetProgress:$,onDebugRequeue:j,learningStatusTabPulseKey:P}){const[O,A]=T.useState("ai"),[z,L]=T.useState(!1),U=T.useRef(null);T.useEffect(()=>{if(P)return L(!0),U.current&&window.clearTimeout(U.current),U.current=window.setTimeout(()=>{L(!1),U.current=null},1600),()=>{U.current&&(window.clearTimeout(U.current),U.current=null)}},[P]);const[V,B]=T.useState(()=>{const D=localStorage.getItem("aiPersonality")||"kind-teacher";return AQ(D)||"„Åì„Çì„Å´„Å°„ÅØÔºÅ‰∏ÄÁ∑í„Å´Â≠¶Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),[Y,K]=T.useState("");T.useEffect(()=>{if(l){const D=localStorage.getItem("aiPersonality")||"kind-teacher",F=Gu(l);let M="";if(F){const{totalCount:X,correctCount:ue}=F,J=X-ue,de=X>0?Math.round(ue/X*100):0;if(X===0)switch(D){case"drill-sergeant":M="Êñ∞„Åó„ÅÑÂçòË™û„Å†ÔºÅÊ∞óÂêà„ÇíÂÖ•„Çå„Å¶Ë¶ö„Åà„ÇçÔºÅ";break;case"kind-teacher":M="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô„Å≠„ÄÇ„Åò„Å£„Åè„ÇäËÄÉ„Åà„Å¶„Åø„Åæ„Åó„Çá„ÅÜ";break;case"analyst":M="Êñ∞Ë¶èÂçòË™û„ÄÇ„Éá„Éº„Çø„Å™„Åó„ÄÇÂàùÂõûÊ∏¨ÂÆö„ÇíÈñãÂßã„Åó„Åæ„Åô";break;case"enthusiastic-coach":M="Êñ∞„Åó„ÅÑ„ÉÅ„É£„É¨„É≥„Ç∏„Å†ÔºÅÊÄù„ÅÑÂàá„Å£„Å¶Ë°å„Åì„ÅÜÔºÅ";break;case"wise-sage":M="Âàù„ÇÅ„Å¶Âá∫‰ºö„ÅÜÂçòË™û„Åò„ÇÉ„Å™„ÄÇÁÑ¶„Çâ„ÅöÂêë„ÅçÂêà„Åä„ÅÜ";break;default:M="Âàù„ÇÅ„Å¶„ÅÆÂçòË™û„Åß„Åô"}else if(X===1){const me=ue===1;switch(D){case"drill-sergeant":M=me?"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÊ≠£Ëß£„Åó„Åü„Åû„ÄÇ„Åæ„Åü„ÇÑ„ÇåÔºÅ":"2ÂõûÁõÆ„Å†ÔºÅÂâçÂõû„ÅØÈñìÈÅï„Åà„Åü„ÄÇ‰ªäÂ∫¶„Åì„ÅùÊ±∫„ÇÅ„ÇçÔºÅ";break;case"kind-teacher":M=me?"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÊ≠£Ëß£„Åß„Åç„Åæ„Åó„Åü„Å≠":"2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÂâçÂõû„ÅØÈñìÈÅï„Åà„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅÂ§ß‰∏àÂ§´„Åß„Åô";break;case"analyst":M=`2ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÂâçÂõû: ${me?"Ê≠£Ëß£":"‰∏çÊ≠£Ëß£"}`;break;case"enthusiastic-coach":M=me?"2ÂõûÁõÆÔºÅÂâçÂõû„ÅØÂÆåÁíß„Å†„Å£„Åü„Å™ÔºÅ":"2ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É≥„ÇπÔºÅÂâçÂõû„ÅÆ„É™„Éô„É≥„Ç∏„Å†ÔºÅ";break;case"wise-sage":M=me?"2Â∫¶ÁõÆ„ÅÆÂá∫‰ºö„ÅÑ„Åò„ÇÉ„ÄÇÂâçÂõû„ÅØ„ÅÜ„Åæ„Åè„ÅÑ„Å£„Åü„ÅÆ„ÅÜ":"2Â∫¶ÁõÆ„Åò„ÇÉ„Å™„ÄÇÂâçÂõû„ÅÆÁµåÈ®ì„ÇíÊ¥ª„Åã„Åù„ÅÜ";break;default:M="2ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô"}}else switch(D){case"drill-sergeant":de>=80?M=`${X}ÂõûÁõÆ„Å†„ÄÇÊ≠£Á≠îÁéá${de}%ÔºÅ„ÅÑ„ÅÑË™øÂ≠ê„Å†ÔºÅ`:de>=50?M=`${X}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${de}%„ÄÇ„ÇÇ„Å£„Å®‰∏ä„Åí„ÇçÔºÅ`:M=`${X}ÂõûÁõÆ„ÄÇÊ≠£Á≠îÁéá${de}%ÔºÅË¶ö„Åà„ÅåÊÇ™„ÅÑ„ÅûÔºÅ`;break;case"kind-teacher":de>=80?M=`${X}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${de}%„ÄÅ„Çà„ÅèË¶ö„Åà„Å¶„ÅÑ„Åæ„Åô„Å≠`:de>=50?M=`${X}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${de}%„ÄÅÂ∞ë„Åó„Åö„Å§Ë¶ö„Åà„Å¶„Åç„Å¶„ÅÑ„Åæ„Åô`:M=`${X}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${de}%„ÄÅÁπ∞„ÇäËøî„ÅóÁ∑¥Áøí„Åó„Åæ„Åó„Çá„ÅÜ`;break;case"analyst":M=`${X}ÂõûÁõÆ„ÅÆÂá∫È°å„ÄÇÊ≠£Á≠îÁéá: ${de}% (Ê≠£Ëß£${ue}/‰∏çÊ≠£Ëß£${J})`;break;case"enthusiastic-coach":de>=80?M=`${X}ÂõûÁõÆÔºÅÊ≠£Á≠îÁéá${de}%ÔºÅÂÆåÁíß„Å´Ëøë„ÅÑ„ÅûÔºÅ`:M=`${X}ÂõûÁõÆ„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏ÔºÅÊ≠£Á≠îÁéá${de}%„ÄÅ„Åæ„Å†‰º∏„Å≥„Çã„ÅûÔºÅ`;break;case"wise-sage":de>=80?M=`${X}ÂõûÁõÆ„Åò„ÇÉ„Å™„ÄÇÊ≠£Á≠îÁéá${de}%„ÄÅ„Çà„ÅèÂÆöÁùÄ„Åó„Å¶„Åä„Çã`:M=`${X}ÂõûÁõÆ„Åò„ÇÉ„ÄÇÊ≠£Á≠îÁéá${de}%„ÄÅÁÑ¶„Çâ„ÅöÁùÄÂÆü„Å´„Å™`;break;default:M=`${X}ÂõûÁõÆ„ÅÆÂá∫È°å„Åß„Åô„ÄÇÊ≠£Á≠îÁéá${de}%`}}else M="Êñ∞„Åó„ÅÑÂïèÈ°å„Åß„Åô";B(M),K("")}},[l]),T.useEffect(()=>{if(h===void 0||!p||!l||p!==l)return;const D=localStorage.getItem("aiPersonality")||"kind-teacher",F=Lu(n||"translation"),M=F.todayTotalAnswered,X=F.todayAccuracy,ue=t>0?(s||0)/t*100:0,de={isCorrect:h,word:p,difficulty:f||S||"intermediate",category:w||"ÂÖ®ÂàÜÈáé",attemptCount:1,responseTime:0,correctStreak:m,incorrectStreak:g,userAccuracy:ue,categoryAccuracy:ue,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:M,todayAccuracy:X,planProgress:0,timeOfDay:A0(),learningPhase:x,estimatedSpeed:y,forgettingRate:b};let me=AI(D,de);if(Math.random()<.15){const Me=[];if(Math.random()<.33){const Ie=XQ(D,l);Ie&&Me.push(Ie)}else if(Math.random()<.5){const Ie=BQ();Ie&&Me.push(Ie)}else{const Ie=zQ();Ie&&Me.push(Ie)}Me.length>0&&(me=`${me}

${Me[0]}`)}K(me)},[d,h,p,f,m,g,n,t,s,w,S]);const pe=T.useRef(null),ge=T.useRef(null),re=T.useRef(null),[ye,Ae]=T.useState(()=>{const D=localStorage.getItem(`learning-limit-${n}`);return D?parseInt(D):null}),[ve,_e]=T.useState(()=>{const D=localStorage.getItem(`review-limit-${n}`);return D?parseInt(D):null}),[ze,et]=T.useState(()=>{const D=localStorage.getItem("memorization-still-learning-limit");return D?parseInt(D):null}),[ut,yt]=T.useState(()=>{const D=localStorage.getItem("memorization-incorrect-limit");return D?parseInt(D):null}),[bt,$t]=T.useState(!1);T.useEffect(()=>{if((n==="translation"||n==="spelling"||n==="grammar")&&k&&a){const{incorrect:D,review:F}=k,M=D+F;(ye!==null&&M>=ye||ve!==null&&F>=ve)&&(i||a())}},[k,ye,ve,i,n,a]);const[ae,le]=T.useState(()=>{if(n==="grammar"){const{retentionRate:D,appearedCount:F}=Ku();return{retentionRate:D,appearedCount:F}}else{const{retentionRate:D,appearedCount:F}=Uu();return{retentionRate:D,appearedCount:F}}}),[G,oe]=T.useState(()=>n==="grammar"?Wu():n==="memorization"?Bu():zu()),[he,Te]=T.useState(null),Se=T.useMemo(()=>{const F=it().wordProgress||{};return QQ({mode:n,currentWord:l,wordProgress:F})},[n,l,d]),[te,Fe]=T.useState([]);T.useEffect(()=>{n==="grammar"&&N0().then(D=>{if(C){const F=C.match(/g(\d+)-(?:unit|u)(\d+)/);if(F){const M=`‰∏≠${F[1]}_Unit${F[2]}`,X=D.filter(ue=>ue.unit===M);Fe(X)}else Fe(D)}else Fe(D)})},[n,d,C]),T.useEffect(()=>{if(n==="grammar"){const{retentionRate:D,appearedCount:F}=Ku();le({retentionRate:D,appearedCount:F}),oe(Wu())}else if(n==="memorization"){const D=Bu();oe(D),le({retentionRate:D.basicRetentionRate,appearedCount:D.appearedWords})}else{const{retentionRate:D,appearedCount:F}=Uu();le({retentionRate:D,appearedCount:F}),oe(zu())}},[d,n]),T.useEffect(()=>{Te(l?Gu(l):null)},[l,d]),T.useEffect(()=>{if(pe.current){const D=Math.round(G.masteredPercentage);pe.current.style.setProperty("--segment-width",String(D)),pe.current.setAttribute("data-width",String(D))}if(ge.current){const D=Math.round(G.learningPercentage);ge.current.style.setProperty("--segment-width",String(D)),ge.current.setAttribute("data-width",String(D))}if(re.current){const D=Math.round(G.strugglingPercentage);re.current.style.setProperty("--segment-width",String(D)),re.current.setAttribute("data-width",String(D))}},[G,O,n]);const{todayAccuracy:Le,todayTotalAnswered:De}=T.useMemo(()=>Lu(n),[n,d]),Ke=n==="memorization"&&!i&&((G==null?void 0:G.learningCount)??0)>0&&((G==null?void 0:G.strugglingCount)??0)===0;T.useMemo(()=>f0(n),[n,d]),T.useMemo(()=>Rh(),[d]);const{retentionRate:pt}=ae,R=G;return T.useMemo(()=>t>0?Math.round(e/t*100):0,[e,t]),u.jsxs("div",{className:"score-board-compact",children:[u.jsxs("div",{className:"score-board-tabs grid grid-cols-3 sm:grid-cols-5 gap-1 sm:gap-2",children:[u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${O==="ai"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("ai"),title:"AI„Ç≥„É°„É≥„Éà",children:[u.jsx("span",{className:"hidden sm:inline",children:"ü§ñ AI"}),u.jsx("span",{className:"sm:hidden",children:"ü§ñ"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${O==="plan"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("plan"),title:"„Éó„É©„É≥",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìã „Éó„É©„É≥"}),u.jsx("span",{className:"sm:hidden",children:"üìã"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${O==="breakdown"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("breakdown"),title:"Â≠¶ÁøíÁä∂Ê≥Å",children:[u.jsx("span",{className:`hidden sm:inline ${z?"animate-pulse drop-shadow-sm "+(O==="breakdown"?"":"text-primary"):""}`,children:"üìà Â≠¶ÁøíÁä∂Ê≥Å"}),u.jsx("span",{className:`sm:hidden ${z?"animate-pulse drop-shadow-sm "+(O==="breakdown"?"":"text-primary"):""}`,children:"üìà"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${O==="history"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>A("history"),title:"Â±•Ê≠¥",children:[u.jsx("span",{className:"hidden sm:inline",children:"üìú Â±•Ê≠¥"}),u.jsx("span",{className:"sm:hidden",children:"üìú"})]}),u.jsxs("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${O==="settings"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>{c?c():A("settings")},title:"Â≠¶ÁøíË®≠ÂÆö",children:[u.jsx("span",{className:"hidden sm:inline",children:"‚öôÔ∏è Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("span",{className:"sm:hidden",children:"‚öôÔ∏è"})]})]}),O==="ai"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"ai-comment-container",children:u.jsxs("div",{className:"flex items-center gap-2 w-full",children:[u.jsx("div",{className:"text-2xl flex-shrink-0",children:(()=>{const D=localStorage.getItem("aiPersonality")||"kind-teacher";return{"kind-teacher":"üòÉ","drill-sergeant":"üëπ","enthusiastic-coach":"üòº",analyst:"ü§ñ","wise-sage":"üßô"}[D]||"üòÉ"})()}),u.jsx("div",{className:"flex-1 min-w-0",children:u.jsx("div",{className:"text-sm text-gray-700 leading-snug break-words",children:(Y||V).replace(/^[üòÉüëπüòºü§ñüßô]+„Äå?/gu,"").replace(/„Äç$/gu,"").replace(/[‚ú®üå∏üòäüå±üí™üî•üìäüèÜ]/gu,"").trim()})})]})})})}),O==="plan"&&u.jsx("div",{className:"score-board-content",children:u.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:[u.jsxs("div",{className:"plan-text-line",children:[u.jsxs("span",{className:"stat-text-label",children:["üìö ",v||"ÂÖ®ÂïèÈ°åÈõÜ"]}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:w||"ÂÖ®ÂàÜÈáé"}),u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:S==="all"?"ÂÖ®Èõ£ÊòìÂ∫¶":S==="basic"?"Âü∫Á§é":S==="standard"?"Ê®ôÊ∫ñ":S==="advanced"?"Áô∫Â±ï":S}),(n==="translation"||n==="spelling"||n==="memorization")&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("button",{onClick:()=>$t(!0),className:"stat-text-label cursor-pointer hover:text-primary transition-colors",title:"Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö",children:"‚öôÔ∏è ‰∏äÈôêË®≠ÂÆö"})]}),N&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"stat-text-divider",children:"ÔΩú"}),u.jsx("span",{className:"stat-text-label",children:N==="all"?"ÂçòË™û„ÉªÁÜüË™û":N==="word"?"ÂçòË™û„ÅÆ„Åø":N==="phrase"?"ÁÜüË™û„ÅÆ„Åø":"ÂçòË™û„ÉªÁÜüË™û"})]})]}),bt&&(n==="translation"||n==="spelling")&&u.jsx("div",{className:"plan-settings-modal",children:u.jsxs("div",{className:"plan-settings-content",children:[u.jsx("h4",{children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö"}),u.jsx("p",{className:"plan-settings-description",children:"0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"Â≠¶Áøí‰∏≠„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"Â≠¶Áøí‰∏≠„ÅÆË™ûÊï∞‰∏äÈôê",value:ye||0,onChange:D=>{const F=parseInt(D.target.value),M=F===0?null:F;Ae(M),M===null?localStorage.removeItem(`learning-limit-${n}`):localStorage.setItem(`learning-limit-${n}`,M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"Ë¶ÅÂæ©Áøí„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"Ë¶ÅÂæ©Áøí„ÅÆË™ûÊï∞‰∏äÈôê",value:ve||0,onChange:D=>{const F=parseInt(D.target.value),M=F===0?null:F;_e(M),M===null?localStorage.removeItem(`review-limit-${n}`):localStorage.setItem(`review-limit-${n}`,M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsx("button",{className:"plan-settings-close",onClick:()=>$t(!1),children:"Èñâ„Åò„Çã"})]})}),bt&&n==="memorization"&&u.jsx("div",{className:"plan-settings-modal",children:u.jsxs("div",{className:"plan-settings-content",children:[u.jsx("h4",{children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö"}),u.jsx("p",{className:"plan-settings-description",children:"0„ÇíÈÅ∏Êäû„Åô„Çã„Å®ÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„Åô"}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê",value:ze||0,onChange:D=>{const F=parseInt(D.target.value),M=F===0?null:F;et(M),M===null?localStorage.removeItem("memorization-still-learning-limit"):localStorage.setItem("memorization-still-learning-limit",M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsxs("div",{className:"plan-setting-item",children:[u.jsx("label",{children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê:"}),u.jsxs("select",{"aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê",value:ut||0,onChange:D=>{const F=parseInt(D.target.value),M=F===0?null:F;yt(M),M===null?localStorage.removeItem("memorization-incorrect-limit"):localStorage.setItem("memorization-incorrect-limit",M.toString())},className:"select-input",children:[u.jsx("option",{value:0,children:"Ë®≠ÂÆöÁÑ°„Åó"}),u.jsx("option",{value:5,children:"5"}),u.jsx("option",{value:10,children:"10"}),u.jsx("option",{value:20,children:"20"}),u.jsx("option",{value:30,children:"30"}),u.jsx("option",{value:50,children:"50"}),u.jsx("option",{value:100,children:"100"}),u.jsx("option",{value:150,children:"150"}),u.jsx("option",{value:200,children:"200"})]}),u.jsx("p",{className:"setting-help",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„ÇâÁπ∞„ÇäËøî„ÅóÂæ©Áøí„É¢„Éº„Éâ„Å´ÂÖ•„Çä„Åæ„Åô"})]}),u.jsx("button",{className:"plan-settings-close",onClick:()=>$t(!1),children:"Èñâ„Åò„Çã"})]})})]})}),O==="breakdown"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsxs("div",{className:"retention-breakdown-container",children:[u.jsxs("div",{className:"retention-breakdown-header",children:[u.jsxs("div",{className:"flex items-center justify-between gap-2",children:[u.jsxs("div",{className:"attempt-counts-summary flex-1",children:["Âá∫È°åÊï∞Ôºö1Âõû ",Se.once,"Âïè 2Âõû ",Se.twice,"Âïè 3Âõû"," ",Se.three,"Âïè 4Âõû ",Se.four,"Âïè 5Âõû ",Se.five,"Âïè 6Âõû‰ª•‰∏ä ",Se.sixOrMore,"Âïè"]}),!1]}),R.appearedWords>0?u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?u.jsxs(u.Fragment,{children:[R.appearedWords,"Ë™ûÁ¢∫Ë™çÔºö üü¢Ë¶ö„Åà„Å¶„Çã"," ",R.masteredCount,"Ë™û"," ",u.jsxs("span",{className:"retention-label",title:i?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":Ke?"üî• „Åæ„Å†„Åæ„Å†„Éñ„Éº„Çπ„Éà‰∏≠":void 0,children:["üü°„Åæ„Å†„Åæ„Å† ",R.learningCount,"Ë™û"]})," ",u.jsxs("span",{className:"retention-label",title:i?"üìö Âæ©Áøí„É¢„Éº„Éâ‰∏≠":void 0,children:["üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ",R.strugglingCount,"Ë™û"]}),a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):n==="grammar"?u.jsxs(u.Fragment,{children:[R.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",R.masteredCount,"Âïè üü°Â≠¶Áøí‰∏≠ ",R.learningCount,"Âïè üî¥Ë¶ÅÂæ©Áøí"," ",R.strugglingCount,"Âïè",a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]}):u.jsxs(u.Fragment,{children:[R.appearedWords,"ÂïèÂá∫È°åÔºö üü¢ÂÆöÁùÄ ",R.masteredCount,"Ë™û üü°Â≠¶Áøí‰∏≠ ",R.learningCount,"Ë™û üî¥Ë¶ÅÂæ©Áøí"," ",R.strugglingCount,"Ë™û",(n==="translation"||n==="spelling")&&a&&u.jsx("span",{className:`review-mode-icon ${i?"active animate-pulse":""}`,onClick:a,title:i?"Âæ©Áøí„É¢„Éº„ÉâËß£Èô§":"Âæ©Áøí„É¢„Éº„ÉâÈñãÂßã",children:"üî•"})]})}):u.jsx("div",{className:"retention-subtitle",children:n==="memorization"?"„Åæ„Å†Ë™ûÂè•„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì":"„Åæ„Å†ÂïèÈ°å„Å´Âèñ„ÇäÁµÑ„Çì„Åß„ÅÑ„Åæ„Åõ„Çì"})]}),R.appearedWords>0&&u.jsx(u.Fragment,{children:u.jsx("div",{className:"retention-progress-bar",children:n==="memorization"?u.jsxs(u.Fragment,{children:[R.masteredPercentage>0&&u.jsx("div",{ref:pe,className:"retention-segment retention-mastered","data-width":Math.round(R.masteredPercentage),title:`üü¢ Ë¶ö„Åà„Å¶„Çã: ${R.masteredCount}Ë™û (${Math.round(R.masteredPercentage)}%)`,children:R.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(R.masteredPercentage),"%"]})}),R.learningCount>0&&u.jsx("div",{ref:ge,className:`retention-segment retention-learning ${i||Ke?"pulsing":""}`,"data-width":Math.round(R.learningPercentage),title:`üü° „Åæ„Å†„Åæ„Å†: ${R.learningCount}Ë™û (${Math.round(R.learningPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":Ke?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":""}`,children:R.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(R.learningPercentage),"%"]})}),R.strugglingCount>0&&u.jsx("div",{ref:re,className:`retention-segment retention-struggling ${i?"pulsing":""}`,"data-width":Math.round(R.strugglingPercentage),title:`üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${R.strugglingCount}Ë™û (${Math.round(R.strugglingPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":""}`,children:R.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(R.strugglingPercentage),"%"]})})]}):u.jsxs(u.Fragment,{children:[R.masteredPercentage>0&&u.jsx("div",{ref:pe,className:"retention-segment retention-mastered","data-width":Math.round(R.masteredPercentage),title:`üü¢ ÂÆöÁùÄ: ${R.masteredCount}Ë™û (${Math.round(R.masteredPercentage)}%)`,children:R.masteredPercentage>=10&&u.jsxs("span",{children:[Math.round(R.masteredPercentage),"%"]})}),R.learningPercentage>0&&u.jsx("div",{ref:ge,className:`retention-segment retention-learning ${Ke||i?"pulsing":""}`,"data-width":Math.round(R.learningPercentage),title:`üü° Â≠¶Áøí‰∏≠: ${R.learningCount}Ë™û (${Math.round(R.learningPercentage)}%) ${Ke?"üî• „Éñ„Éº„Çπ„Éà‰∏≠":i?"üìö Âæ©Áøí‰∏≠":""}`,children:R.learningPercentage>=10&&u.jsxs("span",{children:[Math.round(R.learningPercentage),"%"]})}),R.strugglingPercentage>0&&u.jsx("div",{ref:re,className:`retention-segment retention-struggling ${i?"pulsing":""}`,"data-width":Math.round(R.strugglingPercentage),title:`üî¥ Ë¶ÅÂæ©Áøí: ${R.strugglingCount}Ë™û (${Math.round(R.strugglingPercentage)}%) ${i?"üìö Âæ©Áøí‰∏≠":""}`,children:R.strugglingPercentage>=10&&u.jsxs("span",{children:[Math.round(R.strugglingPercentage),"%"]})})]})})})]})})}),O==="history"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"history-compact",children:n==="grammar"?u.jsx("div",{className:"word-detail-container",children:te.length>0?u.jsx("div",{className:"grammar-units-list",children:te.map(D=>{const F=(D.correctCount||0)+(D.incorrectCount||0),M=D.masteredCount||0,X=D.answeredQuestions||0,ue=X>0?Math.round(M/X*100):0,J=D.historyIcons||"";let de="üü¢",me="ÂÆöÁùÄÊ∏à";M===0&&X>0?(de="üî¥",me="Ë¶ÅÂæ©Áøí"):ue<80&&X>0&&(de="üü°",me="Â≠¶Áøí‰∏≠");const Me=D.unit.match(/‰∏≠(\d+)/),Ie=Me?`${Me[1]}Âπ¥`:D.unit,tt=D.unit.match(/Unit(\d+)/),Z=tt?`Unit${tt[1]}`:"",xe=Z?`${Ie} ${Z}Ôºö${D.title}`:`${Ie}Ôºö${D.title}`;return u.jsxs("div",{className:"grammar-unit-card",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",xe," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[de," ",me]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[D.correctCount,"/",F,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),J&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:J}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[ue,"%"]})]})]},D.unit)})}):u.jsxs("div",{className:"word-detail-empty",children:[u.jsx("p",{children:"„Åæ„Å†ÊñáÊ≥ïÂïèÈ°å„ÅÆËß£Á≠î„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"stat-text-sub",children:"ÂïèÈ°å„ÇíËß£„Åè„Å®ÂçòÂÖÉ„Åî„Å®„ÅÆÊàêÁ∏æ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})}):l&&he?u.jsxs("div",{className:"word-detail-container",children:[u.jsxs("div",{className:"word-detail-title",children:["üìä ",l," „ÅÆÂ≠¶Áøí„Éá„Éº„Çø",u.jsxs("span",{className:"word-status-badge",children:[he.statusIcon," ",he.statusLabel]})]}),u.jsxs("div",{className:"word-detail-stats",children:[u.jsx("span",{className:"word-stat-label",children:"Ê≠£Ëß£:"}),u.jsxs("strong",{className:"word-stat-value",children:[he.correctCount,"/",he.totalCount,"Âõû"]}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),he.accuracyHistory&&he.accuracyHistory.length>0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"Â±•Ê≠¥:"}),u.jsx("span",{className:"word-history-icons",children:he.accuracyHistory}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),u.jsx("span",{className:"word-stat-label",children:"ÂÆöÁùÄÁéá:"}),u.jsxs("strong",{className:"word-stat-value word-retention-rate",children:[he.retentionRate,"%"]}),he.position!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"}),u.jsx("span",{className:"word-stat-label",children:"Position:"}),u.jsx("strong",{className:"word-stat-value",children:he.position.toFixed(0)})]})]}),(he.memorizationPosition!==void 0||he.translationPosition!==void 0||he.spellingPosition!==void 0||he.grammarPosition!==void 0)&&u.jsxs("div",{className:"word-detail-stats",children:[he.memorizationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊöóË®ò:"}),u.jsx("strong",{className:"word-stat-value",children:he.memorizationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),he.translationPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÂíåË®≥:"}),u.jsx("strong",{className:"word-stat-value",children:he.translationPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),he.spellingPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"„Çπ„Éö„É´:"}),u.jsx("strong",{className:"word-stat-value",children:he.spellingPosition.toFixed(0)}),u.jsx("span",{className:"word-stat-divider",children:"ÔΩú"})]}),he.grammarPosition!==void 0&&u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"word-stat-label",children:"ÊñáÊ≥ï:"}),u.jsx("strong",{className:"word-stat-value",children:he.grammarPosition.toFixed(0)})]})]})]}):l&&!he?u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì"})}):u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"ÂïèÈ°å„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅÁèæÂú®„ÅÆÂçòË™û„ÅÆ„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})})})})}),O==="settings"&&u.jsx("div",{className:"score-board-content",children:u.jsx("div",{className:"bg-white rounded-lg p-3 shadow-md border border-gray-200",children:u.jsx("div",{className:"settings-tab-container",children:u.jsx("div",{className:"word-detail-empty",children:u.jsx("p",{children:"„Åì„ÅÆ„Çø„Éñ„ÅÆË®≠ÂÆö„ÅØÂ≠¶ÁøíË®≠ÂÆö„Éë„Éç„É´„Åã„ÇâË°å„Åà„Åæ„Åô"})})})})})]})}const up=[{id:"beginner-basic",name:"ÂàùÁ¥öÂü∫Á§é",requiredWords:600,requiredAccuracy:70,description:"Âü∫Êú¨ÁöÑ„Å™ÂçòË™û",icon:"üå±"},{id:"beginner-complete",name:"ÂàùÁ¥öÂÆå‰∫Ü",requiredWords:1077,requiredAccuracy:70,description:"ÂàùÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üåø"},{id:"intermediate-half",name:"‰∏≠Á¥öÂçäÂàÜ",requiredWords:1900,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´50%",icon:"üå≥"},{id:"intermediate-complete",name:"‰∏≠Á¥öÂÆå‰∫Ü",requiredWords:2693,requiredAccuracy:75,description:"‰∏≠Á¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üéì"},{id:"advanced-half",name:"‰∏äÁ¥öÂçäÂàÜ",requiredWords:3150,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´50%",icon:"üìö"},{id:"advanced-complete",name:"‰∏äÁ¥öÂÆå‰∫Ü",requiredWords:3578,requiredAccuracy:80,description:"‰∏äÁ¥ö„É¨„Éô„É´ÂÆåÂÖ®ÁøíÂæó",icon:"üöÄ"},{id:"master",name:"„Éû„Çπ„Çø„Éº",requiredWords:4e3,requiredAccuracy:85,description:"ÂÖ®„É¨„Éô„É´Âà∂Ë¶á",icon:"‚≠ê"}];function YQ(){const n=localStorage.getItem("user-goal-level");if(n){const e=JSON.parse(n),t=up.find(s=>s.id===e);if(t)return t}return up.find(e=>e.id==="intermediate-complete")||up[0]}function RI(n){const e=n||YQ(),t=it(),s=Rh();let r=0,o=0;Object.values(t.wordProgress).forEach(m=>{r+=m.correctCount,o+=m.correctCount+m.incorrectCount});const i=o>0?r/o*100:0,a=Math.min(100,s/e.requiredWords*100),c=Math.min(100,i/e.requiredAccuracy*100),l=(a+c)/2,d=s>=e.requiredWords&&i>=e.requiredAccuracy,h=JQ(s,e.requiredWords,i,e.requiredAccuracy),p=Math.max(0,e.requiredWords-s),f=h>0?Math.ceil(p/h):0;return{goal:e,currentWords:s,currentAccuracy:Math.round(i),wordsProgress:Math.round(a),accuracyProgress:Math.round(c),overallProgress:Math.round(l),isAchieved:d,estimatedDaysToAchieve:h,recommendedDailyWords:Math.min(50,f)}}function JQ(n,e,t,s){if(n>=e&&t>=s)return 0;const r=it(),i=Date.now()-7*24*60*60*1e3;let a=0;Object.values(r.wordProgress).forEach(g=>{g.lastStudied>=i&&g.masteryLevel==="mastered"&&a++});const c=a/7,l=Math.max(5,c),h=Math.max(0,e-n)/l,f=Math.max(0,s-t)*2,m=Math.ceil(h+f);return Math.max(1,m)}function cJ(n=!0){const e=RI();if(e.isAchieved)return`üéâ „Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ${e.goal.name}„É¨„Éô„É´„ÇíÈÅîÊàê„Åó„Åæ„Åó„ÅüÔºÅ`;const t=[];if(t.push(`${e.goal.icon} ${e.goal.name}„Åæ„Åß ${e.overallProgress}%`),e.currentWords<e.goal.requiredWords){const s=e.goal.requiredWords-e.currentWords;t.push(`„ÅÇ„Å®${s}Ë™û`)}return e.estimatedDaysToAchieve>0&&(e.estimatedDaysToAchieve<=7?t.push(`„ÅÇ„Å®${e.estimatedDaysToAchieve}Êó•„ÅßÈÅîÊàêÔºÅ`):e.estimatedDaysToAchieve<=30?t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/7)}ÈÄ±Èñì„ÅßÈÅîÊàêË¶ãËæº„Åø`):t.push(`Á¥Ñ${Math.ceil(e.estimatedDaysToAchieve/30)}„É∂Êúà„ÅßÈÅîÊàêË¶ãËæº„Åø`)),n&&(e.overallProgress>=80?t.push("„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÈÅîÊàê„Åß„ÅôÔºÅÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=50?t.push("È†ÜË™ø„Å´ÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ„Åì„ÅÆË™øÂ≠ê„ÅßÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜÔºÅ"):e.overallProgress>=25&&t.push("ÁùÄÂÆü„Å´ÈÄ≤Ê≠©„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ")),t.join(" ")}const ZQ={accept:["except"],except:["accept"],affect:["effect"],effect:["affect"],dessert:["desert"],desert:["dessert"],quiet:["quite"],quite:["quiet"],lose:["loose"],loose:["lose"],advice:["advise"],advise:["advice"],breath:["breathe"],breathe:["breath"],cloth:["clothe","clothes"],clothe:["cloth","clothes"],clothes:["cloth","clothe"],borrow:["lend"],lend:["borrow"],teach:["learn"],learn:["teach"],speak:["talk","say","tell"],talk:["speak","say","tell"],say:["speak","talk","tell"],tell:["speak","talk","say"],see:["look","watch"],look:["see","watch"],watch:["see","look"],hear:["listen"],listen:["hear"],bring:["take"],take:["bring"],come:["go"],go:["come"],in:["on","at"],on:["in","at"],at:["in","on"],for:["to","of"],to:["for","of"],of:["for","to"],already:["all ready"],"all ready":["already"],altogether:["all together"],"all together":["altogether"],everyday:["every day"],"every day":["everyday"]};function DI(n){const e=n.toLowerCase();return ZQ[e]||[]}function e9(){const n=it(),e=[],t=new Set;return Object.entries(n.wordProgress).forEach(([s])=>{if(t.has(s.toLowerCase()))return;const r=DI(s);if(r.length===0)return;const o=[s,...r].map(p=>p.toLowerCase()),i=Array.from(new Set(o));let a=0,c=0;i.forEach(p=>{const f=n.wordProgress[p];f&&(a+=f.incorrectCount,c+=f.correctCount+f.incorrectCount)});const l=c>0?a/c:0,d=Math.min(100,l*100*Math.log1p(c));let h="spelling";["speak","talk","say","tell","see","look","watch"].includes(s.toLowerCase())?h="meaning":["in","on","at","for","to","of"].includes(s.toLowerCase())&&(h="grammar"),e.push({words:i,type:h,description:t9(i,h),confusionScore:Math.round(d),totalErrors:a,needsReview:d>30||l>.3}),i.forEach(p=>t.add(p))}),e.filter(s=>s.totalErrors>0).sort((s,r)=>r.confusionScore-s.confusionScore)}function t9(n,e){return e==="spelling"?`„Çπ„Éö„É´„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:e==="meaning"?`ÊÑèÂë≥„Åå‰ºº„Å¶„ÅÑ„Çã: ${n.join(", ")}`:`ÊñáÊ≥ïÁöÑ„Å´Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ: ${n.join(", ")}`}function n9(n){const e=it(),t={},s=[];n.words.forEach(i=>{const a=e.wordProgress[i];if(a){const c=a.correctCount+a.incorrectCount,l=c>0?a.correctCount/c*100:0;t[i]=l,s.push(l)}});const r=s.length>0?s.reduce((i,a)=>i+a,0)/s.length:0,o=s.length>0?s.reduce((i,a)=>i+Math.pow(a-r,2),0)/s.length:0;return{groupRetention:Math.round(r),individualRetentions:t,variance:Math.round(o)}}function s9(n){const e=n9(n);return e.groupRetention<50?`‚ö†Ô∏è ${n.words.join(", ")} „ÅÆÂå∫Âà•„ÅåÊõñÊòß„Åß„Åô„ÄÇÈõÜ‰∏≠ÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`:e.variance>500?`üìä ${n.words.join(", ")} „ÅßÂÆöÁùÄÂ∫¶„Å´„Å∞„Çâ„Å§„Åç„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂº±„ÅÑÂçòË™û„ÇíÈáçÁÇπÁöÑ„Å´„ÄÇ`:e.groupRetention<70?`üí™ ${n.words.join(", ")} „Çí„ÇÇ„ÅÜÂ∞ë„ÅóÁ∑¥Áøí„Åô„Çã„Å®ÂÆåÁíß„Åß„ÅôÔºÅ`:`‚úÖ ${n.words.join(", ")} „ÅÆÂå∫Âà•„Åå„Åó„Å£„Åã„Çä„Åß„Åç„Å¶„ÅÑ„Åæ„ÅôÔºÅ`}function r9(n){const e=/^[^:]+:\s*[""](.+?)[""]$/,t=n.match(e);if(t)return t[1].trim();const s=/^[^:]+:\s*(.+)$/,r=n.match(s);return r?r[1].trim():n}function Ts(n,e={}){if(!("speechSynthesis"in window)){_.warn("„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØWeb Speech API„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì");return}const t=r9(n);if(window.speechSynthesis.speaking||window.speechSynthesis.pending){window.speechSynthesis.cancel(),setTimeout(()=>{Ay(t,e)},50);return}Ay(t,e)}function Ay(n,e){const t=new SpeechSynthesisUtterance(n),s=localStorage.getItem("speechRate"),r=localStorage.getItem("voiceGender");t.lang=e.lang||"en-US",t.rate=e.rate||(s?parseFloat(s):.85),t.pitch=e.pitch||1,t.volume=e.volume||1;const i=window.speechSynthesis.getVoices().filter(c=>c.lang.startsWith("en-")),a=["Google US English","Google UK English Female","Google UK English Male","Samantha","Alex","Microsoft Aria Online","Microsoft Guy Online","Karen","Daniel"];if(r==="female"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("female")||l.name.toLowerCase().includes("woman")||l.name.toLowerCase().includes("samantha")||l.name.toLowerCase().includes("karen")||l.name.toLowerCase().includes("aria"));c&&(t.voice=c)}else if(r==="male"){const c=i.find(l=>a.some(d=>l.name.includes(d)))||i.find(l=>l.name.toLowerCase().includes("male")||l.name.toLowerCase().includes("man")||l.name.toLowerCase().includes("alex")||l.name.toLowerCase().includes("daniel")||l.name.toLowerCase().includes("guy"));c&&(t.voice=c)}else{const c=i.find(l=>a.some(d=>l.name.includes(d)));c&&(t.voice=c)}t.onerror=c=>{_.error("Èü≥Â£∞ÂêàÊàê„Ç®„É©„Éº:",c)},window.speechSynthesis.speak(t)}function xn(){return"speechSynthesis"in window}function o9(){"speechSynthesis"in window&&window.speechSynthesis.cancel()}function i9(){"speechSynthesis"in window&&window.speechSynthesis.speaking&&window.speechSynthesis.pause()}function a9(){"speechSynthesis"in window&&window.speechSynthesis.paused&&window.speechSynthesis.resume()}function c9(){return"speechSynthesis"in window&&window.speechSynthesis.speaking}function l9(){return"speechSynthesis"in window&&window.speechSynthesis.paused}const oi=({word:n,sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:o="medium",variant:i="icon"})=>{const[a,c]=T.useState(!1),l=e.filter(g=>g.words.some(x=>x.word===n.word)),d=l.length>0,h={small:"text-sm px-2 py-1",medium:"text-base px-3 py-1.5",large:"text-lg px-4 py-2"},p={small:"text-base",medium:"text-lg",large:"text-xl"},f=g=>{if(g.stopPropagation(),e.length===0){r();return}if(e.length===1){const x=e[0];d?s(x.id,n):t(x.id,n)}else c(!a)},m=(g,x)=>{x?s(g,n):t(g,n)};return u.jsxs("div",{className:"relative inline-block",children:[u.jsxs("button",{onClick:f,className:`
          ${h[o]}
          ${d?"bg-green-500 hover:bg-green-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}
          rounded-md font-medium transition-colors duration-200
          flex items-center gap-1
        `,title:d?`${l.length}ÂÄã„ÅÆ„Çª„ÉÉ„Éà„Å´ËøΩÂä†Ê∏à„Åø`:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Å´ËøΩÂä†",children:[u.jsx("span",{className:p[o],children:d?"‚úì":"+"}),i!=="icon"&&u.jsx("span",{children:d?"ËøΩÂä†Ê∏à„Åø":"ËøΩÂä†"})]}),a&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),u.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-80 overflow-y-auto",children:[u.jsx("div",{className:"p-2 border-b border-gray-200",children:u.jsx("p",{className:"text-sm font-medium text-gray-700",children:"„Çª„ÉÉ„Éà„ÇíÈÅ∏Êäû"})}),u.jsx("div",{className:"p-2",children:e.map(g=>{const x=g.words.some(y=>y.word===n.word);return u.jsxs("button",{onClick:()=>{m(g.id,x),c(!1)},className:`
                      w-full text-left px-3 py-2 rounded-md mb-1
                      flex items-center justify-between
                      ${x?"bg-green-50 text-green-700":"hover:bg-gray-100:bg-gray-700 text-gray-700"}
                    `,children:[u.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[u.jsx("span",{children:g.icon||"üìñ"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("p",{className:"text-sm font-medium truncate",children:g.name}),u.jsxs("p",{className:"text-xs text-gray-500",children:[g.words.length,"Ë™û"]})]})]}),u.jsx("span",{className:"text-lg ml-2",children:x?"‚úì":"+"})]},g.id)})}),u.jsx("div",{className:"p-2 border-t border-gray-200",children:u.jsx("button",{onClick:()=>{c(!1),r()},className:"w-full text-left px-3 py-2 rounded-md hover:bg-gray-100:bg-gray-700 text-blue-600 text-sm font-medium",children:"‚ûï Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})})]})]})]})};var hs=(n=>(n.MEMORY_ACQUISITION="memory_acquisition",n.COGNITIVE_LOAD="cognitive_load",n.ERROR_PREDICTION="error_prediction",n.LEARNING_STYLE="learning_style",n.LINGUISTIC_RELATIONS="linguistic_relations",n.CONTEXTUAL_LEARNING="contextual_learning",n))(hs||{}),Rt=(n=>(n.IMMEDIATE_REPETITION="immediate_repetition",n.TAKE_BREAK="take_break",n.USE_CONFUSION_PAIRS="use_confusion_pairs",n.REDUCE_DIFFICULTY="reduce_difficulty",n.SPACED_REPETITION="spaced_repetition",n.CONTEXTUAL_LEARNING="contextual_learning",n.GROUP_BY_THEME="group_by_theme",n.ADJUST_SESSION_LENGTH="adjust_session_length",n.USE_ETYMOLOGY="use_etymology",n.TIME_OF_DAY_OPTIMIZATION="time_of_day_optimization",n.INCREASE_EXPOSURE="increase_exposure",n.CONTINUE_NORMAL="continue_normal",n))(Rt||{});const u9={enabled:!1,minSignalStrength:.3,minConfidence:.5,maxActiveSignals:10,effectivenessWindowSize:50},Ns={debug:(n,e)=>{},info:(n,e)=>console.info(`[SignalDetector] ${n}`,e),warn:(n,e)=>console.warn(`[SignalDetector] ${n}`,e),error:(n,e)=>console.error(`[SignalDetector] ${n}`,e)};class d9{constructor(e){Ee(this,"config");Ee(this,"signalCache",new Map);Ee(this,"cacheTimeout",5e3);this.config=e}async initialize(){Ns.info("SignalDetector initializing..."),Ns.info("SignalDetector initialized")}async detectSignals(e,t,s){const r=Date.now(),o=[],i=[],a=`${e}-${t}-${s.attemptNumber}`,c=this.getCachedSignals(a);if(c)return c;const l=[this.detectMemoryAcquisitionSignals(e,t,s),this.detectCognitiveLoadSignals(s),this.detectErrorPredictionSignals(e,t),this.detectLearningStyleSignals(s),this.detectLinguisticRelationsSignals(e),this.detectContextualLearningSignals(e,t)];if((await Promise.allSettled(l)).forEach((f,m)=>{const g=this.getModuleName(m);f.status==="fulfilled"?(o.push(...f.value),Ns.debug(`${g} signals detected`,{count:f.value.length})):(i.push({module:g,error:f.reason}),Ns.warn(`${g} failed`,f.reason))}),o.length===0&&i.length>0)return Ns.error("All AI modules failed",{errors:i}),[];i.length>0&&o.length>0&&Ns.warn("Some AI modules failed",{failed:i.length,succeeded:o.length});const h=this.filterAndSortSignals(o);this.cacheSignals(a,h);const p=Date.now()-r;return Ns.debug("Signal detection completed",{duration:p,signalCount:h.length}),h}async detectMemoryAcquisitionSignals(e,t,s){const r=[];try{const o=this.getAcquisitionProgress(e);if(!o)return r;t==="incorrect"&&this.shouldImmediateRepeat(o)&&r.push({source:hs.MEMORY_ACQUISITION,type:Rt.IMMEDIATE_REPETITION,strength:this.calculateImmediateRepeatStrength(o),confidence:.9,priority:9,timestamp:Date.now(),metadata:{currentExposure:o.totalAttempts,targetExposure:o.dynamicThreshold,consecutiveErrors:this.getConsecutiveErrors(o),acquisitionProgress:this.calculateAcquisitionProgress(o)}}),t==="correct"&&o.correctRate>=.5&&r.push({source:hs.MEMORY_ACQUISITION,type:Rt.SPACED_REPETITION,strength:Math.min(o.correctRate,.8),confidence:.85,priority:7,timestamp:Date.now(),metadata:{correctRate:o.correctRate,consecutiveCorrect:o.consecutiveCorrectStreak}}),t==="incorrect"&&o.totalAttempts<o.dynamicThreshold&&r.push({source:hs.MEMORY_ACQUISITION,type:Rt.INCREASE_EXPOSURE,strength:1-o.totalAttempts/o.dynamicThreshold,confidence:.8,priority:8,timestamp:Date.now(),metadata:{currentAttempts:o.totalAttempts,targetAttempts:o.dynamicThreshold}})}catch(o){Ns.error("Memory Acquisition signal detection failed",o)}return r}async detectCognitiveLoadSignals(e){const t=[];try{const s=e.cognitiveLoad??this.estimateCognitiveLoad(e);s>.8&&t.push({source:hs.COGNITIVE_LOAD,type:Rt.TAKE_BREAK,strength:Math.min(s,1),confidence:.95,priority:10,timestamp:Date.now(),metadata:{cognitiveLoad:s,sessionDuration:e.sessionDuration,recommendedBreakDuration:this.calculateBreakDuration(s),fatigueLevel:this.getFatigueLevel(s)}}),s>.6&&e.recentErrors>=2&&t.push({source:hs.COGNITIVE_LOAD,type:Rt.REDUCE_DIFFICULTY,strength:(s+e.recentErrors/5)/2,confidence:.8,priority:8,timestamp:Date.now(),metadata:{cognitiveLoad:s,recentErrors:e.recentErrors}});const r=e.sessionDuration?e.sessionDuration/6e4:0;r>30&&t.push({source:hs.COGNITIVE_LOAD,type:Rt.ADJUST_SESSION_LENGTH,strength:Math.min(r/60,.6),confidence:.7,priority:6,timestamp:Date.now(),metadata:{sessionDuration:e.sessionDuration,sessionMinutes:r}})}catch(s){Ns.error("Cognitive Load signal detection failed",s)}return t}async detectErrorPredictionSignals(e,t){const s=[];try{if(t==="incorrect"){const r=this.getConfusionPairs(e);r.length>0&&s.push({source:hs.ERROR_PREDICTION,type:Rt.USE_CONFUSION_PAIRS,strength:Math.min(.7+r.length*.1,.9),confidence:.85,priority:8,timestamp:Date.now(),metadata:{confusionPairs:r,errorType:this.detectErrorType(e)}}),this.needsContextualLearning(e)&&s.push({source:hs.ERROR_PREDICTION,type:Rt.CONTEXTUAL_LEARNING,strength:.6,confidence:.75,priority:7,timestamp:Date.now(),metadata:{reason:"context_insufficient"}})}}catch(r){Ns.error("Error Prediction signal detection failed",r)}return s}async detectLearningStyleSignals(e){const t=[];try{const s=new Date().getHours(),r=this.getOptimalLearningHour(),o=Math.abs(s-r);o>3&&t.push({source:hs.LEARNING_STYLE,type:Rt.TIME_OF_DAY_OPTIMIZATION,strength:Math.min(o/12,.5),confidence:.6,priority:4,timestamp:Date.now(),metadata:{currentHour:s,optimalHour:r}});const i=25*60*1e3,a=Math.abs((e.sessionDuration??0)-i);a>10*60*1e3&&t.push({source:hs.LEARNING_STYLE,type:Rt.ADJUST_SESSION_LENGTH,strength:Math.min(a/(30*60*1e3),.6),confidence:.65,priority:5,timestamp:Date.now(),metadata:{currentSessionLength:e.sessionDuration,optimalSessionLength:i}})}catch(s){Ns.error("Learning Style signal detection failed",s)}return t}async detectLinguisticRelationsSignals(e){const t=[];try{e.length>3&&t.push({source:hs.LINGUISTIC_RELATIONS,type:Rt.GROUP_BY_THEME,strength:.6,confidence:.5,priority:6,timestamp:Date.now(),metadata:{simplified:!0,reason:"Èñ¢ÈÄ£Ë™ûÂΩô„Å´„Çà„Çã„Ç∞„É´„Éº„ÉóÂ≠¶Áøí„ÇíÊé®Â•®"}}),e.length>=4&&t.push({source:hs.LINGUISTIC_RELATIONS,type:Rt.USE_ETYMOLOGY,strength:.4,confidence:.5,priority:5,timestamp:Date.now(),metadata:{simplified:!0,reason:"Ë™ûÊ∫êÊÉÖÂ†±„ÇíÊ¥ªÁî®„Åó„ÅüÂ≠¶Áøí„ÇíÊé®Â•®"}})}catch(s){Ns.error("Linguistic Relations signal detection failed",s)}return t}async detectContextualLearningSignals(e,t){const s=[];try{if(t==="incorrect"){this.hasAvailableContexts(e)&&s.push({source:hs.CONTEXTUAL_LEARNING,type:Rt.CONTEXTUAL_LEARNING,strength:.75,confidence:.85,priority:7,timestamp:Date.now(),metadata:{availableContexts:this.getAvailableContextCount(e)}});const o=this.getThemeCategory(e);o&&s.push({source:hs.CONTEXTUAL_LEARNING,type:Rt.GROUP_BY_THEME,strength:.6,confidence:.75,priority:6,timestamp:Date.now(),metadata:{themeCategory:o}})}}catch(r){Ns.error("Contextual Learning signal detection failed",r)}return s}filterAndSortSignals(e){const t=this.config.minSignalStrength??.3,s=e.filter(r=>r.strength>=t);return s.sort((r,o)=>o.priority-r.priority),s.slice(0,this.config.maxActiveSignals)}cacheSignals(e,t){this.signalCache.set(e,t),setTimeout(()=>{this.signalCache.delete(e)},this.cacheTimeout)}getCachedSignals(e){return this.signalCache.get(e)||null}getModuleName(e){return["MemoryAcquisition","CognitiveLoad","ErrorPrediction","LearningStyle","LinguisticRelations","ContextualLearning"][e]||"Unknown"}getAcquisitionProgress(e){try{const t=`acquisition_${e}`,s=localStorage.getItem(t);if(s)return JSON.parse(s)}catch(t){Ns.warn("Failed to load acquisition progress",t)}return null}shouldImmediateRepeat(e){return this.getConsecutiveErrors(e)>=3}getConsecutiveErrors(e){let t=0;for(let s=e.todayReviews.length-1;s>=0&&!e.todayReviews[s].isCorrect;s--)t++;return t}calculateImmediateRepeatStrength(e){const t=this.getConsecutiveErrors(e);return Math.min(.8+t*.05,1)}calculateAcquisitionProgress(e){return Math.min(e.totalAttempts/e.dynamicThreshold*100,100)}estimateCognitiveLoad(e){const t=Math.min((e.sessionDuration??0)/36e5,1),s=Math.min(e.recentErrors/5,1);return(t+s)/2}calculateBreakDuration(e){return e>=.9?10*60*1e3:e>=.8?5*60*1e3:3*60*1e3}getFatigueLevel(e){return e>=.8?"high":e>=.5?"medium":"low"}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}detectErrorType(e){return"meaning"}needsContextualLearning(e){return["abstract","concept","theory","principle"].includes(e)}getOptimalLearningHour(){return 10}hasAvailableContexts(e){return!0}getAvailableContextCount(e){return 3}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const cr={debug:(n,e)=>{},info:(n,e)=>console.info(`[StrategyExecutor] ${n}`,e),warn:(n,e)=>console.warn(`[StrategyExecutor] ${n}`,e),error:(n,e)=>console.error(`[StrategyExecutor] ${n}`,e)};class h9{constructor(e){Ee(this,"config");Ee(this,"strategyHistory",[]);Ee(this,"MAX_HISTORY",20);this.config=e}async initialize(){cr.info("StrategyExecutor initializing..."),this.loadHistory(),cr.info("StrategyExecutor initialized")}selectBestStrategy(e,t){try{if(!Array.isArray(e))throw new Error("Signals must be an array");if(e.length===0)return cr.info("No signals provided, using default strategy"),this.getDefaultRecommendation();const s=this.config.minConfidence??.5,r=e.filter(c=>c.confidence>=s);if(r.length===0)return cr.warn("No signals meet confidence threshold",{totalSignals:e.length,minConfidence:this.config.minConfidence}),this.getDefaultRecommendation();const o=r.find(c=>c.priority===10);if(o)return cr.info("Critical priority signal detected",{type:o.type}),this.createRecommendation(o,r,"critical_priority");const i=r.map(c=>({signal:c,score:this.calculateScore(c,t)}));i.forEach(c=>{const l=this.calculateDiversityPenalty(c.signal.type);c.score-=l}),i.sort((c,l)=>l.score-c.score);const a=i[0];return cr.debug("Strategy selected",{strategy:a.signal.type,score:a.score,totalSignals:r.length}),this.createRecommendation(a.signal,r,"score_based",a.score)}catch(s){return cr.error("Strategy selection failed",{signals:e,error:s}),this.getFallbackRecommendation(s)}}async executeStrategy(e,t,s){const r=Date.now();try{if(!Object.values(Rt).includes(e))throw new Error(`Invalid strategy type: ${e}`);const o=[];switch(e){case Rt.IMMEDIATE_REPETITION:o.push(await this.executeImmediateRepetition(t));break;case Rt.TAKE_BREAK:o.push(...await this.executeTakeBreak(s));break;case Rt.USE_CONFUSION_PAIRS:o.push(await this.executeConfusionPairs(t));break;case Rt.REDUCE_DIFFICULTY:o.push(await this.executeReduceDifficulty(t));break;case Rt.SPACED_REPETITION:o.push(await this.executeSpacedRepetition(t));break;case Rt.CONTEXTUAL_LEARNING:o.push(await this.executeContextualLearning(t));break;case Rt.GROUP_BY_THEME:o.push(await this.executeGroupByTheme(t));break;case Rt.ADJUST_SESSION_LENGTH:o.push(await this.executeAdjustSessionLength(s));break;case Rt.USE_ETYMOLOGY:o.push(await this.executeUseEtymology(t));break;case Rt.TIME_OF_DAY_OPTIMIZATION:o.push(await this.executeTimeOfDayOptimization());break;case Rt.INCREASE_EXPOSURE:o.push(await this.executeIncreaseExposure(t));break;case Rt.CONTINUE_NORMAL:break;default:cr.warn(`No execution logic for strategy: ${e}`)}return this.recordUsage(e),{success:!0,strategy:e,actions:o,duration:Date.now()-r}}catch(o){return cr.error("Strategy execution failed",{strategy:e,word:t,error:o}),{success:!1,strategy:e,actions:[],duration:Date.now()-r,error:o instanceof Error?o.message:String(o)}}}async executeImmediateRepetition(e){return{type:"QUEUE_FRONT",timestamp:Date.now(),metadata:{word:e,position:0,queueType:"immediate"}}}async executeTakeBreak(e){const t=this.calculateBreakDuration(e);return[{type:"PAUSE_SESSION",timestamp:Date.now(),metadata:{duration:t,reason:"cognitive_load"}},{type:"SHOW_BREAK_NOTIFICATION",timestamp:Date.now(),metadata:{message:`${t/6e4}ÂàÜÈñì„ÅÆ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô`}}]}async executeConfusionPairs(e){const t=this.getConfusionPairs(e);return{type:"LOAD_CONFUSION_PAIRS",timestamp:Date.now(),metadata:{word:e,pairs:t}}}async executeReduceDifficulty(e){return{type:"ADJUST_DIFFICULTY",timestamp:Date.now(),metadata:{word:e,direction:"decrease",amount:1}}}async executeSpacedRepetition(e){return{type:"SCHEDULE_SPACED_REVIEW",timestamp:Date.now(),metadata:{word:e,nextReviewTime:Date.now()+24*60*60*1e3}}}async executeContextualLearning(e){return{type:"SHOW_CONTEXT_EXAMPLES",timestamp:Date.now(),metadata:{word:e,exampleCount:3}}}async executeGroupByTheme(e){const t=this.getThemeCategory(e);return{type:"GROUP_WORDS_BY_THEME",timestamp:Date.now(),metadata:{word:e,theme:t}}}async executeAdjustSessionLength(e){return{type:"ADJUST_SESSION_LENGTH",timestamp:Date.now(),metadata:{currentLength:e.sessionDuration,recommendedLength:15e5}}}async executeUseEtymology(e){return{type:"SHOW_ETYMOLOGY",timestamp:Date.now(),metadata:{word:e}}}async executeTimeOfDayOptimization(){return{type:"SUGGEST_OPTIMAL_TIME",timestamp:Date.now(),metadata:{optimalHour:10,message:"Â≠¶ÁøíÂäπÊûú„ÅåÊúÄ„ÇÇÈ´ò„ÅÑÊôÇÈñìÂ∏Ø„ÅØ10ÊôÇÈ†É„Åß„Åô"}}}async executeIncreaseExposure(e){return{type:"INCREASE_EXPOSURE_FREQUENCY",timestamp:Date.now(),metadata:{word:e,multiplier:1.5}}}calculateScore(e,t){const s=e.strength*e.priority,r=e.confidence*2;let o=0;const i=t.get(e.type);if(i){o=i.successRate*3;const a=Date.now()-i.lastUsed,c=Math.max(0,2-a/1e6);o-=c}return s+r+o}calculateDiversityPenalty(e){return this.strategyHistory.slice(-5).filter(s=>s.strategy===e).length*.5}createRecommendation(e,t,s,r){return{strategy:e.type,confidence:e.confidence,reason:this.generateReason(e),signals:t,metadata:{selectionMethod:s,score:r,signalSource:e.source}}}generateReason(e){return{[Rt.IMMEDIATE_REPETITION]:"ÈÄ£Á∂ö„Ç®„É©„Éº„ÅåÊ§úÂá∫„Åï„Çå„Åü„Åü„ÇÅ„ÄÅÂç≥Â∫ß„Å´Âæ©Áøí„Åó„Åæ„Åô",[Rt.TAKE_BREAK]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅ‰ºëÊÜ©„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô",[Rt.USE_CONFUSION_PAIRS]:"Ê∑∑Âêå„Åó„ÇÑ„Åô„ÅÑÂçòË™û„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü",[Rt.REDUCE_DIFFICULTY]:"Ë™çÁü•Ë≤†Ëç∑„ÅåÈ´ò„ÅÑ„Åü„ÇÅ„ÄÅÈõ£ÊòìÂ∫¶„Çí‰∏ã„Åí„Åæ„Åô",[Rt.SPACED_REPETITION]:"ÁøíÂæó„ÅåÈÄ≤„Çì„Åß„ÅÑ„Çã„Åü„ÇÅ„ÄÅÈñìÈöî„ÇíÁ©∫„Åë„Å¶Âæ©Áøí„Åó„Åæ„Åô",[Rt.CONTEXTUAL_LEARNING]:"ÊñáËÑà‰æãÊñá„ÅßÁêÜËß£„ÇíÊ∑±„ÇÅ„Åæ„Åô",[Rt.GROUP_BY_THEME]:"Èñ¢ÈÄ£Ë™ûÂΩô„Å®„Çª„ÉÉ„Éà„ÅßÂ≠¶Áøí„Åó„Åæ„Åô",[Rt.ADJUST_SESSION_LENGTH]:"„Çª„ÉÉ„Ç∑„Éß„É≥Èï∑„ÇíÊúÄÈÅ©Âåñ„Åó„Åæ„Åô",[Rt.USE_ETYMOLOGY]:"Ë™ûÊ∫êÊÉÖÂ†±„ÅßË®òÊÜ∂„ÇíÂº∑Âåñ„Åó„Åæ„Åô",[Rt.TIME_OF_DAY_OPTIMIZATION]:"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊôÇÈñìÂ∏Ø„ÇíÊèêÊ°à„Åó„Åæ„Åô",[Rt.INCREASE_EXPOSURE]:"Èú≤Âá∫ÂõûÊï∞„ÇíÂ¢ó„ÇÑ„Åó„Å¶ÂÆöÁùÄ„Çí‰øÉÈÄ≤„Åó„Åæ„Åô",[Rt.CONTINUE_NORMAL]:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô"}[e.type]||"ÊúÄÈÅ©„Å™Â≠¶ÁøíÊà¶Áï•„ÇíÈÅ©Áî®„Åó„Åæ„Åô"}getDefaultRecommendation(){return{strategy:Rt.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!1,default:!0}}}getFallbackRecommendation(e){return{strategy:Rt.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:e==null?void 0:e.message}}}recordUsage(e){this.strategyHistory.push({strategy:e,timestamp:Date.now()}),this.strategyHistory.length>this.MAX_HISTORY&&this.strategyHistory.shift(),this.saveHistory()}saveHistory(){try{localStorage.setItem("adaptive_strategy_history",JSON.stringify(this.strategyHistory))}catch(e){cr.warn("Failed to save strategy history",e)}}loadHistory(){try{const e=localStorage.getItem("adaptive_strategy_history");e&&(this.strategyHistory=JSON.parse(e))}catch(e){cr.warn("Failed to load strategy history",e)}}calculateBreakDuration(e){const t=e.cognitiveLoad??.5;return t>=.9?10*60*1e3:t>=.8?5*60*1e3:3*60*1e3}getConfusionPairs(e){return{affect:["effect"],effect:["affect"],accept:["except"],except:["accept"]}[e]||[]}getThemeCategory(e){return{apple:"fruits",banana:"fruits",dog:"animals",cat:"animals"}[e]||null}}const Nr={debug:(n,e)=>{},info:(n,e)=>console.info(`[EffectivenessTracker] ${n}`,e),warn:(n,e)=>console.warn(`[EffectivenessTracker] ${n}`,e),error:(n,e)=>console.error(`[EffectivenessTracker] ${n}`,e)},Ey="adaptive_network_effectiveness";class p9{constructor(e){Ee(this,"effectiveness",new Map);Ee(this,"measurements",[]);Ee(this,"config");Ee(this,"saveTimer",null);this.config=e}async initialize(){Nr.info("EffectivenessTracker initializing..."),await this.loadHistory(),Nr.info("EffectivenessTracker initialized",{strategies:this.effectiveness.size,measurements:this.measurements.length})}recordOutcome(e,t){try{if(!Object.values(Rt).includes(e))throw new Error(`Invalid strategy: ${e}`);if(typeof t.success!="boolean")throw new Error("Outcome.success must be boolean");let s=this.effectiveness.get(e);s||(s=this.createDefaultEffectiveness(e),this.effectiveness.set(e,s)),s.totalUses++,t.success?s.successCount++:s.failureCount++,s.successRate=s.successCount/s.totalUses,s.lastUsed=t.timestamp,t.timeToMastery!==void 0&&this.updateAverage(s,"averageTimeToMastery",t.timeToMastery),t.retentionRate!==void 0&&this.updateAverage(s,"averageRetentionRate",t.retentionRate),s.confidence=this.calculateConfidence(s.totalUses),this.measurements.push({strategy:e,outcome:t,timestamp:Date.now()});const r=this.config.effectivenessWindowSize??50;this.measurements.length>r*2&&(this.measurements=this.measurements.slice(-r)),Nr.debug("Outcome recorded",{strategy:e,success:t.success,totalUses:s.totalUses,successRate:s.successRate}),this.debounceSave()}catch(s){Nr.error("Failed to record outcome",{strategy:e,outcome:t,error:s})}}getEffectiveness(e){return this.effectiveness.get(e)}getAllEffectiveness(){return new Map(this.effectiveness)}compareStrategies(e,t){const s=this.effectiveness.get(e),r=this.effectiveness.get(t);if(!s||!r)return{strategy1:e,strategy2:t,betterStrategy:null,successRateDiff:0,confidenceLevel:0,recommendation:"„Éá„Éº„Çø‰∏çË∂≥„ÅÆ„Åü„ÇÅÊØîËºÉ„Åß„Åç„Åæ„Åõ„Çì"};const o=s.successRate-r.successRate,i=this.calculateStatisticalSignificance(s,r);let a=null;Math.abs(o)>.05&&i>.8&&(a=o>0?e:t);let c="";return a?c=`${a}„ÅÆÊñπ„ÅåÂäπÊûúÁöÑ„Åß„ÅôÔºàÂ∑Æ: ${(Math.abs(o)*100).toFixed(1)}%Ôºâ`:i<.8?c="„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô":c="‰∏°Êà¶Áï•„ÅÆÂäπÊûú„ÅØÂêåÁ®ãÂ∫¶„Åß„Åô",{strategy1:e,strategy2:t,betterStrategy:a,successRateDiff:o,confidenceLevel:i,recommendation:c}}exportMetrics(){const e=Array.from(this.effectiveness.values()),t=e.filter(i=>i.totalUses>=10).sort((i,a)=>a.successRate-i.successRate).slice(0,3).map(i=>({strategy:i.strategyType,successRate:i.successRate,uses:i.totalUses})),s=[];t.length>0&&s.push(`ÊúÄ„ÇÇÂäπÊûúÁöÑ„Å™Êà¶Áï•: ${t[0].strategy}ÔºàÊàêÂäüÁéá: ${(t[0].successRate*100).toFixed(1)}%Ôºâ`);const r=e.filter(i=>i.totalUses>=10&&i.successRate<.5).map(i=>i.strategyType);r.length>0&&s.push(`ÊîπÂñÑ„ÅåÂøÖË¶Å„Å™Êà¶Áï•: ${r.join(", ")}`);const o=e.filter(i=>i.totalUses<10);return o.length>0&&s.push(`„Çà„ÇäÂ§ö„Åè„ÅÆ„Éá„Éº„Çø„ÅåÂøÖË¶Å: ${o.length}ÂÄã„ÅÆÊà¶Áï•`),{topPerformers:t,recommendations:s,timestamp:Date.now()}}reset(){Nr.info("Resetting effectiveness data"),this.effectiveness.clear(),this.measurements=[],this.saveToStorage()}createDefaultEffectiveness(e){return{strategyType:e,totalUses:0,successCount:0,failureCount:0,successRate:0,averageTimeToMastery:0,averageRetentionRate:0,lastUsed:0,confidence:0}}updateAverage(e,t,s){const r=e[t],o=e.totalUses;e[t]=(r*(o-1)+s)/o}calculateConfidence(e){return Math.min(1,e/(e+2+2))}calculateStatisticalSignificance(e,t){const s=e.totalUses,r=t.totalUses,o=Math.abs(e.successRate-t.successRate);return(Math.min(1,(s+r)/100)+o)/2}async loadHistory(){try{const e=localStorage.getItem(Ey);if(!e){Nr.info("No stored effectiveness data found");return}const t=JSON.parse(e);t.strategies&&t.strategies.forEach(s=>{this.effectiveness.set(s.strategyType,s)}),Array.isArray(t.measurements)&&(this.measurements=t.measurements),Nr.info("Effectiveness data loaded",{strategies:this.effectiveness.size,measurements:this.measurements.length})}catch(e){Nr.error("Failed to load effectiveness data",e)}}saveToStorage(){try{const e={version:"1.0.0",strategies:Array.from(this.effectiveness.values()),measurements:this.measurements,lastUpdated:Date.now()};localStorage.setItem(Ey,JSON.stringify(e)),Nr.debug("Effectiveness data saved")}catch(e){Nr.warn("Failed to save effectiveness data",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveToStorage(),this.saveTimer=null},500)}}const sn={debug:(n,e)=>{},info:(n,e)=>console.info(`[AdaptiveNetwork] ${n}`,e),warn:(n,e)=>console.warn(`[AdaptiveNetwork] ${n}`,e),error:(n,e)=>console.error(`[AdaptiveNetwork] ${n}`,e)},dp="adaptive_network_state",f9="adaptive_network_config";class m9{constructor(e){Ee(this,"signalDetector");Ee(this,"strategyExecutor");Ee(this,"effectivenessTracker");Ee(this,"state");Ee(this,"config");Ee(this,"saveTimer",null);this.config={...u9,...e},this.state=this.createInitialState(),this.signalDetector=new d9(this.config),this.strategyExecutor=new h9(this.config),this.effectivenessTracker=new p9(this.config),this.loadState(),sn.info("AdaptiveEducationalAINetwork created",{enabled:this.config.enabled})}async initialize(){sn.info("Initializing AdaptiveEducationalAINetwork...");try{await Promise.all([this.signalDetector.initialize(),this.strategyExecutor.initialize(),this.effectivenessTracker.initialize()]),this.validateAndRepairState(),sn.info("AdaptiveEducationalAINetwork initialized successfully")}catch(e){sn.error("Initialization failed",e);try{this.initializeWithDefaults(),sn.info("Initialized with default configuration")}catch{throw new Error(`Failed to initialize Adaptive Network: ${e instanceof Error?e.message:String(e)}`)}}}async processQuestion(e,t,s){try{this.validateInput(e,t,s)}catch(r){return sn.error("Invalid input",{word:e,result:t,context:s,error:r}),this.getDefaultRecommendation()}if(!this.state.enabled)return this.getDefaultRecommendation();try{const r=await this.signalDetector.detectSignals(e,t,s);sn.debug("Signals detected",{word:e,result:t,signalCount:r.length});const o=this.strategyExecutor.selectBestStrategy(r,this.state.effectiveness);return sn.info("Strategy selected",{word:e,result:t,strategy:o.strategy,confidence:o.confidence}),this.executeStrategyAsync(o.strategy,e,s),this.updateState(o,r),this.updateSessionStats(t),this.debounceSave(),o}catch(r){return sn.error("Question processing failed",{word:e,result:t,context:s,error:r}),{strategy:Rt.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{error:!0,fallback:!0,errorMessage:r instanceof Error?r.message:String(r)}}}}getState(){return{...this.state}}updateConfig(e){this.config={...this.config,...e},e.enabled!==void 0&&(this.state.enabled=e.enabled),this.saveConfig(),sn.info("Configuration updated",e)}resetState(){sn.info("Resetting network state"),this.state=this.createInitialState(),this.effectivenessTracker.reset();try{localStorage.removeItem(dp)}catch(e){sn.warn("Failed to remove state from storage",e)}sn.info("Network state reset complete")}exportState(){const e={version:"1.0.0",state:this.state,config:this.config,effectiveness:Array.from(this.state.effectiveness.entries()),exportedAt:Date.now()};return JSON.stringify(e,null,2)}importState(e){try{const t=JSON.parse(e);t.version!=="1.0.0"&&sn.warn("Version mismatch, attempting migration",{expected:"1.0.0",actual:t.version}),t.state&&(this.state={...t.state,effectiveness:new Map(t.effectiveness||[])}),t.config&&(this.config=t.config),this.saveState(),this.saveConfig(),sn.info("State imported successfully")}catch(t){throw sn.error("Failed to import state",t),new Error(`Invalid state data: ${t instanceof Error?t.message:String(t)}`)}}createInitialState(){return{enabled:this.config.enabled,currentStrategy:null,activeSignals:[],effectiveness:new Map,sessionStats:{questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0},lastUpdated:Date.now()}}initializeWithDefaults(){this.state=this.createInitialState(),sn.info("Initialized with defaults")}validateInput(e,t,s){if(!e||typeof e!="string")throw new Error("Invalid word parameter");if(t!=="correct"&&t!=="incorrect")throw new Error('Result must be "correct" or "incorrect"');if(!s||typeof s!="object")throw new Error("Invalid context parameter")}getDefaultRecommendation(){return{strategy:Rt.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}async executeStrategyAsync(e,t,s){try{const r=await this.strategyExecutor.executeStrategy(e,t,s);r.success?sn.debug("Strategy executed",{strategy:e,actionCount:r.actions.length,duration:r.duration}):sn.warn("Strategy execution failed",{strategy:e,error:r.error})}catch(r){sn.error("Strategy execution error",{strategy:e,error:r})}}updateState(e,t){this.state.currentStrategy=e.strategy,this.state.activeSignals=t,this.state.lastUpdated=Date.now()}updateSessionStats(e){this.state.sessionStats.questionsAnswered++,e==="correct"?this.state.sessionStats.correctAnswers++:this.state.sessionStats.incorrectAnswers++,this.state.sessionStats.totalSessionTime=Date.now()-this.state.sessionStats.sessionStartTime}validateAndRepairState(){typeof this.state.enabled!="boolean"&&(sn.warn("Invalid enabled state, repairing"),this.state.enabled=!1),Array.isArray(this.state.activeSignals)||(sn.warn("Invalid activeSignals, repairing"),this.state.activeSignals=[]),this.state.effectiveness instanceof Map||(sn.warn("Invalid effectiveness map, repairing"),this.state.effectiveness=new Map),(!this.state.sessionStats||typeof this.state.sessionStats!="object")&&(sn.warn("Invalid sessionStats, repairing"),this.state.sessionStats={questionsAnswered:0,correctAnswers:0,incorrectAnswers:0,sessionStartTime:Date.now(),totalSessionTime:0})}loadState(){try{const e=localStorage.getItem(dp);if(!e){sn.info("No stored state found");return}const t=JSON.parse(e);t.effectiveness&&Array.isArray(t.effectiveness)&&(t.effectiveness=new Map(t.effectiveness)),this.state={...this.state,...t},sn.info("State loaded from storage")}catch(e){sn.error("Failed to load state",e)}}saveState(){try{const e={...this.state,effectiveness:Array.from(this.state.effectiveness.entries())};localStorage.setItem(dp,JSON.stringify(e)),sn.debug("State saved to storage")}catch(e){sn.warn("Failed to save state",e)}}saveConfig(){try{localStorage.setItem(f9,JSON.stringify(this.config))}catch(e){sn.warn("Failed to save config",e)}}debounceSave(){this.saveTimer&&clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>{this.saveState(),this.saveTimer=null},500)}}function Ph(){const n=T.useRef(null),[e,t]=T.useState(!0),[s,r]=T.useState(null),[o,i]=T.useState(new Map),[a,c]=T.useState(!1),[l,d]=T.useState(null),[h,p]=T.useState(!1);T.useEffect(()=>{(async()=>{try{if(!n.current){n.current=new m9({enabled:!0}),await n.current.initialize();const b=n.current.getState();t(b.enabled),r(b.currentStrategy),i(b.effectiveness),p(!0),console.log("[useAdaptiveNetwork] Network initialized")}}catch(b){d(b instanceof Error?b:new Error(String(b))),console.error("[useAdaptiveNetwork] Initialization failed",b)}})()},[]);const f=T.useCallback(async(y,b,v)=>{if(!n.current)return console.warn("[useAdaptiveNetwork] Network not initialized"),g9();c(!0),d(null);try{const w=await n.current.processQuestion(y,b,v);r(w.strategy);const S=n.current.getState();return i(S.effectiveness),w}catch(w){const S=w instanceof Error?w:new Error(String(w));return d(S),console.error("[useAdaptiveNetwork] Question processing failed",w),x9(S)}finally{c(!1)}},[e]),m=T.useCallback(()=>{if(!n.current)return;const y=!e;n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`)},[e]),g=T.useCallback(y=>{n.current&&(n.current.updateConfig({enabled:y}),t(y),console.log(`[useAdaptiveNetwork] Network ${y?"enabled":"disabled"}`))},[]),x=T.useCallback(()=>{n.current&&(n.current.resetState(),r(null),i(new Map),d(null),console.log("[useAdaptiveNetwork] State reset"))},[]);return{enabled:e,currentStrategy:s,processQuestion:f,toggleEnabled:m,setEnabled:g,resetState:x,effectiveness:o,isLoading:a,error:l,isInitialized:h}}function g9(){return{strategy:Rt.CONTINUE_NORMAL,confidence:.5,reason:"ÈÄöÂ∏∏„ÅÆÂ≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{default:!0}}}function x9(n){return{strategy:Rt.CONTINUE_NORMAL,confidence:0,reason:"AIÂá¶ÁêÜ„Åå‰∏ÄÊôÇÁöÑ„Å´Âà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅÈÄöÂ∏∏Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åô",signals:[],metadata:{fallback:!0,error:!0,errorMessage:n.message}}}function Ry({question:n,allQuestions:e,currentIndex:t,answered:s,selectedAnswer:r,onAnswer:o,onNext:i,onPrevious:a,onDifficultyRate:c,customQuestionSets:l=[],onAddWordToCustomSet:d,onRemoveWordFromCustomSet:h,onOpenCustomSetManagement:p,onFullscreen:f}){const m=T.useMemo(()=>pI(n,e,t),[n.word,e,t]),[g,x]=T.useState(null),[y,b]=T.useState(new Set),[v,w]=T.useState(""),[S,N]=T.useState(0),[,C]=T.useState(()=>{const U=sessionStorage.getItem("currentCorrectStreak");return U?parseInt(U,10):0}),{processQuestion:k}=Ph(),I=async(U,V)=>{try{const B=ye=>{const Ae=(ye.grade||1)/9;return Math.min(Math.max(Ae,0),1)},Y=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(Ae=>!Ae.correct).length,K=()=>{const ye=sessionStorage.getItem("sessionStartTime");return ye?Math.floor((Date.now()-parseInt(ye))/6e4):0},pe=()=>parseInt(sessionStorage.getItem("currentCorrectStreak")||"0"),ge=()=>{const ye=new Date().getHours();return ye<12?"morning":ye<18?"afternoon":ye<22?"evening":"night"},re=await k(U,V?"correct":"incorrect",{currentDifficulty:B(n),timeOfDay:ge(),recentErrors:Y(),sessionLength:K(),consecutiveCorrect:pe()});console.log("[AdaptiveAI]",re.reason,{strategy:re.strategy,confidence:re.confidence})}catch(B){console.error("[QuestionCard] Adaptive AI error:",B)}},$=T.useRef(0),j=T.useRef(0),P=T.useRef(null),O=T.useRef(!1);T.useEffect(()=>{x(null),b(new Set),w(""),N(0)},[t]);const A=U=>{b(V=>{const B=new Set(V);return s?B.size>0?new Set:new Set(m.map((Y,K)=>K)):(B.has(U)?B.delete(U):B.add(U),B)})};T.useEffect(()=>{const U=localStorage.getItem("autoShowDetails")!=="false";s&&r&&r!==n.meaning&&U&&b(new Set(m.map((V,B)=>B)))},[s,r,n.meaning,m]),T.useEffect(()=>{if(s&&r){const U=localStorage.getItem("aiPersonality")||"kind-teacher",V=r===n.meaning,B=parseInt(sessionStorage.getItem("currentCorrectStreak")||"0",10);let Y=AI(U,{isCorrect:V,word:n.word,difficulty:"intermediate",category:"",attemptCount:S+1,responseTime:0,correctStreak:0,incorrectStreak:0,userAccuracy:0,categoryAccuracy:0,isWeakCategory:!1,hasSeenBefore:!1,previousAttempts:0,todayQuestions:0,todayAccuracy:0,planProgress:0,timeOfDay:A0()});const K=[];if(V&&Math.random()<.1){const re=RI();re.estimatedDaysToAchieve>0&&re.estimatedDaysToAchieve<=30&&(re.overallProgress>=90?K.push(`üéØ ${re.goal.name}„Åæ„Åß„ÅÇ„Å®Â∞ë„ÅóÔºÅ`):re.overallProgress>=75&&K.push(`üìà „Åì„ÅÆ„Éö„Éº„Çπ„Å™„Çâ${re.estimatedDaysToAchieve}Êó•„Åß${re.goal.name}ÈÅîÊàê„Åß„ÅôÔºÅ`))}if(!V){const re=DI(n.word);re.length>0&&K.push(`üí° „Äå${n.word}„Äç„Å®„Äå${re.join(", ")}„Äç„ÇíÊ∑∑Âêå„Åó„ÇÑ„Åô„ÅÑ„ÅÆ„ÅßÊ≥®ÊÑèÔºÅ`)}if(!V&&Math.random()<.05){const ye=e9().find(Ae=>Ae.words.includes(n.word.toLowerCase())&&Ae.needsReview);ye&&K.push(s9(ye))}const pe=OQ(U,V,B);if(pe&&K.push(pe.message),V){const re=WQ(B+1);re&&K.push(re)}const ge=KQ(V);if(ge&&K.push(ge),V){const re=B+1;C(re),sessionStorage.setItem("currentCorrectStreak",String(re))}else C(0),sessionStorage.setItem("currentCorrectStreak","0");K.length>0&&(Y=`${Y} ${K[0]}`),w(Y)}else w("")},[s,r,n,S]);const z=()=>{b(new Set),N(0),i()};T.useEffect(()=>{const U=K=>{const pe=K.target;pe.closest(".choice-btn")||pe.closest(".toggle-details-btn")||pe.closest(".rating-btn")||pe.closest(".inline-nav-btn")||pe.closest(".question-text")||($.current=K.touches[0].clientX,O.current=!0)},V=K=>{$.current!==0&&(j.current=K.touches[0].clientX)},B=()=>{if($.current===0){O.current=!1;return}const K=$.current-j.current;Math.abs(K)>80&&(K>0?s?z():i():t>0&&a()),$.current=0,j.current=0,setTimeout(()=>{O.current=!1},300)},Y=P.current;if(Y)return Y.addEventListener("touchstart",U,{passive:!0}),Y.addEventListener("touchmove",V,{passive:!0}),Y.addEventListener("touchend",B),()=>{Y.removeEventListener("touchstart",U),Y.removeEventListener("touchmove",V),Y.removeEventListener("touchend",B)}},[s,t,i,a]),T.useEffect(()=>{const U=V=>{if(!s&&["1","2","3","4"].includes(V.key)){const B=parseInt(V.key)-1;if(B<m.length){V.preventDefault();const Y=m[B].text,K=m[B].question,pe=Y===n.meaning;pe||N(ge=>ge+1),o(Y,n.meaning,K),I(n.word,pe)}}else!s&&V.key===" "?(V.preventDefault(),i()):V.key==="Enter"&&(V.preventDefault(),s?z():i())};return window.addEventListener("keydown",U),()=>{window.removeEventListener("keydown",U)}},[s,m,n,o,S]);const L=U=>{const V="w-full min-h-11 sm:min-h-14 p-2 sm:p-4 text-sm sm:text-base rounded-xl border-2 cursor-pointer transition-all duration-300 flex flex-col items-center text-center touch-manipulation select-none shadow-sm",B="hover:border-blue-600 hover:bg-gray-100:bg-gray-800 hover:-translate-y-1 hover:shadow-lg",Y="active:bg-gray-200:bg-gray-700 active:translate-y-0";return U==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?s?U===r?`${V} bg-red-600 border-red-600 text-white`:`${V} bg-gray-100 text-gray-600 border-gray-400`:`${V} bg-gray-100 text-gray-600 border-gray-400 ${B} ${Y}`:s?U===n.meaning?`${V} bg-green-600 border-green-600 text-white`:U===r&&U!==n.meaning?`${V} bg-red-600 border-red-600 text-white`:`${V} bg-gray-50 text-gray-900 border-gray-300`:`${V} bg-gray-50 text-gray-900 border-gray-300 ${B} ${Y}`};return u.jsxs("div",{className:"question-card",ref:P,children:[f&&u.jsx("button",{onClick:f,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:a,disabled:t===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:`question-content-inline ${xn()?"clickable-pronunciation":""}`,onClick:U=>{xn()&&(U.preventDefault(),U.stopPropagation(),Ts(n.word,{rate:.85}))},onTouchEnd:U=>{xn()&&(U.preventDefault(),U.stopPropagation(),Ts(n.word,{rate:.85}))},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 break-words ${n.word.includes(" ")?"phrase-text":""} ${xn()?"clickable-word":""}`,children:[n.word,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),n.reading&&u.jsxs("div",{className:"question-reading text-sm sm:text-base text-gray-600 mt-1",children:["„Äê",n.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[n.difficulty&&u.jsx("div",{className:`difficulty-badge ${n.difficulty}`,children:n.difficulty==="beginner"?"ÂàùÁ¥ö":n.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),d&&h&&p&&l&&u.jsx(oi,{word:{word:n.word,meaning:n.meaning,katakana:n.reading,source:"translation"},sets:l,onAddWord:d,onRemoveWord:h,onOpenManagement:p,size:"medium",variant:"both"})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:z,title:"Ê¨°„Å∏",children:"‚Üí"})]}),u.jsx("div",{className:"choices",children:m.map((U,V)=>{const B=y.has(V),Y=U.question;return u.jsxs("div",{className:"choice-wrapper",children:[u.jsx("button",{className:L(U.text),onClick:K=>{if(s){K.preventDefault(),K.stopPropagation(),Y&&A(V);return}const pe=U.text===n.meaning;pe||N(ge=>ge+1),o(U.text,n.meaning,Y),I(n.word,pe)},disabled:!1,children:u.jsx("div",{className:"choice-content",children:u.jsx("div",{className:"choice-text",children:U.text})})}),s&&Y&&B&&u.jsxs("div",{className:"choice-details",children:[u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™ûÂè•:"}),u.jsx("span",{className:"detail-text",children:Y.word})]}),Y.reading&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-text",children:Y.reading})]}),Y.meaning&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-text",children:Y.meaning})]}),Y.etymology&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠â:"}),u.jsx("span",{className:"detail-text",children:Y.etymology})]}),Y.relatedWords&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-text",children:Y.relatedWords})]}),Y.relatedFields&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è ÂàÜÈáé:"}),u.jsx("span",{className:"detail-text",children:Y.relatedFields})]}),Y.difficulty&&u.jsxs("div",{className:"choice-detail-item",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("span",{className:"detail-text",children:Y.difficulty})]})]})]},V)})})]})}const E0="ab_session_logs_v1",Dy=300;function y9(n){try{const e=R0();e.push(n),e.length>Dy&&e.splice(0,e.length-Dy),localStorage.setItem(E0,JSON.stringify(e))}catch(e){console.error("[AB Storage] Failed to append session log:",e)}}function R0(){try{const n=localStorage.getItem(E0);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch(n){return console.error("[AB Storage] Failed to load session logs:",n),[]}}function b9(){const n=R0();return JSON.stringify(n,null,2)}function w9(){try{localStorage.removeItem(E0)}catch(n){console.error("[AB Storage] Failed to clear session logs:",n)}}function hp(n){if(n.length===0)return 0;const e=[...n].sort((s,r)=>s-r),t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}function Ql(n){return n.length===0?0:n.reduce((e,t)=>e+t,0)/n.length}function pp(n,e){const t=n.filter(a=>a.variant===e);if(t.length===0)return null;const s=t.map(a=>a.acquiredWordCount),r=t.map(a=>a.acquisitionRate),o=t.map(a=>a.vibrationScore),i=t.map(a=>a.durationSec);return{variant:e,sessionCount:t.length,avgAcquiredWords:Ql(s),medianAcquiredWords:hp(s),avgAcquisitionRate:Ql(r),medianAcquisitionRate:hp(r),avgVibrationScore:Ql(o),medianVibrationScore:hp(o),avgDurationSec:Ql(i)}}function _y(){const n=R0();return{totalSessions:n.length,byVariant:{A:pp(n,"A"),B:pp(n,"B"),C:pp(n,"C")},lastUpdated:Date.now()}}function Zr(n,e){const t=typeof n=="number"?n:Number(n);return Number.isFinite(t)?t:e}function v9(n,e){if(!n)return null;switch(e){case"memorization":return n.memorizationPosition??null;case"translation":return n.translationPosition??null;case"spelling":return n.spellingPosition??null;case"grammar":return n.grammarPosition??null}}function fp(n,e){if(!n)return 0;switch(e){case"memorization":return Zr(n.memorizationAttempts,0);case"translation":return Zr(n.translationAttempts,0);case"spelling":return Zr(n.spellingAttempts,0);case"grammar":return Zr(n.grammarAttempts,0)}}function Py(n,e){if(!n)return 0;switch(e){case"memorization":return Zr(n.memorizationCorrect,0);case"translation":return Zr(n.translationCorrect,0);case"spelling":return Zr(n.spellingCorrect,0);case"grammar":return Zr(n.grammarCorrect,0)}}function jy(n,e){return!n||e!=="memorization"?0:Zr(n.memorizationStillLearning,0)}function Wi(n){const{value:e}=sb("debug_postProcess_output",{mode:n});return e?Array.isArray(e)?e:Array.isArray(e==null?void 0:e.top30)?e.top30:[]:[]}function S9(n){return sb("debug_postProcess_meta",{mode:n}).value}function jh({mode:n,currentIndex:e,totalQuestions:t,questions:s,requeuedWords:r=[],initialExpanded:o=!0}){const[i,a]=T.useState(o),[c,l]=T.useState([]),[d,h]=T.useState(!1),[p,f]=T.useState([]),[m,g]=T.useState(null),[x,y]=T.useState([]),[b,v]=T.useState([]),[w,S]=T.useState(null);T.useEffect(()=>{const C=cp(n);f(C)},[e,n]),T.useEffect(()=>{if(i){const C=_y();S(C)}},[i,e]);const N=()=>{var oe,he,Te,Se,te,Fe,Le,De,Ke,pt;const C=new Date().toISOString(),k=it(),I=Object.keys(k.wordProgress||{}).length,$=Object.values(k.wordProgress||{}),j=$.filter(R=>v9(R,n)==null).length,P=$.filter(R=>(R==null?void 0:R.category)==null).length,O=$.filter(R=>(R==null?void 0:R.lastStudied)==null).length,A=$.filter(R=>(R==null?void 0:R.correctCount)==null||(R==null?void 0:R.incorrectCount)==null||(R==null?void 0:R.consecutiveCorrect)==null).length;let z=0,L=0,U=0,V=0,B=0,Y=0,K=0;for(const R of $){const D=fp(R,n),F=Py(R,n),M=jy(R,n),X=Ut(R,n);B+=D,Y+=F,K+=M,D!==0&&(X>=70?(U++,V++):X>=40?(L++,V++):X<20&&z++)}const pe=Math.max(0,B-Y-K),ge=B>0?(Y/B*100).toFixed(1):"0.0",re=k.wordProgress||{},ye=R=>String(R??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),Ae=R=>ye(R).toLowerCase(),ve=new Map;for(const R of Object.keys(re)){const D=Ae(R);ve.has(D)||ve.set(D,R)}const _e=R=>{const D=ye(R);if(!D)return null;const F=re[D];if(F)return F;const M=re[D.toLowerCase()];if(M)return M;const X=ve.get(Ae(D));return X?re[X]??null:null},et=Wi(n).slice(0,10).map(R=>String((R==null?void 0:R.word)??"")).filter(Boolean),ut=s.slice(e+1,e+11).map(R=>String(R.word??"")).filter(Boolean),yt=et.length>0?et:ut,bt=et.length>0?"postProcess() TOP10":"propsÔºàÁèæÂú®‰ΩçÁΩÆ„ÅÆÊ¨°10ÂïèÔºâ",$t=R=>{const D=_e(R),F=Ut(D,n),M=fp(D,n),X=M===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":F>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":F>=40?"üü° „Åæ„Å†„Åæ„Å†":F>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return{position:F,attempts:M,status:X}},ae=yt.length>0&&yt.every(R=>$t(R).position<40),le=c.length===0?"_Ôºà„Éá„Éº„Çø„Å™„ÅóÔºâ_":`| ÂçòË™û | Position | Category | üß† Memory | üí§ CogLoad | üîÆ Error | üìö Linguistic | üåç Context | üéØ Style | üéÆ Gamify |
|------|----------|----------|-----------|-----------|----------|--------------|-----------|----------|----------|
`+c.map(R=>{const D=(()=>{switch(R.category){case"incorrect":return"‚ùå ÂàÜ„Åã„Çâ„Å™„ÅÑ";case"still_learning":return"üü° „Åæ„Å†„Åæ„Å†";case"mastered":return"‚úÖ ÂÆöÁùÄÊ∏à";case"new":return"‚ö™ Êñ∞Ë¶è";default:return"‚ö™ Êñ∞Ë¶è"}})(),F=(R.position??0).toFixed(0),M=R.aiProposals||{};return`| **${R.word}** | ${F} | ${D} | ${(M.memory??0).toFixed(0)} | ${(M.cognitiveLoad??0).toFixed(0)} | ${(M.errorPrediction??0).toFixed(0)} | ${(M.linguistic??0).toFixed(0)} | ${(M.contextual??0).toFixed(0)} | ${(M.learningStyle??0).toFixed(0)} | ${(M.gamification??0).toFixed(0)} |`}).join(`
`),G=`# üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„É¨„Éù„Éº„ÉàÔºàË©≥Á¥∞ÁâàÔºâ

**ÁîüÊàêÊó•ÊôÇ**: ${C}
    **mode**: ${n}
**ÁèæÂú®‰ΩçÁΩÆ**: ${e+1} / ${t} ÂïèÁõÆ

---

${Fu.generateSummary(n)}

---

${(()=>{var R,D;try{const F=localStorage.getItem("debug_weak_words_detection");if(F){const M=JSON.parse(F),X=(M.allWeakWordsInLS||0)-(((R=M.missingFromBase)==null?void 0:R.length)||0),ue=((D=M.missingFromBase)==null?void 0:D.length)||0;let J=`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

`;return J+=`**timestamp**: ${M.timestamp||"N/A"}

`,J+=`- üìä LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û: **${M.allWeakWordsInLS||0}Ë™û**
`,J+=`- ‚úÖ Ê§úÂá∫ÊàêÂäüÔºàbaseQuestions„Å´Â≠òÂú®Ôºâ: **${X}Ë™û**
`,J+=`- ‚ùå „Éá„Éº„ÇøÊ¨†ÊêçÔºàbaseQuestions„Å´‰∏çÂú®Ôºâ: **${ue}Ë™û**
`,J+=`- üìÅ baseQuestionsÁ∑èÊï∞: ${M.baseQuestionsCount||0}Ë™û
`,J+=`- üîç filteredÁ∑èÊï∞: ${M.filteredCount||0}Ë™û

`,ue>0&&(J+=`### ‚ùå Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº: baseQuestions„Å´Â≠òÂú®„Åó„Å™„ÅÑ„Åæ„Å†„Åæ„Å†Ë™û

`,M.missingFromBase&&M.missingFromBase.length>0&&(J+="```\n",M.missingFromBase.forEach((de,me)=>{J+=`${me+1}. ${de}
`}),J+="```\n\n",J+=`**ÂéüÂõ†**: „Åì„Çå„Çâ„ÅÆÂçòË™û„ÅåÂÖÉ„ÅÆJSON„Éá„Éº„ÇøÔºàjuniorWords.jsonÁ≠âÔºâ„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
`,J+=`**ÂØæÁ≠ñ**: „Éá„Éº„Çø„ÇΩ„Éº„Çπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅ„Åì„Çå„Çâ„ÅÆÂçòË™û„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

`)),M.weakWordsList&&M.weakWordsList.length>0&&(J+=`### üìã LocalStorage„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û„É™„Çπ„Éà

`,J+=`| # | ÂçòË™û | Position | memPos | attempts |
`,J+=`|---|------|----------|--------|----------|
`,M.weakWordsList.slice(0,20).forEach((de,me)=>{J+=`| ${me+1} | **${de.word}** | ${de.position} | ${de.memPos??"-"} | ${de.attempts}Âõû |
`}),M.weakWordsList.length>20&&(J+=`
_‚Ä¶‰ªñ${M.weakWordsList.length-20}Ë™ûÁúÅÁï•_
`),J+=`
`),M.weakQuestionsWords&&M.weakQuestionsWords.length>0&&(J+=`### ‚úÖ Ê§úÂá∫„Åï„Çå„ÅüweakQuestions

`,J+="```\n",M.weakQuestionsWords.slice(0,10).forEach((de,me)=>{J+=`${me+1}. ${de}
`}),M.weakQuestionsWords.length>10&&(J+=`...‰ªñ${M.weakQuestionsWords.length-10}Ë™û
`),J+="```\n\n"),J+=`---

`,J}}catch(F){return`## üö® „Åæ„Å†„Åæ„Å†Ë™ûÊ§úÂá∫Áä∂Ê≥Å

‚ö†Ô∏è Ê§úÂá∫„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${F}

---

`}return""})()}

## üìä „Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ

**Á∑èÂêàÁµ±Ë®à**:
- üìö Á∑èÂçòË™ûÊï∞: ${I}Ë™û
- ‚úÖ ÁøíÂæóÊ∏à„Åø (Position < 20): ${z}Ë™û (${I>0?(z/I*100).toFixed(1):"0.0"}%)
- üü° „Åæ„Å†„Åæ„Å† (Position 40-70, attempts>0): ${L}Ë™û
- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${U}Ë™û
- ‚ö†Ô∏è Ëã¶ÊâãË™ûÂêàË®à (Position‚â•40): ${V}Ë™û

**Ëß£Á≠îÁµ±Ë®à**:
- Á∑èË©¶Ë°åÂõûÊï∞: ${B}Âõû
- Ê≠£Á≠î: ${Y}Âõû
- Ë™§Á≠î: ${pe}Âõû
- ÂÖ®‰ΩìÊ≠£Á≠îÁéá: ${ge}%

**ÈÄ≤ÊçóÁéá**: ${(e/t*100).toFixed(1)}% (${e} / ${t}Âïè)

**progressCacheÂÅ•ÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ**:
- tabPosition Êú™Ë®≠ÂÆö: ${j} / ${I}
- category Êú™Ë®≠ÂÆö: ${P} / ${I}
- lastStudied Êú™Ë®≠ÂÆö: ${O} / ${I}
- ‰∏ªË¶Å„Ç´„Ç¶„É≥„ÉàÊ¨†ÊêçÔºàcorrect/incorrect/streakÔºâ: ${A} / ${I}

---

## üõ†Ô∏è Ëµ∑ÂãïÊôÇ‰øÆÂæ©„É≠„Ç∞Ôºà„Çµ„Éû„É™„ÉºÔºâ

${(()=>{const R=localStorage.getItem("debug_progress_repair_summary");if(!R)return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†loadProgress()„ÅåËµ∞„Å£„Å¶„ÅÑ„Å™„ÅÑ/‰øùÂ≠ò„Åß„Åç„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const D=JSON.parse(R),F=D.timestamp?String(D.timestamp):"-",M=Number(D.categoryAdded??0),X=Number(D.memorizationPositionRepaired??0),ue=!!D.saved;return`**timestamp**: ${F}
**categoryAdded**: ${M}
**memorizationPositionRepaired**: ${X}
**saved**: ${ue?"trueÔºà‰øÆÂæ©„Çí‰øùÂ≠òÔºâ":"falseÔºà‰øÆÂæ©„Å™„Åó or ‰øùÂ≠ò‰∏çË¶ÅÔºâ"}`}catch{return"‚ö†Ô∏è ‰øÆÂæ©„Çµ„Éû„É™„Éº„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"}})()}

---

## üéØ „Ç§„É≥„Çø„Éº„É™„Éº„ÉñË®∫Êñ≠

### PositionÂàÜÂ∏ÉÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ${p.length}Ë™ûÔºâ
${p.length===0?"_Ôºà„Å™„ÅóÔºâ_":`
- **Position 85-100**: ${p.filter(R=>R.position>=85).length}Ë™û
- **Position 70-84**: ${p.filter(R=>R.position>=70&&R.position<85).length}Ë™û
- **Position 40-69**: ${p.filter(R=>R.position>=40&&R.position<70).length}Ë™û

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÇíPosition +15
- ÁµêÊûú: Position 40-55„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰Ωç10Âïè‰∏≠„Å´Ê∑∑ÂÖ•„Åô„Çã„ÅØ„Åö
`}

### Ê¨°10Âïè„ÅÆPositionÂàÜÊûê
**ÂèÇÁÖß**: ${bt}

${yt.map((R,D)=>{const{position:F,attempts:M,status:X}=$t(R);return`${D+1}. **${R}** - Position ${F.toFixed(0)} (${M}Âõû) ${X}`}).join(`
`)}

**ÂïèÈ°åÊ§úÂá∫**:
${ae?"‚ùå **ÂÖ®„Å¶Êñ∞Ë¶èÔºàPosition < 40Ôºâ** ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß":"‚úÖ Êñ∞Ë¶è„Å®„Åæ„Å†„Åæ„Å†„ÅåÊ∑∑Âú® ‚Üí PositionÂàÜÊï£„ÅåÊ©üËÉΩ‰∏≠"}

---

## üéÆ PositionÂàÜÊï£Ë®∫Êñ≠

${m?`**ÂàÜÊï£Ââç**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((oe=m.before)==null?void 0:oe.stillLearning)||0)+(((he=m.before)==null?void 0:he.incorrect)||0)}Ë™û
- Êñ∞Ë¶è: ${((Te=m.before)==null?void 0:Te.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((Se=m.before)==null?void 0:Se.boostable)||0}Ë™û

**ÂàÜÊï£Âæå**:
- „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(((te=m.after)==null?void 0:te.stillLearning)||0)+(((Fe=m.after)==null?void 0:Fe.incorrect)||0)}Ë™û
- Êñ∞Ë¶è (PositionÂºï„Åç‰∏ä„ÅíÂæå): ${((Le=m.after)==null?void 0:Le.new)||0}Ë™û
- Âºï„Åç‰∏ä„ÅíÂÄôË£ú(Position‚â•25): ${((De=m.after)==null?void 0:De.boostable)||0}Ë™û

**PositionÂºï„Åç‰∏ä„Åí**: ${((Ke=m.summary)==null?void 0:Ke.newBoosted)||0}Ë™û ${((pt=m.summary)==null?void 0:pt.working)??!1?"‚úÖ":"‚ùå"}

<details>
<summary>Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${m.changed.slice(0,10).map(R=>"- **"+R.word+"**: "+R.before.toFixed(0)+" ‚Üí "+R.after.toFixed(0)+" (+"+(R.after-R.before).toFixed(0)+")").join(`
`)}

${m.changed.length>10?`
_‚Ä¶‰ªñ`+(m.changed.length-10)+"Ë™û_":""}
</details>`:"‚ö†Ô∏è PositionÂàÜÊï£Ë®∫Êñ≠ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàcalculatePriorities()„ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

### üéØ „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà

${(()=>{try{const R=localStorage.getItem("debug_still_learning_boost");if(!R)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const D=JSON.parse(R);return!D.working||D.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û (Position 40-70, attempts>0) „ÇíÂºï„Åç‰∏ä„Åí**: ${D.boosted}Ë™û ‚úÖ

<details>
<summary>„Éñ„Éº„Çπ„Éà„Åï„Çå„ÅüÂçòË™û„É™„Çπ„Éà (ÊúÄÂàù10‰ª∂)</summary>

${D.changes.slice(0,10).map(F=>{const M=Number(F.after)-Number(F.before);return"- **"+F.word+"**: "+F.before.toFixed(0)+" ‚Üí "+F.after.toFixed(0)+" (+"+(Number.isFinite(M)?M.toFixed(0):"0")+")"}).join(`
`)}

${D.boosted>10?`
_‚Ä¶‰ªñ`+(D.boosted-10)+"Ë™û_":""}
</details>`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

### üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ

${(()=>{const R=Wi(n).slice(0,30);if(R.length===0)return"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const D=R.map(J=>J.attempts>0&&J.position>=40&&J.position<70?"„Åæ„Å†„Åæ„Å†":J.attempts===0&&J.position>=40&&J.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":J.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":J.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),F={„Åæ„Å†„Åæ„Å†:D.filter(J=>J==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:D.filter(J=>J==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:D.filter(J=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(J)).length},M=D.slice(0,20).map(J=>{switch(J){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join(""),X=R.slice(0,15).map((J,de)=>{const me=D[de],Me=me==="„Åæ„Å†„Åæ„Å†"?"üü°":me==="Êñ∞Ë¶è(Âºï‰∏ä)"?"üîµ":me==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"üî¥":me==="ÂÆöÁùÄÊ∏à"?"‚úÖ":"‚ö™";return`${de+1}. ${Me} **${J.word}** (Pos ${J.position.toFixed(0)}, ${J.attempts}Âõû) - ${me}`}).join(`
`);let ue=`**TOP30„ÅÆ„Ç´„ÉÜ„Ç¥„É™ÂàÜÂ∏É**:
- üü° „Åæ„Å†„Åæ„Å†: ${F.„Åæ„Å†„Åæ„Å†}Ë™û
- üîµ Êñ∞Ë¶è(PositionÂºï‰∏ä): ${F.Êñ∞Ë¶èÂºï‰∏ä}Ë™û
- „Åù„ÅÆ‰ªñ: ${F.„Åù„ÅÆ‰ªñ}Ë™û

**„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ** (TOP20):
${M}

**Âá°‰æã**: üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à

<details>
<summary>Ë©≥Á¥∞„É™„Çπ„Éà (TOP15)</summary>

${X}
</details>

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
- „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆ„Çµ„Ç§„ÇØ„É´„Åß‰∫§‰∫íÈÖçÁΩÆ
- ‰æã: üü°üü°üîµüü°üü°üü°üîµüü°üü°üîµ...`;if(F.„Åæ„Å†„Åæ„Å†===0&&F.Êñ∞Ë¶èÂºï‰∏ä===0)ue+=`

‚ö†Ô∏è **„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„Åó**Ôºà„Åæ„Å†„Åæ„Å†Ë™û„ÉªPositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å®„ÇÇ„Å´0Ôºâ`;else if(F.„Åæ„Å†„Åæ„Å†>0&&F.Êñ∞Ë¶èÂºï‰∏ä===0)ue+=`

‚ö†Ô∏è **PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„Å™„Åó** ‚Üí „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else if(F.„Åæ„Å†„Åæ„Å†===0&&F.Êñ∞Ë¶èÂºï‰∏ä>0)ue+=`

‚ö†Ô∏è **„Åæ„Å†„Åæ„Å†Ë™û„Å™„Åó** ‚Üí PositionÂºï„Åç‰∏ä„ÅíÊñ∞Ë¶èË™û„ÅÆ„ÅøÂÑ™ÂÖàÈÖçÁΩÆ`;else{let J=0;for(let de=0;de<D.length-1;de++){const me=D[de],Me=D[de+1];me==="„Åæ„Å†„Åæ„Å†"&&Me==="Êñ∞Ë¶è(Âºï‰∏ä)"&&J++,me==="Êñ∞Ë¶è(Âºï‰∏ä)"&&Me==="„Åæ„Å†„Åæ„Å†"&&J++}J>=3?ue+=`

‚úÖ **‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+J+"ÂõûÔºâ":ue+=`

‚ö†Ô∏è **‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑÂèØËÉΩÊÄß**ÔºàÂàá„ÇäÊõø„ÅàÂõûÊï∞: `+J+"ÂõûÔºâ"}return ue}catch(D){return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº: "+D.message}})()}

---

## ÔøΩÔ∏è PositionÈöéÂ±§Ê§úË®ºÔºà„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÈò≤Ê≠¢Ôºâ

${(()=>{try{const R=localStorage.getItem("debug_position_hierarchy_validation"),D=localStorage.getItem("debug_position_hierarchy_still"),F=localStorage.getItem("debug_position_hierarchy_new");if(!R&&!D&&!F)return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";let M=`**PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂**:
`;M+="```\n",M+=`70-100: ÂàÜ„Åã„Çâ„Å™„ÅÑÔºàÁ¨¨1ÂÑ™ÂÖàÔºâ
`,M+=`60-69:  „Åæ„Å†„Åæ„Å†ÔºàÁ¨¨2ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ‚Üê üîí Âõ∫ÂÆö
`,M+=`40-59:  Êñ∞Ë¶èÔºàÁ¨¨3ÂÑ™ÂÖà„Éª„Éñ„Éº„Çπ„ÉàÂæåÔºâ    ‚Üê üîí Âõ∫ÂÆö
`,M+=`20-39:  Êñ∞Ë¶èÔºàÁ¨¨4ÂÑ™ÂÖà„ÉªÈÄöÂ∏∏Ôºâ
`,M+=`0-19:   ÂÆöÁùÄÊ∏àÔºàÁ¨¨5ÂÑ™ÂÖàÔºâ
`,M+="```\n\n";let X=!1;const ue=[];if(R){const J=JSON.parse(R);J.isValid?(M+=`‚úÖ **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§„ÅåÊ≠£Â∏∏„Åß„Åô
`,M+="  - „Åæ„Å†„Åæ„Å†Ë™ûÔºà60-69ÁØÑÂõ≤ÂÜÖÔºâ: "+J.stillInBoostedZone+`Ë™û
`,M+="  - Êñ∞Ë¶èË™ûÔºà40-59ÁØÑÂõ≤ÂÜÖÔºâ: "+J.newInBoostedZone+`Ë™û

`):(X=!0,M+=`‚ùå **QuestionSchedulerÊ§úË®º**: PositionÈöéÂ±§ÈÅïÂèç„ÇíÊ§úÂá∫
`,M+="  - ÈÅïÂèç‰ª∂Êï∞: "+J.violationCount+`Ë™û
`,ue.push(...J.violations))}if(D){const J=JSON.parse(D);J.violationCount===0?M+="‚úÖ **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: ÂÖ®"+J.totalStill+`Ë™û„ÅåPosition 60-69ÁØÑÂõ≤ÂÜÖ

`:(X=!0,M+=`‚ùå **GamificationAIÔºà„Åæ„Å†„Åæ„Å†Ë™ûÔºâ**: Position 60-69ÁØÑÂõ≤Â§ñ„ÅÆË™û„ÇíÊ§úÂá∫
`,M+="  - ÈÅïÂèç‰ª∂Êï∞: "+J.violationCount+"Ë™ûÔºàÂÖ®"+J.totalStill+`Ë™û‰∏≠Ôºâ
`,ue.push(...J.violations))}if(F){const J=JSON.parse(F);J.violationCount===0?M+="‚úÖ **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: ÂÖ®"+J.totalNew+`Ë™û„ÅåPosition 60Êú™Ê∫Ä

`:(X=!0,M+=`‚ùå **GamificationAIÔºàÊñ∞Ë¶èË™ûÔºâ**: Position 60‰ª•‰∏ä„ÅÆË™û„ÇíÊ§úÂá∫
`,M+="  - ÈÅïÂèç‰ª∂Êï∞: "+J.violationCount+"Ë™ûÔºàÂÖ®"+J.totalNew+`Ë™û‰∏≠Ôºâ
`,ue.push(...J.violations))}return X&&ue.length>0?(M+=`
**üö® ÈÅïÂèç„ÅÆË©≥Á¥∞**:
`,ue.slice(0,10).forEach((J,de)=>{const me=J.type==="new_exceeds_60"?"Êñ∞Ë¶èË™û„ÅåPosition 60‰ª•‰∏ä":J.type==="still_below_60"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 60Êú™Ê∫Ä":J.type==="still_above_70"?"„Åæ„Å†„Åæ„Å†Ë™û„ÅåPosition 70‰ª•‰∏ä":"‰∏çÊòé";M+=de+1+". **"+J.word+"**: Position "+J.position.toFixed(0)+" ‚Üê "+me+`
`}),ue.length>10&&(M+=`
_‚Ä¶‰ªñ`+(ue.length-10)+`‰ª∂_
`),M+=`
**üìñ ÂéüÂõ†„Å®ÂØæÁ≠ñ**:
`,M+=`- „Åì„Çå„ÅØ„Äå„ÅÇ„Å£„Å°„ÇíÁ´ã„Å¶„Çå„Å∞„Åì„Å£„Å°„ÅåÁ´ã„Åü„Åö„ÄçÂïèÈ°å„Åß„Åô
`,M+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÇíÂÑ™ÂÖà„Åï„Åõ„Çã„Åü„ÇÅ„Å´Êñ∞Ë¶èË™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,M+=`- Êñ∞Ë¶èË™û„ÇíÊ∑∑„Åú„Çã„Åü„ÇÅ„Å´„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÈáè„ÇíÂâäÊ∏õ„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü
`,M+=`- PositionÈöéÂ±§„ÅÆ‰∏çÂ§âÊù°‰ª∂Ôºà60-69: „Åæ„Å†„Åæ„Å†„ÄÅ40-59: Êñ∞Ë¶èÔºâ„ÇíÂÆà„Å£„Å¶„Åè„Å†„Åï„ÅÑ
`):X||(M+=`üéâ **PositionÈöéÂ±§„ÅØÂÆåÁíß„Å´ÂÆà„Çâ„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ**
`,M+=`- „Åæ„Å†„Åæ„Å†Ë™û„ÅØÁ¢∫ÂÆü„Å´Êñ∞Ë¶èË™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Åæ„Åô
`,M+=`- Êñ∞Ë¶èË™û„ÅØ„Åæ„Å†„Åæ„Å†Ë™û„ÇíÈÇ™È≠î„Åó„Åæ„Åõ„Çì
`),M}catch(R){return"‚ö†Ô∏è PositionÈöéÂ±§Ê§úË®º„Éá„Éº„Çø„ÅÆËß£Êûê„Ç®„É©„Éº: "+R.message}})()}

---

## ÔøΩüìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞30‰ª∂)

${b.length>0?b.slice(-10).reverse().map((R,D)=>D+1+". **"+R.function+"** "+JSON.stringify(R.params)+" - "+new Date(R.timestamp).toLocaleTimeString()).join(`
`):"‚ö†Ô∏è Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}

---

## üîç sortAndBalance() Âá∫ÂäõÊ§úË®º

**sortAndBalance()Âæå„ÅÆTOP30ÔºàPositionÈôçÈ†Ü„ÇΩ„Éº„ÉàÂæåÔºâ**:
${(()=>{const R=localStorage.getItem("debug_sortAndBalance_output");if(!R)return"‚ö†Ô∏è sortAndBalance()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{return JSON.parse(R).slice(0,30).map((F,M)=>{const X=F.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":F.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":F.position>=40?"üü° „Åæ„Å†„Åæ„Å†":F.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return M+1+". **"+F.word+"** - Position "+(F.position??0).toFixed(0)+" ("+F.attempts+"Âõû) "+X}).join(`
`)}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

**postProcess()Âæå„ÅÆTOP30ÔºàÂÆüÈöõ„ÅÆÂá∫È°å„Ç≠„É•„ÉºÔºâ**:
${(()=>{const R=S9(n),D=Wi(n);return!D||D.length===0?"‚ö†Ô∏è postProcess()„ÅÆÂá∫Âäõ„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì":(R?`
(„É°„Çø) action=${R.action}, interleavedAcrossBands=${!!R.isInterleavedAcrossBands}
`:"")+D.slice(0,30).map((M,X)=>{const ue=M.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":M.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":M.position>=40?"üü° „Åæ„Å†„Åæ„Å†":M.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return X+1+". **"+M.word+"** - Position "+(M.position??0).toFixed(0)+" ("+M.attempts+"Âõû) "+ue}).join(`
`)})()}

**üö® ÈáçË¶Å**: sortAndBalance()„Å®postProcess()„ÅÆÂá∫Âäõ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÄÅpostProcess()„ÅåÈ†ÜÂ∫è„ÇíÁ†¥Â£ä„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ

**üîç „Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞ÂàÜÊûê**:
${(()=>{const R=n,D=t,F=ke=>{if(!ke)return null;try{return JSON.parse(ke)}catch{return null}},M=(ke,ie=!1)=>{const We=ke.filter(Boolean);if(We.length===0)return null;const vt=ft=>{const Ge=typeof ft=="number"?ft:Number(ft);return Number.isFinite(Ge)?Ge:null},dt=ft=>{const Ge=Date.parse(String(ft??""));return Number.isFinite(Ge)?Ge:0};if(ie){const ft=We.filter(at=>String((at==null?void 0:at.mode)??"")===R);if(ft.length===0)return null;const Ge=ft.filter(at=>vt(at==null?void 0:at.questionsCount)===D);return Ge.length>0?(Ge.sort((at,jt)=>dt(jt==null?void 0:jt.timestamp)-dt(at==null?void 0:at.timestamp)),Ge[0]):[...ft].sort((at,jt)=>{const Pt=vt(at==null?void 0:at.questionsCount)??-1,Yt=vt(jt==null?void 0:jt.questionsCount)??-1;return Yt!==Pt?Yt-Pt:dt(jt==null?void 0:jt.timestamp)-dt(at==null?void 0:at.timestamp)})[0]}const st=We.filter(ft=>vt(ft==null?void 0:ft.questionsCount)===D);return st.length>0?(st.sort((ft,Ge)=>dt(Ge==null?void 0:Ge.timestamp)-dt(ft==null?void 0:ft.timestamp)),st[0]):[...We].sort((ft,Ge)=>{const nt=vt(ft==null?void 0:ft.questionsCount)??-1,at=vt(Ge==null?void 0:Ge.questionsCount)??-1;return at!==nt?at-nt:dt(Ge==null?void 0:Ge.timestamp)-dt(ft==null?void 0:ft.timestamp)})[0]},X=`debug_sortAndBalance_top100_history_${R}`,ue=F(localStorage.getItem(X)),J=Array.isArray(ue)?ue:[],de=M(J,!0),me=`debug_sortAndBalance_top100_${R}`,Me=F(localStorage.getItem(me)),Ie=Me&&String((Me==null?void 0:Me.mode)??"")===R?Me:null,tt=F(localStorage.getItem("debug_sortAndBalance_top100")),Z=tt&&String((tt==null?void 0:tt.mode)??"")===R?tt:null,xe=de??Ie??Z??tt;if(!xe)return"‚ö†Ô∏è TOP100„Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì";try{const ke=de?`history:${X}`:Ie?`byMode:${me}`:"legacy:debug_sortAndBalance_top100",ie=Array.isArray(xe==null?void 0:xe.top100)?xe.top100:[],We=Array.isArray(xe==null?void 0:xe.top600)?xe.top600:[],vt=typeof(xe==null?void 0:xe.timestamp)=="string"?xe.timestamp:null,dt=typeof(xe==null?void 0:xe.mode)=="string"?xe.mode:null,st=Number.isFinite(Number(xe==null?void 0:xe.questionsCount))?Number(xe.questionsCount):null,Xt=Number.isFinite(Number(xe==null?void 0:xe.interleavedCount))?Number(xe.interleavedCount):null,ft=Number.isFinite(Number(xe==null?void 0:xe.stillLearningInTop100))?Number(xe.stillLearningInTop100):null,Ge=Number.isFinite(Number(xe==null?void 0:xe.stillLearningInTop600))?Number(xe.stillLearningInTop600):null,at=it().wordProgress||{},jt=Ze=>String(Ze??"").normalize("NFC").replace(/[\s\u00A0]+/g," ").trim(),Pt=Ze=>jt(Ze).toLowerCase(),Yt=new Map;for(const Ze of Object.keys(at)){const He=Pt(Ze);Yt.has(He)||Yt.set(He,Ze)}const mt=Ze=>{const He=jt(Ze);if(!He)return{key:null,wp:null,hit:"empty"};const It=at[He];if(It)return{key:He,wp:It,hit:"direct"};const Gt=He.toLowerCase(),At=at[Gt];if(At)return{key:Gt,wp:At,hit:"lower"};const Et=Pt(He),Rn=Yt.get(Et)??null;return Rn?{key:Rn,wp:at[Rn]??null,hit:"normalized"}:{key:null,wp:null,hit:"miss"}},nn=Ze=>mt(Ze).wp,Mt=(Ze,He=0)=>{const It=typeof Ze=="number"?Ze:Number(Ze);return Number.isFinite(It)?It:He},Xe=(Ze,He)=>{const It=nn(Ze);if(It){const Gt=Mt(It==null?void 0:It.memorizationAttempts,NaN);if(Number.isFinite(Gt))return Gt}return Mt(He,0)},$e=(Ze,He)=>{const It=nn(Ze);if(It){const Gt=Mt(Ut(It,n),NaN);if(Number.isFinite(Gt))return Gt}return Mt(He,0)},Oe=ie.filter(Ze=>{const He=String(Ze.word??""),It=$e(He,Ze.position),Gt=Xe(He,Ze.attempts);return It>=40&&It<70&&Gt>0}),ht=We.filter(Ze=>{const He=String(Ze.word??""),It=$e(He,Ze.position),Gt=Xe(He,Ze.attempts);return It>=40&&It<70&&Gt>0}),se=We.filter(Ze=>{const He=String(Ze.word??""),It=$e(He,Ze.position),Gt=Xe(He,Ze.attempts);return It===50&&Gt===0}).length;let Ne="";vt&&(Ne+=`üïí **snapshot timestamp**: ${vt}

`),Ne+=`üß≠ **snapshot selectedFrom**: ${ke}

`,Ne+=`**üì¶ snapshot meta**
`,Ne+=`- mode: ${dt??"-"}
`,Ne+=`- questionsCount: ${st??"-"}
`,Ne+=`- interleavedCount: ${Xt??"-"}
`,Ne+=`- top100Count: ${ie.length}
`,Ne+=`- top600Count: ${We.length}
`,Ne+=`- stillLearningInTop100 (snapshot): ${ft??"-"}
`,Ne+=`- stillLearningInTop600 (snapshot): ${Ge??"-"}

`,dt&&dt!==R&&(Ne+=`‚ö†Ô∏è **„É¢„Éº„Éâ‰∏ç‰∏ÄËá¥**: „Åì„ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅØ \`${dt}\` „Åß„Åô„ÄÇÊöóË®ò„Çø„Éñ„ÅÆÂàÜÊûê„Å´„ÅØ \`${R}\` „ÅÆ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ
‚Üí translation/spellingÁ≠â„ÅÆ„Äå30Âïè„ÉÜ„Çπ„ÉàÂÆüË°å„Äç„Åå‰∏äÊõ∏„Åç„Åó„Å¶„ÇÇÂ£ä„Çå„Å™„ÅÑ„Çà„ÅÜ„ÄÅmodeÂà•„Ç≠„Éº„ÇíË™≠„ÅøÂèñ„Çã„Çà„ÅÜ„Å´‰øÆÊ≠£Ê∏à„Åø„Åß„Åô„ÄÇ

`);const Be={direct:0,lower:0,normalized:0,miss:0,empty:0};for(const Ze of ie){const He=String((Ze==null?void 0:Ze.word)??""),It=mt(He);Be[It.hit]=(Be[It.hit]||0)+1}Ne+=`**üîë progressCacheÁÖßÂêàÔºàTOP100Ôºâ**
`,Ne+=`- direct: ${Be.direct}
`,Ne+=`- lower: ${Be.lower}
`,Ne+=`- normalized: ${Be.normalized}
`,Ne+=`- miss: ${Be.miss}

`;const rt=cp(n),ot=new Set(rt.map(Ze=>Pt(Ze.word))),Qe=new Set(ie.map(Ze=>Pt(String((Ze==null?void 0:Ze.word)??"")))),Ft=[];for(const Ze of ot)Qe.has(Ze)&&Ft.push(Ze);if(Ne+=`**üü° Ëã¶ÊâãË™û√óTOP100ÔºàÊöóË®òSSOTÔºâ**
`,Ne+=`- strugglingWords: ${rt.length}
`,Ne+=`- inTop100: ${Ft.length}

`,ie.length===0&&(Ne+=`‚ö†Ô∏è TOP100ÈÖçÂàó„ÅåÁ©∫„Åß„ÅôÔºàÂè§„ÅÑ/Â£ä„Çå„Åü„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„ÅÆÂèØËÉΩÊÄßÔºâ

`),se>0?Ne+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: ${se}Ë™ûÔºà„Åì„Çå„Åå„Åæ„Å†„Åæ„Å†Ë™û„Çà„ÇäÂÑ™ÂÖà„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄßÔºâ

`:Ne+=`üìä **Position 50„ÅÆÊñ∞Ë¶è**: 0Ë™ûÔºàË©≤ÂΩì„Å™„ÅóÔºâ

`,Oe.length===0){if(Ne+=`‚ùå **„Åæ„Å†„Åæ„Å†Ë™ûÔºàPosition 40-70, attempts>0Ôºâ„ÅåTOP100„Å´1„Å§„ÇÇÂÖ•„Å£„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ**
`,ie.length>0){const Ze=ie.slice(0,10).map(He=>{const It=String(He.word??""),Gt=mt(It),At=!!Gt.wp,Et=Xe(It,He.attempts),Rn=$e(It,He.position),Ce=Mt(He.attempts,0),Ve=Mt(He.position,0);return{word:It,matchedKey:Gt.key,hitType:Gt.hit,cacheHit:At,usedPos:Rn,usedAttempts:Et,snapshotPos:Ve,snapshotAttempts:Ce}});Ne+=`
**üß™ Âà§ÂÆö„Éá„Éê„ÉÉ„Ç∞ÔºàTOP10„Çµ„É≥„Éó„É´Ôºâ**
`+Ze.map((He,It)=>{const Gt=He.cacheHit?He.hitType:"miss",At=He.matchedKey?` key:${He.matchedKey}`:"";return`${It+1}. ${He.word} | cache:${Gt}${At} | pos used:${He.usedPos} (snap:${He.snapshotPos}) | attempts used:${He.usedAttempts} (snap:${He.snapshotAttempts})`}).join(`
`)+`
`}}else Ne+="‚úÖ „Åæ„Å†„Åæ„Å†Ë™û„Åå**"+Oe.length+`Ë™û**„ÄÅTOP100ÂÜÖ„Å´„ÅÇ„Çä„Åæ„Åô:
`+Oe.slice(0,10).map(Ze=>{const He=String(Ze.word??""),It=Xe(He,Ze.attempts),Gt=$e(He,Ze.position);return`${Ze.rank??""}‰Ωç: ${He} (Position ${Gt}, ${It}Âõû)`}).join(`
`)+(Oe.length>10?`
_‚Ä¶‰ªñ`+(Oe.length-10)+"Ë™û_":"")+`

`;return We.length===0?Ne+="‚ö†Ô∏è TOP600ÈÖçÂàó„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàÊúÄÊñ∞„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É©Âá∫ÂäõÂæÖ„Å°Ôºâ":ht.length>0?(Ne+="üìç **TOP600ÂÜÖ„ÅÆ„Åæ„Å†„Åæ„Å†Ë™û**: "+ht.length+`Ë™û
`,Ne+=ht.slice(0,5).map(Ze=>{const He=String(Ze.word??""),It=Xe(He,Ze.attempts),Gt=$e(He,Ze.position);return`${Ze.rank??""}‰Ωç: ${He} (Position ${Gt}, ${It}Âõû)`}).join(`
`),ht.length>5&&(Ne+=`
_‚Ä¶‰ªñ`+(ht.length-5)+"Ë™û_")):Ne+="‚ùå **TOP600ÂÜÖ„Å´„ÇÇ„Åæ„Å†„Åæ„Å†Ë™û„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì**",se>0&&Oe.length===0&&(Ne+=`

**üö® ÁµêË´ñ**: Position 50„ÅÆÊñ∞Ë¶è`+se+`Ë™û„ÅåÂÖàË°å„Åó„ÄÅ„Åæ„Å†„Åæ„Å†Ë™û„ÅåÊäº„ÅóÂá∫„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô
`,Ne+="‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅßÊñ∞Ë¶è„ÅåÂÑ™ÂÖà„Åï„Çå„ÄÅ„Åæ„Å†„Åæ„Å†„Åå"+(se+1)+"‰Ωç‰ª•Èôç„Å´ËøΩ„ÅÑ„ÇÑ„Çâ„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß"),Ne}catch{return"‚ö†Ô∏è „Éá„Éº„ÇøËß£Êûê„Ç®„É©„Éº"}})()}

---

### üéØ ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÂÜÖPositionÂàÜÂ∏ÉÔºà„É™„Ç¢„É´„Çø„Ç§„É†Ôºâ

${(()=>{if(!s||s.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const R=s.slice(e);if(R.length===0)return"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ";const D=it(),F=Ie=>{if(!Ie)return 0;switch(n){case"memorization":return Ie.memorizationAttempts??0;case"translation":return Ie.translationAttempts??0;case"spelling":return Ie.spellingAttempts??0;case"grammar":return Ie.grammarAttempts??0;default:return Ie.totalAttempts??0}},M=R.map(Ie=>{const tt=String(Ie.word??""),Z=D.wordProgress[tt],xe=Number.isFinite(Ie.position)?Ie.position:null;if(Z){const ke=Ut(Z,n);return{...Ie,position:ke,_originalPosition:xe,_wpMissing:!1,_attempts:F(Z)}}return{...Ie,position:35,_originalPosition:xe,_wpMissing:!0,_attempts:0}}),X=M.filter(Ie=>{if(!Number.isFinite(Ie._originalPosition))return!1;const tt=Ie._originalPosition,Z=Ie.position??0;return Math.abs(tt-Z)>5}).slice(0,20);let ue="**üìä Êú™Âá∫È°å„Ç≠„É•„ÉºÂàÜÊûêÔºàÊÆã„Çä"+R.length+`ÂïèÔºâ**:

`;X.length>0&&(ue+="üö® **Position‰∏çÊï¥ÂêàÊ§úÂá∫**: "+X.length+`Ë™û
`,ue+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåLocalStorage„Å®‰∏ÄËá¥„Åó„Åæ„Åõ„ÇìÔºÅ

`,ue+=`**‰∏çÊï¥Âêà„É™„Çπ„ÉàÔºàÂ∑ÆÂàÜ‚â•5Ôºâ**:
`,ue+=X.map(Ie=>{const tt=Ie._originalPosition??0,Z=Ie.position??0,xe=Z-tt,ke=Z>=70?"üî¥":Z>=40?"üü°":"‚ö™",ie=xe>0?"üî∫":xe<0?"üîª":"‚Üí";return"  "+ke+" **"+Ie.word+"**: "+tt+" "+ie+" "+Z+" (Â∑ÆÂàÜ: "+(xe>0?"+":"")+xe+")"}).join(`
`),ue+=`

**ÂéüÂõ†ÂÄôË£ú**:
`,ue+=`- questionsÈÖçÂàó„ÅåÂè§„ÅÑ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åã„Çâ‰ΩúÊàê„Åï„Çå„Åü
`,ue+=`- Ëß£Á≠îÂæå„Å´Position„ÅåÊõ¥Êñ∞„Åï„Çå„Åü„Åå„ÄÅ„Ç≠„É•„Éº„Å´ÂèçÊò†„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ
`,ue+=`- QuestionScheduler„ÅÆÂëº„Å≥Âá∫„Åó„Çø„Ç§„Éü„É≥„Ç∞„Åå‰∏çÈÅ©Âàá

`);const J={incorrect:M.filter(Ie=>(Ie.position??0)>=70),stillLearning:M.filter(Ie=>{const tt=Ie.position??0,Z=Ie._attempts??0;return tt>=40&&tt<70&&Z>0}),newBoosted:M.filter(Ie=>{const tt=Ie.position??0,Z=Ie._attempts??0;return tt>=40&&tt<60&&Z===0}),newNormal:M.filter(Ie=>{const tt=Ie.position??0;return tt>=20&&tt<40}),mastered:M.filter(Ie=>(Ie.position??0)<20)};ue+=`**PositionÂà•ÂÜÖË®≥**:
`,ue+="- üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑÔºà70-100Ôºâ: "+J.incorrect.length+`Ë™û
`,ue+="- üü° „Åæ„Å†„Åæ„Å†Ôºà40-69, attempts>0Ôºâ: "+J.stillLearning.length+`Ë™û
`,ue+="- üîµ Êñ∞Ë¶èÂºï‰∏äÔºà40-59, attempts=0Ôºâ: "+J.newBoosted.length+`Ë™û
`,ue+="- ‚ö™ Êñ∞Ë¶èÈÄöÂ∏∏Ôºà20-39Ôºâ: "+J.newNormal.length+`Ë™û
`,ue+="- ‚úÖ ÂÆöÁùÄÊ∏àÔºà0-19Ôºâ: "+J.mastered.length+`Ë™û

`;const de=M.slice(0,30),me=de.filter(Ie=>(Ie.position??0)>=40);ue+=`**Ê¨°„ÅÆ30Âïè„ÅÆÊßãÊàê**:
`,ue+="- È´òPositionË™ûÔºà‚â•40Ôºâ: "+me.length+"Ë™û / "+de.length+`Âïè
`,ue+="- Ââ≤Âêà: "+(me.length/de.length*100).toFixed(1)+`%

`,me.length>0?(ue+=`**Ê¨°„ÅÆ30ÂïèÂÜÖ„ÅÆÈ´òPositionË™û**ÔºàLocalStorageÂÜçË®àÁÆóÊ∏à„ÅøÔºâ:
`,ue+=me.slice(0,10).map((Ie,tt)=>{const Z=Ie.position??0,xe=Ie._originalPosition,ke=Z>=70?"üî¥":"üü°",ie=Z>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":"„Åæ„Å†„Åæ„Å†",We=Ie.reAddedCount>0?" üîÑ√ó"+Ie.reAddedCount:"",vt=xe!==void 0&&xe!==Z?" (ÂÖÉ:"+xe+")":"";return"  "+ke+" "+Ie.word+" (Pos "+Z+vt+", "+ie+")"+We}).join(`
`),me.length>10&&(ue+=`
  _...‰ªñ`+(me.length-10)+"Ë™û_")):ue+="‚ö†Ô∏è Ê¨°„ÅÆ30Âïè„Å´È´òPositionË™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºàLocalStorageÂÜçË®àÁÆóÂæåÔºâ„ÄÇ";const Me=J.incorrect.length+J.stillLearning.length;return Me>10&&me.length<5?(ue+=`

‚ùå **Ë≠¶Âëä**: È´òPositionË™û„Åå`+Me+"Ë™ûÂ≠òÂú®„Åó„Åæ„Åô„Åå„ÄÅÊ¨°„ÅÆ30Âïè„Å´„ÅØ"+me.length+"Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ",ue+=`
‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØ„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„Åå‰∏çÂçÅÂàÜ„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`):Me>0&&me.length>=Math.min(Me,15)&&(ue+=`

‚úÖ **ËâØÂ•Ω**: È´òPositionË™û„ÅåÈÅ©Âàá„Å´ÂâçÊñπ„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`),ue})()}

---

## üîÑ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Áä∂ÊÖãË®∫Êñ≠

${(()=>{var tt;it();const R=JSON.parse(localStorage.getItem("debug_function_calls")||"[]"),D=JSON.parse(localStorage.getItem("debug_answer_logs")||"[]"),F=JSON.parse(localStorage.getItem("debug_reschedule_events")||"[]"),M=Z=>{const xe=(Z==null?void 0:Z.function)??(Z==null?void 0:Z.name)??(Z==null?void 0:Z.functionName)??"unknown",ke=(Z==null?void 0:Z.params)??(Z==null?void 0:Z.args)??(Z==null?void 0:Z.parameters)??null,ie=(Z==null?void 0:Z.timestamp)??null;return{name:xe,params:ke,ts:ie}},X=Array.isArray(R)?R.map(M):[],ue=Array.isArray(F)?F:[],J=X.filter(Z=>Z.name==="sortAndBalance").slice(-1)[0],de=ue.filter(Z=>(Z==null?void 0:Z.mode)===n&&(Z==null?void 0:Z.phase)==="triggered").slice(-1)[0],me=ue.filter(Z=>(Z==null?void 0:Z.mode)===n&&(Z==null?void 0:Z.phase)==="applied").slice(-1)[0],Me=D.slice(-1)[0];let Ie=`**üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÁîüÊàêÊÉÖÂ†±**:
`;if(Ie+=`
**üîÑ ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É´Ôºàdebug_reschedule_eventsÔºâ**:
`,me){const Z=new Date(me.timestamp).toLocaleTimeString("ja-JP");if(Ie+=`- ÊúÄÂæå„ÅÆÈÅ©Áî®: ${Z} (${me.reason||"ÁêÜÁî±„Å™„Åó"})
`,me.details){const xe=me.details.remainingBefore,ke=me.details.remainingAfter;(xe!=null||ke!=null)&&(Ie+=`- ÊÆã„Çä„Ç≠„É•„Éº: ${xe??"‰∏çÊòé"} ‚Üí ${ke??"‰∏çÊòé"}
`)}}else Ie+=`- „Åæ„Å†ÈÅ©Áî®„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
`;if(de){const Z=new Date(de.timestamp).toLocaleTimeString("ja-JP");Ie+=`- ÊúÄÂæå„ÅÆ„Éà„É™„Ç¨„Éº: ${Z} (${de.reason||"ÁêÜÁî±„Å™„Åó"})
`}if(Ie+=`
`,J){const Z=new Date(J.ts).toLocaleTimeString("ja-JP");Ie+="- ÊúÄÂæå„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞: "+Z+`
`,Ie+="- ÂïèÈ°åÊï∞: "+(((tt=J.params)==null?void 0:tt.questionsCount)||"‰∏çÊòé")+`Âïè
`}else Ie+=`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Â±•Ê≠¥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì
`;if(Me){const Z=new Date(Me.timestamp).toLocaleTimeString("ja-JP");Ie+="- ÊúÄÂæå„ÅÆËß£Á≠î: "+Z+" ("+Me.word+`)
`,Ie+="- PositionÂ§âÂåñ: "+Me.positionBefore+" ‚Üí "+Me.positionAfter+`
`}if(Ie+=`
`,J&&Me){const Z=new Date(J.ts).getTime();if(new Date(Me.timestamp).getTime()>Z){const ke=D.filter(We=>new Date(We.timestamp).getTime()>Z).length;Ie+="üö® **Ë≠¶Âëä**: „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´"+ke+`ÂõûËß£Á≠î„Åï„Çå„Åæ„Åó„Åü
`,Ie+=`‚Üí questionsÈÖçÂàó„ÅÆPosition„ÅåÂè§„Åè„Å™„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„ÅåÈ´ò„ÅÑ„Åß„ÅôÔºÅ

`;const ie=D.filter(We=>new Date(We.timestamp).getTime()>Z&&Math.abs(We.positionAfter-We.positionBefore)>=10).slice(-10);ie.length>0&&(Ie+=`**„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÂ§ßÂπÖÂ§âÂåñÔºà¬±10‰ª•‰∏äÔºâ**:
`,Ie+=ie.map(We=>{const vt=We.positionAfter-We.positionBefore;return"  "+(vt>0?"üî∫":"üîª")+" "+We.word+": "+We.positionBefore+" ‚Üí "+We.positionAfter+" ("+(vt>0?"+":"")+vt+")"}).join(`
`),Ie+=`

`),Ie+=`**Êé®Â•®ÂØæÂøú**:
`,Ie+=`- ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÇíÂÆüË°åÔºà„Éá„Éº„Çø„ÇΩ„Éº„ÇπÈÅ∏Êäû„Çí„ÇÑ„ÇäÁõ¥„ÅôÔºâ
`,Ie+=`- „Åæ„Åü„ÅØ„ÄÅuseQuestionRequeu„ÅÆPosition-awareÊ©üËÉΩ„ÅåËá™ÂãïË™øÊï¥„Åó„Åæ„Åô
`}else Ie+=`‚úÖ „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„ÅØÊúÄÊñ∞„Åß„ÅôÔºàËß£Á≠îÂæå„Å´ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Ê∏à„ÅøÔºâ
`}return Ie})()}

---

## üß† finalPriority„É¢„Éº„ÉâÔºàvariant CÔºâ„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà

${(()=>{const R=localStorage.getItem(`debug_finalPriority_output_${n}`)||localStorage.getItem("debug_finalPriority_output"),D=localStorage.getItem(`debug_finalPriority_sessionStats_${n}`)||localStorage.getItem("debug_finalPriority_sessionStats");if(!R&&!D)return"‚ö†Ô∏è finalPriority„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºàfinalPriorityMode„ÅåÊú™‰ΩøÁî® or „Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÔºâ";let F="";if(D)try{const M=JSON.parse(D);F+=`**currentTab**: ${M.currentTab}
`,F+=`**allProgressCount**: ${M.allProgressCount}
`,F+=`**totalQuestions**: ${M.totalQuestions}
`,F+=`**timestamp**: ${M.timestamp}

`,F+=`**aiSessionStats**: ${JSON.stringify(M.aiSessionStats)}

`}catch{F+=`‚ö†Ô∏è sessionStatsËß£Êûê„Å´Â§±Êïó

`}if(!R)return F+"‚ö†Ô∏è debug_finalPriority_output „Åå„ÅÇ„Çä„Åæ„Åõ„Çì";try{const M=JSON.parse(R);if(!Array.isArray(M)||M.length===0)return F+"‚ö†Ô∏è finalPriority TOP„ÅåÁ©∫„Åß„Åô";const X=`| # | ÂçòË™û | finalPriority | position | attempts | category |
|---|------|--------------|----------|----------|----------|
`+M.slice(0,30).map(ue=>{const J=Number(ue.finalPriority??0),de=Number(ue.position??0),me=Number(ue.attempts??0),Me=ue.category??"";return`| ${ue.rank??""} | **${ue.word}** | ${J.toFixed(3)} | ${de.toFixed(0)} | ${me} | ${Me} |`}).join(`
`);return F+X}catch{return F+"‚ö†Ô∏è finalPriorityËß£Êûê„Å´Â§±Êïó"}})()}

---

## üìù Ëß£Á≠îÂá¶ÁêÜ„É≠„Ç∞ (ÊúÄÊñ∞10‰ª∂)
${x.length>0?x.map((R,D)=>{var We;const M=Math.abs(R.positionAfter-R.positionBefore)>1?R.positionAfter>R.positionBefore?"üî∫":"üîª":"‚Üí",ue=(We=it().wordProgress)==null?void 0:We[R.word],J=(()=>{if(!ue)return{attempts:0,correct:0,stillLearning:0,incorrect:0};const vt=(()=>{switch(R.mode){case"memorization":return ue.memorizationAttempts??0;case"translation":return ue.translationAttempts??0;case"spelling":return ue.spellingAttempts??0;case"grammar":return ue.grammarAttempts??0;default:return ue.totalAttempts??0}})(),dt=(()=>{switch(R.mode){case"memorization":return ue.memorizationCorrect??0;case"translation":return ue.translationCorrect??0;case"spelling":return ue.spellingCorrect??0;case"grammar":return ue.grammarCorrect??0;default:return ue.correctCount??0}})(),st=R.mode==="memorization"?ue.memorizationStillLearning??0:0,Xt=vt-dt-st;return{attempts:vt,correct:dt,stillLearning:st,incorrect:Xt}})(),de=(()=>{var ft,Ge,nt;const vt=Number(((ft=R.progress)==null?void 0:ft.modeAttempts)??0),dt=Number(((Ge=R.progress)==null?void 0:Ge.modeCorrect)??0),st=Number(((nt=R.progress)==null?void 0:nt.modeStillLearning)??0),Xt=vt-dt-st;return{attempts:vt,correct:dt,stillLearning:st,incorrect:Xt}})(),me=J.correct!==de.correct||J.stillLearning!==de.stillLearning||J.incorrect!==de.incorrect,Me=" | **ÂÆüÈöõ„ÅÆLS**: Ê≠£Ëß£"+J.correct+"/„Åæ„Å†„Åæ„Å†"+J.stillLearning+"/Ë™§Á≠î"+J.incorrect+" (Ë®à"+J.attempts+"Âõû)"+(me?" ‚ö†Ô∏è**‰∏ç‰∏ÄËá¥**":""),Ie=R.savedPositionDebug,tt=Ie==null?void 0:Ie.savedPosition,Z=Ie==null?void 0:Ie.decision,xe=Ie==null?void 0:Ie.reason,ke=R.positionWithSavedPosition,ie=tt!==void 0||ke!==void 0?" | **savedPosition**: "+(tt??"-")+" | **calc(savedÊúâ„Çä)**: "+(ke??"-")+" | **calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå)**: "+(R.positionAfter??"-")+(Z?" | **savedÂà§ÂÆö**: "+Z+(xe?" ("+xe+")":""):""):"";return D+1+". **"+R.word+"**: Position "+R.positionBefore.toFixed(0)+" "+M+" "+R.positionAfter.toFixed(0)+" ("+R.category+") [„É≠„Ç∞(mode): Ê≠£Ëß£"+de.correct+"/„Åæ„Å†„Åæ„Å†"+de.stillLearning+"/Ë™§Á≠î"+de.incorrect+"]"+Me+ie}).join(`
`):"‚ö†Ô∏è Ëß£Á≠î„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†Ëß£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ"}

---

## üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (${p.length}Ë™û)

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„ÅÆË°®„ÅØ**LocalStorage„ÅÆÁîüPosition„Éá„Éº„Çø**„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
GamificationAI„Å´„Çà„Çã„Éñ„Éº„Çπ„ÉàÂæå„ÅÆPositionÔºà„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÊôÇÔºâ„ÅØ„ÄÅÊ¨°„ÅÆ„Äå„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„Éà„Äç„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

| # | ÂçòË™û | Position (LS) | Áä∂ÊÖã | Ë©¶Ë°åÂõûÊï∞ | ÊúÄÁµÇÂ≠¶Áøí | ÈÄ£Á∂öË™§Á≠î |
|---|------|---------------|------|----------|----------|----------|
${p.slice(0,30).map((R,D)=>{var de;const F=R.lastStudied?new Date(R.lastStudied).toLocaleDateString():"-",M=R.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†",ue=(de=it().wordProgress)==null?void 0:de[R.word],J=(ue==null?void 0:ue.consecutiveIncorrect)??0;return`| ${D+1} | **${R.word}** | ${R.position.toFixed(0)} | ${M} | ${R.attempts}Âõû | ${F} | ${J}Âõû |`}).join(`
`)}

_‚Ä¶‰ªñ${Math.max(0,p.length-30)}Ë™ûÁúÅÁï•_

### üìä „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„ÅÆPositionÔºà„Éñ„Éº„Çπ„ÉàÂæåÔºâ

${(()=>{try{const R=localStorage.getItem("debug_still_learning_boost");if(!R)return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";const D=JSON.parse(R);return!D.working||D.boosted===0?"‚ùå „Åæ„Å†„Åæ„Å†Ë™û„Åå0Ë™û ‚Üí „Éñ„Éº„Çπ„Éà„Å™„Åó":`**„Åæ„Å†„Åæ„Å†Ë™û„ÅÆ„Éñ„Éº„Çπ„ÉàÁµêÊûú**: ${D.boosted}Ë™û„Åå Position 60-69 „Å´Âºï„Åç‰∏ä„Åí ‚úÖ

| # | ÂçòË™û | Before | After | Â¢óÂä†Èáè |
|---|------|--------|-------|--------|
${D.changes.slice(0,20).map((F,M)=>`| ${M+1} | **${F.word}** | ${F.before.toFixed(0)} | ${F.after.toFixed(0)} | +${(F.after-F.before).toFixed(0)} |`).join(`
`)}

${D.changes.length>20?"_‚Ä¶‰ªñ"+(D.changes.length-20)+"Ë™û_":""}

**üéØ ÈáçË¶Å**: „Åì„ÅÆË°®„ÅÆ„ÄåAfter„Äç„Ç´„É©„É†„Åå„ÄÅÂÆüÈöõ„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Åß‰Ωø„Çè„Çå„ÇãPositionÂÄ§„Åß„Åô„ÄÇ`}catch{return"‚ö†Ô∏è „Åæ„Å†„Åæ„Å†Ë™û„Éñ„Éº„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó"}})()}

---

## üìã postProcess()Âæå„ÅÆTOP30Ôºà„Çπ„Éä„ÉÉ„Éó„Ç∑„Éß„ÉÉ„ÉàÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: **debug_postProcess_output** „ÅØ **postProcess()Âæå„ÅÆTOP30„ÅÆ„Åø**„Çí‰øùÂ≠ò„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÁèæÂú®‰ΩçÁΩÆÔºàcurrentIndexÔºâ„Å´ËøΩÂæì„Åô„Çã„ÄåÊ¨°„ÅÆ30Âïè„Äç„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ

${(()=>{const R=Wi(n);return!R||R.length===0?`‚ö†Ô∏è „Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÁµêÊûú„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

**ÂÖÉ„ÅÆJSONÈ†ÜÂ∫èÔºàÂèÇËÄÉÊÉÖÂ†±„ÅÆ„ÅøÔºâ**:
`+s.slice(e+1,e+31).map((D,F)=>{var me;const X=(me=it().wordProgress)==null?void 0:me[D.word],ue=X?Ut(X,n):35,J=(()=>{if(!X)return 0;switch(n){case"memorization":return X.memorizationAttempts??0;case"translation":return X.translationAttempts??0;case"spelling":return X.spellingAttempts??0;case"grammar":return X.grammarAttempts??0;default:return X.totalAttempts??0}})(),de=J===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":ue>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ue>=40?"üü° „Åæ„Å†„Åæ„Å†":ue>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(F+1)+" | "+(e+F+2)+"ÂïèÁõÆ | **"+D.word+"** | "+ue.toFixed(0)+" | "+J+"Âõû | "+(D.difficulty||"unknown")+" | "+de+" |"}).join(`
`):`| # | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Áä∂ÊÖã |
|---|------|----------|----------|------|
`+R.map((D,F)=>{const M=D.attempts===0?"‚ö™ Êñ∞Ë¶è(Êú™Âá∫È°å)":D.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":D.position>=40?"üü° „Åæ„Å†„Åæ„Å†":D.position>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return"| "+(F+1)+" | **"+D.word+"** | "+(D.position??0).toFixed(0)+" | "+D.attempts+"Âõû | "+M+" |"}).join(`
`)})()}

---

## üìã ÁèæÂú®„ÅÆ„Ç≠„É•„ÉºÔºöÊ¨°„ÅÆÂá∫È°å‰∫àÂÆö (30ÂïèÔºâ

**‚ö†Ô∏è ÈáçË¶Å**: „Åì„Çå„ÅØ„Äå„ÅÑ„Åæ‰øùÊåÅ„Åó„Å¶„ÅÑ„Çã„Ç≠„É•„ÉºÔºàquestionsÔºâ„Äç„ÅÆ„ÄåcurrentIndex+1..+30„Äç„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ
Position„ÅØ LocalStorage „Åã„ÇâÂÜçË®àÁÆó„Åó„ÅüÂÄ§„Åß„ÅôÔºàdetermineWordPosition()Ôºâ„ÄÇ

${(()=>{if(!s||s.length===0)return"‚ö†Ô∏è „Ç≠„É•„Éº„ÅåÁ©∫„Åß„Åô„ÄÇ";const R=it(),D=s.slice(e+1,e+31);return D.length===0?"‚úÖ „Åô„Åπ„Å¶„ÅÆÂïèÈ°å„ÅåÂá∫È°åÊ∏à„Åø„Åß„Åô„ÄÇ":`| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
`+D.map((F,M)=>{var Ie;const X=String((F==null?void 0:F.word)??""),ue=(Ie=R.wordProgress)==null?void 0:Ie[X],J=ue?Ut(ue,n):35,de=(()=>{if(!ue)return 0;switch(n){case"memorization":return ue.memorizationAttempts??0;case"translation":return ue.translationAttempts??0;case"spelling":return ue.spellingAttempts??0;case"grammar":return ue.grammarAttempts??0;default:return ue.totalAttempts??0}})(),me=(F==null?void 0:F.difficulty)??"‰∏çÊòé",Me=de===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":J>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":J>=40?"üü° „Åæ„Å†„Åæ„Å†":J>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return`| ${M+1} | ${e+M+2}ÂïèÁõÆ | **${X}** | ${J.toFixed(0)} | ${de}Âõû | ${me} | ${Me} |`}).join(`
`)})()}

**üîç ÂàÜÊûê**:
- „Åæ„Å†„Åæ„Å†(Position 45)„Åå‰∏ä‰Ωç„Å´Êù•„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 50„ÅÆÂºï„Åç‰∏ä„ÅíÂçòË™û„ÅåÊ∑∑ÂÖ•„Åó„Å¶„ÅÑ„Çã„ÅãÔºü ‚Üí ‚úÖ Ê≠£Â∏∏
- Position 0„ÅÆÊñ∞Ë¶è„Åå‰∏ä‰ΩçÁã¨Âç†„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÔºü ‚Üí ‚ùå ÂïèÈ°å„ÅÇ„Çä

---

## üìã ÊÆã„Çä„Ç≠„É•„ÉºÔºàLocalStorage PositionÈôçÈ†Ü TOP30Ôºâ

„Åì„ÅÆË°®Á§∫„ÅØ„ÄÅÊÆã„ÇäÂïèÈ°å„Çí LocalStorage „ÅÆÁîüPosition„Åß **ÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„ÅüTOP30** „Åß„ÅôÔºàÂèÇËÄÉÔºâ„ÄÇ

| # | ÂïèÈ°å‰ΩçÁΩÆ | ÂçòË™û | Position | Âá∫È°åÂõûÊï∞ | Èõ£ÊòìÂ∫¶ | Áä∂ÊÖã |
|---|----------|------|----------|----------|--------|------|
${(()=>{const R=it();return s.slice(e+1).map(F=>{var Me;const M=F==null?void 0:F.word,X=(Me=R.wordProgress)==null?void 0:Me[M],ue=X?Ut(X,n):35,J=(()=>{if(!X)return 0;switch(n){case"memorization":return X.memorizationAttempts??0;case"translation":return X.translationAttempts??0;case"spelling":return X.spellingAttempts??0;case"grammar":return X.grammarAttempts??0;default:return X.totalAttempts??0}})(),de=(F==null?void 0:F.difficulty)??"‰∏çÊòé",me=J===0?"‚ö™ Êñ∞Ë¶èÔºàÊú™Âá∫È°åÔºâ":ue>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":ue>=40?"üü° „Åæ„Å†„Åæ„Å†":ue>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄ";return{word:M,position:ue,attempts:J,difficulty:de,status:me,originalQuestion:F}}).sort((F,M)=>M.position-F.position).slice(0,30).map((F,M)=>`| ${M+1} | - | **${F.word}** | ${F.position.toFixed(0)} | ${F.attempts}Âõû | ${F.difficulty} | ${F.status} |`).join(`
`)})()}

---

## ü§ñ AIË©ï‰æ°Â±•Ê≠¥ (ÊúÄÊñ∞${Math.max(c.length,20)}‰ª∂)

${le}

---

## üìä Áµ±Ë®à„Çµ„Éû„É™„Éº

- **Á∑èÂïèÈ°åÊï∞**: ${t}Âïè
- **ÁèæÂú®ÈÄ≤Êçó**: ${((e+1)/t*100).toFixed(1)}%
- **LocalStorage‰øùÂ≠ò‰∏≠Ôºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÔºâ**: ${p.length}Ë™û
  - ÂàÜ„Åã„Çâ„Å™„ÅÑ (Position‚â•70): ${p.filter(R=>R.position>=70).length}Ë™û
  - „Åæ„Å†„Åæ„Å† (Position‚â•40): ${p.filter(R=>R.position>=40&&R.position<70).length}Ë™û
- **Ê¨°30Âïè‰∏≠„ÅÆÁä∂ÊÖãÂà•**Ôºà„Ç≠„É•„ÉºÈ†ÜÔºèPosition„ÅØLocalStorage„Åã„ÇâÂÜçË®àÁÆóÔºâ:
  - üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ: ${(()=>{const R=it();return s.slice(e+1,e+31).filter(F=>{var J;const M=String((F==null?void 0:F.word)??""),X=(J=R.wordProgress)==null?void 0:J[M];return(X?Ut(X,n):35)>=70}).length})()}Âïè
  - üü° „Åæ„Å†„Åæ„Å†: ${(()=>{const R=it();return s.slice(e+1,e+31).filter(F=>{var J;const M=String((F==null?void 0:F.word)??""),X=(J=R.wordProgress)==null?void 0:J[M],ue=X?Ut(X,n):35;return ue>=40&&ue<70}).length})()}Âïè
  - ‚ö™ Êñ∞Ë¶è: ${(()=>{const R=it();return s.slice(e+1,e+31).filter(F=>{var de;const M=String((F==null?void 0:F.word)??""),X=(de=R.wordProgress)==null?void 0:de[M],ue=(()=>{if(!X)return 0;switch(n){case"memorization":return X.memorizationAttempts??0;case"translation":return X.translationAttempts??0;case"spelling":return X.spellingAttempts??0;case"grammar":return X.grammarAttempts??0;default:return X.totalAttempts??0}})(),J=X?Ut(X,n):35;return ue===0||J>=20&&J<40}).length})()}Âïè
  - ‚úÖ ÂÆöÁùÄÊ∏à: ${(()=>{const R=it();return s.slice(e+1,e+31).filter(F=>{var de;const M=String((F==null?void 0:F.word)??""),X=(de=R.wordProgress)==null?void 0:de[M],ue=(()=>{if(!X)return 0;switch(n){case"memorization":return X.memorizationAttempts??0;case"translation":return X.translationAttempts??0;case"spelling":return X.spellingAttempts??0;case"grammar":return X.grammarAttempts??0;default:return X.totalAttempts??0}})(),J=X?Ut(X,n):35;return ue>0&&J<20}).length})()}Âïè

## üîç „Éá„Éê„ÉÉ„Ç∞„Éí„É≥„Éà

**ÊúüÂæÖ„Åï„Çå„ÇãÂãï‰Ωú**:
1. „Åæ„Å†„Åæ„Å†58Ë™û ‚Üí GamificationAI „ÅåÊñ∞Ë¶è„ÇíPositionÂºï„Åç‰∏ä„Åí
2. Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „Åå Position +15 ‚Üí 40-55„Çæ„Éº„É≥„Å´Ê∑∑ÂÖ•
3. PositionÈôçÈ†Ü„ÇΩ„Éº„Éà ‚Üí „Åæ„Å†„Åæ„Å†5Âïè ‚Üí Êñ∞Ë¶è1Âïè„ÅÆÊØîÁéá„ÅßÂá∫È°å

**Á¢∫Ë™ç„Éù„Ç§„É≥„Éà**:
- [ ] calculatePriorities() „ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] applyInterleavingAdjustment() „ÅåÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºü
- [ ] Êñ∞Ë¶è„ÅÆPosition„Åå +15 „Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºüÔºà„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞Á¢∫Ë™çÔºâ
- [ ] sortAndBalance() „ÅåPositionÈôçÈ†Ü„ÇΩ„Éº„Éà„Åó„Å¶„ÅÑ„Çã„ÅãÔºü

---

## üéØ ÂÆü„Éá„Éº„ÇøÊ§úË®ºÔºà„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑÂê∏ÂºïÁ¢∫Ë™çÔºâ

${(()=>{const R=Wi(n);if(!R||R.length===0)return"‚ö†Ô∏è postProcessÂá∫Âäõ„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞Âæå„Å´ÂÜçÂ∫¶Á¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";const D=cp(n),F=new Set(D.map(Me=>Ae(Me.word))),M=R.slice(0,30).map((Me,Ie)=>{const tt=String((Me==null?void 0:Me.word)??""),Z=Ae(tt),xe=F.has(Z),ke=Number((Me==null?void 0:Me.position)??0),ie=Number((Me==null?void 0:Me.attempts)??0);return{rank:Ie+1,word:tt,position:ke,attempts:ie,isStruggling:xe}}),X=M.filter(Me=>Me.isStruggling).length,ue=M.slice(0,10).filter(Me=>Me.isStruggling).length,J=Math.min(D.length,30),de=D.length>0?(X/D.length*100).toFixed(1):"0.0";let me=`**üìä ÂÆü„Éá„Éº„ÇøÂàÜÊûêÁµêÊûúÔºàpostProcessÂá∫ÂäõÔºâ**:
`;return me+="- ÂÖ®„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ: "+D.length+`Ë™û
`,me+="- TOP30ÂÜÖ„Å´Â≠òÂú®: "+X+"Ë™û / "+J+`Ë™ûÔºàÊúüÂæÖÂÄ§Ôºâ
`,me+="- TOP10ÂÜÖ„Å´Â≠òÂú®: "+ue+`Ë™û
`,me+="- „Ç´„Éê„ÉºÁéá: "+de+`%

`,D.length===0?me+=`‚úÖ **„Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì** ‚Üí Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„ÅôÔºÅ
`:X>=Math.min(D.length,20)?me+="‚úÖ **Âê∏ÂºïÊàêÂäü**: TOP30„Å´"+X+`Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁ¢∫ÂÆü„Å´ÂÑ™ÂÖàÂá∫È°å„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºÅ
`:X>=Math.ceil(D.length*.5)?me+="‚ö†Ô∏è **ÈÉ®ÂàÜÁöÑÂê∏Âºï**: TOP30„Å´"+X+"Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÊúüÂæÖÂÄ§Ôºà"+J+`Ë™ûÔºâ„Çà„ÇäÂ∞ë„Å™„ÅÑ„Åß„Åô„ÄÇ
`:(me+="‚ùå **Âê∏ÂºïÂ§±Êïó**: TOP30„Å´"+X+`Ë™û„Åó„ÅãÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ
`,me+=`‚Üí PositionÈôçÈ†Ü„ÇΩ„Éº„Éà„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØPositionÂÄ§„Åå‰∏çÊ≠£Á¢∫„Å™ÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),me+=`
**TOP10„ÅÆÂÜÖË®≥**:
`,me+=M.slice(0,10).map(Me=>{const Ie=Me.isStruggling?"üî¥":Me.position>=40?"üîµ":Me.position>=20?"‚ö™":"‚úÖ",tt=Me.isStruggling?"„Åæ„Å†„Åæ„Å†/ÂàÜ„Åã„Çâ„Å™„ÅÑ":Me.position>=40?"Êñ∞Ë¶è(Âºï‰∏ä)":Me.position>=20?"Êñ∞Ë¶è":"ÂÆöÁùÄÊ∏à";return Me.rank+". "+Ie+" **"+Me.word+"** (Pos "+Me.position+", "+Me.attempts+"Âõû) - "+tt}).join(`
`),me})()}

---

### üéØ Position-aware InsertionÔºà„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥ÔºâÊ§úË®º

${(()=>{const R=localStorage.getItem("debug_position_aware_insertions");if(!R)return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÂÜçÂá∫È°å„Åï„Çå„Çã„Å®Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ`;try{const D=JSON.parse(R);if(!Array.isArray(D)||D.length===0)return"‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅåÁ©∫„Åß„Åô„ÄÇ";let F=`**üìä ÊåøÂÖ•Ë™øÊï¥„ÅÆÂÆüË°åÂ±•Ê≠¥ÔºàÊúÄÊñ∞${D.length}‰ª∂Ôºâ**:

`;D.slice(-10).forEach((J,de)=>{const me=new Date(J.timestamp).toLocaleTimeString("ja-JP"),Me=J.adjustedInsert!==J.originalInsert;if(F+=`${Me?"üéØ":"‚ö™"} **${J.word}** (Position ${J.position})
`,F+=`  - ÊôÇÂàª: ${me}
`,F+=`  - ÂÖÉ„ÅÆÊåøÂÖ•‰ΩçÁΩÆ: index ${J.originalInsert} (ÁèæÂú®‰ΩçÁΩÆ+${J.originalInsert-J.currentIndex})
`,Me){if(F+=`  - üéØ Ë™øÊï¥Âæå: index ${J.adjustedInsert} (ÁèæÂú®‰ΩçÁΩÆ+${J.adjustedInsert-J.currentIndex})
`,F+=`  - ÁêÜÁî±: È´òPositionÂçòË™ûÁæ§„Å´Ââ≤„ÇäËæº„Åø
`,J.nearbyHighPositions&&J.nearbyHighPositions.length>0){const tt=J.nearbyHighPositions.slice(0,3).map(Z=>`${Z.word}(${Z.position})`).join(", ");F+=`  - ËøëÈö£„ÅÆÈ´òPositionË™û: ${tt}${J.nearbyHighPositions.length>3?"...":""}
`}}else F+=`  - Ë™øÊï¥„Å™„ÅóÔºàËøë„Åè„Å´È´òPositionË™û„ÅåË¶ã„Å§„Åã„Çâ„Å™„Åã„Å£„ÅüÔºâ
`;F+=`
`});const X=D.filter(J=>J.adjustedInsert!==J.originalInsert).length,ue=(X/D.length*100).toFixed(1);return F+=`**üìà Áµ±Ë®à„Çµ„Éû„É™**:
`,F+=`- Á∑èÊåøÂÖ•ÂõûÊï∞: ${D.length}Âõû
`,F+=`- Position-awareË™øÊï¥: ${X}Âõû (${ue}%)
`,F+=`- ÈÄöÂ∏∏ÊåøÂÖ•: ${D.length-X}Âõû

`,X>0?(F+=`‚úÖ **„Éï„Ç©„Éº„ÇØ‰∏¶„Å≥„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô**
`,F+=`‚Üí „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑË™û„ÅåÊó¢Â≠ò„ÅÆÈ´òPositionË™û„ÅÆËøë„Åè„Å´ÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
`):(F+=`‚ö†Ô∏è **Ë™øÊï¥„Åå1Â∫¶„ÇÇÁô∫Áîü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì**
`,F+=`‚Üí „Ç≠„É•„ÉºÂÜÖ„Å´È´òPositionË™û„ÅåÂ∞ë„Å™„ÅÑ„Åã„ÄÅÂÜçÂá∫È°å„Åå„Åæ„Å†ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
`),F}catch(D){return`‚ö†Ô∏è Position-awareÊåøÂÖ•„É≠„Ç∞„ÅÆËß£Êûê„Å´Â§±Êïó: ${D}`}})()}

---

### üîÑ ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„É≠„Ç∞ÔºàuseQuestionRequeueÔºâ

${(()=>{const R=localStorage.getItem("debug_requeue_events");if(!R)return"‚ö†Ô∏è debug_requeue_events „Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Åæ„Å†ÂÜçÂá∫È°åÂ∑Æ„ÅóËæº„Åø„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„Å™„ÅÑÂèØËÉΩÊÄßÔºâ";try{const D=JSON.parse(R);if(!Array.isArray(D)||D.length===0)return"‚ö†Ô∏è debug_requeue_events „ÅåÁ©∫„Åß„Åô";const F=D.filter(de=>String((de==null?void 0:de.mode)??"")===n),M=(F.length>0?F:D).slice(-30),X=M.filter(de=>(de==null?void 0:de.decision)==="inserted").length,ue=M.filter(de=>String((de==null?void 0:de.decision)??"").startsWith("skipped")).length;let J=`**üìä „Çµ„Éû„É™**: inserted=${X}, skipped=${ue}ÔºàË°®Á§∫: ${F.length>0?n:"ÂÖ®„É¢„Éº„Éâ"} / ÊúÄÊñ∞${M.length}‰ª∂Ôºâ

`;return J+=M.map((de,me)=>{const Me=de!=null&&de.timestamp?new Date(de.timestamp).toLocaleTimeString("ja-JP"):"-",Ie=String((de==null?void 0:de.word)??(de==null?void 0:de.qid)??"(unknown)"),tt=String((de==null?void 0:de.decision)??"unknown"),Z=String((de==null?void 0:de.reason)??""),xe=Number.isFinite(Number(de==null?void 0:de.plannedOffset))?Number(de.plannedOffset):null,ke=Number.isFinite(Number(de==null?void 0:de.insertAt))?Number(de.insertAt):null,ie=Number.isFinite(Number(de==null?void 0:de.currentIndex))?Number(de.currentIndex):null,We=(de==null?void 0:de.questionPosition)??null,vt=(de==null?void 0:de.ssotPosition)??null,dt=(de==null?void 0:de.effectivePosition)??null,st=`pos(q)=${We??"-"}, pos(ssot)=${vt??"-"}, pos(used)=${dt??"-"}`,Xt=tt==="inserted"&&ke!=null&&ie!=null?`insert@index ${ke} (ÁèæÂú®‰ΩçÁΩÆ+${ke-ie})`:tt.startsWith("skipped")?`skip (windowEnd=${(de==null?void 0:de.windowEnd)??"-"})`:"",ft=xe!=null?`offset=${xe}`:"";return`${me+1}. ${Me} [${tt}] **${Ie}** (${Z}) ${ft} ${Xt} | ${st}`}).join(`
`),J}catch(D){return`‚ö†Ô∏è debug_requeue_events „ÅÆËß£Êûê„Å´Â§±Êïó: ${String(D)}`}})()}

---

_„Åì„ÅÆ„É¨„Éù„Éº„Éà„Çí„Ç≥„Éî„Éº„Åó„Å¶GitHub Copilot Chat„ÅßÂàÜÊûê„Åß„Åç„Åæ„Åô_
`.trim();navigator.clipboard.writeText(G).then(()=>{h(!0),setTimeout(()=>h(!1),2e3)})};return T.useEffect(()=>{const C=localStorage.getItem("debug_ai_evaluations");if(C)try{const $=JSON.parse(C);l(Object.values($).slice(-10))}catch{}{const $="memorization",j=t,P=re=>{if(!re)return null;try{return JSON.parse(re)}catch{return null}},O=re=>{const ye=typeof re=="number"?re:Number(re);return Number.isFinite(ye)?ye:null},A=re=>{const ye=Date.parse(String(re??""));return Number.isFinite(ye)?ye:0},z=re=>{const ye=re.filter(Boolean);if(ye.length===0)return null;const Ae=ye.filter(_e=>O(_e==null?void 0:_e.questionsCount)===j);return Ae.length>0?(Ae.sort((_e,ze)=>A(ze==null?void 0:ze.timestamp)-A(_e==null?void 0:_e.timestamp)),Ae[0]):[...ye].sort((_e,ze)=>{const et=O(_e==null?void 0:_e.questionsCount)??-1,ut=O(ze==null?void 0:ze.questionsCount)??-1;return ut!==et?ut-et:A(ze==null?void 0:ze.timestamp)-A(_e==null?void 0:_e.timestamp)})[0]},L=`debug_position_interleaving_history_${$}`,U=P(localStorage.getItem(L)),V=Array.isArray(U)?U:[],B=z(V),Y=`debug_position_interleaving_${$}`,K=P(localStorage.getItem(Y)),pe=P(localStorage.getItem("debug_position_interleaving")),ge=B??K??pe;ge&&g(ge)}const k=localStorage.getItem("debug_answer_logs");if(k)try{y(JSON.parse(k))}catch{}const I=localStorage.getItem("debug_function_calls");if(I)try{v(JSON.parse(I))}catch{}localStorage.getItem("debug_position_hierarchy_validation"),localStorage.getItem("debug_position_hierarchy_still"),localStorage.getItem("debug_position_hierarchy_new")},[e]),i?u.jsxs("div",{className:"fixed bottom-4 right-4 w-96 max-h-96 bg-white rounded-lg shadow-2xl overflow-auto z-50 border-2 border-blue-500",children:[u.jsxs("div",{className:"sticky top-0 bg-blue-600 text-white p-3 flex justify-between items-center",children:[u.jsx("h3",{className:"font-bold",children:"üîç ÂÜçÂá∫È°å„Éá„Éê„ÉÉ„Ç∞„Éë„Éç„É´"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:N,className:`px-3 py-1 rounded ${d?"bg-green-500":"bg-blue-500 hover:bg-blue-700"}`,title:"„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥ÂΩ¢Âºè„Åß„Ç≥„Éî„Éº",children:d?"‚úì „Ç≥„Éî„ÉºÂÆå‰∫Ü":"üìã „Ç≥„Éî„Éº"}),u.jsx("button",{onClick:()=>a(!1),className:"text-white hover:bg-blue-700 px-2 py-1 rounded",children:"‚úï"})]})]}),u.jsxs("div",{className:"p-4 space-y-4 text-sm",children:[(()=>{try{const C=localStorage.getItem("debug_ab_session_info");if(!C)return null;const k=JSON.parse(C),I=JSON.stringify(k,null,2);return u.jsxs("div",{className:"bg-orange-50 p-3 rounded border-2 border-orange-300",children:[u.jsx("p",{className:"font-semibold text-orange-800",children:"üß™ A/B„ÉÜ„Çπ„ÉàÊÉÖÂ†±Ôºà„Ç≥„Éî„ÉöÁî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„ÇØ„É™„ÉÉ„ÇØ„ÅßJSON„Çí„Ç≥„Éî„Éº"}),u.jsx("pre",{className:"mt-2 bg-white p-2 rounded text-xs cursor-pointer whitespace-pre-wrap break-words",onClick:()=>{navigator.clipboard.writeText(I),h(!0),setTimeout(()=>h(!1),1500)},title:"„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Ç≥„Éî„Éº",children:I})]})}catch{return null}})(),(()=>{const C=Fu.generateSummary(n);if(C==="„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„Åó"||C==="„Çπ„Éë„É≥„Éá„Éº„Çø„Å™„Åó")return u.jsxs("div",{className:"bg-gray-50 p-3 rounded border-2 border-gray-300",children:[u.jsx("p",{className:"font-semibold text-gray-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°"}),u.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"„Éà„É¨„Éº„Çπ„Éá„Éº„Çø„Å™„ÅóÔºàÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ"})]});const I=C.split(`
`).filter(z=>z.trim()).filter(z=>z.startsWith("|"));if(I.length===0)return null;const[$,j,...P]=I,O=$.split("|").filter(z=>z.trim()).map(z=>z.trim()),A=P.map(z=>z.split("|").filter(L=>L.trim()).map(L=>L.trim()));return u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üé´ „Éá„Éº„Çø„Éï„É≠„ÉºËøΩË∑°Ôºà„Çπ„Éë„É≥„Éô„Éº„ÇπÔºâ"}),u.jsx("div",{className:"mt-2 overflow-x-auto",children:u.jsxs("table",{className:"min-w-full text-xs",children:[u.jsx("thead",{children:u.jsx("tr",{className:"bg-purple-100",children:O.map((z,L)=>u.jsx("th",{className:"px-2 py-1 text-left font-semibold",children:z},L))})}),u.jsx("tbody",{children:A.map((z,L)=>u.jsx("tr",{className:L%2===0?"bg-white":"bg-purple-50",children:z.map((U,V)=>u.jsx("td",{className:"px-2 py-1",children:U},V))},L))})]})})]})})(),(()=>{const C=it(),k=Object.keys(C.wordProgress||{}).length,I=Object.values(C.wordProgress||{});let $=0,j=0,P=0,O=0,A=0,z=0;for(const B of I){const Y=fp(B,n),K=Py(B,n),pe=jy(B,n),ge=Ut(B,n);O+=Y,A+=K,z+=pe,Y!==0&&(ge>=70?P++:ge>=40?j++:ge<20&&$++)}const L=Math.max(0,O-A-z),U=O>0?(A/O*100).toFixed(1):"0.0",V=k>0?($/k*100).toFixed(1):"0.0";return u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsx("p",{className:"font-semibold text-green-800",children:"„Çπ„Ç≥„Ç¢„Éú„Éº„ÉâÔºàÂ≠¶ÁøíÁä∂Ê≥ÅÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"Á∑èÂçòË™ûÊï∞"}),u.jsxs("p",{className:"text-lg font-bold",children:[k,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÁøíÂæóÊ∏à„Åø"}),u.jsxs("p",{className:"text-lg font-bold text-green-600",children:[$,"Ë™û"]}),u.jsxs("p",{className:"text-xs text-gray-500",children:["(",V,"%)"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"„Åæ„Å†„Åæ„Å†"}),u.jsxs("p",{className:"text-lg font-bold text-yellow-600",children:[j,"Ë™û"]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsx("p",{className:"text-gray-600",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"}),u.jsxs("p",{className:"text-lg font-bold text-red-600",children:[P,"Ë™û"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÂÖ®‰ΩìÊ≠£Á≠îÁéá:"}),u.jsxs("span",{className:"font-bold",children:[U,"%"]})]}),u.jsxs("div",{className:"flex justify-between mt-1",children:[u.jsx("span",{className:"text-gray-600",children:"Á∑èË©¶Ë°åÂõûÊï∞:"}),u.jsxs("span",{children:[O,"Âõû"]})]}),u.jsxs("div",{className:"flex justify-between text-xs mt-1",children:[u.jsxs("span",{className:"text-green-600",children:["Ê≠£Á≠î: ",A,"Âõû"]}),u.jsxs("span",{className:"text-red-600",children:["Ë™§Á≠î: ",L,"Âõû"]})]})]}),u.jsxs("div",{className:"bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-gray-600",children:"ÈÄ≤ÊçóÁéá:"}),u.jsxs("span",{className:"font-bold",children:[(e/t*100).toFixed(1),"%"]})]}),u.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e," / ",t," ÂïèÁõÆ"]}),u.jsx("progress",{className:"w-full h-2 rounded-full mt-2 [&::-webkit-progress-bar]:bg-gray-200 [&::-webkit-progress-value]:bg-blue-600 [&::-moz-progress-bar]:bg-blue-600",value:e,max:Math.max(1,t)})]})]})]})})(),b.length>0&&u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsxs("p",{className:"font-semibold text-blue-800",children:["üìû Èñ¢Êï∞Âëº„Å≥Âá∫„ÅóÂ±•Ê≠¥ (ÊúÄÊñ∞",b.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-1 max-h-40 overflow-y-auto",children:b.slice().reverse().map((C,k)=>u.jsxs("div",{className:"text-xs bg-white p-2 rounded flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-mono font-bold text-blue-600",children:C.function}),u.jsx("span",{className:"ml-2 text-gray-600",children:JSON.stringify(C.params)})]}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})]},k))})]}),x.length>0&&u.jsxs("div",{className:"bg-green-50 p-3 rounded border-2 border-green-300",children:[u.jsxs("p",{className:"font-semibold text-green-800",children:["üìù Ëß£Á≠îÁõ¥Âæå„ÅÆPositionË®àÁÆó (ÊúÄÊñ∞",x.length,"‰ª∂)"]}),u.jsx("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:x.slice().reverse().map((C,k)=>{const I=Math.abs(C.positionAfter-C.positionBefore)>1,$=C.positionAfter>C.positionBefore;return u.jsxs("div",{className:"text-xs bg-white p-2 rounded border",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:C.word}),u.jsx("span",{className:"text-xs text-gray-500",children:new Date(C.timestamp).toLocaleTimeString()})]}),u.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-600",children:"Position: "}),u.jsxs("span",{className:I?$?"text-red-600 font-bold":"text-green-600 font-bold":"",children:[C.positionBefore.toFixed(0)," ‚Üí ",C.positionAfter.toFixed(0)]}),I&&u.jsxs("span",{className:"ml-2",children:[$?"üî∫":"üîª",Math.abs(C.positionAfter-C.positionBefore).toFixed(0)]})]}),(()=>{const j=(()=>{switch(C.category){case"incorrect":return{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded text-xs",label:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs",label:"üü° „Åæ„Å†„Åæ„Å†"};case"new":return{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs",label:"‚ö™ Êñ∞Ë¶è"};case"mastered":return{className:"bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs",label:"‚úÖ ÂÆöÁùÄÊ∏à"};default:return{className:"bg-gray-100 text-gray-800 px-2 py-0.5 rounded text-xs",label:String(C.category??"")}}})();return u.jsx("span",{className:j.className,children:j.label})})()]}),u.jsxs("div",{className:"mt-1 flex gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["Ê≠£Á≠î: ",C.progress.correctCount]}),u.jsxs("span",{children:["Ë™§Á≠î: ",C.progress.incorrectCount]}),u.jsxs("span",{children:["ÈÄ£Á∂öÊ≠£Á≠î: ",C.progress.consecutiveCorrect]}),u.jsxs("span",{children:["ÈÄ£Á∂öË™§Á≠î: ",C.progress.consecutiveIncorrect]}),u.jsxs("span",{children:["Ê≠£Á≠îÁéá: ",(C.progress.accuracy*100).toFixed(0),"%"]})]}),(()=>{var L,U;const j=C.savedPositionDebug,P=j==null?void 0:j.savedPosition,O=j==null?void 0:j.decision,A=j==null?void 0:j.reason,z=C.positionWithSavedPosition;return P===void 0&&z===void 0&&!O?null:u.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-gray-600",children:[u.jsxs("span",{children:["savedPosition: ",P??"-"]}),u.jsxs("span",{children:["calc(savedÊúâ„Çä): ",z??"-"]}),u.jsxs("span",{children:["calc(savedÁÑ°Ë¶ñ/Ëß£Á≠îÁõ¥Âæå): ",((U=(L=C.positionAfter)==null?void 0:L.toFixed)==null?void 0:U.call(L,0))??"-"]}),O&&u.jsxs("span",{children:["savedÂà§ÂÆö: ",String(O),A?` (${String(A)})`:""]})]})})()]},k)})})]}),m&&u.jsxs("div",{className:"bg-purple-50 p-3 rounded border-2 border-purple-300",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"üéÆ PositionÂàÜÊï£Ë®∫Êñ≠"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Ââç:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",m.before.struggling,"Ë™û / Êñ∞Ë¶è",m.before.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"ÂàÜÊï£Âæå:"}),u.jsxs("span",{children:["„Åæ„Å†„Åæ„Å†",m.after.struggling,"Ë™û / Êñ∞Ë¶è",m.after.new,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between font-bold",children:[u.jsx("span",{children:"PositionÂºï„Åç‰∏ä„Åí:"}),u.jsxs("span",{className:m.summary.working?"text-green-600":"text-red-600",children:[m.summary.boosted,"Ë™û",m.summary.working?" ‚úÖ":" ‚ùå"]})]}),m.changed.length>0&&u.jsxs("details",{className:"mt-2",children:[u.jsxs("summary",{className:"cursor-pointer text-purple-700",children:["Âºï„Åç‰∏ä„Åí„Çâ„Çå„ÅüÂçòË™û (",m.changed.length,"Ë™û)"]}),u.jsx("ul",{className:"mt-1 space-y-1 max-h-40 overflow-y-auto",children:m.changed.slice(0,10).map((C,k)=>u.jsxs("li",{className:"text-xs bg-white p-1 rounded",children:[u.jsx("span",{className:"font-mono",children:C.word}),":"," ",u.jsxs("span",{className:"text-gray-500",children:[C.before.toFixed(0)," ‚Üí ",C.after.toFixed(0)]})]},k))})]}),!m.summary.working&&u.jsx("div",{className:"text-red-600 font-bold mt-2",children:"‚ö†Ô∏è „Ç§„É≥„Çø„Éº„É™„Éº„Éñ„ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åõ„ÇìÔºÅ"})]})]}),(()=>{const C=Wi(n).slice(0,30);if(C.length===0)return null;try{const k=C.map(O=>O.attempts>0&&O.position>=40&&O.position<70?"„Åæ„Å†„Åæ„Å†":O.attempts===0&&O.position>=40&&O.position<70?"Êñ∞Ë¶è(Âºï‰∏ä)":O.position>=70?"ÂàÜ„Åã„Çâ„Å™„ÅÑ":O.position<20?"ÂÆöÁùÄÊ∏à":"Êñ∞Ë¶è"),I={„Åæ„Å†„Åæ„Å†:k.filter(O=>O==="„Åæ„Å†„Åæ„Å†").length,Êñ∞Ë¶èÂºï‰∏ä:k.filter(O=>O==="Êñ∞Ë¶è(Âºï‰∏ä)").length,„Åù„ÅÆ‰ªñ:k.filter(O=>!["„Åæ„Å†„Åæ„Å†","Êñ∞Ë¶è(Âºï‰∏ä)"].includes(O)).length},$=k.slice(0,20).map(O=>{switch(O){case"„Åæ„Å†„Åæ„Å†":return"üü°";case"Êñ∞Ë¶è(Âºï‰∏ä)":return"üîµ";case"ÂàÜ„Åã„Çâ„Å™„ÅÑ":return"üî¥";case"ÂÆöÁùÄÊ∏à":return"‚úÖ";default:return"‚ö™"}}).join("");let j=0;for(let O=0;O<k.length-1;O++){const A=k[O],z=k[O+1];A==="„Åæ„Å†„Åæ„Å†"&&z==="Êñ∞Ë¶è(Âºï‰∏ä)"&&j++,A==="Êñ∞Ë¶è(Âºï‰∏ä)"&&z==="„Åæ„Å†„Åæ„Å†"&&j++}const P=j>=3;return u.jsxs("div",{className:"bg-blue-50 p-3 rounded border-2 border-blue-300",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üéÆ „Ç´„ÉÜ„Ç¥„É™Âà•„Ç§„É≥„Çø„Éº„É™„Éº„ÉñÔºà‰∫§‰∫íÈÖçÁΩÆÔºâ"}),u.jsxs("div",{className:"mt-2 space-y-2 text-xs",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üü° „Åæ„Å†„Åæ„Å†:"}),u.jsxs("span",{className:"font-bold",children:[I.„Åæ„Å†„Åæ„Å†,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"üîµ Êñ∞Ë¶è(Âºï‰∏ä):"}),u.jsxs("span",{className:"font-bold",children:[I.Êñ∞Ë¶èÂºï‰∏ä,"Ë™û"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"„Åù„ÅÆ‰ªñ:"}),u.jsxs("span",{children:[I.„Åù„ÅÆ‰ªñ,"Ë™û"]})]}),u.jsxs("div",{className:"mt-3 p-2 bg-white rounded",children:[u.jsx("p",{className:"text-xs font-semibold mb-1",children:"„Éë„Çø„Éº„É≥Ë¶ñË¶öÂåñ (TOP20):"}),u.jsx("div",{className:"text-lg leading-relaxed break-all",children:$}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"üü°„Åæ„Å†„Åæ„Å† üîµÊñ∞Ë¶è(Âºï‰∏ä) ‚ö™Êñ∞Ë¶è üî¥ÂàÜ„Åã„Çâ„Å™„ÅÑ ‚úÖÂÆöÁùÄÊ∏à"})]}),u.jsxs("div",{className:`mt-2 p-2 rounded ${P?"bg-green-100":"bg-yellow-100"}`,children:[u.jsx("p",{className:"font-semibold",children:P?"‚úÖ ‰∫§‰∫íÈÖçÁΩÆ„ÅåÊ≠£Â∏∏„Å´Ê©üËÉΩ":"‚ö†Ô∏è ‰∫§‰∫íÈÖçÁΩÆ„ÅÆÈ†ªÂ∫¶„Åå‰Ωé„ÅÑ"}),u.jsxs("p",{className:"text-xs mt-1",children:["Âàá„ÇäÊõø„ÅàÂõûÊï∞: ",j,"Âõû",P?" (ÊúüÂæÖ: „Åæ„Å†„Åæ„Å†2-3Âïè ‚Üí Êñ∞Ë¶è1Âïè)":""]})]}),I.„Åæ„Å†„Åæ„Å†===0&&I.Êñ∞Ë¶èÂºï‰∏ä===0&&u.jsx("div",{className:"text-gray-600 mt-2",children:"‚ÑπÔ∏è „Ç§„É≥„Çø„Éº„É™„Éº„ÉñÂØæË±°„Å™„ÅóÔºàÊ≠£Â∏∏Âãï‰ΩúÔºâ"})]})]})}catch{return null}})(),u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsx("p",{className:"font-semibold",children:"üìç ÁèæÂú®‰ΩçÁΩÆ"}),u.jsxs("p",{className:"text-lg",children:[e+1," / ",t," ÂïèÁõÆ"]})]}),u.jsxs("div",{className:"bg-yellow-50 p-3 rounded",children:[u.jsxs("p",{className:"font-semibold text-yellow-800",children:["üîÑ „Åæ„Å†„Åæ„Å†„ÉªÂàÜ„Åã„Çâ„Å™„ÅÑ (",p.length,"Ë™û)"]}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"LocalStorage„Å´‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„ÇãËã¶ÊâãÂçòË™ûÔºàPosition ‚â• 40Ôºâ"}),p.length===0?u.jsx("p",{className:"text-gray-600 mt-2",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-1 max-h-60 overflow-y-auto",children:p.slice(0,20).map((C,k)=>u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-mono font-bold",children:C.word}),u.jsx("span",{className:C.position>=70?"bg-red-100 text-red-800 px-2 py-0.5 rounded":"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded",children:C.position>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-500",children:[u.jsxs("span",{children:["Position: ",C.position.toFixed(0)]}),u.jsxs("span",{children:["Ë©¶Ë°å: ",C.attempts,"Âõû"]}),u.jsxs("span",{children:["ÊúÄÁµÇ: ",new Date(C.lastStudied).toLocaleDateString()]})]})]},k))}),p.length>20&&u.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["‚Äª ÊúÄÂàù„ÅÆ20Ë™û„ÅÆ„ÅøË°®Á§∫ÔºàÂÖ®",p.length,"Ë™ûÔºâ"]})]}),u.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-blue-800",children:"üìã Ê¨°„ÅÆ30ÂïèÔºàPositionÂàÜÊï£Ë®∫Êñ≠Áî®Ôºâ"}),u.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"„Åæ„Å†„Åæ„Å†58Ë™û ‚Üí Êñ∞Ë¶è„ÅÆ17% (Á¥Ñ10Ë™û) „ÅåPosition +15„Åï„Çå„Å¶„ÅÑ„Çã„ÅØ„Åö"}),u.jsx("ul",{className:"mt-2 space-y-1 max-h-80 overflow-y-auto",children:s.slice(e+1,e+31).map((C,k)=>{var U;const I=C==null?void 0:C.word,j=(U=it().wordProgress)==null?void 0:U[I],P=(j==null?void 0:j.memorizationPosition)??0,O=(j==null?void 0:j.totalAttempts)??0,A=(C==null?void 0:C.difficulty)??"‰∏çÊòé",z=P>=40,L=P>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":P>=40?"üü° „Åæ„Å†„Åæ„Å†":P>=20?"‚ö™ Êñ∞Ë¶è":"‚úÖ ÂÆöÁùÄÊ∏à";return u.jsxs("li",{className:`text-xs p-2 rounded ${z?"bg-yellow-200 font-bold":"bg-white"}`,children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"text-gray-500",children:[e+k+2,"ÂïèÁõÆ"]})," ",u.jsx("span",{className:"font-mono font-bold",children:I})]}),u.jsx("div",{className:"text-xs",children:L})]}),u.jsxs("div",{className:"flex gap-3 mt-1 text-xs text-gray-600",children:[u.jsxs("span",{children:["Position: ",P.toFixed(0)]}),u.jsxs("span",{children:["Âá∫È°å: ",O,"Âõû"]}),u.jsx("span",{children:A}),z&&u.jsx("span",{className:"text-yellow-800 font-bold",children:P>=70?"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ":"üü° „Åæ„Å†„Åæ„Å†"})]})]},k)})})]}),u.jsxs("div",{className:"bg-purple-50 p-3 rounded",children:[u.jsx("p",{className:"font-semibold text-purple-800",children:"ü§ñ AIË©ï‰æ°ÔºàÊúÄÊñ∞10‰ª∂Ôºâ"}),c.length===0?u.jsx("p",{className:"text-gray-600",children:"Ôºà„Å™„ÅóÔºâ"}):u.jsx("ul",{className:"mt-2 space-y-2",children:c.slice(-10).map((C,k)=>{const I=C.word||"(ÂçòË™ûÂêç„Å™„Åó)",$=(()=>{switch(C.category){case"incorrect":return{className:"bg-red-100 text-red-800",label:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"};case"still_learning":return{className:"bg-yellow-100 text-yellow-800",label:"„Åæ„Å†„Åæ„Å†"};case"mastered":return{className:"bg-green-100 text-green-800",label:"ÂÆöÁùÄÊ∏à"};case"new":return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"};default:return{className:"bg-gray-100 text-gray-800",label:"Êú™Â≠¶Áøí"}}})();return u.jsxs("li",{className:"text-xs bg-white p-2 rounded",children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("span",{className:"text-gray-500",children:["#",k+1]}),u.jsx("span",{className:"font-mono font-bold text-base text-blue-600",children:I})]}),u.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${$.className}`,children:$.label})]}),u.jsxs("div",{className:"flex flex-col gap-1 text-gray-600",children:[u.jsxs("div",{children:[u.jsxs("span",{className:"font-semibold",children:["Position: ",(C.position??0).toFixed(0)]}),u.jsxs("span",{className:"ml-2 text-xs",children:["(ÈÄ£Á∂öÊ≠£Ëß£: ",C.consecutiveCorrect??0,", ÈÄ£Á∂ö‰∏çÊ≠£Ëß£:"," ",C.consecutiveIncorrect??0,")"]})]}),u.jsxs("div",{className:"text-xs",children:[u.jsxs("span",{children:["Ê≠£Ëß£Áéá: ",((C.accuracy??0)*100).toFixed(0),"%"]}),u.jsxs("span",{className:"ml-2",children:["Ë©¶Ë°å: ",C.attempts??0,"Âõû"]}),u.jsxs("span",{className:"ml-2",children:["ÁµåÈÅé: ",C.daysSince??0,"Êó•"]})]}),C.aiProposals&&u.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[u.jsx("div",{className:"text-xs font-semibold mb-1",children:"ü§ñ 7„Å§„ÅÆAIÊèêÊ°à:"}),u.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[u.jsxs("span",{children:["üß† Memory: ",(C.aiProposals.memory??0).toFixed(0)]}),u.jsxs("span",{children:["üí§ CogLoad: ",(C.aiProposals.cognitiveLoad??0).toFixed(0)]}),u.jsxs("span",{children:["üîÆ Error: ",(C.aiProposals.errorPrediction??0).toFixed(0)]}),u.jsxs("span",{children:["üìö Linguistic: ",(C.aiProposals.linguistic??0).toFixed(0)]}),u.jsxs("span",{children:["üåç Context: ",(C.aiProposals.contextual??0).toFixed(0)]}),u.jsxs("span",{children:["üéØ Style: ",(C.aiProposals.learningStyle??0).toFixed(0)]}),u.jsxs("span",{className:"col-span-2",children:["üéÆ Gamify: ",(C.aiProposals.gamification??0).toFixed(0)]})]})]})]})]},k)})})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_ai_evaluations"),l([])},className:"flex-1 bg-red-100 text-red-800 px-3 py-2 rounded hover:bg-red-200",children:"üóëÔ∏è AIË©ï‰æ°„ÇØ„É™„Ç¢"}),u.jsx("button",{onClick:()=>{localStorage.removeItem("debug_memorization_latest")},className:"flex-1 bg-gray-100 text-gray-800 px-3 py-2 rounded hover:bg-gray-200",children:"üóëÔ∏è „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞„ÇØ„É™„Ç¢"})]}),u.jsxs("div",{className:"mt-6 border-t-2 border-blue-300 pt-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"font-bold text-lg",children:"üìä A/B„ÉÜ„Çπ„ÉàÈõÜË®à"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>{const C=_y();S(C)},className:"bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200",children:"üîÑ Êõ¥Êñ∞"}),u.jsx("button",{onClick:()=>{const C=b9(),k=new Blob([C],{type:"application/json"}),I=URL.createObjectURL(k),$=document.createElement("a");$.href=I,$.download=`ab-session-logs-${Date.now()}.json`,$.click(),URL.revokeObjectURL(I)},className:"bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200",children:"üíæ JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà"}),u.jsx("button",{onClick:()=>{window.confirm("„Åô„Åπ„Å¶„ÅÆA/B„Çª„ÉÉ„Ç∑„Éß„É≥„É≠„Ç∞„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")&&(w9(),S(null))},className:"bg-red-100 text-red-800 px-3 py-1 rounded text-sm hover:bg-red-200",children:"üóëÔ∏è „ÇØ„É™„Ç¢"})]})]}),w&&w.totalSessions>0?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[u.jsxs("div",{className:"text-sm",children:[u.jsx("strong",{children:"Á∑è„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞:"})," ",w.totalSessions]}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["ÊúÄÁµÇÊõ¥Êñ∞: ",new Date(w.lastUpdated).toLocaleString("ja-JP")]})]}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm border-collapse",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-gray-200",children:[u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"Variant"}),u.jsx("th",{className:"border border-gray-300 px-2 py-1",children:"N"}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóË™ûÊï∞",u.jsx("br",{}),"(‰∏≠Â§ÆÂÄ§)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÂèñÂæóÁéá",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊåØÂãï„Çπ„Ç≥„Ç¢",u.jsx("br",{}),"(Âπ≥Âùá)"]}),u.jsxs("th",{className:"border border-gray-300 px-2 py-1",children:["ÊâÄË¶ÅÊôÇÈñì",u.jsx("br",{}),"(Âπ≥Âùá)"]})]})}),u.jsx("tbody",{children:["A","B","C"].map(C=>{const k=w.byVariant[C];return k?u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:C}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.sessionCount}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.avgAcquiredWords.toFixed(2)}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.medianAcquiredWords.toFixed(0)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[(k.avgAcquisitionRate*100).toFixed(1),"%"]}),u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center",children:k.avgVibrationScore.toFixed(1)}),u.jsxs("td",{className:"border border-gray-300 px-2 py-1 text-center",children:[Math.round(k.avgDurationSec),"Áßí"]})]},C):u.jsxs("tr",{children:[u.jsx("td",{className:"border border-gray-300 px-2 py-1 text-center font-bold",children:C}),u.jsx("td",{colSpan:6,className:"border border-gray-300 px-2 py-1 text-center text-gray-500",children:"„Éá„Éº„Çø„Å™„Åó"})]},C)})})]})}),(()=>{try{const k=JSON.parse(localStorage.getItem("ab_session_logs")||"[]").filter(I=>I.mlEnabled===!0).length;if(k>0)return u.jsxs("div",{className:"bg-blue-50/20 p-3 rounded border border-blue-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"ü§ñ MLÁµ±Ë®à"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["ML ON„Çª„ÉÉ„Ç∑„Éß„É≥Êï∞: ",k]}),u.jsx("div",{className:"text-gray-600",children:"‚Äª MLÊúâÂäπÂåñÂæå„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„Éá„Éº„Çø„ÅØÂêÑvariant„Å´Âê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô"})]})]})}catch{}return null})(),w.byVariant.A&&u.jsxs("div",{className:"bg-yellow-50/20 p-3 rounded border border-yellow-300",children:[u.jsx("div",{className:"text-sm font-semibold mb-2",children:"üìà Âà§ÂÆöÂü∫Ê∫ñÔºàÊö´ÂÆöÔºâ"}),u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsxs("div",{children:["‚úÖ ",u.jsx("strong",{children:"ÂêàÊ†º:"})," B or C „Åå A „Å´ÂØæ„Åó„Å¶„ÄåÂèñÂæóË™ûÊï∞/„Çª„ÉÉ„Ç∑„Éß„É≥ +10%„Äç„Åã„Å§ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ„Å™„Åó"]}),u.jsxs("div",{children:["‚ùå ",u.jsx("strong",{children:"‰∏çÂêàÊ†º:"})," ÊîπÂñÑ„Å™„Åó or ÊåØÂãï„Çπ„Ç≥„Ç¢ > 50"]})]}),w.byVariant.B&&w.byVariant.A&&u.jsxs("div",{className:"mt-2 text-xs",children:[u.jsx("strong",{children:"B vs A:"})," ",w.byVariant.B.avgAcquiredWords>=w.byVariant.A.avgAcquiredWords*1.1&&w.byVariant.B.avgVibrationScore<=w.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]}),w.byVariant.C&&w.byVariant.A&&u.jsxs("div",{className:"mt-1 text-xs",children:[u.jsx("strong",{children:"C vs A:"})," ",w.byVariant.C.avgAcquiredWords>=w.byVariant.A.avgAcquiredWords*1.1&&w.byVariant.C.avgVibrationScore<=w.byVariant.A.avgVibrationScore+5?"‚úÖ ÂêàÊ†ºÔºà+10%ÈÅîÊàêÔºâ":"‚è≥ Á∂ôÁ∂öÊ∏¨ÂÆö"]})]})]}):u.jsx("div",{className:"text-center text-gray-500 py-8",children:"„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´„Éá„Éº„Çø„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]})]})]}):null}const My=[0,5,10,20,30,50,100,150,200];function D0({learningLimit:n,reviewLimit:e,onLearningLimitChange:t,onReviewLimitChange:s,idPrefix:r=""}){return u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:`${r}learning-limit`,children:"üéØ Â≠¶Áøí‰∏≠„ÅÆ‰∏äÈôê:"}),u.jsx("select",{id:`${r}learning-limit`,value:n,onChange:o=>t(parseInt(o.target.value)),className:"select-input",children:My.map(o=>u.jsx("option",{value:o,children:o===0?"Ë®≠ÂÆöÁÑ°„Åó":o},o))})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:`${r}review-limit`,children:"‚ö†Ô∏è Ë¶ÅÂæ©Áøí„ÅÆ‰∏äÈôê:"}),u.jsx("select",{id:`${r}review-limit`,value:e,onChange:o=>s(parseInt(o.target.value)),className:"select-input",children:My.map(o=>u.jsx("option",{value:o,children:o===0?"Ë®≠ÂÆöÁÑ°„Åó":o},o))})]})]})}function _0(n){const[e,t]=T.useState(()=>{const a=localStorage.getItem(`learning-limit-${n}`);return a?parseInt(a):30}),[s,r]=T.useState(()=>{const a=localStorage.getItem(`review-limit-${n}`);return a?parseInt(a):10}),o=T.useCallback(a=>{const c=Math.max(0,a)||30;t(c),localStorage.setItem(`learning-limit-${n}`,c.toString())},[n]),i=T.useCallback(a=>{const c=Math.max(0,a)||10;r(c),localStorage.setItem(`review-limit-${n}`,c.toString())},[n]);return{learningLimit:e,reviewLimit:s,setLearningLimit:o,setReviewLimit:i}}var qi=(n=>(n.ENCODING="encoding",n.INITIAL_CONSOLIDATION="initial",n.INTRADAY_REVIEW="intraday",n.SHORT_TERM="short_term",n.LONG_TERM="long_term",n))(qi||{});const Fy={encodingTime:3e4,initialConsolidation:36e5,intradayWindow:864e5,shortTermWindow:6048e5,longTermThreshold:6048e5,correctRateThreshold:.8,responseTimeThreshold:1500},C9=1e3,N9=100,I9=100,k9=0,$9=6e4,T9=1e3;class A9{constructor(e,t){Ee(this,"thresholds");Ee(this,"cache");Ee(this,"CACHE_DURATION",5e3);const s={...Fy,...t};e?this.thresholds=this.adjustThresholds(s,e):this.thresholds=s,this.cache=new Map}adjustThresholds(e,t){return{encodingTime:e.encodingTime,initialConsolidation:e.initialConsolidation/t.learningSpeed,intradayWindow:e.intradayWindow,shortTermWindow:e.shortTermWindow/t.learningSpeed,longTermThreshold:e.longTermThreshold/t.learningSpeed,correctRateThreshold:e.correctRateThreshold,responseTimeThreshold:e.responseTimeThreshold*t.learningSpeed}}detectPhase(e,t){const s=Date.now(),r=this.cache.get(e);if(r&&s-r.timestamp<this.CACHE_DURATION)return r.phase;const o=this.detectPhaseWithReason(e,t);return this.cache.set(e,{phase:o.phase,timestamp:s}),o.phase}detectPhaseWithReason(e,t){const s=Date.now(),r=this.sanitizeTimestamp(t.lastReviewTime,s),o=this.sanitizeTimestamp(t.lastCorrectTime,s),i=this.sanitizeResponseTime(t.averageResponseTime),a=s-r,c=a/864e5,l=t.reviewCount>0?t.correctCount/t.reviewCount:0,d={reviewCount:t.reviewCount,correctCount:t.correctCount,correctRate:l,daysSinceLastReview:c,timeSinceLastReview:a,averageResponseTime:i};if(t.reviewCount===0)return{phase:"encoding",reason:"ÂàùË¶ãÂçòË™ûÔºàreviewCount=0Ôºâ",matchedCondition:1,metrics:d};if(a<this.thresholds.encodingTime)return{phase:"encoding",reason:`‰ΩúÊ•≠Ë®òÊÜ∂ÊÆµÈöéÔºà${Math.round(a/1e3)}ÁßíÂâçÔºâ`,matchedCondition:2,metrics:d};if(t.correctCount===0)return{phase:"encoding",reason:"‰∏ÄÂ∫¶„ÇÇÊ≠£Á≠î„Åó„Å¶„ÅÑ„Å™„ÅÑ",matchedCondition:3,metrics:d};if(c>C9)return{phase:"encoding",reason:`Ë∂ÖÈï∑ÊúüÊîæÁΩÆÔºà${Math.round(c)}Êó•ÂâçÔºâ`,matchedCondition:101,metrics:d};if(t.consecutiveCorrect>=N9)return{phase:"long_term",reason:`ÂÆåÂÖ®ÁøíÂæóÔºà${t.consecutiveCorrect}ÂõûÈÄ£Á∂öÊ≠£Á≠îÔºâ`,matchedCondition:102,metrics:d};if(t.consecutiveWrong>=I9)return{phase:"encoding",reason:`Â≠¶ÁøíÊñπÊ≥ïË¶ÅË¶ãÁõ¥„ÅóÔºà${t.consecutiveWrong}ÂõûÈÄ£Á∂öË™§Á≠îÔºâ`,matchedCondition:103,metrics:d};const h=(s-o)/36e5;if(t.correctCount===1&&s-o<this.thresholds.initialConsolidation)return{phase:"initial",reason:`ÂàùÊúüÁµ±ÂêàÊÆµÈöéÔºàÂàùÂõûÊ≠£Á≠îÂæå${Math.round(h*60)}ÂàÜÔºâ`,matchedCondition:4,metrics:d};if(this.isSameDay(s,o)&&t.correctCount>=2)return{phase:"intraday",reason:`ÂêåÊó•Âæ©ÁøíÊÆµÈöéÔºà‰ªäÊó•${t.correctCount}ÂõûÊ≠£Á≠îÔºâ`,matchedCondition:5,metrics:d};if(c>=1&&c<=7){if(l>=.5&&l<this.thresholds.correctRateThreshold)return{phase:"short_term",reason:`Áü≠ÊúüË®òÊÜ∂ÊÆµÈöéÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d};if(l<.5)return{phase:"encoding",reason:`ÂøòÂç¥„Å´„Çà„Çä„É™„Çª„ÉÉ„ÉàÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:6,metrics:d}}return c>7?l>=this.thresholds.correctRateThreshold&&i<this.thresholds.responseTimeThreshold?{phase:"long_term",reason:`Èï∑ÊúüË®òÊÜ∂Á¢∫Á´ãÔºà${Math.round(c)}Êó•Ââç„ÄÅÊ≠£Á≠îÁéá${Math.round(l*100)}%„ÄÅÂøúÁ≠î${Math.round(i)}msÔºâ`,matchedCondition:7,metrics:d}:l>=.5&&l<this.thresholds.correctRateThreshold?{phase:"short_term",reason:`„Åæ„Å†‰∏çÂÆâÂÆöÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"encoding",reason:`ÂÆåÂÖ®ÂøòÂç¥ÔºàÊ≠£Á≠îÁéá${Math.round(l*100)}%Ôºâ`,matchedCondition:7,metrics:d}:{phase:"short_term",reason:"„Éá„Éï„Ç©„É´„ÉàÂà§ÂÆö",matchedCondition:0,metrics:d}}canTransition(e,t,s){const r=this.detectPhase(e,t);if(r===s)return!0;const o=["encoding","initial","intraday","short_term","long_term"],i=o.indexOf(r),a=o.indexOf(s);return a>i?a-i===1:!0}isSameDay(e,t){const s=new Date(e),r=new Date(t);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}sanitizeResponseTime(e){return e<=k9||e>$9||isNaN(e)?T9:e}sanitizeTimestamp(e,t){return e>t?(console.warn(`Êú™Êù•„ÅÆ„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„ÇíÊ§úÂá∫: ${e}`),t):e<0||isNaN(e)?t:e}clearCache(){this.cache.clear()}updateThresholds(e){this.thresholds=this.adjustThresholds(Fy,e),this.clearCache()}}var Ya=(n=>(n.IMMEDIATE="immediate",n.EARLY="early",n.MID="mid",n.END="end",n))(Ya||{}),ja=(n=>(n.MEMORIZATION="memorization",n.TRANSLATION="translation",n.SPELLING="spelling",n.GRAMMAR="grammar",n))(ja||{});const E9={memorization:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5},translation:{consolidationThreshold:4,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.6},spelling:{consolidationThreshold:6,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.4},grammar:{consolidationThreshold:5,enableImmediateReview:!0,enableEarlyReview:!0,enableMidReview:!0,enableEndReview:!0,newQuestionRatio:.5}},Yl={immediate:50,early:100,mid:150,end:200},R9=72e5,Oy=3,D9=1/0,_9=2,P9=1,Ly=.85,Wa=4;class j9{constructor(e){Ee(this,"queues");Ee(this,"currentQuestionNumber",0);Ee(this,"sessionStartTime",Date.now());Ee(this,"wordAttempts",new Map);Ee(this,"acquisitionProgress",new Map);Ee(this,"tabConfigs");if(this.queues={immediate:[],early:[],mid:[],end:[]},this.tabConfigs={...E9},e)for(const[t,s]of Object.entries(e))this.tabConfigs[t]={...this.tabConfigs[t],...s}}enqueueNewWord(e,t,s){const r=Date.now();this.currentQuestionNumber++;const o=this.tabConfigs[s];if(this.acquisitionProgress.has(e)||this.acquisitionProgress.set(e,{todayFirstSeen:r,todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:o.consolidationThreshold,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:r}),o.enableImmediateReview&&this.shouldEnqueueImmediate(t)){const i=this.calculateImmediateGap(t);this.enqueueToImmediate(e,t,s,i)}}enqueueToImmediate(e,t,s,r){const o=Date.now();if(this.isDuplicateInQueue(e,"immediate"))return;const i={word:e,queueType:"immediate",enqueuedAt:o,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+r,targetTime:o+6e4,priority:100,difficulty:t,category:s};this.enqueueWithLimit(this.queues.immediate,i,Yl.immediate);const a=this.acquisitionProgress.get(e);a.currentQueue="immediate",a.queuedAt=o}enqueueToEarly(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEarlyReview||this.isDuplicateInQueue(e,"early"))return;const i=this.calculateEarlyGap(t),a={word:e,queueType:"early",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+6e5,priority:80,difficulty:t,category:s};this.enqueueWithLimit(this.queues.early,a,Yl.early);const c=this.acquisitionProgress.get(e);c.currentQueue="early",c.queuedAt=r}enqueueToMid(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableMidReview||this.isDuplicateInQueue(e,"mid"))return;const i=this.calculateMidGap(t),a={word:e,queueType:"mid",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:this.currentQuestionNumber+i,targetTime:r+36e5,priority:60,difficulty:t,category:s};this.enqueueWithLimit(this.queues.mid,a,Yl.mid);const c=this.acquisitionProgress.get(e);c.currentQueue="mid",c.queuedAt=r}enqueueToEnd(e,t,s){const r=Date.now();if(!this.tabConfigs[s].enableEndReview||this.isDuplicateInQueue(e,"end"))return;const i={word:e,queueType:"end",enqueuedAt:r,enqueuedQuestionNumber:this.currentQuestionNumber,targetQuestionNumber:1/0,targetTime:1/0,priority:40,difficulty:t,category:s};this.enqueueWithLimit(this.queues.end,i,Yl.end);const a=this.acquisitionProgress.get(e);a.currentQueue="end",a.queuedAt=r}getNextReviewQuestion(){this.cleanupExpiredEntries();const e=Date.now(),t=this.currentQuestionNumber,s=[];for(const r of this.queues.immediate)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.early)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);for(const r of this.queues.mid)(t>=r.targetQuestionNumber||e>=r.targetTime)&&s.push(r);if(s.sort((r,o)=>o.priority-r.priority),s.length>0){const r=s[0];return this.removeFromQueue(r),r}return null}handleCorrectAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayCorrectCount++,i.consecutiveCorrectStreak++,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!0,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.consecutiveCorrectStreak>=5&&i.dynamicThreshold>Oy&&(i.dynamicThreshold=Math.max(Oy,i.dynamicThreshold-P9),i.lastThresholdAdjustment=Date.now(),console.log(`üìâ ÂãïÁöÑÈñæÂÄ§„Çí‰∏ã„Åí„Åæ„Åó„Åü: ${e} ‚Üí ${i.dynamicThreshold}Âõû`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),t==="immediate"&&this.shouldEnqueueEarly(e,i)?this.enqueueToEarly(e,a,c):t==="early"&&this.shouldEnqueueMid(e,i)?this.enqueueToMid(e,a,c):t==="mid"&&this.shouldEnqueueEnd(e,i)?this.enqueueToEnd(e,a,c):i.todayCorrectCount===1&&t==="immediate"&&this.enqueueToImmediate(e,a,c,1),this.isAcquisitionComplete(e,i)&&(i.isAcquisitionComplete=!0,console.log(`‚úÖ Ë®òÊÜ∂Áç≤ÂæóÂÆå‰∫Ü: ${e}`))}handleWrongAnswer(e,t,s,r,o){if(!this.trackWordAttempts(e))return;const i=this.getAcquisitionProgress(e);i.todayWrongCount++,i.consecutiveCorrectStreak=0,i.totalAttempts++,i.todayReviews.push({timestamp:Date.now(),queueType:t,isCorrect:!1,responseTime:s}),i.correctRate=i.todayCorrectCount/i.totalAttempts,i.dynamicThreshold,i.dynamicThreshold=Math.min(D9,i.dynamicThreshold+_9),i.lastThresholdAdjustment=Date.now(),i.isAcquisitionComplete&&(i.isAcquisitionComplete=!1,console.log(`üîÑ Ë™§Á≠î„Å´„Çà„ÇäÂÆöÁùÄÂÆå‰∫Ü„Çí„É™„Çª„ÉÉ„Éà: ${e}`));let a=r??3,c=o??"memorization";const l=this.findWordInQueues(e);l&&(a=l.difficulty,c=l.category),this.removeFromAllQueues(e),t!=="immediate"&&console.log(`‚ùå Ë™§Á≠î„Å´„Çà„ÇäÂç≥ÊôÇÂæ©Áøí„Ç≠„É•„Éº„Å´Êàª„Åó„Åæ„Åô: ${e}`),this.enqueueToImmediate(e,Math.min(a+1,5),c,1)}startSessionEndReview(){const e=[...this.queues.end];return e.length===0?(console.log("ÁµÇ‰∫ÜÊôÇÂæ©Áøí„Å™„Åó"),[]):(console.log(`ÁµÇ‰∫ÜÊôÇÂæ©Áøí„ÇíÈñãÂßã„Åó„Åæ„ÅôÔºà${e.length}Ë™ûÔºâ`),e)}generateAcquisitionReport(){const e=Array.from(this.acquisitionProgress.keys()),t=[],s=[];for(const r of e)this.acquisitionProgress.get(r).isAcquisitionComplete?t.push(r):s.push(r);return{totalWords:e.length,completed:t.length,incomplete:s.length,completionRate:e.length>0?t.length/e.length:0,incompleteWords:s}}getQueueStatistics(){var e,t,s,r;return{immediate:{size:this.queues.immediate.length,oldestEntry:(e=this.queues.immediate[0])==null?void 0:e.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.immediate)},early:{size:this.queues.early.length,oldestEntry:(t=this.queues.early[0])==null?void 0:t.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.early)},mid:{size:this.queues.mid.length,oldestEntry:(s=this.queues.mid[0])==null?void 0:s.enqueuedAt,averageWaitTime:this.calculateAverageWaitTime(this.queues.mid)},end:{size:this.queues.end.length,oldestEntry:(r=this.queues.end[0])==null?void 0:r.enqueuedAt,averageWaitTime:0}}}getAcquisitionProgress(e){if(!this.acquisitionProgress.has(e)){const t=this.findWordInQueues(e),s=(t==null?void 0:t.category)||"memorization",r=this.tabConfigs[s].consolidationThreshold;this.acquisitionProgress.set(e,{todayFirstSeen:Date.now(),todayCorrectCount:0,todayWrongCount:0,isAcquisitionComplete:!1,currentQueue:null,queuedAt:0,todayReviews:[],dynamicThreshold:r,consecutiveCorrectStreak:0,totalAttempts:0,correctRate:0,lastThresholdAdjustment:Date.now()})}return this.acquisitionProgress.get(e)}incrementQuestionNumber(){this.currentQuestionNumber++}reset(){this.queues={immediate:[],early:[],mid:[],end:[]},this.currentQuestionNumber=0,this.sessionStartTime=Date.now(),this.wordAttempts.clear(),this.acquisitionProgress.clear()}getQueueInfo(e){const t=this.findWordInQueues(e);return t?{queueType:t.queueType,questionNumber:t.targetQuestionNumber}:null}getQueueSizes(){return{immediate:this.queues.immediate.length,early:this.queues.early.length,mid:this.queues.mid.length,end:this.queues.end.length}}exportQueues(){return{immediate:[...this.queues.immediate],early:[...this.queues.early],mid:[...this.queues.mid],end:[...this.queues.end]}}clearQueues(){this.queues.immediate=[],this.queues.early=[],this.queues.mid=[],this.queues.end=[]}recordAnswer(e,t,s){const o=this.getAcquisitionProgress(e).currentQueue||"immediate";t?this.handleCorrectAnswer(e,o,s):this.handleWrongAnswer(e,o,s)}shouldEnqueueImmediate(e){return e>=3}shouldEnqueueEarly(e,t){return t.todayCorrectCount>=1}shouldEnqueueMid(e,t){return t.todayCorrectCount>=2}shouldEnqueueEnd(e,t){return t.todayCorrectCount>=3}calculateImmediateGap(e){return e>=4?1:e===3?2:3}calculateEarlyGap(e){return e>=4?5:e===3?7:10}calculateMidGap(e){return e>=4?20:e===3?25:30}isAcquisitionComplete(e,t){if(t.todayCorrectCount<t.dynamicThreshold)return!1;if(t.correctRate<Ly)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}% < ${(Ly*100).toFixed(0)}%`),!1;if(t.consecutiveCorrectStreak<Wa)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): ÈÄ£Á∂öÊ≠£Á≠îÊï∞ ${t.consecutiveCorrectStreak} < ${Wa}`),!1;const s=new Set(t.todayReviews.filter(i=>i.isCorrect).map(i=>i.queueType));if(s.size<3)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): „Ç≠„É•„ÉºÈÄöÈÅéÊï∞ ${s.size} < 3ÔºàÈñìÈöîÂèçÂæ©„Åå‰∏çË∂≥Ôºâ`),!1;if(t.totalAttempts<6)return console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Á∑èÂá∫È°åÂõûÊï∞ ${t.totalAttempts} < 6`),!1;const r=t.todayReviews.slice(-Wa);return r.length>=Wa&&r.every(i=>i.isCorrect)?(console.log(`‚úÖ ÂÆöÁùÄÂÆå‰∫Ü (${e}): Ê≠£Á≠îÁéá ${(t.correctRate*100).toFixed(1)}%, ÈÄ£Á∂öÊ≠£Á≠î ${t.consecutiveCorrectStreak}, ÈñæÂÄ§ ${t.dynamicThreshold}, Á∑èÂá∫È°å ${t.totalAttempts}Âõû`),!0):(console.log(`‚ùå ÂÆöÁùÄÊú™ÂÆå‰∫Ü (${e}): Áõ¥Ëøë${Wa}Âõû„ÅåÂÖ®„Å¶Ê≠£Á≠î„Åß„ÅØ„Å™„ÅÑ`),!1)}isDuplicateInQueue(e,t){return this.queues[t].some(s=>s.word===e)}enqueueWithLimit(e,t,s){e.length>=s&&e.shift(),e.push(t)}removeFromQueue(e){const t=e.queueType,s=this.queues[t],r=s.findIndex(o=>o.word===e.word);r!==-1&&s.splice(r,1)}removeFromAllQueues(e){for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>s.word!==e)}findWordInQueues(e){for(const t of Object.keys(this.queues)){const s=this.queues[t].find(r=>r.word===e);if(s)return s}return null}cleanupExpiredEntries(){const e=Date.now();for(const t of Object.keys(this.queues))this.queues[t]=this.queues[t].filter(s=>e-s.enqueuedAt>R9?(console.warn(`ÊúüÈôêÂàá„Çå„Ç®„É≥„Éà„É™„ÇíÂâäÈô§: ${s.word}`),!1):!0)}trackWordAttempts(e){this.wordAttempts.has(e)||this.wordAttempts.set(e,0);const t=this.wordAttempts.get(e)+1;this.wordAttempts.set(e,t);const s=this.getAcquisitionProgress(e);return t%50===0&&s.todayCorrectCount<s.dynamicThreshold&&(console.log(`üîÑ ÂçòË™û "${e}" „Çí${t}ÂõûÂá∫È°å„Åó„Åæ„Åó„ÅüÔºàÊ≠£Á≠îÁéá: ${(s.correctRate*100).toFixed(1)}%, ÈñæÂÄ§: ${s.dynamicThreshold}ÂõûÔºâ`),console.log("   ‚úÖ ÂÆöÁùÄ„Åæ„ÅßÁ∂ôÁ∂öÂá∫È°å„Åó„Åæ„ÅôÔºà‰∏çÊ≠£Ëß£„ÅåÁ∂ö„ÅèÈôê„ÇäÊ∞∏ÈÅ†„Å´Âá∫È°åÔºâ")),!0}calculateAverageWaitTime(e){if(e.length===0)return 0;const t=Date.now();return e.reduce((r,o)=>r+(t-o.enqueuedAt),0)/e.length}}const M9={minEaseFactor:1.3,maxEaseFactor:2.5,easeFactorIncrement:.1,easeFactorDecrement:.2,initialInterval:1,forgettingCurveDecay:.5,confidenceWeight:.15};class F9{constructor(e){Ee(this,"retentionData",new Map);Ee(this,"config");this.config={...M9,...e}}getRetentionStatus(e){return this.retentionData.has(e)||this.retentionData.set(e,this.createInitialStatus()),this.retentionData.get(e)}recordReview(e,t){const s=this.getRetentionStatus(e);s.totalReviews++,s.lastReviewDate=t.timestamp,s.lastResponseTime=t.responseTime;const r=.3;return s.averageResponseTime=s.averageResponseTime*(1-r)+t.responseTime*r,t.isCorrect?(s.totalCorrect++,s.consecutiveCorrect++,s.consecutiveWrong=0,this.updateSM2OnCorrect(s,t.confidence)):(s.consecutiveCorrect=0,s.consecutiveWrong++,this.updateSM2OnWrong(s)),s.retentionRate=this.estimateRetentionRate(s),s.forgettingIndex=this.calculateForgettingIndex(s),s}getDueWords(e,t=Date.now()){const s=[];for(const r of e){const o=this.getRetentionStatus(r);if(t>=o.nextReviewDate){const a=(t-o.nextReviewDate)/864e5*o.forgettingIndex;s.push({word:r,priority:a})}}return s.sort((r,o)=>o.priority-r.priority),s.map(r=>r.word)}getReviewSchedule(e,t=7){const s=new Map,r=Date.now();for(const o of e){const i=this.getRetentionStatus(o),a=[];let c=i.nextReviewDate;const l=r+t*864e5;for(;c<=l;)a.push(new Date(c)),c+=i.sm2.interval*864e5;a.length>0&&s.set(o,a)}return s}getRetentionStatistics(e){const t=Date.now();let s=0,r=0,o=0,i=0,a=0,c=0;for(const d of e){const h=this.getRetentionStatus(d);s+=h.retentionRate,r+=h.sm2.easeFactor,o+=h.sm2.interval,t>=h.nextReviewDate&&(i++,(t-h.nextReviewDate)/864e5>1&&a++),h.consecutiveCorrect>=5&&h.sm2.interval>=30&&c++}const l=e.length||1;return{averageRetentionRate:s/l,averageEaseFactor:r/l,averageInterval:o/l,dueCount:i,overdueCount:a,wellLearnedCount:c}}estimateRetentionRate(e){const t=Date.now(),s=(t-e.lastReviewDate)/864e5,r=(e.nextReviewDate-t)/864e5;if(r>=0){const o=Math.exp(-this.config.forgettingCurveDecay*s/e.sm2.interval);return Math.max(.1,Math.min(1,o))}else{const o=-r,i=Math.exp(-this.config.forgettingCurveDecay*(s+o)/e.sm2.interval);return Math.max(.05,Math.min(.9,i))}}reset(){this.retentionData.clear()}importRetentionData(e){this.retentionData=new Map(e)}exportRetentionData(){return new Map(this.retentionData)}createInitialStatus(){return{lastReviewDate:Date.now(),nextReviewDate:Date.now()+this.config.initialInterval*864e5,sm2:{interval:this.config.initialInterval,repetition:0,easeFactor:2.5},retentionRate:1,forgettingIndex:1,totalReviews:0,totalCorrect:0,consecutiveCorrect:0,consecutiveWrong:0,averageResponseTime:0,lastResponseTime:0}}updateSM2OnCorrect(e,t){const s=e.sm2;s.repetition++;const r=this.mapConfidenceToQuality(t),o=s.easeFactor+(.1-(5-r)*(.08+(5-r)*.02));s.easeFactor=Math.max(this.config.minEaseFactor,Math.min(this.config.maxEaseFactor,o)),s.repetition===1?s.interval=1:s.repetition===2?s.interval=6:s.interval=Math.round(s.interval*s.easeFactor),e.lastResponseTime>3e3&&e.lastResponseTime>e.averageResponseTime*1.5&&(s.interval=Math.max(1,Math.round(s.interval*.8))),e.nextReviewDate=e.lastReviewDate+s.interval*864e5}updateSM2OnWrong(e){const t=e.sm2;t.repetition=0,t.easeFactor=Math.max(this.config.minEaseFactor,t.easeFactor-this.config.easeFactorDecrement),t.interval=1,e.nextReviewDate=e.lastReviewDate+t.interval*864e5}mapConfidenceToQuality(e){return Math.max(0,Math.min(5,e))}calculateForgettingIndex(e){const r=(e.totalReviews>0?1-e.totalCorrect/e.totalReviews:0)*2,o=e.averageResponseTime>2e3?(e.averageResponseTime-2e3)/5e3:0,i=Math.min(e.consecutiveWrong*.3,1.5),a=1+r+o+i;return Math.max(.5,Math.min(5,a))}}const O9={minSampleSize:20,confidenceThreshold:.7,learningSpeedWindow:7,forgettingSpeedWindow:30},zy={learningSpeed:1,forgettingSpeed:1,consolidationThreshold:3,responseTimeProfile:{averageResponseTime:2e3,fastThreshold:1e3,slowThreshold:3e3,consistencyScore:.5},confidenceLevel:0,sampleSize:0,lastUpdated:Date.now()};class L9{constructor(e){Ee(this,"config");Ee(this,"parameters");Ee(this,"historyCache",[]);this.config={...O9,...e},this.parameters={...zy}}addHistory(e){this.historyCache.push(e),this.historyCache.length>100&&this.historyCache.shift()}estimateParameters(e){const t=e||this.historyCache;return t.length<this.config.minSampleSize?(this.parameters.sampleSize=t.length,this.parameters.confidenceLevel=0,{...this.parameters}):(this.parameters.learningSpeed=this.estimateLearningSpeed(t),this.parameters.forgettingSpeed=this.estimateForgettingSpeed(t),this.parameters.consolidationThreshold=this.estimateConsolidationThreshold(t),this.parameters.responseTimeProfile=this.estimateResponseTimeProfile(t),this.parameters.confidenceLevel=this.calculateConfidenceLevel(t.length),this.parameters.sampleSize=t.length,this.parameters.lastUpdated=Date.now(),{...this.parameters})}getParameters(){return{...this.parameters}}importParameters(e){this.parameters={...e}}clearHistory(){this.historyCache=[]}estimateLearningSpeed(e){const t=new Map,s=new Map;for(const i of e){const a=i.word;t.has(a)||t.set(a,0),t.set(a,t.get(a)+1),i.isCorrect&&!s.has(a)&&s.set(a,t.get(a))}const r=Array.from(s.values());if(r.length===0)return 1;const o=r.reduce((i,a)=>i+a,0)/r.length;return o<=2?1.8:o<=2.5?1.5:o<=3.5?1:o<=5?.7:.5}estimateForgettingSpeed(e){const t=new Map,s=[];for(const o of e){const i=o.word;if(o.isCorrect)t.set(i,o.timestamp);else if(t.has(i)){const a=t.get(i),c=(o.timestamp-a)/864e5;s.push(c),t.delete(i)}}if(s.length===0)return 1;const r=s.reduce((o,i)=>o+i,0)/s.length;return r>=7?.6:r>=5?.8:r>=3?1:r>=1?1.5:2}estimateConsolidationThreshold(e){const t=new Map,s=new Map,r=[];for(const i of e){const a=i.word;if(t.has(a)||(t.set(a,0),s.set(a,0)),i.isCorrect){const c=t.get(a)+1;t.set(a,c);const l=Math.max(s.get(a),c);s.set(a,l),c===5&&r.push(this.getWordTotalReviews(a,e))}else t.set(a,0)}if(r.length===0)return 3;const o=r.reduce((i,a)=>i+a,0)/r.length;return Math.max(2,Math.min(5,Math.round(o*.6)))}estimateResponseTimeProfile(e){const t=e.map(d=>d.responseTime);if(t.length===0)return zy.responseTimeProfile;const s=t.reduce((d,h)=>d+h,0)/t.length,r=t.reduce((d,h)=>d+Math.pow(h-s,2),0)/t.length,o=Math.sqrt(r),i=Math.max(500,s-o),a=Math.min(5e3,s+o),c=o/s,l=Math.max(0,Math.min(1,1-c));return{averageResponseTime:Math.round(s),fastThreshold:Math.round(i),slowThreshold:Math.round(a),consistencyScore:Math.round(l*100)/100}}calculateConfidenceLevel(e){return e<this.config.minSampleSize?0:e<50?(e-this.config.minSampleSize)/(50-this.config.minSampleSize)*.7:e<100?.7+(e-50)/50*.2:.9+Math.min((e-100)/200*.1,.1)}getWordTotalReviews(e,t){return t.filter(s=>s.word===e).length}}const _I={acquisitionRatio:.6,retentionRatio:.4,adaptiveAdjustment:!0,sessionQuestionNumber:0};class z9{constructor(e=_I){Ee(this,"strategy");Ee(this,"personalParams",null);this.strategy={...e}}setPersonalParameters(e){this.personalParams=e}updateStrategy(e){this.strategy={...this.strategy,...e}}selectNextQuestion(e){if(e.length===0)return null;const t=e.map(r=>this.calculatePriority(r));t.sort((r,o)=>o.priority-r.priority);const s=t.find(r=>r.candidate.queueType!==void 0);return s?s.candidate:this.selectByStrategy(t)}calculatePriority(e){const t={queuePriority:this.calculateQueuePriority(e),phasePriority:this.calculatePhasePriority(e),timingPriority:this.calculateTimingPriority(e),personalPriority:this.calculatePersonalPriority(e)},s=Object.values(t).reduce((o,i)=>o+i,0),r=this.generatePriorityReason(e,t);return{candidate:e,priority:s,breakdown:t,reason:r}}calculateQueuePriority(e){if(!e.queueType)return 0;let s={[Ya.IMMEDIATE]:40,[Ya.EARLY]:30,[Ya.MID]:20,[Ya.END]:10}[e.queueType]||0;if(e.questionNumber!==void 0){const r=Math.max(0,5-e.questionNumber*.5);s+=r}return Math.min(40,s)}calculatePhasePriority(e){return{[qi.ENCODING]:25,[qi.INITIAL_CONSOLIDATION]:30,[qi.INTRADAY_REVIEW]:20,[qi.SHORT_TERM]:15,[qi.LONG_TERM]:10}[e.phase]||0}calculateTimingPriority(e){const t=Date.now();if(e.reviewCount===0&&e.firstSeenTime){const o=(t-e.firstSeenTime)/1e3;return o>=600?15:o>=300?10:o>=120?7:o>=60?5:0}if(!e.nextReviewTime)return 15;const s=t-e.nextReviewTime;if(s>=0){const o=s/36e5;return Math.min(20,10+o*2)}const r=Math.abs(s)/(1e3*60*60);return r<=1?10-r*5:0}calculatePersonalPriority(e){if(!this.personalParams)return 5;let t=5;return e.reviewCount===0&&this.personalParams.learningSpeed<.8&&(t-=2),e.reviewCount===0&&this.personalParams.learningSpeed>1.2&&(t+=2),e.reviewCount>0&&this.personalParams.forgettingSpeed>1.2&&(t+=3),e.reviewCount>0&&this.personalParams.forgettingSpeed<.8&&(t-=2),Math.max(0,Math.min(10,t))}selectByStrategy(e){if(e.length===0)return null;const t=this.calculateAdaptiveBias(),s=e.map(c=>({...c,adjustedPriority:c.candidate.reviewCount===0?c.priority+t:c.priority})),r=s.filter(c=>c.adjustedPriority>=60),o=s.filter(c=>c.adjustedPriority>=30&&c.adjustedPriority<60),i=s.filter(c=>c.adjustedPriority<30),a=r.length>0?r:o.length>0?o:i;return a.length===0?null:(a.sort((c,l)=>{const d=l.adjustedPriority-c.adjustedPriority;if(Math.abs(d)>=5)return d;const h=c.candidate.lastReviewTime||c.candidate.firstSeenTime||0,p=l.candidate.lastReviewTime||l.candidate.firstSeenTime||0;return h===0&&p===0?c.candidate.word.localeCompare(l.candidate.word):h-p}),a[0].candidate)}hashString(e){let t=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}calculateAdaptiveBias(){if(!this.strategy.adaptiveAdjustment||this.strategy.sessionQuestionNumber===void 0)return 0;const e=this.strategy.sessionQuestionNumber;return e<=10?15:e<=20?10:e<=30?5:0}generatePriorityReason(e,t){const s=[];if(e.queueType&&s.push(`„Ç≠„É•„Éº: ${e.queueType}`),s.push(`„Éï„Çß„Éº„Ç∫: ${e.phase}`),e.nextReviewTime){const o=Date.now()-e.nextReviewTime,i=Math.abs(o/(1e3*60*60));o>=0?s.push(`ÈÅÖÂª∂: ${i.toFixed(1)}ÊôÇÈñì`):s.push(`‰∫àÂÆö„Åæ„Åß: ${i.toFixed(1)}ÊôÇÈñì`)}return e.reviewCount===0?s.push("Êñ∞Ë¶èÂçòË™û"):s.push(`Âæ©Áøí${e.reviewCount}ÂõûÁõÆ`),s.join(", ")}getAllPriorities(e){return e.map(t=>this.calculatePriority(t)).sort((t,s)=>s.priority-t.priority)}}function Wy(n,e){return e?{word:n,reviewCount:e.correctCount+e.incorrectCount,correctCount:e.correctCount,wrongCount:e.incorrectCount,lastReviewTime:e.lastStudied||0,lastCorrectTime:e.consecutiveCorrect>0?e.lastStudied:0,averageResponseTime:e.averageResponseTime||0,consecutiveCorrect:e.consecutiveCorrect,consecutiveWrong:e.consecutiveIncorrect}:{word:n,reviewCount:0,correctCount:0,wrongCount:0,lastReviewTime:0,lastCorrectTime:0,averageResponseTime:0,consecutiveCorrect:0,consecutiveWrong:0}}function Mh(n=ja.MEMORIZATION,e){const t=T.useRef(null),s=T.useRef(null),r=T.useRef(null),o=T.useRef(null),i=T.useRef(null),[a,c]=T.useState(0),[l,d]=T.useState({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}});T.useEffect(()=>{_.info("[useAdaptiveLearning] Initializing adaptive learning algorithms",{category:n,sessionId:e}),t.current=new A9,s.current=new j9,r.current=new F9,o.current=new L9,i.current=new z9({..._I,sessionQuestionNumber:0});try{localStorage.getItem(`adaptive-learning-queues-${n}`)&&s.current&&_.debug("[useAdaptiveLearning] Restored queues from localStorage")}catch(g){_.error("[useAdaptiveLearning] Failed to restore queues:",g)}try{if(o.current){const g=o.current.estimateParameters();d(x=>({...x,personalParams:g})),i.current&&i.current.setPersonalParameters(g),_.info("[useAdaptiveLearning] Personal parameters estimated:",g)}}catch(g){_.error("[useAdaptiveLearning] Failed to estimate personal parameters:",g)}return()=>{try{if(s.current){const g=s.current.exportQueues();localStorage.setItem(`adaptive-learning-queues-${n}`,JSON.stringify(g)),_.debug("[useAdaptiveLearning] Saved queues to localStorage")}}catch(g){_.error("[useAdaptiveLearning] Failed to save queues:",g)}}},[n,e]);const h=T.useCallback(g=>{if(!i.current||!t.current||!s.current)return _.warn("[useAdaptiveLearning] Algorithms not initialized"),g.length>0?g[0]:null;try{const x=g.map(b=>{const v=Vu(b.word),w=Wy(b.word,v),S=t.current.detectPhase(b.word,w),N=s.current.getQueueInfo(b.word);return{id:b.word,word:b.word,category:n,phase:S,reviewCount:w.reviewCount,correctCount:w.correctCount,lastReviewTime:w.lastReviewTime||Date.now(),queueType:N==null?void 0:N.queueType,questionNumber:N==null?void 0:N.questionNumber,difficulty:parseInt(b.difficulty)||3}});i.current.updateStrategy({sessionQuestionNumber:a});const y=i.current.selectNextQuestion(x);if(y){const b=g.find(v=>v.word===y.word);return c(v=>v+1),d(v=>({...v,currentPhase:y.phase,sessionProgress:{totalQuestions:v.sessionProgress.totalQuestions+1,newWords:v.sessionProgress.newWords+(y.reviewCount===0?1:0),reviews:v.sessionProgress.reviews+(y.reviewCount>0?1:0)}})),_.debug("[useAdaptiveLearning] Selected question:",{word:y.word,phase:y.phase,queueType:y.queueType}),b||null}return null}catch(x){return _.error("[useAdaptiveLearning] Error selecting question:",x),g.length>0?g[0]:null}},[n,a]),p=T.useCallback((g,x,y)=>{try{if(t.current){const b=Vu(g),v=Wy(g,b),w=t.current.detectPhase(g,v);d(S=>({...S,currentPhase:w}))}if(s.current){s.current.recordAnswer(g,x,y);const b=s.current.getQueueSizes();d(v=>({...v,queueSizes:b}))}if(r.current&&r.current.recordReview(g,{isCorrect:x,confidence:x?3:0,responseTime:y,timestamp:Date.now()}),o.current&&(o.current.addHistory({word:g,timestamp:Date.now(),isCorrect:x,responseTime:y,reviewNumber:1,daysSinceFirstSeen:0}),a>0&&a%20===0)){const b=o.current.estimateParameters();d(v=>({...v,personalParams:b})),i.current&&i.current.setPersonalParameters(b),_.info("[useAdaptiveLearning] Personal parameters updated:",b)}_.debug("[useAdaptiveLearning] Recorded answer:",{word:g,isCorrect:x,responseTime:y})}catch(b){_.error("[useAdaptiveLearning] Error recording answer:",b)}},[a]),f=T.useCallback(()=>{_.info("[useAdaptiveLearning] Resetting adaptive learning algorithms"),c(0),d({currentPhase:null,personalParams:null,queueSizes:{immediate:0,early:0,mid:0,end:0},sessionProgress:{totalQuestions:0,newWords:0,reviews:0}}),s.current&&s.current.clearQueues(),o.current&&o.current.clearHistory()},[]),m=T.useCallback(()=>{var g;return{sessionQuestionCount:a,state:l,queues:((g=s.current)==null?void 0:g.exportQueues())||null,personalParams:l.personalParams}},[a,l]);return{selectNextQuestion:h,recordAnswer:p,state:l,reset:f,getDebugInfo:m}}function W9({quizState:n,_categoryList:e,selectedCategory:t,onCategoryChange:s,selectedDifficulty:r,onDifficultyChange:o,selectedWordPhraseFilter:i="all",onWordPhraseFilterChange:a,selectedPhraseTypeFilter:c="all",onPhraseTypeFilterChange:l,selectedDataSource:d="all",onDataSourceChange:h,questionSets:p=[],onStartQuiz:f,onAnswer:m,onNext:g,onPrevious:x,onSkip:y,onDifficultyRate:b,onReviewFocus:v,sessionStats:w,isReviewFocusMode:S=!1,errorPrediction:N,customQuestionSets:C=[],onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:$}){var J,de;const{questions:j,currentIndex:P,answered:O,selectedAnswer:A}=n,z=j.length>0,L=z?j[P]:null,[U,V]=T.useState(!1),[B,Y]=T.useState(!1),[K,pe]=T.useState(!1),[ge,re]=T.useState(Date.now()),[ye,Ae]=T.useState(void 0),[ve,_e]=T.useState(void 0),[ze,et]=T.useState(0),[ut,yt]=T.useState(0),bt=Mh(ja.TRANSLATION),{learningLimit:$t,reviewLimit:ae,setLearningLimit:le,setReviewLimit:G}=_0("translation"),[oe,he]=T.useState(()=>localStorage.getItem("autoNext")==="true"),[Te,Se]=T.useState(()=>{const me=localStorage.getItem("autoNextDelay");return me?parseInt(me,10):1500}),[te,Fe]=T.useState(()=>localStorage.getItem("autoShowDetails")!=="false"),Le=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:me}=await gs(async()=>{const{resetAllProgress:Me}=await Promise.resolve().then(()=>ei);return{resetAllProgress:Me}},void 0);await me(),_.info("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(me){_.error("[TranslationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",me),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},{getRequeuedWords:De}=jl(),Ke=()=>{pe(!0)},pt=async(me,Me)=>{const Ie=me===Me;Ae(Ie),_e(L==null?void 0:L.word),Ie?(et(tt=>tt+1),yt(0)):(yt(tt=>tt+1),et(0)),await m(me,Me),re(Date.now()),L!=null&&L.word&&bt.recordAnswer(L.word,Ie,3e3),oe&&Ie&&setTimeout(()=>{_e(void 0),g()},Te)},R=()=>{_e(void 0),g()},D=async()=>{y&&(await y(),re(Date.now()))},F=localStorage.getItem("learning-schedule-90days"),M=!!F;let X=null;if(M)try{const me=JSON.parse(F),Me=Math.floor((Date.now()-me.startDate)/(1e3*60*60*24)),Ie=Math.min(Me+1,me.totalDays),tt=Math.round(Ie/me.totalDays*100);X={currentDay:Ie,totalDays:me.totalDays,progressPercent:tt,phase:me.phase}}catch(me){_.error("Failed to parse learning plan:",me)}const ue=()=>{Y(!B)};return B&&z&&L?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:ue,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4",children:u.jsx(Ry,{question:L,questionNumber:P+1,allQuestions:j,currentIndex:P,answered:O,selectedAnswer:A,onAnswer:pt,onNext:y?O?R:D:R,onPrevious:x,onDifficultyRate:b,errorPrediction:N,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:$,onFullscreen:ue})})]})}):u.jsxs("div",{className:"quiz-view",children:[M&&X&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[X.currentDay,"Êó•ÁõÆ / ",X.totalDays,"Êó• (Phase ",X.phase,") -"," ",X.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),z&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(_h,{mode:"translation",currentScore:n.score,totalAnswered:n.totalAnswered,sessionCorrect:w==null?void 0:w.correct,sessionIncorrect:w==null?void 0:w.incorrect,sessionReview:w==null?void 0:w.review,sessionMastered:w==null?void 0:w.mastered,sessionStats:w,onReviewFocus:v,isReviewFocusMode:S,onShowSettings:()=>V(!0),currentWord:L==null?void 0:L.word,onAnswerTime:ge,lastAnswerCorrect:ye,lastAnswerWord:ve,lastAnswerDifficulty:L==null?void 0:L.difficulty,correctStreak:ze,incorrectStreak:ut,learningPhase:bt.state.currentPhase??void 0,estimatedSpeed:(J=bt.state.personalParams)==null?void 0:J.learningSpeed,dataSource:((de=p==null?void 0:p.find(me=>me.id===d))==null?void 0:de.name)||"ÂÖ®ÂïèÈ°åÈõÜ",onResetProgress:Le,onDebugRequeue:Ke,category:t==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":t,difficulty:r,wordPhraseFilter:i})})}),U&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>V(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-quiz",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-quiz",value:t,onChange:me=>s(me.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),BI.map(me=>u.jsx("option",{value:me,children:me},me))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-quiz",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-quiz",value:r,onChange:me=>o(me.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),h&&p&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-quiz",children:"üìö Âá∫È°åÂÖÉ:"}),u.jsx("select",{id:"data-source-select-quiz",value:d,onChange:me=>h(me.target.value),className:"select-input",children:p.map(me=>u.jsx("option",{value:me.id,children:me.name},me.id))})]}),a&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-quiz",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-quiz",value:i,onChange:me=>a(me.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),l&&i==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-quiz",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-quiz",value:c,onChange:me=>l(me.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsx(D0,{learningLimit:$t,reviewLimit:ae,onLearningLimitChange:le,onReviewLimitChange:G,idPrefix:"quiz-"}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle",checked:oe,onChange:me=>{he(me.target.checked),localStorage.setItem("autoNext",me.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",oe?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),oe&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay",min:"500",max:"3000",step:"100",value:Te,onChange:me=>{const Me=parseInt(me.target.value,10);Se(Me),localStorage.setItem("autoNextDelay",Me.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(Te/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-show-details-toggle",checked:te,onChange:me=>{Fe(me.target.checked),localStorage.setItem("autoShowDetails",me.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-show-details-toggle",className:"checkbox-label",children:["‰∏çÊ≠£Ëß£ÊôÇËá™Âãï„ÅßË©≥Á¥∞„ÇíÈñã„ÅèÔºö",te?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:ue,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),L&&u.jsx(u.Fragment,{children:u.jsx(Ry,{question:L,questionNumber:P+1,allQuestions:j,currentIndex:P,answered:O,selectedAnswer:A,onAnswer:pt,onNext:y?O?R:D:R,onPrevious:x,onDifficultyRate:b,errorPrediction:N,customQuestionSets:C,onAddWordToCustomSet:k,onRemoveWordFromCustomSet:I,onOpenCustomSetManagement:$})})]})})})]}),K&&u.jsx(jh,{mode:"translation",currentIndex:P,totalQuestions:j.length,questions:j,requeuedWords:De(j,P)})]})}function B9(n){const[e,t]=T.useState({questions:[],currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""}),[s,r]=T.useState([]),[o,i]=T.useState([]),[a,c]=T.useState([]),[l,d]=T.useState(0),[h,p]=T.useState([]),f=T.useRef(0);return T.useEffect(()=>{n.length>0&&t({questions:n,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedLetters:[],correctWord:""})},[n]),T.useEffect(()=>{if(e.questions.length>0){const w=e.questions[e.currentIndex].word.toLowerCase();if(w.includes(" ")){const S=w.split(/\s+/);c(S),d(0),p([]);const C=[...S[0].split("")].sort(()=>Math.random()-.5);r(C),t(k=>({...k,correctWord:w.replace(/\s+/g,""),answered:!1}))}else{c([]),d(0),p([]);const N=[...w.split("")].sort(()=>Math.random()-.5);r(N),t(C=>({...C,correctWord:w,answered:!1}))}i([]),f.current=Date.now()}},[e.currentIndex,e.questions]),{spellingState:e,setSpellingState:t,shuffledLetters:s,selectedSequence:o,setSelectedSequence:i,phraseWords:a,currentWordIndex:l,completedWords:h,handleLetterClick:v=>{if(e.answered){if(o.includes(`${v}`))i(o.filter(S=>S!==`${v}`));else{const S=[...o,`${v}`];i(S)}return}if(o.includes(`${v}`))return;const w=[...o,`${v}`];return i(w),w.length===s.length?w:null},checkAnswer:v=>{const w=v.map(N=>s[parseInt(N)]).join(""),S=Date.now()-f.current;if(a.length>0){const N=a[l];if(w===N){const k=[...h,w];if(p(k),l<a.length-1){const I=l+1;d(I);const j=[...a[I].split("")].sort(()=>Math.random()-.5);return r(j),i([]),{isPartialCorrect:!0,isComplete:!1,userWord:w,responseTime:S}}else{const I=k.join("");return{isPartialCorrect:!0,isComplete:!0,isCorrect:I===e.correctWord,userWord:I,responseTime:S}}}else return{isPartialCorrect:!1,isComplete:!0,isCorrect:!1,userWord:[...h,w].join(""),responseTime:S}}else return{isComplete:!0,isCorrect:w===e.correctWord,userWord:w,responseTime:S}},moveToNextQuestion:()=>{t(v=>({...v,currentIndex:v.currentIndex+1,answered:!1}))},updateScore:v=>{t(w=>({...w,score:v?w.score+1:w.score,totalAnswered:w.totalAnswered+1,answered:!0}))},resetAnswer:()=>{if(i([]),t(v=>({...v,answered:!1})),a.length>0){const w=[...a[l].split("")].sort(()=>Math.random()-.5);r(w)}else{const S=[...e.questions[e.currentIndex].word.toLowerCase().split("")].sort(()=>Math.random()-.5);r(S)}f.current=Date.now()}}}function V9(){const[n,e]=T.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0});return{sessionStats:n,setSessionStats:e,resetStats:()=>{e({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0})},updateStats:r=>{e(o=>({...o,correct:o.correct+(r==="correct"?1:0),incorrect:o.incorrect+(r==="incorrect"?1:0),review:o.review+(r==="review"?1:0),mastered:o.mastered+(r==="mastered"?1:0)}))}}}function U9({questions:n,_categoryList:e,selectedCategory:t,onCategoryChange:s,selectedDifficulty:r,onDifficultyChange:o,selectedWordPhraseFilter:i="all",onWordPhraseFilterChange:a,selectedPhraseTypeFilter:c="all",onPhraseTypeFilterChange:l,selectedDataSource:d="all",onDataSourceChange:h,onStartQuiz:p,onReviewFocus:f,isReviewFocusMode:m=!1,customQuestionSets:g=[],onAddWordToCustomSet:x,onRemoveWordFromCustomSet:y,onOpenCustomSetManagement:b}){var nn,Mt,Xe;const{learningLimit:v,reviewLimit:w,setLearningLimit:S,setReviewLimit:N}=_0("spelling"),[C,k]=T.useState([]),{spellingState:I,setSpellingState:$,shuffledLetters:j,selectedSequence:P,setSelectedSequence:O,phraseWords:A,completedWords:z,handleLetterClick:L,checkAnswer:U,moveToNextQuestion:V,updateScore:B}=B9(C),{sessionStats:Y,setSessionStats:K,resetStats:pe,updateStats:ge}=V9(),re=Mh(ja.SPELLING),{processQuestion:ye}=Ph(),Ae=async($e,Oe)=>{try{const ht=()=>{const Qe=new Date().getHours();return Qe<12?"morning":Qe<18?"afternoon":Qe<22?"evening":"night"},se=()=>{const Qe=I.questions[I.currentIndex];if(!Qe)return .5;const Ft=(Qe.grade||1)/9;return Math.min(Math.max(Ft,0),1)},Ne=()=>JSON.parse(sessionStorage.getItem("recentAnswers")||"[]").filter(Ft=>!Ft.correct).length,Be=()=>{const Qe=sessionStorage.getItem("sessionStartTime");return Qe?Math.floor((Date.now()-parseInt(Qe))/6e4):0},rt=()=>D,ot=await ye($e,Oe?"correct":"incorrect",{currentDifficulty:se(),timeOfDay:ht(),recentErrors:Ne(),sessionLength:Be(),consecutiveCorrect:rt()});console.log("[AdaptiveAI]",ot.reason,{strategy:ot.strategy,confidence:ot.confidence})}catch(ht){console.error("[SpellingView] Adaptive AI error:",ht)}},[ve]=T.useState(()=>{const $e=new Pl;return localStorage.getItem("enable-ai-coordination")==="true"&&($e.enableAICoordination(!0),_.info("ü§ñ [SpellingView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),$e}),{reAddQuestion:_e,clearExpiredFlags:ze,updateRequeueStats:et,getRequeuedWords:ut,checkPositionMismatch:yt}=jl(),[bt,$t]=T.useState(!1),[ae,le]=T.useState(!1),[G,oe]=T.useState(!1),[he,Te]=T.useState(Date.now()),[Se,te]=T.useState(0),[Fe,Le]=T.useState(!1),[De,Ke]=T.useState(void 0),[pt,R]=T.useState(void 0),[D,F]=T.useState(0),[M,X]=T.useState(0),[ue,J]=T.useState(()=>localStorage.getItem("autoNext")==="true"),[de,me]=T.useState(()=>{const $e=localStorage.getItem("autoNextDelay");return $e?parseInt($e,10):1500}),Me=T.useRef(null),Ie=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:$e}=await gs(async()=>{const{resetAllProgress:Oe}=await Promise.resolve().then(()=>ei);return{resetAllProgress:Oe}},void 0);await $e(),pe(),F(0),X(0),console.log("‚úÖ [„Çπ„Éö„É´„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch($e){console.error("‚ùå [„Çπ„Éö„É´„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",$e),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},tt=()=>{oe(!0)},Z=T.useRef(0),xe=T.useRef(0),ke=T.useRef([]);T.useEffect(()=>{(async()=>{if(n.length===0){k([]);return}Z.current=Date.now(),ke.current=[],pe();const Oe=await ve.schedule({questions:n,mode:"spelling",limits:{learningLimit:v,reviewLimit:w},sessionStats:{correct:Y.correct,incorrect:Y.incorrect,still_learning:0,mastered:Y.mastered||0,duration:Date.now()-Z.current},useMetaAI:!0,isReviewFocusMode:m||!1}),ht=Oe.scheduledQuestions;Oe.vibrationScore>50&&_.warn("[SpellingView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:Oe.vibrationScore,processingTime:Oe.processingTime}),k(ht),te(0),Le(!1),_.log("[SpellingView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:ht.length,vibrationScore:Oe.vibrationScore})})()},[n,v,w,m,ve]),T.useEffect(()=>{if(!Fe||I.questions.length===0)return;const $e=I.currentIndex;(async()=>{try{const ht=I.questions.slice($e);if(ht.length===0){Le(!1);return}_.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:Se,currentIndex:$e,remaining:ht.length});const se=await ve.schedule({questions:ht,mode:"spelling",limits:{learningLimit:v,reviewLimit:w},sessionStats:{correct:Y.correct,incorrect:Y.incorrect,still_learning:0,mastered:Y.mastered||0,duration:Date.now()-Z.current},useMetaAI:!0,isReviewFocusMode:m||!1});$(Ne=>Ne.currentIndex!==$e?Ne:{...Ne,questions:[...Ne.questions.slice(0,$e),...se.scheduledQuestions]}),te(0),Le(!1),_.info("[SpellingView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:se.scheduledQuestions.length})}catch(ht){_.error("[SpellingView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",ht),Le(!1)}})()},[Fe,I.currentIndex,I.questions,ve,v,w,Y,m,Se]),T.useEffect(()=>{if(!I.answered&&Me.current){const $e=setTimeout(()=>{var Oe;(Oe=Me.current)==null||Oe.focus()},100);return()=>clearTimeout($e)}},[I.answered,I.currentIndex,I.questions.length]);const ie=($e,Oe)=>{const ht=L(Oe);ht&&ht.length===j.length&&setTimeout(()=>We(ht),300)},We=async $e=>{const Oe=U($e);Oe&&(Oe.isPartialCorrect&&!Oe.isComplete||Oe.isComplete&&await vt(Oe.userWord,Oe.isCorrect||!1,Oe.responseTime))},vt=async($e,Oe,ht)=>{var rt;const se=I.questions[I.currentIndex];Ke(Oe),R(se.word),Oe?(F(ot=>ot+1),X(0)):(X(ot=>ot+1),F(0));const Ne=Oe?0:M+1;if(!Fe&&Ne>=5&&Le(!0),se){await Co(se.word,Oe,ht,void 0,"spelling"),Te(Date.now()),re.recordAnswer(se.word,Oe,ht),await Ae(se.word,Oe);const Qe=(rt=(await is()).wordProgress)==null?void 0:rt[se.word];let Ft=Oe?"correct":"incorrect";Qe&&Qe.masteryLevel==="mastered"?Ft="mastered":!Oe&&Qe&&Qe.incorrectCount>=2&&(Ft="review"),ge(Ft),xa({status:Ft,word:se.word,timestamp:Date.now()},"spelling"),Qe&&Qe.skippedCount&&Qe.skippedCount>0&&(Oe?NI(se.word):CI(se.word))}!Oe&&se&&ke.current.push(se.word);let Be=I.questions;if(!Oe&&se){const ot=_e(se,I.questions,I.currentIndex,"spelling");Be=ot,ot!==I.questions&&$(Qe=>({...Qe,questions:ot}))}if(te(ot=>{const Qe=ot+1;return Qe>=50?(Le(!0),0):(Qe%10===0&&yt(Be,"spelling").needsRescheduling&&Le(!0),Qe)}),se){const ot=String(se.word);Wr.onShown(ot),Wr.onAnswer(ot,Oe),et(se,Y,K)}B(Oe),se&&pc({id:fc(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:Oe?1:0,total:1,percentage:Oe?100:0,date:Date.now(),timeSpent:Math.floor(ht/1e3),incorrectWords:Oe?[]:[se.word],mode:"spelling"})},dt=()=>{const $e=I.currentIndex+1;if($e<I.questions.length){const Oe=ze(I.questions,$e-1);Oe!==I.questions&&$(ht=>({...ht,questions:Oe}))}if($e>=I.questions.length&&!window.location.hostname.includes("github.io"))try{const Oe=Wr.summarize();_.log("üß™ KPI Summary (spelling):",Oe)}catch{}R(void 0),$e<I.questions.length?V():$(Oe=>({...Oe,answered:!1}))},st=async()=>{const $e=I.questions[I.currentIndex];if(!$e)return;if(I.answered){dt();return}const Oe=Date.now()-xe.current;console.log("[SpellingView] SkipÂá¶ÁêÜÈñãÂßã:",{word:$e.word,responseTime:Oe,currentScore:I.score,totalAnswered:I.totalAnswered}),Ke(!0),R($e.word),F(ht=>ht+1),X(0),Eh($e.word,30),SI($e.word),await Co($e.word,!0,Oe,void 0,"spelling"),Te(Date.now()),O([]),$(ht=>({...ht,totalAnswered:ht.totalAnswered+1,score:ht.score+1,answered:!1})),ge("correct"),ge("mastered"),xa({status:"correct",word:$e.word,timestamp:Date.now()},"spelling"),console.log("[SpellingView] SkipÂá¶ÁêÜÂÆå‰∫Ü:",{word:$e.word,newScore:I.score+1,newTotalAnswered:I.totalAnswered+1}),pc({id:fc(),questionSetId:"spelling-quiz-single",questionSetName:"„Çπ„Éö„É´„ÇØ„Ç§„Ç∫",score:1,total:1,percentage:100,date:Date.now(),timeSpent:Math.floor(Oe/1e3),incorrectWords:[],mode:"spelling",difficulty:$e.difficulty}),dt(),te(ht=>{const se=ht+1;return se>=50?(Le(!0),0):(se%10===0&&yt(I.questions,"spelling").needsRescheduling&&Le(!0),se)})},Xt=()=>{O([]),$($e=>({...$e,currentIndex:$e.currentIndex>0?$e.currentIndex-1:0,answered:!1})),xe.current=Date.now()},ft=()=>{if(P.length>0){const $e=P.slice(0,-1);O($e)}},Ge=I.questions.length>0,nt=Ge?I.questions[I.currentIndex]:null,at=P.map($e=>j[parseInt($e)]).join(""),jt=nt?{word:nt.word,meaning:nt.meaning,katakana:nt.reading,source:"spelling"}:null,Pt=localStorage.getItem("learning-schedule-90days"),Yt=!!Pt;let mt=null;if(Yt)try{const $e=JSON.parse(Pt),Oe=Math.floor((Date.now()-$e.startDate)/(1e3*60*60*24)),ht=Math.min(Oe+1,$e.totalDays),se=Math.round(ht/$e.totalDays*100);mt={currentDay:ht,totalDays:$e.totalDays,progressPercent:se,phase:$e.phase}}catch($e){_.error("Failed to parse learning plan:",$e)}return u.jsxs("div",{className:"spelling-view",children:[Yt&&mt&&u.jsx("div",{className:"plan-progress-banner",children:u.jsxs("div",{className:"plan-progress-content",children:[u.jsx("span",{className:"plan-progress-icon",children:"üìö"}),u.jsxs("div",{className:"plan-progress-info",children:[u.jsx("div",{className:"plan-progress-title",children:"Â≠¶Áøí„Éó„É©„É≥ÈÄ≤Ë°å‰∏≠"}),u.jsxs("div",{className:"plan-progress-detail",children:[mt.currentDay,"Êó•ÁõÆ / ",mt.totalDays,"Êó• (Phase ",mt.phase,") -"," ",mt.progressPercent,"%ÂÆå‰∫Ü"]})]})]})}),!Ge&&u.jsx("div",{className:"quiz-controls",children:u.jsx("button",{onClick:p,className:"w-64 px-8 py-4 text-lg font-bold bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-xl:bg-primary-hover",children:"üéØ „ÇØ„Ç§„Ç∫ÈñãÂßã"})}),Ge?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(_h,{mode:"spelling",currentScore:I.score,totalAnswered:I.totalAnswered,sessionCorrect:Y.correct,sessionIncorrect:Y.incorrect,sessionReview:Y.review,sessionMastered:Y.mastered,sessionStats:Y,onReviewFocus:f,isReviewFocusMode:m,onShowSettings:()=>$t(!0),onResetProgress:Ie,onDebugRequeue:tt,currentWord:(nn=I.questions[I.currentIndex])==null?void 0:nn.word,onAnswerTime:he,lastAnswerCorrect:De,lastAnswerWord:pt,lastAnswerDifficulty:(Mt=I.questions[I.currentIndex])==null?void 0:Mt.difficulty,correctStreak:D,incorrectStreak:M,learningPhase:re.state.currentPhase??void 0,estimatedSpeed:(Xe=re.state.personalParams)==null?void 0:Xe.learningSpeed,dataSource:d==="all"?"ÂÖ®ÂïèÈ°åÈõÜ":d==="junior"?"È´òÊ†°ÂèóÈ®ì":"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ",category:t==="ÂÖ®ÂàÜÈáé"?"ÂÖ®ÂàÜÈáé":t,difficulty:r,wordPhraseFilter:i})})}),bt&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>$t(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 text-sm shadow-sm:bg-gray-600:border-gray-500",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"category-select-spelling",children:"üìö Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"category-select-spelling",value:t,onChange:$e=>s($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÂàÜÈáé"}),BI.map($e=>u.jsx("option",{value:$e,children:$e},$e))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-select-spelling",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-select-spelling",value:r,onChange:$e=>o($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆ„É¨„Éô„É´"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),h&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"data-source-select-spelling",children:"üìö ÂïèÈ°åÈõÜ:"}),u.jsxs("select",{id:"data-source-select-spelling",value:d,onChange:$e=>h($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"junior",children:"È´òÊ†°ÂèóÈ®ì"}),u.jsx("option",{value:"intermediate",children:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ"})]})]}),a&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"word-phrase-filter-spelling",children:"üìñ ÂçòË™û/ÁÜüË™û:"}),u.jsxs("select",{id:"word-phrase-filter-spelling",value:i,onChange:$e=>a($e.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"words-only",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases-only",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),l&&i==="phrases-only"&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"phrase-type-filter-spelling",children:"üè∑Ô∏è ÁÜüË™û„Çø„Ç§„Éó:"}),u.jsxs("select",{id:"phrase-type-filter-spelling",value:c,onChange:$e=>{l&&l($e.target.value)},className:"select-input",children:[u.jsx("option",{value:"all",children:"„Åô„Åπ„Å¶"}),u.jsx("option",{value:"phrasal-verb",children:"Âè•ÂãïË©û"}),u.jsx("option",{value:"idiom",children:"„Ç§„Éá„Ç£„Ç™„É†"}),u.jsx("option",{value:"collocation",children:"„Ç≥„É≠„Ç±„Éº„Ç∑„Éß„É≥"}),u.jsx("option",{value:"other",children:"„Åù„ÅÆ‰ªñ"})]})]}),u.jsx(D0,{learningLimit:v,reviewLimit:w,onLearningLimitChange:S,onReviewLimitChange:N,idPrefix:"spelling-quiz-"})]}),nt&&u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>le(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row meaning-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:Xt,disabled:I.currentIndex===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"meaning-display",children:[u.jsxs("div",{className:"meaning-line",children:[u.jsx("span",{className:"text-xl text-gray-600",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"text-4xl font-bold text-gray-900 ml-2",children:nt.meaning})]}),u.jsxs("div",{className:"meaning-meta",children:[nt.difficulty&&u.jsx("div",{className:`difficulty-badge ${nt.difficulty}`,children:nt.difficulty==="beginner"?"ÂàùÁ¥ö":nt.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),jt&&x&&y&&b&&g&&u.jsx("div",{className:"mt-3 flex justify-center",children:u.jsx(oi,{word:jt,sets:g,onAddWord:x,onRemoveWord:y,onOpenManagement:b,size:"medium",variant:"both"})}),nt.word.includes(" ")&&u.jsxs("div",{className:"phrase-hint",children:["üí° ÁÜüË™û(",A.length,"Ë™û): ÂçòË™û„Åî„Å®„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",z.length>0&&u.jsxs("span",{className:"phrase-progress",children:[" ","(ÂÆåÊàê: ",z.join(" "),")"]})]})]})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:I.answered?dt:st,disabled:I.currentIndex>=I.questions.length-1,title:I.answered?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó",children:"‚Üí"})]}),u.jsx("div",{className:"question-content-inline",children:u.jsxs("div",{className:"user-word-display",children:[u.jsx("div",{className:"user-word-label",children:"„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà:"}),u.jsx("div",{className:"user-word-text",children:A.length>0?u.jsxs(u.Fragment,{children:[z.join(" "),z.length>0&&" ",at||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"]}):at||"Ôºà‰∏¶„Å≥Êõø„ÅàÔºâ"})]})}),u.jsx("div",{className:"letter-cards",ref:Me,tabIndex:0,onKeyDown:$e=>{if(I.answered)$e.key==="Enter"&&($e.preventDefault(),dt());else{const Oe=$e.key.toLowerCase();if(Oe.length===1&&Oe>="a"&&Oe<="z"){$e.preventDefault();const ht=j.findIndex((se,Ne)=>se===Oe&&!P.includes(`${Ne}`));ht!==-1&&ie(Oe,ht)}else $e.key==="Backspace"?($e.preventDefault(),ft()):($e.key===" "||$e.key==="Enter")&&($e.preventDefault(),st())}},children:j.map(($e,Oe)=>{const ht=P.includes(`${Oe}`),se=P.indexOf(`${Oe}`)+1;let Ne="";return I.answered&&ht&&(Ne=P.map(ot=>j[parseInt(ot)]).join("")===I.correctWord?"correct":"incorrect"),u.jsxs("button",{className:`letter-card ${ht?"selected":""} ${I.answered?"practice-mode":""} ${Ne}`,onClick:()=>ie($e,Oe),children:[$e,ht&&u.jsx("span",{className:"selection-number",children:se})]},Oe)})}),!I.answered&&u.jsxs("div",{className:"spelling-reset-button-container",children:[P.length>0&&u.jsx("button",{className:"btn-reset-selection",onClick:ft,children:"‚å´ 1ÊñáÂ≠óÊàª„Åô"}),u.jsx("button",{className:"btn-skip-word",onClick:st,children:"‚è≠Ô∏è ÂàÜ„Åã„Çâ„Å™„ÅÑ („Çπ„Éö„Éº„Çπ„Ç≠„Éº)"})]}),I.answered&&u.jsxs("div",{className:"result-display",children:[u.jsxs("div",{className:"correct-answer",children:[at===I.correctWord?"‚úÖ Ê≠£Ëß£: ":at===""?"‚è≠Ô∏è „Çπ„Ç≠„ÉÉ„Éó - Ê≠£Ëß£: ":"‚ùå ‰∏çÊ≠£Ëß£ - Ê≠£Ëß£: ",u.jsxs("strong",{className:xn()?"clickable-word":"",onClick:$e=>{$e.stopPropagation(),xn()&&nt&&Ts(nt.word,{rate:.85})},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":void 0,children:[(nt==null?void 0:nt.word)||I.correctWord,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"}),(nt==null?void 0:nt.reading)&&u.jsxs("span",{className:"pronunciation-hint",children:["(",nt.reading,")"]})]})]}),u.jsxs("div",{className:"question-details-spelling",children:[nt.reading&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>xn()&&Ts(nt.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Ë™≠„Åø:"}),u.jsx("span",{className:"detail-content",children:nt.reading})]}),u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"ÊÑèÂë≥:"}),u.jsx("span",{className:"detail-content",children:nt.meaning})]}),nt.etymology&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üìö Ë™ûÊ∫êÁ≠âËß£Ë™¨:"}),u.jsx("span",{className:"detail-content",children:nt.etymology})]}),nt.relatedWords&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üîó Èñ¢ÈÄ£Ë™û:"}),u.jsx("span",{className:"detail-content",children:nt.relatedWords})]}),nt.relatedFields&&u.jsxs("div",{className:"detail-row",children:[u.jsx("span",{className:"detail-label",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsx("span",{className:"detail-content",children:nt.relatedFields})]}),nt.difficulty&&u.jsxs("div",{className:"detail-row clickable-row",onClick:()=>xn()&&Ts(nt.word,{rate:.85}),title:"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥ üîä",children:[u.jsx("span",{className:"detail-label",children:"Èõ£ÊòìÂ∫¶:"}),u.jsx("div",{className:`difficulty-badge ${nt.difficulty}`,children:nt.difficulty==="beginner"?"ÂàùÁ¥ö":nt.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]})]})]})]})]}):u.jsx("div",{className:"empty-state",children:u.jsx("p",{children:"üìñ Êù°‰ª∂„ÇíÈÅ∏Êäû„Åó„Å¶„Äå„ÇØ„Ç§„Ç∫ÈñãÂßã„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})}),G&&u.jsx(jh,{mode:"spelling",currentIndex:I.currentIndex,totalQuestions:I.questions.length,questions:I.questions,requeuedWords:ut(I.questions,I.currentIndex)})]})}function G9(n){const e=n.split("/").pop()||"",s=e.replace(/\.txt$/,"").split("_");return s.length>=3?s.slice(2).join("_"):e}const H9=[{id:"beginner-morning-routine",level:"beginner",topic:"daily-life",wordCount:50,filePath:"/data/passages-for-phrase-work/beginner_50_Morning-Routine.txt"},{id:"beginner-supermarket-shopping",level:"beginner",topic:"daily-life",wordCount:1910,filePath:"/data/passages-for-phrase-work/beginner_1910_Shopping-at-the-Supermarket.txt"},{id:"beginner-cafe-day",level:"beginner",topic:"food-culture",wordCount:1380,filePath:"/data/passages-for-phrase-work/beginner_1380_A-Day-at-the-Cafe.txt"},{id:"beginner-conversation-daily",level:"beginner",topic:"communication",wordCount:3018,filePath:"/data/passages-for-phrase-work/beginner_3018_Daily-Conversations.txt"},{id:"beginner-weather-seasons",level:"beginner",topic:"nature",wordCount:2111,filePath:"/data/passages-for-phrase-work/beginner_2111_Weather-and-Seasons.txt"},{id:"beginner-wildlife-park-guide",level:"beginner",topic:"animals",wordCount:2097,filePath:"/data/passages-for-phrase-work/beginner_2097_Wildlife-Park-Guide.txt"},{id:"intermediate-exchange-student-australia",level:"intermediate",topic:"culture-exchange",wordCount:3199,filePath:"/data/passages-for-phrase-work/intermediate_3199_Exchange-Student-in-Australia.txt"},{id:"intermediate-homestay-america",level:"intermediate",topic:"culture-exchange",wordCount:3148,filePath:"/data/passages-for-phrase-work/intermediate_3148_Homestay-in-America.txt"},{id:"intermediate-career-day",level:"intermediate",topic:"education-career",wordCount:2895,filePath:"/data/passages-for-phrase-work/intermediate_2895_Career-Day-at-School.txt"},{id:"intermediate-hospital-visit",level:"intermediate",topic:"health",wordCount:2721,filePath:"/data/passages-for-phrase-work/intermediate_2721_A-Visit-to-the-Hospital.txt"},{id:"intermediate-science-museum",level:"intermediate",topic:"science-education",wordCount:3265,filePath:"/data/passages-for-phrase-work/intermediate_3265_Science-Museum-Experience.txt"},{id:"intermediate-community-events",level:"intermediate",topic:"community",wordCount:2216,filePath:"/data/passages-for-phrase-work/intermediate_2216_Community-Events.txt"},{id:"intermediate-school-events-year",level:"intermediate",topic:"school-life",wordCount:2558,filePath:"/data/passages-for-phrase-work/intermediate_2558_A-Year-of-School-Events.txt"},{id:"intermediate-school-news",level:"intermediate",topic:"school-life",wordCount:1937,filePath:"/data/passages-for-phrase-work/intermediate_1937_School-News.txt"},{id:"advanced-environmental-issues",level:"advanced",topic:"environment",wordCount:4263,filePath:"/data/passages-for-phrase-work/advanced_4263_Environmental-Issues-and-Solutions.txt"},{id:"advanced-family-gathering",level:"advanced",topic:"culture-family",wordCount:4493,filePath:"/data/passages-for-phrase-work/advanced_4493_Family-Gathering-Traditions.txt"},{id:"advanced-health-statistics",level:"advanced",topic:"health-data",wordCount:3422,filePath:"/data/passages-for-phrase-work/advanced_3422_Health-Statistics-Analysis.txt"},{id:"advanced-historical-figures",level:"advanced",topic:"history",wordCount:3115,filePath:"/data/passages-for-phrase-work/advanced_3115_Historical-Figures-Study.txt"},{id:"advanced-international-exchange",level:"advanced",topic:"culture-global",wordCount:3813,filePath:"/data/passages-for-phrase-work/advanced_3813_Cultural-Exchange-Insights.txt"},{id:"advanced-school-festival",level:"advanced",topic:"school-events",wordCount:4419,filePath:"/data/passages-for-phrase-work/advanced_4419_School-Festival-Planning.txt"},{id:"advanced-summer-vacation-stories",level:"advanced",topic:"personal-growth",wordCount:3255,filePath:"/data/passages-for-phrase-work/advanced_3255_Summer-Vacation-Stories.txt"},{id:"advanced-technology-future",level:"advanced",topic:"technology-innovation",wordCount:3161,filePath:"/data/passages-for-phrase-work/advanced_3161_Technology-and-Future.txt"}],P0=H9.map(n=>({...n,title:G9(n.filePath),level:n.level}));function PI(){return P0}async function jI(n){try{const e=P0.find(i=>i.id===n);if(!e)return _.error(`Passage not found: ${n}`),"";const s=`/data/passages-original/${e.filePath.split("/").pop()||""}`,r=await fetch(s);return r.ok?await r.text():(_.log(`Original file not found: ${s}`),"")}catch(e){return _.error(`Error loading original passage ${n}:`,e),""}}async function q9(n){const e=P0.find(t=>t.id===n);if(!e)return _.error(`Passage not found: ${n}`),null;try{const t=await fetch(e.filePath);if(!t.ok)throw new Error(`Failed to fetch: ${t.statusText}`);const s=await t.text(),r=K9(s);return{...e,content:s,sections:r}}catch(t){return _.error(`Error loading passage ${n}:`,t),null}}function K9(n){const e=n.split(`
`),t=[];let s=null;for(const r of e){const o=r.trim();o&&(!r.startsWith("    ")&&o.length>0&&o.length<80?(s&&t.push(s),s={title:o,paragraphs:[]}):r.startsWith("    ")&&s&&s.paragraphs.push(o))}return s&&t.push(s),t}function Bi(n){const e=n.toLowerCase().trim();if(e.endsWith("ing")&&e.length>4){const t=e.slice(0,-3);return t.endsWith("n")||t.endsWith("m")||t.endsWith("t")?t.slice(0,-1):t+"e"}if(e.endsWith("ed")&&e.length>3){const t=e.slice(0,-2);return t.endsWith("i")?t.slice(0,-1)+"y":t}return e.endsWith("es")&&e.length>3?e.slice(0,-2):e.endsWith("s")&&e.length>2&&!e.endsWith("ss")?e.slice(0,-1):e}async function MI(n){try{let e=`/data/passages/passages-translations/${n}-ja.txt`;console.log(`[ÂÖ®Ë®≥] Attempting to load: ${e} for passageId: ${n}`);let t=await fetch(e);if(t.ok||(e=`/data/passages-translations/${n}-ja.txt`,console.log(`[ÂÖ®Ë®≥] Trying old path: ${e}`),t=await fetch(e)),!t.ok)return console.log(`[ÂÖ®Ë®≥] File not found (${t.status}): ${e}`),"";const s=await t.text();return console.log(`[ÂÖ®Ë®≥] Successfully loaded ${s.length} characters from ${e}`),s}catch(e){return console.error(`[ÂÖ®Ë®≥] Error loading full translation for ${n}:`,e),""}}async function X9(n){try{const e=PI().find(a=>a.id===n);if(!e)return[];const s=`/data/passages-for-phrase-work-ja/${(e.filePath.split("/").pop()||"").replace(/\.txt$/,"-ja.txt")}`,r=await fetch(s);if(!r.ok)return _.log(`No Japanese phrase file found: ${s}`),[];const i=(await r.text()).split(`
`).map(a=>a.trim()).filter(a=>a.length>0);return _.log(`Loaded ${i.length} Japanese phrases from ${s}`),i}catch(e){return _.error(`Error loading Japanese phrases for ${n}:`,e),[]}}async function Q9(n,e){const t=await q9(n);if(!t)return null;const[s,r,o]=await Promise.all([X9(n),MI(n),jI(n)]);let i=0;const a=[];return t.sections.forEach(l=>{l.paragraphs.forEach(d=>{if(d.match(/^([^:]+):\s*"([^"]+)"$/)){const p=d.trim(),f=p.split(/\s+/),m=f.map(x=>{let y=x,b="";if(y.startsWith('"')&&(b='"',y=y.substring(1)),/^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\.$|^[A-Z]\.$|^vs\.$|^e\.g\.$|^i\.e\.$/.test(y)){const S=Bi(y.replace(/\.$/,"")),N=e.get(S),C=(N==null?void 0:N.meaning)||"",k=[];return b&&k.push({word:b,meaning:"",isUnknown:!1}),k.push({word:y,meaning:C==="-"?"":C,isUnknown:!1}),k}const w=y.match(/([.,!?;:‚Äî"])$/);if(w){const S=y.replace(/[.,!?;:‚Äî"]$/,""),N=w[1];if(!S){const j=[];return b&&j.push({word:b,meaning:"",isUnknown:!1}),j.push({word:N,meaning:"",isUnknown:!1}),j}const C=Bi(S),k=e.get(C),I=(k==null?void 0:k.meaning)||"",$=[];return b&&$.push({word:b,meaning:"",isUnknown:!1}),$.push({word:S,meaning:I==="-"?"":I,isUnknown:!1}),$.push({word:N,meaning:"",isUnknown:!1}),$}else{const S=Bi(y),N=e.get(S),C=(N==null?void 0:N.meaning)||"",k=[];return b&&k.push({word:b,meaning:"",isUnknown:!1}),k.push({word:y,meaning:C==="-"?"":C,isUnknown:!1}),k}}).flat(),g=s[i]||"";i++,a.push({english:p,japanese:g,phraseMeaning:g,words:f,segments:m})}else{const p=d.trim(),f=p.split(/\s+/),m=f.map(x=>{if(/^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\.$|^[A-Z]\.$|^vs\.$|^e\.g\.$|^i\.e\.$/.test(x)){const v=Bi(x.replace(/\.$/,"")),w=e.get(v),S=(w==null?void 0:w.meaning)||"";return{word:x,meaning:S==="-"?"":S,isUnknown:!1}}const b=x.match(/([.,!?;:‚Äî])$/);if(b){const v=x.replace(/[.,!?;:‚Äî]$/,""),w=b[1];if(!v)return{word:w,meaning:"",isUnknown:!1};const S=Bi(v),N=e.get(S),C=(N==null?void 0:N.meaning)||"";return[{word:v,meaning:C==="-"?"":C,isUnknown:!1},{word:w,meaning:"",isUnknown:!1}]}else{const v=Bi(x),w=e.get(v),S=(w==null?void 0:w.meaning)||"";return{word:x,meaning:S==="-"?"":S,isUnknown:!1}}}).flat(),g=s[i]||"";i++,a.push({english:p,japanese:g,phraseMeaning:g,words:f,segments:m})}})}),{id:t.id,title:t.title,level:t.level,actualWordCount:t.wordCount,phrases:a,translation:r,originalText:o}}async function Y9(n){var e;try{const t=await fetch(`/data/passages-phrase-learning/${n}.json`);if(!t.ok)return _.log(`No phrase learning JSON found for ${n}, will use .txt conversion`),null;const s=await t.json();_.log(`Loaded phrase learning JSON for ${n}, phrases: ${((e=s.phrases)==null?void 0:e.length)||0}`);const[r,o]=await Promise.all([MI(n),jI(n)]);return{...s,phrases:s.phrases||[],translation:r,originalText:o}}catch{return _.log(`Skipping phrase learning JSON for ${n} (file may be old or moved), will use .txt conversion`),null}}async function J9(n){var s;const e=PI(),t=[];_.log(`Loading ${e.length} passages...`);for(const r of e){let o=await Y9(r.id);o||(o=await Q9(r.id,n)),o?(_.log(`‚úì Loaded passage: ${r.id} (${((s=o.phrases)==null?void 0:s.length)||0} phrases)`),t.push(o)):_.error(`‚úó Failed to load passage: ${r.id}`)}return _.log(`Total passages loaded: ${t.length}`),t}const By=new Set(["be","am","is","are","was","were","been","being","have","has","had","having","do","does","did","done","doing","can","could","will","would","shall","should","may","might","must","go","goes","went","gone","going","get","gets","got","gotten","getting","make","makes","made","making","take","takes","took","taken","taking","see","sees","saw","seen","seeing","come","comes","came","coming","want","wants","wanted","wanting","use","uses","used","using","find","finds","found","finding","give","gives","gave","given","giving","tell","tells","told","telling","work","works","worked","working","call","calls","called","calling","try","tries","tried","trying","ask","asks","asked","asking","need","needs","needed","needing","feel","feels","felt","feeling","become","becomes","became","becoming","leave","leaves","left","leaving","put","puts","putting","mean","means","meant","meaning","keep","keeps","kept","keeping","let","lets","letting","begin","begins","began","begun","beginning","seem","seems","seemed","seeming","help","helps","helped","helping","talk","talks","talked","talking","turn","turns","turned","turning","start","starts","started","starting","show","shows","showed","shown","showing","hear","hears","heard","hearing","play","plays","played","playing","run","runs","ran","running","move","moves","moved","moving","like","likes","liked","liking","live","lives","lived","living","believe","believes","believed","believing","bring","brings","brought","bringing","happen","happens","happened","happening","write","writes","wrote","written","writing","sit","sits","sat","sitting","stand","stands","stood","standing","lose","loses","lost","losing","pay","pays","paid","paying","meet","meets","met","meeting","include","includes","included","including","continue","continues","continued","continuing","set","sets","setting","learn","learns","learned","learning","change","changes","changed","changing","lead","leads","led","leading","understand","understands","understood","understanding","watch","watches","watched","watching","follow","follows","followed","following","stop","stops","stopped","stopping","create","creates","created","creating","speak","speaks","spoke","spoken","speaking","read","reads","reading","spend","spends","spent","spending","grow","grows","grew","grown","growing","open","opens","opened","opening","walk","walks","walked","walking","win","wins","won","winning","teach","teaches","taught","teaching","offer","offers","offered","offering","remember","remembers","remembered","remembering","consider","considers","considered","considering","appear","appears","appeared","appearing","buy","buys","bought","buying","serve","serves","served","serving","die","dies","died","dying","send","sends","sent","sending","build","builds","built","building","stay","stays","stayed","staying","fall","falls","fell","fallen","falling","cut","cuts","cutting","reach","reaches","reached","reaching","kill","kills","killed","killing","raise","raises","raised","raising","pass","passes","passed","passing","sell","sells","sold","selling","decide","decides","decided","deciding","return","returns","returned","returning","explain","explains","explained","explaining","hope","hopes","hoped","hoping","develop","develops","developed","developing","carry","carries","carried","carrying","break","breaks","broke","broken","breaking","receive","receives","received","receiving","agree","agrees","agreed","agreeing","support","supports","supported","supporting","hit","hits","hitting","produce","produces","produced","producing","eat","eats","ate","eaten","eating","cover","covers","covered","covering","catch","catches","caught","catching","draw","draws","drew","drawn","drawing","wake","wakes","woke","woken","waking","brush","brushes","brushed","brushing","wash","washes","washed","washing","prepare","prepares","prepared","preparing","check","checks","checked","checking"]),FI=new Set(["in","on","at","to","for","with","from","by","about","as","into","like","through","after","over","between","out","against","during","without","before","under","around","among","of","up"]),Z9=new Set(["and","but","or","so","yet","for","nor","because","although","if","when","while","since","unless","that","which","who","whom","whose","where"]),eY=new Set(["the","a","an","this","that","these","those","my","your","his","her","its","our","their","some","any","no","every","each","either","neither","much","many","more","most","few","little","several"]),tY=new Set(["i","you","he","she","it","we","they","me","him","her","us","them","myself","yourself","himself","herself","itself","ourselves","themselves"]),nY=new Set(["good","new","first","last","long","great","little","own","other","old","right","big","high","different","small","large","next","early","young","important","few","public","bad","same","able","ready","usual","toast","juice"]),sY=new Set(["not","so","up","out","just","now","how","then","more","also","here","well","only","very","even","back","there","down","still","in","as","too","when","never","really","usually","finally","first","after","before"]);function rY(n){return{S:"#3b82f6",V:"#ef4444",O:"#10b981",C:"#f59e0b",M:"#8b5cf6",Prep:"#6366f1",Conj:"#ec4899",Det:"#14b8a6",Adj:"#f97316",Adv:"#a855f7",Unknown:"#6b7280"}[n]}function oY(n){return{S:"‰∏ªË™û",V:"ÂãïË©û",O:"ÁõÆÁöÑË™û",C:"Ë£úË™û",M:"‰øÆÈ£æË™û",Prep:"ÂâçÁΩÆË©û",Conj:"Êé•Á∂öË©û",Det:"ÂÜ†Ë©û„ÉªÈôêÂÆöË©û",Adj:"ÂΩ¢ÂÆπË©û",Adv:"ÂâØË©û",Unknown:"‰∏çÊòé"}[n]}function iY(n,e,t){var r;const s=n.toLowerCase();return/^[.,!?;:]$/.test(n)?"Unknown":By.has(s)?"V":FI.has(s)?"Prep":Z9.has(s)?"Conj":eY.has(s)?"Det":nY.has(s)?"Adj":sY.has(s)?"Adv":tY.has(s)?e===0||e>0&&By.has((r=t[e+1])==null?void 0:r.toLowerCase())?"S":"O":"Unknown"}function aY(n){return{".":"Êñá„ÅÆÁµÇ„Çè„Çä",",":"Âå∫Âàá„Çä„ÉªÂàóÊåô","!":"ÊÑüÂòÜ„ÉªÂº∑Ë™ø","?":"ÁñëÂïè",";":"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",":":"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•","-":"Ë£úË∂≥Ë™¨Êòé„ÉªË®Ä„ÅÑÊèõ„Åà","‚Äî":"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•","‚Äì":"ÁØÑÂõ≤„ÉªÈñ¢‰øÇ",'"':"ÂºïÁî®","'":"ÂºïÁî®„ÉªÊâÄÊúâÊ†º","(":"Ë£úË∂≥ÊÉÖÂ†±„ÅÆÈñãÂßã",")":"Ë£úË∂≥ÊÉÖÂ†±„ÅÆÁµÇ‰∫Ü"}[n]||"Âè•Ë™≠ÁÇπ"}function Jl(n){const e=n.match(/\b[\w']+\b|[.,!?;:\-‚Äî‚Äì"'()]/g)||[],t=[];let s=!1,r=!1;for(let o=0;o<e.length;o++){const i=e[o];if(/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(i)){t.push({word:i,tag:"Unknown",color:"#6b7280",description:aY(i)});continue}let a=iY(i,o,e);a==="Unknown"&&(o===0&&/^[A-Z]/.test(i)&&!r?(a="S",r=!0):s&&!r?a="O":(o>0&&FI.has(e[o-1].toLowerCase()),a="M")),a==="V"&&(s=!0),a==="S"&&(r=!0),t.push({word:i,tag:a,color:rY(a),description:oY(a)})}return t}const cY=[{words:["wake","up"],meaning:"Ëµ∑„Åç„Çã",type:"phrasal-verb"},{words:["get","up"],meaning:"Ëµ∑Â∫ä„Åô„Çã",type:"phrasal-verb"},{words:["wake","up"],meaning:"ÁõÆ„ÇíË¶ö„Åæ„Åô",type:"phrasal-verb"},{words:["brush","my","teeth"],meaning:"Ê≠Ø„ÇíÁ£®„Åè",type:"phrasal-verb"},{words:["wash","my","face"],meaning:"È°î„ÇíÊ¥ó„ÅÜ",type:"phrasal-verb"},{words:["have","breakfast"],meaning:"ÊúùÈ£ü„ÇíÈ£ü„Åπ„Çã",type:"phrasal-verb"},{words:["go","to","school"],meaning:"Â≠¶Ê†°„Å´Ë°å„Åè",type:"phrasal-verb"},{words:["come","back"],meaning:"Â∏∞„Å£„Å¶„Åè„Çã",type:"phrasal-verb"},{words:["come","home"],meaning:"Â∏∞ÂÆÖ„Åô„Çã",type:"phrasal-verb"},{words:["do","homework"],meaning:"ÂÆøÈ°å„Çí„Åô„Çã",type:"phrasal-verb"},{words:["go","to","bed"],meaning:"ÂØù„Çã",type:"phrasal-verb"},{words:["at","seven"],meaning:"7ÊôÇ„Å´",type:"time-expression"},{words:["in","the","morning"],meaning:"Êúù„Å´",type:"time-expression"},{words:["in","the","afternoon"],meaning:"ÂçàÂæå„Å´",type:"time-expression"},{words:["in","the","evening"],meaning:"Â§ïÊñπ„Å´",type:"time-expression"},{words:["at","night"],meaning:"Â§ú„Å´",type:"time-expression"},{words:["every","morning"],meaning:"ÊØéÊúù",type:"determiner-noun"},{words:["every","day"],meaning:"ÊØéÊó•",type:"determiner-noun"},{words:["every","night"],meaning:"ÊØéÊô©",type:"determiner-noun"},{words:["every","week"],meaning:"ÊØéÈÄ±",type:"determiner-noun"}];function Zl(n){const e=[],t=n.map(s=>s.toLowerCase());for(const s of cY){const r=s.words.map(o=>o.toLowerCase());for(let o=0;o<=t.length-r.length;o++){let i=!0;for(let a=0;a<r.length;a++)if(t[o+a]!==r[a]){i=!1;break}i&&e.push({...s,words:n.slice(o,o+r.length)})}}return e}const lY=[{name:"too ~ to ...",meaning:"„Äú„Åô„Åé„Å¶...„Åß„Åç„Å™„ÅÑ",pattern:/\btoo\s+\w+\s+to\s+\w+/i,explanation:"„Äåtoo + ÂΩ¢ÂÆπË©û/ÂâØË©û + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Åé„Å¶...„Åß„Åç„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"so ~ that ...",meaning:"„Å®„Å¶„ÇÇ„Äú„Å™„ÅÆ„Åß...",pattern:/\bso\s+\w+\s+that\b/i,explanation:"„Äåso + ÂΩ¢ÂÆπË©û/ÂâØË©û + that ~„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Å®„Å¶„ÇÇ„Äú„Å™„ÅÆ„Åß...„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"so that ...",meaning:"„Äú„Åô„Çã„Åü„ÇÅ„Å´",pattern:/\bso\s+that\b/i,explanation:"„Äåso that ~„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åü„ÇÅ„Å´„Äç„Å®„ÅÑ„ÅÜÁõÆÁöÑ„ÇíË°®„Åô"},{name:"It is ~ for ... to",meaning:"...„Åå„Äú„Åô„Çã„ÅÆ„ÅØ",pattern:/\bit\s+is\s+\w+\s+for\s+\w+\s+to\b/i,explanation:"„ÄåIt is + ÂΩ¢ÂÆπË©û + for + ‰∫∫ + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå(‰∫∫)„Åå„Äú„Åô„Çã„ÅÆ„ÅØ...„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"It is ~ to ...",meaning:"„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†",pattern:/\bit\s+is\s+\w+\s+to\s+\w+/i,explanation:"„ÄåIt is + ÂΩ¢ÂÆπË©û + to + ÂãïË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"It is ~ that ...",meaning:"...„Å™„ÅÆ„ÅØ„Äú„Å† (Âº∑Ë™ø)",pattern:/\bit\s+is\s+\w+\s+that\b/i,explanation:"Âº∑Ë™øÊßãÊñá„ÄÇ„ÄåIt is ~ that ...„Äç„ÅÆÂΩ¢„Åß„ÄÅÁâπÂÆö„ÅÆÈÉ®ÂàÜ„ÇíÂº∑Ë™ø„Åô„Çã"},{name:"not only ~ but also ...",meaning:"„Äú„Å†„Åë„Åß„Å™„Åè...„ÇÇ",pattern:/\bnot\s+only\s+.+\s+but\s+also\b/i,explanation:"„Äånot only A but also B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„Å†„Åë„Åß„Å™„ÅèB„ÇÇ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"either ~ or ...",meaning:"„Äú„Åã...„Åã„Å©„Å°„Çâ„Åã",pattern:/\beither\s+.+\s+or\b/i,explanation:"„Äåeither A or B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÅãB„Åã„Å©„Å°„Çâ„Åã„Äç„Å®„ÅÑ„ÅÜÈÅ∏Êäû„ÇíË°®„Åô"},{name:"neither ~ nor ...",meaning:"„Äú„ÇÇ...„ÇÇ„Å™„ÅÑ",pattern:/\bneither\s+.+\s+nor\b/i,explanation:"„Äåneither A nor B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÇÇB„ÇÇ„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÂê¶ÂÆö„ÇíË°®„Åô"},{name:"both ~ and ...",meaning:"„Äú„ÇÇ...„ÇÇ‰∏°Êñπ",pattern:/\bboth\s+.+\s+and\b/i,explanation:"„Äåboth A and B„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåA„ÇÇB„ÇÇ‰∏°Êñπ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"as ~ as ...",meaning:"...„Å®Âêå„Åò„Åè„Çâ„ÅÑ„Äú",pattern:/\bas\s+\w+\s+as\b/i,explanation:"„Äåas + ÂΩ¢ÂÆπË©û/ÂâØË©û + as ...„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå...„Å®Âêå„Åò„Åè„Çâ„ÅÑ„Äú„Äç„Å®„ÅÑ„ÅÜÂêåÁ≠âÊØîËºÉ"},{name:"not as ~ as ...",meaning:"...„Åª„Å©„Äú„Å™„ÅÑ",pattern:/\bnot\s+as\s+\w+\s+as\b/i,explanation:"„Äånot as + ÂΩ¢ÂÆπË©û/ÂâØË©û + as ...„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå...„Åª„Å©„Äú„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"one of the ~est",meaning:"ÊúÄ„ÇÇ„Äú„Å™„ÇÇ„ÅÆ„ÅÆ1„Å§",pattern:/\bone\s+of\s+the\s+\w+est\b/i,explanation:"„Äåone of the + ÊúÄ‰∏äÁ¥ö + Ë§áÊï∞ÂêçË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåÊúÄ„ÇÇ„Äú„Å™„ÇÇ„ÅÆ„ÅÆ1„Å§„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"make/let/have + ‰∫∫ + ÂãïË©û",meaning:"‰∫∫„Å´„Äú„Åï„Åõ„Çã",pattern:/\b(make|let|have|help)\s+\w+\s+\w+/i,explanation:"‰ΩøÂΩπÂãïË©û„ÅÆÊßãÊñá„ÄÇ„Äåmake/let/have + ‰∫∫ + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„Åß„Äå‰∫∫„Å´„Äú„Åï„Åõ„Çã„Äç"},{name:"be used to ~ing",meaning:"„Äú„Åô„Çã„Åì„Å®„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã",pattern:/\b(am|is|are|was|were)\s+used\s+to\s+\w+ing\b/i,explanation:"„Äåbe used to + ÂãïÂêçË©û„Äç„ÅÆÂΩ¢„Åß„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥"},{name:"used to + ÂãïË©û",meaning:"Êòî„ÅØ„Äú„Åó„Åü„ÇÇ„ÅÆ„Å†",pattern:/\bused\s+to\s+\w+/i,explanation:"„Äåused to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„ÅÆÂΩ¢„Åß„ÄÅ„ÄåÊòî„ÅØ„Äú„Åó„Åü„ÇÇ„ÅÆ„Å†„Äç„Å®„ÅÑ„ÅÜÈÅéÂéª„ÅÆÁøíÊÖ£„ÇíË°®„Åô"}];function uY(n){const e=[];for(const t of lY)t.pattern.test(n)&&e.push(t);return e}function Vy(n){return{beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö",Advanced:"‰∏äÁ¥ö",ÂàùÁ¥ö:"ÂàùÁ¥ö",‰∏≠Á¥ö:"‰∏≠Á¥ö",‰∏äÁ¥ö:"‰∏äÁ¥ö"}[n]||n}function Uy(n){return{S:"‰∏ªË™û",V:"ÂãïË©û",O:"ÁõÆÁöÑË™û",C:"Ë£úË™û",M:"‰øÆÈ£æË™û",Prep:"ÂâçÁΩÆË©û",Conj:"Êé•Á∂öË©û",Det:"ÈôêÂÆöË©û",Adj:"ÂΩ¢ÂÆπË©û",Adv:"ÂâØË©û",Unknown:""}[n]||""}function OI({onSaveUnknownWords:n,customQuestionSets:e=[],onAddWordToCustomSet:t,onRemoveWordFromCustomSet:s,onOpenCustomSetManagement:r}){var $t;const[o,i]=T.useState([]),[a,c]=T.useState(null),[l,d]=T.useState([]),[h,p]=T.useState([]),[f,m]=T.useState("all"),[g,x]=T.useState(null),[y,b]=T.useState(new Map),[v,w]=T.useState(new Map),[S,N]=T.useState(null),[C,k]=T.useState(!1),[I,$]=T.useState(!0),[j,P]=T.useState("reading"),[O,A]=T.useState(0),[z,L]=T.useState(!1),[U,V]=T.useState(!1),[B,Y]=T.useState(null),[K,pe]=T.useState(null),[ge,re]=T.useState(!0);T.useEffect(()=>{if(o.length>0){const ae="reading-unknown-words-state";try{const le=o.map(G=>({id:G.id,unknownWords:G.phrases.flatMap((oe,he)=>oe.segments.map((Te,Se)=>Te.isUnknown?`${he}-${Se}`:null).filter(Boolean))}));localStorage.setItem(ae,JSON.stringify(le))}catch(le){_.warn("ÂàÜ„Åã„Çâ„Å™„ÅÑÂçòË™û„ÅÆÁä∂ÊÖã‰øùÂ≠ò„Å´Â§±Êïó:",le)}}},[o]),T.useEffect(()=>{_.log("[Èï∑Êñá] ËæûÊõ∏„ÅÆË™≠„ÅøËæº„Åø„ÇíÈñãÂßã..."),fetch("/data/vocabulary/high-school-entrance-words.csv").then(ae=>{if(!ae.ok)throw new Error(`CSVË™≠„ÅøËæº„ÅøÂ§±Êïó: ${ae.status}`);return ae.text()}).then(ae=>{const le=ae.split(`
`),G=new Map;le.slice(1).forEach(oe=>{if(!oe.trim())return;const he=oe.split(",").map(Te=>Te.trim());if(he.length>=7){const Te=he[0].toLowerCase().trim();G.set(Te,{word:he[0],reading:he[1],meaning:he[2],etymology:he[3],relatedWords:he[4],relatedFields:he[5],difficulty:he[6]})}}),_.log(`[Èï∑Êñá] „É°„Ç§„É≥ËæûÊõ∏: ${G.size}ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`),b(G)}).catch(ae=>{}),fetch("/data/dictionaries/reading-passages-dictionary.json").then(ae=>{if(!ae.ok)throw new Error(`JSONË™≠„ÅøËæº„ÅøÂ§±Êïó: ${ae.status}`);return ae.json()}).then(ae=>{const le=new Map;Object.entries(ae).forEach(([G,oe])=>{le.set(G.toLowerCase(),oe)}),w(le),_.log(`[Èï∑Êñá] Èï∑ÊñáË™≠Ëß£ËæûÊõ∏: ${le.size}ÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`)}).catch(ae=>{_.error("[Èï∑Êñá] Error loading reading dictionary:",ae)})},[]);const ye=T.useCallback(ae=>{const le=ae.toLowerCase().replace(/[.,!?;:"']/g,"").trim();if(y.has(le)||v.has(le))return le;if(le.endsWith("es")){const G=le.slice(0,-2);if(y.has(G)||v.has(G))return G}if(le.endsWith("s")){const G=le.slice(0,-1);if(y.has(G)||v.has(G))return G}if(le.endsWith("ed")){const G=le.slice(0,-2);if(y.has(G)||v.has(G))return G;if(y.has(G+"e")||v.has(G+"e"))return G+"e";if(G.length>2&&G[G.length-1]===G[G.length-2]){const oe=G.slice(0,-1);if(y.has(oe)||v.has(oe))return oe}}if(le.endsWith("ing")){const G=le.slice(0,-3);if(y.has(G)||v.has(G))return G;if(y.has(G+"e")||v.has(G+"e"))return G+"e";if(G.length>2&&G[G.length-1]===G[G.length-2]){const oe=G.slice(0,-1);if(y.has(oe)||v.has(oe))return oe}}if(le.endsWith("ly")){const G=le.slice(0,-2);if(y.has(G)||v.has(G))return G}if(le.endsWith("er")){const G=le.slice(0,-2);if(y.has(G)||v.has(G))return G}if(le.endsWith("est")){const G=le.slice(0,-3);if(y.has(G)||v.has(G))return G}return le},[y,v]),Ae=T.useCallback((ae,le)=>{if(le&&typeof le=="string"&&le.trim()&&le!=="-")return le;if(le&&typeof le=="object"&&"meaning"in le&&typeof le.meaning=="string")return le.meaning;const G=ae.toLowerCase();if(G==="who")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„ÅØ";if(G==="whom")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„Çí";if(G==="which")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆÁâ©Á≠â„ÅØ„Éª„Çí";if(G==="that")return"(Èñ¢‰øÇ‰ª£ÂêçË©û)„Åù„ÅÆ‰∫∫„ÉªÁâ©Á≠â„ÅØ„Éª„Çí";const oe=ye(ae),he=y.get(oe),Te=v.get(oe);return(he==null?void 0:he.meaning)||(Te==null?void 0:Te.meaning)||""},[ye,y,v]);T.useEffect(()=>{const ae=setInterval(()=>{z&&!c9()&&!l9()&&(L(!1),V(!1))},500);return()=>clearInterval(ae)},[z]),T.useEffect(()=>{if(y.size===0){_.log("[Èï∑Êñá] ËæûÊõ∏„ÅÆË™≠„ÅøËæº„Åø„ÇíÂæÖÊ©ü‰∏≠...");return}_.log(`[Èï∑Êñá] „Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„ÇíÈñãÂßã... (ËæûÊõ∏: ${y.size}ÂçòË™û)`);try{localStorage.removeItem("reading-passages-data")}catch{}const ae="reading-unknown-words-state";let le=[];try{const G=localStorage.getItem(ae);G&&(le=JSON.parse(G))}catch(G){_.warn("[Èï∑Êñá] ‰øùÂ≠òÊ∏à„ÅøÈÄ≤Êçó„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",G)}re(!0),J9(y).then(G=>{var oe,he;if(G&&G.length>0){_.log(`[Èï∑Êñá] ${G.length}‰ª∂„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);const Te=G.map(Fe=>{const Le=le.find(De=>De.id===Fe.id);return Le!=null&&Le.unknownWords&&Le.unknownWords.length>0?{...Fe,phrases:Fe.phrases.map((De,Ke)=>({...De,segments:De.segments.map((pt,R)=>{var D;return{...pt,isUnknown:((D=Le.unknownWords)==null?void 0:D.includes(`${Ke}-${R}`))??!1}})}))}:Fe}),Se={ÂàùÁ¥ö:1,beginner:1,‰∏≠Á¥ö:2,intermediate:2,‰∏äÁ¥ö:3,advanced:3,Advanced:3},te=Te.sort((Fe,Le)=>{const De=Se[Fe.level||""]||999,Ke=Se[Le.level||""]||999;if(De!==Ke)return De-Ke;const pt=Fe.actualWordCount||0,R=Le.actualWordCount||0;return pt-R});i(te),_.log(`[Èï∑Êñá] „Éë„ÉÉ„Çª„Éº„Ç∏„ÇíË®≠ÂÆöÂÆå‰∫Ü: ${te.length}‰ª∂`),te.length>0&&(c(te[0].id),d(new Array(((oe=te[0].phrases)==null?void 0:oe.length)||0).fill(!1)),p(new Array(((he=te[0].phrases)==null?void 0:he.length)||0).fill(!1)),_.log(`[Èï∑Êñá] ÂàùÊúü„Éë„ÉÉ„Çª„Éº„Ç∏„ÇíÈÅ∏Êäû: ${te[0].id}`)),re(!1)}else _.error("[Èï∑Êñá] loadAllPassagesAsReadingFormat„ÅåÁ©∫„ÅÆÈÖçÂàó„ÇíËøî„Åó„Åæ„Åó„Åü"),x("„Éë„ÉÉ„Çª„Éº„Ç∏„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºà„Éá„Éº„Çø„ÅåÁ©∫„Åß„ÅôÔºâ"),re(!1)}).catch(G=>{_.error("[Èï∑Êñá] Error loading passages:",G),x("„Éë„ÉÉ„Çª„Éº„Ç∏„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+G.message),re(!1)})},[y]);const ve=T.useMemo(()=>o.find(ae=>ae.id===a),[o,a]),_e=T.useMemo(()=>{const ae=f==="all"?o:o.filter(G=>G.level===f),le={ÂàùÁ¥ö:1,beginner:1,‰∏≠Á¥ö:2,intermediate:2,‰∏äÁ¥ö:3,advanced:3,Advanced:3};return ae.sort((G,oe)=>{const he=le[G.level||""]||999,Te=le[oe.level||""]||999;if(he!==Te)return he-Te;const Se=G.actualWordCount||0,te=oe.actualWordCount||0;return Se-te})},[o,f]),ze=T.useCallback(ae=>{var G,oe;c(ae);const le=o.find(he=>he.id===ae);le&&(d(new Array(((G=le.phrases)==null?void 0:G.length)||0).fill(!1)),p(new Array(((oe=le.phrases)==null?void 0:oe.length)||0).fill(!1)),A(0))},[o]);T.useCallback((ae,le)=>{if(le.preventDefault(),le.stopPropagation(),!ve||!xn())return;const oe=ve.phrases[ae].segments.filter(Te=>Te.word&&Te.word.trim()!=="").map(Te=>Te.word).join(" ");Ts(oe,{rate:.85});const he=le.currentTarget;he.classList.add("speaking"),setTimeout(()=>{he.classList.remove("speaking")},600)},[ve]);const et=(ae,le)=>{if(le.preventDefault(),le.stopPropagation(),S&&S.word===ae){N(null);return}const G=ae.toLowerCase().replace(/[.,!?;:"']/g,"").trim(),he=(Se=>{if(y.has(Se))return Se;if(Se.endsWith("es")&&y.has(Se.slice(0,-2)))return Se.slice(0,-2);if(Se.endsWith("s")&&y.has(Se.slice(0,-1)))return Se.slice(0,-1);if(Se.endsWith("ed")){const te=Se.slice(0,-2);if(y.has(te))return te;if(y.has(te+"e"))return te+"e";if(te.length>2&&te[te.length-1]===te[te.length-2]){const Fe=te.slice(0,-1);if(y.has(Fe))return Fe}}if(Se.endsWith("ing")){const te=Se.slice(0,-3);if(y.has(te))return te;if(y.has(te+"e"))return te+"e";if(te.length>2&&te[te.length-1]===te[te.length-2]){const Fe=te.slice(0,-1);if(y.has(Fe))return Fe}}return Se.endsWith("ly")&&y.has(Se.slice(0,-2))||Se.endsWith("er")&&y.has(Se.slice(0,-2))?Se.slice(0,-2):Se.endsWith("est")&&y.has(Se.slice(0,-3))?Se.slice(0,-3):null})(G),Te=he?y.get(he):null;if(Te){const Se=le.currentTarget.getBoundingClientRect();N({word:Te.word,meaning:Te.meaning,reading:Te.reading,etymology:Te.etymology,relatedWords:Te.relatedWords,x:Se.left+window.scrollX,y:Se.bottom+window.scrollY+5})}else{const Se=v.get(he||G);if(Se){const te=le.currentTarget.getBoundingClientRect();N({word:Se.word,meaning:Se.meaning,reading:Se.reading||"",etymology:Se.etymology||"",relatedWords:Se.relatedWords||"",x:te.left+window.scrollX,y:te.bottom+window.scrollY+5})}else _.warn(`Word not found in dictionary: ${G}`)}},ut=()=>{if(!ve)return;const ae=[];if(ve.phrases.forEach(le=>{le.segments.forEach(G=>{G.isUnknown&&G.word.trim()!==""&&(ae.some(oe=>oe.word.toLowerCase()===G.word.toLowerCase())||ae.push({word:G.word,meaning:G.meaning,reading:G.reading||"",etymology:G.etymology||"",relatedWords:G.relatedWords||"",relatedFields:G.relatedFields||"",difficulty:G.difficulty||"intermediate"}))})}),ae.length===0){alert(`ÂàÜ„Åã„Çâ„Å™„ÅÑÂçòË™û„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
ÂçòË™û„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Éû„Éº„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);return}n&&n(ae),i(le=>le.map(G=>G.id===ve.id?{...G,phrases:G.phrases.map(oe=>({...oe,segments:oe.segments.map(he=>({...he,isUnknown:!1}))}))}:G)),alert(`${ae.length}ÂÄã„ÅÆÂçòË™û„Çí„Äå${ve.title}„Äç„Åã„Çâ‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ`)},yt=()=>{ve&&(i(ae=>ae.map(le=>le.id===ve.id?{...le,phrases:le.phrases.map(G=>({...G,segments:G.segments.map(oe=>({...oe,isUnknown:!1}))}))}:le)),d(new Array(ve.phrases.length).fill(!1)),p(new Array(ve.phrases.length).fill(!1)))};if(g)return u.jsx("div",{className:"error-message",children:g});if(ge)return u.jsx("div",{className:"empty-container",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."});if(o.length===0)return u.jsx("div",{className:"empty-container",children:"„Éë„ÉÉ„Çª„Éº„Ç∏„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"});if(_e.length===0)return u.jsxs("div",{className:"comprehensive-reading-view",children:[u.jsx("div",{className:"reading-header",children:u.jsxs("div",{className:"filter-controls",children:[u.jsx("label",{htmlFor:"difficulty-filter",children:"Èõ£ÊòìÂ∫¶: "}),u.jsxs("select",{id:"difficulty-filter",value:f,onChange:ae=>m(ae.target.value),title:"Èõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]})}),u.jsx("div",{className:"empty-container",children:"ÈÅ∏Êäû„Åó„ÅüÈõ£ÊòìÂ∫¶„ÅÆ„Éë„ÉÉ„Çª„Éº„Ç∏„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂà•„ÅÆÈõ£ÊòìÂ∫¶„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"})]});const bt=(($t=ve==null?void 0:ve.phrases)==null?void 0:$t.reduce((ae,le)=>ae+le.segments.filter(G=>G.isUnknown).length,0))||0;return u.jsxs("div",{className:"comprehensive-reading-view",children:[!I&&C&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-filter",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-filter",value:f,onChange:ae=>m(ae.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"passage-select",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏:"}),u.jsx("select",{id:"passage-select",value:a||"",onChange:ae=>ze(ae.target.value),className:"select-input",children:_e.map(ae=>u.jsxs("option",{value:ae.id,children:[Vy(ae.level||"beginner"),"_",ae.actualWordCount,"Ë™û_",ae.title]},ae.id))})]})]}),I&&u.jsxs("div",{className:"reading-sub-tabs grid grid-cols-6 gap-1 sm:gap-2",children:[u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="reading"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("reading"),children:"üìñ Ë™≠Ëß£"}),u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="fullText"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("fullText"),children:"üìÑ ÂÖ®Êñá"}),u.jsx("button",{className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${j==="fullTranslation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,onClick:()=>P("fullTranslation"),children:"üìù ÂÖ®Ë®≥"}),u.jsxs("button",{onClick:ut,className:"px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium bg-success text-white rounded-t-lg border-b-2 border-success transition-all duration-200 hover:bg-success-hover disabled:opacity-50 disabled:cursor-not-allowed:bg-success-hover",disabled:bt===0,title:"Êú™Áü•Ë™û„Çí‰øùÂ≠ò",children:["üíæ ‰øùÂ≠ò (",bt,")"]}),u.jsx("button",{onClick:yt,className:"px-4 py-2 text-sm font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md:bg-warning-hover",title:"„É™„Çª„ÉÉ„Éà",children:"üîÑ „É™„Çª„ÉÉ„Éà"}),u.jsx("button",{className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",onClick:()=>k(!C),title:"Â≠¶ÁøíË®≠ÂÆö„ÇíÈñã„Åè",children:"‚öôÔ∏è Â≠¶ÁøíË®≠ÂÆö"})]}),I&&C&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"difficulty-filter-reading",children:"‚≠ê Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"difficulty-filter-reading",value:f,onChange:ae=>m(ae.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶"}),u.jsx("option",{value:"ÂàùÁ¥ö",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"‰∏≠Á¥ö",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"‰∏äÁ¥ö",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"passage-select-reading",children:"üìñ „Éë„ÉÉ„Çª„Éº„Ç∏:"}),u.jsx("select",{id:"passage-select-reading",value:a||"",onChange:ae=>ze(ae.target.value),className:"select-input",children:_e.map(ae=>u.jsxs("option",{value:ae.id,children:[Vy(ae.level||"beginner"),"_",ae.actualWordCount,"Ë™û_",ae.title]},ae.id))})]})]}),S&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"word-popup-overlay",onClick:()=>N(null)}),u.jsxs("div",{className:"word-popup","data-popup-x":S.x,"data-popup-y":S.y,children:[u.jsx("button",{className:"popup-close",onClick:()=>N(null),title:"Èñâ„Åò„Çã",children:"‚úï"}),u.jsx("div",{className:"popup-word",children:S.word}),S.reading&&u.jsx("div",{className:"popup-reading",children:S.reading}),u.jsx("div",{className:"popup-meaning",children:S.meaning}),S.etymology&&u.jsxs("div",{className:"popup-etymology",children:[u.jsx("strong",{children:"Ë™ûÊ∫ê:"})," ",S.etymology]}),S.relatedWords&&u.jsxs("div",{className:"popup-related",children:[u.jsx("strong",{children:"Èñ¢ÈÄ£Ë™û:"})," ",S.relatedWords]})]})]}),I&&ve&&ve.phrases&&ve.phrases.length>0&&u.jsxs("div",{className:"passage-content",children:[u.jsx("h3",{className:"passage-title",children:ve.title}),j==="reading"&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"reading-full-text-area",children:[u.jsx("h4",{className:"text-lg font-semibold mb-3",children:"üìñ ÂÖ®Êñá"}),u.jsx("div",{className:"full-text-content",children:(()=>{if(ve.originalText){const le=ve.originalText.split(/([.!?])\s+/).filter(oe=>oe.trim()),G=[];for(let oe=0;oe<le.length;oe+=2){const he=le[oe],Te=le[oe+1]||"";G.push((he+Te).trim())}return u.jsx("div",{className:"sentences-container",children:G.map((oe,he)=>u.jsxs("span",{className:`sentence-clickable ${B===he?"selected-reading":""}`,onClick:()=>{Y(he);const Te=Jl(oe);pe({text:oe,grammarAnalysis:Te,showMeanings:!1})},children:[oe," "]},he))})}if(ve.title.toLowerCase().includes("conversation")){const le=[];return ve.phrases.forEach(G=>{let oe=G.segments.map(he=>he.word).join(" ").trim();!oe||oe==="-"||(oe=oe.replace(/\s+([.,!?;:"])/g,"$1"),le.push(oe))}),u.jsx("div",{className:"sentences-container",children:le.map((G,oe)=>u.jsxs("span",{className:`sentence-clickable ${B===oe?"selected-reading":""}`,onClick:()=>{Y(oe);const he=Jl(G);pe({text:G,grammarAnalysis:he,showMeanings:!1})},children:[G," "]},oe))})}else{let le="",G=!0;ve.phrases.forEach(Te=>{Te.segments.forEach(Se=>{let te=Se.word.trim();te&&te!=="-"&&(/^[.,!?;:]$/.test(te)?(le+=te,G=/^[.!?]$/.test(te)):(te==='"'||te==="'"||(G&&te.length>0&&(te=te.charAt(0).toUpperCase()+te.slice(1),G=!1),le.length>0&&!le.endsWith(" ")&&!le.endsWith('"')&&!le.endsWith("'")&&(le+=" ")),le+=te))})}),le=le.replace(/\s+"/g,'"').replace(/\s+'/g,"'");const oe=le.split(/([.!?])\s+/).filter(Te=>Te.trim()),he=[];for(let Te=0;Te<oe.length;Te+=2){const Se=oe[Te],te=oe[Te+1]||"";he.push((Se+te).trim())}return u.jsx("div",{className:"sentences-container",children:he.map((Te,Se)=>u.jsxs("span",{className:`sentence-clickable ${B===Se?"selected-reading":""}`,onClick:()=>{Y(Se);const te=Jl(Te);pe({text:Te,grammarAnalysis:te,showMeanings:!1})},children:[Te," "]},Se))})}})()})]}),B!==null&&K&&u.jsxs("div",{className:"selected-sentence-analysis mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("h4",{className:"m-0 text-base font-semibold text-blue-700",children:"üìú Êñá„ÅÆË™≠Ëß£"}),u.jsxs("div",{className:"flex gap-1",children:[u.jsx("button",{className:"px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>Ts(K.text),title:"Áô∫Èü≥",children:"üîä"}),u.jsx("button",{className:"px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",onClick:()=>pe({...K,showMeanings:!K.showMeanings}),children:K.showMeanings?"ÊÑèÂë≥„ÇíÈö†„Åô":"ÊÑèÂë≥„ÇíË°®Á§∫"})]})]}),u.jsx("div",{className:"selected-sentence-text mb-2 text-base",children:K.text}),(()=>{var pt,R;const ae=K.grammarAnalysis.filter(D=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(D.word)),le=ae.map(D=>D.word),G=Zl(le),oe=new Map,he=new Set;G.forEach(D=>{let F=0;for(;F<le.length;){const M=le.slice(F).findIndex((X,ue)=>D.words.every((J,de)=>{var me;return((me=le[F+ue+de])==null?void 0:me.toLowerCase())===J.toLowerCase()}));if(M!==-1){const X=F+M;oe.set(X,D),D.words.forEach((ue,J)=>he.add(X+J));break}F++}});const Te=new Map,Se=new Set;ae.forEach((D,F)=>{he.has(F)||(D.tag==="Prep"&&F+1<ae.length&&(Te.set(F,2),Se.add(F),Se.add(F+1)),D.tag==="Det"&&D.word.toLowerCase()==="every"&&F+1<ae.length&&(Te.set(F,2),Se.add(F),Se.add(F+1)))});const te=[],Fe=[];for(let D=0;D<ae.length;D++){const F=ae[D];if(he.has(D)&&!oe.has(D)||Se.has(D)&&!Te.has(D))continue;const M=oe.get(D),X=Te.get(D),ue=M?M.words:X?ae.slice(D,D+X).map(Me=>Me.word):[F.word],J=ue.join(" ");te.push(J);const de=J.toLowerCase(),me=de==="i"?"‰∏ªË™û":de==="wake up"?"ÂãïË©ûÈÉ®":((pt=ue[0])==null?void 0:pt.toLowerCase())==="at"||((R=ue[0])==null?void 0:R.toLowerCase())==="every"?"ÂâçÁΩÆË©ûÂè•":Uy(F.tag);Fe.push(me),M&&(D+=M.words.length-1),!M&&X&&(D+=X-1)}const Le=te.join(" "),De=te.map(D=>D.replace(/[^\s]/g,"-")).join(" "),Ke=Fe.join(" ");return u.jsx("div",{className:"mt-2 text-sm text-gray-800",children:u.jsxs("pre",{className:"font-mono whitespace-pre-wrap leading-5",children:[Le,`
`,De,`
`,Ke]})})})(),u.jsxs("div",{className:"grammar-structure mb-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üî§ ÊñáÊ≥ïÊßãÈÄ†"}),u.jsx("div",{className:"flex flex-wrap gap-1.5 text-sm",children:(()=>{const ae=K.grammarAnalysis.map(Fe=>Fe.word),le=Zl(ae),G=new Map,oe=new Set;le.forEach(Fe=>{let Le=0;for(;Le<ae.length;){const De=ae.slice(Le).findIndex((Ke,pt)=>Fe.words.every((R,D)=>{var F;return((F=ae[Le+pt+D])==null?void 0:F.toLowerCase())===R.toLowerCase()}));if(De!==-1){const Ke=Le+De;G.set(Ke,Fe),Fe.words.forEach((pt,R)=>oe.add(Ke+R));break}Le++}});const he=new Map,Te=new Set,Se=K.grammarAnalysis.filter(Fe=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(Fe.word));Se.forEach((Fe,Le)=>{oe.has(Le)||(Fe.tag==="Prep"&&Le+1<Se.length&&(he.set(Le,2),Te.add(Le),Te.add(Le+1)),Fe.tag==="Det"&&Fe.word.toLowerCase()==="every"&&Le+1<Se.length&&(he.set(Le,2),Te.add(Le),Te.add(Le+1)))});const te=[];for(let Fe=0;Fe<Se.length;Fe++){const Le=Se[Fe];if(oe.has(Fe)&&!G.has(Fe)||Te.has(Fe)&&!he.has(Fe))continue;const De=G.get(Fe),Ke=he.get(Fe),pt=!!Ke,R=De?De.words.join(" "):Ke?Se.slice(Fe,Fe+Ke).map(F=>F.word).join(" "):Le.word,D=Le.tag==="Det"&&Le.word.toLowerCase()==="every"?"M":Le.tag;te.push(u.jsxs("div",{className:"inline-flex flex-col items-center",title:Le.description,children:[u.jsx("span",{className:`font-medium text-base ${pt?"px-0.5":""} ${De||pt?"border-b-2 border-yellow-500":""}`,children:R}),u.jsx("span",{className:"text-xs grammar-tag-label mt-0.5","data-tag":D,children:Uy(D)})]},Fe)),De&&(Fe+=De.words.length-1),!De&&Ke&&(Fe+=Ke-1)}return te})()})]}),(()=>{var pt;const ae=K.grammarAnalysis.filter(R=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(R.word)),le={one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10",eleven:"11",twelve:"12"},G=R=>{const D=R.join(" ").toLowerCase();if(D==="i")return"ÁßÅ„ÅØ";if(D==="wake up")return"Ëµ∑„Åç„Çã";if(R.length===2&&R[0].toLowerCase()==="at"){const F=R[1].toLowerCase(),M=le[F]||(F.match(/^\d+$/)?F:"");if(M)return`${M}ÊôÇ„Å´`}return R.length===2&&R[0].toLowerCase()==="every"&&R[1].toLowerCase()==="morning"?"ÊØéÊúù":R.map(F=>Ae(F,void 0)).filter(F=>F&&F!=="-").join(" ")},oe=ae.map(R=>R.word),he=Zl(oe),Te=new Map,Se=new Set;he.forEach(R=>{let D=0;for(;D<oe.length;){const F=oe.slice(D).findIndex((M,X)=>R.words.every((ue,J)=>{var de;return((de=oe[D+X+J])==null?void 0:de.toLowerCase())===ue.toLowerCase()}));if(F!==-1){const M=D+F;Te.set(M,R),R.words.forEach((X,ue)=>Se.add(M+ue));break}D++}});const te=[];for(let R=0;R<ae.length;R++){if(Se.has(R)&&!Te.has(R))continue;const D=Te.get(R);if(D){te.push({words:D.words,meaning:((pt=y.get(D.words.join(" ").toLowerCase()))==null?void 0:pt.meaning)||G(D.words)}),R+=D.words.length-1;continue}const F=ae[R].tag,M=ae[R].word.toLowerCase();if(F==="Prep"&&R+1<ae.length){const X=[ae[R].word,ae[R+1].word];te.push({words:X,meaning:G(X)}),R+=1;continue}if(F==="Det"&&M==="every"&&R+1<ae.length){const X=[ae[R].word,ae[R+1].word];te.push({words:X,meaning:G(X)}),R+=1;continue}te.push({words:[ae[R].word],meaning:G([ae[R].word])})}const Fe=te.map(R=>R.words.join(" ")).join(" "),Le=te.map(R=>R.meaning).join(" "),Ke=K.text.toLowerCase().replace(/[\s.?!]+/g," ").trim()==="i wake up at seven every morning"?"ÁßÅ„ÅØÊØéÊúù7ÊôÇ„Å´Ëµ∑„Åç„Åæ„Åô„ÄÇ":Le;return u.jsxs("div",{className:"mt-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üìù Áõ¥Ë®≥„Å®Êó•Êú¨Ë™ûË®≥"}),u.jsx("div",{className:"text-sm text-gray-800",children:Fe}),u.jsx("div",{className:"border-b border-gray-300 my-1"}),u.jsx("div",{className:"text-sm text-gray-800",children:Le}),u.jsx("div",{className:"mt-1 text-sm text-gray-800",children:Ke})]})})(),(()=>{var Le;const ae=K.grammarAnalysis.map(De=>De.word),le=Zl(ae),G=new Map,oe=new Set;le.forEach(De=>{let Ke=0;for(;Ke<ae.length;){const pt=ae.slice(Ke).findIndex((R,D)=>De.words.every((F,M)=>{var X;return((X=ae[Ke+D+M])==null?void 0:X.toLowerCase())===F.toLowerCase()}));if(pt!==-1){const R=Ke+pt;G.set(R,De),De.words.forEach((D,F)=>oe.add(R+F));break}Ke++}});const he=K.grammarAnalysis.filter(De=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(De.word)),Te={one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",ten:"10",eleven:"11",twelve:"12"},Se=De=>{const Ke=De.join(" ").toLowerCase();if(Ke==="i")return"ÁßÅ„ÅØ";if(Ke==="wake up")return"Ëµ∑„Åç„Çã";if(De.length===2&&De[0].toLowerCase()==="at"){const pt=De[1].toLowerCase(),R=Te[pt]||(pt.match(/^\d+$/)?pt:"");if(R)return`${R}ÊôÇ„Å´`}return De.length===2&&De[0].toLowerCase()==="every"&&De[1].toLowerCase()==="morning"?"ÊØéÊúù":De.map(pt=>Ae(pt,void 0)).filter(pt=>pt&&pt!=="-").join(" ")},te=[];for(let De=0;De<he.length;De++){const Ke=he[De];if(oe.has(De)&&!G.has(De))continue;const pt=G.get(De);if(pt){const D=pt.words.join(" ").toLowerCase(),F=((Le=y.get(D))==null?void 0:Le.meaning)||Se(pt.words);te.push({english:pt.words.join(" "),meaning:F,isPhrase:!0}),De+=pt.words.length-1;continue}if(Ke.tag==="Prep"&&De+1<he.length){const D=[Ke.word,he[De+1].word];te.push({english:D.join(" "),meaning:Se(D),isPhrase:!0}),De+=1;continue}if(Ke.tag==="Det"&&Ke.word.toLowerCase()==="every"&&De+1<he.length){const D=[Ke.word,he[De+1].word];te.push({english:D.join(" "),meaning:Se(D),isPhrase:!0}),De+=1;continue}const R=Se([Ke.word]);te.push({english:Ke.word,meaning:R,isPhrase:!1})}const Fe=[];return te.forEach((De,Ke)=>{const pt=Ke===te.length-1;De.isPhrase?Fe.push(u.jsxs("div",{className:"inline-flex items-center gap-1 bg-yellow-50 px-2 py-1 rounded border border-yellow-200",children:[u.jsx("span",{className:"font-medium text-sm border-b-2 border-yellow-600",children:De.english}),t&&s&&r&&u.jsx(oi,{word:{word:De.english,meaning:De.meaning,source:"reading",sourceDetail:ve==null?void 0:ve.title},sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:"small"})]},`item-${Ke}`)):Fe.push(u.jsxs("div",{className:"inline-flex items-center gap-1 bg-blue-50 px-2 py-1 rounded border border-blue-200",children:[u.jsx("span",{className:"font-medium text-sm border-b-2 border-blue-600",children:De.english}),t&&s&&r&&u.jsx(oi,{word:{word:De.english,meaning:De.meaning,source:"reading",sourceDetail:ve==null?void 0:ve.title},sets:e,onAddWord:t,onRemoveWord:s,onOpenManagement:r,size:"small"})]},`item-${Ke}`)),pt||Fe.push(u.jsx("span",{className:"text-gray-500",children:"+"},`sep-${Ke}`))}),u.jsxs("div",{className:"mt-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üìö ÂçòË™û„Å®ÁÜüË™û"}),u.jsx("div",{className:"flex flex-wrap gap-1",children:Fe}),u.jsx("div",{className:"mt-1 text-sm text-gray-700",children:te.map(De=>De.meaning).join(" ")})]})})(),(()=>{const ae=uY(K.text);return ae.length===0?null:u.jsxs("div",{className:"mt-2",children:[u.jsx("h5",{className:"text-xs font-semibold mb-1 text-gray-700",children:"üìê ÈáçË¶ÅÊßãÊñá"}),u.jsx("div",{className:"space-y-1",children:ae.map((le,G)=>u.jsxs("div",{className:"bg-green-50 p-2 rounded border border-green-200",children:[u.jsxs("div",{className:"flex items-center justify-between text-sm",children:[u.jsx("span",{className:"font-semibold text-green-700",children:le.name}),u.jsx("span",{className:"text-xs text-gray-600",children:le.meaning})]}),u.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["üí° ",le.explanation]})]},G))})]})})(),K.showMeanings&&u.jsxs("div",{className:"word-cards-container",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üìö ÂçòË™û„ÅÆÊÑèÂë≥:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:K.grammarAnalysis.filter(ae=>!/^[.,!?;:\-‚Äî‚Äì"'()]$/.test(ae.word)).map((ae,le)=>{const G=Ae(ae.word,void 0);return u.jsxs("div",{className:"word-card",onDoubleClick:oe=>et(ae.word,oe),title:"„ÉÄ„Éñ„É´„Çø„ÉÉ„Éó: Ë©≥Á¥∞Ë°®Á§∫",children:[u.jsx("div",{className:"word-card-word",children:ae.word}),G&&G!=="-"&&u.jsx("div",{className:"word-card-meaning text-xs",children:G})]},le)})})]})]})]}),j==="fullText"&&u.jsxs("div",{className:"full-text-display",children:[u.jsx("h3",{children:"üìÑ ÂÖ®Êñá"}),u.jsxs("div",{className:"full-text-controls",children:[u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-primary text-white border-2 border-primary rounded-lg transition-all duration-200 hover:bg-primary-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-primary-hover",onClick:()=>{const ae=ve.phrases.map(le=>le.segments.map(oe=>oe.word).join(" ").replace(/^[A-Z][a-z]*(?:\s+\d+)?:\s*/,"").replace(/"/g,"")).join(" ").replace(/\s+([.,!?;:])/g,"$1");Ts(ae),L(!0),V(!1)},disabled:z&&!U,title:"ÂÖ®Êñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-warning-hover",onClick:()=>{U?(a9(),V(!1)):(i9(),V(!0))},disabled:!z,title:U?"Áô∫Èü≥„ÇíÂÜçÈñã":"Áô∫Èü≥„Çí‰∏ÄÊôÇÂÅúÊ≠¢",children:U?"‚ñ∂Ô∏è ÂÜçÈñã":"‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢"}),u.jsx("button",{className:"px-6 py-3 text-base font-medium bg-error text-white border-2 border-error rounded-lg transition-all duration-200 hover:bg-error-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-error-hover",onClick:()=>{o9(),L(!1),V(!1)},disabled:!z,title:"Áô∫Èü≥„ÇíÂÅúÊ≠¢",children:"‚èπÔ∏è ÂÅúÊ≠¢"})]}),u.jsx("div",{className:"full-text-content",children:(()=>{if(ve.originalText)return u.jsx("div",{className:"paragraph-en",children:ve.originalText});if(ve.title.toLowerCase().includes("conversation")){const le=[];return ve.phrases.forEach(G=>{let oe=G.segments.map(he=>he.word).join(" ").trim();!oe||oe==="-"||(oe=oe.replace(/\s+([.,!?;:"])/g,"$1"),le.push(oe))}),u.jsx("div",{children:le.map((G,oe)=>u.jsx("p",{className:"paragraph-en conversation-line",children:G},oe))})}else{const G=ve.phrases[0].segments.map(D=>D.word).join(" ").trim(),oe=G.length<100&&!/[.!?]$/.test(G);let he="",Te=!0;ve.phrases.forEach((D,F)=>{F===0&&oe||D.segments.forEach(M=>{let X=M.word.trim();X&&X!=="-"&&(/^[.,!?;:]$/.test(X)?(he+=X,Te=/^[.!?]$/.test(X)):(X==='"'||X==="'"||(Te&&X.length>0&&(X=X.charAt(0).toUpperCase()+X.slice(1),Te=!1),he.length>0&&!he.endsWith(" ")&&!he.endsWith('"')&&!he.endsWith("'")&&(he+=" ")),he+=X))})}),he=he.replace(/\s+"/g,'"').replace(/\s+'/g,"'");const Se=he.split(/([.!?])\s+/).filter(D=>D.trim()),te=[];for(let D=0;D<Se.length;D+=2){const F=Se[D],M=Se[D+1]||"";te.push((F+M).trim())}const Fe=[];let Le=[],De=0;const Ke=60;te.forEach((D,F)=>{const M=D.split(/\s+/).length;Le.push(D),De+=M,(De>=Ke||F===te.length-1)&&(Fe.push(Le.join(" ")),Le=[],De=0)}),Le.length>0&&Fe.push(Le.join(" "));const pt=te,R=D=>{Y(D);const F=pt[D],M=Jl(F);pe({text:F,grammarAnalysis:M,showMeanings:!1})};return u.jsxs("div",{children:[u.jsx("div",{className:"sentences-container",children:pt.map((D,F)=>u.jsxs("span",{className:`sentence-clickable ${B===F?"selected":""}`,onClick:()=>R(F),children:[D," "]},F))}),B!==null&&K&&u.jsxs("div",{className:"selected-sentence-analysis",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h4",{className:"m-0",children:"üìñ ÈÅ∏Êäû„Åó„ÅüÊñá„ÅÆË™≠Ëß£"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"px-3 py-1 text-sm bg-primary text-white rounded hover:bg-primary-hover",onClick:()=>Ts(K.text),title:"„Åì„ÅÆÊñá„ÇíÁô∫Èü≥",children:"üîä Áô∫Èü≥"}),u.jsx("button",{className:"px-3 py-1 text-sm bg-info text-white rounded hover:bg-info-hover",onClick:()=>pe({...K,showMeanings:!K.showMeanings}),children:K.showMeanings?"ÊÑèÂë≥„ÇíÈö†„Åô":"ÊÑèÂë≥„ÇíË°®Á§∫"})]})]}),u.jsx("div",{className:"selected-sentence-text",children:K.text}),u.jsxs("div",{className:"grammar-structure mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üî§ ÊñáÊ≥ïÊßãÈÄ†:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:K.grammarAnalysis.map((D,F)=>u.jsxs("div",{className:"grammar-tag","data-tag":D.tag,title:D.description,children:[u.jsx("span",{className:"font-semibold",children:D.word}),u.jsxs("span",{className:"ml-1 text-xs grammar-tag-label","data-tag":D.tag,children:["[",D.tag,"]"]})]},F))})]}),K.showMeanings&&u.jsxs("div",{className:"word-cards-container mt-4",children:[u.jsx("h5",{className:"text-sm font-semibold mb-2",children:"üìö ÂçòË™û„ÅÆÊÑèÂë≥:"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:K.grammarAnalysis.filter(D=>!/^[.,!?;:]$/.test(D.word)).map((D,F)=>{const M=Ae(D.word,void 0);return u.jsxs("div",{className:"word-card",onDoubleClick:X=>et(D.word,X),title:"„ÉÄ„Éñ„É´„Çø„ÉÉ„Éó: Ë©≥Á¥∞Ë°®Á§∫",children:[u.jsx("div",{className:"word-card-word",children:D.word}),M&&M!=="-"&&u.jsx("div",{className:"word-card-meaning text-xs",children:M})]},F)})})]})]})]})}})()})]}),j==="fullTranslation"&&u.jsx("div",{className:"full-translation-display",children:u.jsx("div",{className:"full-translation-content",children:(()=>{var le;if(console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.id:",ve.id),console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.translation exists:",!!ve.translation),console.log("[ÂÖ®Ë®≥„Çø„Éñ] currentPassage.translation length:",((le=ve.translation)==null?void 0:le.length)||0),ve.translation){const G=ve.translation.split(/\n+/).map(oe=>oe.trim()).filter(oe=>oe.length>0);return u.jsx("div",{className:"full-translation-text",children:G.map((oe,he)=>u.jsx("p",{className:"paragraph-ja",children:oe},he))})}if(ve.title.toLowerCase().includes("conversation")){const G=[];return ve.phrases.forEach(oe=>{let he=oe.phraseMeaning||"";he=he.replace(/\[Ë¶Å‰øÆÊ≠£\]/g,"").trim(),!(!he||he==="-")&&G.push(he)}),G.map((oe,he)=>u.jsx("p",{className:"paragraph-ja conversation-line",children:oe},he))}else{const G=[];let oe="";ve.phrases.forEach(Se=>{let te=Se.phraseMeaning||"";if(te){if(te=te.replace(/\[Ë¶Å‰øÆÊ≠£\]/g,"").trim(),!te)return;const Fe=Se.segments.map(De=>De.word).join(" ").trim(),Le=/[.!?]$/.test(Fe);/[„ÄÇÔºÅÔºü]$/.test(te)?(oe+=te,Le&&(G.push(oe.trim()),oe="")):Le?(oe+=te+"„ÄÇ",G.push(oe.trim()),oe=""):oe+=te+"„ÄÅ"}}),oe.trim()&&G.push(oe.trim()+"„ÄÇ");const he=[],Te=4;for(let Se=0;Se<G.length;Se+=Te){const te=G.slice(Se,Se+Te);he.push(te.join(""))}return he.map((Se,te)=>u.jsx("p",{className:"paragraph-ja",children:Se},te))}})()})})]}),u.jsx("style",{children:`
        .comprehensive-reading-view {
          max-width: 1200px;
          margin: 0 auto;
          padding: 20px;
          width: 100%;
        }

        @media (max-width: 768px) {
          .comprehensive-reading-view {
            max-width: 100%;
            margin: 0;
            padding: 8px;
          }
        }

        .reading-header {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-bottom: 20px;
        }

        .dark-mode .reading-header {
          background: var(--gray-800);
        }

        .reading-header h2 {
          margin: 0 0 20px 0;
        }

        .filter-controls, .passage-selector {
          margin-bottom: 15px;
        }

        .filter-controls label, .passage-selector label {
          font-weight: bold;
          margin-right: 10px;
          color: #333;
        }

        .dark-mode .filter-controls label,
        .dark-mode .passage-selector label {
          color: var(--gray-200);
        }

        .filter-controls select, .passage-selector select {
          padding: 8px 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-size: 14px;
          background: white;
          color: #333;
        }

        .dark-mode .filter-controls select,
        .dark-mode .passage-selector select {
          background: var(--gray-700);
          border-color: var(--gray-600);
          color: var(--gray-200);
        }

        .passage-stats {
          display: flex;
          gap: 10px;
          margin: 15px 0;
          flex-wrap: wrap;
        }

        .stat-badge {
          display: inline-block;
          padding: 6px 12px;
          background: #f0f0f0;
          border-radius: 4px;
          font-size: 14px;
          color: #333;
        }

        .dark-mode .stat-badge {
          background: var(--gray-700);
          color: var(--gray-200);
        }

        .stat-badge.unknown-count {
          background: #fff3cd;
          color: #856404;
          font-weight: bold;
        }

        .dark-mode .stat-badge.unknown-count {
          background: var(--yellow-500);
          color: var(--black);
        }

        .action-buttons {
          display: flex;
          gap: 10px;
          margin-top: 15px;
        }

        .action-buttons button {
          padding: 10px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 14px;
          font-weight: bold;
          transition: all 0.3s;
        }

        .btn-primary {
          background: #007bff;
          color: white;
        }

        .btn-primary:hover {
          background: #0056b3;
        }

        .btn-info {
          background: #17a2b8;
          color: white;
        }

        .btn-info:hover {
          background: #138496;
        }

        .btn-success {
          background: #28a745;
          color: white;
        }

        .btn-success:hover {
          background: #218838;
        }

        .btn-success:disabled {
          background: #ccc;
          cursor: not-allowed;
        }

        .btn-secondary {
          background: #6c757d;
          color: white;
        }

        .btn-secondary:hover {
          background: #545b62;
        }

        .passage-content {
          background: white;
          padding: 30px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dark-mode .passage-content {
          background: var(--gray-800);
          color: var(--gray-100);
        }

        .passage-title {
          text-align: center;
          color: #333;
          margin-bottom: 30px;
          font-size: 24px;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .passage-title {
          color: var(--white);
        }

        .passage-body {
          line-height: 1.5;
          font-family: 'Times New Roman', Georgia, serif;
          color: #333;
        }

        .dark-mode .passage-body {
          color: var(--gray-200);
        }

        .phrase-block {
          margin-bottom: 8px;
          padding: 8px 12px;
          background: #ffffff;
          border-left: 3px solid #007bff;
          border-radius: 2px;
        }

        .dark-mode .phrase-block {
          background: var(--gray-700);
          border-left-color: var(--blue-400);
        }

        .phrase-english {
          font-size: 16px;
          line-height: 1.6;
          margin-bottom: 6px;
          font-family: 'Times New Roman', 'Georgia', serif;
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          align-items: flex-start;
        }

        .word-card {
          display: inline-flex;
          flex-direction: column;
          align-items: center;
          padding: 2px 5px;
          margin: 1px;
          background: #f8f9fa;
          border: 1px solid #dee2e6;
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s;
          min-width: 60px;
        }

        .dark-mode .word-card {
          background: var(--gray-700);
          border-color: var(--gray-600);
        }

        .word-card:hover {
          background: #e7f3ff;
          border-color: #007bff;
        }

        .dark-mode .word-card:hover {
          background: var(--gray-600);
          border-color: var(--blue-400);
        }

        .word-card.unknown {
          background: #ffc107;
          color: #000;
          border-color: #ff9800;
          font-weight: bold;
        }

        .word-card.phrase-card {
          background: #e8f5e9;
          border-color: #4caf50;
        }

        .dark-mode .word-card.phrase-card {
          background: var(--gray-700);
          border-color: var(--green-400);
        }

        .word-card.phrase-card:hover {
          background: #c8e6c9;
        }

        .dark-mode .word-card.phrase-card:hover {
          background: var(--gray-600);
        }

        .word-card.punctuation-card {
          min-width: 20px;
          background: transparent;
          border: none;
          cursor: default;
          padding: 2px 4px;
        }

        .word-card.punctuation-card:hover {
          background: transparent;
          border: none;
        }

        .word-card-word {
          font-size: 16px;
          font-weight: 500;
          color: #333;
          text-align: center;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .word-card-word {
          color: var(--gray-200);
        }

        .phrase-card .word-card-word {
          font-size: 15px;
          color: #2e7d32;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .dark-mode .phrase-card .word-card-word {
          color: var(--green-400);
        }

        .word-card-meaning {
          font-size: 12px;
          color: #666;
          margin-top: 1px;
          text-align: center;
          padding: 1px 3px;
          background: rgba(255, 255, 255, 0.8);
          border-radius: 2px;
          min-height: 14px;
        }

        .dark-mode .word-card-meaning {
          color: var(--gray-300);
          background: rgba(48, 48, 48, 0.8);
        }

        .word-segment {
          display: inline-block;
          padding: 2px 4px;
          margin: 0 2px;
          cursor: pointer;
          border-radius: 3px;
          transition: all 0.2s;
          font-family: 'Times New Roman', Georgia, serif;
        }

        .word-segment:hover {
          background: #e7f3ff;
        }

        .word-segment.unknown {
          background: #ffc107;
          color: #000;
          font-weight: bold;
        }

        .show-translation-btn {
          background: #f8f9fa;
          border: 1px solid #ddd;
          padding: 8px 16px;
          border-radius: 4px;
          cursor: pointer;
          color: #666;
          font-size: 14px;
        }

        .show-translation-btn:hover {
          background: #e9ecef;
        }

        .phrase-translation {
          margin-top: 10px;
          padding: 15px;
          background: white;
          border-radius: 4px;
          border: 1px solid #dee2e6;
        }

        .dark-mode .phrase-translation {
          background: var(--gray-800);
          border-color: var(--gray-600);
        }

        .translation-text {
          font-size: 16px;
          color: #333;
          margin-bottom: 10px;
          font-weight: 500;
        }

        .dark-mode .translation-text {
          color: var(--gray-200);
        }

        .word-meanings {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          font-size: 14px;
          color: #666;
        }

        .dark-mode .word-meanings {
          color: var(--gray-300);
        }

        .word-meaning-pair {
          background: #e7f3ff;
          padding: 4px 8px;
          border-radius: 3px;
        }

        .dark-mode .word-meaning-pair {
          background: var(--gray-700);
          color: var(--gray-200);
        }

        .error-message, .empty-container {
          text-align: center;
          padding: 50px;
          font-size: 18px;
          color: #666;
        }

        .dark-mode .error-message,
        .dark-mode .empty-container {
          color: var(--gray-300);
        }

        .error-message {
          color: #dc3545;
        }

        .dark-mode .error-message {
          color: var(--red-400);
        }

        /* ÂçòË™û„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÅÆ„Çπ„Çø„Ç§„É´ */
        .word-popup-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: transparent;
          z-index: 999;
        }

        .word-popup {
          position: absolute;
          left: var(--popup-x, 0);
          top: var(--popup-y, 0);
          background: white;
          border: 2px solid #007bff;
          border-radius: 8px;
          padding: 16px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          z-index: 1000;
          max-width: 400px;
          min-width: 250px;
        }

        .dark-mode .word-popup {
          background: var(--gray-800);
          border-color: var(--blue-400);
          color: var(--gray-200);
        }

        .popup-close {
          position: absolute;
          top: 8px;
          right: 8px;
          background: #f8f9fa;
          border: none;
          border-radius: 4px;
          width: 24px;
          height: 24px;
          cursor: pointer;
          font-size: 16px;
          line-height: 1;
          color: #666;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .popup-close:hover {
          background: #e9ecef;
          color: #000;
        }

        .popup-word {
          font-size: 20px;
          font-weight: bold;
          color: #007bff;
          margin-bottom: 4px;
          padding-right: 30px;
        }

        .popup-reading {
          font-size: 14px;
          color: #666;
          margin-bottom: 8px;
        }

        .popup-meaning {
          font-size: 16px;
          color: #333;
          margin-bottom: 12px;
          padding: 8px;
          background: #f0f8ff;
          border-radius: 4px;
        }

        .popup-etymology {
          font-size: 13px;
          color: #555;
          margin-bottom: 8px;
          padding: 6px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .popup-related {
          font-size: 13px;
          color: #555;
          padding: 6px;
          background: #f8f9fa;
          border-radius: 4px;
        }

        .popup-etymology strong,
        .popup-related strong {
          color: #007bff;
        }

        .full-text-display, .full-translation-display {
          background: white;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          margin-top: 20px;
        }

        .dark-mode .full-text-display,
        .dark-mode .full-translation-display {
          background: var(--gray-800);
          color: var(--gray-100);
        }

        .full-text-display h3, .full-translation-display h3 {
          margin: 0 0 15px 0;
          color: #667eea;
        }

        .dark-mode .full-text-display h3,
        .dark-mode .full-translation-display h3 {
          color: var(--blue-400);
        }

        .full-text-content {
          font-size: 1.1em;
          line-height: 1.8;
          color: #333;
          font-family: 'Times New Roman', 'Georgia', serif;
        }

        .full-text-content .paragraph-en {
          margin-bottom: 1.5em;
          text-indent: 2em;
          text-align: left;
        }

        .full-text-content .paragraph-en:first-child {
          margin-top: 0;
        }

        /* ‰ºöË©±ÂΩ¢Âºè„ÅÆË°å„Çπ„Çø„Ç§„É´ */
        .full-text-content .conversation-line {
          text-indent: 0;
          margin-bottom: 1em;
          padding-left: 1em;
          border-left: 3px solid #667eea;
        }

        .full-translation-content {
          font-size: 1.05em;
          line-height: 2;
          color: #333;
        }

        .full-translation-text {
          white-space: pre-wrap;
          line-height: 2;
        }

        .full-translation-content .paragraph-ja {
          margin-bottom: 1.5em;
          text-indent: 1em;
          text-align: left;
        }

        .full-translation-content .paragraph-ja:first-child {
          margin-top: 0;
        }

        /* ‰ºöË©±ÂΩ¢Âºè„ÅÆÊó•Êú¨Ë™ûË®≥„Çπ„Çø„Ç§„É´ */
        .full-translation-content .conversation-line {
          text-indent: 0;
          margin-bottom: 1em;
          padding-left: 1em;
          border-left: 3px solid #667eea;
        }

        .translation-line {
          margin-bottom: 10px;
          padding: 8px;
          background: #f8f9fa;
          border-radius: 4px;
        }
      `})]})}const dY=Object.freeze(Object.defineProperty({__proto__:null,default:OI},Symbol.toStringTag,{value:"Module"}));function hY(n){if(!n)return null;const e=n.match(/[A-Za-z0-9]+(?:[‚Äô'][A-Za-z0-9]+)*(?:-[A-Za-z0-9]+(?:[‚Äô'][A-Za-z0-9]+)*)*|[.,!?;:()]/g);if(!e||e.length===0)return null;const t=[];for(const s of e){if(/[A-Za-z0-9]/.test(s)){t.push("____");continue}if(/^[.,!?;:]$/.test(s)){t.length===0?t.push(`____${s}`):t[t.length-1]=`${t[t.length-1]}${s}`;continue}if(s==="("){t.push("(");continue}if(s===")"){t.length===0?t.push(")"):t[t.length-1]=`${t[t.length-1]})`;continue}}return t.join(" ").replace(/\(\s+/g,"(").replace(/\s+\)/g,")").replace(/\s+([.,!?;:])/g,"$1").trim()}function LI(n){var Xe,$e,Oe,ht;const[e,t]=T.useState(()=>localStorage.getItem("grammar-quiz-type")||"verb-form"),[s,r]=T.useState(()=>localStorage.getItem("grammar-grade")||"all"),[o,i]=T.useState([]),[a,c]=T.useState(!1),[l,d]=T.useState(!1),[h,p]=T.useState(!1),f=Mh(ja.GRAMMAR),{processQuestion:m}=Ph(),[g]=T.useState(()=>{const se=new Pl;return localStorage.getItem("enable-ai-coordination")==="true"&&(se.enableAICoordination(!0),_.info("ü§ñ [GrammarQuizView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),se}),{reAddQuestion:x,clearExpiredFlags:y,updateRequeueStats:b,getRequeuedWords:v,checkPositionMismatch:w}=jl(),[S,N]=T.useState(Date.now()),[C,k]=T.useState(void 0),[I,$]=T.useState(void 0),[j,P]=T.useState(0),[O,A]=T.useState(0),{learningLimit:z,reviewLimit:L,setLearningLimit:U,setReviewLimit:V}=_0("grammar"),[B,Y]=T.useState(!1),[K,pe]=T.useState(0),[ge,re]=T.useState(!1),ye=()=>{Y(!B)},Ae=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:se}=await gs(async()=>{const{resetAllProgress:Ne}=await Promise.resolve().then(()=>ei);return{resetAllProgress:Ne}},void 0);await se(),le(!1),Te([]),te(0),Le(null),Ke([]),R([]),F(""),X(!1),J(!1),me(0),Ie(0),Z({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),P(0),A(0),console.log("‚úÖ [ÊñáÊ≥ï„Çø„Éñ] Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(se){console.error("‚ùå [ÊñáÊ≥ï„Çø„Éñ] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",se),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},ve=()=>{p(!0)},_e=async(se,Ne)=>{try{const Be=ot=>ot.difficulty==="beginner"?.3:ot.difficulty==="intermediate"?.6:ot.difficulty==="advanced"?.9:.5,rt=()=>{const ot=new Date().getHours();return ot<12?"morning":ot<18?"afternoon":ot<22?"evening":"night"};await m(se,Ne?"correct":"incorrect",{currentDifficulty:Be(ie),timeOfDay:rt(),recentErrors:tt.incorrect,sessionLength:Math.floor((Date.now()-Ge.current)/6e4),consecutiveCorrect:j})}catch(Be){console.error("[GrammarQuizView] Adaptive AI error:",Be)}},[ze,et]=T.useState(()=>localStorage.getItem("autoNext-grammar")==="true"),[ut,yt]=T.useState(()=>{const se=localStorage.getItem("autoNextDelay-grammar");return se?parseInt(se,10):1500}),[bt,$t]=T.useState(()=>localStorage.getItem("autoReadAloud-grammar")==="true"),[ae,le]=T.useState(!1),[G,oe]=T.useState(!1),[he,Te]=T.useState([]),[Se,te]=T.useState(0),[Fe,Le]=T.useState(null),[De,Ke]=T.useState([]),[pt,R]=T.useState([]),[D,F]=T.useState(""),[M,X]=T.useState(!1),[ue,J]=T.useState(!1),[de,me]=T.useState(0),[Me,Ie]=T.useState(0),[tt,Z]=T.useState({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[xe,ke]=T.useState(null),ie=he[Se],We=(ie==null?void 0:ie.type)==="sentenceOrdering"||e==="sentence-ordering",vt=We?(ie==null?void 0:ie.correctAnswer)||(ie==null?void 0:ie.correctOrder):void 0,dt=We?hY(vt):null,st=We&&typeof vt=="string"&&/[.,!?;:]/.test(vt)&&!!dt,Xt=ie!=null&&ie.id?(()=>{const se=ie.id.match(/^g(\d+)-u(\d+)/);if(se)return`g${se[1]}-unit${se[2]}`})():void 0,ft=T.useRef({quizType:e,grade:s}),Ge=T.useRef(Date.now()),nt=T.useCallback(()=>{if(Se<he.length-1){const se=Se+1,Ne=y(he,se-1);Ne!==he&&Te(Ne),te(se),Le(null),Ke([]),X(!1),J(!1),Ge.current=Date.now(),$(void 0)}},[Se,he]),at=T.useCallback(async()=>{var se,Ne;if(!G){oe(!0),ke(null);try{let Be=[],rt=null;if(s==="all")Be=["1","2","3"];else if(s.match(/^[123]$/))Be=[s];else if(s.endsWith("-all"))Be=[s.charAt(0)];else if(s.match(/^g\d+-unit\d+$/)){const At=(se=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:se[1],Et=(Ne=s.match(/^g(\d+)-unit(\d+)$/))==null?void 0:Ne[2];At&&Et!==void 0&&(Be=[At],rt=parseInt(Et))}const ot=[];for(const At of Be)for(let Et=0;Et<10;Et++)if(!(rt!==null&&Et!==rt))try{const Rn=await fetch(`/data/grammar/grammar_grade${At}_unit${Et}.json`);if(Rn.ok){const Ce=await Rn.json();if(Ce.enabled===!1){_.log(`grammar_grade${At}_unit${Et}.json is disabled: ${Ce.disabledReason||"No reason provided"}`);continue}ot.push(Ce)}else _.log(`grammar_grade${At}_unit${Et}.json returned status ${Rn.status}, skipping...`)}catch(Rn){_.log(`Failed to fetch grammar_grade${At}_unit${Et}.json:`,Rn)}if(ot.length===0)throw new Error(`ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºàÂ≠¶Âπ¥: ${s}, ÂΩ¢Âºè: ${e}Ôºâ`);const Qe=[];if(ot.forEach(At=>{const Et=At.questions||[],Rn={"verb-form":"verbForm","fill-in-blank":"fillInBlank","sentence-ordering":"sentenceOrdering"};if(e==="all"||e==="random")Qe.push(...Et);else{const Ce=Rn[e]||e,Ve=Et.filter(je=>je.type===Ce);Qe.push(...Ve)}}),Qe.length===0)throw new Error("ÈÅ∏Êäû„Åï„Çå„ÅüÊù°‰ª∂„Å´Ë©≤ÂΩì„Åô„ÇãÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");if(_.log(`Total questions: ${Qe.length}`),Qe.length===0)throw new Error("ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");const Ft=At=>{if(At.word)return At.word;if(At.id)return`grammar_${At.id}`;if(At.question)return`grammar_${At.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const Et=At.japanese||At.sentence||"unknown";return`grammar_${String(Et).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`},Ze=Qe.map(At=>({word:Ft(At),meaning:At.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:At.difficulty||"beginner"})),He=await g.schedule({questions:Ze,mode:"grammar",limits:{learningLimit:z,reviewLimit:L},sessionStats:{correct:tt.correct,incorrect:tt.incorrect,still_learning:tt.review||0,mastered:tt.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:B}),It=new Map(Qe.map(At=>[Ft(At),At])),Gt=He.scheduledQuestions.map(At=>{const Et=It.get(At.word);if(Et)return{...Et,word:At.word,position:At.position,finalPriority:At.finalPriority}}).filter(At=>At!==void 0);He.vibrationScore>50&&_.warn("[GrammarQuizView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:He.vibrationScore,processingTime:He.processingTime}),_.log("[GrammarQuizView] QuestionSchedulerÈÅ©Áî®ÂÆå‰∫Ü",{total:Gt.length,vibrationScore:He.vibrationScore}),Te(Gt),te(0),Le(null),Ke([]),R([]),X(!1),J(!1),me(0),Ie(0),Z({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),pe(0),re(!1),le(!0),oe(!1)}catch(Be){_.error("„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Be),ke(Be instanceof Error?Be.message:String(Be)),oe(!1)}}},[e,s]);T.useEffect(()=>{if(!ge||he.length===0)return;const se=Se,Ne=rt=>{if(rt.word)return rt.word;if(rt.id)return`grammar_${rt.id}`;if(rt.question)return`grammar_${rt.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`;const ot=rt.japanese||rt.sentence||"unknown";return`grammar_${String(ot).slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`};(async()=>{try{const rt=he.slice(se);if(rt.length===0){re(!1);return}const ot=rt.map(He=>({word:Ne(He),meaning:He.japanese||"",reading:"",grade:1,category:"grammar",etymology:"",relatedWords:"",relatedFields:"",difficulty:He.difficulty||"beginner"})),Qe=new Map(rt.map(He=>[Ne(He),He]));_.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:K,currentIndex:se,remaining:rt.length});const Ze=(await g.schedule({questions:ot,mode:"grammar",limits:{learningLimit:z,reviewLimit:L},sessionStats:{correct:tt.correct,incorrect:tt.incorrect,still_learning:tt.review||0,mastered:tt.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:B})).scheduledQuestions.map(He=>{const It=Qe.get(He.word);if(It)return{...It,word:He.word,position:He.position,finalPriority:He.finalPriority}}).filter(He=>He!==void 0);Te(He=>He.length===0||Se!==se?He:[...He.slice(0,se),...Ze]),pe(0),re(!1),_.info("[GrammarQuizView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:Ze.length})}catch(rt){_.error("[GrammarQuizView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",rt),re(!1)}})()},[ge,he,Se,g,z,L,tt,B,K]);const jt=T.useCallback(async()=>{if(M)nt();else{me(Qe=>Qe+1),Ie(Qe=>Qe+1),Z(Qe=>({...Qe,correct:Qe.correct+1,mastered:Qe.mastered+1}));const se=Date.now()-Ge.current,{updateWordProgress:Ne,addSessionHistory:Be}=await gs(async()=>{const{updateWordProgress:Qe,addSessionHistory:Ft}=await Promise.resolve().then(()=>ei);return{updateWordProgress:Qe,addSessionHistory:Ft}},void 0),rt=ie.id?`grammar_${ie.id}`:ie.question?`grammar_${ie.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;if(await Ne(rt,!0,se,void 0,"grammar"),Be({status:"correct",word:rt,timestamp:Date.now()},"grammar"),N(Date.now()),Se<he.length-1)te(Qe=>Qe+1),Le(null),Ke([]),X(!1),J(!1),Ge.current=Date.now();else{if(!window.location.hostname.includes("github.io"))try{const Qe=Wr.summarize();_.log("üß™ KPI Summary (grammar):",Qe)}catch{}X(!1)}pe(Qe=>{const Ft=Qe+1;return Ft>=50?(re(!0),0):(Ft%10===0&&w(he,"grammar").needsRescheduling&&re(!0),Ft)})}},[M,Se,he,ie,nt,w]);T.useEffect(()=>{localStorage.setItem("grammar-quiz-type",e)},[e]),T.useEffect(()=>{localStorage.setItem("grammar-grade",s)},[s]),T.useEffect(()=>{(async()=>{const Ne=[],Be=s.match(/^g?(\d+)/),rt=Be?Be[1]:null;if(!rt||s==="all"){i([]);return}for(let ot=0;ot<10;ot++)try{const Qe=await fetch(`/data/grammar/grammar_grade${rt}_unit${ot}.json`);if(Qe.ok){const Ft=await Qe.json();if(Ft.enabled===!1)continue;Ne.push({value:`g${rt}-unit${ot}`,label:`‰∏≠${rt}_Unit${ot}_${Ft.title}`})}}catch{}i(Ne)})()},[s,e]),T.useEffect(()=>{const se=ft.current,Ne=se.quizType!==e||se.grade!==s;ae&&Ne&&at(),ft.current={quizType:e,grade:s}},[e,s,ae,at]),T.useEffect(()=>{if(We&&ie&&ie.words){const se=[...ie.words].sort(()=>Math.random()-.5);R(se),Ke([]),X(!1),J(!1)}},[Se,he,We,ie]),T.useEffect(()=>{Le(null),F(""),X(!1),J(!1)},[Se]),T.useEffect(()=>{const se=Ne=>{ae&&!M&&Ne.key==="Enter"&&(Ne.preventDefault(),jt())};return window.addEventListener("keydown",se),()=>{window.removeEventListener("keydown",se)}},[ae,M,jt]);const Pt=async se=>{var Ve;if(M||We)return;Le(se),X(!0);const Ne=se===ie.correctAnswer,Be=se==="ÂàÜ„Åã„Çâ„Å™„ÅÑ";k(Ne),$(ie.question||ie.sentence),Ne?(P(je=>je+1),A(0)):(A(je=>je+1),P(0));const rt=Ne?0:O+1;!ge&&rt>=5&&re(!0),bt&&ie.sentence&&setTimeout(()=>{const je=new SpeechSynthesisUtterance(ie.sentence);je.lang="en-US",je.rate=.9,window.speechSynthesis.speak(je)},300),Ie(je=>je+1);const ot=Date.now()-Ge.current;if(Ne){me(St=>St+1);const je=ie&&de>=2;Z(St=>({...St,correct:St.correct+1,mastered:je?St.mastered+1:St.mastered}))}else Z(Be?je=>({...je,incorrect:je.incorrect+1,review:je.review+1}):je=>({...je,incorrect:je.incorrect+1}));const{updateWordProgress:Qe,loadProgress:Ft,addSessionHistory:Ze,addQuizResult:He}=await gs(async()=>{const{updateWordProgress:je,loadProgress:St,addSessionHistory:Ct,addQuizResult:wn}=await Promise.resolve().then(()=>ei);return{updateWordProgress:je,loadProgress:St,addSessionHistory:Ct,addQuizResult:wn}},void 0),It=ie.id?`grammar_${ie.id}`:ie.question?`grammar_${ie.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`,{generateId:Gt}=await gs(async()=>{const{generateId:je}=await Promise.resolve().then(()=>gX);return{generateId:je}},void 0);await He({id:Gt(),questionSetId:"grammar-set",questionSetName:"ÊñáÊ≥ïÂïèÈ°å",score:Ne?1:0,total:1,percentage:Ne?100:0,date:Date.now(),timeSpent:Math.floor(ot/1e3),incorrectWords:Ne?[]:[It],mode:"grammar",category:void 0,difficulty:ie.difficulty}),await Qe(It,Ne,ot,void 0,"grammar"),f.recordAnswer(It,Ne,ot),await _e(It,Ne);const Et=(Ve=(await Ft()).wordProgress)==null?void 0:Ve[It];let Rn=Ne?"correct":"incorrect";Et&&Et.masteryLevel==="mastered"?Rn="mastered":!Ne&&Et&&Et.incorrectCount>=2&&(Rn="review"),Ze({status:Rn,word:It,timestamp:Date.now()},"grammar"),N(Date.now());let Ce=he;if(!Ne&&ie){const je=x(ie,he,Se,"grammar");Ce=je,je!==he&&Te(je)}pe(je=>{const St=je+1;return St>=50?(re(!0),0):(St%10===0&&w(Ce,"grammar").needsRescheduling&&re(!0),St)});{const je=String(ie.word);Wr.onShown(je),Wr.onAnswer(je,Ne)}b(ie,tt,Z)},Yt=(se,Ne)=>{M||!We||(Ne?(R(Be=>Be.filter(rt=>rt!==se)),Ke(Be=>{var ot;const rt=[...Be,se];return rt.length===((ot=ie.words)==null?void 0:ot.length)&&!M&&setTimeout(async()=>{var je;X(!0);const Qe=rt.join(" "),Ft=(ie.correctAnswer||ie.correctOrder||ie.sentence||"").replace(/[.!?]/g,"").trim(),Ze=Qe.toLowerCase()===Ft.toLowerCase();Ie(St=>St+1);const He=Date.now()-Ge.current;if(bt&&setTimeout(()=>{const St=new SpeechSynthesisUtterance(Ft);St.lang="en-US",St.rate=.9,window.speechSynthesis.speak(St)},300),Ze){me(Ct=>Ct+1);const St=de>=2;Z(Ct=>({...Ct,correct:Ct.correct+1,mastered:St?Ct.mastered+1:Ct.mastered}))}else Z(St=>({...St,incorrect:St.incorrect+1}));const{updateWordProgress:It,loadProgress:Gt,addSessionHistory:At}=await gs(async()=>{const{updateWordProgress:St,loadProgress:Ct,addSessionHistory:wn}=await Promise.resolve().then(()=>ei);return{updateWordProgress:St,loadProgress:Ct,addSessionHistory:wn}},void 0),Et=ie.id?`grammar_${ie.id}`:ie.question?`grammar_${ie.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:`grammar_unknown_${Date.now()}`;await It(Et,Ze,He,void 0,"grammar");const Ce=(je=(await Gt()).wordProgress)==null?void 0:je[Et];let Ve=Ze?"correct":"incorrect";Ce&&Ce.masteryLevel==="mastered"?Ve="mastered":!Ze&&Ce&&Ce.incorrectCount>=2&&(Ve="review"),At({status:Ve,word:Et,timestamp:Date.now()},"grammar"),await _e(Et,Ze),N(Date.now())},100),rt})):(Ke(Be=>Be.filter(rt=>rt!==se)),R(Be=>[...Be,se])))},mt=()=>{J(!ue)},nn=()=>{Se>0&&(te(se=>se-1),Le(null),Ke([]),X(!1),J(!1),Ge.current=Date.now())},Mt=()=>{var se;return!ie||!M?!1:We?De.join(" ")===((se=ie.words)==null?void 0:se.join(" ")):Fe===ie.correctAnswer};return T.useEffect(()=>{ae||at()},[ae,at]),u.jsxs("div",{className:"quiz-view",children:[xe&&u.jsxs("div",{className:"error-message",children:[u.jsxs("p",{children:["‚ùå ",xe]}),u.jsx("button",{onClick:at,className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"ÂÜçË©¶Ë°å"})]}),!xe&&ae&&ie&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(_h,{mode:"grammar",currentScore:de,totalAnswered:Me,sessionCorrect:tt.correct,sessionIncorrect:tt.incorrect,sessionReview:tt.review,sessionMastered:tt.mastered,sessionStats:tt,onReviewFocus:ye,isReviewFocusMode:B,onShowSettings:()=>c(!0),onResetProgress:Ae,onDebugRequeue:ve,currentWord:ie!=null&&ie.id?`grammar_${ie.id}`:ie!=null&&ie.question?`grammar_${ie.question.slice(0,50).replace(/[^a-zA-Z0-9]/g,"_")}`:void 0,onAnswerTime:S,lastAnswerCorrect:C,lastAnswerWord:I,lastAnswerDifficulty:ie==null?void 0:ie.difficulty,correctStreak:j,incorrectStreak:O,learningPhase:f.state.currentPhase??void 0,estimatedSpeed:(Xe=f.state.personalParams)==null?void 0:Xe.learningSpeed,dataSource:s.startsWith("g")&&s.includes("-unit")?`ÊñáÊ≥ïÂïèÈ°åÈõÜÔΩú${s.replace("g","").replace("-unit","-unit")}`:s==="all"?"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ":`${s}Âπ¥„ÅÆÂÜÖÂÆπ`,category:e==="all"?"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û":e==="verb-form"?"ÂãïË©ûÂ§âÂåñ":e==="fill-in-blank"?"Á©¥Âüã„ÇÅ":e==="sentence-ordering"?"‰∏¶„Å≥Êõø„Åà":"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û",difficulty:"",wordPhraseFilter:"all",grammarUnit:Xt})})}),a&&u.jsxs("div",{className:"study-settings-panel",children:[u.jsxs("div",{className:"settings-header",children:[u.jsx("h3",{children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"grade-select-active",children:"üìö Â≠¶Âπ¥„ÉªÂçòÂÖÉ:"}),u.jsxs("select",{id:"grade-select-active",value:s,onChange:se=>r(se.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®Â≠¶Âπ¥„ÅÆÂÜÖÂÆπ"}),u.jsx("option",{value:"1",children:"1Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(se=>se.value.startsWith("g1-")).map(se=>u.jsxs("option",{value:se.value,children:["1Âπ¥_",se.label.replace(/^‰∏≠\d+_/,"")]},se.value)),u.jsx("option",{value:"2",children:"2Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(se=>se.value.startsWith("g2-")).map(se=>u.jsxs("option",{value:se.value,children:["2Âπ¥_",se.label.replace(/^‰∏≠\d+_/,"")]},se.value)),u.jsx("option",{value:"3",children:"3Âπ¥„ÅÆÂÜÖÂÆπ"}),o.filter(se=>se.value.startsWith("g3-")).map(se=>u.jsxs("option",{value:se.value,children:["3Âπ¥_",se.label.replace(/^‰∏≠\d+_/,"")]},se.value))]})]}),u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"quiz-type-select-active",children:"üìù ÂïèÈ°å„ÅÆÁ®ÆÈ°û:"}),u.jsxs("select",{id:"quiz-type-select-active",value:e,onChange:se=>t(se.target.value),className:"select-input",children:[u.jsx("option",{value:"all",children:"ÂÖ®„Å¶„ÅÆÁ®ÆÈ°û"}),u.jsx("option",{value:"verb-form",children:"ÂãïË©ûÂ§âÂåñ"}),u.jsx("option",{value:"fill-in-blank",children:"Á©¥Âüã„ÇÅ"}),u.jsx("option",{value:"sentence-ordering",children:"‰∏¶„Å≥Êõø„Åà"})]})]}),u.jsx(D0,{learningLimit:z,reviewLimit:L,onLearningLimitChange:U,onReviewLimitChange:V,idPrefix:"grammar-quiz-"}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-next-toggle-grammar-quiz",checked:ze,onChange:se=>{et(se.target.checked),localStorage.setItem("autoNext-grammar",se.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-next-toggle-grammar-quiz",className:"checkbox-label",children:["Ê≠£Ëß£ÊôÇËá™Âãï„ÅßÊ¨°„Å∏Ôºö",ze?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})}),ze&&u.jsxs("div",{className:"filter-group",children:[u.jsx("label",{htmlFor:"auto-next-delay-grammar-quiz",children:"‚è±Ô∏è Ê¨°„Å∏„ÅÆÈÅÖÂª∂ÊôÇÈñìÔºö"}),u.jsxs("div",{className:"slider-row",children:[u.jsx("input",{type:"range",id:"auto-next-delay-grammar-quiz",min:"500",max:"3000",step:"100",value:ut,onChange:se=>{const Ne=parseInt(se.target.value,10);yt(Ne),localStorage.setItem("autoNextDelay-grammar",Ne.toString())},className:"slider-input"}),u.jsxs("span",{className:"slider-value",children:[(ut/1e3).toFixed(1),"Áßí"]})]})]}),u.jsx("div",{className:"filter-group",children:u.jsxs("div",{className:"checkbox-row",children:[u.jsx("input",{type:"checkbox",id:"auto-read-aloud-toggle-grammar-quiz",checked:bt,onChange:se=>{$t(se.target.checked),localStorage.setItem("autoReadAloud-grammar",se.target.checked.toString())}}),u.jsxs("label",{htmlFor:"auto-read-aloud-toggle-grammar-quiz",className:"checkbox-label",children:["ÂõûÁ≠îÊôÇËá™Âãï„ÅßË™≠„Åø‰∏ä„ÅíÔºö",bt?"ÊúâÂäπ":"ÁÑ°Âäπ"]})]})})]}),u.jsx("div",{className:"question-container",children:u.jsxs("div",{className:"question-card relative",children:[u.jsx("button",{onClick:()=>d(!0),className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{className:"question-nav-row",children:[u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:nn,disabled:Se===0,title:"Ââç„Å∏",children:"‚Üê"}),u.jsxs("div",{className:"question-content-inline",children:[u.jsxs("div",{className:`question-text ${ue?"hint-active":""} ${M?"":"clickable"}`,onClick:M?void 0:mt,title:M?"":"„Çø„ÉÉ„Éó„Åó„Å¶„Éí„É≥„Éà„ÇíË°®Á§∫ üí°",children:[ie.japanese,!M&&u.jsx("span",{className:"hint-icon",children:"üí°"})]}),ie.difficulty&&u.jsx("div",{className:`difficulty-badge ${ie.difficulty}`,children:ie.difficulty==="beginner"?"ÂàùÁ¥ö":ie.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"})]}),u.jsx("button",{className:"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed",onClick:jt,disabled:Se>=he.length-1,title:M?"Ê¨°„Å∏":"„Çπ„Ç≠„ÉÉ„Éó (Enter)",children:"‚Üí"})]}),ue&&!M&&u.jsx("div",{className:"hint-box",children:ie.hint}),ie.passage&&u.jsxs("div",{className:"passage-context",children:[u.jsx("div",{className:"passage-label",children:"üìñ ÊñáËÑà"}),u.jsxs("div",{className:"passage-content",children:[u.jsx("div",{className:"passage-english",children:ie.passage}),ie.passageJapanese&&u.jsx("div",{className:"passage-japanese",children:ie.passageJapanese})]})]}),We?u.jsxs("div",{className:"word-area",children:[st&&u.jsxs("div",{className:"selected-words-area",children:[u.jsx("div",{className:"area-label",children:"Êñá„ÅÆÂΩ¢ÔºàÂè•Ë™≠ÁÇπ„Å§„ÅçÔºâ"}),u.jsx("div",{className:"sentence-display",children:dt})]}),u.jsxs("div",{className:"selected-words-area",children:[u.jsxs("div",{className:"area-label-with-reset",children:[u.jsxs("span",{className:"area-label",children:["ÈÅ∏Êäû„Åó„ÅüÂçòË™û (",De.length,"Ë™û)"]}),!M&&u.jsx("button",{className:`reset-ordering-button ${De.length===0?"disabled":""}`,onClick:()=>{if(De.length>0){const se=De[De.length-1];Ke(Ne=>Ne.slice(0,-1)),R(Ne=>[...Ne,se])}},disabled:De.length===0,title:De.length===0?"ÂçòË™û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ":"ÊúÄÂæå„ÅÆÂçòË™û„ÇíÊàª„Åô",children:"‚Ü∂ 1„Å§Êàª„Çã"})]}),u.jsxs("div",{className:"word-container",children:[De.map((se,Ne)=>u.jsx("button",{className:"word-button selected",onClick:()=>Yt(se,!1),disabled:M,children:se},`selected-${Ne}`)),De.length===0&&u.jsx("div",{className:"placeholder",children:"„Åì„Åì„Å´ÂçòË™û„Çí‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑ"})]})]}),u.jsxs("div",{className:"remaining-words-area",children:[u.jsxs("div",{className:"area-label",children:["‰Ωø„Åà„ÇãÂçòË™û (",pt.length,"Ë™û)"]}),u.jsx("div",{className:"word-container",children:pt.map((se,Ne)=>u.jsx("button",{className:"word-button remaining",onClick:()=>Yt(se,!0),disabled:M,children:se},`remaining-${Ne}`))})]})]}):u.jsxs("div",{className:"choices-area",children:[ie.conversation?u.jsxs(u.Fragment,{children:[ie.japanese&&ie.japanese.includes("A:")&&ie.japanese.includes("B:")&&u.jsx("div",{className:"japanese-conversation",children:ie.japanese.split(/([AB]:)/).map((se,Ne)=>se==="A:"||se==="B:"?u.jsx("span",{className:"conversation-speaker",children:se},Ne):se.trim()?u.jsx("span",{className:"conversation-text",children:se.trim()},Ne):null)}),u.jsx("div",{className:"conversation-display",children:(ie.conversation||(($e=ie.dialogue)==null?void 0:$e.map(se=>`${se.speaker}: ${se.text}`))||[]).map((se,Ne)=>u.jsx("div",{className:"conversation-line",children:se.split("____").map((Be,rt,ot)=>u.jsxs("span",{children:[Be,rt<ot.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},rt))},Ne))})]}):ie.originalSentence||ie.targetSentence?u.jsxs("div",{className:"paraphrase-display",children:[u.jsx("div",{className:"paraphrase-label",children:"üìù ÂÖÉ„ÅÆÊñá:"}),u.jsx("div",{className:"sentence-display original",children:ie.originalSentence||ie.sentence}),u.jsx("div",{className:"paraphrase-arrow",children:"‚Üì Ë®Ä„ÅÑÊèõ„Åà"}),u.jsx("div",{className:"paraphrase-label",children:"‚úèÔ∏è Êõ∏„ÅçÊèõ„ÅàÂæå:"}),u.jsx("div",{className:"sentence-display target",children:(Oe=ie.question||ie.targetSentence)==null?void 0:Oe.split("____").map((se,Ne,Be)=>u.jsxs("span",{children:[se,Ne<Be.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},Ne))})]}):u.jsx("div",{className:"sentence-display",children:(ht=ie.sentence)==null?void 0:ht.split("____").map((se,Ne,Be)=>u.jsxs("span",{children:[se,Ne<Be.length-1&&u.jsx("span",{className:"fill-in-blank-space",children:"_______"})]},Ne))}),ie.choices&&ie.choices.length>0?u.jsxs("div",{className:"choices-grid",children:[ie.choices.map((se,Ne)=>{const Be=Fe===se,rt=se===ie.correctAnswer,ot=M&&rt,Qe=M&&Be&&!rt;return u.jsxs("button",{className:`choice-button ${Be?"selected":""} ${ot?"correct":""} ${Qe?"incorrect":""}`,onClick:()=>Pt(se),disabled:M,children:[se,ot&&" ‚úì",Qe&&" ‚úó"]},Ne)}),u.jsxs("button",{className:`choice-button dont-know ${Fe==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""} ${M&&Fe==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"incorrect":""}`,onClick:()=>Pt("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:M,children:["ÂàÜ„Åã„Çâ„Å™„ÅÑ",M&&Fe==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"&&" ‚úó"]})]}):u.jsxs("div",{className:"text-input-container",children:[u.jsx("input",{type:"text",className:"text-answer-input",value:D,onChange:se=>F(se.target.value),onKeyPress:se=>{se.key==="Enter"&&D.trim()&&Pt(D.trim())},placeholder:"Á≠î„Åà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",disabled:M,autoFocus:!0}),u.jsx("button",{className:"submit-answer-button",onClick:()=>Pt(D.trim()),disabled:M||!D.trim(),children:"ÂõûÁ≠î„Åô„Çã"}),u.jsx("button",{className:`choice-button dont-know ${Fe==="ÂàÜ„Åã„Çâ„Å™„ÅÑ"?"selected":""}`,onClick:()=>Pt("ÂàÜ„Åã„Çâ„Å™„ÅÑ"),disabled:M,children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]})]}),M&&u.jsx(u.Fragment,{children:We?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:`result-box ${Mt()?"correct":"incorrect"}`,children:[u.jsx("div",{className:"result-header",children:Mt()?"‚úÖ Ê≠£Ëß£ÔºÅ":"‚ùå ‰∏çÊ≠£Ëß£"}),u.jsx("div",{className:"result-content",children:u.jsxs("div",{className:"answer-comparison",children:[u.jsxs("div",{className:"user-answer",children:[u.jsx("strong",{children:"„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î:"}),u.jsx("br",{}),De.join(" ")]}),!Mt()&&u.jsxs("div",{className:"correct-answer",children:[u.jsx("strong",{children:"Ê≠£Ëß£:"}),u.jsx("br",{}),ie.correctAnswer||ie.correctOrder||ie.sentence||""]})]})})]}),ie.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),ie.explanation]})})]}):u.jsx(u.Fragment,{children:ie.explanation&&u.jsx("div",{className:"explanation-box",children:u.jsxs("div",{className:"explanation",children:[u.jsx("strong",{children:"Ëß£Ë™¨:"}),u.jsx("br",{}),ie.explanation]})})})})]})})]}),h&&u.jsx(jh,{mode:"grammar",currentIndex:Se,totalQuestions:he.length,questions:he.map(se=>({word:se.id,difficulty:se.difficulty})),requeuedWords:v(he,Se)})]})}const pY=Object.freeze(Object.defineProperty({__proto__:null,default:LI},Symbol.toStringTag,{value:"Module"}));class Pr{static recordDataSave(e,t,s){this.enabled&&this.addEvent({type:"data-save",success:e,duration:t,errorMessage:s,timestamp:Date.now()})}static recordAIAnalysis(e,t,s,r){this.enabled&&this.addEvent({type:"ai-analysis",category:e,confidence:t,actualResult:s,errorMessage:r,timestamp:Date.now()})}static recordCategoryDetermination(e,t,s,r){this.enabled&&this.addEvent({type:"category-determination",category:e,confidence:t,duration:s,actualResult:r,timestamp:Date.now()})}static recordPriorityCalculation(e,t=!0){this.enabled&&this.addEvent({type:"priority-calculation",duration:e,success:t,timestamp:Date.now()})}static addEvent(e){this.events.push(e),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}static getMetrics(){const e=this.events.filter(o=>o.type==="data-save"),t=this.events.filter(o=>o.type==="ai-analysis"),s=this.events.filter(o=>o.type==="category-determination"),r=this.events.filter(o=>o.type==="priority-calculation");return{dataSave:{totalAttempts:e.length,successRate:e.length>0?e.filter(o=>o.success).length/e.length:0,avgDuration:e.length>0?e.reduce((o,i)=>o+(i.duration||0),0)/e.length:0,errorRate:e.length>0?e.filter(o=>!o.success).length/e.length:0},aiAnalysis:{totalAnalyses:t.length,avgConfidence:t.length>0?t.reduce((o,i)=>o+(i.confidence||0),0)/t.length:0,accuracy:t.filter(o=>o.actualResult).length>0?t.filter(o=>o.actualResult&&o.category===o.actualResult).length/t.filter(o=>o.actualResult).length:0,lowConfidenceRate:t.length>0?t.filter(o=>(o.confidence||0)<.7).length/t.length:0},categoryDetermination:{total:s.length,avgConfidence:s.length>0?s.reduce((o,i)=>o+(i.confidence||0),0)/s.length:0,accuracy:s.filter(o=>o.actualResult).length>0?s.filter(o=>o.actualResult&&o.category===o.actualResult).length/s.filter(o=>o.actualResult).length:0},priorityCalculation:{total:r.length,avgDuration:r.length>0?r.reduce((o,i)=>o+(i.duration||0),0)/r.length:0}}}static report(){if(!this.enabled)return;const e=this.getMetrics();console.group("üìà Quality Report"),console.group("üíæ Data Save"),console.log(`Total Attempts: ${e.dataSave.totalAttempts}`),console.log(`Success Rate: ${(e.dataSave.successRate*100).toFixed(2)}%`),console.log(`Avg Duration: ${e.dataSave.avgDuration.toFixed(2)}ms`),console.log(`Error Rate: ${(e.dataSave.errorRate*100).toFixed(2)}%`),console.groupEnd(),console.group("ü§ñ AI Analysis"),console.log(`Total Analyses: ${e.aiAnalysis.totalAnalyses}`),console.log(`Avg Confidence: ${(e.aiAnalysis.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),console.log(`Low Confidence Rate: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`),console.groupEnd(),console.group("üè∑Ô∏è Category Determination"),console.log(`Total: ${e.categoryDetermination.total}`),console.log(`Avg Confidence: ${(e.categoryDetermination.avgConfidence*100).toFixed(2)}%`),console.log(`Accuracy: ${(e.categoryDetermination.accuracy*100).toFixed(2)}%`),console.groupEnd(),console.group("‚öñÔ∏è Priority Calculation"),console.log(`Total: ${e.priorityCalculation.total}`),console.log(`Avg Duration: ${e.priorityCalculation.avgDuration.toFixed(2)}ms`),console.groupEnd(),console.groupEnd()}static export(){return JSON.stringify({timestamp:new Date().toISOString(),events:this.events,metrics:this.getMetrics()},null,2)}static saveToStorage(){try{localStorage.setItem("quality-monitor-data",this.export()),console.log("‚úÖ Quality data saved to localStorage")}catch(e){console.error("‚ùå Failed to save quality data:",e)}}static loadFromStorage(){try{const e=localStorage.getItem("quality-monitor-data");if(e){const t=JSON.parse(e);this.events=t.events||[],console.log(`‚úÖ Loaded ${this.events.length} quality events from localStorage`)}}catch(e){console.error("‚ùå Failed to load quality data:",e)}}static clear(){this.events=[],localStorage.removeItem("quality-monitor-data")}static checkThresholds(){if(!this.enabled)return;const e=this.getMetrics();e.dataSave.successRate<.99&&e.dataSave.totalAttempts>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] Data save success rate is low: ${(e.dataSave.successRate*100).toFixed(2)}%`),e.aiAnalysis.accuracy<.9&&e.aiAnalysis.totalAnalyses>=20&&console.warn(`‚ö†Ô∏è [QualityMonitor] AI analysis accuracy is low: ${(e.aiAnalysis.accuracy*100).toFixed(2)}%`),e.aiAnalysis.lowConfidenceRate>.3&&e.aiAnalysis.totalAnalyses>=10&&console.warn(`‚ö†Ô∏è [QualityMonitor] High rate of low-confidence analyses: ${(e.aiAnalysis.lowConfidenceRate*100).toFixed(2)}%`)}static startPeriodicCheck(e=6e4){return setInterval(()=>{this.checkThresholds()},e)}}Ee(Pr,"events",[]),Ee(Pr,"maxEvents",1e3),Ee(Pr,"enabled",!1);Pr.enabled&&(Pr.loadFromStorage(),window.addEventListener("beforeunload",()=>{Pr.saveToStorage()}),Pr.startPeriodicCheck(6e4));const Gy="ab_anonymous_user_id_v1";function zI(){try{const n=localStorage.getItem(Gy);if(n)return n;const e=`anon_${Date.now()}_${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem(Gy,e),e}catch{return console.warn("[AB Identity] localStorage not available, using session-only ID"),`temp_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}}function fY(){const n=zI(),e=Date.now(),t=Math.random().toString(36).substring(2,11);return`${n}-${e}-${t}`}function mY(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return Math.abs(e)}function gY(n){switch(mY(n)%3){case 0:return"A";case 1:return"B";case 2:return"C";default:return"A"}}function xY(n){var e;try{const s=(e=it().wordProgress)==null?void 0:e[n];if(!s)return!1;const r=s.memorizationPosition??50;return r>=0&&r<20}catch(t){return console.warn(`[AB Snapshot] Failed to check mastered status for "${n}":`,t),!1}}function Hy(n){const e=[];for(const t of n)xY(t)&&e.push(t);return e}function yY(n,e){const t=new Set(n),s=new Set(e);let r=0;for(const o of s)t.has(o)||r++;return r}function bY(n,e){return e===0?0:n/e}function wY(n){return new Set(n).size}function vY(n){return n.map(e=>e.word)}const SY={targetScore:30,warningScore:40,criticalScore:50,fallbackQuestionCount:20};function CY(n,e=0,t=SY){let s="good",r=!1,o=!1,i="";return n<=t.targetScore?(s="good",i="ÊåØÂãï„Çπ„Ç≥„Ç¢ËâØÂ•Ω"):n<=t.warningScore?(s="warning",i="ÊåØÂãï„Çπ„Ç≥„Ç¢Ê≥®ÊÑè„É¨„Éô„É´"):n<=t.criticalScore?(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®"):(s="critical",r=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Å∏„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÊé®Â•®",e>=2&&(o=!0,i="ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™ÂåñÁ∂ôÁ∂ö: variant=A„Å∏ÂàáÊàª„ÅóÊé®Â•®")),{level:s,shouldFallback:r,shouldSwitchToA:o,score:n,message:i}}function NY(n,e,t){try{const s=`ab_consecutive_critical_${n}_${e}`,r=parseInt(localStorage.getItem(s)||"0",10),o=t?r+1:0;return localStorage.setItem(s,String(o)),o}catch{return 0}}function IY(n,e,t,s,r){try{const o={sessionId:n,variant:e,timestamp:Date.now(),score:t,level:s,fallbackApplied:r},i=JSON.parse(localStorage.getItem("ab_vibration_history")||"[]");i.push(o),i.length>300&&i.splice(0,i.length-300),localStorage.setItem("ab_vibration_history",JSON.stringify(i))}catch{}}function kY({allQuestions:n,questionSets:e,customQuestionSets:t=[],onAddWordToCustomSet:s,onRemoveWordFromCustomSet:r,onOpenCustomSetManagement:o}){var Rn;const[i,a]=T.useState(!1),[c,l]=T.useState("all"),[d,h]=T.useState("all"),[p,f]=T.useState("all"),[m,g]=T.useState("all"),[x,y]=T.useState(()=>{const Ce=localStorage.getItem("memorization-still-learning-limit");return Ce?parseInt(Ce):null}),[b,v]=T.useState(()=>{const Ce=localStorage.getItem("memorization-incorrect-limit");return Ce?parseInt(Ce):null}),[w,S]=T.useState({showWord:!0,showMeaning:!0,showPronunciation:!1,showExample:!1,showEtymology:!1,showRelated:!1}),[N,C]=T.useState(!1),[k,I]=T.useState(!0),[$,j]=T.useState(!1),[P,O]=T.useState(1.5),[A,z]=T.useState(null),[L,U]=T.useState(0),[V,B]=T.useState([]),[Y]=T.useState(()=>`session-${Date.now()}`),[K,pe]=T.useState(0),[ge]=T.useState(()=>fY()),[re]=T.useState(()=>gY(ge)),[ye]=T.useState(()=>Date.now()),[Ae,ve]=T.useState([]),[_e,ze]=T.useState([]),[et,ut]=T.useState(0),[yt,bt]=T.useState(0),[$t,ae]=T.useState(!1),[le,G]=T.useState(0),[oe,he]=T.useState(()=>{try{return localStorage.getItem("ab_ml_enabled")==="true"}catch{return!1}}),[Te,Se]=T.useState(!1),[te,Fe]=T.useState({correct:0,still_learning:0,incorrect:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),[Le,De]=T.useState(0),[Ke,pt]=T.useState(0),[R,D]=T.useState(0),[F,M]=T.useState(!1),[X,ue]=T.useState(null),[J,de]=T.useState(0),me=(Ce,Ve,je)=>{try{const St=localStorage.getItem("debug_reschedule_events"),Ct=St?JSON.parse(St):[];Ct.push({timestamp:new Date().toISOString(),mode:"memorization",phase:Ce,reason:Ve,details:je??{}}),Ct.length>30&&Ct.shift(),localStorage.setItem("debug_reschedule_events",JSON.stringify(Ct))}catch{}},[Me,Ie]=T.useState(void 0),[tt,Z]=T.useState(void 0),[xe,ke]=T.useState(0),[ie,We]=T.useState(0),[vt,dt]=T.useState(null),st=T.useRef(0),[Xt,ft]=T.useState(!0),Ge=T.useRef(0),nt=T.useRef(null),at=T.useRef(null),[jt,Pt]=T.useState(!1),[Yt,mt]=T.useState(!1),nn=Mh(ja.MEMORIZATION),{processQuestion:Mt}=Ph(),[Xe]=T.useState(()=>{const Ce=new Pl;return localStorage.getItem("enable-ai-coordination")==="true"&&(Ce.enableAICoordination(!0),_.info("ü§ñ [MemorizationView] AIÁµ±Âêà„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü")),Ce}),$e=T.useRef(0),Oe=T.useRef(null);T.useEffect(()=>{$e.current=L,Oe.current=(A==null?void 0:A.word)??null},[L,A==null?void 0:A.word]),T.useEffect(()=>{const Ce=Ve=>{const je=Ve,{word:St,position:Ct,mode:wn}=je.detail;wn==="memorization"&&(M(!0),ue(`Âº±ÁÇπË™ûÊ§úÂá∫: ${St} (Position=${Ct})`))};return window.addEventListener("weak-word-detected",Ce),()=>{window.removeEventListener("weak-word-detected",Ce)}},[]);const{reAddQuestion:ht,clearExpiredFlags:se,updateRequeueStats:Ne,getRequeuedWords:Be,checkPositionMismatch:rt}=jl();T.useMemo(()=>{zt.start("calculate-category-stats");const Ce={incorrect:te.incorrect,still_learning:te.still_learning,correct:te.correct,mastered:te.mastered,total:te.total,incorrectRate:te.total>0?te.incorrect/te.total:0,correctRate:te.total>0?te.correct/te.total:0};return zt.end("calculate-category-stats"),Ce},[te.incorrect,te.still_learning,te.correct,te.mastered,te.total]),T.useMemo(()=>{zt.start("get-available-categories");const Ce=new Set;n.forEach(je=>{je.relatedFields&&Array.isArray(je.relatedFields)&&je.relatedFields.forEach(St=>Ce.add(St))});const Ve=Array.from(Ce).sort();return zt.end("get-available-categories"),Ve},[n]),T.useMemo(()=>{zt.start("filter-questions");let Ce=n;return p!=="all"&&(Ce=Ce.filter(Ve=>Ve.difficulty===p)),d!=="all"&&(Ce=Ce.filter(Ve=>Ve.relatedFields&&Array.isArray(Ve.relatedFields)&&Ve.relatedFields.includes(d))),m==="words"?Ce=Ce.filter(Ve=>!Ve.word.includes(" ")||Ve.word.split(" ").length<=2):m==="phrases"&&(Ce=Ce.filter(Ve=>Ve.word.includes(" ")&&Ve.word.split(" ").length>2)),zt.end("filter-questions"),Ce},[n,c,p,d,m]),T.useEffect(()=>{(async()=>{try{const Ve=await w0();Ve&&S(Ve);const je=await S0();je&&(C(je.autoVoice||!1),I(je.voiceWord!==void 0?je.voiceWord:!0),j(je.voiceMeaning||!1),O(je.voiceDelay!==void 0?je.voiceDelay:1.5)),ft(!1)}catch(Ve){_.error("Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",Ve),ft(!1)}})()},[]);const ot=()=>{const Ce=new Set;return n.forEach(Ve=>{Ve.relatedFields&&Array.isArray(Ve.relatedFields)&&Ve.relatedFields.forEach(je=>Ce.add(je))}),Array.from(Ce).sort()};T.useEffect(()=>{if(Xt)return;(async()=>{try{const Ve=n;if(Ve.length===0){_.warn("[MemorizationView] ÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}let je=Ve;if(p!=="all"&&(je=je.filter(Dt=>Dt.difficulty===p)),d!=="all"&&(je=je.filter(Dt=>Dt.relatedFields&&Array.isArray(Dt.relatedFields)&&Dt.relatedFields.includes(d))),m==="words"?je=je.filter(Dt=>!Dt.word.includes(" ")||Dt.word.split(" ").length<=2):m==="phrases"&&(je=je.filter(Dt=>Dt.word.includes(" ")&&Dt.word.split(" ").length>2)),je.length===0){_.warn("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂïèÈ°å„Åå0‰ª∂„Åß„Åô");return}_.info("[MemorizationView] „Éï„Ç£„É´„Çø„ÉºÂæå„ÅÆÂçòË™ûÊï∞",{totalFiltered:je.length,sessionStats:{correct:te.correct,incorrect:te.incorrect,still_learning:te.still_learning||0}}),re==="B"||re==="C"?Xe.enableAICoordination(!0):Xe.enableAICoordination(!1),await is();const Ct=it().wordProgress||{},wn=[],rr=Object.entries(Ct).filter(([Dt,tn])=>(tn.memorizationAttempts??tn.totalAttempts??0)<=0?!1:Ut(tn,"memorization")>=40).map(([Dt,tn])=>({word:Dt,position:Ut(tn,"memorization"),memPos:tn.memorizationPosition,attempts:tn.memorizationAttempts??tn.totalAttempts??0})),lo=new Set(Ve.map(Dt=>Dt.word)),Bo=rr.filter(Dt=>!lo.has(Dt.word));try{localStorage.setItem("debug_weak_words_detection",JSON.stringify({timestamp:new Date().toISOString(),allWeakWordsInLS:rr.length,weakWordsList:rr,missingFromBase:Bo.map(Dt=>Dt.word),baseQuestionsCount:Ve.length,filteredCount:je.length}))}catch{}for(const Dt of Ve){const tn=Ct[Dt.word];if(!tn||(tn.memorizationAttempts??tn.totalAttempts??0)<=0)continue;Ut(tn,"memorization")>=40&&wn.push(Dt)}try{const Dt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");localStorage.setItem("debug_weak_words_detection",JSON.stringify({...Dt,weakQuestionsCount:wn.length,weakQuestionsWords:wn.map(tn=>tn.word)}))}catch{}try{const Dt=JSON.parse(localStorage.getItem("debug_weak_words_detection")||"{}");Dt.weakQuestionsDetected=wn.length,Dt.weakQuestionsWords=wn.map(tn=>tn.word),Dt.dataMissing=rr.length-wn.length,localStorage.setItem("debug_weak_words_detection",JSON.stringify(Dt))}catch{}let uo=je;if(wn.length>0){const Dt=new Map;for(const tn of je)Dt.set(tn.word,tn);for(const tn of wn)Dt.set(tn.word,tn);uo=Array.from(Dt.values())}let vs;const ln=await Xe.schedule({questions:uo,mode:"memorization",limits:{learningLimit:x,reviewLimit:b},sessionStats:{correct:te.correct,incorrect:te.incorrect,still_learning:te.still_learning||0,mastered:te.mastered||0,duration:Date.now()-st.current},useMetaAI:!0,isReviewFocusMode:Te,hybridMode:re==="B",finalPriorityMode:re==="C"});if(!ln||!ln.scheduledQuestions){_.error("[MemorizationView] „Çπ„Ç±„Ç∏„É•„Éº„É´ÁµêÊûú„ÅåÁÑ°Âäπ„Åß„Åô",{scheduleResult:ln});return}const js=ln.scheduledQuestions,or={totalScheduled:js.length,top10Words:js.slice(0,10).map(Dt=>Dt.word),timestamp:new Date().toISOString()};try{localStorage.setItem("debug_memorization_latest",JSON.stringify(or))}catch{}const rs=ln.vibrationScore,Fh=zI(),Kr=CY(rs,yt),ji=NY(Fh,re,Kr.level==="critical");if(bt(ji),IY(ge,re,rs,Kr.level,Kr.shouldFallback),Kr.shouldFallback&&!$t&&(re==="B"||re==="C")&&(_.warn("[MemorizationView] ÊåØÂãï„Çπ„Ç≥„Ç¢ÊÇ™Âåñ: N=20„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈÅ©Áî®",{score:rs,variant:re,consecutiveCritical:ji}),ae(!0),js.splice(20)),Kr.shouldSwitchToA&&_.error("[MemorizationView] variant=AÂàáÊàª„ÅóÊé®Â•®",{score:rs,variant:re,consecutiveCritical:ji,message:Kr.message}),ln.vibrationScore>50&&_.warn("[MemorizationView] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:ln.vibrationScore,processingTime:ln.processingTime}),B(js),js.length>0&&L===0&&!A){const Dt=vY(js);ze(Dt),ut(ln.vibrationScore);const tn=Hy(Dt);ve(tn)}if(js.length>0&&L===0&&!A){const Dt=js[0];z(Dt),U(0),st.current=Date.now(),Fe(tn=>({...tn,total:tn.total+1}))}}catch(Ve){_.error("[MemorizationView] ÂïèÈ°åÈÅ∏Êäû„Ç®„É©„Éº:",Ve),ft(!1)}})()},[c,p,d,m,n,Xt,Te]);const Qe=()=>{Se(!Te)},Ft=async()=>{if(confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"))try{const{resetAllProgress:Ce}=await gs(async()=>{const{resetAllProgress:Ve}=await Promise.resolve().then(()=>ei);return{resetAllProgress:Ve}},void 0);await Ce(),Fe({correct:0,still_learning:0,incorrect:0,mastered:0,total:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),ke(0),We(0),U(0),ut(0),bt(0),G(0),_.info("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü"),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü")}catch(Ce){_.error("[MemorizationView] ÊàêÁ∏æ„É™„Çª„ÉÉ„ÉàÂ§±Êïó",Ce),alert("„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},Ze=()=>{mt(!0)},He=async(Ce,Ve)=>{try{const je=Ct=>{const wn=(Ct.grade||1)/9;return Math.min(Math.max(wn,0),1)},St=()=>{const Ct=new Date().getHours();return Ct<12?"morning":Ct<18?"afternoon":Ct<22?"evening":"night"};A&&await Mt(Ce,Ve?"correct":"incorrect",{currentDifficulty:je(A),timeOfDay:St(),recentErrors:te.incorrect,sessionLength:Math.floor((Date.now()-st.current)/6e4),consecutiveCorrect:xe})}catch(je){console.error("[MemorizationView] Adaptive AI error:",je)}};T.useEffect(()=>{(x!==null&&te.still_learning>=x||b!==null&&te.incorrect>=b)&&(Te||Se(!0))},[te,x,b,Te]),T.useEffect(()=>{Le!==0&&V.length!==0&&setTimeout(()=>{const Ce=I0(V,"memorization");Fe(Ve=>({...Ve,incorrect:Ce.incorrect,still_learning:Ce.still_learning,mastered:Ce.mastered}))},100)},[Le,V]),T.useEffect(()=>{if(!F||Xt||V.length===0)return;(async()=>{try{_.info("[MemorizationView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:R,reason:X});const Ve=$e.current,je=Oe.current,St=Math.min(Ve+1,V.length),Ct=V.slice(St),rr=it().wordProgress||{},lo=[];for(const vs of n){const ln=rr[vs.word];if(!ln||(ln.memorizationAttempts??ln.totalAttempts??0)<=0)continue;Ut(ln,"memorization")>=40&&(Ct.find(rs=>rs.word===vs.word)||lo.push(vs))}let Bo=Ct;if(lo.length>0){const vs=new Map;for(const ln of Ct)vs.set(ln.word,ln);for(const ln of lo)vs.set(ln.word,ln);Bo=Array.from(vs.values())}if(Bo.length===0){_.warn("[MemorizationView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂØæË±°„Å™„Åó"),D(0),M(!1),ue(null),me("skipped","ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂØæË±°„Å™„Åó",{lockedPrefixCount:St,total:V.length});return}const uo=await Xe.schedule({questions:Bo,mode:"memorization",limits:{learningLimit:x??null,reviewLimit:b??null},sessionStats:{correct:te.correct,incorrect:te.incorrect,still_learning:te.still_learning,mastered:te.mastered,duration:0},useMetaAI:!0,hybridMode:re==="A"||re==="B"});B(vs=>$e.current!==Ve||Oe.current!==je?vs:[...vs.slice(0,St),...uo.scheduledQuestions]),de(Date.now()),me("applied",X??"Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞",{lockedPrefixCount:St,remainingBefore:Bo.length,remainingAfter:uo.scheduledQuestions.length}),D(0),M(!1),ue(null),_.info("[MemorizationView] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newLength:uo.scheduledQuestions.length})}catch(Ve){_.error("[MemorizationView] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",Ve),M(!1),ue(null),me("error","ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº",{error:String(Ve)})}})()},[F,Xt,V,x,b,te,re,Xe,R,X]),T.useEffect(()=>{if(!A||!N||at.current===A.word)return;at.current=A.word,(async()=>{if(k&&Ts(A.word,{rate:.85}),$&&A.meaning){await new Promise(je=>setTimeout(je,P*1e3));const Ve=new SpeechSynthesisUtterance(A.meaning);Ve.lang="ja-JP",Ve.rate=.85,window.speechSynthesis.speak(Ve)}})()},[A,N,k,$,P]);const It=()=>{Pt(!jt)},Gt=async Ce=>{if(Ce==="showWord")return;const Ve={...w,[Ce]:!w[Ce]};S(Ve),await b0(Ve)},At=async(Ce,Ve,je,St)=>{C(Ce),I(Ve),j(je),St!==void 0&&O(St),await v0({autoVoice:Ce,voiceWord:Ve,voiceMeaning:je,voiceDelay:St!==void 0?St:P,interleavingMode:"off",cardDisplaySettings:w})},Et=T.useCallback(async Ce=>{var Kr,ji,Dt,tn;if(!A)return;const Ve=(Date.now()-st.current)/1e3,je=Ce==="right",St=Ce==="center",Ct=A,wn=Ve,rr=L;Ie(je),Z(A.word);const lo=!je&&!St?ie+1:0;!F&&lo>=5&&(M(!0),ue("‰∏çÊ≠£Ëß£ÈÄ£Êâì„ÅßÊñ∞Ë¶èÊûØÊ∏á„ÇíÂõûÈÅø"),me("triggered","‰∏çÊ≠£Ëß£ÈÄ£Êâì„ÅßÊñ∞Ë¶èÊûØÊ∏á„ÇíÂõûÈÅø",{word:A.word,incorrectStreak:lo})),je?(ke(gt=>gt+1),We(0)):St?(ke(0),We(0)):(We(gt=>gt+1),ke(0)),Fe(gt=>{const un=A.reAddedCount&&A.reAddedCount>0;let Nn=gt.incorrect,Ss=gt.still_learning;return je&&un&&(Nn>0?Nn=Math.max(0,Nn-1):Ss>0&&(Ss=Math.max(0,Ss-1))),{correct:je?gt.correct+1:gt.correct,still_learning:St?Ss+1:Ss,incorrect:!je&&!St?Nn+1:Nn,mastered:je?gt.mastered+1:gt.mastered,total:gt.total,newQuestions:gt.newQuestions,reviewQuestions:gt.reviewQuestions,consecutiveNew:gt.consecutiveNew,consecutiveReview:gt.consecutiveReview}}),zt.start("quick-category-determination");const uo=(Kr=it().wordProgress)==null?void 0:Kr[Ct.word],vs=Ut(uo,"memorization"),ln=Yr(vs),js=zt.end("quick-category-determination");if(js>50&&zt.warnIfSlow("quick-category-determination",js,50),Pr.recordCategoryDetermination(ln,1,js),wn<16){zt.start("data-save");try{await Co(Ct.word,je,wn*1e3,void 0,"memorization",St);try{const Nn=(ji=it().wordProgress)==null?void 0:ji[Ct.word],Ss=Ut(Nn,"memorization"),Bs=Yr(Ss);aI(Bs)&&Bs!==ln&&(M(!0),ue(`Â≠¶ÁøíÁä∂ÊÖãÂ§âÂåñ: ${ln}‚Üí${Bs}`),me("triggered",`Â≠¶ÁøíÁä∂ÊÖãÂ§âÂåñ: ${ln}‚Üí${Bs}`,{word:Ct.word,categoryBefore:ln,categoryAfter:Bs,posAfter:Ss}))}catch(un){_.error("[MemorizationView] „Ç´„ÉÜ„Ç¥„É™Â§âÂåñÊ§úÁü•„Ç®„É©„Éº:",un)}if(je)try{const Nn=(Dt=it().wordProgress)==null?void 0:Dt[Ct.word];Ut(Nn,"memorization")<40&&B(ir=>{if(!Array.isArray(ir)||ir.length===0)return ir;const Mi=Math.min(rr,ir.length-1);return ir.filter((Oh,Lh)=>Lh<=Mi||Oh.word!==Ct.word?!0:!((Oh.reAddedCount||0)>0))})}catch{}const gt=zt.end("data-save");Pr.recordDataSave(!0,gt)}catch(gt){const un=zt.end("data-save");Pr.recordDataSave(!1,un,String(gt)),_.error("[MemorizationView] Â≠¶Áøí„Éá„Éº„ÇøË®òÈå≤„Ç®„É©„Éº:",gt)}finally{De(Date.now())}Promise.all([(async()=>{try{const gt={word:Ct.word,timestamp:Date.now(),viewDuration:wn,swipeDirection:Ce==="center"?"left":Ce,sessionId:Y,consecutiveViews:K+1};await C0(gt),pe(un=>un+1)}catch(gt){_.error("[MemorizationView] Ë°åÂãïË®òÈå≤„Ç®„É©„Éº:",gt)}})(),(async()=>{try{nn.recordAnswer(Ct.word,je,wn*1e3)}catch(gt){_.error("[MemorizationView] Áµ±Ë®àË®òÈå≤„Ç®„É©„Éº:",gt)}})(),(async()=>{await new Promise(gt=>setTimeout(gt,1e3)),zt.start("ai-detailed-analysis");try{await He(Ct.word,je);const gt=zt.end("ai-detailed-analysis")}catch(gt){zt.end("ai-detailed-analysis"),_.error("[MemorizationView] AIÂàÜÊûê„Ç®„É©„Éº:",gt)}})()]).catch(gt=>{_.error("[MemorizationView] „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂá¶ÁêÜ„Ç®„É©„Éº:",gt)})}if(Ne(A,te,Fe),dt(A.word),D(gt=>{const un=gt+1;if(un>=50)return M(!0),ue("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),me("triggered","50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü",{answerCountSinceSchedule:un}),un;if(un%10===0)try{const Nn=rt(V,"memorization");Nn.needsRescheduling&&(M(!0),ue(Nn.reason),me("triggered",Nn.reason,{answerCountSinceSchedule:un}))}catch(Nn){_.error("[MemorizationView] Position‰∏çÊï¥Âêà„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:",Nn)}return un}),oe&&Xe.aiCoordinator)try{const gt=it(),un=(gt==null?void 0:gt.wordProgress)??{},Nn=un[A.word]??((tn=gt==null?void 0:gt.wordProgress)==null?void 0:tn[A.word])??null;let Ss=0,Bs=0,ir=0,Mi=0;for(const zh of Object.values(un)){const Wh=Ut(zh,"memorization");Wh>=70?ir++:Wh>=40?Bs++:Wh>=20?Mi++:Ss++}const Lh={totalAttempts:(te.correct||0)+(te.incorrect||0)+(te.still_learning||0)+(te.mastered||0),correctAnswers:te.correct||0,incorrectAnswers:te.incorrect||0,stillLearningAnswers:te.still_learning||0,sessionStartTime:ye,sessionDuration:Date.now()-ye,consecutiveIncorrect:0,masteredCount:Ss,stillLearningCount:Bs,incorrectCount:ir,newCount:Mi,consecutiveCorrect:te.consecutiveCorrect||0},VI={word:{word:A.word,meaning:A.meaning,reading:A.reading,difficulty:A.difficulty,category:A.category,source:A.source,type:A.type,isPhraseOnly:A.isPhraseOnly},progress:Nn,sessionStats:Lh,currentTab:"memorization",allProgress:un},UI={wasCorrect:je,responseTime:Math.round(wn*1e3),timestamp:Date.now(),features:[]};Xe.aiCoordinator.learn(VI,UI).catch(zh=>{console.warn("[ML] learn() failed",zh)})}catch(gt){console.warn("[ML] learn() error",gt)}let or=V;if(!je||St){const gt=ht(A,V,L,"memorization");gt!==V&&(or=gt,B(gt))}let rs=L+1;const Fh=Math.min(rs+5,or.length);for(;rs<Fh&&or[rs].word===A.word;)_.warn("[MemorizationView] ÈÄ£Á∂öÂá∫È°å„ÇíÊ§úÂá∫„ÄÅ„Çπ„Ç≠„ÉÉ„Éó",{word:or[rs].word,nextIndex:rs}),rs++;if(rs<or.length){const gt=se(or,L);gt!==or&&B(gt);const un=or[rs];z(un),U(rs),st.current=Date.now(),Fe(Nn=>({...Nn,total:Nn.total+1})),Z(void 0)}else{if(_e.length>0)try{const gt=Hy(_e),un=yY(Ae,gt),Nn=wY(_e),Ss=bY(un,Nn),Bs=Date.now(),ir=Math.round((Bs-ye)/1e3),Mi={sessionId:ge,variant:re,mode:"memorization",sessionLength:_e.length,questionWords:_e,uniqueWordCount:Nn,startMasteredWords:Ae,endMasteredWords:gt,acquiredWordCount:un,acquisitionRate:Ss,vibrationScore:et,startedAt:ye,endedAt:Bs,durationSec:ir,mlEnabled:oe};y9(Mi)}catch(gt){console.error("[AB Session End] Failed to save log:",gt)}z(null),Z(void 0)}},[A,L,V,Y,K,te,x,b]);return T.useEffect(()=>{const Ce=nt.current;if(!Ce)return;const Ve=Ct=>{Ge.current=Ct.touches[0].clientX},je=Ct=>{const rr=Ct.changedTouches[0].clientX-Ge.current;Math.abs(rr)>100&&(rr>0?Et("right"):Et("left"))},St=Ct=>{Ct.key==="ArrowLeft"||Ct.key==="1"?(Ct.preventDefault(),Et("left")):Ct.key==="ArrowDown"||Ct.key==="2"?(Ct.preventDefault(),Et("center")):(Ct.key==="ArrowRight"||Ct.key==="3")&&(Ct.preventDefault(),Et("right"))};return Ce.addEventListener("touchstart",Ve),Ce.addEventListener("touchend",je),document.addEventListener("keydown",St),()=>{Ce.removeEventListener("touchstart",Ve),Ce.removeEventListener("touchend",je),document.removeEventListener("keydown",St)}},[Et]),Xt?u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})}):A?u.jsxs("div",{className:"quiz-view",children:[jt?u.jsx("div",{className:"fixed inset-0 z-50 bg-gray-50 overflow-y-auto",children:u.jsxs("div",{className:"min-h-screen flex items-center justify-center py-8",children:[u.jsx("button",{onClick:It,className:"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition","aria-label":"ÂÖ®ÁîªÈù¢ÁµÇ‰∫Ü",children:u.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),u.jsx("div",{className:"w-full max-w-4xl px-4 h-[90vh] flex items-center",children:u.jsxs("div",{ref:nt,className:"question-card h-[600px] sm:h-[650px] md:h-[700px] flex flex-col w-full",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${xn()?"clickable-pronunciation":""}`,onClick:Ce=>{xn()&&(Ce.preventDefault(),Ce.stopPropagation(),Ts(A.word,{rate:.85}))},onTouchEnd:Ce=>{xn()&&(Ce.preventDefault(),Ce.stopPropagation(),Ts(A.word,{rate:.85}))},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${A.word.includes(" ")?"phrase-text":""} ${xn()?"clickable-word":""}`,children:[A.word,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),A.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",A.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[A.difficulty&&u.jsx("div",{className:`difficulty-badge ${A.difficulty}`,children:A.difficulty==="beginner"?"ÂàùÁ¥ö":A.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),s&&r&&o&&u.jsx(oi,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4 flex-shrink-0",children:[u.jsxs("button",{onClick:()=>Et("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>Et("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>Et("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),s&&r&&o&&u.jsx("div",{className:"mb-2 flex justify-center flex-shrink-0",children:u.jsx(oi,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})}),u.jsxs("div",{className:"space-y-3 overflow-y-auto flex-1 min-h-0",children:[u.jsx("button",{onClick:()=>Gt("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showMeaning?"‚ñº":"‚ñ∂"})]}),w.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words",children:A.meaning})]})}),A.etymology&&A.etymology.trim()!==""&&A.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>Gt("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showEtymology?"‚ñº":"‚ñ∂"})]}),w.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.etymology})]})}),A.relatedWords&&A.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>Gt("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showRelated?"‚ñº":"‚ñ∂"})]}),w.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.relatedWords})]})})]})]})})]})}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-4 flex justify-center",children:u.jsx("div",{className:"w-full max-w-4xl",children:u.jsx(_h,{mode:"memorization",sessionCorrect:te.correct,sessionReview:te.still_learning,sessionIncorrect:te.incorrect,totalAnswered:te.total,currentWord:A==null?void 0:A.word,onAnswerTime:Le,learningStatusTabPulseKey:J,lastAnswerCorrect:Me,lastAnswerWord:tt,lastAnswerDifficulty:A==null?void 0:A.difficulty,correctStreak:xe,incorrectStreak:ie,learningPhase:nn.state.currentPhase??void 0,estimatedSpeed:(Rn=nn.state.personalParams)==null?void 0:Rn.learningSpeed,onShowSettings:()=>a(!0),dataSource:c,category:d==="all"?"ÂÖ®ÂàÜÈáé":d,difficulty:p,wordPhraseFilter:m,onReviewFocus:Qe,isReviewFocusMode:Te,onResetProgress:Ft,onDebugRequeue:Ze})})}),i&&u.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-lg p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-bold",children:"üìä Â≠¶ÁøíË®≠ÂÆö"}),u.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600",children:"‚úï Èñâ„Åò„Çã"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-datasource",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìñ Âá∫È°åÂÖÉ:"}),u.jsxs("select",{id:"memorization-datasource",value:c,onChange:Ce=>l(Ce.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂïèÈ°åÈõÜ"}),u.jsx("option",{value:"standard",children:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ"}),u.jsx("option",{value:"advanced",children:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö"}),u.jsx("option",{value:"comprehensive",children:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-difficulty",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìä Èõ£ÊòìÂ∫¶:"}),u.jsxs("select",{id:"memorization-difficulty",value:p,onChange:Ce=>f(Ce.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®Èõ£ÊòìÂ∫¶"}),u.jsx("option",{value:"beginner",children:"ÂàùÁ¥ö"}),u.jsx("option",{value:"intermediate",children:"‰∏≠Á¥ö"}),u.jsx("option",{value:"advanced",children:"‰∏äÁ¥ö"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-category",className:"block text-sm font-medium mb-2 text-gray-700",children:"üè∑Ô∏è Èñ¢ÈÄ£ÂàÜÈáé:"}),u.jsxs("select",{id:"memorization-category",value:d,onChange:Ce=>h(Ce.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂÖ®ÂàÜÈáé"}),ot().map(Ce=>u.jsx("option",{value:Ce,children:Ce},Ce))]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"memorization-filter",className:"block text-sm font-medium mb-2 text-gray-700",children:"üìù ÂçòË™û„ÉªÁÜüË™û:"}),u.jsxs("select",{id:"memorization-filter",value:m,onChange:Ce=>g(Ce.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[u.jsx("option",{value:"all",children:"ÂçòË™ûÔºãÁÜüË™û"}),u.jsx("option",{value:"words",children:"ÂçòË™û„ÅÆ„Åø"}),u.jsx("option",{value:"phrases",children:"ÁÜüË™û„ÅÆ„Åø"})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üéØ Âá∫È°åÁπ∞„ÇäËøî„ÅóË®≠ÂÆö:"}),u.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Êú™ÂÖ•Âäõ„ÅÆÂ†¥Âêà„ÅØÁÑ°Âà∂Èôê„Å´Âá∫È°å„Åó„Åæ„ÅôÔºàÊé®Â•®ÔºöLeitner„Ç∑„Çπ„ÉÜ„É†ÊñπÂºèÔºâ"}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center mb-2",children:[u.jsx("input",{type:"checkbox",checked:x!==null,onChange:Ce=>{Ce.target.checked?(y(50),localStorage.setItem("memorization-still-learning-limit","50")):(y(null),localStorage.removeItem("memorization-still-learning-limit"))},className:"mr-2 w-4 h-4"}),u.jsx("span",{className:"text-sm",children:"üü° „Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê„ÇíË®≠ÂÆö"})]}),x!==null&&u.jsxs("div",{className:"ml-6",children:[u.jsx("select",{value:x,title:"„Åæ„Å†„Åæ„Å†„ÅÆË™ûÊï∞‰∏äÈôê",onChange:Ce=>{const Ve=parseInt(Ce.target.value);y(Ve),localStorage.setItem("memorization-still-learning-limit",Ve.toString())},className:"w-full px-3 py-2 border rounded-lg bg-white",children:[5,10,20,30,50,100,150,200].map(Ce=>u.jsx("option",{value:Ce,children:Ce},Ce))}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„Çâ„ÄÅÂæ©Áøí„É¢„Éº„Éâ„Å´Ëá™Âãï„ÅßÂàá„ÇäÊõø„Çè„Çä„Åæ„Åô"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{className:"flex items-center mb-2",children:[u.jsx("input",{type:"checkbox",checked:b!==null,onChange:Ce=>{Ce.target.checked?(v(30),localStorage.setItem("memorization-incorrect-limit","30")):(v(null),localStorage.removeItem("memorization-incorrect-limit"))},className:"mr-2 w-4 h-4"}),u.jsx("span",{className:"text-sm",children:"üî¥ ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê„ÇíË®≠ÂÆö"})]}),b!==null&&u.jsxs("div",{className:"ml-6",children:[u.jsx("select",{value:b,title:"ÂàÜ„Åã„Çâ„Å™„ÅÑ„ÅÆË™ûÊï∞‰∏äÈôê",onChange:Ce=>{const Ve=parseInt(Ce.target.value);v(Ve),localStorage.setItem("memorization-incorrect-limit",Ve.toString())},className:"w-full px-3 py-2 border rounded-lg bg-white",children:[5,10,20,30,50,100,150,200].map(Ce=>u.jsx("option",{value:Ce,children:Ce},Ce))}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"„Åì„ÅÆÊï∞„Å´ÈÅî„Åó„Åü„Çâ„ÄÅÂæ©Áøí„É¢„Éº„Éâ„Å´Ëá™Âãï„ÅßÂàá„ÇäÊõø„Çè„Çä„Åæ„Åô"})]})]})]})]}),u.jsxs("div",{className:"border-t pt-4",children:[u.jsx("label",{className:"block text-sm font-medium mb-3 text-gray-700",children:"üîä Ëá™ÂãïÁô∫Èü≥Ë®≠ÂÆö:"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:N,onChange:Ce=>At(Ce.target.checked,k,$),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ëá™Âãï„ÅßÁô∫Èü≥„Åô„Çã"})]}),N&&u.jsxs("div",{className:"ml-6 space-y-2",children:[u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:k,onChange:Ce=>At(N,Ce.target.checked,$),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"Ë™ûÂè•„ÇíË™≠„Åø‰∏ä„Åí"})]}),u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:$,onChange:Ce=>At(N,k,Ce.target.checked),className:"mr-2 w-4 h-4"}),u.jsx("span",{children:"ÊÑèÂë≥„ÇíË™≠„Åø‰∏ä„Åí"})]}),$&&u.jsxs("div",{className:"ml-6 mt-2",children:[u.jsxs("label",{className:"block text-sm text-gray-600 mb-1",children:["‚è±Ô∏è Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî: ",P.toFixed(1),"Áßí"]}),u.jsx("input",{type:"range",min:"0.5",max:"5.0",step:"0.5",value:P,onChange:Ce=>{const Ve=parseFloat(Ce.target.value);O(Ve),At(N,k,$,Ve)},className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer","aria-label":"Ë™ûÂè•„Å®ÊÑèÂë≥„ÅÆÈñìÈöî"}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0.5Áßí"}),u.jsx("span",{children:"5.0Áßí"})]})]})]})]})]}),u.jsx("div",{className:"border-t pt-4 mt-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ü§ñ Ê©üÊ¢∞Â≠¶ÁøíÔºàMLÔºâ"}),u.jsx("p",{className:"text-xs text-gray-500",children:"ÂÄã‰∫∫„ÅÆÂ≠¶Áøí„Éë„Çø„Éº„É≥„Å´ÈÅ©ÂøúÔºàÂÆüÈ®ìÁöÑÊ©üËÉΩÔºâ"})]}),u.jsx("button",{onClick:()=>{try{const Ce=!oe;localStorage.setItem("ab_ml_enabled",String(Ce)),he(Ce),alert(Ce?"MLÊ©üËÉΩ„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åó„Åü„ÄÇË®≠ÂÆö„ÇíÂèçÊò†„Åô„Çã„Å´„ÅØ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ":"MLÊ©üËÉΩ„ÇíÁÑ°Âäπ„Å´„Åó„Åæ„Åó„Åü„ÄÇË®≠ÂÆö„ÇíÂèçÊò†„Åô„Çã„Å´„ÅØ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")}catch{alert("Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:`px-4 py-2 rounded-lg font-medium transition ${oe?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-700 hover:bg-gray-400"}`,children:oe?"ON":"OFF"})]})})]})]}),u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"relative w-full max-w-4xl",children:[u.jsx("button",{onClick:It,className:"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md","aria-label":"ÂÖ®ÁîªÈù¢Ë°®Á§∫",title:"ÂÖ®ÁîªÈù¢Ë°®Á§∫",children:u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),u.jsxs("div",{ref:nt,className:"question-card w-full h-[600px] sm:h-[650px] md:h-[700px] flex flex-col",children:[u.jsx("div",{className:"py-8 flex flex-col items-center justify-center h-[200px] flex-shrink-0",children:u.jsxs("div",{className:`flex flex-col items-center ${xn()?"clickable-pronunciation":""}`,onClick:Ce=>{xn()&&(Ce.preventDefault(),Ce.stopPropagation(),Ts(A.word,{rate:.85}))},onTouchEnd:Ce=>{xn()&&(Ce.preventDefault(),Ce.stopPropagation(),Ts(A.word,{rate:.85}))},title:xn()?"„Çø„ÉÉ„Éó„Åó„Å¶Áô∫Èü≥„ÇíËÅû„Åè üîä":"",children:[u.jsxs("div",{className:`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${A.word.includes(" ")?"phrase-text":""} ${xn()?"clickable-word":""}`,children:[A.word,xn()&&u.jsx("span",{className:"speaker-icon",children:"üîä"})]}),A.reading&&u.jsxs("div",{className:"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center",children:["„Äê",A.reading,"„Äë"]}),u.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 flex-wrap",children:[A.difficulty&&u.jsx("div",{className:`difficulty-badge ${A.difficulty}`,children:A.difficulty==="beginner"?"ÂàùÁ¥ö":A.difficulty==="intermediate"?"‰∏≠Á¥ö":"‰∏äÁ¥ö"}),s&&r&&o&&u.jsx(oi,{word:{word:A.word,meaning:A.meaning,ipa:A.reading,source:"memorization"},sets:t,onAddWord:s,onRemoveWord:r,onOpenManagement:o,size:"medium",variant:"both"})]})]})}),u.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[u.jsxs("button",{onClick:()=>Et("left"),className:"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"ÂàÜ„Åã„Çâ„Å™„ÅÑ",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚ùå"}),u.jsx("span",{className:"text-sm sm:text-base",children:"ÂàÜ„Åã„Çâ„Å™„ÅÑ"})]}),u.jsxs("button",{onClick:()=>Et("center"),className:"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"„Åæ„Å†„Åæ„Å†",children:[u.jsx("span",{className:"text-3xl mb-2",children:"ü§î"}),u.jsx("span",{className:"text-sm sm:text-base",children:"„Åæ„Å†„Åæ„Å†"})]}),u.jsxs("button",{onClick:()=>Et("right"),className:"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95","aria-label":"Ë¶ö„Åà„Å¶„Çã",children:[u.jsx("span",{className:"text-3xl mb-2",children:"‚úÖ"}),u.jsx("span",{className:"text-sm sm:text-base",children:"Ë¶ö„Åà„Å¶„Çã"})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("button",{onClick:()=>Gt("showMeaning"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"ÊÑèÂë≥"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showMeaning?"‚ñº":"‚ñ∂"})]}),w.showMeaning&&u.jsx("div",{className:"flex-1 text-base sm:text-lg text-gray-900 break-words",children:A.meaning})]})}),A.etymology&&A.etymology.trim()!==""&&A.etymology!=="‰∏≠Â≠¶Ëã±Ë™û„ÅßÈáçË¶Å„Å™ÂçòË™û„Åß„Åô„ÄÇ"&&u.jsx("button",{onClick:()=>Gt("showEtymology"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base",children:"Ë™ûÊ∫ê„ÉªËß£Ë™¨"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showEtymology?"‚ñº":"‚ñ∂"})]}),w.showEtymology&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.etymology})]})}),A.relatedWords&&A.relatedWords.trim()!==""&&u.jsx("button",{onClick:()=>Gt("showRelated"),className:"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx("span",{className:"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0",children:"Èñ¢ÈÄ£Ë™û"}),u.jsx("span",{className:"text-gray-500 flex-shrink-0",children:w.showRelated?"‚ñº":"‚ñ∂"})]}),w.showRelated&&u.jsx("div",{className:"flex-1 text-xs sm:text-sm text-gray-600 break-words",children:A.relatedWords})]})})]})]})]})})]}),Yt&&u.jsx(jh,{mode:"memorization",currentIndex:L,totalQuestions:V.length,questions:V,requeuedWords:Be(V,L)})]}):u.jsx("div",{className:"flex items-center justify-center py-8",children:u.jsx("div",{className:"text-xl",children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})})}const $Y=({isOpen:n,onClose:e,sets:t,onCreateSet:s,onDeleteSet:r,onEditSet:o,onRemoveWord:i})=>{const[a,c]=T.useState("manage"),[l,d]=T.useState(""),[h,p]=T.useState(""),[f,m]=T.useState(null),[g,x]=T.useState(null),[y,b]=T.useState(""),[v,w]=T.useState("");if(!n)return null;const S=()=>{l.trim()&&(s(l.trim(),h.trim()||void 0),d(""),p(""),c("manage"))},N=I=>{x(I.id),b(I.name),w(I.description||"")},C=()=>{g&&y.trim()&&(o(g,y.trim(),v.trim()||void 0),x(null))},k=()=>{x(null),b(""),w("")};return u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl sm:max-w-4xl w-full mx-auto max-h-[90vh] flex flex-col",children:[u.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"üìö „Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„ÉàÁÆ°ÁêÜ"}),u.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700:text-gray-200 text-2xl","aria-label":"Èñâ„Åò„Çã",children:"‚úï"})]}),u.jsxs("div",{className:"flex border-b border-gray-200",children:[u.jsxs("button",{onClick:()=>c("manage"),className:`flex-1 px-6 py-3 font-medium ${a==="manage"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:["üìã „Çª„ÉÉ„ÉàÁÆ°ÁêÜ (",t.length,")"]}),u.jsx("button",{onClick:()=>c("create"),className:`flex-1 px-6 py-3 font-medium ${a==="create"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900:text-gray-200"}`,children:"‚ûï Êñ∞Ë¶è‰ΩúÊàê"})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a==="manage"?u.jsx("div",{className:"space-y-4",children:t.length===0?u.jsxs("div",{className:"text-center py-12 text-gray-500",children:[u.jsx("p",{className:"text-lg mb-2",children:"üìù „Åæ„Å†„Çª„ÉÉ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-sm",children:"„ÄåÊñ∞Ë¶è‰ΩúÊàê„Äç„Çø„Éñ„Åã„ÇâÊúÄÂàù„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Çä„Åæ„Åó„Çá„ÅÜ"})]}):t.map(I=>u.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[u.jsx("div",{className:"bg-gray-50 p-4",children:g===I.id?u.jsxs("div",{className:"space-y-2",children:[u.jsx("input",{type:"text",value:y,onChange:$=>b($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"„Çª„ÉÉ„ÉàÂêç"}),u.jsx("textarea",{value:v,onChange:$=>w($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ",rows:2}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"‰øùÂ≠ò"}),u.jsx("button",{onClick:k,className:"px-4 py-2 bg-gray-300 text-gray-900 rounded-md hover:bg-gray-400:bg-gray-500",children:"„Ç≠„É£„É≥„Çª„É´"})]})]}):u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-2xl",children:I.icon||"üìñ"}),u.jsx("h3",{className:"text-lg font-bold text-gray-900",children:I.name}),u.jsxs("span",{className:"text-sm text-gray-500",children:["(",I.words.length,"Ë™û)"]})]}),I.description&&u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:I.description}),u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["‰ΩúÊàê: ",new Date(I.createdAt).toLocaleDateString("ja-JP")]})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>N(I),className:"text-blue-600 hover:text-blue-700:text-blue-300 text-sm","aria-label":"Á∑®ÈõÜ",children:"‚úèÔ∏è"}),u.jsx("button",{onClick:()=>m(f===I.id?null:I.id),className:"text-gray-600 hover:text-gray-700:text-gray-300 text-sm","aria-label":f===I.id?"Êäò„Çä„Åü„Åü„ÇÄ":"Â±ïÈñã",children:f===I.id?"‚ñ≤":"‚ñº"}),u.jsx("button",{onClick:()=>{confirm(`„Äå${I.name}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)&&r(I.id)},className:"text-red-600 hover:text-red-700:text-red-300 text-sm","aria-label":"ÂâäÈô§",children:"üóëÔ∏è"})]})]})}),f===I.id&&u.jsx("div",{className:"p-4 bg-white",children:I.words.length===0?u.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"„Åæ„Å†ÂçòË™û„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì"}):u.jsx("div",{className:"space-y-2",children:I.words.map(($,j)=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-semibold text-gray-900",children:$.word}),$.ipa&&u.jsxs("span",{className:"text-sm text-blue-600",children:["/",$.ipa,"/"]})]}),u.jsx("p",{className:"text-sm text-gray-700 mt-1",children:$.meaning}),$.source&&u.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Âá∫ÂÖ∏: ",$.source,$.sourceDetail&&` (${$.sourceDetail})`]})]}),u.jsx("button",{onClick:()=>i(I.id,$),className:"ml-4 text-red-600 hover:text-red-700:text-red-300","aria-label":"ÂâäÈô§",children:"‚ûñ"})]},`${$.word}-${j}`))})})]},I.id))}):u.jsxs("div",{className:"max-w-2xl mx-auto",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["„Çª„ÉÉ„ÉàÂêç ",u.jsx("span",{className:"text-red-500",children:"*"})]}),u.jsx("input",{type:"text",value:l,onChange:I=>d(I.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: Ëã¶Êâã„Å™ÂâçÁΩÆË©û"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ë™¨ÊòéÔºà‰ªªÊÑèÔºâ"}),u.jsx("textarea",{value:h,onChange:I=>p(I.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900",placeholder:"‰æã: È´òÊ†°ÂÖ•Ë©¶„Åß„Çà„ÅèÂá∫„ÇãÂâçÁΩÆË©û„Çí„Åæ„Å®„ÇÅ„Åü„Çª„ÉÉ„Éà",rows:3})]}),u.jsx("button",{onClick:S,disabled:!l.trim(),className:"w-full px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300:bg-gray-600 disabled:cursor-not-allowed font-medium",children:"‚ûï „Çª„ÉÉ„Éà„Çí‰ΩúÊàê"})]}),u.jsxs("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg",children:[u.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"üí° „Éí„É≥„Éà"}),u.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„Éà„Çí‰ΩúÊàêÂæå„ÄÅÂêÑ„Çø„Éñ„ÅÆ+„Éú„Çø„É≥„ÅßÂçòË™û„ÇíËøΩÂä†„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ „Çª„ÉÉ„ÉàÂêç„ÅØÂæå„Åã„ÇâÁ∑®ÈõÜ„Åß„Åç„Åæ„Åô"}),u.jsx("li",{children:"‚Ä¢ Ë§áÊï∞„ÅÆ„Çª„ÉÉ„Éà„Çí‰Ωú„Å£„Å¶„ÄÅ„ÉÜ„Éº„Éû„Åî„Å®„Å´Êï¥ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ"})]})]})]})})]})})};function TY({allQuestions:n,onStartSession:e}){const[t,s]=T.useState(null),[r,o]=T.useState(null),[i]=T.useState(3),[a,c]=T.useState({totalLearned:0,totalReviewed:0,averageAccuracy:0,estimatedCompletion:90});if(T.useEffect(()=>{const g=localStorage.getItem("learning-schedule-90days");if(g)try{const x=JSON.parse(g),y=Math.floor((Date.now()-x.startDate)/(1e3*60*60*24)),b=x.totalDays;x.currentDay=Math.min(y+1,b);const v=Math.floor(b/3),w=Math.floor(b*2/3);x.phase=x.currentDay<=v?1:x.currentDay<=w?2:3,s(x),o(xI(x,n))}catch(x){_.error("Failed to load schedule:",x)}},[n]),T.useEffect(()=>{if(t){c(yI(t));const g=document.querySelector(".progress-bar");if(g){const x=t.currentDay,y=t.totalDays,b=x/y*100;g.style.width=`${b}%`}}},[t]),!t)return null;const l=["Âü∫Á§éÂõ∫„ÇÅÊúü","ÂøúÁî®Êã°Â§ßÊúü","ÂÆåÊàê„ÉªÂÆöÁùÄÊúü"],d=t.phase,h=t.currentDay,p=t.totalDays,f=h/p*100,m=bI(t);return u.jsxs("div",{className:"learning-plan-dashboard",children:[u.jsxs("div",{className:"dashboard-header",children:[u.jsxs("div",{className:"day-counter",children:[u.jsx("span",{className:"day-number",children:h}),u.jsxs("span",{className:"day-label",children:["/ ",p,"Êó•ÁõÆ"]})]}),u.jsxs("div",{className:"phase-indicator",children:[u.jsxs("span",{className:`phase-badge phase-${d}`,children:["Phase ",d]}),u.jsx("span",{className:"phase-name",children:l[d-1]})]}),u.jsxs("div",{className:"progress-bar-container",children:[u.jsx("div",{className:`progress-bar phase-${d}`}),u.jsxs("span",{className:"progress-label",children:[f.toFixed(1),"%"]})]})]}),u.jsxs("div",{className:"stats-summary",children:[u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üìö"}),u.jsx("div",{className:"stat-value",children:a.totalLearned}),u.jsx("div",{className:"stat-label",children:"Â≠¶ÁøíÊ∏à„ÅøÂçòË™û"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚úÖ"}),u.jsxs("div",{className:"stat-value",children:[a.averageAccuracy.toFixed(1),"%"]}),u.jsx("div",{className:"stat-label",children:"Âπ≥ÂùáÊ≠£Á≠îÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"üéØ"}),u.jsxs("div",{className:"stat-value",children:[m>0?m.toFixed(0):0,"%"]}),u.jsx("div",{className:"stat-label",children:"‰ªäÈÄ±„ÅÆÈÅîÊàêÁéá"})]}),u.jsxs("div",{className:"stat-card",children:[u.jsx("div",{className:"stat-icon",children:"‚è±Ô∏è"}),u.jsx("div",{className:"stat-value",children:a.estimatedCompletion}),u.jsx("div",{className:"stat-label",children:"ÂÆå‰∫Ü„Åæ„ÅßÔºàÊó•Ôºâ"})]})]}),r&&u.jsxs("div",{className:"today-plan",children:[u.jsxs("h2",{children:["üìñ ‰ªäÊó•„ÅÆÂ≠¶Áøí„Éó„É©„É≥ÔºàDay ",h,"Ôºâ"]}),u.jsxs("div",{className:"session-cards",children:[u.jsxs("div",{className:"session-card morning",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåÖ"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊúùÔºöÊñ∞Ë¶èÂ≠¶Áøí"}),u.jsxs("p",{children:[r.morning.newWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("morning",r.morning.newWords),className:"btn-start-session",disabled:r.morning.newWords.length===0,children:r.morning.newWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card afternoon",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"‚òÄÔ∏è"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"ÊòºÔºöÂº±ÁÇπÂæ©Áøí"}),u.jsxs("p",{children:[r.afternoon.reviewWords.length,"Ë™û ¬∑ 15ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("afternoon",r.afternoon.reviewWords),className:"btn-start-session",disabled:r.afternoon.reviewWords.length===0,children:r.afternoon.reviewWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]}),u.jsxs("div",{className:"session-card evening",children:[u.jsxs("div",{className:"session-header",children:[u.jsx("span",{className:"session-icon",children:"üåô"}),u.jsxs("div",{className:"session-info",children:[u.jsx("h3",{children:"Â§úÔºöÁ∑èÂêàÊºîÁøí"}),u.jsxs("p",{children:[r.evening.mixedWords.length,"Ë™û ¬∑ 20ÂàÜ"]})]})]}),u.jsx("button",{onClick:()=>e("evening",r.evening.mixedWords),className:"btn-start-session",disabled:r.evening.mixedWords.length===0,children:r.evening.mixedWords.length===0?"ÂçòË™û„Å™„Åó":"ÈñãÂßã„Åô„Çã"})]})]})]}),u.jsxs("div",{className:"milestones",children:[u.jsx("h2",{children:"üèÜ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥"}),u.jsx("div",{className:"milestone-list",children:t.milestones.map((g,x)=>{const y=h>g.day,b=h===g.day,v=a.totalLearned>=g.wordsTarget;return u.jsxs("div",{className:`milestone-item ${v?"achieved":""} ${b?"current":""} ${y?"passed":""}`,children:[u.jsxs("div",{className:"milestone-day",children:["Day ",g.day]}),u.jsx("div",{className:"milestone-title",children:g.title}),u.jsxs("div",{className:"milestone-target",children:[g.wordsTarget,"Ë™û"]}),v&&u.jsx("span",{className:"check-mark",children:"‚úì"})]},x)})})]})]})}const AY=()=>{const[n,e]=T.useState("prepositions");return u.jsxs("div",{className:"grammar-guide-view p-4 max-w-app mx-auto",children:[u.jsxs("div",{className:"grammar-guide-tabs grid grid-cols-3 gap-1 sm:gap-2 mb-4",children:[u.jsxs("button",{onClick:()=>e("prepositions"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="prepositions"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üìç ÂâçÁΩÆË©û"}),u.jsx("span",{className:"sm:hidden",children:"üìç"})]}),u.jsxs("button",{onClick:()=>e("punctuation"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="punctuation"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"‚úèÔ∏è Ë®òÂè∑"}),u.jsx("span",{className:"sm:hidden",children:"‚úèÔ∏è"})]}),u.jsxs("button",{onClick:()=>e("tips"),className:`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${n==="tips"?"bg-primary text-white border-primary":"bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300"}`,children:[u.jsx("span",{className:"hidden sm:inline",children:"üí° Ë™≠Ëß£„Ç≥„ÉÑ"}),u.jsx("span",{className:"sm:hidden",children:"üí°"})]})]}),u.jsxs("div",{className:"content-area bg-white rounded-lg p-4 shadow-md border border-gray-200",children:[n==="prepositions"&&u.jsx(EY,{}),n==="punctuation"&&u.jsx(RY,{}),n==="tips"&&u.jsx(DY,{})]})]})},EY=()=>u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"ÂâçÁΩÆË©û„ÅÆ„Éã„É•„Ç¢„É≥„Çπ„Å®‰Ωø„ÅÑÂàÜ„Åë"}),u.jsx("p",{className:"text-text-secondary mb-6",children:"Ëã±Ë™û„ÅßÊúÄ„ÇÇÈ†ªÁπÅ„Å´‰Ωø„ÅÜÂâçÁΩÆË©û„ÇíÈáçË¶ÅÂ∫¶È†Ü„Å´Á¥π‰ªã„Åó„Åæ„Åô„ÄÇ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Ç¢„Ç§„É°„Éº„Ç∏„ÇíÁêÜËß£„Åô„Çã„Åì„Å®„Åß„ÄÅËá™ÁÑ∂„Å™Ëã±Ë™ûË°®Áèæ„ÅåË∫´„Å´„Å§„Åç„Åæ„Åô„ÄÇ"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üåü ÊúÄÈáçË¶ÅÔºöÊôÇÈñì„ÉªÂ†¥ÊâÄ„ÅÆÂü∫Êú¨3„Å§"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üì¶"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"IN"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„ÄåÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üìÖ ",u.jsx("strong",{children:"in 2024"})," ‚Üí Âπ¥„Å®„ÅÑ„ÅÜÈï∑„ÅÑÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üóìÔ∏è ",u.jsx("strong",{children:"in May"})," ‚Üí Êúà„Å®„ÅÑ„ÅÜÊúüÈñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üåÖ ",u.jsx("strong",{children:"in the morning"})," ‚Üí ÂçàÂâç„Å®„ÅÑ„ÅÜÊôÇÈñìÂ∏Ø„ÅÆ‰∏≠"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üåè ",u.jsx("strong",{children:"in Japan"})," ‚Üí ÂõΩ„Å®„ÅÑ„ÅÜÂ∫É„ÅÑÁ©∫Èñì„ÅÆ‰∏≠"]}),u.jsxs("div",{className:"text-blue-600",children:["üè† ",u.jsx("strong",{children:"in the room"})," ‚Üí ÈÉ®Â±ã„Å®„ÅÑ„ÅÜÂõ≤„Åæ„Çå„ÅüÁ©∫Èñì„ÅÆ‰∏≠"]})]})]})]})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÑ"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"ON"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„ÄåÊé•Ëß¶„Éª„Åè„Å£„Å§„ÅÑ„Å¶„ÅÑ„Çã„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üìÜ ",u.jsx("strong",{children:"on Monday"})," ‚Üí ÊõúÊó•„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üìÖ ",u.jsx("strong",{children:"on May 1st"})," ‚Üí Êó•‰ªò„Å®„ÅÑ„ÅÜÁâπÂÆö„ÅÆÊó•„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üéÑ ",u.jsx("strong",{children:"on Christmas"})," ‚Üí „Åù„ÅÆÊó•„Å´Êé•Ëß¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["ü™ë ",u.jsx("strong",{children:"on the table"})," ‚Üí „ÉÜ„Éº„Éñ„É´Ë°®Èù¢„Å´Êé•Ëß¶"]}),u.jsxs("div",{className:"text-green-600",children:["üñºÔ∏è ",u.jsx("strong",{children:"on the wall"})," ‚Üí Â£ÅÈù¢„Å´Êé•Ëß¶"]})]})]})]})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AT"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Éî„É≥„Éù„Ç§„É≥„Éà„ÉªÂú∞ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üïñ ",u.jsx("strong",{children:"at 7:00"})," ‚Üí 7ÊôÇ„Å®„ÅÑ„ÅÜÊôÇÂàª„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["‚òÄÔ∏è ",u.jsx("strong",{children:"at noon"})," ‚Üí Ê≠£Âçà„Å®„ÅÑ„ÅÜÁû¨Èñì„ÅÆÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üåô ",u.jsx("strong",{children:"at night"})," ‚Üí Â§ú„Å®„ÅÑ„ÅÜÊôÇÁÇπ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üó∫Ô∏è"})," Â†¥ÊâÄ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üè´ ",u.jsx("strong",{children:"at school"})," ‚Üí Â≠¶Ê†°„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]}),u.jsxs("div",{className:"text-orange-600",children:["üö™ ",u.jsx("strong",{children:"at the door"})," ‚Üí „Éâ„Ç¢„Å®„ÅÑ„ÅÜÂú∞ÁÇπ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚≠ê „Åù„ÅÆ‰ªñ„ÅÆÈáçË¶Å„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚û°Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"TO"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„ÄåÊñπÂêë„ÉªÂà∞ÈÅîÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß≠"})," ÊñπÂêë„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üè´ ",u.jsx("strong",{children:"to school"})," ‚Üí Â≠¶Ê†°„Å∏ÔºàÊñπÂêëÔºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üóº ",u.jsx("strong",{children:"to Tokyo"})," ‚Üí Êù±‰∫¨„Å∏ÔºàÁõÆÁöÑÂú∞Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üîÑ"})," ÁØÑÂõ≤„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üìä ",u.jsx("strong",{children:"from A to B"})," ‚Üí A„Åã„ÇâB„Åæ„ÅßÔºàÁØÑÂõ≤Ôºâ"]}),u.jsxs("div",{className:"text-pink-600",children:["üïê ",u.jsx("strong",{children:"from 9 to 5"})," ‚Üí 9ÊôÇ„Åã„Çâ5ÊôÇ„Åæ„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üéØ"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"FOR"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„ÄåÁõÆÁöÑ„ÉªÂØæË±°„ÉªÊúüÈñì„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üíù"})," ÁõÆÁöÑ„ÉªÂØæË±°„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üë§ ",u.jsx("strong",{children:"for you"})," ‚Üí „ÅÇ„Å™„Åü„ÅÆ„Åü„ÇÅ„Å´ÔºàÂØæË±°Ôºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üç≥ ",u.jsx("strong",{children:"for breakfast"})," ‚Üí ÊúùÈ£ü„Å®„Åó„Å¶ÔºàÁõÆÁöÑÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"})," ÊúüÈñì„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["‚è∞ ",u.jsx("strong",{children:"for 3 hours"})," ‚Üí 3ÊôÇÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]}),u.jsxs("div",{className:"text-purple-600",children:["üìÖ ",u.jsx("strong",{children:"for a week"})," ‚Üí 1ÈÄ±ÈñìÔºàÁ∂ôÁ∂öÊúüÈñìÔºâ"]})]})]})]})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üé¨"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"FROM"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„ÄåËµ∑ÁÇπ„ÉªÂá∫Áô∫ÁÇπ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," Ëµ∑ÁÇπ„ÅÆ„Ç§„É°„Éº„Ç∏Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üè† ",u.jsx("strong",{children:"from home"})," ‚Üí ÂÆ∂„Åã„ÇâÔºàÂá∫Áô∫ÁÇπÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üáØüáµ ",u.jsx("strong",{children:"from Japan"})," ‚Üí Êó•Êú¨„Åã„ÇâÔºàÂá∫Ë∫´Ôºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," ÊôÇÈñì„ÅÆËµ∑ÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["‚è∞ ",u.jsx("strong",{children:"from 9 am"})," ‚Üí 9ÊôÇ„Åã„ÇâÔºàÈñãÂßãÊôÇÂàªÔºâ"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"from Monday"})," ‚Üí ÊúàÊõúÊó•„Åã„Çâ"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üìå „Çà„Åè‰Ωø„ÅÜÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"ü§ù"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"WITH"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå‰∏ÄÁ∑í„Å´„Éª‰Ωø„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë•"})," ‰º¥„ÅÜÁõ∏ÊâãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üë®‚Äçüë©‚Äçüëß ",u.jsx("strong",{children:"with my family"})," ‚Üí ÂÆ∂Êóè„Å®‰∏ÄÁ∑í„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üßë‚Äçü§ù‚Äçüßë ",u.jsx("strong",{children:"with friends"})," ‚Üí ÂèãÈÅî„Å®"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üõ†Ô∏è"})," ‰Ωø„ÅÜÈÅìÂÖ∑Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["‚úèÔ∏è ",u.jsx("strong",{children:"with a pen"})," ‚Üí „Éö„É≥„ÅßÔºàÈÅìÂÖ∑Ôºâ"]}),u.jsxs("div",{className:"text-indigo-600",children:["üç¥ ",u.jsx("strong",{children:"with chopsticks"})," ‚Üí ÁÆ∏„Åß"]})]})]})]})]}),u.jsxs("div",{className:"bg-amber-50/20 rounded-lg p-5 border-2 border-amber-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöó"}),u.jsx("div",{className:"text-2xl font-bold text-amber-600 mt-2",children:"BY"}),u.jsx("div",{className:"text-sm text-amber-700 mt-1",children:"„Äå„Äú„ÅÆ„Åù„Å∞„Å´„ÉªÊâãÊÆµ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üöå"})," ÊâãÊÆµ„ÉªÊñπÊ≥ïÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üöÜ ",u.jsx("strong",{children:"by train"})," ‚Üí ÈõªËªä„ÅßÔºà‰∫§ÈÄöÊâãÊÆµÔºâ"]}),u.jsxs("div",{className:"text-amber-600",children:["‚úâÔ∏è ",u.jsx("strong",{children:"by email"})," ‚Üí „É°„Éº„É´„ÅßÔºàÈÄö‰ø°ÊâãÊÆµÔºâ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-amber-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," „Åù„Å∞„Å´Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-amber-600",children:["üåä ",u.jsx("strong",{children:"by the sea"})," ‚Üí Êµ∑„ÅÆ„Åù„Å∞„Å´"]}),u.jsxs("div",{className:"text-amber-600",children:["ü™ü ",u.jsx("strong",{children:"by the window"})," ‚Üí Á™ì„ÅÆ„Åù„Å∞„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-rose-50/20 rounded-lg p-5 border-2 border-rose-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üîó"}),u.jsx("div",{className:"text-2xl font-bold text-rose-600 mt-2",children:"OF"}),u.jsx("div",{className:"text-sm text-rose-700 mt-1",children:"„Äå„Äú„ÅÆÔºàÊâÄÂ±û„ÉªÈÉ®ÂàÜÔºâ„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üëë"})," ÊâÄÂ±û„ÉªÊâÄÊúâÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üìö ",u.jsx("strong",{children:"the book of mine"})," ‚Üí ÁßÅ„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-rose-600",children:["üèõÔ∏è ",u.jsx("strong",{children:"the capital of Japan"})," ‚Üí Êó•Êú¨„ÅÆÈ¶ñÈÉΩ"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-rose-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üß©"})," ÈÉ®ÂàÜÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-rose-600",children:["üç∞ ",u.jsx("strong",{children:"a piece of cake"})," ‚Üí „Ç±„Éº„Ç≠‰∏ÄÂàá„Çå"]}),u.jsxs("div",{className:"text-rose-600",children:["üíß ",u.jsx("strong",{children:"a glass of water"})," ‚Üí „Ç≥„ÉÉ„Éó‰∏ÄÊùØ„ÅÆÊ∞¥"]})]})]})]})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üí´ ‰∏≠È†ªÂ∫¶„ÅÆÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üí≠"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"ABOUT"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„Å´„Å§„ÅÑ„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"})," Ë©±È°å„ÉªÂÜÖÂÆπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üìö ",u.jsx("strong",{children:"a book about history"})," ‚Üí Ê≠¥Âè≤„Å´„Å§„ÅÑ„Å¶„ÅÆÊú¨"]}),u.jsxs("div",{className:"text-cyan-600",children:["üí¨ ",u.jsx("strong",{children:"talk about sports"})," ‚Üí „Çπ„Éù„Éº„ÉÑ„Å´„Å§„ÅÑ„Å¶Ë©±„Åô"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," „Åä„Åä„Çà„Åù„ÅÆÊï∞Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["‚è∞ ",u.jsx("strong",{children:"about 10 minutes"})," ‚Üí Á¥Ñ10ÂàÜ"]}),u.jsxs("div",{className:"text-cyan-600",children:["üë• ",u.jsx("strong",{children:"about 50 people"})," ‚Üí Á¥Ñ50‰∫∫"]})]})]})]})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≠Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"AFTER"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂæåÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"after dinner"})," ‚Üí Â§ïÈ£ü„ÅÆÂæå"]}),u.jsxs("div",{className:"text-lime-600",children:["üè´ ",u.jsx("strong",{children:"after school"})," ‚Üí ÊîæË™≤Âæå"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫èÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üî§ ",u.jsx("strong",{children:"after you"})," ‚Üí „ÅäÂÖà„Å´„Å©„ÅÜ„Åû"]}),u.jsxs("div",{className:"text-lime-600",children:["üìù ",u.jsx("strong",{children:"one after another"})," ‚Üí Ê¨°„ÄÖ„Å´"]})]})]})]})]}),u.jsxs("div",{className:"bg-sky-50/20 rounded-lg p-5 border-2 border-sky-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚èÆÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-sky-600 mt-2",children:"BEFORE"}),u.jsx("div",{className:"text-sm text-sky-700 mt-1",children:"„Äå„Äú„ÅÆÂâç„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊôÇÈñì„ÅÆÂâçÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üçΩÔ∏è ",u.jsx("strong",{children:"before breakfast"})," ‚Üí ÊúùÈ£üÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üéÑ ",u.jsx("strong",{children:"before Christmas"})," ‚Üí „ÇØ„É™„Çπ„Éû„Çπ„ÅÆÂâç"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-sky-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," È†ÜÂ∫è„Éª‰ΩçÁΩÆÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-sky-600",children:["üö™ ",u.jsx("strong",{children:"before the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂâç"]}),u.jsxs("div",{className:"text-sky-600",children:["üë• ",u.jsx("strong",{children:"before everyone"})," ‚Üí „Åø„Çì„Å™„ÅÆÂâç„Åß"]})]})]})]})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-violet-50/20 rounded-lg p-5 border-2 border-violet-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-violet-600 mt-2",children:"OVER"}),u.jsx("div",{className:"text-sm text-violet-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ä„ÇíË∂ä„Åà„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"ü¶Ö"})," ‰∏äÊñπ„ÉªË∂ä„Åà„ÇãÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üåâ ",u.jsx("strong",{children:"over the bridge"})," ‚Üí Ê©ã„ÇíË∂ä„Åà„Å¶"]}),u.jsxs("div",{className:"text-violet-600",children:["üèîÔ∏è ",u.jsx("strong",{children:"over the mountain"})," ‚Üí Â±±„ÇíË∂ä„Åà„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-violet-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," ‰ª•‰∏ä„ÉªË∂ÖÈÅéÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-violet-600",children:["üë• ",u.jsx("strong",{children:"over 100 people"})," ‚Üí 100‰∫∫‰ª•‰∏ä"]}),u.jsxs("div",{className:"text-violet-600",children:["üí∞ ",u.jsx("strong",{children:"over $50"})," ‚Üí 50„Éâ„É´‰ª•‰∏ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-slate-50/20 rounded-lg p-5 border-2 border-slate-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚¨áÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-slate-600 mt-2",children:"UNDER"}),u.jsx("div",{className:"text-sm text-slate-700 mt-1",children:"„Äå„Äú„ÅÆ‰∏ã„Å´„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨áÔ∏è"})," ‰∏ãÊñπ„Éª‰∏ãÂÅ¥Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üå≥ ",u.jsx("strong",{children:"under the tree"})," ‚Üí Êú®„ÅÆ‰∏ã„Å´"]}),u.jsxs("div",{className:"text-slate-600",children:["üåâ ",u.jsx("strong",{children:"under the bridge"})," ‚Üí Ê©ã„ÅÆ‰∏ã„Å´"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-slate-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üî¢"})," Êú™Ê∫ÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-slate-600",children:["üë∂ ",u.jsx("strong",{children:"under 18"})," ‚Üí 18Ê≠≥Êú™Ê∫Ä"]}),u.jsxs("div",{className:"text-slate-600",children:["üí∞ ",u.jsx("strong",{children:"under $10"})," ‚Üí 10„Éâ„É´Êú™Ê∫Ä"]})]})]})]})]}),u.jsxs("div",{className:"bg-fuchsia-50/20 rounded-lg p-5 border-2 border-fuchsia-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üöá"}),u.jsx("div",{className:"text-2xl font-bold text-fuchsia-600 mt-2",children:"THROUGH"}),u.jsx("div",{className:"text-sm text-fuchsia-700 mt-1",children:"„Äå„Äú„ÇíÈÄö„Å£„Å¶„Äç"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üö™"})," ÈÄöÈÅé„ÉªË≤´ÈÄöÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["ü™ü ",u.jsx("strong",{children:"through the window"})," ‚Üí Á™ì„ÇíÈÄö„Å£„Å¶"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üå≤ ",u.jsx("strong",{children:"through the forest"})," ‚Üí Ê£Æ„ÇíÊäú„Åë„Å¶"]})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚è∞"})," ÊúüÈñìÂÖ®‰ΩìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-fuchsia-600",children:["üåô ",u.jsx("strong",{children:"through the night"})," ‚Üí ‰∏ÄÊô©‰∏≠"]}),u.jsxs("div",{className:"text-fuchsia-600",children:["üåßÔ∏è ",u.jsx("strong",{children:"through the winter"})," ‚Üí ÂÜ¨„ÅÆÈñì„Åö„Å£„Å®"]})]})]})]})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"‚ú® Áü•„Å£„Å¶„Åä„Åè„Å®‰æøÂà©„Å™ÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-emerald-50/20 rounded-lg p-5 border-2 border-emerald-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚ÜîÔ∏è"}),u.jsx("div",{className:"text-2xl font-bold text-emerald-600 mt-2",children:"BETWEEN"}),u.jsx("div",{className:"text-sm text-emerald-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà2„Å§Ôºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-emerald-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìç"})," 2„Å§„ÅÆÈñìÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-emerald-600",children:["üè´üè• ",u.jsx("strong",{children:"between the school and hospital"})," ‚Üí Â≠¶Ê†°„Å®ÁóÖÈô¢„ÅÆÈñì"]}),u.jsxs("div",{className:"text-emerald-600",children:["üë• ",u.jsx("strong",{children:"between you and me"})," ‚Üí „ÅÇ„Å™„Åü„Å®ÁßÅ„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë•"}),u.jsx("div",{className:"text-2xl font-bold text-orange-600 mt-2",children:"AMONG"}),u.jsx("div",{className:"text-sm text-orange-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´Ôºà3„Å§‰ª•‰∏äÔºâ„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶"})," Ë§áÊï∞„ÅÆ‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-orange-600",children:["üå∏ ",u.jsx("strong",{children:"among the flowers"})," ‚Üí Ëä±„ÄÖ„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-orange-600",children:["üë• ",u.jsx("strong",{children:"among friends"})," ‚Üí Âèã‰∫∫„Åü„Å°„ÅÆÈñì„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-red-50/20 rounded-lg p-5 border-2 border-red-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üö´"}),u.jsx("div",{className:"text-2xl font-bold text-red-600 mt-2",children:"WITHOUT"}),u.jsx("div",{className:"text-sm text-red-700 mt-1",children:"„Äå„Äú„Å™„Åó„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-red-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ùå"})," Ê¨†Â¶Ç„Éª‰∏çÂú®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-red-600",children:["üíß ",u.jsx("strong",{children:"without water"})," ‚Üí Ê∞¥„Å™„Åó„Åß"]}),u.jsxs("div",{className:"text-red-600",children:["üë§ ",u.jsx("strong",{children:"without you"})," ‚Üí „ÅÇ„Å™„Åü„Å™„Åó„Åß"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-yellow-50/20 rounded-lg p-5 border-2 border-yellow-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è≥"}),u.jsx("div",{className:"text-2xl font-bold text-yellow-600 mt-2",children:"DURING"}),u.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"„Äå„Äú„ÅÆÈñì„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-yellow-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," ÊúüÈñì‰∏≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-yellow-600",children:["üå¥ ",u.jsx("strong",{children:"during summer vacation"})," ‚Üí Â§è‰ºë„Åø„ÅÆÈñì"]}),u.jsxs("div",{className:"text-yellow-600",children:["üé• ",u.jsx("strong",{children:"during the movie"})," ‚Üí Êò†Áîª„ÅÆÈñì"]})]})]})})]}),u.jsxs("div",{className:"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"‚è∞"}),u.jsx("div",{className:"text-2xl font-bold text-teal-600 mt-2",children:"UNTIL/TILL"}),u.jsx("div",{className:"text-sm text-teal-700 mt-1",children:"„Äå„Äú„Åæ„Åß„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-teal-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üïê"})," Á∂ôÁ∂ö„ÅÆÁµÇÁÇπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-teal-600",children:["üåô ",u.jsx("strong",{children:"until midnight"})," ‚Üí ÁúüÂ§ú‰∏≠„Åæ„Åß"]}),u.jsxs("div",{className:"text-teal-600",children:["üìÖ ",u.jsx("strong",{children:"until next week"})," ‚Üí Êù•ÈÄ±„Åæ„Åß"]})]})]})})]}),u.jsxs("div",{className:"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìÜ"}),u.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-2",children:"SINCE"}),u.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"„Äå„Äú‰ª•Êù•„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üìÖ"})," Ëµ∑ÁÇπ„Åã„ÇâÁ∂ôÁ∂öÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-blue-600",children:["üéÇ ",u.jsx("strong",{children:"since last year"})," ‚Üí ÂéªÂπ¥„Åã„ÇâÔºà„Åö„Å£„Å®Ôºâ"]}),u.jsxs("div",{className:"text-blue-600",children:["üë∂ ",u.jsx("strong",{children:"since childhood"})," ‚Üí Â≠ê‰æõ„ÅÆÈ†É„Åã„Çâ"]})]})]})})]})]})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-semibold mb-4 text-primary",children:"üè† Â†¥ÊâÄ„ÇíË°®„ÅôÂâçÁΩÆË©û"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üè¢"}),u.jsx("div",{className:"text-2xl font-bold text-purple-600 mt-2",children:"INSIDE"}),u.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"„Äå„Äú„ÅÆÂÜÖÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-purple-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üì¶"})," ÂÜÖÂÅ¥„ÉªÂÜÖÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-purple-600",children:["üè† ",u.jsx("strong",{children:"inside the house"})," ‚Üí ÂÆ∂„ÅÆ‰∏≠„Å´"]}),u.jsxs("div",{className:"text-purple-600",children:["üì¶ ",u.jsx("strong",{children:"inside the box"})," ‚Üí ÁÆ±„ÅÆ‰∏≠„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-5 border-2 border-green-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üå≥"}),u.jsx("div",{className:"text-2xl font-bold text-green-600 mt-2",children:"OUTSIDE"}),u.jsx("div",{className:"text-sm text-green-700 mt-1",children:"„Äå„Äú„ÅÆÂ§ñÂÅ¥„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üå≤"})," Â§ñÂÅ¥„ÉªÂ§ñÈÉ®Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-green-600",children:["üè° ",u.jsx("strong",{children:"outside the house"})," ‚Üí ÂÆ∂„ÅÆÂ§ñ„Å´"]}),u.jsxs("div",{className:"text-green-600",children:["üè´ ",u.jsx("strong",{children:"outside the school"})," ‚Üí Â≠¶Ê†°„ÅÆÂ§ñ„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üìç"}),u.jsx("div",{className:"text-2xl font-bold text-cyan-600 mt-2",children:"NEAR"}),u.jsx("div",{className:"text-sm text-cyan-700 mt-1",children:"„Äå„Äú„ÅÆËøë„Åè„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-cyan-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"üéØ"})," ËøëÊé•Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-cyan-600",children:["üöâ ",u.jsx("strong",{children:"near the station"})," ‚Üí ÈßÖ„ÅÆËøë„Åè„Å´"]}),u.jsxs("div",{className:"text-cyan-600",children:["üåä ",u.jsx("strong",{children:"near the sea"})," ‚Üí Êµ∑„ÅÆËøë„Åè„Å´"]})]})]})})]})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üë§"}),u.jsx("div",{className:"text-2xl font-bold text-indigo-600 mt-2",children:"BEHIND"}),u.jsx("div",{className:"text-sm text-indigo-700 mt-1",children:"„Äå„Äú„ÅÆÂæå„Çç„Å´„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-indigo-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚¨ÖÔ∏è"})," ÂæåÊñπÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-indigo-600",children:["üö™ ",u.jsx("strong",{children:"behind the door"})," ‚Üí „Éâ„Ç¢„ÅÆÂæå„Çç„Å´"]}),u.jsxs("div",{className:"text-indigo-600",children:["üè† ",u.jsx("strong",{children:"behind the house"})," ‚Üí ÂÆ∂„ÅÆË£è„Å´"]})]})]})})]}),u.jsxs("div",{className:"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üåâ"}),u.jsx("div",{className:"text-2xl font-bold text-pink-600 mt-2",children:"ACROSS"}),u.jsx("div",{className:"text-sm text-pink-700 mt-1",children:"„Äå„Äú„ÇíÊ®™Âàá„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-pink-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚ÜîÔ∏è"})," Ê®™Êñ≠Ôºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-pink-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"across the street"})," ‚Üí ÈÄö„Çä„ÇíÊ®™Âàá„Å£„Å¶"]}),u.jsxs("div",{className:"text-pink-600",children:["üåä ",u.jsx("strong",{children:"across the river"})," ‚Üí Â∑ù„ÇíÊ∏°„Å£„Å¶"]})]})]})})]}),u.jsxs("div",{className:"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500",children:[u.jsxs("div",{className:"text-center mb-4",children:[u.jsx("span",{className:"text-5xl",children:"üõ§Ô∏è"}),u.jsx("div",{className:"text-2xl font-bold text-lime-600 mt-2",children:"ALONG"}),u.jsx("div",{className:"text-sm text-lime-700 mt-1",children:"„Äå„Äú„Å´Ê≤ø„Å£„Å¶„Äç"})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-semibold text-lime-800 mb-2 flex items-center gap-2",children:[u.jsx("span",{children:"‚û°Ô∏è"})," Ê≤ø„Å£„Å¶ÈÄ≤„ÇÄÔºö"]}),u.jsxs("div",{className:"bg-white rounded p-2 text-sm space-y-1",children:[u.jsxs("div",{className:"text-lime-600",children:["üõ£Ô∏è ",u.jsx("strong",{children:"along the street"})," ‚Üí ÈÄö„Çä„Å´Ê≤ø„Å£„Å¶"]}),u.jsxs("div",{className:"text-lime-600",children:["üåä ",u.jsx("strong",{children:"along the river"})," ‚Üí Â∑ùÊ≤ø„ÅÑ„Å´"]})]})]})})]})]})})]}),RY=()=>{const n=[{symbol:".",name:"Period („Éî„É™„Ç™„Éâ)",usage:"Êñá„ÅÆÁµÇ„Çè„Çä",example:"I like cats.",explanation:"Âπ≥ÂèôÊñá„ÉªÂëΩ‰ª§Êñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:",",name:"Comma („Ç≥„É≥„Éû)",usage:"Âå∫Âàá„Çä„ÉªÂàóÊåô",example:"I bought apples, oranges, and bananas.",explanation:"ÂçòË™û„ÇÑÂè•„ÇíÂå∫Âàá„Çã„ÄÇÊé•Á∂öË©û„ÅÆÂâç„Å´„ÇÇ‰ΩøÁî®"},{symbol:"!",name:"Exclamation Mark (ÊÑüÂòÜÁ¨¶)",usage:"ÊÑüÂòÜ„ÉªÂº∑Ë™ø",example:"What a beautiful day!",explanation:"È©ö„Åç„ÉªÂñú„Å≥„ÉªÂº∑„ÅÑÊÑüÊÉÖ„ÇíË°®„Åô"},{symbol:"?",name:"Question Mark (ÁñëÂïèÁ¨¶)",usage:"ÁñëÂïè",example:"Do you like music?",explanation:"ÁñëÂïèÊñá„ÅÆÁµÇ„Çè„Çä„ÇíÁ§∫„Åô"},{symbol:":",name:"Colon („Ç≥„É≠„É≥)",usage:"Ë™¨Êòé„Éª‰æãÁ§∫„ÅÆÂ∞éÂÖ•",example:"I have three pets: a dog, a cat, and a bird.",explanation:"Âæå„Çç„Å´Ë™¨Êòé„ÇÑÂàóÊåô„ÅåÁ∂ö„Åè„Åì„Å®„ÇíÁ§∫„Åô"},{symbol:";",name:"Semicolon („Çª„Éü„Ç≥„É≠„É≥)",usage:"Èñ¢ÈÄ£„Åô„ÇãÊñá„ÅÆÂå∫Âàá„Çä",example:"I love reading; my sister prefers sports.",explanation:"„Éî„É™„Ç™„Éâ„Çà„ÇäÂº±„Åè„ÄÅ„Ç≥„É≥„Éû„Çà„ÇäÂº∑„ÅÑÂå∫Âàá„Çä"},{symbol:"-",name:"Hyphen („Éè„Ç§„Éï„É≥)",usage:"Ë§áÂêàË™û„ÉªË£úË∂≥",example:"a well-known writer",explanation:"2„Å§‰ª•‰∏ä„ÅÆÂçòË™û„ÇíÁπã„Åí„Çã"},{symbol:"‚Äî",name:"Em Dash („ÉÄ„ÉÉ„Ç∑„É•)",usage:"Âº∑„ÅÑÂå∫Âàá„Çä„ÉªÊåøÂÖ•",example:"My friends‚ÄîJohn and Mary‚Äîare coming.",explanation:"Ë£úË∂≥ÊÉÖÂ†±„ÇíÊåøÂÖ•„Åô„Çã"}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Ëã±ÊñáË®òÂè∑„ÅÆÊÑèÂë≥„Å®‰Ωø„ÅÑÊñπ"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-5 hover:shadow-lg transition-shadow border border-border-color",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[u.jsx("div",{className:"text-5xl font-bold text-primary flex-shrink-0",children:e.symbol}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-lg font-bold text-text-color",children:e.name}),u.jsx("p",{className:"text-sm text-primary font-semibold",children:e.usage})]})]}),u.jsx("div",{className:"bg-blue-50/20 rounded p-3 mb-3",children:u.jsx("div",{className:"font-mono text-sm text-blue-600",children:e.example})}),u.jsx("p",{className:"text-sm text-text-secondary",children:e.explanation})]},t))})]})},DY=()=>{const n=[{icon:"üìù",title:"ÊúÄÂàù„Å´Ê≥®Èáà„Å®Ë®≠Âïè„ÇíÁ¢∫Ë™ç",description:"Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´„ÄÅÊ≥®Èáà„Å®ÂïèÈ°å„Åã„ÇâÈáçË¶Å„Å™Êâã„Åå„Åã„Çä„ÇíÂæó„Çã",details:["Ê≥®Èáà„ÅØÂçò„Å´Èõ£„Åó„ÅÑÂçòË™û„ÅÆÊÑèÂë≥„Åß„ÅØ„Å™„Åè„ÄÅÂÜÖÂÆπÁêÜËß£„ÅÆ„Ç´„ÇÆ","Ê≥®Èáà„ÅÆÂçòË™û„ÇíÈÄ£ÊÉ≥„Åô„Çã„Å®Èï∑Êñá„ÅÆ„ÅÇ„Çâ„Åô„Åò„ÅåË¶ã„Åà„Å¶„Åè„Çã","Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ„ÇÑÂ§ßÊÑè„ÇíÂïè„ÅÜË®≠Âïè„Åã„Çâ„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÊãæ„ÅÜ","ÈÉ®ÂàÜÁöÑ„Å™ÈÅ∏ÊäûÂïèÈ°å„ÅÆÈÅ∏ÊäûËÇ¢„Å´„ÇÇÂÖ±ÈÄö„Ç≠„Éº„ÉØ„Éº„Éâ„ÅåÈö†„Çå„Å¶„ÅÑ„Çã"]},{icon:"üéØ",title:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÅßÂÖ®‰ΩìÂÉè„ÇíÊé¥„ÇÄ",description:"Ëã±Ë™û„ÅÆÊñáÁ´†„ÅØ„ÄåÁµêË´ñÂÖàÂá∫„Åó„Äç„ÅåÂü∫Êú¨„ÄÇÊúÄÂàù„Å´ÂÖ®‰Ωì„ÅÆÊñπÂêëÊÄß„ÅåÁ§∫„Åï„Çå„Çã",example:{title:"The Importance of Reading Books",para1:"Reading books is one of the best ways to improve your knowledge and imagination. Many people think that reading is boring, but it actually helps you learn new things and understand the world better.",explanation:`„Çø„Ç§„Éà„É´: „ÄåÊú¨„ÇíË™≠„ÇÄÈáçË¶ÅÊÄß„Äç‚Üí „ÉÜ„Éº„ÉûÁ¢∫ÂÆö
Á¨¨1ÊÆµËêΩ: „ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅØÁü•Ë≠ò„Å®ÊÉ≥ÂÉèÂäõ„ÇíÈ´ò„ÇÅ„ÇãÊúÄËâØ„ÅÆÊñπÊ≥ï„ÅÆ1„Å§„Äç‚Üí Á≠ÜËÄÖ„ÅÆ‰∏ªÂºµ
‚Üí „Åì„ÅÆÊôÇÁÇπ„Åß„ÄåÊú¨„ÇíË™≠„ÇÄ„Åì„Å®„ÅÆËâØ„ÅÑÁÇπ„Å´„Å§„ÅÑ„Å¶Ëø∞„Åπ„ÇãÊñáÁ´†„Äç„Å†„Å®ÂàÜ„Åã„Çã`},details:["„Çø„Ç§„Éà„É´ ‚Üí Ë©±È°åÔºà„Éà„Éî„ÉÉ„ÇØÔºâ„ÇíÁ§∫„Åô","Á¨¨1ÊÆµËêΩ ‚Üí Á≠ÜËÄÖ„ÅÆÁ´ãÂ†¥„Éª‰∏ªÂºµ„ÇíÊòéÁ¢∫„Å´„Åô„Çã","„Äå‰Ωï„Å´„Å§„ÅÑ„Å¶„Äç„Äå„Å©„ÅÜËÄÉ„Åà„Å¶„ÅÑ„Çã„Åã„Äç„Çí„É°„É¢„Åô„Çã„Å®Êï¥ÁêÜ„Åó„ÇÑ„Åô„ÅÑ","ÂïèÈ°åÊèêËµ∑ÔºàÁñëÂïèÔºâ‚Üí Êú¨Êñá„ÅßÁ≠î„Åà„ÇíÊé¢„Åô„Éë„Çø„Éº„É≥„ÇÇÂ§ö„ÅÑ"]},{icon:"üìç",title:"ÊÆµËêΩ„ÅÆÊúÄÂàù„Å®ÊúÄÂæå„Å´Ê≥®ÁõÆ",description:"Ëã±Ë™û„ÅØ„Äå„Éë„É©„Ç∞„É©„Éï„Éª„É™„Éº„Éá„Ç£„É≥„Ç∞„Äç„ÄÇ1ÊÆµËêΩ = 1„Å§„ÅÆ‰∏ªÂºµ",example:{structure:`„ÄêÂÖ∏ÂûãÁöÑ„Å™ÊÆµËêΩÊßãÈÄ†„Äë
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ
„ÄåÈÅãÂãï„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Äç‚Üê ÊÆµËêΩ„ÅÆ‰∏ªÂºµ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‰∏≠ÈñìÈÉ®Ôºà„Çµ„Éù„Éº„ÉàÔºâ
ÁêÜÁî±1: ‰Ωì„ÅåÂº∑„Åè„Å™„Çã
ÁêÜÁî±2: „Çπ„Éà„É¨„ÇπËß£Ê∂à„Å´„Å™„Çã
ÂÖ∑‰Ωì‰æã: ÊØéÊó•30ÂàÜÊ≠©„Åè„Å†„Åë„ÅßÂäπÊûú
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ÊúÄÁµÇÊñáÔºà„Åæ„Å®„ÇÅÔºâ
„Äå„Å†„Åã„ÇâÈÅãÂãï„ÇíÁøíÊÖ£„Å´„Åô„Åπ„Åç„Äç‚Üê ÁµêË´ñ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`,tips:"Á¨¨1Êñá„Å®ÊúÄÁµÇÊñá„Å†„ÅëË™≠„ÇÅ„Å∞„ÄÅ„Åù„ÅÆÊÆµËêΩ„Åß‰Ωï„ÇíË®Ä„ÅÑ„Åü„ÅÑ„Åã„ÅåÂàÜ„Åã„ÇãÔºÅ"},details:["Á¨¨1ÊñáÔºà„Éà„Éî„ÉÉ„ÇØ„Çª„É≥„ÉÜ„É≥„ÇπÔºâ: „Åù„ÅÆÊÆµËêΩ„ÅßÊúÄ„ÇÇË®Ä„ÅÑ„Åü„ÅÑ„Åì„Å®","‰∏≠ÈñìÈÉ®: ÁêÜÁî±„ÉªÂÖ∑‰Ωì‰æã„Éª„Éá„Éº„ÇøÔºàÈ£õ„Å∞„ÅóË™≠„ÅøOKÔºâ","ÊúÄÁµÇÊñá: „Åæ„Å®„ÇÅ„ÉªÁµêË´ñ„ÉªÊ¨°„ÅÆÊÆµËêΩ„Å∏„ÅÆÊ©ãÊ∏°„Åó","ÊÄ•„ÅÑ„Åß„ÅÑ„ÇãÊôÇ„ÅØÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å†„ÅëË™≠„ÇÄ„ÅÆ„ÇÇÊúâÂäπ"]},{icon:"üîó",title:"„Éá„Ç£„Çπ„Ç≥„Éº„Çπ„Éû„Éº„Ç´„Éº„ÇíË¶ãÈÄÉ„Åï„Å™„ÅÑ",description:"ÊñáÁ´†„ÅÆÊµÅ„Çå„ÇíÁ§∫„Åô„Å§„Å™„ÅéË®ÄËëâ„ÅåË´ñÁêÜÂ±ïÈñã„ÅÆ„Ç´„ÇÆ",details:["ÈÄÜÊé•: However, But, Yet, On the other hand","Âõ†Êûú: Therefore, So, Thus, As a result","‰æãÁ§∫: For example, For instance, Such as","ËøΩÂä†: In addition, Moreover, Furthermore","Ë®Ä„ÅÑÊèõ„Åà: In other words, That is, Namely"]},{icon:"üîç",title:"Ë®≠Âïè„ÅÆÁ®ÆÈ°ûÂà•„ÅÆÊîªÁï•Ê≥ï",description:"ÂïèÈ°å„ÅÆ„Çø„Ç§„Éó„Å´Âøú„Åò„ÅüË™≠„ÅøÊñπ„Çí‰Ωø„ÅÑÂàÜ„Åë„Çã",details:["‰∏ªÊó®ÂïèÈ°å: ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„Å®ÊúÄÁµÇÊÆµËêΩ„ÇíÈáçÁÇπÁöÑ„Å´","Ë©≥Á¥∞ÂïèÈ°å: „Ç≠„Éº„ÉØ„Éº„Éâ„ÅßË©≤ÂΩìÁÆáÊâÄ„ÇíÁâπÂÆö„Åó„Å¶Á≤æË™≠","Ë™ûÂΩôÂïèÈ°å: ÂâçÂæå„ÅÆÊñáËÑà„Åã„ÇâÊÑèÂë≥„ÇíÊé®Ê∏¨","ÊåáÁ§∫Ë™ûÂïèÈ°å: Áõ¥Ââç„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç","NOTÂïèÈ°å: Êú¨Êñá„Å´Êõ∏„Åã„Çå„Å¶„ÅÑ„Å™„ÅÑÈÅ∏ÊäûËÇ¢„ÇíÊé¢„Åô"]},{icon:"‚è±Ô∏è",title:"ÊôÇÈñìÈÖçÂàÜ„Å®ÂÑ™ÂÖàÈ†Ü‰Ωç",description:"ÂÖ®ÂïèËß£„Åè„Åü„ÇÅ„ÅÆÊà¶Áï•ÁöÑ„Å™ÊôÇÈñìÁÆ°ÁêÜ",details:["1Âïè„ÅÇ„Åü„Çä„ÅÆÁõÆÂÆâÊôÇÈñì„ÇíÊ±∫„ÇÅ„ÇãÔºà‰æã: 3ÂàÜ/ÂïèÔºâ","Êòì„Åó„ÅÑÂïèÈ°å„Åã„ÇâËß£„ÅÑ„Å¶ÂæóÁÇπ„ÇíÁ¢∫‰øù","Èõ£Âïè„ÅØÂæåÂõû„Åó„ÄÅÊúÄÂæå„Å´Êàª„Çã","ÊúÄ‰Ωé5ÂàÜ„ÅØË¶ãÁõ¥„ÅóÊôÇÈñì„ÇíÁ¢∫‰øù"]},{icon:"‚ùì",title:"ÂàÜ„Åã„Çâ„Å™„ÅÑÈÉ®ÂàÜ„ÅÆÂØæÂá¶Ê≥ï",description:"ÂÆåÁíß„ÇíÁõÆÊåá„Åï„Åö„ÄÅÂäπÁéáÁöÑ„Å´ÂæóÁÇπ„Åô„Çã",details:["Áü•„Çâ„Å™„ÅÑÂçòË™û„ÅØÂâçÂæå„Åã„ÇâÊé®Ê∏¨ÔºàÂìÅË©û„ÉªËÇØÂÆöÂê¶ÂÆö„ÇíÂà§Êñ≠Ôºâ","‰∏ÄÊñá„ÅåÂàÜ„Åã„Çâ„Å™„Åè„Å¶„ÇÇÊÆµËêΩÂÖ®‰Ωì„Åã„ÇâÊÑèÂë≥„ÇíÊé¥„ÇÄ","Á¥∞ÈÉ®„Çà„ÇäÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÂÑ™ÂÖà","Ê∂àÂéªÊ≥ï„ÅßÈÅ∏ÊäûËÇ¢„ÇíÁµû„ÇãÔºàÊòé„Çâ„Åã„Å´ÈÅï„ÅÜ„ÇÇ„ÅÆ„ÇíÈô§Â§ñÔºâ"]}];return u.jsxs("div",{className:"space-y-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-text-color mb-4",children:"Èï∑ÊñáË™≠Ëß£„ÅÆ„Ç≥„ÉÑ"}),u.jsx("div",{className:"bg-yellow-50/20 rounded-lg p-6 border-l-4 border-yellow-500 mb-6",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"text-2xl",children:"üí°"}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-lg text-yellow-800 mb-2",children:"Âü∫Êú¨Êà¶Áï•"}),u.jsx("p",{className:"text-yellow-700 mb-3",children:"Èï∑ÊñáË™≠Ëß£„ÅØ„ÄåÂÆåÁíß„Å´ÁêÜËß£„Åô„Çã„Äç„ÅÆ„Åß„ÅØ„Å™„Åè„ÄåÂøÖË¶Å„Å™ÊÉÖÂ†±„ÇíÂäπÁéáÁöÑ„Å´Ë¶ã„Å§„Åë„Çã„Äç‰ΩúÊ•≠„Åß„Åô„ÄÇ Ê≥®Èáà„Å®Ë®≠Âïè„Åã„ÇâÊâã„Åå„Åã„Çä„ÇíÂæó„Å¶„ÄÅÂÖ®‰Ωì„ÅÆÊµÅ„Çå„ÇíÊé¥„Åø„Å™„Åå„Çâ„ÄÅËß£Á≠î„Å´ÂøÖË¶Å„Å™ÈÉ®ÂàÜ„ÇíÊé¢„Åó„Å¶„ÅÑ„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ"}),u.jsxs("div",{className:"bg-yellow-100/30 rounded p-3 text-sm",children:[u.jsx("p",{className:"font-semibold text-yellow-900 mb-1",children:"‚ö° ÊúÄÈáçË¶Å„Éù„Ç§„É≥„Éà"}),u.jsx("p",{className:"text-yellow-800",children:"Ë™≠„ÇÄÈ†ÜÁï™: ‚ë† Ê≥®Èáà ‚Üí ‚ë° Ë®≠Âïè„ÉªÈÅ∏ÊäûËÇ¢ ‚Üí ‚ë¢ „Çø„Ç§„Éà„É´„ÉªÁ¨¨1ÊÆµËêΩ ‚Üí ‚ë£ ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá ‚Üí ‚ë§ ÂøÖË¶ÅÁÆáÊâÄ„ÇíÁ≤æË™≠"})]})]})]})}),u.jsx("div",{className:"space-y-4",children:n.map((e,t)=>u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6 hover:shadow-lg transition-shadow border-l-4 border-primary/30",children:[u.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[u.jsx("span",{className:"text-4xl",children:e.icon}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-xl font-bold text-text-color mb-2",children:e.title}),u.jsx("p",{className:"text-text-secondary",children:e.description})]})]}),e.example&&u.jsx("div",{className:"ml-14 mb-4 bg-blue-50/20 rounded-lg p-4 border border-blue-200",children:u.jsxs("div",{className:"space-y-3",children:[e.example.title&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìå „Çø„Ç§„Éà„É´‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 font-mono text-sm text-blue-700",children:e.example.title})]}),e.example.para1&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìÑ Á¨¨1ÊÆµËêΩ‰æã"}),u.jsx("div",{className:"bg-white rounded p-2 text-sm text-gray-700 leading-relaxed",children:e.example.para1})]}),e.example.structure&&u.jsxs("div",{children:[u.jsx("div",{className:"text-xs font-semibold text-blue-600 mb-1",children:"üìä ÊÆµËêΩ„ÅÆÊßãÈÄ†"}),u.jsx("div",{className:"bg-white rounded p-3 text-sm font-mono whitespace-pre-line text-gray-700",children:e.example.structure})]}),e.example.explanation&&u.jsxs("div",{className:"bg-yellow-50/30 rounded p-3 border-l-2 border-yellow-500",children:[u.jsx("div",{className:"text-xs font-semibold text-yellow-800 mb-1",children:"üí° Ë™≠„ÅøÂèñ„Çå„Çã„Åì„Å®"}),u.jsx("div",{className:"text-sm text-yellow-700 whitespace-pre-line",children:e.example.explanation})]}),e.example.tips&&u.jsx("div",{className:"bg-green-50/30 rounded p-3 border-l-2 border-green-500",children:u.jsxs("div",{className:"text-sm font-semibold text-green-700",children:["‚ú® ",e.example.tips]})})]})}),u.jsx("ul",{className:"space-y-2 ml-14",children:e.details.map((s,r)=>u.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[u.jsx("span",{className:"text-primary mt-1",children:"‚úì"}),u.jsx("span",{className:"text-text-color",children:s})]},r))})]},t))}),u.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50/20/20 rounded-lg p-6 mt-8 border-2 border-blue-300",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìñ"}),u.jsx("span",{children:"ÂÆüË∑µÔºÅÂäπÁéáÁöÑ„Å™Ë™≠Ëß£ÊâãÈ†Ü"})]}),u.jsx("ol",{className:"space-y-3",children:[{step:"Ê≥®Èáà„ÇíË™≠„ÇÄ",detail:"‚Üí ÈáçË¶ÅÂçòË™û„Åã„ÇâÂÜÖÂÆπ„Çí‰∫àÊÉ≥"},{step:"Ë®≠Âïè„Å®ÈÅ∏ÊäûËÇ¢„ÇíË™≠„ÇÄ",detail:"‚Üí ‰Ωï„ÇíËÅû„Åã„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„ÄÅ„Ç≠„Éº„ÉØ„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ"},{step:"„Çø„Ç§„Éà„É´„Å®Á¨¨1ÊÆµËêΩ„ÇíË™≠„ÇÄ",detail:"‚Üí „ÉÜ„Éº„Éû„Å®Ë´ñÁÇπ„ÇíÊääÊè°"},{step:"ÂêÑÊÆµËêΩ„ÅÆÁ¨¨1Êñá„ÇíÊµÅ„ÅóË™≠„Åø",detail:"‚Üí ÂÖ®‰ΩìÊßãÊàê„ÇíÁêÜËß£"},{step:"Ë®≠Âïè„Å´Èñ¢ÈÄ£„Åô„ÇãÊÆµËêΩ„ÇíÁ≤æË™≠",detail:"‚Üí Á≠î„Åà„ÅÆÊ†πÊã†„ÇíÊé¢„Åô"},{step:"ÈÅ∏ÊäûËÇ¢„ÇíÊú¨Êñá„Å®ÁÖß„Çâ„ÅóÂêà„Çè„Åõ„Çã",detail:"‚Üí Ê†πÊã†„Åå„ÅÇ„ÇãÈÅ∏ÊäûËÇ¢„ÇíÈÅ∏„Å∂"},{step:"Ë¶ãÁõ¥„Åó",detail:"‚Üí ÈÅ∏„Çì„Å†Á≠î„Åà„ÅåÊú¨Êñá„ÅÆÂÜÖÂÆπ„Å®ÁüõÁõæ„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç"}].map((e,t)=>u.jsxs("li",{className:"flex items-start gap-3",children:[u.jsx("span",{className:"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5",children:t+1}),u.jsxs("div",{children:[u.jsx("span",{className:"text-text-color font-semibold",children:e.step}),u.jsx("span",{className:"text-text-secondary text-sm ml-2",children:e.detail})]})]},t))})]}),u.jsxs("div",{className:"bg-green-50/20 rounded-lg p-6 border-l-4 border-green-500",children:[u.jsxs("h3",{className:"text-lg font-bold text-green-800 mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üìå"}),u.jsx("span",{children:"Ê≥®Èáà„ÅÆÂäπÊûúÁöÑ„Å™Ê¥ªÁî®Ê≥ï"})]}),u.jsxs("div",{className:"space-y-2 text-sm text-green-700",children:[u.jsxs("p",{children:["‚úì ",u.jsx("strong",{children:"Ê≥®Èáà„Åå„ÅÇ„Çã = „Åù„ÅÆÂçòË™û„ÅåÂÜÖÂÆπÁêÜËß£„Å´ÂøÖÈ†à"}),"„Å®„ÅÑ„ÅÜÂá∫È°åËÄÖ„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏"]}),u.jsx("p",{children:"‚úì Ê≥®Èáà„ÅÆÂçòË™û„Çí‰∏¶„Åπ„Çã„Å®„ÄÅÈï∑Êñá„ÅÆ„ÉÜ„Éº„Éû„ÇÑ„Çπ„Éà„Éº„É™„Éº„ÅåÊµÆ„Åã„Å≥‰∏ä„Åå„Çã"}),u.jsx("p",{children:"‚úì ‰æã: „ÄåÁí∞Â¢É„Äç„ÄåÊ±öÊüì„Äç„ÄåÂØæÁ≠ñ„Äç‚Üí Áí∞Â¢ÉÂïèÈ°å„Å´„Å§„ÅÑ„Å¶„ÅÆÊñáÁ´†„Å†„Å®‰∫àÊ∏¨„Åß„Åç„Çã"}),u.jsx("p",{className:"pt-2 italic",children:"üí° Êú¨Êñá„ÇíË™≠„ÇÄÂâç„Å´Ê≥®Èáà„Å†„Åë„ÅßÂÜÖÂÆπ„Çí‰∫àÊÉ≥„Åô„ÇãÁ∑¥Áøí„Çí„Åô„Çã„Å®ÂäπÊûúÁöÑÔºÅ"})]})]})]})},_Y=()=>u.jsx("div",{className:"dictionary-view",children:u.jsxs("div",{className:"dictionary-container",children:[u.jsx("h2",{children:"üìö Ëã±ÂçòË™ûËæûÊõ∏"}),u.jsx("p",{className:"coming-soon",children:"ËæûÊõ∏Ê©üËÉΩ„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô"})]})}),qy="ai_predictions_log",Ky=1e4;class of{constructor(e){Ee(this,"cache",null);Ee(this,"storage");this.storage=e||PY()}async logPrediction(e,t,s){const r={predicted:t,actual:s,word:e,timestamp:Date.now()};if(this.cache===null&&await this.loadCache(),this.cache.push(r),this.cache.length>Ky){const o=this.cache.length-Ky;this.cache.splice(0,o)}await this.saveCache()}async getRecentPredictions(e=1e3){this.cache===null&&await this.loadCache();const t=Math.max(0,this.cache.length-e);return this.cache.slice(t).reverse()}async getAllPredictions(){return this.cache===null&&await this.loadCache(),[...this.cache]}async getPredictionsByTimeRange(e,t=Date.now()){return this.cache===null&&await this.loadCache(),this.cache.filter(s=>s.timestamp&&s.timestamp>=e&&s.timestamp<=t)}async getPredictionsByWord(e){return this.cache===null&&await this.loadCache(),this.cache.filter(t=>t.word===e)}async getStats(){this.cache===null&&await this.loadCache();const e=this.cache.map(s=>s.timestamp).filter(s=>s!==void 0),t=new Set(this.cache.map(s=>s.word)).size;return{total:this.cache.length,oldest:e.length>0?Math.min(...e):null,newest:e.length>0?Math.max(...e):null,uniqueWords:t}}async clearLogs(){this.cache=[],await this.saveCache()}async loadCache(){try{const e=await this.storage.getItem(qy);e&&Array.isArray(e)?this.cache=e:this.cache=[]}catch(e){console.error("Failed to load prediction logs:",e),this.cache=[]}}async saveCache(){try{await this.storage.setItem(qy,this.cache)}catch(e){console.error("Failed to save prediction logs:",e)}}}function PY(){const n=new Map;return{async getItem(e){return n.get(e)},async setItem(e,t){n.set(e,t)}}}let eu=null;function WI(){return eu||(typeof window<"u"&&gs(async()=>{const{loadSetting:n,saveSetting:e}=await Promise.resolve().then(()=>gk);return{loadSetting:n,saveSetting:e}},void 0).then(({loadSetting:n,saveSetting:e})=>{const t={async getItem(s){return n(s)},async setItem(s,r){await e(s,r)}};eu=new of(t)}),eu=new of),eu}const jY=Object.freeze(Object.defineProperty({__proto__:null,PredictionLogger:of,getPredictionLogger:WI},Symbol.toStringTag,{value:"Module"}));function MY(n){return n.length===0?0:n.reduce((t,s)=>t+Math.abs(s.predicted-s.actual),0)/n.length*100}function FY(n,e=10){if(n.length===0)return{ece:0,mae:0,count:0,bins:[],overallAccuracy:0,averagePrediction:0};const t=OY(n,e),s=t.reduce((l,d)=>l+d.weight*d.error,0),r=MY(n),i=n.filter(l=>l.actual===1).length/n.length,c=n.reduce((l,d)=>l+d.predicted,0)/n.length;return{ece:s,mae:r,count:n.length,bins:t,overallAccuracy:i,averagePrediction:c}}function OY(n,e){const t=1/e,s=[];for(let r=0;r<e;r++){const o=r*t,i=(r+1)*t,a=n.filter(g=>r===e-1?g.predicted>=o&&g.predicted<=i:g.predicted>=o&&g.predicted<i);if(a.length===0){s.push({range:[o,i],midpoint:(o+i)/2,count:0,averagePrediction:0,actualAccuracy:0,weight:0,error:0});continue}const c=a.length,l=c/n.length,h=a.reduce((g,x)=>g+x.predicted,0)/c,f=a.filter(g=>g.actual===1).length/c,m=Math.abs(h-f);s.push({range:[o,i],midpoint:(o+i)/2,count:c,averagePrediction:h,actualAccuracy:f,weight:l,error:m})}return s}function LY(n){return n<=.05?"excellent":n<=.1?"good":n<=.15?"fair":"poor"}function zY(n){return n<=10?"excellent":n<=20?"good":n<=30?"fair":"poor"}const WY=({minPredictions:n=100})=>{const[e,t]=T.useState(null),[s,r]=T.useState(!0),[o,i]=T.useState(null),a=async()=>{r(!0),i(null);try{const m=await WI().getAllPredictions();if(m.length===0){i("‰∫àÊ∏¨„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),t(null);return}const g=FY(m,10);t(g)}catch(f){console.error("Failed to load calibration data:",f),i("„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}finally{r(!1)}};if(T.useEffect(()=>{a()},[]),s)return u.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:u.jsxs("div",{className:"animate-pulse",children:[u.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded mb-4"}),u.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})});if(o||!e)return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow",children:[u.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsx("p",{className:"text-yellow-800",children:o||"‰∫àÊ∏¨„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})})]});const c=LY(e.ece),l=zY(e.mae),d={excellent:"text-green-600",good:"text-blue-600",fair:"text-yellow-600",poor:"text-red-600"},h={excellent:"üåü",good:"üëç",fair:"‚ö†Ô∏è",poor:"‚ùå"},p=e.count<n;return u.jsxs("div",{className:"p-6 bg-white rounded-lg shadow space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"AI„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥ÂàÜÊûê"}),u.jsx("button",{onClick:a,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"üîÑ Êõ¥Êñ∞"})]}),p&&u.jsx("div",{className:"p-4 bg-yellow-50/20 border border-yellow-200 rounded",children:u.jsxs("p",{className:"text-yellow-800",children:["‚ö†Ô∏è ‰∫àÊ∏¨Êï∞„Åå",n,"‰ª∂Êú™Ê∫Ä„Åß„ÅôÔºàÁèæÂú®",e.count,"‰ª∂Ôºâ„ÄÇ „Çà„ÇäÊ≠£Á¢∫„Å™ÂàÜÊûê„Å´„ÅØ",n,"‰ª∂‰ª•‰∏ä„ÅÆ‰∫àÊ∏¨„ÅåÊé®Â•®„Åï„Çå„Åæ„Åô„ÄÇ"]})}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ECEÔºàExpected Calibration ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.ece*100).toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[c]}`,children:[h[c]," ",c]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"‰∫àÊ∏¨Á¢∫Áéá„Å®ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá„ÅÆÂ∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"MAEÔºàMean Absolute ErrorÔºâ"}),u.jsxs("div",{className:"flex items-baseline gap-2",children:[u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[e.mae.toFixed(1),"%"]}),u.jsxs("span",{className:`text-lg ${d[l]}`,children:[h[l]," ",l]})]}),u.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Âπ≥ÂùáÁµ∂ÂØæË™§Â∑ÆÔºàÂ∞è„Åï„ÅÑ„Åª„Å©ËâØ„ÅÑÔºâ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"ÂÖ®‰ΩìÊ≠£Ëß£Áéá"}),u.jsx("div",{className:"flex items-baseline gap-2",children:u.jsxs("span",{className:"text-3xl font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})}),u.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["‰∫àÊ∏¨Êï∞: ",e.count,"‰ª∂"]})]})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:"„Éì„É≥Âà•„Ç≠„É£„É™„Éñ„É¨„Éº„Ç∑„Éß„É≥"}),u.jsx("div",{className:"space-y-2",children:e.bins.filter(f=>f.count>0).map((f,m)=>u.jsx(BY,{bin:f},m))}),u.jsx("div",{className:"mt-4 text-xs text-gray-500",children:"ÁêÜÊÉ≥ÁöÑ„Å™‰∫àÊ∏¨„Åß„ÅØ„ÄÅÂêÑ„Éì„É≥„ÅÆ„Äå‰∫àÊ∏¨„Äç„Å®„ÄåÂÆüÈöõ„Äç„Åå‰∏ÄËá¥„Åó„Åæ„Åô„ÄÇ „Éì„É≥„ÅØ‰∫àÊ∏¨Á¢∫Áéá„Çí10ÂàÜÂâ≤„Åó„Åü„Ç∞„É´„Éº„Éó„Åß„Åô„ÄÇ"})]}),u.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-bold mb-2 text-gray-800",children:"‰∫àÊ∏¨„ÅÆÂÇæÂêë"}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"Âπ≥Âùá‰∫àÊ∏¨Á¢∫Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.averagePrediction*100).toFixed(1),"%"]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-sm text-gray-600",children:"ÂÆüÈöõ„ÅÆÊ≠£Ëß£Áéá:"}),u.jsxs("span",{className:"ml-2 font-bold text-gray-800",children:[(e.overallAccuracy*100).toFixed(1),"%"]})]}),u.jsx("div",{className:"ml-auto",children:e.averagePrediction>e.overallAccuracy+.05?u.jsx("span",{className:"px-3 py-1 bg-red-100/30 text-red-700 rounded-full text-sm",children:"ÈÅé‰ø°ÂÇæÂêë"}):e.averagePrediction<e.overallAccuracy-.05?u.jsx("span",{className:"px-3 py-1 bg-blue-100/30 text-blue-700 rounded-full text-sm",children:"ÈÅéÂ∞èË©ï‰æ°ÂÇæÂêë"}):u.jsx("span",{className:"px-3 py-1 bg-green-100/30 text-green-700 rounded-full text-sm",children:"„Éê„É©„É≥„ÇπËâØÂ•Ω"})})]})]})]})},BY=({bin:n})=>{const[e,t]=n.range,s=n.averagePrediction*100,r=n.actualAccuracy*100,o=Math.abs(s-r),i=o<5?"bg-green-500":o<10?"bg-blue-500":o<15?"bg-yellow-500":"bg-red-500";return u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[u.jsxs("span",{children:[(e*100).toFixed(0),"%-",(t*100).toFixed(0),"% Ôºà",n.count,"‰ª∂Ôºâ"]}),u.jsxs("span",{children:["Ë™§Â∑Æ: ",o.toFixed(1),"%"]})]}),u.jsxs("div",{className:"relative h-6 bg-gray-200 rounded",children:[u.jsx("div",{className:"absolute h-full bg-blue-300 rounded opacity-50",style:{width:`${s}%`}}),u.jsx("div",{className:`absolute h-full ${i} rounded`,style:{width:`${r}%`}}),u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800",children:["‰∫àÊ∏¨ ",s.toFixed(0),"% / ÂÆüÈöõ ",r.toFixed(0),"%"]})]})]})};async function VY(){try{const n=mk(),e=await is(),t={version:"1.0",exportDate:Date.now(),progress:e,sessionHistory:[],dailyStats:[],settings:{}};if(n.completed&&n.indexedDBSupported)try{t.sessionHistory=await F0(vn.SESSION_HISTORY),t.dailyStats=await F0(vn.DAILY_STATS);const s=["user-goal-level","lastLoginDate","loginStreak","radar-improvement-progress","skip-exclude-groups"];for(const r of s){const o=localStorage.getItem(r);o&&(t.settings[r]=o)}}catch{_.warn("IndexedDB„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„ÄÅLocalStorage„Åã„ÇâÂèñÂæó„Åó„Åæ„Åô:")}if(Object.keys(t.settings).length===0){const s=["user-goal-level","lastLoginDate","loginStreak","radar-improvement-progress","skip-exclude-groups","daily-plan-target-translation","daily-plan-target-spelling","daily-plan-target-reading"];for(const r of s){const o=localStorage.getItem(r);o&&(t.settings[r]=o)}}return JSON.stringify(t,null,2)}catch(n){throw _.error("„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:",n),new Error("„Éá„Éº„Çø„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}async function UY(){try{const n=await VY(),e=new Blob([n],{type:"application/json"}),t=URL.createObjectURL(e),s=new Date,r=`quiz-app-backup-${s.getFullYear()}${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}.json`,o=document.createElement("a");o.href=t,o.download=r,o.click(),URL.revokeObjectURL(t),_.log(`‚úÖ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü: ${r}`)}catch(n){_.error("„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç®„É©„Éº:",n),alert("„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}async function GY(n){try{const e=JSON.parse(n);if(!e.version||!e.progress)throw new Error("ÁÑ°Âäπ„Å™„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„Åß„Åô");if(!confirm(`„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô„ÅãÔºü

„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊó•ÊôÇ: ${new Date(e.exportDate).toLocaleString()}
ÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ

Âæ©ÂÖÉÂâç„Å´ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åô„Çã„Åì„Å®„ÇíÊé®Â•®„Åó„Åæ„Åô„ÄÇ`))return!1;if(await Cr(e.progress),e.settings)for(const[s,r]of Object.entries(e.settings))localStorage.setItem(s,r);return _.log("‚úÖ „Éá„Éº„ÇøÂæ©ÂÖÉÂÆå‰∫Ü"),alert("„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),!0}catch(e){return _.error("„Éá„Éº„Çø„Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:",e),alert("„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éï„Ç°„Ç§„É´„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ"),!1}}async function HY(n){return new Promise((e,t)=>{const s=new FileReader;s.onload=async r=>{var o;try{const i=(o=r.target)==null?void 0:o.result,a=await GY(i);e(a)}catch(i){t(i)}},s.onerror=()=>t(new Error("„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")),s.readAsText(n)})}function qY({onResetComplete:n,allQuestions:e,onQuestionSetsUpdated:t}){const[s,r]=T.useState(!1),[o,i]=T.useState(null),[a,c]=T.useState(!1),[l,d]=T.useState(null),[h,p]=T.useState(null),[f,m]=T.useState([]),[g,x]=T.useState(null),[y,b]=T.useState([]),[v,w]=T.useState([]),[S,N]=T.useState([]),[C,k]=T.useState(0),I=()=>{try{let P=0;const O=[];for(let A=0;A<localStorage.length;A++){const z=localStorage.key(A);if(z){const L=localStorage.getItem(z);if(L){const U=new Blob([L]).size;P+=U,O.push({key:z,sizeMB:U/(1024*1024)})}}}O.sort((A,z)=>z.sizeMB-A.sizeMB),i({totalMB:P/(1024*1024),details:O.slice(0,5)})}catch(P){_.error("„Çπ„Éà„É¨„Éº„Ç∏„Çµ„Ç§„Ç∫„ÅÆÂèñÂæó„Ç®„É©„Éº:",P)}},$=T.useCallback(()=>{d(s0()),p(r0()),m(x0(12)),x(y0());const O=Ah(10).map(z=>{const L=e.find(U=>U.word&&z.word&&U.word.toLowerCase()===z.word.toLowerCase());return{...z,etymology:L==null?void 0:L.etymology,relatedWords:L==null?void 0:L.relatedWords,difficulty:L==null?void 0:L.difficulty}});b(O),w(c0(10)),N(o0(7,5));const A=it();k(A.statistics.streakDays),I()},[e]);T.useEffect(()=>{$();const P=async()=>{const z=(await Dh()).some(L=>L.source==="weak-words");c(z)};P();const O=()=>{$(),P()};if(typeof window<"u"&&window.addEventListener(na,O),s){const A=setInterval(()=>{$(),P()},1e3);return()=>{clearInterval(A),typeof window<"u"&&window.removeEventListener(na,O)}}return()=>{typeof window<"u"&&window.removeEventListener(na,O)}},[s,$]);const j=()=>{confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ")&&(m0(),d(null),p(null),m([]),x(null),b([]),w([]),N([]),k(0),alert("Â≠¶ÁøíË®òÈå≤„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü"),$(),n&&n())};return u.jsxs("div",{className:"stats-view",children:[u.jsx("div",{className:"w-full mb-4 px-2",children:u.jsx(WY,{minPredictions:50})}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üìÜ Â≠¶Áøí„Ç´„É¨„É≥„ÉÄ„Éº",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàÈÅéÂéª7Êó•ÈñìÔºâ"})]}),u.jsx(KY,{streakDays:C})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:["üò∞ Ëã¶ÊâãÂçòË™û„Éà„ÉÉ„Éó10",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"ÔºàË¶ÅÂæ©ÁøíÔºâ"})]}),y.length>0?u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-orange-200 p-6",children:[u.jsx("ul",{className:"space-y-3",children:y.map((P,O)=>u.jsx("li",{className:"p-4 bg-gradient-to-r from-orange-50 to-red-50/30/30 rounded-lg border border-orange-200 hover:shadow-md hover:scale-[1.02] transition-all duration-200",children:u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[u.jsx("span",{className:"flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full text-sm",children:O+1}),u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:P.word}),P.meaning&&u.jsx("span",{className:"text-sm text-gray-600 mt-1",children:P.meaning}),P.reading&&u.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:P.reading}),P.etymology&&u.jsxs("span",{className:"text-xs text-blue-600 mt-1",children:["üìñ ",P.etymology]}),P.relatedWords&&u.jsxs("span",{className:"text-xs text-purple-600 mt-0.5",children:["üîó ",P.relatedWords]})]})]}),u.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[u.jsxs("span",{className:"px-3 py-1 bg-red-100/50 text-red-700 rounded-full font-medium",children:["‚ùå ",P.mistakes,"Âõû"]}),P.recentAccuracy>0&&u.jsxs("span",{className:"px-3 py-1 bg-blue-100/50 text-blue-700 rounded-full font-medium",children:["Ê≠£Ëß£Áéá ",P.recentAccuracy,"%"]})]})]})},O))}),u.jsxs("div",{className:"mt-6 flex gap-3",children:[u.jsxs("button",{onClick:async()=>{try{const P=await qu(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")}`,20,3,60,e);await Hu(P),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${P.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(P){_.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",P),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2",children:["üìö ÂïèÈ°å„Çª„ÉÉ„Éà„Çí",a?"Êõ¥Êñ∞":"‰ΩúÊàê",u.jsx("span",{className:"text-xs opacity-90",children:"(‰∏ä‰Ωç20Ë™û)"})]}),u.jsx("button",{onClick:async()=>{const P=prompt("ÂèñÂæó„Åô„ÇãËã¶ÊâãË™ûÂè•„ÅÆÊï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1-100Ôºâ","30");if(!P)return;const O=parseInt(P);if(isNaN(O)||O<1||O>100){alert("1„Åã„Çâ100„Åæ„Åß„ÅÆÊï∞ÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");return}try{const A=await qu(`Ëã¶ÊâãË™ûÂè•ÈõÜ ${new Date().toLocaleDateString("ja-JP")} (${O}Ë™û)`,O,3,60,e);await Hu(A),c(!0),t&&await t(),alert(`‚úÖ ÂïèÈ°å„Çª„ÉÉ„Éà„Äå${A.name}„Äç„Çí${a?"Êõ¥Êñ∞":"‰ΩúÊàê"}„Åó„Åæ„Åó„ÅüÔºÅ
ÂíåË®≥„ÉªÊöóË®ò„Éª„Çπ„Éö„É´„Çø„Éñ„ÅßÂà©Áî®„Åß„Åç„Åæ„Åô„ÄÇ`)}catch(A){_.error("ÂïèÈ°å„Çª„ÉÉ„Éà‰ΩúÊàê„Ç®„É©„Éº:",A),alert("‚ùå ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚öôÔ∏è „Ç´„Çπ„Çø„É†"})]})]}):u.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50/20/20 rounded-xl border-2 border-dashed border-green-300 p-8 text-center",children:[u.jsx("p",{className:"text-xl font-semibold text-green-700",children:"Ëã¶Êâã„Å™ÂçòË™û„ÅØ„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅüéâ"}),u.jsx("p",{className:"text-sm text-green-600 mt-2",children:"È†ÜË™ø„Å´Â≠¶Áøí„ÅåÈÄ≤„Çì„Åß„ÅÑ„Åæ„Åô"})]})]}),u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-blue-200 p-6 mb-4",children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó"}),u.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Â≠¶Áøí„Éá„Éº„Çø„ÇíJSON„Åß‰øùÂ≠ò/Âæ©ÂÖÉ„Åß„Åç„Åæ„Åô„ÄÇ„Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„ÉàÂâç„Å´„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÊé®Â•®„ÄÇ"}),u.jsx("button",{onClick:()=>{UY()},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200",children:"‚¨áÔ∏è „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ"}),u.jsx("span",{className:"mx-2"}),u.jsx("input",{type:"file",accept:"application/json","aria-label":"„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû",onChange:async P=>{var z;const O=(z=P.target.files)==null?void 0:z[0];if(P.target.value="",!O)return;await HY(O)&&window.location.reload()}})]}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg border-2 border-red-200 p-6",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"‚ö†Ô∏è „Éá„Éº„Çø„ÅÆ„É™„Çª„ÉÉ„Éà"}),u.jsx("p",{className:"text-sm text-gray-600",children:"„Åô„Åπ„Å¶„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ"})]}),u.jsx("button",{onClick:j,className:"px-8 py-3 bg-red-600 hover:bg-red-700:bg-red-800 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2",children:"üóëÔ∏è „É™„Çª„ÉÉ„ÉàÂÆüË°å"})]})})]}),o&&u.jsxs("div",{className:"w-full mb-4 px-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2",children:"üíæ „Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè"}),u.jsxs("div",{className:"bg-white rounded-xl shadow-lg border-2 border-purple-200 p-6",children:[u.jsxs("div",{className:"mb-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"ÂêàË®à‰ΩøÁî®Èáè"}),u.jsxs("span",{className:`text-xl font-bold ${o.totalMB>4?"text-red-600":"text-green-600"}`,children:[o.totalMB.toFixed(2)," MB"," ",u.jsx("span",{className:"text-sm font-normal text-gray-500",children:"/ Á¥Ñ 5-10 MB"})]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden relative",children:u.jsx("div",{className:`h-full rounded-full transition-all duration-500 absolute left-0 top-0 ${o.totalMB>8?"bg-red-600 w-full":o.totalMB>4?"bg-yellow-500":"bg-green-500"}`,"data-progress":Math.min(o.totalMB/10*100,100)})}),o.totalMB>4&&u.jsx("p",{className:"mt-2 text-sm font-medium text-red-600 flex items-center gap-1",children:"‚ö†Ô∏è ÂÆπÈáè„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô"})]}),u.jsxs("details",{className:"mt-4",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-700:text-blue-300 font-medium flex items-center gap-2",children:"üìä Ë©≥Á¥∞„ÇíË°®Á§∫"}),u.jsx("ul",{className:"mt-4 space-y-2",children:o.details.map((P,O)=>u.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[u.jsx("code",{className:"text-sm text-gray-700 font-mono",children:P.key}),u.jsxs("span",{className:"text-sm font-semibold text-gray-800",children:[P.sizeMB.toFixed(2)," MB"]})]},O))}),u.jsx("div",{className:"mt-4 p-4 bg-blue-50/20 rounded-lg border border-blue-200",children:u.jsxs("p",{className:"text-sm text-blue-700 flex items-start gap-2",children:[u.jsx("span",{className:"text-lg",children:"üí°"}),u.jsx("span",{children:"„Éí„É≥„Éà: „Éá„Éº„Çø„ÅåÂ§ß„Åç„Åè„Å™„Çä„Åô„Åé„ÅüÂ†¥Âêà„ÅØ„ÄÅÂè§„ÅÑÊàêÁ∏æ„ÇíÂâäÈô§„Åô„Çã„Å®ÂÆπÈáè„ÇíÁØÄÁ¥Ñ„Åß„Åç„Åæ„Åô„ÄÇ"})]})})]})]})]})]})}function KY({streakDays:n}){const[e,t]=T.useState([]);if(T.useEffect(()=>{const o=g0(14);t(o)},[]),e.length===0)return u.jsxs("div",{className:"w-full p-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center",children:[u.jsx("p",{className:"text-gray-500 text-lg",children:"üìä „Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}),u.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Â≠¶Áøí„ÇíÈñãÂßã„Åô„Çã„Å®ÈÄ≤Êçó„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô"})]});const s=e.slice(-7),r={memorization:{bg:"bg-green-500",text:"üü¢ ÊöóË®ò"},translation:{bg:"bg-blue-500",text:"üîµ ÂíåË®≥"},spelling:{bg:"bg-yellow-500",text:"üü° „Çπ„Éö„É´"},grammar:{bg:"bg-red-500",text:"üî¥ ÊñáÊ≥ï"}};return u.jsxs("div",{className:"w-full p-3 sm:p-6 bg-white rounded-xl shadow-lg border-2 border-blue-200",children:[u.jsxs("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 bg-gradient-to-r from-orange-100 to-yellow-100 rounded-lg border-2 border-orange-300 text-center",children:[u.jsxs("div",{className:"flex items-center justify-center gap-2",children:[u.jsx("span",{className:"text-2xl sm:text-3xl",children:"üî•"}),u.jsxs("span",{className:"text-lg sm:text-2xl font-bold text-orange-600",children:[n,"Êó•ÈÄ£Á∂öÂ≠¶Áøí‰∏≠ÔºÅ"]})]}),n>0&&u.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1 sm:mt-2",children:"„Åì„ÅÆË™øÂ≠ê„ÅßÈ†ëÂºµ„Çç„ÅÜÔºÅ"})]}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2 mb-2",children:s.map((o,i)=>{const c=new Date(o.date).getDay(),d=["Êó•","Êúà","ÁÅ´","Ê∞¥","Êú®","Èáë","Âúü"][c];return u.jsx("div",{className:"text-center",children:u.jsx("div",{className:"text-xs sm:text-sm font-bold text-gray-700 mb-1",children:d})},i)})}),u.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",children:s.map((o,i)=>{const a=[{key:"memorization",data:o.memorization},{key:"translation",data:o.translation},{key:"spelling",data:o.spelling},{key:"grammar",data:o.grammar}],c=a.reduce((m,g)=>m+g.data.correct,0),l=a.reduce((m,g)=>m+g.data.count,0),d=new Date(o.date),h=`${d.getMonth()+1}/${d.getDate()}`,p=o.date===k0(new Date),f=a.filter(m=>m.data.count>0).map(m=>{const g=m.data.count>0?Math.round(m.data.correct/m.data.count*100):0;return`${r[m.key].text}: ${m.data.correct}/${m.data.count}Âïè (${g}%)`}).join(`
`);return u.jsxs("div",{className:"flex flex-col items-center group",children:[u.jsx("div",{className:`relative w-full h-24 sm:h-32 bg-gray-200 rounded-lg overflow-hidden flex flex-col-reverse border-2 shadow-sm hover:shadow-xl hover:scale-105 transition-all duration-300 ${p?"border-orange-400 ring-2 ring-orange-300 ring-offset-1":"border-gray-300"}`,title:l>0?`${o.date}${p?" [‰ªäÊó•]":""}
${f}`:`${o.date}: Êú™Â≠¶Áøí`,children:c===0?u.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-xs",children:"Êú™Â≠¶Áøí"}):u.jsxs(u.Fragment,{children:[a.map(m=>m.data.correct>0&&u.jsx("div",{className:`mode-progress-bar w-full ${r[m.key].bg} flex items-center justify-center text-white text-xs font-bold transition-all duration-500 ease-out hover:brightness-110`,style:{"--height-percent":m.data.correct/c*100,"--animation-delay":i*.1},children:u.jsx("span",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:m.data.correct})},m.key)),u.jsx("div",{className:"hidden sm:flex absolute inset-0 bg-black/80 text-white p-2 text-[10px] leading-tight opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none flex-col justify-center",children:a.filter(m=>m.data.count>0).map(m=>{const g=Math.round(m.data.correct/m.data.count*100);return u.jsxs("div",{className:"mb-1",children:[u.jsx("div",{className:"font-bold",children:r[m.key].text}),u.jsxs("div",{children:[m.data.correct,"/",m.data.count,"Âïè (",g,"%)"]})]},m.key)})})]})}),u.jsxs("div",{className:"mt-1 sm:mt-2 text-center",children:[u.jsxs("div",{className:`text-[10px] sm:text-xs ${p?"text-orange-600 font-bold":"text-gray-500"}`,children:[h,p&&" üéØ"]}),u.jsxs("div",{className:"text-xs sm:text-sm font-bold text-gray-800",children:[c,"Âïè"]})]})]},i)})}),u.jsx("style",{children:`
        @keyframes slideUp {
          from {
            height: 0%;
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        .mode-progress-bar {
          height: calc(var(--height-percent, 0) * 1%);
          animation: slideUp 0.6s ease-out calc(var(--animation-delay, 0) * 1s) both;
        }
      `}),u.jsx("div",{className:"mt-4 sm:mt-6 pt-3 sm:pt-4 border-t-2 border-gray-200",children:u.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2 sm:gap-4 text-xs sm:text-sm",children:Object.entries(r).map(([o,i])=>u.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[u.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 ${i.bg} rounded`}),u.jsx("span",{className:"text-gray-700",children:i.text})]},o))})})]})}function XY({allQuestions:n,onStartSession:e,_selectedDataSource:t="all",_onDataSourceChange:s,customQuestionSets:r,onOpenCustomSetManagement:o,questionSets:i=[],categoryList:a=[],onResetComplete:c,onQuestionSetsUpdated:l}){const[d,h]=T.useState("settings"),[p,f]=T.useState(()=>{const $=localStorage.getItem("batchSize");return $?parseInt($,10):20}),[m,g]=T.useState(()=>localStorage.getItem("aiPersonality")||"kind-teacher"),x=$=>{g($),localStorage.setItem("aiPersonality",$)},[y,b]=T.useState(()=>{const $=localStorage.getItem("voiceGender");return $==="female"||$==="male"?$:"female"}),[v,w]=T.useState(()=>{const $=localStorage.getItem("speechRate");return $?parseFloat($):.9}),S=$=>{b($),localStorage.setItem("voiceGender",$)},N=$=>{w($),localStorage.setItem("speechRate",$.toString())},[C,k]=T.useState(()=>{const $=localStorage.getItem("darkMode");return $==="system"||$==="light"||$==="dark"?$:$==="true"?"dark":$==="false"?"light":"system"}),I=$=>{let j=!1;$==="system"?j=window.matchMedia("(prefers-color-scheme: dark)").matches:j=$==="dark",document.documentElement.classList.toggle("dark",j)};return T.useEffect(()=>{if(I(C),C==="system"){const $=window.matchMedia("(prefers-color-scheme: dark)"),j=()=>{I("system")};return $.addEventListener("change",j),()=>$.removeEventListener("change",j)}},[C]),n.length,u.jsxs("div",{className:"w-full",children:[u.jsxs("div",{className:"flex gap-2 mb-6 border-b-2 border-gray-200",children:[u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="settings"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("settings"),children:"‚öôÔ∏è Ë®≠ÂÆö"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="reference"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("reference"),children:"üîñ ÂèÇËÄÉ"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="dictionary"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("dictionary"),children:"üìï ËæûÊõ∏"}),u.jsx("button",{className:`px-4 py-3 font-semibold transition-all duration-200 border-b-4 ${d==="stats"?"text-blue-600 border-blue-600":"text-gray-600 border-transparent hover:text-blue-600 hover:border-blue-300"}`,onClick:()=>h("stats"),children:"üìä ÊàêÁ∏æ"})]}),d==="reference"?u.jsx(AY,{}):d==="dictionary"?u.jsx(_Y,{}):d==="stats"?u.jsx(qY,{questionSets:i,allQuestions:n,categoryList:a,onResetComplete:c||(()=>h("stats")),onQuestionSetsUpdated:l||(async()=>{})}):u.jsxs("div",{className:"px-4 py-6 space-y-6",children:[u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà"}),u.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:["(",r.length,"ÂÄã)"]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("button",{onClick:o,className:"w-full px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all shadow-md flex items-center justify-center gap-2",children:[u.jsx("span",{children:"üìö"}),u.jsx("span",{children:"„Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÁÆ°ÁêÜ"})]}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg",children:"üí° Ëá™ÂàÜ„Å†„Åë„ÅÆ„Ç™„É™„Ç∏„Éä„É´ÂïèÈ°å„Çª„ÉÉ„Éà„Çí‰ΩúÊàê„ÉªÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇÂ≠¶Áøí„Åó„Åü„ÅÑÂçòË™û„ÇíËá™Áî±„Å´ËøΩÂä†„Åó„Å¶„ÄÅÂäπÁéáÁöÑ„Å´Âæ©Áøí„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ"})]})]}),u.jsx(TY,{allQuestions:n,onStartSession:e}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üé≠"}),u.jsx("span",{children:"AI„ÅÆ‰∫∫Ê†º"})]}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.entries(IQ).map(([$,j])=>u.jsxs("button",{className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all duration-200 ${m===$?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md hover:scale-102"}`,onClick:()=>x($),children:[u.jsx("div",{className:"text-3xl",children:j.avatar}),u.jsx("div",{className:"font-semibold text-sm",children:j.name}),u.jsx("div",{className:"text-xs opacity-80 text-center",children:j.description})]},$))})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üîä"}),u.jsx("span",{children:"Èü≥Â£∞Ë®≠ÂÆö"})]}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"üé§"}),u.jsx("span",{children:"Â£∞„ÅÆÁ®ÆÈ°û"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${y==="female"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>S("female"),children:[u.jsx("div",{className:"text-3xl",children:"üë©"}),u.jsx("div",{className:"text-sm font-semibold",children:"Â•≥ÊÄß"})]}),u.jsxs("button",{className:`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${y==="male"?"bg-primary border-primary text-white shadow-lg scale-105":"bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md"}`,onClick:()=>S("male"),children:[u.jsx("div",{className:"text-3xl",children:"üë®"}),u.jsx("div",{className:"text-sm font-semibold",children:"Áî∑ÊÄß"})]})]})]}),u.jsxs("div",{children:[u.jsxs("h4",{className:"text-base font-semibold text-text-color mb-3 flex items-center gap-2",children:[u.jsx("span",{children:"‚è±Ô∏è"}),u.jsx("span",{children:"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsx("span",{className:"text-xs font-normal text-text-secondary",children:"(WPM: Words Per Minute)"})]}),u.jsxs("div",{className:"bg-bg-secondary rounded-lg p-6",children:[u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("div",{className:"font-bold text-primary text-4xl mb-1",children:Math.round(v*150)}),u.jsx("div",{className:"text-sm text-text-secondary",children:"WPM"}),u.jsx("div",{className:"text-xs text-text-secondary mt-2",children:v<.75?"üê¢ „ÇÜ„Å£„Åè„Çä„Å®Áô∫Èü≥":v>=.95?"üöÄ „Éç„Ç§„ÉÜ„Ç£„Éñ‰∏¶„ÅÆÈÄüÂ∫¶":"üéØ È´òÊ†°ÂÖ•Ë©¶„É™„Çπ„Éã„É≥„Ç∞Áõ∏ÂΩì"})]}),u.jsxs("div",{className:"relative mb-8",children:[u.jsx("input",{type:"range",min:"0.6",max:"1.0",step:"0.05",value:v,onChange:$=>N(parseFloat($.target.value)),className:"w-full h-3 bg-border-color rounded-lg appearance-none cursor-pointer accent-primary","aria-label":"Áô∫Èü≥ÈÄüÂ∫¶"}),u.jsxs("div",{className:"absolute top-0 left-0 w-full h-3 pointer-events-none",children:[u.jsx("div",{className:"absolute top-1/2 left-0 -translate-y-1/2 w-0.5 h-5 bg-gray-400"}),u.jsx("div",{className:"absolute top-1/2 left-[37.5%] -translate-y-1/2 w-0.5 h-5 bg-blue-500"}),u.jsx("div",{className:"absolute top-1/2 left-[75%] -translate-y-1/2 w-0.5 h-5 bg-green-500"}),u.jsx("div",{className:"absolute top-1/2 left-full -translate-y-1/2 -translate-x-0.5 w-0.5 h-5 bg-orange-500"})]})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs",children:[u.jsxs("button",{onClick:()=>N(.6),className:"bg-gray-50/50 rounded-lg p-3 border border-gray-200 hover:bg-gray-100:bg-gray-700/50 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-gray-600",children:"90 WPM"}),u.jsx("div",{className:"text-gray-500 mt-1",children:"ÊúÄ‰ΩéÈÄüÂ∫¶"})]}),u.jsxs("button",{onClick:()=>N(.75),className:"bg-blue-50/20 rounded-lg p-3 border border-blue-200 hover:bg-blue-100:bg-blue-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-blue-600",children:"113 WPM"}),u.jsx("div",{className:"text-blue-500 mt-1",children:"ÂàùÂ≠¶ËÄÖÂêë„Åë"})]}),u.jsxs("button",{onClick:()=>N(.9),className:"bg-green-50/20 rounded-lg p-3 border border-green-200 hover:bg-green-100:bg-green-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-green-600",children:"135 WPM"}),u.jsx("div",{className:"text-green-500 mt-1",children:"È´òÊ†°ÂÖ•Ë©¶"})]}),u.jsxs("button",{onClick:()=>N(1),className:"bg-orange-50/20 rounded-lg p-3 border border-orange-200 hover:bg-orange-100:bg-orange-800/30 transition-colors cursor-pointer",children:[u.jsx("div",{className:"font-bold text-orange-600",children:"150 WPM"}),u.jsx("div",{className:"text-orange-500 mt-1",children:"„Éç„Ç§„ÉÜ„Ç£„Éñ"})]})]})]})]})]}),u.jsxs("div",{className:"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border",children:[u.jsxs("h3",{className:"text-xl font-bold text-text-color mb-4 flex items-center gap-2",children:[u.jsx("span",{children:"üìã"}),u.jsx("span",{children:"„Éó„É©„Ç§„Éê„Ç∑„Éº"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("a",{href:"/privacy.html",target:"_blank",rel:"noopener noreferrer",className:"block w-full px-4 py-3 bg-primary text-white text-center rounded-lg font-semibold hover:bg-btn-primary-hover transition-colors shadow-md",children:"üìÑ „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº"}),u.jsx("p",{className:"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg text-center",children:"Êú¨„Ç¢„Éó„É™„ÅØÂÄã‰∫∫ÊÉÖÂ†±„ÇíÂèéÈõÜ„Åõ„Åö„ÄÅÂ≠¶Áøí„Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂ÂÜÖ„Å´„ÅÆ„Åø‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ"})]})]})]})]})}const QY=({isVisible:n,message:e="Ë™≠„ÅøËæº„Åø‰∏≠..."})=>n?u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 pointer-events-auto",children:u.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-6 animate-in fade-in duration-300",children:[u.jsxs("div",{className:"relative w-16 h-16",children:[u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-gray-200"}),u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-600 animate-spin"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:e}),u.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Ê∫ñÂÇô‰∏≠„Åß„Åô..."})]})]})}):null;let tu=null,nu=null;async function Xy(){return tu||(tu=(await gs(()=>Promise.resolve().then(()=>pY),void 0)).default,tu)}async function Qy(){return nu||(nu=(await gs(()=>Promise.resolve().then(()=>dY),void 0)).default,nu)}function Yy(){typeof requestIdleCallback<"u"?requestIdleCallback(()=>{Xy(),Qy()}):setTimeout(()=>{Xy(),Qy()},2e3)}const BI=["Ë®ÄË™ûÂü∫Êú¨","Â≠¶Ê†°„ÉªÂ≠¶Áøí","Êó•Â∏∏ÁîüÊ¥ª","‰∫∫„ÉªÁ§æ‰ºö","Ëá™ÁÑ∂„ÉªÁí∞Â¢É","È£ü„ÉªÂÅ•Â∫∑","ÈÅãÂãï„ÉªÂ®ØÊ•Ω","Â†¥ÊâÄ„ÉªÁßªÂãï","ÊôÇÈñì„ÉªÊï∞Èáè","ÁßëÂ≠¶„ÉªÊäÄË°ì"];function YY(){try{let n=0;const e=[];for(let s=0;s<localStorage.length;s++){const r=localStorage.key(s);if(r){const o=localStorage.getItem(r);if(o){const i=new Blob([o]).size;n+=i,e.push({key:r,size:i})}}}const t=n/(1024*1024);_.log(`üìä LocalStorage‰ΩøÁî®Èáè: ${t.toFixed(2)}MB`),e.sort((s,r)=>r.size-s.size),e.slice(0,5).forEach(s=>{const r=s.size/1048576;_.log(`  - ${s.key}: ${r.toFixed(2)}MB`)}),t>4&&(_.warn("‚ö†Ô∏è LocalStorage„ÅÆ‰ΩøÁî®Èáè„ÅåÂ§ö„ÅÑ„Åü„ÇÅ„ÄÅÂè§„ÅÑ„Éá„Éº„Çø„ÇíËá™ÂãïÂâäÈô§„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"),is(),_.log("Ëá™ÂãïÂúßÁ∏Æ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ"))}catch(n){_.error("LocalStorage„Çµ„Ç§„Ç∫„ÅÆÁ¢∫Ë™ç„Ç®„É©„Éº:",n)}}function JY(){const[n,e]=T.useState("translation"),[t,s]=T.useState(!1),[r,o]=T.useState([]),[i,a]=T.useState(()=>wX()),[c,l]=T.useState(!1);T.useEffect(()=>{vX(i)},[i]),T.useEffect(()=>{!window.location.hostname.includes("github.io")&&gs(()=>import("./scoreBoardTests-Brf3ccKG.js"),__vite__mapDeps([0,1,2])).then(()=>{_.log("‚úÖ „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü"),_.log("   ‰Ωø„ÅÑÊñπ: window.runScoreBoardTests()"),_.log('   „Åæ„Åü„ÅØ: window.checkCurrentScoreBoardDisplay("translation")')}).catch(xe=>{_.error("„ÉÜ„Çπ„Éà„É¢„Ç∏„É•„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",xe)})},[]);const{categoryList:d,setCategoryList:h,selectedCategory:p,setSelectedCategory:f,selectedDifficulty:m,setSelectedDifficulty:g,selectedWordPhraseFilter:x,setSelectedWordPhraseFilter:y,selectedPhraseTypeFilter:b,setSelectedPhraseTypeFilter:v,selectedDataSource:w,setSelectedDataSource:S}=yX(),[N,C]=T.useState([]),[k,I]=T.useState(!1),$=T.useRef(!1);T.useEffect(()=>{$.current=!1},[n]),T.useEffect(()=>{k&&(n==="translation"||n==="spelling")&&!$.current&&A.questions.length===0&&($.current=!0,F())},[k,n]);const[j]=T.useState(()=>{const Z=localStorage.getItem("quiz-adaptive-mode");return Z?JSON.parse(Z):!1}),{sessionStats:P,setSessionStats:O,quizState:A,setQuizState:z,reviewFocusMode:L,setReviewFocusMode:U,reviewQuestionPool:V,setReviewQuestionPool:B,reviewCorrectStreak:Y,setReviewCorrectStreak:K}=bX(),[pe]=T.useState(()=>new Pl),{reAddQuestion:ge,clearExpiredFlags:re,updateRequeueStats:ye,checkPositionMismatch:Ae}=jl(),[ve,_e]=T.useState(0),[ze,et]=T.useState(!1),[ut,yt]=T.useState(null),bt=T.useRef(0),$t=T.useRef(0),ae=T.useRef([]),le=T.useRef(0),G=T.useRef([]),oe=T.useRef(null),he=T.useRef(null),Te=T.useRef(new Map),Se=T.useRef([]),te=T.useRef([]);T.useEffect(()=>{if(n!=="translation"||!ze||A.questions.length===0)return;const Z=A.currentIndex,xe=A.answered?Z+1:Z;(async()=>{try{const ie=A.questions.slice(xe);if(ie.length===0){et(!1),yt(null),_e(0);return}_.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÈñãÂßã",{answerCount:ve,reason:ut,currentIndex:Z,startIndex:xe,remaining:ie.length});const We=await pe.schedule({questions:ie,mode:"translation",limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:P.correct,incorrect:P.incorrect,still_learning:P.review||0,mastered:P.mastered||0,duration:Date.now()-bt.current},useMetaAI:!0,isReviewFocusMode:L,hybridMode:!0});z(vt=>{if(vt.currentIndex!==Z)return vt;const dt=vt.questions.slice(0,xe);return{...vt,questions:[...dt,...We.scheduledQuestions]}}),_e(0),et(!1),yt(null),_.info("[Translation] Ëá™ÂãïÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞ÂÆå‰∫Ü",{newRemaining:We.scheduledQuestions.length})}catch(ie){_.error("[Translation] ÂÜç„Çπ„Ç±„Ç∏„É•„Éº„É™„É≥„Ç∞„Ç®„É©„Éº:",ie),et(!1),yt(null)}})()},[n,ze,ve,ut,A.questions,A.currentIndex,A.answered,pe,P,L]),xX(),T.useEffect(()=>{const Z=vt=>{const dt=vt==="dark"||vt==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark-mode",dt)},ke=localStorage.getItem("darkMode")||"system";Z(ke);const ie=window.matchMedia("(prefers-color-scheme: dark)"),We=()=>{const vt=localStorage.getItem("darkMode");(!vt||vt==="system")&&Z("system")};return ie.addEventListener("change",We),()=>ie.removeEventListener("change",We)},[]),T.useEffect(()=>{(async()=>{try{_.log("üîÑ „Éá„Éº„ÇøÁßªË°å„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...");try{await fk()}catch(Ge){_.error("Migration error (continuing):",Ge)}eb();let xe=!1;try{const Ge=await is();Ge&&Ge.wordProgress&&Ge.statistics&&Ge.questionSetStats?(_r(Ge),_.log("‚úÖ Progress data loaded successfully"),xe=!0):_.warn("‚ö†Ô∏è Progress data incomplete, reinitializing")}catch(Ge){_.error("Progress load error:",Ge)}if(!xe){_.log("üîß Initializing fresh progress data");const Ge={results:[],statistics:{totalQuizzes:0,totalQuestions:0,totalCorrect:0,averageScore:0,bestScore:0,streakDays:0,lastStudyDate:0,studyDates:[]},questionSetStats:{},wordProgress:{},categoryStats:{},difficultyStats:{}};_r(Ge);try{localStorage.setItem("progress-data",JSON.stringify(Ge))}catch(nt){_.warn("Failed to save initial progress:",nt)}}YY();const ie=await(await fetch("/data/vocabulary/high-school-entrance-words.csv")).text(),We=Qa(ie).map(Ge=>({...Ge,source:"junior"}));let vt=[];try{const nt=await(await fetch("/data/vocabulary/high-school-entrance-phrases.csv")).text();vt=Qa(nt).map(at=>({...at,source:"junior"})),_.log(`üìö È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${vt.length}ÂÄã`)}catch(Ge){_.warn("È´òÊ†°ÂèóÈ®ìËã±ÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Ge)}let dt=[];try{const nt=await(await fetch("/data/vocabulary/junior-high-intermediate-words.csv")).text();dt=Qa(nt).map(at=>({...at,source:"intermediate"})),_.log(`üìö ‰∏≠Â≠¶Â±•‰øÆÂçòË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${dt.length}ÂÄã`)}catch(Ge){_.warn("‰∏≠Â≠¶Â±•‰øÆÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Ge)}let st=[];try{const nt=await(await fetch("/data/vocabulary/junior-high-intermediate-phrases.csv")).text();st=Qa(nt).map(at=>({...at,source:"intermediate"})),_.log(`üìö ‰∏≠Â≠¶Â±•‰øÆÁÜüË™û„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü: ${st.length}ÂÄã`)}catch(Ge){_.warn("‰∏≠Â≠¶Â±•‰øÆÁÜüË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Ge)}const Xt=new Map;try{for(const Ge of[1,2,3])try{const at=await(await fetch(`/data/sentence-ordering-grade${Ge}.json`)).json();at.units&&at.units.forEach(jt=>{const Pt=`${Ge}Âπ¥ ${jt.unit}`;Xt.set(jt.unit,`${jt.unit}: ${jt.title}`),Xt.set(Pt,`${Ge}Âπ¥ ${jt.unit}: ${jt.title}`)})}catch(nt){_.warn(`Grade ${Ge} sentence ordering data not found:`,nt)}}catch(Ge){_.warn("Unit title mapping failed:",Ge)}const ft=[...We,...vt,...dt,...st];if(ft.length>0){o(ft);try{const Xe=ft.map($e=>({word:$e.word,difficulty:$e.difficulty||"beginner"}));localStorage.setItem("all-questions-cache",JSON.stringify(Xe))}catch(Xe){_.warn("Questions cache save failed:",Xe)}const at=Array.from(new Set(ft.map(Xe=>Xe.category||"").filter(Xe=>Xe))).map(Xe=>Xt.has(Xe)?Xt.get(Xe):Xe).sort((Xe,$e)=>{const Oe=/(\d+)Âπ¥\s+Unit\s+(\d+)/i,ht=Xe.match(Oe),se=$e.match(Oe);if(ht&&se){const ot=parseInt(ht[1],10),Qe=parseInt(se[1],10);if(ot!==Qe)return ot-Qe;const Ft=parseInt(ht[2],10),Ze=parseInt(se[2],10);return Ft-Ze}const Ne=/Unit\s+(\d+)/i,Be=Xe.match(Ne),rt=$e.match(Ne);if(Be&&rt){const ot=parseInt(Be[1],10),Qe=parseInt(rt[1],10);return ot-Qe}return Xe.localeCompare($e,"ja")});h(at);const jt={id:"all-set",name:"È´òÊ†°ÂèóÈ®ìÁ∑èÂêà",questions:ft,createdAt:Date.now(),isBuiltIn:!0,source:"È´òÊ†°ÂèóÈ®ì2758Ë™û + È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ1791Ë™û"},Pt={id:"advanced-set",name:"È´òÊ†°ÂèóÈ®ì‰∏äÁ¥ö",questions:ft.filter(Xe=>Xe.difficulty==="advanced"),createdAt:Date.now(),isBuiltIn:!0,source:"high-school-entrance (ÂçòË™û2662 + ÁÜüË™û96)"},Yt={id:"standard-set",name:"È´òÊ†°ÂèóÈ®ìÊ®ôÊ∫ñ",questions:ft.filter(Xe=>Xe.difficulty==="intermediate"||Xe.difficulty==="beginner"),createdAt:Date.now(),isBuiltIn:!0,source:"junior-high-intermediate (ÂçòË™û1579 + ÁÜüË™û212)"},{getCustomQuestionSets:mt}=await gs(async()=>{const{getCustomQuestionSets:Xe}=await Promise.resolve().then(()=>$y);return{getCustomQuestionSets:Xe}},void 0),Mt=(await mt()).map(Xe=>{const $e=new Date(Xe.createdAt),Oe=`${$e.getMonth()+1}/${$e.getDate()}`,ht=Xe.source==="reading"?"Èï∑Êñá":Xe.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï";return{id:Xe.id,name:`„Ç´„Çπ„Çø„É†ÂïèÈ°åÔºà${ht}_${Oe}Ôºâ`,questions:Xe.questions,createdAt:Xe.createdAt,isBuiltIn:!1,source:Xe.source==="reading"?"Èï∑ÊñáË™≠Ëß£":Xe.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}});C([jt,Pt,Yt,...Mt]),I(!0)}}catch(xe){_.error("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",xe),alert("Ëã±ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}})()},[]);const Fe=async()=>{try{const{getCustomQuestionSets:Z}=await gs(async()=>{const{getCustomQuestionSets:We}=await Promise.resolve().then(()=>$y);return{getCustomQuestionSets:We}},void 0),xe=await Z(),ke=N.find(We=>We.isBuiltIn),ie=xe.map(We=>({id:We.id,name:We.name,questions:We.questions,createdAt:We.createdAt,isBuiltIn:!1,source:We.source==="reading"?"Èï∑ÊñáË™≠Ëß£":We.source==="weak-words"?"Ëã¶ÊâãË™ûÂè•":"ÊâãÂãï‰ΩúÊàê"}));ke&&C([ke,...ie])}catch(Z){_.error("„Ç´„Çπ„Çø„É†ÂïèÈ°å„Çª„ÉÉ„Éà„ÅÆÂÜçË™≠„ÅøËæº„Åø„Å´Â§±Êïó:",Z)}};T.useEffect(()=>{localStorage.setItem("quiz-adaptive-mode",JSON.stringify(j))},[j]),T.useEffect(()=>{localStorage.setItem("selectedDataSource",w)},[w]),T.useEffect(()=>{A.questions.length>0&&F()},[w,p,m,x,b]);const Le=()=>{let Z=r;if(w!=="all"&&(Z=Z.filter(xe=>xe.source===w)),p!=="all"&&(Z=Z.filter(xe=>xe.category===p)),m!=="all"){const xe={all:"",beginner:"ÂàùÁ¥ö",intermediate:"‰∏≠Á¥ö",advanced:"‰∏äÁ¥ö"};Z=Z.filter(ke=>ke.difficulty===xe[m])}return x==="words-only"?Z=Z.filter(xe=>!xe.word.includes(" ")):x==="phrases-only"&&(Z=Z.filter(xe=>xe.word.includes(" ")),b!=="all"&&(Z=Z.filter(xe=>gI(xe.word)===b))),Z=d0(Z),Z},De=(Z,xe)=>{const ke=SX(Z,xe);a(ie=>({...ie,sets:[...ie.sets,ke]})),_.log(`‚úÖ „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${Z}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü`)},Ke=Z=>{a(xe=>IX(xe,Z)),_.log("üóëÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü")},pt=(Z,xe,ke)=>{a(ie=>kX(ie,Z,{name:xe,description:ke})),_.log(`‚úèÔ∏è „Ç´„Çπ„Çø„É†„Çª„ÉÉ„Éà„Äå${xe}„Äç„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`)},R=(Z,xe)=>{a(ke=>CX(ke,Z,xe)),_.log(`‚ûï „Äå${xe.word}„Äç„Çí„Çª„ÉÉ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`)},D=(Z,xe)=>{a(ke=>NX(ke,Z,xe)),_.log(`‚ûñ „Äå${xe.word}„Äç„Çí„Çª„ÉÉ„Éà„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü`)},F=async()=>{var Yt;const Z=yQ();_.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥:",Z);const xe=n0();let ke=Le();if(ke.length===0){alert("ÊåáÂÆö„Åï„Çå„ÅüÊù°‰ª∂„ÅÆÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì");return}if(L){const mt=Ou();if(ke=ke.filter(nn=>mt.some(Mt=>Mt&&nn.word&&Mt.toLowerCase()===nn.word.toLowerCase())),ke.length===0){alert("Ë¶ÅÂæ©ÁøíÂïèÈ°å„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì"),U(!1),B([]);return}B([...ke]),_.log(`üéØ Ë£ú‰øÆ„É¢„Éº„ÉâÈñãÂßã: ${ke.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å`)}const ie=EX(r,d),We=II();We?(MX(ie),_.log(`üìä ÊîπÂñÑÈÄ≤Êçó: ${We.currentDay}Êó•ÁõÆ - ÂÖ®‰ΩìÈÄ≤Êçó${We.overallProgress.toFixed(1)}%`)):ie.weakCategories.length>0&&(jX(ie),_.log("üéØ „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„ÉàÊîπÂñÑ„Éó„É©„É≥„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü")),ie.aiRecommendations.length>0&&(_.log("üß† AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà „Åã„Çâ„ÅÆÊé®Â•®:"),ie.aiRecommendations.forEach(mt=>_.log(`  ${mt}`))),ie.weakCategories.length>0&&p==="all"&&(ke=PX(ke,ie.weakCategories,Math.min(30,ke.length)),_.log(`üí° Âº±ÁÇπÂàÜÈáé„ÇíÂÑ™ÂÖàÂá∫È°å: ${ie.weakCategories.slice(0,3).map(mt=>mt.category).join(", ")}`));const vt=Ou(),st=p0(10).map(mt=>mt.word);let Xt=[];if(vt.length>0){const mt=ke.filter(Mt=>vt.some(Xe=>Xe&&Mt.word&&Xe.toLowerCase()===Mt.word.toLowerCase()));Xt=xe.maxReviewCount>0?mt.slice(0,xe.maxReviewCount):[];const nn=ke.filter(Mt=>!vt.some(Xe=>Xe&&Mt.word&&Xe.toLowerCase()===Mt.word.toLowerCase()));ke=[...Xt,...nn],Xt.length>0&&_.log(`üîÑ Ë¶ÅÂæ©ÁøíÂïèÈ°å: ${Xt.length}ÂïèÔºà‰∏äÈôê: ${xe.maxReviewCount}ÂïèÔºâ`)}if(st.length>0){const mt=ke.filter(nn=>st.some(Mt=>Mt&&nn.word&&Mt.toLowerCase()===nn.word.toLowerCase()));if(mt.length>0){const nn=ke.filter(Mt=>!st.some(Xe=>Xe&&Mt.word&&Xe.toLowerCase()===Mt.word.toLowerCase()));ke=[...mt,...nn],_.log(`üîó Ê∑∑ÂêåÂ±•Ê≠¥: ${mt.length}Âïè„ÇíÂÑ™ÂÖàÂá∫È°å`)}}if(!L&&ke.length>0){const mt=await is(),nn=new Map;ke.forEach(Be=>{const rt=mt.wordProgress[Be.word];if(rt&&rt.learningHistory&&rt.learningHistory.length>0){const ot=rt.learningHistory.map(Ft=>({timestamp:Ft.timestamp,wasCorrect:Ft.wasCorrect,responseTime:Ft.responseTime,userAnswer:Ft.userAnswer,confidenceLevel:Ft.responseTime<2e3?"instant":Ft.responseTime<5e3?"hesitant":"guessed",sessionContext:{questionIndex:Ft.sessionIndex||0,previousQuestions:[],sessionFatigue:0}})),Qe=FX(Be.word,rt,ot);nn.set(Be.word,Qe)}});const Mt=WX(ke,mt.wordProgress,nn),Xe=VX(Mt,ke.length),$e=Ty(G.current,bt.current);oe.current=$e;const Oe=HX(Xe,$e),ht=new Map(Oe.map(Be=>[Be.word,Be]));if(ke=ke.filter(Be=>ht.has(Be.word)).sort((Be,rt)=>{const ot=ht.get(Be.word).priority;return ht.get(rt.word).priority-ot}),_.log("üß† Â≠¶ÁøíÊõ≤Á∑öAI: ÊúÄÈÅ©„Å™Âá∫È°åÈ†ÜÂ∫è„ÇíÊ±∫ÂÆö"),_.log("  Âá∫È°åÊà¶Áï•:",Oe.slice(0,5).map(Be=>`${Be.word}(${Be.strategy}, ÊàêÂäüÁéá${Be.estimatedSuccessRate.toFixed(0)}%)`).join(", ")),$e.fatigueLevel>40){const Be=KX($e);_.log(`‚ö° Ë™çÁü•Ë≤†Ëç∑: ${$e.fatigueLevel.toFixed(0)}% - ${Be}`)}const se=iI(ke,mt.wordProgress,te.current),Ne=new Map;if(se.sequence.forEach((Be,rt)=>{Ne.set(Be,rt)}),ke=ke.sort((Be,rt)=>{const ot=Ne.get(Be.word)??999,Qe=Ne.get(rt.word)??999;return ot-Qe}),_.log("üîó ÊñáËÑàÂ≠¶ÁøíAI: ÊÑèÂë≥ÁöÑ„ÇØ„É©„Çπ„Çø„É™„É≥„Ç∞ÂÆå‰∫Ü"),_.log(`  „ÇØ„É©„Çπ„Çø„ÉºÊï∞: ${se.clusters.length}`),se.transitions.length>0){const Be=se.transitions[0];_.log(`  ‰æã: ${Be.from} ‚Üí ${Be.to} (${Be.reason})`)}}if(n==="translation"&&ke.length>0){await is();const mt=await pe.schedule({questions:ke,mode:"translation",limits:{learningLimit:null,reviewLimit:null},sessionStats:{correct:P.correct,incorrect:P.incorrect,still_learning:P.review||0,mastered:P.mastered||0,duration:0},useMetaAI:!0,isReviewFocusMode:L,hybridMode:!0});ke=mt.scheduledQuestions,mt.vibrationScore>50&&_.warn("[Translation Hybrid] È´ò„ÅÑÊåØÂãï„Çπ„Ç≥„Ç¢Ê§úÂá∫",{score:mt.vibrationScore,processingTime:mt.processingTime}),_.log("üß† „É°„ÇøAIÁµ±ÂêàÂ±§: „Éè„Ç§„Éñ„É™„ÉÉ„ÉâË™øÊï¥ÂÆå‰∫Ü",{total:ke.length,vibrationScore:mt.vibrationScore,adjustmentRange:"¬±20%"})}L?_.log(`üéØ Ë£ú‰øÆ„É¢„Éº„Éâ: ${ke.length}Âïè„ÇíÁπ∞„ÇäËøî„ÅóÂá∫È°å‰∏≠`):_.log(`üìö Â≠¶ÁøíÊï∞: ${ke.length}Âïè`),z({questions:ke,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),_e(0),et(!1),yt(null),O({correct:0,incorrect:0,review:0,mastered:0,newQuestions:0,reviewQuestions:0,consecutiveNew:0,consecutiveReview:0}),bt.current=Date.now(),$t.current=Date.now(),ae.current=[],G.current=[],oe.current=null;const ft=await is(),Ge=XX(ft.wordProgress,Se.current);he.current=Ge;const nt=ke.map(mt=>mt.word),at=((Yt=oe.current)==null?void 0:Yt.fatigueLevel)??0,jt=tQ(nt,ft.wordProgress,Ge,at);Te.current=jt,_.log("üîÆ „Ç®„É©„Éº‰∫àÊ∏¨AI: Ë™§Á≠î„É™„Çπ„ÇØÂàÜÊûêÂÆå‰∫Ü");const Pt=Array.from(jt.values()).filter(mt=>mt.warningLevel==="high"||mt.warningLevel==="critical").sort((mt,nn)=>nn.errorRisk-mt.errorRisk);Pt.length>0&&(_.log(`  È´ò„É™„Çπ„ÇØÂïèÈ°å: ${Pt.length}Âïè`),_.log(`  ÊúÄÈ´ò„É™„Çπ„ÇØ: ${Pt[0].word} (${Pt[0].errorRisk.toFixed(0)}% - ${Pt[0].primaryPattern})`))},M=()=>{L?(U(!1),B([]),K(new Map)):(U(!0),K(new Map))},X=()=>{L?(U(!1),B([]),K(new Map)):(U(!0),K(new Map))},ue=Z=>{f(Z),U(!1),B([]),A.questions.length>0&&F()},J=Z=>{g(Z),U(!1),B([]),A.questions.length>0&&F()},de=async(Z,xe,ke)=>{var Ge,nt,at,jt;if(A.answered)return;const ie=Z==="ÂàÜ„Åã„Çâ„Å™„ÅÑ",We=Z.trim(),vt=xe.trim(),dt=!ie&&We===vt,st=A.questions[A.currentIndex];!dt&&ke&&ke.word&&(await h0(ke.word,st.word),_.log(`üîó Ê∑∑Âêå„ÇíË®òÈå≤: ${ke.word} ‚Üê ${st.word}`));const Xt=Date.now()-$t.current;if(st){const Yt=(Ge=(await is()).wordProgress)==null?void 0:Ge[st.word],nn=1-(Yt?Yt.correctCount/(Yt.correctCount+Yt.incorrectCount):.5);G.current.push({timestamp:Date.now(),wasCorrect:dt,responseTime:Xt,questionDifficulty:nn});const Mt=Ty(G.current,bt.current);oe.current=Mt,(nt=Mt.breakRecommendation)!=null&&nt.shouldBreak&&_.log(`üí§ ‰ºëÊÜ©Êé®Â•®: ${Mt.breakRecommendation.reason}`),Se.current.push({word:st.word,wasCorrect:dt,userAnswer:We}),Se.current.length>50&&(Se.current=Se.current.slice(-50))}if(st){await Co(st.word,dt,Xt,void 0,"translation");const Yt=(at=(await is()).wordProgress)==null?void 0:at[st.word];let mt=dt?"correct":"incorrect";Yt&&Yt.masteryLevel==="mastered"?mt="mastered":!dt&&Yt&&Yt.incorrectCount>=2&&(mt="review"),O(Xe=>({...Xe,correct:Xe.correct+(mt==="correct"?1:0),incorrect:Xe.incorrect+(mt==="incorrect"?1:0),review:Xe.review+(mt==="review"?1:0),mastered:Xe.mastered+(mt==="mastered"?1:0)})),xa({status:mt,word:st.word,timestamp:Date.now()},"translation"),te.current.push(st.word),te.current.length>10&&(te.current=te.current.slice(-10)),le.current++;const Mt=(jt=(await is()).wordProgress)==null?void 0:jt[st.word];if(Mt&&Mt.skippedCount&&Mt.skippedCount>0&&(dt?NI(st.word):(CI(st.word),_.log("ü§î AIÂ≠¶Áøí„Ç¢„Ç∑„Çπ„Çø„É≥„Éà: „Çπ„Ç≠„ÉÉ„Éó„Åó„ÅüÂçòË™û„Åå‰∏çÊ≠£Ëß£„Åß„Åó„Åü„ÄÇÂêåÊôÇÊúü„ÅÆÂçòË™û„ÇíÂÜçÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ"))),pc({id:fc(),questionSetId:"main-set-single",questionSetName:"È´òÊ†°ÂèóÈ®ìËã±ÂçòË™û",score:dt?1:0,total:1,percentage:dt?100:0,date:Date.now(),timeSpent:Math.floor(Xt/1e3),incorrectWords:dt?[]:[st.word],mode:"translation",category:p!=="all"?p:void 0,difficulty:m!=="all"?m:void 0}),dt||ae.current.push(st.word),L){const Xe=new Map(Y);if(dt){const $e=Xe.get(st.word)||0;if(Xe.set(st.word,$e+1),$e+1>=2){const Oe=V.filter(ht=>ht.word!==st.word);B(Oe),_.log(`‚úÖ ${st.word} „ÇíË£ú‰øÆÂØæË±°„Åã„ÇâÈô§Â§ñ (2ÂõûÈÄ£Á∂öÊ≠£Ëß£)`),Oe.length===0&&(alert("üéâ „Åô„Åπ„Å¶„ÅÆË¶ÅÂæ©ÁøíÂïèÈ°å„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„ÅüÔºÅ"),U(!1),K(new Map))}}else Xe.set(st.word,0);K(Xe)}}if(st){const Pt=String(st.word);Wr.onShown(Pt),Wr.onAnswer(Pt,dt),ye(st,P,O)}let ft=A.questions;!L&&st&&!dt&&(ft=ge(st,A.questions,A.currentIndex,"translation")),L||_e(Pt=>{const Yt=Pt+1;if(Yt>=50)return et(!0),yt("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(Yt%10===0){const mt=Ae(ft,"translation");mt.needsRescheduling&&(et(!0),yt(mt.reason))}return Yt}),z(Pt=>({...Pt,questions:ft,answered:!0,selectedAnswer:Z,score:dt?Pt.score+1:Pt.score,totalAnswered:Pt.totalAnswered+1}))},me=()=>{z(Z=>{var ie;const xe=L?V:Z.questions,ke=Z.currentIndex+1;if(!L&&ke<xe.length){const We=re(xe,ke-1);if(We!==xe)return{...Z,questions:We,currentIndex:ke,answered:!1,selectedAnswer:null}}if(!L&&ke>=xe.length){if(!window.location.hostname.includes("github.io"))try{const at=Wr.summarize();_.log("üß™ KPI Summary (translation):",at)}catch{}const We=Date.now(),vt=G.current.reduce((at,jt)=>at+jt.responseTime,0),dt=G.current.length>0?vt/G.current.length:0,st=((ie=oe.current)==null?void 0:ie.fatigueLevel)??0,Xt=nQ(bt.current,We,Z.totalAnswered,Z.score,dt,st,P.correct+P.mastered,P.review);aQ(Xt);const ft=cQ();if(ft.length>=3){const at=iQ("user",ft),jt=kI(),Pt=lQ(at,jt);_.log("üìä Â≠¶Áøí„Çπ„Çø„Ç§„É´AI:",Pt)}const Ge=(We-bt.current)/(1e3*60),nt=xQ(Z.score,Z.totalAnswered,dt,Ge,P.correct+P.mastered,st);_.log("üéÆ „Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥ÁµêÊûú:"),_.log(`  Áç≤ÂæóXP: ${nt.xpGained}`),nt.leveledUp&&_.log(`  üéâ „É¨„Éô„É´„Ç¢„ÉÉ„Éó! Lv.${nt.newLevel}`),nt.feedback.forEach(at=>{_.log(`  ${at.icon} ${at.message}`)})}return L&&ke>=xe.length?(_.log("üîÑ Ë£ú‰øÆ„É¢„Éº„Éâ: ÂïèÈ°å„ÇíÁπ∞„ÇäËøî„Åó„Åæ„Åô"),{...Z,questions:xe,currentIndex:0,answered:!1,selectedAnswer:null}):{...Z,questions:xe,currentIndex:ke%xe.length,answered:!1,selectedAnswer:null}}),$t.current=Date.now()},Me=()=>{z(Z=>({...Z,currentIndex:Z.currentIndex>0?Z.currentIndex-1:0,answered:!1,selectedAnswer:null}))},Ie=async()=>{const Z=A.questions[A.currentIndex];if(Z){const xe=Date.now()-$t.current;await Eh(Z.word,30),SI(Z.word),await Co(Z.word,!0,xe,void 0,"translation"),z(ke=>({...ke,score:ke.score+1,totalAnswered:ke.totalAnswered+1,currentIndex:(ke.currentIndex+1)%ke.questions.length,answered:!1,selectedAnswer:null})),O(ke=>({...ke,correct:ke.correct+1,mastered:ke.mastered+1})),xa({status:"correct",word:Z.word,timestamp:Date.now()},"translation")}else z(xe=>({...xe,currentIndex:(xe.currentIndex+1)%xe.questions.length,answered:!1,selectedAnswer:null}));$t.current=Date.now(),!L&&n==="translation"&&_e(xe=>{const ke=xe+1;if(ke>=50)return et(!0),yt("50ÂõûËß£Á≠î„Å´ÈÅî„Åó„Åæ„Åó„Åü"),0;if(ke%10===0){const ie=Ae(A.questions,"translation");ie.needsRescheduling&&(et(!0),yt(ie.reason))}return ke})},tt=Z=>{const xe=A.questions[A.currentIndex];if(xe){const ke=Date.now()-$t.current;Co(xe.word,A.selectedAnswer===xe.meaning,ke,Z,"translation")}};return u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx(QY,{isVisible:t,message:"Ë™≠„ÅøËæº„Åø‰∏≠..."}),u.jsxs("div",{className:"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2",children:[u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="memorization"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("memorization"),children:"üí° ÊöóË®ò"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="translation"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("translation"),children:"üìù ÂíåË®≥"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="spelling"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("spelling"),children:"‚úèÔ∏è „Çπ„Éö„É´"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="grammar"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>{e("grammar"),s(!0),setTimeout(()=>s(!1),1500),Yy()},children:"üìö ÊñáÊ≥ï"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="reading"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>{e("reading"),s(!0),setTimeout(()=>s(!1),1500),Yy()},children:"üìñ Èï∑Êñá"}),u.jsx("button",{className:`flex-1 min-w-0 truncate py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${n==="settings"?"bg-white text-blue-600 border-blue-600":"bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800"}`,onClick:()=>e("settings"),children:"‚öôÔ∏è Ë®≠ÂÆö"})]}),u.jsx($Y,{isOpen:c,onClose:()=>l(!1),sets:i.sets,onCreateSet:De,onDeleteSet:Ke,onEditSet:pt,onRemoveWord:D}),u.jsx("div",{className:"p-2 md:p-6 bg-gray-50",children:u.jsx("div",{className:"max-w-app mx-auto",children:n==="memorization"?u.jsx(kY,{allQuestions:r,questionSets:N,customQuestionSets:i.sets,onAddWordToCustomSet:R,onRemoveWordFromCustomSet:D,onOpenCustomSetManagement:()=>l(!0)}):n==="translation"?u.jsx(W9,{quizState:A,_categoryList:d,selectedCategory:p,onCategoryChange:ue,selectedDifficulty:m,onDifficultyChange:J,selectedWordPhraseFilter:x,onWordPhraseFilterChange:y,selectedPhraseTypeFilter:b,onPhraseTypeFilterChange:v,selectedDataSource:w,onDataSourceChange:S,questionSets:N,onStartQuiz:F,onAnswer:de,onNext:me,onPrevious:Me,onSkip:Ie,onDifficultyRate:tt,onReviewFocus:M,sessionStats:P,isReviewFocusMode:L,errorPrediction:A.questions.length>0&&A.currentIndex<A.questions.length?Te.current.get(A.questions[A.currentIndex].word):void 0,customQuestionSets:i.sets,onAddWordToCustomSet:R,onRemoveWordFromCustomSet:D,onOpenCustomSetManagement:()=>l(!0)}):n==="spelling"?u.jsx(U9,{questions:A.questions,_categoryList:d,selectedCategory:p,onCategoryChange:ue,selectedDifficulty:m,onDifficultyChange:J,selectedWordPhraseFilter:x,onWordPhraseFilterChange:y,selectedPhraseTypeFilter:b,onPhraseTypeFilterChange:v,selectedDataSource:w,onDataSourceChange:S,onStartQuiz:F,onReviewFocus:X,isReviewFocusMode:L,customQuestionSets:i.sets,onAddWordToCustomSet:R,onRemoveWordFromCustomSet:D,onOpenCustomSetManagement:()=>l(!0)}):n==="reading"?u.jsx(OI,{customQuestionSets:i.sets,onAddWordToCustomSet:R,onRemoveWordFromCustomSet:D,onOpenCustomSetManagement:()=>l(!0),onSaveUnknownWords:async Z=>{if(Z.length===0)return;const xe=new Date,ie=`Èï∑ÊñáÂçòË™ûÈõÜ (${`${xe.getMonth()+1}/${xe.getDate()}`})`,We=prompt(`${Z.length}ÂÄã„ÅÆÂçòË™û„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
ÂïèÈ°åÈõÜ„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:`,ie);if(!We)return;const vt={id:fc(),name:We,questions:Z.map(st=>({word:st.word,reading:st.reading||"",meaning:st.meaning,etymology:st.etymology||"",relatedWords:st.relatedWords||"",relatedFields:st.relatedFields||"",difficulty:st.difficulty||"intermediate"})),createdAt:Date.now(),isBuiltIn:!1,source:"Èï∑ÊñáË™≠Ëß£"},dt=[...N,vt];C(dt),fI(dt),alert(`‚úÖ ÂïèÈ°åÈõÜ„Äå${We}„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºà${Z.length}Ë™ûÔºâ`)}}):n==="grammar"?u.jsx(LI,{}):u.jsx(XY,{allQuestions:r,_selectedDataSource:w,_onDataSourceChange:S,customQuestionSets:i.sets,questionSets:N,categoryList:d,onResetComplete:()=>e("settings"),onQuestionSetsUpdated:Fe,onOpenCustomSetManagement:()=>l(!0),onStartSession:(Z,xe)=>{z({questions:xe,currentIndex:0,score:0,totalAnswered:0,answered:!1,selectedAnswer:null}),bt.current=Date.now(),$t.current=Date.now(),ae.current=[],e("translation")}})})})]})}const ZY=()=>{const n=localStorage.getItem("darkMode");let e="system";n==="system"||n==="light"||n==="dark"?e=n:n==="true"?(e="dark",localStorage.setItem("darkMode","dark")):n==="false"&&(e="light",localStorage.setItem("darkMode","light"));let t=!1;e==="system"?t=window.matchMedia("(prefers-color-scheme: dark)").matches:t=e==="dark",document.documentElement.classList.toggle("dark",t)};ZY();mp.createRoot(document.getElementById("root")).render(u.jsx(QI.StrictMode,{children:u.jsx(JY,{})}));export{e9 as a,_ as b,f0 as c,Rh as d,Uu as e,zu as f,Lu as g,lI as h,RI as i,dI as j,cJ as k,it as l};
//# sourceMappingURL=index-TvirIlx4.js.map
