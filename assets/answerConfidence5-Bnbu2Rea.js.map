{"version":3,"file":"answerConfidence5-Bnbu2Rea.js","sources":["../../src/ai/ml/AnswerConfidenceModel.ts","../../src/ai/utils/answerConfidence5.ts"],"sourcesContent":["import * as tf from '@tensorflow/tfjs';\n\nexport type AnswerConfidenceModelPrediction = {\n  pCorrect: number; // 0-1\n};\n\nconst STORAGE_KEY = 'ml-answer-confidence-v1';\nconst MAX_STORAGE_CHARS = 120_000; // localStorage安全側（他の保存を壊さない）\n\nfunction clamp01(value: number): number {\n  if (!Number.isFinite(value)) return 0;\n  return Math.max(0, Math.min(1, value));\n}\n\nfunction toBase64(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer);\n  let binary = '';\n  for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]!);\n  return btoa(binary);\n}\n\nfunction fromBase64(base64: string): ArrayBuffer {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);\n  return bytes.buffer;\n}\n\ntype PersistedWeights = {\n  version: 1;\n  savedAt: number;\n  specs: tf.io.WeightsManifestEntry[];\n  dataB64: string;\n  meta: {\n    trainCount: number;\n  };\n};\n\nexport class AnswerConfidenceModel {\n  private model: tf.LayersModel | null = null;\n  private inputDim: number;\n  private trainCount = 0;\n  private loading: Promise<void> | null = null;\n\n  constructor(inputDim: number) {\n    this.inputDim = inputDim;\n  }\n\n  async ensureInitialized(): Promise<void> {\n    if (this.model) return;\n    if (this.loading) return this.loading;\n\n    this.loading = (async () => {\n      // 1) 構築\n      const model = tf.sequential({\n        layers: [\n          tf.layers.dense({\n            inputShape: [this.inputDim],\n            units: 16,\n            activation: 'relu',\n            kernelInitializer: 'glorotUniform',\n          }),\n          tf.layers.dense({ units: 8, activation: 'relu' }),\n          tf.layers.dense({ units: 1, activation: 'sigmoid' }),\n        ],\n      });\n\n      model.compile({\n        optimizer: tf.train.adam(0.001),\n        loss: 'binaryCrossentropy',\n        metrics: ['accuracy'],\n      });\n\n      this.model = model;\n\n      // 2) 可能なら復元\n      await this.loadFromLocalStorage();\n    })();\n\n    await this.loading;\n  }\n\n  predict(features: number[]): AnswerConfidenceModelPrediction {\n    if (!this.model) {\n      // 初回は呼び出し側で ensureInitialized をawaitする想定だが、\n      // ここは防御的に「中立」を返す。\n      return { pCorrect: 0.5 };\n    }\n\n    if (!Array.isArray(features) || features.length !== this.inputDim) {\n      return { pCorrect: 0.5 };\n    }\n\n    const x = tf.tensor2d([features], [1, this.inputDim]);\n    const y = this.model.predict(x) as tf.Tensor;\n    const value = y.dataSync()[0] ?? 0.5;\n    x.dispose();\n    y.dispose();\n\n    return { pCorrect: clamp01(value) };\n  }\n\n  async learn(features: number[], wasCorrect: boolean): Promise<void> {\n    if (!this.model) return;\n    if (!Array.isArray(features) || features.length !== this.inputDim) return;\n\n    const x = tf.tensor2d([features], [1, this.inputDim]);\n    const y = tf.tensor2d([[wasCorrect ? 1 : 0]], [1, 1]);\n\n    try {\n      await this.model.fit(x, y, {\n        epochs: 1,\n        batchSize: 1,\n        shuffle: false,\n        verbose: 0,\n      });\n\n      this.trainCount += 1;\n\n      // 学習10回ごとに保存（容量を守りつつ）\n      if (this.trainCount % 10 === 0) {\n        await this.saveToLocalStorage();\n      }\n    } catch {\n      // 学習失敗は無視（UX優先）\n    } finally {\n      x.dispose();\n      y.dispose();\n    }\n  }\n\n  private async saveToLocalStorage(): Promise<void> {\n    if (!this.model) return;\n    if (typeof localStorage === 'undefined') return;\n\n    try {\n      const weights = this.model.getWeights();\n      const named = weights.map((tensor, index) => ({ name: `w${index}`, tensor }));\n      const { data, specs } = await tf.io.encodeWeights(named);\n\n      const payload: PersistedWeights = {\n        version: 1,\n        savedAt: Date.now(),\n        specs,\n        dataB64: toBase64(data),\n        meta: { trainCount: this.trainCount },\n      };\n\n      const json = JSON.stringify(payload);\n      if (json.length > MAX_STORAGE_CHARS) {\n        // 大きすぎる場合は保存しない（他の保存を壊さない）\n        try {\n          localStorage.removeItem(STORAGE_KEY);\n        } catch {\n          // ignore\n        }\n        return;\n      }\n\n      localStorage.setItem(STORAGE_KEY, json);\n    } catch {\n      // QuotaExceeded などは無視\n    }\n  }\n\n  private async loadFromLocalStorage(): Promise<void> {\n    if (!this.model) return;\n    if (typeof localStorage === 'undefined') return;\n\n    try {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      if (!raw) return;\n\n      const parsed = JSON.parse(raw) as PersistedWeights;\n      if (!parsed || parsed.version !== 1) return;\n      if (!Array.isArray(parsed.specs) || typeof parsed.dataB64 !== 'string') return;\n\n      const data = fromBase64(parsed.dataB64);\n      const tensors = await tf.io.decodeWeights(data, parsed.specs);\n\n      // w0..wn の順で復元\n      const current = this.model.getWeights();\n      const ordered = current.map((_, index) => tensors[`w${index}`]).filter(Boolean) as tf.Tensor[];\n\n      if (ordered.length === current.length) {\n        this.model.setWeights(ordered);\n        this.trainCount = parsed.meta?.trainCount ?? this.trainCount;\n      }\n\n      // decodeWeightsが返したテンソルのうち未使用があっても放置でOK（GC対象）\n    } catch {\n      // 壊れたデータは破棄\n      try {\n        localStorage.removeItem(STORAGE_KEY);\n      } catch {\n        // ignore\n      }\n    }\n  }\n}\n\nlet singleton: AnswerConfidenceModel | null = null;\n\n/**\n * 単一インスタンスを返す（モデル初期化は呼び出し側でawait）\n */\nexport function getAnswerConfidenceModel(inputDim: number): AnswerConfidenceModel {\n  if (!singleton) singleton = new AnswerConfidenceModel(inputDim);\n  return singleton;\n}\n","import type { StorageWordProgress } from '@/ai/types';\nimport { getAnswerConfidenceModel } from '@/ai/ml/AnswerConfidenceModel';\n\nexport type AnswerConfidence5 = 1 | 2 | 3 | 4 | 5;\n\nexport type Confidence5Estimate = {\n  confidence5: AnswerConfidence5;\n  score01: number;\n  source: 'deep' | 'heuristic';\n};\n\nfunction clamp01(value: number): number {\n  if (!Number.isFinite(value)) return 0;\n  return Math.max(0, Math.min(1, value));\n}\n\nfunction mapScoreToConfidence5(score01: number): AnswerConfidence5 {\n  const s = clamp01(score01);\n  if (s < 0.2) return 1;\n  if (s < 0.4) return 2;\n  if (s < 0.6) return 3;\n  if (s < 0.8) return 4;\n  return 5;\n}\n\nfunction safeDiv(numerator: number, denominator: number, fallback = 0): number {\n  if (!Number.isFinite(numerator) || !Number.isFinite(denominator) || denominator === 0) {\n    return fallback;\n  }\n  return numerator / denominator;\n}\n\nfunction buildFeatures(params: {\n  progress: StorageWordProgress | null | undefined;\n  responseTimeMs: number;\n  timestamp: number;\n}): number[] {\n  const progress = params.progress;\n\n  const attempts = progress?.memorizationAttempts ?? progress?.totalAttempts ?? 0;\n  const correct = progress?.memorizationCorrect ?? progress?.correctCount ?? 0;\n  const incorrect = progress?.incorrectCount ?? 0;\n  const streak = progress?.consecutiveCorrect ?? 0;\n\n  const accuracy = attempts > 0 ? correct / attempts : 0.5;\n  const daysSinceLast = progress?.lastStudied\n    ? (params.timestamp - (progress.lastStudied ?? 0)) / 86_400_000\n    : 999;\n\n  const avgRt = progress?.averageResponseTime ?? 3000;\n\n  // 時刻特徴量（曜日/時間帯）\n  const d = new Date(params.timestamp);\n  const hour = d.getHours();\n  const day = d.getDay();\n\n  // responseTimeはスケールが大きいので log 正規化\n  const rtLog = Math.log10(Math.max(50, params.responseTimeMs)) / 4; // ~0-1程度\n\n  return [\n    clamp01(rtLog),\n    clamp01(hour / 23),\n    clamp01(day / 6),\n    clamp01(safeDiv(attempts, 50, 0)),\n    clamp01(accuracy),\n    clamp01(safeDiv(streak, 10, 0)),\n    clamp01(safeDiv(incorrect, 20, 0)),\n    clamp01(safeDiv(daysSinceLast, 30, 1)),\n    clamp01(Math.log10(Math.max(50, avgRt)) / 4),\n    clamp01(safeDiv(progress?.difficultyScore ?? 0, 1, 0)),\n  ];\n}\n\nfunction estimateHeuristic(params: {\n  progress: StorageWordProgress | null | undefined;\n  wasCorrect: boolean;\n  responseTimeMs: number;\n  timestamp: number;\n}): Confidence5Estimate {\n  if (!params.wasCorrect) {\n    return { confidence5: 1, score01: 0.0, source: 'heuristic' };\n  }\n\n  const avgRt = params.progress?.averageResponseTime ?? 3000;\n  const speedRatio = avgRt > 0 ? avgRt / Math.max(200, params.responseTimeMs) : 1;\n\n  // 速いほど高い（ただし過剰に上がらないように）\n  const speedScore = clamp01(Math.log2(Math.max(0.25, Math.min(4, speedRatio))) / 2 + 0.5);\n\n  const streak = params.progress?.consecutiveCorrect ?? 0;\n  const streakScore = clamp01(streak / 6);\n\n  const score01 = clamp01(0.65 * speedScore + 0.35 * streakScore);\n  return { confidence5: mapScoreToConfidence5(score01), score01, source: 'heuristic' };\n}\n\n/**\n * 回答ログから「自信度(1-5)」を推定する。\n * - 基本は深層学習モデルの p(correct) を使用（オンライン学習）\n * - モデル未初期化/失敗時はヒューリスティックにフォールバック\n */\nexport async function estimateConfidence5(params: {\n  progress: StorageWordProgress | null | undefined;\n  wasCorrect: boolean;\n  responseTimeMs: number;\n  timestamp?: number;\n}): Promise<Confidence5Estimate> {\n  const timestamp = params.timestamp ?? Date.now();\n\n  // 不正解は常に最低（SM-2品質の直感と整合）\n  if (!params.wasCorrect) {\n    return { confidence5: 1, score01: 0.0, source: 'deep' };\n  }\n\n  const features = buildFeatures({\n    progress: params.progress,\n    responseTimeMs: params.responseTimeMs,\n    timestamp,\n  });\n\n  try {\n    const model = getAnswerConfidenceModel(features.length);\n    await model.ensureInitialized();\n\n    const pred = model.predict(features);\n    const score01 = clamp01(pred.pCorrect);\n\n    // 学習は非同期で回す（UX優先）\n    model.learn(features, params.wasCorrect).catch(() => {\n      // ignore\n    });\n\n    return { confidence5: mapScoreToConfidence5(score01), score01, source: 'deep' };\n  } catch {\n    return estimateHeuristic({\n      progress: params.progress,\n      wasCorrect: params.wasCorrect,\n      responseTimeMs: params.responseTimeMs,\n      timestamp,\n    });\n  }\n}\n"],"names":["STORAGE_KEY","MAX_STORAGE_CHARS","clamp01","value","toBase64","buffer","bytes","binary","fromBase64","base64","AnswerConfidenceModel","inputDim","__publicField","model","tf.sequential","tf.layers.dense","tf.train","features","x","tf.tensor2d","y","wasCorrect","named","tensor","index","data","specs","tf.io.encodeWeights","payload","json","raw","parsed","tensors","tf.io.decodeWeights","current","ordered","_","_a","singleton","getAnswerConfidenceModel","mapScoreToConfidence5","score01","s","safeDiv","numerator","denominator","fallback","buildFeatures","params","progress","attempts","correct","incorrect","streak","accuracy","daysSinceLast","avgRt","d","hour","day","rtLog","estimateHeuristic","speedRatio","speedScore","_b","streakScore","estimateConfidence5","timestamp","pred"],"mappings":"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"}